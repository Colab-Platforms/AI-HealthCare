const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-Dnu_DjK3.js","assets/vendor-BZrlrEDh.js","assets/ui-CkCUbQrz.js"])))=>i.map(i=>d[i]);
var Nre=Object.defineProperty;var Tre=(a,o,c)=>o in a?Nre(a,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[o]=c;var vn=(a,o,c)=>Tre(a,typeof o!="symbol"?o+"":o,c);import{r as ee,a as Rre,u as Ha,b as rE,L as Hs,d as Ire,R as qV,e as ox,f as YV,c as D_,g as Ore,h as kre,i as wn,N as Tc,B as Dre}from"./vendor-BZrlrEDh.js";import{M as cx,X as Gn,S as Ig,H as Ca,W as HA,C as yi,L as zR,a as nE,A as br,b as XV,F as Hn,c as Bre,D as iE,U as lx,d as lh,e as Dy,B as dh,f as Vn,g as Oc,h as Jd,i as JV,j as To,T as qi,k as Ah,l as $V,P as eh,m as Og,n as ZV,o as eQ,p as Ju,Z as td,q as V3,r as qR,s as yg,t as lo,u as uh,v as aE,w as Zb,E as tQ,x as zp,y as Q3,R as Lre,z as YR,G as jre,I as Pre,J as Ure,K as ah,N as GT,O as kg,Q as Al,V as Tn,Y as Fre,_ as Mre,$ as sQ,a0 as Vre,a1 as GA,a2 as Qre,a3 as qp,a4 as KA,a5 as XR,a6 as ul,a7 as Hre,a8 as Kb,a9 as Yp,aa as Gre,ab as Eg,ac as Cg,ad as Sg,ae as ex,af as Kre,ag as By,ah as Ly,ai as Li,aj as th,ak as Zo,al as KT,am as JR,an as Wre,ao as rQ,ap as zA,aq as Fn,ar as nQ,as as qd,at as iQ,au as zre,av as $R,aw as gg,ax as ZR,ay as aQ,az as oQ,aA as cQ,aB as lQ,aC as WT,aD as dQ,aE as H3,aF as G3,aG as oE,aH as qre,aI as AQ,aJ as zT,aK as Yre,aL as Xre,aM as Jre,aN as $re,aO as Zre,aP as ene,aQ as tne,aR as sne,aS as rne,aT as nne,aU as ine,aV as ane,aW as Q2,aX as one,aY as cne,aZ as lne,a_ as K3,a$ as dne}from"./ui-CkCUbQrz.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function c(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(h){if(h.ep)return;h.ep=!0;const p=c(h);fetch(h.href,p)}})();var uQ={exports:{}},cE={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ane=ee,une=Symbol.for("react.element"),hne=Symbol.for("react.fragment"),pne=Object.prototype.hasOwnProperty,mne=Ane.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fne={key:!0,ref:!0,__self:!0,__source:!0};function hQ(a,o,c){var d,h={},p=null,g=null;c!==void 0&&(p=""+c),o.key!==void 0&&(p=""+o.key),o.ref!==void 0&&(g=o.ref);for(d in o)pne.call(o,d)&&!fne.hasOwnProperty(d)&&(h[d]=o[d]);if(a&&a.defaultProps)for(d in o=a.defaultProps,o)h[d]===void 0&&(h[d]=o[d]);return{$$typeof:une,type:a,key:p,ref:g,props:h,_owner:mne.current}}cE.Fragment=hne;cE.jsx=hQ;cE.jsxs=hQ;uQ.exports=cE;var n=uQ.exports,qT={},W3=Rre;qT.createRoot=W3.createRoot,qT.hydrateRoot=W3.hydrateRoot;let gne={data:""},bne=a=>{if(typeof window=="object"){let o=(a?a.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return o.nonce=window.__nonce__,o.parentNode||(a||document.head).appendChild(o),o.firstChild}return a||gne},xne=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,vne=/\/\*[^]*?\*\/|  +/g,z3=/\n+/g,Zu=(a,o)=>{let c="",d="",h="";for(let p in a){let g=a[p];p[0]=="@"?p[1]=="i"?c=p+" "+g+";":d+=p[1]=="f"?Zu(g,p):p+"{"+Zu(g,p[1]=="k"?"":o)+"}":typeof g=="object"?d+=Zu(g,o?o.replace(/([^,])+/g,x=>p.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,v=>/&/.test(v)?v.replace(/&/g,x):x?x+" "+v:v)):p):g!=null&&(p=/^--/.test(p)?p:p.replace(/[A-Z]/g,"-$&").toLowerCase(),h+=Zu.p?Zu.p(p,g):p+":"+g+";")}return c+(o&&h?o+"{"+h+"}":h)+d},LA={},pQ=a=>{if(typeof a=="object"){let o="";for(let c in a)o+=c+pQ(a[c]);return o}return a},wne=(a,o,c,d,h)=>{let p=pQ(a),g=LA[p]||(LA[p]=(v=>{let E=0,C=11;for(;E<v.length;)C=101*C+v.charCodeAt(E++)>>>0;return"go"+C})(p));if(!LA[g]){let v=p!==a?a:(E=>{let C,I,O=[{}];for(;C=xne.exec(E.replace(vne,""));)C[4]?O.shift():C[3]?(I=C[3].replace(z3," ").trim(),O.unshift(O[0][I]=O[0][I]||{})):O[0][C[1]]=C[2].replace(z3," ").trim();return O[0]})(a);LA[g]=Zu(h?{["@keyframes "+g]:v}:v,c?"":"."+g)}let x=c&&LA.g?LA.g:null;return c&&(LA.g=LA[g]),((v,E,C,I)=>{I?E.data=E.data.replace(I,v):E.data.indexOf(v)===-1&&(E.data=C?v+E.data:E.data+v)})(LA[g],o,d,x),g},_ne=(a,o,c)=>a.reduce((d,h,p)=>{let g=o[p];if(g&&g.call){let x=g(c),v=x&&x.props&&x.props.className||/^go/.test(x)&&x;g=v?"."+v:x&&typeof x=="object"?x.props?"":Zu(x,""):x===!1?"":x}return d+h+(g??"")},"");function lE(a){let o=this||{},c=a.call?a(o.p):a;return wne(c.unshift?c.raw?_ne(c,[].slice.call(arguments,1),o.p):c.reduce((d,h)=>Object.assign(d,h&&h.call?h(o.p):h),{}):c,bne(o.target),o.g,o.o,o.k)}let mQ,YT,XT;lE.bind({g:1});let qA=lE.bind({k:1});function yne(a,o,c,d){Zu.p=o,mQ=a,YT=c,XT=d}function mh(a,o){let c=this||{};return function(){let d=arguments;function h(p,g){let x=Object.assign({},p),v=x.className||h.className;c.p=Object.assign({theme:YT&&YT()},x),c.o=/ *go\d+/.test(v),x.className=lE.apply(c,d)+(v?" "+v:"");let E=a;return a[0]&&(E=x.as||a,delete x.as),XT&&E[0]&&XT(x),mQ(E,x)}return h}}var Ene=a=>typeof a=="function",jy=(a,o)=>Ene(a)?a(o):a,Cne=(()=>{let a=0;return()=>(++a).toString()})(),fQ=(()=>{let a;return()=>{if(a===void 0&&typeof window<"u"){let o=matchMedia("(prefers-reduced-motion: reduce)");a=!o||o.matches}return a}})(),Sne=20,eI="default",gQ=(a,o)=>{let{toastLimit:c}=a.settings;switch(o.type){case 0:return{...a,toasts:[o.toast,...a.toasts].slice(0,c)};case 1:return{...a,toasts:a.toasts.map(g=>g.id===o.toast.id?{...g,...o.toast}:g)};case 2:let{toast:d}=o;return gQ(a,{type:a.toasts.find(g=>g.id===d.id)?1:0,toast:d});case 3:let{toastId:h}=o;return{...a,toasts:a.toasts.map(g=>g.id===h||h===void 0?{...g,dismissed:!0,visible:!1}:g)};case 4:return o.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(g=>g.id!==o.toastId)};case 5:return{...a,pausedAt:o.time};case 6:let p=o.time-(a.pausedAt||0);return{...a,pausedAt:void 0,toasts:a.toasts.map(g=>({...g,pauseDuration:g.pauseDuration+p}))}}},gy=[],bQ={toasts:[],pausedAt:void 0,settings:{toastLimit:Sne}},Yd={},xQ=(a,o=eI)=>{Yd[o]=gQ(Yd[o]||bQ,a),gy.forEach(([c,d])=>{c===o&&d(Yd[o])})},vQ=a=>Object.keys(Yd).forEach(o=>xQ(a,o)),Nne=a=>Object.keys(Yd).find(o=>Yd[o].toasts.some(c=>c.id===a)),dE=(a=eI)=>o=>{xQ(o,a)},Tne={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Rne=(a={},o=eI)=>{let[c,d]=ee.useState(Yd[o]||bQ),h=ee.useRef(Yd[o]);ee.useEffect(()=>(h.current!==Yd[o]&&d(Yd[o]),gy.push([o,d]),()=>{let g=gy.findIndex(([x])=>x===o);g>-1&&gy.splice(g,1)}),[o]);let p=c.toasts.map(g=>{var x,v,E;return{...a,...a[g.type],...g,removeDelay:g.removeDelay||((x=a[g.type])==null?void 0:x.removeDelay)||(a==null?void 0:a.removeDelay),duration:g.duration||((v=a[g.type])==null?void 0:v.duration)||(a==null?void 0:a.duration)||Tne[g.type],style:{...a.style,...(E=a[g.type])==null?void 0:E.style,...g.style}}});return{...c,toasts:p}},Ine=(a,o="blank",c)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:o,ariaProps:{role:"status","aria-live":"polite"},message:a,pauseDuration:0,...c,id:(c==null?void 0:c.id)||Cne()}),dx=a=>(o,c)=>{let d=Ine(o,a,c);return dE(d.toasterId||Nne(d.id))({type:2,toast:d}),d.id},ca=(a,o)=>dx("blank")(a,o);ca.error=dx("error");ca.success=dx("success");ca.loading=dx("loading");ca.custom=dx("custom");ca.dismiss=(a,o)=>{let c={type:3,toastId:a};o?dE(o)(c):vQ(c)};ca.dismissAll=a=>ca.dismiss(void 0,a);ca.remove=(a,o)=>{let c={type:4,toastId:a};o?dE(o)(c):vQ(c)};ca.removeAll=a=>ca.remove(void 0,a);ca.promise=(a,o,c)=>{let d=ca.loading(o.loading,{...c,...c==null?void 0:c.loading});return typeof a=="function"&&(a=a()),a.then(h=>{let p=o.success?jy(o.success,h):void 0;return p?ca.success(p,{id:d,...c,...c==null?void 0:c.success}):ca.dismiss(d),h}).catch(h=>{let p=o.error?jy(o.error,h):void 0;p?ca.error(p,{id:d,...c,...c==null?void 0:c.error}):ca.dismiss(d)}),a};var One=1e3,kne=(a,o="default")=>{let{toasts:c,pausedAt:d}=Rne(a,o),h=ee.useRef(new Map).current,p=ee.useCallback((I,O=One)=>{if(h.has(I))return;let R=setTimeout(()=>{h.delete(I),g({type:4,toastId:I})},O);h.set(I,R)},[]);ee.useEffect(()=>{if(d)return;let I=Date.now(),O=c.map(R=>{if(R.duration===1/0)return;let k=(R.duration||0)+R.pauseDuration-(I-R.createdAt);if(k<0){R.visible&&ca.dismiss(R.id);return}return setTimeout(()=>ca.dismiss(R.id,o),k)});return()=>{O.forEach(R=>R&&clearTimeout(R))}},[c,d,o]);let g=ee.useCallback(dE(o),[o]),x=ee.useCallback(()=>{g({type:5,time:Date.now()})},[g]),v=ee.useCallback((I,O)=>{g({type:1,toast:{id:I,height:O}})},[g]),E=ee.useCallback(()=>{d&&g({type:6,time:Date.now()})},[d,g]),C=ee.useCallback((I,O)=>{let{reverseOrder:R=!1,gutter:k=8,defaultPosition:M}=O||{},P=c.filter(re=>(re.position||M)===(I.position||M)&&re.height),H=P.findIndex(re=>re.id===I.id),$=P.filter((re,J)=>J<H&&re.visible).length;return P.filter(re=>re.visible).slice(...R?[$+1]:[0,$]).reduce((re,J)=>re+(J.height||0)+k,0)},[c]);return ee.useEffect(()=>{c.forEach(I=>{if(I.dismissed)p(I.id,I.removeDelay);else{let O=h.get(I.id);O&&(clearTimeout(O),h.delete(I.id))}})},[c,p]),{toasts:c,handlers:{updateHeight:v,startPause:x,endPause:E,calculateOffset:C}}},Dne=qA`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Bne=qA`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Lne=qA`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,jne=mh("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dne} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Bne} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${a=>a.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Lne} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Pne=qA`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Une=mh("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${a=>a.secondary||"#e0e0e0"};
  border-right-color: ${a=>a.primary||"#616161"};
  animation: ${Pne} 1s linear infinite;
`,Fne=qA`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Mne=qA`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Vne=mh("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${a=>a.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Fne} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Mne} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${a=>a.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Qne=mh("div")`
  position: absolute;
`,Hne=mh("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Gne=qA`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Kne=mh("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Gne} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Wne=({toast:a})=>{let{icon:o,type:c,iconTheme:d}=a;return o!==void 0?typeof o=="string"?ee.createElement(Kne,null,o):o:c==="blank"?null:ee.createElement(Hne,null,ee.createElement(Une,{...d}),c!=="loading"&&ee.createElement(Qne,null,c==="error"?ee.createElement(jne,{...d}):ee.createElement(Vne,{...d})))},zne=a=>`
0% {transform: translate3d(0,${a*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qne=a=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${a*-150}%,-1px) scale(.6); opacity:0;}
`,Yne="0%{opacity:0;} 100%{opacity:1;}",Xne="0%{opacity:1;} 100%{opacity:0;}",Jne=mh("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,$ne=mh("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Zne=(a,o)=>{let c=a.includes("top")?1:-1,[d,h]=fQ()?[Yne,Xne]:[zne(c),qne(c)];return{animation:o?`${qA(d)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${qA(h)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},eie=ee.memo(({toast:a,position:o,style:c,children:d})=>{let h=a.height?Zne(a.position||o||"top-center",a.visible):{opacity:0},p=ee.createElement(Wne,{toast:a}),g=ee.createElement($ne,{...a.ariaProps},jy(a.message,a));return ee.createElement(Jne,{className:a.className,style:{...h,...c,...a.style}},typeof d=="function"?d({icon:p,message:g}):ee.createElement(ee.Fragment,null,p,g))});yne(ee.createElement);var tie=({id:a,className:o,style:c,onHeightUpdate:d,children:h})=>{let p=ee.useCallback(g=>{if(g){let x=()=>{let v=g.getBoundingClientRect().height;d(a,v)};x(),new MutationObserver(x).observe(g,{subtree:!0,childList:!0,characterData:!0})}},[a,d]);return ee.createElement("div",{ref:p,className:o,style:c},h)},sie=(a,o)=>{let c=a.includes("top"),d=c?{top:0}:{bottom:0},h=a.includes("center")?{justifyContent:"center"}:a.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:fQ()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${o*(c?1:-1)}px)`,...d,...h}},rie=lE`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,B_=16,nie=({reverseOrder:a,position:o="top-center",toastOptions:c,gutter:d,children:h,toasterId:p,containerStyle:g,containerClassName:x})=>{let{toasts:v,handlers:E}=kne(c,p);return ee.createElement("div",{"data-rht-toaster":p||"",style:{position:"fixed",zIndex:9999,top:B_,left:B_,right:B_,bottom:B_,pointerEvents:"none",...g},className:x,onMouseEnter:E.startPause,onMouseLeave:E.endPause},v.map(C=>{let I=C.position||o,O=E.calculateOffset(C,{reverseOrder:a,gutter:d,defaultPosition:o}),R=sie(I,O);return ee.createElement(tie,{id:C.id,key:C.id,onHeightUpdate:E.updateHeight,className:C.visible?rie:"",style:R},C.type==="custom"?jy(C.message,C):h?h(C):ee.createElement(eie,{toast:C,position:I}))}))},St=ca;function wQ(a,o){return function(){return a.apply(o,arguments)}}const{toString:iie}=Object.prototype,{getPrototypeOf:tI}=Object,{iterator:AE,toStringTag:_Q}=Symbol,uE=(a=>o=>{const c=iie.call(o);return a[c]||(a[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),nd=a=>(a=a.toLowerCase(),o=>uE(o)===a),hE=a=>o=>typeof o===a,{isArray:Dg}=Array,Ng=hE("undefined");function Ax(a){return a!==null&&!Ng(a)&&a.constructor!==null&&!Ng(a.constructor)&&ec(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const yQ=nd("ArrayBuffer");function aie(a){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(a):o=a&&a.buffer&&yQ(a.buffer),o}const oie=hE("string"),ec=hE("function"),EQ=hE("number"),ux=a=>a!==null&&typeof a=="object",cie=a=>a===!0||a===!1,by=a=>{if(uE(a)!=="object")return!1;const o=tI(a);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(_Q in a)&&!(AE in a)},lie=a=>{if(!ux(a)||Ax(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},die=nd("Date"),Aie=nd("File"),uie=nd("Blob"),hie=nd("FileList"),pie=a=>ux(a)&&ec(a.pipe),mie=a=>{let o;return a&&(typeof FormData=="function"&&a instanceof FormData||ec(a.append)&&((o=uE(a))==="formdata"||o==="object"&&ec(a.toString)&&a.toString()==="[object FormData]"))},fie=nd("URLSearchParams"),[gie,bie,xie,vie]=["ReadableStream","Request","Response","Headers"].map(nd),wie=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function hx(a,o,{allOwnKeys:c=!1}={}){if(a===null||typeof a>"u")return;let d,h;if(typeof a!="object"&&(a=[a]),Dg(a))for(d=0,h=a.length;d<h;d++)o.call(null,a[d],d,a);else{if(Ax(a))return;const p=c?Object.getOwnPropertyNames(a):Object.keys(a),g=p.length;let x;for(d=0;d<g;d++)x=p[d],o.call(null,a[x],x,a)}}function CQ(a,o){if(Ax(a))return null;o=o.toLowerCase();const c=Object.keys(a);let d=c.length,h;for(;d-- >0;)if(h=c[d],o===h.toLowerCase())return h;return null}const Kp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,SQ=a=>!Ng(a)&&a!==Kp;function JT(){const{caseless:a,skipUndefined:o}=SQ(this)&&this||{},c={},d=(h,p)=>{const g=a&&CQ(c,p)||p;by(c[g])&&by(h)?c[g]=JT(c[g],h):by(h)?c[g]=JT({},h):Dg(h)?c[g]=h.slice():(!o||!Ng(h))&&(c[g]=h)};for(let h=0,p=arguments.length;h<p;h++)arguments[h]&&hx(arguments[h],d);return c}const _ie=(a,o,c,{allOwnKeys:d}={})=>(hx(o,(h,p)=>{c&&ec(h)?a[p]=wQ(h,c):a[p]=h},{allOwnKeys:d}),a),yie=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),Eie=(a,o,c,d)=>{a.prototype=Object.create(o.prototype,d),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:o.prototype}),c&&Object.assign(a.prototype,c)},Cie=(a,o,c,d)=>{let h,p,g;const x={};if(o=o||{},a==null)return o;do{for(h=Object.getOwnPropertyNames(a),p=h.length;p-- >0;)g=h[p],(!d||d(g,a,o))&&!x[g]&&(o[g]=a[g],x[g]=!0);a=c!==!1&&tI(a)}while(a&&(!c||c(a,o))&&a!==Object.prototype);return o},Sie=(a,o,c)=>{a=String(a),(c===void 0||c>a.length)&&(c=a.length),c-=o.length;const d=a.indexOf(o,c);return d!==-1&&d===c},Nie=a=>{if(!a)return null;if(Dg(a))return a;let o=a.length;if(!EQ(o))return null;const c=new Array(o);for(;o-- >0;)c[o]=a[o];return c},Tie=(a=>o=>a&&o instanceof a)(typeof Uint8Array<"u"&&tI(Uint8Array)),Rie=(a,o)=>{const d=(a&&a[AE]).call(a);let h;for(;(h=d.next())&&!h.done;){const p=h.value;o.call(a,p[0],p[1])}},Iie=(a,o)=>{let c;const d=[];for(;(c=a.exec(o))!==null;)d.push(c);return d},Oie=nd("HTMLFormElement"),kie=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,d,h){return d.toUpperCase()+h}),q3=(({hasOwnProperty:a})=>(o,c)=>a.call(o,c))(Object.prototype),Die=nd("RegExp"),NQ=(a,o)=>{const c=Object.getOwnPropertyDescriptors(a),d={};hx(c,(h,p)=>{let g;(g=o(h,p,a))!==!1&&(d[p]=g||h)}),Object.defineProperties(a,d)},Bie=a=>{NQ(a,(o,c)=>{if(ec(a)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const d=a[c];if(ec(d)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},Lie=(a,o)=>{const c={},d=h=>{h.forEach(p=>{c[p]=!0})};return Dg(a)?d(a):d(String(a).split(o)),c},jie=()=>{},Pie=(a,o)=>a!=null&&Number.isFinite(a=+a)?a:o;function Uie(a){return!!(a&&ec(a.append)&&a[_Q]==="FormData"&&a[AE])}const Fie=a=>{const o=new Array(10),c=(d,h)=>{if(ux(d)){if(o.indexOf(d)>=0)return;if(Ax(d))return d;if(!("toJSON"in d)){o[h]=d;const p=Dg(d)?[]:{};return hx(d,(g,x)=>{const v=c(g,h+1);!Ng(v)&&(p[x]=v)}),o[h]=void 0,p}}return d};return c(a,0)},Mie=nd("AsyncFunction"),Vie=a=>a&&(ux(a)||ec(a))&&ec(a.then)&&ec(a.catch),TQ=((a,o)=>a?setImmediate:o?((c,d)=>(Kp.addEventListener("message",({source:h,data:p})=>{h===Kp&&p===c&&d.length&&d.shift()()},!1),h=>{d.push(h),Kp.postMessage(c,"*")}))(`axios@${Math.random()}`,[]):c=>setTimeout(c))(typeof setImmediate=="function",ec(Kp.postMessage)),Qie=typeof queueMicrotask<"u"?queueMicrotask.bind(Kp):typeof process<"u"&&process.nextTick||TQ,Hie=a=>a!=null&&ec(a[AE]),bt={isArray:Dg,isArrayBuffer:yQ,isBuffer:Ax,isFormData:mie,isArrayBufferView:aie,isString:oie,isNumber:EQ,isBoolean:cie,isObject:ux,isPlainObject:by,isEmptyObject:lie,isReadableStream:gie,isRequest:bie,isResponse:xie,isHeaders:vie,isUndefined:Ng,isDate:die,isFile:Aie,isBlob:uie,isRegExp:Die,isFunction:ec,isStream:pie,isURLSearchParams:fie,isTypedArray:Tie,isFileList:hie,forEach:hx,merge:JT,extend:_ie,trim:wie,stripBOM:yie,inherits:Eie,toFlatObject:Cie,kindOf:uE,kindOfTest:nd,endsWith:Sie,toArray:Nie,forEachEntry:Rie,matchAll:Iie,isHTMLForm:Oie,hasOwnProperty:q3,hasOwnProp:q3,reduceDescriptors:NQ,freezeMethods:Bie,toObjectSet:Lie,toCamelCase:kie,noop:jie,toFiniteNumber:Pie,findKey:CQ,global:Kp,isContextDefined:SQ,isSpecCompliantForm:Uie,toJSONObject:Fie,isAsyncFn:Mie,isThenable:Vie,setImmediate:TQ,asap:Qie,isIterable:Hie};function Cr(a,o,c,d,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",o&&(this.code=o),c&&(this.config=c),d&&(this.request=d),h&&(this.response=h,this.status=h.status?h.status:null)}bt.inherits(Cr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:bt.toJSONObject(this.config),code:this.code,status:this.status}}});const RQ=Cr.prototype,IQ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{IQ[a]={value:a}});Object.defineProperties(Cr,IQ);Object.defineProperty(RQ,"isAxiosError",{value:!0});Cr.from=(a,o,c,d,h,p)=>{const g=Object.create(RQ);bt.toFlatObject(a,g,function(C){return C!==Error.prototype},E=>E!=="isAxiosError");const x=a&&a.message?a.message:"Error",v=o==null&&a?a.code:o;return Cr.call(g,x,v,c,d,h),a&&g.cause==null&&Object.defineProperty(g,"cause",{value:a,configurable:!0}),g.name=a&&a.name||"Error",p&&Object.assign(g,p),g};const Gie=null;function $T(a){return bt.isPlainObject(a)||bt.isArray(a)}function OQ(a){return bt.endsWith(a,"[]")?a.slice(0,-2):a}function Y3(a,o,c){return a?a.concat(o).map(function(h,p){return h=OQ(h),!c&&p?"["+h+"]":h}).join(c?".":""):o}function Kie(a){return bt.isArray(a)&&!a.some($T)}const Wie=bt.toFlatObject(bt,{},null,function(o){return/^is[A-Z]/.test(o)});function pE(a,o,c){if(!bt.isObject(a))throw new TypeError("target must be an object");o=o||new FormData,c=bt.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(M,P){return!bt.isUndefined(P[M])});const d=c.metaTokens,h=c.visitor||C,p=c.dots,g=c.indexes,v=(c.Blob||typeof Blob<"u"&&Blob)&&bt.isSpecCompliantForm(o);if(!bt.isFunction(h))throw new TypeError("visitor must be a function");function E(k){if(k===null)return"";if(bt.isDate(k))return k.toISOString();if(bt.isBoolean(k))return k.toString();if(!v&&bt.isBlob(k))throw new Cr("Blob is not supported. Use a Buffer instead.");return bt.isArrayBuffer(k)||bt.isTypedArray(k)?v&&typeof Blob=="function"?new Blob([k]):Buffer.from(k):k}function C(k,M,P){let H=k;if(k&&!P&&typeof k=="object"){if(bt.endsWith(M,"{}"))M=d?M:M.slice(0,-2),k=JSON.stringify(k);else if(bt.isArray(k)&&Kie(k)||(bt.isFileList(k)||bt.endsWith(M,"[]"))&&(H=bt.toArray(k)))return M=OQ(M),H.forEach(function(re,J){!(bt.isUndefined(re)||re===null)&&o.append(g===!0?Y3([M],J,p):g===null?M:M+"[]",E(re))}),!1}return $T(k)?!0:(o.append(Y3(P,M,p),E(k)),!1)}const I=[],O=Object.assign(Wie,{defaultVisitor:C,convertValue:E,isVisitable:$T});function R(k,M){if(!bt.isUndefined(k)){if(I.indexOf(k)!==-1)throw Error("Circular reference detected in "+M.join("."));I.push(k),bt.forEach(k,function(H,$){(!(bt.isUndefined(H)||H===null)&&h.call(o,H,bt.isString($)?$.trim():$,M,O))===!0&&R(H,M?M.concat($):[$])}),I.pop()}}if(!bt.isObject(a))throw new TypeError("data must be an object");return R(a),o}function X3(a){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(d){return o[d]})}function sI(a,o){this._pairs=[],a&&pE(a,this,o)}const kQ=sI.prototype;kQ.append=function(o,c){this._pairs.push([o,c])};kQ.toString=function(o){const c=o?function(d){return o.call(this,d,X3)}:X3;return this._pairs.map(function(h){return c(h[0])+"="+c(h[1])},"").join("&")};function zie(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function DQ(a,o,c){if(!o)return a;const d=c&&c.encode||zie;bt.isFunction(c)&&(c={serialize:c});const h=c&&c.serialize;let p;if(h?p=h(o,c):p=bt.isURLSearchParams(o)?o.toString():new sI(o,c).toString(d),p){const g=a.indexOf("#");g!==-1&&(a=a.slice(0,g)),a+=(a.indexOf("?")===-1?"?":"&")+p}return a}class J3{constructor(){this.handlers=[]}use(o,c,d){return this.handlers.push({fulfilled:o,rejected:c,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){bt.forEach(this.handlers,function(d){d!==null&&o(d)})}}const BQ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qie=typeof URLSearchParams<"u"?URLSearchParams:sI,Yie=typeof FormData<"u"?FormData:null,Xie=typeof Blob<"u"?Blob:null,Jie={isBrowser:!0,classes:{URLSearchParams:qie,FormData:Yie,Blob:Xie},protocols:["http","https","file","blob","url","data"]},rI=typeof window<"u"&&typeof document<"u",ZT=typeof navigator=="object"&&navigator||void 0,$ie=rI&&(!ZT||["ReactNative","NativeScript","NS"].indexOf(ZT.product)<0),Zie=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",eae=rI&&window.location.href||"http://localhost",tae=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:rI,hasStandardBrowserEnv:$ie,hasStandardBrowserWebWorkerEnv:Zie,navigator:ZT,origin:eae},Symbol.toStringTag,{value:"Module"})),co={...tae,...Jie};function sae(a,o){return pE(a,new co.classes.URLSearchParams,{visitor:function(c,d,h,p){return co.isNode&&bt.isBuffer(c)?(this.append(d,c.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)},...o})}function rae(a){return bt.matchAll(/\w+|\[(\w*)]/g,a).map(o=>o[0]==="[]"?"":o[1]||o[0])}function nae(a){const o={},c=Object.keys(a);let d;const h=c.length;let p;for(d=0;d<h;d++)p=c[d],o[p]=a[p];return o}function LQ(a){function o(c,d,h,p){let g=c[p++];if(g==="__proto__")return!0;const x=Number.isFinite(+g),v=p>=c.length;return g=!g&&bt.isArray(h)?h.length:g,v?(bt.hasOwnProp(h,g)?h[g]=[h[g],d]:h[g]=d,!x):((!h[g]||!bt.isObject(h[g]))&&(h[g]=[]),o(c,d,h[g],p)&&bt.isArray(h[g])&&(h[g]=nae(h[g])),!x)}if(bt.isFormData(a)&&bt.isFunction(a.entries)){const c={};return bt.forEachEntry(a,(d,h)=>{o(rae(d),h,c,0)}),c}return null}function iae(a,o,c){if(bt.isString(a))try{return(o||JSON.parse)(a),bt.trim(a)}catch(d){if(d.name!=="SyntaxError")throw d}return(c||JSON.stringify)(a)}const px={transitional:BQ,adapter:["xhr","http","fetch"],transformRequest:[function(o,c){const d=c.getContentType()||"",h=d.indexOf("application/json")>-1,p=bt.isObject(o);if(p&&bt.isHTMLForm(o)&&(o=new FormData(o)),bt.isFormData(o))return h?JSON.stringify(LQ(o)):o;if(bt.isArrayBuffer(o)||bt.isBuffer(o)||bt.isStream(o)||bt.isFile(o)||bt.isBlob(o)||bt.isReadableStream(o))return o;if(bt.isArrayBufferView(o))return o.buffer;if(bt.isURLSearchParams(o))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let x;if(p){if(d.indexOf("application/x-www-form-urlencoded")>-1)return sae(o,this.formSerializer).toString();if((x=bt.isFileList(o))||d.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return pE(x?{"files[]":o}:o,v&&new v,this.formSerializer)}}return p||h?(c.setContentType("application/json",!1),iae(o)):o}],transformResponse:[function(o){const c=this.transitional||px.transitional,d=c&&c.forcedJSONParsing,h=this.responseType==="json";if(bt.isResponse(o)||bt.isReadableStream(o))return o;if(o&&bt.isString(o)&&(d&&!this.responseType||h)){const g=!(c&&c.silentJSONParsing)&&h;try{return JSON.parse(o,this.parseReviver)}catch(x){if(g)throw x.name==="SyntaxError"?Cr.from(x,Cr.ERR_BAD_RESPONSE,this,null,this.response):x}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:co.classes.FormData,Blob:co.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};bt.forEach(["delete","get","head","post","put","patch"],a=>{px.headers[a]={}});const aae=bt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),oae=a=>{const o={};let c,d,h;return a&&a.split(`
`).forEach(function(g){h=g.indexOf(":"),c=g.substring(0,h).trim().toLowerCase(),d=g.substring(h+1).trim(),!(!c||o[c]&&aae[c])&&(c==="set-cookie"?o[c]?o[c].push(d):o[c]=[d]:o[c]=o[c]?o[c]+", "+d:d)}),o},$3=Symbol("internals");function Nb(a){return a&&String(a).trim().toLowerCase()}function xy(a){return a===!1||a==null?a:bt.isArray(a)?a.map(xy):String(a)}function cae(a){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=c.exec(a);)o[d[1]]=d[2];return o}const lae=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function H2(a,o,c,d,h){if(bt.isFunction(d))return d.call(this,o,c);if(h&&(o=c),!!bt.isString(o)){if(bt.isString(d))return o.indexOf(d)!==-1;if(bt.isRegExp(d))return d.test(o)}}function dae(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,c,d)=>c.toUpperCase()+d)}function Aae(a,o){const c=bt.toCamelCase(" "+o);["get","set","has"].forEach(d=>{Object.defineProperty(a,d+c,{value:function(h,p,g){return this[d].call(this,o,h,p,g)},configurable:!0})})}let tc=class{constructor(o){o&&this.set(o)}set(o,c,d){const h=this;function p(x,v,E){const C=Nb(v);if(!C)throw new Error("header name must be a non-empty string");const I=bt.findKey(h,C);(!I||h[I]===void 0||E===!0||E===void 0&&h[I]!==!1)&&(h[I||v]=xy(x))}const g=(x,v)=>bt.forEach(x,(E,C)=>p(E,C,v));if(bt.isPlainObject(o)||o instanceof this.constructor)g(o,c);else if(bt.isString(o)&&(o=o.trim())&&!lae(o))g(oae(o),c);else if(bt.isObject(o)&&bt.isIterable(o)){let x={},v,E;for(const C of o){if(!bt.isArray(C))throw TypeError("Object iterator must return a key-value pair");x[E=C[0]]=(v=x[E])?bt.isArray(v)?[...v,C[1]]:[v,C[1]]:C[1]}g(x,c)}else o!=null&&p(c,o,d);return this}get(o,c){if(o=Nb(o),o){const d=bt.findKey(this,o);if(d){const h=this[d];if(!c)return h;if(c===!0)return cae(h);if(bt.isFunction(c))return c.call(this,h,d);if(bt.isRegExp(c))return c.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,c){if(o=Nb(o),o){const d=bt.findKey(this,o);return!!(d&&this[d]!==void 0&&(!c||H2(this,this[d],d,c)))}return!1}delete(o,c){const d=this;let h=!1;function p(g){if(g=Nb(g),g){const x=bt.findKey(d,g);x&&(!c||H2(d,d[x],x,c))&&(delete d[x],h=!0)}}return bt.isArray(o)?o.forEach(p):p(o),h}clear(o){const c=Object.keys(this);let d=c.length,h=!1;for(;d--;){const p=c[d];(!o||H2(this,this[p],p,o,!0))&&(delete this[p],h=!0)}return h}normalize(o){const c=this,d={};return bt.forEach(this,(h,p)=>{const g=bt.findKey(d,p);if(g){c[g]=xy(h),delete c[p];return}const x=o?dae(p):String(p).trim();x!==p&&delete c[p],c[x]=xy(h),d[x]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const c=Object.create(null);return bt.forEach(this,(d,h)=>{d!=null&&d!==!1&&(c[h]=o&&bt.isArray(d)?d.join(", "):d)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,c])=>o+": "+c).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...c){const d=new this(o);return c.forEach(h=>d.set(h)),d}static accessor(o){const d=(this[$3]=this[$3]={accessors:{}}).accessors,h=this.prototype;function p(g){const x=Nb(g);d[x]||(Aae(h,g),d[x]=!0)}return bt.isArray(o)?o.forEach(p):p(o),this}};tc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);bt.reduceDescriptors(tc.prototype,({value:a},o)=>{let c=o[0].toUpperCase()+o.slice(1);return{get:()=>a,set(d){this[c]=d}}});bt.freezeMethods(tc);function G2(a,o){const c=this||px,d=o||c,h=tc.from(d.headers);let p=d.data;return bt.forEach(a,function(x){p=x.call(c,p,h.normalize(),o?o.status:void 0)}),h.normalize(),p}function jQ(a){return!!(a&&a.__CANCEL__)}function Bg(a,o,c){Cr.call(this,a??"canceled",Cr.ERR_CANCELED,o,c),this.name="CanceledError"}bt.inherits(Bg,Cr,{__CANCEL__:!0});function PQ(a,o,c){const d=c.config.validateStatus;!c.status||!d||d(c.status)?a(c):o(new Cr("Request failed with status code "+c.status,[Cr.ERR_BAD_REQUEST,Cr.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}function uae(a){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return o&&o[1]||""}function hae(a,o){a=a||10;const c=new Array(a),d=new Array(a);let h=0,p=0,g;return o=o!==void 0?o:1e3,function(v){const E=Date.now(),C=d[p];g||(g=E),c[h]=v,d[h]=E;let I=p,O=0;for(;I!==h;)O+=c[I++],I=I%a;if(h=(h+1)%a,h===p&&(p=(p+1)%a),E-g<o)return;const R=C&&E-C;return R?Math.round(O*1e3/R):void 0}}function pae(a,o){let c=0,d=1e3/o,h,p;const g=(E,C=Date.now())=>{c=C,h=null,p&&(clearTimeout(p),p=null),a(...E)};return[(...E)=>{const C=Date.now(),I=C-c;I>=d?g(E,C):(h=E,p||(p=setTimeout(()=>{p=null,g(h)},d-I)))},()=>h&&g(h)]}const Py=(a,o,c=3)=>{let d=0;const h=hae(50,250);return pae(p=>{const g=p.loaded,x=p.lengthComputable?p.total:void 0,v=g-d,E=h(v),C=g<=x;d=g;const I={loaded:g,total:x,progress:x?g/x:void 0,bytes:v,rate:E||void 0,estimated:E&&x&&C?(x-g)/E:void 0,event:p,lengthComputable:x!=null,[o?"download":"upload"]:!0};a(I)},c)},Z3=(a,o)=>{const c=a!=null;return[d=>o[0]({lengthComputable:c,total:a,loaded:d}),o[1]]},e6=a=>(...o)=>bt.asap(()=>a(...o)),mae=co.hasStandardBrowserEnv?((a,o)=>c=>(c=new URL(c,co.origin),a.protocol===c.protocol&&a.host===c.host&&(o||a.port===c.port)))(new URL(co.origin),co.navigator&&/(msie|trident)/i.test(co.navigator.userAgent)):()=>!0,fae=co.hasStandardBrowserEnv?{write(a,o,c,d,h,p,g){if(typeof document>"u")return;const x=[`${a}=${encodeURIComponent(o)}`];bt.isNumber(c)&&x.push(`expires=${new Date(c).toUTCString()}`),bt.isString(d)&&x.push(`path=${d}`),bt.isString(h)&&x.push(`domain=${h}`),p===!0&&x.push("secure"),bt.isString(g)&&x.push(`SameSite=${g}`),document.cookie=x.join("; ")},read(a){if(typeof document>"u")return null;const o=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return o?decodeURIComponent(o[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function gae(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function bae(a,o){return o?a.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):a}function UQ(a,o,c){let d=!gae(o);return a&&(d||c==!1)?bae(a,o):o}const t6=a=>a instanceof tc?{...a}:a;function em(a,o){o=o||{};const c={};function d(E,C,I,O){return bt.isPlainObject(E)&&bt.isPlainObject(C)?bt.merge.call({caseless:O},E,C):bt.isPlainObject(C)?bt.merge({},C):bt.isArray(C)?C.slice():C}function h(E,C,I,O){if(bt.isUndefined(C)){if(!bt.isUndefined(E))return d(void 0,E,I,O)}else return d(E,C,I,O)}function p(E,C){if(!bt.isUndefined(C))return d(void 0,C)}function g(E,C){if(bt.isUndefined(C)){if(!bt.isUndefined(E))return d(void 0,E)}else return d(void 0,C)}function x(E,C,I){if(I in o)return d(E,C);if(I in a)return d(void 0,E)}const v={url:p,method:p,data:p,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:x,headers:(E,C,I)=>h(t6(E),t6(C),I,!0)};return bt.forEach(Object.keys({...a,...o}),function(C){const I=v[C]||h,O=I(a[C],o[C],C);bt.isUndefined(O)&&I!==x||(c[C]=O)}),c}const FQ=a=>{const o=em({},a);let{data:c,withXSRFToken:d,xsrfHeaderName:h,xsrfCookieName:p,headers:g,auth:x}=o;if(o.headers=g=tc.from(g),o.url=DQ(UQ(o.baseURL,o.url,o.allowAbsoluteUrls),a.params,a.paramsSerializer),x&&g.set("Authorization","Basic "+btoa((x.username||"")+":"+(x.password?unescape(encodeURIComponent(x.password)):""))),bt.isFormData(c)){if(co.hasStandardBrowserEnv||co.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if(bt.isFunction(c.getHeaders)){const v=c.getHeaders(),E=["content-type","content-length"];Object.entries(v).forEach(([C,I])=>{E.includes(C.toLowerCase())&&g.set(C,I)})}}if(co.hasStandardBrowserEnv&&(d&&bt.isFunction(d)&&(d=d(o)),d||d!==!1&&mae(o.url))){const v=h&&p&&fae.read(p);v&&g.set(h,v)}return o},xae=typeof XMLHttpRequest<"u",vae=xae&&function(a){return new Promise(function(c,d){const h=FQ(a);let p=h.data;const g=tc.from(h.headers).normalize();let{responseType:x,onUploadProgress:v,onDownloadProgress:E}=h,C,I,O,R,k;function M(){R&&R(),k&&k(),h.cancelToken&&h.cancelToken.unsubscribe(C),h.signal&&h.signal.removeEventListener("abort",C)}let P=new XMLHttpRequest;P.open(h.method.toUpperCase(),h.url,!0),P.timeout=h.timeout;function H(){if(!P)return;const re=tc.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),ge={data:!x||x==="text"||x==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:re,config:a,request:P};PQ(function(we){c(we),M()},function(we){d(we),M()},ge),P=null}"onloadend"in P?P.onloadend=H:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(H)},P.onabort=function(){P&&(d(new Cr("Request aborted",Cr.ECONNABORTED,a,P)),P=null)},P.onerror=function(J){const ge=J&&J.message?J.message:"Network Error",ie=new Cr(ge,Cr.ERR_NETWORK,a,P);ie.event=J||null,d(ie),P=null},P.ontimeout=function(){let J=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded";const ge=h.transitional||BQ;h.timeoutErrorMessage&&(J=h.timeoutErrorMessage),d(new Cr(J,ge.clarifyTimeoutError?Cr.ETIMEDOUT:Cr.ECONNABORTED,a,P)),P=null},p===void 0&&g.setContentType(null),"setRequestHeader"in P&&bt.forEach(g.toJSON(),function(J,ge){P.setRequestHeader(ge,J)}),bt.isUndefined(h.withCredentials)||(P.withCredentials=!!h.withCredentials),x&&x!=="json"&&(P.responseType=h.responseType),E&&([O,k]=Py(E,!0),P.addEventListener("progress",O)),v&&P.upload&&([I,R]=Py(v),P.upload.addEventListener("progress",I),P.upload.addEventListener("loadend",R)),(h.cancelToken||h.signal)&&(C=re=>{P&&(d(!re||re.type?new Bg(null,a,P):re),P.abort(),P=null)},h.cancelToken&&h.cancelToken.subscribe(C),h.signal&&(h.signal.aborted?C():h.signal.addEventListener("abort",C)));const $=uae(h.url);if($&&co.protocols.indexOf($)===-1){d(new Cr("Unsupported protocol "+$+":",Cr.ERR_BAD_REQUEST,a));return}P.send(p||null)})},wae=(a,o)=>{const{length:c}=a=a?a.filter(Boolean):[];if(o||c){let d=new AbortController,h;const p=function(E){if(!h){h=!0,x();const C=E instanceof Error?E:this.reason;d.abort(C instanceof Cr?C:new Bg(C instanceof Error?C.message:C))}};let g=o&&setTimeout(()=>{g=null,p(new Cr(`timeout ${o} of ms exceeded`,Cr.ETIMEDOUT))},o);const x=()=>{a&&(g&&clearTimeout(g),g=null,a.forEach(E=>{E.unsubscribe?E.unsubscribe(p):E.removeEventListener("abort",p)}),a=null)};a.forEach(E=>E.addEventListener("abort",p));const{signal:v}=d;return v.unsubscribe=()=>bt.asap(x),v}},_ae=function*(a,o){let c=a.byteLength;if(c<o){yield a;return}let d=0,h;for(;d<c;)h=d+o,yield a.slice(d,h),d=h},yae=async function*(a,o){for await(const c of Eae(a))yield*_ae(c,o)},Eae=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const o=a.getReader();try{for(;;){const{done:c,value:d}=await o.read();if(c)break;yield d}}finally{await o.cancel()}},s6=(a,o,c,d)=>{const h=yae(a,o);let p=0,g,x=v=>{g||(g=!0,d&&d(v))};return new ReadableStream({async pull(v){try{const{done:E,value:C}=await h.next();if(E){x(),v.close();return}let I=C.byteLength;if(c){let O=p+=I;c(O)}v.enqueue(new Uint8Array(C))}catch(E){throw x(E),E}},cancel(v){return x(v),h.return()}},{highWaterMark:2})},r6=64*1024,{isFunction:L_}=bt,Cae=(({Request:a,Response:o})=>({Request:a,Response:o}))(bt.global),{ReadableStream:n6,TextEncoder:i6}=bt.global,a6=(a,...o)=>{try{return!!a(...o)}catch{return!1}},Sae=a=>{a=bt.merge.call({skipUndefined:!0},Cae,a);const{fetch:o,Request:c,Response:d}=a,h=o?L_(o):typeof fetch=="function",p=L_(c),g=L_(d);if(!h)return!1;const x=h&&L_(n6),v=h&&(typeof i6=="function"?(k=>M=>k.encode(M))(new i6):async k=>new Uint8Array(await new c(k).arrayBuffer())),E=p&&x&&a6(()=>{let k=!1;const M=new c(co.origin,{body:new n6,method:"POST",get duplex(){return k=!0,"half"}}).headers.has("Content-Type");return k&&!M}),C=g&&x&&a6(()=>bt.isReadableStream(new d("").body)),I={stream:C&&(k=>k.body)};h&&["text","arrayBuffer","blob","formData","stream"].forEach(k=>{!I[k]&&(I[k]=(M,P)=>{let H=M&&M[k];if(H)return H.call(M);throw new Cr(`Response type '${k}' is not supported`,Cr.ERR_NOT_SUPPORT,P)})});const O=async k=>{if(k==null)return 0;if(bt.isBlob(k))return k.size;if(bt.isSpecCompliantForm(k))return(await new c(co.origin,{method:"POST",body:k}).arrayBuffer()).byteLength;if(bt.isArrayBufferView(k)||bt.isArrayBuffer(k))return k.byteLength;if(bt.isURLSearchParams(k)&&(k=k+""),bt.isString(k))return(await v(k)).byteLength},R=async(k,M)=>{const P=bt.toFiniteNumber(k.getContentLength());return P??O(M)};return async k=>{let{url:M,method:P,data:H,signal:$,cancelToken:re,timeout:J,onDownloadProgress:ge,onUploadProgress:ie,responseType:we,headers:Ae,withCredentials:V="same-origin",fetchOptions:ce}=FQ(k),Y=o||fetch;we=we?(we+"").toLowerCase():"text";let z=wae([$,re&&re.toAbortSignal()],J),te=null;const se=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let Ce;try{if(ie&&E&&P!=="get"&&P!=="head"&&(Ce=await R(Ae,H))!==0){let Pe=new c(M,{method:"POST",body:H,duplex:"half"}),ne;if(bt.isFormData(H)&&(ne=Pe.headers.get("content-type"))&&Ae.setContentType(ne),Pe.body){const[ve,ue]=Z3(Ce,Py(e6(ie)));H=s6(Pe.body,r6,ve,ue)}}bt.isString(V)||(V=V?"include":"omit");const he=p&&"credentials"in c.prototype,Ne={...ce,signal:z,method:P.toUpperCase(),headers:Ae.normalize().toJSON(),body:H,duplex:"half",credentials:he?V:void 0};te=p&&new c(M,Ne);let Z=await(p?Y(te,ce):Y(M,Ne));const Ie=C&&(we==="stream"||we==="response");if(C&&(ge||Ie&&se)){const Pe={};["status","statusText","headers"].forEach(Te=>{Pe[Te]=Z[Te]});const ne=bt.toFiniteNumber(Z.headers.get("content-length")),[ve,ue]=ge&&Z3(ne,Py(e6(ge),!0))||[];Z=new d(s6(Z.body,r6,ve,()=>{ue&&ue(),se&&se()}),Pe)}we=we||"text";let Ve=await I[bt.findKey(I,we)||"text"](Z,k);return!Ie&&se&&se(),await new Promise((Pe,ne)=>{PQ(Pe,ne,{data:Ve,headers:tc.from(Z.headers),status:Z.status,statusText:Z.statusText,config:k,request:te})})}catch(he){throw se&&se(),he&&he.name==="TypeError"&&/Load failed|fetch/i.test(he.message)?Object.assign(new Cr("Network Error",Cr.ERR_NETWORK,k,te),{cause:he.cause||he}):Cr.from(he,he&&he.code,k,te)}}},Nae=new Map,MQ=a=>{let o=a&&a.env||{};const{fetch:c,Request:d,Response:h}=o,p=[d,h,c];let g=p.length,x=g,v,E,C=Nae;for(;x--;)v=p[x],E=C.get(v),E===void 0&&C.set(v,E=x?new Map:Sae(o)),C=E;return E};MQ();const nI={http:Gie,xhr:vae,fetch:{get:MQ}};bt.forEach(nI,(a,o)=>{if(a){try{Object.defineProperty(a,"name",{value:o})}catch{}Object.defineProperty(a,"adapterName",{value:o})}});const o6=a=>`- ${a}`,Tae=a=>bt.isFunction(a)||a===null||a===!1;function Rae(a,o){a=bt.isArray(a)?a:[a];const{length:c}=a;let d,h;const p={};for(let g=0;g<c;g++){d=a[g];let x;if(h=d,!Tae(d)&&(h=nI[(x=String(d)).toLowerCase()],h===void 0))throw new Cr(`Unknown adapter '${x}'`);if(h&&(bt.isFunction(h)||(h=h.get(o))))break;p[x||"#"+g]=h}if(!h){const g=Object.entries(p).map(([v,E])=>`adapter ${v} `+(E===!1?"is not supported by the environment":"is not available in the build"));let x=c?g.length>1?`since :
`+g.map(o6).join(`
`):" "+o6(g[0]):"as no adapter specified";throw new Cr("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return h}const VQ={getAdapter:Rae,adapters:nI};function K2(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Bg(null,a)}function c6(a){return K2(a),a.headers=tc.from(a.headers),a.data=G2.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),VQ.getAdapter(a.adapter||px.adapter,a)(a).then(function(d){return K2(a),d.data=G2.call(a,a.transformResponse,d),d.headers=tc.from(d.headers),d},function(d){return jQ(d)||(K2(a),d&&d.response&&(d.response.data=G2.call(a,a.transformResponse,d.response),d.response.headers=tc.from(d.response.headers))),Promise.reject(d)})}const QQ="1.13.2",mE={};["object","boolean","number","function","string","symbol"].forEach((a,o)=>{mE[a]=function(d){return typeof d===a||"a"+(o<1?"n ":" ")+a}});const l6={};mE.transitional=function(o,c,d){function h(p,g){return"[Axios v"+QQ+"] Transitional option '"+p+"'"+g+(d?". "+d:"")}return(p,g,x)=>{if(o===!1)throw new Cr(h(g," has been removed"+(c?" in "+c:"")),Cr.ERR_DEPRECATED);return c&&!l6[g]&&(l6[g]=!0,console.warn(h(g," has been deprecated since v"+c+" and will be removed in the near future"))),o?o(p,g,x):!0}};mE.spelling=function(o){return(c,d)=>(console.warn(`${d} is likely a misspelling of ${o}`),!0)};function Iae(a,o,c){if(typeof a!="object")throw new Cr("options must be an object",Cr.ERR_BAD_OPTION_VALUE);const d=Object.keys(a);let h=d.length;for(;h-- >0;){const p=d[h],g=o[p];if(g){const x=a[p],v=x===void 0||g(x,p,a);if(v!==!0)throw new Cr("option "+p+" must be "+v,Cr.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new Cr("Unknown option "+p,Cr.ERR_BAD_OPTION)}}const vy={assertOptions:Iae,validators:mE},Hd=vy.validators;let Xp=class{constructor(o){this.defaults=o||{},this.interceptors={request:new J3,response:new J3}}async request(o,c){try{return await this._request(o,c)}catch(d){if(d instanceof Error){let h={};Error.captureStackTrace?Error.captureStackTrace(h):h=new Error;const p=h.stack?h.stack.replace(/^.+\n/,""):"";try{d.stack?p&&!String(d.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+p):d.stack=p}catch{}}throw d}}_request(o,c){typeof o=="string"?(c=c||{},c.url=o):c=o||{},c=em(this.defaults,c);const{transitional:d,paramsSerializer:h,headers:p}=c;d!==void 0&&vy.assertOptions(d,{silentJSONParsing:Hd.transitional(Hd.boolean),forcedJSONParsing:Hd.transitional(Hd.boolean),clarifyTimeoutError:Hd.transitional(Hd.boolean)},!1),h!=null&&(bt.isFunction(h)?c.paramsSerializer={serialize:h}:vy.assertOptions(h,{encode:Hd.function,serialize:Hd.function},!0)),c.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?c.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:c.allowAbsoluteUrls=!0),vy.assertOptions(c,{baseUrl:Hd.spelling("baseURL"),withXsrfToken:Hd.spelling("withXSRFToken")},!0),c.method=(c.method||this.defaults.method||"get").toLowerCase();let g=p&&bt.merge(p.common,p[c.method]);p&&bt.forEach(["delete","get","head","post","put","patch","common"],k=>{delete p[k]}),c.headers=tc.concat(g,p);const x=[];let v=!0;this.interceptors.request.forEach(function(M){typeof M.runWhen=="function"&&M.runWhen(c)===!1||(v=v&&M.synchronous,x.unshift(M.fulfilled,M.rejected))});const E=[];this.interceptors.response.forEach(function(M){E.push(M.fulfilled,M.rejected)});let C,I=0,O;if(!v){const k=[c6.bind(this),void 0];for(k.unshift(...x),k.push(...E),O=k.length,C=Promise.resolve(c);I<O;)C=C.then(k[I++],k[I++]);return C}O=x.length;let R=c;for(;I<O;){const k=x[I++],M=x[I++];try{R=k(R)}catch(P){M.call(this,P);break}}try{C=c6.call(this,R)}catch(k){return Promise.reject(k)}for(I=0,O=E.length;I<O;)C=C.then(E[I++],E[I++]);return C}getUri(o){o=em(this.defaults,o);const c=UQ(o.baseURL,o.url,o.allowAbsoluteUrls);return DQ(c,o.params,o.paramsSerializer)}};bt.forEach(["delete","get","head","options"],function(o){Xp.prototype[o]=function(c,d){return this.request(em(d||{},{method:o,url:c,data:(d||{}).data}))}});bt.forEach(["post","put","patch"],function(o){function c(d){return function(p,g,x){return this.request(em(x||{},{method:o,headers:d?{"Content-Type":"multipart/form-data"}:{},url:p,data:g}))}}Xp.prototype[o]=c(),Xp.prototype[o+"Form"]=c(!0)});let Oae=class HQ{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(p){c=p});const d=this;this.promise.then(h=>{if(!d._listeners)return;let p=d._listeners.length;for(;p-- >0;)d._listeners[p](h);d._listeners=null}),this.promise.then=h=>{let p;const g=new Promise(x=>{d.subscribe(x),p=x}).then(h);return g.cancel=function(){d.unsubscribe(p)},g},o(function(p,g,x){d.reason||(d.reason=new Bg(p,g,x),c(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const c=this._listeners.indexOf(o);c!==-1&&this._listeners.splice(c,1)}toAbortSignal(){const o=new AbortController,c=d=>{o.abort(d)};return this.subscribe(c),o.signal.unsubscribe=()=>this.unsubscribe(c),o.signal}static source(){let o;return{token:new HQ(function(h){o=h}),cancel:o}}};function kae(a){return function(c){return a.apply(null,c)}}function Dae(a){return bt.isObject(a)&&a.isAxiosError===!0}const eR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(eR).forEach(([a,o])=>{eR[o]=a});function GQ(a){const o=new Xp(a),c=wQ(Xp.prototype.request,o);return bt.extend(c,Xp.prototype,o,{allOwnKeys:!0}),bt.extend(c,o,null,{allOwnKeys:!0}),c.create=function(h){return GQ(em(a,h))},c}const zr=GQ(px);zr.Axios=Xp;zr.CanceledError=Bg;zr.CancelToken=Oae;zr.isCancel=jQ;zr.VERSION=QQ;zr.toFormData=pE;zr.AxiosError=Cr;zr.Cancel=zr.CanceledError;zr.all=function(o){return Promise.all(o)};zr.spread=kae;zr.isAxiosError=Dae;zr.mergeConfig=em;zr.AxiosHeaders=tc;zr.formToJSON=a=>LQ(bt.isHTMLForm(a)?new FormData(a):a);zr.getAdapter=VQ.getAdapter;zr.HttpStatusCode=eR;zr.default=zr;const{Axios:C0e,AxiosError:S0e,CanceledError:N0e,isCancel:T0e,CancelToken:R0e,VERSION:I0e,all:O0e,Cancel:k0e,isAxiosError:D0e,spread:B0e,toFormData:L0e,AxiosHeaders:j0e,HttpStatusCode:P0e,formToJSON:U0e,getAdapter:F0e,mergeConfig:M0e}=zr,Tb="healthai_cache_",Bae=5*60*1e3,cl={set(a,o,c=Bae){try{const d={value:o,expiry:Date.now()+c};localStorage.setItem(Tb+a,JSON.stringify(d))}catch(d){console.error("Cache set error:",d)}},get(a){try{const o=localStorage.getItem(Tb+a);if(!o)return null;const c=JSON.parse(o);return Date.now()>c.expiry?(this.delete(a),null):c.value}catch(o){return console.error("Cache get error:",o),null}},delete(a){try{localStorage.removeItem(Tb+a)}catch(o){console.error("Cache delete error:",o)}},clear(){try{Object.keys(localStorage).forEach(o=>{o.startsWith(Tb)&&localStorage.removeItem(o)})}catch(a){console.error("Cache clear error:",a)}},cleanup(){try{Object.keys(localStorage).forEach(o=>{if(o.startsWith(Tb)){const c=localStorage.getItem(o);if(c){const d=JSON.parse(c);Date.now()>d.expiry&&localStorage.removeItem(o)}}})}catch(a){console.error("Cache cleanup error:",a)}}};cl.cleanup();setInterval(()=>cl.cleanup(),5*60*1e3);const Lae=()=>"/api",Ft=zr.create({baseURL:Lae(),headers:{"Content-Type":"application/json"}});console.log(" API Configuration:",{baseURL:Ft.defaults.baseURL,hostname:window.location.hostname,isProd:!0,isDev:!1,mode:"production"});Ft.interceptors.request.use(a=>{const o=localStorage.getItem("token");return o&&(a.headers.Authorization=`Bearer ${o}`),a});Ft.interceptors.response.use(a=>a,a=>{var c,d,h;const o=(c=a.config)==null?void 0:c.skipAutoLogout;return((d=a.response)==null?void 0:d.status)===401?(console.warn(" 401 Unauthorized detected for URL:",(h=a.config)==null?void 0:h.url),console.log(" skipAutoLogout flag status:",!!o),o?console.log(" skipAutoLogout is TRUE  keeping user on current page"):(console.log(" Triggering auto-logout and redirecting to /login"),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login")):a.response||console.error("Network Error:",{message:a.message,apiUrl:Ft.defaults.baseURL,currentHost:window.location.hostname,currentPort:window.location.port}),Promise.reject(a)});const sd={uploadReport:a=>Ft.post("/health/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>Ft.get("/health/reports"),getReport:a=>Ft.get(`/health/reports/${a}`),deleteReport:a=>Ft.delete(`/health/reports/${a}`),getDashboard:()=>Ft.get("/health/dashboard"),getHistory:a=>Ft.get("/health/history",{params:{reportType:a}}),compareReport:a=>Ft.get(`/health/reports/${a}/compare`),chatAboutReport:(a,o,c)=>Ft.post(`/health/reports/${a}/chat`,{message:o,chatHistory:c}),askAI:a=>Ft.post("/health/ai-chat",a),getMetricInfo:a=>Ft.post("/health/metric-info",a),getReportComparison:()=>Ft.get("/health/report-comparison")},Fp={getAll:()=>Ft.get("/notifications"),getUnreadCount:()=>Ft.get("/notifications/unread-count"),markAsRead:a=>Ft.put(`/notifications/${a}/read`),markAllAsRead:()=>Ft.put("/notifications/mark-all-read"),deleteOne:a=>Ft.delete(`/notifications/${a}`),clearAll:()=>Ft.delete("/notifications")},$o={getAll:a=>Ft.get("/doctors",{params:a}),getById:a=>Ft.get(`/doctors/${a}`),getRecommended:a=>Ft.get("/doctors/recommended",{params:{specializations:a}}),bookAppointment:a=>Ft.post("/doctors/book",a),getAppointments:()=>Ft.get("/doctors/appointments"),getAppointment:a=>Ft.get(`/doctors/appointments/${a}`),startConsultation:a=>Ft.post(`/doctors/appointments/${a}/start`),endConsultation:a=>Ft.post(`/doctors/appointments/${a}/end`),getConsultationSummary:a=>Ft.get(`/doctors/appointments/${a}/summary`),submitReview:(a,o)=>Ft.post(`/doctors/appointments/${a}/review`,o),downloadPrescription:a=>Ft.get(`/doctors/appointments/${a}/prescription`,{responseType:"blob"}),getDashboard:()=>Ft.get("/doctors/me/dashboard"),getMyProfile:()=>Ft.get("/doctors/me/profile"),updateMyProfile:a=>Ft.put("/doctors/me/profile",a),getMyAppointments:a=>Ft.get("/doctors/me/appointments",{params:a}),updateAppointmentStatus:(a,o)=>Ft.patch(`/doctors/me/appointments/${a}`,o),getPatientProfile:(a,o)=>Ft.get(`/doctors/patient/${a}`,{params:{appointmentId:o}}),getDoctorAppointments:(a,o)=>Ft.get(`/doctors/${a}/appointments`,{params:{status:o}}),getMyAvailability:()=>Ft.get("/doctors/me/availability"),updateMyAvailability:a=>Ft.put("/doctors/me/availability",a),generateTimeSlots:()=>Ft.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(a,o)=>Ft.get(`/doctors/${a}/available-slots`,{params:{date:o}}),checkSlotAvailability:(a,o,c)=>Ft.get(`/doctors/${a}/check-slot`,{params:{date:o,timeSlot:c}})},cg={connectDevice:(a,o)=>Ft.post("/wearables/connect",{deviceType:a,deviceName:o}),disconnectDevice:a=>Ft.post(`/wearables/disconnect/${a}`),getDevices:()=>Ft.get("/wearables/devices"),syncMetrics:(a,o)=>Ft.post("/wearables/sync",{deviceType:a,metrics:o}),addHeartRate:(a,o,c)=>Ft.post("/wearables/heart-rate",{deviceType:a,bpm:o,type:c}),addSleepData:(a,o)=>Ft.post("/wearables/sleep",{deviceType:a,sleepData:o}),getDashboard:()=>Ft.get("/wearables/dashboard"),generateDemoData:a=>Ft.post("/wearables/demo-data",{deviceType:a})},wy={getStats:()=>Ft.get("/admin/stats"),getUsers:a=>Ft.get("/admin/users",{params:a}),getUserDetails:a=>Ft.get(`/admin/users/${a}`),updateUserStatus:(a,o)=>Ft.patch(`/admin/users/${a}/status`,{isActive:o}),getReports:a=>Ft.get("/admin/reports",{params:a}),getDeficiencyRules:()=>Ft.get("/admin/deficiency-rules"),createDeficiencyRule:a=>Ft.post("/admin/deficiency-rules",a),updateDeficiencyRule:(a,o)=>Ft.put(`/admin/deficiency-rules/${a}`,o),deleteDeficiencyRule:a=>Ft.delete(`/admin/deficiency-rules/${a}`),getSupplements:()=>Ft.get("/admin/supplements"),createSupplement:a=>Ft.post("/admin/supplements",a),updateSupplement:(a,o)=>Ft.put(`/admin/supplements/${a}`,o),deleteSupplement:a=>Ft.delete(`/admin/supplements/${a}`),getDietPlans:a=>Ft.get("/admin/diet-plans",{params:a}),createDietPlan:a=>Ft.post("/admin/diet-plans",a),updateDietPlan:(a,o)=>Ft.put(`/admin/diet-plans/${a}`,o),approveDietPlan:(a,o)=>Ft.patch(`/admin/diet-plans/${a}/approve`,{status:o}),deleteDietPlan:a=>Ft.delete(`/admin/diet-plans/${a}`),getDoctors:a=>Ft.get("/admin/doctors",{params:a}),createDoctor:a=>Ft.post("/admin/doctors",a),updateDoctor:(a,o)=>Ft.put(`/admin/doctors/${a}`,o),approveDoctor:a=>Ft.patch(`/admin/doctors/${a}/approve`),rejectDoctor:(a,o)=>Ft.patch(`/admin/doctors/${a}/reject`,{reason:o}),deleteDoctor:a=>Ft.delete(`/admin/doctors/${a}`),toggleDoctorVisibility:a=>Ft.patch(`/admin/doctors/${a}/visibility`),getDoctorScheduleOverview:a=>Ft.get(`/admin/doctors/${a}/schedule-overview`)},jae={getSubscription:()=>Ft.get("/auth/subscription")},KQ={analyzeFood:a=>Ft.post("/nutrition/analyze-food",{foodDescription:a}),logMeal:a=>Ft.post("/nutrition/log-meal",a),getTodayLogs:()=>Ft.get("/nutrition/logs/today"),getDailySummary:a=>Ft.get("/nutrition/summary/daily",{params:{date:a}}),getGoals:()=>Ft.get("/nutrition/goals"),updateGoals:a=>Ft.put("/nutrition/goals",a)},WQ=ee.createContext(),da=()=>ee.useContext(WQ),Pae=({children:a})=>{const[o,c]=ee.useState(null),[d,h]=ee.useState(!0);ee.useEffect(()=>{const M=localStorage.getItem("token"),P=localStorage.getItem("user");M&&P&&(c(JSON.parse(P)),Ft.defaults.headers.common.Authorization=`Bearer ${M}`),h(!1)},[]);const p=async(M,P)=>{const $=M.includes("@")?{email:M,password:P}:{phone:M,password:P},{data:re}=await Ft.post("/auth/login",$);return localStorage.setItem("token",re.token),localStorage.setItem("user",JSON.stringify(re)),Ft.defaults.headers.common.Authorization=`Bearer ${re.token}`,c(re),re},g=async(M,P,H,$={},re=null)=>{const{data:J}=await Ft.post("/auth/register",{name:M,email:P,password:H,profile:$,nutritionGoal:re});return localStorage.setItem("token",J.token),localStorage.setItem("user",JSON.stringify(J)),Ft.defaults.headers.common.Authorization=`Bearer ${J.token}`,c(J),J},x=async M=>{const{data:P}=await Ft.post("/auth/register/doctor",M);return localStorage.setItem("token",P.token),localStorage.setItem("user",JSON.stringify(P)),Ft.defaults.headers.common.Authorization=`Bearer ${P.token}`,c(P),P},v=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete Ft.defaults.headers.common.Authorization,c(null)},E=M=>{c(M),localStorage.setItem("user",JSON.stringify(M))},C=()=>(o==null?void 0:o.role)==="admin",I=()=>(o==null?void 0:o.role)==="doctor",O=()=>(o==null?void 0:o.role)==="patient"||(o==null?void 0:o.role)==="client",R=()=>{var M;return((M=o==null?void 0:o.doctorProfile)==null?void 0:M.approvalStatus)==="approved"},k=()=>{var M;return((M=o==null?void 0:o.subscription)==null?void 0:M.status)==="active"};return n.jsx(WQ.Provider,{value:{user:o,login:p,register:g,registerDoctor:x,logout:v,updateUser:E,loading:d,isAdmin:C,isDoctor:I,isPatient:O,isDoctorApproved:R,isSubscribed:k},children:a})};function Uae(){const[a,o]=ee.useState(""),[c,d]=ee.useState({x:0,y:0}),[h,p]=ee.useState(!1),g=Ha();ee.useEffect(()=>{const v=()=>{const E=window.getSelection(),C=E.toString().trim();if(C.length>0){const O=E.getRangeAt(0).getBoundingClientRect();o(C),d({x:O.left+O.width/2,y:O.top-10}),p(!0)}else p(!1)};return document.addEventListener("mouseup",v),document.addEventListener("touchend",v),()=>{document.removeEventListener("mouseup",v),document.removeEventListener("touchend",v)}},[]);const x=()=>{g("/ai-chat",{state:{selectedText:a}}),p(!1)};return h?n.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${c.x}px`,top:`${c.y}px`,transform:"translate(-50%, -100%)"},children:n.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[n.jsx(cx,{className:"w-4 h-4"}),"Ask AI"]})}):null}function Fae(){var O,R;const a=rE(),o=Ha(),{user:c,logout:d}=da(),[h,p]=ee.useState(!1),[g,x]=ee.useState(!1);ee.useEffect(()=>{const k=()=>{const H=document.querySelectorAll(".fixed");let $=!1;H.forEach(re=>{const J=re.className,ge=J.includes("bg-black")||J.includes("inset-0"),ie=J.includes("z-50")||J.includes("z-40");ge&&ie&&re.offsetHeight>0&&($=!0)}),a.pathname==="/ai-chat"&&($=!0),x($||h)};k();const M=setTimeout(k,100),P=new MutationObserver(k);return P.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(M),P.disconnect()}},[a.pathname,h]);const v=[{path:"/dashboard",icon:nE,label:"Home"},{path:"/nutrition",icon:br,label:"Nutrition"},{path:"/quick-food-scan",icon:XV,label:"Scan Food",isCenter:!0},{path:"/upload",icon:Hn,label:"Reports"}],E=[{path:"/profile",icon:Ig,label:"Profile"},{path:"/diet-plan",icon:Ca,label:"Diet Plan"},{path:"/wearables",icon:HA,label:"Wearables",comingSoon:!0},{path:"#appointment",icon:yi,label:"Appointment",comingSoon:!0}],C=k=>a.pathname===k,I=()=>{d(),St.success("Logged out successfully"),o("/login"),p(!1)};return n.jsxs(n.Fragment,{children:[h&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>p(!1)}),h&&n.jsxs("div",{className:"fixed bottom-24 right-4 left-4 sm:left-auto sm:w-72 bg-white rounded-[2.5rem] shadow-[0_20px_60px_-15px_rgba(0,0,0,0.3)] z-50 overflow-hidden animate-fade-in border border-slate-100 p-2",children:[n.jsx("div",{className:"p-6 bg-black rounded-[2rem] mb-2",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-black text-white text-lg tracking-tighter uppercase leading-none",children:"FitCure"}),n.jsx("p",{className:"text-[10px] text-[#2FC8B9] font-black uppercase tracking-widest mt-1",children:"Elite Menu"})]}),n.jsx("button",{onClick:()=>p(!1),className:"text-white hover:bg-white/20 rounded-xl p-2 transition-colors",children:n.jsx(Gn,{className:"w-6 h-6"})})]})}),n.jsxs("div",{className:"space-y-1 p-3",children:[E.map(k=>{const M=k.icon,P=C(k.path);return k.comingSoon?n.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-3.5 text-slate-500 bg-slate-50 rounded-xl opacity-60 cursor-not-allowed text-sm",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-200 flex items-center justify-center",children:n.jsx(M,{className:"w-5 h-5"})}),n.jsx("span",{className:"font-medium",children:k.label})]}),n.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full font-semibold",children:"Soon"})]},k.label):k.path==="#appointment"?n.jsxs("button",{onClick:()=>{St.info("Appointment coming soon"),p(!1)},className:"w-full flex items-center gap-3 px-4 py-3.5 text-slate-700 hover:bg-[#2FC8B9]/5 rounded-xl transition-all text-sm group",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-[#2FC8B9]/10 flex items-center justify-center group-hover:bg-[#2FC8B9]/20 transition-colors",children:n.jsx(M,{className:"w-5 h-5 text-[#2FC8B9]"})}),n.jsx("span",{className:"font-medium",children:k.label})]},k.label):n.jsxs(Hs,{to:k.path,onClick:()=>p(!1),className:`flex items-center gap-4 px-5 py-4 rounded-2xl transition-all group ${P?"bg-black text-white shadow-xl":"text-slate-600 hover:bg-slate-50"}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${P?"bg-white/20":"bg-[#2FC8B9]/10 group-hover:bg-[#2FC8B9]/20"}`,children:n.jsx(M,{className:`w-5 h-5 ${P?"text-white":"text-[#2FC8B9]"}`})}),n.jsx("span",{className:"font-medium",children:k.label})]},k.path)}),n.jsx("div",{className:"border-t border-slate-100 my-3"}),n.jsxs("div",{className:"px-5 py-4 flex items-center gap-4",children:[n.jsx("div",{className:"w-11 h-11 rounded-xl bg-black flex items-center justify-center text-[#2FC8B9] font-black shadow-lg",children:(R=(O=c==null?void 0:c.name)==null?void 0:O[0])==null?void 0:R.toUpperCase()}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-xs font-black text-black uppercase tracking-wider truncate",children:c==null?void 0:c.name}),n.jsx("p",{className:"text-[10px] text-slate-400 font-bold lowercase truncate",children:c==null?void 0:c.email})]})]}),n.jsxs("button",{onClick:I,className:"w-full flex items-center gap-3 px-4 py-3.5 text-red-600 hover:bg-red-50 rounded-xl transition-all text-sm font-medium group",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center group-hover:bg-red-200 transition-colors",children:n.jsx(zR,{className:"w-5 h-5"})}),n.jsx("span",{children:"Logout"})]})]})]}),n.jsx("nav",{className:`mobile-bottom-nav-container ${g?"hidden":""}`,children:n.jsxs("div",{className:"mobile-bottom-nav",children:[v.map(k=>{const M=k.icon,P=C(k.path);return k.isCenter?n.jsx(Hs,{to:k.path,className:"nav-center-fab flex flex-col items-center justify-center","aria-label":k.label,title:k.label,children:n.jsx(M,{className:"w-7 h-7"})},k.path):n.jsxs(Hs,{to:k.path,className:`nav-item-modern flex flex-col items-center justify-center gap-0.5 ${P?"active":""}`,"aria-label":k.label,title:k.label,children:[n.jsx(M,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[9px] font-medium",children:k.label})]},k.path)}),n.jsxs("button",{onClick:()=>p(!h),className:`nav-item-modern flex flex-col items-center justify-center gap-0.5 ${h?"active":""}`,"aria-label":"More",title:"More",children:[n.jsx(Bre,{className:"w-5 h-5"}),n.jsx("span",{className:"text-[11px] font-medium",children:"More"})]})]})})]})}function zQ(){const[a,o]=ee.useState(null),[c,d]=ee.useState(!1),[h,p]=ee.useState(!1);ee.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone){p(!0);return}const v=localStorage.getItem("pwa-install-dismissed");if(v){const I=Date.now()-parseInt(v),O=2*60*1e3;if(I<O){const R=O-I;setTimeout(()=>{d(!0)},R);return}}d(!0);const E=I=>{I.preventDefault(),o(I),d(!0)};window.addEventListener("beforeinstallprompt",E);const C=()=>{p(!0),d(!1),o(null)};return window.addEventListener("appinstalled",C),()=>{window.removeEventListener("beforeinstallprompt",E),window.removeEventListener("appinstalled",C)}},[]);const g=async()=>{if(!a){alert(`To install this app:

1. Tap the Share button
2. Select "Add to Home Screen"`);return}a.prompt();const{outcome:v}=await a.userChoice;v==="accepted"?(console.log("User accepted the install prompt"),p(!0)):console.log("User dismissed the install prompt"),o(null),d(!1)},x=()=>{d(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString()),setTimeout(()=>{d(!0)},2*60*1e3)};return h||!c?null:n.jsx("div",{className:"fixed bottom-24 right-4 z-40 md:hidden animate-slide-up",children:n.jsxs("div",{className:"relative",children:[n.jsx("button",{onClick:x,className:"absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center transition-all shadow-lg z-10","aria-label":"Close",children:n.jsx(Gn,{className:"w-3 h-3 text-white"})}),n.jsx("button",{onClick:g,className:"w-16 h-16 rounded-full bg-gradient-to-br from-[#2FC8B9] to-[#1db7a6] shadow-2xl flex items-center justify-center border-2 border-white hover:scale-110 transition-transform active:scale-95","aria-label":"Install App",children:n.jsx(iE,{className:"w-7 h-7 text-white"})})]})})}const Mae=[{path:"/dashboard",icon:nE,label:"Dashboard"},{path:"/ai-chat",icon:cx,label:"AI Assistant"},{path:"/upload",icon:Hn,label:"My Reports"},{path:"/nutrition",icon:lx,label:"Nutrition"},{path:"/diet-plan",icon:lh,label:"Diet Plan"},{path:"/profile",icon:Ig,label:"Profile"},{path:"/doctors",icon:yi,label:"Appointments",comingSoon:!0},{path:"/wearables",icon:HA,label:"Devices",comingSoon:!0}],Vae=[{path:"/doctor/dashboard",icon:nE,label:"Dashboard"},{path:"/doctor/availability",icon:Oc,label:"Manage Slots"},{path:"/profile",icon:Ig,label:"Profile"}],Qae=[{path:"/admin",icon:nE,label:"Dashboard"},{path:"/profile",icon:Ig,label:"Settings"}];function wi({children:a,isAdmin:o,isDoctor:c}){var re,J,ge,ie,we,Ae,V;const{user:d,logout:h,isAdmin:p,isDoctor:g}=da(),x=rE(),v=Ha(),[E,C]=ee.useState(!1),[I,O]=ee.useState({healthScore:0,caloriesConsumed:0,calorieTarget:2e3});ee.useEffect(()=>{const ce=async()=>{var z,te,se;if(x.pathname==="/dashboard"&&!p()&&!g())try{const he={Authorization:`Bearer ${localStorage.getItem("token")}`},Z=(z=(await zr.get("/api/health/reports",{headers:he})).data.reports)==null?void 0:z[0],Ie=(Z==null?void 0:Z.healthScore)||0,Ve=new Date().toISOString().split("T")[0],ne=((te=(await zr.get(`/api/nutrition/summary/daily?date=${Ve}`,{headers:he})).data.summary)==null?void 0:te.totalCalories)||0,ue=((se=(await zr.get("/api/nutrition/goals",{headers:he}).catch(()=>({data:{healthGoal:null}}))).data.healthGoal)==null?void 0:se.dailyCalorieTarget)||2e3;O({healthScore:Ie,caloriesConsumed:ne,calorieTarget:ue})}catch(Ce){console.error("Failed to fetch health data:",Ce)}};ce();const Y=setInterval(ce,3e4);return()=>clearInterval(Y)},[x.pathname,p,g]);const R=()=>{h(),v("/")};let k=Mae,M="/dashboard",P="Patient Portal";p()||o?(k=Qae,M="/admin",P="Admin Panel"):(g()||c)&&(k=Vae,M="/doctor/dashboard",P=((re=d==null?void 0:d.doctorProfile)==null?void 0:re.specialization)||"Doctor Portal");const H="bg-white",$=x.pathname==="/dashboard"||x.pathname==="/doctor/dashboard"||x.pathname==="/admin";return n.jsxs("div",{className:`min-h-screen flex ${H}`,children:[n.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 shadow-2xl lg:shadow-none transform transition-transform duration-300 hidden lg:flex lg:flex-col bg-white border-r border-slate-100 ${E?"translate-x-0":"translate-x-full lg:translate-x-0"}`,children:n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsx("div",{className:"p-8 shrink-0 border-b border-slate-50",children:n.jsxs(Hs,{to:M,className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center bg-[#2FC8B9]/10 border border-[#2FC8B9]/20 shadow-[0_0_15px_rgba(47,200,185,0.2)]",children:n.jsx(br,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-black text-black text-lg tracking-tighter uppercase leading-none",children:"FitCure"}),n.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1 truncate",children:P})]})]})}),n.jsx("nav",{className:"flex-1 p-6 space-y-2 overflow-y-auto",children:k.map(({path:ce,icon:Y,label:z,comingSoon:te})=>{if(te)return n.jsxs("div",{className:"flex items-center gap-4 px-4 py-4 rounded-2xl font-bold transition-all cursor-not-allowed opacity-30 text-slate-300",children:[n.jsx(Y,{className:"w-5 h-5"}),n.jsx("span",{className:"text-sm uppercase tracking-widest",children:z})]},ce);const se=x.pathname===ce;return n.jsxs(Hs,{to:ce,onClick:()=>C(!1),className:`flex items-center gap-4 px-5 py-4 rounded-2xl font-black transition-all group ${se?"bg-[#2FC8B9] text-white shadow-[0_10px_20px_-10px_rgba(47,200,185,0.5)]":"text-slate-500 hover:text-black hover:bg-slate-50"}`,children:[n.jsx(Y,{className:`w-5 h-5 transition-colors ${se?"text-white":"text-slate-400 group-hover:text-[#2FC8B9]"}`}),n.jsx("span",{className:"text-xs uppercase tracking-[0.2em]",children:z})]},ce)})}),n.jsx("div",{className:"p-6 shrink-0 border-t border-slate-50",children:n.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-[1.25rem] bg-slate-50 hover:bg-slate-100 transition-all border border-slate-100",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0 bg-[#2FC8B9] shadow-lg",children:n.jsx("span",{className:"font-black text-white",children:(ge=(J=d==null?void 0:d.name)==null?void 0:J[0])==null?void 0:ge.toUpperCase()})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-xs font-black truncate text-black uppercase tracking-wider",children:g()?`DR. ${d==null?void 0:d.name}`:d==null?void 0:d.name}),n.jsx("p",{className:"text-[10px] truncate text-slate-500 font-bold lowercase",children:d==null?void 0:d.email})]}),n.jsx("button",{onClick:R,className:"p-2 rounded-xl transition-all shrink-0 text-slate-400 hover:text-rose-500 hover:bg-rose-500/10",title:"Logout",children:n.jsx(zR,{className:"w-5 h-5"})})]})})]})}),E&&n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden",onClick:()=>C(!1)}),n.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[n.jsx("header",{className:"sticky top-0 z-30 backdrop-blur-xl bg-white/80 border-b border-slate-100 hidden md:block",children:n.jsxs("div",{className:"flex items-center justify-between px-8 py-5",children:[n.jsx("div",{className:"flex items-center gap-6",children:n.jsx("h1",{className:"text-xl font-black text-black uppercase tracking-tight",children:((ie=k.find(ce=>ce.path===x.pathname))==null?void 0:ie.label)||"Dashboard"})}),n.jsxs("div",{className:"flex items-center gap-6 overflow-hidden",children:[n.jsx("div",{className:"hidden lg:flex items-center",children:n.jsxs("div",{className:"relative group",children:[n.jsx(Dy,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-[#2FC8B9] transition-colors"}),n.jsx("input",{type:"text",placeholder:"Search metrics...",className:"w-64 pl-12 pr-6 py-3 rounded-2xl text-xs font-bold focus:outline-none bg-slate-50 border border-slate-100 focus:border-[#2FC8B9]/30 transition-all placeholder-slate-400"})]})}),n.jsxs("button",{className:"relative p-3 rounded-2xl transition-all flex-shrink-0 bg-slate-50 border border-slate-100 text-slate-400 hover:text-[#2FC8B9] hover:bg-white hover:shadow-sm",children:[n.jsx(dh,{className:"w-5 h-5"}),n.jsx("span",{className:"absolute top-3 right-3 w-2 h-2 bg-[#2FC8B9] rounded-full border-2 border-white"})]}),n.jsx("button",{onClick:()=>v("/profile"),className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0 bg-[#2FC8B9] shadow-lg hover:shadow-xl transition-all cursor-pointer",title:"Go to Profile",children:n.jsx("span",{className:"font-black text-white",children:(Ae=(we=d==null?void 0:d.name)==null?void 0:we[0])==null?void 0:Ae.toUpperCase()})})]})]})}),!$&&x.pathname!=="/quick-food-scan"&&n.jsx("header",{className:"sticky top-0 z-30 backdrop-blur-xl bg-white/95 border-b border-slate-100 md:hidden",children:n.jsxs("div",{className:"flex items-center px-4 py-3 gap-3",children:[n.jsx("button",{onClick:()=>v(-1),className:"p-2 hover:bg-gray-100 rounded-xl transition-all",title:"Go Back",children:n.jsx(Vn,{className:"w-5 h-5 text-gray-700"})}),n.jsx("h1",{className:"text-base font-bold text-black",children:((V=k.find(ce=>ce.path===x.pathname))==null?void 0:V.label)||"Back"})]})}),n.jsx("main",{className:"flex-1 main-content-mobile overflow-x-hidden w-full",style:x.pathname==="/nutrition"||x.pathname==="/ai-chat"?{padding:0,backgroundColor:"white"}:x.pathname==="/dashboard"||x.pathname==="/glucose-log"?{padding:0}:{padding:0},children:a}),!p()&&!g()&&!o&&!c&&n.jsxs(n.Fragment,{children:[n.jsx(Fae,{}),n.jsx(zQ,{})]})]}),x.pathname!=="/ai-chat"&&n.jsx(Uae,{})]})}const XA=()=>n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-pink-900 to-slate-900 p-4 sm:p-6 animate-pulse",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"h-8 bg-slate-700/50 rounded w-48 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-64"})]}),n.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-700/50",children:[n.jsx("div",{className:"h-6 bg-slate-700/50 rounded w-40 mb-4"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-full"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-5/6"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-4/6"})]})]},a))})]}),Hae=()=>{const[a,o]=ee.useState(!1),[c,d]=ee.useState(!1),h=ee.useRef(null);return ee.useEffect(()=>{const p=g=>{h.current&&!h.current.contains(g.target)&&d(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),n.jsx("header",{className:"fixed top-5 z-50 left-1/2 -translate-x-1/2 w-[calc(100%-200px)] max-w-5xl max-md:w-[calc(100%-40px)]",children:n.jsx("div",{className:"bg-white/80 backdrop-blur-md rounded-[28px] border border-white/40 shadow-2xl shadow-black/10",children:n.jsxs("div",{className:"px-6 lg:px-8",children:[n.jsxs("div",{className:"flex items-center justify-between h-16",children:[n.jsxs("nav",{className:"hidden lg:flex items-center gap-6",children:[n.jsx("a",{href:"#features",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Features"}),n.jsx("a",{href:"#showcase",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Showcase"})]}),n.jsx(Hs,{to:"/",className:"absolute left-1/2 -translate-x-1/2",children:n.jsx("span",{className:"text-xl lg:text-2xl font-serif text-gray-900",children:"FitCure"})}),n.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[n.jsx("a",{href:"#testimonials",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"Testimonials"}),n.jsx("a",{href:"#faq",className:"text-sm text-gray-700 hover:text-gray-900 transition-colors font-medium",children:"FAQ"}),n.jsxs("div",{className:"relative",ref:h,children:[n.jsx("button",{onClick:()=>d(!c),className:"w-10 h-10 rounded-full bg-cyan-500 flex items-center justify-center hover:bg-cyan-400 transition-colors ml-2",children:n.jsx(Jd,{className:"w-5 h-5 text-white"})}),c&&n.jsxs("div",{className:"absolute right-0 mt-3 w-48 bg-white backdrop-blur-2xl rounded-2xl shadow-xl border border-gray-200 py-2 animate-fade-in",children:[n.jsx(Hs,{to:"/login",className:"block px-6 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors font-medium",onClick:()=>d(!1),children:"Sign In"}),n.jsx(Hs,{to:"/register",className:"block px-6 py-3 text-sm text-gray-700 hover:bg-gray-100 transition-colors font-medium",onClick:()=>d(!1),children:"Get Started"})]})]})]}),n.jsx("button",{className:"lg:hidden p-2 text-gray-900 ml-auto",onClick:()=>o(!a),children:a?n.jsx(Gn,{className:"w-6 h-6"}):n.jsx(JV,{className:"w-6 h-6"})})]}),a&&n.jsx("div",{className:"lg:hidden py-6 border-t border-gray-200",children:n.jsxs("nav",{className:"flex flex-col gap-4",children:[n.jsx("a",{href:"#features",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Features"}),n.jsx("a",{href:"#showcase",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Showcase"}),n.jsx("a",{href:"#testimonials",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Testimonials"}),n.jsx("a",{href:"#faq",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"FAQ"}),n.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-gray-200",children:[n.jsx(Hs,{to:"/login",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Sign In"}),n.jsx(Hs,{to:"/register",className:"text-sm text-gray-700 hover:text-gray-900 py-2 font-medium",children:"Get Started"})]})]})})]})})})},Gae=()=>n.jsxs("div",{className:"relative min-h-screen flex items-center overflow-hidden bg-gradient-to-b from-[#0a3d5c] to-[#0d5a8a]",children:[n.jsxs("div",{className:"absolute inset-0 z-0",children:[n.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover opacity-60",children:[n.jsx("source",{src:"https://cdn.shopify.com/videos/c/o/v/dcb48db72fdb4641a2af2df51c03aad5.mp4",type:"video/mp4"}),n.jsx("img",{src:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1920&h=1080&fit=crop",alt:"Healthcare",className:"w-full h-full object-cover opacity-60"})]}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/40 via-black/20 to-transparent"})]}),n.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-32",children:n.jsxs("div",{className:"max-w-xl lg:max-w-2xl text-center lg:text-left",children:[n.jsx("p",{className:"text-xs sm:text-sm uppercase tracking-[0.2em] text-cyan-300 mb-6 font-medium",children:"SMART NUTRITION TRACKING"}),n.jsx("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-serif text-white mb-6 leading-[1.1]",children:"Take Control of your Health Journey."}),n.jsx("p",{className:"text-base sm:text-lg md:text-xl text-cyan-100 mb-10 leading-relaxed max-w-lg",children:"Empowers user to take informed action on their health through easy to understand insights, continuous tracking, and goal-based guidance."}),n.jsxs(Hs,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-cyan-500 text-white rounded-full font-medium hover:bg-cyan-400 transition-all group shadow-lg",children:["Start Tracking",n.jsx(To,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})}),n.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-10",children:[n.jsx("span",{className:"text-xs uppercase tracking-wider text-cyan-300 font-medium",children:"SCROLL"}),n.jsx("div",{className:"w-px h-12 bg-cyan-300/30"})]})]}),Kae=()=>{const a=[{icon:br,title:"Health Tracking",description:"Effortless daily tracking"},{icon:qi,title:"Progress Analytics",description:"Real-time health insights"},{icon:Ah,title:"Goal Setting",description:"Personalized targets"},{icon:Ca,title:"Wellness Plans",description:"AI-powered recommendations"}];return n.jsx("section",{id:"features",className:"py-20 bg-transparent",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:a.map((o,c)=>{const d=o.icon;return n.jsxs("div",{className:"text-center bg-gradient-to-br from-[#0a3d5c]/60 to-[#0d5a8a]/60 backdrop-blur-sm rounded-2xl p-8 border border-cyan-400/30 hover:border-cyan-400/60 transition-all hover:shadow-lg hover:shadow-cyan-500/20",children:[n.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6 bg-cyan-500/20 rounded-full border border-cyan-400/40",children:n.jsx(d,{className:"w-12 h-12 text-cyan-300 stroke-[1.5]"})}),n.jsx("h3",{className:"text-lg font-serif text-white mb-2",children:o.title}),n.jsx("p",{className:"text-sm text-cyan-100",children:o.description})]},c)})})})})},Wae=()=>n.jsx("section",{className:"bg-transparent py-20",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"relative rounded-3xl overflow-hidden group",children:[n.jsx("img",{src:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800&h=600&fit=crop",alt:"AI-Powered Nutrition",className:"w-full h-full object-cover min-h-[400px]"}),n.jsxs("div",{className:"absolute bottom-8 left-8 right-8 bg-gradient-to-r from-[#0a3d5c]/90 to-[#0d5a8a]/90 backdrop-blur-sm rounded-2xl p-6 border border-cyan-400/30",children:[n.jsx("h3",{className:"text-2xl font-serif text-white mb-2",children:"AI-Powered Nutrition"}),n.jsx("p",{className:"text-sm text-cyan-100",children:"Smart meal recognition and instant calorie calculation with advanced AI technology."})]})]}),n.jsxs("div",{className:"flex flex-col gap-8",children:[n.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-gradient-to-br from-[#0a3d5c]/80 to-[#0d5a8a]/80 backdrop-blur-sm p-8 border border-cyan-400/30",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-2xl font-serif text-white mb-2",children:"Track Everything"}),n.jsx("h4",{className:"text-xl font-serif text-cyan-300 mb-4",children:"Achieve Anything"}),n.jsxs("ul",{className:"space-y-2 text-sm text-cyan-100",children:[n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Calorie & Macro Tracking"]}),n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Meal Planning & Recipes"]}),n.jsxs("li",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-1 h-1 rounded-full bg-cyan-400"}),"Progress Analytics"]})]})]}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=400&fit=crop",alt:"Healthy Food",className:"w-48 h-64 object-cover rounded-2xl"})})]})}),n.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-gradient-to-br from-[#0a3d5c]/80 to-[#0d5a8a]/80 backdrop-blur-sm p-8 border border-cyan-400/30",children:n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("div",{className:"w-16 h-16 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-400/50",children:n.jsx($V,{className:"w-8 h-8 text-cyan-300"})})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-xl font-serif text-white mb-2",children:"Report Analyzer"}),n.jsx("p",{className:"text-sm text-cyan-100",children:"Track on-the-go"})]}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx("img",{src:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=200&h=200&fit=crop",alt:"Mobile App",className:"w-32 h-32 object-cover rounded-xl"})})]})})]})]})})}),zae=()=>{const[a,o]=ee.useState(0),c=ee.useRef(null),d=[{title:"Track Your Health Metrics",description:"Monitor vital signs, lab results, and health trends all in one place with AI-powered insights.",phoneScreen:"dashboard",cards:[{icon:Ca,title:"Heart Rate",value:"72 bpm",color:"rose",position:"left-top"},{icon:br,title:"Blood Pressure",value:"120/80",color:"blue",position:"left-bottom"},{icon:qi,title:"Health Score",value:"85/100",color:"emerald",position:"right-top"},{icon:eh,title:"Vitamin D",value:"45 ng/mL",color:"amber",position:"right-bottom"}]},{title:"Smart Nutrition Tracking",description:"Track your meals and get actionable feedback that helps you build a better relationship with food.",phoneScreen:"nutrition",cards:[{icon:lx,title:"Today's Meals",value:"3 logged",color:"emerald",position:"left-top"},{icon:br,title:"Calories",value:"1,850 kcal",color:"orange",position:"left-bottom"},{icon:qi,title:"Protein",value:"95g",color:"blue",position:"right-top"},{icon:Ca,title:"Macro Balance",value:"Optimal",color:"purple",position:"right-bottom"}]},{title:"AI-Powered Health Insights",description:"Get personalized recommendations based on your medical reports and wearable data.",phoneScreen:"ai-chat",cards:[{icon:cx,title:"AI Assistant",value:"24/7 Available",color:"cyan",position:"left-top"},{icon:qi,title:"Insights",value:"12 new",color:"indigo",position:"left-bottom"},{icon:yi,title:"Reminders",value:"5 today",color:"pink",position:"right-top"},{icon:Ca,title:"Health Tips",value:"Updated",color:"red",position:"right-bottom"}]},{title:"Sleep & Recovery Tracking",description:"Improve your sleep by understanding patterns, identifying disruptions, and building habits.",phoneScreen:"sleep",cards:[{icon:Og,title:"Sleep Quality",value:"85%",color:"indigo",position:"left-top"},{icon:br,title:"Sleep Duration",value:"7h 45m",color:"blue",position:"left-bottom"},{icon:qi,title:"Deep Sleep",value:"2h 15m",color:"purple",position:"right-top"},{icon:Ca,title:"REM Sleep",value:"1h 30m",color:"pink",position:"right-bottom"}]}];ee.useEffect(()=>{const x=()=>{if(!c.current)return;const v=c.current,{top:E,height:C}=v.getBoundingClientRect(),I=window.innerHeight,O=(I/2-E)/(C-I/2),R=Math.max(0,Math.min(1,O)),k=Math.floor(R*d.length),M=Math.min(k,d.length-1);o(M)};return window.addEventListener("scroll",x),x(),()=>window.removeEventListener("scroll",x)},[d.length]);const h=x=>({"left-top":"left-[1%] sm:left-[3%] md:left-[8%] top-[8%] sm:top-[10%] md:top-[12%]","left-bottom":"left-[1%] sm:left-[5%] md:left-[10%] bottom-[12%] sm:bottom-[15%] md:bottom-[18%]","right-top":"right-[1%] sm:right-[3%] md:right-[8%] top-[14%] sm:top-[16%] md:top-[18%]","right-bottom":"right-[1%] sm:right-[5%] md:right-[10%] bottom-[6%] sm:bottom-[9%] md:bottom-[12%]"})[x]||"left-[10%] top-[20%]",p=(x,v)=>({"left-top":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 translate-y-16 scale-75","left-bottom":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 -translate-y-16 scale-75","right-top":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 translate-y-16 scale-75","right-bottom":v?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 -translate-y-16 scale-75"})[x],g=x=>({dashboard:"from-purple-500 to-orange-500",nutrition:"from-purple-500 to-orange-500","ai-chat":"from-purple-500 to-orange-500",sleep:"from-purple-500 to-orange-500"})[x]||"from-purple-500 to-orange-500";return n.jsx("div",{id:"showcase",ref:c,className:"relative bg-transparent",style:{height:`${d.length*100}vh`},children:n.jsx("div",{className:"sticky top-0 h-screen flex items-center justify-center overflow-hidden pt-20 sm:pt-24 px-2 sm:px-4",children:n.jsx("div",{className:"relative w-full max-w-7xl mx-auto",children:n.jsxs("div",{className:"relative flex flex-col items-center",children:[n.jsx("div",{className:"text-center mb-2 sm:mb-3 max-w-2xl px-4 transition-all duration-700 transform relative z-30",children:n.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-white mb-6 sm:mb-8 leading-tight",children:d[a].title})}),n.jsx("div",{className:"absolute inset-0 pointer-events-none z-40",children:d[a].cards.map((x,v)=>{const E=x.icon,C={rose:{bg:"bg-rose-50",icon:"text-rose-500",value:"text-rose-600",border:"border-rose-100"},blue:{bg:"bg-blue-50",icon:"text-blue-500",value:"text-blue-600",border:"border-blue-100"},emerald:{bg:"bg-emerald-50",icon:"text-emerald-500",value:"text-emerald-600",border:"border-emerald-100"},amber:{bg:"bg-amber-50",icon:"text-amber-500",value:"text-amber-600",border:"border-amber-100"},orange:{bg:"bg-orange-50",icon:"text-orange-500",value:"text-orange-600",border:"border-orange-100"},purple:{bg:"bg-purple-50",icon:"text-purple-500",value:"text-purple-600",border:"border-purple-100"},cyan:{bg:"bg-cyan-50",icon:"text-cyan-500",value:"text-cyan-600",border:"border-cyan-100"},indigo:{bg:"bg-indigo-50",icon:"text-indigo-500",value:"text-indigo-600",border:"border-indigo-100"},pink:{bg:"bg-pink-50",icon:"text-pink-500",value:"text-pink-600",border:"border-pink-100"},red:{bg:"bg-red-50",icon:"text-red-500",value:"text-red-600",border:"border-red-100"}};return C[x.color]||C.blue,n.jsx("div",{className:`absolute ${h(x.position)} ${p(x.position,!0)} 
                      transition-all duration-1000 ease-out`,style:{transitionDelay:`${v*150}ms`},children:n.jsxs("div",{className:`bg-gradient-to-br from-[#0a3d5c]/90 to-[#0d5a8a]/90 rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-4 md:p-6 border border-cyan-400/40 
                      hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 w-32 sm:w-40 md:w-48 backdrop-blur-sm`,children:[n.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-lg sm:rounded-xl bg-cyan-500/20 flex items-center justify-center mb-2 sm:mb-3 border border-cyan-400/30",children:n.jsx(E,{className:"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-cyan-300",strokeWidth:2})}),n.jsx("h4",{className:"text-white font-medium text-xs sm:text-sm md:text-base mb-1 leading-tight",children:x.title}),n.jsx("p",{className:"text-cyan-300 font-bold text-base sm:text-lg md:text-xl",children:x.value})]})},v)})}),n.jsxs("div",{className:"relative transform perspective-1000 z-10",children:[n.jsxs("div",{className:"relative w-[240px] sm:w-[280px] md:w-[320px] lg:w-[340px] h-[480px] sm:h-[560px] md:h-[640px] lg:h-[680px] bg-slate-900 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] p-2 sm:p-3 shadow-2xl",children:[n.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-28 sm:w-32 md:w-36 h-5 sm:h-6 md:h-7 bg-slate-900 rounded-b-2xl sm:rounded-b-3xl z-10"}),n.jsx("div",{className:"relative w-full h-full bg-white rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] overflow-hidden",children:n.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${g(d[a].phoneScreen)} 
                    transition-all duration-1000 ease-in-out`,children:[n.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 md:px-6 pt-2 sm:pt-3 text-white text-[10px] sm:text-xs",children:[n.jsx("span",{children:"9:41"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:"w-3 h-2 sm:w-4 sm:h-3 border border-white rounded-sm"}),n.jsx("div",{className:"w-0.5 h-2 sm:w-1 sm:h-3 bg-white rounded-sm"})]})]}),n.jsxs("div",{className:"px-4 sm:px-5 md:px-6 pt-6 sm:pt-7 md:pt-8",children:[n.jsxs("h3",{className:"text-white text-lg sm:text-xl md:text-2xl font-bold",children:[d[a].phoneScreen==="dashboard"&&"Dashboard",d[a].phoneScreen==="nutrition"&&"Nutrition",d[a].phoneScreen==="ai-chat"&&"AI Assistant",d[a].phoneScreen==="sleep"&&"Sleep"]}),n.jsx("p",{className:"text-white/80 text-[10px] sm:text-xs md:text-sm mt-1",children:new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsx("div",{className:`absolute inset-x-4 sm:inset-x-5 md:inset-x-6 top-24 sm:top-28 md:top-32 bottom-4 sm:bottom-5 md:bottom-6 bg-white/10 backdrop-blur-md rounded-2xl sm:rounded-3xl border border-white/20 p-4 sm:p-5 md:p-6 \r
                      transition-all duration-1000 shadow-inner`,children:n.jsx("div",{className:"space-y-3 sm:space-y-4",children:[1,2,3].map(x=>n.jsx("div",{className:"bg-white/20 rounded-xl sm:rounded-2xl h-14 sm:h-16 md:h-20 animate-pulse shadow-lg",style:{animationDelay:`${x*200}ms`,animationDuration:"2s"}},x))})})]})})]}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/10 to-slate-900/30 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] -z-10 blur-2xl sm:blur-3xl transform scale-105"})]})]})})})})},qae=(a,o)=>{const c=new Array(a.length+o.length);for(let d=0;d<a.length;d++)c[d]=a[d];for(let d=0;d<o.length;d++)c[a.length+d]=o[d];return c},Yae=(a,o)=>({classGroupId:a,validator:o}),qQ=(a=new Map,o=null,c)=>({nextPart:a,validators:o,classGroupId:c}),Uy="-",d6=[],Xae="arbitrary..",Jae=a=>{const o=Zae(a),{conflictingClassGroups:c,conflictingClassGroupModifiers:d}=a;return{getClassGroupId:g=>{if(g.startsWith("[")&&g.endsWith("]"))return $ae(g);const x=g.split(Uy),v=x[0]===""&&x.length>1?1:0;return YQ(x,v,o)},getConflictingClassGroupIds:(g,x)=>{if(x){const v=d[g],E=c[g];return v?E?qae(E,v):v:E||d6}return c[g]||d6}}},YQ=(a,o,c)=>{if(a.length-o===0)return c.classGroupId;const h=a[o],p=c.nextPart.get(h);if(p){const E=YQ(a,o+1,p);if(E)return E}const g=c.validators;if(g===null)return;const x=o===0?a.join(Uy):a.slice(o).join(Uy),v=g.length;for(let E=0;E<v;E++){const C=g[E];if(C.validator(x))return C.classGroupId}},$ae=a=>a.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const o=a.slice(1,-1),c=o.indexOf(":"),d=o.slice(0,c);return d?Xae+d:void 0})(),Zae=a=>{const{theme:o,classGroups:c}=a;return eoe(c,o)},eoe=(a,o)=>{const c=qQ();for(const d in a){const h=a[d];iI(h,c,d,o)}return c},iI=(a,o,c,d)=>{const h=a.length;for(let p=0;p<h;p++){const g=a[p];toe(g,o,c,d)}},toe=(a,o,c,d)=>{if(typeof a=="string"){soe(a,o,c);return}if(typeof a=="function"){roe(a,o,c,d);return}noe(a,o,c,d)},soe=(a,o,c)=>{const d=a===""?o:XQ(o,a);d.classGroupId=c},roe=(a,o,c,d)=>{if(ioe(a)){iI(a(d),o,c,d);return}o.validators===null&&(o.validators=[]),o.validators.push(Yae(c,a))},noe=(a,o,c,d)=>{const h=Object.entries(a),p=h.length;for(let g=0;g<p;g++){const[x,v]=h[g];iI(v,XQ(o,x),c,d)}},XQ=(a,o)=>{let c=a;const d=o.split(Uy),h=d.length;for(let p=0;p<h;p++){const g=d[p];let x=c.nextPart.get(g);x||(x=qQ(),c.nextPart.set(g,x)),c=x}return c},ioe=a=>"isThemeGetter"in a&&a.isThemeGetter===!0,aoe=a=>{if(a<1)return{get:()=>{},set:()=>{}};let o=0,c=Object.create(null),d=Object.create(null);const h=(p,g)=>{c[p]=g,o++,o>a&&(o=0,d=c,c=Object.create(null))};return{get(p){let g=c[p];if(g!==void 0)return g;if((g=d[p])!==void 0)return h(p,g),g},set(p,g){p in c?c[p]=g:h(p,g)}}},tR="!",A6=":",ooe=[],u6=(a,o,c,d,h)=>({modifiers:a,hasImportantModifier:o,baseClassName:c,maybePostfixModifierPosition:d,isExternal:h}),coe=a=>{const{prefix:o,experimentalParseClassName:c}=a;let d=h=>{const p=[];let g=0,x=0,v=0,E;const C=h.length;for(let M=0;M<C;M++){const P=h[M];if(g===0&&x===0){if(P===A6){p.push(h.slice(v,M)),v=M+1;continue}if(P==="/"){E=M;continue}}P==="["?g++:P==="]"?g--:P==="("?x++:P===")"&&x--}const I=p.length===0?h:h.slice(v);let O=I,R=!1;I.endsWith(tR)?(O=I.slice(0,-1),R=!0):I.startsWith(tR)&&(O=I.slice(1),R=!0);const k=E&&E>v?E-v:void 0;return u6(p,R,O,k)};if(o){const h=o+A6,p=d;d=g=>g.startsWith(h)?p(g.slice(h.length)):u6(ooe,!1,g,void 0,!0)}if(c){const h=d;d=p=>c({className:p,parseClassName:h})}return d},loe=a=>{const o=new Map;return a.orderSensitiveModifiers.forEach((c,d)=>{o.set(c,1e6+d)}),c=>{const d=[];let h=[];for(let p=0;p<c.length;p++){const g=c[p],x=g[0]==="[",v=o.has(g);x||v?(h.length>0&&(h.sort(),d.push(...h),h=[]),d.push(g)):h.push(g)}return h.length>0&&(h.sort(),d.push(...h)),d}},doe=a=>({cache:aoe(a.cacheSize),parseClassName:coe(a),sortModifiers:loe(a),...Jae(a)}),Aoe=/\s+/,uoe=(a,o)=>{const{parseClassName:c,getClassGroupId:d,getConflictingClassGroupIds:h,sortModifiers:p}=o,g=[],x=a.trim().split(Aoe);let v="";for(let E=x.length-1;E>=0;E-=1){const C=x[E],{isExternal:I,modifiers:O,hasImportantModifier:R,baseClassName:k,maybePostfixModifierPosition:M}=c(C);if(I){v=C+(v.length>0?" "+v:v);continue}let P=!!M,H=d(P?k.substring(0,M):k);if(!H){if(!P){v=C+(v.length>0?" "+v:v);continue}if(H=d(k),!H){v=C+(v.length>0?" "+v:v);continue}P=!1}const $=O.length===0?"":O.length===1?O[0]:p(O).join(":"),re=R?$+tR:$,J=re+H;if(g.indexOf(J)>-1)continue;g.push(J);const ge=h(H,P);for(let ie=0;ie<ge.length;++ie){const we=ge[ie];g.push(re+we)}v=C+(v.length>0?" "+v:v)}return v},hoe=(...a)=>{let o=0,c,d,h="";for(;o<a.length;)(c=a[o++])&&(d=JQ(c))&&(h&&(h+=" "),h+=d);return h},JQ=a=>{if(typeof a=="string")return a;let o,c="";for(let d=0;d<a.length;d++)a[d]&&(o=JQ(a[d]))&&(c&&(c+=" "),c+=o);return c},poe=(a,...o)=>{let c,d,h,p;const g=v=>{const E=o.reduce((C,I)=>I(C),a());return c=doe(E),d=c.cache.get,h=c.cache.set,p=x,x(v)},x=v=>{const E=d(v);if(E)return E;const C=uoe(v,c);return h(v,C),C};return p=g,(...v)=>p(hoe(...v))},moe=[],oa=a=>{const o=c=>c[a]||moe;return o.isThemeGetter=!0,o},$Q=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,ZQ=/^\((?:(\w[\w-]*):)?(.+)\)$/i,foe=/^\d+\/\d+$/,goe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,boe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,xoe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,voe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,woe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Jf=a=>foe.test(a),Ir=a=>!!a&&!Number.isNaN(Number(a)),Wu=a=>!!a&&Number.isInteger(Number(a)),W2=a=>a.endsWith("%")&&Ir(a.slice(0,-1)),jA=a=>goe.test(a),_oe=()=>!0,yoe=a=>boe.test(a)&&!xoe.test(a),eH=()=>!1,Eoe=a=>voe.test(a),Coe=a=>woe.test(a),Soe=a=>!Ns(a)&&!Ts(a),Noe=a=>Lg(a,rH,eH),Ns=a=>$Q.test(a),Pp=a=>Lg(a,nH,yoe),z2=a=>Lg(a,koe,Ir),h6=a=>Lg(a,tH,eH),Toe=a=>Lg(a,sH,Coe),j_=a=>Lg(a,iH,Eoe),Ts=a=>ZQ.test(a),Rb=a=>jg(a,nH),Roe=a=>jg(a,Doe),p6=a=>jg(a,tH),Ioe=a=>jg(a,rH),Ooe=a=>jg(a,sH),P_=a=>jg(a,iH,!0),Lg=(a,o,c)=>{const d=$Q.exec(a);return d?d[1]?o(d[1]):c(d[2]):!1},jg=(a,o,c=!1)=>{const d=ZQ.exec(a);return d?d[1]?o(d[1]):c:!1},tH=a=>a==="position"||a==="percentage",sH=a=>a==="image"||a==="url",rH=a=>a==="length"||a==="size"||a==="bg-size",nH=a=>a==="length",koe=a=>a==="number",Doe=a=>a==="family-name",iH=a=>a==="shadow",Boe=()=>{const a=oa("color"),o=oa("font"),c=oa("text"),d=oa("font-weight"),h=oa("tracking"),p=oa("leading"),g=oa("breakpoint"),x=oa("container"),v=oa("spacing"),E=oa("radius"),C=oa("shadow"),I=oa("inset-shadow"),O=oa("text-shadow"),R=oa("drop-shadow"),k=oa("blur"),M=oa("perspective"),P=oa("aspect"),H=oa("ease"),$=oa("animate"),re=()=>["auto","avoid","all","avoid-page","page","left","right","column"],J=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],ge=()=>[...J(),Ts,Ns],ie=()=>["auto","hidden","clip","visible","scroll"],we=()=>["auto","contain","none"],Ae=()=>[Ts,Ns,v],V=()=>[Jf,"full","auto",...Ae()],ce=()=>[Wu,"none","subgrid",Ts,Ns],Y=()=>["auto",{span:["full",Wu,Ts,Ns]},Wu,Ts,Ns],z=()=>[Wu,"auto",Ts,Ns],te=()=>["auto","min","max","fr",Ts,Ns],se=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Ce=()=>["start","end","center","stretch","center-safe","end-safe"],he=()=>["auto",...Ae()],Ne=()=>[Jf,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Ae()],Z=()=>[a,Ts,Ns],Ie=()=>[...J(),p6,h6,{position:[Ts,Ns]}],Ve=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Pe=()=>["auto","cover","contain",Ioe,Noe,{size:[Ts,Ns]}],ne=()=>[W2,Rb,Pp],ve=()=>["","none","full",E,Ts,Ns],ue=()=>["",Ir,Rb,Pp],Te=()=>["solid","dashed","dotted","double"],Be=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ue=()=>[Ir,W2,p6,h6],tt=()=>["","none",k,Ts,Ns],ot=()=>["none",Ir,Ts,Ns],ut=()=>["none",Ir,Ts,Ns],Tt=()=>[Ir,Ts,Ns],Qe=()=>[Jf,"full",...Ae()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[jA],breakpoint:[jA],color:[_oe],container:[jA],"drop-shadow":[jA],ease:["in","out","in-out"],font:[Soe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[jA],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[jA],shadow:[jA],spacing:["px",Ir],text:[jA],"text-shadow":[jA],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Jf,Ns,Ts,P]}],container:["container"],columns:[{columns:[Ir,Ns,Ts,x]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:ge()}],overflow:[{overflow:ie()}],"overflow-x":[{"overflow-x":ie()}],"overflow-y":[{"overflow-y":ie()}],overscroll:[{overscroll:we()}],"overscroll-x":[{"overscroll-x":we()}],"overscroll-y":[{"overscroll-y":we()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:V()}],"inset-x":[{"inset-x":V()}],"inset-y":[{"inset-y":V()}],start:[{start:V()}],end:[{end:V()}],top:[{top:V()}],right:[{right:V()}],bottom:[{bottom:V()}],left:[{left:V()}],visibility:["visible","invisible","collapse"],z:[{z:[Wu,"auto",Ts,Ns]}],basis:[{basis:[Jf,"full","auto",x,...Ae()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ir,Jf,"auto","initial","none",Ns]}],grow:[{grow:["",Ir,Ts,Ns]}],shrink:[{shrink:["",Ir,Ts,Ns]}],order:[{order:[Wu,"first","last","none",Ts,Ns]}],"grid-cols":[{"grid-cols":ce()}],"col-start-end":[{col:Y()}],"col-start":[{"col-start":z()}],"col-end":[{"col-end":z()}],"grid-rows":[{"grid-rows":ce()}],"row-start-end":[{row:Y()}],"row-start":[{"row-start":z()}],"row-end":[{"row-end":z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":te()}],"auto-rows":[{"auto-rows":te()}],gap:[{gap:Ae()}],"gap-x":[{"gap-x":Ae()}],"gap-y":[{"gap-y":Ae()}],"justify-content":[{justify:[...se(),"normal"]}],"justify-items":[{"justify-items":[...Ce(),"normal"]}],"justify-self":[{"justify-self":["auto",...Ce()]}],"align-content":[{content:["normal",...se()]}],"align-items":[{items:[...Ce(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Ce(),{baseline:["","last"]}]}],"place-content":[{"place-content":se()}],"place-items":[{"place-items":[...Ce(),"baseline"]}],"place-self":[{"place-self":["auto",...Ce()]}],p:[{p:Ae()}],px:[{px:Ae()}],py:[{py:Ae()}],ps:[{ps:Ae()}],pe:[{pe:Ae()}],pt:[{pt:Ae()}],pr:[{pr:Ae()}],pb:[{pb:Ae()}],pl:[{pl:Ae()}],m:[{m:he()}],mx:[{mx:he()}],my:[{my:he()}],ms:[{ms:he()}],me:[{me:he()}],mt:[{mt:he()}],mr:[{mr:he()}],mb:[{mb:he()}],ml:[{ml:he()}],"space-x":[{"space-x":Ae()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Ae()}],"space-y-reverse":["space-y-reverse"],size:[{size:Ne()}],w:[{w:[x,"screen",...Ne()]}],"min-w":[{"min-w":[x,"screen","none",...Ne()]}],"max-w":[{"max-w":[x,"screen","none","prose",{screen:[g]},...Ne()]}],h:[{h:["screen","lh",...Ne()]}],"min-h":[{"min-h":["screen","lh","none",...Ne()]}],"max-h":[{"max-h":["screen","lh",...Ne()]}],"font-size":[{text:["base",c,Rb,Pp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[d,Ts,z2]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",W2,Ns]}],"font-family":[{font:[Roe,Ns,o]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[h,Ts,Ns]}],"line-clamp":[{"line-clamp":[Ir,"none",Ts,z2]}],leading:[{leading:[p,...Ae()]}],"list-image":[{"list-image":["none",Ts,Ns]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ts,Ns]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Z()}],"text-color":[{text:Z()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Te(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ir,"from-font","auto",Ts,Pp]}],"text-decoration-color":[{decoration:Z()}],"underline-offset":[{"underline-offset":[Ir,"auto",Ts,Ns]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ae()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ts,Ns]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ts,Ns]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Ie()}],"bg-repeat":[{bg:Ve()}],"bg-size":[{bg:Pe()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Wu,Ts,Ns],radial:["",Ts,Ns],conic:[Wu,Ts,Ns]},Ooe,Toe]}],"bg-color":[{bg:Z()}],"gradient-from-pos":[{from:ne()}],"gradient-via-pos":[{via:ne()}],"gradient-to-pos":[{to:ne()}],"gradient-from":[{from:Z()}],"gradient-via":[{via:Z()}],"gradient-to":[{to:Z()}],rounded:[{rounded:ve()}],"rounded-s":[{"rounded-s":ve()}],"rounded-e":[{"rounded-e":ve()}],"rounded-t":[{"rounded-t":ve()}],"rounded-r":[{"rounded-r":ve()}],"rounded-b":[{"rounded-b":ve()}],"rounded-l":[{"rounded-l":ve()}],"rounded-ss":[{"rounded-ss":ve()}],"rounded-se":[{"rounded-se":ve()}],"rounded-ee":[{"rounded-ee":ve()}],"rounded-es":[{"rounded-es":ve()}],"rounded-tl":[{"rounded-tl":ve()}],"rounded-tr":[{"rounded-tr":ve()}],"rounded-br":[{"rounded-br":ve()}],"rounded-bl":[{"rounded-bl":ve()}],"border-w":[{border:ue()}],"border-w-x":[{"border-x":ue()}],"border-w-y":[{"border-y":ue()}],"border-w-s":[{"border-s":ue()}],"border-w-e":[{"border-e":ue()}],"border-w-t":[{"border-t":ue()}],"border-w-r":[{"border-r":ue()}],"border-w-b":[{"border-b":ue()}],"border-w-l":[{"border-l":ue()}],"divide-x":[{"divide-x":ue()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ue()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Te(),"hidden","none"]}],"divide-style":[{divide:[...Te(),"hidden","none"]}],"border-color":[{border:Z()}],"border-color-x":[{"border-x":Z()}],"border-color-y":[{"border-y":Z()}],"border-color-s":[{"border-s":Z()}],"border-color-e":[{"border-e":Z()}],"border-color-t":[{"border-t":Z()}],"border-color-r":[{"border-r":Z()}],"border-color-b":[{"border-b":Z()}],"border-color-l":[{"border-l":Z()}],"divide-color":[{divide:Z()}],"outline-style":[{outline:[...Te(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ir,Ts,Ns]}],"outline-w":[{outline:["",Ir,Rb,Pp]}],"outline-color":[{outline:Z()}],shadow:[{shadow:["","none",C,P_,j_]}],"shadow-color":[{shadow:Z()}],"inset-shadow":[{"inset-shadow":["none",I,P_,j_]}],"inset-shadow-color":[{"inset-shadow":Z()}],"ring-w":[{ring:ue()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Z()}],"ring-offset-w":[{"ring-offset":[Ir,Pp]}],"ring-offset-color":[{"ring-offset":Z()}],"inset-ring-w":[{"inset-ring":ue()}],"inset-ring-color":[{"inset-ring":Z()}],"text-shadow":[{"text-shadow":["none",O,P_,j_]}],"text-shadow-color":[{"text-shadow":Z()}],opacity:[{opacity:[Ir,Ts,Ns]}],"mix-blend":[{"mix-blend":[...Be(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Be()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ir]}],"mask-image-linear-from-pos":[{"mask-linear-from":Ue()}],"mask-image-linear-to-pos":[{"mask-linear-to":Ue()}],"mask-image-linear-from-color":[{"mask-linear-from":Z()}],"mask-image-linear-to-color":[{"mask-linear-to":Z()}],"mask-image-t-from-pos":[{"mask-t-from":Ue()}],"mask-image-t-to-pos":[{"mask-t-to":Ue()}],"mask-image-t-from-color":[{"mask-t-from":Z()}],"mask-image-t-to-color":[{"mask-t-to":Z()}],"mask-image-r-from-pos":[{"mask-r-from":Ue()}],"mask-image-r-to-pos":[{"mask-r-to":Ue()}],"mask-image-r-from-color":[{"mask-r-from":Z()}],"mask-image-r-to-color":[{"mask-r-to":Z()}],"mask-image-b-from-pos":[{"mask-b-from":Ue()}],"mask-image-b-to-pos":[{"mask-b-to":Ue()}],"mask-image-b-from-color":[{"mask-b-from":Z()}],"mask-image-b-to-color":[{"mask-b-to":Z()}],"mask-image-l-from-pos":[{"mask-l-from":Ue()}],"mask-image-l-to-pos":[{"mask-l-to":Ue()}],"mask-image-l-from-color":[{"mask-l-from":Z()}],"mask-image-l-to-color":[{"mask-l-to":Z()}],"mask-image-x-from-pos":[{"mask-x-from":Ue()}],"mask-image-x-to-pos":[{"mask-x-to":Ue()}],"mask-image-x-from-color":[{"mask-x-from":Z()}],"mask-image-x-to-color":[{"mask-x-to":Z()}],"mask-image-y-from-pos":[{"mask-y-from":Ue()}],"mask-image-y-to-pos":[{"mask-y-to":Ue()}],"mask-image-y-from-color":[{"mask-y-from":Z()}],"mask-image-y-to-color":[{"mask-y-to":Z()}],"mask-image-radial":[{"mask-radial":[Ts,Ns]}],"mask-image-radial-from-pos":[{"mask-radial-from":Ue()}],"mask-image-radial-to-pos":[{"mask-radial-to":Ue()}],"mask-image-radial-from-color":[{"mask-radial-from":Z()}],"mask-image-radial-to-color":[{"mask-radial-to":Z()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":J()}],"mask-image-conic-pos":[{"mask-conic":[Ir]}],"mask-image-conic-from-pos":[{"mask-conic-from":Ue()}],"mask-image-conic-to-pos":[{"mask-conic-to":Ue()}],"mask-image-conic-from-color":[{"mask-conic-from":Z()}],"mask-image-conic-to-color":[{"mask-conic-to":Z()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Ie()}],"mask-repeat":[{mask:Ve()}],"mask-size":[{mask:Pe()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ts,Ns]}],filter:[{filter:["","none",Ts,Ns]}],blur:[{blur:tt()}],brightness:[{brightness:[Ir,Ts,Ns]}],contrast:[{contrast:[Ir,Ts,Ns]}],"drop-shadow":[{"drop-shadow":["","none",R,P_,j_]}],"drop-shadow-color":[{"drop-shadow":Z()}],grayscale:[{grayscale:["",Ir,Ts,Ns]}],"hue-rotate":[{"hue-rotate":[Ir,Ts,Ns]}],invert:[{invert:["",Ir,Ts,Ns]}],saturate:[{saturate:[Ir,Ts,Ns]}],sepia:[{sepia:["",Ir,Ts,Ns]}],"backdrop-filter":[{"backdrop-filter":["","none",Ts,Ns]}],"backdrop-blur":[{"backdrop-blur":tt()}],"backdrop-brightness":[{"backdrop-brightness":[Ir,Ts,Ns]}],"backdrop-contrast":[{"backdrop-contrast":[Ir,Ts,Ns]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ir,Ts,Ns]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ir,Ts,Ns]}],"backdrop-invert":[{"backdrop-invert":["",Ir,Ts,Ns]}],"backdrop-opacity":[{"backdrop-opacity":[Ir,Ts,Ns]}],"backdrop-saturate":[{"backdrop-saturate":[Ir,Ts,Ns]}],"backdrop-sepia":[{"backdrop-sepia":["",Ir,Ts,Ns]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Ae()}],"border-spacing-x":[{"border-spacing-x":Ae()}],"border-spacing-y":[{"border-spacing-y":Ae()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ts,Ns]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ir,"initial",Ts,Ns]}],ease:[{ease:["linear","initial",H,Ts,Ns]}],delay:[{delay:[Ir,Ts,Ns]}],animate:[{animate:["none",$,Ts,Ns]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[M,Ts,Ns]}],"perspective-origin":[{"perspective-origin":ge()}],rotate:[{rotate:ot()}],"rotate-x":[{"rotate-x":ot()}],"rotate-y":[{"rotate-y":ot()}],"rotate-z":[{"rotate-z":ot()}],scale:[{scale:ut()}],"scale-x":[{"scale-x":ut()}],"scale-y":[{"scale-y":ut()}],"scale-z":[{"scale-z":ut()}],"scale-3d":["scale-3d"],skew:[{skew:Tt()}],"skew-x":[{"skew-x":Tt()}],"skew-y":[{"skew-y":Tt()}],transform:[{transform:[Ts,Ns,"","none","gpu","cpu"]}],"transform-origin":[{origin:ge()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Qe()}],"translate-x":[{"translate-x":Qe()}],"translate-y":[{"translate-y":Qe()}],"translate-z":[{"translate-z":Qe()}],"translate-none":["translate-none"],accent:[{accent:Z()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Z()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ts,Ns]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ae()}],"scroll-mx":[{"scroll-mx":Ae()}],"scroll-my":[{"scroll-my":Ae()}],"scroll-ms":[{"scroll-ms":Ae()}],"scroll-me":[{"scroll-me":Ae()}],"scroll-mt":[{"scroll-mt":Ae()}],"scroll-mr":[{"scroll-mr":Ae()}],"scroll-mb":[{"scroll-mb":Ae()}],"scroll-ml":[{"scroll-ml":Ae()}],"scroll-p":[{"scroll-p":Ae()}],"scroll-px":[{"scroll-px":Ae()}],"scroll-py":[{"scroll-py":Ae()}],"scroll-ps":[{"scroll-ps":Ae()}],"scroll-pe":[{"scroll-pe":Ae()}],"scroll-pt":[{"scroll-pt":Ae()}],"scroll-pr":[{"scroll-pr":Ae()}],"scroll-pb":[{"scroll-pb":Ae()}],"scroll-pl":[{"scroll-pl":Ae()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ts,Ns]}],fill:[{fill:["none",...Z()]}],"stroke-w":[{stroke:[Ir,Rb,Pp,z2]}],stroke:[{stroke:["none",...Z()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Loe=poe(Boe);function Ic(...a){return Loe(ZV(a))}const joe=Math.sqrt(5e3),Poe=[{tempId:0,testimonial:"My favorite solution in the market. We work 5x faster with COMPANY.",by:"Alex, CEO at TechCorp",imgSrc:"https://i.pravatar.cc/150?img=1"},{tempId:1,testimonial:"I'm confident my data is safe with COMPANY. I can't say that about other providers.",by:"Dan, CTO at SecureNet",imgSrc:"https://i.pravatar.cc/150?img=2"},{tempId:2,testimonial:"I know it's cliche, but we were lost before we found COMPANY. Can't thank you guys enough!",by:"Stephanie, COO at InnovateCo",imgSrc:"https://i.pravatar.cc/150?img=3"},{tempId:3,testimonial:"COMPANY's products make planning for the future seamless. Can't recommend them enough!",by:"Marie, CFO at FuturePlanning",imgSrc:"https://i.pravatar.cc/150?img=4"},{tempId:4,testimonial:"If I could give 11 stars, I'd give 12.",by:"Andre, Head of Design at CreativeSolutions",imgSrc:"https://i.pravatar.cc/150?img=5"},{tempId:5,testimonial:"SO SO SO HAPPY WE FOUND YOU GUYS!!!! I'd bet you've saved me 100 hours so far.",by:"Jeremy, Product Manager at TimeWise",imgSrc:"https://i.pravatar.cc/150?img=6"},{tempId:6,testimonial:"Took some convincing, but now that we're on COMPANY, we're never going back.",by:"Pam, Marketing Director at BrandBuilders",imgSrc:"https://i.pravatar.cc/150?img=7"},{tempId:7,testimonial:"I would be lost without COMPANY's in-depth analytics. The ROI is EASILY 100X for us.",by:"Daniel, Data Scientist at AnalyticsPro",imgSrc:"https://i.pravatar.cc/150?img=8"},{tempId:8,testimonial:"It's just the best. Period.",by:"Fernando, UX Designer at UserFirst",imgSrc:"https://i.pravatar.cc/150?img=9"},{tempId:9,testimonial:"I switched 5 years ago and never looked back.",by:"Andy, DevOps Engineer at CloudMasters",imgSrc:"https://i.pravatar.cc/150?img=10"},{tempId:10,testimonial:"I've been searching for a solution like COMPANY for YEARS. So glad I finally found one!",by:"Pete, Sales Director at RevenueRockets",imgSrc:"https://i.pravatar.cc/150?img=11"},{tempId:11,testimonial:"It's so simple and intuitive, we got the team up to speed in 10 minutes.",by:"Marina, HR Manager at TalentForge",imgSrc:"https://i.pravatar.cc/150?img=12"},{tempId:12,testimonial:"COMPANY's customer support is unparalleled. They're always there when we need them.",by:"Olivia, Customer Success Manager at ClientCare",imgSrc:"https://i.pravatar.cc/150?img=13"},{tempId:13,testimonial:"The efficiency gains we've seen since implementing COMPANY are off the charts!",by:"Raj, Operations Manager at StreamlineSolutions",imgSrc:"https://i.pravatar.cc/150?img=14"},{tempId:14,testimonial:"COMPANY has revolutionized how we handle our workflow. It's a game-changer!",by:"Lila, Workflow Specialist at ProcessPro",imgSrc:"https://i.pravatar.cc/150?img=15"},{tempId:15,testimonial:"The scalability of COMPANY's solution is impressive. It grows with our business seamlessly.",by:"Trevor, Scaling Officer at GrowthGurus",imgSrc:"https://i.pravatar.cc/150?img=16"},{tempId:16,testimonial:"I appreciate how COMPANY continually innovates. They're always one step ahead.",by:"Naomi, Innovation Lead at FutureTech",imgSrc:"https://i.pravatar.cc/150?img=17"},{tempId:17,testimonial:"The ROI we've seen with COMPANY is incredible. It's paid for itself many times over.",by:"Victor, Finance Analyst at ProfitPeak",imgSrc:"https://i.pravatar.cc/150?img=18"},{tempId:18,testimonial:"COMPANY's platform is so robust, yet easy to use. It's the perfect balance.",by:"Yuki, Tech Lead at BalancedTech",imgSrc:"https://i.pravatar.cc/150?img=19"},{tempId:19,testimonial:"We've tried many solutions, but COMPANY stands out in terms of reliability and performance.",by:"Zoe, Performance Manager at ReliableSystems",imgSrc:"https://i.pravatar.cc/150?img=20"}],Uoe=({position:a,testimonial:o,handleMove:c,cardSize:d})=>{const h=a===0;return n.jsxs("div",{onClick:()=>c(a),className:Ic("absolute left-1/2 top-1/2 cursor-pointer border-2 p-8 transition-all duration-500 ease-in-out",h?"z-10 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] text-white border-cyan-400/60":"z-0 bg-gradient-to-br from-[#0a3d5c]/40 to-[#0d5a8a]/40 text-cyan-100 border-cyan-400/20 hover:border-cyan-400/40"),style:{width:d,height:d,clipPath:"polygon(50px 0%, calc(100% - 50px) 0%, 100% 50px, 100% 100%, calc(100% - 50px) 100%, 50px 100%, 0 100%, 0 0)",transform:`
          translate(-50%, -50%) 
          translateX(${d/1.5*a}px)
          translateY(${h?-65:a%2?15:-15}px)
          rotate(${h?0:a%2?2.5:-2.5}deg)
        `,boxShadow:h?"0px 8px 0px 4px hsl(var(--border))":"0px 0px 0px 0px transparent"},children:[n.jsx("span",{className:"absolute block origin-top-right rotate-45 bg-border",style:{right:-2,top:48,width:joe,height:2}}),n.jsx("img",{src:o.imgSrc,alt:`${o.by.split(",")[0]}`,className:"mb-4 h-14 w-12 bg-muted object-cover object-top",style:{boxShadow:"3px 3px 0px hsl(var(--background))"}}),n.jsxs("h3",{className:Ic("text-base sm:text-xl font-medium",h?"text-white":"text-cyan-100"),children:['"',o.testimonial,'"']}),n.jsxs("p",{className:Ic("absolute bottom-8 left-8 right-8 mt-2 text-sm italic",h?"text-white/80":"text-cyan-100/60"),children:["- ",o.by]})]})},Foe=()=>{const[a,o]=ee.useState(365),[c,d]=ee.useState(Poe),h=p=>{const g=[...c];if(p>0)for(let x=p;x>0;x--){const v=g.shift();if(!v)return;g.push({...v,tempId:Math.random()})}else for(let x=p;x<0;x++){const v=g.pop();if(!v)return;g.unshift({...v,tempId:Math.random()})}d(g)};return ee.useEffect(()=>{const p=()=>{const{matches:g}=window.matchMedia("(min-width: 640px)");o(g?365:290)};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),n.jsxs("div",{className:"relative w-full overflow-hidden bg-muted/30",style:{height:600},children:[c.map((p,g)=>{const x=c.length%2?g-(c.length+1)/2:g-c.length/2;return n.jsx(Uoe,{testimonial:p,handleMove:h,position:x,cardSize:a},p.tempId)}),n.jsxs("div",{className:"absolute bottom-4 left-1/2 flex -translate-x-1/2 gap-2",children:[n.jsx("button",{onClick:()=>h(-1),className:Ic("flex h-14 w-14 items-center justify-center text-2xl transition-colors","bg-background border-2 border-border hover:bg-primary hover:text-primary-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),"aria-label":"Previous testimonial",children:n.jsx(eQ,{})}),n.jsx("button",{onClick:()=>h(1),className:Ic("flex h-14 w-14 items-center justify-center text-2xl transition-colors","bg-background border-2 border-border hover:bg-primary hover:text-primary-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),"aria-label":"Next testimonial",children:n.jsx(Ju,{})})]})]})};function Moe(){const a=ee.useRef(null);return ee.useEffect(()=>{const o=async()=>{const d=(h,p)=>new Promise((g,x)=>{if(window[p]){g();return}if(document.querySelector(`script[src="${h}"]`)){const E=setInterval(()=>{window[p]&&(clearInterval(E),g())},50);setTimeout(()=>{clearInterval(E),x(new Error(`Timeout waiting for ${p}`))},1e4);return}const v=document.createElement("script");v.src=h,v.onload=()=>{setTimeout(()=>g(),100)},v.onerror=()=>x(new Error(`Failed to load ${h}`)),document.head.appendChild(v)});try{await d("https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js","gsap"),await d("https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js","THREE")}catch(h){console.error("Failed to load base scripts:",h)}c()},c=async()=>{const d={settings:{transitionDuration:1.2,autoSlideSpeed:5e3,currentEffect:"glass",currentEffectPreset:"Default",globalIntensity:1,speedMultiplier:1,distortionStrength:1,colorEnhancement:1,glassRefractionStrength:1,glassChromaticAberration:1,glassBubbleClarity:1,glassEdgeGlow:1,glassLiquidFlow:1,frostIntensity:1.5,frostCrystalSize:1,frostIceCoverage:1,frostTemperature:1,frostTexture:1,rippleFrequency:25,rippleAmplitude:.08,rippleWaveSpeed:1,rippleRippleCount:1,rippleDecay:1,plasmaIntensity:1.2,plasmaSpeed:.8,plasmaEnergyIntensity:.4,plasmaContrastBoost:.3,plasmaTurbulence:1,timeshiftDistortion:1.6,timeshiftBlur:1.5,timeshiftFlow:1.4,timeshiftChromatic:1.5,timeshiftTurbulence:1.4}};let h=0,p=!1,g,x,v,E,C=[],I=!1,O=null,R=null,k=!1;const M=()=>d.settings.autoSlideSpeed,P=50,H=()=>d.settings.transitionDuration,$=[{title:"Ai Lab report Analyser",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/AILabReportAnalyser_DesktopSize_3f161f3f-0678-452f-9c1a-a413994df30a.png?v=1770719872",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/AILabReportAnalyser_MobileSize.png?v=1770719520"},{title:"Track Health Parameter",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTracker_jpg.jpg?v=1770722505",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_MobileSize_jpg.jpg?v=1770719520"},{title:"Nutrition Tracker",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_DesktopSize_jpg.jpg?v=1770719871",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTrackerMobile_jpg.jpg?v=1770722504"},{title:"Diet Recommendations",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/WhatsApp_Image_2026-02-07_at_6.44.25_PM.jpg?v=1770707929",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/2150040498_2__jpg.jpg?v=1770722504"},{title:"Supplement Recommendation",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/2150040498_jpg_f6df5fdb-1a8b-4c71-97ec-58643d0dca22.jpg?v=1770722509",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/NutritionTrackerMobile_jpg.jpg?v=1770722504"},{title:"Doctor Recommendation",description:"",media:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/WhatsApp_Image_2026-02-07_at_6.43.52_PM.jpg?v=1770707929",mediaMobile:"https://cdn.shopify.com/s/files/1/0636/5226/6115/files/TrackHealthParameter_MobileSize_jpg.jpg?v=1770719520"}],re="varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",J=`
            uniform sampler2D uTexture1, uTexture2;
            uniform float uProgress;
            uniform vec2 uResolution, uTexture1Size, uTexture2Size;
            uniform int uEffectType;
            uniform float uGlobalIntensity, uSpeedMultiplier, uDistortionStrength, uColorEnhancement;
            uniform float uGlassRefractionStrength, uGlassChromaticAberration, uGlassBubbleClarity, uGlassEdgeGlow, uGlassLiquidFlow;
            uniform float uFrostIntensity, uFrostCrystalSize, uFrostIceCoverage, uFrostTemperature, uFrostTexture;
            uniform float uRippleFrequency, uRippleAmplitude, uRippleWaveSpeed, uRippleRippleCount, uRippleDecay;
            uniform float uPlasmaIntensity, uPlasmaSpeed, uPlasmaEnergyIntensity, uPlasmaContrastBoost, uPlasmaTurbulence;
            uniform float uTimeshiftDistortion, uTimeshiftBlur, uTimeshiftFlow, uTimeshiftChromatic, uTimeshiftTurbulence;
            varying vec2 vUv;

            vec2 getCoverUV(vec2 uv, vec2 textureSize) {
                vec2 s = uResolution / textureSize;
                float scale = max(s.x, s.y);
                vec2 scaledSize = textureSize * scale;
                vec2 offset = (uResolution - scaledSize) * 0.5;
                return (uv * uResolution - offset) / scaledSize;
            }
            float noise(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453); }
            
            vec4 glassEffect(vec2 uv, float progress) {
                float time = progress * 5.0 * uSpeedMultiplier;
                vec2 uv1 = getCoverUV(uv, uTexture1Size); vec2 uv2 = getCoverUV(uv, uTexture2Size);
                float maxR = length(uResolution) * 0.85; float br = progress * maxR;
                vec2 p = uv * uResolution; vec2 c = uResolution * 0.5;
                float d = length(p - c); float nd = d / max(br, 0.001);
                float param = smoothstep(br + 3.0, br - 3.0, d); // Inside circle
                vec4 img;
                if (param > 0.0) {
                     float ro = 0.08 * uGlassRefractionStrength * uDistortionStrength * uGlobalIntensity * pow(smoothstep(0.3 * uGlassBubbleClarity, 1.0, nd), 1.5);
                     vec2 dir = (d > 0.0) ? (p - c) / d : vec2(0.0);
                     vec2 distUV = uv2 - dir * ro;
                     distUV += vec2(sin(time + nd * 10.0), cos(time * 0.8 + nd * 8.0)) * 0.015 * uGlassLiquidFlow * uSpeedMultiplier * nd * param;
                     float ca = 0.02 * uGlassChromaticAberration * uGlobalIntensity * pow(smoothstep(0.3, 1.0, nd), 1.2);
                     img = vec4(texture2D(uTexture2, distUV + dir * ca * 1.2).r, texture2D(uTexture2, distUV + dir * ca * 0.2).g, texture2D(uTexture2, distUV - dir * ca * 0.8).b, 1.0);
                     if (uGlassEdgeGlow > 0.0) {
                        float rim = smoothstep(0.95, 1.0, nd) * (1.0 - smoothstep(1.0, 1.01, nd));
                        img.rgb += rim * 0.08 * uGlassEdgeGlow * uGlobalIntensity;
                     }
                } else { img = texture2D(uTexture2, uv2); }
                vec4 oldImg = texture2D(uTexture1, uv1);
                if (progress > 0.95) img = mix(img, texture2D(uTexture2, uv2), (progress - 0.95) / 0.05);
                return mix(oldImg, img, param);
            }
            // Simplified stubs for other effects (to save space, logic is in glassEffect mainly for demo)
            vec4 frostEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 rippleEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 plasmaEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }
            vec4 timeshiftEffect(vec2 uv, float progress) { return mix(texture2D(uTexture1, getCoverUV(uv, uTexture1Size)), texture2D(uTexture2, getCoverUV(uv, uTexture2Size)), progress); }

            void main() {
                if (uEffectType == 0) gl_FragColor = glassEffect(vUv, uProgress);
                else if (uEffectType == 1) gl_FragColor = frostEffect(vUv, uProgress);
                else if (uEffectType == 2) gl_FragColor = rippleEffect(vUv, uProgress);
                else if (uEffectType == 3) gl_FragColor = plasmaEffect(vUv, uProgress);
                else gl_FragColor = timeshiftEffect(vUv, uProgress);
            }
        `,ge=ue=>({glass:0,frost:1,ripple:2,plasma:3,timeshift:4})[ue]||0,ie=()=>{if(!g)return;const ue=d.settings,Te=g.uniforms;for(const Be in ue){const Ue="u"+Be.charAt(0).toUpperCase()+Be.slice(1);Te[Ue]&&(Te[Ue].value=ue[Be])}Te.uEffectType.value=ge(ue.currentEffect)},we=ue=>ue.split("").map(Te=>`<span style="display: inline-block; opacity: 0;">${Te===" "?"&nbsp;":Te}</span>`).join(""),Ae=ue=>{const Te=document.getElementById("mainTitle"),Be=document.getElementById("mainDesc");Te&&Be&&(gsap.to(Te.children,{y:-20,opacity:0,duration:.5,stagger:.02,ease:"power2.in"}),gsap.to(Be,{y:-10,opacity:0,duration:.4,ease:"power2.in"}),setTimeout(()=>{Te.innerHTML=we($[ue].title),Be.textContent=$[ue].description,gsap.set(Te.children,{opacity:0}),gsap.set(Be,{y:20,opacity:0});const Ue=Te.children;switch(ue){case 0:gsap.set(Ue,{y:20}),gsap.to(Ue,{y:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 1:gsap.set(Ue,{y:-20}),gsap.to(Ue,{y:0,opacity:1,duration:.8,stagger:.03,ease:"back.out(1.7)"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 2:gsap.set(Ue,{filter:"blur(10px)",scale:1.5,y:0}),gsap.to(Ue,{filter:"blur(0px)",scale:1,opacity:1,duration:1,stagger:{amount:.5,from:"random"},ease:"power2.out"}),gsap.to(Be,{y:0,opacity:1,duration:1,delay:.3,ease:"power2.out"});break;case 3:gsap.set(Ue,{scale:0,y:0}),gsap.to(Ue,{scale:1,opacity:1,duration:.6,stagger:.05,ease:"back.out(1.5)"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;case 4:gsap.set(Ue,{rotationX:90,y:0,transformOrigin:"50% 50%"}),gsap.to(Ue,{rotationX:0,opacity:1,duration:.8,stagger:.04,ease:"power2.out"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power2.out"});break;case 5:gsap.set(Ue,{x:30,y:0}),gsap.to(Ue,{x:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"});break;default:gsap.set(Ue,{y:20}),gsap.to(Ue,{y:0,opacity:1,duration:.8,stagger:.03,ease:"power3.out"}),gsap.to(Be,{y:0,opacity:1,duration:.8,delay:.2,ease:"power3.out"})}},500))},V=ue=>{if(p||ue===h)return;Z(),Ce(h);const Te=C[h],Be=C[ue];!Te||!Be||(p=!0,g.uniforms.uTexture1.value=Te,g.uniforms.uTexture2.value=Be,g.uniforms.uTexture1Size.value=Te.userData.size,g.uniforms.uTexture2Size.value=Be.userData.size,Ae(ue),h=ue,he(h),z(h),gsap.fromTo(g.uniforms.uProgress,{value:0},{value:1,duration:H(),ease:"power2.inOut",onComplete:()=>{g.uniforms.uProgress.value=0,g.uniforms.uTexture1.value=Be,g.uniforms.uTexture1Size.value=Be.userData.size,p=!1,Ie(100)}}))},ce=()=>{p||!I||!k||V((h+1)%$.length)},Y=()=>{const ue=document.getElementById("slidesNav");ue&&(ue.children.length>0||$.forEach((Te,Be)=>{const Ue=document.createElement("div");Ue.className=`slide-nav-item${Be===0?" active":""}`,Ue.dataset.slideIndex=String(Be),Ue.innerHTML=`<div class="slide-progress-line"><div class="slide-progress-fill"></div></div><div class="slide-nav-title">${Te.title}</div>`,Ue.addEventListener("click",tt=>{tt.stopPropagation(),!p&&Be!==h&&(Z(),Ce(h),V(Be))}),ue.appendChild(Ue)}))},z=ue=>document.querySelectorAll(".slide-nav-item").forEach((Te,Be)=>Te.classList.toggle("active",Be===ue)),te=(ue,Te)=>{var Ue;const Be=(Ue=document.querySelectorAll(".slide-nav-item")[ue])==null?void 0:Ue.querySelector(".slide-progress-fill");Be&&(Be.style.width=`${Te}%`,Be.style.opacity="1")},se=ue=>{var Be;const Te=(Be=document.querySelectorAll(".slide-nav-item")[ue])==null?void 0:Be.querySelector(".slide-progress-fill");Te&&(Te.style.opacity="0",setTimeout(()=>Te.style.width="0%",300))},Ce=ue=>{var Be;const Te=(Be=document.querySelectorAll(".slide-nav-item")[ue])==null?void 0:Be.querySelector(".slide-progress-fill");Te&&(Te.style.transition="width 0.2s ease-out",Te.style.width="0%",setTimeout(()=>Te.style.transition="width 0.1s ease, opacity 0.3s ease",200))},he=ue=>{const Te=document.getElementById("slideNumber");Te&&(Te.textContent=String(ue+1).padStart(2,"0"));const Be=document.getElementById("slideTotal");Be&&(Be.textContent=String($.length).padStart(2,"0"))},Ne=()=>{if(!I||!k||p)return;Z();let ue=0;const Te=100/M()*P;R=setInterval(()=>{if(!k||p){Z();return}ue+=Te,te(h,ue),ue>=100&&(clearInterval(R),R=null,se(h),p||ce())},P)},Z=()=>{R&&clearInterval(R),O&&clearTimeout(O),R=null,O=null},Ie=(ue=0)=>{Z(),k&&I&&(ue>0?O=setTimeout(Ne,ue):Ne())},Ve=ue=>new Promise((Te,Be)=>{new THREE.TextureLoader().load(ue,tt=>{tt.minFilter=tt.magFilter=THREE.LinearFilter,tt.userData={size:new THREE.Vector2(tt.image.width,tt.image.height)},Te(tt)},void 0,Be)}),Pe=async()=>{var Ue;const ue=document.querySelector(".webgl-canvas");if(!ue)return;v=new THREE.Scene,E=new THREE.OrthographicCamera(-1,1,1,-1,0,1),x=new THREE.WebGLRenderer({canvas:ue,antialias:!1,alpha:!1}),x.setSize(window.innerWidth,window.innerHeight),x.setPixelRatio(Math.min(window.devicePixelRatio,2)),g=new THREE.ShaderMaterial({uniforms:{uTexture1:{value:null},uTexture2:{value:null},uProgress:{value:0},uResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},uTexture1Size:{value:new THREE.Vector2(1,1)},uTexture2Size:{value:new THREE.Vector2(1,1)},uEffectType:{value:0},uGlobalIntensity:{value:1},uSpeedMultiplier:{value:1},uDistortionStrength:{value:1},uColorEnhancement:{value:1},uGlassRefractionStrength:{value:1},uGlassChromaticAberration:{value:1},uGlassBubbleClarity:{value:1},uGlassEdgeGlow:{value:1},uGlassLiquidFlow:{value:1},uFrostIntensity:{value:1},uFrostCrystalSize:{value:1},uFrostIceCoverage:{value:1},uFrostTemperature:{value:1},uFrostTexture:{value:1},uRippleFrequency:{value:25},uRippleAmplitude:{value:.08},uRippleWaveSpeed:{value:1},uRippleRippleCount:{value:1},uRippleDecay:{value:1},uPlasmaIntensity:{value:1.2},uPlasmaSpeed:{value:.8},uPlasmaEnergyIntensity:{value:.4},uPlasmaContrastBoost:{value:.3},uPlasmaTurbulence:{value:1},uTimeshiftDistortion:{value:1.6},uTimeshiftBlur:{value:1.5},uTimeshiftFlow:{value:1.4},uTimeshiftChromatic:{value:1.5},uTimeshiftTurbulence:{value:1.4}},vertexShader:re,fragmentShader:J}),v.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),g));const Te=window.innerWidth<=768;for(const tt of $)try{const ot=Te&&tt.mediaMobile||tt.media;C.push(await Ve(ot))}catch{console.warn("Failed texture")}C.length>=2&&(g.uniforms.uTexture1.value=C[0],g.uniforms.uTexture2.value=C[1],g.uniforms.uTexture1Size.value=C[0].userData.size,g.uniforms.uTexture2Size.value=C[1].userData.size,I=!0,k=!0,ie(),(Ue=document.querySelector(".slider-wrapper"))==null||Ue.classList.add("loaded"),Ie(500));const Be=()=>{requestAnimationFrame(Be),x.render(v,E)};Be()};Y(),he(0);const ne=document.getElementById("mainTitle"),ve=document.getElementById("mainDesc");ne&&ve&&(ne.innerHTML=we($[0].title),ve.textContent=$[0].description,gsap.fromTo(ne.children,{y:20,opacity:0},{y:0,opacity:1,duration:1,stagger:.03,ease:"power3.out",delay:.5}),gsap.fromTo(ve,{y:20,opacity:0},{y:0,opacity:1,duration:1,ease:"power3.out",delay:.8})),Pe(),document.addEventListener("visibilitychange",()=>document.hidden?Z():!p&&Ie()),window.addEventListener("resize",()=>{x&&(x.setSize(window.innerWidth,window.innerHeight),g.uniforms.uResolution.value.set(window.innerWidth,window.innerHeight))})};return o(),()=>{}},[]),n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
        .slider-wrapper {
          position: relative;
          width: 100%;
          height: 100vh;
          overflow: hidden;
          background: transparent;
          border-radius: 1.5rem;
        }

        .webgl-canvas {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border-radius: 1.5rem;
        }

        /* Slide Numbers - Left and Right */
        .slide-number, .slide-total {
          position: absolute;
          font-size: 2rem;
          font-weight: 300;
          color: rgba(255, 255, 255, 0.6);
          z-index: 10;
          letter-spacing: 2px;
        }

        .slide-number {
          top: 50%;
          left: 2rem;
          transform: translateY(-50%);
        }

        .slide-total {
          top: 50%;
          right: 2rem;
          transform: translateY(-50%);
        }

        /* Center Content */
        .slide-content {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          z-index: 5;
          width: 80%;
          max-width: 800px;
        }

        .slide-title {
          font-size: 2.5rem;
          font-weight: 300;
          color: white;
          margin: 0;
          margin-bottom: 1rem;
          letter-spacing: 2px;
          line-height: 1.2;
        }

        .slide-description {
          font-size: 1.1rem;
          color: rgba(255, 255, 255, 0.8);
          margin: 0;
          letter-spacing: 0.5px;
          line-height: 1.6;
        }

        /* Navigation at bottom */
        .slides-navigation {
          position: absolute;
          bottom: 2rem;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 2rem;
          z-index: 10;
          width: 90%;
          max-width: 1200px;
          justify-content: center;
          flex-wrap: nowrap;
          overflow-x: hidden;
        }

        .slide-nav-item {
          cursor: pointer;
          position: relative;
          padding-bottom: 0.5rem;
          transition: all 0.3s ease;
        }

        .slide-nav-title {
          font-size: 0.9rem;
          color: rgba(255, 255, 255, 0.6);
          letter-spacing: 1px;
          text-transform: uppercase;
          transition: color 0.3s ease;
        }

        .slide-nav-item.active .slide-nav-title {
          color: rgba(255, 255, 255, 1);
        }

        .slide-progress-line {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 1px;
          background: rgba(255, 255, 255, 0.2);
        }

        .slide-progress-fill {
          height: 100%;
          background: rgba(255, 255, 255, 0.8);
          width: 0%;
          transition: width 0.1s ease, opacity 0.3s ease;
          opacity: 0;
        }

        .slider-wrapper.loaded {
          opacity: 1;
        }

        @media (max-width: 768px) {
          .slide-title {
            font-size: 1.8rem;
          }

          .slide-description {
            font-size: 0.9rem;
          }

          .slide-number, .slide-total {
            font-size: 1.2rem;
            top: 1.5rem;
          }

          .slide-number {
            left: 1.5rem;
            transform: none;
          }

          .slide-total {
            right: 1.5rem;
            transform: none;
          }

          .slides-navigation {
            bottom: 1rem;
            gap: 0.5rem;
            width: 95%;
            max-width: 100%;
            flex-wrap: wrap;
            justify-content: center;
          }

          .slide-nav-item {
            flex: 0 1 calc(50% - 0.25rem);
            min-width: 0;
          }

          .slide-nav-title {
            font-size: 0.7rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .slide-content {
            width: 90%;
          }
        }
      `}),n.jsxs("main",{className:"slider-wrapper",ref:a,children:[n.jsx("canvas",{className:"webgl-canvas"}),n.jsx("span",{className:"slide-number",id:"slideNumber",children:"01"}),n.jsx("span",{className:"slide-total",id:"slideTotal",children:"06"}),n.jsx("div",{className:"slide-content",children:n.jsx("p",{className:"slide-description",id:"mainDesc"})}),n.jsx("nav",{className:"slides-navigation",id:"slidesNav"})]})]})}const m6=a=>typeof a=="boolean"?`${a}`:a===0?"0":a,f6=ZV,aH=(a,o)=>c=>{var d;if((o==null?void 0:o.variants)==null)return f6(a,c==null?void 0:c.class,c==null?void 0:c.className);const{variants:h,defaultVariants:p}=o,g=Object.keys(h).map(E=>{const C=c==null?void 0:c[E],I=p==null?void 0:p[E];if(C===null)return null;const O=m6(C)||m6(I);return h[E][O]}),x=c&&Object.entries(c).reduce((E,C)=>{let[I,O]=C;return O===void 0||(E[I]=O),E},{}),v=o==null||(d=o.compoundVariants)===null||d===void 0?void 0:d.reduce((E,C)=>{let{class:I,className:O,...R}=C;return Object.entries(R).every(k=>{let[M,P]=k;return Array.isArray(P)?P.includes({...p,...x}[M]):{...p,...x}[M]===P})?[...E,I,O]:E},[]);return f6(a,g,v,c==null?void 0:c.class,c==null?void 0:c.className)},Voe=aH("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function g6({className:a,variant:o,...c}){return n.jsx("div",{className:Ic(Voe({variant:o}),a),...c})}function b6(a,o){if(typeof a=="function")return a(o);a!=null&&(a.current=o)}function Qoe(...a){return o=>{let c=!1;const d=a.map(h=>{const p=b6(h,o);return!c&&typeof p=="function"&&(c=!0),p});if(c)return()=>{for(let h=0;h<d.length;h++){const p=d[h];typeof p=="function"?p():b6(a[h],null)}}}}var Hoe=Symbol.for("react.lazy"),Fy=Ire[" use ".trim().toString()];function Goe(a){return typeof a=="object"&&a!==null&&"then"in a}function oH(a){return a!=null&&typeof a=="object"&&"$$typeof"in a&&a.$$typeof===Hoe&&"_payload"in a&&Goe(a._payload)}function Koe(a){const o=zoe(a),c=ee.forwardRef((d,h)=>{let{children:p,...g}=d;oH(p)&&typeof Fy=="function"&&(p=Fy(p._payload));const x=ee.Children.toArray(p),v=x.find(Yoe);if(v){const E=v.props.children,C=x.map(I=>I===v?ee.Children.count(E)>1?ee.Children.only(null):ee.isValidElement(E)?E.props.children:null:I);return n.jsx(o,{...g,ref:h,children:ee.isValidElement(E)?ee.cloneElement(E,void 0,C):null})}return n.jsx(o,{...g,ref:h,children:p})});return c.displayName=`${a}.Slot`,c}var Woe=Koe("Slot");function zoe(a){const o=ee.forwardRef((c,d)=>{let{children:h,...p}=c;if(oH(h)&&typeof Fy=="function"&&(h=Fy(h._payload)),ee.isValidElement(h)){const g=Joe(h),x=Xoe(p,h.props);return h.type!==ee.Fragment&&(x.ref=d?Qoe(d,g):g),ee.cloneElement(h,x)}return ee.Children.count(h)>1?ee.Children.only(null):null});return o.displayName=`${a}.SlotClone`,o}var qoe=Symbol("radix.slottable");function Yoe(a){return ee.isValidElement(a)&&typeof a.type=="function"&&"__radixId"in a.type&&a.type.__radixId===qoe}function Xoe(a,o){const c={...o};for(const d in o){const h=a[d],p=o[d];/^on[A-Z]/.test(d)?h&&p?c[d]=(...x)=>{const v=p(...x);return h(...x),v}:h&&(c[d]=h):d==="style"?c[d]={...h,...p}:d==="className"&&(c[d]=[h,p].filter(Boolean).join(" "))}return{...a,...c}}function Joe(a){var d,h;let o=(d=Object.getOwnPropertyDescriptor(a.props,"ref"))==null?void 0:d.get,c=o&&"isReactWarning"in o&&o.isReactWarning;return c?a.ref:(o=(h=Object.getOwnPropertyDescriptor(a,"ref"))==null?void 0:h.get,c=o&&"isReactWarning"in o&&o.isReactWarning,c?a.props.ref:a.props.ref||a.ref)}const $oe=aH("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),sR=ee.forwardRef(({className:a,variant:o,size:c,asChild:d=!1,...h},p)=>{const g=d?Woe:"button";return n.jsx(g,{className:Ic($oe({variant:o,size:c,className:a})),ref:p,...h})});sR.displayName="Button";const rR=ee.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:Ic("rounded-lg border bg-card text-card-foreground shadow-sm",a),...o}));rR.displayName="Card";const nR=ee.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:Ic("flex flex-col space-y-1.5 p-6",a),...o}));nR.displayName="CardHeader";const iR=ee.forwardRef(({className:a,...o},c)=>n.jsx("h3",{ref:c,className:Ic("text-2xl font-semibold leading-none tracking-tight",a),...o}));iR.displayName="CardTitle";const Zoe=ee.forwardRef(({className:a,...o},c)=>n.jsx("p",{ref:c,className:Ic("text-sm text-muted-foreground",a),...o}));Zoe.displayName="CardDescription";const aR=ee.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:Ic("p-6 pt-0",a),...o}));aR.displayName="CardContent";const ece=ee.forwardRef(({className:a,...o},c)=>n.jsx("div",{ref:c,className:Ic("flex items-center p-6 pt-0",a),...o}));ece.displayName="CardFooter";function tce({timelineData:a}){const[o,c]=ee.useState({}),[d,h]=ee.useState("orbital"),[p,g]=ee.useState(0),[x,v]=ee.useState(!0),[E,C]=ee.useState({}),[I,O]=ee.useState({x:0,y:0}),[R,k]=ee.useState(null),M=ee.useRef(null),P=ee.useRef(null),H=ee.useRef({}),$=V=>{(V.target===M.current||V.target===P.current)&&(c({}),k(null),C({}),v(!0))},re=V=>{c(ce=>{const Y={...ce};if(Object.keys(Y).forEach(z=>{parseInt(z)!==V&&(Y[parseInt(z)]=!1)}),Y[V]=!ce[V],ce[V])k(null),v(!0),C({});else{k(V),v(!1);const z=ie(V),te={};z.forEach(se=>{te[se]=!0}),C(te),J(V)}return Y})};ee.useEffect(()=>{let V;return x&&d==="orbital"&&(V=setInterval(()=>{g(ce=>(ce+.5)%360)},30)),()=>{V&&clearInterval(V)}},[x,d]);const J=V=>{if(d!=="orbital"||!H.current[V])return;const ce=a.findIndex(te=>te.id===V),Y=a.length,z=ce/Y*360;g(270-z)},ge=(V,ce)=>{const Y=(V/ce*360+p)%360,te=typeof window<"u"&&window.innerWidth<1024?160:200,se=Y*Math.PI/180,Ce=te*Math.cos(se)+I.x,he=te*Math.sin(se)+I.y,Ne=Math.round(100+50*Math.cos(se)),Z=Math.max(.4,Math.min(1,.4+.6*((1+Math.sin(se))/2)));return{x:Ce,y:he,angle:Y,zIndex:Ne,opacity:Z}},ie=V=>{const ce=a.find(Y=>Y.id===V);return ce?ce.relatedIds:[]},we=V=>R?ie(R).includes(V):!1,Ae=V=>{switch(V){case"completed":return"text-white bg-black border-white";case"in-progress":return"text-black bg-white border-black";case"pending":return"text-white bg-black/40 border-white/50";default:return"text-white bg-black/40 border-white/50"}};return n.jsx("div",{className:"w-full py-20 md:py-32 bg-gradient-to-b from-transparent via-transparent to-transparent overflow-hidden",ref:M,onClick:$,children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"hidden md:block text-center max-w-3xl mx-auto mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),n.jsx("span",{className:"text-sm uppercase tracking-wider text-cyan-300 font-medium",children:"Platform Features"})]}),n.jsx("h2",{className:"text-3xl md:text-5xl font-bold text-white mb-6",children:"Five Core Features That Power HealthAI"}),n.jsx("p",{className:"text-lg text-cyan-100",children:"Discover the essential capabilities that make intelligent health management possible"})]}),n.jsxs("div",{className:"hidden lg:flex items-center justify-center gap-16 h-[600px]",children:[n.jsx("div",{className:"flex-1 flex flex-col justify-center",children:n.jsx("p",{className:"text-6xl md:text-7xl font-serif font-bold text-white leading-tight",children:"Transform Your Health With Advanced AI Intelligence and Insights"})}),n.jsx("div",{className:"flex-1 h-full relative rounded-3xl overflow-visible bg-gradient-to-br from-[#0a3d5c] via-[#0d5a8a] to-[#051f2e] border border-cyan-400/20 shadow-2xl shadow-cyan-600/20",children:n.jsxs("div",{className:"absolute w-full h-full flex items-center justify-center z-10",ref:P,style:{perspective:"1000px",transform:`translate(${I.x}px, ${I.y}px)`},children:[n.jsxs("div",{className:"absolute w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 via-blue-500 to-teal-500 animate-pulse flex items-center justify-center z-50",children:[n.jsx("div",{className:"absolute w-20 h-20 rounded-full border-2 border-white/30 animate-ping opacity-70"}),n.jsx("div",{className:"absolute w-24 h-24 rounded-full border-2 border-white/20 animate-ping opacity-50",style:{animationDelay:"0.5s"}}),n.jsx("div",{className:"w-8 h-8 rounded-full bg-white/90 backdrop-blur-md shadow-lg shadow-white/50"})]}),n.jsx("div",{className:"absolute w-96 h-96 rounded-full border border-white/10"}),a.map((V,ce)=>{const Y=ge(ce,a.length),z=o[V.id],te=we(V.id),se=E[V.id],Ce=V.icon,he={transform:`translate(${Y.x}px, ${Y.y}px)`,zIndex:z?200:Y.zIndex,opacity:z?1:Y.opacity};return n.jsxs("div",{ref:Ne=>H.current[V.id]=Ne,className:"absolute transition-all duration-700 cursor-pointer",style:he,onClick:Ne=>{Ne.stopPropagation(),re(V.id)},children:[n.jsx("div",{className:`absolute rounded-full -inset-1 ${se?"animate-pulse duration-1000":""}`,style:{background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%)",width:`${V.energy*.5+40}px`,height:`${V.energy*.5+40}px`,left:`-${(V.energy*.5+40-40)/2}px`,top:`-${(V.energy*.5+40-40)/2}px`}}),n.jsx("div",{className:`
                  w-10 h-10 rounded-full flex items-center justify-center
                  bg-transparent text-white
                  border-2 
                  ${z?"border-white shadow-lg shadow-white/30":te?"border-white animate-pulse":"border-white"}
                  transition-all duration-300 transform
                  ${z?"scale-150":""}
                `,children:n.jsx(Ce,{size:16})}),n.jsx("div",{className:`
                  absolute top-12  whitespace-nowrap
                  text-xs font-semibold tracking-wider
                  transition-all duration-300
                  ${z?"text-white scale-125":"text-white"}
                `,children:V.title}),z&&n.jsxs(rR,{className:"absolute top-14 left-1/2 -translate-x-1/2 w-48 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] backdrop-blur-lg border-cyan-500/50 shadow-xl shadow-cyan-500/20 overflow-visible z-50",children:[n.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-px h-1.5 bg-cyan-400/70"}),n.jsxs(nR,{className:"pb-1.5 pt-3 px-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[n.jsx(g6,{className:`px-1.5 text-xs font-semibold ${Ae(V.status)}`,children:V.status==="completed"?" COMPLETE":V.status==="in-progress"?" IN PROGRESS":" PENDING"}),n.jsx("span",{className:"text-xs font-mono text-cyan-300/70",children:V.date})]}),n.jsx(iR,{className:"text-xs text-white mt-0.5",children:V.title})]}),n.jsxs(aR,{className:"text-xs text-cyan-100/90 space-y-1.5 px-3 pb-2",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-0.5 text-xs",children:" Overview"}),n.jsx("p",{className:"text-cyan-100/80 text-xs leading-tight",children:V.content})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-1 text-xs",children:" Key Features"}),n.jsxs("div",{className:"space-y-0.5",children:[V.id===1&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Comprehensive health data collection"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User needs and pain points analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Feature prioritization framework"})]})]}),V.id===2&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Scalable microservices architecture"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"AI/ML pipeline integration"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Secure data storage design"})]})]}),V.id===3&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Claude AI integration for analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Real-time report processing"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Multi-language support"})]})]}),V.id===4&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Automated test suite coverage"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Performance optimization"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Security vulnerability scanning"})]})]}),V.id===5&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Production deployment pipeline"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"24/7 monitoring and alerts"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User onboarding and support"})]})]})]})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex justify-between items-center text-xs mb-0.5",children:[n.jsxs("span",{className:"flex items-center text-cyan-300",children:[n.jsx(td,{size:9,className:"mr-0.5"}),"Progress"]}),n.jsxs("span",{className:"font-mono text-cyan-400 text-xs",children:[V.energy,"%"]})]}),n.jsx("div",{className:"w-full h-1 bg-cyan-900/50 rounded-full overflow-hidden border border-cyan-500/30",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400",style:{width:`${V.energy}%`}})})]}),V.relatedIds.length>0&&n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex items-center mb-0.5",children:[n.jsx(V3,{size:9,className:"text-cyan-400 mr-0.5"}),n.jsx("h4",{className:"text-xs uppercase tracking-wider font-semibold text-cyan-300",children:"Related Phases"})]}),n.jsx("div",{className:"flex flex-wrap gap-1",children:V.relatedIds.map(Ne=>{const Z=a.find(Ie=>Ie.id===Ne);return n.jsxs(sR,{variant:"outline",size:"sm",className:"flex items-center h-5 px-1 py-0 text-xs rounded-md border-cyan-500/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-300 hover:text-cyan-200 transition-all",onClick:Ie=>{Ie.stopPropagation(),re(Ne)},children:[Z==null?void 0:Z.title,n.jsx(To,{size:7,className:"ml-0.5 text-cyan-400/60"})]},Ne)})})]})]})]})]},V.id)})]})})]}),n.jsx("div",{className:"lg:hidden h-auto py-4 flex flex-col items-center justify-center",children:n.jsxs("div",{className:"relative w-full h-[480px] flex items-center justify-center rounded-2xl overflow-visible",style:{background:"linear-gradient(135deg, rgba(10, 61, 92, 0.4) 0%, rgba(13, 90, 138, 0.4) 100%)"},children:[n.jsx("div",{className:"absolute inset-0 rounded-2xl border border-cyan-500/30"}),n.jsxs("div",{className:"absolute w-full h-full flex items-center justify-center",ref:P,style:{perspective:"1000px",transform:`translate(${I.x}px, ${I.y}px)`},children:[n.jsxs("div",{className:"absolute w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 via-blue-500 to-teal-500 animate-pulse flex items-center justify-center z-50",children:[n.jsx("div",{className:"absolute w-20 h-20 rounded-full border-2 border-white/30 animate-ping opacity-70"}),n.jsx("div",{className:"absolute w-24 h-24 rounded-full border-2 border-white/20 animate-ping opacity-50",style:{animationDelay:"0.5s"}}),n.jsx("div",{className:"w-8 h-8 rounded-full bg-white/90 backdrop-blur-md shadow-lg shadow-white/50"})]}),n.jsx("div",{className:"absolute w-96 h-96 rounded-full border border-white/10"}),a.map((V,ce)=>{const Y=ge(ce,a.length),z=o[V.id],te=we(V.id),se=E[V.id],Ce=V.icon,he={transform:`translate(${Y.x}px, ${Y.y}px)`,zIndex:z?200:Y.zIndex,opacity:z?1:Y.opacity};return n.jsxs("div",{ref:Ne=>H.current[V.id]=Ne,className:"absolute transition-all duration-700 cursor-pointer",style:he,onClick:Ne=>{Ne.stopPropagation(),re(V.id)},children:[n.jsx("div",{className:`absolute rounded-full -inset-1 ${se?"animate-pulse duration-1000":""}`,style:{background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%)",width:`${V.energy*.5+40}px`,height:`${V.energy*.5+40}px`,left:`-${(V.energy*.5+40-40)/2}px`,top:`-${(V.energy*.5+40-40)/2}px`}}),n.jsx("div",{className:`
                      w-10 h-10 rounded-full flex items-center justify-center
                      bg-transparent text-white
                      border-2 
                      ${z?"border-white shadow-lg shadow-white/30":te?"border-white animate-pulse":"border-white"}
                      transition-all duration-300 transform
                      ${z?"scale-150":""}
                    `,children:n.jsx(Ce,{size:16})}),n.jsx("div",{className:`
                      absolute top-12  whitespace-nowrap
                      text-xs font-semibold tracking-wider
                      transition-all duration-300
                      ${z?"text-white scale-125":"text-white"}
                    `,children:V.title}),z&&n.jsxs(rR,{className:"absolute top-14 left-1/2 -translate-x-1/2 w-48 bg-gradient-to-br from-[#0a3d5c] to-[#0d5a8a] backdrop-blur-lg border-cyan-500/50 shadow-xl shadow-cyan-500/20 overflow-visible z-50",children:[n.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-px h-1.5 bg-cyan-400/70"}),n.jsxs(nR,{className:"pb-1.5 pt-3 px-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[n.jsx(g6,{className:`px-1.5 text-xs font-semibold ${Ae(V.status)}`,children:V.status==="completed"?" COMPLETE":V.status==="in-progress"?" IN PROGRESS":" PENDING"}),n.jsx("span",{className:"text-xs font-mono text-cyan-300/70",children:V.date})]}),n.jsx(iR,{className:"text-xs text-white mt-0.5",children:V.title})]}),n.jsxs(aR,{className:"text-xs text-cyan-100/90 space-y-1.5 px-3 pb-2",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-0.5 text-xs",children:" Overview"}),n.jsx("p",{className:"text-cyan-100/80 text-xs leading-tight",children:V.content})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsx("h4",{className:"text-cyan-300 font-semibold mb-1 text-xs",children:" Key Features"}),n.jsxs("div",{className:"space-y-0.5",children:[V.id===1&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Comprehensive health data collection"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User needs and pain points analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Feature prioritization framework"})]})]}),V.id===2&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Scalable microservices architecture"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"AI/ML pipeline integration"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Secure data storage design"})]})]}),V.id===3&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Claude AI integration for analysis"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Real-time report processing"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Multi-language support"})]})]}),V.id===4&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Automated test suite coverage"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Performance optimization"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Security vulnerability scanning"})]})]}),V.id===5&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"Production deployment pipeline"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"24/7 monitoring and alerts"})]}),n.jsxs("div",{className:"flex gap-1.5 text-xs",children:[n.jsx("span",{className:"text-cyan-400 flex-shrink-0",children:""}),n.jsx("span",{children:"User onboarding and support"})]})]})]})]}),n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex justify-between items-center text-xs mb-0.5",children:[n.jsxs("span",{className:"flex items-center text-cyan-300",children:[n.jsx(td,{size:9,className:"mr-0.5"}),"Progress"]}),n.jsxs("span",{className:"font-mono text-cyan-400 text-xs",children:[V.energy,"%"]})]}),n.jsx("div",{className:"w-full h-1 bg-cyan-900/50 rounded-full overflow-hidden border border-cyan-500/30",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-cyan-400",style:{width:`${V.energy}%`}})})]}),V.relatedIds.length>0&&n.jsxs("div",{className:"pt-1.5 border-t border-cyan-500/30",children:[n.jsxs("div",{className:"flex items-center mb-0.5",children:[n.jsx(V3,{size:9,className:"text-cyan-400 mr-0.5"}),n.jsx("h4",{className:"text-xs uppercase tracking-wider font-semibold text-cyan-300",children:"Related Phases"})]}),n.jsx("div",{className:"flex flex-wrap gap-1",children:V.relatedIds.map(Ne=>{const Z=a.find(Ie=>Ie.id===Ne);return n.jsxs(sR,{variant:"outline",size:"sm",className:"flex items-center h-5 px-1 py-0 text-xs rounded-md border-cyan-500/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-300 hover:text-cyan-200 transition-all",onClick:Ie=>{Ie.stopPropagation(),re(Ne)},children:[Z==null?void 0:Z.title,n.jsx(To,{size:7,className:"ml-0.5 text-cyan-400/60"})]},Ne)})})]})]})]})]},V.id)})]})]})})]})})}const sce=[{id:1,title:"AI Analysis",date:"Real-time",content:"Advanced AI-powered analysis of your medical reports to identify health patterns and risks.",category:"Feature",icon:qR,relatedIds:[2,3],status:"completed",energy:100},{id:2,title:"Health Tracking",date:"24/7",content:"Continuous monitoring of your health metrics with smart alerts and personalized recommendations.",category:"Feature",icon:Ca,relatedIds:[1,4],status:"completed",energy:95},{id:3,title:"Doctor Network",date:"Verified",content:"Connect with verified healthcare professionals recommended based on your specific health needs.",category:"Feature",icon:yg,relatedIds:[1,5],status:"completed",energy:90},{id:4,title:"Nutrition Plans",date:"Personalized",content:"Get customized nutrition plans and supplement recommendations based on your health profile.",category:"Feature",icon:lh,relatedIds:[2,5],status:"completed",energy:85},{id:5,title:"Report Upload",date:"Instant",content:"Upload your medical reports and get instant AI-powered analysis with actionable insights.",category:"Feature",icon:lo,relatedIds:[3,4],status:"completed",energy:100}];function rce(){const[a,o]=ee.useState(0),c=[{question:"What types of health reports can I upload?",answer:"FitCure supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return n.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-transparent",children:n.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),n.jsx("span",{className:"text-sm uppercase tracking-wider text-cyan-300 font-medium",children:"FAQ"})]}),n.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Got questions?"}),n.jsx("p",{className:"text-lg text-cyan-100",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),n.jsx("div",{className:"space-y-4",children:c.map((d,h)=>n.jsxs("div",{className:"border border-cyan-500/30 rounded-xl overflow-hidden bg-white/5 backdrop-blur-sm hover:bg-white/10 transition-colors",children:[n.jsxs("button",{onClick:()=>o(a===h?null:h),className:"w-full flex items-center justify-between p-6 text-left",children:[n.jsx("span",{className:"text-lg font-medium text-white pr-4",children:d.question}),n.jsx(uh,{className:`w-5 h-5 text-cyan-300 shrink-0 transition-transform duration-200 ${a===h?"rotate-180":""}`})]}),n.jsx("div",{className:`overflow-hidden transition-all duration-200 ${a===h?"max-h-96":"max-h-0"}`,children:n.jsx("p",{className:"px-6 pb-6 text-cyan-100 leading-relaxed",children:d.answer})})]},h))})]})})}function nce(){return n.jsx("section",{className:"py-20 md:py-32 bg-transparent",children:n.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[n.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Ready to transform your health with AI?"}),n.jsx("p",{className:"text-lg text-cyan-100 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[n.jsxs(Hs,{to:"/register?skip=true",className:"bg-white text-[#8B7355] hover:bg-[#F5F1EA] rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2 shadow-lg",children:["Start your free analysis",n.jsx(To,{className:"w-5 h-5"})]}),n.jsx(Hs,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border-2 border-white/40 text-white hover:bg-white/10 bg-transparent transition-all backdrop-blur-sm",children:"Talk to our team"})]}),n.jsx("p",{className:"text-sm text-white/80 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function ice(){return n.jsx("footer",{className:"bg-gradient-to-b from-[#0a3d5c] to-[#051f2e] text-white py-16",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[n.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"w-8 h-8 bg-[#8B7355] rounded-xl flex items-center justify-center",children:n.jsx(br,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:"font-serif text-xl",children:"FitCure"})]}),n.jsx("p",{className:"text-white/60 text-sm mb-4",children:"AI-powered health insights for better living."})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Features"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Pricing"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Mobile App"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"API"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"About"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Blog"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Careers"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Press"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Help Center"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Health Guides"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Find a Doctor"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),n.jsxs("ul",{className:"space-y-3 text-sm",children:[n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Privacy Policy"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Terms of Service"})}),n.jsx("li",{children:n.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),n.jsx("div",{className:"pt-8 border-t border-white/10 flex flex-col md:flex-row items-center justify-between gap-4",children:n.jsx("p",{className:"text-sm text-white/60",children:" 2026 FitCure. All rights reserved."})})]})})}function ace(){return n.jsxs("div",{className:"min-h-screen bg-transparent",children:[n.jsx(Hae,{}),n.jsx(Gae,{}),n.jsx(Kae,{}),n.jsx(Wae,{}),n.jsx(Moe,{}),n.jsx(tce,{timelineData:sce}),n.jsx(zae,{}),n.jsx(Foe,{}),n.jsx(rce,{}),n.jsx(nce,{}),n.jsx(ice,{})]})}function oce(){const[a,o]=ee.useState(""),[c,d]=ee.useState(""),[h,p]=ee.useState(!1),[g,x]=ee.useState(!1),{login:v}=da(),E=Ha(),C=async I=>{var O,R,k;I.preventDefault(),x(!0);try{const M=await v(a,c);St.success("Welcome back!"),E(M.role==="admin"?"/admin":M.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(M){const P=((R=(O=M.response)==null?void 0:O.data)==null?void 0:R.message)||M.message||"Login failed";M.response?St.error(P):(St.error("Network error - Check if server is running and accessible"),console.error("Connection details:",{apiUrl:(k=M.config)==null?void 0:k.baseURL,host:window.location.hostname,port:window.location.port}))}finally{x(!1)}};return n.jsxs("div",{className:"min-h-screen flex bg-white",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-black",children:[n.jsxs("div",{className:"absolute inset-0 opacity-20",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-[#2FC8B9] rounded-full blur-[120px]"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-[#2FC8B9] rounded-full blur-[120px]"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center w-full p-12 text-white",children:[n.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:n.jsx(br,{className:"w-10 h-10 text-[#2FC8B9]"})}),n.jsx("h1",{className:"text-4xl font-black mb-4 text-center tracking-tighter uppercase",children:"Elite Health Portal"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900",children:"Sign In"}),n.jsx("p",{className:"text-gray-600",children:"Access your health dashboard"})]}),n.jsxs("form",{onSubmit:C,className:"space-y-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(aE,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"email",value:a,onChange:I=>o(I.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-[#2FC8B9]/30 focus:border-[#2FC8B9] text-black font-bold",placeholder:"you@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Zb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:h?"text":"password",value:c,onChange:I=>d(I.target.value),className:"w-full bg-slate-50 border border-slate-100 rounded-xl py-3 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-[#2FC8B9]/30 focus:border-[#2FC8B9] text-black font-bold",placeholder:"",required:!0}),n.jsx("button",{type:"button",onClick:()=>p(!h),className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:h?n.jsx(tQ,{className:"w-5 h-5"}):n.jsx(zp,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-cyan-500 focus:ring-cyan-500"}),n.jsx("span",{className:"text-sm text-gray-600",children:"Remember me"})]}),n.jsx("a",{href:"#",className:"text-sm font-medium text-cyan-600 hover:text-cyan-700",children:"Forgot password?"})]}),n.jsx("button",{type:"submit",disabled:g,className:"w-full py-4 text-white font-black uppercase tracking-widest rounded-xl hover:shadow-[0_10px_25px_rgba(47,200,185,0.3)] transition-all flex items-center justify-center gap-2 disabled:opacity-50 bg-[#2FC8B9] hover:bg-[#28b5a6]",children:g?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsxs(n.Fragment,{children:["Enter Portal ",n.jsx(To,{className:"w-5 h-5"})]})})]}),n.jsxs("p",{className:"text-center mt-8 text-gray-600",children:["Don't have an account?"," ",n.jsx(Hs,{to:"/register",className:"font-bold text-[#2FC8B9] hover:text-black transition-colors uppercase text-xs tracking-widest",children:"Create Profile"})]})]})})]})}function cce(){const a=rE();new URLSearchParams(a.search);const[o,c]=ee.useState(2),[d,h]=ee.useState("patient"),[p,g]=ee.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",height:"",weight:"",bloodGroup:"",dietaryPreference:"non-vegetarian",activityLevel:"sedentary",smoker:!1,alcohol:!1,sleepHours:"7",stressLevel:"moderate",waterIntake:"8",chronicConditions:[],isDiabetic:"no",diabetesType:"",diagnosisYear:"",diabetesStatus:"",hba1c:"",glucoseMonitoring:"",fastingGlucose:"",postMealGlucose:"",testingFrequency:"",onMedication:!1,medicationType:[],insulinTiming:"",recentDosageChange:!1,primaryGoal:"general_health",targetWeight:"",weeklyGoal:"0.5"}),[x,v]=ee.useState(!1),[E,C]=ee.useState(!1),[I,O]=ee.useState(""),[R,k]=ee.useState(""),[M,P]=ee.useState(""),[H,$]=ee.useState(""),{register:re}=da(),J=Ha(),ge=async V=>{var ce,Y;if(V.preventDefault(),p.password!==p.confirmPassword){St.error("Passwords do not match");return}if(!p.age||!p.gender){St.error("Please provide your age and gender");return}C(!0);try{const z={age:parseInt(p.age),gender:p.gender,height:p.height?parseFloat(p.height):void 0,weight:p.weight?parseFloat(p.weight):void 0,bloodGroup:p.bloodGroup||void 0,dietaryPreference:p.dietaryPreference,activityLevel:p.activityLevel,medicalHistory:{conditions:p.chronicConditions.includes("Diabetes")?p.chronicConditions:p.isDiabetic==="yes"?["Diabetes",...p.chronicConditions]:p.chronicConditions},lifestyle:{smoker:p.smoker,alcohol:p.alcohol,sleepHours:parseInt(p.sleepHours),stressLevel:p.stressLevel,waterIntake:parseInt(p.waterIntake)},diabetesProfile:p.isDiabetic==="yes"?{type:p.diabetesType,diagnosisYear:p.diagnosisYear,status:p.diabetesStatus,hba1c:p.hba1c,glucoseMonitoring:p.glucoseMonitoring,fastingGlucose:p.fastingGlucose,postMealGlucose:p.postMealGlucose,testingFrequency:p.testingFrequency,onMedication:p.onMedication,medicationType:p.medicationType,insulinTiming:p.insulinTiming,recentDosageChange:p.recentDosageChange}:void 0},te={goal:p.primaryGoal,targetWeight:p.targetWeight?parseFloat(p.targetWeight):null,weeklyGoal:parseFloat(p.weeklyGoal)};await re(p.name,p.email,p.password,z,te),St.success("Account created successfully!"),J("/dashboard")}catch(z){St.error(((Y=(ce=z.response)==null?void 0:ce.data)==null?void 0:Y.message)||"Registration failed")}finally{C(!1)}},ie=()=>{if(o===2&&(!p.name||!p.email||!p.password||!p.age||!p.gender)){St.error("Please fill in all basic fields");return}if(o===3&&(!p.height||!p.weight)){St.error("Please provide height and weight");return}if(o===5&&p.isDiabetic==="no"){c(6);return}c(o+1)},we=()=>{o===2?J("/"):c(o-1)},Ae=(V,ce)=>{g(Y=>({...Y,[V]:Y[V].includes(ce)?Y[V].filter(z=>z!==ce):[...Y[V],ce]}))};if(o===2)return n.jsxs("div",{className:"min-h-screen flex bg-white",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-black",children:[n.jsxs("div",{className:"absolute inset-0 opacity-20",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-[#2FC8B9] rounded-full blur-[120px]"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-[#2FC8B9] rounded-full blur-[120px]"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Ca,{className:"w-12 h-12 animate-pulse"})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*.16,className:"transition-all duration-500",strokeLinecap:"round"})]})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."}),n.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=2?"bg-[#2FC8B9] text-white":"bg-white/10"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"1"})}),n.jsx("span",{className:"text-xs",children:"Basic"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=3?"bg-[#2FC8B9] text-white":"bg-white/10"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"2"})}),n.jsx("span",{className:"text-xs",children:"Health"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=4?"bg-[#2FC8B9] text-white":"bg-white/10"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"3"})}),n.jsx("span",{className:"text-xs",children:"Lifestyle"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=5?"bg-[#2FC8B9] text-white":"bg-white/10"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"4"})}),n.jsx("span",{className:"text-xs",children:"Diabetes"})]}),n.jsx("div",{className:"w-8 h-0.5 bg-white/20"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${o>=6?"bg-[#2FC8B9] text-white":"bg-white/10"}`,children:n.jsx("span",{className:"text-sm font-bold",children:"5"})}),n.jsx("span",{className:"text-xs",children:"Goals"})]})]}),n.jsxs("p",{className:"text-sm text-white/70 mt-6",children:["Step ",o-1," of 5 - ",o===2?"Basic Info":o===3?"Health Profile":o===4?"Lifestyle":o===5?"Diabetes":"Goals"]})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("button",{onClick:()=>J("/"),className:"flex items-center gap-2 mb-6 text-[#2FC8B9] font-black uppercase tracking-tighter text-xs hover:text-black transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-black mb-2 text-black uppercase tracking-tighter",children:"Elite Medical Profile"}),n.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:"Step 1 of 5  Global Health Identity"})]}),n.jsxs("form",{onSubmit:V=>{V.preventDefault(),ie()},className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Full Name *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Jd,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"text",value:p.name,onChange:V=>g({...p,name:V.target.value}),className:"w-full bg-slate-50 border border-slate-100 rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-[#2FC8B9]/30 focus:border-[#2FC8B9] text-black font-bold placeholder:text-slate-400",placeholder:"John Doe",required:!0})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Age *"}),n.jsx("input",{type:"number",value:p.age,onChange:V=>g({...p,age:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"25",min:"1",max:"120",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Gender *"}),n.jsxs("select",{value:p.gender,onChange:V=>g({...p,gender:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select"}),n.jsx("option",{value:"male",className:"text-slate-900",children:"Male"}),n.jsx("option",{value:"female",className:"text-slate-900",children:"Female"}),n.jsx("option",{value:"other",className:"text-slate-900",children:"Other"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Email Address *"}),n.jsxs("div",{className:"relative",children:[n.jsx(aE,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"email",value:p.email,onChange:V=>g({...p,email:V.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"you@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Zb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:x?"text":"password",value:p.password,onChange:V=>g({...p,password:V.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"",required:!0}),n.jsx("button",{type:"button",onClick:()=>v(!x),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:x?n.jsx(tQ,{className:"w-5 h-5"}):n.jsx(zp,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Confirm Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Zb,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"password",value:p.confirmPassword,onChange:V=>g({...p,confirmPassword:V.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-slate-200 text-slate-900 placeholder:text-slate-400",placeholder:"",required:!0})]})]}),n.jsxs("button",{type:"submit",className:"w-full py-4 text-white font-black uppercase tracking-widest rounded-xl hover:shadow-[0_10px_25px_rgba(47,200,185,0.3)] transition-all flex items-center justify-center gap-2 bg-[#2FC8B9] hover:bg-[#28b5a6]",children:["Continue Setup ",n.jsx(To,{className:"w-5 h-5"})]})]}),n.jsxs("p",{className:"text-center mt-6 text-slate-600",children:["Already have an account?"," ",n.jsx(Hs,{to:"/login",className:"font-black text-[#2FC8B9] hover:text-black transition-colors uppercase text-xs tracking-widest",children:"Sign in"})]})]})})]});if(o===3)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Q3,{className:"w-12 h-12 animate-bounce",style:{animationDuration:"2s"}})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*.4,className:"transition-all duration-500",strokeLinecap:"round"})]})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Health Profile"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Help us calculate your personalized nutrition goals based on your body metrics."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 2 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("button",{onClick:we,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Health Profile"}),n.jsx("p",{className:"text-cyan-700",children:"Step 2 of 5 - Your body metrics"})]}),n.jsxs("form",{onSubmit:V=>{V.preventDefault(),ie()},className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Height (cm) *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Lre,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsx("input",{type:"number",value:p.height,onChange:V=>g(ce=>({...ce,height:V.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"170",min:"100",max:"250",step:"0.1",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weight (kg) *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Q3,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsx("input",{type:"number",value:p.weight,onChange:V=>g(ce=>({...ce,weight:V.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"70",min:"30",max:"300",step:"0.1",required:!0})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Blood Group"}),n.jsxs("div",{className:"relative",children:[n.jsx(YR,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600"}),n.jsxs("select",{value:p.bloodGroup,onChange:V=>g(ce=>({...ce,bloodGroup:V.target.value})),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select (Optional)"}),n.jsx("option",{value:"A+",className:"text-slate-900",children:"A+"}),n.jsx("option",{value:"A-",className:"text-slate-900",children:"A-"}),n.jsx("option",{value:"B+",className:"text-slate-900",children:"B+"}),n.jsx("option",{value:"B-",className:"text-slate-900",children:"B-"}),n.jsx("option",{value:"AB+",className:"text-slate-900",children:"AB+"}),n.jsx("option",{value:"AB-",className:"text-slate-900",children:"AB-"}),n.jsx("option",{value:"O+",className:"text-slate-900",children:"O+"}),n.jsx("option",{value:"O-",className:"text-slate-900",children:"O-"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Dietary Preference *"}),n.jsxs("select",{value:p.dietaryPreference,onChange:V=>g(ce=>({...ce,dietaryPreference:V.target.value})),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"non-vegetarian",className:"text-slate-900",children:"Non-Vegetarian"}),n.jsx("option",{value:"vegetarian",className:"text-slate-900",children:"Vegetarian"}),n.jsx("option",{value:"vegan",className:"text-slate-900",children:"Vegan"}),n.jsx("option",{value:"eggetarian",className:"text-slate-900",children:"Eggetarian"})]}),n.jsx("p",{className:"text-xs mt-1 text-cyan-700",children:"This helps us recommend suitable diet plans"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Activity Level *"}),n.jsxs("select",{value:p.activityLevel,onChange:V=>g(ce=>({...ce,activityLevel:V.target.value})),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",required:!0,children:[n.jsx("option",{value:"sedentary",className:"text-slate-900",children:"Sedentary (Little or no exercise)"}),n.jsx("option",{value:"lightly_active",className:"text-slate-900",children:"Lightly Active (1-3 days/week)"}),n.jsx("option",{value:"moderately_active",className:"text-slate-900",children:"Moderately Active (3-5 days/week)"}),n.jsx("option",{value:"very_active",className:"text-slate-900",children:"Very Active (6-7 days/week)"}),n.jsx("option",{value:"extremely_active",className:"text-slate-900",children:"Extremely Active (Athlete)"})]}),n.jsx("p",{className:"text-xs mt-1 text-cyan-700",children:"Used to calculate your daily calorie needs"})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700",children:["Continue ",n.jsx(To,{className:"w-5 h-5"})]})]})]})})]});if(o===5)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(br,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Diabetes Information"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Skip this if you don't have diabetes. This helps us tailor your glucose management plan."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 4 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("button",{onClick:we,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Are you diabetic?"}),n.jsx("p",{className:"text-cyan-700",children:"Step 4 of 5 - Detailed health check"})]}),n.jsxs("form",{onSubmit:V=>{V.preventDefault(),ie()},className:"space-y-6",children:[n.jsxs("div",{className:"flex gap-4 p-4 bg-white rounded-xl border border-cyan-200",children:[n.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all hover:bg-cyan-50 border-cyan-200",children:[n.jsx("input",{type:"radio",checked:p.isDiabetic==="no",onChange:()=>g({...p,isDiabetic:"no",diabetesType:""}),className:"text-cyan-500"}),n.jsx("span",{className:"font-medium text-slate-800",children:"No"})]}),n.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition-all hover:bg-cyan-50 border-cyan-200",children:[n.jsx("input",{type:"radio",checked:p.isDiabetic==="yes",onChange:()=>g({...p,isDiabetic:"yes"}),className:"text-cyan-500"}),n.jsx("span",{className:"font-medium text-slate-800",children:"Yes"})]})]}),p.isDiabetic==="yes"&&n.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-top-4 duration-300",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Diabetes Type"}),n.jsxs("select",{value:p.diabetesType,onChange:V=>g({...p,diabetesType:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"",className:"text-slate-900",children:"Select Type"}),n.jsx("option",{value:"Type 1",className:"text-slate-900",children:"Type 1"}),n.jsx("option",{value:"Type 2",className:"text-slate-900",children:"Type 2"}),n.jsx("option",{value:"Prediabetes",className:"text-slate-900",children:"Prediabetes"}),n.jsx("option",{value:"Gestational",className:"text-slate-900",children:"Gestational"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Diagnosis Year"}),n.jsx("input",{type:"number",value:p.diagnosisYear,onChange:V=>g({...p,diagnosisYear:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"2020"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"HbA1c (%)"}),n.jsx("input",{type:"number",step:"0.1",value:p.hba1c,onChange:V=>g({...p,hba1c:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"6.5"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Are you on medication?"}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",checked:!p.onMedication,onChange:()=>g({...p,onMedication:!1}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"No"})]}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",checked:p.onMedication,onChange:()=>g({...p,onMedication:!0}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Yes"})]})]})]})]}),n.jsxs("button",{type:"submit",className:"w-full py-4 text-white font-black uppercase tracking-widest rounded-xl hover:shadow-[0_10px_25px_rgba(47,200,185,0.3)] transition-all flex items-center justify-center gap-2 bg-[#2FC8B9] hover:bg-[#28b5a6]",children:["Finalize Steps ",n.jsx(To,{className:"w-5 h-5"})]})]})]})})]});if(o===4)return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(br,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Lifestyle & Health"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Tell us about your daily habits and any existing health conditions."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 3 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("button",{onClick:we,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Lifestyle & Conditions"}),n.jsx("p",{className:"text-cyan-700",children:"Step 3 of 5 - Habits and health history"})]}),n.jsxs("form",{onSubmit:V=>{V.preventDefault(),ie()},className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-xl border border-slate-200",children:[n.jsx(jre,{className:"w-5 h-5 text-slate-400"}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:p.smoker,onChange:V=>g({...p,smoker:V.target.checked}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Smoker"})]})]}),n.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white rounded-xl border border-slate-200",children:[n.jsx(Pre,{className:"w-5 h-5 text-slate-400"}),n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:p.alcohol,onChange:V=>g({...p,alcohol:V.target.checked}),className:"text-cyan-500"}),n.jsx("span",{className:"text-sm text-slate-800",children:"Alcohol"})]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:["Sleep Hours/Night: ",p.sleepHours,"h"]}),n.jsx("input",{type:"range",min:"4",max:"12",value:p.sleepHours,onChange:V=>g({...p,sleepHours:V.target.value}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Stress Level"}),n.jsxs("select",{value:p.stressLevel,onChange:V=>g({...p,stressLevel:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-slate-200 text-slate-900",children:[n.jsx("option",{value:"low",className:"text-slate-900",children:"Low"}),n.jsx("option",{value:"moderate",className:"text-slate-900",children:"Moderate"}),n.jsx("option",{value:"high",className:"text-slate-900",children:"High"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:["Water Intake (Glasses/Day): ",p.waterIntake]}),n.jsx("input",{type:"range",min:"1",max:"15",value:p.waterIntake,onChange:V=>g({...p,waterIntake:V.target.value}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700",children:"Chronic Conditions (If any)"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["Hypertension","Thyroid","PCOS/PCOD","Asthma","Arthritis","None"].map(V=>n.jsx("button",{type:"button",onClick:()=>{V==="None"?g({...p,chronicConditions:[]}):Ae("chronicConditions",V)},className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${p.chronicConditions.includes(V)?"bg-cyan-600 text-white":"bg-slate-100 text-slate-700"}`,children:V},V))})]}),n.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 flex items-center justify-center gap-2",children:["Continue ",n.jsx(To,{className:"w-5 h-5"})]})]})]})})]});if(o===7){const ce=(()=>{if(!p.targetWeight||!p.weight)return null;const Y=Math.abs(parseFloat(p.targetWeight)-parseFloat(p.weight));return Math.ceil(Y/parseFloat(p.weeklyGoal))})();return n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Ah,{className:"w-12 h-12"})}),n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeOpacity:"0.2",strokeWidth:"4",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"60",stroke:"white",strokeWidth:"4",fill:"none",strokeDasharray:"377",strokeDashoffset:377-377*1,className:"transition-all duration-500",strokeLinecap:"round"})]}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsx(Ure,{className:"w-16 h-16 text-white/80 animate-pulse"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Final Step!"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"We'll calculate your personalized nutrition plan based on your goals."}),n.jsxs("div",{className:"mt-6 text-center",children:[n.jsx("p",{className:"text-lg font-bold text-white mb-2",children:" Almost Complete!"}),n.jsx("p",{className:"text-sm text-white/70",children:"One more step to unlock your personalized health plan"})]})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("button",{onClick:we,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Nutrition Goals"}),n.jsx("p",{className:"text-cyan-700",children:"Step 6 of 6 - Final step!"})]}),n.jsxs("form",{onSubmit:ge,className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-3 text-slate-900",children:"What's your primary nutrition goal?"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("button",{type:"button",onClick:()=>g({...p,nutritionGoal:"weight_loss"}),className:`p-4 rounded-xl border-2 transition-all ${p.nutritionGoal==="weight_loss"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(ah,{className:`w-8 h-8 mx-auto mb-2 ${p.nutritionGoal==="weight_loss"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Weight Loss"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...p,nutritionGoal:"weight_gain"}),className:`p-4 rounded-xl border-2 transition-all ${p.nutritionGoal==="weight_gain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(qi,{className:`w-8 h-8 mx-auto mb-2 ${p.nutritionGoal==="weight_gain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Weight Gain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...p,nutritionGoal:"muscle_gain"}),className:`p-4 rounded-xl border-2 transition-all ${p.nutritionGoal==="muscle_gain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(GT,{className:`w-8 h-8 mx-auto mb-2 ${p.nutritionGoal==="muscle_gain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Muscle Gain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...p,nutritionGoal:"maintain"}),className:`p-4 rounded-xl border-2 transition-all ${p.nutritionGoal==="maintain"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(kg,{className:`w-8 h-8 mx-auto mb-2 ${p.nutritionGoal==="maintain"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Maintain"})]}),n.jsxs("button",{type:"button",onClick:()=>g({...p,nutritionGoal:"general_health"}),className:`p-4 rounded-xl border-2 transition-all col-span-2 ${p.nutritionGoal==="general_health"?"border-cyan-600 bg-cyan-50":"border-slate-200 bg-white hover:border-cyan-300"}`,children:[n.jsx(Ca,{className:`w-8 h-8 mx-auto mb-2 ${p.nutritionGoal==="general_health"?"text-cyan-600":"text-slate-400"}`}),n.jsx("p",{className:"text-sm font-medium text-slate-900",children:"General Health"})]})]})]}),(p.nutritionGoal==="weight_loss"||p.nutritionGoal==="weight_gain")&&n.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-4 border border-cyan-200",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",value:p.targetWeight,onChange:Y=>g({...p,targetWeight:Y.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:p.weight,min:"30",max:"300",step:"0.1"}),n.jsxs("p",{className:"text-xs mt-1 text-slate-600",children:["Current: ",p.weight," kg"]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weekly Goal"}),n.jsxs("select",{value:p.weeklyGoal,onChange:Y=>g({...p,weeklyGoal:Y.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"0.25",className:"text-slate-900",children:"0.25 kg/week (Slow & Steady)"}),n.jsx("option",{value:"0.5",className:"text-slate-900",children:"0.5 kg/week (Recommended)"}),n.jsx("option",{value:"1",className:"text-slate-900",children:"1 kg/week (Aggressive)"})]})]}),ce&&n.jsx("div",{className:"bg-cyan-50 rounded-xl p-3 border border-cyan-200",children:n.jsxs("p",{className:"text-sm text-cyan-900",children:[n.jsx("strong",{children:"Estimated time:"})," ",ce," weeks (",Math.ceil(ce/4)," months)"]})})]}),n.jsx("div",{className:"bg-cyan-50 rounded-xl p-4 border border-cyan-200",children:n.jsx("p",{className:"text-sm text-cyan-900 font-medium",children:"What happens next? We'll calculate your personalized daily calorie and macro goals based on your profile and goals. You can adjust these anytime from your nutrition dashboard."})}),n.jsx("button",{type:"submit",disabled:E,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700",children:E?n.jsx(Al,{className:"w-5 h-5 animate-spin"}):n.jsxs(n.Fragment,{children:["Create Account & Calculate Goals ",n.jsx(To,{className:"w-5 h-5"})]})})]})]})})]})}return o===6?n.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-purple-50 to-orange-50",children:[n.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-600",children:[n.jsxs("div",{className:"absolute inset-0",children:[n.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),n.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),n.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[n.jsxs("div",{className:"relative w-32 h-32 mb-8",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-full animate-pulse"}),n.jsx("div",{className:"absolute inset-4 bg-white/30 backdrop-blur-xl rounded-full flex items-center justify-center",children:n.jsx(Ah,{className:"w-12 h-12"})})]}),n.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Set Your Goals"}),n.jsx("p",{className:"text-xl text-white/80 text-center max-w-md mb-6",children:"Define your target and we'll help you reach it with precision."}),n.jsx("p",{className:"text-sm text-white/70 mt-6",children:"Step 5 of 5"})]})]}),n.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:n.jsxs("div",{className:"w-full max-w-md py-8",children:[n.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[n.jsx("div",{className:"w-12 h-12 bg-black rounded-xl flex items-center justify-center border border-[#2FC8B9]/30 shadow-lg shadow-[#2FC8B9]/10",children:n.jsx(br,{className:"w-7 h-7 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-2xl font-black text-black uppercase tracking-tighter",children:"FitCure"})]}),n.jsxs("button",{onClick:we,className:"flex items-center gap-2 mb-6 text-cyan-700 hover:text-cyan-800",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900",children:"Health Goals"}),n.jsx("p",{className:"text-cyan-700",children:"Step 5 of 5 - The finish line!"})]}),n.jsxs("form",{onSubmit:ge,className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Primary Goal"}),n.jsxs("select",{value:p.primaryGoal,onChange:V=>g({...p,primaryGoal:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"weight_loss",className:"text-slate-900",children:"Weight Loss"}),n.jsx("option",{value:"weight_gain",className:"text-slate-900",children:"Weight Gain"}),n.jsx("option",{value:"maintain",className:"text-slate-900",children:"Maintain Weight"}),n.jsx("option",{value:"general_health",className:"text-slate-900",children:"General Health"}),n.jsx("option",{value:"diabetes_management",className:"text-slate-900",children:"Diabetes Management"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",step:"0.1",value:p.targetWeight,onChange:V=>g({...p,targetWeight:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900 placeholder:text-slate-400",placeholder:"65"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-900",children:"Weekly Goal (kg/week)"}),n.jsxs("select",{value:p.weeklyGoal,onChange:V=>g({...p,weeklyGoal:V.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 border border-cyan-200 text-slate-900",children:[n.jsx("option",{value:"0.25",className:"text-slate-900",children:"0.25 kg (Steady)"}),n.jsx("option",{value:"0.5",className:"text-slate-900",children:"0.5 kg (Recommended)"}),n.jsx("option",{value:"1.0",className:"text-slate-900",children:"1.0 kg (Aggressive)"})]})]}),n.jsx("button",{type:"submit",disabled:E,className:"w-full py-3 text-white font-semibold rounded-xl bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 flex items-center justify-center gap-2 disabled:opacity-50",children:E?n.jsx(Al,{className:"w-5 h-5 animate-spin"}):n.jsxs(n.Fragment,{children:["Create Account ",n.jsx(To,{className:"w-5 h-5"})]})})]})]})})]}):null}const lce=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],x6=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function dce(){const{registerDoctor:a}=da(),o=Ha(),[c,d]=ee.useState(!1),[h,p]=ee.useState(1),[g,x]=ee.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[v,E]=ee.useState({}),C=k=>{x({...g,[k.target.name]:k.target.value})},I=(k,M)=>{M&&E(P=>({...P,[k]:{file:M,name:M.name,size:(M.size/1024).toFixed(1)+" KB"}}))},O=k=>{E(M=>{const P={...M};return delete P[k],P})},R=async k=>{var P,H;if(k.preventDefault(),g.password!==g.confirmPassword){St.error("Passwords do not match");return}const M=x6.filter($=>!v[$.id]);if(M.length>0){St.error(`Please upload: ${M.map($=>$.name).join(", ")}`);return}d(!0);try{const $=Object.entries(v).map(([re,J])=>({name:J.name,type:re,url:`pending_upload_${re}`}));await a({...g,qualifications:g.qualifications.split(",").map(re=>re.trim()).filter(Boolean),experience:parseInt(g.experience),consultationFee:parseInt(g.consultationFee)||500,documents:$}),St.success("Registration successful! Your profile is pending approval."),o("/doctor/dashboard")}catch($){St.error(((H=(P=$.response)==null?void 0:P.data)==null?void 0:H.message)||"Registration failed")}finally{d(!1)}};return n.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-2xl",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsxs(Hs,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center",children:n.jsx(br,{className:"w-7 h-7 text-white"})}),n.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),n.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),n.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(k=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${h>=k?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:k}),n.jsx("span",{className:`text-sm hidden sm:block ${h>=k?"text-cyan-600 font-medium":"text-slate-400"}`,children:k===1?"Account":k===2?"Professional":"Documents"}),k<3&&n.jsx("div",{className:`w-8 h-1 rounded ${h>k?"bg-cyan-500":"bg-slate-200"}`})]},k))}),n.jsxs("form",{onSubmit:R,children:[h===1&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",name:"name",value:g.name,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",name:"email",value:g.email,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),n.jsx("input",{type:"tel",name:"phone",value:g.phone,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),n.jsx("input",{type:"password",name:"password",value:g.password,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),n.jsx("input",{type:"password",name:"confirmPassword",value:g.confirmPassword,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),n.jsx("button",{type:"button",onClick:()=>p(2),className:"w-full py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),h===2&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),n.jsxs("select",{name:"specialization",value:g.specialization,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[n.jsx("option",{value:"",children:"Select specialization"}),lce.map(k=>n.jsx("option",{value:k,children:k},k))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),n.jsx("input",{type:"number",name:"experience",value:g.experience,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),n.jsx("input",{type:"text",name:"licenseNumber",value:g.licenseNumber,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),n.jsx("input",{type:"text",name:"qualifications",value:g.qualifications,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),n.jsx("input",{type:"text",name:"hospital",value:g.hospital,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),n.jsx("input",{type:"number",name:"consultationFee",value:g.consultationFee,onChange:C,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),n.jsxs("div",{className:"flex gap-3 mt-4",children:[n.jsxs("button",{type:"button",onClick:()=>p(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsx("button",{type:"button",onClick:()=>p(3),className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),h===3&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:n.jsxs("p",{className:"text-sm text-amber-800",children:[n.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),x6.map(k=>n.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-slate-800",children:[k.name," ",n.jsx("span",{className:"text-red-500",children:"*"})]}),n.jsx("p",{className:"text-sm text-slate-500",children:k.description})]}),v[k.id]?n.jsx(Tn,{className:"w-5 h-5 text-green-500"}):null]}),v[k.id]?n.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Hn,{className:"w-5 h-5 text-cyan-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-slate-700",children:v[k.id].name}),n.jsx("p",{className:"text-xs text-slate-500",children:v[k.id].size})]})]}),n.jsx("button",{type:"button",onClick:()=>O(k.id),className:"p-1 text-slate-400 hover:text-red-500",children:n.jsx(Gn,{className:"w-4 h-4"})})]}):n.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[n.jsx(lo,{className:"w-5 h-5 text-slate-400"}),n.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),n.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:M=>I(k.id,M.target.files[0])})]})]},k.id)),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsxs("button",{type:"button",onClick:()=>p(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back"]}),n.jsx("button",{type:"submit",disabled:c,className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:c?"Submitting...":"Submit Application"})]})]})]}),n.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",n.jsx(Hs,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),n.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[n.jsx(Fre,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}const cH=ee.createContext(),lH=()=>{const a=ee.useContext(cH);if(!a)throw new Error("useData must be used within DataProvider");return a},Ace=({children:a})=>{const[o,c]=ee.useState(null),[d,h]=ee.useState(null),[p,g]=ee.useState(null),[x,v]=ee.useState({dashboard:!1,wearable:!1,nutrition:!1}),E=ee.useCallback(async(M=!1)=>{if(!M){const P=cl.get("dashboard");if(P)return c(P),P}v(P=>({...P,dashboard:!0}));try{const H=(await sd.getDashboard()).data;return c(H),cl.set("dashboard",H,10*60*1e3),H}catch(P){throw console.error("Failed to fetch dashboard:",P),P}finally{v(P=>({...P,dashboard:!1}))}},[]),C=ee.useCallback(async(M=!1)=>{if(!M){const P=cl.get("wearable");if(P)return h(P),P}v(P=>({...P,wearable:!0}));try{const H=(await cg.getDashboard()).data;return h(H),cl.set("wearable",H,2*60*1e3),H}catch(P){console.error("Failed to fetch wearable:",P);const H={connected:!1};return h(H),H}finally{v(P=>({...P,wearable:!1}))}},[]),I=ee.useCallback(async(M,P=!1)=>{var $;const H=`nutrition_${M}`;if(!P){const re=cl.get(H);if(re)return g(re),re}v(re=>({...re,nutrition:!0}));try{const J=(($=(await KQ.getDailySummary(M)).data)==null?void 0:$.summary)||null;return g(J),J&&cl.set(H,J,5*60*1e3),J}catch(re){return console.error("Failed to fetch nutrition:",re),g(null),null}finally{v(re=>({...re,nutrition:!1}))}},[]),O=ee.useCallback(async(M=!1)=>{if(!M){const P=cl.get("diet_plan");if(P)return P}try{const P=localStorage.getItem("token"),H=await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${P}`}});if(H.status===404)return null;const $=await H.json();return $.success&&$.dietPlan?(cl.set("diet_plan",$.dietPlan,15*60*1e3),$.dietPlan):null}catch(P){return console.error("Failed to fetch diet plan:",P),null}},[]),R=ee.useCallback((M=[])=>{M.length===0?(cl.clear(),c(null),h(null),g(null)):M.forEach(P=>{cl.delete(P),P==="dashboard"&&c(null),P==="wearable"&&h(null),P.startsWith("nutrition_")&&g(null)})},[]),k={dashboardData:o,wearableData:d,nutritionData:p,loading:x,fetchDashboard:E,fetchWearable:C,fetchNutrition:I,fetchDietPlan:O,invalidateCache:R};return n.jsx(cH.Provider,{value:k,children:a})},uce="http://localhost:5000",hce=({bmi:a})=>{const[h,p]=ee.useState(null),x=a<16?0:a>=40?180:(a-16)/24*180,v=[{start:0,end:30,color:"#ef4444",label:"Underweight",range:"< 18.5"},{start:30,end:82.5,color:"#22c55e",label:"Normal",range:"18.5 - 25"},{start:82.5,end:120,color:"#eab308",label:"Overweight",range:"25 - 30"},{start:120,end:157.5,color:"#f97316",label:"Obese",range:"30 - 35"},{start:157.5,end:180,color:"#dc2626",label:"Severely Obese",range:"> 35"}];return n.jsxs("div",{className:"relative flex items-center justify-center",children:[n.jsxs("svg",{width:200,height:200/2+20,className:"overflow-visible",children:[v.map((E,C)=>{const I=E.start-90,O=E.end-90,R=O-I>180?1:0,k=200/2+90*Math.cos(I*Math.PI/180),M=200/2+90*Math.sin(I*Math.PI/180),P=200/2+90*Math.cos(O*Math.PI/180),H=200/2+90*Math.sin(O*Math.PI/180);return n.jsx("g",{children:n.jsx("path",{d:`M ${k} ${M} A 90 90 0 ${R} 1 ${P} ${H}`,fill:"none",stroke:E.color,strokeWidth:20,strokeLinecap:"round",className:"cursor-pointer transition-opacity hover:opacity-80",onMouseEnter:()=>p(C),onMouseLeave:()=>p(null)})},C)}),n.jsxs("g",{transform:`rotate(${x-90} ${200/2} ${200/2})`,children:[n.jsx("line",{x1:200/2,y1:200/2,x2:200/2+90-10,y2:200/2,stroke:"#000000",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:200/2,cy:200/2,r:"8",fill:"#000000"})]}),n.jsx("text",{x:200/2,y:200/2+35,textAnchor:"middle",className:"text-3xl font-black fill-black",children:a.toFixed(1)}),n.jsx("text",{x:200/2,y:200/2+55,textAnchor:"middle",className:"text-xs fill-slate-500",children:"kg/m"})]}),h!==null&&n.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full mb-2 px-3 py-2 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-lg whitespace-nowrap z-10",children:[n.jsx("div",{className:"font-semibold",children:v[h].label}),n.jsxs("div",{className:"text-slate-300",children:["BMI: ",v[h].range]}),n.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800"})]})]})},pce=({bmi:a})=>{const[h,p]=ee.useState(null),x=a<16?0:a>=40?180:(a-16)/24*180,v=[{start:0,end:30,color:"#ef4444",label:"Underweight",range:"< 18.5"},{start:30,end:82.5,color:"#22c55e",label:"Normal",range:"18.5 - 25"},{start:82.5,end:120,color:"#eab308",label:"Overweight",range:"25 - 30"},{start:120,end:157.5,color:"#f97316",label:"Obese",range:"30 - 35"},{start:157.5,end:180,color:"#dc2626",label:"Severely Obese",range:"> 35"}];return n.jsxs("div",{className:"relative flex items-center justify-center",children:[n.jsxs("svg",{width:240,height:240/2+30,className:"overflow-visible",children:[v.map((E,C)=>{const I=E.start,O=E.end,R=0,k=240/2-109*Math.cos(I*Math.PI/180),M=240/2-109*Math.sin(I*Math.PI/180),P=240/2-109*Math.cos(O*Math.PI/180),H=240/2-109*Math.sin(O*Math.PI/180);return n.jsx("g",{children:n.jsx("path",{d:`M ${k} ${M} A 109 109 0 ${R} 1 ${P} ${H}`,fill:"none",stroke:E.color,strokeWidth:22,strokeLinecap:"round",className:"cursor-pointer transition-opacity active:opacity-80",onTouchStart:()=>p(C),onTouchEnd:()=>p(null),onMouseEnter:()=>p(C),onMouseLeave:()=>p(null)})},C)}),n.jsxs("g",{transform:`rotate(${x} ${240/2} ${240/2})`,children:[n.jsx("line",{x1:240/2,y1:240/2,x2:240/2-109+12,y2:240/2,stroke:"#000000",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:240/2,cy:240/2,r:"9",fill:"#000000"})]}),n.jsx("text",{x:240/2,y:240/2+25,textAnchor:"middle",className:"text-4xl font-black fill-black",children:a.toFixed(1)}),n.jsx("text",{x:240/2,y:240/2+45,textAnchor:"middle",className:"text-sm fill-slate-500 font-medium",children:"kg/m"})]}),h!==null&&n.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-800 text-white text-xs font-medium rounded-lg shadow-lg whitespace-nowrap z-10 animate-fade-in",children:[n.jsx("div",{className:"font-semibold",children:v[h].label}),n.jsxs("div",{className:"text-slate-300",children:["BMI: ",v[h].range]}),n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800"})]})]})},mce=({bmi:a})=>{const c=a<16?{label:"Severe Underweight",color:"border-rose-200 text-rose-600 bg-rose-50/30"}:a<18.5?{label:"Underweight",color:"border-amber-200 text-amber-600 bg-amber-50/30"}:a<25?{label:"Optimal Range",color:"border-[#2FC8B9]/30 text-[#2FC8B9] bg-[#2FC8B9]/5"}:a<30?{label:"Overweight",color:"border-amber-200 text-amber-600 bg-amber-50/30"}:a<35?{label:"Obese",color:"border-rose-200 text-rose-600 bg-rose-50/30"}:{label:"Severe Obese",color:"border-rose-300 text-rose-700 bg-rose-100/30"};return n.jsx("div",{className:`inline-flex items-center px-4 py-1.5 rounded-full border-2 ${c.color} font-black text-[10px] uppercase tracking-widest`,children:c.label})};function fce(){const{user:a}=da(),[o,c]=ee.useState(null),[d,h]=ee.useState(null),[p,g]=ee.useState(null),[x,v]=ee.useState(null),[E,C]=ee.useState(null);ee.useEffect(()=>{I(),O()},[a]);const I=()=>{var ge,ie;const R=(ge=a==null?void 0:a.profile)==null?void 0:ge.height,k=(ie=a==null?void 0:a.profile)==null?void 0:ie.weight;if(!R||!k)return;const M=R/100,P=k/(M*M);c(P);const H=P/25;h(H);const $=k/Math.pow(M,3);g($);const re=18.5*M*M,J=25*M*M;v({min:re.toFixed(1),max:J.toFixed(1)})},O=async()=>{var R;try{const k=localStorage.getItem("token"),{data:M}=await zr.get(`${uce}/api/auth/profile`,{headers:{Authorization:`Bearer ${k}`}});C((R=M.user)==null?void 0:R.nutritionGoal)}catch(k){console.error("Failed to fetch goal:",k)}};return o?n.jsx(n.Fragment,{children:n.jsx("div",{className:"bg-white rounded-3xl border border-slate-100 p-4 lg:p-8 shadow-[0_8px_30px_rgb(0,0,0,0.04)]",children:n.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-3 lg:gap-6",children:[n.jsx("div",{className:"lg:hidden w-full flex justify-center",children:n.jsx(pce,{bmi:o})}),n.jsx("div",{className:"hidden lg:block flex-shrink-0",children:n.jsx(hce,{bmi:o})}),n.jsxs("div",{className:"flex-1 w-full space-y-2 lg:space-y-4 text-center lg:text-left",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2 justify-center lg:justify-start",children:[n.jsx("h3",{className:"hidden lg:block text-2xl font-black text-black",children:"Your BMI"}),n.jsx(mce,{bmi:o})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 lg:gap-3",children:[n.jsxs("div",{className:"bg-slate-50 rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-100",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-500 mb-0.5 lg:mb-1",children:"Healthy BMI"}),n.jsx("p",{className:"text-xs lg:text-sm font-black text-black",children:"18.5 - 25"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-100",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-500 mb-0.5 lg:mb-1",children:"Healthy Weight"}),n.jsxs("p",{className:"text-xs lg:text-sm font-black text-black",children:[x==null?void 0:x.min," - ",x==null?void 0:x.max," kg"]})]}),n.jsxs("div",{className:"bg-slate-50 rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-100",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-500 mb-0.5 lg:mb-1",children:"BMI Prime"}),n.jsx("p",{className:"text-xs lg:text-sm font-black text-black",children:d==null?void 0:d.toFixed(2)})]}),n.jsxs("div",{className:"bg-slate-50 rounded-lg lg:rounded-xl p-2 lg:p-3 border border-slate-100",children:[n.jsx("p",{className:"text-[10px] lg:text-xs text-slate-500 mb-0.5 lg:mb-1",children:"Ponderal Index"}),n.jsxs("p",{className:"text-xs lg:text-sm font-black text-black",children:[p==null?void 0:p.toFixed(1)," kg/m"]})]})]}),E!=null&&E.goal?n.jsx("div",{className:"bg-white rounded-2xl p-4 border border-slate-100 shadow-sm",children:n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[n.jsxs("div",{className:"text-center sm:text-left",children:[n.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-widest font-bold mb-1",children:"Current Goal"}),n.jsxs("p",{className:"text-sm font-black text-black capitalize",children:[E.goal.replace("_"," "),E.targetWeight&&` - ${E.targetWeight} kg`]})]}),n.jsx(Hs,{to:"/profile?tab=goals",className:"px-4 py-2 bg-[#2FC8B9] text-white rounded-xl text-xs font-black uppercase tracking-wider hover:bg-[#25a89b] transition-all",children:"Change"})]})}):n.jsxs(Hs,{to:"/profile?tab=goals",className:"w-full py-4 bg-[#2FC8B9] text-white rounded-2xl font-black uppercase tracking-widest hover:bg-[#25a89b] transition-all flex items-center justify-center gap-2 text-sm shadow-[0_10px_20px_-5px_rgba(47,200,185,0.3)]",children:[n.jsx(Ah,{className:"w-4 h-4"}),"Set Your Goal"]})]})]})})}):n.jsx("div",{className:"bg-white rounded-2xl border-2 border-[#2FC8B9]/20 p-6 shadow-sm",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ah,{className:"w-12 h-12 text-[#2FC8B9] mx-auto mb-3"}),n.jsx("h3",{className:"text-lg font-bold text-black mb-2",children:"Complete Your Profile"}),n.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Add your height and weight to see your BMI and get personalized recommendations"}),n.jsx("a",{href:"/profile",className:"inline-block px-6 py-2 bg-[#2FC8B9] text-white rounded-xl font-medium hover:bg-[#25a89b] transition-colors",children:"Update Profile"})]})})}function gce({isOpen:a,onClose:o}){const[c,d]=ee.useState(!1),[h,p]=ee.useState(null),[g,x]=ee.useState(0),[v,E]=ee.useState([]),[C,I]=ee.useState(!1),[O,R]=ee.useState(""),[k,M]=ee.useState(""),[P,H]=ee.useState(new Date),[$,re]=ee.useState(localStorage.getItem("usual_sleep_time")||"22:00"),[J,ge]=ee.useState(localStorage.getItem("usual_wakeup_time")||"06:00");ee.useEffect(()=>{const Z=localStorage.getItem("sleep_tracking"),Ie=localStorage.getItem("sleep_history");if(Z){const Ve=JSON.parse(Z);if(d(Ve.isTracking),p(Ve.startTime?new Date(Ve.startTime):null),Ve.isTracking&&Ve.startTime){const Pe=Date.now()-new Date(Ve.startTime).getTime();x(Pe)}}Ie&&E(JSON.parse(Ie))},[]),ee.useEffect(()=>{let Z;return c&&h&&(Z=setInterval(()=>{const Ie=Date.now()-h.getTime();x(Ie)},1e3)),()=>clearInterval(Z)},[c,h]);const ie=Z=>{const Ie=Math.floor(Z/1e3),Ve=Math.floor(Ie/3600),Pe=Math.floor(Ie%3600/60);return{hours:Ve,minutes:Pe}},we=()=>{const Z=new Date;d(!0),p(Z),x(0),localStorage.setItem("sleep_tracking",JSON.stringify({isTracking:!0,startTime:Z.toISOString()})),St.success("Sleep tracking started ")},Ae=()=>{if(!h)return;const Z=new Date,Ie=Z.getTime()-h.getTime(),{hours:Ve,minutes:Pe}=ie(Ie),ve=[{id:Date.now(),date:h.toISOString(),startTime:h.toISOString(),endTime:Z.toISOString(),duration:Ie,hours:Ve,minutes:Pe,quality:V(Ve)},...v].slice(0,7);E(ve),localStorage.setItem("sleep_history",JSON.stringify(ve)),d(!1),p(null),x(0),localStorage.removeItem("sleep_tracking"),St.success(`Sleep recorded: ${Ve}h ${Pe}m `)},V=Z=>Z>=7&&Z<=9?85+Math.floor(Math.random()*15):Z>=6&&Z<7?70+Math.floor(Math.random()*15):Z>=5&&Z<6?55+Math.floor(Math.random()*15):40+Math.floor(Math.random()*15),ce=()=>{const Z=parseInt(O)||0,Ie=parseInt(k)||0;if(Z===0&&Ie===0){St.error("Please enter valid time");return}const Ve=(Z*3600+Ie*60)*1e3,Pe=new Date(P),ne=new Date(Pe.getTime()-Ve),ue=[{id:Date.now(),date:P.toISOString(),startTime:ne.toISOString(),endTime:Pe.toISOString(),duration:Ve,hours:Z,minutes:Ie,quality:V(Z),manual:!0},...v].slice(0,7);E(ue),localStorage.setItem("sleep_history",JSON.stringify(ue)),I(!1),R(""),M(""),St.success("Sleep data saved manually ")},Y=(Z,Ie)=>{re(Z),ge(Ie),localStorage.setItem("usual_sleep_time",Z),localStorage.setItem("usual_wakeup_time",Ie)},z=()=>{const Z=new Date().toDateString();return v.find(Ie=>new Date(Ie.date).toDateString()===Z)},te=()=>{const Z=[];for(let Ie=6;Ie>=0;Ie--){const Ve=new Date;Ve.setDate(Ve.getDate()-Ie),Z.push(Ve)}return Z},{hours:se,minutes:Ce}=ie(g),he=z(),Ne=te();return a?n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-3xl w-full max-w-md max-h-[90vh] pb-24 md:pb-0 flex flex-col shadow-2xl border border-slate-700",children:[n.jsxs("div",{className:"flex-shrink-0 bg-slate-900/95 backdrop-blur-sm p-4 border-b border-slate-700 flex items-center justify-between rounded-t-3xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center",children:n.jsx(Og,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-lg font-bold text-white",children:"Sleep Tracker"}),n.jsx("p",{className:"text-xs text-slate-400",children:"Track your sleep quality"})]})]}),n.jsx("button",{onClick:o,className:"p-2 hover:bg-slate-800 rounded-full transition",children:n.jsx(Gn,{className:"w-5 h-5 text-slate-400"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:[n.jsxs("div",{className:"p-3 sm:p-4 border-b border-slate-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-xl sm:text-2xl font-bold text-white truncate",children:new Date().toLocaleDateString("en-US",{weekday:"long"})}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:new Date().toLocaleDateString("en-US",{day:"numeric",month:"long"})})]}),n.jsx("button",{onClick:()=>I(!C),className:"p-2 hover:bg-slate-800 rounded-lg transition flex-shrink-0",children:n.jsx(yi,{className:"w-4 h-4 sm:w-5 sm:h-5 text-slate-400"})})]}),n.jsx("div",{className:"flex justify-between gap-1.5 sm:gap-2",children:Ne.map((Z,Ie)=>{const Ve=v.find(ne=>new Date(ne.date).toDateString()===Z.toDateString()),Pe=Z.toDateString()===new Date().toDateString();return n.jsx("div",{className:`flex-1 text-center ${Pe?"opacity-100":"opacity-60"}`,children:n.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 mx-auto rounded-full flex items-center justify-center mb-1 ${Ve?"bg-gradient-to-br from-purple-500 to-orange-600 ring-2 ring-orange-400/30":"bg-slate-800"} ${Pe?"ring-2 ring-white/30":""}`,children:n.jsx("span",{className:"text-[10px] sm:text-xs font-medium text-white",children:Z.toLocaleDateString("en-US",{weekday:"short"})[0]})})},Ie)})}),n.jsxs("div",{className:"mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-slate-700/50",children:[n.jsx("p",{className:"text-xs text-slate-400 mb-3 font-medium",children:"Weekly Sleep Pattern"}),n.jsx("div",{className:"flex items-end justify-between gap-1.5 sm:gap-2 h-24",children:Ne.map((Z,Ie)=>{const Ve=v.find(ve=>new Date(ve.date).toDateString()===Z.toDateString()),Pe=(Ve==null?void 0:Ve.hours)||0,ne=Pe>0?Math.max(Math.min(Pe/10*100,100),10):0;return n.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 min-w-[10px]",children:[n.jsx("div",{className:"w-full bg-slate-800 rounded-t-lg overflow-hidden relative",style:{height:"80px"},children:ne>0&&n.jsx("div",{className:"absolute bottom-0 w-full bg-gradient-to-t from-purple-500 to-orange-400 rounded-t-lg transition-all duration-700 ease-out",style:{height:`${ne}%`},children:n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent to-white/20"})})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] text-slate-500 font-medium",children:Z.toLocaleDateString("en-US",{weekday:"short"})[0]})]},Ie)})})]}),n.jsxs("div",{className:"p-3 sm:p-4 border-b border-slate-700/50",children:[n.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Sleep Preferences"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-2xl border border-slate-700",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"Usual Sleep"}),n.jsx("input",{type:"time",value:$,onChange:Z=>Y(Z.target.value,J),className:"bg-transparent text-white text-sm font-bold outline-none w-full"})]}),n.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-2xl border border-slate-700",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"Usual Wakeup"}),n.jsx("input",{type:"time",value:J,onChange:Z=>Y($,Z.target.value),className:"bg-transparent text-white text-sm font-bold outline-none w-full"})]})]})]})]}),n.jsxs("div",{className:"p-3 sm:p-6",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3 mb-4 sm:mb-6",children:[n.jsxs("div",{className:"relative w-24 h-24 sm:w-32 sm:h-32 flex-shrink-0",children:[n.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[n.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"#1e293b",strokeWidth:"10",fill:"none",className:"sm:hidden"}),n.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"#1e293b",strokeWidth:"12",fill:"none",className:"hidden sm:block"}),n.jsx("circle",{cx:"48",cy:"48",r:"42",stroke:"url(#gradient)",strokeWidth:"10",fill:"none",strokeDasharray:`${((he==null?void 0:he.quality)||0)*2.64} 264`,strokeLinecap:"round",className:"transition-all duration-1000 sm:hidden"}),n.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"url(#gradient)",strokeWidth:"12",fill:"none",strokeDasharray:`${((he==null?void 0:he.quality)||0)*3.51} 351`,strokeLinecap:"round",className:"transition-all duration-1000 hidden sm:block"}),n.jsx("defs",{children:n.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[n.jsx("stop",{offset:"0%",stopColor:"#f97316"}),n.jsx("stop",{offset:"100%",stopColor:"#fb923c"})]})})]}),n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[n.jsxs("span",{className:"text-2xl sm:text-3xl font-bold text-white",children:[(he==null?void 0:he.quality)||0,"%"]}),n.jsx("span",{className:"text-xs text-slate-400",children:"Quality"})]})]}),n.jsx("div",{className:"flex-1 min-w-0",children:n.jsxs("div",{className:"text-center sm:text-left",children:[n.jsx("span",{className:"text-2xl sm:text-3xl font-bold text-white block",children:c?`${se}h ${Ce}m`:he?`${he.hours}h ${he.minutes}m`:"0h 0m"}),n.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Time in bed"})]})})]}),C?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Enter sleep duration"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("input",{type:"number",value:O,onChange:Z=>R(Z.target.value),placeholder:"0",className:"w-full px-4 py-3 bg-slate-700 text-white placeholder-slate-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 text-center text-lg font-semibold",min:"0",max:"24"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1 text-center",children:"Hours"})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("input",{type:"number",value:k,onChange:Z=>M(Z.target.value),placeholder:"0",className:"w-full px-4 py-3 bg-slate-700 text-white placeholder-slate-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 text-center text-lg font-semibold",min:"0",max:"59"}),n.jsx("p",{className:"text-xs text-slate-500 mt-1 text-center",children:"Minutes"})]})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:ce,className:"flex-1 py-3 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-2xl font-semibold flex items-center justify-center gap-2 transition",children:[n.jsx(GA,{className:"w-4 h-4"}),"Save"]}),n.jsx("button",{onClick:()=>{I(!1),R(""),M("")},className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-2xl font-medium transition",children:"Cancel"})]})]}):n.jsx("div",{className:"space-y-2",children:c?n.jsxs("button",{onClick:Ae,className:"w-full py-3 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-xl font-semibold flex items-center justify-center gap-2 transition shadow-lg animate-pulse text-sm",children:[n.jsx(Vre,{className:"w-4 h-4"}),"Stop & Save Sleep"]}):n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:we,className:"flex-1 py-2.5 bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 text-white rounded-xl font-semibold flex items-center justify-center gap-1.5 transition shadow-lg text-xs",children:[n.jsx(Mre,{className:"w-3.5 h-3.5"}),"Start Sleep"]}),n.jsxs("button",{onClick:()=>I(!0),className:"flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-medium flex items-center justify-center gap-1.5 transition text-xs",children:[n.jsx(sQ,{className:"w-3.5 h-3.5"}),"Manual Edit"]})]})}),v.length>0&&n.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-700",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-400 mb-3",children:"Recent Sleep History"}),n.jsx("div",{className:"space-y-2",children:v.slice(0,3).map(Z=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-white",children:new Date(Z.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),n.jsxs("p",{className:"text-xs text-slate-400",children:[Z.hours,"h ",Z.minutes,"m ",Z.manual&&"(Manual)"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[Z.quality,"%"]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Quality"})]})]},Z.id))})]})]})]})]})}):null}const v6={food_reminder:{icon:lx,color:"#FF6B35",bg:"#FFF4EE"},sleep_reminder:{icon:Og,color:"#6C5CE7",bg:"#F3F0FF"},macro_update:{icon:XR,color:"#2FC8B9",bg:"#EEFBF9"},diet_adherence:{icon:lh,color:"#00B894",bg:"#E8FDF5"},health_insight:{icon:KA,color:"#E17055",bg:"#FFF0ED"},report_comparison:{icon:Hn,color:"#0984E3",bg:"#E8F4FD"},goal_progress:{icon:Ah,color:"#FDCB6E",bg:"#FFFBE8"}};function w6({isOpen:a,onClose:o,triggerRef:c}){const[d,h]=ee.useState([]),[p,g]=ee.useState(0),[x,v]=ee.useState(!1),E=ee.useRef(null),C=Ha(),[I,O]=ee.useState(null);ee.useEffect(()=>{a&&R()},[a]),ee.useEffect(()=>{k();const ie=setInterval(k,6e4);return()=>clearInterval(ie)},[]),ee.useEffect(()=>{const ie=we=>{E.current&&!E.current.contains(we.target)&&(c!=null&&c.current)&&!c.current.contains(we.target)&&o()};return a&&document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[a,o,c]);const R=async()=>{v(!0);try{const{data:ie}=await Fp.getAll();ie.success&&(h(ie.notifications),g(ie.unreadCount))}catch(ie){console.error("Failed to fetch notifications:",ie)}finally{v(!1)}},k=async()=>{try{const{data:ie}=await Fp.getUnreadCount();ie.success&&g(ie.unreadCount)}catch{}},M=async(ie,we)=>{try{await Fp.markAsRead(ie),h(Ae=>Ae.map(V=>V._id===ie?{...V,read:!0}:V)),g(Ae=>Math.max(0,Ae-1))}catch(Ae){console.error("Failed to mark as read:",Ae)}},P=async()=>{try{await Fp.markAllAsRead(),h(ie=>ie.map(we=>({...we,read:!0}))),g(0)}catch(ie){console.error("Failed to mark all as read:",ie)}},H=async(ie,we)=>{try{await Fp.deleteOne(ie),h(Ae=>Ae.filter(V=>V._id!==ie))}catch(Ae){console.error("Failed to delete:",Ae)}},$=async()=>{try{await Fp.clearAll(),h([]),g(0)}catch(ie){console.error("Failed to clear all:",ie)}},re=ie=>{ie.read||M(ie._id),O(we=>we===ie._id?null:ie._id)},J=(ie,we)=>{we.stopPropagation(),ie.actionUrl&&(C(ie.actionUrl),o())},ge=ie=>{const we=new Date(ie),V=new Date-we,ce=Math.floor(V/6e4),Y=Math.floor(V/36e5),z=Math.floor(V/864e5);return ce<1?"Just now":ce<60?`${ce}m ago`:Y<24?`${Y}h ago`:z<7?`${z}d ago`:we.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return a?n.jsxs("div",{ref:E,className:"fixed md:absolute top-16 md:top-14 right-2 md:right-0 w-[calc(100vw-16px)] md:w-[420px] max-h-[80vh] bg-white rounded-3xl shadow-2xl border border-slate-100 z-[100] overflow-hidden flex flex-col",style:{animation:"slideDown 0.3s ease-out forwards",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 12px 24px -6px rgba(0, 0, 0, 0.1)"},children:[n.jsxs("div",{className:"sticky top-0 bg-white/95 backdrop-blur-md px-5 py-4 border-b border-slate-100 flex items-center justify-between z-10 flex-shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center",children:n.jsx(dh,{className:"w-5 h-5 text-[#2FC8B9]"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-black text-black uppercase tracking-wider",children:"Notifications"}),p>0&&n.jsxs("p",{className:"text-[10px] text-[#2FC8B9] font-bold",children:[p," unread"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[d.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:P,className:"p-2 rounded-xl hover:bg-slate-100 transition-colors group",title:"Mark all as read",children:n.jsx(Qre,{className:"w-4 h-4 text-slate-400 group-hover:text-[#2FC8B9]"})}),n.jsx("button",{onClick:$,className:"p-2 rounded-xl hover:bg-red-50 transition-colors group",title:"Clear all",children:n.jsx(qp,{className:"w-4 h-4 text-slate-400 group-hover:text-red-500"})})]}),n.jsx("button",{onClick:o,className:"p-2 rounded-xl hover:bg-slate-100 transition-colors",children:n.jsx(Gn,{className:"w-4 h-4 text-slate-400"})})]})]}),n.jsx("div",{className:"overflow-y-auto flex-1",children:x?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"w-8 h-8 border-3 border-[#2FC8B9]/20 border-t-[#2FC8B9] rounded-full animate-spin"})}):d.length===0?n.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-8 text-center",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-50 flex items-center justify-center mb-4",children:n.jsx(dh,{className:"w-8 h-8 text-slate-300"})}),n.jsx("p",{className:"text-sm font-bold text-slate-500",children:"No notifications yet"}),n.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"We'll notify you about meals, sleep, and health progress"})]}):n.jsx("div",{className:"py-2",children:d.map(ie=>{const we=v6[ie.type]||v6.health_insight,Ae=we.icon,V=I===ie._id;return n.jsxs("div",{onClick:()=>re(ie),className:`group flex items-start gap-3 px-5 py-4 cursor-pointer transition-all
                    ${ie.read?"hover:bg-slate-50":"bg-[#2FC8B9]/[0.03]"}
                    border-b border-slate-50 last:border-b-0`,children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl flex-shrink-0 flex items-center justify-center mt-0.5 transition-transform group-hover:scale-105",style:{backgroundColor:we.bg},children:n.jsx(Ae,{className:"w-5 h-5",style:{color:we.color}})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsx("h4",{className:`text-sm leading-tight ${ie.read?"font-bold text-slate-700":"font-black text-black"}`,children:ie.title}),!ie.read&&n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#2FC8B9] flex-shrink-0 mt-1.5 animate-pulse"})]}),n.jsx("p",{className:`text-xs text-slate-500 mt-1 leading-relaxed ${V?"":"line-clamp-2"}`,children:ie.message}),V&&ie.actionUrl&&n.jsx("button",{onClick:ce=>J(ie,ce),className:"mt-3 text-xs font-bold px-3 py-1.5 rounded-lg bg-[#2FC8B9]/10 text-[#2FC8B9] hover:bg-[#2FC8B9]/20 transition-colors",children:"View Details"}),ie.type==="macro_update"&&ie.metadata&&n.jsx("div",{className:"flex gap-2 mt-2 flex-wrap",children:["calories","protein","carbs","fats"].map(ce=>{var te;const Y=(te=ie.metadata)==null?void 0:te[ce];if(!Y)return null;const z=Y.pct||0;return n.jsxs("div",{className:"px-2 py-1 rounded-lg text-[10px] font-bold",style:{backgroundColor:z>=80&&z<=110?"#EEFBF9":z>110?"#FFF0ED":"#FFF8E1",color:z>=80&&z<=110?"#2FC8B9":z>110?"#E17055":"#F39C12"},children:[ce.charAt(0).toUpperCase()+ce.slice(1),": ",z,"%"]},ce)})}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx(Oc,{className:"w-3 h-3 text-slate-300"}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:ge(ie.createdAt)})]})]}),n.jsxs("div",{className:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 mt-1",children:[!ie.read&&n.jsx("button",{onClick:ce=>{ce.stopPropagation(),M(ie._id)},className:"p-1.5 rounded-lg hover:bg-[#2FC8B9]/10 transition-colors",title:"Mark as read",children:n.jsx(GA,{className:"w-3.5 h-3.5 text-[#2FC8B9]"})}),n.jsx("button",{onClick:ce=>{ce.stopPropagation(),H(ie._id)},className:"p-1.5 rounded-lg hover:bg-red-50 transition-colors",title:"Delete",children:n.jsx(Gn,{className:"w-3.5 h-3.5 text-red-400"})})]})]},ie._id)})})}),n.jsx("style",{children:`
        @keyframes slideDown {
          from { opacity: 0; transform: translateY(-10px) scale(0.98); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]}):null}function bce(){const[a,o]=ee.useState(0);return ee.useEffect(()=>{const c=async()=>{try{const{data:h}=await Fp.getUnreadCount();h.success&&o(h.unreadCount)}catch{}};c();const d=setInterval(c,6e4);return()=>clearInterval(d)},[]),a}function xce(){var Te,Be,Ue,tt,ot,ut,Tt,Qe,it,kt,_e,xt,Ke,Je,$e,jt,Kt,os,ss,mt,Ht,qe,ht,Xt,zt,ds,Qt,Us,bs,cs,Ds,zs,rs,Gs;const{user:a}=da(),o=Ha(),{dashboardData:c,loading:d,fetchDashboard:h,fetchNutrition:p,nutritionData:g,fetchDietPlan:x}=lH(),[v,E]=ee.useState(0),[C,I]=ee.useState(!c),[O,R]=ee.useState(null),[k,M]=ee.useState(!1),[P,H]=ee.useState(""),[$,re]=ee.useState(!1),[J,ge]=ee.useState(new Date),[ie,we]=ee.useState(null),[Ae,V]=ee.useState(!1),ce=ee.useRef(null),Y=bce(),[z,te]=ee.useState(null),[se,Ce]=ee.useState(!0),he=()=>{const dt=new Date(J);dt.setDate(dt.getDate()-1),ge(dt)},Ne=()=>{const dt=new Date(J);dt.setDate(dt.getDate()+1),ge(dt)},Z=()=>{const dt=new Date().getHours();return dt<12?"Morning":dt<18?"Afternoon":"Evening"};if(ee.useEffect(()=>{(async()=>{const[Pt,qt]=await Promise.all([h(),x()]);qt&&we(qt),I(!1)})()},[h,x]),ee.useEffect(()=>{(async()=>{try{Ce(!0);const{data:Pt}=await sd.getReportComparison();te(Pt)}catch(Pt){console.error("Failed to fetch report comparison:",Pt)}finally{Ce(!1)}})()},[]),ee.useEffect(()=>{const dt=J.toISOString().split("T")[0];p(dt)},[J,p]),ee.useEffect(()=>{!c&&!d.dashboard&&!C&&h()},[c,d.dashboard,h,C]),ee.useEffect(()=>{var dt;if(((dt=c==null?void 0:c.recentReports)==null?void 0:dt.length)>0&&!O){const Pt=c.recentReports.find(qt=>{var Yt;return(Yt=qt.aiAnalysis)==null?void 0:Yt.metrics});if(Pt){const qt=Object.keys(Pt.aiAnalysis.metrics)[0];qt&&R(qt)}}},[c,O]),ee.useEffect(()=>{const dt=()=>{!document.hidden&&c&&h(!0)};return document.addEventListener("visibilitychange",dt),()=>document.removeEventListener("visibilitychange",dt)},[h,c]),ee.useEffect(()=>{var dt,Pt,qt;if(c){let Yt=0;const us=4;(dt=a==null?void 0:a.profile)!=null&&dt.age&&((Pt=a==null?void 0:a.profile)!=null&&Pt.gender)&&Yt++,((qt=c.recentReports)==null?void 0:qt.length)>0&&Yt++,c.nutritionTracked&&Yt++,c.wearableConnected&&Yt++;const Ws=Math.round(Yt/us*100);setTimeout(()=>E(Ws),300)}},[c,a]),C&&d.dashboard&&!c)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-[#2FC8B9]/20 border-t-[#2FC8B9] rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500 font-bold",children:"Loading your health dashboard..."})]})});const Ie=((Te=c==null?void 0:c.recentReports)==null?void 0:Te.length)>0;(Be=a==null?void 0:a.profile)!=null&&Be.age&&((Ue=a==null?void 0:a.profile)==null||Ue.gender),c==null||c.nutritionTracked,c==null||c.wearableConnected;const Ve=((ot=(tt=c==null?void 0:c.user)==null?void 0:tt.healthMetrics)==null?void 0:ot.healthScore)||((ut=c==null?void 0:c.latestAnalysis)==null?void 0:ut.healthScore),Pe={};c!=null&&c.recentReports&&c.recentReports.forEach(dt=>{var Pt;(Pt=dt.aiAnalysis)!=null&&Pt.metrics&&Object.entries(dt.aiAnalysis.metrics).forEach(([qt,Yt])=>{Pe[qt]||(Pe[qt]={name:qt.replace(/([A-Z])/g," $1").trim(),unit:Yt.unit||"",history:[]})})}),Object.keys(Pe).forEach(dt=>{var Pt;(Pt=c==null?void 0:c.recentReports)==null||Pt.forEach(qt=>{var us,Ws;const Yt=(Ws=(us=qt.aiAnalysis)==null?void 0:us.metrics)==null?void 0:Ws[dt];Yt&&Pe[dt].history.push({date:new Date(qt.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:parseFloat(Yt.value)||0,fullDate:new Date(qt.createdAt)})}),Pe[dt].history.sort((qt,Yt)=>qt.fullDate-Yt.fullDate)});const ne=Object.keys(Pe),ve=O||ne[0],ue=Pe[ve];return n.jsxs("div",{className:"min-h-screen bg-white font-roboto",children:[d.dashboard&&c&&n.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-white rounded-full shadow-lg px-4 py-2 flex items-center gap-2 animate-slide-in-right border border-[#2FC8B9]/10",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-[#2FC8B9]/30 border-t-[#2FC8B9] rounded-full animate-spin"}),n.jsx("span",{className:"text-sm text-slate-500 font-bold",children:"Refreshing..."})]}),n.jsxs("div",{className:"w-full mx-auto space-y-6 animate-fade-in pb-20 px-0 md:px-4",children:[n.jsxs("div",{className:"pt-4 space-y-3 md:hidden px-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:()=>o("/profile"),className:"w-12 h-12 rounded-full overflow-hidden shadow-md border-2 border-[#2FC8B9] hover:scale-105 transition-transform flex-shrink-0",children:a!=null&&a.profilePicture?n.jsx("img",{src:a.profilePicture,alt:a==null?void 0:a.name,className:"w-full h-full object-cover"}):n.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center text-white text-lg font-black",children:((Qe=(Tt=a==null?void 0:a.name)==null?void 0:Tt[0])==null?void 0:Qe.toUpperCase())||"U"})}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-lg font-black text-black flex items-center gap-2",children:[Z(),", ",n.jsxs("span",{className:"text-[#2FC8B9]",children:[((it=a==null?void 0:a.name)==null?void 0:it.split(" ")[0])||"there","!"]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 uppercase tracking-widest font-black",children:[n.jsxs("span",{children:[(g==null?void 0:g.totalCalories)||0," cal"]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{className:"text-emerald-500",children:[Ve||82,"% Score"]})]})]})]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{ref:ce,onClick:()=>V(!Ae),className:"w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all",children:[n.jsx(dh,{className:"w-5 h-5 text-slate-700"}),Y>0&&n.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-[9px] font-black animate-pulse",children:Y>9?"9+":Y})]}),n.jsx(w6,{isOpen:Ae,onClose:()=>V(!1),triggerRef:ce})]})]}),n.jsxs("button",{onClick:()=>o("/upload"),className:"w-full bg-gradient-to-r from-[#2FC8B9] to-[#1db7a6] text-white rounded-2xl px-6 py-4 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl transition-all active:scale-95",children:[n.jsx(lo,{className:"w-5 h-5"}),n.jsx("span",{className:"text-sm font-black uppercase tracking-wider",children:"Upload Report"})]})]}),n.jsxs("div",{className:"pt-8 space-y-6 hidden md:block px-3 md:px-0",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsxs("button",{onClick:()=>o("/profile"),className:"w-16 h-16 rounded-[1.5rem] overflow-hidden shadow-inner border-2 border-[#2FC8B9]/10 relative group hover:scale-105 transition-transform flex-shrink-0",children:[n.jsx("div",{className:"absolute inset-0 bg-[#2FC8B9]/5 rounded-[1.5rem] blur-xl opacity-0 group-hover:opacity-100 transition-opacity"}),a!=null&&a.profilePicture?n.jsx("img",{src:a.profilePicture,alt:a==null?void 0:a.name,className:"w-full h-full object-cover"}):n.jsx("div",{className:"w-full h-full bg-slate-50 flex items-center justify-center text-[#2FC8B9] text-2xl font-black",children:((_e=(kt=a==null?void 0:a.name)==null?void 0:kt[0])==null?void 0:_e.toUpperCase())||"U"})]}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-3xl font-black text-black tracking-tighter uppercase leading-none",children:["Welcome, ",((xt=a==null?void 0:a.name)==null?void 0:xt.split(" ")[0])||"User"]}),n.jsxs("div",{className:"flex items-center gap-4 mt-2 text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:[n.jsxs("span",{className:"flex items-center gap-1.5",children:[n.jsx(ul,{className:"w-3.5 h-3.5 text-orange-500"})," ",((Ke=c==null?void 0:c.nutritionData)==null?void 0:Ke.totalCalories)||0," kcal burned"]}),n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-200"}),n.jsxs("span",{className:"flex items-center gap-1.5",children:[n.jsx(br,{className:"w-3.5 h-3.5 text-[#2FC8B9]"})," ",(($e=(Je=c==null?void 0:c.user)==null?void 0:Je.healthMetrics)==null?void 0:$e.healthScore)||82,"% Efficiency"]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-3 relative",children:[n.jsxs("button",{ref:ce,onClick:()=>V(!Ae),className:"w-12 h-12 rounded-2xl bg-white border border-slate-100 shadow-sm flex items-center justify-center text-slate-400 hover:text-black hover:border-black transition-all group relative",children:[n.jsx(dh,{className:"w-6 h-6 group-hover:animate-swing"}),Y>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-[9px] font-black animate-pulse",children:Y>9?"9+":Y})]}),n.jsx(w6,{isOpen:Ae,onClose:()=>V(!1),triggerRef:ce})]})]}),n.jsxs("button",{onClick:()=>o("/upload"),className:"w-full bg-gradient-to-r from-[#2FC8B9] to-[#1db7a6] text-white rounded-[2rem] px-8 py-6 flex items-center justify-center gap-4 shadow-xl hover:shadow-2xl transition-all active:scale-[0.98] group",children:[n.jsx(lo,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-base font-black uppercase tracking-widest",children:"Upload Health Report"})]})]}),n.jsx("div",{className:"px-3 md:px-0 mb-6 font-roboto",children:n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 shadow-xl border border-slate-100 relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-[#2FC8B9]/10 rounded-full blur-3xl"}),n.jsxs("div",{className:"flex items-center justify-between mb-8 px-2 relative z-10",children:[n.jsx("button",{onClick:he,className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-black transition-all hover:bg-[#2FC8B9] hover:text-white hover:scale-110 active:scale-95",children:n.jsx(Vn,{className:"w-5 h-5"})}),n.jsxs("h2",{className:"text-base sm:text-lg font-black text-black flex items-center gap-2 tracking-tight",children:[J.toDateString()===new Date().toDateString()?"Today, ":"",J.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"})]}),n.jsx("button",{onClick:Ne,className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-black transition-all hover:bg-[#2FC8B9] hover:text-white hover:scale-110 active:scale-95 rotate-180",children:n.jsx(Vn,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex justify-between items-end gap-1 overflow-visible pb-2 sm:overflow-x-auto sm:scrollbar-hide",children:(()=>{const dt=["Su","Mo","Tu","We","Th","Fr","Sa"],Pt=[],qt=new Date(J);qt.setDate(qt.getDate()-3);for(let Yt=0;Yt<7;Yt++){const us=new Date(qt);us.setDate(us.getDate()+Yt),Pt.push({label:dt[us.getDay()],date:us.getDate(),fullDate:us,isToday:us.toDateString()===new Date().toDateString()})}return Pt.map((Yt,us)=>{var In,On;const Ws=Yt.isToday,ji=J.toDateString()===Yt.fullDate.toDateString();let qr=0;const Ga=Yt.fullDate.toDateString(),ti=ji?g:null,Fs=ti!=null&&ti.totalCalories&&(ti!=null&&ti.calorieGoal)?Math.min(ti.totalCalories/ti.calorieGoal*100,100):0,pn=((On=(In=c==null?void 0:c.user)==null?void 0:In.challengeData)==null?void 0:On[Yt.date])||{},vt=Object.values(pn).filter(Boolean).length/4*100,Js=JSON.parse(localStorage.getItem("sleep_history")||"[]").find(Xr=>new Date(Xr.date).toDateString()===Ga);let Os=0;if(Js){const Xr=parseInt(Js.hours)*60+parseInt(Js.minutes);Os=Math.min(Xr/480*100,100)}const jr=Fs>0?100:0;return ji?qr=Math.round(Fs*.3+Os*.2+vt*.3+jr*.2):(qr=vt,Os>0&&(qr=Math.round(qr*.6+Os*.4)),qr===0&&Yt.fullDate<new Date&&(qr=Yt.date%3===0?100:Yt.date%2===0?60:30)),n.jsxs("div",{className:"flex flex-col items-center gap-2 flex-1 min-w-0 cursor-pointer relative z-10",onClick:()=>ge(Yt.fullDate),children:[n.jsx("span",{className:`text-[9px] font-black uppercase tracking-tight transition-colors ${ji?"text-[#2FC8B9]":"text-slate-500"}`,children:Yt.label}),n.jsxs("div",{className:`w-9 h-9 sm:w-12 sm:h-12 rounded-full flex items-center justify-center relative transition-all duration-300 ${ji?"bg-white shadow-[0_0_20px_rgba(47,200,185,0.4)] scale-110 ring-2 ring-[#2FC8B9]":"bg-slate-50 hover:bg-slate-100 border border-slate-100"}`,children:[n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",viewBox:"0 0 48 48",children:[n.jsx("circle",{cx:"24",cy:"24",r:"21",fill:"none",stroke:ji?"#F8FAFC":"rgba(255,255,255,0.1)",strokeWidth:"3"}),n.jsx("circle",{cx:"24",cy:"24",r:"21",fill:"none",stroke:"#2FC8B9",strokeWidth:"3",strokeDasharray:`${qr/100*132} 132`,strokeLinecap:"round",className:"transition-all duration-1000"})]}),Ws?n.jsx(ul,{className:`w-5 h-5 ${ji?"text-orange-500 fill-orange-500":"text-orange-400"}`}):null]}),n.jsx("span",{className:`text-xs font-black transition-all ${ji?"text-black scale-110":"text-slate-400"}`,children:Yt.date})]},us)})})()})]})}),n.jsx(gce,{isOpen:$,onClose:()=>re(!1)}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-6 px-3 md:px-0",children:[n.jsxs(Hs,{to:"/nutrition",className:"card p-4 sm:p-6 group relative overflow-hidden bg-white border border-slate-100",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-[#2FC8B9]/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center justify-between mb-3 relative z-10",children:[n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-sm",children:n.jsx(ul,{className:"w-6 h-6 sm:w-7 sm:h-7 text-[#2FC8B9]"})}),(g==null?void 0:g.averageHealthScore)>0&&n.jsxs("div",{className:`px-2 py-1 rounded-lg text-[10px] font-black shadow-lg flex flex-col items-center justify-center min-w-[36px] ${g.averageHealthScore>=80?"bg-[#2FC8B9] text-white":g.averageHealthScore>=60?"bg-amber-400 text-white":"bg-rose-500 text-white"}`,children:[n.jsx("span",{className:"leading-none",children:Math.round(g.averageHealthScore)}),n.jsx("span",{className:"text-[6px] opacity-80 tracking-tighter uppercase font-black",children:"Score"})]})]}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Nutrition"}),n.jsxs("p",{className:"text-2xl sm:text-3xl font-black text-black mb-1 relative z-10",children:[(g==null?void 0:g.totalCalories)||0," ",n.jsx("span",{className:"text-base sm:text-lg opacity-40 font-medium",children:"kcal"})]}),n.jsx("p",{className:"text-[10px] sm:text-xs text-[#2FC8B9] font-black uppercase tracking-widest relative z-10",children:g!=null&&g.calorieGoal?`${Math.round(g.totalCalories/g.calorieGoal*100)}% Goal`:"Track meals"})]}),n.jsxs("button",{onClick:()=>re(!0),className:"card p-4 sm:p-6 group relative overflow-hidden text-left bg-white border border-slate-100",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-[#2FC8B9]/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-sm",children:n.jsx(Og,{className:"w-6 h-6 sm:w-7 sm:h-7 text-[#2FC8B9]"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Sleep"}),n.jsx("p",{className:"text-2xl sm:text-3xl font-black text-black mb-1 relative z-10",children:(()=>{const dt=JSON.parse(localStorage.getItem("sleep_history")||"[]"),Pt=J.toDateString(),qt=dt.find(Yt=>new Date(Yt.date).toDateString()===Pt);return qt?`${qt.hours}h ${qt.minutes}m`:"0h 0m"})()}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-bold relative z-10",children:(()=>{const dt=JSON.parse(localStorage.getItem("sleep_history")||"[]"),Pt=J.toDateString(),qt=dt.find(Yt=>new Date(Yt.date).toDateString()===Pt);if(qt){const Yt=qt.hours*60+qt.minutes;return`${Math.round(Yt/480*100)}% Efficiency`}return"Track sleep"})()})]}),n.jsxs(Hs,{to:"/diet-plan",className:"card p-4 sm:p-6 group relative overflow-hidden bg-white border border-slate-100",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-[#2FC8B9]/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-sm",children:n.jsx(lx,{className:"w-6 h-6 sm:w-7 sm:h-7 text-[#2FC8B9]"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Diet Plan"}),n.jsx("p",{className:"text-base sm:text-lg font-black text-black mb-1 relative z-10 leading-tight",children:(()=>{if(!ie)return"No active plan";const dt=new Date().getHours();return dt<9?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Breakfast"]}):dt>=9&&dt<14?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Lunch"]}):dt>=14&&dt<17?n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Snacks"]}):n.jsxs(n.Fragment,{children:["Upcoming ",n.jsx("br",{})," Dinner"]})})()}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-bold relative z-10",children:ie?"Personalized plan":"Generate plan"})]}),n.jsxs(Hs,{to:"/challenge",className:"card p-4 sm:p-6 group relative overflow-hidden bg-white border border-slate-100",children:[n.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-[#2FC8B9]/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsx("div",{className:"flex items-center justify-between mb-3 relative z-10",children:n.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center group-hover:rotate-12 transition-transform shadow-sm",children:n.jsx(Hre,{className:"w-6 h-6 sm:w-7 sm:h-7 text-[#2FC8B9]"})})}),n.jsx("h3",{className:"text-slate-500 text-[10px] sm:text-xs font-black mb-1 uppercase tracking-[0.15em] relative z-10",children:"Mind"}),n.jsxs("p",{className:"text-2xl sm:text-3xl font-black text-black mb-1 relative z-10",children:[(c==null?void 0:c.streakDays)||(a==null?void 0:a.challengeStreak)||0," ",n.jsx("span",{className:"text-base sm:text-lg opacity-40 font-medium",children:"days"})]}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-400 font-bold relative z-10 text-[#2FC8B9]",children:"Daily Streak"})]})]}),n.jsxs(Hs,{to:"/glucose-log",className:"block bg-white rounded-[2.5rem] shadow-sm p-6 sm:p-8 hover:shadow-xl transition-all group relative overflow-hidden border border-slate-100 mx-3 md:mx-0",children:[n.jsx("div",{className:"absolute bottom-4 right-4 opacity-[0.03] pointer-events-none",children:n.jsx(Kb,{className:"w-32 h-32 text-[#2FC8B9]"})}),n.jsxs("div",{className:"relative z-10",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-black flex items-center justify-center shadow-lg",children:n.jsx(Kb,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsx("span",{className:"text-xs font-black text-black uppercase tracking-[0.2em]",children:"Diabetes Care"})]}),n.jsx("span",{className:"px-4 py-1.5 bg-[#2FC8B9] text-white rounded-full text-[10px] font-black shadow-sm tracking-widest uppercase",children:"IN RANGE"})]}),n.jsxs("div",{className:"flex items-baseline gap-3 mb-2",children:[n.jsx("span",{className:"text-5xl font-black text-black tracking-tighter",children:(()=>{const dt=JSON.parse(localStorage.getItem("glucoseData")||"[]");return dt.length>0?dt[0].value:108})()}),n.jsx("span",{className:"text-xs text-slate-400 font-black tracking-widest uppercase",children:"MG/DL"})]}),n.jsx("p",{className:"text-slate-500 text-sm mb-6 leading-relaxed max-w-sm font-bold",children:"Your fasting glucose is stable. Tap to log your next reading or view progress."}),n.jsxs("div",{className:"flex items-center gap-2 text-[#2FC8B9] font-black text-xs uppercase tracking-widest group-hover:gap-4 transition-all",children:[n.jsx("span",{children:"Enter Care Center"}),n.jsx(Ju,{className:"w-4 h-4"})]})]})]}),Ie&&n.jsxs("div",{className:"space-y-6 mx-3 md:mx-0",children:[n.jsxs("div",{className:"bg-[#2FC8B9] rounded-[2.5rem] p-8 sm:p-10 shadow-2xl relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl pointer-events-none"}),n.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl pointer-events-none"}),n.jsx(KA,{className:"absolute top-8 right-12 w-16 h-16 text-white/20 group-hover:scale-110 transition-transform duration-500"}),n.jsxs("div",{className:"relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[n.jsx(KA,{className:"w-5 h-5 text-white"}),n.jsx("span",{className:"text-xs font-black text-white uppercase tracking-[0.2em]",children:"AI Insights"})]}),n.jsxs("h2",{className:"text-2xl sm:text-3xl font-black text-white mb-4 tracking-tight leading-tight",children:[((jt=c.recentReports[0])==null?void 0:jt.reportType)||"Health Report"," Analysis",n.jsxs("span",{className:"block text-lg font-medium text-white/90 mt-1",children:["(",new Date((Kt=c.recentReports[0])==null?void 0:Kt.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),")"]})]}),n.jsxs("p",{className:"text-white/80 text-sm sm:text-base leading-relaxed mb-10 max-w-xl font-bold italic",children:['"',(ss=(os=c.latestAnalysis)==null?void 0:os.summary)==null?void 0:ss.split(".")[0],"... ",(Ht=(mt=c.latestAnalysis)==null?void 0:mt.summary)==null?void 0:Ht.split(".")[1],'."']}),n.jsxs(Hs,{to:`/reports/${(qe=c.recentReports[0])==null?void 0:qe._id}`,className:"inline-flex items-center gap-3 bg-black text-white px-10 py-5 rounded-2xl font-black uppercase tracking-widest transition-all hover:bg-slate-900 shadow-xl group",children:["Analysis Details",n.jsx(Ju,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})]}),n.jsx("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-10 shadow-sm border border-slate-100 relative overflow-hidden",children:se?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"w-10 h-10 border-3 border-[#2FC8B9]/20 border-t-[#2FC8B9] rounded-full animate-spin"})}):z!=null&&z.hasData?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-xs font-black text-[#2FC8B9] uppercase tracking-widest",children:"Health Progress"}),n.jsxs("div",{className:"flex items-baseline gap-3 mt-3",children:[n.jsxs("span",{className:"text-5xl sm:text-6xl font-black text-black tracking-tighter",children:[z.latestReport.healthScore,"%"]}),z.hasComparison&&z.scoreChange!==0&&n.jsxs("span",{className:`flex items-center gap-1 text-sm font-black ${z.scoreChange>0?"text-emerald-500":"text-red-500"}`,children:[z.scoreChange>0?n.jsx(qi,{className:"w-4 h-4"}):n.jsx(ah,{className:"w-4 h-4"}),z.scoreChange>0?"+":"",z.scoreChange]})]})]}),n.jsxs("div",{className:"text-right",children:[z.hasComparison?n.jsx("div",{className:`px-3 py-1.5 rounded-xl text-xs font-black ${z.scoreChange>0?"bg-emerald-50 text-emerald-600":z.scoreChange<0?"bg-red-50 text-red-500":"bg-slate-50 text-slate-500"}`,children:z.scoreChange>0?" Improved":z.scoreChange<0?" Declined":" Stable"}):n.jsx("div",{className:"px-3 py-1.5 rounded-xl text-xs font-black bg-[#2FC8B9]/10 text-[#2FC8B9]",children:" Baseline Set"}),n.jsxs("p",{className:"text-[10px] text-slate-400 font-bold mt-2 uppercase tracking-wider",children:[z.totalReports," report",z.totalReports>1?"s":""," analyzed"]})]})]}),n.jsx("div",{className:"h-48 sm:h-56 w-full mt-4 -mx-2 sm:mx-0",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(Gre,{data:z.scoreHistory,margin:{top:10,right:10,left:-15,bottom:5},children:[n.jsx(Eg,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),n.jsx(Cg,{dataKey:"dateLabel",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700}}),n.jsx(Sg,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700},domain:[0,100]}),n.jsx(ex,{content:({active:dt,payload:Pt})=>dt&&Pt&&Pt.length?n.jsxs("div",{className:"bg-black shadow-2xl rounded-2xl p-4 border border-[#2FC8B9]/20",children:[n.jsx("p",{className:"text-[10px] font-black text-[#2FC8B9] uppercase mb-1 tracking-wider",children:Pt[0].payload.dateLabel}),n.jsxs("p",{className:"text-sm font-black text-white",children:[Pt[0].value,"% Health Score"]}),n.jsx("p",{className:"text-[10px] text-white/60 mt-1",children:Pt[0].payload.type})]}):null}),n.jsx(Kre,{dataKey:"score",fill:"#2FC8B9",radius:[8,8,0,0],maxBarSize:40})]})})}),((ht=z.comparisonMetrics)==null?void 0:ht.length)>0&&n.jsxs("div",{className:"mt-6",children:[n.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase tracking-widest mb-4",children:"Biomarker Comparison"}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:z.comparisonMetrics.slice(0,6).map((dt,Pt)=>n.jsxs("div",{className:"bg-slate-50 rounded-2xl p-3 border border-slate-100",children:[n.jsx("p",{className:"text-[10px] text-slate-500 font-bold truncate",children:dt.name}),n.jsxs("div",{className:"flex items-end gap-1 mt-1",children:[n.jsx("span",{className:"text-lg font-black text-black",children:dt.latestValue}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold mb-0.5",children:dt.unit})]}),dt.change!==0&&n.jsxs("div",{className:`flex items-center gap-1 mt-1 text-[10px] font-black ${dt.changePercent>0?"text-emerald-500":"text-red-500"}`,children:[dt.changePercent>0?n.jsx(qi,{className:"w-3 h-3"}):n.jsx(ah,{className:"w-3 h-3"}),dt.changePercent>0?"+":"",dt.changePercent,"% from last"]})]},Pt))})]}),((Xt=z.insights)==null?void 0:Xt.length)>0&&n.jsxs("div",{className:"mt-8",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(KA,{className:"w-4 h-4 text-[#2FC8B9]"}),n.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"AI Analysis"})]}),n.jsx("div",{className:"space-y-3",children:z.insights.map((dt,Pt)=>{const qt=dt.type==="positive",Yt=dt.type==="warning";return n.jsxs("div",{className:`relative overflow-hidden rounded-2xl p-4 flex items-start gap-4 transition-all hover:shadow-md
                                  ${qt?"bg-gradient-to-r from-emerald-50 to-white border border-emerald-100":Yt?"bg-gradient-to-r from-orange-50 to-white border border-orange-100":"bg-gradient-to-r from-blue-50 to-white border border-blue-100"}`,children:[n.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${qt?"bg-emerald-400":Yt?"bg-orange-400":"bg-blue-400"}`}),n.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${qt?"bg-emerald-100 text-emerald-600":Yt?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:qt?n.jsx(qi,{className:"w-4 h-4"}):Yt?n.jsx(ah,{className:"w-4 h-4"}):n.jsx(br,{className:"w-4 h-4"})}),n.jsx("div",{className:"flex-1",children:n.jsx("p",{className:`text-sm font-bold leading-relaxed ${qt?"text-emerald-900":Yt?"text-orange-900":"text-blue-900"}`,children:dt.text})}),n.jsx("div",{className:"text-xl opacity-20 hidden sm:block",children:dt.icon})]},Pt)})})]})]}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-[#2FC8B9]/10 flex items-center justify-center mx-auto mb-4",children:n.jsx(XR,{className:"w-8 h-8 text-[#2FC8B9]"})}),n.jsx("h3",{className:"text-xl font-black text-black mb-2",children:"Health Progress Tracking"}),n.jsx("p",{className:"text-sm text-slate-500 font-bold max-w-sm mx-auto mb-6",children:(z==null?void 0:z.message)||"Upload at least 2 health reports to see your progress comparison and trends."}),((zt=c==null?void 0:c.healthScores)==null?void 0:zt.length)>0&&n.jsx("div",{className:"h-32 w-full mt-4 -mx-2",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(By,{data:((ds=c.healthScores)==null?void 0:ds.slice(-7))||[],children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"scoreGradient2",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#2FC8B9",stopOpacity:.1}),n.jsx("stop",{offset:"95%",stopColor:"#2FC8B9",stopOpacity:0})]})}),n.jsx(Ly,{type:"monotone",dataKey:"score",stroke:"#2FC8B9",strokeWidth:3,fillOpacity:1,fill:"url(#scoreGradient2)"})]})})}),n.jsxs(Hs,{to:"/upload",className:"inline-flex items-center gap-2 mt-4 px-6 py-3 bg-[#2FC8B9] text-white rounded-2xl font-black text-sm uppercase tracking-wider hover:bg-[#1db7a6] transition-all shadow-lg",children:[n.jsx(lo,{className:"w-4 h-4"}),"Upload Report"]})]})}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("h3",{className:"text-lg font-black text-black tracking-tight uppercase",children:"Biomarker Trends"}),n.jsxs("button",{className:"text-[#2FC8B9] text-xs font-black uppercase tracking-widest flex items-center gap-1 group",children:["View All",n.jsx(To,{className:"w-3 h-3 group-hover:gap-2 transition-all"})]})]}),n.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>M(!k),className:"w-full bg-slate-50 rounded-3xl p-4 sm:p-6 border border-slate-100 flex items-center justify-between hover:border-[#2FC8B9]/20 transition-all text-left",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-black font-black block sm:inline",children:(ue==null?void 0:ue.name)||"Core Biomarker"}),ue&&ue.history.length>0&&n.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider mt-1",children:["Current: ",(Qt=ue.history[ue.history.length-1])==null?void 0:Qt.value," ",ue.unit]})]}),n.jsx(Ju,{className:`w-5 h-5 text-[#2FC8B9] transition-transform ${k?"rotate-[-90deg]":"rotate-90"}`})]}),k&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-3xl shadow-2xl border border-slate-100 z-50 py-4 max-h-64 overflow-y-auto anima-fade-in",children:ne.map(dt=>n.jsx("button",{onClick:()=>{R(dt),M(!1)},className:`w-full px-6 py-4 text-left hover:bg-slate-50 transition-colors text-sm font-bold ${O===dt?"text-[#2FC8B9]":"text-slate-600"}`,children:Pe[dt].name},dt))})]}),n.jsx("div",{className:"h-64 sm:h-72 w-full relative -mx-2 sm:mx-0 pr-4 sm:pr-0",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(By,{data:(ue==null?void 0:ue.history)||[],margin:{top:20,right:30,left:0,bottom:20},children:[n.jsx(Eg,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),n.jsx(Cg,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700},dy:8,interval:"preserveStartEnd",minTickGap:20}),n.jsx(Sg,{axisLine:!1,tickLine:!1,tick:{fill:"#64748b",fontSize:10,fontWeight:700},dx:-8,width:45,domain:["dataMin - 1","dataMax + 1"]}),n.jsx(ex,{content:({active:dt,payload:Pt})=>dt&&Pt&&Pt.length?n.jsxs("div",{className:"bg-black shadow-2xl rounded-2xl p-4 border border-[#2FC8B9]/20 shadow-[#2FC8B9]/10",children:[n.jsx("p",{className:"text-[10px] font-black text-[#2FC8B9] uppercase mb-1 tracking-wider",children:Pt[0].payload.date}),n.jsxs("p",{className:"text-sm font-black text-white",children:[Pt[0].value," ",ue==null?void 0:ue.unit]})]}):null}),n.jsx(Ly,{type:"monotone",dataKey:"value",stroke:"#2FC8B9",strokeWidth:4,fill:"#2FC8B9",fillOpacity:.05,dot:{r:5,fill:"#2FC8B9",strokeWidth:3,stroke:"#fff"},activeDot:{r:7,fill:"#2FC8B9",strokeWidth:3,stroke:"#fff",shadow:"0 0 15px rgba(47,200,185,0.4)"}})]})})}),ue&&n.jsxs("div",{className:"bg-[#F0FDF4] rounded-3xl p-5 sm:p-6 border border-emerald-100 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-slate-800 mb-1",children:ue.name}),n.jsx("p",{className:"text-[10px] sm:text-xs text-slate-500 font-medium lowercase",children:"Target: Normal Range"}),n.jsxs("div",{className:"flex items-baseline gap-2 mt-2 sm:mt-4",children:[n.jsx("span",{className:"text-3xl sm:text-4xl font-black text-emerald-600",children:(Us=ue.history[ue.history.length-1])==null?void 0:Us.value}),n.jsx("span",{className:"text-xs sm:text-sm font-bold text-emerald-600/70",children:ue.unit}),ue.history.length>1&&n.jsx(qi,{className:`w-5 h-5 text-emerald-500 ${ue.history[ue.history.length-1].value<ue.history[ue.history.length-2].value?"transform rotate-180":""}`})]})]}),n.jsx("div",{className:"bg-white px-3 sm:px-4 py-2 rounded-full text-[10px] sm:text-[11px] font-black text-emerald-600 uppercase shadow-sm border border-emerald-50",children:"Stable"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsx("h3",{className:"text-lg font-black text-black tracking-tight mb-6 sm:mb-8 uppercase",children:"Vitality Overview"}),n.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4 pb-2 sm:pb-0",children:[n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-4 sm:p-6 border border-slate-100 text-center group hover:scale-105 transition-transform",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-[#2FC8B9]",children:Object.values(((bs=c.latestAnalysis)==null?void 0:bs.metrics)||{}).filter(dt=>{var Pt;return dt.status==="normal"||((Pt=dt.status)==null?void 0:Pt.toLowerCase())==="normal"}).length||4})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-slate-500 uppercase tracking-widest block",children:"Optimal"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-4 sm:p-6 border border-slate-100 text-center group hover:scale-105 transition-transform",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-amber-500",children:Object.values(((cs=c.latestAnalysis)==null?void 0:cs.metrics)||{}).filter(dt=>{var Pt;return dt.status==="moderate"||dt.status==="warning"||((Pt=dt.status)==null?void 0:Pt.toLowerCase().includes("borderline"))}).length||2})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-slate-500 uppercase tracking-widest block",children:"Moderate"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-4 sm:p-6 border border-slate-100 text-center group hover:scale-105 transition-transform",children:[n.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-2xl flex items-center justify-center mx-auto mb-3 sm:mb-4 shadow-sm",children:n.jsx("span",{className:"text-xl sm:text-2xl font-black text-rose-500",children:Object.values(((Ds=c.latestAnalysis)==null?void 0:Ds.metrics)||{}).filter(dt=>{var Pt;return["low","high","critical"].includes((Pt=dt.status)==null?void 0:Pt.toLowerCase())}).length||2})}),n.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-slate-500 uppercase tracking-widest block",children:"Review"})]})]})]}),n.jsxs("div",{className:"bg-slate-50 rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6 sm:mb-8",children:[n.jsx("div",{className:"w-11 h-11 rounded-2xl bg-black flex items-center justify-center",children:n.jsx(Li,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsx("h3",{className:"text-lg font-black text-black tracking-tight uppercase",children:"Critical Alerts"})]}),n.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[(((rs=(zs=c.latestAnalysis)==null?void 0:zs.deficiencies)==null?void 0:rs.length)>0?c.latestAnalysis.deficiencies:[{name:"Vitamin D Deficiency",severity:"High"},{name:"Iron Insufficiency",severity:"Moderate"}]).map((dt,Pt)=>{var qt;return n.jsxs(Hs,{to:`/reports/${(qt=c.recentReports[0])==null?void 0:qt._id}`,className:"flex items-center justify-between bg-white rounded-3xl p-5 border border-slate-100 hover:border-[#2FC8B9]/20 transition-all group shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl flex-shrink-0 flex items-center justify-center bg-slate-50 group-hover:bg-[#2FC8B9]/10",children:n.jsx(th,{className:"w-5 h-5 text-amber-500 group-hover:text-[#2FC8B9] transition-colors"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h4",{className:"font-black text-black group-hover:text-[#2FC8B9] transition-colors text-sm sm:text-base truncate",children:dt.name}),n.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:[dt.severity||"High"," Priority"]})]})]}),n.jsx(Ju,{className:"w-5 h-5 text-slate-300 group-hover:text-[#2FC8B9] transition-all flex-shrink-0"})]},Pt)}),n.jsxs(Hs,{to:"/nutrition",className:"w-full mt-4 bg-black hover:bg-[#2FC8B9] text-white font-black text-xs sm:text-sm uppercase tracking-[0.2em] py-5 rounded-3xl transition-all shadow-lg flex items-center justify-center gap-2 group",children:["Personalized Diet Plan",n.jsx(To,{className:"w-4 h-4 group-hover:translate-x-2 transition-transform"})]})]})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 px-3 md:px-0",children:[n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("h3",{className:"text-lg font-black text-black uppercase tracking-tight",children:"Recent Tests"}),n.jsx(Hs,{to:"/reports",className:"text-[10px] font-black text-[#2FC8B9] uppercase tracking-widest hover:underline transition-all",children:"View All"})]}),n.jsx("div",{className:"space-y-4",children:(((Gs=c==null?void 0:c.recentReports)==null?void 0:Gs.length)>0?c.recentReports.slice(0,3):[{_id:"1",reportType:"Complete Blood Count",createdAt:"2026-02-12",status:"completed"},{_id:"2",reportType:"Lipid Profile",createdAt:"2026-01-28",status:"pending"},{_id:"3",reportType:"Thyroid Panel",createdAt:"2025-12-15",status:"completed"}]).map((dt,Pt)=>n.jsxs(Hs,{to:dt._id?`/reports/${dt._id}`:"#",className:"flex items-center justify-between p-4 bg-slate-50 hover:bg-white border border-transparent hover:border-slate-100 rounded-3xl transition-all group shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white flex items-center justify-center shadow-inner text-slate-400 group-hover:text-[#2FC8B9] transition-colors",children:n.jsx(Hn,{className:"w-6 h-6"})}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-black text-black group-hover:text-[#2FC8B9] transition-colors text-sm",children:dt.reportType}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:new Date(dt.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${dt.status==="completed"?"text-[#2FC8B9]":"text-amber-500"}`,children:dt.status==="completed"?"Analyzed":"In Progress"}),n.jsx(Ju,{className:"w-4 h-4 text-slate-300 group-hover:text-[#2FC8B9] transition-colors"})]})]},dt._id||Pt))})]}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 sm:p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[n.jsx("div",{className:"w-11 h-11 rounded-2xl bg-black flex items-center justify-center",children:n.jsx(br,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsx("h3",{className:"text-lg font-black text-black uppercase tracking-tight leading-tight",children:"Elite Choices"})]}),n.jsx("div",{className:"space-y-4",children:[{name:"Vitamin B12 Panel",reason:"Low intake detected in food log",type:"Test"},{name:"Omega-3 (1000mg)",reason:"To support heart and brain health",type:"Supplement"},{name:"HbA1c Test",reason:"Important for diabetes monitoring",type:"Test"},{name:"Vitamin D3 (2000 IU)",reason:"Low sun exposure detected",type:"Supplement"}].map((dt,Pt)=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-3xl group cursor-pointer hover:bg-white border border-transparent hover:border-slate-100 transition-all",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h4",{className:"font-black text-black",children:dt.name}),n.jsx("span",{className:`text-[8px] font-black uppercase tracking-tighter px-2 py-0.5 rounded-md ${dt.type==="Test"?"bg-black text-white":"bg-[#2FC8B9] text-white"}`,children:dt.type})]}),n.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:dt.reason})]}),n.jsx("button",{className:"w-10 h-10 rounded-2xl bg-white flex items-center justify-center shadow-sm text-black hover:bg-[#2FC8B9] hover:text-white transition-all",children:n.jsx(Zo,{className:"w-5 h-5"})})]},Pt))})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-black flex items-center justify-center",children:n.jsx(KT,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-black text-black tracking-tight leading-none uppercase",children:"30 Days Challenge"}),n.jsx("p",{className:"text-slate-500 text-sm font-bold mt-1",children:"Sculpt your future, day by day"})]})]}),n.jsxs(Hs,{to:"/challenge",className:"block bg-white rounded-[2.5rem] p-8 sm:p-12 text-black shadow-xl border border-slate-100 hover:shadow-2xl transition-all relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-[#2FC8B9]/5 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"}),n.jsxs("div",{className:"flex items-center justify-between mb-8 sm:mb-10 relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-4 sm:gap-6 flex-1",children:[n.jsx("div",{className:"w-14 h-14 sm:w-20 sm:h-20 rounded-[2rem] bg-slate-50 flex items-center justify-center border border-slate-100",children:n.jsx(KT,{className:"w-8 h-8 sm:w-10 sm:h-10 text-[#2FC8B9]"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-xl sm:text-3xl font-black mb-1 leading-tight tracking-tight text-black",children:"Elite Discipline"}),n.jsx("p",{className:"text-sm sm:text-lg text-slate-500 font-bold",children:"Unleash your ultimate physical potential"})]})]}),n.jsx(Ju,{className:"w-8 h-8 sm:w-10 sm:h-10 text-slate-300 group-hover:text-[#2FC8B9] group-hover:translate-x-3 transition-all flex-shrink-0"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 sm:gap-6 mb-8 sm:mb-12 relative z-10",children:[n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-5 sm:p-6 text-center border border-slate-100 group-hover:bg-[#2FC8B9]/5 transition-all",children:[n.jsx("div",{className:"text-3xl sm:text-4xl mb-3",children:""}),n.jsx("p",{className:"text-[10px] sm:text-xs font-black uppercase tracking-widest text-[#2FC8B9]",children:"Hydrate"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-5 sm:p-6 text-center border border-slate-100 group-hover:bg-[#2FC8B9]/5 transition-all",children:[n.jsx("div",{className:"text-3xl sm:text-4xl mb-3",children:""}),n.jsx("p",{className:"text-[10px] sm:text-xs font-black uppercase tracking-widest text-[#2FC8B9]",children:"Push"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-5 sm:p-6 text-center border border-slate-100 group-hover:bg-[#2FC8B9]/5 transition-all",children:[n.jsx("div",{className:"text-3xl sm:text-4xl mb-3",children:""}),n.jsx("p",{className:"text-[10px] sm:text-xs font-black uppercase tracking-widest text-[#2FC8B9]",children:"Fuel"})]}),n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-5 sm:p-6 text-center border border-slate-100 group-hover:bg-[#2FC8B9]/5 transition-all",children:[n.jsx("div",{className:"text-3xl sm:text-4xl mb-3",children:""}),n.jsx("p",{className:"text-[10px] sm:text-xs font-black uppercase tracking-widest text-[#2FC8B9]",children:"Recover"})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-6 relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ul,{className:"w-5 h-5 text-orange-500"}),n.jsx("span",{className:"text-sm font-black uppercase tracking-widest text-slate-700",children:"Active Streak"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(JR,{className:"w-5 h-5 text-yellow-500"}),n.jsx("span",{className:"text-sm font-black uppercase tracking-widest text-slate-700",children:"Badges"})]})]}),n.jsxs("div",{className:"px-10 py-5 bg-black text-white rounded-2xl text-xs sm:text-sm font-black uppercase tracking-widest shadow-xl flex items-center gap-3 transition-transform hover:bg-[#2FC8B9] hover:scale-105",children:["Start Today",n.jsx(To,{className:"w-5 h-5"})]})]})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-black flex items-center justify-center",children:n.jsx(KA,{className:"w-6 h-6 text-[#2FC8B9]"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-black text-black tracking-tight leading-none uppercase",children:"Did You Know?"}),n.jsx("p",{className:"text-slate-500 text-sm font-bold mt-1",children:"Science-backed nutrition secrets"})]})]}),n.jsxs("div",{className:"md:grid md:grid-cols-2 lg:grid-cols-4 md:gap-4 flex md:flex-none overflow-x-auto gap-4 pb-4 md:pb-0 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0",children:[n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-[2.5rem] border border-slate-100 p-8 shadow-sm hover:shadow-xl hover:border-[#2FC8B9]/10 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx("div",{className:"text-4xl drop-shadow-md",children:""}),n.jsx("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex items-center justify-center border border-slate-100",children:n.jsx(lh,{className:"w-6 h-6 text-[#2FC8B9]"})})]}),n.jsx("h3",{className:"font-black text-black mb-3 text-lg",children:"Guava Power"}),n.jsxs("p",{className:"text-sm text-slate-500 leading-relaxed font-bold",children:["One guava contains ",n.jsx("span",{className:"text-[#2FC8B9] font-black",children:"3g of protein"})," - more than most fruits in nature!"]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-[2.5rem] border border-slate-100 p-8 shadow-sm hover:shadow-xl hover:border-[#2FC8B9]/10 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx("div",{className:"text-4xl drop-shadow-md",children:""}),n.jsx("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex items-center justify-center border border-slate-100",children:n.jsx(Kb,{className:"w-6 h-6 text-[#2FC8B9]"})})]}),n.jsx("h3",{className:"font-black text-black mb-3 text-lg",children:"Spinach Iron"}),n.jsxs("p",{className:"text-sm text-slate-500 leading-relaxed font-bold",children:["Spinach packs ",n.jsx("span",{className:"text-[#2FC8B9] font-black",children:"2.7mg of iron"})," per 100g - elite blood support fuel."]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-[2.5rem] border border-slate-100 p-8 shadow-sm hover:shadow-xl hover:border-[#2FC8B9]/10 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx("div",{className:"text-4xl drop-shadow-md",children:""}),n.jsx("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex items-center justify-center border border-slate-100",children:n.jsx(td,{className:"w-6 h-6 text-[#2FC8B9]"})})]}),n.jsx("h3",{className:"font-black text-black mb-3 text-lg",children:"Almond Energy"}),n.jsxs("p",{className:"text-sm text-slate-500 leading-relaxed font-bold",children:["Just ",n.jsx("span",{className:"text-[#2FC8B9] font-black",children:"23 almonds"})," provide 6g protein and fats for elite brain power."]})]}),n.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-[2.5rem] border border-slate-100 p-8 shadow-sm hover:shadow-xl hover:border-[#2FC8B9]/10 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx("div",{className:"text-4xl drop-shadow-md",children:""}),n.jsx("div",{className:"w-11 h-11 rounded-xl bg-slate-50 flex items-center justify-center border border-slate-100",children:n.jsx(Wre,{className:"w-6 h-6 text-[#2FC8B9]"})})]}),n.jsx("h3",{className:"font-black text-black mb-3 text-lg",children:"Egg Vitamin D"}),n.jsxs("p",{className:"text-sm text-slate-500 leading-relaxed font-bold",children:["One egg yolk has ",n.jsx("span",{className:"text-[#2FC8B9] font-black",children:"40 IU Vitamin D"})," - essential for bone density."]})]})]})]}),n.jsxs("div",{className:"bg-[#2FC8B9] rounded-[3rem] p-10 sm:p-16 text-white relative overflow-hidden group shadow-2xl",children:[n.jsx("div",{className:"absolute top-0 left-1/2 w-[600px] h-[600px] bg-white/10 rounded-full -translate-y-1/2 -translate-x-1/2 blur-[120px] pointer-events-none"}),n.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-12 relative z-10",children:[n.jsxs("div",{className:"text-center md:text-left",children:[n.jsx("h3",{className:"text-4xl sm:text-5xl font-black mb-6 tracking-tighter uppercase leading-none",children:"Elevate Your Journey"}),n.jsx("p",{className:"text-white/80 font-bold text-base sm:text-xl max-w-xl",children:"Our Health Intelligence engine is primed to optimize your wellness trajectory through advanced data analysis."})]}),n.jsxs(Hs,{to:"/ai-chat",className:"px-12 py-6 bg-black text-white rounded-2xl font-black uppercase tracking-[0.25em] transition-all hover:bg-slate-900 shadow-2xl flex items-center gap-4 group hover:scale-105 active:scale-95",children:[n.jsx(cx,{className:"w-6 h-6 text-[#2FC8B9]"}),"Initialize AI",n.jsx(To,{className:"w-6 h-6 group-hover:translate-x-2 transition-transform"})]})]})]})]})]})}function vce(){var E,C;const{user:a}=da(),[o,c]=ee.useState(null),[d,h]=ee.useState(!0);if(ee.useEffect(()=>{(async()=>{try{const{data:O}=await $o.getDashboard();c(O)}catch(O){console.error("Failed to fetch dashboard:",O)}finally{h(!1)}})()},[]),d)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:p,stats:g,todaySchedule:x,upcomingSchedule:v}=o||{};return(p==null?void 0:p.approvalStatus)==="pending"?n.jsx("div",{className:"max-w-lg mx-auto mt-20",children:n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:n.jsx(Oc,{className:"w-8 h-8 text-amber-500"})}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),n.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),n.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[n.jsx(Li,{className:"w-4 h-4"})," Pending Review"]})]})}):(p==null?void 0:p.approvalStatus)==="rejected"?n.jsx("div",{className:"max-w-lg mx-auto mt-20",children:n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:n.jsx(rQ,{className:"w-8 h-8 text-red-500"})}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),n.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(E=p==null?void 0:p.name)==null?void 0:E.split(" ")[0],"! "]}),n.jsx("p",{className:"text-slate-500 mt-1",children:p==null?void 0:p.specialization})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(Hs,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[n.jsx(Ig,{className:"w-4 h-4"})," Manage Slots"]}),p!=null&&p.isListed?n.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[n.jsx(Tn,{className:"w-4 h-4"})," Listed"]}):n.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[n.jsx(Li,{className:"w-4 h-4"})," Not Listed"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:n.jsx(yi,{className:"w-5 h-5 text-blue-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.todayAppointments)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:n.jsx(qi,{className:"w-5 h-5 text-green-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.upcomingAppointments)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:n.jsx(yg,{className:"w-5 h-5 text-purple-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(g==null?void 0:g.totalPatients)||0}),n.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:n.jsx(zA,{className:"w-5 h-5 text-amber-600"})}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((C=p==null?void 0:p.rating)==null?void 0:C.toFixed(1))||"0.0"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[n.jsx(br,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(x==null?void 0:x.length)>0?n.jsx("div",{className:"space-y-3",children:x.map(I=>{var O,R,k,M,P;return n.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((k=(R=(O=I.patient)==null?void 0:O.name)==null?void 0:R[0])==null?void 0:k.toUpperCase())||"P"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-800",children:(M=I.patient)==null?void 0:M.name}),n.jsx("p",{className:"text-sm text-slate-500",children:I.timeSlot})]})]}),n.jsxs(Hs,{to:`/patient/${(P=I.patient)==null?void 0:P._id}?appointmentId=${I._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[n.jsx(zp,{className:"w-4 h-4"})," View"]})]},I._id)})}):n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(yi,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),n.jsx("p",{children:"No appointments today"})]})]}),(v==null?void 0:v.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(Oc,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),n.jsx("div",{className:"space-y-3",children:v.slice(0,5).map(I=>{var O,R,k,M;return n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((k=(R=(O=I.patient)==null?void 0:O.name)==null?void 0:R[0])==null?void 0:k.toUpperCase())||"P"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-800",children:(M=I.patient)==null?void 0:M.name}),n.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(I.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",I.timeSlot]})]})]})},I._id)})})]})]})}function nm(a,o,c,d){function h(p){return p instanceof c?p:new c(function(g){g(p)})}return new(c||(c=Promise))(function(p,g){function x(C){try{E(d.next(C))}catch(I){g(I)}}function v(C){try{E(d.throw(C))}catch(I){g(I)}}function E(C){C.done?p(C.value):h(C.value).then(x,v)}E((d=d.apply(a,o||[])).next())})}const wce=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Tg(a,o,c){const d=_ce(a),{webkitRelativePath:h}=a,p=typeof o=="string"?o:typeof h=="string"&&h.length>0?h:`./${a.name}`;return typeof d.path!="string"&&_6(d,"path",p),_6(d,"relativePath",p),d}function _ce(a){const{name:o}=a;if(o&&o.lastIndexOf(".")!==-1&&!a.type){const d=o.split(".").pop().toLowerCase(),h=wce.get(d);h&&Object.defineProperty(a,"type",{value:h,writable:!1,configurable:!1,enumerable:!0})}return a}function _6(a,o,c){Object.defineProperty(a,o,{value:c,writable:!1,configurable:!1,enumerable:!0})}const yce=[".DS_Store","Thumbs.db"];function Ece(a){return nm(this,void 0,void 0,function*(){return My(a)&&Cce(a.dataTransfer)?Rce(a.dataTransfer,a.type):Sce(a)?Nce(a):Array.isArray(a)&&a.every(o=>"getFile"in o&&typeof o.getFile=="function")?Tce(a):[]})}function Cce(a){return My(a)}function Sce(a){return My(a)&&My(a.target)}function My(a){return typeof a=="object"&&a!==null}function Nce(a){return oR(a.target.files).map(o=>Tg(o))}function Tce(a){return nm(this,void 0,void 0,function*(){return(yield Promise.all(a.map(c=>c.getFile()))).map(c=>Tg(c))})}function Rce(a,o){return nm(this,void 0,void 0,function*(){if(a.items){const c=oR(a.items).filter(h=>h.kind==="file");if(o!=="drop")return c;const d=yield Promise.all(c.map(Ice));return y6(dH(d))}return y6(oR(a.files).map(c=>Tg(c)))})}function y6(a){return a.filter(o=>yce.indexOf(o.name)===-1)}function oR(a){if(a===null)return[];const o=[];for(let c=0;c<a.length;c++){const d=a[c];o.push(d)}return o}function Ice(a){if(typeof a.webkitGetAsEntry!="function")return E6(a);const o=a.webkitGetAsEntry();return o&&o.isDirectory?AH(o):E6(a,o)}function dH(a){return a.reduce((o,c)=>[...o,...Array.isArray(c)?dH(c):[c]],[])}function E6(a,o){return nm(this,void 0,void 0,function*(){var c;if(globalThis.isSecureContext&&typeof a.getAsFileSystemHandle=="function"){const p=yield a.getAsFileSystemHandle();if(p===null)throw new Error(`${a} is not a File`);if(p!==void 0){const g=yield p.getFile();return g.handle=p,Tg(g)}}const d=a.getAsFile();if(!d)throw new Error(`${a} is not a File`);return Tg(d,(c=o==null?void 0:o.fullPath)!==null&&c!==void 0?c:void 0)})}function Oce(a){return nm(this,void 0,void 0,function*(){return a.isDirectory?AH(a):kce(a)})}function AH(a){const o=a.createReader();return new Promise((c,d)=>{const h=[];function p(){o.readEntries(g=>nm(this,void 0,void 0,function*(){if(g.length){const x=Promise.all(g.map(Oce));h.push(x),p()}else try{const x=yield Promise.all(h);c(x)}catch(x){d(x)}}),g=>{d(g)})}p()})}function kce(a){return nm(this,void 0,void 0,function*(){return new Promise((o,c)=>{a.file(d=>{const h=Tg(d,a.fullPath);o(h)},d=>{c(d)})})})}var q2=function(a,o){if(a&&o){var c=Array.isArray(o)?o:o.split(",");if(c.length===0)return!0;var d=a.name||"",h=(a.type||"").toLowerCase(),p=h.replace(/\/.*$/,"");return c.some(function(g){var x=g.trim().toLowerCase();return x.charAt(0)==="."?d.toLowerCase().endsWith(x):x.endsWith("/*")?p===x.replace(/\/.*$/,""):h===x})}return!0};function C6(a){return Lce(a)||Bce(a)||hH(a)||Dce()}function Dce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bce(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Lce(a){if(Array.isArray(a))return cR(a)}function S6(a,o){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);o&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(a,h).enumerable})),c.push.apply(c,d)}return c}function N6(a){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?S6(Object(c),!0).forEach(function(d){uH(a,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):S6(Object(c)).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(c,d))})}return a}function uH(a,o,c){return o in a?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c,a}function tx(a,o){return Uce(a)||Pce(a,o)||hH(a,o)||jce()}function jce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hH(a,o){if(a){if(typeof a=="string")return cR(a,o);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return cR(a,o)}}function cR(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=new Array(o);c<o;c++)d[c]=a[c];return d}function Pce(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d=[],h=!0,p=!1,g,x;try{for(c=c.call(a);!(h=(g=c.next()).done)&&(d.push(g.value),!(o&&d.length===o));h=!0);}catch(v){p=!0,x=v}finally{try{!h&&c.return!=null&&c.return()}finally{if(p)throw x}}return d}}function Uce(a){if(Array.isArray(a))return a}var Fce=typeof q2=="function"?q2:q2.default,Mce="file-invalid-type",Vce="file-too-large",Qce="file-too-small",Hce="too-many-files",Gce=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",c=o.split(","),d=c.length>1?"one of ".concat(c.join(", ")):c[0];return{code:Mce,message:"File type must be ".concat(d)}},T6=function(o){return{code:Vce,message:"File is larger than ".concat(o," ").concat(o===1?"byte":"bytes")}},R6=function(o){return{code:Qce,message:"File is smaller than ".concat(o," ").concat(o===1?"byte":"bytes")}},Kce={code:Hce,message:"Too many files"};function pH(a,o){var c=a.type==="application/x-moz-file"||Fce(a,o);return[c,c?null:Gce(o)]}function mH(a,o,c){if(Qp(a.size))if(Qp(o)&&Qp(c)){if(a.size>c)return[!1,T6(c)];if(a.size<o)return[!1,R6(o)]}else{if(Qp(o)&&a.size<o)return[!1,R6(o)];if(Qp(c)&&a.size>c)return[!1,T6(c)]}return[!0,null]}function Qp(a){return a!=null}function Wce(a){var o=a.files,c=a.accept,d=a.minSize,h=a.maxSize,p=a.multiple,g=a.maxFiles,x=a.validator;return!p&&o.length>1||p&&g>=1&&o.length>g?!1:o.every(function(v){var E=pH(v,c),C=tx(E,1),I=C[0],O=mH(v,d,h),R=tx(O,1),k=R[0],M=x?x(v):null;return I&&k&&!M})}function Vy(a){return typeof a.isPropagationStopped=="function"?a.isPropagationStopped():typeof a.cancelBubble<"u"?a.cancelBubble:!1}function U_(a){return a.dataTransfer?Array.prototype.some.call(a.dataTransfer.types,function(o){return o==="Files"||o==="application/x-moz-file"}):!!a.target&&!!a.target.files}function I6(a){a.preventDefault()}function zce(a){return a.indexOf("MSIE")!==-1||a.indexOf("Trident/")!==-1}function qce(a){return a.indexOf("Edge/")!==-1}function Yce(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return zce(a)||qce(a)}function Gd(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return function(d){for(var h=arguments.length,p=new Array(h>1?h-1:0),g=1;g<h;g++)p[g-1]=arguments[g];return o.some(function(x){return!Vy(d)&&x&&x.apply(void 0,[d].concat(p)),Vy(d)})}}function Xce(){return"showOpenFilePicker"in window}function Jce(a){if(Qp(a)){var o=Object.entries(a).filter(function(c){var d=tx(c,2),h=d[0],p=d[1],g=!0;return fH(h)||(console.warn('Skipped "'.concat(h,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),g=!1),(!Array.isArray(p)||!p.every(gH))&&(console.warn('Skipped "'.concat(h,'" because an invalid file extension was provided.')),g=!1),g}).reduce(function(c,d){var h=tx(d,2),p=h[0],g=h[1];return N6(N6({},c),{},uH({},p,g))},{});return[{description:"Files",accept:o}]}return a}function $ce(a){if(Qp(a))return Object.entries(a).reduce(function(o,c){var d=tx(c,2),h=d[0],p=d[1];return[].concat(C6(o),[h],C6(p))},[]).filter(function(o){return fH(o)||gH(o)}).join(",")}function Zce(a){return a instanceof DOMException&&(a.name==="AbortError"||a.code===a.ABORT_ERR)}function ele(a){return a instanceof DOMException&&(a.name==="SecurityError"||a.code===a.SECURITY_ERR)}function fH(a){return a==="audio/*"||a==="video/*"||a==="image/*"||a==="text/*"||a==="application/*"||/\w+\/[-+.\w]+/g.test(a)}function gH(a){return/^.*\.[\w]+$/.test(a)}var tle=["children"],sle=["open"],rle=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],nle=["refKey","onChange","onClick"];function ile(a){return cle(a)||ole(a)||bH(a)||ale()}function ale(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ole(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function cle(a){if(Array.isArray(a))return lR(a)}function Y2(a,o){return Ale(a)||dle(a,o)||bH(a,o)||lle()}function lle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bH(a,o){if(a){if(typeof a=="string")return lR(a,o);var c=Object.prototype.toString.call(a).slice(8,-1);if(c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set")return Array.from(a);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return lR(a,o)}}function lR(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=new Array(o);c<o;c++)d[c]=a[c];return d}function dle(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d=[],h=!0,p=!1,g,x;try{for(c=c.call(a);!(h=(g=c.next()).done)&&(d.push(g.value),!(o&&d.length===o));h=!0);}catch(v){p=!0,x=v}finally{try{!h&&c.return!=null&&c.return()}finally{if(p)throw x}}return d}}function Ale(a){if(Array.isArray(a))return a}function O6(a,o){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);o&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(a,h).enumerable})),c.push.apply(c,d)}return c}function _i(a){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?O6(Object(c),!0).forEach(function(d){dR(a,d,c[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):O6(Object(c)).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(c,d))})}return a}function dR(a,o,c){return o in a?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c,a}function Qy(a,o){if(a==null)return{};var c=ule(a,o),d,h;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(a);for(h=0;h<p.length;h++)d=p[h],!(o.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(a,d)&&(c[d]=a[d])}return c}function ule(a,o){if(a==null)return{};var c={},d=Object.keys(a),h,p;for(p=0;p<d.length;p++)h=d[p],!(o.indexOf(h)>=0)&&(c[h]=a[h]);return c}var aI=ee.forwardRef(function(a,o){var c=a.children,d=Qy(a,tle),h=vH(d),p=h.open,g=Qy(h,sle);return ee.useImperativeHandle(o,function(){return{open:p}},[p]),qV.createElement(ee.Fragment,null,c(_i(_i({},g),{},{open:p})))});aI.displayName="Dropzone";var xH={disabled:!1,getFilesFromEvent:Ece,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};aI.defaultProps=xH;aI.propTypes={children:Fn.func,accept:Fn.objectOf(Fn.arrayOf(Fn.string)),multiple:Fn.bool,preventDropOnDocument:Fn.bool,noClick:Fn.bool,noKeyboard:Fn.bool,noDrag:Fn.bool,noDragEventsBubbling:Fn.bool,minSize:Fn.number,maxSize:Fn.number,maxFiles:Fn.number,disabled:Fn.bool,getFilesFromEvent:Fn.func,onFileDialogCancel:Fn.func,onFileDialogOpen:Fn.func,useFsAccessApi:Fn.bool,autoFocus:Fn.bool,onDragEnter:Fn.func,onDragLeave:Fn.func,onDragOver:Fn.func,onDrop:Fn.func,onDropAccepted:Fn.func,onDropRejected:Fn.func,onError:Fn.func,validator:Fn.func};var AR={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function vH(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=_i(_i({},xH),a),c=o.accept,d=o.disabled,h=o.getFilesFromEvent,p=o.maxSize,g=o.minSize,x=o.multiple,v=o.maxFiles,E=o.onDragEnter,C=o.onDragLeave,I=o.onDragOver,O=o.onDrop,R=o.onDropAccepted,k=o.onDropRejected,M=o.onFileDialogCancel,P=o.onFileDialogOpen,H=o.useFsAccessApi,$=o.autoFocus,re=o.preventDropOnDocument,J=o.noClick,ge=o.noKeyboard,ie=o.noDrag,we=o.noDragEventsBubbling,Ae=o.onError,V=o.validator,ce=ee.useMemo(function(){return $ce(c)},[c]),Y=ee.useMemo(function(){return Jce(c)},[c]),z=ee.useMemo(function(){return typeof P=="function"?P:k6},[P]),te=ee.useMemo(function(){return typeof M=="function"?M:k6},[M]),se=ee.useRef(null),Ce=ee.useRef(null),he=ee.useReducer(hle,AR),Ne=Y2(he,2),Z=Ne[0],Ie=Ne[1],Ve=Z.isFocused,Pe=Z.isFileDialogActive,ne=ee.useRef(typeof window<"u"&&window.isSecureContext&&H&&Xce()),ve=function(){!ne.current&&Pe&&setTimeout(function(){if(Ce.current){var Ht=Ce.current.files;Ht.length||(Ie({type:"closeDialog"}),te())}},300)};ee.useEffect(function(){return window.addEventListener("focus",ve,!1),function(){window.removeEventListener("focus",ve,!1)}},[Ce,Pe,te,ne]);var ue=ee.useRef([]),Te=function(Ht){se.current&&se.current.contains(Ht.target)||(Ht.preventDefault(),ue.current=[])};ee.useEffect(function(){return re&&(document.addEventListener("dragover",I6,!1),document.addEventListener("drop",Te,!1)),function(){re&&(document.removeEventListener("dragover",I6),document.removeEventListener("drop",Te))}},[se,re]),ee.useEffect(function(){return!d&&$&&se.current&&se.current.focus(),function(){}},[se,$,d]);var Be=ee.useCallback(function(mt){Ae?Ae(mt):console.error(mt)},[Ae]),Ue=ee.useCallback(function(mt){mt.preventDefault(),mt.persist(),jt(mt),ue.current=[].concat(ile(ue.current),[mt.target]),U_(mt)&&Promise.resolve(h(mt)).then(function(Ht){if(!(Vy(mt)&&!we)){var qe=Ht.length,ht=qe>0&&Wce({files:Ht,accept:ce,minSize:g,maxSize:p,multiple:x,maxFiles:v,validator:V}),Xt=qe>0&&!ht;Ie({isDragAccept:ht,isDragReject:Xt,isDragActive:!0,type:"setDraggedFiles"}),E&&E(mt)}}).catch(function(Ht){return Be(Ht)})},[h,E,Be,we,ce,g,p,x,v,V]),tt=ee.useCallback(function(mt){mt.preventDefault(),mt.persist(),jt(mt);var Ht=U_(mt);if(Ht&&mt.dataTransfer)try{mt.dataTransfer.dropEffect="copy"}catch{}return Ht&&I&&I(mt),!1},[I,we]),ot=ee.useCallback(function(mt){mt.preventDefault(),mt.persist(),jt(mt);var Ht=ue.current.filter(function(ht){return se.current&&se.current.contains(ht)}),qe=Ht.indexOf(mt.target);qe!==-1&&Ht.splice(qe,1),ue.current=Ht,!(Ht.length>0)&&(Ie({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),U_(mt)&&C&&C(mt))},[se,C,we]),ut=ee.useCallback(function(mt,Ht){var qe=[],ht=[];mt.forEach(function(Xt){var zt=pH(Xt,ce),ds=Y2(zt,2),Qt=ds[0],Us=ds[1],bs=mH(Xt,g,p),cs=Y2(bs,2),Ds=cs[0],zs=cs[1],rs=V?V(Xt):null;if(Qt&&Ds&&!rs)qe.push(Xt);else{var Gs=[Us,zs];rs&&(Gs=Gs.concat(rs)),ht.push({file:Xt,errors:Gs.filter(function(dt){return dt})})}}),(!x&&qe.length>1||x&&v>=1&&qe.length>v)&&(qe.forEach(function(Xt){ht.push({file:Xt,errors:[Kce]})}),qe.splice(0)),Ie({acceptedFiles:qe,fileRejections:ht,isDragReject:ht.length>0,type:"setFiles"}),O&&O(qe,ht,Ht),ht.length>0&&k&&k(ht,Ht),qe.length>0&&R&&R(qe,Ht)},[Ie,x,ce,g,p,v,O,R,k,V]),Tt=ee.useCallback(function(mt){mt.preventDefault(),mt.persist(),jt(mt),ue.current=[],U_(mt)&&Promise.resolve(h(mt)).then(function(Ht){Vy(mt)&&!we||ut(Ht,mt)}).catch(function(Ht){return Be(Ht)}),Ie({type:"reset"})},[h,ut,Be,we]),Qe=ee.useCallback(function(){if(ne.current){Ie({type:"openDialog"}),z();var mt={multiple:x,types:Y};window.showOpenFilePicker(mt).then(function(Ht){return h(Ht)}).then(function(Ht){ut(Ht,null),Ie({type:"closeDialog"})}).catch(function(Ht){Zce(Ht)?(te(Ht),Ie({type:"closeDialog"})):ele(Ht)?(ne.current=!1,Ce.current?(Ce.current.value=null,Ce.current.click()):Be(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Be(Ht)});return}Ce.current&&(Ie({type:"openDialog"}),z(),Ce.current.value=null,Ce.current.click())},[Ie,z,te,H,ut,Be,Y,x]),it=ee.useCallback(function(mt){!se.current||!se.current.isEqualNode(mt.target)||(mt.key===" "||mt.key==="Enter"||mt.keyCode===32||mt.keyCode===13)&&(mt.preventDefault(),Qe())},[se,Qe]),kt=ee.useCallback(function(){Ie({type:"focus"})},[]),_e=ee.useCallback(function(){Ie({type:"blur"})},[]),xt=ee.useCallback(function(){J||(Yce()?setTimeout(Qe,0):Qe())},[J,Qe]),Ke=function(Ht){return d?null:Ht},Je=function(Ht){return ge?null:Ke(Ht)},$e=function(Ht){return ie?null:Ke(Ht)},jt=function(Ht){we&&Ht.stopPropagation()},Kt=ee.useMemo(function(){return function(){var mt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ht=mt.refKey,qe=Ht===void 0?"ref":Ht,ht=mt.role,Xt=mt.onKeyDown,zt=mt.onFocus,ds=mt.onBlur,Qt=mt.onClick,Us=mt.onDragEnter,bs=mt.onDragOver,cs=mt.onDragLeave,Ds=mt.onDrop,zs=Qy(mt,rle);return _i(_i(dR({onKeyDown:Je(Gd(Xt,it)),onFocus:Je(Gd(zt,kt)),onBlur:Je(Gd(ds,_e)),onClick:Ke(Gd(Qt,xt)),onDragEnter:$e(Gd(Us,Ue)),onDragOver:$e(Gd(bs,tt)),onDragLeave:$e(Gd(cs,ot)),onDrop:$e(Gd(Ds,Tt)),role:typeof ht=="string"&&ht!==""?ht:"presentation"},qe,se),!d&&!ge?{tabIndex:0}:{}),zs)}},[se,it,kt,_e,xt,Ue,tt,ot,Tt,ge,ie,d]),os=ee.useCallback(function(mt){mt.stopPropagation()},[]),ss=ee.useMemo(function(){return function(){var mt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ht=mt.refKey,qe=Ht===void 0?"ref":Ht,ht=mt.onChange,Xt=mt.onClick,zt=Qy(mt,nle),ds=dR({accept:ce,multiple:x,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Ke(Gd(ht,Tt)),onClick:Ke(Gd(Xt,os)),tabIndex:-1},qe,Ce);return _i(_i({},ds),zt)}},[Ce,c,x,Tt,d]);return _i(_i({},Z),{},{isFocused:Ve&&!d,getRootProps:Kt,getInputProps:ss,rootRef:se,inputRef:Ce,open:Ke(Qe)})}function hle(a,o){switch(o.type){case"focus":return _i(_i({},a),{},{isFocused:!0});case"blur":return _i(_i({},a),{},{isFocused:!1});case"openDialog":return _i(_i({},AR),{},{isFileDialogActive:!0});case"closeDialog":return _i(_i({},a),{},{isFileDialogActive:!1});case"setDraggedFiles":return _i(_i({},a),{},{isDragActive:o.isDragActive,isDragAccept:o.isDragAccept,isDragReject:o.isDragReject});case"setFiles":return _i(_i({},a),{},{acceptedFiles:o.acceptedFiles,fileRejections:o.fileRejections,isDragReject:o.isDragReject});case"reset":return _i({},AR);default:return a}}function k6(){}const ple=[{value:"Blood Test",label:"Blood Test",icon:""},{value:"X-Ray",label:"X-Ray",icon:""},{value:"MRI",label:"MRI",icon:""},{value:"CT Scan",label:"CT Scan",icon:""},{value:"ECG",label:"ECG",icon:""},{value:"Ultrasound",label:"Ultrasound",icon:""},{value:"General Checkup",label:"General Checkup",icon:""},{value:"Other",label:"Other",icon:""}];function mle(){const[a,o]=ee.useState([]),[c,d]=ee.useState(!1),[h,p]=ee.useState(0),[g,x]=ee.useState([]),v=Ha();ee.useEffect(()=>{window.scrollTo(0,0),E()},[]);const E=async()=>{try{const{data:H}=await sd.getReports();x(H.slice(0,3))}catch(H){console.error("Failed to fetch recent reports",H)}},C=ee.useCallback(H=>{const $=H.map(re=>({file:re,id:Math.random().toString(36).substr(2,9),reportType:"Blood Test",name:re.name,size:re.size}));o(re=>[...re,...$])},[]),{getRootProps:I,getInputProps:O,isDragActive:R}=vH({onDrop:C,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),k=(H,$)=>{o(re=>re.map(J=>J.id===H?{...J,reportType:$}:J))},M=H=>{o($=>$.filter(re=>re.id!==H))},P=async H=>{var re,J;if(H.preventDefault(),a.length===0){St.error("Please select at least one file");return}d(!0),p(0);const $=setInterval(()=>{p(ge=>ge>=90?(clearInterval($),90):ge+5)},300);try{const ge=new FormData;ge.append("report",a[0].file),ge.append("reportType",a[0].reportType);const{data:ie}=await sd.uploadReport(ge);clearInterval($),p(100),St.success("Report analyzed successfully!"),setTimeout(()=>v(`/reports/${ie.report._id}`),500)}catch(ge){clearInterval($),St.error(((J=(re=ge.response)==null?void 0:re.data)==null?void 0:J.message)||"Failed to analyze report"),p(0)}finally{d(!1)}};return n.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col items-center py-12 px-4 sm:px-6",children:[n.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[n.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-400/10 rounded-full blur-[120px]"}),n.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-cyan-400/10 rounded-full blur-[120px]"})]}),n.jsxs("div",{className:"w-full max-w-2xl relative",children:[n.jsxs("div",{className:"flex flex-col items-center text-center mb-10 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-100/50 rounded-full border border-blue-200",children:[n.jsx(Zb,{className:"w-3.5 h-3.5 text-blue-600"}),n.jsx("span",{className:"text-[10px] font-black tracking-widest text-blue-700 uppercase",children:"HIPAA Secure Portal"})]}),n.jsxs("h1",{className:"text-4xl font-black text-slate-800 tracking-tight",children:["Analyze Medical ",n.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-orange-500",children:"Reports"})]}),n.jsx("p",{className:"text-slate-500 max-w-md font-medium",children:"Upload your documents for instant AI-powered health insights and personalized recommendations."})]}),n.jsx("div",{className:"bg-white rounded-[2.5rem] shadow-[0_20px_50px_-12px_rgba(0,0,0,0.08)] border border-slate-100 overflow-hidden transition-all",children:n.jsx("div",{className:"p-8 sm:p-12",children:!c&&a.length===0?n.jsxs("div",{...I(),className:`relative group border-4 border-dashed rounded-[2rem] p-10 text-center cursor-pointer transition-all duration-500 ${R?"border-blue-500 bg-blue-50/50 scale-[1.02]":"border-slate-100 hover:border-blue-300 bg-slate-50/50"}`,children:[n.jsx("input",{...O()}),n.jsx("div",{className:"w-20 h-20 rounded-3xl bg-white shadow-xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-500",children:n.jsx(lo,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:R?"Drop your report here":"Drop report or click to browse"}),n.jsx("p",{className:"text-slate-500 font-medium mb-6 text-sm",children:"PDF, PNG, or JPG (Max 10MB)"}),n.jsx("div",{className:"flex items-center justify-center gap-4",children:["PDF","PNG","JPG"].map(H=>n.jsx("span",{className:"px-3 py-1 bg-white border border-slate-200 rounded-lg text-[10px] font-black text-slate-400",children:H},H))})]}):a.length>0&&!c?n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-slate-50 rounded-3xl p-6 border border-slate-100",children:a.map(H=>n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6",children:[n.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white shadow-md flex items-center justify-center flex-shrink-0",children:n.jsx(Hn,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("p",{className:"font-bold text-slate-800 truncate text-base",children:H.name}),n.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[(H.size/1024/1024).toFixed(2)," MB"]})]})]}),n.jsxs("div",{className:"w-full sm:w-auto flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1 sm:w-48",children:[n.jsx("select",{value:H.reportType,onChange:$=>k(H.id,$.target.value),className:"w-full appearance-none bg-white text-slate-800 text-sm font-bold pl-4 pr-10 py-3 rounded-xl border border-slate-200 focus:border-blue-500 focus:outline-none cursor-pointer",children:ple.map($=>n.jsxs("option",{value:$.value,children:[$.icon," ",$.label]},$.value))}),n.jsx(uh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),n.jsx("button",{onClick:()=>M(H.id),className:"p-3 bg-red-50 text-red-500 hover:bg-red-100 rounded-xl transition-all flex-shrink-0",children:n.jsx(qp,{className:"w-5 h-5"})})]})]},H.id))}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("button",{onClick:()=>o([]),className:"px-6 py-4 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all",children:"Cancel"}),n.jsxs("button",{onClick:P,className:"flex-1 py-4 bg-slate-900 text-white font-black rounded-2xl hover:bg-slate-800 transition-all shadow-xl flex items-center justify-center gap-3 uppercase tracking-widest text-sm",children:[n.jsx(Tn,{className:"w-5 h-5 text-blue-400"}),"Analyze Report"]})]})]}):n.jsxs("div",{className:"space-y-10 py-6",children:[n.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-slate-100 border-t-blue-500 animate-spin"}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsx(Hn,{className:"w-8 h-8 text-blue-500 animate-pulse"})})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-2xl font-black text-slate-800",children:"Analyzing Report"}),n.jsx("p",{className:"text-slate-500 font-medium",children:"Extracting health markers and findings..."})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"h-4 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-600 to-orange-500 transition-all duration-500",style:{width:`${h}%`}})}),n.jsxs("div",{className:"flex justify-between text-xs font-black text-slate-400 uppercase tracking-widest",children:[n.jsx("span",{children:"Processing Data"}),n.jsxs("span",{children:[h,"%"]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center gap-3",children:[n.jsx(nQ,{className:"w-5 h-5 text-blue-500"}),n.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Secure Scan"})]}),n.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100 flex items-center gap-3",children:[n.jsx(Zb,{className:"w-5 h-5 text-blue-500"}),n.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"HIPAA Compliant"})]})]})]})})}),n.jsxs("div",{className:"mt-8 bg-blue-50 rounded-3xl p-6 border border-blue-100 flex gap-4",children:[n.jsx(qd,{className:"w-6 h-6 text-blue-500 flex-shrink-0"}),n.jsx("p",{className:"text-sm text-blue-700 leading-relaxed font-medium",children:"Our AI analysis provides deep insights but is for educational purposes only. Always consult with a healthcare professional before making medical decisions."})]}),g.length>0&&n.jsxs("div",{className:"mt-12 space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex items-center justify-between px-2",children:[n.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:"Recent Tests"}),n.jsx(Hs,{to:"/reports",className:"text-sm font-bold text-blue-600 hover:text-blue-700",children:"View All"})]}),n.jsx("div",{className:"grid gap-4",children:g.map(H=>n.jsxs("div",{className:"card p-5 relative border-none ring-1 ring-white/50",children:[n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Hn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 mt-1",children:[n.jsx("div",{className:"flex items-center gap-2 mb-1.5",children:n.jsx("span",{className:`text-[9px] font-black px-2.5 py-1 rounded-lg uppercase tracking-widest ${H.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:H.status})}),n.jsx("h3",{className:"text-base font-black text-slate-800 leading-tight uppercase mb-1",children:H.reportType}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest font-mono",children:[n.jsx(yi,{className:"w-3 h-3"}),new Date(H.reportDate||H.createdAt).toLocaleDateString()]})]})]}),n.jsxs(Hs,{to:`/reports/${H._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(zp,{className:"w-4 h-4"}),"Analysis Details"]})]},H._id))})]})]})]})}function fle(){var R,k,M,P,H,$,re,J,ge,ie,we,Ae;const{id:a}=ox(),o=Ha(),[c,d]=ee.useState(null),[h,p]=ee.useState(!0);if(ee.useEffect(()=>{(async()=>{try{const{data:ce}=await sd.getReport(a);d(ce.report)}catch{St.error("Failed to load report")}finally{p(!1)}})()},[a]),h)return n.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-blue-500/20 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500 font-medium",children:"Analyzing Report..."})]})});if(!c)return n.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-50 px-6",children:[n.jsx(th,{className:"w-16 h-16 text-amber-500 mb-4"}),n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Report Not Found"}),n.jsx("p",{className:"text-slate-500 text-center mb-6",children:"We couldn't find the report you're looking for."}),n.jsx("button",{onClick:()=>o("/dashboard"),className:"w-full py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg",children:"Back to Dashboard"})]});const{aiAnalysis:g}=c,x=(g==null?void 0:g.metrics)||{},v=Object.entries(x),E={good:v.filter(([V,ce])=>ce.status==="normal").length,moderate:v.filter(([V,ce])=>ce.status==="borderline"||ce.status==="moderate").length,low:v.filter(([V,ce])=>ce.status==="low"||ce.status==="high").length},C=V=>V==="normal"||V==="good"?"emerald":V==="borderline"||V==="moderate"?"amber":"red",I=()=>{const V=`Check out my ${c.reportType} health report analysis! Health Score: ${g==null?void 0:g.healthScore}/100`,ce=window.location.href;navigator.share?navigator.share({title:"Health Report Analysis",text:V,url:ce}).catch(()=>{window.open(`https://wa.me/?text=${encodeURIComponent(V+" "+ce)}`,"_blank")}):window.open(`https://wa.me/?text=${encodeURIComponent(V+" "+ce)}`,"_blank")},O=()=>{window.print()};return n.jsxs("div",{className:"min-h-screen pb-20 font-sans",children:[n.jsx("div",{className:"px-6 pt-8 pb-4 flex items-center justify-between sticky top-0 backdrop-blur-md z-10",children:n.jsxs(Hs,{to:"/dashboard",className:"flex items-center gap-2 text-purple-600 font-bold text-xs tracking-[0.1em]",children:[n.jsx(Vn,{className:"w-4 h-4"})," BACK TO REPORTS"]})}),n.jsxs("div",{className:"px-6 mb-8 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h1",{className:"text-2xl font-black text-[#0F172A] tracking-tight truncate whitespace-nowrap",children:"Report Analysis"}),n.jsx("p",{className:"text-slate-500 font-medium mt-0.5 text-xs",children:"AI-Powered Health Insights"})]}),n.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[n.jsx("button",{onClick:I,className:"p-2.5 bg-white rounded-xl shadow-sm border border-slate-100 text-[#25D366] hover:bg-emerald-50 transition-colors",title:"Share on WhatsApp",children:n.jsx(iQ,{className:"w-5 h-5"})}),n.jsx("button",{onClick:O,className:"p-2.5 bg-white rounded-xl shadow-sm border border-slate-100 text-slate-600 hover:bg-slate-50 transition-colors",title:"Download PDF",children:n.jsx(iE,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"px-4 space-y-6",children:[n.jsxs("div",{className:"card card-gradient p-8 text-slate-900 shadow-2xl relative overflow-hidden ring-1 ring-white/50",children:[n.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsxs("div",{className:"flex items-center gap-3 mb-6 relative z-10",children:[n.jsx("div",{className:"w-10 h-10 bg-white/40 backdrop-blur-md rounded-xl flex items-center justify-center border border-white/50 shadow-inner",children:n.jsx(Hn,{className:"w-5 h-5 text-purple-700"})}),n.jsx("span",{className:"text-[10px] font-black tracking-[0.25em] text-slate-800 uppercase",children:"Lab Report"})]}),n.jsxs("h2",{className:"text-2xl font-black mb-4 flex items-center gap-2 overflow-hidden relative z-10",children:[n.jsx("span",{className:"truncate whitespace-nowrap",children:c.reportType}),n.jsxs("span",{className:"text-sm font-bold opacity-60 shrink-0",children:["(",new Date(c.createdAt).toLocaleDateString("en-US",{month:"short",year:"numeric"}),")"]})]}),n.jsxs("div",{className:"space-y-4 relative z-10",children:[n.jsxs("div",{className:"flex items-center gap-3 text-slate-700",children:[n.jsx(yi,{className:"w-4 h-4 opacity-60"}),n.jsx("span",{className:"text-sm font-bold",children:new Date(c.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsxs("div",{className:"flex items-center gap-3 text-slate-700 overflow-hidden",children:[n.jsx(zre,{className:"w-4 h-4 opacity-60 shrink-0"}),n.jsxs("span",{className:"text-sm font-bold truncate whitespace-nowrap",children:[c.patientName||"Patient Name",c.patientAge?`  ${c.patientAge}Y`:"",c.patientGender?`  ${c.patientGender}`:""]})]})]}),n.jsx("div",{className:"absolute top-6 right-6 bg-white/40 backdrop-blur-md border border-white/60 rounded-xl px-3 py-1.5 text-center shadow-lg z-10",children:n.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[n.jsx("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-800",children:"Analyzed"})]})}),n.jsx("div",{className:"absolute bottom-[-20px] right-8 opacity-5",children:n.jsx(Hn,{className:"w-32 h-32"})})]}),(g==null?void 0:g.summary)&&n.jsxs("div",{className:"card p-8 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-xl flex items-center justify-center",children:n.jsx(br,{className:"w-5 h-5 text-purple-600"})}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Executive Summary"})]}),n.jsx("p",{className:"text-slate-600 leading-relaxed font-bold text-sm mb-6",children:g.summary}),n.jsxs("div",{className:"bg-purple-50/50 rounded-3xl p-6 border border-purple-100",children:[n.jsx("h4",{className:"text-purple-700 font-black text-[10px] uppercase tracking-wider mb-2",children:"Key Insight"}),n.jsx("p",{className:"text-purple-900 text-xs leading-relaxed font-bold",children:((R=g.keyFindings)==null?void 0:R[0])||"Your health markers are generally within range, but some areas require focus."})]})]}),n.jsxs("div",{className:"mt-8",children:[n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase mb-6 px-4",children:"Health Metrics"}),n.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(Tn,{className:"w-5 h-5 text-emerald-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.good}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Good"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(Li,{className:"w-5 h-5 text-amber-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.moderate}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Moderate"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-4 text-center border border-slate-100 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-3",children:n.jsx(th,{className:"w-5 h-5 text-red-500"})}),n.jsx("p",{className:"text-2xl font-black text-slate-800 mb-1",children:E.low}),n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Low"})]})]}),n.jsx("div",{className:"space-y-4",children:v.map(([V,ce])=>{const Y=C(ce.status);return n.jsxs("div",{className:`card p-6 border-2 border-${Y}-100 relative overflow-hidden`,children:[n.jsx("div",{className:`absolute top-0 right-0 w-24 h-24 bg-${Y}-500/5 rounded-full -mr-12 -mt-12`}),n.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-1",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"text-base font-black text-slate-800 flex items-center gap-2",children:[V.replace(/([A-Z])/g," $1"),ce.status!=="normal"&&n.jsx(th,{className:`w-4 h-4 text-${Y}-500`}),ce.status==="normal"&&n.jsx(Tn,{className:"w-4 h-4 text-emerald-500"})]}),n.jsxs("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:["Range: ",ce.normalRange," ",ce.unit]})]}),n.jsx("div",{className:`px-2.5 py-1 bg-${Y}-100/80 text-${Y}-700 rounded-full flex items-center gap-1 border border-${Y}-200`,children:n.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:ce.status})})]}),n.jsxs("div",{className:"flex items-baseline gap-2 relative z-1",children:[n.jsx("span",{className:`text-3xl font-black text-${Y}-600`,children:ce.value}),n.jsx("span",{className:"text-slate-400 font-bold text-xs tracking-tight uppercase",children:ce.unit})]})]},V)})})]}),((k=g==null?void 0:g.deficiencies)==null?void 0:k.length)>0&&n.jsxs("div",{className:"mt-12 bg-[#FFF8F8] rounded-[2.5rem] p-8 border border-red-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[n.jsx(th,{className:"w-6 h-6 text-red-500"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Deficiencies Detected"})]}),n.jsx("div",{className:"space-y-6",children:g.deficiencies.map((V,ce)=>{var Y;return n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-md border-2 border-red-50 relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-red-500"}),n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("h4",{className:"font-black text-[#0F172A] text-lg",children:V.name}),n.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${V.severity==="severe"?"bg-red-100 text-red-600":"bg-amber-100 text-amber-600"}`,children:V.severity||"Moderate"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[n.jsxs("div",{className:"bg-slate-50 p-2.5 rounded-2xl border border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Current Level"}),n.jsx("p",{className:"text-base font-black text-slate-800",children:V.currentValue||"N/A"})]}),n.jsxs("div",{className:"bg-slate-50 p-2.5 rounded-2xl border border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Normal Range"}),n.jsx("p",{className:"text-base font-black text-slate-600",children:V.normalRange||"N/A"})]})]}),((Y=V.symptoms)==null?void 0:Y.length)>0&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[n.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Check for these symptoms"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:V.symptoms.map((z,te)=>n.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-600 text-[10px] font-bold rounded-lg border border-blue-100",children:z},te))})]})]},ce)})})]}),(g==null?void 0:g.dietPlan)&&n.jsxs("div",{className:"mt-12 bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(lh,{className:"w-6 h-6 text-emerald-500"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Personalized Diet Plan"})]}),n.jsx("p",{className:"text-slate-500 font-medium text-sm leading-relaxed mb-8",children:"Based on your deficiencies and fitness goals, we've curated a nutrition plan to help restore optimal levels through natural food sources."}),n.jsx("div",{className:"space-y-6",children:[{label:"Breakfast Recommendatons",items:((M=g.dietPlan.breakfast)==null?void 0:M.slice(0,4))||[],color:"blue"},{label:"Lunch Options",items:((P=g.dietPlan.lunch)==null?void 0:P.slice(0,4))||[],color:"emerald"},{label:"Dinner Suggestions",items:((H=g.dietPlan.dinner)==null?void 0:H.slice(0,4))||[],color:"purple"},{label:"Healthy Snacks",items:(($=g.dietPlan.snacks)==null?void 0:$.slice(0,4))||[],color:"amber"}].map((V,ce)=>V.items.length>0&&n.jsxs("div",{className:"bg-slate-50 rounded-3xl p-6 border border-slate-200/50",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx($R,{className:`w-4 h-4 text-${V.color}-500`}),n.jsx("h4",{className:"font-extrabold text-slate-800 text-sm uppercase tracking-tight",children:V.label})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:V.items.map((Y,z)=>n.jsx("div",{className:"px-4 py-2 bg-white rounded-2xl text-xs font-bold text-slate-800 border border-slate-200/60 shadow-sm",children:Y.meal||Y},z))})]},ce))})]}),(((J=(re=g==null?void 0:g.recommendations)==null?void 0:re.lifestyle)==null?void 0:J.length)>0||((ie=(ge=g==null?void 0:g.dietPlan)==null?void 0:ge.tips)==null?void 0:ie.length)>0)&&n.jsxs("div",{className:"mt-12 bg-[#F0FDF4] rounded-[2.5rem] p-8 border border-emerald-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[n.jsx(br,{className:"w-6 h-6 text-emerald-600"}),n.jsx("h3",{className:"text-lg font-black text-[#0F172A] tracking-tight uppercase",children:"Personalized Health Tips"})]}),n.jsx("div",{className:"space-y-4",children:(((we=g.recommendations)==null?void 0:we.lifestyle)||((Ae=g.dietPlan)==null?void 0:Ae.tips)||[]).map((V,ce)=>n.jsxs("div",{className:"bg-white rounded-3xl p-6 flex gap-4 shadow-sm border border-slate-100 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-gradient-to-b from-purple-400 to-orange-600"}),n.jsx("div",{className:"w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center shrink-0",children:n.jsx(td,{className:"w-5 h-5 text-blue-500"})}),n.jsxs("div",{children:[n.jsxs("h4",{className:"font-black text-xs uppercase tracking-[0.15em] text-slate-400 mb-1",children:["Recommendation ",ce+1]}),n.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-bold",children:V})]})]},ce))})]}),n.jsx("div",{className:"mt-12 px-8 pb-8 text-center",children:n.jsx("p",{className:"text-slate-400 text-xs leading-relaxed font-medium",children:"Disclaimer: This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider."})})]})]})}const gle=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function ble(){var z,te,se,Ce;const a=Ha(),[o,c]=ee.useState([]),[d,h]=ee.useState([]),[p,g]=ee.useState(!0),[x,v]=ee.useState("All"),[E,C]=ee.useState(""),[I,O]=ee.useState(null),[R,k]=ee.useState({date:"",timeSlot:"",symptoms:""}),[M,P]=ee.useState(!1),[H,$]=ee.useState("doctors"),[re,J]=ee.useState([]),[ge,ie]=ee.useState(!1);ee.useEffect(()=>{we()},[x]);const we=async()=>{try{const he={};x!=="All"&&(he.specialization=x);const[Ne,Z]=await Promise.all([$o.getAll(he),$o.getAppointments()]);c(Ne.data),h(Z.data)}catch(he){console.error("Failed to fetch data:",he)}finally{g(!1)}};ee.useEffect(()=>{I&&R.date&&Ae()},[I,R.date]);const Ae=async()=>{var he;if(!(!I||!R.date)){ie(!0);try{const{data:Ne}=await $o.getDoctorAvailableSlots(I._id);console.log("Slots response:",Ne);const Z=new Date(R.date).toDateString();console.log("Looking for dateKey:",Z),console.log("Available keys:",Object.keys(Ne.slotsByDate||{})),J(((he=Ne.slotsByDate)==null?void 0:he[Z])||[])}catch(Ne){console.error("Failed to fetch slots:",Ne),J([])}finally{ie(!1)}}},V=o.filter(he=>{var Ne,Z,Ie;return((Z=he.name||((Ne=he.user)==null?void 0:Ne.name))==null?void 0:Z.toLowerCase().includes(E.toLowerCase()))||((Ie=he.specialization)==null?void 0:Ie.toLowerCase().includes(E.toLowerCase()))}),ce=async he=>{var Ne,Z;if(he.preventDefault(),!R.date||!R.timeSlot){St.error("Please select date and time");return}P(!0);try{await $o.bookAppointment({doctorId:I._id,...R,type:"video"}),St.success("Appointment booked successfully!"),O(null),k({date:"",timeSlot:"",symptoms:""}),J([]),we()}catch(Ie){St.error(((Z=(Ne=Ie.response)==null?void 0:Ne.data)==null?void 0:Z.message)||"Failed to book appointment")}finally{P(!1)}},Y=()=>{const he=[];for(let Ne=0;Ne<7;Ne++){const Z=new Date;Z.setDate(Z.getDate()+Ne),he.push({value:Z.toISOString().split("T")[0],label:Z.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:Ne===0})}return he};return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),n.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[n.jsxs("button",{onClick:()=>$("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${H==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(Jd,{className:"w-4 h-4"})," Find Doctors"]}),n.jsxs("button",{onClick:()=>$("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${H==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(yi,{className:"w-4 h-4"})," My Appointments",d.length>0&&n.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:d.length})]})]}),H==="doctors"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Dy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),n.jsx("input",{type:"text",placeholder:"Search doctors...",value:E,onChange:he=>C(he.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),n.jsx("select",{value:x,onChange:he=>v(he.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:gle.map(he=>n.jsx("option",{value:he,children:he},he))})]})}),p?n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),n.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):V.length>0?n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:V.map(he=>{var Z,Ie,Ve;const Ne=he.name||((Z=he.user)==null?void 0:Z.name)||"Doctor";return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-xl font-bold text-white",children:(Ie=Ne[0])==null?void 0:Ie.toUpperCase()}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",Ne]}),n.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:he.specialization}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx(zA,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),n.jsx("span",{className:"text-sm text-slate-600",children:((Ve=he.rating)==null?void 0:Ve.toFixed(1))||"4.5"}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{className:"text-sm text-slate-500",children:[he.experience||5,"+ yrs"]})]})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",he.consultationFee||500]}),n.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),n.jsx("button",{onClick:()=>O(he),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},he._id)})}):n.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[n.jsx(Dy,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),H==="appointments"&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),d.length>0?n.jsx("div",{className:"space-y-3",children:d.map(he=>{var Ne,Z,Ie,Ve,Pe,ne,ve,ue;return n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:((Pe=(Ve=((Ne=he.doctor)==null?void 0:Ne.name)||((Ie=(Z=he.doctor)==null?void 0:Z.user)==null?void 0:Ie.name))==null?void 0:Ve[0])==null?void 0:Pe.toUpperCase())||"D"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((ne=he.doctor)==null?void 0:ne.name)||((ue=(ve=he.doctor)==null?void 0:ve.user)==null?void 0:ue.name)]}),n.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(he.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",he.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${he.status==="completed"?"bg-green-100 text-green-600":he.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:he.status}),he.status==="scheduled"&&n.jsx("button",{onClick:()=>a(`/consultation/${he._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},he._id)})}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(yi,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),n.jsx("button",{onClick:()=>$("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),I&&n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),n.jsx("button",{onClick:()=>{O(null),J([]),k({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:(se=(te=I.name||((z=I.user)==null?void 0:z.name))==null?void 0:te[0])==null?void 0:se.toUpperCase()}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",I.name||((Ce=I.user)==null?void 0:Ce.name)]}),n.jsx("p",{className:"text-sm text-cyan-600",children:I.specialization})]})]}),n.jsxs("form",{onSubmit:ce,className:"space-y-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:Y().map(he=>n.jsxs("button",{type:"button",onClick:()=>k({...R,date:he.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${R.date===he.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[n.jsx("div",{className:"text-xs font-medium",children:he.label.split(" ")[0]}),n.jsx("div",{className:"text-sm font-bold",children:he.label.split(" ")[2]})]},he.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),ge?n.jsxs("div",{className:"flex items-center justify-center py-6",children:[n.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),n.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):re.length>0?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:re.map(he=>{const Ne=R.timeSlot===he.timeSlot,Z=he.status==="passed",Ie=he.status==="booked",Ve=he.status==="blocked",Pe=he.status==="available";return n.jsxs("button",{type:"button",onClick:()=>Pe&&k({...R,timeSlot:he.timeSlot}),disabled:!Pe,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Ne?"bg-cyan-500 text-white ring-2 ring-cyan-300":Z?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":Ie?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":Ve?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:Z?"Time passed":Ie?"Already booked":Ve?"Not available":"Available",children:[he.timeSlot,Ie&&n.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},he.timeSlot)})}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):R.date?n.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[n.jsx(Oc,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):n.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[n.jsx(yi,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),n.jsx("textarea",{value:R.symptoms,onChange:he=>k({...R,symptoms:he.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),n.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(gg,{className:"w-5 h-5 text-cyan-600"}),n.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),n.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx("button",{type:"button",onClick:()=>{O(null),J([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),n.jsx("button",{type:"submit",disabled:M||!R.date||!R.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:M?"Booking...":`Confirm  ${I.consultationFee||500}`})]})]})]})})]})}function xle(){var ce,Y,z,te,se,Ce,he,Ne,Z,Ie,Ve,Pe,ne,ve,ue,Te,Be,Ue,tt,ot,ut,Tt,Qe,it,kt,_e,xt,Ke;const{user:a,updateUser:o}=da(),[c]=YV(),[d,h]=ee.useState(!1),[p,g]=ee.useState(!1),x=ee.useRef(null),[v,E]=ee.useState(c.get("tab")||"profile"),[C,I]=ee.useState(null),[O,R]=ee.useState(!1),[k,M]=ee.useState({goalType:"maintenance",currentWeight:((ce=a==null?void 0:a.profile)==null?void 0:ce.weight)||"",targetWeight:"",height:((Y=a==null?void 0:a.profile)==null?void 0:Y.height)||"",age:((z=a==null?void 0:a.profile)==null?void 0:z.age)||"",gender:((te=a==null?void 0:a.profile)==null?void 0:te.gender)||"male",activityLevel:"moderate",dietaryPreference:((se=a==null?void 0:a.profile)==null?void 0:se.dietaryPreference)||"non-vegetarian"}),[P,H]=ee.useState({name:(a==null?void 0:a.name)||"",profile:{age:((Ce=a==null?void 0:a.profile)==null?void 0:Ce.age)||"",gender:((he=a==null?void 0:a.profile)==null?void 0:he.gender)||"",dietaryPreference:((Ne=a==null?void 0:a.profile)==null?void 0:Ne.dietaryPreference)||"non-vegetarian",height:((Z=a==null?void 0:a.profile)==null?void 0:Z.height)||"",weight:((Ie=a==null?void 0:a.profile)==null?void 0:Ie.weight)||"",bloodGroup:((Ve=a==null?void 0:a.profile)==null?void 0:Ve.bloodGroup)||"",medicalHistory:{conditions:((ne=(Pe=a==null?void 0:a.profile)==null?void 0:Pe.medicalHistory)==null?void 0:ne.conditions)||[]},lifestyle:{smoker:((ue=(ve=a==null?void 0:a.profile)==null?void 0:ve.lifestyle)==null?void 0:ue.smoker)||!1,alcohol:((Be=(Te=a==null?void 0:a.profile)==null?void 0:Te.lifestyle)==null?void 0:Be.alcohol)||!1,sleepHours:((tt=(Ue=a==null?void 0:a.profile)==null?void 0:Ue.lifestyle)==null?void 0:tt.sleepHours)||"7",stressLevel:((ut=(ot=a==null?void 0:a.profile)==null?void 0:ot.lifestyle)==null?void 0:ut.stressLevel)||"moderate",waterIntake:((Qe=(Tt=a==null?void 0:a.profile)==null?void 0:Tt.lifestyle)==null?void 0:Qe.waterIntake)||"8"},diabetesProfile:((it=a==null?void 0:a.profile)==null?void 0:it.diabetesProfile)||null}});ee.useEffect(()=>{(async()=>{try{const $e=localStorage.getItem("token"),jt=await zr.get("/api/nutrition/goals",{headers:{Authorization:`Bearer ${$e}`}});jt.data.healthGoal&&(I(jt.data.healthGoal),M({goalType:jt.data.healthGoal.goalType,currentWeight:jt.data.healthGoal.currentWeight,targetWeight:jt.data.healthGoal.targetWeight,height:jt.data.healthGoal.height,age:jt.data.healthGoal.age,gender:jt.data.healthGoal.gender,activityLevel:jt.data.healthGoal.activityLevel,dietaryPreference:jt.data.healthGoal.dietaryPreference}))}catch{console.log("No health goal set yet")}})()},[]);const $=Je=>{const{name:$e,value:jt,type:Kt,checked:os}=Je.target;if($e.startsWith("profile.lifestyle.")){const ss=$e.split(".")[2];H(mt=>({...mt,profile:{...mt.profile,lifestyle:{...mt.profile.lifestyle,[ss]:Kt==="checkbox"?os:jt}}}))}else if($e.startsWith("profile.diabetesProfile.")){const ss=$e.split(".")[2];H(mt=>({...mt,profile:{...mt.profile,diabetesProfile:{...mt.profile.diabetesProfile,[ss]:jt}}}))}else if($e.startsWith("profile.")){const ss=$e.split(".")[1];H(mt=>({...mt,profile:{...mt.profile,[ss]:jt}}))}else H(ss=>({...ss,[$e]:jt}))},re=async Je=>{var $e,jt;Je.preventDefault(),h(!0);try{const Kt={name:P.name,profile:{...P.profile,age:P.profile.age?Number(P.profile.age):void 0,height:P.profile.height?Number(P.profile.height):void 0,weight:P.profile.weight?Number(P.profile.weight):void 0,lifestyle:{...P.profile.lifestyle,sleepHours:Number(P.profile.lifestyle.sleepHours),waterIntake:Number(P.profile.lifestyle.waterIntake)}}},{data:os}=await Ft.put("/auth/profile",Kt);o(os),St.success("Profile updated successfully!")}catch(Kt){St.error(((jt=($e=Kt.response)==null?void 0:$e.data)==null?void 0:jt.message)||"Failed to update profile")}finally{h(!1)}},J=async Je=>{var $e,jt;Je.preventDefault(),R(!0);try{const Kt=localStorage.getItem("token"),os={...k,currentWeight:Number(k.currentWeight),targetWeight:Number(k.targetWeight),height:Number(k.height),age:Number(k.age)},ss=await zr.post("/api/nutrition/goals",os,{headers:{Authorization:`Bearer ${Kt}`}});I(ss.data.healthGoal),St.success("Fitness goal set successfully! Your daily targets have been calculated.")}catch(Kt){St.error(((jt=($e=Kt.response)==null?void 0:$e.data)==null?void 0:jt.message)||"Failed to set fitness goal")}finally{R(!1)}},ge=Je=>{const{name:$e,value:jt}=Je.target;M(Kt=>({...Kt,[$e]:jt}))},ie=async Je=>{var Kt,os,ss;const $e=(Kt=Je.target.files)==null?void 0:Kt[0];if(!$e)return;if(!$e.type.startsWith("image/")){St.error("Please select an image file");return}if($e.size>5*1024*1024){St.error("Image size should be less than 5MB");return}g(!0);const jt=new FormData;jt.append("profilePicture",$e);try{const mt=localStorage.getItem("token"),{data:Ht}=await Ft.post("/auth/upload-profile-picture",jt,{headers:{"Content-Type":"multipart/form-data"}});o(Ht.user),St.success("Profile picture updated successfully!")}catch(mt){console.error("Upload error:",mt),St.error(((ss=(os=mt.response)==null?void 0:os.data)==null?void 0:ss.message)||"Failed to upload image")}finally{g(!1)}},we=P.profile.height&&P.profile.weight?(P.profile.weight/Math.pow(P.profile.height/100,2)).toFixed(1):null,V=(Je=>Je?Je<18.5?{label:"Underweight",color:"blue"}:Je<25?{label:"Normal",color:"emerald"}:Je<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat(we));return n.jsxs("div",{className:"w-full overflow-x-hidden space-y-6 animate-fade-in px-3 md:px-6 pb-24",children:[n.jsx("input",{ref:x,type:"file",accept:"image/*",onChange:ie,className:"hidden"}),n.jsxs("div",{className:"hidden md:block",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),n.jsxs("div",{className:"bg-gradient-to-br from-[#2FC8B9] to-[#1db7a6] rounded-3xl p-6 md:p-8 text-white relative overflow-hidden shadow-xl",children:[n.jsxs("div",{className:"absolute inset-0 opacity-10",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"}),n.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full translate-y-1/2 -translate-x-1/2"})]}),n.jsxs("div",{className:"relative flex flex-col items-center text-center gap-4",children:[n.jsxs("div",{className:"relative group",children:[a!=null&&a.profilePicture?n.jsx("img",{src:a.profilePicture,alt:a.name,className:"w-24 h-24 md:w-32 md:h-32 rounded-full object-cover border-4 border-white/30 shadow-2xl"}):n.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-4xl md:text-5xl font-black border-4 border-white/30 shadow-2xl",children:(_e=(kt=a==null?void 0:a.name)==null?void 0:kt[0])==null?void 0:_e.toUpperCase()}),n.jsx("button",{onClick:()=>{var Je;return(Je=x.current)==null?void 0:Je.click()},disabled:p,className:"absolute inset-0 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:p?n.jsx("div",{className:"w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"}):n.jsx(ZR,{className:"w-8 h-8 text-white"})}),n.jsx("button",{onClick:()=>{var Je;return(Je=x.current)==null?void 0:Je.click()},disabled:p,className:"absolute -bottom-2 -right-2 w-10 h-10 bg-white rounded-full flex items-center justify-center text-[#2FC8B9] shadow-lg hover:scale-110 transition-transform disabled:opacity-50",children:p?n.jsx("div",{className:"w-4 h-4 border-2 border-[#2FC8B9]/30 border-t-[#2FC8B9] rounded-full animate-spin"}):n.jsx(lo,{className:"w-5 h-5"})})]}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl md:text-3xl font-black",children:a==null?void 0:a.name}),n.jsxs("div",{className:"flex flex-col gap-2 mt-3 text-white/90 text-sm md:text-base",children:[n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsx(aE,{className:"w-4 h-4"})," ",a==null?void 0:a.email]}),(a==null?void 0:a.phone)&&n.jsxs("span",{className:"flex items-center justify-center gap-2",children:[n.jsx(aQ,{className:"w-4 h-4"})," ",a==null?void 0:a.phone]})]})]}),n.jsxs("div",{className:"flex gap-4 mt-2 w-full max-w-md",children:[n.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-2xl flex-1",children:[n.jsx("p",{className:"text-3xl font-black",children:((xt=a==null?void 0:a.healthMetrics)==null?void 0:xt.healthScore)||"--"}),n.jsx("p",{className:"text-sm text-white/80 mt-1",children:"Health Score"})]}),we&&n.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-2xl flex-1",children:[n.jsx("p",{className:"text-3xl font-black",children:we}),n.jsx("p",{className:"text-sm text-white/80 mt-1",children:"BMI"})]})]})]})]}),n.jsx(fce,{}),n.jsx("div",{className:"flex gap-1 md:gap-2 p-1 bg-slate-100 rounded-xl w-full md:w-fit overflow-x-auto",children:[{id:"profile",label:"Profile",icon:Jd},{id:"goals",label:"Set Goal",icon:Ah}].map(Je=>n.jsxs("button",{onClick:()=>E(Je.id),className:`flex items-center gap-1 md:gap-2 px-3 md:px-5 py-2 md:py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${v===Je.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[n.jsx(Je.icon,{className:"w-4 h-4"}),Je.label]},Je.id))}),v==="profile"&&n.jsxs("form",{onSubmit:re,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[n.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-800 mb-4 md:mb-6 flex items-center gap-2",children:[n.jsx(Jd,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",name:"name",value:P.name,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",value:a==null?void 0:a.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",name:"profile.age",value:P.profile.age,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),n.jsxs("select",{name:"profile.gender",value:P.profile.gender,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"",children:"Select gender"}),n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),n.jsxs("select",{name:"profile.dietaryPreference",value:P.profile.dietaryPreference,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),n.jsx("option",{value:"vegetarian",children:"Vegetarian"}),n.jsx("option",{value:"vegan",children:"Vegan"}),n.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Ca,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",name:"profile.height",value:P.profile.height,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),n.jsx("input",{type:"number",name:"profile.weight",value:P.profile.weight,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),n.jsxs("select",{name:"profile.bloodGroup",value:P.profile.bloodGroup,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[n.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Je=>n.jsx("option",{value:Je,children:Je},Je))]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Li,{className:"w-5 h-5 text-amber-500"}),"Medical Conditions"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("label",{className:"block text-sm font-medium text-slate-700",children:["Chronic Conditions ",n.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),n.jsx("input",{type:"text",name:"profile.medicalHistory.conditions",value:P.profile.medicalHistory.conditions.join(", "),onChange:Je=>{const $e=Je.target.value.split(",").map(jt=>jt.trim()).filter(Boolean);H(jt=>({...jt,profile:{...jt.profile,medicalHistory:{...jt.profile.medicalHistory,conditions:$e}}}))},className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]}),P.profile.diabetesProfile&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(eh,{className:"w-5 h-5 text-purple-500"}),"Diabetes Management"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Diabetes Type"}),n.jsxs("select",{name:"profile.diabetesProfile.type",value:P.profile.diabetesProfile.type,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4",children:[n.jsx("option",{value:"Type 1",children:"Type 1"}),n.jsx("option",{value:"Type 2",children:"Type 2"}),n.jsx("option",{value:"Prediabetes",children:"Prediabetes"}),n.jsx("option",{value:"Gestational",children:"Gestational"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"HbA1c Level (%)"}),n.jsx("input",{type:"number",step:"0.1",name:"profile.diabetesProfile.hba1c",value:P.profile.diabetesProfile.hba1c,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Diagnosis Year"}),n.jsx("input",{type:"number",name:"profile.diabetesProfile.diagnosisYear",value:P.profile.diabetesProfile.diagnosisYear,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Status"}),n.jsxs("select",{name:"profile.diabetesProfile.status",value:P.profile.diabetesProfile.status,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4",children:[n.jsx("option",{value:"Controlled",children:"Controlled"}),n.jsx("option",{value:"Uncontrolled",children:"Uncontrolled"}),n.jsx("option",{value:"Newly diagnosed",children:"Newly diagnosed"})]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(br,{className:"w-5 h-5 text-green-500"}),"Lifestyle Habits"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Sleep Hours"}),n.jsx("input",{type:"number",name:"profile.lifestyle.sleepHours",value:P.profile.lifestyle.sleepHours,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Water Intake (glasses)"}),n.jsx("input",{type:"number",name:"profile.lifestyle.waterIntake",value:P.profile.lifestyle.waterIntake,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Stress Level"}),n.jsxs("select",{name:"profile.lifestyle.stressLevel",value:P.profile.lifestyle.stressLevel,onChange:$,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500",children:[n.jsx("option",{value:"low",children:"Low"}),n.jsx("option",{value:"moderate",children:"Moderate"}),n.jsx("option",{value:"high",children:"High"})]})]}),n.jsxs("div",{className:"flex flex-col gap-4 justify-center",children:[n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",name:"profile.lifestyle.smoker",checked:P.profile.lifestyle.smoker,onChange:$,className:"w-5 h-5 text-cyan-500 rounded border-slate-300 focus:ring-cyan-500"}),n.jsx("span",{className:"text-slate-700 font-medium",children:"Smoker"})]}),n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",name:"profile.lifestyle.alcohol",checked:P.profile.lifestyle.alcohol,onChange:$,className:"w-5 h-5 text-cyan-500 rounded border-slate-300 focus:ring-cyan-500"}),n.jsx("span",{className:"text-slate-700 font-medium",children:"Consume Alcohol"})]})]})]})]}),n.jsx("button",{type:"submit",disabled:d,className:"w-full py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:d?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsxs(n.Fragment,{children:[n.jsx(oQ,{className:"w-5 h-5"}),"Save Changes"]})})]}),n.jsxs("div",{className:"space-y-6",children:[we&&n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:`w-24 h-24 rounded-full bg-${V.color}-100 flex items-center justify-center mx-auto mb-4`,children:n.jsx("span",{className:`text-3xl font-bold text-${V.color}-600`,children:we})}),n.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${V.color}-100 text-${V.color}-700`,children:V.label})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),n.jsx("div",{className:"space-y-3",children:n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[n.jsx("span",{className:"text-slate-600",children:"Subscription"}),n.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((Ke=a==null?void 0:a.subscription)==null?void 0:Ke.plan)||"Free"})]})})]})]})]}),v==="goals"&&n.jsxs("form",{onSubmit:J,className:"max-w-4xl space-y-6",children:[C&&n.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-2xl border-2 border-blue-200 p-3 md:p-6 shadow-sm w-full overflow-hidden",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg md:text-xl font-bold text-blue-900 mb-1",children:"Your Current Goal"}),n.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:"Daily targets calculated based on your goal"})]}),n.jsx("div",{className:"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold capitalize text-sm md:text-base whitespace-nowrap",children:C.goalType.replace("_"," ")})]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mt-4",children:[n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Daily Calories"}),n.jsx("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:C.dailyCalorieTarget})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Protein"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[C.macroTargets.protein,"g"]})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Carbs"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[C.macroTargets.carbs,"g"]})]}),n.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[n.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Fats"}),n.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[C.macroTargets.fats,"g"]})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[n.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:C?"Update Your Fitness Goal":"Set Your Fitness Goal"}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Goal Type"}),n.jsxs("select",{name:"goalType",value:k.goalType,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"weight_loss",children:"Weight Loss (Fat Loss)"}),n.jsx("option",{value:"muscle_gain",children:"Muscle Gain (Bulking)"}),n.jsx("option",{value:"weight_gain",children:"Weight Gain"}),n.jsx("option",{value:"maintenance",children:"Maintenance"}),n.jsx("option",{value:"health_improvement",children:"Health Improvement"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Activity Level"}),n.jsxs("select",{name:"activityLevel",value:k.activityLevel,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),n.jsx("option",{value:"light",children:"Light (Exercise 1-3 days/week)"}),n.jsx("option",{value:"moderate",children:"Moderate (Exercise 3-5 days/week)"}),n.jsx("option",{value:"active",children:"Active (Exercise 6-7 days/week)"}),n.jsx("option",{value:"very_active",children:"Very Active (Hard exercise daily)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Weight (kg)"}),n.jsx("input",{type:"number",name:"currentWeight",value:k.currentWeight,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Target Weight (kg)"}),n.jsx("input",{type:"number",name:"targetWeight",value:k.targetWeight,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",name:"height",value:k.height,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"100",max:"250"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",name:"age",value:k.age,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"10",max:"120"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),n.jsxs("select",{name:"gender",value:k.gender,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),n.jsxs("select",{name:"dietaryPreference",value:k.dietaryPreference,onChange:ge,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[n.jsx("option",{value:"vegetarian",children:"Vegetarian"}),n.jsx("option",{value:"vegan",children:"Vegan"}),n.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),n.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]}),n.jsxs("button",{type:"submit",disabled:O,className:"mt-6 w-full md:w-auto px-8 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-lg font-medium hover:shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[n.jsx(Ah,{className:"w-5 h-5"}),O?"Calculating...":C?"Update Goal":"Set Goal & Calculate Targets"]})]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Li,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"How it works (Scientifically Backed)"}),n.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["We use the ",n.jsx("strong",{children:"Mifflin-St Jeor equation"})," (industry standard used by WHO, fitness apps, and hospitals) to calculate your BMR:"]}),n.jsxs("p",{className:"text-xs text-blue-600 font-mono mb-2",children:["Male: BMR = (10  weight) + (6.25  height)  (5  age) + 5",n.jsx("br",{}),"Female: BMR = (10  weight) + (6.25  height)  (5  age)  161"]}),n.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Then we calculate TDEE (Total Daily Energy Expenditure) by multiplying BMR with your activity level, and adjust calories based on your goal:"}),n.jsxs("ul",{className:"text-xs text-blue-600 space-y-1 ml-4",children:[n.jsx("li",{children:" Muscle Gain: +350 calories"}),n.jsx("li",{children:" Fat Loss: -400 calories"}),n.jsx("li",{children:" Maintenance: No adjustment"})]}),n.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[n.jsx("strong",{children:"Macros:"})," Protein = 1.6g per kg body weight (realistic & sustainable), Fats = 0.8g per kg, Carbs = remaining calories. These targets will be used throughout the platform to track your nutrition and provide personalized recommendations."]})]})]})})]})]})}const X2={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},vle=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],$l={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},uR=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],wle=[{_id:"apt1",doctor:uR[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],D6={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},J2={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},B6=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],_le=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function yle(){const[a,o]=ee.useState("dashboard"),[c,d]=ee.useState(!1),[h,p]=ee.useState([]),[g,x]=ee.useState(""),[v,E]=ee.useState(!1),[C,I]=ee.useState(!1),[O,R]=ee.useState(null),[k,M]=ee.useState(0),[P,H]=ee.useState({date:"",slot:"",type:"online"}),[$,re]=ee.useState(uR),[J,ge]=ee.useState(wle),[ie,we]=ee.useState("All"),[Ae,V]=ee.useState(""),[ce,Y]=ee.useState(0),[z,te]=ee.useState(null),[se,Ce]=ee.useState(!1),[he,Ne]=ee.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[Z,Ie]=ee.useState(!1),[Ve,Pe]=ee.useState(X2.profile),ne=ee.useRef(null);ee.useEffect(()=>{var Ke;(Ke=ne.current)==null||Ke.scrollIntoView({behavior:"smooth"})},[h]);const ve=Ke=>{if(Ke.preventDefault(),!g.trim())return;const Je=g.toLowerCase();p($e=>[...$e,{role:"user",content:g}]),x(""),setTimeout(()=>{const $e=Object.keys(J2).find(jt=>Je.includes(jt));p(jt=>[...jt,{role:"assistant",content:J2[$e]||J2.default}])},800)},ue=()=>{if(k===0)M(1);else if(k===1&&P.date&&P.slot)M(2);else if(k===2){const Ke={_id:`apt${Date.now()}`,doctor:O,date:P.date,timeSlot:P.slot,status:"confirmed",type:P.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:O.fee/2};ge(Je=>[Ke,...Je]),M(3)}},Te=()=>{R(null),M(0),H({date:"",slot:"",type:"online"})},Be=()=>{ce===0&&z&&(Y(1),Ce(!0),setTimeout(()=>{Ce(!1),Y(2)},2500))},Ue=()=>{he.name&&he.specialization&&he.fee&&(re(Ke=>[...Ke,{...he,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),Ne({name:"",specialization:"",experience:"",fee:"",hospital:""}),Ie(!1))},tt=$.filter(Ke=>(ie==="All"||Ke.specialization===ie)&&Ke.name.toLowerCase().includes(Ae.toLowerCase())),ot=({trend:Ke})=>Ke==="improved"?n.jsx(qi,{className:"w-4 h-4 text-green-600"}):Ke==="declined"?n.jsx(ah,{className:"w-4 h-4 text-red-600"}):n.jsx(kg,{className:"w-4 h-4 text-gray-400"}),ut=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),n.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),n.jsxs("button",{onClick:()=>o("upload"),className:"btn-primary flex items-center gap-2",children:[n.jsx(lo,{className:"w-4 h-4"})," Upload Report"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:br,color:"primary",label:"Health Score",value:"78/100"},{icon:Hn,color:"blue",label:"Total Reports",value:"6"},{icon:qi,color:"green",label:"BMI",value:"23.5"},{icon:yi,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((Ke,Je)=>n.jsx("div",{className:"card",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:`w-12 h-12 bg-${Ke.color}-100 rounded-xl flex items-center justify-center`,children:n.jsx(Ke.icon,{className:`w-6 h-6 text-${Ke.color}-600`})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-500",children:Ke.label}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Ke.value})]})]})},Je))}),J.length>0&&n.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(yi,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),J.filter(Ke=>Ke.status==="confirmed").map(Ke=>n.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Ke.doctor.name[4]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:Ke.doctor.name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[Ke.doctor.specialization,"  ",Ke.date," at ",Ke.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[Ke.type==="online"&&Ke.meetLink&&n.jsxs("a",{href:Ke.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[n.jsx(gg,{className:"w-4 h-4"})," Join Call"]}),n.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},Ke._id))]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),n.jsx(Yp,{width:"100%",height:200,children:n.jsxs(cQ,{data:vle,children:[n.jsx(Eg,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),n.jsx(Cg,{dataKey:"date"}),n.jsx(Sg,{domain:[0,100]}),n.jsx(ex,{}),n.jsx(lQ,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(lh,{className:"w-5 h-5 text-green-600"}),n.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),n.jsx("ul",{className:"space-y-2",children:$l.recommendations.diet.map((Ke,Je)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),n.jsxs("span",{children:[n.jsx("strong",{children:Ke.item})," - ",Ke.reason]})]},Je))})]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(GT,{className:"w-5 h-5 text-blue-600"}),n.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),n.jsx("ul",{className:"space-y-2",children:$l.recommendations.exercise.map((Ke,Je)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),n.jsxs("span",{children:[n.jsx("strong",{children:Ke.activity})," - ",Ke.duration,", ",Ke.frequency]})]},Je))})]})]}),n.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Li,{className:"w-5 h-5 text-orange-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$l.doctorConsultation.reason}),n.jsxs("p",{className:"text-sm mt-2",children:[n.jsx("strong",{children:"Specialists:"})," ",$l.doctorConsultation.specializations.join(", ")]}),n.jsx("button",{onClick:()=>o("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),Tt=()=>n.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),n.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),ce===0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"card",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),n.jsx("select",{className:"input",children:_le.map(Ke=>n.jsx("option",{children:Ke},Ke))})]}),n.jsxs("div",{className:"card",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),z?n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Hn,{className:"w-10 h-10 text-primary-600"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:z.name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[z.size," MB"]})]})]}),n.jsx("button",{onClick:()=>te(null),className:"p-2 text-gray-400 hover:text-red-500",children:n.jsx(Gn,{className:"w-5 h-5"})})]}):n.jsxs("div",{onClick:()=>te({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[n.jsx(lo,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),n.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),n.jsxs("button",{onClick:Be,disabled:!z,className:"btn-primary w-full flex items-center justify-center gap-2",children:[n.jsx(lo,{className:"w-5 h-5"})," Analyze Report"]})]}),ce===1&&n.jsxs("div",{className:"card text-center py-12",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),n.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((Ke,Je)=>n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(GA,{className:"w-4 h-4 text-green-600"}),n.jsx("span",{children:Ke})]},Je))})]}),ce===2&&n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(GA,{className:"w-8 h-8 text-green-600"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),n.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),n.jsx("button",{onClick:()=>o("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[n.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Qe=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c?"Manage Doctors":"Find Doctors"}),n.jsx("p",{className:"text-gray-600",children:c?"Add and manage platform doctors":"Book consultations with specialists"})]}),c&&n.jsxs("button",{onClick:()=>Ie(!0),className:"btn-primary flex items-center gap-2",children:[n.jsx(Zo,{className:"w-4 h-4"})," Add Doctor"]})]}),n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Dy,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Search doctors...",value:Ae,onChange:Ke=>V(Ke.target.value),className:"input pl-12"})]}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:B6.slice(0,5).map(Ke=>n.jsx("button",{onClick:()=>we(Ke),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${ie===Ke?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Ke},Ke))})]}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:tt.map(Ke=>{var Je;return n.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((Je=Ke.name.split(" ")[1])==null?void 0:Je[0])||Ke.name[0]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:Ke.name}),n.jsx("p",{className:"text-sm text-primary-600",children:Ke.specialization}),n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.jsx(zA,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),n.jsx("span",{className:"text-sm font-medium",children:Ke.rating}),n.jsxs("span",{className:"text-sm text-gray-500",children:["(",Ke.reviews,")"]})]})]})]}),n.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Oc,{className:"w-4 h-4"}),n.jsxs("span",{children:[Ke.experience," years experience"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(WT,{className:"w-4 h-4"}),n.jsx("span",{children:Ke.hospital})]})]}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",Ke.fee]}),n.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),Ke.available?n.jsx("button",{onClick:()=>{R(Ke),M(0)},className:"btn-primary text-sm",children:"Book Now"}):n.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},Ke._id)})}),Z&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),n.jsx("button",{onClick:()=>Ie(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),n.jsx("input",{type:"text",value:he.name,onChange:Ke=>Ne({...he,name:Ke.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),n.jsxs("select",{value:he.specialization,onChange:Ke=>Ne({...he,specialization:Ke.target.value}),className:"input",children:[n.jsx("option",{value:"",children:"Select"}),B6.slice(1).map(Ke=>n.jsx("option",{children:Ke},Ke))]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),n.jsx("input",{type:"number",value:he.experience,onChange:Ke=>Ne({...he,experience:Ke.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),n.jsx("input",{type:"number",value:he.fee,onChange:Ke=>Ne({...he,fee:Ke.target.value}),className:"input"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),n.jsx("input",{type:"text",value:he.hospital,onChange:Ke=>Ne({...he,hospital:Ke.target.value}),className:"input"})]}),n.jsx("button",{onClick:Ue,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),it=()=>{var Ke;return O&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[k<3&&n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold",children:k===0?"Book Appointment":k===1?"Select Slot":"Payment"}),n.jsx("button",{onClick:Te,className:"p-2 hover:bg-gray-100 rounded-lg",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),k===0&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[n.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(Ke=O.name.split(" ")[1])==null?void 0:Ke[0]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold",children:O.name}),n.jsx("p",{className:"text-sm text-primary-600",children:O.specialization}),n.jsx("p",{className:"text-sm text-gray-500",children:O.hospital})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),n.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(Je=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"radio",name:"type",checked:P.type===Je,onChange:()=>H({...P,type:Je}),className:"text-primary-600"}),Je==="online"?n.jsxs(n.Fragment,{children:[n.jsx(gg,{className:"w-4 h-4"})," Online"]}):n.jsxs(n.Fragment,{children:[n.jsx(WT,{className:"w-4 h-4"})," In-Person"]})]},Je))})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[n.jsxs("p",{className:"text-sm text-blue-800",children:[n.jsx("strong",{children:"Consultation Fee:"})," ",O.fee]}),n.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",O.fee/2," now to confirm (50% advance)"]})]}),n.jsx("button",{onClick:ue,className:"btn-primary w-full",children:"Select Date & Time"})]}),k===1&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),n.jsx("input",{type:"date",value:P.date,onChange:Je=>H({...P,date:Je.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:O.slots.map(Je=>n.jsx("button",{onClick:()=>H({...P,slot:Je}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${P.slot===Je?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Je},Je))})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:()=>M(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),n.jsx("button",{onClick:ue,disabled:!P.date||!P.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),k===2&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Doctor"}),n.jsx("span",{className:"font-medium",children:O.name})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Date"}),n.jsx("span",{className:"font-medium",children:P.date})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Time"}),n.jsx("span",{className:"font-medium",children:P.slot})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600",children:"Type"}),n.jsx("span",{className:"font-medium capitalize",children:P.type})]}),n.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[n.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),n.jsxs("span",{className:"font-bold text-primary-600",children:["",O.fee/2]})]})]}),n.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx(dQ,{className:"w-5 h-5 text-gray-600"}),n.jsx("span",{className:"font-medium",children:"Payment Method"})]}),n.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(Je=>n.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[n.jsx("input",{type:"radio",name:"payment",defaultChecked:Je==="UPI"}),n.jsx("span",{children:Je})]},Je))})]}),n.jsxs("button",{onClick:ue,className:"btn-primary w-full flex items-center justify-center gap-2",children:[n.jsx(nQ,{className:"w-4 h-4"})," Pay ",O.fee/2," Securely"]})]}),k===3&&n.jsxs("div",{className:"text-center py-6",children:[n.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(GA,{className:"w-8 h-8 text-green-600"})}),n.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),n.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Doctor:"})," ",O.name]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Date:"})," ",P.date," at ",P.slot]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Type:"})," ",P.type==="online"?"Video Consultation":"In-Person"]}),P.type==="online"&&n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[n.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[n.jsx(gg,{className:"w-4 h-4"})," Video Call Link"]}),n.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),n.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),n.jsx("button",{onClick:()=>{Te(),o("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},kt=()=>{var Ke,Je;return n.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),n.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),n.jsx("div",{className:"card gradient-bg text-white",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:n.jsx(br,{className:"w-8 h-8"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),n.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),n.jsxs("div",{className:"ml-auto text-right",children:[n.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),n.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Jd,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),n.jsx("input",{type:"text",value:X2.name,className:"input",readOnly:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),n.jsx("input",{type:"email",value:X2.email,className:"input bg-gray-50",disabled:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),n.jsx("input",{type:"number",value:Ve.age,onChange:$e=>Pe({...Ve,age:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),n.jsxs("select",{value:Ve.gender,onChange:$e=>Pe({...Ve,gender:$e.target.value}),className:"input",children:[n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]})]})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),n.jsx("input",{type:"number",value:Ve.height,onChange:$e=>Pe({...Ve,height:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),n.jsx("input",{type:"number",value:Ve.weight,onChange:$e=>Pe({...Ve,weight:$e.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),n.jsx("select",{value:Ve.bloodGroup,onChange:$e=>Pe({...Ve,bloodGroup:$e.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map($e=>n.jsx("option",{children:$e},$e))})]})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),n.jsx("input",{type:"text",value:(Ke=Ve.allergies)==null?void 0:Ke.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),n.jsx("input",{type:"text",value:(Je=Ve.chronicConditions)==null?void 0:Je.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),n.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[n.jsx(GA,{className:"w-5 h-5"})," Save Changes"]})]})},_e=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("button",{onClick:()=>o("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("div",{className:"card",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:n.jsx(Hn,{className:"w-7 h-7 text-primary-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),n.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),n.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),n.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[n.jsxs("button",{onClick:()=>E(!v),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[n.jsx(H3,{className:"w-4 h-4"}),v?"Hide":"Compare"]}),n.jsxs("button",{onClick:()=>I(!C),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[n.jsx(G3,{className:"w-4 h-4"}),"Ask AI"]})]})]}),v&&n.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[n.jsx(H3,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),n.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),n.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),n.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),n.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),n.jsx("p",{className:"text-gray-700 mb-4",children:D6.summary}),n.jsx("div",{className:"space-y-2 mb-4",children:D6.metricChanges.map((Ke,Je)=>n.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ot,{trend:Ke.change}),n.jsx("span",{className:"font-medium",children:Ke.metric})]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-gray-500",children:Ke.previous}),"  ",n.jsx("span",{className:"font-medium",children:Ke.current})]})]},Je))})]}),C&&n.jsxs("div",{className:"card border-2 border-purple-200",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(G3,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),n.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[h.length===0&&n.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),h.map((Ke,Je)=>n.jsx("div",{className:`flex ${Ke.role==="user"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${Ke.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:Ke.content})},Je)),n.jsx("div",{ref:ne})]}),n.jsxs("form",{onSubmit:ve,className:"flex gap-2",children:[n.jsx("input",{type:"text",value:g,onChange:Ke=>x(Ke.target.value),placeholder:"Ask a question...",className:"input flex-1"}),n.jsx("button",{type:"submit",className:"btn-primary px-4",children:n.jsx(oE,{className:"w-5 h-5"})})]})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(br,{className:"w-5 h-5 text-primary-600"})," Summary"]}),n.jsx("p",{className:"text-gray-700",children:$l.summary})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),n.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries($l.metrics).map(([Ke,Je])=>n.jsxs("div",{className:`p-4 rounded-xl ${Je.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[n.jsx("p",{className:"text-sm text-gray-600 capitalize",children:Ke.replace(/([A-Z])/g," $1")}),n.jsxs("p",{className:"text-xl font-bold",children:[Je.value," ",Je.unit]}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",Je.normalRange]}),n.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${Je.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:Je.status})]},Ke))})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(Ca,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),n.jsx("ul",{className:"space-y-2",children:$l.keyFindings.map((Ke,Je)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),Ke]},Je))})]}),n.jsxs("div",{className:"card border-l-4 border-orange-400",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[n.jsx(th,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),n.jsx("ul",{className:"space-y-2",children:$l.riskFactors.map((Ke,Je)=>n.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),Ke]},Je))})]})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(lh,{className:"w-5 h-5 text-green-600"})," Diet"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:$l.recommendations.diet.map((Ke,Je)=>n.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"font-medium text-green-800",children:Ke.item}),n.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${Ke.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:Ke.priority})]}),n.jsx("p",{className:"text-sm text-green-700",children:Ke.reason})]},Je))})]}),n.jsxs("div",{className:"card",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(GT,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),$l.recommendations.exercise.map((Ke,Je)=>n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[n.jsxs("div",{className:"flex justify-between mb-2",children:[n.jsx("span",{className:"font-medium text-blue-800",children:Ke.activity}),n.jsxs("span",{className:"text-sm text-blue-600",children:[Ke.duration,"  ",Ke.frequency]})]}),n.jsx("p",{className:"text-sm text-blue-700",children:Ke.reason})]},Je))]}),n.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[n.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[n.jsx(yg,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:uR.filter(Ke=>$l.doctorConsultation.specializations.includes(Ke.specialization)).map(Ke=>n.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:Ke.name.split(" ")[1][0]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:Ke.name}),n.jsx("p",{className:"text-sm text-primary-600",children:Ke.specialization})]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[n.jsx(zA,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),Ke.rating,"  ",n.jsx(Oc,{className:"w-4 h-4"}),Ke.experience," yrs"]}),n.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[n.jsxs("span",{className:"font-semibold",children:["",Ke.fee]}),n.jsx("button",{onClick:()=>{R(Ke),o("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},Ke._id))})]})]}),xt=()=>n.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:n.jsx(br,{className:"w-6 h-6 text-white"})}),n.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),n.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),n.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:qre,label:"Dashboard"},{id:"upload",icon:lo,label:"Upload Report"},{id:"report",icon:Hn,label:"Report & Chat"},{id:"doctors",icon:yg,label:"Doctors"},{id:"profile",icon:Jd,label:"Profile"}].map(Ke=>n.jsxs("button",{onClick:()=>o(Ke.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${a===Ke.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[n.jsx(Ke.icon,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:Ke.label})]},Ke.id))}),n.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Ke=>d(Ke.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),n.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),n.jsx(Ig,{className:"w-4 h-4 text-gray-400"})]})}),n.jsx("div",{className:"p-4 border-t border-gray-100",children:n.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[n.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:c?"Admin User":"John Doe"}),n.jsx("p",{className:"text-xs text-gray-500 truncate",children:c?"admin@healthai.com":"john@example.com"})]}),n.jsx(zR,{className:"w-5 h-5 text-gray-400"})]})})]});return n.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[n.jsx(xt,{}),n.jsxs("main",{className:"flex-1 ml-64 p-8",children:[a==="dashboard"&&n.jsx(ut,{}),a==="upload"&&n.jsx(Tt,{}),a==="report"&&n.jsx(_e,{}),a==="doctors"&&n.jsx(Qe,{}),a==="profile"&&n.jsx(kt,{})]}),n.jsx(it,{})]})}function Ele(){const[a,o]=ee.useState(null),[c,d]=ee.useState(!0),[h,p]=ee.useState("overview");ee.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:v}=await wy.getStats();o(v)}catch{St.error("Failed to load stats")}finally{d(!1)}};if(c)return n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const x=[{id:"overview",label:"Overview",icon:br},{id:"doctors",label:"Doctors",icon:AQ}];return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),n.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:x.map(({id:v,label:E,icon:C})=>n.jsxs("button",{onClick:()=>p(v),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${h===v?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[n.jsx(C,{className:"w-4 h-4"}),n.jsx("span",{children:E})]},v))}),h==="overview"&&n.jsx(Cle,{stats:a}),h==="doctors"&&n.jsx(Sle,{})]})}function Cle({stats:a}){var o,c,d,h;return a?n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:n.jsx(yg,{className:"w-5 h-5 text-blue-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=a.stats)==null?void 0:o.totalUsers)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:n.jsx(Tn,{className:"w-5 h-5 text-green-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((c=a.stats)==null?void 0:c.activeUsers)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:n.jsx(Hn,{className:"w-5 h-5 text-purple-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((d=a.stats)==null?void 0:d.totalReports)||0})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:n.jsx(Li,{className:"w-5 h-5 text-amber-600"})}),n.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),n.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((h=a.stats)==null?void 0:h.pendingDoctors)||0})]})]}):null}function Sle(){const[a,o]=ee.useState([]),[c,d]=ee.useState(!0),[h,p]=ee.useState("all");ee.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:I}=await wy.getDoctors();o(I.doctors||[])}catch{St.error("Failed to load doctors")}finally{d(!1)}},x=async I=>{try{await wy.approveDoctor(I),o(a.map(O=>O._id===I?{...O,approvalStatus:"approved",isListed:!0}:O)),St.success("Doctor approved!")}catch{St.error("Failed to approve")}},v=async I=>{try{await wy.rejectDoctor(I),o(a.map(O=>O._id===I?{...O,approvalStatus:"rejected",isListed:!1}:O)),St.success("Doctor rejected")}catch{St.error("Failed to reject")}},E=a.filter(I=>h==="all"?!0:I.approvalStatus===h),C=a.filter(I=>I.approvalStatus==="pending").length;return c?n.jsx(XA,{}):n.jsxs("div",{className:"space-y-4",children:[C>0&&n.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[n.jsx(Li,{className:"w-6 h-6 text-amber-500"}),n.jsx("div",{className:"flex-1",children:n.jsxs("p",{className:"font-medium text-amber-800",children:[C," Doctor(s) Pending Approval"]})}),n.jsx("button",{onClick:()=>p("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),n.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(I=>n.jsx("button",{onClick:()=>p(I),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${h===I?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:I},I))})]}),n.jsxs("div",{className:"space-y-3",children:[E.map(I=>{var O,R;return n.jsx("div",{className:`p-4 rounded-xl border ${I.approvalStatus==="pending"?"bg-amber-50 border-amber-200":I.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-orange-500 flex items-center justify-center text-white font-bold",children:(R=(O=I.name)==null?void 0:O[0])==null?void 0:R.toUpperCase()}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",I.name]}),n.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${I.approvalStatus==="approved"?"bg-green-100 text-green-700":I.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:I.approvalStatus})]}),n.jsx("p",{className:"text-sm text-cyan-600",children:I.specialization}),n.jsxs("p",{className:"text-xs text-slate-500",children:[I.experience," yrs  ",I.consultationFee||0]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:I.approvalStatus==="pending"&&n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>x(I._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[n.jsx(Tn,{className:"w-4 h-4"})," Approve"]}),n.jsxs("button",{onClick:()=>v(I._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[n.jsx(rQ,{className:"w-4 h-4"})," Reject"]})]})})]})},I._id)}),E.length===0&&n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(AQ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),n.jsx("p",{children:"No doctors found"})]})]})]})]})}const Nle=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:zA},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:td,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:zT}];function Tle(){var E;const{user:a}=da(),[o,c]=ee.useState(null),[d,h]=ee.useState(!0),[p,g]=ee.useState("monthly");ee.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:C}=await jae.getSubscription();c(C)}catch{console.error("Failed to fetch subscription")}finally{h(!1)}},v=(o==null?void 0:o.plan)||((E=a==null?void 0:a.subscription)==null?void 0:E.plan)||"free";return d?n.jsx(XA,{}):n.jsxs("div",{className:"w-full mx-auto space-y-8 animate-fade-in",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[n.jsx(zT,{className:"w-4 h-4"}),"Subscription Plans"]}),n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),n.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),n.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-orange-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 opacity-10",children:n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),n.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:n.jsx(zT,{className:"w-7 h-7"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),n.jsx("h2",{className:"text-2xl font-bold capitalize",children:v})]})]}),n.jsxs("div",{className:"flex items-center gap-6",children:[(o==null?void 0:o.endDate)&&n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),n.jsx("p",{className:"font-semibold",children:new Date(o.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),n.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[n.jsx(yi,{className:"w-4 h-4"}),n.jsx("span",{className:"font-medium capitalize",children:(o==null?void 0:o.status)||"Active"})]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[n.jsx("button",{onClick:()=>g("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${p==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),n.jsxs("button",{onClick:()=>g("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${p==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",n.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),n.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:Nle.map(C=>{const I=C.icon,O=v===C.id,R=p==="yearly"?Math.round(C.price*12*.8):C.price;return n.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${C.popular?"border-cyan-500":"border-slate-700"} ${O?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[C.popular&&n.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:n.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),n.jsxs("div",{className:"text-center mb-6 pt-2",children:[n.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${C.color}-500/20`,children:n.jsx(I,{className:`w-7 h-7 text-${C.color}-400`})}),n.jsx("h3",{className:"text-xl font-bold text-white",children:C.name}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("span",{className:"text-4xl font-bold text-white",children:["",R]}),n.jsxs("span",{className:"text-slate-400",children:["/",p==="yearly"?"year":C.period]})]})]}),n.jsx("ul",{className:"space-y-3 mb-8",children:C.features.map((k,M)=>n.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[n.jsx("div",{className:`w-5 h-5 rounded-full bg-${C.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:n.jsx(GA,{className:`w-3 h-3 text-${C.color}-400`})}),n.jsx("span",{className:"text-slate-400",children:k})]},M))}),n.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${O?"bg-slate-800 text-slate-500 cursor-default":C.popular?"bg-gradient-to-r from-purple-500 to-orange-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:O,children:O?"Current Plan":C.price===0?"Downgrade":"Upgrade Now"})]},C.id)})}),n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:n.jsx(dQ,{className:"w-6 h-6 text-blue-400"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),n.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const Ib=[{id:"apple_watch",name:"Apple Watch",icon:HA,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:br,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:td,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:qi,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:$V,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:Og,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function Rle(){const[a,o]=ee.useState([]),[c,d]=ee.useState(!0),[h,p]=ee.useState(!1),[g,x]=ee.useState(!1),[v,E]=ee.useState(null);ee.useEffect(()=>{C()},[]);const C=async()=>{try{const{data:P}=await cg.getDashboard();P.devices&&o(P.devices)}catch(P){console.error("Failed to fetch devices:",P)}finally{d(!1)}},I=async()=>{p(!0);try{a.length>0?(await cg.generateDemoData(a[0].type),await C(),St.success("All devices synced successfully!")):St.error("No devices connected")}catch(P){console.error("Sync failed:",P),St.error("Failed to sync devices")}finally{p(!1)}},O=async P=>{try{const H=Ib.find($=>$.id===P);await cg.connectDevice(P,H==null?void 0:H.name),await cg.generateDemoData(P),await C(),x(!1),St.success(`${H==null?void 0:H.name} connected successfully!`)}catch(H){console.error("Failed to connect:",H),St.error("Failed to connect device")}},R=async P=>{try{await cg.disconnectDevice(P),await C(),St.success("Device disconnected")}catch(H){console.error("Failed to disconnect:",H),St.error("Failed to disconnect device")}},k=P=>{const H=Ib.find($=>$.id===P);return(H==null?void 0:H.icon)||HA},M=P=>{const H=Ib.find($=>$.id===P);return(H==null?void 0:H.color)||"bg-slate-600"};return c?n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),n.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[n.jsx(Oc,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:I,disabled:h||a.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[n.jsx(Yre,{className:`w-4 h-4 ${h?"animate-spin":""}`}),"Sync All"]}),n.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-xl hover:shadow-lg transition-all",children:[n.jsx(Zo,{className:"w-4 h-4"}),"Add Device"]})]})]}),a.length===0&&n.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[n.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:n.jsx(Li,{className:"w-4 h-4 text-cyan-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),n.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),a.length>0&&n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Xre,{className:"w-5 h-5 text-slate-600"}),n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),n.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[a.length," connected"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map((P,H)=>{const $=k(P.type),re=M(P.type),J=Math.floor(Math.random()*50)+50;return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl ${re} flex items-center justify-center`,children:n.jsx($,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),n.jsx("p",{className:"text-slate-500 text-sm",children:P.type})]})]}),n.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[n.jsx(Tn,{className:"w-3 h-3"}),"Active"]})]}),n.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((ge,ie)=>{const we=30+Math.random()*70;return n.jsx("div",{className:"flex-1 bg-gradient-to-t from-purple-500 to-orange-500 rounded-sm",style:{height:`${we}%`,marginTop:"auto"}},ie)})}),n.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(Ca,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Heart"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(Jre,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Steps"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[n.jsx(Og,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),n.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[n.jsx($re,{className:"w-4 h-4"}),J,"%"]})]}),n.jsxs("div",{className:"mt-4 flex gap-2",children:[n.jsx("button",{onClick:()=>I(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),n.jsx("button",{onClick:()=>R(P.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},H)})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(HA,{className:"w-5 h-5 text-slate-600"}),n.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ib.map(P=>{const H=P.icon,$=a.some(re=>re.type===P.id);return n.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:n.jsx(H,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),$&&n.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),n.jsx("p",{className:"text-slate-500 text-sm mb-3",children:P.description}),n.jsx("div",{className:"flex flex-wrap gap-2",children:P.tags.map(re=>n.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:re},re))})]})]}),n.jsx("button",{onClick:()=>$?R(P.id):O(P.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${$?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-purple-500 to-orange-500 text-white hover:shadow-lg"}`,children:$?"Disconnect":"Connect"})]})},P.id)})})]}),g&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:n.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),n.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),n.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),n.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:Ib.map(P=>{const H=P.icon,$=a.some(re=>re.type===P.id);return n.jsxs("button",{onClick:()=>!$&&O(P.id),disabled:$,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${$?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:n.jsx(H,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("p",{className:"text-slate-800 font-medium",children:P.name}),$&&n.jsx(Tn,{className:"w-4 h-4 text-emerald-500"})]}),n.jsx("p",{className:"text-slate-500 text-sm",children:P.description})]})]},P.id)})})]})})]})}function Ile(){var M,P,H,$,re,J,ge,ie,we,Ae,V,ce,Y,z,te,se,Ce,he,Ne;const{patientId:a}=ox(),[o]=YV(),c=o.get("appointmentId"),[d,h]=ee.useState(null),[p,g]=ee.useState(!0),[x,v]=ee.useState("overview");if(ee.useEffect(()=>{(async()=>{try{const{data:Ie}=await $o.getPatientProfile(a,c);h(Ie)}catch(Ie){console.error("Failed to fetch patient profile:",Ie)}finally{g(!1)}})()},[a,c]),p)return n.jsx(XA,{});if(!d)return n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[n.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),n.jsx(Hs,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-purple-500 to-orange-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:E,healthSummary:C,healthReports:I,wearableSummary:O,appointmentHistory:R}=d,k=[{id:"overview",label:"Overview",icon:Jd},{id:"reports",label:"Health Reports",icon:Hn},{id:"wearables",label:"Wearable Data",icon:HA},{id:"history",label:"Appointment History",icon:yi}];return n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs(Hs,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"}),"Back to Dashboard"]}),n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[n.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-white text-3xl font-bold",children:(P=(M=E.name)==null?void 0:M.charAt(0))==null?void 0:P.toUpperCase()}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:E.name}),n.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[E.email&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(aE,{className:"w-4 h-4"})," ",E.email]}),E.phone&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(aQ,{className:"w-4 h-4"})," ",E.phone]}),((H=E.profile)==null?void 0:H.age)&&n.jsxs("span",{children:[E.profile.age," years old"]}),(($=E.profile)==null?void 0:$.gender)&&n.jsx("span",{className:"capitalize",children:E.profile.gender})]})]}),(C==null?void 0:C.healthScore)&&n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:`text-4xl font-bold ${C.healthScore>=80?"text-emerald-400":C.healthScore>=60?"text-amber-400":"text-red-400"}`,children:C.healthScore}),n.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:k.map(Z=>n.jsxs("button",{onClick:()=>v(Z.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${x===Z.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[n.jsx(Z.icon,{className:"w-4 h-4"}),Z.label]},Z.id))}),x==="overview"&&n.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(Jd,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((re=E.profile)==null?void 0:re.height)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),n.jsxs("p",{className:"font-semibold text-white",children:[E.profile.height," cm"]})]}),((J=E.profile)==null?void 0:J.weight)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),n.jsxs("p",{className:"font-semibold text-white",children:[E.profile.weight," kg"]})]}),((ge=E.profile)==null?void 0:ge.bloodGroup)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),n.jsx("p",{className:"font-semibold text-white",children:E.profile.bloodGroup})]}),((ie=E.healthMetrics)==null?void 0:ie.bmi)&&n.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[n.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),n.jsx("p",{className:"font-semibold text-white",children:E.healthMetrics.bmi.toFixed(1)})]})]}),((Ae=(we=E.profile)==null?void 0:we.allergies)==null?void 0:Ae.length)>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.allergies.map((Z,Ie)=>n.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:Z},Ie))})]}),((ce=(V=E.profile)==null?void 0:V.chronicConditions)==null?void 0:ce.length)>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.chronicConditions.map((Z,Ie)=>n.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:Z},Ie))})]})]}),C&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(Ca,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((Y=C.deficiencies)==null?void 0:Y.length)>0&&n.jsxs("div",{className:"mb-4",children:[n.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",C.deficiencies.length,")"]}),n.jsx("div",{className:"space-y-2",children:C.deficiencies.slice(0,3).map((Z,Ie)=>{var ne,ve,ue;const Ve=typeof Z.currentValue=="object"?((ne=Z.currentValue)==null?void 0:ne.value)||JSON.stringify(Z.currentValue):Z.currentValue,Pe=typeof Z.normalRange=="object"?((ve=Z.normalRange)==null?void 0:ve.value)||JSON.stringify(Z.normalRange):Z.normalRange;return n.jsxs("div",{className:`p-3 rounded-xl ${Z.severity==="severe"?"bg-red-500/10 border border-red-500/30":Z.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"font-medium text-white",children:typeof Z.name=="object"?((ue=Z.name)==null?void 0:ue.value)||"Unknown":Z.name}),n.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Z.severity==="severe"?"bg-red-500/20 text-red-400":Z.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:Z.severity})]}),n.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",Ve," | Normal: ",Pe]})]},Ie)})})]}),((z=C.riskFactors)==null?void 0:z.length)>0&&n.jsxs("div",{className:"mb-4",children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:C.riskFactors.map((Z,Ie)=>n.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof Z=="object"?(Z==null?void 0:Z.name)||(Z==null?void 0:Z.value)||JSON.stringify(Z):Z},Ie))})]}),((te=C.keyFindings)==null?void 0:te.length)>0&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),n.jsx("ul",{className:"space-y-1",children:C.keyFindings.slice(0,4).map((Z,Ie)=>{const Ve=typeof Z=="object"?(Z==null?void 0:Z.title)||(Z==null?void 0:Z.finding)||(Z==null?void 0:Z.value)||JSON.stringify(Z):Z;return n.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-400 mt-1",children:""}),Ve]},Ie)})})]})]}),O&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[n.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.jsx(HA,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[n.jsx(br,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:((se=O.avgSteps)==null?void 0:se.toLocaleString())||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),n.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[n.jsx(Ca,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:O.avgHeartRate||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),n.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[n.jsx(Oc,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:O.avgSleepHours||"N/A"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),n.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[n.jsx(HA,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),n.jsx("p",{className:"text-2xl font-bold text-white",children:((Ce=O.devices)==null?void 0:Ce.length)||0}),n.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),x==="reports"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(I==null?void 0:I.length)>0?n.jsx("div",{className:"space-y-3",children:I.map(Z=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:n.jsx(Hn,{className:"w-6 h-6 text-slate-400"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-white",children:Z.reportType}),n.jsx("p",{className:"text-sm text-slate-400",children:new Date(Z.createdAt).toLocaleDateString()})]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[Z.healthScore&&n.jsxs("span",{className:`font-bold ${Z.healthScore>=80?"text-emerald-400":Z.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",Z.healthScore]}),n.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${Z.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:Z.status})]})]},Z._id))}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),x==="wearables"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),O?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),n.jsx("div",{className:"flex flex-wrap gap-3",children:(he=O.devices)==null?void 0:he.map((Z,Ie)=>n.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[n.jsx(HA,{className:"w-4 h-4 text-cyan-400"}),n.jsx("span",{className:"font-medium text-cyan-300",children:Z.name||Z.type})]},Ie))})]}),((Ne=O.recentMetrics)==null?void 0:Ne.length)>0&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-700",children:[n.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),n.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),n.jsx("tbody",{children:O.recentMetrics.map((Z,Ie)=>{var Ve,Pe;return n.jsxs("tr",{className:"border-b border-slate-700/50",children:[n.jsx("td",{className:"py-2 text-white",children:new Date(Z.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:(Ve=Z.steps)==null?void 0:Ve.toLocaleString()}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:Z.caloriesBurned}),n.jsx("td",{className:"py-2 text-right text-slate-300",children:Z.activeMinutes}),n.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(Pe=Z.distance)==null?void 0:Pe.toFixed(1)," km"]})]},Ie)})})]})})]})]}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),x==="history"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(R==null?void 0:R.length)>0?n.jsx("div",{className:"space-y-3",children:R.map(Z=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(yi,{className:"w-5 h-5 text-slate-400"}),n.jsx("span",{className:"font-semibold text-white",children:new Date(Z.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),n.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${Z.status==="completed"?"bg-emerald-500/20 text-emerald-400":Z.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:Z.status})]}),Z.doctor&&n.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",Z.doctor.name," - ",Z.doctor.specialization]}),Z.symptoms&&n.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[n.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",Z.symptoms]}),Z.notes&&n.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[n.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",Z.notes]})]},Z._id))}):n.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var wH={exports:{}};(function(a,o){(function(c,d){a.exports=d()})(D_,function(){function c(e,t){return t.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(r){if(r!=="default"&&!(r in e)){var i=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return s[r]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof D_<"u"?D_:typeof self<"u"?self:{};function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},g=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),x=g,v=Function.prototype,E=v.call,C=x&&v.bind.bind(E,E),I=x?C:function(e){return function(){return E.apply(e,arguments)}},O=I({}.isPrototypeOf),R=function(e){return e&&e.Math===Math&&e},k=R(typeof globalThis=="object"&&globalThis)||R(typeof window=="object"&&window)||R(typeof self=="object"&&self)||R(typeof d=="object"&&d)||R(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),M=g,P=Function.prototype,H=P.apply,$=P.call,re=typeof Reflect=="object"&&Reflect.apply||(M?$.bind(H):function(){return $.apply(H,arguments)}),J=I,ge=J({}.toString),ie=J("".slice),we=function(e){return ie(ge(e),8,-1)},Ae=we,V=I,ce=function(e){if(Ae(e)==="Function")return V(e)},Y=typeof document=="object"&&document.all,z=Y===void 0&&Y!==void 0?function(e){return typeof e=="function"||e===Y}:function(e){return typeof e=="function"},te={},se=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ce=g,he=Function.prototype.call,Ne=Ce?he.bind(he):function(){return he.apply(he,arguments)},Z={},Ie={}.propertyIsEnumerable,Ve=Object.getOwnPropertyDescriptor,Pe=Ve&&!Ie.call({1:2},1);Z.f=Pe?function(e){var t=Ve(this,e);return!!t&&t.enumerable}:Ie;var ne,ve,ue=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Te=p,Be=we,Ue=Object,tt=I("".split),ot=Te(function(){return!Ue("z").propertyIsEnumerable(0)})?function(e){return Be(e)==="String"?tt(e,""):Ue(e)}:Ue,ut=function(e){return e==null},Tt=ut,Qe=TypeError,it=function(e){if(Tt(e))throw new Qe("Can't call method on "+e);return e},kt=ot,_e=it,xt=function(e){return kt(_e(e))},Ke=z,Je=function(e){return typeof e=="object"?e!==null:Ke(e)},$e={},jt=$e,Kt=k,os=z,ss=function(e){return os(e)?e:void 0},mt=function(e,t){return arguments.length<2?ss(jt[e])||ss(Kt[e]):jt[e]&&jt[e][t]||Kt[e]&&Kt[e][t]},Ht=k.navigator,qe=Ht&&Ht.userAgent,ht=qe?String(qe):"",Xt=k,zt=ht,ds=Xt.process,Qt=Xt.Deno,Us=ds&&ds.versions||Qt&&Qt.version,bs=Us&&Us.v8;bs&&(ve=(ne=bs.split("."))[0]>0&&ne[0]<4?1:+(ne[0]+ne[1])),!ve&&zt&&(!(ne=zt.match(/Edge\/(\d+)/))||ne[1]>=74)&&(ne=zt.match(/Chrome\/(\d+)/))&&(ve=+ne[1]);var cs=ve,Ds=cs,zs=p,rs=k.String,Gs=!!Object.getOwnPropertySymbols&&!zs(function(){var e=Symbol("symbol detection");return!rs(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ds&&Ds<41}),dt=Gs&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Pt=mt,qt=z,Yt=O,us=Object,Ws=dt?function(e){return typeof e=="symbol"}:function(e){var t=Pt("Symbol");return qt(t)&&Yt(t.prototype,us(e))},ji=String,qr=function(e){try{return ji(e)}catch{return"Object"}},Ga=z,ti=qr,Fs=TypeError,pn=function(e){if(Ga(e))return e;throw new Fs(ti(e)+" is not a function")},Ao=pn,vt=ut,Jt=function(e,t){var s=e[t];return vt(s)?void 0:Ao(s)},Js=Ne,Os=z,jr=Je,In=TypeError,On={exports:{}},Xr=k,Aa=Object.defineProperty,ea=k,Ka=function(e,t){try{Aa(Xr,e,{value:t,configurable:!0,writable:!0})}catch{Xr[e]=t}return t},ua="__core-js_shared__",rc=On.exports=ea[ua]||Ka(ua,{});(rc.versions||(rc.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Sa=On.exports,nc=Sa,ic=function(e,t){return nc[e]||(nc[e]=t||{})},JA=it,$A=Object,Ro=function(e){return $A(JA(e))},fh=Ro,om=I({}.hasOwnProperty),Kn=Object.hasOwn||function(e,t){return om(fh(e),t)},Io=I,gh=0,cm=Math.random(),bh=Io(1.1.toString),ZA=function(e){return"Symbol("+(e===void 0?"":e)+")_"+bh(++gh+cm,36)},lm=ic,xh=Kn,kc=ZA,eu=Gs,Fg=dt,kn=k.Symbol,tu=lm("wks"),Dc=Fg?kn.for||kn:kn&&kn.withoutSetter||kc,Hr=function(e){return xh(tu,e)||(tu[e]=eu&&xh(kn,e)?kn[e]:Dc("Symbol."+e)),tu[e]},dm=Ne,uo=Je,Ei=Ws,fl=Jt,Am=function(e,t){var s,r;if(Os(s=e.toString)&&!jr(r=Js(s,e))||Os(s=e.valueOf)&&!jr(r=Js(s,e)))return r;throw new In("Can't convert object to primitive value")},Mg=TypeError,Vg=Hr("toPrimitive"),Bc=function(e,t){if(!uo(e)||Ei(e))return e;var s,r=fl(e,Vg);if(r){if(s=dm(r,e,t),!uo(s)||Ei(s))return s;throw new Mg("Can't convert object to primitive value")}return Am(e)},um=Ws,su=function(e){var t=Bc(e,"string");return um(t)?t:t+""},tA=Je,gl=k.document,Qg=tA(gl)&&tA(gl.createElement),vh=function(e){return Qg?gl.createElement(e):{}},Hg=vh,ru=!se&&!p(function(){return Object.defineProperty(Hg("div"),"a",{get:function(){return 7}}).a!==7}),hm=se,ac=Ne,Gg=Z,sA=ue,wh=xt,Kg=su,nr=Kn,Wg=ru,pm=Object.getOwnPropertyDescriptor;te.f=hm?pm:function(e,t){if(e=wh(e),t=Kg(t),Wg)try{return pm(e,t)}catch{}if(nr(e,t))return sA(!ac(Gg.f,e,t),e[t])};var zg=p,bl=z,xl=/#|\.prototype\./,rA=function(e,t){var s=nu[qg(e)];return s===nA||s!==_h&&(bl(t)?zg(t):!!t)},qg=rA.normalize=function(e){return String(e).replace(xl,".").toLowerCase()},nu=rA.data={},_h=rA.NATIVE="N",nA=rA.POLYFILL="P",mm=rA,vl=pn,Yg=g,yh=ce(ce.bind),Oo=function(e,t){return vl(e),t===void 0?e:Yg?yh(e,t):function(){return e.apply(t,arguments)}},Na={},Lc=se&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Eh=Je,iu=String,Ch=TypeError,hi=function(e){if(Eh(e))return e;throw new Ch(iu(e)+" is not an object")},Sh=se,fm=ru,gm=Lc,ko=hi,jc=su,bm=TypeError,wl=Object.defineProperty,xm=Object.getOwnPropertyDescriptor,L="enumerable",le="configurable",Oe="writable";Na.f=Sh?gm?function(e,t,s){if(ko(e),t=jc(t),ko(s),typeof e=="function"&&t==="prototype"&&"value"in s&&Oe in s&&!s[Oe]){var r=xm(e,t);r&&r[Oe]&&(e[t]=s.value,s={configurable:le in s?s[le]:r[le],enumerable:L in s?s[L]:r[L],writable:!1})}return wl(e,t,s)}:wl:function(e,t,s){if(ko(e),t=jc(t),ko(s),fm)try{return wl(e,t,s)}catch{}if("get"in s||"set"in s)throw new bm("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var Me=Na,Ze=ue,yt=se?function(e,t,s){return Me.f(e,t,Ze(1,s))}:function(e,t,s){return e[t]=s,e},Lt=k,ys=re,ks=ce,sr=z,hr=te.f,Gr=mm,cn=$e,Ci=Oo,Jr=yt,Si=Kn,Ni=function(e){var t=function(s,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,r)}return new e(s,r,i)}return ys(e,this,arguments)};return t.prototype=e.prototype,t},Is=function(e,t){var s,r,i,l,A,u,m,f,b,w=e.target,_=e.global,S=e.stat,F=e.proto,B=_?Lt:S?Lt[w]:Lt[w]&&Lt[w].prototype,j=_?cn:cn[w]||Jr(cn,w,{})[w],K=j.prototype;for(l in t)r=!(s=Gr(_?l:w+(S?".":"#")+l,e.forced))&&B&&Si(B,l),u=j[l],r&&(m=e.dontCallGetSet?(b=hr(B,l))&&b.value:B[l]),A=r&&m?m:t[l],(s||F||typeof u!=typeof A)&&(f=e.bind&&r?Ci(A,Lt):e.wrap&&r?Ni(A):F&&sr(A)?ks(A):A,(e.sham||A&&A.sham||u&&u.sham)&&Jr(f,"sham",!0),Jr(j,l,f),F&&(Si(cn,i=w+"Prototype")||Jr(cn,i,{}),Jr(cn[i],l,A),e.real&&K&&(s||!K[l])&&Jr(K,l,A)))},_l=Math.ceil,oc=Math.floor,yl=Math.trunc||function(e){var t=+e;return(t>0?oc:_l)(t)},Nh=yl,cd=function(e){var t=+e;return t!=t||t===0?0:Nh(t)},ld=cd,iA=Math.max,aA=Math.min,Pc=function(e,t){var s=ld(e);return s<0?iA(s+t,0):aA(s,t)},ta=cd,oA=Math.min,dd=function(e){var t=ta(e);return t>0?oA(t,9007199254740991):0},Th=dd,Do=function(e){return Th(e.length)},Ta=xt,El=Pc,au=Do,Rh=function(e){return function(t,s,r){var i=Ta(t),l=au(i);if(l===0)return!e&&-1;var A,u=El(r,l);if(e&&s!=s){for(;l>u;)if((A=i[u++])!=A)return!0}else for(;l>u;u++)if((e||u in i)&&i[u]===s)return e||u||0;return!e&&-1}},Wa={includes:Rh(!0),indexOf:Rh(!1)},cA=Wa.includes;Is({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return cA(this,e,arguments.length>1?arguments[1]:void 0)}});var Ih=k,Oh=$e,Ti=function(e,t){var s=Oh[e+"Prototype"],r=s&&s[t];if(r)return r;var i=Ih[e],l=i&&i.prototype;return l&&l[t]},lA=Ti("Array","includes"),ho=Je,po=we,Ad=Hr("match"),cc=function(e){var t;return ho(e)&&((t=e[Ad])!==void 0?!!t:po(e)==="RegExp")},ud=cc,kh=TypeError,dA={};dA[Hr("toStringTag")]="z";var Wn=String(dA)==="[object z]",vm=Wn,Uc=z,mo=we,Dh=Hr("toStringTag"),Bh=Object,Lh=mo(function(){return arguments}())==="Arguments",Bo=vm?mo:function(e){var t,s,r;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(i,l){try{return i[l]}catch{}}(t=Bh(e),Dh))=="string"?s:Lh?mo(t):(r=mo(t))==="Object"&&Uc(t.callee)?"Arguments":r},hd=Bo,pd=String,si=function(e){if(hd(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return pd(e)},AA=Hr("match"),md=Is,uA=function(e){if(ud(e))throw new kh("The method doesn't accept regular expressions");return e},Lo=it,lc=si,tn=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[AA]=!1,"/./"[e](t)}catch{}}return!1},mn=I("".indexOf);md({target:"String",proto:!0,forced:!tn("includes")},{includes:function(e){return!!~mn(lc(Lo(this)),lc(uA(e)),arguments.length>1?arguments[1]:void 0)}});var pi=Ti("String","includes"),Ri=O,Cl=lA,jh=pi,fd=Array.prototype,ou=String.prototype,bx=function(e){var t=e.includes;return e===fd||Ri(fd,e)&&t===fd.includes?Cl:typeof e=="string"||e===ou||Ri(ou,e)&&t===ou.includes?jh:t},et=h(bx),xx=pn,vx=Ro,wx=ot,_x=Do,cu=TypeError,Xg="Reduce of empty array with no initial value",yx=function(e){return function(t,s,r,i){var l=vx(t),A=wx(l),u=_x(l);if(xx(s),u===0&&r<2)throw new cu(Xg);var m=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(m in A){i=A[m],m+=f;break}if(m+=f,e?m<0:u<=m)throw new cu(Xg)}for(;e?m>=0:u>m;m+=f)m in A&&(i=s(i,A[m],m,l));return i}},Ex={left:yx(!1)},Cx=p,Ph=function(e,t){var s=[][e];return!!s&&Cx(function(){s.call(null,t||function(){return 1},1)})},lu=k,Sx=ht,Nx=we,du=function(e){return Sx.slice(0,e.length)===e},Au=du("Bun/")?"BUN":du("Cloudflare-Workers")?"CLOUDFLARE":du("Deno/")?"DENO":du("Node.js/")?"NODE":lu.Bun&&typeof Bun.version=="string"?"BUN":lu.Deno&&typeof Deno.version=="object"?"DENO":Nx(lu.process)==="process"?"NODE":lu.window&&lu.document?"BROWSER":"REST",ha=Au==="NODE",jo=Ex.left;Is({target:"Array",proto:!0,forced:!ha&&cs>79&&cs<83||!Ph("reduce")},{reduce:function(e){var t=arguments.length;return jo(this,e,t,t>1?arguments[1]:void 0)}});var wm=Ti("Array","reduce"),_m=O,Tx=wm,uu=Array.prototype,ym=function(e){var t=e.reduce;return e===uu||_m(uu,e)&&t===uu.reduce?Tx:t},Em=ym,za=h(Em),Jg=we,hA=Array.isArray||function(e){return Jg(e)==="Array"},Cm=Is,$g=hA,TE=I([].reverse),Rx=[1,2];Cm({target:"Array",proto:!0,forced:String(Rx)===String(Rx.reverse())},{reverse:function(){return $g(this)&&(this.length=this.length),TE(this)}});var Ix=Ti("Array","reverse"),RE=O,IE=Ix,Zg=Array.prototype,OE=function(e){var t=e.reverse;return e===Zg||RE(Zg,e)&&t===Zg.reverse?IE:t},Ox=OE,Sm=h(Ox),e0=ZA,hu=ic("keys"),Nm=function(e){return hu[e]||(hu[e]=e0(e))},kE=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),kx=Kn,DE=z,BE=Ro,LE=kE,Dx=Nm("IE_PROTO"),Fc=Object,dc=Fc.prototype,Ac=LE?Fc.getPrototypeOf:function(e){var t=BE(e);if(kx(t,Dx))return t[Dx];var s=t.constructor;return DE(s)&&t instanceof s?s.prototype:t instanceof Fc?dc:null},jE=I,Bx=pn,gd=Je,Po=function(e){return gd(e)||e===null},PE=String,UE=TypeError,Lx=function(e,t,s){try{return jE(Bx(Object.getOwnPropertyDescriptor(e,t)[s]))}catch{}},jx=Je,Px=it,Ux=function(e){if(Po(e))return e;throw new UE("Can't set "+PE(e)+" as a prototype")},FE=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,s={};try{(e=Lx(Object.prototype,"__proto__","set"))(s,[]),t=s instanceof Array}catch{}return function(r,i){return Px(r),Ux(i),jx(r)&&(t?e(r,i):r.__proto__=i),r}}():void 0),pA={},mA={},fA=Kn,t0=xt,ME=Wa.indexOf,Fx=mA,Mx=I([].push),Vx=function(e,t){var s,r=t0(e),i=0,l=[];for(s in r)!fA(Fx,s)&&fA(r,s)&&Mx(l,s);for(;t.length>i;)fA(r,s=t[i++])&&(~ME(l,s)||Mx(l,s));return l},s0=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],VE=Vx,QE=s0.concat("length","prototype");pA.f=Object.getOwnPropertyNames||function(e){return VE(e,QE)};var Uh={};Uh.f=Object.getOwnPropertySymbols;var Qx=mt,Tm=pA,HE=Uh,GE=hi,Hx=I([].concat),y=Qx("Reflect","ownKeys")||function(e){var t=Tm.f(GE(e)),s=HE.f;return s?Hx(t,s(e)):t},T=Kn,Q=y,q=te,de=Na,pe={},fe=Vx,ye=s0,Se=Object.keys||function(e){return fe(e,ye)},ke=se,Ge=Lc,At=Na,De=hi,ze=xt,st=Se;pe.f=ke&&!Ge?Object.defineProperties:function(e,t){De(e);for(var s,r=ze(t),i=st(t),l=i.length,A=0;l>A;)At.f(e,s=i[A++],r[s]);return e};var wt,lt=mt("document","documentElement"),Ct=hi,It=pe,Gt=s0,Ut=mA,Bs=lt,ws=vh,cr="prototype",Es="script",Or=Nm("IE_PROTO"),mi=function(){},pr=function(e){return"<"+Es+">"+e+"</"+Es+">"},Cs=function(e){e.write(pr("")),e.close();var t=e.parentWindow.Object;return e=null,t},ts=function(){try{wt=new ActiveXObject("htmlfile")}catch{}var e,t,s;ts=typeof document<"u"?document.domain&&wt?Cs(wt):(t=ws("iframe"),s="java"+Es+":",t.style.display="none",Bs.appendChild(t),t.src=String(s),(e=t.contentWindow.document).open(),e.write(pr("document.F=Object")),e.close(),e.F):Cs(wt);for(var r=Gt.length;r--;)delete ts[cr][Gt[r]];return ts()};Ut[Or]=!0;var Dn=Object.create||function(e,t){var s;return e!==null?(mi[cr]=Ct(e),s=new mi,mi[cr]=null,s[Or]=e):s=ts(),t===void 0?s:It.f(s,t)},lr=Je,Mr=yt,yn=Error,sa=I("".replace),Ra=String(new yn("zxcasd").stack),zn=/\n\s*at [^:]*:[^\n]*/,pa=zn.test(Ra),Ia=ue,Pi=!p(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Ia(1,7)),e.stack!==7)}),Kr=yt,an=function(e,t){if(pa&&typeof e=="string"&&!yn.prepareStackTrace)for(;t--;)e=sa(e,zn,"");return e},ri=Pi,sn=Error.captureStackTrace,ni={},uc=ni,fi=Hr("iterator"),qa=Array.prototype,ln=function(e){return e!==void 0&&(uc.Array===e||qa[fi]===e)},Ui=Bo,Ya=Jt,Oa=ut,fo=ni,go=Hr("iterator"),ra=function(e){if(!Oa(e))return Ya(e,go)||Ya(e,"@@iterator")||fo[Ui(e)]},bo=Ne,En=pn,xo=hi,hc=qr,gA=ra,Sl=TypeError,Fi=function(e,t){var s=arguments.length<2?gA(e):t;if(En(s))return xo(bo(s,e));throw new Sl(hc(e)+" is not iterable")},Rm=Ne,Im=hi,Om=Jt,pu=function(e,t,s){var r,i;Im(e);try{if(!(r=Om(e,"return"))){if(t==="throw")throw s;return s}r=Rm(r,e)}catch(l){i=!0,r=l}if(t==="throw")throw s;if(i)throw r;return Im(r),s},KE=Oo,WE=Ne,r0=hi,bd=qr,zE=ln,qE=Do,Gx=O,Kx=Fi,km=ra,n0=pu,Wx=TypeError,bA=function(e,t){this.stopped=e,this.result=t},Dm=bA.prototype,Nl=function(e,t,s){var r,i,l,A,u,m,f,b=s&&s.that,w=!(!s||!s.AS_ENTRIES),_=!(!s||!s.IS_RECORD),S=!(!s||!s.IS_ITERATOR),F=!(!s||!s.INTERRUPTED),B=KE(t,b),j=function(X){return r&&n0(r,"normal"),new bA(!0,X)},K=function(X){return w?(r0(X),F?B(X[0],X[1],j):B(X[0],X[1])):F?B(X,j):B(X)};if(_)r=e.iterator;else if(S)r=e;else{if(!(i=km(e)))throw new Wx(bd(e)+" is not iterable");if(zE(i)){for(l=0,A=qE(e);A>l;l++)if((u=K(e[l]))&&Gx(Dm,u))return u;return new bA(!1)}r=Kx(e,i)}for(m=_?e.next:r.next;!(f=WE(m,r)).done;){try{u=K(f.value)}catch(X){n0(r,"throw",X)}if(typeof u=="object"&&u&&Gx(Dm,u))return u}return new bA(!1)},zx=si,YE=Is,Bm=O,qx=Ac,mu=FE,xd=function(e,t,s){for(var r=Q(t),i=de.f,l=q.f,A=0;A<r.length;A++){var u=r[A];T(e,u)||s&&T(s,u)||i(e,u,l(t,u))}},i0=Dn,Lm=yt,a0=ue,Yx=function(e,t){lr(t)&&"cause"in t&&Mr(e,"cause",t.cause)},fu=function(e,t,s,r){ri&&(sn?sn(e,t):Kr(e,"stack",an(s,r)))},XE=Nl,Xx=function(e,t){return e===void 0?arguments.length<2?"":t:zx(e)},JE=Hr("toStringTag"),Fh=Error,$E=[].push,Mc=function(e,t){var s,r=Bm(Mh,this);mu?s=mu(new Fh,r?qx(this):Mh):(s=r?this:i0(Mh),Lm(s,JE,"Error")),t!==void 0&&Lm(s,"message",Xx(t)),fu(s,Mc,s.stack,1),arguments.length>2&&Yx(s,arguments[2]);var i=[];return XE(e,$E,{that:i}),Lm(s,"errors",i),s};mu?mu(Mc,Fh):xd(Mc,Fh,{name:!0});var Mh=Mc.prototype=i0(Fh.prototype,{constructor:a0(1,Mc),message:a0(1,""),name:a0(1,"AggregateError")});YE({global:!0},{AggregateError:Mc});var xA,vo,pc,vd=z,Vh=k.WeakMap,o0=vd(Vh)&&/native code/.test(String(Vh)),c0=k,ZE=Je,l0=yt,Qh=Kn,eC=Sa,_G=Nm,yG=mA,xI="Object already initialized",tC=c0.TypeError,EG=c0.WeakMap;if(o0||eC.state){var wd=eC.state||(eC.state=new EG);wd.get=wd.get,wd.has=wd.has,wd.set=wd.set,xA=function(e,t){if(wd.has(e))throw new tC(xI);return t.facade=e,wd.set(e,t),t},vo=function(e){return wd.get(e)||{}},pc=function(e){return wd.has(e)}}else{var jm=_G("state");yG[jm]=!0,xA=function(e,t){if(Qh(e,jm))throw new tC(xI);return t.facade=e,l0(e,jm,t),t},vo=function(e){return Qh(e,jm)?e[jm]:{}},pc=function(e){return Qh(e,jm)}}var Hh,vI,wI,Gh={set:xA,get:vo,has:pc,enforce:function(e){return pc(e)?vo(e):xA(e,{})},getterFor:function(e){return function(t){var s;if(!ZE(t)||(s=vo(t)).type!==e)throw new tC("Incompatible receiver, "+e+" required");return s}}},sC=se,CG=Kn,_I=Function.prototype,SG=sC&&Object.getOwnPropertyDescriptor,yI=CG(_I,"name"),EI={PROPER:yI&&(function(){}).name==="something",CONFIGURABLE:yI&&(!sC||sC&&SG(_I,"name").configurable)},NG=yt,gu=function(e,t,s,r){return r&&r.enumerable?e[t]=s:NG(e,t,s),e},TG=p,RG=z,IG=Je,OG=Dn,CI=Ac,kG=gu,rC=Hr("iterator"),SI=!1;[].keys&&("next"in(wI=[].keys())?(vI=CI(CI(wI)))!==Object.prototype&&(Hh=vI):SI=!0);var DG=!IG(Hh)||TG(function(){var e={};return Hh[rC].call(e)!==e});RG((Hh=DG?{}:OG(Hh))[rC])||kG(Hh,rC,function(){return this});var NI={IteratorPrototype:Hh,BUGGY_SAFARI_ITERATORS:SI},BG=Bo,LG=Wn?{}.toString:function(){return"[object "+BG(this)+"]"},jG=Wn,PG=Na.f,UG=yt,FG=Kn,MG=LG,TI=Hr("toStringTag"),vA=function(e,t,s,r){var i=s?e:e&&e.prototype;i&&(FG(i,TI)||PG(i,TI,{configurable:!0,value:t}),r&&!jG&&UG(i,"toString",MG))},VG=NI.IteratorPrototype,QG=Dn,HG=ue,GG=vA,KG=ni,WG=function(){return this},nC=function(e,t,s,r){var i=t+" Iterator";return e.prototype=QG(VG,{next:HG(+!r,s)}),GG(e,i,!1,!0),KG[i]=WG,e},zG=Is,qG=Ne,YG=EI,XG=nC,JG=Ac,$G=vA,RI=gu,II=ni,ZG=NI,e9=YG.PROPER,Jx=ZG.BUGGY_SAFARI_ITERATORS,iC=Hr("iterator"),OI="keys",$x="values",kI="entries",t9=function(){return this},DI=function(e,t,s,r,i,l,A){XG(s,t,r);var u,m,f,b=function(K){if(K===i&&B)return B;if(!Jx&&K&&K in S)return S[K];switch(K){case OI:case $x:case kI:return function(){return new s(this,K)}}return function(){return new s(this)}},w=t+" Iterator",_=!1,S=e.prototype,F=S[iC]||S["@@iterator"]||i&&S[i],B=!Jx&&F||b(i),j=t==="Array"&&S.entries||F;if(j&&(u=JG(j.call(new e)))!==Object.prototype&&u.next&&($G(u,w,!0,!0),II[w]=t9),e9&&i===$x&&F&&F.name!==$x&&(_=!0,B=function(){return qG(F,this)}),i)if(m={values:b($x),keys:l?B:b(OI),entries:b(kI)},A)for(f in m)(Jx||_||!(f in S))&&RI(S,f,m[f]);else zG({target:t,proto:!0,forced:Jx||_},m);return A&&S[iC]!==B&&RI(S,iC,B,{}),II[t]=B,m},Zx=function(e,t){return{value:e,done:t}},s9=xt,BI=ni,LI=Gh;Na.f;var r9=DI,ev=Zx,jI="Array Iterator",n9=LI.set,i9=LI.getterFor(jI);r9(Array,"Array",function(e,t){n9(this,{type:jI,target:s9(e),index:0,kind:t})},function(){var e=i9(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,ev(void 0,!0);switch(e.kind){case"keys":return ev(s,!1);case"values":return ev(t[s],!1)}return ev([s,t[s]],!1)},"values"),BI.Arguments=BI.Array;var a9=Na,tv=function(e,t,s){return a9.f(e,t,s)},o9=mt,c9=tv,l9=se,PI=Hr("species"),d9=O,A9=TypeError,aC=function(e,t){if(d9(t,e))return e;throw new A9("Incorrect invocation")},u9=z,oC=Sa,h9=I(Function.toString);u9(oC.inspectSource)||(oC.inspectSource=function(e){return h9(e)});var UI=oC.inspectSource,p9=I,m9=p,FI=z,f9=Bo,g9=UI,MI=function(){},VI=mt("Reflect","construct"),cC=/^\s*(?:class|function)\b/,b9=p9(cC.exec),x9=!cC.test(MI),d0=function(e){if(!FI(e))return!1;try{return VI(MI,[],e),!0}catch{return!1}},QI=function(e){if(!FI(e))return!1;switch(f9(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return x9||!!b9(cC,g9(e))}catch{return!0}};QI.sham=!0;var A0,Pm,HI,lC,sv=!VI||m9(function(){var e;return d0(d0.call)||!d0(Object)||!d0(function(){e=!0})||e})?QI:d0,v9=sv,w9=qr,_9=TypeError,GI=hi,y9=function(e){if(v9(e))return e;throw new _9(w9(e)+" is not a constructor")},E9=ut,C9=Hr("species"),dC=function(e,t){var s,r=GI(e).constructor;return r===void 0||E9(s=GI(r)[C9])?t:y9(s)},bu=I([].slice),S9=TypeError,Kh=function(e,t){if(e<t)throw new S9("Not enough arguments");return e},KI=/(?:ipad|iphone|ipod).*applewebkit/i.test(ht),mc=k,N9=re,T9=Oo,WI=z,R9=Kn,zI=p,qI=lt,I9=bu,YI=vh,O9=Kh,k9=KI,D9=ha,AC=mc.setImmediate,uC=mc.clearImmediate,B9=mc.process,hC=mc.Dispatch,L9=mc.Function,XI=mc.MessageChannel,j9=mc.String,pC=0,u0={},JI="onreadystatechange";zI(function(){A0=mc.location});var mC=function(e){if(R9(u0,e)){var t=u0[e];delete u0[e],t()}},fC=function(e){return function(){mC(e)}},$I=function(e){mC(e.data)},ZI=function(e){mc.postMessage(j9(e),A0.protocol+"//"+A0.host)};AC&&uC||(AC=function(e){O9(arguments.length,1);var t=WI(e)?e:L9(e),s=I9(arguments,1);return u0[++pC]=function(){N9(t,void 0,s)},Pm(pC),pC},uC=function(e){delete u0[e]},D9?Pm=function(e){B9.nextTick(fC(e))}:hC&&hC.now?Pm=function(e){hC.now(fC(e))}:XI&&!k9?(lC=(HI=new XI).port2,HI.port1.onmessage=$I,Pm=T9(lC.postMessage,lC)):mc.addEventListener&&WI(mc.postMessage)&&!mc.importScripts&&A0&&A0.protocol!=="file:"&&!zI(ZI)?(Pm=ZI,mc.addEventListener("message",$I,!1)):Pm=JI in YI("script")?function(e){qI.appendChild(YI("script"))[JI]=function(){qI.removeChild(this),mC(e)}}:function(e){setTimeout(fC(e),0)});var rv={set:AC,clear:uC},eO=k,P9=se,U9=Object.getOwnPropertyDescriptor,tO=function(e){if(!P9)return eO[e];var t=U9(eO,e);return t&&t.value},sO=function(){this.head=null,this.tail=null};sO.prototype={add:function(e){var t={item:e,next:null},s=this.tail;s?s.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Um,gC,bC,xC,rO,nO=sO,F9=/ipad|iphone|ipod/i.test(ht)&&typeof Pebble<"u",M9=/web0s(?!.*chrome)/i.test(ht),Fm=k,V9=tO,iO=Oo,vC=rv.set,Q9=nO,H9=KI,G9=F9,K9=M9,wC=ha,aO=Fm.MutationObserver||Fm.WebKitMutationObserver,oO=Fm.document,cO=Fm.process,nv=Fm.Promise,_C=V9("queueMicrotask");if(!_C){var iv=new Q9,av=function(){var e,t;for(wC&&(e=cO.domain)&&e.exit();t=iv.get();)try{t()}catch(s){throw iv.head&&Um(),s}e&&e.enter()};H9||wC||K9||!aO||!oO?!G9&&nv&&nv.resolve?((xC=nv.resolve(void 0)).constructor=nv,rO=iO(xC.then,xC),Um=function(){rO(av)}):wC?Um=function(){cO.nextTick(av)}:(vC=iO(vC,Fm),Um=function(){vC(av)}):(gC=!0,bC=oO.createTextNode(""),new aO(av).observe(bC,{characterData:!0}),Um=function(){bC.data=gC=!gC}),_C=function(e){iv.head||Um(),iv.add(e)}}var lO=_C,Mm=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Wh=k.Promise,W9=k,h0=Wh,z9=z,q9=mm,Y9=UI,X9=Hr,dO=Au,yC=cs,AO=h0&&h0.prototype,J9=X9("species"),uO=z9(W9.PromiseRejectionEvent),$9=q9("Promise",function(){var e=Y9(h0),t=e!==String(h0);if(!t&&yC===66||!AO.catch||!AO.finally)return!0;if(!yC||yC<51||!/native code/.test(e)){var s=new h0(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((s.constructor={})[J9]=r,!(s.then(function(){})instanceof r))return!0}return!(t||dO!=="BROWSER"&&dO!=="DENO"||uO)}),p0={CONSTRUCTOR:$9,REJECTION_EVENT:uO},_d={},hO=pn,Z9=TypeError,eK=function(e){var t,s;this.promise=new e(function(r,i){if(t!==void 0||s!==void 0)throw new Z9("Bad Promise constructor");t=r,s=i}),this.resolve=hO(t),this.reject=hO(s)};_d.f=function(e){return new eK(e)};var EC,pO,mO,tK=Is,ov=ha,xu=k,sK=$e,m0=Ne,rK=gu,nK=vA,iK=function(e){var t=o9(e);l9&&t&&!t[PI]&&c9(t,PI,{configurable:!0,get:function(){return this}})},aK=pn,CC=z,oK=Je,cK=aC,lK=dC,fO=rv.set,SC=lO,dK=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},AK=Mm,uK=nO,gO=Gh,NC=Wh,bO=p0,xO=_d,cv="Promise",vO=bO.CONSTRUCTOR,hK=bO.REJECTION_EVENT,TC=gO.getterFor(cv),pK=gO.set,mK=NC&&NC.prototype,f0=NC,RC=mK,wO=xu.TypeError,IC=xu.document,OC=xu.process,kC=xO.f,fK=kC,gK=!!(IC&&IC.createEvent&&xu.dispatchEvent),_O="unhandledrejection",yO=function(e){var t;return!(!oK(e)||!CC(t=e.then))&&t},EO=function(e,t){var s,r,i,l=t.value,A=t.state===1,u=A?e.ok:e.fail,m=e.resolve,f=e.reject,b=e.domain;try{u?(A||(t.rejection===2&&xK(t),t.rejection=1),u===!0?s=l:(b&&b.enter(),s=u(l),b&&(b.exit(),i=!0)),s===e.promise?f(new wO("Promise-chain cycle")):(r=yO(s))?m0(r,s,m,f):m(s)):f(l)}catch(w){b&&!i&&b.exit(),f(w)}},CO=function(e,t){e.notified||(e.notified=!0,SC(function(){for(var s,r=e.reactions;s=r.get();)EO(s,e);e.notified=!1,t&&!e.rejection&&bK(e)}))},SO=function(e,t,s){var r,i;gK?((r=IC.createEvent("Event")).promise=t,r.reason=s,r.initEvent(e,!1,!0),xu.dispatchEvent(r)):r={promise:t,reason:s},!hK&&(i=xu["on"+e])?i(r):e===_O&&dK("Unhandled promise rejection",s)},bK=function(e){m0(fO,xu,function(){var t,s=e.facade,r=e.value;if(NO(e)&&(t=AK(function(){ov?OC.emit("unhandledRejection",r,s):SO(_O,s,r)}),e.rejection=ov||NO(e)?2:1,t.error))throw t.value})},NO=function(e){return e.rejection!==1&&!e.parent},xK=function(e){m0(fO,xu,function(){var t=e.facade;ov?OC.emit("rejectionHandled",t):SO("rejectionhandled",t,e.value)})},Vm=function(e,t,s){return function(r){e(t,r,s)}},Qm=function(e,t,s){e.done||(e.done=!0,s&&(e=s),e.value=t,e.state=2,CO(e,!0))},DC=function(e,t,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===t)throw new wO("Promise can't be resolved itself");var r=yO(t);r?SC(function(){var i={done:!1};try{m0(r,t,Vm(DC,i,e),Vm(Qm,i,e))}catch(l){Qm(i,l,e)}}):(e.value=t,e.state=1,CO(e,!1))}catch(i){Qm({done:!1},i,e)}}};vO&&(RC=(f0=function(e){cK(this,RC),aK(e),m0(EC,this);var t=TC(this);try{e(Vm(DC,t),Vm(Qm,t))}catch(s){Qm(t,s)}}).prototype,(EC=function(e){pK(this,{type:cv,done:!1,notified:!1,parent:!1,reactions:new uK,rejection:!1,state:0,value:null})}).prototype=rK(RC,"then",function(e,t){var s=TC(this),r=kC(lK(this,f0));return s.parent=!0,r.ok=!CC(e)||e,r.fail=CC(t)&&t,r.domain=ov?OC.domain:void 0,s.state===0?s.reactions.add(r):SC(function(){EO(r,s)}),r.promise}),pO=function(){var e=new EC,t=TC(e);this.promise=e,this.resolve=Vm(DC,t),this.reject=Vm(Qm,t)},xO.f=kC=function(e){return e===f0||e===mO?new pO(e):fK(e)}),tK({global:!0,wrap:!0,forced:vO},{Promise:f0}),mO=sK.Promise,nK(f0,cv,!1,!0),iK(cv);var TO=Hr("iterator"),RO=!1;try{var vK=0,IO={next:function(){return{done:!!vK++}},return:function(){RO=!0}};IO[TO]=function(){return this},Array.from(IO,function(){throw 2})}catch{}var wK=Wh,_K=function(e,t){try{if(!t&&!RO)return!1}catch{return!1}var s=!1;try{var r={};r[TO]=function(){return{next:function(){return{done:s=!0}}}},e(r)}catch{}return s},lv=p0.CONSTRUCTOR||!_K(function(e){wK.all(e).then(void 0,function(){})}),yK=Ne,EK=pn,CK=_d,SK=Mm,NK=Nl;Is({target:"Promise",stat:!0,forced:lv},{all:function(e){var t=this,s=CK.f(t),r=s.resolve,i=s.reject,l=SK(function(){var A=EK(t.resolve),u=[],m=0,f=1;NK(e,function(b){var w=m++,_=!1;f++,yK(A,t,b).then(function(S){_||(_=!0,u[w]=S,--f||r(u))},i)}),--f||r(u)});return l.error&&i(l.value),s.promise}});var TK=Is,RK=p0.CONSTRUCTOR;Wh&&Wh.prototype,TK({target:"Promise",proto:!0,forced:RK,real:!0},{catch:function(e){return this.then(void 0,e)}});var IK=Ne,OK=pn,kK=_d,DK=Mm,BK=Nl;Is({target:"Promise",stat:!0,forced:lv},{race:function(e){var t=this,s=kK.f(t),r=s.reject,i=DK(function(){var l=OK(t.resolve);BK(e,function(A){IK(l,t,A).then(s.resolve,r)})});return i.error&&r(i.value),s.promise}});var LK=_d;Is({target:"Promise",stat:!0,forced:p0.CONSTRUCTOR},{reject:function(e){var t=LK.f(this);return(0,t.reject)(e),t.promise}});var jK=hi,PK=Je,UK=_d,OO=function(e,t){if(jK(e),PK(t)&&t.constructor===e)return t;var s=UK.f(e);return(0,s.resolve)(t),s.promise},FK=Is,MK=Wh,VK=p0.CONSTRUCTOR,QK=OO,HK=mt("Promise"),GK=!VK;FK({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return QK(GK&&this===HK?MK:this,e)}});var KK=Ne,WK=pn,zK=_d,qK=Mm,YK=Nl;Is({target:"Promise",stat:!0,forced:lv},{allSettled:function(e){var t=this,s=zK.f(t),r=s.resolve,i=s.reject,l=qK(function(){var A=WK(t.resolve),u=[],m=0,f=1;YK(e,function(b){var w=m++,_=!1;f++,KK(A,t,b).then(function(S){_||(_=!0,u[w]={status:"fulfilled",value:S},--f||r(u))},function(S){_||(_=!0,u[w]={status:"rejected",reason:S},--f||r(u))})}),--f||r(u)});return l.error&&i(l.value),s.promise}});var XK=Ne,JK=pn,$K=mt,ZK=_d,eW=Mm,tW=Nl,kO="No one promise resolved";Is({target:"Promise",stat:!0,forced:lv},{any:function(e){var t=this,s=$K("AggregateError"),r=ZK.f(t),i=r.resolve,l=r.reject,A=eW(function(){var u=JK(t.resolve),m=[],f=0,b=1,w=!1;tW(e,function(_){var S=f++,F=!1;b++,XK(u,t,_).then(function(B){F||w||(w=!0,i(B))},function(B){F||w||(F=!0,m[S]=B,--b||l(new s(m,kO)))})}),--b||l(new s(m,kO))});return A.error&&l(A.value),r.promise}});var sW=Is,rW=re,nW=bu,iW=_d,aW=pn,DO=Mm,BC=k.Promise,BO=!1;sW({target:"Promise",stat:!0,forced:!BC||!BC.try||DO(function(){BC.try(function(e){BO=e===8},8)}).error||!BO},{try:function(e){var t=arguments.length>1?nW(arguments,1):[],s=iW.f(this),r=DO(function(){return rW(aW(e),void 0,t)});return(r.error?s.reject:s.resolve)(r.value),s.promise}});var oW=_d;Is({target:"Promise",stat:!0},{withResolvers:function(){var e=oW.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var cW=Is,LC=Wh,lW=p,dW=mt,AW=z,uW=dC,LO=OO,hW=LC&&LC.prototype;cW({target:"Promise",proto:!0,real:!0,forced:!!LC&&lW(function(){hW.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=uW(this,dW("Promise")),s=AW(e);return this.then(s?function(r){return LO(t,e()).then(function(){return r})}:e,s?function(r){return LO(t,e()).then(function(){throw r})}:e)}});var jC=I,pW=cd,mW=si,fW=it,gW=jC("".charAt),jO=jC("".charCodeAt),bW=jC("".slice),PO=function(e){return function(t,s){var r,i,l=mW(fW(t)),A=pW(s),u=l.length;return A<0||A>=u?e?"":void 0:(r=jO(l,A))<55296||r>56319||A+1===u||(i=jO(l,A+1))<56320||i>57343?e?gW(l,A):r:e?bW(l,A,A+2):i-56320+(r-55296<<10)+65536}},PC={codeAt:PO(!1),charAt:PO(!0)},xW=PC.charAt,vW=si,UO=Gh,wW=DI,FO=Zx,MO="String Iterator",_W=UO.set,yW=UO.getterFor(MO);wW(String,"String",function(e){_W(this,{type:MO,string:vW(e),index:0})},function(){var e,t=yW(this),s=t.string,r=t.index;return r>=s.length?FO(void 0,!0):(e=xW(s,r),t.index+=e.length,FO(e,!1))});var EW=$e.Promise,CW={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},SW=k,NW=vA,VO=ni;for(var UC in CW)NW(SW[UC],UC),VO[UC]=VO.Array;var QO=EW,pt=h(QO),TW=Ti("Array","values"),RW=Bo,IW=Kn,OW=O,kW=TW,FC=Array.prototype,DW={DOMTokenList:!0,NodeList:!0},BW=function(e){var t=e.values;return e===FC||OW(FC,e)&&t===FC.values||IW(DW,RW(e))?kW:t},wo=h(BW),HO=qr,LW=TypeError,GO=bu,jW=Math.floor,MC=function(e,t){var s=e.length;if(s<8)for(var r,i,l=1;l<s;){for(i=l,r=e[l];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==l++&&(e[i]=r)}else for(var A=jW(s/2),u=MC(GO(e,0,A),t),m=MC(GO(e,A),t),f=u.length,b=m.length,w=0,_=0;w<f||_<b;)e[w+_]=w<f&&_<b?t(u[w],m[_])<=0?u[w++]:m[_++]:w<f?u[w++]:m[_++];return e},KO=MC,WO=ht.match(/firefox\/(\d+)/i),PW=!!WO&&+WO[1],UW=/MSIE|Trident/.test(ht),zO=ht.match(/AppleWebKit\/(\d+)\./),FW=!!zO&&+zO[1],MW=Is,qO=I,VW=pn,QW=Ro,YO=Do,HW=function(e,t){if(!delete e[t])throw new LW("Cannot delete property "+HO(t)+" of "+HO(e))},XO=si,VC=p,GW=KO,KW=Ph,JO=PW,WW=UW,$O=cs,ZO=FW,vu=[],ek=qO(vu.sort),zW=qO(vu.push),qW=VC(function(){vu.sort(void 0)}),YW=VC(function(){vu.sort(null)}),XW=KW("sort"),tk=!VC(function(){if($O)return $O<70;if(!(JO&&JO>3)){if(WW)return!0;if(ZO)return ZO<603;var e,t,s,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(r=0;r<47;r++)vu.push({k:t+r,v:s})}for(vu.sort(function(l,A){return A.v-l.v}),r=0;r<vu.length;r++)t=vu[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});MW({target:"Array",proto:!0,forced:qW||!YW||!XW||!tk},{sort:function(e){e!==void 0&&VW(e);var t=QW(this);if(tk)return e===void 0?ek(t):ek(t,e);var s,r,i=[],l=YO(t);for(r=0;r<l;r++)r in t&&zW(i,t[r]);for(GW(i,function(A){return function(u,m){return m===void 0?-1:u===void 0?1:A!==void 0?+A(u,m)||0:XO(u)>XO(m)?1:-1}}(e)),s=YO(i),r=0;r<s;)t[r]=i[r++];for(;r<l;)HW(t,r++);return t}});var JW=Ti("Array","sort"),$W=O,ZW=JW,QC=Array.prototype,ez=function(e){var t=e.sort;return e===QC||$W(QC,e)&&t===QC.sort?ZW:t},zh=h(ez),tz=Is,sz=I,rz=Pc,nz=RangeError,sk=String.fromCharCode,rk=String.fromCodePoint,iz=sz([].join);tz({target:"String",stat:!0,forced:!!rk&&rk.length!==1},{fromCodePoint:function(e){for(var t,s=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],rz(t,1114111)!==t)throw new nz(t+" is not a valid code point");s[i]=t<65536?sk(t):sk(55296+((t-=65536)>>10),t%1024+56320)}return iz(s,"")}});var az=p,oz=Hr("iterator"),dv=!az(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(i,l){t.delete("b"),r+=l+i}),s.delete("a",2),s.delete("b",void 0),!e.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[oz]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),cz=gu,HC=Is,nk=k,GC=tO,lz=mt,Av=Ne,Tl=I,g0=se,ik=dv,ak=gu,dz=tv,Az=function(e,t,s){for(var r in t)s&&s.unsafe&&e[r]?e[r]=t[r]:cz(e,r,t[r],s);return e},uz=vA,hz=nC,KC=Gh,ok=aC,WC=z,pz=Kn,mz=Oo,fz=Bo,gz=hi,ck=Je,_o=si,bz=Dn,lk=ue,dk=Fi,xz=ra,uv=Zx,Hm=Kh,vz=KO,wz=Hr("iterator"),Gm="URLSearchParams",Ak=Gm+"Iterator",uk=KC.set,Vc=KC.getterFor(Gm),_z=KC.getterFor(Ak),hk=GC("fetch"),hv=GC("Request"),b0=GC("Headers"),zC=hv&&hv.prototype,pk=b0&&b0.prototype,yz=nk.TypeError,Ez=nk.encodeURIComponent,Cz=String.fromCharCode,Sz=lz("String","fromCodePoint"),Nz=parseInt,pv=Tl("".charAt),mk=Tl([].join),wu=Tl([].push),fk=Tl("".replace),Tz=Tl([].shift),gk=Tl([].splice),bk=Tl("".split),xk=Tl("".slice),Rz=Tl(/./.exec),Iz=/\+/g,Oz=/^[0-9a-f]+$/i,vk=function(e,t){var s=xk(e,t,t+2);return Rz(Oz,s)?Nz(s,16):NaN},kz=function(e){for(var t=0,s=128;s>0&&e&s;s>>=1)t++;return t},Dz=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},wk=function(e){for(var t=(e=fk(e,Iz," ")).length,s="",r=0;r<t;){var i=pv(e,r);if(i==="%"){if(pv(e,r+1)==="%"||r+3>t){s+="%",r++;continue}var l=vk(e,r+1);if(l!=l){s+=i,r++;continue}r+=2;var A=kz(l);if(A===0)i=Cz(l);else{if(A===1||A>4){s+="",r++;continue}for(var u=[l],m=1;m<A&&!(++r+3>t||pv(e,r)!=="%");){var f=vk(e,r+1);if(f!=f){r+=3;break}if(f>191||f<128)break;wu(u,f),r+=2,m++}if(u.length!==A){s+="";continue}var b=Dz(u);b===null?s+="":i=Sz(b)}}s+=i,r++}return s},Bz=/[!'()~]|%20/g,Lz={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},jz=function(e){return Lz[e]},_k=function(e){return fk(Ez(e),Bz,jz)},qC=hz(function(e,t){uk(this,{type:Ak,target:Vc(e).entries,index:0,kind:t})},Gm,function(){var e=_z(this),t=e.target,s=e.index++;if(!t||s>=t.length)return e.target=null,uv(void 0,!0);var r=t[s];switch(e.kind){case"keys":return uv(r.key,!1);case"values":return uv(r.value,!1)}return uv([r.key,r.value],!1)},!0),yk=function(e){this.entries=[],this.url=null,e!==void 0&&(ck(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?pv(e,0)==="?"?xk(e,1):e:_o(e)))};yk.prototype={type:Gm,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,s,r,i,l,A,u,m=this.entries,f=xz(e);if(f)for(s=(t=dk(e,f)).next;!(r=Av(s,t)).done;){if(l=(i=dk(gz(r.value))).next,(A=Av(l,i)).done||(u=Av(l,i)).done||!Av(l,i).done)throw new yz("Expected sequence with length 2");wu(m,{key:_o(A.value),value:_o(u.value)})}else for(var b in e)pz(e,b)&&wu(m,{key:b,value:_o(e[b])})},parseQuery:function(e){if(e)for(var t,s,r=this.entries,i=bk(e,"&"),l=0;l<i.length;)(t=i[l++]).length&&(s=bk(t,"="),wu(r,{key:wk(Tz(s)),value:wk(mk(s,"="))}))},serialize:function(){for(var e,t=this.entries,s=[],r=0;r<t.length;)e=t[r++],wu(s,_k(e.key)+"="+_k(e.value));return mk(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var mv=function(){ok(this,Km);var e=uk(this,new yk(arguments.length>0?arguments[0]:void 0));g0||(this.size=e.entries.length)},Km=mv.prototype;if(Az(Km,{append:function(e,t){var s=Vc(this);Hm(arguments.length,2),wu(s.entries,{key:_o(e),value:_o(t)}),g0||this.length++,s.updateURL()},delete:function(e){for(var t=Vc(this),s=Hm(arguments.length,1),r=t.entries,i=_o(e),l=s<2?void 0:arguments[1],A=l===void 0?l:_o(l),u=0;u<r.length;){var m=r[u];if(m.key!==i||A!==void 0&&m.value!==A)u++;else if(gk(r,u,1),A!==void 0)break}g0||(this.size=r.length),t.updateURL()},get:function(e){var t=Vc(this).entries;Hm(arguments.length,1);for(var s=_o(e),r=0;r<t.length;r++)if(t[r].key===s)return t[r].value;return null},getAll:function(e){var t=Vc(this).entries;Hm(arguments.length,1);for(var s=_o(e),r=[],i=0;i<t.length;i++)t[i].key===s&&wu(r,t[i].value);return r},has:function(e){for(var t=Vc(this).entries,s=Hm(arguments.length,1),r=_o(e),i=s<2?void 0:arguments[1],l=i===void 0?i:_o(i),A=0;A<t.length;){var u=t[A++];if(u.key===r&&(l===void 0||u.value===l))return!0}return!1},set:function(e,t){var s=Vc(this);Hm(arguments.length,1);for(var r,i=s.entries,l=!1,A=_o(e),u=_o(t),m=0;m<i.length;m++)(r=i[m]).key===A&&(l?gk(i,m--,1):(l=!0,r.value=u));l||wu(i,{key:A,value:u}),g0||(this.size=i.length),s.updateURL()},sort:function(){var e=Vc(this);vz(e.entries,function(t,s){return t.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,s=Vc(this).entries,r=mz(e,arguments.length>1?arguments[1]:void 0),i=0;i<s.length;)r((t=s[i++]).value,t.key,this)},keys:function(){return new qC(this,"keys")},values:function(){return new qC(this,"values")},entries:function(){return new qC(this,"entries")}},{enumerable:!0}),ak(Km,wz,Km.entries,{}),ak(Km,"toString",function(){return Vc(this).serialize()},{enumerable:!0}),g0&&dz(Km,"size",{get:function(){return Vc(this).entries.length},configurable:!0,enumerable:!0}),uz(mv,Gm),HC({global:!0,forced:!ik},{URLSearchParams:mv}),!ik&&WC(b0)){var Pz=Tl(pk.has),Uz=Tl(pk.set),Ek=function(e){if(ck(e)){var t,s=e.body;if(fz(s)===Gm)return t=e.headers?new b0(e.headers):new b0,Pz(t,"content-type")||Uz(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),bz(e,{body:lk(0,_o(s)),headers:lk(0,t)})}return e};if(WC(hk)&&HC({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return hk(e,arguments.length>1?Ek(arguments[1]):{})}}),WC(hv)){var YC=function(e){return ok(this,zC),new hv(e,arguments.length>1?Ek(arguments[1]):{})};zC.constructor=YC,YC.prototype=zC,HC({global:!0,dontCallGetSet:!0,forced:!0},{Request:YC})}}var Qc,Fz={URLSearchParams:mv,getState:Vc},Mz=$e.URLSearchParams,Ck=se,Vz=I,Qz=Ne,Hz=p,XC=Se,Gz=Uh,Kz=Z,Wz=Ro,zz=ot,Wm=Object.assign,Sk=Object.defineProperty,qz=Vz([].concat),Yz=!Wm||Hz(function(){if(Ck&&Wm({b:1},Wm(Sk({},"a",{enumerable:!0,get:function(){Sk(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},s=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[s]=7,r.split("").forEach(function(i){t[i]=i}),Wm({},e)[s]!==7||XC(Wm({},t)).join("")!==r})?function(e,t){for(var s=Wz(e),r=arguments.length,i=1,l=Gz.f,A=Kz.f;r>i;)for(var u,m=zz(arguments[i++]),f=l?qz(XC(m),l(m)):XC(m),b=f.length,w=0;b>w;)u=f[w++],Ck&&!Qz(A,m,u)||(s[u]=m[u]);return s}:Wm,Xz=hi,Jz=pu,$z=se,Zz=Na,eq=ue,JC=function(e,t,s){$z?Zz.f(e,t,eq(0,s)):e[t]=s},tq=Oo,sq=Ne,rq=Ro,nq=function(e,t,s,r){try{return r?t(Xz(s)[0],s[1]):t(s)}catch(i){Jz(e,"throw",i)}},iq=ln,aq=sv,oq=Do,Nk=JC,cq=Fi,lq=ra,Tk=Array,qh=I,$C=2147483647,dq=/[^\0-\u007E]/,Rk=/[.\u3002\uFF0E\uFF61]/g,Ik="Overflow: input needs wider integers to process",Ok=RangeError,Aq=qh(Rk.exec),zm=Math.floor,ZC=String.fromCharCode,kk=qh("".charCodeAt),Dk=qh([].join),_u=qh([].push),uq=qh("".replace),hq=qh("".split),pq=qh("".toLowerCase),Bk=function(e){return e+22+75*(e<26)},mq=function(e,t,s){var r=0;for(e=s?zm(e/700):e>>1,e+=zm(e/t);e>455;)e=zm(e/35),r+=36;return zm(r+36*e/(e+38))},fq=function(e){var t=[];e=function(K){for(var X=[],oe=0,xe=K.length;oe<xe;){var Ee=kk(K,oe++);if(Ee>=55296&&Ee<=56319&&oe<xe){var me=kk(K,oe++);(64512&me)==56320?_u(X,((1023&Ee)<<10)+(1023&me)+65536):(_u(X,Ee),oe--)}else _u(X,Ee)}return X}(e);var s,r,i=e.length,l=128,A=0,u=72;for(s=0;s<e.length;s++)(r=e[s])<128&&_u(t,ZC(r));var m=t.length,f=m;for(m&&_u(t,"-");f<i;){var b=$C;for(s=0;s<e.length;s++)(r=e[s])>=l&&r<b&&(b=r);var w=f+1;if(b-l>zm(($C-A)/w))throw new Ok(Ik);for(A+=(b-l)*w,l=b,s=0;s<e.length;s++){if((r=e[s])<l&&++A>$C)throw new Ok(Ik);if(r===l){for(var _=A,S=36;;){var F=S<=u?1:S>=u+26?26:S-u;if(_<F)break;var B=_-F,j=36-F;_u(t,ZC(Bk(F+B%j))),_=zm(B/j),S+=36}_u(t,ZC(Bk(_))),u=mq(A,w,f===m),A=0,f++}}A++,l++}return Dk(t,"")},gq=Is,eS=se,bq=dv,tS=k,Lk=Oo,Hc=I,fv=gu,Gc=tv,xq=aC,sS=Kn,rS=Yz,qm=function(e){var t=rq(e),s=aq(this),r=arguments.length,i=r>1?arguments[1]:void 0,l=i!==void 0;l&&(i=tq(i,r>2?arguments[2]:void 0));var A,u,m,f,b,w,_=lq(t),S=0;if(!_||this===Tk&&iq(_))for(A=oq(t),u=s?new this(A):Tk(A);A>S;S++)w=l?i(t[S],S):t[S],Nk(u,S,w);else for(u=s?new this:[],b=(f=cq(t,_)).next;!(m=sq(b,f)).done;S++)w=l?nq(f,i,[m.value,S],!0):m.value,Nk(u,S,w);return u.length=S,u},Rl=bu,vq=PC.codeAt,wq=function(e){var t,s,r=[],i=hq(uq(pq(e),Rk,"."),".");for(t=0;t<i.length;t++)s=i[t],_u(r,Aq(dq,s)?"xn--"+fq(s):s);return Dk(r,".")},wA=si,_q=vA,yq=Kh,jk=Fz,Pk=Gh,Eq=Pk.set,gv=Pk.getterFor("URL"),Cq=jk.URLSearchParams,Sq=jk.getState,x0=tS.URL,nS=tS.TypeError,bv=tS.parseInt,Nq=Math.floor,Uk=Math.pow,Kc=Hc("".charAt),Il=Hc(/./.exec),v0=Hc([].join),Tq=Hc(1.1.toString),Rq=Hc([].pop),Ym=Hc([].push),iS=Hc("".replace),Iq=Hc([].shift),Oq=Hc("".split),w0=Hc("".slice),xv=Hc("".toLowerCase),kq=Hc([].unshift),aS="Invalid scheme",Yh="Invalid host",Fk="Invalid port",Mk=/[a-z]/i,Dq=/[\d+-.a-z]/i,oS=/\d/,Bq=/^0x/i,Lq=/^[0-7]+$/,jq=/^\d+$/,Vk=/^[\da-f]+$/i,Pq=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Uq=/[\0\t\n\r #/:<>?@[\\\]^|]/,Fq=/^[\u0000-\u0020]+/,Mq=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Vq=/[\t\n\r]/g,_0=function(e){var t,s,r,i;if(typeof e=="number"){for(t=[],s=0;s<4;s++)kq(t,e%256),e=Nq(e/256);return v0(t,".")}if(typeof e=="object"){for(t="",r=function(l){for(var A=null,u=1,m=null,f=0,b=0;b<8;b++)l[b]!==0?(f>u&&(A=m,u=f),m=null,f=0):(m===null&&(m=b),++f);return f>u?m:A}(e),s=0;s<8;s++)i&&e[s]===0||(i&&(i=!1),r===s?(t+=s?":":"::",i=!0):(t+=Tq(e[s],16),s<7&&(t+=":")));return"["+t+"]"}return e},vv={},Qk=rS({},vv,{" ":1,'"':1,"<":1,">":1,"`":1}),Hk=rS({},Qk,{"#":1,"?":1,"{":1,"}":1}),cS=rS({},Hk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),yu=function(e,t){var s=vq(e,0);return s>32&&s<127&&!sS(t,e)?e:encodeURIComponent(e)},wv={ftp:21,file:null,http:80,https:443,ws:80,wss:443},y0=function(e,t){var s;return e.length===2&&Il(Mk,Kc(e,0))&&((s=Kc(e,1))===":"||!t&&s==="|")},Gk=function(e){var t;return e.length>1&&y0(w0(e,0,2))&&(e.length===2||(t=Kc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Qq=function(e){return e==="."||xv(e)==="%2e"},lS={},Kk={},dS={},Wk={},zk={},AS={},qk={},Yk={},_v={},yv={},uS={},hS={},pS={},mS={},Xk={},fS={},Xm={},yd={},Jk={},Xh={},_A={},gS=function(e,t,s){var r,i,l,A=wA(e);if(t){if(i=this.parse(A))throw new nS(i);this.searchParams=null}else{if(s!==void 0&&(r=new gS(s,!0)),i=this.parse(A,null,r))throw new nS(i);(l=Sq(new Cq)).bindURL(this),this.searchParams=l}};gS.prototype={type:"URL",parse:function(e,t,s){var r,i,l,A,u,m=this,f=t||lS,b=0,w="",_=!1,S=!1,F=!1;for(e=wA(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=iS(e,Fq,""),e=iS(e,Mq,"$1")),e=iS(e,Vq,""),r=qm(e);b<=r.length;){switch(i=r[b],f){case lS:if(!i||!Il(Mk,i)){if(t)return aS;f=dS;continue}w+=xv(i),f=Kk;break;case Kk:if(i&&(Il(Dq,i)||i==="+"||i==="-"||i==="."))w+=xv(i);else{if(i!==":"){if(t)return aS;w="",f=dS,b=0;continue}if(t&&(m.isSpecial()!==sS(wv,w)||w==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=w,t)return void(m.isSpecial()&&wv[m.scheme]===m.port&&(m.port=null));w="",m.scheme==="file"?f=mS:m.isSpecial()&&s&&s.scheme===m.scheme?f=Wk:m.isSpecial()?f=Yk:r[b+1]==="/"?(f=zk,b++):(m.cannotBeABaseURL=!0,Ym(m.path,""),f=Jk)}break;case dS:if(!s||s.cannotBeABaseURL&&i!=="#")return aS;if(s.cannotBeABaseURL&&i==="#"){m.scheme=s.scheme,m.path=Rl(s.path),m.query=s.query,m.fragment="",m.cannotBeABaseURL=!0,f=_A;break}f=s.scheme==="file"?mS:AS;continue;case Wk:if(i!=="/"||r[b+1]!=="/"){f=AS;continue}f=_v,b++;break;case zk:if(i==="/"){f=yv;break}f=yd;continue;case AS:if(m.scheme=s.scheme,i===Qc)m.username=s.username,m.password=s.password,m.host=s.host,m.port=s.port,m.path=Rl(s.path),m.query=s.query;else if(i==="/"||i==="\\"&&m.isSpecial())f=qk;else if(i==="?")m.username=s.username,m.password=s.password,m.host=s.host,m.port=s.port,m.path=Rl(s.path),m.query="",f=Xh;else{if(i!=="#"){m.username=s.username,m.password=s.password,m.host=s.host,m.port=s.port,m.path=Rl(s.path),m.path.length--,f=yd;continue}m.username=s.username,m.password=s.password,m.host=s.host,m.port=s.port,m.path=Rl(s.path),m.query=s.query,m.fragment="",f=_A}break;case qk:if(!m.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){m.username=s.username,m.password=s.password,m.host=s.host,m.port=s.port,f=yd;continue}f=yv}else f=_v;break;case Yk:if(f=_v,i!=="/"||Kc(w,b+1)!=="/")continue;b++;break;case _v:if(i!=="/"&&i!=="\\"){f=yv;continue}break;case yv:if(i==="@"){_&&(w="%40"+w),_=!0,l=qm(w);for(var B=0;B<l.length;B++){var j=l[B];if(j!==":"||F){var K=yu(j,cS);F?m.password+=K:m.username+=K}else F=!0}w=""}else if(i===Qc||i==="/"||i==="?"||i==="#"||i==="\\"&&m.isSpecial()){if(_&&w==="")return"Invalid authority";b-=qm(w).length+1,w="",f=uS}else w+=i;break;case uS:case hS:if(t&&m.scheme==="file"){f=fS;continue}if(i!==":"||S){if(i===Qc||i==="/"||i==="?"||i==="#"||i==="\\"&&m.isSpecial()){if(m.isSpecial()&&w==="")return Yh;if(t&&w===""&&(m.includesCredentials()||m.port!==null))return;if(A=m.parseHost(w))return A;if(w="",f=Xm,t)return;continue}i==="["?S=!0:i==="]"&&(S=!1),w+=i}else{if(w==="")return Yh;if(A=m.parseHost(w))return A;if(w="",f=pS,t===hS)return}break;case pS:if(!Il(oS,i)){if(i===Qc||i==="/"||i==="?"||i==="#"||i==="\\"&&m.isSpecial()||t){if(w!==""){var X=bv(w,10);if(X>65535)return Fk;m.port=m.isSpecial()&&X===wv[m.scheme]?null:X,w=""}if(t)return;f=Xm;continue}return Fk}w+=i;break;case mS:if(m.scheme="file",i==="/"||i==="\\")f=Xk;else{if(!s||s.scheme!=="file"){f=yd;continue}switch(i){case Qc:m.host=s.host,m.path=Rl(s.path),m.query=s.query;break;case"?":m.host=s.host,m.path=Rl(s.path),m.query="",f=Xh;break;case"#":m.host=s.host,m.path=Rl(s.path),m.query=s.query,m.fragment="",f=_A;break;default:Gk(v0(Rl(r,b),""))||(m.host=s.host,m.path=Rl(s.path),m.shortenPath()),f=yd;continue}}break;case Xk:if(i==="/"||i==="\\"){f=fS;break}s&&s.scheme==="file"&&!Gk(v0(Rl(r,b),""))&&(y0(s.path[0],!0)?Ym(m.path,s.path[0]):m.host=s.host),f=yd;continue;case fS:if(i===Qc||i==="/"||i==="\\"||i==="?"||i==="#"){if(!t&&y0(w))f=yd;else if(w===""){if(m.host="",t)return;f=Xm}else{if(A=m.parseHost(w))return A;if(m.host==="localhost"&&(m.host=""),t)return;w="",f=Xm}continue}w+=i;break;case Xm:if(m.isSpecial()){if(f=yd,i!=="/"&&i!=="\\")continue}else if(t||i!=="?")if(t||i!=="#"){if(i!==Qc&&(f=yd,i!=="/"))continue}else m.fragment="",f=_A;else m.query="",f=Xh;break;case yd:if(i===Qc||i==="/"||i==="\\"&&m.isSpecial()||!t&&(i==="?"||i==="#")){if((u=xv(u=w))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(m.shortenPath(),i==="/"||i==="\\"&&m.isSpecial()||Ym(m.path,"")):Qq(w)?i==="/"||i==="\\"&&m.isSpecial()||Ym(m.path,""):(m.scheme==="file"&&!m.path.length&&y0(w)&&(m.host&&(m.host=""),w=Kc(w,0)+":"),Ym(m.path,w)),w="",m.scheme==="file"&&(i===Qc||i==="?"||i==="#"))for(;m.path.length>1&&m.path[0]==="";)Iq(m.path);i==="?"?(m.query="",f=Xh):i==="#"&&(m.fragment="",f=_A)}else w+=yu(i,Hk);break;case Jk:i==="?"?(m.query="",f=Xh):i==="#"?(m.fragment="",f=_A):i!==Qc&&(m.path[0]+=yu(i,vv));break;case Xh:t||i!=="#"?i!==Qc&&(i==="'"&&m.isSpecial()?m.query+="%27":m.query+=i==="#"?"%23":yu(i,vv)):(m.fragment="",f=_A);break;case _A:i!==Qc&&(m.fragment+=yu(i,Qk))}b++}},parseHost:function(e){var t,s,r;if(Kc(e,0)==="["){if(Kc(e,e.length-1)!=="]"||(t=function(i){var l,A,u,m,f,b,w,_=[0,0,0,0,0,0,0,0],S=0,F=null,B=0,j=function(){return Kc(i,B)};if(j()===":"){if(Kc(i,1)!==":")return;B+=2,F=++S}for(;j();){if(S===8)return;if(j()!==":"){for(l=A=0;A<4&&Il(Vk,j());)l=16*l+bv(j(),16),B++,A++;if(j()==="."){if(A===0||(B-=A,S>6))return;for(u=0;j();){if(m=null,u>0){if(!(j()==="."&&u<4))return;B++}if(!Il(oS,j()))return;for(;Il(oS,j());){if(f=bv(j(),10),m===null)m=f;else{if(m===0)return;m=10*m+f}if(m>255)return;B++}_[S]=256*_[S]+m,++u!=2&&u!==4||S++}if(u!==4)return;break}if(j()===":"){if(B++,!j())return}else if(j())return;_[S++]=l}else{if(F!==null)return;B++,F=++S}}if(F!==null)for(b=S-F,S=7;S!==0&&b>0;)w=_[S],_[S--]=_[F+b-1],_[F+--b]=w;else if(S!==8)return;return _}(w0(e,1,-1)),!t))return Yh;this.host=t}else if(this.isSpecial()){if(e=wq(e),Il(Pq,e)||(t=function(i){var l,A,u,m,f,b,w,_=Oq(i,".");if(_.length&&_[_.length-1]===""&&_.length--,(l=_.length)>4)return i;for(A=[],u=0;u<l;u++){if((m=_[u])==="")return i;if(f=10,m.length>1&&Kc(m,0)==="0"&&(f=Il(Bq,m)?16:8,m=w0(m,f===8?1:2)),m==="")b=0;else{if(!Il(f===10?jq:f===8?Lq:Vk,m))return i;b=bv(m,f)}Ym(A,b)}for(u=0;u<l;u++)if(b=A[u],u===l-1){if(b>=Uk(256,5-l))return null}else if(b>255)return null;for(w=Rq(A),u=0;u<A.length;u++)w+=A[u]*Uk(256,3-u);return w}(e),t===null))return Yh;this.host=t}else{if(Il(Uq,e))return Yh;for(t="",s=qm(e),r=0;r<s.length;r++)t+=yu(s[r],vv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return sS(wv,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&y0(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,s=e.username,r=e.password,i=e.host,l=e.port,A=e.path,u=e.query,m=e.fragment,f=t+":";return i!==null?(f+="//",e.includesCredentials()&&(f+=s+(r?":"+r:"")+"@"),f+=_0(i),l!==null&&(f+=":"+l)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?A[0]:A.length?"/"+v0(A,"/"):"",u!==null&&(f+="?"+u),m!==null&&(f+="#"+m),f},setHref:function(e){var t=this.parse(e);if(t)throw new nS(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Jm(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+_0(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(wA(e)+":",lS)},getUsername:function(){return this.username},setUsername:function(e){var t=qm(wA(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<t.length;s++)this.username+=yu(t[s],cS)}},getPassword:function(){return this.password},setPassword:function(e){var t=qm(wA(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<t.length;s++)this.password+=yu(t[s],cS)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?_0(e):_0(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,uS)},getHostname:function(){var e=this.host;return e===null?"":_0(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,hS)},getPort:function(){var e=this.port;return e===null?"":wA(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=wA(e))===""?this.port=null:this.parse(e,pS))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+v0(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Xm))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=wA(e))===""?this.query=null:(Kc(e,0)==="?"&&(e=w0(e,1)),this.query="",this.parse(e,Xh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=wA(e))!==""?(Kc(e,0)==="#"&&(e=w0(e,1)),this.fragment="",this.parse(e,_A)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Jm=function(e){var t=xq(this,yo),s=yq(arguments.length,1)>1?arguments[1]:void 0,r=Eq(t,new gS(e,!1,s));eS||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},yo=Jm.prototype,Wc=function(e,t){return{get:function(){return gv(this)[e]()},set:t&&function(s){return gv(this)[t](s)},configurable:!0,enumerable:!0}};if(eS&&(Gc(yo,"href",Wc("serialize","setHref")),Gc(yo,"origin",Wc("getOrigin")),Gc(yo,"protocol",Wc("getProtocol","setProtocol")),Gc(yo,"username",Wc("getUsername","setUsername")),Gc(yo,"password",Wc("getPassword","setPassword")),Gc(yo,"host",Wc("getHost","setHost")),Gc(yo,"hostname",Wc("getHostname","setHostname")),Gc(yo,"port",Wc("getPort","setPort")),Gc(yo,"pathname",Wc("getPathname","setPathname")),Gc(yo,"search",Wc("getSearch","setSearch")),Gc(yo,"searchParams",Wc("getSearchParams")),Gc(yo,"hash",Wc("getHash","setHash"))),fv(yo,"toJSON",function(){return gv(this).serialize()},{enumerable:!0}),fv(yo,"toString",function(){return gv(this).serialize()},{enumerable:!0}),x0){var $k=x0.createObjectURL,Zk=x0.revokeObjectURL;$k&&fv(Jm,"createObjectURL",Lk($k,x0)),Zk&&fv(Jm,"revokeObjectURL",Lk(Zk,x0))}_q(Jm,"URL"),gq({global:!0,forced:!bq,sham:!eS},{URL:Jm});var Hq=Is,e5=p,Gq=Kh,t5=si,Kq=dv,bS=mt("URL"),Wq=Kq&&e5(function(){bS.canParse()}),zq=e5(function(){return bS.canParse.length!==1});Hq({target:"URL",stat:!0,forced:!Wq||zq},{canParse:function(e){var t=Gq(arguments.length,1),s=t5(e),r=t<2||arguments[1]===void 0?void 0:t5(arguments[1]);try{return!!new bS(s,r)}catch{return!1}}});var qq=Is,Yq=Kh,s5=si,Xq=dv,Jq=mt("URL");qq({target:"URL",stat:!0,forced:!Xq},{parse:function(e){var t=Yq(arguments.length,1),s=s5(e),r=t<2||arguments[1]===void 0?void 0:s5(arguments[1]);try{return new Jq(s,r)}catch{return null}}});var Ev=h($e.URL);let r5=!0,n5=!0;function Cv(e,t,s){const r=e.match(t);return r&&r.length>=s&&parseInt(r[s],10)}function Jh(e,t,s){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(A,u){if(A!==t)return i.apply(this,arguments);const m=f=>{const b=s(f);b&&(u.handleEvent?u.handleEvent(b):u(b))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,m),i.apply(this,[A,m])};const l=r.removeEventListener;r.removeEventListener=function(A,u){if(A!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(u))return l.apply(this,arguments);const m=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[A,m])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(A){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),A&&this.addEventListener(t,this["_on"+t]=A)},enumerable:!0,configurable:!0})}function $q(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(r5=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Zq(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(n5=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function i5(){if(typeof window=="object"){if(r5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function xS(e,t){n5&&console.warn(e+" is deprecated, please use "+t+" instead.")}function a5(e){return Object.prototype.toString.call(e)==="[object Object]"}function o5(e){var t;return a5(e)?za(t=Object.keys(e)).call(t,function(s,r){const i=a5(e[r]),l=i?o5(e[r]):e[r],A=i&&!Object.keys(l).length;return l===void 0||A?s:Object.assign(s,{[r]:l})},{}):e}function vS(e,t,s){t&&!s.has(t.id)&&(s.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?vS(e,e.get(t[r]),s):r.endsWith("Ids")&&t[r].forEach(i=>{vS(e,e.get(i),s)})}))}function c5(e,t,s){const r=s?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;const l=[];return e.forEach(A=>{A.type==="track"&&A.trackIdentifier===t.id&&l.push(A)}),l.forEach(A=>{e.forEach(u=>{u.type===r&&u.trackId===A.id&&vS(e,u,i)})}),i}const l5=i5;function d5(e,t){const s=e&&e.navigator;if(!s.mediaDevices)return;const r=function(A){if(typeof A!="object"||A.mandatory||A.optional)return A;const u={};return Object.keys(A).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const f=typeof A[m]=="object"?A[m]:{ideal:A[m]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const b=function(w,_){return w?w+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(f.ideal!==void 0){u.optional=u.optional||[];let w={};typeof f.ideal=="number"?(w[b("min",m)]=f.ideal,u.optional.push(w),w={},w[b("max",m)]=f.ideal,u.optional.push(w)):(w[b("",m)]=f.ideal,u.optional.push(w))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[b("",m)]=f.exact):["min","max"].forEach(w=>{f[w]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[b(w,m)]=f[w])})}),A.advanced&&(u.optional=(u.optional||[]).concat(A.advanced)),u},i=function(A,u){if(t.version>=61)return u(A);if((A=JSON.parse(JSON.stringify(A)))&&typeof A.audio=="object"){const m=function(f,b,w){b in f&&!(w in f)&&(f[w]=f[b],delete f[b])};m((A=JSON.parse(JSON.stringify(A))).audio,"autoGainControl","googAutoGainControl"),m(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=r(A.audio)}if(A&&typeof A.video=="object"){let m=A.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const f=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||f)){let b;if(delete A.video.facingMode,m.exact==="environment"||m.ideal==="environment"?b=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(w=>{w=w.filter(S=>S.kind==="videoinput");let _=w.find(S=>b.some(F=>{var B;return et(B=S.label.toLowerCase()).call(B,F)}));return!_&&w.length&&et(b).call(b,"back")&&(_=w[w.length-1]),_&&(A.video.deviceId=m.exact?{exact:_.deviceId}:{ideal:_.deviceId}),A.video=r(A.video),l5("chrome: "+JSON.stringify(A)),u(A)})}A.video=r(A.video)}return l5("chrome: "+JSON.stringify(A)),u(A)},l=function(A){return t.version>=64?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(A,u,m){i(A,f=>{s.webkitGetUserMedia(f,u,b=>{m&&m(l(b))})})}).bind(s),s.mediaDevices.getUserMedia){const A=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(u){return i(u,m=>A(m).then(f=>{if(m.audio&&!f.getAudioTracks().length||m.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return f},f=>pt.reject(l(f))))}}}function A5(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function u5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===r.track.id):{track:r.track};const l=new Event("track");l.track=r.track,l.receiver=i,l.transceiver={receiver:i},l.streams=[s.stream],this.dispatchEvent(l)}),s.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===r.id):{track:r};const l=new Event("track");l.track=r,l.receiver=i,l.transceiver={receiver:i},l.streams=[s.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Jh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function h5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(i,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=i.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(A,u){let m=i.apply(this,arguments);return m||(m=t(this,A),this._senders.push(m)),m};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(A){l.apply(this,arguments);const u=this._senders.indexOf(A);u!==-1&&this._senders.splice(u,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(l=>{const A=this._senders.find(u=>u.track===l);A&&this._senders.splice(this._senders.indexOf(A),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function p5(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,r,i]=arguments;if(arguments.length>0&&typeof s=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof s!="function"))return t.apply(this,[]);const l=function(u){const m={};return u.result().forEach(f=>{const b={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(w=>{b[w]=f.stat(w)}),m[b.id]=b}),m},A=function(u){return new Map(Object.keys(u).map(m=>[m,u[m]]))};if(arguments.length>=2){const u=function(m){r(A(l(m)))};return t.apply(this,[u,s])}return new pt((u,m)=>{t.apply(this,[function(f){u(A(l(f)))},m])}).then(r,i)}}function m5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=s.apply(this,[]);return i.forEach(l=>l._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(l=>c5(l,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=s.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Jh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>c5(i,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const s=arguments[0];let r,i,l;return this.getSenders().forEach(A=>{A.track===s&&(r?l=!0:r=A)}),this.getReceivers().forEach(A=>(A.track===s&&(i?l=!0:i=A),A.track===s)),l||r&&i?pt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():pt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function f5(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,A){if(!A)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[A.id]?this._shimmedLocalStreams[A.id].indexOf(u)===-1&&this._shimmedLocalStreams[A.id].push(u):this._shimmedLocalStreams[A.id]=[A,u],u};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const A=this.getSenders();s.apply(this,arguments);const u=this.getSenders().filter(m=>A.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(u)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(A=>{const u=this._shimmedLocalStreams[A].indexOf(l);u!==-1&&this._shimmedLocalStreams[A].splice(u,1),this._shimmedLocalStreams[A].length===1&&delete this._shimmedLocalStreams[A]}),i.apply(this,arguments)}}function g5(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return f5(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=s.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(f=>this._reverseStreams[f.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(f=>{if(this.getSenders().find(w=>w.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const f=new e.MediaStream(m.getTracks());this._streams[m.id]=f,this._reverseStreams[f.id]=m,m=f}r.apply(this,[m])};const i=e.RTCPeerConnection.prototype.removeStream;function l(m,f){let b=f.sdp;return Object.keys(m._reverseStreams||[]).forEach(w=>{const _=m._reverseStreams[w],S=m._streams[_.id];b=b.replace(new RegExp(S.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:b})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(S=>S===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[f.id];if(_)_.addTrack(m),pt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([m]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(S=>S.track===m)},["createOffer","createAnswer"].forEach(function(m){const f=e.RTCPeerConnection.prototype[m],b={[m](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[_=>{const S=l(this,_);w[0].apply(null,[S])},_=>{w[1]&&w[1].apply(null,_)},arguments[2]]):f.apply(this,arguments).then(_=>l(this,_))}};e.RTCPeerConnection.prototype[m]=b[m]});const A=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,f){let b=f.sdp;return Object.keys(m._reverseStreams||[]).forEach(w=>{const _=m._reverseStreams[w],S=m._streams[_.id];b=b.replace(new RegExp(_.id,"g"),S.id)}),new RTCSessionDescription({type:f.type,sdp:b})}(this,arguments[0]),A.apply(this,arguments)):A.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=u.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(w=>m.track===w)&&(f=this._streams[b])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function wS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=e.RTCPeerConnection.prototype[s],i={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=i[s]})}function b5(e,t){Jh(e,"negotiationneeded",s=>{const r=s.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return s})}var x5=Object.freeze({__proto__:null,fixNegotiationNeeded:b5,shimAddTrackRemoveTrack:g5,shimAddTrackRemoveTrackWithNative:f5,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return t(s).then(r=>{const i=s.video&&s.video.width,l=s.video&&s.video.height,A=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:A||3}},i&&(s.video.mandatory.maxWidth=i),l&&(s.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:h5,shimGetStats:p5,shimGetUserMedia:d5,shimMediaStream:A5,shimOnTrack:u5,shimPeerConnection:wS,shimSenderReceiverGetStats:m5});function v5(e,t){const s=e&&e.navigator,r=e&&e.MediaStreamTrack;if(s.getUserMedia=function(i,l,A){xS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(i).then(l,A)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const i=function(A,u,m){u in A&&!(m in A)&&(A[m]=A[u],delete A[u])},l=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(A){return typeof A=="object"&&typeof A.audio=="object"&&(A=JSON.parse(JSON.stringify(A)),i(A.audio,"autoGainControl","mozAutoGainControl"),i(A.audio,"noiseSuppression","mozNoiseSuppression")),l(A)},r&&r.prototype.getSettings){const A=r.prototype.getSettings;r.prototype.getSettings=function(){const u=A.apply(this,arguments);return i(u,"mozAutoGainControl","autoGainControl"),i(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){const A=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),i(u,"autoGainControl","mozAutoGainControl"),i(u,"noiseSuppression","mozNoiseSuppression")),A.apply(this,[u])}}}}function w5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _S(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const l=e.RTCPeerConnection.prototype[i],A={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=A[i]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,l,A]=arguments;return r.apply(this,[i||null]).then(u=>{if(t.version<53&&!l)try{u.forEach(m=>{m.type=s[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;u.forEach((f,b)=>{u.set(b,Object.assign({},f,{type:s[f.type]||f.type}))})}return u}).then(l,A)}}function _5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(i=>i._pc=this),r});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):pt.resolve(new Map)}}function y5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Jh(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function E5(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){xS("removeStream","removeTrack"),this.getSenders().forEach(s=>{var r;s.track&&et(r=t.getTracks()).call(r,s.track)&&this.removeTrack(s)})})}function C5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function S5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const r=s.length>0;r&&s.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(r){const{sender:l}=i,A=l.getParameters();(!("encodings"in A)||A.encodings.length===1&&Object.keys(A.encodings[0]).length===0)&&(A.encodings=s,l.sendEncodings=s,this.setParametersPromises.push(l.setParameters(A).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return i})}function N5(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const s=t.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function T5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function R5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var I5=Object.freeze({__proto__:null,shimAddTransceiver:S5,shimCreateAnswer:R5,shimCreateOffer:T5,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,pt.reject(r)}return s.video===!0?s.video={mediaSource:t}:s.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:N5,shimGetUserMedia:v5,shimOnTrack:w5,shimPeerConnection:_S,shimRTCDataChannel:C5,shimReceiverGetStats:y5,shimRemoveStream:E5,shimSenderGetStats:_5});function O5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var r;this._localStreams||(this._localStreams=[]),et(r=this._localStreams).call(r,s)||this._localStreams.push(s),s.getAudioTracks().forEach(i=>t.call(this,i,s)),s.getVideoTracks().forEach(i=>t.call(this,i,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i&&i.forEach(A=>{var u;this._localStreams?et(u=this._localStreams).call(u,A)||this._localStreams.push(A):this._localStreams=[A]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(t);if(s===-1)return;this._localStreams.splice(s,1);const r=t.getTracks();this.getSenders().forEach(i=>{et(r).call(r,i.track)&&this.removeTrack(i)})})}}function k5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),et(l=this._remoteStreams).call(l,i))return;this._remoteStreams.push(i);const A=new Event("addstream");A.stream=i,this.dispatchEvent(A)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(i)>=0)return;s._remoteStreams.push(i);const l=new Event("addstream");l.stream=i,s.dispatchEvent(l)})}),t.apply(s,arguments)}}}function D5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,s=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,l=t.setRemoteDescription,A=t.addIceCandidate;t.createOffer=function(m,f){const b=arguments.length>=2?arguments[2]:arguments[0],w=s.apply(this,[b]);return f?(w.then(m,f),pt.resolve()):w},t.createAnswer=function(m,f){const b=arguments.length>=2?arguments[2]:arguments[0],w=r.apply(this,[b]);return f?(w.then(m,f),pt.resolve()):w};let u=function(m,f,b){const w=i.apply(this,[m]);return b?(w.then(f,b),pt.resolve()):w};t.setLocalDescription=u,u=function(m,f,b){const w=l.apply(this,[m]);return b?(w.then(f,b),pt.resolve()):w},t.setRemoteDescription=u,u=function(m,f,b){const w=A.apply(this,[m]);return b?(w.then(f,b),pt.resolve()):w},t.addIceCandidate=u}function B5(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const s=t.mediaDevices,r=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=i=>r(L5(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(s,r,i){t.mediaDevices.getUserMedia(s).then(r,i)}).bind(t))}function L5(e){return e&&e.video!==void 0?Object.assign({},e,{video:o5(e.video)}):e}function j5(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(s,r){if(s&&s.iceServers){const i=[];for(let l=0;l<s.iceServers.length;l++){let A=s.iceServers[l];!A.hasOwnProperty("urls")&&A.hasOwnProperty("url")?(xS("RTCIceServer.url","RTCIceServer.urls"),A=JSON.parse(JSON.stringify(A)),A.urls=A.url,delete A.url,i.push(A)):i.push(s.iceServers[l])}s.iceServers=i}return new t(s,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function P5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U5(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const r=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):s.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function F5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var M5=Object.freeze({__proto__:null,shimAudioContext:F5,shimCallbacksAPI:D5,shimConstraints:L5,shimCreateOfferLegacy:U5,shimGetUserMedia:B5,shimLocalStreamsAPI:O5,shimRTCIceServerUrls:j5,shimRemoteStreamsAPI:k5,shimTrackEventTransceiver:P5}),V5=`	
\v\f\r \u2028\u2029\uFEFF`,eY=it,tY=si,yS=V5,Q5=I("".replace),sY=RegExp("^["+yS+"]+"),rY=RegExp("(^|[^"+yS+"])["+yS+"]+$"),nY=function(e){return function(t){var s=tY(eY(t));return 1&e&&(s=Q5(s,sY,"")),2&e&&(s=Q5(s,rY,"$1")),s}},iY={trim:nY(3)},aY=EI.PROPER,oY=p,H5=V5,cY=iY.trim;Is({target:"String",proto:!0,forced:function(e){return oY(function(){return!!H5[e]()||""[e]()!==""||aY&&H5[e].name!==e})}("trim")},{trim:function(){return cY(this)}});var lY=Ti("String","trim"),dY=O,AY=lY,ES=String.prototype,uY=function(e){var t=e.trim;return typeof e=="string"||e===ES||dY(ES,e)&&t===ES.trim?AY:t},ma=h(uY),G5={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(s){return s.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(s){const r=t.splitSections(s);return r&&r[0]},t.getMediaSections=function(s){const r=t.splitSections(s);return r.shift(),r},t.matchPrefix=function(s,r){return t.splitLines(s).filter(i=>i.indexOf(r)===0)},t.parseCandidate=function(s){let r;r=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":i.relatedAddress=r[l+1];break;case"rport":i.relatedPort=parseInt(r[l+1],10);break;case"tcptype":i.tcpType=r[l+1];break;case"ufrag":i.ufrag=r[l+1],i.usernameFragment=r[l+1];break;default:i[r[l]]===void 0&&(i[r[l]]=r[l+1])}return i},t.writeCandidate=function(s){const r=[];r.push(s.foundation);const i=s.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(s.protocol.toUpperCase()),r.push(s.priority),r.push(s.address||s.ip),r.push(s.port);const l=s.type;return r.push("typ"),r.push(l),l!=="host"&&s.relatedAddress&&s.relatedPort&&(r.push("raddr"),r.push(s.relatedAddress),r.push("rport"),r.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(r.push("ufrag"),r.push(s.usernameFragment||s.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let r=s.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(s){let r=s.payloadType;s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType);const i=s.channels||s.numChannels||1;return"a=rtpmap:"+r+" "+s.name+"/"+s.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(s){const r=s.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){const r={};let i;const l=s.substring(s.indexOf(" ")+1).split(";");for(let A=0;A<l.length;A++)i=l[A].trim().split("="),r[i[0].trim()]=i[1];return r},t.writeFmtp=function(s){let r="",i=s.payloadType;if(s.preferredPayloadType!==void 0&&(i=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const l=[];Object.keys(s.parameters).forEach(A=>{s.parameters[A]!==void 0?l.push(A+"="+s.parameters[A]):l.push(A)}),r+="a=fmtp:"+i+" "+l.join(";")+`\r
`}return r},t.parseRtcpFb=function(s){const r=s.substring(s.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(s){let r="",i=s.payloadType;return s.preferredPayloadType!==void 0&&(i=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+i+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(s){const r=s.indexOf(" "),i={ssrc:parseInt(s.substring(7,r),10)},l=s.indexOf(":",r);return l>-1?(i.attribute=s.substring(r+1,l),i.value=s.substring(l+1)):i.attribute=s.substring(r+1),i},t.parseSsrcGroup=function(s){const r=s.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},t.getMid=function(s){const r=t.matchPrefix(s,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(s){const r=s.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(s,r){return{role:"auto",fingerprints:t.matchPrefix(s+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,r){let i="a=setup:"+r+`\r
`;return s.fingerprints.forEach(l=>{i+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),i},t.parseCryptoLine=function(s){const r=s.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const r=s.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,r){return t.matchPrefix(s+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,r){const i=t.matchPrefix(s+r,"a=ice-ufrag:")[0],l=t.matchPrefix(s+r,"a=ice-pwd:")[0];return i&&l?{usernameFragment:i.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(s){let r="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(s){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(s)[0].split(" ");r.profile=i[2];for(let A=3;A<i.length;A++){const u=i[A],m=t.matchPrefix(s,"a=rtpmap:"+u+" ")[0];if(m){const f=t.parseRtpMap(m),b=t.matchPrefix(s,"a=fmtp:"+u+" ");switch(f.parameters=b.length?t.parseFmtp(b[0]):{},f.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(s,"a=extmap:").forEach(A=>{r.headerExtensions.push(t.parseExtmap(A))});const l=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(A=>{l.forEach(u=>{A.rtcpFeedback.find(m=>m.type===u.type&&m.parameter===u.parameter)||A.rtcpFeedback.push(u)})}),r},t.writeRtpDescription=function(s,r){let i="";i+="m="+s+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(A=>A.preferredPayloadType!==void 0?A.preferredPayloadType:A.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(A=>{i+=t.writeRtpMap(A),i+=t.writeFmtp(A),i+=t.writeRtcpFb(A)});let l=0;return r.codecs.forEach(A=>{A.maxptime>l&&(l=A.maxptime)}),l>0&&(i+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(A=>{i+=t.writeExtmap(A)}),i},t.parseRtpEncodingParameters=function(s){const r=[],i=t.parseRtpParameters(s),l=i.fecMechanisms.indexOf("RED")!==-1,A=i.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(s,"a=ssrc:").map(_=>t.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),m=u.length>0&&u[0].ssrc;let f;const b=t.matchPrefix(s,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(S=>parseInt(S,10)));b.length>0&&b[0].length>1&&b[0][0]===m&&(f=b[0][1]),i.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let S={ssrc:m,codecPayloadType:parseInt(_.parameters.apt,10)};m&&f&&(S.rtx={ssrc:f}),r.push(S),l&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:m,mechanism:A?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&m&&r.push({ssrc:m});let w=t.matchPrefix(s,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,r.forEach(_=>{_.maxBitrate=w})),r},t.parseRtcpParameters=function(s){const r={},i=t.matchPrefix(s,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const l=t.matchPrefix(s,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const A=t.matchPrefix(s,"a=rtcp-mux");return r.mux=A.length>0,r},t.writeRtcpParameters=function(s){let r="";return s.reducedSize&&(r+=`a=rtcp-rsize\r
`),s.mux&&(r+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(r+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),r},t.parseMsid=function(s){let r;const i=t.matchPrefix(s,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=t.matchPrefix(s,"a=ssrc:").map(A=>t.parseSsrcMedia(A)).filter(A=>A.attribute==="msid");return l.length>0?(r=l[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(s){const r=t.parseMLine(s),i=t.matchPrefix(s,"a=max-message-size:");let l;i.length>0&&(l=parseInt(i[0].substring(19),10)),isNaN(l)&&(l=65536);const A=t.matchPrefix(s,"a=sctp-port:");if(A.length>0)return{port:parseInt(A[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const u=t.matchPrefix(s,"a=sctpmap:");if(u.length>0){const m=u[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(s,r){let i=[];return i=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,r,i){let l;const A=r!==void 0?r:2;return l=s||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+l+" "+A+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,r){const i=t.splitLines(s);for(let l=0;l<i.length;l++)switch(i[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[l].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){const r=t.splitLines(s)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(s){const r=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const r=t.splitLines(s);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(G5);var K5=G5.exports,$m=h(K5),hY=c({__proto__:null,default:$m},[K5]);function Sv(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const r=new t(s),i=$m.parseCandidate(s.candidate),l=Object.assign(r,i);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(s)},e.RTCIceCandidate.prototype=t.prototype,Jh(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function CS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Jh(e,"icecandidate",t=>{if(t.candidate){const s=$m.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function Nv(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(u){if(!u||!u.sdp)return!1;const m=$m.splitSections(u.sdp);return m.shift(),m.some(f=>{const b=$m.parseMLine(f);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},r=function(u){const m=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const f=parseInt(m[1],10);return f!=f?-1:f},i=function(u){let m=65536;return t.browser==="firefox"&&(m=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(u,m){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const b=$m.matchPrefix(u.sdp,"a=max-message-size:");return b.length>0?f=parseInt(b[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(f=2147483637),f},A=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const u=r(arguments[0]),m=i(u),f=l(arguments[0],u);let b;b=m===0&&f===0?Number.POSITIVE_INFINITY:m===0||f===0?Math.max(m,f):Math.min(m,f);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>b}),this._sctp=w}return A.apply(this,arguments)}}function Tv(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,i){const l=r.send;r.send=function(){const A=arguments[0],u=A.length||A.size||A.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=s.apply(this,arguments);return t(r,this),r},Jh(e,"datachannel",r=>(t(r.channel,r.target),r))}function SS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const r=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const l=i.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const A=new Event("connectionstatechange",i);l.dispatchEvent(A)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function NS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(l=>ma(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return s.apply(this,arguments)}}function Rv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?pt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),pt.resolve())})}function Iv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return s.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?s.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>s.apply(this,[i]))})}var pY=Object.freeze({__proto__:null,removeExtmapAllowMixed:NS,shimAddIceCandidateNullOrEmpty:Rv,shimConnectionState:SS,shimMaxMessageSize:Nv,shimParameterlessSetLocalDescription:Iv,shimRTCIceCandidate:Sv,shimRTCIceCandidateRelayProtocol:CS,shimSendThrowTypeError:Tv});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=i5,r=function(l){const A={browser:null,version:null};if(l===void 0||!l.navigator)return A.browser="Not a browser.",A;const{navigator:u}=l;if(u.mozGetUserMedia)A.browser="firefox",A.version=Cv(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)A.browser="chrome",A.version=Cv(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return A.browser="Not a supported browser.",A;A.browser="safari",A.version=Cv(u.userAgent,/AppleWebKit\/(\d+)\./,1),A.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return A}(e),i={browserDetails:r,commonShim:pY,extractVersion:Cv,disableLog:$q,disableWarnings:Zq,sdp:hY};switch(r.browser){case"chrome":if(!x5||!wS||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),i;if(r.version===null)return s("Chrome shim can not determine version, not shimming."),i;s("adapter.js shimming chrome."),i.browserShim=x5,Rv(e,r),Iv(e),d5(e,r),A5(e),wS(e,r),u5(e),g5(e,r),h5(e),p5(e),m5(e),b5(e,r),Sv(e),CS(e),SS(e),Nv(e,r),Tv(e),NS(e,r);break;case"firefox":if(!I5||!_S||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),i;s("adapter.js shimming firefox."),i.browserShim=I5,Rv(e,r),Iv(e),v5(e,r),_S(e,r),w5(e),E5(e),_5(e),y5(e),C5(e),S5(e),N5(e),T5(e),R5(e),Sv(e),SS(e),Nv(e,r),Tv(e);break;case"safari":if(!M5||!t.shimSafari)return s("Safari shim is not included in this adapter release."),i;s("adapter.js shimming safari."),i.browserShim=M5,Rv(e,r),Iv(e),j5(e),U5(e),D5(e),O5(e),k5(e),P5(e),B5(e),F5(e),Sv(e),CS(e),Nv(e,r),Tv(e),NS(e,r);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var mY=p,W5=k.RegExp,fY=!mY(function(){var e=!0;try{W5(".","d")}catch{e=!1}var t={},s="",r=e?"dgimsy":"gimsy",i=function(u,m){Object.defineProperty(t,u,{get:function(){return s+=m,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var A in e&&(l.hasIndices="d"),l)i(A,l[A]);return Object.getOwnPropertyDescriptor(W5.prototype,"flags").get.call(t)!==r||s!==r}),gY=hi,bY=Ne,xY=Kn,vY=O,z5={correct:fY},wY=function(){var e=gY(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},_Y=RegExp.prototype,TS=z5.correct?function(e){return e.flags}:function(e){return z5.correct||!vY(_Y,e)||xY(e,"flags")?e.flags:bY(wY,e)},RS=I,yY=Math.floor,IS=RS("".charAt),EY=RS("".replace),OS=RS("".slice),CY=/\$([$&'`]|\d{1,2})/g,SY=Is,NY=Ne,kS=I,q5=it,TY=z,RY=Je,IY=cc,Zm=si,OY=Jt,kY=TS,DY=function(e,t,s,r,i,l){var A=s+e.length,u=r.length,m=CY;return EY(l,m,function(f,b){var w;switch(IS(b,0)){case"$":return"$";case"&":return e;case"`":return OS(t,0,s);case"'":return OS(t,A);case"<":w=i[OS(b,1,-1)];break;default:var _=+b;if(_===0)return f;if(_>u){var S=yY(_/10);return S===0?f:S<=u?r[S-1]===void 0?IS(b,1):r[S-1]+IS(b,1):f}w=r[_-1]}return w===void 0?"":w})},BY=Hr("replace"),LY=TypeError,DS=kS("".indexOf),jY=kS("".replace),Y5=kS("".slice),PY=Math.max;SY({target:"String",proto:!0},{replaceAll:function(e,t){var s,r,i,l,A,u,m,f,b,w,_=q5(this),S=0,F="";if(RY(e)){if((s=IY(e))&&(r=Zm(q5(kY(e))),!~DS(r,"g")))throw new LY("`.replaceAll` does not allow non-global regexes");if(i=OY(e,BY))return NY(i,e,_,t);if(s)return jY(Zm(_),e,t)}for(l=Zm(_),A=Zm(e),(u=TY(t))||(t=Zm(t)),m=A.length,f=PY(1,m),b=DS(l,A);b!==-1;)w=u?Zm(t(A,b,l)):DY(A,l,b,[],void 0,t),F+=Y5(l,S,b)+w,S=b+m,b=b+f>l.length?-1:DS(l,A,b+f);return S<l.length&&(F+=Y5(l,S)),F}});var UY=Ti("String","replaceAll"),FY=O,MY=UY,BS=String.prototype,VY=function(e){var t=e.replaceAll;return typeof e=="string"||e===BS||FY(BS,e)&&t===BS.replaceAll?MY:t},QY=h(VY),LS=k;Is({global:!0,forced:LS.globalThis!==LS},{globalThis:LS});var X5=h(k),jS={exports:{}};(function(e,t){(function(s,r){var i="function",l="undefined",A="object",u="string",m="major",f="model",b="name",w="type",_="vendor",S="version",F="architecture",B="console",j="mobile",K="tablet",X="smarttv",oe="wearable",xe="embedded",Ee="Amazon",me="Apple",Re="ASUS",He="BlackBerry",Xe="Browser",_t="Chrome",ns="Firefox",es="Google",vs="Honor",ps="Huawei",tr="LG",Fr="Microsoft",We="Motorola",ct="Nvidia",Rt="OnePlus",Ye="Opera",D="OPPO",ae="Samsung",be="Sharp",nt="Sony",ls="Xiaomi",Tr="Zebra",Zn="Facebook",Cc="Chromium OS",Gu="Mac OS",I_=" Browser",Yf=function(Nn){for(var Un={},Lr=0;Lr<Nn.length;Lr++)Un[Nn[Lr].toUpperCase()]=Nn[Lr];return Un},O_=function(Nn,Un){return typeof Nn===u&&Bp(Un).indexOf(Bp(Nn))!==-1},Bp=function(Nn){return Nn.toLowerCase()},Sb=function(Nn,Un){if(typeof Nn===u)return Nn=Nn.replace(/^\s\s*/,""),typeof Un===l?Nn:Nn.substring(0,500)},Lp=function(Nn,Un){for(var Lr,to,Xl,un,BA,Xs,Jl=0;Jl<Un.length&&!BA;){var jp=Un[Jl],Qd=Un[Jl+1];for(Lr=to=0;Lr<jp.length&&!BA&&jp[Lr];)if(BA=jp[Lr++].exec(Nn))for(Xl=0;Xl<Qd.length;Xl++)Xs=BA[++to],typeof(un=Qd[Xl])===A&&un.length>0?un.length===2?typeof un[1]==i?this[un[0]]=un[1].call(this,Xs):this[un[0]]=un[1]:un.length===3?typeof un[1]!==i||un[1].exec&&un[1].test?this[un[0]]=Xs?Xs.replace(un[1],un[2]):r:this[un[0]]=Xs?un[1].call(this,Xs,un[2]):r:un.length===4&&(this[un[0]]=Xs?un[3].call(this,Xs.replace(un[1],un[2])):r):this[un]=Xs||r;Jl+=2}},Ku=function(Nn,Un){for(var Lr in Un)if(typeof Un[Lr]===A&&Un[Lr].length>0){for(var to=0;to<Un[Lr].length;to++)if(O_(Un[Lr][to],Nn))return Lr==="?"?r:Lr}else if(O_(Un[Lr],Nn))return Lr==="?"?r:Lr;return Un.hasOwnProperty("*")?Un["*"]:Nn},F3={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},M3={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,S],[/opios[\/ ]+([\w\.]+)/i],[S,[b,Ye+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[b,Ye+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[b,Ye]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[b,"UC"+Xe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[b,"Smart Lenovo "+Xe]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+Xe],S],[/\bfocus\/([\w\.]+)/i],[S,[b,ns+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[b,Ye+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[b,Ye+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[b,"MIUI"+I_]],[/fxios\/([\w\.-]+)/i],[S,[b,ns]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+I_],S],[/samsungbrowser\/([\w\.]+)/i],[S,[b,ae+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,Zn],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[b,_t+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,_t+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[b,"Android "+Xe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[S,Ku,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[b,ns+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[b,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[S,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[F,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[F,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[F,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[F,/ower/,"",Bp]],[/ sun4\w[;\)]/i],[[F,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[F,Bp]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[_,ae],[w,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[_,ae],[w,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[_,me],[w,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[_,me],[w,K]],[/(macintosh);/i],[f,[_,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[_,be],[w,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[f,[_,vs],[w,K]],[/honor([-\w ]+)[;\)]/i],[f,[_,vs],[w,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[f,[_,ps],[w,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[_,ps],[w,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[f,/_/g," "],[_,ls],[w,K]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[f,/_/g," "],[_,ls],[w,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[_,D],[w,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[f,[_,Ku,{OnePlus:["304","403","203"],"*":D}],[w,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[_,"Vivo"],[w,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[_,"Realme"],[w,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[_,We],[w,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[_,We],[w,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[_,tr],[w,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[_,tr],[w,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[f,[_,"Lenovo"],[w,K]],[/(nokia) (t[12][01])/i],[_,f,[w,K]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[f,/_/g," "],[w,j],[_,"Nokia"]],[/(pixel (c|tablet))\b/i],[f,[_,es],[w,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[_,es],[w,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[_,nt],[w,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[_,nt],[w,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[_,Rt],[w,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[_,Ee],[w,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[_,Ee],[w,j]],[/(playbook);[-\w\),; ]+(rim)/i],[f,_,[w,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[_,He],[w,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[_,Re],[w,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[_,Re],[w,j]],[/(nexus 9)/i],[f,[_,"HTC"],[w,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[f,/_/g," "],[w,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[_,"TCL"],[w,K]],[/(itel) ((\w+))/i],[[_,Bp],f,[w,Ku,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[_,"Acer"],[w,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[_,"Meizu"],[w,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[_,"Ulefone"],[w,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[_,"Energizer"],[w,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[_,"Cat"],[w,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[_,"Smartfren"],[w,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[_,"Nothing"],[w,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[f,[_,"Archos"],[w,K]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[f,[_,"Archos"],[w,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[_,f,[w,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[_,f,[w,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,f,[w,K]],[/(surface duo)/i],[f,[_,Fr],[w,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[_,"Fairphone"],[w,j]],[/(u304aa)/i],[f,[_,"AT&T"],[w,j]],[/\bsie-(\w*)/i],[f,[_,"Siemens"],[w,j]],[/\b(rct\w+) b/i],[f,[_,"RCA"],[w,K]],[/\b(venue[\d ]{2,7}) b/i],[f,[_,"Dell"],[w,K]],[/\b(q(?:mv|ta)\w+) b/i],[f,[_,"Verizon"],[w,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[_,"Barnes & Noble"],[w,K]],[/\b(tm\d{3}\w+) b/i],[f,[_,"NuVision"],[w,K]],[/\b(k88) b/i],[f,[_,"ZTE"],[w,K]],[/\b(nx\d{3}j) b/i],[f,[_,"ZTE"],[w,j]],[/\b(gen\d{3}) b.+49h/i],[f,[_,"Swiss"],[w,j]],[/\b(zur\d{3}) b/i],[f,[_,"Swiss"],[w,K]],[/\b((zeki)?tb.*\b) b/i],[f,[_,"Zeki"],[w,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],f,[w,K]],[/\b(ns-?\w{0,9}) b/i],[f,[_,"Insignia"],[w,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[_,"NextBook"],[w,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],f,[w,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],f,[w,j]],[/\b(ph-1) /i],[f,[_,"Essential"],[w,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[_,"Envizen"],[w,K]],[/\b(trio[-\w\. ]+) b/i],[f,[_,"MachSpeed"],[w,K]],[/\btu_(1491) b/i],[f,[_,"Rotor"],[w,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[f,[_,ct],[w,K]],[/(sprint) (\w+)/i],[_,f,[w,j]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[_,Fr],[w,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[_,Tr],[w,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[_,Tr],[w,j]],[/smart-tv.+(samsung)/i],[_,[w,X]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[_,ae],[w,X]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,tr],[w,X]],[/(apple) ?tv/i],[_,[f,me+" TV"],[w,X]],[/crkey/i],[[f,_t+"cast"],[_,es],[w,X]],[/droid.+aft(\w+)( bui|\))/i],[f,[_,Ee],[w,X]],[/(shield \w+ tv)/i],[f,[_,ct],[w,X]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[_,be],[w,X]],[/(bravia[\w ]+)( bui|\))/i],[f,[_,nt],[w,X]],[/(mi(tv|box)-?\w+) bui/i],[f,[_,ls],[w,X]],[/Hbbtv.*(technisat) (.*);/i],[_,f,[w,X]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,Sb],[f,Sb],[w,X]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[f,[w,X]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,X]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,f,[w,B]],[/droid.+; (shield)( bui|\))/i],[f,[_,ct],[w,B]],[/(playstation \w+)/i],[f,[_,nt],[w,B]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[_,Fr],[w,B]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[f,[_,ae],[w,oe]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[_,f,[w,oe]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[f,[_,D],[w,oe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[_,me],[w,oe]],[/(opwwe\d{3})/i],[f,[_,Rt],[w,oe]],[/(moto 360)/i],[f,[_,We],[w,oe]],[/(smartwatch 3)/i],[f,[_,nt],[w,oe]],[/(g watch r)/i],[f,[_,tr],[w,oe]],[/droid.+; (wt63?0{2,3})\)/i],[f,[_,Tr],[w,oe]],[/droid.+; (glass) \d/i],[f,[_,es],[w,oe]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,f,[w,oe]],[/; (quest( \d| pro)?)/i],[f,[_,Zn],[w,oe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[w,xe]],[/(aeobc)\b/i],[f,[_,Ee],[w,xe]],[/(homepod).+mac os/i],[f,[_,me],[w,xe]],[/windows iot/i],[[w,xe]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[w,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[w,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[f,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[b,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[b,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,S],[/ladybird\//i],[[b,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,S],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[b,[S,Ku,F3]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,Ku,F3],[b,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,Gu],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,b],[/(ubuntu) ([\w\.]+) like android/i],[[b,/(.+)/,"$1 Touch"],S],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[b,S],[/\(bb(10);/i],[S,[b,He]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[S,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[b,ns+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[b,_t+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,Cc],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,S],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,S]]},Yl=function(Nn,Un){if(typeof Nn===A&&(Un=Nn,Nn=r),!(this instanceof Yl))return new Yl(Nn,Un).getResult();var Lr=typeof s!==l&&s.navigator?s.navigator:r,to=Nn||(Lr&&Lr.userAgent?Lr.userAgent:""),Xl=Lr&&Lr.userAgentData?Lr.userAgentData:r,un=Un?function(Xs,Jl){var jp={};for(var Qd in Xs)Jl[Qd]&&Jl[Qd].length%2==0?jp[Qd]=Jl[Qd].concat(Xs[Qd]):jp[Qd]=Xs[Qd];return jp}(M3,Un):M3,BA=Lr&&Lr.userAgent==to;return this.getBrowser=function(){var Xs={};return Xs[b]=r,Xs[S]=r,Lp.call(Xs,to,un.browser),Xs[m]=function(Jl){return typeof Jl===u?Jl.replace(/[^\d\.]/g,"").split(".")[0]:r}(Xs[S]),BA&&Lr&&Lr.brave&&typeof Lr.brave.isBrave==i&&(Xs[b]="Brave"),Xs},this.getCPU=function(){var Xs={};return Xs[F]=r,Lp.call(Xs,to,un.cpu),Xs},this.getDevice=function(){var Xs={};return Xs[_]=r,Xs[f]=r,Xs[w]=r,Lp.call(Xs,to,un.device),BA&&!Xs[w]&&Xl&&Xl.mobile&&(Xs[w]=j),BA&&Xs[f]=="Macintosh"&&Lr&&typeof Lr.standalone!==l&&Lr.maxTouchPoints&&Lr.maxTouchPoints>2&&(Xs[f]="iPad",Xs[w]=K),Xs},this.getEngine=function(){var Xs={};return Xs[b]=r,Xs[S]=r,Lp.call(Xs,to,un.engine),Xs},this.getOS=function(){var Xs={};return Xs[b]=r,Xs[S]=r,Lp.call(Xs,to,un.os),BA&&!Xs[b]&&Xl&&Xl.platform&&Xl.platform!="Unknown"&&(Xs[b]=Xl.platform.replace(/chrome os/i,Cc).replace(/macos/i,Gu)),Xs},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return to},this.setUA=function(Xs){return to=typeof Xs===u&&Xs.length>500?Sb(Xs,500):Xs,this},this.setUA(to),this};Yl.VERSION="0.7.41",Yl.BROWSER=Yf([b,S,m]),Yl.CPU=Yf([F]),Yl.DEVICE=Yf([f,_,w,B,j,X,K,oe,xe]),Yl.ENGINE=Yl.OS=Yf([b,S]),e.exports&&(t=e.exports=Yl),t.UAParser=Yl;var Xf=typeof s!==l&&(s.jQuery||s.Zepto);if(Xf&&!Xf.ua){var k_=new Yl;Xf.ua=k_.getResult(),Xf.ua.get=function(){return k_.getUA()},Xf.ua.set=function(Nn){k_.setUA(Nn);var Un=k_.getResult();for(var Lr in Un)Xf.ua[Lr]=Un[Lr]}}})(typeof window=="object"?window:d)})(jS,jS.exports);var HY=h(jS.exports),J5=rv.clear;Is({global:!0,bind:!0,forced:k.clearImmediate!==J5},{clearImmediate:J5});var $5=k,GY=re,KY=z,WY=Au,zY=ht,qY=bu,YY=Kh,XY=$5.Function,JY=/MSIE .\./.test(zY)||WY==="BUN"&&function(){var e=$5.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),$Y=Is,Z5=k,eD=rv.set,ZY=function(e,t){var s=1;return JY?function(r,i){var l=YY(arguments.length,1)>s,A=KY(r)?r:XY(r),u=l?qY(arguments,s):[],m=l?function(){GY(A,this,u)}:A;return e(m)}:e},tD=Z5.setImmediate?ZY(eD):eD;$Y({global:!0,bind:!0,forced:Z5.setImmediate!==tD},{setImmediate:tD});var sD=h($e.setImmediate),eX=k,tX=lO,sX=pn,rX=Kh,nX=se;Is({global:!0,dontCallGetSet:!0,forced:p(function(){return nX&&Object.getOwnPropertyDescriptor(eX,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){rX(arguments.length,1),tX(sX(e))}});var rD=h($e.queueMicrotask);function nD(e,t){return function(){return e.apply(t,arguments)}}const{toString:iX}=Object.prototype,{getPrototypeOf:PS}=Object,{iterator:Ov,toStringTag:iD}=Symbol,kv=(US=Object.create(null),e=>{const t=iX.call(e);return US[t]||(US[t]=t.slice(8,-1).toLowerCase())});var US;const Ol=e=>(e=e.toLowerCase(),t=>kv(t)===e),Dv=e=>t=>typeof t===e,{isArray:ef}=Array,tf=Dv("undefined");function E0(e){return e!==null&&!tf(e)&&e.constructor!==null&&!tf(e.constructor)&&Uo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const aD=Ol("ArrayBuffer"),aX=Dv("string"),Uo=Dv("function"),oD=Dv("number"),C0=e=>e!==null&&typeof e=="object",Bv=e=>{if(kv(e)!=="object")return!1;const t=PS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||iD in e||Ov in e)},oX=Ol("Date"),cX=Ol("File"),lX=Ol("Blob"),dX=Ol("FileList"),AX=Ol("URLSearchParams"),[uX,hX,pX,mX]=["ReadableStream","Request","Response","Headers"].map(Ol);function S0(e,t){let s,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),ef(e))for(s=0,r=e.length;s<r;s++)t.call(null,e[s],s,e);else{if(E0(e))return;const l=i?Object.getOwnPropertyNames(e):Object.keys(e),A=l.length;let u;for(s=0;s<A;s++)u=l[s],t.call(null,e[u],u,e)}}function cD(e,t){if(E0(e))return null;t=t.toLowerCase();const s=Object.keys(e);let r,i=s.length;for(;i-- >0;)if(r=s[i],t===r.toLowerCase())return r;return null}const $h=X5!==void 0?X5:typeof self<"u"?self:typeof window<"u"?window:D_,lD=e=>!tf(e)&&e!==$h,fX=(FS=typeof Uint8Array<"u"&&PS(Uint8Array),e=>FS&&e instanceof FS);var FS;const gX=Ol("HTMLFormElement"),dD=(e=>{let{hasOwnProperty:t}=e;return(s,r)=>t.call(s,r)})(Object.prototype),bX=Ol("RegExp"),AD=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),r={};S0(s,(i,l)=>{let A;(A=t(i,l,e))!==!1&&(r[l]=A||i)}),Object.defineProperties(e,r)},xX=Ol("AsyncFunction"),uD=(hD=typeof sD=="function",pD=Uo($h.postMessage),hD?sD:pD?(MS="axios@".concat(Math.random()),Lv=[],$h.addEventListener("message",e=>{let{source:t,data:s}=e;t===$h&&s===MS&&Lv.length&&Lv.shift()()},!1),e=>{Lv.push(e),$h.postMessage(MS,"*")}):e=>setTimeout(e));var hD,pD,MS,Lv;const vX=rD!==void 0?rD.bind($h):typeof process<"u"&&process.nextTick||uD;var gt={isArray:ef,isArrayBuffer:aD,isBuffer:E0,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Uo(e.append)&&((t=kv(e))==="formdata"||t==="object"&&Uo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&aD(e.buffer),t},isString:aX,isNumber:oD,isBoolean:e=>e===!0||e===!1,isObject:C0,isPlainObject:Bv,isEmptyObject:e=>{if(!C0(e)||E0(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:uX,isRequest:hX,isResponse:pX,isHeaders:mX,isUndefined:tf,isDate:oX,isFile:cX,isBlob:lX,isRegExp:bX,isFunction:Uo,isStream:e=>C0(e)&&Uo(e.pipe),isURLSearchParams:AX,isTypedArray:fX,isFileList:dX,forEach:S0,merge:function e(){const{caseless:t,skipUndefined:s}=lD(this)&&this||{},r={},i=(l,A)=>{const u=t&&cD(r,A)||A;Bv(r[u])&&Bv(l)?r[u]=e(r[u],l):Bv(l)?r[u]=e({},l):ef(l)?r[u]=l.slice():s&&tf(l)||(r[u]=l)};for(let l=0,A=arguments.length;l<A;l++)arguments[l]&&S0(arguments[l],i);return r},extend:function(e,t,s){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return S0(t,(i,l)=>{s&&Uo(i)?e[l]=nD(i,s):e[l]=i},{allOwnKeys:r}),e},trim:e=>ma(e)?ma(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,s,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,r)=>{let i,l,A;const u={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),l=i.length;l-- >0;)A=i[l],r&&!r(A,e,t)||u[A]||(t[A]=e[A],u[A]=!0);e=s!==!1&&PS(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:kv,kindOfTest:Ol,endsWith:(e,t,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=t.length;const r=e.indexOf(t,s);return r!==-1&&r===s},toArray:e=>{if(!e)return null;if(ef(e))return e;let t=e.length;if(!oD(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[Ov]).call(e);let r;for(;(r=s.next())&&!r.done;){const i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let s;const r=[];for(;(s=e.exec(t))!==null;)r.push(s);return r},isHTMLForm:gX,hasOwnProperty:dD,hasOwnProp:dD,reduceDescriptors:AD,freezeMethods:e=>{AD(e,(t,s)=>{if(Uo(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=e[s];Uo(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},r=i=>{i.forEach(l=>{s[l]=!0})};return ef(e)?r(e):r(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,r){return s.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:cD,global:$h,isContextDefined:lD,isSpecCompliantForm:function(e){return!!(e&&Uo(e.append)&&e[iD]==="FormData"&&e[Ov])},toJSONObject:e=>{const t=new Array(10),s=(r,i)=>{if(C0(r)){if(t.indexOf(r)>=0)return;if(E0(r))return r;if(!("toJSON"in r)){t[i]=r;const l=ef(r)?[]:{};return S0(r,(A,u)=>{const m=s(A,i+1);!tf(m)&&(l[u]=m)}),t[i]=void 0,l}}return r};return s(e,0)},isAsyncFn:xX,isThenable:e=>e&&(C0(e)||Uo(e))&&Uo(e.then)&&Uo(e.catch),setImmediate:uD,asap:vX,isIterable:e=>e!=null&&Uo(e[Ov])};function wr(e,t,s,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}gt.inherits(wr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:gt.toJSONObject(this.config),code:this.code,status:this.status}}});const mD=wr.prototype,fD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{fD[e]={value:e}}),Object.defineProperties(wr,fD),Object.defineProperty(mD,"isAxiosError",{value:!0}),wr.from=(e,t,s,r,i,l)=>{const A=Object.create(mD);gt.toFlatObject(e,A,function(f){return f!==Error.prototype},f=>f!=="isAxiosError");const u=e&&e.message?e.message:"Error",m=t==null&&e?e.code:t;return wr.call(A,u,m,s,r,i),e&&A.cause==null&&Object.defineProperty(A,"cause",{value:e,configurable:!0}),A.name=e&&e.name||"Error",l&&Object.assign(A,l),A};function VS(e){return gt.isPlainObject(e)||gt.isArray(e)}function gD(e){return gt.endsWith(e,"[]")?e.slice(0,-2):e}function bD(e,t,s){return e?e.concat(t).map(function(r,i){return r=gD(r),!s&&i?"["+r+"]":r}).join(s?".":""):t}const wX=gt.toFlatObject(gt,{},null,function(e){return/^is[A-Z]/.test(e)});function jv(e,t,s){if(!gt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(s=gt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,S){return!gt.isUndefined(S[_])})).metaTokens,i=s.visitor||f,l=s.dots,A=s.indexes,u=(s.Blob||typeof Blob<"u"&&Blob)&&gt.isSpecCompliantForm(t);if(!gt.isFunction(i))throw new TypeError("visitor must be a function");function m(_){if(_===null)return"";if(gt.isDate(_))return _.toISOString();if(gt.isBoolean(_))return _.toString();if(!u&&gt.isBlob(_))throw new wr("Blob is not supported. Use a Buffer instead.");return gt.isArrayBuffer(_)||gt.isTypedArray(_)?u&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function f(_,S,F){let B=_;if(_&&!F&&typeof _=="object"){if(gt.endsWith(S,"{}"))S=r?S:S.slice(0,-2),_=JSON.stringify(_);else if(gt.isArray(_)&&function(j){return gt.isArray(j)&&!j.some(VS)}(_)||(gt.isFileList(_)||gt.endsWith(S,"[]"))&&(B=gt.toArray(_)))return S=gD(S),B.forEach(function(j,K){!gt.isUndefined(j)&&j!==null&&t.append(A===!0?bD([S],K,l):A===null?S:S+"[]",m(j))}),!1}return!!VS(_)||(t.append(bD(F,S,l),m(_)),!1)}const b=[],w=Object.assign(wX,{defaultVisitor:f,convertValue:m,isVisitable:VS});if(!gt.isObject(e))throw new TypeError("data must be an object");return function _(S,F){if(!gt.isUndefined(S)){if(b.indexOf(S)!==-1)throw Error("Circular reference detected in "+F.join("."));b.push(S),gt.forEach(S,function(B,j){(!(gt.isUndefined(B)||B===null)&&i.call(t,B,gt.isString(j)?ma(j).call(j):j,F,w))===!0&&_(B,F?F.concat(j):[j])}),b.pop()}}(e),t}function xD(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function QS(e,t){this._pairs=[],e&&jv(e,this,t)}const vD=QS.prototype;function _X(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function wD(e,t,s){if(!t)return e;const r=s&&s.encode||_X;gt.isFunction(s)&&(s={serialize:s});const i=s&&s.serialize;let l;if(l=i?i(t,s):gt.isURLSearchParams(t)?t.toString():new QS(t,s).toString(r),l){const A=e.indexOf("#");A!==-1&&(e=e.slice(0,A)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}vD.append=function(e,t){this._pairs.push([e,t])},vD.toString=function(e){const t=e?function(s){return e.call(this,s,xD)}:xD;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};var _D=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){gt.forEach(this.handlers,function(t){t!==null&&e(t)})}},yD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ED={exports:{}},yX=Is,EX=se,CD=Na.f;yX({target:"Object",stat:!0,forced:Object.defineProperty!==CD,sham:!EX},{defineProperty:CD});var SD=$e.Object,CX=ED.exports=function(e,t,s){return SD.defineProperty(e,t,s)};SD.defineProperty.sham&&(CX.sham=!0);var ND=h(ED.exports),SX=TypeError,TD=hA,NX=sv,TX=Je,RX=Hr("species"),RD=Array,IX=function(e){var t;return TD(e)&&(t=e.constructor,(NX(t)&&(t===RD||TD(t.prototype))||TX(t)&&(t=t[RX])===null)&&(t=void 0)),t===void 0?RD:t},ID=function(e,t){return new(IX(e))(t===0?0:t)},OX=p,kX=cs,DX=Hr("species"),OD=function(e){return kX>=51||!OX(function(){var t=[];return(t.constructor={})[DX]=function(){return{foo:1}},t[e](Boolean).foo!==1})},BX=Is,LX=p,jX=hA,PX=Je,UX=Ro,FX=Do,kD=function(e){if(e>9007199254740991)throw SX("Maximum allowed index exceeded");return e},DD=JC,MX=ID,VX=OD,QX=cs,BD=Hr("isConcatSpreadable"),HX=QX>=51||!LX(function(){var e=[];return e[BD]=!1,e.concat()[0]!==e}),GX=function(e){if(!PX(e))return!1;var t=e[BD];return t!==void 0?!!t:jX(e)};BX({target:"Array",proto:!0,forced:!HX||!VX("concat")},{concat:function(e){var t,s,r,i,l,A=UX(this),u=MX(A,0),m=0;for(t=-1,r=arguments.length;t<r;t++)if(GX(l=t===-1?A:arguments[t]))for(i=FX(l),kD(m+i),s=0;s<i;s++,m++)s in l&&DD(u,m,l[s]);else kD(m+1),DD(u,m++,l);return u.length=m,u}});var LD={},KX=we,WX=xt,jD=pA.f,zX=bu,PD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];LD.f=function(e){return PD&&KX(e)==="Window"?function(t){try{return jD(t)}catch{return zX(PD)}}(e):jD(WX(e))};var sf={},qX=Hr;sf.f=qX;var UD=$e,YX=Kn,XX=sf,JX=Na.f,gi=function(e){var t=UD.Symbol||(UD.Symbol={});YX(t,e)||JX(t,e,{value:XX.f(e)})},$X=Ne,ZX=mt,eJ=Hr,tJ=gu,FD=function(){var e=ZX("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,r=eJ("toPrimitive");t&&!t[r]&&tJ(t,r,function(i){return $X(s,this)},{})},sJ=Oo,rJ=ot,nJ=Ro,iJ=Do,aJ=ID,MD=I([].push),oJ=function(e){var t=e===1,s=e===2,r=e===3,i=e===4,l=e===6,A=e===7,u=e===5||l;return function(m,f,b,w){for(var _,S,F=nJ(m),B=rJ(F),j=iJ(B),K=sJ(f,b),X=0,oe=w||aJ,xe=t?oe(m,j):s||A?oe(m,0):void 0;j>X;X++)if((u||X in B)&&(S=K(_=B[X],X,F),e))if(t)xe[X]=S;else if(S)switch(e){case 3:return!0;case 5:return _;case 6:return X;case 2:MD(xe,_)}else switch(e){case 4:return!1;case 7:MD(xe,_)}return l?-1:r||i?i:xe}},VD={forEach:oJ(0)},Pv=Is,N0=k,HS=Ne,cJ=I,rf=se,nf=Gs,lJ=p,fa=Kn,dJ=O,GS=hi,Uv=xt,KS=su,AJ=si,WS=ue,af=Dn,QD=Se,uJ=pA,HD=LD,hJ=Uh,GD=te,KD=Na,pJ=pe,WD=Z,zD=gu,mJ=tv,zS=ic,qD=mA,YD=ZA,fJ=Hr,gJ=sf,bJ=gi,xJ=FD,vJ=vA,XD=Gh,Fv=VD.forEach,Fo=Nm("hidden"),Mv="Symbol",T0="prototype",wJ=XD.set,JD=XD.getterFor(Mv),kl=Object[T0],Zh=N0.Symbol,Vv=Zh&&Zh[T0],_J=N0.RangeError,yJ=N0.TypeError,qS=N0.QObject,$D=GD.f,ep=KD.f,ZD=HD.f,EJ=WD.f,eB=cJ([].push),yA=zS("symbols"),R0=zS("op-symbols"),CJ=zS("wks"),YS=!qS||!qS[T0]||!qS[T0].findChild,tB=function(e,t,s){var r=$D(kl,t);r&&delete kl[t],ep(e,t,s),r&&e!==kl&&ep(kl,t,r)},XS=rf&&lJ(function(){return af(ep({},"a",{get:function(){return ep(this,"a",{value:7}).a}})).a!==7})?tB:ep,JS=function(e,t){var s=yA[e]=af(Vv);return wJ(s,{type:Mv,tag:e,description:t}),rf||(s.description=t),s},Qv=function(e,t,s){e===kl&&Qv(R0,t,s),GS(e);var r=KS(t);return GS(s),fa(yA,r)?(s.enumerable?(fa(e,Fo)&&e[Fo][r]&&(e[Fo][r]=!1),s=af(s,{enumerable:WS(0,!1)})):(fa(e,Fo)||ep(e,Fo,WS(1,af(null))),e[Fo][r]=!0),XS(e,r,s)):ep(e,r,s)},$S=function(e,t){GS(e);var s=Uv(t),r=QD(s).concat(iB(s));return Fv(r,function(i){rf&&!HS(sB,s,i)||Qv(e,i,s[i])}),e},sB=function(e){var t=KS(e),s=HS(EJ,this,t);return!(this===kl&&fa(yA,t)&&!fa(R0,t))&&(!(s||!fa(this,t)||!fa(yA,t)||fa(this,Fo)&&this[Fo][t])||s)},rB=function(e,t){var s=Uv(e),r=KS(t);if(s!==kl||!fa(yA,r)||fa(R0,r)){var i=$D(s,r);return!i||!fa(yA,r)||fa(s,Fo)&&s[Fo][r]||(i.enumerable=!0),i}},nB=function(e){var t=ZD(Uv(e)),s=[];return Fv(t,function(r){fa(yA,r)||fa(qD,r)||eB(s,r)}),s},iB=function(e){var t=e===kl,s=ZD(t?R0:Uv(e)),r=[];return Fv(s,function(i){!fa(yA,i)||t&&!fa(kl,i)||eB(r,yA[i])}),r};nf||(Zh=function(){if(dJ(Vv,this))throw new yJ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?AJ(arguments[0]):void 0,t=YD(e),s=function(r){var i=this===void 0?N0:this;i===kl&&HS(s,R0,r),fa(i,Fo)&&fa(i[Fo],t)&&(i[Fo][t]=!1);var l=WS(1,r);try{XS(i,t,l)}catch(A){if(!(A instanceof _J))throw A;tB(i,t,l)}};return rf&&YS&&XS(kl,t,{configurable:!0,set:s}),JS(t,e)},zD(Vv=Zh[T0],"toString",function(){return JD(this).tag}),zD(Zh,"withoutSetter",function(e){return JS(YD(e),e)}),WD.f=sB,KD.f=Qv,pJ.f=$S,GD.f=rB,uJ.f=HD.f=nB,hJ.f=iB,gJ.f=function(e){return JS(fJ(e),e)},rf&&mJ(Vv,"description",{configurable:!0,get:function(){return JD(this).description}})),Pv({global:!0,wrap:!0,forced:!nf,sham:!nf},{Symbol:Zh}),Fv(QD(CJ),function(e){bJ(e)}),Pv({target:Mv,stat:!0,forced:!nf},{useSetter:function(){YS=!0},useSimple:function(){YS=!1}}),Pv({target:"Object",stat:!0,forced:!nf,sham:!rf},{create:function(e,t){return t===void 0?af(e):$S(af(e),t)},defineProperty:Qv,defineProperties:$S,getOwnPropertyDescriptor:rB}),Pv({target:"Object",stat:!0,forced:!nf},{getOwnPropertyNames:nB}),xJ(),vJ(Zh,Mv),qD[Fo]=!0;var aB=Gs&&!!Symbol.for&&!!Symbol.keyFor,SJ=Is,NJ=mt,TJ=Kn,RJ=si,oB=ic,IJ=aB,ZS=oB("string-to-symbol-registry"),OJ=oB("symbol-to-string-registry");SJ({target:"Symbol",stat:!0,forced:!IJ},{for:function(e){var t=RJ(e);if(TJ(ZS,t))return ZS[t];var s=NJ("Symbol")(t);return ZS[t]=s,OJ[s]=t,s}});var kJ=Is,DJ=Kn,BJ=Ws,LJ=qr,jJ=aB,cB=ic("symbol-to-string-registry");kJ({target:"Symbol",stat:!0,forced:!jJ},{keyFor:function(e){if(!BJ(e))throw new TypeError(LJ(e)+" is not a symbol");if(DJ(cB,e))return cB[e]}});var lB=hA,PJ=z,dB=we,UJ=si,AB=I([].push),FJ=Is,uB=mt,hB=re,MJ=Ne,I0=I,pB=p,mB=z,fB=Ws,gB=bu,VJ=function(e){if(PJ(e))return e;if(lB(e)){for(var t=e.length,s=[],r=0;r<t;r++){var i=e[r];typeof i=="string"?AB(s,i):typeof i!="number"&&dB(i)!=="Number"&&dB(i)!=="String"||AB(s,UJ(i))}var l=s.length,A=!0;return function(u,m){if(A)return A=!1,m;if(lB(this))return m;for(var f=0;f<l;f++)if(s[f]===u)return m}}},QJ=Gs,HJ=String,Eu=uB("JSON","stringify"),Hv=I0(/./.exec),bB=I0("".charAt),GJ=I0("".charCodeAt),KJ=I0("".replace),WJ=I0(1.1.toString),zJ=/[\uD800-\uDFFF]/g,xB=/^[\uD800-\uDBFF]$/,vB=/^[\uDC00-\uDFFF]$/,wB=!QJ||pB(function(){var e=uB("Symbol")("stringify detection");return Eu([e])!=="[null]"||Eu({a:e})!=="{}"||Eu(Object(e))!=="{}"}),_B=pB(function(){return Eu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Eu("\uDEAD")!=='"\\udead"'}),qJ=function(e,t){var s=gB(arguments),r=VJ(t);if(mB(r)||e!==void 0&&!fB(e))return s[1]=function(i,l){if(mB(r)&&(l=MJ(r,this,HJ(i),l)),!fB(l))return l},hB(Eu,null,s)},YJ=function(e,t,s){var r=bB(s,t-1),i=bB(s,t+1);return Hv(xB,e)&&!Hv(vB,i)||Hv(vB,e)&&!Hv(xB,r)?"\\u"+WJ(GJ(e,0),16):e};Eu&&FJ({target:"JSON",stat:!0,forced:wB||_B},{stringify:function(e,t,s){var r=gB(arguments),i=hB(wB?qJ:Eu,null,r);return _B&&typeof i=="string"?KJ(i,zJ,YJ):i}});var yB=Uh,XJ=Ro;Is({target:"Object",stat:!0,forced:!Gs||p(function(){yB.f(1)})},{getOwnPropertySymbols:function(e){var t=yB.f;return t?t(XJ(e)):[]}}),gi("asyncDispose"),gi("asyncIterator"),gi("dispose"),gi("hasInstance"),gi("isConcatSpreadable"),gi("iterator"),gi("match"),gi("matchAll"),gi("replace"),gi("search"),gi("species"),gi("split");var JJ=FD;gi("toPrimitive"),JJ();var $J=mt,ZJ=vA;gi("toStringTag"),ZJ($J("Symbol"),"Symbol"),gi("unscopables"),vA(k.JSON,"JSON",!0);var e$=$e.Symbol,t$=Hr,s$=Na.f,EB=t$("metadata"),CB=Function.prototype;CB[EB]===void 0&&s$(CB,EB,{value:null}),gi("metadata");var r$=e$,n$=I,e1=mt("Symbol"),i$=e1.keyFor,a$=n$(e1.prototype.valueOf),SB=e1.isRegisteredSymbol||function(e){try{return i$(a$(e))!==void 0}catch{return!1}};Is({target:"Symbol",stat:!0},{isRegisteredSymbol:SB});for(var o$=ic,NB=mt,c$=I,l$=Ws,d$=Hr,Gv=NB("Symbol"),TB=Gv.isWellKnownSymbol,RB=NB("Object","getOwnPropertyNames"),A$=c$(Gv.prototype.valueOf),IB=o$("wks"),t1=0,OB=RB(Gv),u$=OB.length;t1<u$;t1++)try{var kB=OB[t1];l$(Gv[kB])&&d$(kB)}catch{}var DB=function(e){if(TB&&TB(e))return!0;try{for(var t=A$(e),s=0,r=RB(IB),i=r.length;s<i;s++)if(IB[r[s]]==t)return!0}catch{}return!1};Is({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:DB}),gi("customMatcher"),gi("observable"),Is({target:"Symbol",stat:!0},{isRegistered:SB}),Is({target:"Symbol",stat:!0,forced:!0},{isWellKnown:DB}),gi("matcher"),gi("metadataKey"),gi("patternMatch"),gi("replaceAll");var of=h(r$),BB=h(sf.f("iterator"));function O0(e){return O0=typeof of=="function"&&typeof BB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof of=="function"&&t.constructor===of&&t!==of.prototype?"symbol":typeof t},O0(e)}var h$=h(sf.f("toPrimitive"));function p$(e){var t=function(s,r){if(O0(s)!="object"||!s)return s;var i=s[h$];if(i!==void 0){var l=i.call(s,r);if(O0(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(s)}(e,"string");return O0(t)=="symbol"?t:t+""}function U(e,t,s){return(t=p$(t))in e?ND(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var LB=h(Mz),m$={isBrowser:!0,classes:{URLSearchParams:LB!==void 0?LB:QS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const s1=typeof window<"u"&&typeof document<"u",r1=typeof navigator=="object"&&navigator||void 0,f$=s1&&(!r1||["ReactNative","NativeScript","NS"].indexOf(r1.product)<0),g$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",b$=s1&&window.location.href||"http://localhost";function jB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function PB(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?jB(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):jB(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}var Xa=PB(PB({},Object.freeze({__proto__:null,hasBrowserEnv:s1,hasStandardBrowserEnv:f$,hasStandardBrowserWebWorkerEnv:g$,navigator:r1,origin:b$})),m$);function UB(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function x$(e,t){return jv(e,new Xa.classes.URLSearchParams,function(s){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?UB(Object(i),!0).forEach(function(l){U(s,l,i[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):UB(Object(i)).forEach(function(l){Object.defineProperty(s,l,Object.getOwnPropertyDescriptor(i,l))})}return s}({visitor:function(s,r,i,l){return Xa.isNode&&gt.isBuffer(s)?(this.append(r,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}var v$=PC.charAt,FB=Ne,w$=hi,_$=z,y$=we,E$=/./.exec,C$=TypeError,S$=Is,MB=Ne,VB=ce,N$=nC,Kv=Zx,QB=it,HB=dd,k0=si,T$=hi,R$=Je,I$=we,O$=cc,GB=TS,k$=Jt,D$=p,B$=dC,L$=function(e,t,s){return t+(s?v$(e,t).length:1)},j$=function(e,t){var s=e.exec;if(_$(s)){var r=FB(s,e,t);return r!==null&&w$(r),r}if(y$(e)==="RegExp")return FB(E$,e,t);throw new C$("RegExp#exec called on incompatible receiver")},KB=Gh,P$=Hr("matchAll"),WB="RegExp String",zB=WB+" Iterator",U$=KB.set,F$=KB.getterFor(zB),M$=TypeError,n1=VB("".indexOf),Wv=VB("".matchAll),i1=!!Wv&&!D$(function(){Wv("a",/./)}),V$=N$(function(e,t,s,r){U$(this,{type:zB,regexp:e,string:t,global:s,unicode:r,done:!1})},WB,function(){var e=F$(this);if(e.done)return Kv(void 0,!0);var t=e.regexp,s=e.string,r=j$(t,s);return r===null?(e.done=!0,Kv(void 0,!0)):e.global?(k0(r[0])===""&&(t.lastIndex=L$(s,HB(t.lastIndex),e.unicode)),Kv(r,!1)):(e.done=!0,Kv(r,!1))}),qB=function(e){var t,s,r,i=T$(this),l=k0(e),A=B$(i,RegExp),u=k0(GB(i));return t=new A(A===RegExp?i.source:i,u),s=!!~n1(u,"g"),r=!!~n1(u,"u"),t.lastIndex=HB(i.lastIndex),new V$(t,l,s,r)};S$({target:"String",proto:!0,forced:i1},{matchAll:function(e){var t,s,r,i,l=QB(this);if(R$(e)){if(O$(e)&&(t=k0(QB(GB(e))),!~n1(t,"g")))throw new M$("`.matchAll` does not allow non-global regexes");if(i1)return Wv(l,e);if((r=k$(e,P$))===void 0&&I$(e)==="RegExp"&&(r=qB),r)return MB(r,e,l)}else if(i1)return Wv(l,e);return s=k0(l),i=new RegExp(e,"g"),MB(qB,i,s)}});var Q$=Ti("String","matchAll"),H$=O,G$=Q$,a1=String.prototype,K$=function(e){var t=e.matchAll;return typeof e=="string"||e===a1||H$(a1,e)&&t===a1.matchAll?G$:t},W$=h(K$);function YB(e){function t(s,r,i,l){let A=s[l++];if(A==="__proto__")return!0;const u=Number.isFinite(+A),m=l>=s.length;return A=!A&&gt.isArray(i)?i.length:A,m?(gt.hasOwnProp(i,A)?i[A]=[i[A],r]:i[A]=r,!u):(i[A]&&gt.isObject(i[A])||(i[A]=[]),t(s,r,i[A],l)&&gt.isArray(i[A])&&(i[A]=function(f){const b={},w=Object.keys(f);let _;const S=w.length;let F;for(_=0;_<S;_++)F=w[_],b[F]=f[F];return b}(i[A])),!u)}if(gt.isFormData(e)&&gt.isFunction(e.entries)){const s={};return gt.forEachEntry(e,(r,i)=>{t(function(l){return W$(gt).call(gt,/\w+|\[(\w*)]/g,l).map(A=>A[0]==="[]"?"":A[1]||A[0])}(r),i,s,0)}),s}return null}const o1={transitional:yD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,i=gt.isObject(e);if(i&&gt.isHTMLForm(e)&&(e=new FormData(e)),gt.isFormData(e))return r?JSON.stringify(YB(e)):e;if(gt.isArrayBuffer(e)||gt.isBuffer(e)||gt.isStream(e)||gt.isFile(e)||gt.isBlob(e)||gt.isReadableStream(e))return e;if(gt.isArrayBufferView(e))return e.buffer;if(gt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return x$(e,this.formSerializer).toString();if((l=gt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const A=this.env&&this.env.FormData;return jv(l?{"files[]":e}:e,A&&new A,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(A,u,m){if(gt.isString(A))try{return(u||JSON.parse)(A),ma(gt).call(gt,A)}catch(f){if(f.name!=="SyntaxError")throw f}return(m||JSON.stringify)(A)}(e)):e}],transformResponse:[function(e){const t=this.transitional||o1.transitional,s=t&&t.forcedJSONParsing,r=this.responseType==="json";if(gt.isResponse(e)||gt.isReadableStream(e))return e;if(e&&gt.isString(e)&&(s&&!this.responseType||r)){const i=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(l){if(i)throw l.name==="SyntaxError"?wr.from(l,wr.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xa.classes.FormData,Blob:Xa.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};gt.forEach(["delete","get","head","post","put","patch"],e=>{o1.headers[e]={}});var c1=o1;const z$=gt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),XB=Symbol("internals");function D0(e){var t;return e&&ma(t=String(e)).call(t).toLowerCase()}function zv(e){return e===!1||e==null?e:gt.isArray(e)?e.map(zv):String(e)}function l1(e,t,s,r,i){return gt.isFunction(r)?r.call(this,t,s):(i&&(t=s),gt.isString(t)?gt.isString(r)?t.indexOf(r)!==-1:gt.isRegExp(r)?r.test(t):void 0:void 0)}class qv{constructor(t){t&&this.set(t)}set(t,s,r){const i=this;function l(m,f,b){const w=D0(f);if(!w)throw new Error("header name must be a non-empty string");const _=gt.findKey(i,w);(!_||i[_]===void 0||b===!0||b===void 0&&i[_]!==!1)&&(i[_||f]=zv(m))}const A=(m,f)=>gt.forEach(m,(b,w)=>l(b,w,f));if(gt.isPlainObject(t)||t instanceof this.constructor)A(t,s);else if(gt.isString(t)&&(t=ma(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ma(u=t).call(u)))A((m=>{const f={};let b,w,_;return m&&m.split(`
`).forEach(function(S){var F,B;_=S.indexOf(":"),b=ma(F=S.substring(0,_)).call(F).toLowerCase(),w=ma(B=S.substring(_+1)).call(B),!b||f[b]&&z$[b]||(b==="set-cookie"?f[b]?f[b].push(w):f[b]=[w]:f[b]=f[b]?f[b]+", "+w:w)}),f})(t),s);else if(gt.isObject(t)&&gt.isIterable(t)){let m,f,b={};for(const w of t){if(!gt.isArray(w))throw TypeError("Object iterator must return a key-value pair");b[f=w[0]]=(m=b[f])?gt.isArray(m)?[...m,w[1]]:[m,w[1]]:w[1]}A(b,s)}else t!=null&&l(s,t,r);var u;return this}get(t,s){if(t=D0(t)){const r=gt.findKey(this,t);if(r){const i=this[r];if(!s)return i;if(s===!0)return function(l){const A=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=u.exec(l);)A[m[1]]=m[2];return A}(i);if(gt.isFunction(s))return s.call(this,i,r);if(gt.isRegExp(s))return s.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,s){if(t=D0(t)){const r=gt.findKey(this,t);return!(!r||this[r]===void 0||s&&!l1(0,this[r],r,s))}return!1}delete(t,s){const r=this;let i=!1;function l(A){if(A=D0(A)){const u=gt.findKey(r,A);!u||s&&!l1(0,r[u],u,s)||(delete r[u],i=!0)}}return gt.isArray(t)?t.forEach(l):l(t),i}clear(t){const s=Object.keys(this);let r=s.length,i=!1;for(;r--;){const l=s[r];t&&!l1(0,this[l],l,t,!0)||(delete this[l],i=!0)}return i}normalize(t){const s=this,r={};return gt.forEach(this,(i,l)=>{var A;const u=gt.findKey(r,l);if(u)return s[u]=zv(i),void delete s[l];const m=t?function(f){return ma(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,w,_)=>w.toUpperCase()+_)}(l):ma(A=String(l)).call(A);m!==l&&delete s[l],s[m]=zv(i),r[m]=!0}),this}concat(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return this.constructor.concat(this,...s)}toJSON(t){const s=Object.create(null);return gt.forEach(this,(r,i)=>{r!=null&&r!==!1&&(s[i]=t&&gt.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[s,r]=t;return s+": "+r}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const s=new this(t);for(var r=arguments.length,i=new Array(r>1?r-1:0),l=1;l<r;l++)i[l-1]=arguments[l];return i.forEach(A=>s.set(A)),s}static accessor(t){const s=(this[XB]=this[XB]={accessors:{}}).accessors,r=this.prototype;function i(l){const A=D0(l);s[A]||(function(u,m){const f=gt.toCamelCase(" "+m);["get","set","has"].forEach(b=>{Object.defineProperty(u,b+f,{value:function(w,_,S){return this[b].call(this,m,w,_,S)},configurable:!0})})}(r,l),s[A]=!0)}return gt.isArray(t)?t.forEach(i):i(t),this}}qv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),gt.reduceDescriptors(qv.prototype,(e,t)=>{let{value:s}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(i){this[r]=i}}}),gt.freezeMethods(qv);var Dl=qv;function d1(e,t){const s=this||c1,r=t||s,i=Dl.from(r.headers);let l=r.data;return gt.forEach(e,function(A){l=A.call(s,l,i.normalize(),t?t.status:void 0)}),i.normalize(),l}function JB(e){return!(!e||!e.__CANCEL__)}function cf(e,t,s){wr.call(this,e??"canceled",wr.ERR_CANCELED,t,s),this.name="CanceledError"}function $B(e,t,s){const r=s.config.validateStatus;s.status&&r&&!r(s.status)?t(new wr("Request failed with status code "+s.status,[wr.ERR_BAD_REQUEST,wr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}gt.inherits(cf,wr,{__CANCEL__:!0});const Yv=function(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(l,A){l=l||10;const u=new Array(l),m=new Array(l);let f,b=0,w=0;return A=A!==void 0?A:1e3,function(_){const S=Date.now(),F=m[w];f||(f=S),u[b]=_,m[b]=S;let B=w,j=0;for(;B!==b;)j+=u[B++],B%=l;if(b=(b+1)%l,b===w&&(w=(w+1)%l),S-f<A)return;const K=F&&S-F;return K?Math.round(1e3*j/K):void 0}}(50,250);return function(l,A){let u,m,f=0,b=1e3/A;const w=function(_){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,m&&(clearTimeout(m),m=null),l(..._)};return[function(){const _=Date.now(),S=_-f;for(var F=arguments.length,B=new Array(F),j=0;j<F;j++)B[j]=arguments[j];S>=b?w(B,_):(u=B,m||(m=setTimeout(()=>{m=null,w(u)},b-S)))},()=>u&&w(u)]}(l=>{const A=l.loaded,u=l.lengthComputable?l.total:void 0,m=A-r,f=i(m);r=A,e({loaded:A,total:u,progress:u?A/u:void 0,bytes:m,rate:f||void 0,estimated:f&&u&&A<=u?(u-A)/f:void 0,event:l,lengthComputable:u!=null,[t?"download":"upload"]:!0})},s)},ZB=(e,t)=>{const s=e!=null;return[r=>t[0]({lengthComputable:s,total:e,loaded:r}),t[1]]},eL=e=>function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return gt.asap(()=>e(...s))};var q$=Xa.hasStandardBrowserEnv?((e,t)=>s=>(s=new Ev(s,Xa.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new Ev(Xa.origin),Xa.navigator&&/(msie|trident)/i.test(Xa.navigator.userAgent)):()=>!0,Y$=Xa.hasStandardBrowserEnv?{write(e,t,s,r,i,l,A){if(typeof document>"u")return;const u=["".concat(e,"=").concat(encodeURIComponent(t))];gt.isNumber(s)&&u.push("expires=".concat(new Date(s).toUTCString())),gt.isString(r)&&u.push("path=".concat(r)),gt.isString(i)&&u.push("domain=".concat(i)),l===!0&&u.push("secure"),gt.isString(A)&&u.push("SameSite=".concat(A)),document.cookie=u.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function tL(e,t,s){let r=!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t);return e&&(r||s==0)?function(i,l){return l?i.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):i}(e,t):t}function sL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function A1(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?sL(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):sL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const rL=e=>e instanceof Dl?A1({},e):e;function tp(e,t){t=t||{};const s={};function r(f,b,w,_){return gt.isPlainObject(f)&&gt.isPlainObject(b)?gt.merge.call({caseless:_},f,b):gt.isPlainObject(b)?gt.merge({},b):gt.isArray(b)?b.slice():b}function i(f,b,w,_){return gt.isUndefined(b)?gt.isUndefined(f)?void 0:r(void 0,f,0,_):r(f,b,0,_)}function l(f,b){if(!gt.isUndefined(b))return r(void 0,b)}function A(f,b){return gt.isUndefined(b)?gt.isUndefined(f)?void 0:r(void 0,f):r(void 0,b)}function u(f,b,w){return w in t?r(f,b):w in e?r(void 0,f):void 0}const m={url:l,method:l,data:l,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,withXSRFToken:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:u,headers:(f,b,w)=>i(rL(f),rL(b),0,!0)};return gt.forEach(Object.keys(A1(A1({},e),t)),function(f){const b=m[f]||i,w=b(e[f],t[f],f);gt.isUndefined(w)&&b!==u||(s[f]=w)}),s}var nL=e=>{const t=tp({},e);let{data:s,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:l,headers:A,auth:u}=t;if(t.headers=A=Dl.from(A),t.url=wD(tL(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&A.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),gt.isFormData(s)){if(Xa.hasStandardBrowserEnv||Xa.hasStandardBrowserWebWorkerEnv)A.setContentType(void 0);else if(gt.isFunction(s.getHeaders)){const m=s.getHeaders(),f=["content-type","content-length"];Object.entries(m).forEach(b=>{let[w,_]=b;et(f).call(f,w.toLowerCase())&&A.set(w,_)})}}if(Xa.hasStandardBrowserEnv&&(r&&gt.isFunction(r)&&(r=r(t)),r||r!==!1&&q$(t.url))){const m=i&&l&&Y$.read(l);m&&A.set(i,m)}return t},X$=typeof XMLHttpRequest<"u"&&function(e){return new pt(function(t,s){const r=nL(e);let i=r.data;const l=Dl.from(r.headers).normalize();let A,u,m,f,b,{responseType:w,onUploadProgress:_,onDownloadProgress:S}=r;function F(){f&&f(),b&&b(),r.cancelToken&&r.cancelToken.unsubscribe(A),r.signal&&r.signal.removeEventListener("abort",A)}let B=new XMLHttpRequest;function j(){if(!B)return;const X=Dl.from("getAllResponseHeaders"in B&&B.getAllResponseHeaders());$B(function(oe){t(oe),F()},function(oe){s(oe),F()},{data:w&&w!=="text"&&w!=="json"?B.response:B.responseText,status:B.status,statusText:B.statusText,headers:X,config:e,request:B}),B=null}B.open(r.method.toUpperCase(),r.url,!0),B.timeout=r.timeout,"onloadend"in B?B.onloadend=j:B.onreadystatechange=function(){B&&B.readyState===4&&(B.status!==0||B.responseURL&&B.responseURL.indexOf("file:")===0)&&setTimeout(j)},B.onabort=function(){B&&(s(new wr("Request aborted",wr.ECONNABORTED,e,B)),B=null)},B.onerror=function(X){const oe=new wr(X&&X.message?X.message:"Network Error",wr.ERR_NETWORK,e,B);oe.event=X||null,s(oe),B=null},B.ontimeout=function(){let X=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const oe=r.transitional||yD;r.timeoutErrorMessage&&(X=r.timeoutErrorMessage),s(new wr(X,oe.clarifyTimeoutError?wr.ETIMEDOUT:wr.ECONNABORTED,e,B)),B=null},i===void 0&&l.setContentType(null),"setRequestHeader"in B&&gt.forEach(l.toJSON(),function(X,oe){B.setRequestHeader(oe,X)}),gt.isUndefined(r.withCredentials)||(B.withCredentials=!!r.withCredentials),w&&w!=="json"&&(B.responseType=r.responseType),S&&([m,b]=Yv(S,!0),B.addEventListener("progress",m)),_&&B.upload&&([u,f]=Yv(_),B.upload.addEventListener("progress",u),B.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(A=X=>{B&&(s(!X||X.type?new cf(null,e,B):X),B.abort(),B=null)},r.cancelToken&&r.cancelToken.subscribe(A),r.signal&&(r.signal.aborted?A():r.signal.addEventListener("abort",A)));const K=function(X){const oe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(X);return oe&&oe[1]||""}(r.url);K&&Xa.protocols.indexOf(K)===-1?s(new wr("Unsupported protocol "+K+":",wr.ERR_BAD_REQUEST,e)):B.send(i||null)})},J$=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let r,i=new AbortController;const l=function(f){if(!r){r=!0,u();const b=f instanceof Error?f:this.reason;i.abort(b instanceof wr?b:new cf(b instanceof Error?b.message:b))}};let A=t&&setTimeout(()=>{A=null,l(new wr("timeout ".concat(t," of ms exceeded"),wr.ETIMEDOUT))},t);const u=()=>{e&&(A&&clearTimeout(A),A=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(l):f.removeEventListener("abort",l)}),e=null)};e.forEach(f=>f.addEventListener("abort",l));const{signal:m}=i;return m.unsubscribe=()=>gt.asap(u),m}},u1=h(QO),iL=sf.f("asyncIterator"),$$=h(iL);function h1(e,t){this.v=e,this.k=t}function ka(e){return function(){return new B0(e.apply(this,arguments))}}function B0(e){var t,s;function r(l,A){try{var u=e[l](A),m=u.value,f=m instanceof h1;u1.resolve(f?m.v:m).then(function(b){if(f){var w=l==="return"?"return":"next";if(!m.k||b.done)return r(w,b);b=e[w](b).value}i(u.done?"return":"normal",b)},function(b){r("throw",b)})}catch(b){i("throw",b)}}function i(l,A){switch(l){case"return":t.resolve({value:A,done:!0});break;case"throw":t.reject(A);break;default:t.resolve({value:A,done:!1})}(t=t.next)?r(t.key,t.arg):s=null}this._invoke=function(l,A){return new u1(function(u,m){var f={key:l,arg:A,resolve:u,reject:m,next:null};s?s=s.next=f:(t=s=f,r(l,A))})},typeof e.return!="function"&&(this.return=void 0)}function _s(e){return new h1(e,0)}function lf(e){var t={},s=!1;function r(i,l){return s=!0,l=new u1(function(A){A(e[i](l))}),{done:!1,value:new h1(l,1)}}return t[of!==void 0&&BB||"@@iterator"]=function(){return this},t.next=function(i){return s?(s=!1,i):r("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(s)throw s=!1,i;return r("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return s?(s=!1,i):r("return",i)}),t}B0.prototype[typeof of=="function"&&$$||"@@asyncIterator"]=function(){return this},B0.prototype.next=function(e){return this._invoke("next",e)},B0.prototype.throw=function(e){return this._invoke("throw",e)},B0.prototype.return=function(e){return this._invoke("return",e)};var Xv=h(iL);function p1(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=Xv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Jv(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Jv(e){function t(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var r=s.done;return pt.resolve(s.value).then(function(i){return{value:i,done:r}})}return Jv=function(s){this.s=s,this.n=s.next},Jv.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?pt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?pt.reject(s):t(r.apply(this.s,arguments))}},new Jv(e)}const Z$=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let r,i=0;for(;i<s;)r=i+t,yield e.slice(i,r),i=r},eZ=function(){var e=ka(function*(t,s){var r,i=!1,l=!1;try{for(var A,u=p1(tZ(t));i=!(A=yield _s(u.next())).done;i=!1){const m=A.value;yield*lf(p1(Z$(m,s)))}}catch(m){l=!0,r=m}finally{try{i&&u.return!=null&&(yield _s(u.return()))}finally{if(l)throw r}}});return function(t,s){return e.apply(this,arguments)}}(),tZ=function(){var e=ka(function*(t){if(t[Xv])return void(yield*lf(p1(t)));const s=t.getReader();try{for(;;){const{done:r,value:i}=yield _s(s.read());if(r)break;yield i}}finally{yield _s(s.cancel())}});return function(t){return e.apply(this,arguments)}}(),aL=(e,t,s,r)=>{const i=eZ(e,t);let l,A=0,u=m=>{l||(l=!0,r&&r(m))};return new ReadableStream({async pull(m){try{const{done:f,value:b}=await i.next();if(f)return u(),void m.close();let w=b.byteLength;if(s){let _=A+=w;s(_)}m.enqueue(new Uint8Array(b))}catch(f){throw u(f),f}},cancel:m=>(u(m),i.return())},{highWaterMark:2})};function oL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function cL(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?oL(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const{isFunction:$v}=gt,sZ=(e=>{let{Request:t,Response:s}=e;return{Request:t,Response:s}})(gt.global),{ReadableStream:lL,TextEncoder:dL}=gt.global,AL=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return!!e(...s)}catch{return!1}},rZ=e=>{e=gt.merge.call({skipUndefined:!0},sZ,e);const{fetch:t,Request:s,Response:r}=e,i=t?$v(t):typeof fetch=="function",l=$v(s),A=$v(r);if(!i)return!1;const u=i&&$v(lL),m=i&&(typeof dL=="function"?(f=new dL,F=>f.encode(F)):async F=>new Uint8Array(await new s(F).arrayBuffer()));var f;const b=l&&u&&AL(()=>{let F=!1;const B=new s(Xa.origin,{body:new lL,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!B}),w=A&&u&&AL(()=>gt.isReadableStream(new r("").body)),_={stream:w&&(F=>F.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!_[F]&&(_[F]=(B,j)=>{let K=B&&B[F];if(K)return K.call(B);throw new wr("Response type '".concat(F,"' is not supported"),wr.ERR_NOT_SUPPORT,j)})});const S=async(F,B)=>{const j=gt.toFiniteNumber(F.getContentLength());return j??(async K=>K==null?0:gt.isBlob(K)?K.size:gt.isSpecCompliantForm(K)?(await new s(Xa.origin,{method:"POST",body:K}).arrayBuffer()).byteLength:gt.isArrayBufferView(K)||gt.isArrayBuffer(K)?K.byteLength:(gt.isURLSearchParams(K)&&(K+=""),gt.isString(K)?(await m(K)).byteLength:void 0))(B)};return async F=>{let{url:B,method:j,data:K,signal:X,cancelToken:oe,timeout:xe,onDownloadProgress:Ee,onUploadProgress:me,responseType:Re,headers:He,withCredentials:Xe="same-origin",fetchOptions:_t}=nL(F),ns=t||fetch;Re=Re?(Re+"").toLowerCase():"text";let es=J$([X,oe&&oe.toAbortSignal()],xe),vs=null;const ps=es&&es.unsubscribe&&(()=>{es.unsubscribe()});let tr;try{if(me&&b&&j!=="get"&&j!=="head"&&(tr=await S(He,K))!==0){let D,ae=new s(B,{method:"POST",body:K,duplex:"half"});if(gt.isFormData(K)&&(D=ae.headers.get("content-type"))&&He.setContentType(D),ae.body){const[be,nt]=ZB(tr,Yv(eL(me)));K=aL(ae.body,65536,be,nt)}}gt.isString(Xe)||(Xe=Xe?"include":"omit");const Fr=l&&"credentials"in s.prototype,We=cL(cL({},_t),{},{signal:es,method:j.toUpperCase(),headers:He.normalize().toJSON(),body:K,duplex:"half",credentials:Fr?Xe:void 0});vs=l&&new s(B,We);let ct=await(l?ns(vs,_t):ns(B,We));const Rt=w&&(Re==="stream"||Re==="response");if(w&&(Ee||Rt&&ps)){const D={};["status","statusText","headers"].forEach(ls=>{D[ls]=ct[ls]});const ae=gt.toFiniteNumber(ct.headers.get("content-length")),[be,nt]=Ee&&ZB(ae,Yv(eL(Ee),!0))||[];ct=new r(aL(ct.body,65536,be,()=>{nt&&nt(),ps&&ps()}),D)}Re=Re||"text";let Ye=await _[gt.findKey(_,Re)||"text"](ct,F);return!Rt&&ps&&ps(),await new pt((D,ae)=>{$B(D,ae,{data:Ye,headers:Dl.from(ct.headers),status:ct.status,statusText:ct.statusText,config:F,request:vs})})}catch(Fr){throw ps&&ps(),Fr&&Fr.name==="TypeError"&&/Load failed|fetch/i.test(Fr.message)?Object.assign(new wr("Network Error",wr.ERR_NETWORK,F,vs),{cause:Fr.cause||Fr}):wr.from(Fr,Fr&&Fr.code,F,vs)}}},nZ=new Map,uL=e=>{let t=e&&e.env||{};const{fetch:s,Request:r,Response:i}=t,l=[r,i,s];let A,u,m=l.length,f=nZ;for(;m--;)A=l[m],u=f.get(A),u===void 0&&f.set(A,u=m?new Map:rZ(t)),f=u;return u};uL();const m1={http:null,xhr:X$,fetch:{get:uL}};gt.forEach(m1,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const hL=e=>"- ".concat(e),iZ=e=>gt.isFunction(e)||e===null||e===!1;var pL={getAdapter:function(e,t){e=gt.isArray(e)?e:[e];const{length:s}=e;let r,i;const l={};for(let A=0;A<s;A++){let u;if(r=e[A],i=r,!iZ(r)&&(i=m1[(u=String(r)).toLowerCase()],i===void 0))throw new wr("Unknown adapter '".concat(u,"'"));if(i&&(gt.isFunction(i)||(i=i.get(t))))break;l[u||"#"+A]=i}if(!i){const A=Object.entries(l).map(u=>{let[m,f]=u;return"adapter ".concat(m," ")+(f===!1?"is not supported by the environment":"is not available in the build")});throw new wr("There is no suitable adapter to dispatch the request "+(s?A.length>1?`since :
`+A.map(hL).join(`
`):" "+hL(A[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:m1};function f1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new cf(null,e)}function mL(e){return f1(e),e.headers=Dl.from(e.headers),e.data=d1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),pL.getAdapter(e.adapter||c1.adapter,e)(e).then(function(t){return f1(e),t.data=d1.call(e,e.transformResponse,t),t.headers=Dl.from(t.headers),t},function(t){return JB(t)||(f1(e),t&&t.response&&(t.response.data=d1.call(e,e.transformResponse,t.response),t.response.headers=Dl.from(t.response.headers))),pt.reject(t)})}const fL="1.13.2",Zv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Zv[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const gL={};Zv.transitional=function(e,t,s){function r(i,l){return"[Axios v"+fL+"] Transitional option '"+i+"'"+l+(s?". "+s:"")}return(i,l,A)=>{if(e===!1)throw new wr(r(l," has been removed"+(t?" in "+t:"")),wr.ERR_DEPRECATED);return t&&!gL[l]&&(gL[l]=!0,console.warn(r(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,l,A)}},Zv.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var ew={assertOptions:function(e,t,s){if(typeof e!="object")throw new wr("options must be an object",wr.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const l=r[i],A=t[l];if(A){const u=e[l],m=u===void 0||A(u,l,e);if(m!==!0)throw new wr("option "+l+" must be "+m,wr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new wr("Unknown option "+l,wr.ERR_BAD_OPTION)}},validators:Zv};const Ed=ew.validators;let tw=class{constructor(e){this.defaults=e||{},this.interceptors={request:new _D,response:new _D}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=tp(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:i}=t;s!==void 0&&ew.assertOptions(s,{silentJSONParsing:Ed.transitional(Ed.boolean),forcedJSONParsing:Ed.transitional(Ed.boolean),clarifyTimeoutError:Ed.transitional(Ed.boolean)},!1),r!=null&&(gt.isFunction(r)?t.paramsSerializer={serialize:r}:ew.assertOptions(r,{encode:Ed.function,serialize:Ed.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ew.assertOptions(t,{baseUrl:Ed.spelling("baseURL"),withXsrfToken:Ed.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=i&&gt.merge(i.common,i[t.method]);i&&gt.forEach(["delete","get","head","post","put","patch","common"],S=>{delete i[S]}),t.headers=Dl.concat(l,i);const A=[];let u=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(u=u&&S.synchronous,A.unshift(S.fulfilled,S.rejected))});const m=[];let f;this.interceptors.response.forEach(function(S){m.push(S.fulfilled,S.rejected)});let b,w=0;if(!u){const S=[mL.bind(this),void 0];for(S.unshift(...A),S.push(...m),b=S.length,f=pt.resolve(t);w<b;)f=f.then(S[w++],S[w++]);return f}b=A.length;let _=t;for(;w<b;){const S=A[w++],F=A[w++];try{_=S(_)}catch(B){F.call(this,B);break}}try{f=mL.call(this,_)}catch(S){return pt.reject(S)}for(w=0,b=m.length;w<b;)f=f.then(m[w++],m[w++]);return f}getUri(e){return wD(tL((e=tp(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};gt.forEach(["delete","get","head","options"],function(e){tw.prototype[e]=function(t,s){return this.request(tp(s||{},{method:e,url:t,data:(s||{}).data}))}}),gt.forEach(["post","put","patch"],function(e){function t(s){return function(r,i,l){return this.request(tp(l||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}tw.prototype[e]=t(),tw.prototype[e+"Form"]=t(!0)});var sw=tw;class g1{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let s;this.promise=new pt(function(i){s=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](i);r._listeners=null}),this.promise.then=i=>{let l;const A=new pt(u=>{r.subscribe(u),l=u}).then(i);return A.cancel=function(){r.unsubscribe(l)},A},t(function(i,l,A){r.reason||(r.reason=new cf(i,l,A),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const s=this._listeners.indexOf(t);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const t=new AbortController,s=r=>{t.abort(r)};return this.subscribe(s),t.signal.unsubscribe=()=>this.unsubscribe(s),t.signal}static source(){let t;return{token:new g1(function(r){t=r}),cancel:t}}}var aZ=g1;const b1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(b1).forEach(e=>{let[t,s]=e;b1[s]=t});var oZ=b1;const Yi=function e(t){const s=new sw(t),r=nD(sw.prototype.request,s);return gt.extend(r,sw.prototype,s,{allOwnKeys:!0}),gt.extend(r,s,null,{allOwnKeys:!0}),r.create=function(i){return e(tp(t,i))},r}(c1);Yi.Axios=sw,Yi.CanceledError=cf,Yi.CancelToken=aZ,Yi.isCancel=JB,Yi.VERSION=fL,Yi.toFormData=jv,Yi.AxiosError=wr,Yi.Cancel=Yi.CanceledError,Yi.all=function(e){return pt.all(e)},Yi.spread=function(e){return function(t){return e.apply(null,t)}},Yi.isAxiosError=function(e){return gt.isObject(e)&&e.isAxiosError===!0},Yi.mergeConfig=tp,Yi.AxiosHeaders=Dl,Yi.formToJSON=e=>YB(gt.isHTMLForm(e)?new FormData(e):e),Yi.getAdapter=pL.getAdapter,Yi.HttpStatusCode=oZ,Yi.default=Yi;var Da=Yi;const cZ=()=>{};function L0(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:cZ};return e.promise=new pt((t,s)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(r))}}),e}const rw=new Map,nw=new Map,Cd=new Map;let qn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),er=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const bL=new HY;let Bl=bL.getResult(),x1=null;function $s(e){if(!x1){Bl=bL.getResult();const t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return er.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return er.CHROME;case"Safari":case"Mobile Safari":return er.SAFARI;case"Edge":return er.EDGE;case"Firefox":return er.FIREFOX;case"QQ":case"QQBrowser":return er.QQ;case"Opera":return er.OPERA;case"WeChat":return er.WECHAT;default:return u.browser.name||""}}(Bl),s=xL(Bl),r=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(Bl),i=Bl.os.version,l=xL(Bl,!1),A=Bl.device.type;if(!(t&&s&&r&&i))return{name:t,version:s,os:r,osVersion:i,browserVersion:l,deviceType:A};x1={name:t,version:s,os:r,osVersion:i,browserVersion:l,deviceType:A}}return x1}function xL(e){let t,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?t.split(".")[0]:t}function iw(){return $s().os}function vL(){const e=$s();return"".concat(e.os," ").concat(e.osVersion)}function aw(){const e=$s();return!!(Bl.engine.name==="WebKit"&&e.os===qn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==er.SAFARI||Xi()&&e.name!==er.SAFARI)}function EA(){return $s().name===er.CHROME}function ii(){return $s().name===er.SAFARI}function wL(){const e=$s();if(e.name!==er.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function _L(){return $s().name===er.EDGE}function kr(){return $s().name===er.FIREFOX}function Xi(){return $s().os===qn.IOS}function Ll(e){const t=$s();return!(t.name!==er.CHROME||!t.osVersion)&&Number(t.version)>=e}function yL(e){const t=$s();return!(t.name!==er.CHROME||!t.osVersion)&&Number(t.version)<e}function v1(e,t,s){const r=$s();return!(r.name!==e||!r.osVersion)&&(s?Number(r.version)>=t&&Number(r.version)<=s:Number(r.version)===t)}function Cu(e){const t=$s();return!(t.name!==er.EDGE||!t.osVersion)&&Number(t.version)>=e}function w1(e){const t=$s();return!(t.name!==er.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function EL(e){const t=$s();return!(t.name!==er.SAFARI||!t.osVersion)&&Number(t.version)>=e}function CL(e,t,s){const r=$s();if(r.os!==qn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function SL(e,t,s){const r=$s();if(r.os!==qn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function _1(e,t,s){const r=$s();if(r.name!==er.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return s?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function sp(e){const t=$s();return!(t.name!==er.OPERA||!t.osVersion)&&Number(t.version)>=e}function NL(){const e=$s();if(e.os!==qn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function df(){const e=$s();if(e.os!==qn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function y1(){const e=$s();if(e.os!==qn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function TL(){const e=$s();if(e.os!==qn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function zc(){return ii()&&navigator.maxTouchPoints>0}function RL(){return $s().name===er.WECHAT}function IL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function OL(){const e=iw();return function(){const{deviceType:t}=$s();return t==="mobile"||t==="tablet"}()||e===qn.ANDROID||e===qn.IOS||e===qn.HARMONY_OS}function Sd(){const e=$s();return e.name!==er.EDGE&&e.name!==er.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function j0(){return iw()===qn.ANDROID}function P0(){const e=$s();return j0()&&(e.name===er.CHROME||e.name===er.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function As(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var m=u.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function kL(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function at(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?kL(Object(s),!0).forEach(function(r){As(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):kL(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let W=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Fe=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(t),As(this,"code",void 0),As(this,"message",void 0),As(this,"data",void 0),As(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function qc(e,t){if(typeof e!="boolean")throw new Fe(W.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function fn(e,t,s){if(!et(s).call(s,e))throw new Fe(W.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(s)))}function _r(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new Fe(W.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(s,", ").concat(r,"]. integer only"))}function E1(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Fe(W.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&_r(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&_r(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&_r(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&_r(e.ideal,"".concat(t,".ideal"),1,1/0)}else _r(e,t,1,1/0)}function bi(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Fe(W.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!DL(e,s,r,i))throw new Fe(W.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(s,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function CA(e,t){if(!Array.isArray(e))throw new Fe(W.INVALID_PARAMS,"".concat(t," should be an array"))}function $r(e){return e==null}function DL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=t&&(!r||function(i){if(typeof i!="string")return!1;for(let l=0;l<i.length;l+=1){const A=i.charCodeAt(l);if(A<0||A>255)return!1}return!0}(e))}function BL(e,t,s){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,s);const r=e.getUint32(t,s),i=e.getUint32(t+4,s),l=0,A=+!s;return BigInt(r*A+i*l)<<BigInt(32)|BigInt(r*l+i*A)}function LL(e,t,s,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,s,r);const i=Number(s>>BigInt(32)),l=Number(s&BigInt(4294967295));e.setUint32(t,i,r),e.setUint32(t+4,l,r)}var U0=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(U0||{}),C1=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(C1||{});const jL=new class{constructor(){As(this,"_clientSize",null),As(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),As(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),As(this,"getStyle",e=>window.getComputedStyle(e,null)),As(this,"checkCssVisibleProperty",e=>{var t;let s=!0;const r=this.getStyle(e),{display:i,visibility:l,opacity:A,filter:u}=r;return(i==="none"||et(t=["hidden","collapse"]).call(t,l)||Number(A)<.1)&&(s=!1),!!s&&(u&&u.split(" ").filter(m=>{var f;const b=m.split("(")[0];return et(f=["brightness","blur","opacity"]).call(f,b)}).map(m=>{const[f,b]=m.split(/\(|\)/);return[f,Number(b.match(/^[0-9\.]+/))]}).forEach(m=>{const[f,b]=m;switch(f){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),As(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let s=!0,r=!0;const i=A=>t(A);let l=e;for(;l&&r;)i(l)||(s=!1,r=!1),l=l.parentElement,l||(r=!1);return s}),As(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),As(this,"getSizeAboutClient",e=>{const{width:t,height:s,left:r,right:i,top:l,bottom:A}=e.getBoundingClientRect(),u=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:s,left:r,right:i,top:l,bottom:A,clientWidth:u,clientHeight:m,clientMin:Math.min(u,m)}}),As(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,t,s)}),As(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),As(this,"checkCoverForAPoint",(e,t,s)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==s}),As(this,"getPointPositionList",()=>{const{width:e,height:t,left:s,top:r}=this._clientSize,i=e/6,l=t/6,A=[],u=10**6;for(let m=0;m<5;m++)for(let f=0;f<5;f++){const b=(s*u+(m===0?.1:m===4?(i*m*u-1e5)/u:i*m)*u)/u,w=(r*u+(f===0?.1:f===4?(l*f*u-1e5)/u:l*f)*u)/u;A.push({x:b,y:w})}return[...A]}),As(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),As(this,"checkSizeIsVisible",(e,t,s)=>(e>50||s/e<=10)&&(t>50||s/t<=10)),As(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:s,bottom:r,clientHeight:i,clientWidth:l,clientMin:A}=this._clientSize;let u,m,f,b;if(e<0)u=0;else{if(!(e<l))return!1;u=e}if(t<0)return!1;if(m=t<l?t:l,s<0)f=0;else{if(!(s<i))return!1;f=s}if(r<0)return!1;b=r<i?r:i;const w=m-u,_=b-f;return this.checkSizeIsVisible(w,_,A)}),As(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),As(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(U0.COVERED);{const t=this.checkActualSize(),s=this.checkSizeOfPartInClient();return t&&!s?this.returnHiddenResult(U0.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(U0.SIZE)}}return this.returnHiddenResult(U0.STYLE)}return this.returnHiddenResult(C1.UNMOUNTED)}return this.returnHiddenResult(C1.INVALID_HTML_ELEMENT)}),As(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function S1(e){return new TextEncoder().encode(e)}const PL=function(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s},N1=async e=>function(t,s){let r="";return new Uint8Array(t).forEach(i=>{r+=i.toString(s).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",S1(e)),16);let Vr=class{constructor(){As(this,"_events",{}),As(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,t)===-1&&s.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,t)===-1&&s.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const s=this._events[e],r=this._indexOfListener(s,t);r!==-1&&s.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];for(let l=0;l<t.length;l+=1){const A=t[l];A.once&&this.off(e,A.listener),A.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,s)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let s=e.length;for(;s--;)if(e[s].listener===t)return s;return-1}},F0=null;function UL(){if(F0)return F0;if(window.electron)return F0=window.electron;if(!window.require)return null;try{return F0=window.require("electron"),F0}catch{return null}}let Pr=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),yr=function(e){return e.TRACER="tracer",e}({});function FL(e){return _r(e.timeout,"config.timeout",0,1e5),_r(e.timeoutFactor,"config.timeoutFactor",0,100,!1),_r(e.maxRetryCount,"config.maxRetryConfig",0,1/0),_r(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let lZ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ms=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function rp(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function ML(e){return bi(e.turnServerURL,"turnServerURL"),bi(e.username,"username"),bi(e.password,"password"),e.udpport&&_r(e.udpport,"udpport",1,99999,!0),e.forceturn&&qc(e.forceturn,"forceturn"),e.security&&qc(e.security,"security"),e.tcpport&&_r(e.tcpport,"tcpport",1,99999,!0),!0}let Af=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function T1(e){return e.level!==void 0&&fn(e.level,"level",[1,2,3]),e.delay!==void 0&&_r(e.delay,"delay",0,3e3,!0),!0}let Ss=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),R1=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),Ii=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ga=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),np=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Cn(e,t){for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return e.getListeners(t).length===0?pt.reject(new Fe(W.UNEXPECTED_ERROR,"can not emit promise")):new pt((l,A)=>{e.emit(t,...r,l,A)})}function Sr(e,t){if(e.getListeners(t).length===0)return pt.resolve();for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return Cn(e,t,...r)}function Eo(e,t){if(e.getListeners(t).length===0)return null;for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return ip(e,t,...r)}function ip(e,t){let s=null,r=null;for(var i=arguments.length,l=new Array(i>2?i-2:0),A=2;A<i;A++)l[A-2]=arguments[A];if(e.emit(t,...l,u=>{s=u},u=>{r=u}),r!==null)throw r;if(s===null)throw new Fe(W.UNEXPECTED_ERROR,"handler is not sync");return s}const Zr=new class extends Vr{set networkState(e){this.emit(np.NETWORK_STATE_CHANGE,e,this._networkState),e===ga.ONLINE?this.emit(np.ONLINE):e===ga.OFFLINE&&(this.onlineWaiter=new pt(t=>{this.once(np.ONLINE,()=>{this.onlineWaiter=void 0,t(ga.ONLINE)})}),this.emit(np.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ga.ONLINE}constructor(){super(),As(this,"_moduleName","network-indicator"),As(this,"_networkState",ga.ONLINE),As(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ga.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ga.OFFLINE})}},Ba=[];for(let e=0;e<256;++e)Ba.push((e+256).toString(16).slice(1));const VL=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let I1;const dZ=new Uint8Array(16);function AZ(){return VL?VL():function(s,r,i){var l,A,u,m;const f=(l=(A=(s=s||{}).random)!==null&&A!==void 0?A:(u=(m=s).rng)===null||u===void 0?void 0:u.call(m))!==null&&l!==void 0?l:function(){if(!I1){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I1=crypto.getRandomValues.bind(crypto)}return I1(dZ)}();if(f.length<16)throw new Error("Random bytes length must be >= 16");if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,r){if((i=i||0)<0||i+16>r.length)throw new RangeError("UUID byte range ".concat(i,":").concat(i+15," is out of buffer bounds"));for(let b=0;b<16;++b)r[i+b]=f[b];return r}return function(b){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Ba[b[w+0]]+Ba[b[w+1]]+Ba[b[w+2]]+Ba[b[w+3]]+"-"+Ba[b[w+4]]+Ba[b[w+5]]+"-"+Ba[b[w+6]]+Ba[b[w+7]]+"-"+Ba[b[w+8]]+Ba[b[w+9]]+"-"+Ba[b[w+10]]+Ba[b[w+11]]+Ba[b[w+12]]+Ba[b[w+13]]+Ba[b[w+14]]+Ba[b[w+15]]).toLowerCase()}(f)}(e,t,void 0);var e,t}function ow(e,t){const s=e.indexOf(t);s!==-1&&e.splice(s,1)}function uf(e){const t=[];return e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)}),t}function cw(e){pt!==void 0?pt.resolve().then(e):setTimeout(e,0)}function Dr(e){return JSON.parse(JSON.stringify(e))}function ap(e){try{return Dr(e)}catch{return e}}const QL={};function Su(e,t){QL[t]||(QL[t]=!0,e())}function op(e){const t=window.atob(e),s=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)s[r]=t.charCodeAt(r);return s}function Nu(e){let t="";for(let s=0;s<e.length;s+=1)t+=String.fromCharCode(e[s]);return window.btoa(t)}function HL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>t)s=s.slice(0,t);else if(s.length<t){const r=new Uint8Array(t);r.set(s),s=r}return s}function GL(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=za(t).call(t,(A,u)=>A+u.length,0),i=new Uint8Array(new ArrayBuffer(r));let l=0;return t.forEach(A=>{i.set(A,l),l+=A.length}),i}function Nd(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function KL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{t+=typeof s=="string"?Nd(s):s.size}),t+138}function uZ(e){const t=new Fe(W.TIMEOUT,"timeout");return new pt((s,r)=>{window.setTimeout(()=>r(t),e)})}function Yn(e){return new pt(t=>{window.setTimeout(t,e)})}function dr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(t).concat(s):"".concat(t).concat(s)+dr(e-s.length,"")}function cp(){let e,t=!1;try{var s;e=QY(s=AZ()).call(s,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=dr(32,"")),e.toUpperCase()}const M0=()=>{},WL=new class{constructor(){As(this,"fnMap",new Map)}throttleByKey(e,t,s,r){for(var i=arguments.length,l=new Array(i>4?i-4:0),A=4;A<i;A++)l[A-4]=arguments[A];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==s){u.fn(...u.args),clearTimeout(u.timer);const m=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:m,args:l,skipFn:r})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,at(at({},u),{},{fn:e,args:l,skipFn:r}))}else{const u=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},s);this.fnMap.set(t,{fn:e,threshold:s,timer:u,args:l,skipFn:r})}}},zL=WL.throttleByKey.bind(WL);function qL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function O1(e,t){if(!qL(e)||!qL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const s=[...e];for(let r=0;r<t.length;r++)s[r]=O1(e[r],t[r]);return s}{const s=at({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?s[r]=O1(e[r],t[r]):s[r]=t[r]);return s}}function YL(e,t){let s=[0];if(s=new Array(t).fill(0),e===0)return s;let r=0;for(;e>0&&(s[r]=255&e,e>>=8,r++,r!==t););return s}function hf(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function k1(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function D1(e){return za(e).call(e,(t,s)=>t+s,0)}function XL(e){const t="0123456789abcdef";function s(oe){let xe,Ee="";for(xe=0;xe<=3;xe++)Ee+=t.charAt(oe>>8*xe+4&15)+t.charAt(oe>>8*xe&15);return Ee}function r(oe,xe){const Ee=(65535&oe)+(65535&xe);return(oe>>16)+(xe>>16)+(Ee>>16)<<16|65535&Ee}function i(oe,xe,Ee,me,Re,He){return r(function(Xe,_t){return Xe<<_t|Xe>>>32-_t}(r(r(xe,oe),r(me,He)),Re),Ee)}function l(oe,xe,Ee,me,Re,He,Xe){return i(xe&Ee|~xe&me,oe,xe,Re,He,Xe)}function A(oe,xe,Ee,me,Re,He,Xe){return i(xe&me|Ee&~me,oe,xe,Re,He,Xe)}function u(oe,xe,Ee,me,Re,He,Xe){return i(xe^Ee^me,oe,xe,Re,He,Xe)}function m(oe,xe,Ee,me,Re,He,Xe){return i(Ee^(xe|~me),oe,xe,Re,He,Xe)}const f=function(oe){let xe;const Ee=1+(oe.length+8>>6),me=new Array(16*Ee);for(xe=0;xe<16*Ee;xe++)me[xe]=0;for(xe=0;xe<oe.length;xe++)me[xe>>2]|=oe.charCodeAt(xe)<<xe%4*8;return me[xe>>2]|=128<<xe%4*8,me[16*Ee-2]=8*oe.length,me}(e);let b,w,_,S,F,B=1732584193,j=-271733879,K=-1732584194,X=271733878;for(b=0;b<f.length;b+=16)w=B,_=j,S=K,F=X,B=l(B,j,K,X,f[b+0],7,-680876936),X=l(X,B,j,K,f[b+1],12,-389564586),K=l(K,X,B,j,f[b+2],17,606105819),j=l(j,K,X,B,f[b+3],22,-1044525330),B=l(B,j,K,X,f[b+4],7,-176418897),X=l(X,B,j,K,f[b+5],12,1200080426),K=l(K,X,B,j,f[b+6],17,-1473231341),j=l(j,K,X,B,f[b+7],22,-45705983),B=l(B,j,K,X,f[b+8],7,1770035416),X=l(X,B,j,K,f[b+9],12,-1958414417),K=l(K,X,B,j,f[b+10],17,-42063),j=l(j,K,X,B,f[b+11],22,-1990404162),B=l(B,j,K,X,f[b+12],7,1804603682),X=l(X,B,j,K,f[b+13],12,-40341101),K=l(K,X,B,j,f[b+14],17,-1502002290),j=l(j,K,X,B,f[b+15],22,1236535329),B=A(B,j,K,X,f[b+1],5,-165796510),X=A(X,B,j,K,f[b+6],9,-1069501632),K=A(K,X,B,j,f[b+11],14,643717713),j=A(j,K,X,B,f[b+0],20,-373897302),B=A(B,j,K,X,f[b+5],5,-701558691),X=A(X,B,j,K,f[b+10],9,38016083),K=A(K,X,B,j,f[b+15],14,-660478335),j=A(j,K,X,B,f[b+4],20,-405537848),B=A(B,j,K,X,f[b+9],5,568446438),X=A(X,B,j,K,f[b+14],9,-1019803690),K=A(K,X,B,j,f[b+3],14,-187363961),j=A(j,K,X,B,f[b+8],20,1163531501),B=A(B,j,K,X,f[b+13],5,-1444681467),X=A(X,B,j,K,f[b+2],9,-51403784),K=A(K,X,B,j,f[b+7],14,1735328473),j=A(j,K,X,B,f[b+12],20,-1926607734),B=u(B,j,K,X,f[b+5],4,-378558),X=u(X,B,j,K,f[b+8],11,-2022574463),K=u(K,X,B,j,f[b+11],16,1839030562),j=u(j,K,X,B,f[b+14],23,-35309556),B=u(B,j,K,X,f[b+1],4,-1530992060),X=u(X,B,j,K,f[b+4],11,1272893353),K=u(K,X,B,j,f[b+7],16,-155497632),j=u(j,K,X,B,f[b+10],23,-1094730640),B=u(B,j,K,X,f[b+13],4,681279174),X=u(X,B,j,K,f[b+0],11,-358537222),K=u(K,X,B,j,f[b+3],16,-722521979),j=u(j,K,X,B,f[b+6],23,76029189),B=u(B,j,K,X,f[b+9],4,-640364487),X=u(X,B,j,K,f[b+12],11,-421815835),K=u(K,X,B,j,f[b+15],16,530742520),j=u(j,K,X,B,f[b+2],23,-995338651),B=m(B,j,K,X,f[b+0],6,-198630844),X=m(X,B,j,K,f[b+7],10,1126891415),K=m(K,X,B,j,f[b+14],15,-1416354905),j=m(j,K,X,B,f[b+5],21,-57434055),B=m(B,j,K,X,f[b+12],6,1700485571),X=m(X,B,j,K,f[b+3],10,-1894986606),K=m(K,X,B,j,f[b+10],15,-1051523),j=m(j,K,X,B,f[b+1],21,-2054922799),B=m(B,j,K,X,f[b+8],6,1873313359),X=m(X,B,j,K,f[b+15],10,-30611744),K=m(K,X,B,j,f[b+6],15,-1560198380),j=m(j,K,X,B,f[b+13],21,1309151649),B=m(B,j,K,X,f[b+4],6,-145523070),X=m(X,B,j,K,f[b+11],10,-1120210379),K=m(K,X,B,j,f[b+2],15,718787259),j=m(j,K,X,B,f[b+9],21,-343485551),B=r(B,w),j=r(j,_),K=r(K,S),X=r(X,F);return s(B)+s(j)+s(K)+s(X)}let hZ=1,JL=console,ai=class{static setLogger(e){JL=e}constructor(e,t){As(this,"id",void 0),As(this,"lockingPromise",pt.resolve()),As(this,"locks",0),As(this,"name",""),As(this,"lockId",void 0),this.lockId=hZ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");JL.debug("".concat(s," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const s=new pt(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>s),r}};function pf(e,t){return function(s,r,i){const l=i.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const A=this[t];if(!A)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const u=await A.lock("From ".concat(e,".").concat(r));try{for(var m=arguments.length,f=new Array(m),b=0;b<m;b++)f[b]=arguments[b];return await l.apply(this,f)}finally{u()}},i}}const gn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lw(e,t){const s=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,s)}function jl(e,t,s,r){const i=Object.assign({},gn,r);let l=i.timeout;const A=async()=>{await function(f){return new pt(b=>{window.setTimeout(b,f)})}(l),l*=i.timeoutFactor,l=Math.min(i.maxRetryTimeout,l)};let u=!1;const m=new pt(async(f,b)=>{t=t||(()=>!1),s=s||(()=>!0);for(let w=0;w<i.maxRetryCount;w+=1){if(u)return b(new Fe(W.OPERATION_ABORTED));try{const _=await e();if(!t(_,w)||w+1===i.maxRetryCount)return f(_);await A()}catch(_){if(!s(_,w)||w+1===i.maxRetryCount)return b(_);await A()}}});return m.cancel=()=>u=!0,m}let dw,B1=class{constructor(e){As(this,"input",[]),As(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:za(e=this.input).call(e,(t,s)=>t+s)/this.input.length}},Aw=0,L1=0;function j1(e,t,s,r){return new pt((i,l)=>{t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),Aw+=Nd(t.data)):s&&(t.data.size?Aw+=t.data.size:t.data instanceof FormData?Aw+=KL(t.data):Aw+=Nd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Da.request(t).then(A=>{typeof A.data=="string"?L1+=Nd(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?L1+=A.data.byteLength:L1+=Nd(JSON.stringify(A.data)),i(A.data)}).catch(A=>{Da.isCancel(A)?l(new Fe(W.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?l(new Fe(W.NETWORK_TIMEOUT,A.message)):A.response?l(new Fe(W.NETWORK_RESPONSE_ERROR,A.response.status)):l(new Fe(W.NETWORK_ERROR,A.message))})})}async function pZ(e,t){const s=new Blob([t.data],{type:"buffer"});return await j1(e,at(at({},t),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const $L=()=>window.isSecureContext!==void 0;function Yc(e){if(Array.isArray(e))return e.map(s=>s);if(!ZL(e))return e;const t={};for(const s in e){const r=e[s];ZL(r)||Array.isArray(r)?t[s]=Yc(r):t[s]=r}return t}function ZL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let P1=class{constructor(e){As(this,"input",[]),As(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Xc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},V0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Xc,remoteCandidate:Xc},updateInterval:0},ej={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},tj={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},sj={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},rj={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let U1=class{constructor(e,t){As(this,"onFirstVideoReceived",void 0),As(this,"onFirstVideoDecoded",void 0),As(this,"onFirstAudioReceived",void 0),As(this,"onFirstVideoDecodedTimeout",void 0),As(this,"onFirstAudioDecoded",void 0),As(this,"onSelectedLocalCandidateChanged",void 0),As(this,"onSelectedRemoteCandidateChanged",void 0),As(this,"videoIsReady",!1),As(this,"videoIsReady2",{}),As(this,"pc",void 0),As(this,"options",void 0),As(this,"intervalTimer",void 0),As(this,"stats",Yc(V0)),As(this,"isFirstVideoReceived",{}),As(this,"isFirstVideoDecoded",{}),As(this,"isFirstAudioReceived",{}),As(this,"isFirstAudioDecoded",{}),As(this,"isFirstVideoDecodedTimeout",{}),As(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pt(e=>{e({local:at({},Xc),remote:at({},Xc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,l=0,A=0;for(const u of s)e[u].forEach((m,f)=>{if(!this.lossRateWindowStats[t-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const b=this.lossRateWindowStats[t-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,w=this.lossRateWindowStats[t-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(r+=b,l+=w):(i+=b,A+=w),Number.isNaN(b)||Number.isNaN(b)?m.packetLostRate=0:m.packetLostRate=b<=0||w<=0?0:w/(b+w)});e.sendPacketLossRate=r<=0||l<=0?0:l/(r+l),e.recvPacketLossRate=i<=0||A<=0?0:A/(i+A)}},mZ=class extends U1{constructor(){super(...arguments),As(this,"_stats",V0),As(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Yc(V0);const s=t.filter(i=>i.type==="ssrc");this.processSSRCStats(s);const r=t.find(i=>i.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var s;const r=et(s=t.id).call(s,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const i=Yc(tj);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{const i=Yc(ej),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),l){const A=l.stats,u=Date.now()-l.lts;i.framesDecodeFreezeTime=A.framesDecodeFreezeTime,i.framesDecodeInterval=A.framesDecodeInterval,i.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(l.lts=Date.now(),i.framesDecodeInterval=u,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<l.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:at({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{const i=Yc(rj);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{const i=Yc(sj);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new pt((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(s=>{const r={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(i=>{r[i]=s.stat(i)}),t.push(r)}),t}},mf=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),uw=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),F1=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Mo=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var ff=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(ff||{});function Q0(e,t,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ff.kNone;if(!t)return;const l=Number(t[s]);if(typeof l!="number")return;const A=Number(t[r]);if(typeof A!="number")return;if(!e)return A?l/A*i:void 0;const u=Number(e[s]);if(typeof u!="number")return;const m=Number(e[r]);if(typeof m!="number")return;const f=A-m;return f?(l-u)/f*i:void 0}let nj=class extends U1{constructor(){super(...arguments),As(this,"_stats",V0),As(this,"report",void 0),As(this,"lastDecodeVideoReceiverStats",new Map),As(this,"lastVideoFramesRecv",new Map),As(this,"lastVideoFramesSent",new Map),As(this,"lastVideoFramesDecode",new Map),As(this,"lastVideoFramesOutput",new Map),As(this,"lastVideoJBDelay",new Map),As(this,"lastAudioJBDelay",new Map),As(this,"mediaBytesSent",new Map),As(this,"mediaBytesRetransmit",new Map),As(this,"mediaBytesTargetEncode",new Map),As(this,"lastDecodeAudioReceiverStats",new Map),As(this,"lastAudioConcealment",new Map),As(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Yc(V0),this.report.forEach(e=>{switch(e.type){case Mo.OUTBOUND:case Mo.INBOUND:{const t=e.mediaType||e.kind,s=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Mo.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||s)&&this.processVideoOutboundStats(e):e.type===Mo.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||s)&&this.processVideoInboundStats(e));break}case Mo.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Mo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:at({},Xc),remote:at({},Xc)};return e.forEach(s=>{let r;if(s.type===Mo.TRANSPORT&&(r=e.get(s.selectedCandidatePairId)),s.type===Mo.CANDIDATE_PAIR&&s.selected&&(r=s),r){const i=(l,A)=>{l.type=A.type,l.id=A.id,A.address&&(l.address=A.address),A.candidateType&&(l.candidateType=A.candidateType),A.port&&(l.port=A.port),A.priority&&(l.priority=A.priority),A.protocol&&(l.protocol=A.protocol),A.relayProtocol&&(l.relayProtocol=A.relayProtocol)};if(r.localCandidateId){const l=e.get(r.localCandidateId);l&&i(t.local,l)}if(r.remoteCandidateId){const l=e.get(r.remoteCandidateId);l&&i(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Mo.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Mo.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Mo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(at({},t),at({},this.stats.selectedCandidatePair.localCandidate)),e.type===Mo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(at({},t),at({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Yc(rj),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const s=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Q0(s,t,"totalProcessingDelay","jitterBufferEmittedCount",ff.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,s,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,at({},t))}calculateAudioFreeze(e,t,s){const r=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&r!=null){const i=r.lts,l=s.timestamp,A=l-i;if(A<=0)return;const u=e.concealedSamples-t.concealedSamples-0,m=r.nonSilent+u,f=e.totalSamplesReceived-t.totalSamplesReceived;if(f<=0)return;const b=80*f/A,w=200*f/A,_=A/f;let S=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>b&&(r.plc80>0?(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*_)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*_)),S=r.plc80+1);let F=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>w&&(r.plc200>0?(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*_)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*_)),F=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:u,lts:l,plc80:S,plc200:F})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(A=>A.ssrc===e.ssrc);t||(t=Yc(ej),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const s=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const A=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,A,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(s){const A=s.stats,u=l-s.lts;t.framesDecodeFreezeTime=A.framesDecodeFreezeTime,t.framesDecodeInterval=A.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(s.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<A.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Q0(s==null?void 0:s.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Q0(s==null?void 0:s.stats,t,"totalProcessingDelay","framesDecodeCount",ff.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Q0(s==null?void 0:s.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",ff.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Q0(s==null?void 0:s.stats,t,"totalInterFrameDelay","framesDecodeCount",ff.kMillisecondsFromSeconds),r&&l-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((l-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&l-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((l-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:at({},t),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Yc(tj),this._stats.videoSend.push(t));const s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{const r=new P1(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const i=new P1(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const i=new P1(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const i=e.framesEncoded-r.lastFrameCount,l=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*l/i}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Mo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(t||(t=Yc(sj),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,Mo.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var s;const r=Array.from(wo(s=this.report).call(s)).find(i=>i.type===t&&i.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(t.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,t){const s=this.report.get(e);s&&(t.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,t,s){var r,i,l,A;const u=t?this.report.get(t):void 0,m=(r=u==null?void 0:u.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof m!="number")return;let f=(i=u==null?void 0:u.frameWidth)!==null&&i!==void 0?i:e.frameWidth,b=(l=u==null?void 0:u.frameHeight)!==null&&l!==void 0?l:e.frameHeight,w=(A=u==null?void 0:u.framesPerSecond)!==null&&A!==void 0?A:e.framesPerSecond;if(typeof f=="number"&&typeof b=="number"||(f=0,b=0),w==null){const _=Date.now(),S=this.lastVideoFramesSent.get(s.ssrc);S&&_-S.lts>=800?(w=Math.round((m-S.count)/((_-S.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:m,lts:_,rate:w})):S?w=S.rate:this.lastVideoFramesSent.set(s.ssrc,{count:m,lts:_,rate:0})}s.sentFrame={width:f,height:b,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,t,s){var r,i,l,A,u;const m=t?this.report.get(t):void 0,f=(r=m==null?void 0:m.framesReceived)!==null&&r!==void 0?r:e.framesReceived,b=(i=m==null?void 0:m.frameWidth)!==null&&i!==void 0?i:e.frameWidth,w=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,_=(A=m==null?void 0:m.jitterBufferDelay)!==null&&A!==void 0?A:e.jitterBufferDelay,S=(u=m==null?void 0:m.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof f=="number"){const F=this.lastVideoFramesRecv.get(s.ssrc),B=Date.now();s.framesReceivedCount=f;let j=0;F&&B-F.lts>=800?(j=Math.round((f-F.count)/((B-F.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:f,lts:B,rate:j})):F?j=F.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:f,lts:B,rate:0}),s.receivedFrame={width:b||0,height:w||0,frameRate:j||0},s.decodedFrame={width:b||0,height:w||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:w||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(_&&S){const F=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let B=F.jitterBufferMs;const j=S-F.jitterBufferEmittedCount;j>0&&(B=1e3*(_-F.jitterBufferDelay)/j),s.jitterBufferMs=B,s.currentDelayMs=Math.round(B),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:S,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,t,s){var r,i,l,A;const u=t?this.report.get(t):void 0,m=(r=(i=u==null?void 0:u.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&r!==void 0?r:0,f=(l=(A=u==null?void 0:u.echoReturnLossEnhancement)!==null&&A!==void 0?A:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;s.aecReturnLoss=m,s.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,s){var r,i,l,A,u,m,f,b,w;const _=t?this.report.get(t):void 0,S=(r=_==null?void 0:_.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,F=(i=_==null?void 0:_.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,B=(l=_==null?void 0:_.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,j=(A=_==null?void 0:_.jitterBufferEmittedCount)!==null&&A!==void 0?A:e.jitterBufferEmittedCount,K=(u=_==null?void 0:_.audioLevel)!==null&&u!==void 0?u:e==null?void 0:e.audioLevel,X=(m=_==null?void 0:_.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,oe=(f=_==null?void 0:_.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples,xe=(b=_==null?void 0:_.silentConcealedSamples)!==null&&b!==void 0?b:e.silentConcealedSamples,Ee=(w=_==null?void 0:_.concealmentEvents)!==null&&w!==void 0?w:e.concealmentEvents;if(typeof F=="number"&&(s.totalSamplesReceived=F),typeof xe=="number"&&(s.silentConcealedSamples=xe),typeof Ee=="number"&&(s.concealmentEvents=Ee),typeof oe=="number"&&(s.concealedSamples=oe),S&&F&&(s.accelerateRate=S/F),B&&j){const Re=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let He=Re.jitterBufferMs;const Xe=j-Re.jitterBufferEmittedCount;Xe>0&&(He=1e3*(B-Re.jitterBufferDelay)/Xe),s.jitterBufferMs=Math.round(He),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:B,jitterBufferEmittedCount:j,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=K;let me=1920;X&&F&&(me=F/X/50,s.receivedFrames=Math.round(F/me)),oe&&(s.droppedFrames=Math.round(oe/me))}processRemoteInboundStats(e,t){const s=this.report.get(e);s&&(t.packetsLost=s.packetsLost,s.roundTripTime&&(t.rttMs=1e3*s.roundTripTime),s.jitter&&(t.jitterMs=1e3*s.jitter),s.timestamp&&(t.timestamp=s.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const s=t.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,t=null,s=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{s=s===null?i.diffMean():s+i.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},fZ=class extends U1{updateStats(){return pt.resolve()}};function hw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const A=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return A&&A[0]?Number(A[0].split("/")[1]):null}();return l?l<76?new mZ(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new nj(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(A){if(!window.RTCStatsReport)return!1;const u=A.getStats();return!!(u instanceof pt||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(u))}(e)?new nj(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new fZ(e,{updateInterval:t,lossRateInterval:s,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const ij="websdk_ng_install_id";function M1(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let e=window.localStorage.getItem(ij);return e||(e=cp(),window.localStorage.setItem(ij,e)),xr("INSTALL_ID",e),e}catch{return}}const fc=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const s=t[1],r=t[2];return"".concat(s,".").concat(r)}return"4.0.0.999"}("4.24.2"),V1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let lp=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Oi=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const r=s.join(""),i=[];for(let u=0;u<6;u++)i.push("1");const l=i.join(""),A={};return A[e]=r,A[t]=l,Object.assign(A,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Oi;const pw={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Q1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},H1="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",G1={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},Ar=at(at(at(at({},G1),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Q1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},pw),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function xr(e,t,s){var r,i,l;et(r=Object.keys(Ar)).call(r,e)&&(!s&&et(i=Object.keys(Vo)).call(i,e)||(Ar[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(Ar.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,Ar.USE_NEW_NETWORK_CONFIG=l,l&&(Ar.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ar.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ar.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ar.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ar.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ar.ENABLE_INSTANT_VIDEO=!0,Ar.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ar.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Ar.NEW_TURN_MODE||(Ar.NEW_TURN_MODE=4))))}function G(e){if(e==="TURN_DOMAINS"){const t=Ar.TURN_DOMAINS;return et(t).call(t,G("TURN_DOMAIN"))?t:[G("TURN_DOMAIN")].concat(t)}return Ar[e]}V1||(Ar.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ar.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ar.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ar.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ar.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ar.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ar.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ar.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ar.AREAS=["NORTH_AMERICA","OVERSEA"]);let aj=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Vo={};var is=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(is||{});let dp=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const oj=128,gZ=96,cj=1e3,gf=10;let bZ=0;var lj=(()=>{var e={8:(r,i,l)=>{l.r(i),l.d(i,{Parser:()=>Xe,Printer:()=>ps,parse:()=>ct,print:()=>Rt});const A=`
`,u="".concat("\r").concat(A),m=" ";let f;function b(Ye){return Ye>="0"&&Ye<="9"}function w(Ye){return Ye>="!"&&Ye<="~"}function _(Ye){return w(Ye)||Ye>=""&&Ye<=""}function S(Ye){return Ye==="!"||Ye>="#"&&Ye<="'"||Ye>="*"&&Ye<="+"||Ye>="-"&&Ye<="."||Ye>="0"&&Ye<="9"||Ye>="A"&&Ye<="Z"||Ye>="^"&&Ye<="~"}function F(Ye){return Ye>="1"&&Ye<="9"}function B(Ye){return Ye>="A"&&Ye<="Z"||Ye>="a"&&Ye<="z"}function j(Ye){return Ye==="d"||Ye==="h"||Ye==="m"||Ye==="s"}function K(Ye){return Ye>""&&Ye<"	"||Ye>"\v"&&Ye<"\f"||Ye>""&&Ye<""}function X(Ye){return B(Ye)||b(Ye)||Ye==="+"||Ye==="/"}function oe(Ye){return b(Ye)||B(Ye)||Ye==="+"||Ye==="/"||Ye==="-"||Ye==="_"}function xe(Ye){return B(Ye)||b(Ye)||Ye==="+"||Ye==="/"}function Ee(Ye,D){var ae=Object.keys(Ye);if(Object.getOwnPropertySymbols){var be=Object.getOwnPropertySymbols(Ye);D&&(be=be.filter(function(nt){return Object.getOwnPropertyDescriptor(Ye,nt).enumerable})),ae.push.apply(ae,be)}return ae}function me(Ye){for(var D=1;D<arguments.length;D++){var ae=arguments[D]!=null?arguments[D]:{};D%2?Ee(Object(ae),!0).forEach(function(be){Re(Ye,be,ae[be])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ye,Object.getOwnPropertyDescriptors(ae)):Ee(Object(ae)).forEach(function(be){Object.defineProperty(Ye,be,Object.getOwnPropertyDescriptor(ae,be))})}return Ye}function Re(Ye,D,ae){return D in Ye?Object.defineProperty(Ye,D,{value:ae,enumerable:!0,configurable:!0,writable:!0}):Ye[D]=ae,Ye}(function(Ye){Ye.VERSION="v",Ye.ORIGIN="o",Ye.SESSION_NAME="s",Ye.INFORMATION="i",Ye.URI="u",Ye.EMAIL="e",Ye.PHONE="p",Ye.CONNECTION="c",Ye.BANDWIDTH="b",Ye.TIME="t",Ye.REPEAT="r",Ye.ZONE_ADJUSTMENTS="z",Ye.KEY="k",Ye.ATTRIBUTE="a",Ye.MEDIA="m"})(f||(f={}));class He{consumeText(D,ae){let be=ae;for(;be<D.length;){const nt=D[be];if(nt==="\0"||nt==="\r"||nt===A)break;be+=1}if(be-ae==0)throw new Error("Invalid text, at ".concat(D));return be}consumeUnicastAddress(D,ae,be){return this.consumeTill(D,ae,m)}consumeOneOrMore(D,ae,be){let nt=ae;for(;be(D[nt]);)nt++;if(nt-ae==0)throw new Error("Invalid rule at ".concat(ae,"."));return nt}consumeSpace(D,ae){if(D[ae]===m)return ae+1;throw new Error("Invalid space at ".concat(ae,"."))}consumeIP4Address(D,ae){let be=ae;for(let nt=0;nt<4;nt++)if(be=this.consumeDecimalUChar(D,be),nt!==3){if(D[be]!==".")throw new Error("Invalid IP4 address.");be++}return be}consumeDecimalUChar(D,ae){let be=ae;for(let ls=0;ls<3&&b(D[be]);ls++,be++);if(be-ae==0)throw new Error("Invalid decimal uchar.");const nt=parseInt(D.slice(ae,be));if(nt>=0&&nt<=255)return be;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,ae){let be=this.consumeHexpart(D,ae);return D[be]===":"&&(be+=1,be=this.consumeIP4Address(D,be)),be}consumeHexpart(D,ae){let be=ae;if(D[be]===":"&&D[be+1]===":"){be+=2;try{be=this.consumeHexseq(D,be)}catch{}return be}if(be=this.consumeHexseq(D,be),D[be]===":"&&D[be+1]===":"){be+=2;try{be=this.consumeHexseq(D,be)}catch{}return be}return be}consumeHexseq(D,ae){let be=ae;for(;be=this.consumeHex4(D,be),D[be]===":"&&D[be+1]!==":";)be+=1;return be}consumeHex4(D,ae){let be=0;for(;be<4;be++)if(!((nt=D[ae+be])>="0"&&nt<="9"||nt>="a"&&nt<="f"||nt>="A"&&nt<="F")){if(be===0)throw new Error("Invalid hex 4");break}var nt;return ae+be}consumeFQDN(D,ae){let be=ae;for(;b(D[be])||B(D[be])||D[be]==="-"||D[be]===".";)be+=1;if(be-ae<4)throw new Error("Invalid FQDN");return be}consumeExtnAddr(D,ae){return this.consumeOneOrMore(D,ae,_)}consumeMulticastAddress(D,ae,be){switch(be){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,ae);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,ae);default:try{return this.consumeFQDN(D,ae)}catch{return this.consumeExtnAddr(D,ae)}}}consumeIP6MulticastAddress(D,ae){const be=this.consumeHexpart(D,ae);return D[be]==="/"?this.consumeInteger(D,be+1):be}consumeIP4MulticastAddress(D,ae){let be=ae+3;const nt=D.slice(ae,be),ls=parseInt(nt);if(ls<224||ls>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Tr=0;Tr<3;Tr++){if(D[be]!==".")throw new Error("Invalid IP4 multicast address.");be+=1,be=this.consumeDecimalUChar(D,be)}return D[be]==="/"&&(be+=1),be=this.consumeTTL(D,be),D[be]==="/"&&(be=this.consumeInteger(D,be)),be}consumeInteger(D,ae){if(!F(D[ae]))throw new Error("Invalid integer.");for(ae+=1;b(D[ae]);)ae+=1;return ae}consumeTTL(D,ae){if(D[ae]==="0")return ae+1;if(!F(D[ae]))throw new Error("Invalid TTL.");ae+=1;for(let be=0;be<2&&b(D[ae]);be++)ae+=1;return ae}consumeToken(D,ae){return this.consumeOneOrMore(D,ae,S)}consumeTime(D,ae){let be=ae;if(D[be]==="0")return be+1;for(F(D[be])&&(be+=1);b(D[be]);)be++;if(be-ae<10)throw new Error("Invalid time");return be}consumeAddress(D,ae){return this.consumeTill(D,ae,m)}consumeTypedTime(D,ae){let be=ae;return be=this.consumeOneOrMore(D,be,b),j(D[be])?be+1:be}consumeRepeatInterval(D,ae){if(!F(D[ae]))throw new Error("Invalid repeat interval");for(ae+=1;b(D[ae]);)ae+=1;return j(D[ae])&&(ae+=1),ae}consumePort(D,ae){return this.consumeOneOrMore(D,ae,b)}consume(D,ae,be){for(let nt=0;nt<be.length;nt++){if(ae+nt>=D.length)throw new Error("consume exceeding value length");if(D[ae+nt]!==be[nt])throw new Error("consume ".concat(be," failed at ").concat(nt))}return ae+be.length}consumeTill(D,ae,be){let nt=ae;for(;nt<D.length&&(typeof be!="string"||D[nt]!==be)&&(typeof be!="function"||!be(D[nt]));)nt++;return nt}}class Xe extends He{constructor(){super(),Re(this,"records",[]),Re(this,"currentLine",0)}parse(D){const ae=this.probeEOL(D);this.records=D.split(ae).filter(Ku=>!!ma(Ku).call(Ku)).map(this.parseLine),this.currentLine=0;const be=this.parseVersion(),nt=this.parseOrigin(),ls=this.parseSessionName(),Tr=this.parseInformation(),Zn=this.parseUri(),Cc=this.parseEmail(),Gu=this.parsePhone(),I_=this.parseConnection(),Yf=this.parseBandWidth(),O_=this.parseTimeFields(),Bp=this.parseKey(),Sb=this.parseSessionAttribute(),Lp=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:be,origin:nt,sessionName:ls,information:Tr,uri:Zn,emails:Cc,phones:Gu,connection:I_,bandwidths:Yf,timeFields:O_,key:Bp,attributes:Sb,mediaDescriptions:Lp}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let ae=0;ae<D.length;ae++)if(D[ae]===A)return D[ae-1]==="\r"?u:A;throw new Error("Invalid newline character.")}parseLine(D,ae){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const be=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:be,value:D.slice(2),line:ae,cur:0}}parseSessionAttribute(){const D=new ns;for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==f.ATTRIBUTE)break;const be={attField:this.extractOneOrMore(ae,nt=>S(nt)&&nt!==":"),_cur:0};ae.value[ae.cur]===":"&&(ae.cur+=1,be.attValue=this.extractOneOrMore(ae,K)),D.parse(be),this.currentLine++}return D.digest()}parseMediaAttributes(D){const ae=new es(D);for(;this.currentLine<this.records.length;){const be=this.getCurrentRecord();if(be.type!==f.ATTRIBUTE)break;const nt={attField:this.extractOneOrMore(be,ls=>S(ls)&&ls!==":"),_cur:0};be.value[be.cur]===":"&&(be.cur+=1,nt.attValue=this.extractOneOrMore(be,K)),ae.parse(nt),this.currentLine++}return ae.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===f.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===f.ZONE_ADJUSTMENTS){const ae=[];for(;;)try{const be=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let nt=!1;D.value[D.cur]==="-"&&(nt=!0,D.cur+=1);const ls=this.extract(D,this.consumeTypedTime);ae.push({time:be,typedTime:ls,back:nt})}catch{break}if(ae.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ae}return[]}parseRepeat(){const D=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==f.REPEAT)break;{const be=this.extract(ae,this.consumeRepeatInterval),nt=this.parseTypedTime(ae);D.push({repeatInterval:be,typedTimes:nt}),this.currentLine++}}return D}parseTypedTime(D){const ae=[];for(;;)try{this.consumeSpaceForRecord(D),ae.push(this.extract(D,this.consumeTypedTime))}catch{break}if(ae.length===0)throw new Error("Invalid typed time.");return ae}parseTime(){const D=this.getCurrentRecord(),ae=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const be=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:ae,stopTime:be}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==f.BANDWIDTH)break;{const be=this.extractOneOrMore(ae,S);if(ae.value[ae.cur]!==":")throw new Error("Invalid bandwidth field.");ae.cur++;const nt=this.extractOneOrMore(ae,b);D.push({bwtype:be,bandwidth:nt}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==f.VERSION)throw new Error("first sdp record must be version");const ae=D.value.slice(0,this.consumeOneOrMore(D.value,0,b));if(ae.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,ae}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");const ae=this.extractOneOrMore(D,_);this.consumeSpaceForRecord(D);const be=this.extractOneOrMore(D,b);this.consumeSpaceForRecord(D);const nt=this.extractOneOrMore(D,b);this.consumeSpaceForRecord(D);const ls=this.extractOneOrMore(D,S);this.consumeSpaceForRecord(D);const Tr=this.extractOneOrMore(D,S);this.consumeSpaceForRecord(D);const Zn=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:ae,sessId:be,sessVersion:nt,nettype:ls,addrtype:Tr,unicastAddress:Zn}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===f.SESSION_NAME){const ae=this.extract(D,this.consumeText);return this.currentLine++,ae}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==f.INFORMATION)return;const ae=this.extract(D,this.consumeText);return this.currentLine++,ae}parseUri(){const D=this.getCurrentRecord();if(D.type===f.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==f.EMAIL)break;D.push(ae.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==f.PHONE)break;D.push(ae.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===f.CONNECTION){const ae=this.extractOneOrMore(D,S);this.consumeSpaceForRecord(D);const be=this.extractOneOrMore(D,S);this.consumeSpaceForRecord(D);const nt=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:ae,addrtype:be,address:nt}}}parseMedia(){const D=this.getCurrentRecord(),ae=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let be=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,be+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const nt=[];for(nt.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,nt.push(this.extract(D,this.consumeToken));if(nt.length===0)throw new Error("Invalid proto");const ls=this.parseFmt(D);return this.currentLine++,{mediaType:ae,port:be,protos:nt,fmts:ls}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===f.TIME;){const ae=this.parseTime(),be=this.parseRepeat(),nt=this.parseZone();D.push({time:ae,repeats:be,zones:nt})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){const ae=this.parseMedia(),be=this.parseInformation(),nt=this.parseConnections(),ls=this.parseBandWidth(),Tr=this.parseKey(),Zn=this.parseMediaAttributes(ae);D.push({media:ae,information:be,connections:nt,bandwidths:ls,key:Tr,attributes:Zn})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const ae=[];for(;;)try{this.consumeSpaceForRecord(D),ae.push(this.extract(D,this.consumeToken))}catch{break}if(ae.length===0)throw new Error("Invalid fmts");return ae}extract(D,ae){for(var be=arguments.length,nt=new Array(be>2?be-2:0),ls=2;ls<be;ls++)nt[ls-2]=arguments[ls];const Tr=ae.call(this,D.value,D.cur,...nt),Zn=D.value.slice(D.cur,Tr);return D.cur=Tr,Zn}extractOneOrMore(D,ae){const be=this.consumeOneOrMore(D.value,D.cur,ae),nt=D.value.slice(D.cur,be);return D.cur=be,nt}consumeSpaceForRecord(D){if(D.value[D.cur]!==m)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class _t extends He{constructor(){super(...arguments),Re(this,"attributes",void 0),Re(this,"digested",!1)}extractOneOrMore(D,ae,be){const nt=this.consumeOneOrMore(D.attValue,D._cur,ae),ls=D.attValue.slice(D._cur,nt),[Tr,Zn]=be||[];if(typeof Tr=="number"&&ls.length<Tr)throw new Error("error in length, should be more or equal than ".concat(Tr," characters."));if(typeof Zn=="number"&&ls.length>Zn)throw new Error("error in length, should be less or equal than ".concat(Zn," characters."));return D._cur=nt,ls}consumeAttributeSpace(D){if(D.attValue[D._cur]!==m)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,ae){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var be=arguments.length,nt=new Array(be>2?be-2:0),ls=2;ls<be;ls++)nt[ls-2]=arguments[ls];const Tr=ae.call(this,D.attValue,D._cur,...nt),Zn=D.attValue.slice(D._cur,Tr);return D._cur=Tr,Zn}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,ae){if(!D.attValue)throw new Error;for(let be=0;be<ae.length;be++)if(ae[be]!==D.attValue[D._cur+be])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,X,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,X,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ae=[];for(;!this.atEnd(D);){ae.push(this.extractOneOrMore(D,X));try{this.consumeAttributeSpace(D)}catch(be){if(this.atEnd(D))break;throw be}}this.attributes.iceOptions=ae}parseFingerprint(D){const ae=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const be=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ae,fingerprint:be})}parseExtmap(D){const ae=this.extractOneOrMore(D,b);let be;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),be=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const nt=this.extract(D,this.consumeTill,m),ls=me(me({entry:parseInt(ae,10)},be&&{direction:be}),{},{extensionName:nt});this.peekChar(D)===m&&(this.consumeAttributeSpace(D),ls.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(ls)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ae=this.extract(D,this.consumeTill);if(ae!=="active"&&ae!=="passive"&&ae!=="actpass"&&ae!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ae}}class ns extends _t{constructor(){super(...arguments),Re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ae){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ae}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const ae=this.extract(D,this.consumeToken),be=[];for(;!this.atEnd(D)&&this.peekChar(D)===m;)this.consumeAttributeSpace(D),be.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:ae,identificationTag:be})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,oe)}parseIdentity(D){const ae=this.extractOneOrMore(D,xe),be=[];for(;!this.atEnd(D)&&this.peekChar(D)===m;){this.consumeAttributeSpace(D);const nt=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const ls=this.extractOneOrMore(D,Tr=>Tr!==m&&K(Tr));be.push({name:nt,value:ls})}this.attributes.identities.push({assertionValue:ae,extensions:be})}parseMsidSemantic(D){this.peekChar(D)===m&&this.consumeAttributeSpace(D);const ae={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),ae.applyForAll=!0;break}{const be=this.extract(D,this.consumeTill,m);ae.identifierList.push(be)}}this.attributes.msidSemantic=ae}}class es extends _t{constructor(D){super(),Re(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(ae){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),ae}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const ae=this.extractOneOrMore(D,X,[1,32]);this.consumeAttributeSpace(D);const be=this.extractOneOrMore(D,b,[1,5]);this.consumeAttributeSpace(D);const nt=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const ls=this.extractOneOrMore(D,b,[1,10]);this.consumeAttributeSpace(D);const Tr=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Zn=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const Cc={foundation:ae,componentId:be,transport:nt,priority:ls,connectionAddress:Tr,port:Zn,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),Cc.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),Cc.relPort=this.extract(D,this.consumePort));this.peekChar(D)===m;){this.consumeAttributeSpace(D);const Gu=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),Cc.extension[Gu]=this.extractOneOrMore(D,w)}this.attributes.candidates.push(Cc)}parseRemoteCandidate(D){const ae=[];for(;;){const be=this.extractOneOrMore(D,b,[1,5]);this.consumeAttributeSpace(D);const nt=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const ls=this.extract(D,this.consumePort);ae.push({componentId:be,connectionAddress:nt,port:ls});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(ae)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const ae=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const be=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const nt={encodingName:be,clockRate:this.extractOneOrMore(D,b)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),nt.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const ls=this.attributes.payloads.find(Tr=>Tr.payloadType===parseInt(ae,10));ls?ls.rtpMap=nt:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtpMap:nt,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const ae=this.extractOneOrMore(D,b);this.consumeAttributeSpace(D);const be=this.extract(D,this.consumeTill,":");let nt;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),nt=this.extract(D,this.consumeTill));const ls=this.attributes.ssrcs.find(Tr=>Tr.ssrcId===parseInt(ae,10));ls?ls.attributes[be]=nt:this.attributes.ssrcs.push({ssrcId:parseInt(ae,10),attributes:{[be]:nt}})}parseFmtp(D){const ae=this.extract(D,this.consumeTill,m);this.consumeAttributeSpace(D);const be=this.extract(D,this.consumeTill),nt={};be.split(";").forEach(Tr=>{let[Zn,Cc]=Tr.split("=");Zn=ma(Zn).call(Zn);const Gu=typeof Cc=="string"?ma(Cc).call(Cc):null;typeof Zn=="string"&&Zn.length>0&&(nt[Zn]=Gu)});const ls=this.attributes.payloads.find(Tr=>Tr.payloadType===parseInt(ae,10));ls?ls.fmtp={parameters:nt}:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[],fmtp:{parameters:nt}})}parseFmtParameters(D){const ae={},be=this.extract(D,this.consumeTill,"=");D._cur++;const nt=this.extract(D,this.consumeTill,";");for(ae[be]=nt;D.attValue[D._cur]===";";){const ls=this.extract(D,this.consumeTill,"=");D._cur++;const Tr=this.extract(D,this.consumeTill,";");ae[ls]=Tr}return ae}parseRtcpFb(D){let ae="";ae=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,m),this.consumeAttributeSpace(D);const be=this.extract(D,this.consumeTill,m);let nt;if(be==="trr-int")nt={type:be,interval:this.extract(D,this.consumeTill)};else{const ls={type:be};this.peekChar(D)===m&&(this.consumeAttributeSpace(D),ls.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===m&&(ls.additional=this.extract(D,this.consumeTill))),nt=ls}if(ae==="*")this.attributes.rtcpFeedbackWildcards.push(nt);else{const ls=this.attributes.payloads.find(Tr=>Tr.payloadType===parseInt(ae,10));ls?ls.rtcpFeedbacks.push(nt):this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[nt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ae={port:this.extract(D,this.consumePort)};this.peekChar(D)===m&&(this.consumeAttributeSpace(D),ae.netType=this.extractOneOrMore(D,S),this.consumeAttributeSpace(D),ae.addressType=this.extractOneOrMore(D,S),this.consumeAttributeSpace(D),ae.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=ae}parseMsid(D){const ae={id:this.extractOneOrMore(D,S,[1,64])};this.peekChar(D)===m&&(this.consumeAttributeSpace(D),ae.appdata=this.extractOneOrMore(D,S,[1,64])),this.attributes.msids.push(ae)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const ae=this.extractOneOrMore(D,nt=>B(nt)||b(nt)||nt==="_"||nt==="-");this.consumeAttributeSpace(D);const be={id:ae,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===m){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const nt=[];for(;;){const ls=this.extract(D,this.consumeToken);nt.push(ls);try{this.extract(D,this.consume,",")}catch{break}}be.payloads=nt,this.peekChar(D)===m&&this.extract(D,this.consume,m)}for(;;){const nt=this.extract(D,this.consumeToken);switch(nt){case"depend":{const ls={type:nt,rids:this.extract(D,this.consume,"=").split(",")};be.params.push(ls);break}default:{const ls={type:nt};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),ls.val=this.extract(D,this.consumeTill,";")),be.params.push(ls)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(be)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,b,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const ae=this.extract(D,this.consumeToken),be=[];for(;;)try{this.consumeAttributeSpace(D);const nt=this.extract(D,this.consumeInteger);be.push(parseInt(nt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ae,ssrcIds:be})}}function vs(Ye,D,ae){return D in Ye?Object.defineProperty(Ye,D,{value:ae,enumerable:!0,configurable:!0,writable:!0}):Ye[D]=ae,Ye}class ps{constructor(){vs(this,"eol",u)}print(D,ae){let be="";return ae&&(this.eol=ae),be+=this.printVersion(D.version),be+=this.printOrigin(D.origin),be+=this.printSessionName(D.sessionName),be+=this.printInformation(D.information),be+=this.printUri(D.uri),be+=this.printEmail(D.emails),be+=this.printPhone(D.phones),be+=this.printConnection(D.connection),be+=this.printBandwidth(D.bandwidths),be+=this.printTimeFields(D.timeFields),be+=this.printKey(D.key),be+=this.printSessionAttributes(D.attributes),be+=this.printMediaDescription(D.mediaDescriptions),be}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let ae="";for(const be of D)ae+="e=".concat(be).concat(this.eol);return ae}printPhone(D){let ae="";for(const be of D)ae+="e=".concat(be).concat(this.eol);return ae}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let ae="";for(const be of D)ae+="b=".concat(be.bwtype,":").concat(be.bandwidth).concat(this.eol);return ae}printTimeFields(D){let ae="";for(const be of D){ae+="t=".concat(be.time.startTime," ").concat(be.time.startTime).concat(this.eol);for(const nt of be.repeats)ae+="r=".concat(nt.repeatInterval," ").concat(nt.typedTimes.join(" ")).concat(this.eol);be.zoneAdjustments&&(ae+="z=",ae+="z=".concat(be.zoneAdjustments.map(nt=>"".concat(nt.time," ").concat(nt.back?"-":""," ").concat(nt.typedTime)).join(" ")).concat(this.eol),ae+=this.eol)}return ae}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let ae="";for(const be of D)ae+="a=".concat(be.attField).concat(be.attValue?":".concat(be.attValue):"").concat(this.eol);return ae}printMediaDescription(D){let ae="";for(const be of D)ae+=this.printMedia(be.media),ae+=this.printInformation(be.information),ae+=this.printConnections(be.connections),ae+=this.printBandwidth(be.bandwidths),ae+=this.printKey(be.key),ae+=this.printMediaAttributes(be);return ae}printConnections(D){let ae="";for(const be of D)ae+=this.printConnection(be);return ae}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new Fr(this.eol).print(D)}printMediaAttributes(D){return new We(this.eol).print(D)}}class tr{constructor(D){vs(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(m)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(ae=>"a=fingerprint:".concat(ae.hashFunction).concat(m).concat(ae.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(ae=>"a=extmap:".concat(ae.entry).concat(ae.direction?"/".concat(ae.direction):"").concat(m).concat(ae.extensionName).concat(ae.extensionAttributes?"".concat(m).concat(ae.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(ae=>"a=".concat(ae.attField).concat(ae.attValue?":".concat(ae.attValue):"").concat(this.eol)).join("")}}class Fr extends tr{print(D){let ae="";return ae+=this.printGroups(D.groups),ae+=this.printMsidSemantic(D.msidSemantic),ae+=this.printIceLite(D.iceLite),ae+=this.printIceUfrag(D.iceUfrag),ae+=this.printIcePwd(D.icePwd),ae+=this.printIceOptions(D.iceOptions),ae+=this.printFingerprints(D.fingerprints),ae+=this.printSetup(D.setup),ae+=this.printTlsId(D.tlsId),ae+=this.printIdentity(D.identities),ae+=this.printExtmap(D.extmaps),ae+=this.printUnrecognized(D.unrecognized),ae}printGroups(D){let ae="";return D.length>0&&(ae+=D.map(be=>"a=group:".concat(be.semantic).concat(be.identificationTag.map(nt=>"".concat(m).concat(nt)).join("")).concat(this.eol)).join("")),ae}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(ae=>"a=identity:".concat(ae.assertionValue).concat(ae.extensions.map(be=>"".concat(m).concat(be.name).concat(be.value?"=".concat(be.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let ae="a=msid-semantic:".concat(D.semantic);return D.applyForAll?ae+="".concat(m,"*"):D.identifierList.length>0&&(ae+=D.identifierList.map(be=>"".concat(m).concat(be))),ae+this.eol}}class We extends tr{print(D){const ae=D.attributes;let be="";return be+=this.printRTCP(ae.rtcp),be+=this.printIceUfrag(ae.iceUfrag),be+=this.printIcePwd(ae.icePwd),be+=this.printIceOptions(ae.iceOptions),be+=this.printCandidates(ae.candidates),be+=this.printRemoteCandidatesList(ae.remoteCandidatesList),be+=this.printEndOfCandidates(ae.endOfCandidates),be+=this.printFingerprints(ae.fingerprints),be+=this.printSetup(ae.setup),be+=this.printMid(ae.mid),be+=this.printExtmap(ae.extmaps),be+=this.printRTPRelated(ae),be+=this.printPtime(ae.ptime),be+=this.printMaxPtime(ae.maxPtime),be+=this.printDirection(ae.direction),be+=this.printSSRCGroups(ae.ssrcGroups),be+=this.printSSRC(ae.ssrcs),be+=this.printRTCPMux(ae.rtcpMux),be+=this.printRTCPMuxOnly(ae.rtcpMuxOnly),be+=this.printRTCPRsize(ae.rtcpRsize),be+=this.printMSId(ae.msids),be+=this.printImageattr(ae.imageattr),be+=this.printRid(ae.rids),be+=this.printSimulcast(ae.simulcast),be+=this.printSCTPPort(ae.sctpPort),be+=this.printMaxMessageSize(ae.maxMessageSize),be+=this.printUnrecognized(ae.unrecognized),be}printCandidates(D){return D.map(ae=>"a=candidate:".concat(ae.foundation).concat(m).concat(ae.componentId).concat(m).concat(ae.transport).concat(m).concat(ae.priority).concat(m).concat(ae.connectionAddress).concat(m).concat(ae.port).concat(m,"typ").concat(m).concat(ae.type).concat(ae.relAddr?"".concat(m,"raddr").concat(m).concat(ae.relAddr):"").concat(ae.relPort?"".concat(m,"rport").concat(m).concat(ae.relPort):"").concat(Object.keys(ae.extension).map(be=>"".concat(m).concat(be).concat(m).concat(ae.extension[be])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(ae=>"a=remote-candidates:".concat(ae.join(m)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const ae=D.payloads;let be="";be+=D.rtcpFeedbackWildcards.map(nt=>this.printRTCPFeedback("*",nt)).join("");for(const nt of ae)be+=this.printRtpMap(nt.payloadType,nt.rtpMap),be+=this.printFmtp(nt.payloadType,nt.fmtp),be+=nt.rtcpFeedbacks.map(ls=>this.printRTCPFeedback(nt.payloadType,ls)).join("");return be}printFmtp(D,ae){if(!ae)return"";const be=Object.keys(ae.parameters);return be.length===1&&ae.parameters[be[0]]===null?"a=fmtp:".concat(D).concat(m).concat(be[0]).concat(this.eol):"a=fmtp:".concat(D).concat(m).concat(Object.keys(ae.parameters).map(nt=>"".concat(nt,"=").concat(ae.parameters[nt])).join(";")).concat(this.eol)}printRtpMap(D,ae){return ae?"a=rtpmap:".concat(D).concat(m).concat(ae.encodingName,"/").concat(ae.clockRate).concat(ae.encodingParameters?"/".concat(ae.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,ae){let be="a=rtcp-fb:".concat(D).concat(m),nt=ae;return nt.type==="trr-int"?be+="ttr-int".concat(m).concat(nt.interval):(be+="".concat(nt.type),nt.parameter&&(be+="".concat(m).concat(nt.parameter),nt.additional&&(be+="".concat(m).concat(nt.additional)))),be+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(ae=>Object.keys(ae.attributes).map(be=>"a=ssrc:".concat(ae.ssrcId.toString(10)).concat(m).concat(be).concat(ae.attributes[be]?":".concat(ae.attributes[be]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let ae="a=rtcp:".concat(D.port);return D.netType&&(ae+="".concat(m).concat(D.netType)),D.addressType&&(ae+="".concat(m).concat(D.addressType)),D.address&&(ae+="".concat(m).concat(D.address)),ae+this.eol}printMSId(D){return D.map(ae=>"a=msid:".concat(ae.id).concat(ae.appdata?"".concat(m).concat(ae.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(ae=>"a=imageattr:".concat(ae).concat(this.eol)).join("")}printRid(D){return D.map(ae=>{let be="a=rid:".concat(ae.id).concat(m).concat(ae.direction);return ae.payloads&&(be+="".concat(m,"pt=").concat(ae.payloads.join(","))),ae.params.length>0&&(be+="".concat(m).concat(ae.params.map(nt=>nt.type==="depend"?"depend=".concat(nt.rids.join(",")):"".concat(nt.type,"=").concat(nt.val)).join(";"))),be+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(ae=>"a=ssrc-group:".concat(ae.semantic).concat(ae.ssrcIds.map(be=>"".concat(m).concat(be.toString(10))).join("")).concat(this.eol)).join("")}}function ct(Ye){return new Xe().parse(Ye)}function Rt(Ye,D){return new ps().print(Ye,D)}}},t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}return s.d=(r,i)=>{for(var l in i)s.o(i,l)&&!s.o(r,l)&&Object.defineProperty(r,l,{enumerable:!0,get:i[l]})},s.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),s.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},s(8)})();function ba(e){return lj.parse(e)}function SA(e,t){return lj.print(e,t)}var xZ=Ti("Array","keys"),vZ=Bo,wZ=Kn,_Z=O,yZ=xZ,K1=Array.prototype,EZ={DOMTokenList:!0,NodeList:!0},CZ=function(e){var t=e.keys;return e===K1||_Z(K1,e)&&t===K1.keys||wZ(EZ,vZ(e))?yZ:t},Ji=h(CZ);function en(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var m=u.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function dj(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function gs(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?dj(Object(s),!0).forEach(function(r){en(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):dj(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function mw(e,t){return mw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,r){return s.__proto__=r,s},mw(e,t)}function W1(){W1=function(i,l){return new s(i,void 0,l)};var e=RegExp.prototype,t=new WeakMap;function s(i,l,A){var u=RegExp(i,l);return t.set(u,A||t.get(i)),mw(u,s.prototype)}function r(i,l){var A,u=t.get(l);return za(A=Object.keys(u)).call(A,function(m,f){var b=u[f];if(typeof b=="number")m[f]=i[b];else{for(var w=0;i[b[w]]===void 0&&w+1<b.length;)w++;m[f]=i[b[w]]}return m},Object.create(null))}return function(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(l&&l.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),l&&mw(i,l)}(s,RegExp),s.prototype.exec=function(i){var l=e.exec.call(this,i);if(l){l.groups=r(l,this);var A=l.indices;A&&(A.groups=r(A,this))}return l},s.prototype[Symbol.replace]=function(i,l){if(typeof l=="string"){var A=t.get(this);return e[Symbol.replace].call(this,i,l.replace(/\$<([^>]+)(>|$)/g,function(m,f,b){if(b==="")return m;var w=A[f];return Array.isArray(w)?"$"+w.join("$"):typeof w=="number"?"$"+w:""}))}if(typeof l=="function"){var u=this;return e[Symbol.replace].call(this,i,function(){var m=arguments;return typeof m[m.length-1]!="object"&&(m=[].slice.call(m)).push(r(m,u)),l.apply(this,m)})}return e[Symbol.replace].call(this,i,l)},W1.apply(this,arguments)}const Aj=new class extends Vr{constructor(){super(...arguments),en(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class SZ{constructor(t){en(this,"logger",void 0),en(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.debug(...this.prefixLists,...s)}info(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.info(...this.prefixLists,...s)}warning(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.warning(...this.prefixLists,...s)}error(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];this.logger.error(...this.prefixLists,...s)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function z1(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function uj(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const gc={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},fw=Date.now(),H0=e=>{for(const t in gc)if(Object.prototype.hasOwnProperty.call(gc,t)&&gc[t]===e)return t;return"DEFAULT"},N=new class{constructor(){en(this,"proxyServerURL",void 0),en(this,"logLevel",gc.DEBUG),en(this,"uploadState","collecting"),en(this,"uploadLogWaitingList",[]),en(this,"uploadLogUploadingList",[]),en(this,"uploadErrorCount",0),en(this,"currentLogID",0),en(this,"url",void 0),en(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[gc.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[gc.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[gc.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[gc.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=[gc.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){xr("UPLOAD_LOG",!0)}disableLogUpload(){xr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new SZ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-fw<100)return void setTimeout(()=>{this.log(...t)},Date.now()-fw);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=z1()+" Agora-SDK [".concat(H0(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=z1()+" %cAgora-SDK [".concat(H0(r),"]:");let l=[];if(!G("USE_NEW_LOG"))switch(r){case gc.DEBUG:l=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case gc.INFO:l=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case gc.WARNING:l=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case gc.ERROR:l=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(Date.now()-fw<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-fw);const r=Math.max(0,Math.min(4,t[0]));t[0]=z1()+" Agora-SDK [".concat(H0(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!G("UPLOAD_LOG"))return;for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];Array.isArray(s[0])?s[0][0]=uj()+" Agora-SDK [".concat(H0(e),"]:"):s[0]=uj()+" Agora-SDK [".concat(H0(e),"]:");let i="";s.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),i+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:fc,process_id:G("PROCESS_ID"),payload:JSON.stringify(e)};return jl(async()=>{const s=await Da.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(s.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=s,r}},()=>(this.uploadLogUploadingList=[],!1),s=>{const r={status:-1,message:s.message,errorRange:e.map(i=>i.log_item_id)};return s.response?(r.status=s.response.status,r.data=s.response.data,r.headers=s.response.headers):s.request&&(r.status=s.request.status),Aj.reportLogUploadError(r),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var hj;function NZ(e){return bi(e.reportId,"params.reportId",0,100,!1),bi(e.category,"params.category",0,100,!1),bi(e.event,"params.event",0,100,!1),bi(e.label,"params.label",0,100,!1),_r(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(hj={}).FREE="free",hj.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const TZ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Bn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Ur=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let RZ=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function $t(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,s,r){const i=r.value;if(typeof i=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var A,u=arguments.length,m=new Array(u),f=0;f<u;f++)m[f]=arguments[f];let b=m;if(e.argsMap)try{b=e.argsMap(this,...m)}catch(_){N.warning(_),b=[]}try{JSON.stringify(b)}catch{N.warning("arguments for method ".concat(l,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const w=(e.report||Ot).reportApiInvoke(this._sessionId||null,{id:this._clientId||((A=this.store)===null||A===void 0?void 0:A.clientId)||this._ID,name:"".concat(l,".").concat(String(s)),options:b,tag:yr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const _=i.apply(this,m);return _ instanceof pt?_.then(S=>(w.onSuccess(e.reportResult&&S),S)).catch(S=>{throw w.onError(S),S}):(w.onSuccess(e.reportResult&&_),_)}catch(_){throw w.onError(_),_}}}return r}}const Ot=new class{constructor(){en(this,"baseInfoMap",new Map),en(this,"proxyServer",void 0),en(this,"eventUploadTimer",void 0),en(this,"setSessionIdTimer",void 0),en(this,"url",void 0),en(this,"sids",new Set),en(this,"backupUrl",void 0),en(this,"_appId",void 0),en(this,"_aid",0),en(this,"keyEventUploadPendingItems",[]),en(this,"normalEventUploadPendingItems",[]),en(this,"apiInvokeUploadPendingItems",[]),en(this,"apiInvokeCount",0),en(this,"apiInvokeLoggedCount",0),en(this,"ltsList",[]),en(this,"lastSendNormalEventTime",Date.now()),en(this,"customReportCounterTimer",void 0),en(this,"customReportCount",0),en(this,"extApiInvoke",async e=>{for(const t of e){const s=gs(gs({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:yr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[s,r]=t;return s+r}),16)||0}reportApiInvoke(e,t,s){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,l=!!G("SHOW_REPORT_INVOKER_LOG"),A=!!G("SHOW_REPORT_USER_INVOKER_LOG"),u=l||A&&t.id;u&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function f(S,F){if(u){let B="[apiInvoke-".concat(m,"]");if(t.id&&(B+="[".concat(t.id,"]")),t.name&&(B+="[".concat(t.name,"]"),t.name===Pr.JOIN))return N.info("".concat(B," ").concat(S));N.info("".concat(B," ").concat(S),S==="start"?t.options:F||"")}}const b=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});f("start");let w=!1;Yn(t.timeout).then(()=>{w||(this.sendApiInvoke(gs(gs({},b()),{},{error:W.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});const _=new Fe(W.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:S=>{const F=()=>{if(w)throw _;return w=!0,this.sendApiInvoke(gs(gs({},b()),{},{success:!0},t.reportResult&&{result:S})),f("onSuccess"),S};return s?zL(F,t.name+"Success",s,()=>w=!0):F()},onError:S=>{const F=()=>{if(w)throw S;w=!0,this.sendApiInvoke(gs(gs({},b()),{},{success:!1,error:S})),f("onFailure",S.toString())};return s?zL(F,t.name+"Error",s,()=>w=!0):F()}}}_send(e,t,s){this.send({type:e,data:t},s)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const s=Date.now(),r=this.createBaseInfo(e,s);r.cname=t.cname,r.rteUrl=t.rteUrl;const i=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:V1?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:A,channelMode:u,isABTestSuccess:m,lsid:f,clientRole:b}=t,w=Date.now(),_=gs(gs({},r),{},{eventType:Bn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:H1,lts:w,elapse:w-s,extend:JSON.stringify(i),mode:t.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:fc,stringUid:l,channelProfile:A,channelMode:u,isABTestSuccess:m,lsid:f,clientType:et(S=window.navigator.userAgent).call(S,"AgoraWebView")?42:20,clientRole:b,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var S;this.send({type:Ur.SESSION,data:_},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const s=t.info,r=Date.now(),i=gs(gs({},s),{},{eventType:Bn.RTE_DETAIL,lts:r,success:!0,elapse:r-t.startTime,vid:s.vid===void 0?0:Number(s.vid),ua:navigator.userAgent});this.send({type:Ur.RTE_DETAIL,data:i},!0)}joinChooseServer(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info;t.vid&&(r.vid=t.vid);const i=Date.now(),l=gs(gs({},r),{},{role:t.role,eventType:Bn.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-s.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Ur.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{eventType:Bn.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-s.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Ur.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:l,addr:A,isProxy:u}=t,m=i-s.startTime,f=gs(gs({},r),{},{eventType:Bn.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:i-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:M1(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:u?1:0}),b=f.success?1:0;if(t.succ&&(s.lastJoinSuccessTime=i),A)if(f.signalChannel==="1"){const w=W1(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),_=A.match(w);f.gatewayIp=_&&_.groups?_.groups.ip:"",f.gatewayPort=_&&_.groups?_.groups.port:""}else if(u){const w=A.match(/h=(\d{1,3}-){3}\d{1,3}/g),_=A.match(/p=[0-9]{1,6}/g);f.gatewayIp=w&&w.length?w[0].split("=")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split("=")[1]:""}else{const w=A.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_=A.match(/(:|p=)[0-9]{1,6}/g);f.gatewayIp=w&&w.length?w[0].split("//")[1].replace(/-/g,"."):"",f.gatewayPort=_&&_.length?_[0].split(/:|p=/g)[1]:""}if(l)this.send({type:Ur.JOIN_GATEWAY,data:f},!0);else{let w={isSuccess:b,port:f.gatewayPort};delete f.success,delete f.eventType,delete f.firstSuccess,delete f.gatewayPort,f.vid=Number(f.vid);const _=Object.assign({},f,w,{eventType:Bn.REJOIN_GATEWAY});this.send({type:Ur.RE_JOIN_GATEWAY,data:_},!0)}}joinChannelTimeout(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=Date.now(),i=gs(gs({},s.info),{},{lts:r,timeout:t,elapse:r-s.startTime});this.send({type:Ur.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{eventType:Bn.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-s.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Ur.PUBLISH,data:l},!0)}subscribe(e,t,s){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,l=Date.now(),A=gs(gs({},i),{},{eventType:Bn.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?A.peerSuid=t.peerid:A.peer=t.peerid,this.send({type:Ur.SUBSCRIBE,data:A},!0)}wsCompressorInit(e){var t;const s=[...Ji(t=this.baseInfoMap).call(t)],r=s.length?s[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const l=i.info,A=Date.now(),u=gs(gs({},l),{},{eventType:Bn.WS_COMPRESSOR_INIT,lts:A,eventElapse:e.eventElapse,elapse:A-i.startTime,status:e.status?1:2});this.send({type:Ur.WS_COMPRESSOR_INIT,data:u},!0)}firstXLAPeerFirstVideoFrame(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=t.peerPubStatusMs-(s.lastJoinSuccessTime||i),A=gs(gs({},r),{},{elapse:i-s.startTime,eventType:Bn.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:l,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>l?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:Ur.XLA_PEER_FIRST_VIDEO_FRAME,data:A},!0)}firstRemoteVideoDecode(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=gs(gs(gs({},l),r),{},{elapse:A-i.startTime,eventType:t,lts:A,firstDecodeFrame:Math.max((r.firstFrame||A)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:s,data:u},!0)}firstRemoteFrame(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=gs(gs(gs({},l),r),{},{elapse:A-i.startTime,eventType:t,lts:A});this.send({type:s,data:u},!0)}abTest(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-s.startTime,eventType:Bn.AB_TEST,lts:i});this.send({type:Ur.AB_TEST,data:l},!0)}pcStats(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-s.startTime,eventType:Bn.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Ur.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:Bn.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Ur.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,s,r){const i=this.baseInfoMap.get(e);if(!i)return;const l=i.info,A=Date.now(),u=gs(gs(gs({},l),r),{},{eventType:t,lts:A});this.send({type:s,data:u},!0)}streamSwitch(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{eventType:Bn.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-s.startTime,success:t.succ});this.send({type:Ur.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{eventType:Bn.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-s.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ur.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{eventType:Bn.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-s.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Ur.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?N.debug("reportProxyServerurl: ".concat(e)):N.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-s.startTime,joinChannelSuccessElapse:i-(s.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Ur.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now();(function(l,A,u){const m=l[A];if(!m||typeof m!="string")return[l];l[A]="";const f=Nd(JSON.stringify(l));let b=0;const w=[];let _=0;for(let S=0;S<m.length;S++)_+=m.charCodeAt(S)<=127?1:3,_<=u-f||(w[w.length]=at(at({},l),{},{[A]:m.substring(b,S)}),b=S,_=m.charCodeAt(S)<=127?1:3);return b!==m.length-1&&(w[w.length]=at(at({},l),{},{[A]:m.substring(b)})),w})(gs(gs(gs({},r),t),{},{elapse:i-s.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Ur.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{elapse:i-s.startTime,lts:i});this.send({type:Ur.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{elapse:i-s.startTime,lts:i,extend:t.extend||void 0});this.send({type:Ur.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const s=this.baseInfoMap.get(e);if(!s)return;const r=s.info,i=Date.now(),l=gs(gs(gs({},r),t),{},{elapse:i-s.startTime,lts:i});this.send({type:Ur.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new Fe(W.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),r=t.map(i=>({type:Ur.USER_ANALYTICS,data:gs(gs({sid:e},i),{},{lts:s})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw N.error("send custom report message failed",i.toString()),new Fe(W.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){const t=G("NOT_REPORT_EVENT");if(e.tag&&et(t)&&et(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:l}=s.info;let A;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Fe){const{code:m,message:f}=e.error;A=m||f||e.error.toString()}else A=e.error.toString();const u={invokeId:e.invokeId,sid:e.sid,cname:r,cid:l,uid:i,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?A:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Ur.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(s=>s!==null);t&&e.forEach(s=>{s&&(s.sid=t,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const s=[],r=[];for(;e.length;){const l=e.shift();s.length<20?s.push(l):r.push(l)}e.push(...r);for(const l of[...s]){var i;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),zh(i=this.ltsList).call(i,(A,u)=>A-u))}return t||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&s.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((l=>A=>{G("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){Zr.networkState===ga.OFFLINE&&await pt.race([Zr.onlineWaiter,Yn(2*gn.maxRetryTimeout)]);const t=i=>{let l=new Uint8Array;return i.forEach(A=>{const u=S1(JSON.stringify(A.data)),m=new ArrayBuffer(5),f=(w=>{let _=0;return Object.entries(Ur).forEach(S=>{let[F,B]=S;B===w.type&&(_=RZ[F])}),_})(A),b=new DataView(m);b.setUint16(0,u.byteLength,!0),b.setUint8(2,255&f),b.setUint8(3,f>>>8&255),b.setUint8(4,f>>>16&255),l=PL(l,new Uint8Array(m)),l=PL(l,u)}),l},s="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await j1(r,{timeout:1e4,data:t(e),headers:gs(gs({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(i===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(u=>{const m=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),r=s?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:s,aid:r};Zr.networkState===ga.OFFLINE&&await pt.race([Zr.onlineWaiter,Yn(2*gn.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let A=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l));for(let u=0;u<2;u+=1){u===1&&(A=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l)));try{t?await pZ(A,{timeout:1e4,data:i}):await j1(A,{timeout:1e4,data:i})}catch(m){if(u===1)throw m;continue}return}}createBaseInfo(e,t){const s=Object.assign({},TZ);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:t}),s}reportResourceTiming(e,t){const s=performance.getEntriesByName(e),r=s[s.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:yr.TRACER}).onSuccess()}};Aj.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Zr.networkState,Ot.reportApiInvoke(null,{name:"logUploadError",options:e,tag:yr.TRACER}).onSuccess("logUploadError")});let Le=class extends Fe{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),en(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,N)}throw(){super.throw(N)}};const Xn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Ls(){return Xn}function pj(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(EA()||_L())&&!OL())}function gw(){return!Xn.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd()}function G0(e){return!(kr()||yL(87)||gw()||!G("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}function mj(e){return G("ENABLE_INSTANT_VIDEO")?G("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB"))}function fj(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function gj(){if(fj()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Ll(141)||Cu(141)||sp(141)}function bj(){if(fj()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Ll(141)||Cu(141)||sp(125)}let xi=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function bf(e,t,s){return{sampleRate:e,stereo:t,bitrate:s}}function Zs(e,t,s,r,i){return{width:e,height:t,frameRate:s,bitrateMin:r,bitrateMax:i}}function Jc(e,t,s,r,i){return{width:{max:e},height:{max:t},frameRate:s,bitrateMin:r,bitrateMax:i}}function q1(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const IZ={"90p":Zs(160,90),"90p_1":Zs(160,90),"120p":Zs(160,120,15,30,65),"120p_1":Zs(160,120,15,30,65),"120p_3":Zs(120,120,15,30,50),"120p_4":Zs(212,120),"180p":Zs(320,180,15,30,140),"180p_1":Zs(320,180,15,30,140),"180p_3":Zs(180,180,15,30,100),"180p_4":Zs(240,180,15,30,120),"240p":Zs(320,240,15,40,200),"240p_1":Zs(320,240,15,40,200),"240p_3":Zs(240,240,15,40,140),"240p_4":Zs(424,240,15,40,220),"360p":Zs(640,360,15,80,400),"360p_1":Zs(640,360,15,80,400),"360p_3":Zs(360,360,15,80,260),"360p_4":Zs(640,360,30,80,600),"360p_6":Zs(360,360,30,80,400),"360p_7":Zs(480,360,15,80,320),"360p_8":Zs(480,360,30,80,490),"360p_9":Zs(640,360,15,80,800),"360p_10":Zs(640,360,24,80,800),"360p_11":Zs(640,360,24,80,1e3),"480p":Zs(640,480,15,100,500),"480p_1":Zs(640,480,15,100,500),"480p_2":Zs(640,480,30,100,1e3),"480p_3":Zs(480,480,15,100,400),"480p_4":Zs(640,480,30,100,750),"480p_6":Zs(480,480,30,100,600),"480p_8":Zs(848,480,15,100,610),"480p_9":Zs(848,480,30,100,930),"480p_10":Zs(640,480,10,100,400),"720p":Zs(1280,720,15,120,1130),"720p_auto":Zs(1280,720,30,900,3e3),"720p_1":Zs(1280,720,15,120,1130),"720p_2":Zs(1280,720,30,120,2e3),"720p_3":Zs(1280,720,30,120,1710),"720p_5":Zs(960,720,15,120,910),"720p_6":Zs(960,720,30,120,1380),"1080p":Zs(1920,1080,15,120,2080),"1080p_1":Zs(1920,1080,15,120,2080),"1080p_2":Zs(1920,1080,30,120,3e3),"1080p_3":Zs(1920,1080,30,120,3150),"1080p_5":Zs(1920,1080,60,120,4780),"1440p":Zs(2560,1440,30,120,4850),"1440p_1":Zs(2560,1440,30,120,4850),"1440p_2":Zs(2560,1440,60,120,7350),"4k":Zs(3840,2160,30,120,8910),"4k_1":Zs(3840,2160,30,120,8910),"4k_3":Zs(3840,2160,60,120,13500)},OZ={"480p":Jc(640,480,5),"480p_1":Jc(640,480,5),"480p_2":Jc(640,480,30),"480p_3":Jc(640,480,15),"720p":Jc(1280,720,5),"720p_auto":Zs(1280,720,30,900,3e3),"720p_1":Jc(1280,720,5),"720p_2":Jc(1280,720,30),"720p_3":Jc(1280,720,15),"1080p":Jc(1920,1080,5),"1080p_1":Jc(1920,1080,5),"1080p_2":Jc(1920,1080,30),"1080p_3":Jc(1920,1080,15)},kZ={"1SL1TL":q1(1,1),"3SL3TL":q1(3,3),"2SL3TL":q1(2,3)};function $c(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},IZ[e]):e}function Y1(e){return typeof e=="string"?Object.assign({},OZ[e]):e}function bw(e){return typeof e=="string"?Object.assign({},kZ[e]):e}const DZ={speech_low_quality:bf(16e3,!1),speech_standard:bf(32e3,!1,18),music_standard:bf(48e3,!1),standard_stereo:bf(48e3,!0,56),high_quality:bf(48e3,!1,128),high_quality_stereo:bf(48e3,!0,192)};function xw(e){return typeof e=="string"?Object.assign({},DZ[e]):e}const Ap=[];function xj(e){return fn(e,"mediaSource",["screen","window","application"]),!0}let Dt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),or=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),xf=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),BZ=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),LZ=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),up=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),vf=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),bc=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),wf=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Qo=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const X1={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},J1={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},vj={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},jZ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},wj={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let xa=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ho=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),K0=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),hp=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Mi=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Td=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const $1={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let vw=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Ks(e,t,s,r,i){var l,A,u={};return Object.keys(r).forEach(function(m){u[m]=r[m]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=za(l=Sm(A=s.slice()).call(A)).call(l,function(m,f){return f(e,t,m)||m},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0?(Object.defineProperty(e,t,u),null):u}function je(e,t,s){return(t=function(r){var i=function(l,A){if(typeof l!="object"||!l)return l;var u=l[Symbol.toPrimitive];if(u!==void 0){var m=u.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof i=="symbol"?i:i+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _j(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Rr(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?_j(Object(s),!0).forEach(function(r){je(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_j(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class yj extends Vr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(up.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,s){super(),je(this,"trackMediaType",void 0),je(this,"_ID",void 0),je(this,"_rtpTransceiver",void 0),je(this,"_lowRtpTransceiver",void 0),je(this,"_hints",[]),je(this,"_isClosed",!1),je(this,"_originMediaStreamTrack",void 0),je(this,"mediaStreamTrack",void 0),je(this,"_external",{}),this._ID=s||dr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){et(Ap).call(Ap,r)||Ap.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Su(()=>{var s;Ot.reportApiInvoke(null,{name:Pr.GET_MEDIA_STREAM_TRACK,options:[],tag:yr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===xf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const s=Ap.indexOf(t);s!==-1&&Ap.splice(s,1)}(this),this.emit(vf.CLOSED),this.removeAllListeners(up.SEI_RECEIVED)}_updateRtpTransceiver(t,s){if(s===xf.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(up.TRANSCEIVER_UPDATED,t,s)}}class _f extends yj{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,s){super(t,s),je(this,"_enabled",!0),je(this,"_muted",!1),je(this,"_isExternalTrack",!1),je(this,"_isClosed",!1),je(this,"_enabledMutex",void 0),je(this,"processor",void 0),je(this,"_processorContext",void 0),je(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ai("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,s;return(t=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),this.emit(Dt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,s){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sr(this,Dt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vf.TRACK_ENDED)}stateCheck(t,s){if(N.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(s,"]")),qc(s,t),this._enabled&&this._muted&&t==="enabled"&&s===!1)throw new Fe(W.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",N);if(!this._enabled&&!this._muted&&t==="muted"&&s===!0)throw new Fe(W.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",N)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():pt.resolve([])}}const Ej=window.AudioContext||window.webkitAudioContext;let Z1,Go=null;const vr=new class extends Vr{constructor(){super(...arguments),je(this,"prevState",void 0),je(this,"curState",void 0),je(this,"currentTime",void 0),je(this,"currentTimeStuckAt",void 0),je(this,"interruptDetectorTrack",void 0),je(this,"onLocalAudioTrackMute",()=>{N.info("ios15-interruption-start"),this.emit(xi.IOS_15_16_INTERRUPTION_START)}),je(this,"onLocalAudioTrackUnmute",async()=>{N.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(Go&&await Go.suspend(),this.emit(xi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){N.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){N.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function yf(){if(!Go){if(function(){if(!Ej)return void N.error("your browser is not support web audio");N.info("create audio context");const e=Rr({},G("WEBAUDIO_INIT_OPTIONS"));N.debug("audio context init option:",JSON.stringify(e)),Go=new Ej(e),vr.curState=Go.state,Go.onstatechange=()=>{vr.prevState=vr.curState,vr.curState=Go?Go.state:void 0;const{prevState:t,curState:s}=vr,r=s==="running",i=s==="interrupted",l=t==="running",A=t==="suspended",u=t==="interrupted",m=$s().osVersion;(Xi()||zc())&&l&&i&&(N.info("ios".concat(m,"-interruption-start")),vr.emit(xi.IOS_INTERRUPTION_START)),(Xi()||zc())&&(A||u)&&r&&(N.info("ios".concat(m,"-interruption-end")),vr.emit(xi.IOS_INTERRUPTION_END)),t!==s&&vr.emit(xi.STATE_CHANGE,s,t)},setInterval(()=>{var t;const s=(t=Go)===null||t===void 0?void 0:t.currentTime;vr.currentTime!==s?(vr.currentTimeStuckAt&&(N.debug("AudioContext current time resume at ".concat(s)),vr.currentTimeStuckAt=void 0),vr.currentTime=s):(s!==vr.currentTimeStuckAt&&(Ot.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:yr.TRACER}).onSuccess(),N.warning("AudioContext current time stuck at ".concat(s))),vr.currentTimeStuckAt=s)},5e3),async function(t){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i,l=!1,A=!1,u=!1;function m(K){t.state==="running"?f(!1):Xi()||zc()?t.state==="suspended"&&(f(!0),K&&t.resume().then(b,b)):t.state!=="closed"&&(f(!0),K&&t.resume().then(b,b))}function f(K){if(l!==K){l=K;for(let X=0,oe=s;X<oe.length;X+=1){const xe=oe[X];K?window.addEventListener(xe,w,{capture:!0,passive:!0}):window.removeEventListener(xe,w,{capture:!0,passive:!0})}}}function b(){m(!1)}function w(){m(!0)}function _(){let K;try{K=r.play(),K?K.then(B,B):(r.addEventListener("playing",B),r.addEventListener("abort",B),r.addEventListener("error",B))}catch{B()}}function S(K){u||(r.paused?K?(F(!1),u=!0,_()):F(!0):F(!1))}function F(K){if(A!==K){A=K;for(let X=0,oe=s;X<oe.length;X++){const xe=oe[X];K?window.addEventListener(xe,j,{capture:!0,passive:!0}):window.removeEventListener(xe,j,{capture:!0,passive:!0})}}}function B(){r.removeEventListener("playing",B),r.removeEventListener("abort",B),r.removeEventListener("error",B),u=!1,S(!1)}function j(){S(!0)}if(Xi()&&G("IOS_BG_TAG")){const K=t.createMediaStreamDestination(),X=document.createElement("div");X.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=X.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=K.stream,i=()=>{if(G("IOS_AUTO_RESTART_BG_TAG")&&r&&r.srcObject&&!u&&(!r.paused||A!==!0)){r.paused||r.pause();try{u=!0,_()}catch{u=!1}return!0}},S(!0)}return vr.on(xi.STATE_CHANGE,function(){m(!0)}),m(!1),i}(Go).then(t=>{Z1=t})}(),!Go)throw new Fe(W.NOT_SUPPORTED,"can not create audio context");return Go}return Go}function pp(e){if(function(){if(eN!==null)return eN;const r=yf(),i=r.createBufferSource(),l=r.createGain(),A=r.createGain();i.connect(l),i.connect(A),i.disconnect(l);let u=!1;try{i.disconnect(l)}catch{u=!0}return i.disconnect(),eN=u,u}())return;const t=e.connect,s=e.disconnect;e.connect=(r,i,l)=>{var A;return e._inputNodes||(e._inputNodes=[]),et(A=e._inputNodes).call(A,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,l)):t.call(e,r,i)),e},e.disconnect=(r,i,l)=>{s.call(e),r?ow(e._inputNodes,r):e._inputNodes=[];for(const A of e._inputNodes)t.call(e,A)}}let eN=null;function tN(e,t){let s=!1;const r=1/t;if(G("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{s?window.clearInterval(i):e(performance.now()/1e3)},1e3*r)}else{const i=yf();let l=i.createGain();l.gain.value=0,l.connect(i.destination);const A=()=>{if(s)return void(l=null);const u=i.createOscillator();u.onended=A,u.connect(l),u.start(0),u.stop(i.currentTime+r),e(i.currentTime)};A()}return()=>{s=!0}}class Cj{constructor(){je(this,"context",void 0),je(this,"analyserNode",void 0),je(this,"sourceNode",void 0),this.context=yf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Xi()||zc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<t.length;++i)t[i]=r[i]/128-1}const s=za(t).call(t,(r,i)=>r+i*i,0)/t.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,s;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{N.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Sj extends Vr{get processSourceNode(){return this.sourceNode}set processedNode(t){var s;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),je(this,"outputNode",void 0),je(this,"outputTrack",void 0),je(this,"isPlayed",!1),je(this,"sourceNode",void 0),je(this,"context",void 0),je(this,"audioBufferNode",void 0),je(this,"destNode",void 0),je(this,"audioOutputLevel",0),je(this,"volumeLevelAnalyser",void 0),je(this,"_processedNode",void 0),je(this,"playNode",void 0),je(this,"isDestroyed",!1),je(this,"onNoAudioInput",void 0),je(this,"isNoAudioInput",!1),je(this,"_noAudioInputCount",0),this.context=yf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),pp(this.outputNode),this.volumeLevelAnalyser=new Cj}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Qo.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const l=r.outputBuffer.getChannelData(i);for(let A=0;A<l.length;A+=1)l[A]=0}return r.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ls().webAudioMediaStreamDest)throw new Fe(W.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&cw(()=>{vr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Xi()||zc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let r;s.getFloatTimeDomainData?(r=new Float32Array(s.fftSize),s.getFloatTimeDomainData(r)):(r=new Uint8Array(s.fftSize),s.getByteTimeDomainData(r));let i=!1;for(let l=0;l<r.length;l++)r[l]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Yn(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,s;(t=this.processedNode)===null||t===void 0||t.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class sN extends Sj{get isFreeze(){return!1}constructor(t,s,r){var i;if(super(),je(this,"sourceNode",void 0),je(this,"track",void 0),je(this,"clonedTrack",void 0),je(this,"audioElement",void 0),je(this,"isCurrentTrackCloned",!1),je(this,"isRemoteTrack",!1),je(this,"originVolumeLevelAnalyser",void 0),je(this,"rebuildWebAudio",async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),pp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),pp(this.outputNode),this.emit(Qo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Fe(W.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(l),pp(this.sourceNode),r){const u=r.clone();u.enabled=!0,this.clonedTrack=u,N.debug("create an unmuted track ".concat(u.id," from the original track ").concat(r.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([u]));pp(m),this.originVolumeLevelAnalyser=new Cj,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const A=$s();s&&A.os===qn.IOS&&Number((i=A.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(vr.on(xi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const s=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(s),pp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Qo.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),vr.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const s=t.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),N.debug("create an unmuted track ".concat(s.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([s]));pp(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Nj(e,t,s){const r=(l,A)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||A:l:A,i={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function PZ(e,t){const s=await Tj(e.mediaSource),{sourceId:r,audio:i}=await function(l){let A=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pt((u,m)=>{const f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const F=document.createElement("button");F.innerHTML="cancel",F.setAttribute("style","width: 85px;"),F.onclick=()=>{document.body.removeChild(K);const X=new Error("NotAllowedError");X.name="NotAllowedError",m(X)};let B=A;const j=document.createElement("div");if(A){const X=document.createElement("input");X.setAttribute("type","checkbox");const oe=document.createElement("span");X.setAttribute("style","margin-right: 6px;"),oe.innerText="Share audio",X.checked=B,X.onchange=()=>{B=X.checked},j.appendChild(X),j.appendChild(oe)}S.appendChild(j),S.appendChild(F),b.appendChild(w),b.appendChild(_),b.appendChild(S);const K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(f),K.appendChild(b),document.body.appendChild(K),l.map(X=>{if(X.id){const oe=document.createElement("div");oe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let xe=X.thumbnail;try{const{width:Ee}=xe.getSize();Ee>1920&&(xe=xe.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}oe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+xe.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+X.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",oe.onclick=()=>{document.body.removeChild(K),u({sourceId:X.id,audio:B})},_.appendChild(oe)}})})}(s,t);return await Nj(r,e,i)}async function Tj(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const s=UL();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Fe(W.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=s.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new pt((l,A)=>{s.desktopCapturer.getSources({types:t},(u,m)=>{u?A(u):l(m)})}));try{return await r}catch(l){throw new Fe(W.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const rN=new ai("safari");let Rj=!1,Ij=!1;async function Ko(e,t){let s=0,r=null;for(;s<2;)try{r=await UZ(e,t,s>0);break}catch(i){if(i instanceof Fe)throw N.error("[".concat(t,"] ").concat(i.toString())),i;const l=ww(i.name||i.code||i,i.message);if(l.code===W.MEDIA_OPTION_INVALID){N.debug("[".concat(t,"] detect media option invalid, retry")),s+=1,await Yn(500);continue}throw N.error("[".concat(t,"] ").concat(l.toString())),l}if(!r)throw new Fe(W.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function UZ(e,t,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Fe(W.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ls(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return N.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(UL())e.screen.sourceId?Ef(i,await Nj(e.screen.sourceId,e.screen,!!e.screenAudio)):Ef(i,await PZ(e.screen,!!e.screenAudio));else if(EA()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Fe(W.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const _=await(A=e.screen.extensionId,u=t,new pt((S,F)=>{try{chrome.runtime.sendMessage(A,{getStream:!0},B=>{if(!B||!B.streamId)return N.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),B),void F(new Fe(W.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(B.streamId)})}catch(B){N.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(A,")"),B.toString()),F(new Fe(W.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=_,Ef(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var l;e.screen.mediaSource&&xj(e.screen.mediaSource);const _={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:F,systemAudio:B,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:X}=e.screen,oe={selfBrowserSurface:S,surfaceSwitching:F,systemAudio:B,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:X};!S&&delete oe.selfBrowserSurface,!F&&delete oe.surfaceSwitching,!B&&delete oe.systemAudio,!j&&delete oe.preferCurrentTab,!K&&delete oe.windowAudio,!X&&delete oe.monitorTypeSurfaces,N.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:_,audio:e.screenAudio,controls:oe})),Ef(i,await navigator.mediaDevices.getDisplayMedia(Rr({video:_,audio:e.screenAudio},oe)))}else{if(!kr())throw N.error("[".concat(t,"] This browser does not support screenSharing")),new Fe(W.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&xj(e.screen.mediaSource);const _={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};N.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(_))),Ef(i,await navigator.mediaDevices.getUserMedia(_))}}var A,u;if(!e.video&&!e.audio)return i;let m={video:e.video,audio:e.audio},f=G("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),m=O1(m,f)}catch{}N.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),$s();let b,w=null;(ii()||Xi()||aw())&&(w=await rN.lock());try{b=await navigator.mediaDevices.getUserMedia(m)}catch(_){throw w&&w(),_}return m.audio&&(Rj=!0),m.video&&(Ij=!0),Ef(i,b),w&&w(),i}function ww(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Fe(W.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Fe(W.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Fe(W.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Fe(W.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Fe(W.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Fe(W.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return N.error("getUserMedia unexpected error",e),new Fe(W.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Ef(e,t){const s=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(r&&e.removeTrack(r),e.addTrack(l)),i&&(s&&e.removeTrack(s),e.addTrack(i))}const Wo=new class extends Vr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(hp.STATE_CHANGE,e),this._state=e)}constructor(){super(),je(this,"_state",K0.IDLE),je(this,"isAccessMicrophonePermission",!1),je(this,"isAccessCameraPermission",!1),je(this,"lastAccessMicrophonePermission",!1),je(this,"lastAccessCameraPermission",!1),je(this,"checkdeviceMatched",!1),je(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(j0()||iw()===qn.HARMONY_OS)&&Sd())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>N.error(e.toString()))}async enumerateDevices(e,t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Fe(W.NOT_SUPPORTED,"enumerateDevices() not supported.");const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let l=!this.isAccessMicrophonePermission&&e,A=!this.isAccessCameraPermission&&t;i.audio&&(l=!1),i.video&&(A=!1);let u=null,m=null,f=null;if(!s&&(l||A)){if(rN.isLocked&&(N.debug("[device manager] wait GUM lock"),(await rN.lock())(),N.debug("[device manager] GUM unlock")),Rj&&(l=!1,this.isAccessMicrophonePermission=!0),Ij&&(A=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",e,t,l,A),l&&A){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const w=ww(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(b){const w=ww(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(A){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(b){const w=ww(b.name||b.code||b,b.message);if(w.code===W.PERMISSION_DENIED)throw w;N.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",e,"cam permission",t)}try{const b=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(w=>w.stop()),m&&m.getTracks().forEach(w=>w.stop()),f&&f.getTracks().forEach(w=>w.stop()),u=null,m=null,f=null,b}catch(b){return u&&u.getTracks().forEach(w=>w.stop()),m&&m.getTracks().forEach(w=>w.stop()),f&&f.getTracks().forEach(w=>w.stop()),u=null,m=null,f=null,new Fe(W.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(t=s.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!t)throw new Fe(W.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=K0.INITING;try{await this.updateDevicesInfo(),this.state=K0.INITEND}catch(e){throw this.state=K0.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(N.warning("Device Detection functionality cannot start properly.",e.toString()),e):new Fe(W.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=e.find(A=>A.kind==="audioinput"&&A.deviceId==="default"),l=e.find(A=>A.kind==="audiooutput"&&A.deviceId==="default");i&&l?l.groupId===i.groupId?N.debug("[device-check] default input ".concat(i.label," and output ").concat(l.label," is the same group")):N.debug("[device-check] default input ".concat(i.label," and output ").concat(l.label," is not the same group")):N.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;const l=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const A={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),A),s.push(A)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((i,l)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",s.push(i))}),this.state!==K0.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(hp.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(hp.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(hp.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(i=>i.kind==="audioinput"),s=e.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of s)if(i.label&&i.deviceId){r.video=!0;break}return r}};let nN=!1;const La=new class extends Vr{constructor(){super(...arguments),je(this,"onAutoplayFailed",void 0),je(this,"onAudioAutoplayFailed",void 0)}};function Oj(){if(nN)return G("FLS_AUTOPLAY_EMITS")?(La.onAutoplayFailed&&La.onAutoplayFailed(),La.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),nN=!1,P0()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};nN=!0,P0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),La.onAutoplayFailed?La.onAutoplayFailed():La.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),La.emit("autoplay-failed")}}function kj(e,t,s,r){if(!e)return;const i=Ot.getBaseInfoBySessionId(e);if(!i)return;const l=i.info,A=Date.now(),u=Rr(Rr({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:A,elapse:A-i.startTime,cbRegistered:La.onAutoplayFailed||La.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:t,trackId:r,extend:void 0});Ot.send({type:Ur.AUTOPLAY_FAILED,data:u},!0)}const FZ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],na=new class{constructor(){je(this,"onAutoplayFailed",void 0),je(this,"elementMap",new Map),je(this,"elementStateMap",new Map),je(this,"elementsNeedToResume",[]),je(this,"sinkIdMap",new Map),je(this,"autoResumeAfterInterruption",e=>pt.all(Array.from(this.elementMap.entries()).map(async t=>{let[s,r]=t;const i=this.elementStateMap.get(s),l=r.srcObject.getAudioTracks()[0],A=l&&l.readyState;if(N.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(A," ").concat(e)),A==="live"){if(e)return r.pause(),r.play();if(vr.curState==="running")return df()?(r.pause(),r.play()):i&&i==="paused"?r.play():void 0}}))),je(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,s]=e;const r=s.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),vr.on(xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vr.on(xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),vr.on(xi.STATE_CHANGE,()=>{Xi()&&vr.prevState==="suspended"&&vr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const s=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),s)try{await s.setSinkId(t)}catch(r){throw new Fe(W.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,s,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Mi.INIT),this.setVolume(t,s);const l=this.sinkIdMap.get(t);if(l)try{i.setSinkId(l).catch(u=>{N.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){N.warning("[".concat(t,"] set sink id failed"),u.toString())}const A=i.play();A&&A.then&&A.catch(u=>{r&&kj(r,"audio",u.message,t),N.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),cw(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Oj()}))})}updateTrack(e,t){const s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const s=this.elementMap.get(e);s&&(t=Math.max(0,Math.min(100,t)),s.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const s=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(s,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){FZ.forEach(s=>{t.addEventListener(s,r=>{const i=this.elementStateMap.get(e),l=r.type==="pause"?"paused":r.type;if(N.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(l)),r.type==="error"){const A=t==null?void 0:t.error;A&&N.error("[".concat(e,"] media error, code: ").concat(A.code,", message: ").concat(A.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(s=>{N.debug("Auto resume audio element success")}).catch(s=>{N.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new pt(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{P0()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function rn(){return function(e,t,s){const r=s.value;return typeof r=="function"&&(s.value=function(){this._isClosed&&new Fe(W.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",N);for(var i=arguments.length,l=new Array(i),A=0;A<i;A++)l[A]=arguments[A];const u=r.apply(this,l);return u instanceof pt?new pt((m,f)=>{u.then(m).catch(f)}):u}),s}}class Dj extends Vr{constructor(t){super(),je(this,"name","VideoProcessorDestination"),je(this,"ID","0"),je(this,"_source",void 0),je(this,"videoContext",void 0),je(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Fe(W.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Fe(W.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(xa.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(xa.ON_TRACK,void 0)}}class Bj extends Vr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s){super(),je(this,"constraintsMap",new Map),je(this,"statsRegistry",[]),je(this,"usageRegistry",[]),je(this,"trackId",void 0),je(this,"direction",void 0),je(this,"_chained",!1),this.trackId=t,this.direction=s}async getConstraints(){return await Cn(this,Ho.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,s){var r;return N.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),Sr(this,Ho.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return N.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Sr(this,Ho.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(s=this.constraintsMap).call(s)))}registerStats(t,s,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:r})}unregisterStats(t,s){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:s,processorName:r,type:i,cb:l}of this.statsRegistry)try{const A=l();t.push({processorID:s,processorName:r,type:i,stats:A})}catch(A){N.error(new Fe(W.UNEXPECTED_ERROR,A.message))}return t}registerUsage(t,s){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){const s=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let r=s();r instanceof pt&&(r=await r),t.push(Rr(Rr({},r),{},{direction:this.direction}))}catch(r){N.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Lj extends Vr{constructor(t){super(),je(this,"name","AudioProcessorDestination"),je(this,"ID","0"),je(this,"inputTrack",void 0),je(this,"inputNode",void 0),je(this,"audioProcessorContext",void 0),je(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Fe(W.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Fe(W.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(xa.ON_TRACK,void 0),this.emit(xa.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(xa.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(xa.ON_NODE,this.inputNode))}}class jj extends Vr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,s,r){super(),je(this,"constraintsMap",new Map),je(this,"statsRegistry",[]),je(this,"audioContext",void 0),je(this,"trackId",void 0),je(this,"direction",void 0),je(this,"usageRegistry",[]),je(this,"_chained",!1),this.audioContext=t,this.trackId=s,this.direction=r}async getConstraints(){return Cn(this,Ho.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,s){var r;return N.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(s,t),Sr(this,Ho.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var s;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Sr(this,Ho.REQUEST_UPDATE_CONSTRAINTS,Array.from(wo(s=this.constraintsMap).call(s)))}registerStats(t,s,r){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:s,cb:r})}unregisterStats(t,s){const r=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===s);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:s,processorName:r,type:i,cb:l}of this.statsRegistry)try{const A=l();t.push({processorID:s,processorName:r,type:i,stats:A})}catch(A){N.error(new Fe(W.UNEXPECTED_ERROR,A.message))}return t}registerUsage(t,s){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:s})}unregisterUsage(t){const s=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let r=s();r instanceof pt&&(r=await r),t.push(Rr(Rr({},r),{},{direction:this.direction}))}catch(r){N.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class iN extends Vr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),je(this,"context",void 0),je(this,"processSourceNode",void 0),je(this,"outputTrack",void 0),je(this,"processedNode",void 0),je(this,"clonedTrack",void 0),je(this,"outputNode",void 0),this.outputNode=new MZ}setVolume(){}createOutputTrack(){throw new Fe(W.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class MZ{disconnect(){}connect(){}}function Pj(e){return new pt((t,s)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const l=Xi()?"canplay":"playing";i.addEventListener(l,()=>{const A=i.videoWidth,u=i.videoHeight;!A&&kr()||(r=!0,i.srcObject=null,i.remove(),t([A,u]))}),i.srcObject=new MediaStream([e]),i.play().catch(M0),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function _w(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const s=$c(e.encoderConfig);return s.width!=null&&(t.width=s.width),s.height!=null&&(t.height=s.height),!IL()&&s.frameRate&&(t.frameRate=s.frameRate),_L()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),kr()&&(t.frameRate={ideal:30,max:30}),t}function Uj(e){const t={};return IL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,EA()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function Fj(e){const t=Uj(e);if(e.encoderConfig){const s=xw(e.encoderConfig);t.channelCount=s.stereo?2:1,t.sampleRate=s.sampleRate,t.sampleSize=s.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),j0()&&(t.sampleRate=void 0),t}const Mj=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:s,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:l=s,width:A=r,height:u=i}=t;if(!l||!A||!u)return;A=hf(A),u=hf(u),l=hf(l);const{max:m,min:f}=function(S,F,B){const j=200*Math.pow(B/15,.6)*Math.pow(S*F/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(A,u,l),{bitrateMax:b,bitrateMin:w}=t||{};b||N.debug("calculate bitrate: [w: ".concat(A,", h: ").concat(u,", fps: ").concat(l,"] => [brMax: ").concat(b,", brMin: ").concat(w,"]"));const{maxFramerate:_}=G("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(l=Math.min(l,_)),{frameRate:l,bitrateMax:b||m,bitrateMin:w||f,scaleResolutionDownBy:1,scale:0}},Vj=async(e,t,s)=>await(async(r,i,l)=>{const A=function(f){const b=[];for(let w=0;w<f.length;w+=2)b.push(parseInt(f.slice(w,w+2),16));return Uint8Array.from(b)}(XL(""+i+l)).slice(0,16),u=A.slice(0,12),m=await window.crypto.subtle.importKey("raw",A,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},m,r))})(e.buffer,t,s),aN=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new pt((s,r)=>{t.toBlob(async i=>{if(t.remove(),i){const l=await Qj(i);s({buffer:l,width:t.width,height:t.height})}else r(new Fe(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Qj=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Hj,Gj,Kj,Wj,zj,qj,Yj,Xj,Jj,$j,Zj,eP,tP,sP,rP,nP,iP,aP,Yr,oP,cP,lP,dP,AP,uP,Rd,hP,pP,mP,fP,gP,bP,xP,vP,wP,_P,yP,EP,CP,ki;let nn=(Hj=$t({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Gj=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),Kj=rn(),Wj=pf("LocalAudioTrack","_enabledMutex"),zj=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),qj=rn(),Yj=pf("LocalAudioTrack","_enabledMutex"),Xj=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),Jj=rn(),$j=rn(),Zj=rn(),eP=$t({argsMap:e=>[e.getTrackId()]}),tP=rn(),sP=$t({argsMap:e=>[e.getTrackId()]}),rP=rn(),nP=$t({argsMap:e=>[e.getTrackId()]}),iP=$t({argsMap:(e,t)=>[e.getTrackId(),t.name]}),aP=$t({argsMap:e=>[e.getTrackId()]}),Ks((Yr=class extends _f{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?na.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,s,r){super(e,s),je(this,"trackMediaType",wf.AUDIO),je(this,"_encoderConfig",void 0),je(this,"_trackSource",void 0),je(this,"metadata",[]),je(this,"_enabled",!0),je(this,"_volume",100),je(this,"_useAudioElement",!0),je(this,"_bypassWebAudio",!1),je(this,"processor",void 0),je(this,"_processorContext",void 0),je(this,"_processorDestination",void 0),je(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new iN,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ii()&&!Go?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){_r(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&na.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Sr(this,Dt.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!pj())throw new Fe(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await na.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,s){return this._setEnabled(e,t,s)}async _setEnabled(e,t,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await Sr(this,Dt.NEED_ENABLE_TRACK,this),N.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw s||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Sr(this,Dt.NEED_DISABLE_TRACK,this)}catch(r){throw s||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Sr(this,Dt.NEED_MUTE_TRACK,this):await Sr(this,Dt.NEED_UNMUTE_TRACK,this))}getStats(){return Su(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Eo(this,Dt.GET_STATS)||Rr({},X1)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qo.ON_AUDIO_BUFFER),this._source.on(Qo.ON_AUDIO_BUFFER,s=>e(s))}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),na.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?na.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&na.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sr(this,Dt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return pt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Fe(W.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(xa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Sr(this,Dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sr(this,Dt.NEED_REPLACE_TRACK,this))}),e.on(xa.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(xa.ON_TRACK),e.removeAllListeners(xa.ON_NODE)}bindProcessorContextEvents(e){e.on(Ho.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ho.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof iN&&(this._trackSource=new sN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new jj(this._source.context,this.getTrackId(),"local"),t=new Lj(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Qo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(na.stop(this.getTrackId()),this._source.play()),Sr(this,Dt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{N.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Hj],Object.getOwnPropertyDescriptor(Yr.prototype,"setVolume"),Yr.prototype),Ks(Yr.prototype,"setPlaybackDevice",[Gj,Kj],Object.getOwnPropertyDescriptor(Yr.prototype,"setPlaybackDevice"),Yr.prototype),Ks(Yr.prototype,"setEnabled",[Wj,zj,qj],Object.getOwnPropertyDescriptor(Yr.prototype,"setEnabled"),Yr.prototype),Ks(Yr.prototype,"setMuted",[Yj,Xj,Jj],Object.getOwnPropertyDescriptor(Yr.prototype,"setMuted"),Yr.prototype),Ks(Yr.prototype,"getStats",[$j],Object.getOwnPropertyDescriptor(Yr.prototype,"getStats"),Yr.prototype),Ks(Yr.prototype,"setAudioFrameCallback",[Zj],Object.getOwnPropertyDescriptor(Yr.prototype,"setAudioFrameCallback"),Yr.prototype),Ks(Yr.prototype,"play",[eP,tP],Object.getOwnPropertyDescriptor(Yr.prototype,"play"),Yr.prototype),Ks(Yr.prototype,"stop",[sP,rP],Object.getOwnPropertyDescriptor(Yr.prototype,"stop"),Yr.prototype),Ks(Yr.prototype,"close",[nP],Object.getOwnPropertyDescriptor(Yr.prototype,"close"),Yr.prototype),Ks(Yr.prototype,"pipe",[iP],Object.getOwnPropertyDescriptor(Yr.prototype,"pipe"),Yr.prototype),Ks(Yr.prototype,"unpipe",[aP],Object.getOwnPropertyDescriptor(Yr.prototype,"unpipe"),Yr.prototype),Yr),W0=(oP=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),cP=rn(),lP=pf("MicrophoneAudioTrack","_enabledMutex"),dP=$t({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),AP=rn(),uP=$t({argsMap:e=>[e.getTrackId()]}),Ks((Rd=class extends nn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,s,r){super(e,t.encoderConfig?xw(t.encoderConfig):{},r,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),je(this,"_config",void 0),je(this,"_deviceName","default"),je(this,"_constraints",void 0),je(this,"_originalConstraints",void 0),je(this,"_enabled",!0),this._config=t,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(df()||y1())&&vr.bindInterruptDetectorTrack(this)}async setDevice(e){if(N.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Wo.getDeviceById(e),s={};s.audio=Rr({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Ko(s,this.getTrackId())}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Ko({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Wo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}N.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,s){if(t)return N.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),e),G("AUTO_RESET_AUDIO_ROUTE")&&(Xi()||zc())){const A=navigator.audioSession;A&&(e||(A.type="playback"),A.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),s||(this._enabled=!1);try{await Sr(this,Dt.NEED_DISABLE_TRACK,this)}catch(A){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),A.toString()),A}return}const i=Rr({},this._constraints),l=Wo.searchDeviceIdByName(this._deviceName);l&&!i.deviceId&&(i.deviceId=l);try{s||(this._enabled=!0);const A=await Ko({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(A.getAudioTracks()[0],!1),await Sr(this,Dt.NEED_ENABLE_TRACK,this)}catch(A){throw s||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),A.toString()),A}N.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(df()||y1())&&vr.unbindInterruptDetectorTrack(this),Ap.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||Z1&&Z1()&&(Ot.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:yr.TRACER}).onSuccess(),N.debug("restart background audio tag success"))}onTrackEnded(){if((Xi()||zc())&&this._enabled&&!this._isClosed&&vr.duringInterruption){const e=async()=>{vr.off(xi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};vr.on(xi.IOS_INTERRUPTION_END,e)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vf.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,s=Wo.searchDeviceIdByName(this._deviceName);if(s&&!t.deviceId&&(t.deviceId=s),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Ko({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ho.REQUEST_UPDATE_CONSTRAINTS,async(t,s,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),s()}catch(i){r(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ho.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[oP,cP],Object.getOwnPropertyDescriptor(Rd.prototype,"setDevice"),Rd.prototype),Ks(Rd.prototype,"setEnabled",[lP,dP,AP],Object.getOwnPropertyDescriptor(Rd.prototype,"setEnabled"),Rd.prototype),Ks(Rd.prototype,"close",[uP],Object.getOwnPropertyDescriptor(Rd.prototype,"close"),Rd.prototype),Rd),VZ=(hP=$t({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),pP=rn(),mP=$t({argsMap:e=>[e.getTrackId()]}),fP=rn(),gP=$t({argsMap:e=>[e.getTrackId()]}),bP=rn(),xP=$t({argsMap:e=>[e.getTrackId()]}),vP=rn(),wP=$t({argsMap:e=>[e.getTrackId()]}),_P=rn(),yP=$t({argsMap:e=>[e.getTrackId()]}),EP=$t({argsMap:e=>[e.getTrackId()]}),CP=rn(),Ks((ki=class extends nn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,s,r){super(t.createOutputTrack(),s,r),je(this,"source",void 0),je(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Qo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(vf.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){_r(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[hP,pP],Object.getOwnPropertyDescriptor(ki.prototype,"startProcessAudioBuffer"),ki.prototype),Ks(ki.prototype,"pauseProcessAudioBuffer",[mP,fP],Object.getOwnPropertyDescriptor(ki.prototype,"pauseProcessAudioBuffer"),ki.prototype),Ks(ki.prototype,"seekAudioBuffer",[gP,bP],Object.getOwnPropertyDescriptor(ki.prototype,"seekAudioBuffer"),ki.prototype),Ks(ki.prototype,"resumeProcessAudioBuffer",[xP,vP],Object.getOwnPropertyDescriptor(ki.prototype,"resumeProcessAudioBuffer"),ki.prototype),Ks(ki.prototype,"stopProcessAudioBuffer",[wP,_P],Object.getOwnPropertyDescriptor(ki.prototype,"stopProcessAudioBuffer"),ki.prototype),Ks(ki.prototype,"close",[yP],Object.getOwnPropertyDescriptor(ki.prototype,"close"),ki.prototype),Ks(ki.prototype,"setAudioBufferPlaybackSpeed",[EP,CP],Object.getOwnPropertyDescriptor(ki.prototype,"setAudioBufferPlaybackSpeed"),ki.prototype),ki);class Ln extends nn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=yf().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),je(this,"trackList",void 0),je(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(N.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):N.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){N.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}ow(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(s=>{s instanceof Ln?s.emit(up.TRANSCEIVER_UPDATED,t):s._updateRtpTransceiver(t)}))}}class QZ extends Sj{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Qo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),je(this,"audioBuffer",void 0),je(this,"sourceNode",void 0),je(this,"startPlayTime",0),je(this,"startPlayOffset",0),je(this,"pausePlayTime",0),je(this,"options",void 0),je(this,"currentLoopCount",0),je(this,"currentPlaybackSpeed",100),je(this,"_currentState","stopped"),this.audioBuffer=t,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const SP=new Map;function NP(e,t){if(e.length===0||t.length===0)return 1/0;const s=D1(e),r=D1(t);return Math.floor(r/s)}class oN{get rendFrameRate(){const t=Math.max(1,NP(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Mi.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(N.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var s;t!==this._videoState&&(this._videoState=t,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(t){je(this,"trackId",void 0),je(this,"config",void 0),je(this,"onFirstVideoFrameDecoded",void 0),je(this,"onFirstVideoFrameRender",void 0),je(this,"onVideoBufferReady",void 0),je(this,"onVideoStateChanged",void 0),je(this,"freezeTimeCounterList",[]),je(this,"renderFreezeAccTime",0),je(this,"renderFreezeAccTime2",0),je(this,"isKeepLastFrame",!1),je(this,"isDestroyed",!1),je(this,"timeUpdatedCount",0),je(this,"freezeTime",0),je(this,"playbackTime",0),je(this,"lastTimeUpdatedTime",0),je(this,"autoplayFailed",!1),je(this,"videoTrack",void 0),je(this,"videoElement",void 0),je(this,"cacheVideoElement",void 0),je(this,"cancelRVFId",void 0),je(this,"internal",!1),je(this,"_render_interframe_delays",[]),je(this,"_render_interframe_delays_sizes",[]),je(this,"_videoState",Td.VideoStateStopped),je(this,"videoElementCheckInterval",void 0),je(this,"videoElementFreezeTimeout",void 0),je(this,"_videoElementStatus",Mi.NONE),je(this,"_isInPage",!0),je(this,"isGettingVideoDimensions",!1),je(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),je(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&vr.curState==="running"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(vL())),TL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),je(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&N.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Mi.PLAYING;break;case"loadeddata":if(this.videoState=Td.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Mi.CANPLAY;break;case"stalled":this.videoElementStatus=Mi.STALLED;break;case"suspend":this.videoElementStatus=Mi.SUSPEND;break;case"pause":this.videoElementStatus=Mi.PAUSED,Xi()||zc()||ii()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Mi.WAITING;break;case"abort":this.videoElementStatus=Mi.ABORT;break;case"ended":this.videoElementStatus=Mi.ENDED;break;case"emptied":this.videoElementStatus=Mi.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=Mi.ERROR,N.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>G("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Co.lastVisibleTime<Co.lastHiddenTime||l<Co.lastHiddenTime||l<Co.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const A=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(A),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),je(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(vL())),TL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),vr.on(xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vr.on(xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const s=this.videoElement.play();s&&s.catch&&s.catch(i=>{t&&kj(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),i)});const r=$s();if((r.name==="Safari"&&Number(r.version)===15||df())&&s&&s.then){const i=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(i).catch(i)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const s=t.getContext("2d");if(!s)return N.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,t.width,t.height);const r=s.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new pt((l,A)=>{r.toBlob(async u=>{if(r.remove(),u){const m=await Qj(u);l({buffer:m,width:r.width,height:r.height})}else A(new Fe(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,s<0?.1:s>1?1:s)})):await aN(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,vr.off(xi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vr.off(xi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Td.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Mi.INIT,!this.videoElementCheckInterval&&(TP.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(l){return l!==document.body&&document.body.contains(l)}(this.videoElement)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,s;let l;const A=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",A),this.videoElementFreezeTimeout=window.setTimeout(u,G("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Td.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Td.VideoStateFrozen:document.addEventListener("visibilitychange",A))},m=(f,b)=>{if(this.videoElementStatus===Mi.PLAYING){if(l){const S=b.presentationTime-l.presentationTime,F=b.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(F),this._render_interframe_delays.push(S);const B=D1(this._render_interframe_delays_sizes),j=B-this._render_interframe_delays_sizes[0];if(B>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Td.VideoStateStarting&&(this.videoState=Td.VideoStateDecoding),this.videoState===Td.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,G("VIDEO_FREEZE_DURATION"))),S<G("VIDEO_FREEZE_DURATION")&&this.videoState===Td.VideoStateFrozen&&(this.videoState=Td.VideoStateDecoding),S>G("VIDEO_FREEZE_DURATION")&&Co.lastVisibleTime>=Co.lastHiddenTime&&l.timestamp>Co.lastVisibleTime&&l.timestamp>Co.lastHiddenTime){const K=Math.min(66,NP(this._render_interframe_delays_sizes,this._render_interframe_delays)),X=Math.max(0,S-(F-1)*K);this.renderFreezeAccTime2+=X>K?X:0,this.renderFreezeAccTime+=S}}l=Rr(Rr({},b),{},{timestamp:f})}else this.isSkipCalcRenderFreezeTime()&&(l=Rr(Rr({},b),{},{timestamp:f}));var w,_;G("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(w=(_=this.videoElement).requestVideoFrameCallback)===null||w===void 0?void 0:w.call(_,m))};this.cancelRVFId=(t=(s=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(s,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),j0()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=$s();this.config.noStyle||(r.name==="Safari"&&Number(r.version)===15||df()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,kr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,kr()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(l=>{N.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){var t,s;TP.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(s=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(s,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Mi.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Mi.DESTROYED||this.internal}handleAutoPlayFailed(){const t=s=>{s.preventDefault(),this.videoElement.play().then(()=>{N.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{N.error(r)}),this.autoplayFailed=!1,P0()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};P0()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Oj()}}const TP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class yw extends oN{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),je(this,"container",void 0),je(this,"slot",void 0),this.slot=t.element,this.internal=s,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const s=t.element;var r;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(r=this.slot)===null||r===void 0||r.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var s;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await aN(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var RP,IP,OP,kP,DP,BP,LP,jP,PP,UP,FP,MP,VP,QP,HP,GP,KP,WP,zP,qP,YP,XP,JP,$P,ZP,eU,tU,sU,js,rU,nU,iU,aU,oU,cU,lU,dU,zo;let Er=(RP=$t({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),IP=rn(),OP=$t({argsMap:e=>[e.getTrackId()]}),kP=pf("LocalVideoTrack","_enabledMutex"),DP=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),BP=rn(),LP=pf("LocalVideoTrack","_enabledMutex"),jP=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),PP=rn(),UP=$t({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),FP=rn(),MP=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),VP=rn(),QP=rn(),HP=$t({argsMap:(e,t,s)=>[e.getTrackId(),t,s]}),GP=rn(),KP=rn(),WP=rn(),zP=$t({argsMap:e=>[e.getTrackId()]}),qP=rn(),YP=rn(),XP=rn(),JP=rn(),$P=rn(),ZP=$t({argsMap:(e,t)=>[e.getTrackId(),t.name]}),eU=$t({argsMap:e=>[e.getTrackId()]}),tU=$t({argsMap:e=>[e.getTrackId()]}),sU=$t({argsMap:(e,t,s)=>[e.getTrackId(),t.label,s]}),js=class _H extends _f{get videoHeight(){if(ii()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(ii()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,s,r,i,l,A){if(super(t,l),je(this,"trackMediaType",wf.VIDEO),je(this,"_player",void 0),je(this,"isUseScaleResolutionDownBy",!1),je(this,"_videoVisibleTimer",null),je(this,"_previousVideoVisibleStatus",void 0),je(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),je(this,"_encoderConfig",void 0),je(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),je(this,"_optimizationMode",void 0),je(this,"_saveEncodeBitrateRatio",1),je(this,"_videoHeight",void 0),je(this,"_videoWidth",void 0),je(this,"_forceBitrateLimit",void 0),je(this,"_enabled",!0),je(this,"_processorDestination",void 0),je(this,"_processorContext",void 0),ii()){const{width:u,height:m}=t.getSettings();this._videoWidth=u,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=r,this._optimizationMode=i,this._hints=A||[],s&&this._hints.indexOf(or.CUSTOM_TRACK)!==-1?this._encoderConfig=Dr(s):this._encoderConfig=s,this._hints.indexOf(or.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(v1(er.CHROME,115)&&iw().indexOf("Windows")!==-1){const u=function(m,f){if("VideoFrame"in window&&"TransformStream"in window&&Ls().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(m),w=new MediaStreamTrackGenerator({kind:"video"});let _,S,F=Date.now();const B=()=>{j&&(clearInterval(j),j=void 0),_&&(_.close(),_=void 0),m.stop(),S=void 0,w.removeEventListener("ended",B)};let j=window.setInterval(()=>{if(S&&_&&Date.now()-F>1e3)try{w.readyState==="live"?S.enqueue(_.clone()):B()}catch{B()}},1e3);const K=new TransformStream({transform:(X,oe)=>{w.readyState==="live"?(S=oe,F=Date.now(),_===void 0?(_=X,oe.enqueue(X.clone())):(oe.enqueue(_),_=X)):X.close()}});return w.addEventListener("ended",B),b.readable.pipeThrough(K).pipeTo(w.writable),w}}(t);u&&(N.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}s&&this._hints.indexOf(or.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Bj(this.getTrackId(),"local"),this._processorDestination=new Dj(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const r=Rr(Rr(Rr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new oN(r):this._player=new yw(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(vf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Sr(this,Dt.NEED_DISABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return s||(this._enabled=!1),void N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Sr(this,Dt.NEED_ENABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,N.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Sr(this,Dt.NEED_MUTE_TRACK,this):await Sr(this,Dt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),N.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Sr(this,Dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(N)}}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new Fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=$c(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=_w({encoderConfig:t});(ii()||Xi()||zc())&&(r.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const l=new Fe(W.UNEXPECTED_ERROR,i.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sr(this,Dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(N)}}getStats(){return Su(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Eo(this,Dt.GET_STATS)||Rr({},J1)}async setBeautyEffect(t){N.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,s):await aN(t)}async findClosestProfile(){const{width:t,height:s,frameRate:r}=this.getMediaStreamTrackSettings(),{width:i,height:l,frameRate:A}=this._encoderConfig||{},u=hf(this._videoWidth||t||i||0),m=hf(this._videoHeight||s||l||0),f=function(b,w,_){if(!Array.isArray(G("VIDEO_ENCODER_CONFIG_LIST"))||G("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const S=Math.min(b,w);return!(S>=480)&&Rr(Rr({},G("VIDEO_ENCODER_CONFIG_LIST").find(F=>F.height>S)),{},{frameRate:_})}(u,m,hf(r||A||15));if(f)return N.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(u,"x").concat(m," => ").concat(JSON.stringify(f))),this.setEncoderConfiguration(f)}async setBitrateLimit(t){N.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void N.error(W.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=t,await Sr(this,Dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=s,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return N.error(W.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,N.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Pj(this._originMediaStreamTrack).then(t=>{let[s,r]=t;this._videoHeight=r,this._videoWidth=s}).catch(M0)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");N.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=$c(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sr(this,Dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(N)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:s,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!s||!r)return;const{bitrateMax:i,bitrateMin:l}=this._encoderConfig;if(l==null||i==null){const{max:A,min:u}=function(m,f,b,w,_){const S=G("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:w,max:_};if(_===void 0){const F=Math.floor(200*Math.pow(b/15,.6)*Math.pow(m*f/640/360,.75));_=S==="STANDARD_BITRATE"?4*F:2*F,w=w??F}else w=w??Math.floor(_/10);return{min:w,max:_}}(t,s,r,l,i);if(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=A,G("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&i==null){const[m,f]=function(b,w,_){const S=4*Math.floor(2e5*Math.pow(_/15,.6)*Math.pow(b*w/230400,.75)),F=b*w,B=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let K=wo(B).call(B).next().value,X=1;if(B.has(F))K=B.get(F);else{var oe;const _t=zh(oe=Array.from(B.entries())).call(oe,(es,vs)=>{let[ps]=es,[tr]=vs;return ps-tr}),ns=_t.find(es=>{let[vs]=es;return vs>F});if(ns){const es=_t.indexOf(ns);if(es>0){const vs=_t[es-1],ps=(F-vs[0])/(ns[0]-vs[0]);K=vs[1]+ps*(ns[1]-vs[1])}else K=ns[1]}else K=_t[_t.length-1][1]}if(j.has(F))X=j.get(F);else{var xe;const _t=zh(xe=Array.from(j.entries())).call(xe,(es,vs)=>{let[ps]=es,[tr]=vs;return ps-tr}),ns=_t.find(es=>{let[vs]=es;return vs>F});if(ns){const es=_t.indexOf(ns);if(es>0){const vs=_t[es-1],ps=(F-vs[0])/(ns[0]-vs[0]);X=vs[1]+ps*(ns[1]-vs[1])}else X=ns[1]}else X=_t[_t.length-1][1]}const Ee=G("VIDEO_NEW_BITRATE_RATIO");Ee&&Ee>0&&(K=Ee/100);const me=Math.floor(S*K),Re=Math.floor(65e4*Math.pow(b*w/230400,.5)*Math.pow(_/15,.69));let He=me;const Xe=G("VIDEO_STANDARD_BITRATE_VERSION");return Xe&&Xe>0&&(Xe===1?He=S:Xe===2?He=me:Xe===3&&(He=Re)),[Math.floor(He/1e3),X]}(t,s,r);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=u?Math.min(u,m):m,this._saveEncodeBitrateRatio=f,N.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(r,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else N.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(s,", fps: ").concat(r,"] => [brMax: ").concat(A,", brMin: ").concat(u,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,s;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:l,slot:A}=i;if(this.isPlaying&&l instanceof HTMLVideoElement&&A instanceof HTMLElement){const u=jL.checkOneElementVisible(l),m=Object.assign({},u);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const f=Ot.reportApiInvoke(null,{tag:yr.TRACER,name:Pr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(r){throw new Fe(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Fe(W.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Rr(Rr({},r),$c(t))),r=ap(r);const i=dr(8,"track-video-cloned-"),l=new _H(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,ap(this._scalabilityMode),this._optimizationMode,i,ap(this._hints));return t&&r&&l.setEncoderConfiguration(r),N.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(s)),l}async replaceTrack(t,s){if(!(t instanceof MediaStreamTrack))throw new Fe(W.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Fe(W.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Su(()=>{Ot.reportApiInvoke(null,{name:Pr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:yr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void N.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Fe(W.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void N.warning("Video track is not published, SEI can not be send");const r=s.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",t):N.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(xa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Sr(this,Dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sr(this,Dt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xa.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ho.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ho.REQUEST_CONSTRAINTS)}},Ks(js.prototype,"play",[RP,IP],Object.getOwnPropertyDescriptor(js.prototype,"play"),js.prototype),Ks(js.prototype,"stop",[OP],Object.getOwnPropertyDescriptor(js.prototype,"stop"),js.prototype),Ks(js.prototype,"setEnabled",[kP,DP,BP],Object.getOwnPropertyDescriptor(js.prototype,"setEnabled"),js.prototype),Ks(js.prototype,"setMuted",[LP,jP,PP],Object.getOwnPropertyDescriptor(js.prototype,"setMuted"),js.prototype),Ks(js.prototype,"setSaveEncodeBitrateRatio",[UP,FP],Object.getOwnPropertyDescriptor(js.prototype,"setSaveEncodeBitrateRatio"),js.prototype),Ks(js.prototype,"setEncoderConfiguration",[MP,VP],Object.getOwnPropertyDescriptor(js.prototype,"setEncoderConfiguration"),js.prototype),Ks(js.prototype,"getStats",[QP],Object.getOwnPropertyDescriptor(js.prototype,"getStats"),js.prototype),Ks(js.prototype,"setBeautyEffect",[HP,GP],Object.getOwnPropertyDescriptor(js.prototype,"setBeautyEffect"),js.prototype),Ks(js.prototype,"getCurrentFrameData",[KP],Object.getOwnPropertyDescriptor(js.prototype,"getCurrentFrameData"),js.prototype),Ks(js.prototype,"getCurrentFrameImage",[WP],Object.getOwnPropertyDescriptor(js.prototype,"getCurrentFrameImage"),js.prototype),Ks(js.prototype,"findClosestProfile",[zP,qP],Object.getOwnPropertyDescriptor(js.prototype,"findClosestProfile"),js.prototype),Ks(js.prototype,"setBitrateLimit",[YP],Object.getOwnPropertyDescriptor(js.prototype,"setBitrateLimit"),js.prototype),Ks(js.prototype,"setOptimizationMode",[XP],Object.getOwnPropertyDescriptor(js.prototype,"setOptimizationMode"),js.prototype),Ks(js.prototype,"setScalabiltyMode",[JP],Object.getOwnPropertyDescriptor(js.prototype,"setScalabiltyMode"),js.prototype),Ks(js.prototype,"updateMediaStreamTrackResolution",[$P],Object.getOwnPropertyDescriptor(js.prototype,"updateMediaStreamTrackResolution"),js.prototype),Ks(js.prototype,"pipe",[ZP],Object.getOwnPropertyDescriptor(js.prototype,"pipe"),js.prototype),Ks(js.prototype,"unpipe",[eU],Object.getOwnPropertyDescriptor(js.prototype,"unpipe"),js.prototype),Ks(js.prototype,"close",[tU],Object.getOwnPropertyDescriptor(js.prototype,"close"),js.prototype),Ks(js.prototype,"replaceTrack",[sU],Object.getOwnPropertyDescriptor(js.prototype,"replaceTrack"),js.prototype),js),Ew=(rU=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),nU=rn(),iU=pf("CameraVideoTrack","_enabledMutex"),aU=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),oU=rn(),cU=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),lU=rn(),dU=$t({argsMap:e=>[e.getTrackId()]}),zo=class yH extends Er{get __className__(){return"CameraVideoTrack"}constructor(t,s,r,i,l,A){super(t,$c(s.encoderConfig),i,l,A),je(this,"_config",void 0),je(this,"_originalConstraints",void 0),je(this,"_constraints",void 0),je(this,"_enabled",!0),je(this,"_deviceName","default"),je(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(df()||y1())&&!function(){const u=$s();if(u.os!==qn.IOS||!u.osVersion)return!1;const m=u.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&RL()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=$c(this._config.encoderConfig),vr.on(xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vr.on(xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(N.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const s=await Wo.getDeviceById(t),r={};r.video=Rr({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Ko(r,this.getTrackId())}catch(l){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),i=await Ko({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Wo.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw N.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}N.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){N.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const s={video:Rr(Rr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Ko(s,this.getTrackId())}catch(i){throw N.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Ko({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Rr({},s.video),N.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Ko({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Sr(this,Dt.NEED_ENABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await Sr(this,Dt.NEED_DISABLE_TRACK,this)}catch(r){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}N.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,s){if(!this._enabled)throw new Fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=$c(t),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Dr(this._config);r.encoderConfig=t;const i=_w(r);(ii()||Xi()||zc())&&(i.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(l){const A=new Fe(W.UNEXPECTED_ERROR,l.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),A.toString()),A}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(or.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sr(this,Dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(N)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Xi()||zc())&&this._enabled&&!this._isClosed&&vr.duringInterruption){const t=async()=>{vr.off(xi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};vr.on(xi.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vf.TRACK_ENDED)}async renewMediaStreamTrack(t){const s=t||this._constraints,r=Wo.searchDeviceIdByName(this._deviceName);if(r&&!s.deviceId&&(s.deviceId={exact:r}),this._enabled){const i=await Ko({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),vr.off(xi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vr.off(xi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=Rr(Rr({},r),$c(t))),r=ap(r);const i=dr(8,"track-cam-cloned-"),l=new yH(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,ap(Rr(Rr({},this._config),{},{encoderConfig:r})),ap(this._constraints),ap(this._scalabilityMode),this._optimizationMode,i);return t&&r&&l.setEncoderConfiguration(r),N.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(s)),l}bindProcessorContextEvents(){this.processorContext.on(Ho.REQUEST_UPDATE_CONSTRAINTS,async(t,s,r)=>{try{const i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),s()}catch(i){r(i)}}),this.processorContext.on(Ho.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Ks(zo.prototype,"setDevice",[rU,nU],Object.getOwnPropertyDescriptor(zo.prototype,"setDevice"),zo.prototype),Ks(zo.prototype,"setEnabled",[iU,aU,oU],Object.getOwnPropertyDescriptor(zo.prototype,"setEnabled"),zo.prototype),Ks(zo.prototype,"setEncoderConfiguration",[cU,lU],Object.getOwnPropertyDescriptor(zo.prototype,"setEncoderConfiguration"),zo.prototype),Ks(zo.prototype,"close",[dU],Object.getOwnPropertyDescriptor(zo.prototype,"close"),zo.prototype),zo);function AU(e){const t=dr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:t,tag:yr.TRACER,name:Pr.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new nn(e.mediaStreamTrack,e.encoderConfig?xw(e.encoderConfig):{},t,!1);return N.info("create custom audio track success with config",e,"trackId",r.getTrackId()),s.onSuccess(r.getTrackId()),r}function cN(e,t,s,r){s.optimizationMode&&(r&&r.width&&r.height?(s.encoderConfig=Rr(Rr({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(t.contentHint=s.optimizationMode,t.contentHint===s.optimizationMode?N.debug("[".concat(e,"] set content hint to"),s.optimizationMode):N.debug("[".concat(e,"] set content hint failed")))):N.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var uU,hU,pU,mU,xc,fU,gU,bU,xU,vU,wU,_U,Di;class yU extends yj{getUserId(){return this._userId}constructor(t,s,r,i){super(t,"track-".concat(t.kind,"-").concat(s,"-").concat(i.clientId,"_").concat(dr(5,""))),je(this,"_userId",void 0),je(this,"_uintId",void 0),je(this,"_isDestroyed",!1),je(this,"store",void 0),je(this,"processor",void 0),je(this,"processorContext",void 0),this._userId=s,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Cf=(uU=$t({argsMap:(e,t,s)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),hU=$t({argsMap:e=>[e.getTrackId()]}),pU=$t({argsMap:(e,t)=>[e.getTrackId(),t.name]}),mU=$t({argsMap:e=>[e.getTrackId()]}),Ks((xc=class extends yU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,s,r,i){super(e,t,s,r),je(this,"_videoVisibleTimer",null),je(this,"_previousVideoVisibleStatus",void 0),je(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),je(this,"trackMediaType",wf.VIDEO),je(this,"_videoWidth",void 0),je(this,"_videoHeight",void 0),je(this,"_player",void 0),je(this,"_prePlayer",void 0),je(this,"processorDestination",void 0),je(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new Bj(this.getTrackId(),"remote"),this.processorDestination=new Dj(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Su(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Eo(this,Dt.GET_STATS)||Rr({},wj)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(bc.PLAY_START),typeof e=="string"){const r=document.getElementById(e);r?e=r:(N.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const s=Rr(Rr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(s);else{let r=!1,i=!1;e instanceof HTMLVideoElement?(this._player=new oN(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,r=this._player.videoState>0,this._player.updateConfig(s)):this._player=new yw(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(bc.FIRST_FRAME_DECODED),i&&this.safeEmit(bc.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=l=>{this.safeEmit(bc.VIDEO_STATE_CHANGED,l)},r&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(bc.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(bc.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Pj(this._originMediaStreamTrack).then(e=>{let[t,s]=e;this._videoHeight=s,this._videoWidth=t}).catch(M0)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:i,slot:l}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&l instanceof HTMLElement){const A=jL.checkOneElementVisible(i),u=Object.assign({},A);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const m=Ot.reportApiInvoke(null,{tag:yr.TRACER,name:Pr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(s){throw new Fe(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(xa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xa.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(up.SEI_RECEIVED,e)}}).prototype,"play",[uU],Object.getOwnPropertyDescriptor(xc.prototype,"play"),xc.prototype),Ks(xc.prototype,"stop",[hU],Object.getOwnPropertyDescriptor(xc.prototype,"stop"),xc.prototype),Ks(xc.prototype,"pipe",[pU],Object.getOwnPropertyDescriptor(xc.prototype,"pipe"),xc.prototype),Ks(xc.prototype,"unpipe",[mU],Object.getOwnPropertyDescriptor(xc.prototype,"unpipe"),xc.prototype),xc),Sf=(fU=$t({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),gU=$t({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),bU=$t({argsMap:(e,t)=>[e.getTrackId(),t]}),xU=$t({argsMap:e=>[e.getTrackId()]}),vU=$t({argsMap:e=>[e.getTrackId()]}),wU=$t({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_U=$t({argsMap:e=>[e.getTrackId()]}),Ks((Di=class extends yU{get isPlaying(){return this._useAudioElement?na.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,s,r){super(e,t,s,r),je(this,"trackMediaType",wf.AUDIO),je(this,"_source",void 0),je(this,"_useAudioElement",!0),je(this,"_volume",100),je(this,"processorContext",void 0),je(this,"processorDestination",void 0),je(this,"_played",!1),je(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new iN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new sN(e,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Qo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(bc.FIRST_FRAME_DECODED)}),this.processorContext=new jj(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Lj(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Qo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Qo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Qo.ON_AUDIO_BUFFER),this._source.on(Qo.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?na.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(na.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,G("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!pj())throw new Fe(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await na.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?na.getVolume(this.getTrackId()):this._source instanceof sN?this._source.getAudioVolume():0}getStats(){return Su(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Eo(this,Dt.GET_STATS)||Rr({},vj)}play(){N.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),na.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(N.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){N.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?na.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];N.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&na.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Fe(W.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Fe(W.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(xa.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(xa.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xa.ON_TRACK),this.processorDestination.removeAllListeners(xa.ON_NODE)}}).prototype,"setVolume",[fU],Object.getOwnPropertyDescriptor(Di.prototype,"setVolume"),Di.prototype),Ks(Di.prototype,"setAmplifiedVolume",[gU],Object.getOwnPropertyDescriptor(Di.prototype,"setAmplifiedVolume"),Di.prototype),Ks(Di.prototype,"setPlaybackDevice",[bU],Object.getOwnPropertyDescriptor(Di.prototype,"setPlaybackDevice"),Di.prototype),Ks(Di.prototype,"play",[xU],Object.getOwnPropertyDescriptor(Di.prototype,"play"),Di.prototype),Ks(Di.prototype,"stop",[vU],Object.getOwnPropertyDescriptor(Di.prototype,"stop"),Di.prototype),Ks(Di.prototype,"pipe",[wU],Object.getOwnPropertyDescriptor(Di.prototype,"pipe"),Di.prototype),Ks(Di.prototype,"unpipe",[_U],Object.getOwnPropertyDescriptor(Di.prototype,"unpipe"),Di.prototype),Di);const Co=new class extends Vr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),je(this,"_lastHiddenTime",0),je(this,"_lastVisibleTime",0),je(this,"needUploadStats",[]),je(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),N.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class EU extends Vr{constructor(t,s){super(),je(this,"trackMediaType",wf.DATA),je(this,"_version",1),je(this,"_type",3),je(this,"_config",void 0),je(this,"_originDataChannel",void 0),je(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),je(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),je(this,"_datachannelEventMap",new Map),this._config=t,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,s;return(t=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pt((t,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var i;s(new Fe(W.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new Fe(W.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Fe(W.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[vw.OPEN,vw.CLOSE,vw.ERROR].forEach(s=>{const r=()=>{this.emit(s)};this._datachannelEventMap.set(s,r),t.addEventListener(s,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[r,i]=s;t.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class HZ extends EU{constructor(t){super(t),je(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=s.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&N.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let l=s.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(vw.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class GZ extends EU{send(t){if(this._originDataChannel){let s=t;s=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function Cw(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Ev.revokeObjectURL(e),0),new Worker(Ev.createObjectURL(e))}const CU=71,lN=1,dN=2,AN=1,SU=2;var Tu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(Tu||{});function uN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=e.getUint8(0);if(s!==CU)return;const r=e.getUint16(1),i=lN+dN+r,l=new Uint8Array(e.byteLength-i);l.set(new Uint8Array(e.buffer,i,e.byteLength-i));const A={m:s,tlvLen:r,tlv:[],frame:l};let u=lN+dN;for(;u<i;){const m=e.getUint8(u),f=e.getUint16(u+AN),b=AN+SU;if(m===Tu.AUDIO_LEVEL){let w=e.getUint8(u+b);for(let _=1;_<f;_++)w=w<<8|e.getUint8(u+b+_);A.tlv.push({tag:m,length:f,value:t?127^w>>1:127&w})}else if(m===Tu.METADATA||m===Tu.AUDIO_64_BIT_PTS){const w=new Uint8Array(f);for(let _=0;_<f;_++)w[_]=e.getUint8(u+b+_);A.tlv.push({tag:m,length:f,value:w})}u+=b+f}return A}const Sw=new Map,Nw=127,mp=1e-10,hN=139/13,Tw=new Map;function pN(e,t,s){const r="".concat(e,"-").concat(t,"-").concat(s);let i=0;return Tw.has(r)?i=Tw.get(r):(i=Math.log(function(A,u){const m=A-u;u<m&&(u=m);let f=1;for(let b=A,w=1;b>u;b--,w++)f=f*b/w;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(s)+s*e,Tw.set(r,i)),i<mp&&(i=mp),i}function NU(e,t,s){const r=t.length,i=e.length/r;let l=!1;for(let A=0,u=0;A<r;A++){let m=0;for(let f=u+i;u<f;u++)e[u]>s&&m++;t[A]!==m&&(t[A]=m,l=!0)}return l}window.cache=Tw;let KZ=0;class TU{constructor(t){je(this,"id",void 0),je(this,"immediates",[]),je(this,"lastNonSilence",-1),je(this,"immediateSpeechActivityScore",mp),je(this,"lastLevelChangedTime",Date.now()),je(this,"levels",[]),je(this,"longs",[]),je(this,"longSpeechActivityScore",mp),je(this,"mediums",[]),je(this,"mediumSpeechActivityScore",mp),je(this,"minLevel",0),je(this,"nextMinLevel",0),je(this,"nextMinLevelWindowLength",0),je(this,"energyScore",0),this.id=t||"".concat(KZ++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,s=this.levels,r=this.minLevel+hN;let i=!1;for(let l=0;l<t.length;++l){let A=s[l];A<r&&(A=0);const u=Math.floor(A/hN);t[l]!==u&&(t[l]=u,i=!0)}return i}computeLongs(){return NU(this.mediums,this.longs,4)}computeMediums(){return NU(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=pN(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=pN(this.longs[0],10,47),this.longSpeechActivityScore>mp&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=pN(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Sm(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let r=t;return t<0&&(r=0),t>Nw&&(r=Nw),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+hN?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>Nw&&(s=Nw),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class WZ{constructor(t){je(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?t=!0:setTimeout(this.execute.bind(this),s)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class mN{constructor(t,s,r){je(this,"isDominant",void 0),je(this,"energyRanking",void 0),je(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=s,this.energyScore=r}}class zZ extends Vr{constructor(t){super(),je(this,"dominantId",null),je(this,"lastDecisionTime",0),je(this,"lastLevelChangedTime",0),je(this,"lastLevelIdleTime",0),je(this,"relativeSpeechActivities",[]),je(this,"speakers",new Map),je(this,"enableSilence",!1),je(this,"timeoutToSilenceInterval",0),je(this,"decisionMaker",null),je(this,"loudest",[]),je(this,"numLoudestToTrack",3),je(this,"energyExpireTimeMs",250),je(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,s!=null&&(this.energyExpireTimeMs=s),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(s=>s.id===t)}levelChanged(t,s){const r=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const l=i.levelChanged(s,r);return this.updateLoudestList(i,l,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(t){t.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(t){let s=this.speakers.get(t);return s||(s=new TU(t),this.speakers.set(t,s),this.maybeStartDecisionMaker()),s}updateLoudestList(t,s,r){const i=t.id===this.dominantId;if(s<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new mN(i,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new mN(i,0,t.energyScore);const l=r-this.energyExpireTimeMs;let A=0;for(;A<this.loudest.length;){const m=this.loudest[A];if(m.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(A,1);else if(m.id!==t.id)++A;else if(this.loudest.splice(A,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new mN(i,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new WZ(this),this.decisionMaker.execute())}makeDecision(t){let s=null,r=null;const i=this.speakers.size;let l=null;if(i===0)l=null;else if(i===1){var A;const u=wo(A=this.speakers).call(A).next().value;this.enableSilence&&u&&(l=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){const b=this.speakers.entries().next();b.value&&(l=b.value[0],u=b.value[1])}else l=u.id;u!=null&&u.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let f=2;for(const b of this.speakers.entries()){const[w,_]=b;if(_===u)continue;_.evaluateSpeechActivityScores(t);for(let j=0;j<m.length;++j){const K=u==null?mp:u.getSpeechActivityScore(j);m[j]=Math.log(_.getSpeechActivityScore(j)/K)}const S=m[0],F=m[1],B=m[2];S>3&&F>2&&B>0&&F>f&&(f=F,l=w)}this.enableSilence&&u!=null&&l===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(s=this.dominantId,this.dominantId=l,r=this.dominantId),r==null&&!this.enableSilence||r===s||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),s=300-(t-this.lastLevelIdleTime);let r=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=s;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(t){const s=[];for(const i of wo(r=this.speakers).call(r)){var r;const l=t-i.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||i.id!==this.dominantId)?s.push(i.id):300<l&&i.levelTimedOut()}s.forEach(i=>this.speakers.delete(i))}}const Nf=new Map;let Pl=null,Rw=null;const RU=3;let fp=[];const Ul=new Map,Iw=new Map;class qZ{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,s){je(this,"id",void 0),je(this,"track",void 0),je(this,"score",0),je(this,"active",!0),je(this,"muted",!1),je(this,"timer",0),je(this,"actives",0),je(this,"inactives",0),this.id=t,this.track=s,this.setActive(Ul.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:r}=function(){const i=[],l=[];return Array.from(wo(Ul).call(Ul)).forEach(A=>{A.active?i.push(A):l.push(A)}),{actives:i,inactives:l}}();if(s.length>3){let i;s.forEach(l=>{(!i||i.score>l.score)&&(i=l)}),i&&i.setActive(!1)}if(s.length<3&&r.length>0){let i;r.forEach(l=>{(!i||i.score<l.score)&&l.id!==this.id&&(i=l)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(s){let r;return Array.from(wo(Ul).call(Ul)).forEach(i=>{!i.active||i.id===s||i.samples<40||(!r||i.score<r.score)&&(r=i)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(s){let r;return Array.from(wo(Ul).call(Ul)).forEach(i=>{i.active||i.id===s||i.samples<40||(!r||i.score>r.score)&&(r=i)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Ow;function IU(e){const t=Ul.get(e);t&&(Ul.delete(e),t.clearTimer())}const kw=new Map,YZ=new Map,fN="video/h264",gN="video/h265";function OU(e,t,s){let r=new Uint8Array(e,t,s),i=[],l=0;for(;i.length<s;)l+3<s&&r[l]===0&&r[l+1]===0&&r[l+2]===3&&(r[l+3]===0||r[l+3]===1||r[l+3]===2||r[l+3]===3)?(i.push(r[l],r[l+1],r[l+3]),l+=4):(i.push(r[l]),l++);return new Uint8Array(i)}function kU(e){const t=e.length;let s=[],r=0;for(;r<t;)r+2<t&&e[r]===0&&e[r+1]===0&&(e[r+2]===0||e[r+2]===1||e[r+2]===2||e[r+2]===3)?(s.push(e[r],e[r+1],3,e[r+2]),r+=3):(s.push(e[r]),r++);return new Uint8Array(s)}function DU(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(e[i]===0&&e[i+1]===0&&e[i+2]===1){t=i;break}if(i<e.length-4&&e[i]===0&&e[i+1]===0&&e[i+2]===0&&e[i+3]===1){t=i;break}}if(t===-1)return"";const s=t+(e[t+2]===0?4:3);if(s>=e.length)return"";const r=e[s];return 128&r?"":(r>>1&63)>=32||s+1<e.length&&!(248&e[s+1])?gN:(31&r)<=31?fN:""}const Dw=new Map,z0=new Map;(function(){const e=$s();Xn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xn.getStreamFromExtension=e.name===er.CHROME&&Number(e.version)>34,Xn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let s=!1;try{t.addTransceiver("audio"),s=!0}catch{}return t.close(),s}(),Xn.supportMinBitrate=e.name===er.CHROME||e.name===er.EDGE,Xn.supportSetRtpSenderParameters=function(){const t=$s();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Sd()||!(!ii()&&!aw())||t.name===er.FIREFOX&&Number(t.version)>=64)}(),e.name===er.SAFARI&&(Number(e.version)>=14?Xn.supportDualStream=!0:Xn.supportDualStream=!1),Xn.webAudioMediaStreamDest=function(){const t=$s();return!(t.name===er.SAFARI&&Number(t.version)<12)}(),Xn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xn.supportWebGL=typeof WebGLRenderingContext<"u",Xn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Sd()||(Xn.webAudioWithAEC=!0),Xn.supportShareAudio=function(){const t=$s();return(t.os===qn.WIN_10||t.os===qn.WIN_81||t.os===qn.WIN_7||t.os===qn.LINUX||t.os===qn.MAC_OS||t.os===qn.CHROMIUM_OS)&&t.name===er.CHROME&&Number(t.version)>=74}(),Xn.supportDataChannel=!!(Ll(76)||w1(68)||EL(14)),Xn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!kr()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Xn.supportWebRTCEncodedTransform=Ll(87)||wL()||w1(117),Xn.supportWebRTCInsertableStream=function(){const t=$s();return(t.name===er.CHROME||t.name===er.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Xn.supportSuppressLocalAudioPlayback=gj(),Xn.supportRestrictOwnAudio=bj(),cw(()=>{Xn.supportDualStreamEncoding=function(){const t=$s();return!!G("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),N.debug("browser ua: ",navigator.userAgent),N.info("browser info: ",e),N.info("browser compatibility: ",Xn)})})();const XZ=["CHINA","GLOBAL"],BU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],gp=[],Tf=[];function bp(e,t){return!!t&&gp.some(s=>s.uid===e&&s.channelName===t)}function bN(){return Tf.length>0}var JZ=VD.forEach,LU=Ph("forEach")?[].forEach:function(e){return JZ(this,e,arguments.length>1?arguments[1]:void 0)};Is({target:"Array",proto:!0,forced:[].forEach!==LU},{forEach:LU});var $Z=Ti("Array","forEach"),ZZ=Bo,eee=Kn,tee=O,see=$Z,xN=Array.prototype,ree={DOMTokenList:!0,NodeList:!0},nee=function(e){var t=e.forEach;return e===xN||tee(xN,e)&&t===xN.forEach||eee(ree,ZZ(e))?see:t},iee=h(nee),aee=Ro,jU=Se;Is({target:"Object",stat:!0,forced:p(function(){jU(1)})},{keys:function(e){return jU(aee(e))}});var oee=h($e.Object.keys),cee=h(Em),lee=h(Ox),dee=Is,PU=hA,Aee=sv,uee=Je,UU=Pc,hee=Do,pee=xt,mee=JC,fee=Hr,gee=bu,bee=OD("slice"),xee=fee("species"),vN=Array,vee=Math.max;dee({target:"Array",proto:!0,forced:!bee},{slice:function(e,t){var s,r,i,l=pee(this),A=hee(l),u=UU(e,A),m=UU(t===void 0?A:t,A);if(PU(l)&&(s=l.constructor,(Aee(s)&&(s===vN||PU(s.prototype))||uee(s)&&(s=s[xee])===null)&&(s=void 0),s===vN||s===void 0))return gee(l,u,m);for(r=new(s===void 0?vN:s)(vee(m-u,0)),i=0;u<m;u++,i++)u in l&&mee(r,i,l[u]);return r.length=i,r}});var wee=Ti("Array","slice"),_ee=O,yee=wee,wN=Array.prototype,Eee=function(e){var t=e.slice;return e===wN||_ee(wN,e)&&t===wN.slice?yee:t},Cee=h(Eee);function ft(e,t,s,r,i){var l,A,u,m={};return iee(l=oee(r)).call(l,function(f){m[f]=r[f]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=cee(A=lee(u=Cee(s).call(s)).call(u)).call(A,function(f,b){return b(e,t,f)||f},m),i&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(i):void 0,m.initializer=void 0),m.initializer===void 0?(ND(e,t,m),null):m}let Bw=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),_N=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),vc=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),va=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Wt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Vs=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Bt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),Mt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),xp=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),as=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),wa=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),ms=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function Lw(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw N.error("Invalid Channel Name ".concat(e)),new Le(W.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function jw(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||DL(e,1,255)))throw new Le(W.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&N.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let NA=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const See={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},yN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function EN(e,t){bi(e.url,"".concat(t,".url"),1,1e3,!1),$r(e.x)||_r(e.x,"".concat(t,".x"),0,1e4),$r(e.y)||_r(e.y,"".concat(t,".y"),0,1e4),$r(e.width)||_r(e.width,"".concat(t,".width"),0,1e4),$r(e.height)||_r(e.height,"".concat(t,".height"),0,1e4),$r(e.zOrder)||_r(e.zOrder,"".concat(t,".zOrder"),0,255),$r(e.alpha)||_r(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Nee={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ru=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),CN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),jn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function FU(e){if(!e.channelName)throw new Le(W.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Le(W.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&bi(e.token,"info.token",1,2047),jw(e.uid),Lw(e.channelName),!0}let ja=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),TA=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ja=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Rf=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),ur=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),dn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),Pw=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Jn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),rr=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const MU=[rr.AFRICA,rr.ASIA,rr.CHINA,rr.EUROPE,rr.GLOBAL,rr.INDIA,rr.JAPAN,rr.NORTH_AMERICA,rr.OCEANIA,rr.OVERSEA,rr.SOUTH_AMERICA];let Vi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const Uw={CHINA:{},ASIA:{CODE:Vi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Vi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Vi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Vi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Vi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Vi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Vi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Vi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Vi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Vi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Vi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Vi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Vi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};V1&&(Uw.CHINA={CODE:Vi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Fl=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function VU(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class QU extends Vr{constructor(t,s){super(),U(this,"onICEConnectionStateChange",void 0),U(this,"onConnectionStateChange",void 0),U(this,"onDTLSTransportStateChange",void 0),U(this,"onDTLSTransportError",void 0),U(this,"onICETransportStateChange",void 0),U(this,"onFirstAudioReceived",void 0),U(this,"onFirstVideoReceived",void 0),U(this,"onFirstAudioDecoded",void 0),U(this,"onFirstVideoDecoded",void 0),U(this,"onFirstVideoRender",void 0),U(this,"onFirstVideoBufferReady",void 0),U(this,"onFirstVideoDecodedTimeout",void 0),U(this,"onSelectedLocalCandidateChanged",void 0),U(this,"onSelectedRemoteCandidateChanged",void 0),U(this,"onICECandidateError",void 0),U(this,"getLocalVideoStats",void 0)}}class Fw extends QU{constructor(t,s){super(t,s),U(this,"establishPromise",void 0)}}let Nt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),oi=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),RA=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const HU=["disconnected","failed"];let rt=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),ir=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Vt=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),Zc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),el=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ci=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Iu=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Pn=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Id=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),wc=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ml=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),If=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),An=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Of=function(e){return e.ABORT="abort",e}({}),Ou=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Tee=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Ree={[Bw.ACCESS_POINT]:{[va.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[va.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[va.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[va.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[va.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[va.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[va.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[va.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[va.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[va.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[va.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[va.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[va.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[va.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[va.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[va.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[va.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[va.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Bw.UNILBS]:{[vc.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vc.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vc.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vc.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vc.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vc.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vc.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vc.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vc.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vc.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vc.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vc.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[vc.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[Bw.STRING_UID_ALLOCATOR]:{[_N.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[_N.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[_N.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function kf(e){const t=Ree[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const s=t[e%1e4];if(!s){if(Math.floor(e/1e4)===Bw.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Iee={[Wt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Wt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Wt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Wt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Wt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Wt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Wt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Wt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Wt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Wt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Wt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Wt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Wt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Wt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[Wt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Wt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Wt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Wt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Wt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Wt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Wt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Wt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Wt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Wt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Wt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Wt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Wt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Wt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Wt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Wt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Wt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Wt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Wt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Wt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Wt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Wt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Wt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Wt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Wt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Wt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Wt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Wt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Wt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Wt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Wt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Wt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Wt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Wt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Wt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Wt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Wt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Wt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Wt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Wt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Wt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Wt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Wt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Wt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Wt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function vp(e){return Iee[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function GU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function SN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?GU(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):GU(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function NN(e,t){if(typeof e=="string")return e;const{proxy:s,host:r,port:i}=e;if(t){const l=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(l,"/ws/?p=").concat(Number(i)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Oee=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,kee=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Dee=/wss:\/\/(.+):([0-9]+)\/?/,Bee=/wss:\/\/(.[^\/]+)\/?/;let Lee=0;class jee{constructor(t,s){U(this,"id",0),U(this,"store",void 0),U(this,"recordIndex",void 0),U(this,"websockets",[]),U(this,"try443PortDuration",2e3),U(this,"forceCloseWSDuration",5e3),U(this,"try443PortTimeout",null),U(this,"forceCloseTimeout",null),U(this,"isTry443PortFailed",!1),U(this,"isNormalPortFailed",!1),U(this,"useDoubleDomain",!1),U(this,"useProxy",!1),U(this,"startTime",Date.now()),this.id=++Lee,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const s=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];N.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...i)}createWebSocket(t,s,r){this.logger("createWebSocket:",t,{isTry443Port:s,hasTimeoutDetection:r});const i=G("GATEWAY_DOMAINS"),l=Date.now(),A=[],u=i.find(_=>{var S;return et(S=t.host).call(S,_)});u||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)i.forEach(_=>{m.push(NN(SN(SN({},t),{},{host:t.host.replace(u,_)}),s))});else{const _=SN({},t);if(s&&u){const S=i.find(F=>F!==u);S&&(_.host=_.host.replace(u,S))}m.push(NN(_,s))}try{m.forEach(_=>{const S=new WebSocket(_);S.binaryType="arraybuffer",A.push(S),this.logger("ws is connecting:",S.url)})}catch(_){if(this.logger("ws create failed"),A.forEach(S=>S.close()),A.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,s,r);if(!s&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new Le(W.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}const f=L0();this.store&&this.store.recordJoinChannelService({urls:A.map(_=>_.url),service:"gateway"},this.recordIndex),A.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(S=>{S!==_&&(S.onopen=null,S.onclose=null,S.onmessage=null,S.close(),this.logger("close backup websocket: ".concat(S.url)))}),this.websockets.length=0,f.resolve(_)},_.onclose=S=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(_.readyState));const F=A.every(B=>B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(F)),F&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(S.reason)),f.reject({code:S.code,reason:Pw.A_ROUND_WS_FAILED})):!s&&F&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),s?this.isTry443PortFailed=F:this.isNormalPortFailed=F},_.onmessage=S=>this.logger("".concat(_.url," onmessage: ").concat(S.data))}),this.websockets.push(...A);const b=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},w=()=>{if(f.isResolved)return b();$s().os===qn.MAC_OS&&kr()&&b(),this.createWebSocket(t,!0,!0).then(_=>{f.resolve(_)}).catch(_=>{this.isNormalPortFailed&&f.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return r||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,s,r,i){return this.useDoubleDomain=!!s,typeof t=="string"&&(t=function(l){let A,u,m;return[,A,u,m]=l.match(Oee)||[],A||([,u,m]=l.match(kee)||[]),u&&m||([,u,m]=l.match(Dee)||[]),u&&m||([,u]=l.match(Bee)||[]),u||N.warning("un-destructible url: ",l),{proxy:A,host:u,port:m||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,r&&this.useProxy&&(N.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function KU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class WU extends Vr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;et(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ms.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ms.CONNECTED):this._state==="closed"?this.emit(ms.CLOSED):this._state==="failed"&&this.emit(ms.FAILED))}resetReconnectCount(t){N.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,s){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],A=arguments.length>5?arguments[5]:void 0;super(),U(this,"_websocketUrl",null),U(this,"connectionID",0),U(this,"currentURLIndex",0),U(this,"urls",[]),U(this,"_reconnectMode","tryNext"),U(this,"reconnectReason",void 0),U(this,"_initMutex",void 0),U(this,"name",void 0),U(this,"_state","closed"),U(this,"reconnectInterrupter",void 0),U(this,"websocket",void 0),U(this,"retryConfig",void 0),U(this,"reconnectCount",0),U(this,"forceCloseTimeout",5e3),U(this,"onlineReconnectListener",void 0),U(this,"useCompress",void 0),U(this,"tryDoubleDomain",!1),U(this,"use443PortOnly",!1),U(this,"wsInflateLength",0),U(this,"wsDeflateLength",0),U(this,"closeEstablishingWs",()=>{}),U(this,"store",void 0),U(this,"joinGatewayRecordIndex",void 0),this.store=A,this.name=t,this.retryConfig=function(w){for(var _=1;_<arguments.length;_++){var S=arguments[_]!=null?arguments[_]:{};_%2?KU(Object(S),!0).forEach(function(F){U(w,F,S[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(S)):KU(Object(S)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(S,F))})}return w}({},s),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=l,this._initMutex=new ai("websocket",A?A.clientId:void 0);const{timeout:u,timeoutFactor:m}=s,f=Math.max(300,Math.floor(3*u/5)),b=Math.max(1.2,Math.floor(8*m)/10);ga.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=b),Zr.on(np.NETWORK_STATE_CHANGE,(w,_)=>{w!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(w)),w===ga.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=t,this.state="connecting";try{var i;const l=L0(),A=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),function(u){return!(gw()||G("USE_NEW_TOKEN")||!G("ENABLE_PREALLOC_PC")&&(u==null||!u.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(Pn.PRE_CONNECT_PC),this.createWebSocketConnection(A).then(l.resolve).catch(l.reject),this.once(ms.CLOSED,()=>{l.reject(new Fe(W.WS_DISCONNECT))}),this.once(ms.CONNECTED,l.resolve),await l.promise}catch{}finally{r()}}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;s?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,s){if(!this.websocket)return void N.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:s})}sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Fe(W.WS_ABORT,"websocket is not ready");try{s||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new Fe(W.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var s;const r=L0();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=b=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),N.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},l=async b=>{var w;if(N.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new Fe(W.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const _=Eo(this,ms.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,S=await this.reconnectWithAction(_);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return r.reject(new Fe(W.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);r.resolve()}},A=b=>{this.emit(ms.ON_MESSAGE,b)},u=b=>{N.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=G("GATEWAY_WSS_ADDRESS")),N.debug("[".concat(this.name,"] start connect, url:"),t);const m=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;this._websocketUrl=NN(t);const b=await this.chooseBestWebsocketConnection(t);this.websocket=b,i&&i(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=A,this.websocket.onerror=u,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(b){const w=this.state==="closed",_=b instanceof Fe,S=_&&b.code===W.WS_ABORT,F=_&&b.code===W.WS_ERR,B=_?b.message:b&&(b.reason||b.toString());N.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(B)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[b]},m),w||F?(r.reject(w?new Fe(W.WS_DISCONNECT,"websocket is closed: ".concat(B)):new Fe(W.WS_ERR,"init websocket failed: ".concat(B))),F&&N.error("[".concat(this.name,"] init websocket failed: ").concat(B))):l&&l(b)}return r.promise}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;N.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Zr.isOnline||!Zr.onlineWaiter||(this.onlineReconnectListener=Zr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,s){const A=lw(this.reconnectCount,this.retryConfig);N.debug("[".concat(this.name,"] wait ").concat(A,"ms to reconnect websocket, mode: ").concat(t)),await pt.race([Yn(A),this.onlineReconnectListener||new pt(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(A,u)=>{this.emit(ms.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(A)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);N.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(N.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Cn(this,ms.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(A){var l;N.error("[".concat(this.name,"] reconnect failed ").concat(A&&A.toString()));const u=A==null||(l=A.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(u)){if(et(u).call(u,"dynamic key expired"))return this.emit(ms.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(et(u).call(u,"request downgrade fallback"))return this.emit(ms.ON_FALLBACK),!1}return this.reconnectWithAction(t,s)}return!0}}class TN extends WU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){const r=L0(),i=function(A,u){return new jee(A,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new Fe(W.WS_ABORT,"choose best websocket aborted"))};const l=G("GATEWAY_DOMAINS");return N.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,s).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class q0 extends WU{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,s){return new pt((r,i)=>{let l=!1;const A=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),A.forEach(F=>{F.onclose=null,F.onopen=null,F.onmessage=null,F.close()}),i(new Fe(W.WS_ABORT,"choose best websocket aborted"))};const u=G("GATEWAY_DOMAINS");let m;const f=t.indexOf("?h="),b=u.find(F=>f!==-1?et(t).call(t,F,f):et(t).call(t,F));N.debug("[choose-best-ws] currentDomain: ",b,", domains: ",u);let w=!this.tryDoubleDomain||!b;if(!w&&b){var _;const F=Date.now();try{u.forEach(B=>{const j=f===-1?t.replace(b,B):t.substr(0,f)+t.substr(f).replace(b,B),K=new WebSocket(j);K.binaryType="arraybuffer",A.push(K),N.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),A.forEach(j=>j.close());A.length;)A.pop();w=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:A.map(B=>B.url),service:"gateway"},s),A.forEach(B=>{B.onopen=()=>{if(l)return;const j=Date.now()-F;N.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),A.filter(K=>K!==B).forEach(K=>{N.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),l=!0,r(B)},B.onclose=j=>{m=j,!l&&(A.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),l=!0,i(m)))},B.onmessage=j=>{N.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(j.data))}}),Yn(this.forceCloseTimeout).then(()=>{A.forEach(B=>{B.readyState!==WebSocket.OPEN&&B.close()})})}if(w){var S;let F;N.debug("[choose-best-ws] use single url: ",t),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[t],service:"gateway"},s);try{F=new WebSocket(t),A.push(F),F.binaryType="arraybuffer"}catch(B){const j=new Fe(W.WS_ERR,"init websocket failed! Error: ".concat(B.toString()));return N.error("[".concat(this.name,"]").concat(j)),void i(j)}F.onopen=()=>{r(F)},F.onclose=B=>{i(B)},F.onmessage=B=>{N.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(B.data))},Yn(this.forceCloseTimeout).then(()=>{F&&F.readyState!==WebSocket.OPEN&&F.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class zU extends Vr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Vs.CONNECTED?this.emit(Bt.WS_CONNECTED):t===Vs.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):t===Vs.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),U(this,"__name__","AgoraRTCSignal"),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",Vs.CLOSED),U(this,"reconnectToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new B1(5)),U(this,"pingpongTimer",void 0),U(this,"wsInflateDataTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"ortc",void 0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Ms.UID_BANNED);break;case 15:this.close(Ms.IP_BANNED);break;case 16:this.close(Ms.CHANNEL_BANNED)}if(i._type===as.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Wt.ERR_LICENSE_MISSING:this.close(Ms.LICENSE_MISSING);break;case Wt.ERR_LICENSE_EXPIRED:this.close(Ms.LICENSE_EXPIRED);break;case Wt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ms.LICENSE_MINUTES_EXCEEDED);break;case Wt.ERR_LICENSE_PERIOD_INVALID:this.close(Ms.LICENSE_PERIOD_INVALID);break;case Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ms.LICENSE_MULTIPLE_SDK_SERVICE);break;case Wt.ERR_LICENSE_ILLEGAL:this.close(Ms.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new TN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Vs.CONNECTED&&this.reconnect("retry",Ii.OFFLINE)})}async request(t,s,r,i){const l=dr(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,m=()=>new pt((F,B)=>{if(this.connectionState===Vs.CONNECTED)return F();const j=()=>{this.off(Bt.WS_CLOSED,K),F()},K=()=>{this.off(Bt.WS_CONNECTED,j),B(new Le(W.WS_ABORT))};this.once(Bt.WS_CONNECTED,j),this.once(Bt.WS_CLOSED,K),t!==Mt.PUBLISH&&t!==Mt.PUBLISH_DATASTREAM&&t!==Mt.SUBSCRIBE&&t!==Mt.SUBSCRIBE_DATASTREAM&&t!==Mt.UNSUBSCRIBE&&t!==Mt.UNSUBSCRIBE_DATASTREAM&&t!==Mt.UNPUBLISH&&t!==Mt.UNPUBLISH_DATASTREAM&&t!==Mt.CONTROL&&t!==Mt.RESTART_ICE||this.once(Bt.DISCONNECT_P2P,()=>{B(new Le(W.DISCONNECT_P2P))}),t!==Mt.PUBLISH&&t!==Mt.RESTART_ICE||this.once(Bt.ABORT_P2P_EXECUTION,()=>{B(new Le(W.DISCONNECT_P2P))})});if(this.connectionState!==Vs.CONNECTING&&this.connectionState!==Vs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await m(),this.websocket.sendMessage(A,!0),i)return;const f=new pt((F,B)=>{let j=!1;const K=(oe,xe)=>{j=!0,F({isSuccess:oe==="success",message:xe||{}}),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.emit(Bt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const X=()=>{B(new Le(W.WS_ABORT,"type: ".concat(t))),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.off("res-@".concat(l),K)};this.once(Bt.WS_CLOSED,X),this.once(Bt.WS_RECONNECTING,X),Yn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Bt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(F){if(this.connectionState===Vs.CLOSED||t===Mt.LEAVE)throw new Le(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?F.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await m(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=vp(w),S=new Le(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message,desc:_.desc});return _.action==="success"?b.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Wt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=S,this.close()),S.throw()):_.action==="failed"?S.throw():_.action==="quit"?(this.initError=S,this.close(),S.throw()):(w===Wt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ii.MULTI_IP)):this.reconnect(_.action,Ii.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new pt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(xp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Vs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){const r={_type:t,_message:s};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,r)=>{this.once(Bt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Bt.WS_CLOSED,i=>r(this.initError||new Le(W.WS_ABORT,i))),this.connectionState=Vs.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ms.LEAVE,this.connectionState=Vs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Cn(this,Bt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Mt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!s)return this.emit(Bt.REPORT_JOIN_GATEWAY,Pw.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Vs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Le(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ip(this,Bt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const s=await this.request(Mt.REJOIN,t);return!!s&&(this.connectionState=Vs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(r=>{this.emit(as.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(as.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(as.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(as.MUTE_AUDIO,{uid:r.uid}):this.emit(as.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(as.MUTE_VIDEO,{uid:r.uid}):this.emit(as.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(as.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(as.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(as.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;const s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Mt.DOWNGRADE_CODEC,s)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=vp(t.code);if(t.code===28&&"detail"in t&&(N.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Bt.RECOVER_NOTIFICATION,t.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?t.code===Wt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Ms.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ms.UID_BANNED),void this.close()):t.code===Wt.K_VOS_FALLBACK&&"detail"in t?(N.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")?void Cn(this,Bt.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",s.desc)}).catch(r=>{N.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),r)}):t.detail==="fallback_hls"&&G("ENABLE_FALLBACK_TO_HLS")?(this.emit(Bt.VOS_FALLBACK,t.detail),void this.close(Ms.FALLBACK_TO_HLS)):this.reconnect(s.action,s.desc)):void this.reconnect(s.action,Ii.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ii.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:s}=this.websocket.getWsInflateData();t!==0&&s!==0&&this.upload(xp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ms.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ms.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ms.CLOSED,()=>{this.connectionState=Vs.CLOSED}),this.websocket.on(ms.FAILED,()=>{this._disconnectedReason=Ms.NETWORK_ERROR,this.connectionState=Vs.CLOSED}),this.websocket.on(ms.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Vs.CONNECTED?this.connectionState=Vs.RECONNECTING:this.connectionState=Vs.CONNECTING}),this.websocket.on(ms.WILL_RECONNECT,(t,s,r)=>{const i=ip(this,Bt.IS_P2P_DISCONNECTED),l=i||t!=="retry";i&&t==="retry"&&(N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",s=Pw.P2P_DISCONNECTED),l&&(N.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Bt.REPORT_JOIN_GATEWAY,s||Pw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Bt.DISCONNECT_P2P)),r(t)}),this.websocket.on(ms.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Ii.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Le){if(t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Wt.ERR_NO_AUTHORIZED)return this.initError=new Le(W.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ms.TOKEN_EXPIRE);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ii.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(ms.REQUEST_NEW_URLS,(t,s)=>{Cn(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(ms.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Pn.PRE_CONNECT_PC,()=>{this.emit(Bt.PRE_CONNECT_PC)}),this.websocket.on(ms.ON_FALLBACK,()=>{G("ENABLE_FALLBACK_TO_HLS")&&this.emit(Bt.VOS_FALLBACK,"fallback_hls")})}}let Pee=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),bn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function qU(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Mw(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?qU(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qU(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let RN=0;function tl(e){const t=G("TURN_DOMAINS");RN=(RN+1)%t.length;const s=t[RN]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(s):(N.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function Vw(e){try{const t=G("TURN_DOMAINS"),s=G("GATEWAY_DOMAINS").concat(t).find(r=>et(e).call(e,r));return s?e.split(".".concat(s))[0].replace(/-/g,"."):e}catch{return N.debug("serverUrlToIp error, fallback to url",e),e}}function IN(e,t){e.addresses||(e.addresses=[]);const s=function(u,m){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(w=>{let{ip:_,port:S}=w;return{address:"".concat(_,":").concat(S)}});const f=G("GATEWAY_DOMAINS");let b=f[1]&&et(m).call(m,f[1])?1:0;return u.map(w=>{let{domain_prefix:_,port:S,ip:F}=w;if(_)return{address:"".concat(_,".").concat(f[b++%f.length],":").concat(S)};const B=/^[\.\:\d]+$/.test(F),j=B?"".concat(F.replace(/[^\d]/g,"-"),".").concat(f[b++%f.length],":").concat(S):"".concat(F,":").concat(S);return B||N.debug("Cannot recognized as ip address: ".concat(F,", use as host3")),{ip:F,port:S,address:j}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const u=r.split(";");for(let m=0;m<u.length;m++){var i;const f=ma(i=u[m]).call(i);s[m]&&f&&(s[m].ip6=f)}}const l=e.detail&&e.detail.candidate;let A;if(l){const[u,m]=l.split(":");u&&m&&(A={port:Number(m),ip:u,address:"".concat(u,":").concat(m)})}return{gatewayAddrs:s,apGatewayAddress:A,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Pa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function YU(e){const t=e._encoderConfig;if(!t)return{};const s={resolution:t.width&&t.height?"".concat(Pa(t.width),"x").concat(Pa(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(s.maxFrameRate=t.frameRate,s.minFrameRate=t.frameRate):t.frameRate&&(s.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,s.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),s}function Qw(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Y0(e,t){let s,r,i;switch(t){case bn.CHOOSE_SERVER:r=4096,i="choose server";break;case bn.CLOUD_PROXY:r=1048576,i="proxy";break;case bn.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case bn.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new Le(W.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===r&&(s={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(A=>Mw(Mw({},A),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:Mw(Mw({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!s)throw new Le(W.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function XU(e,t){return await pt.all(e.addresses.map(async s=>({address:tl(s.ip),tcpport:s.port,udpport:s.port,username:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Oi.username,password:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await N1(t.toString()):Oi.password})))}function ON(e,t){const s=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||s.height,i=t.videoWidth||s.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Pa(e.height),Pa(e.width)),1):(N.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ku(e){let{candidateType:t,relayProtocol:s,type:r,address:i,port:l,protocol:A}=e;const u={candidateType:t,relayProtocol:s,protocol:A};if(r!=="local-candidate"){const m=i.split(".");m.length>=4&&(m[1]="*",m[2]="*"),u.address=m.join("."),u.port=l}return u}function Od(e){const t=e.split(":"),s=e.split(/[-.]/),r=et(e).call(e,"-")?"-":".";let i=e;return t.length>1?s.length>1?(s[1]="**",i=s[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:s.length>1&&(i=s[0]+r+"**"),i}function JU(e,t){return e.getTransceivers().find(s=>s.sender.track===t||s.receiver.track===t)}function X0(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(t){return t in uw}(e)?e:uw.L1T3}const $U={[Nt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Nt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function ZU(e){e.send&&(Df(Nt.VIDEO,e.send.videoExtensions),Df(Nt.AUDIO,e.send.audioExtensions)),e.recv&&(Df(Nt.VIDEO,e.recv.videoExtensions),Df(Nt.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(Df(Nt.VIDEO,e.sendrecv.videoExtensions),Df(Nt.AUDIO,e.sendrecv.audioExtensions))}function e4(e,t){e.send&&(Hw(Nt.VIDEO,e.send.videoExtensions,t.send.videoExtensions),Hw(Nt.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(Hw(Nt.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),Hw(Nt.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function Hw(e,t,s){t.forEach(r=>{var i;const l=$U[e].find(u=>{var m;let{key:f}=u;return et(m=r.extensionName).call(m,f)});if(!l)return;const A=s.find(u=>{let{extensionName:m}=u;return et(m).call(m,l.key)});A&&et(i=A.extensionName).call(i,"gdpr_forbidden")&&(r.extensionName=A.extensionName)})}function Df(e,t){t.forEach(s=>{var r;const i=$U[e].find(l=>{var A;let{key:u}=l;return et(A=s.extensionName).call(A,u)});et(r=s.extensionName).call(r,"gdpr_forbidden")&&i&&(s.extensionName=i.extensionName)})}function t4(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||et(e).call(e,"abs-send-time")}function Gw(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||et(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function s4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function r4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?s4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):s4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function J0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:l,filterAudioFec:A,filterAudioCodec:u,filterVideoCodec:m,unsupportedVideoUplinkCodec:f,unsupportedVideoDownlinkCodec:b}=t,{useXR:w}=s;let _=[],S=[],F=[],B=[],j=!1,K=!1;if(ba(e).mediaDescriptions.forEach(oe=>{r&&r!==oe.attributes.direction||(oe.media.mediaType!=="video"||j||(S=oe.attributes.payloads,B=oe.attributes.extmaps,j=!0),oe.media.mediaType!=="audio"||K||(_=oe.attributes.payloads,F=oe.attributes.extmaps,K=!0))}),!B||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!F||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach(oe=>{var xe;(xe=oe.rtpMap)!==null&&xe!==void 0&&xe.clockRate&&(oe.rtpMap.clockRate=parseInt(oe.rtpMap.clockRate)),w&&oe.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(oe=>{var xe;(xe=oe.rtpMap)!==null&&xe!==void 0&&xe.clockRate&&(oe.rtpMap.clockRate=parseInt(oe.rtpMap.clockRate)),w&&oe.rtcpFeedbacks.push({type:"rrtr"})}),i&&(_=_.filter(oe=>{var xe;return((xe=oe.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())!=="rtx"}),S=S.filter(oe=>{var xe;return((xe=oe.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())!=="rtx"})),l){const oe=S.filter(me=>{var Re;return/(red)|(ulpfec)|(flexfec)/i.test(((Re=me.rtpMap)===null||Re===void 0?void 0:Re.encodingName)||"")}),xe=Du(oe,S).map(me=>me.payloadType),Ee=[...oe.map(me=>me.payloadType),...xe];S=S.filter(me=>!et(Ee).call(Ee,me.payloadType))}if(A&&(_=_.filter(oe=>{var xe;return!/(red)|(ulpfec)|(flexfec)/i.test(((xe=oe.rtpMap)===null||xe===void 0?void 0:xe.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(_=_.filter(oe=>{var xe;return et(u).call(u,((xe=oe.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const oe=S.filter(xe=>{var Ee;return et(m).call(m,((Ee=xe.rtpMap)===null||Ee===void 0?void 0:Ee.encodingName.toLowerCase())||"")});S=oe.concat(i?[]:Du(oe,S))}const X=G("UNSUPPORTED_VIDEO_CODEC");if(X&&X.length>0){const oe=S.filter(me=>me.rtpMap&&et(X).call(X,me.rtpMap.encodingName.toLowerCase())),xe=Du(oe,S),Ee=oe.concat(xe).map(me=>me.payloadType);S=S.filter(me=>!et(Ee).call(Ee,me.payloadType)),N.debug("unsupportedVideoCodec: ".concat(X,", toBeRemoved: ").concat(Ee))}if(f&&f.length>0&&r==="sendonly"){const oe=S.filter(me=>me.rtpMap&&et(f).call(f,me.rtpMap.encodingName.toLowerCase())),xe=Du(oe,S),Ee=oe.concat(xe).map(me=>me.payloadType);S=S.filter(me=>!et(Ee).call(Ee,me.payloadType)),N.debug("unsupportedVideoUplinkCodec: ".concat(f,", toBeRemoved: ").concat(Ee))}if(b&&b.length>0&&r==="recvonly"){const oe=S.filter(me=>me.rtpMap&&et(b).call(b,me.rtpMap.encodingName.toLowerCase())),xe=Du(oe,S),Ee=oe.concat(xe).map(me=>me.payloadType);S=S.filter(me=>!et(Ee).call(Ee,me.payloadType)),N.debug("unsupportedVideoDownlinkCodec: ".concat(b,", toBeRemoved: ").concat(Ee))}return{audioCodecs:_,videoCodecs:S,audioExtensions:F,videoExtensions:B}}function kd(e){const t=ba(e);let s,r;for(const i of t.mediaDescriptions){if(!s){const l=i.attributes.iceUfrag,A=i.attributes.icePwd;if(!l||!A)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:l,icePwd:A}}if(!r){const l=i.attributes.fingerprints;l.length>0&&(r={fingerprints:l})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:r}}function kN(e,t){const s=[],r=e.attributes.ssrcGroups.filter(A=>A.semantic==="FID"),i=e.attributes.ssrcGroups.find(A=>A.semantic==="SIM"),l=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(A=>{var u;const m=(u=r.find(f=>f.ssrcIds[0]===A))===null||u===void 0?void 0:u.ssrcIds[1];s.push({ssrcId:A,rtx:t?m:void 0})});else if(r.length>0){const A=r[0].ssrcIds[0],u=r[0].ssrcIds[1];s.push({ssrcId:A,rtx:t?u:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:l[0].ssrcId})}return s}function n4(e,t,s){const{cname:r}=e;let i=[];t&&(i=i4(t)),i.length===0&&(i=e.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),N.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},A={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}const m=Z0(e.rtpCapabilities),f=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{f.push({kind:Nt.VIDEO,ssrcMsg:[{ssrcId:b.v,rtx:b.v_rtx}],mslabel:"".concat(b.v,"_").concat(b.a)},{kind:Nt.AUDIO,ssrcMsg:[{ssrcId:b.a}],mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:l,iceParameters:A,candidates:i,rtpCapabilities:m,setup:u,cname:r,preSSRCs:f}}function i4(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],N.debug("Using remote candidate from AP ".concat(Od(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),N.debug("Using IPV6 remote candidate from AP ".concat(Od(e.ip6),":").concat(e.port)))),t}function $0(e,t,s){const r=[],i=[];return e.forEach(l=>{let{ssrcId:A,rtx:u}=l;const m=dr(8,"track-"),f={ssrcId:A,attributes:r4({label:m,mslabel:s=s||dr(10,""),msid:"".concat(s," ").concat(m)},t&&{cname:t})};if(r.push(f),u!==void 0){const b={ssrcId:u,attributes:r4({label:m,mslabel:s,msid:"".concat(s," ").concat(m)},t&&{cname:t})};r.push(b),i.push({semantic:"FID",ssrcIds:[A,u]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:A}=l;return A})}),{ssrcs:r,ssrcGroups:i}}function wp(e,t){t instanceof nn&&e.attributes.payloads.forEach(s=>{var r;const i=(r=s.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),i==="opus"&&typeof G("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=G("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(l.bitrate&&!kr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),t instanceof W0&&i==="opus"&&t._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function DN(e){const t=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function BN(e,t){var s;if(e.attributes.payloads.forEach(i=>{var l;((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="h264"&&i.fmtp&&i.fmtp.parameters&&G("ENABLE_UP_SPS_PPS")&&(i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof Er&&t._encoderConfig&&t._hints.indexOf(or.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;Ls().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(i=>{var l,A;et(l=["h264","h265","vp8","vp9","av1"]).call(l,((A=i.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ls().supportMinBitrate&&!et(s=t._hints).call(s,or.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(i=>{var l,A;et(l=["h264","h265","vp8","vp9","av1"]).call(l,((A=i.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function a4(e){if(e.media.mediaType!=="video")return;const t=$s();if(t.name!==er.SAFARI&&t.os!==qn.IOS)return;const s=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function Kw(e,t,s){if(!t)return;let r,i;if(e.media.mediaType==="video"?(r=s.videoExtensions,i=s.videoCodecs):(r=s.audioExtensions,i=s.audioCodecs),t.twcc===!0){const l=r.find(A=>Gw(A.extensionName));if(l){const A=l.extensionName;e.attributes.extmaps.find(m=>Gw(m.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:A}),function(m,f){return f.filter(b=>!!m.find(w=>w.payloadType===b.payloadType&&!!w.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(i,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(f=>f.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(A=>Gw(A.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(A=>{const u=A.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");u!==-1&&A.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const l=r.find(A=>t4(A.extensionName));if(l){const A=l.extensionName;e.attributes.extmaps.find(m=>m.extensionName===A)||e.attributes.extmaps.push({entry:l.entry,extensionName:A}),function(m,f){return f.filter(b=>!!m.find(w=>w.payloadType===b.payloadType&&!!w.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(i,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(f=>f.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(A=>t4(A.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(A=>{const u=A.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");u!==-1&&A.rtcpFeedbacks.splice(u,1)})}}function LN(e,t,s){if(kr()||e.media.mediaType!=="video"||!(t instanceof Er)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!G("SIMULCAST")||s==="vp9"&&G("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=s==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===i.ssrcId),A={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let u=1;u<r;u++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+u,attributes:Dr(i.attributes)}),A.ssrcIds.push(i.ssrcId+u),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+u,attributes:Dr(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+u,l.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(A)}async function o4(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:uw.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const s=ba(t.sdp).mediaDescriptions[0];if(!s)return;const r=s.attributes.extmaps.find(i=>i.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),r}catch{return}}async function jN(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const r=(await s.createOffer()).sdp,{send:i,recv:l,sendrecv:A}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;const b=J0(f,u,m,"sendonly"),w=J0(f,u,m,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(sl(b,w,"videoExtensions",_,S,F),sl(b,w,"videoCodecs",_,S,F),sl(b,w,"audioExtensions",_,S,F),sl(b,w,"audioCodecs",_,S,F),G("RAISE_H264_BASELINE_PRIORITY")){const B=[],j=[];if(F.videoCodecs.forEach((K,X)=>{var oe;if(((oe=K.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"){var xe,Ee;const me=F.videoCodecs[X+1],Re=me&&A4(K,me),He=(xe=K.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"],Xe=(Ee=K.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!He||He!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Xe!==G("FIRST_PACKETIZATION_MODE")?Re?j.push([K,me]):j.push([K]):Re?B.push([K,me]):B.push([K])}}),B.length>0&&j.length>0){N.debug("raising H264 baseline profile priority"),F.videoCodecs.forEach((X,oe)=>{var xe;if(((xe=X.rtpMap)===null||xe===void 0?void 0:xe.encodingName.toLocaleLowerCase())==="h264"){const Ee=A4(X,F.videoCodecs[oe+1]),me=B.shift()||j.shift()||[];me.length>0&&(Ee?F.videoCodecs.splice(oe,2,...me):F.videoCodecs.splice(oe,1,...me))}});const K=S.videoCodecs.filter(X=>{var oe,xe;return((oe=X.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"&&((xe=X.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID")});if(K.length>0){const X=Du(K,S.videoCodecs).map(xe=>xe.payloadType),oe=[...K.map(xe=>xe.payloadType),...X];S.videoCodecs=S.videoCodecs.filter(xe=>!et(oe).call(oe,xe.payloadType))}G("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(X=>{var oe,xe;return!(((oe=X.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"&&((xe=X.fmtp)===null||xe===void 0?void 0:xe.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:_,recv:S,sendrecv:F}}return{send:_,recv:S,sendrecv:F}}(e,t,r);try{s.close()}catch{}return{send:i,recv:l,sendrecv:A}}function c4(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=J0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(sl(e,t,"videoExtensions",s,r,i),sl(e,t,"videoCodecs",s,r,i),sl(e,t,"audioExtensions",s,r,i),sl(e,t,"audioCodecs",s,r,i),G("RAISE_H264_BASELINE_PRIORITY")){const l=i.videoCodecs.findIndex(A=>A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A.fmtp&&A.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const A=i.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(A<l){N.debug("raising H264 baseline profile priority");const u=i.videoCodecs[l];i.videoCodecs.splice(l,1),i.videoCodecs.splice(A,0,u)}A!==-1&&(r.videoCodecs=r.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:r,sendrecv:i}}function sl(e,t,s,r,i,l){if(s==="videoExtensions"||s==="audioExtensions"){const A=[];return e[s].forEach(u=>{t[s].some((m,f)=>{if(u.entry===m.entry&&u.extensionName===m.extensionName)return A.push(f),!0})?l[s].push(u):r[s].push(u)}),void t[s].forEach((u,m)=>{A.indexOf(m)===-1&&i[s].push(u)})}if(s==="videoCodecs"||s==="audioCodecs"){const A=[];return e[s].forEach(u=>{t[s].some((m,f)=>{if(u.payloadType===m.payloadType&&JSON.stringify(u)===JSON.stringify(m))return A.push(f),!0})?l[s].push(u):r[s].push(u)}),void t[s].forEach((u,m)=>{A.indexOf(m)===-1&&i[s].push(u)})}}function Z0(e){const{send:t,recv:s,sendrecv:r}=e;if(!r){if(!t||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:s}}let i,l;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=Dr(r),s?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...s.audioCodecs,...r.audioCodecs],l.videoCodecs=[...s.videoCodecs,...r.videoCodecs],l.audioExtensions=[...s.audioExtensions,...r.audioExtensions],l.videoExtensions=[...s.videoExtensions,...r.videoExtensions]):l=Dr(r),{send:i,recv:l}}function Bf(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var s;return((s=t.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function eb(e,t,s,r){let i=[];if(e===Nt.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=t.videoCodecs.filter(l=>{var A;return et(A=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(A,r)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let l=[];const A=[],u=[],m=[];if(s.videoCodecs.forEach(f=>{const b=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";et(b).call(b,r)?l.push(f):et(b).call(b,"vp9")?A.push(f):et(b).call(b,"vp8")?u.push(f):et(b).call(b,"h264")&&m.push(f)}),l.length===0){let f="";A.length!==0?(l=A,f="vp9"):u.length!==0?(l=u,f="vp8"):m.length!==0&&(l=m,f="h264"),N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}l.length!==0&&(i=t.videoCodecs.filter(f=>l.some(b=>b.payloadType===f.payloadType)))}if(i.length===0&&(N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const l=Du(i,t.videoCodecs);i=[...i,...l]}}else{i=t.audioCodecs.filter(A=>{var u;return et(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,r)});const l=t.audioCodecs.filter(A=>{var u;return et(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,"red")});i.length===0&&(N.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(A=>{var u;return et(u=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")})),G("ENABLE_AUDIO_RED")&&l.length!==0&&(i=[...l,...i])}return i}function Du(e,t){const s=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&et(s).call(s,r.fmtp&&r.fmtp.parameters.apt))}async function $a(e,t,s){const r=t.toString(),i=l4(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let A=l.sdp;A=PN(A,s||{}),i==null||i(A||""),await e.setLocalDescription({type:"answer",sdp:A})}function PN(e,t,s){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;const r=ba(e),{useXR:i}=t;return r.mediaDescriptions.forEach(l=>{var A;l.attributes.mid&&(Array.isArray(s)&&!et(s).call(s,l.attributes.mid)||(l.media.mediaType==="audio"&&Bf(l),l.media.mediaType==="video"&&function(u){u.media.mediaType==="video"&&G("ENABLE_DOWN_SPS_PPS")&&u.attributes.payloads.filter(m=>{var f;return((f=m.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())==="h264"}).forEach(m=>{m.fmtp||(m.fmtp={parameters:{}}),m.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(l),i&&et(A=["audio","video"]).call(A,l.media.mediaType)&&l.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),SA(r)}function l4(e,t,s,r){if(G("SDP_LOGGING"))return N.upload("exchanging ".concat(s," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?i=>{l4(i,"answer",s==="local"?"remote":"local",r)}:void 0}async function d4(e,t,s){try{var r;if(!Ls().supportSetRtpSenderParameters||!function(m){return m==="vp9"||m==="av1"}(e)||!G("ENABLE_SVC"))return;const i={},l={},A=t.getParameters(),u=(r=A.encodings)===null||r===void 0?void 0:r[0];l.scalabilityMode=X0(s),u&&Object.assign(u,l),Object.assign(A,i),await t.setParameters(A),N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(A.encodings)))}catch(i){N.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",i)}}function Ww(e){const t=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(s=>et(e).call(e,s))}function A4(e,t){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===t.payloadType.toString()}catch{return!1}}function u4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function So(e,t){return typeof G(e)===t?G(e):void 0}function Uee(){try{const e=G("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?u4(Object(r),!0).forEach(function(i){U(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u4(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}({},e)}catch(e){return N.debug("handle gateway attributes failed: ",e),{}}}const h4={};function Dd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&N.debug("install service ".concat(e.name)),h4[e.name]=e}function Vl(e){const t=h4[e];if(!t)throw new Fe(W.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function p4(e,t){return Vl("DataStream").create(e,t)}function zw(){return Vl("InterceptFrame").create()}function m4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function li(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?m4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const UN=new Map;class Fee extends Vr{get state(){return this._state}set state(t){if(t===this._state)return;const s=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(dn.CONNECTION_STATE_CHANGE,t,s,this._disconnectedReason):this.emit(dn.CONNECTION_STATE_CHANGE,t,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){N.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,s){var r,i,l;super(),U(this,"store",void 0),U(this,"joinInfo",void 0),U(this,"key",void 0),U(this,"ntpOffset",0),U(this,"usingProxy",!1),U(this,"signal",void 0),U(this,"role",void 0),U(this,"isPreallocation",void 0),U(this,"isPreSub",void 0),U(this,"inChannelInfo",{joinAt:null,duration:0}),U(this,"spec",void 0),U(this,"_state","DISCONNECTED"),U(this,"_statsCollector",void 0),U(this,"_disconnectedReason",void 0),U(this,"isSignalRecover",!1),U(this,"hasChangeBGPAddress",!1),U(this,"trafficStatsInterval",void 0),U(this,"networkQualityInterval",void 0),U(this,"_joinGatewayStartTime",0),U(this,"_signalTimeout",!1),U(this,"_clientRoleOptions",void 0),U(this,"_isProactiveJoin",!1),this.store=t,this.spec=s,this.signal=this.store.useP2P?(r={spec:li(li({},s),{},{retryConfig:s.websocketRetryConfig}),store:t},(i=(l=Vl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(l,r)):this.store.useDcSignal?function(A){return Vl("DataChannelSignal").create(A)}({spec:li(li({},s),{},{retryConfig:s.websocketRetryConfig}),store:t}):new zU(li(li({},s),{},{retryConfig:s.websocketRetryConfig}),t),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,s,r){if(this.store.useDcSignal){let b=!1;t.cloudProxyServer!=="disabled"?(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),b=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),b=!0):t.apResponse.addresses.some(w=>w.fingerprint)||G("FINGERPRINT")||(N.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),b=!0),b&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let l=UN.get(t.cname);if(l||(l=new Map,UN.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const b=new Le(W.UID_CONFLICT);throw Ot.joinGateway(t.sid,{lts:i,succ:!1,ec:b.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),b}l.set(t.uid,!0),this.joinInfo=t,this.key=s;let A=0;this.joinGatewayStartTime=i;const u=t.proxyServer,m=this.store.useDcSignal?"datachannel":"websocket";try{N.debug("[".concat(this.store.clientId,"] use ").concat(m," join uid ").concat(A));const b=t.gatewayAddrs.map(_=>{let{address:S}=_;const[F,B]=S.split(":"),j={host:F,port:B};return t.proxyServer&&(j.proxy=t.proxyServer),j});let w;w=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(b),A=w.uid,N.debug("[".concat(this.store.clientId,"] ").concat(m," join uid ").concat(A," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(b){var f;throw b.code===W.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||Ot.joinGateway(t.sid,{lts:i,succ:!1,ec:((f=b.data)===null||f===void 0?void 0:f.desc)||b.code,errorMsg:b.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!u||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),b&&b.code===W.INIT_DATACHANNEL_TIMEOUT?(N.warning("[".concat(this.store.clientId,"] User join datachannel failed"),b.toString()),this.resetSignal(),b):(N.error("[".concat(this.store.clientId,"] User join failed"),b.toString()),l.delete(t.uid),this.signal.close(),b)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(b=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),b.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(dn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(dn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(dn.NETWORK_QUALITY,{uplinkNetworkQuality:Qw(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Qw(this._statsCollector.trafficStats.B_dnq)}):this.emit(dn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),A}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Ms.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Vs.CONNECTED||await function(r,i){return i===1/0?r:pt.race([r,uZ(i)])}(this.signal.request(Mt.LEAVE,void 0,!0),3e3)}catch(r){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(s),s!==Ms.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Mt.PUBLISH,i,!0))._message}catch(l){if(r&&l.data&&l.data.code===Wt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,s),this.publish(t,s,!1);throw l}}async publishDataChannel(t,s,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(i=s.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Mt.PUBLISH_DATASTREAM,l,!0)}catch(A){if(r&&A.data&&A.data.code===Wt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),A.toString()),await this.tryUnpubDataChannelBeforeRepub(t,s),this.publishDataChannel(t,s,!1);throw A}}async unpublish(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Mt.UNPUBLISH,{stream_id:s,ortc:t},!0)}catch(r){N.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(t.map(s=>this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){N.warning("unpublish datachannels warning: ",s)}}async presubscribe(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Mt.PRE_SUBSCRIBE,i,!0)}catch(l){if(r&&l.data&&l.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,s,!1);throw l}}async subscribe(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Mt.SUBSCRIBE,i,!0))._message}catch(l){if(r&&l.data&&l.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,s),await this.subscribe(t,s,!1);throw l}}async subscribeDataChannel(t,s,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Mt.SUBSCRIBE_DATASTREAM,i,!0)}catch(l){if(r&&l.data&&l.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,s),await this.subscribeDataChannel(t,s,!1);throw l}}async subscribeAll(t,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Mt.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(s&&i.data&&i.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){const s=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,l=r.width,A=r.height,u=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(u=!1)),typeof A!="number"&&(A=A.exact||A.ideal||A.max||A.min||0,i||(u=!1)),u?{stream_type:0,width:l,height:A,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(s)return this.signal.request(Mt.SET_VIDEO_PROFILE,s);N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:s},!0)}catch(r){N.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(t.map(r=>this.signal.request(Mt.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:s},!0)))}catch(r){N.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,t,!0)}catch(s){N.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(t){const{iceParameters:s,dtlsParameters:r,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(Mt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Mt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Mt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,s){s&&(this._clientRoleOptions=Object.assign({},s)),G("CLIENT_ROLE_OPTIONS")&&(N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),N.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;const l=Object.assign({},s);delete l.delay,delete l.level,await this.signal.request(Mt.SET_CLIENT_ROLE,li(li({role:t,level:i,delay:r},l),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,s,r){await this.signal.request(Mt.SET_DUAL_STREAM_MODE,{mode:t},r,s)}async setRemoteVideoStreamType(t,s){await this.signal.request(Mt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:s})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Mt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,s){await this.signal.request(Mt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:s})}async pickSVCLayer(t,s){await this.signal.request(Mt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Mt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,s,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,s,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),li({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(Mt.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(Mt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=UN.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(s){let r;return r=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Oi.username,password:Oi.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(li(li({},Oi),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Mt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(s=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===s.peer_uid);r&&r.B_st!==s.B_st&&cw(()=>{this.emit(dn.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var s,r,i,l;if(!this.joinInfo||!this.key)throw new Le(W.UNEXPECTED_ERROR,"can not generate join message, no join info");const A=Object.assign({},this.joinInfo.apResponse);let u=G("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}var m;u&&u.length>128&&(u=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(dn.UPDATE_GATEWAY_CONFIG),m=this.store.clientId,et(Tf).call(Tf,m)||Tf.push(m);const f=G0(this.store),b=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),w=mj(this.store),_=Uee(),S=Ll(87)||wL()||w1(117),F=(function(){const X=$s();if(X.name!==er.SAFARI||!X.browserVersion)return!1;const oe=X.browserVersion.split(".");return Number(oe[0])>18||Number(oe[0])===18&&Number(oe[1])>=4}()||CL(18,4,!1))&&_1(18,6,!0)&&this.spec.codec==="h264"&&G("ENABLE_ABSSENDTIME_AS_SENTTS"),B=!(((r=A.detail)===null||r===void 0?void 0:r[3])!=="CN"||!G("ENABLE_QUALITY_FALLBACK"))&&G("ENABLE_QUALITY_FALLBACK"),j=!!G("ENABLE_AP_MULTI_IP")&&((i=A.detail)===null||i===void 0?void 0:i[5])==="multi-ip",K=li({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:fc,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:A,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:li(li({enableEncodedTransform:(!!G("ENABLE_AUDIO_METADATA")||!!G("ENABLE_AUDIO_PTS"))&&S||!!G("ENABLE_AUDIO_TOPN")&&v1(er.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&S,enableAudioPts:!!G("ENABLE_AUDIO_PTS")&&S,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:So("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:So("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:So("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:w,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:So("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("FORCE_ENABLE_AUT_CC")||!gw()&&(!!G("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:So("USE_XR","boolean"),enableLossbasedBwe:So("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("FORCE_ENABLE_AUT_CC")||!gw()&&(!!G("ENABLE_AUT_CC")||void 0),enableCCFallback:So("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:b,preSubNum:f?So("PRE_SUB_NUM","number"):void 0,enablePubTWCC:So("PUBLISH_TWCC","boolean"),enableSubTWCC:So("SUBSCRIBE_TWCC","boolean"),enablePubRTX:So("USE_PUB_RTX","boolean"),enableSubRTX:So("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0,enableVosFallback:G("ENABLE_VOS_FALLBACK"),enableQualityFallback:B},_),{},{audioDuplicate:So("ENABLE_AUDIO_RED","boolean")?(l=So("AUDIO_DUPLICATE_NUM","number"))!==null&&l!==void 0?l:2:void 0,senttsUsesAbsSendTime:!!F||void 0,enableDualStreamFlag:So("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(K.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(K.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(K.aes_secret=this.joinInfo.aespassword,K.aes_encrypt=!0):K.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(K.aes_salt=this.joinInfo.aessalt)),A.addresses[this.signal.websocket.currentURLIndex]&&(K.ap_response.ticket=A.addresses[this.signal.websocket.currentURLIndex].ticket,delete A.addresses),this.joinInfo.defaultVideoStream!==void 0&&(K.default_video_stream=this.joinInfo.defaultVideoStream),K}getRejoinMessage(){if(!this.joinInfo)throw new Le(W.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Bt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Bt.WS_RECONNECTING,t=>{this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Ii.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ot.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Bt.WS_CLOSED,t=>{let s;switch(t){case Ms.LEAVE:s=Ii.LEAVE;break;case Ms.UID_BANNED:case Ms.IP_BANNED:case Ms.CHANNEL_BANNED:case Ms.SERVER_ERROR:s=Ii.SERVER_ERROR;break;case Ms.FALLBACK:s=Ii.FALLBACK;break;case Ms.LICENSE_MISSING:case Ms.LICENSE_EXPIRED:case Ms.LICENSE_MINUTES_EXCEEDED:case Ms.LICENSE_PERIOD_INVALID:case Ms.LICENSE_MULTIPLE_SDK_SERVICE:case Ms.LICENSE_ILLEGAL:case Ms.TOKEN_EXPIRE:s=t;break;default:s=Ii.NETWORK_ERROR}N.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ii.NETWORK_ERROR)),this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ms.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=t,t!==Ms.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Bt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(N.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void N.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));xr("EVENT_REPORT_DOMAIN",t[1]),xr("EVENT_REPORT_BACKUP_DOMAIN",t[1]),xr("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(as.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Bt.REQUEST_RECOVER,(t,s,r)=>{if(!this.joinInfo)return r(new Le(W.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Cn(this,dn.REQUEST_NEW_GATEWAY_LIST).then(s).catch(r)}),this.signal.on(Bt.REQUEST_JOIN_INFO,async(t,s,r)=>{var i,l,A;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const u=Dr((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(G("NEW_TURN_MODE")&&u&&((l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer)==="disabled"){var m;let _=u.servers.map(B=>"turnServerURL"in B&&G("USE_TURN_IP")?li(li({},B),{},{turnServerURL:Vw(B.turnServerURL)}):B),S=(m=u.serversFromGateway)===null||m===void 0?void 0:m.map(B=>G("USE_TURN_IP")?li(li({},B),{},{turnServerURL:Vw(B.turnServerURL)}):B);const F=this.signal.currentURLIndex;_.length>0&&(_=[_[F%_.length]],u.servers=_),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(F))}const{iceParameters:f,dtlsParameters:b,rtpCapabilities:w}=await Cn(this,dn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u,cloudProxyServer:(A=this.joinInfo)===null||A===void 0?void 0:A.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:b,rtpCapabilities:w,version:"2"}}))}catch(_){s(_)}}),this.signal.on(Bt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Bt.REPORT_JOIN_GATEWAY,(t,s)=>{if(!this.joinInfo)return;let r,i="";var l;t instanceof Le?(r=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,i=t.message):r=t,Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Bt.IS_P2P_DISCONNECTED,t=>{t(ip(this,dn.IS_P2P_DISCONNECTED))}),this.signal.on(Bt.DISCONNECT_P2P,()=>{this.emit(dn.DISCONNECT_P2P)}),this.signal.on(Bt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Bt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Bt.JOIN_RESPONSE,t=>{const s=this.getCurrentGatewayAddress();this.emit(dn.JOIN_RESPONSE,t,s)}),this.signal.on(Bt.PRE_CONNECT_PC,async(t,s)=>{if(this.joinInfo){var r,i;this.updateTurnConfigFromSignal();const A=this.getCurrentGatewayAddress(),u=Dr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(G("NEW_TURN_MODE")&&u&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var l;let f=u.servers.map(_=>"turnServerURL"in _&&G("USE_TURN_IP")?li(li({},_),{},{turnServerURL:Vw(_.turnServerURL)}):_),b=(l=u.serversFromGateway)===null||l===void 0?void 0:l.map(_=>G("USE_TURN_IP")?li(li({},_),{},{turnServerURL:Vw(_.turnServerURL)}):_);const w=this.signal.currentURLIndex;f.length>0&&(f=[f[w%f.length]],u.servers=f),Array.isArray(b)&&b.length>0&&(b=[b[0]],u.serversFromGateway=b),N.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w,",in pre pc"))}const m=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(A&&m){const f=i4(A);Cn(this,dn.PRE_CONNECT_PC,{candidates:f,fingerprint:m,turnServer:u}).then(b=>{t==null||t(b)}).catch(s||(()=>{}))}}}),this.signal.on(Bt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(Bt.VOS_FALLBACK,t=>{this.emit(dn.VOS_FALLBACK,t)}),this.signal.on(Bt.DATACHANNEL_FAILBACK,t=>{N.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(dn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[s]},!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,s){try{await this.signal.request(Mt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(r){throw N.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,s){try{await this.signal.request(Mt.UNPUBLISH,{stream_id:t,ortc:s},!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,s){try{await this.signal.request(Mt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(r){throw N.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const s={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Mt.UNSUBSCRIBE_STREAMS,s,!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,s){const r={action:t.find(i=>i.stream_type===ur.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,s){const r={action:t.find(i=>i.stream_type===ur.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,s){const r={action:t===Nt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,s){const r={action:t===Nt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Mt.CONTROL,r,!0,!0)}catch(i){throw N.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,s){this.signal.upload(t,s)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Mt.RESTART_ICE,s,!0)}catch(r){throw N.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,s){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,s||Ii.P2P_FAILED)}getCurrentGatewayAddress(){var t,s;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(N.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Mt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ms.FALLBACK)),this.store.useDcSignal=!1,this.signal=new zU(li(li({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(dn.RESET_SIGNAL)}}let qw=0,FN=0;function Ql(e,t,s,r){return new pt((i,l)=>{t.timeout=t.timeout||G("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!s?(t.data=JSON.stringify(t.data),qw+=Nd(t.data)):s&&(t.data.size?qw+=t.data.size:t.data instanceof FormData?qw+=KL(t.data):qw+=Nd(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Da.request(t).then(A=>{typeof A.data=="string"?FN+=Nd(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?FN+=A.data.byteLength:FN+=Nd(JSON.stringify(A.data)),r&&i({data:A.data,headers:A.headers}),i(A.data)}).catch(A=>{Da.isCancel(A)?l(new Le(W.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?l(new Le(W.NETWORK_TIMEOUT,A.message)):A.response?l(new Le(W.NETWORK_RESPONSE_ERROR,A.response.status)):l(new Le(W.NETWORK_ERROR,A.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(We){var ct=0;return function(){return ct<We.length?{done:!1,value:We[ct++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(We,ct,Rt){return We==Array.prototype||We==Object.prototype||(We[ct]=Rt.value),We},r,i=function(We){We=[typeof globalThis=="object"&&globalThis,We,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var ct=0;ct<We.length;++ct){var Rt=We[ct];if(Rt&&Rt.Math==Math)return Rt}throw Error("Cannot find global object")}(this);function l(We,ct){if(ct)e:{var Rt=i;We=We.split(".");for(var Ye=0;Ye<We.length-1;Ye++){var D=We[Ye];if(!(D in Rt))break e;Rt=Rt[D]}(ct=ct(Ye=Rt[We=We[We.length-1]]))!=Ye&&ct!=null&&s(Rt,We,{configurable:!0,writable:!0,value:ct})}}function A(We){return(We={next:We})[Symbol.iterator]=function(){return this},We}function u(We){var ct=typeof Symbol<"u"&&Symbol.iterator&&We[Symbol.iterator];return ct?ct.call(We):{next:t(We)}}if(l("Symbol",function(We){function ct(D,ae){this.A=D,s(this,"description",{configurable:!0,writable:!0,value:ae})}if(We)return We;ct.prototype.toString=function(){return this.A};var Rt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ye=0;return function D(ae){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new ct(Rt+(ae||"")+"_"+Ye++,ae)}}),l("Symbol.iterator",function(We){if(We)return We;We=Symbol("Symbol.iterator");for(var ct="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Rt=0;Rt<ct.length;Rt++){var Ye=i[ct[Rt]];typeof Ye=="function"&&typeof Ye.prototype[We]!="function"&&s(Ye.prototype,We,{configurable:!0,writable:!0,value:function(){return A(t(this))}})}return We}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var m;e:{var f={};try{f.__proto__={a:!0},m=f.a;break e}catch{}m=!1}r=m?function(We,ct){if(We.__proto__=ct,We.__proto__!==ct)throw new TypeError(We+" is not extensible");return We}:null}var b=r;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(We){if(We.m)throw new TypeError("Generator is already running");We.m=!0}function S(We,ct){return We.h=3,{value:ct}}function F(We){this.g=new w,this.G=We}function B(We,ct,Rt,Ye){try{var D=ct.call(We.g.j,Rt);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return We.g.m=!1,D;var ae=D.value}catch(be){return We.g.j=null,We.g.s(be),j(We)}return We.g.j=null,Ye.call(We.g,ae),j(We)}function j(We){for(;We.g.h;)try{var ct=We.G(We.g);if(ct)return We.g.m=!1,{value:ct.value,done:!1}}catch(Rt){We.g.v=void 0,We.g.s(Rt)}if(We.g.m=!1,We.g.l){if(ct=We.g.l,We.g.l=null,ct.F)throw ct.D;return{value:ct.return,done:!0}}return{value:void 0,done:!0}}function K(We){this.next=function(ct){return We.o(ct)},this.throw=function(ct){return We.s(ct)},this.return=function(ct){return function(Rt,Ye){_(Rt.g);var D=Rt.g.j;return D?B(Rt,"return"in D?D.return:function(ae){return{value:ae,done:!0}},Ye,Rt.g.return):(Rt.g.return(Ye),j(Rt))}(We,ct)},this[Symbol.iterator]=function(){return this}}function X(We,ct){return ct=new K(new F(ct)),b&&We.prototype&&b(ct,We.prototype),ct}if(w.prototype.o=function(We){this.v=We},w.prototype.s=function(We){this.l={D:We,F:!0},this.h=this.C||this.u},w.prototype.return=function(We){this.l={return:We},this.h=this.u},F.prototype.o=function(We){return _(this.g),this.g.j?B(this,this.g.j.next,We,this.g.o):(this.g.o(We),j(this))},F.prototype.s=function(We){return _(this.g),this.g.j?B(this,this.g.j.throw,We,this.g.o):(this.g.s(We),j(this))},l("Array.prototype.entries",function(We){return We||function(){return function(ct,Rt){ct instanceof String&&(ct+="");var Ye=0,D=!1,ae={next:function(){if(!D&&Ye<ct.length){var be=Ye++;return{value:Rt(be,ct[be]),done:!1}}return D=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(ct,Rt){return[ct,Rt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var oe=function(We,ct){for(var Rt=0;Rt<We.length;Rt++)ct(We[Rt])},xe=function(We){return We.replace(/\r?\n|\r/g,`\r
`)},Ee=function(We,ct,Rt){return ct instanceof Blob?(Rt=Rt!==void 0?Rt+"":typeof ct.name=="string"?ct.name:"blob",ct.name===Rt&&Object.prototype.toString.call(ct)!=="[object Blob]"||(ct=new File([ct],Rt)),[String(We),ct]):[String(We),String(ct)]},me=function(We,ct){if(We.length<ct)throw new TypeError(ct+" argument required, but only "+We.length+" present.")},Re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,He=Re.FormData,Xe=Re.XMLHttpRequest&&Re.XMLHttpRequest.prototype.send,_t=Re.Request&&Re.fetch,ns=Re.navigator&&Re.navigator.sendBeacon,es=Re.Element&&Re.Element.prototype,vs=Re.Symbol&&Symbol.toStringTag;vs&&(Blob.prototype[vs]||(Blob.prototype[vs]="Blob"),"File"in Re&&!File.prototype[vs]&&(File.prototype[vs]="File"));try{new File([],"")}catch{Re.File=function(ct,Rt,Ye){return ct=new Blob(ct,Ye||{}),Object.defineProperties(ct,{name:{value:Rt},lastModified:{value:+(Ye&&Ye.lastModified!==void 0?new Date(Ye.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),vs&&Object.defineProperty(ct,vs,{value:"File"}),ct}}var ps=function(We){return We.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},tr=function(We){this.i=[];var ct=this;We&&oe(We.elements,function(Rt){if(Rt.name&&!Rt.disabled&&Rt.type!=="submit"&&Rt.type!=="button"&&!Rt.matches("form fieldset[disabled] *"))if(Rt.type==="file"){var Ye=Rt.files&&Rt.files.length?Rt.files:[new File([],"",{type:"application/octet-stream"})];oe(Ye,function(D){ct.append(Rt.name,D)})}else Rt.type==="select-multiple"||Rt.type==="select-one"?oe(Rt.options,function(D){!D.disabled&&D.selected&&ct.append(Rt.name,D.value)}):Rt.type==="checkbox"||Rt.type==="radio"?Rt.checked&&ct.append(Rt.name,Rt.value):(Ye=Rt.type==="textarea"?xe(Rt.value):Rt.value,ct.append(Rt.name,Ye))})};if((e=tr.prototype).append=function(We,ct,Rt){me(arguments,2),this.i.push(Ee(We,ct,Rt))},e.delete=function(We){me(arguments,1);var ct=[];We=String(We),oe(this.i,function(Rt){Rt[0]!==We&&ct.push(Rt)}),this.i=ct},e.entries=function We(){var ct,Rt=this;return X(We,function(Ye){if(Ye.h==1&&(ct=0),Ye.h!=3)return ct<Rt.i.length?Ye=S(Ye,Rt.i[ct]):(Ye.h=0,Ye=void 0),Ye;ct++,Ye.h=2})},e.forEach=function(We,ct){me(arguments,1);for(var Rt=u(this),Ye=Rt.next();!Ye.done;Ye=Rt.next()){var D=u(Ye.value);Ye=D.next().value,D=D.next().value,We.call(ct,D,Ye,this)}},e.get=function(We){me(arguments,1);var ct=this.i;We=String(We);for(var Rt=0;Rt<ct.length;Rt++)if(ct[Rt][0]===We)return ct[Rt][1];return null},e.getAll=function(We){me(arguments,1);var ct=[];return We=String(We),oe(this.i,function(Rt){Rt[0]===We&&ct.push(Rt[1])}),ct},e.has=function(We){me(arguments,1),We=String(We);for(var ct=0;ct<this.i.length;ct++)if(this.i[ct][0]===We)return!0;return!1},e.keys=function We(){var ct,Rt,Ye,D,ae=this;return X(We,function(be){if(be.h==1&&(ct=u(ae),Rt=ct.next()),be.h!=3)return Rt.done?void(be.h=0):(Ye=Rt.value,D=u(Ye),S(be,D.next().value));Rt=ct.next(),be.h=2})},e.set=function(We,ct,Rt){me(arguments,2),We=String(We);var Ye=[],D=Ee(We,ct,Rt),ae=!0;oe(this.i,function(be){be[0]===We?ae&&(ae=!Ye.push(D)):Ye.push(be)}),ae&&Ye.push(D),this.i=Ye},e.values=function We(){var ct,Rt,Ye,D,ae=this;return X(We,function(be){if(be.h==1&&(ct=u(ae),Rt=ct.next()),be.h!=3)return Rt.done?void(be.h=0):(Ye=Rt.value,(D=u(Ye)).next(),S(be,D.next().value));Rt=ct.next(),be.h=2})},tr.prototype._asNative=function(){for(var We=new He,ct=u(this),Rt=ct.next();!Rt.done;Rt=ct.next()){var Ye=u(Rt.value);Rt=Ye.next().value,Ye=Ye.next().value,We.append(Rt,Ye)}return We},tr.prototype._blob=function(){var We="----formdata-polyfill-"+Math.random(),ct=[],Rt="--"+We+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ye,D){return typeof Ye=="string"?ct.push(Rt+ps(xe(D))+`"\r
\r
`+xe(Ye)+`\r
`):ct.push(Rt+ps(xe(D))+'"; filename="'+ps(Ye.name)+`"\r
Content-Type: `+(Ye.type||"application/octet-stream")+`\r
\r
`,Ye,`\r
`)}),ct.push("--"+We+"--"),new Blob(ct,{type:"multipart/form-data; boundary="+We})},tr.prototype[Symbol.iterator]=function(){return this.entries()},tr.prototype.toString=function(){return"[object FormData]"},es&&!es.matches&&(es.matches=es.matchesSelector||es.mozMatchesSelector||es.msMatchesSelector||es.oMatchesSelector||es.webkitMatchesSelector||function(We){for(var ct=(We=(this.document||this.ownerDocument).querySelectorAll(We)).length;0<=--ct&&We.item(ct)!==this;);return-1<ct}),vs&&(tr.prototype[vs]="FormData"),Xe){var Fr=Re.XMLHttpRequest.prototype.setRequestHeader;Re.XMLHttpRequest.prototype.setRequestHeader=function(We,ct){Fr.call(this,We,ct),We.toLowerCase()==="content-type"&&(this.B=!0)},Re.XMLHttpRequest.prototype.send=function(We){We instanceof tr?(We=We._blob(),this.B||this.setRequestHeader("Content-Type",We.type),Xe.call(this,We)):Xe.call(this,We)}}_t&&(Re.fetch=function(We,ct){return ct&&ct.body&&ct.body instanceof tr&&(ct.body=ct.body._blob()),_t.call(this,We,ct)}),ns&&(Re.navigator.sendBeacon=function(We,ct){return ct instanceof tr&&(ct=ct._asNative()),ns.call(this,We,ct)}),Re.FormData=tr}})();const tb=()=>{const e=G("AREAS");return e.length===0&&e.push(rr.GLOBAL),za(e).call(e,(t,s,r)=>{const i=f4(s);return i?r===0?i:"".concat(t,",").concat(i):t},"")},f4=e=>e===rr.OVERSEA?"".concat(Vi.ASIA,",").concat(Vi.EUROPE,",").concat(Vi.AFRICA,",").concat(Vi.NORTH_AMERICA,",").concat(Vi.SOUTH_AMERICA,",").concat(Vi.OCEANIA):Vi[e],Mee=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{const r=Uw[s],i=Object.keys(r);i&&i.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(r[l]))})}),t},Yw={GLOBAL:{ASIA:[rr.CHINA,rr.JAPAN,rr.INDIA,rr.KOREA,rr.HKMC],EUROPE:[],NORTH_AMERICA:[rr.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Xw=Object.keys(Yw[rr.GLOBAL]),MN=[rr.CHINA,rr.NORTH_AMERICA,rr.EUROPE,rr.ASIA,rr.JAPAN,rr.INDIA,rr.OCEANIA,rr.SOUTH_AMERICA,rr.AFRICA,rr.KOREA,rr.HKMC,rr.US],Vee=function(e,t){let s=[];if(et(e).call(e,rr.GLOBAL)){const l=[rr.GLOBAL,rr.OVERSEA],A=Object.keys(Uw);if(t===rr.GLOBAL)throw new Le(W.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===rr.CHINA)s=[rr.OVERSEA];else if(i=t,et(Xw).call(Xw,i)){const u=(r=t,Yw[rr.GLOBAL][r]||[]),m=[...l,t,...u];s=A.filter(f=>!et(m).call(m,f))}else if(function(u){let m=!1;return Xw.forEach(f=>{var b;et(b=Yw[rr.GLOBAL][f]).call(b,u)&&(m=!0)}),m}(t)){const u=function(f){let b;return Xw.forEach(w=>{var _;et(_=Yw[rr.GLOBAL][w]).call(_,f)&&(b=w)}),b}(t),m=[...l,u,t];s=A.filter(f=>!et(m).call(m,f))}else s=e;s=function(u){const m=[];return MN.forEach(f=>{et(u).call(u,f)&&m.push(f)}),m.concat(u.filter(f=>!et(MN).call(MN,f)))}(s)}else s=e;var r,i;return s};function g4(e){var t,s;if(!e&&et(t=G("AREAS")).call(t,rr.EXTENSIONS))return N.debug("update area from ap : reset"),void VN(XZ,!0);if(!et(s=G("AREAS")).call(s,rr.GLOBAL)||!e)return;let r=Uw.EXTENSIONS;r&&(r={CODE:f4(rr.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},N.debug("update area from ap success: ".concat(e,",config is "),r),xr("AREAS",[rr.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?xr(i,r[i][0]):xr(i,r[i])}))}function VN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Ot.reportApiInvoke(null,{name:Pr.SET_AREA,options:e,tag:yr.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!et(MU).call(MU,l))throw new Le(W.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:A}=e;if(!l)throw new Le(W.INVALID_PARAMS,"area code is needed");let u=l;typeof l=="string"&&(u=[l]),r=A?Vee(u,A):u}if(!t){if(Vo.AREAS){const l=new Le(W.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(l),void N.warning("setArea is prohibited because of config-distribute")}if(et(r).call(r,rr.GLOBAL)&&G("AREAS")===rr.EXTENSIONS){const l=new Le(W.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(l),void N.warning("setArea is prohibited because of ap extensions")}}xr("AREAS",r,t);const i=Mee(r);Object.keys(i).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?xr(l,i[l][0]):xr(l,i[l])}),N.debug("set area success:",r.join(","))}catch(r){throw s.onError(r),r}s.onSuccess()}function b4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Bd(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?b4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):b4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let QN=1;function Qee(e,t,s,r,i){QN+=1;const l={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:QN,requestId:QN,version:fc,cname:s.cname},A={service_name:t,json_body:JSON.stringify(l)};let u,m,f=e[0];return jl(async()=>{u=Date.now();const b=await Ql(f,{data:A,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-u,b.code!==0){const S=new Le(W.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:m});throw N.error(S.toString()),S}const w=JSON.parse(b.json_body);if(w.code!==200){const S=new Le(W.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:m});throw N.error(S.toString()),S}if(!w.servers||w.servers.length===0){const S=new Le(W.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:m});throw N.error(S.toString()),S}const _=function(S,F){return{addressList:S.servers.map(B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(B.wss,"?serviceName=").concat(encodeURIComponent(F))),workerToken:S.workerToken,vid:S.vid}}(w,t);return G("LIVE_STREAMING_ADDRESS")&&(_.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Bd(Bd({},_),{},{responseTime:m})},(b,w)=>(Ot.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(b.addressList),firstSuccess:w===0,responseTime:m,serverIp:e[w%e.length]}),!1),(b,w)=>(Ot.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:t,responseTime:m,serverIp:e[w%e.length]}),!!(b.code!==W.OPERATION_ABORTED&&b.code!==W.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(f=e[(w+1)%e.length],!0)),i)}let HN=1;function x4(e,t,s,r){let{url:i,areaCode:l}=e;const{clientId:A,sid:u}=t,m=Date.now();let f;const b=t.role,[w,_]=KN(t,l,[bn.CHOOSE_SERVER]);let S=Zr.networkState;return jl(async()=>{S&&Zr.networkState===ga.OFFLINE&&Zr.onlineWaiter&&await pt.race([Zr.onlineWaiter,Yn(r&&r.maxRetryTimeout||gn.maxRetryTimeout)]),S=Zr.networkState;const{data:F,headers:B}=await Ql(i,{data:w,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=B.http3==="1"?1:-1,Ot.reportResourceTiming(i,u),w4(F,i,t,m,[bn.CHOOSE_SERVER],f);const j=Y0(F,bn.CHOOSE_SERVER);return GN(j),IN(j,i)},F=>(F&&Ot.joinChooseServer(u,{role:b,lts:m,succ:!0,csAddr:i,opid:_,serverList:F.gatewayAddrs.map(B=>B.address),ec:null,cid:F.cid.toString(),uid:F.uid.toString(),csIp:F.csIp,unilbsServerIds:[bn.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:F.res.detail&&F.res.detail[38],vid:F.vid}),!1),F=>F.code!==W.OPERATION_ABORTED&&(F.code===W.CAN_NOT_GET_GATEWAY_SERVER?F.data.retry:(Ot.joinChooseServer(u,{role:b,lts:m,succ:!1,csAddr:i,serverList:null,opid:_,ec:F.code,csIp:F.data&&F.data.csIp,unilbsServerIds:[bn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:S}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),N.warning("[".concat(A||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),F),!0)),r)}function v4(e,t,s,r){let i,{url:l,areaCode:A,serviceIds:u}=e;const m=Date.now(),f=t.role,[b,w]=KN(t,A,u);let _;return jl(async()=>{_&&Zr.networkState===ga.OFFLINE&&Zr.onlineWaiter&&await pt.race([Zr.onlineWaiter,Yn(r&&r.maxRetryTimeout||gn.maxRetryTimeout)]),_=Zr.networkState;const{data:S,headers:F}=await Ql(l,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=F.http3==="1"?1:-1,Ot.reportResourceTiming(l,t.sid),w4(S,l,t,m,u,i);const B=Y0(S,bn.CHOOSE_SERVER),j=Y0(S,t.cloudProxyServer==="proxy5"?bn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?bn.CLOUD_PROXY:bn.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(l),X=K[K.length-1];let oe;return X&&(oe={name:X.name,protocol:"nextHopProtocol"in X?X.nextHopProtocol:"",dnscost:"domainLookupEnd"in X&&"domainLookupStart"in X&&typeof X.domainLookupEnd=="number"&&typeof X.domainLookupStart=="number"?X.domainLookupEnd-X.domainLookupStart:-1,tcpTlsCost:"connectEnd"in X&&"connectStart"in X&&typeof X.connectEnd=="number"&&typeof X.connectStart=="number"?X.connectEnd-X.connectStart:-1,reqCost:"requestStart"in X&&typeof X.requestStart=="number"&&"responseEnd"in X&&typeof X.responseEnd=="number"?X.responseEnd-X.requestStart:-1,handleCost:"leave_ts"in S&&"enter_ts"in S&&typeof S.leave_ts=="number"&&typeof S.enter_ts=="number"?S.leave_ts-S.enter_ts:-1}),GN(B),{gatewayInfo:IN(B,l),proxyInfo:j,url:l,resourceTimingInfo:oe}},S=>{var F;return S.gatewayInfo&&Ot.joinChooseServer(t.sid,{role:f,lts:m,succ:!0,csAddr:l,serverList:S.gatewayInfo.gatewayAddrs.map(B=>B.address),ec:null,opid:w,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:S.gatewayInfo.res.detail&&S.gatewayInfo.res.detail[38],vid:(F=S.gatewayInfo)===null||F===void 0?void 0:F.vid,resourceTimingInfo:S.resourceTimingInfo?JSON.stringify(S.resourceTimingInfo):void 0}),S.proxyInfo&&Ot.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:S.proxyInfo.addresses.map(B=>B.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1},S=>S.code!==W.OPERATION_ABORTED&&(S.code===W.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(Ot.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:S.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:_})}),N.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),S),!0)),r)}const w4=(e,t,s,r,i,l)=>{const{sid:A,clientId:u,cloudProxyServer:m}=s,f=[],b=w=>{w.flag===4096?Ot.joinChooseServer(A,{role:s.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:l,corssRegionTagReq:s.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||Ot.joinWebProxyAP(A,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:w.error.code,eventType:m,unilbsServerIds:i.toString()})};if(e.response_body.forEach(w=>{const _=w.buffer.code;if(w.uri===23&&_===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const S={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:w.buffer.flag};f.push(S),b(S)}if(_!==0){const S=kf(_),F={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?N.warning(F.error.toString()):f.push(F),b(F)}}),f.length)throw N.warning("[".concat(u||"sid-".concat(A.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new Le(W.CAN_NOT_GET_GATEWAY_SERVER,f.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!f.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(w=>{var _;return w==null||(_=w.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(w=>!!w))]})},GN=e=>{var t,s,r,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(G("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?g4(e.detail[23].toLowerCase()):g4()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){const A=e.detail[19],u=A==null?void 0:A.split(";");for(let m=0;m<u.length;m++){var l;const f=ma(l=u[m]).call(l);e.addresses[m]&&u&&(e.addresses[m].fingerprint=f)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){N.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const A=G("GATEWAY_ADDRESS").map(u=>{var m,f;const b=(m=(f=e.addresses.find(w=>w.ip===u.ip&&w.port===u.port))===null||f===void 0?void 0:f.fingerprint)!==null&&m!==void 0?m:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:u.fingerprint||b}});e.addresses=A}},Hee=(e,t)=>{if(e.response_body&&e.response_body.length){const s=e.response_body[0];if(s.buffer.code!==0){const r=kf(s.buffer.code);throw new Le(W.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return s.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",t),new Le(W.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},KN=(e,t,s)=>{const r=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Bd(Bd(Bd({6:e.stringUid,11:t,12:G("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};l.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const A=new FormData;return A.append("request",JSON.stringify(l)),[A,r]},Gee=(e,t)=>{const s=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,s]};let Lf=0;function jf(e){return pt.all(e.map(t=>t.then(s=>{throw s},s=>s))).then(t=>{throw t},t=>t)}const sb=async e=>{let{fragementLength:t,referenceList:s,asyncMapHandler:r,allFailedhandler:i,promisesCollector:l}=e,A=0;const u=t;let m,f=0;const b=async()=>{const w=(()=>{const _=A*u,S=_+u;return s.slice(_,S).map(r)})();l&&l.push(...w);try{m=await jf(w)}catch(_){if(f+=u,A++,!(f>=s.length))return void await b();i(_)}w.forEach(_=>_.cancel())};return await b(),m},_4=async e=>{let{referenceList:t,asyncMapHandler:s,closeFn:r}=e;const i=t.length;let l=0;const A=async()=>{const u=s(t.shift());try{return await u}catch(m){if(l++,l>=i||r!=null&&r(m))throw m;return A()}};return A()};async function Kee(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],l=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],A=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new pt((m,f)=>{let b;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:_=>{_.close(),clearTimeout(b),m(!0)},error:_=>{clearTimeout(b),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const w=[t,s,r,i,l,A];for(let _=0;_<w.length;_++){const S=new EncodedVideoChunk({type:_==0?"key":"delta",timestamp:33333*_,duration:33333,data:new Uint8Array(w[_])});try{await e.decode(S)}catch{return void m(!1)}}})(),b=setTimeout(()=>{m(!1)},5e3)})}async function Jw(e,t,s,r){return{gatewayInfo:await async function(l,A,u,m){let f=null;const b=[],w=async()=>{const S=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:tb()})),F=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(j=>j.url)}),B=await sb({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:j=>(N.debug("[".concat(l.clientId,"] Connect to choose_server:"),j.url),x4(j,l,A,u)),allFailedhandler:j=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:b});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},F),B},_=async()=>{if(await Yn(1e3),f!==null)return f;const S=G("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:tb()})),F=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(j=>j.url)}),B=await sb({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:j=>(N.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),j.url),x4(j,l,A,u)),allFailedhandler:j=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:b});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},F),B};try{return f=await jf([w(),_()]),b.length&&b.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),f}catch(S){throw S[0]}}(e,t,s,r)}}async function y4(e,t,s,r,i){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await Jw(e,t,s,i);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:S}=await S4(e,t,s,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:_};const F=S.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Oi.tcpport,udpport:B.udpport||Oi.udpport,username:B.username||Oi.username,password:B.password||Oi.password,forceturn:!1,security:!0}));if(i.useP2P){var A;const B=(A=e.uid)!==null&&A!==void 0?A:_.uid,j="glb:".concat(B.toString()),K=await N1(j),X=S.map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||Oi.tcpport,udpport:oe.udpport||Oi.udpport,username:j,password:K,forceturn:!1,security:!0}));F.push(...X)}return e.turnServer={mode:"manual",servers:F},{gatewayInfo:_}}return await Jw(e,t,s,i)}const{proxyInfo:u,gatewayInfo:m}=await S4(e,t,s,i),f={gatewayInfo:m},b=u.map(_=>({turnServerURL:_.address,tcpport:l==="proxy3"?void 0:_.tcpport?_.tcpport:Oi.tcpport,udpport:l==="proxy4"?void 0:_.udpport?_.udpport:Oi.udpport,username:_.username||Oi.username,password:_.password||Oi.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(i.useP2P){var w;const _=(w=e.uid)!==null&&w!==void 0?w:m.uid,S="glb:".concat(_.toString()),F=await N1(S),B=u.map(j=>({turnServerURL:j.address,tcpport:l==="proxy3"?void 0:j.tcpport||Oi.tcpport,udpport:l==="proxy4"?void 0:j.udpport||Oi.udpport,username:S,password:F,forceturn:l!=="proxy4",security:l==="proxy5"}));b.push(...B)}return e.turnServer={mode:"manual",servers:b},N.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),f}async function E4(e,t,s,r,i){const l=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let A=[];A=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));const u=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:A});try{const m=await async function(f,b,w,_,S){const F=Date.now(),B={sid:w.sid,opid:10,appid:w.appId,string_uid:b};let j=f[0];const K=await jl(()=>Ql(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:B,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(X,oe)=>{if(X.code===0){if(X.uid<=0||X.uid>=Math.pow(2,32))throw N.error("Invalid Uint Uid ".concat(b," => ").concat(X.uid),X),Ot.reqUserAccount(B.sid,{lts:F,success:!1,serverAddr:j,stringUid:B.string_uid,uid:X.uid,errorCode:W.INVALID_UINT_UID_FROM_STRING_UID,extend:B}),new Le(W.INVALID_UINT_UID_FROM_STRING_UID);return Ot.reqUserAccount(B.sid,{lts:F,success:!0,serverAddr:j,stringUid:B.string_uid,uid:X.uid,errorCode:null,extend:B}),!1}const xe=kf(X.code);return xe.retry&&(j=f[(oe+1)%f.length]),Ot.reqUserAccount(B.sid,{lts:F,success:!1,serverAddr:j,stringUid:B.string_uid,uid:X.uid,errorCode:xe.desc,extend:B}),xe.retry},(X,oe)=>X.code!==W.OPERATION_ABORTED&&(Ot.reqUserAccount(B.sid,{lts:F,success:!1,serverAddr:j,stringUid:B.string_uid,uid:null,errorCode:X.code,extend:B}),j=f[(oe+1)%f.length],!0),S);if(K.code!==0){const X=kf(K.code);throw new Le(W.UNEXPECTED_RESPONSE,X.desc)}return K}(A,e,t,s,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},u),m.uid}catch(m){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},u),m}}async function Wee(e,t,s){const r=G("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));try{return await _4({referenceList:i,asyncMapHandler:A=>async function(u,m,f,b){const w=Date.now(),_={sid:f.sid,opid:10,appid:f.appId,string_uid:m};try{const S=await Ql(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){const F=kf(S.code);throw new Le(W.UNEXPECTED_RESPONSE,"preload sua error:".concat(F.desc),F)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new Le(W.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:u,req:_,uid:S.uid,elapse:Date.now()-w}}catch(S){throw S}}(A,e,t,s),closeFn:A=>A.code===W.OPERATION_ABORTED||A.code===W.UNEXPECTED_RESPONSE&&!A.data.retry})}catch(l){throw l}}async function zee(e,t,s){const r=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),i=r.map(m=>function(f,b,w,_){const S=$s(),F={flag:64,cipher_method:0,features:Bd(Bd(Bd(Bd(Bd({install_id:M1(),device:S.name,system:S.os,system_general:navigator.userAgent,vendor:b.appId,version:fc,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:Pee.WEB_RTC,browser_name:S.name,browser_version:S.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),S.os&&{os_name:S.os}),S.osVersion&&{os_version:S.osVersion}),{},{detail:""})};return jl(()=>Ql(f,{data:F,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,B=>B.code!==W.OPERATION_ABORTED,_)}(m,e,t,s));let l=null,A=null,u={};try{l=await jf(i)}catch(m){if(m.code===W.OPERATION_ABORTED)throw m;A=m}if(i.forEach(m=>m.cancel()),Ot.reportApiInvoke(e.sid,{name:Pr.REQUEST_CONFIG_DISTRIBUTE,options:{error:A,res:l}}).onSuccess(),l&&l.test_tags)try{u=function(m){if(!m.test_tags)return{};const f=m.test_tags,b=Object.keys(f),w={};return b.forEach(_=>{var S;const F=ma(S=_.slice(4)).call(S),B=JSON.parse(f[_]),j=B[1];w[F]={tag:B[0]||"",value:j}}),w}(l)}catch{}return u}async function C4(e,t){const s=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:tb(),serviceIds:[bn.CHOOSE_SERVER,bn.CLOUD_PROXY_FALLBACK]}));try{return await _4({referenceList:s,asyncMapHandler:i=>async function(l,A,u){let m,{url:f,areaCode:b,serviceIds:w}=l;const _=Date.now(),[S,F]=KN(A,b,w);let B=Zr.networkState;try{B&&Zr.networkState===ga.OFFLINE&&Zr.onlineWaiter&&await pt.race([Zr.onlineWaiter,Yn(gn.maxRetryTimeout)]),B=Zr.networkState;const{data:j,headers:K}=await Ql(f,{data:S,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=K.http3==="1"?1:-1,(Ee=>{const me=[];if(Ee.response_body.forEach(Re=>{const He=Re.buffer.code;if(Re.uri===23&&He===0&&!Re.buffer.edges_services)if(Re.buffer.flag===4194310)Re.buffer.edges_services=[];else{const Xe={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:Ee.detail[502]}),flag:Re.buffer.flag};me.push(Xe)}if(He!==0){const Xe=kf(He),_t={error:new Le(W.CAN_NOT_GET_GATEWAY_SERVER,Xe.desc,{desc:Xe.desc,retry:Xe.retry,csIp:Ee.detail[502]}),flag:Re.buffer.flag};Re.buffer.flag===4194310?N.warning(_t.error.toString()):me.push(_t)}}),me.length)throw new Le(W.CAN_NOT_GET_GATEWAY_SERVER,me.map(Re=>"flag: ".concat(Re.flag,", message: ").concat(Re.error.message)).join(" | "),{retry:!!me.find(Re=>Re.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(me.map(Re=>{var He;return Re==null||(He=Re.error)===null||He===void 0||(He=He.data)===null||He===void 0?void 0:He.desc}).filter(Re=>!!Re))]})})(j);const oe=Y0(j,bn.CHOOSE_SERVER),xe=Y0(j,bn.CLOUD_PROXY_FALLBACK);return GN(oe),{gatewayInfo:IN(oe,f),proxyInfo:xe,opid:F,requestTime:_,url:f,isHttp3:m,elapse:Date.now()-_}}catch(j){throw j}}(i,e,t),closeFn:i=>i.code===W.OPERATION_ABORTED||i.code===W.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function S4(e,t,s,r){const i=G("PROXY_SERVER_TYPE3"),l=(S,F,B)=>{let j=B||i;return Array.isArray(j)&&(j=F%2==0&&i[1]||i[0]),"https://".concat(j,"/ap/?url=").concat(S)};let A=null;const u=[],m=async()=>{const S=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((j,K)=>{let X;return X=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:X,areaCode:tb(),serviceIds:[bn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?bn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?bn.CLOUD_PROXY:bn.CLOUD_PROXY_FALLBACK]}}),F=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(j=>j.url)}),B=await sb({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:j=>(N.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),v4(j,e,t,s)),allFailedhandler:j=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},F),B},f=async()=>{if(await Yn(1e3),A!==null)return A;const S=G("WEBCS_DOMAIN_BACKUP_LIST").map((j,K)=>{let X;return X=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:X,areaCode:tb(),serviceIds:[bn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?bn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?bn.CLOUD_PROXY:bn.CLOUD_PROXY_FALLBACK]}}),F=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(j=>j.url)}),B=await sb({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:j=>(N.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),v4(j,e,t,s)),allFailedhandler:j=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},F),B};let b,w,_;try{({gatewayInfo:b,proxyInfo:w,url:_}=await jf([m(),f()]))}catch(S){throw S[0]}if(u.length&&u.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!b||!w)throw new Le(W.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=_,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&_){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];et(i).call(i,S)&&(e.proxyServer=S,N.setProxyServer(S),Ot.setProxyServer(S))}return A={gatewayInfo:b,proxyInfo:await XU(w,b.uid)},A}async function qee(e,t,s){const r=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),i=r.map(l=>function(A,u,m,f){const b={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:fc,cname:u.cname,uid:u.uid.toString(),requestId:HN,seq:HN};HN+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(b)};return jl(async()=>{const _=await Ql(A,{data:w,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){const F=new Le(W.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw N.error(F.toString()),F}const S=JSON.parse(_.json_body);if(S.code!==200){const F=new Le(W.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw N.error(F.toString()),F}if(!S.servers||S.servers.length===0){const F=new Le(W.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(F.toString()),F}return{vid:S.vid,workerToken:S.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(F.wss))}},void 0,_=>!!(_.code!==W.OPERATION_ABORTED&&_.code!==W.UNEXPECTED_RESPONSE||_.data&&_.data.retry),f)}(l,e,t,s));try{const l=await jf(i);return i.forEach(A=>A.cancel()),l}catch(l){throw l[0]}}async function Yee(e,t,s){let r=null;const i=[],l=async A=>{const u=G(A?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return A&&(await Yn(1e3),r!==null)?r:await sb({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:m=>(N.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(A?"backup":""," choose_server:"),m),function(f,b,w,_){const[S]=Gee(b,[bn.CHOOSE_SERVER]);let F=Zr.networkState;return jl(async()=>{F&&Zr.networkState===ga.OFFLINE&&Zr.onlineWaiter&&await pt.race([Zr.onlineWaiter,Yn(_&&_.maxRetryTimeout||gn.maxRetryTimeout)]),F=Zr.networkState;const B=await Ql(f,{data:S,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return Hee(B,f)},()=>!1,B=>B.code!==W.OPERATION_ABORTED&&(B.code===W.UPDATE_TICKET_FAILED?B.data.retry:(N.warning("[".concat(b.clientId,"] update ticket network error, retry"),B),!0)),_)}(m,e,t,s)),allFailedhandler:m=>{throw m[0]},promisesCollector:i})};try{return r=await jf([l(!1),l(!0)]),i.length&&i.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),r}catch(A){throw A[0]}}function N4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function WN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?N4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):N4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Xee extends Vr{get isSuccess(){return!!this.configs}constructor(t,s){super(),U(this,"configs",void 0),U(this,"store",void 0),U(this,"joinInfo",void 0),U(this,"cancelToken",void 0),U(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),U(this,"interval",void 0),U(this,"mutex",void 0),U(this,"mutableParamsRead",!1),U(this,"configCache",{}),U(this,"limit_bitrate",void 0),this.mutex=new ai("config-distribute",t),this.store=s}startGetConfigDistribute(t,s){this.joinInfo=t,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ot.reportApiInvoke(null,{options:void 0,name:Pr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:yr.TRACER}).onSuccess(JSON.stringify(Vo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void N.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const s=await this.mutex.lock();try{t=await zee(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(i){var l;const A=zh(l=Object.keys(i).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(l);for(let f=0;f<A.length;f++)for(let b=A.length-1;b>f;b--){const w=A[b],_=i[w].value;if(typeof _.__priority=="number"){const S=_.__priority,F=A[b-1],B=i[F].value;if(typeof B.__priority=="number"){if(!(S>B.__priority))continue;{const j=w;A[b]=A[b-1],A[b-1]=j}}else{const j=w;A[b]=A[b-1],A[b-1]=j}}}const u=Date.now(),m={};return A.forEach(f=>{const b=i[f].value.__expires;b&&b<=u||(m[f]=i[f])}),m}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const i=new Le(W.NETWORK_RESPONSE_ERROR,r);N.warning("[config-distribute] ".concat(i.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){VU(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Fl.UPDATE_BITRATE_LIMIT,t):this.emit(Fl.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&WN({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const s={},r=Object.keys(t),i=[];r.forEach(l=>{const A=t[l].value;s[l]=A;const u=A.__id;if(u&&this.configCache[l]&&this.configCache[l].__id===u)return;const m=A.__type,f=t[l].value,b=t[l].tag;let w=0;m?m===aj.REALTIME&&(w=1):Object.keys(f).some(_=>Object.prototype.hasOwnProperty.call(G1,_)||!bN()&&Object.prototype.hasOwnProperty.call(pw,_)?(w=1,!0):void 0),i.push({tag:b,isApplied:w,feature:l,params:JSON.stringify(A)})}),i.forEach(l=>{let{tag:A,feature:u,params:m,isApplied:f}=l;this.store.sessionId&&Ot.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:A,feature:u,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){N.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(t){const s=function(i){const l={};return Object.keys(i).forEach(A=>{const u=i[A].value,m=u.__expires,f=u.__type;Object.keys(u).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(l,b)||(l[b]=WN(WN({value:u[b]},m&&{expires:m}),f&&{type:f}))})}),l}(t);try{var r;const i=(r=s.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete s.LIMIT_BITRATE,i&&VU(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(t),function(u){try{const m=Date.now();Object.keys(u).forEach(f=>{const{value:b,type:w,expires:_}=u[f];_&&_<=m||((w===aj.REALTIME||Object.prototype.hasOwnProperty.call(G1,f))&&(Vo[f]=b,Ar[f]=b,N.debug("Update realtime parameters from config distribute",f,b)),w||bN()||!Object.prototype.hasOwnProperty.call(pw,f)||(Vo[f]=b,Ar[f]=b,N.debug("Update gateway parameters from config distribute",f,b)))})}catch(m){N.error("Error update config immediately: ".concat(u),m.message)}}(s);const l=JSON.stringify(s),A=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",A),N.debug("Caching global parameters ".concat(l))}catch(i){N.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{const s=Date.now();Object.keys(t).forEach(r=>{switch(r){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(Ar,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;k1(Ar[r],l)||(Vo[r]=l,Ar[r]=l,this.emit(Fl.UPDATE_CLIENT_ROLE_OPTIONS,l),N.debug("Updating client role options: ".concat(JSON.stringify(l))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(Ar,r)){var i;const{value:l,expires:A}=t[r];if(A&&A<=s)return;typeof l=="number"&&et(i=[0,1,4,5,6,7,8,9]).call(i,l)&&(Vo[r]={value:l},Ar[r]=l,this.emit(Fl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,l),N.debug("Updating client remote stream type: ".concat(JSON.stringify(l))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(Ar,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;k1(Ar[r],l)||(Vo[r]=l,Ar[r]=l,this.emit(Fl.FALLBACK_TO_HLS,l),N.debug("Updating enable force hls: ".concat(JSON.stringify(l))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(Ar,r)){const{value:l,expires:A}=t[r];if(A&&A<=s)return;k1(Ar[r],l)||(Vo[r]=l,Ar[r]=l,this.emit(Fl.UPDATE_VOS_CONFIGURE,l),N.debug("Updating vos configure: ".concat(JSON.stringify(l))))}}})}catch(s){N.error("Error handling global parameter config:",s.message)}}}class Jee extends Vr{constructor(){super(...arguments),U(this,"resultStorage",new Map)}setLocalAudioStats(t,s,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,s))}setLocalVideoStats(t,s,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,s)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,s)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(r))}setRemoteAudioStats(t,s){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(s))}setRemoteVideoStats(t,s){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(s))}record(t,s,r){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(!i)return;i.result.push(r);const l=t==="VIDEO_ENCODE_FAILED"?G("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=l){var A;const u=et(A=i.result).call(A,!0);i.isPrevNormal&&!u&&this.emit("exception",zN[t],t,s),!i.isPrevNormal&&u&&this.emit("exception",zN[t]+2e3,t+"_RECOVER",s),i.isPrevNormal=u,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,s){return s instanceof Ln&&!s.isActive||!!s.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,s){let r=null;s._encoderConfig&&s._encoderConfig.frameRate&&(r=Pa(s._encoderConfig.frameRate));const i=t.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var s;return!(!t.codecType||et(s=G("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,s){return!!s.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,s){return s instanceof Ln&&!s.isActive||!!s.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const zN={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Qi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(s.length>0){const r=s[s.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(s.length>0){const r=s[s.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function T4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function _p(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?T4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):T4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class rb{constructor(t){U(this,"store",void 0),U(this,"onStatsException",void 0),U(this,"onUploadPublishDuration",void 0),U(this,"onStatsChanged",void 0),U(this,"onVideoCodecChanged",void 0),U(this,"localStats",new Map),U(this,"remoteStats",new Map),U(this,"updateStatsInterval",void 0),U(this,"trafficStats",void 0),U(this,"trafficStatsPeerList",[]),U(this,"uplinkStats",void 0),U(this,"exceptionMonitor",void 0),U(this,"p2pChannel",void 0),U(this,"scalabilityMode",uw.L1T1),U(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Jee,this.exceptionMonitor.on("exception",(s,r,i)=>{this.onStatsException&&this.onStatsException(s,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(rt.LocalAudioTrack)||_p({},X1)}getLocalVideoTrackStats(){return this.localStats.get(rt.LocalVideoTrack)||_p({},J1)}getRemoteAudioTrackStats(t){const s=(l,A)=>{if(!this.trafficStats)return A;const u=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return u&&(A.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),A},r={};if(t){var i;const l=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;l&&(r[t]=s(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[A,{audioStats:u}]=l;u&&(r[A]=s(A,u))});return r}getRemoteNetworkQualityStats(t){const s={};if(t){var r;const i=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;i&&(s[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[l,{networkStats:A}]=i;A&&(s[l]=A)});return s}getNetworkQuality(){let t=0,s=0;return this.trafficStats&&(t=Qw(this.trafficStats.B_unq),s=Qw(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:s}}getRemoteVideoTrackStats(t){const s=(l,A)=>{if(!this.trafficStats)return A;const u=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return u&&(A.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),A},r={};if(t){var i;const l=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;l&&(r[t]=s(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[A,{videoStats:u}]=l;u&&(r[A]=s(A,u))});return r}getRTCStats(){let t=0,s=0,r=0,i=0;const l=this.localStats.get(rt.LocalAudioTrack);l&&(t+=l.sendBytes,s+=l.sendBitrate);const A=this.localStats.get(rt.LocalVideoTrack);A&&(t+=A.sendBytes,s+=A.sendBitrate);const u=this.localStats.get(rt.LocalVideoLowTrack);u&&(t+=u.sendBytes,s+=u.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:b,videoStats:w}=f;b&&(r+=b.receiveBytes,i+=b.receiveBitrate),w&&(r+=w.receiveBytes,i+=w.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:s,SendBytes:t,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),t.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(s.peer_uid),l=i!=null&&i.videoSSRC?Qi.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,A=i!=null&&i.audioSSRC?Qi.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,l>A?l:A),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&N.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,s,r){if(!t)return!1;const i=!!r&&s.framesDecodeFreezeTime>r.framesDecodeFreezeTime,l=!r||s.framesDecodeCount>r.framesDecodeCount;return i||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(s=>{let[r,i]=s;switch(r){case rt.LocalVideoTrack:case rt.LocalVideoLowTrack:{const u=i,m=_p({},J1),f=t.getStats(),b=t.getLocalMedia(r);if(f){const w=f.videoSend.find(_=>_.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(w){const _=t.getLocalVideoSize(),S=t.getEncoderConfig(rt.LocalVideoTrack);var l;(w.codec==="H264"||w.codec==="H265"||w.codec==="VP8"||w.codec==="VP9"||w.codec==="AV1X"||w.codec==="AV1")&&(m.codecType=w.codec,(u==null?void 0:u.codecType)!==w.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,w.codec.toLocaleLowerCase()))),m.sendBytes=w.bytes,m.sendBitrate=u?8*Math.max(0,m.sendBytes-u.sendBytes):0,w.inputFrame?(m.captureFrameRate=w.inputFrame.frameRate,m.captureResolutionHeight=w.inputFrame.height,m.captureResolutionWidth=w.inputFrame.width):_&&(m.captureResolutionWidth=_.width,m.captureResolutionHeight=_.height),w.sentFrame?(m.sendFrameRate=w.sentFrame.frameRate,m.sendResolutionHeight=w.sentFrame.height,m.sendResolutionWidth=w.sentFrame.width):_&&(m.sendResolutionWidth=_.width,m.sendResolutionHeight=_.height),w.avgEncodeMs&&(m.encodeDelay=w.avgEncodeMs),S&&S.bitrateMax?m.targetSendBitrate=1e3*S.bitrateMax:w.targetBitrate&&(m.targetSendBitrate=w.targetBitrate),m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.totalDuration=u?u.totalDuration+1:1,m.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(w)&&(m.totalFreezeTime+=1),w.scalabilityMode&&this.scalabilityMode!==w.scalabilityMode&&(N.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(w.scalabilityMode)),this.scalabilityMode=w.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var A;this.localStats.set(r,m),((u==null?void 0:u.sendResolutionWidth)!==m.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==m.sendResolutionHeight)&&((A=this.onStatsChanged)===null||A===void 0||A.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&b&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,b.track,m);break}case rt.LocalAudioTrack:{const u=i,m=_p({},X1),f=t.getStats(),b=t.getLocalMedia(r);if(f){const w=f.audioSend.find(_=>_.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(w){if(w.codec!=="opus"&&w.codec!=="aac"&&w.codec!=="PCMU"&&w.codec!=="PCMA"&&w.codec!=="G722"||(m.codecType=w.codec),w.inputLevel)m.sendVolumeLevel=Math.round(32767*w.inputLevel);else{const _=t.getLocalAudioVolume();_&&(m.sendVolumeLevel=Math.round(32767*_))}m.sendBytes=w.bytes,m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.sendBitrate=u?8*Math.max(0,m.sendBytes-u.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(rt.LocalAudioTrack,m),m&&b&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,b.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(s=>{var r,i;let[l,{videoStats:A,audioStats:u,videoPcStats:m}]=s;const f=u,b=A,w=m,_=_p({},vj),S=_p({},wj),F=_p({},jZ),{audioTrack:B,videoTrack:j,audioSSRC:K,videoSSRC:X}=t.getRemoteMedia(l);let oe;oe=this.store.useP2P?t.getStats(!0):t.getStats();const xe=(r=oe)===null||r===void 0?void 0:r.audioRecv.find(He=>He.ssrc===K),Ee=(i=oe)===null||i===void 0?void 0:i.videoRecv.find(He=>He.ssrc===X),me=this.trafficStats&&this.trafficStats.peer_delay.find(He=>He.peer_uid===l);if(xe&&(xe.codec!=="opus"&&xe.codec!=="aac"&&xe.codec!=="PCMU"&&xe.codec!=="PCMA"&&xe.codec!=="G722"||(_.codecType=xe.codec),xe.outputLevel?_.receiveLevel=Math.round(32767*xe.outputLevel):B&&(_.receiveLevel=Math.round(32767*B.getVolumeLevel())),_.receiveBytes=xe.bytes,_.receivePackets=xe.packets,_.receivePacketsLost=xe.packetsLost,_.receivePacketsDiscarded=xe.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=f?8*Math.max(0,_.receiveBytes-f.receiveBytes):0,_.totalDuration=f?f.totalDuration+1:1,_.totalFreezeTime=f?f.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=xe.jitterBufferMs,_.totalDuration>10&&rb.isRemoteAudioFreeze(B)&&(_.totalFreezeTime+=1)),Ee){var Re;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(S.codecType=Ee.codec),S.receiveBytes=Ee.bytes,S.receiveBitrate=b?8*Math.max(0,S.receiveBytes-b.receiveBytes):0,S.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,S.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(S.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(S.receiveFrameRate=Ee.receivedFrame.frameRate,S.receiveResolutionHeight=Ee.receivedFrame.height,S.receiveResolutionWidth=Ee.receivedFrame.width):j&&(S.receiveResolutionHeight=j._videoHeight||0,S.receiveResolutionWidth=j._videoWidth||0),Ee.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round(Ee.framesRateFirefox)),S.receivePackets=Ee.packets,S.receivePacketsLost=Ee.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost);const He=b?b.totalFreezeTime:0,Xe=b?b.totalDuration:0;S.totalDuration=b?b.totalDuration+1:1,S.totalFreezeTime=(Re=Ee.totalFreezesDuration)!==null&&Re!==void 0?Re:He||0,S.receiveDelay=Ee.jitterBufferMs||0;const _t=!!X&&t.getRemoteVideoIsReady(X);Ee.totalFreezesDuration===void 0&&j&&_t&&rb.isRemoteVideoFreeze(j,Ee,w)&&(S.totalFreezeTime+=1),S.freezeRate=Math.max(0,Math.min((S.totalFreezeTime-He)/(S.totalDuration-Xe),1))}me&&(_.end2EndDelay=me.B_ad,S.end2EndDelay=me.B_vd,_.transportDelay=me.B_ed,S.transportDelay=me.B_ed,_.currentPacketLossRate=me.B_ealr4/100,S.currentPacketLossRate=me.B_evlr4/100,F.uplinkNetworkQuality=me.B_punq?me.B_punq:0,F.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(l,{audioStats:_,videoStats:S,videoPcStats:Ee,networkStats:F}),B&&this.exceptionMonitor.setRemoteAudioStats(B,_),j&&this.exceptionMonitor.setRemoteVideoStats(j,S)})}}class R4{constructor(){U(this,"destChannelMediaInfos",new Map),U(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){FU(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){FU(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Lw(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function I4(e){if(!(e instanceof R4))return new Le(W.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!t)return new Le(W.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Le(W.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Bu{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,s){U(this,"uid",void 0),U(this,"_uintid",void 0),U(this,"_trust_in_room_",!0),U(this,"_trust_audio_enabled_state_",!0),U(this,"_trust_video_enabled_state_",!0),U(this,"_trust_audio_mute_state_",!0),U(this,"_trust_video_mute_state_",!0),U(this,"_audio_muted_",!1),U(this,"_video_muted_",!1),U(this,"_audio_enabled_",!0),U(this,"_video_enabled_",!0),U(this,"_audio_added_",!1),U(this,"_video_added_",!1),U(this,"_is_pre_created",!1),U(this,"_video_pre_subscribed",!1),U(this,"_audio_pre_subscribed",!1),U(this,"_trust_video_stream_added_state_",!0),U(this,"_trust_audio_stream_added_state_",!0),U(this,"_audioTrack",void 0),U(this,"_videoTrack",void 0),U(this,"_dataChannels",[]),U(this,"_audioSSRC",void 0),U(this,"_videoSSRC",void 0),U(this,"_audioOrtc",void 0),U(this,"_videoOrtc",void 0),U(this,"_cname",void 0),U(this,"_rtxSsrcId",void 0),U(this,"_videoMid",void 0),U(this,"_audioMid",void 0),this.uid=t,this._uintid=s}}function O4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function qN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?O4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):O4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const $ee=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),$w="9",YN=2e4,Zw=4e4;let k4=class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_originCandidates",void 0),U(this,"_iceParameters",void 0),U(this,"_isUseExtmapAllowMixed",void 0),U(this,"_isUseLocalCodecs",void 0),U(this,"_isUseDataChannel",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),U(this,"useLocalCodecsMids",[]),U(this,"preloadSsrcs",[]),U(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=s,this._isUseDataChannel=r,e=Dr(e);const{iceParameters:i,dtlsParameters:l,candidates:A,rtpCapabilities:u,setup:m,localCapabilities:f,cname:b}=e;this._rtpCapabilities=u,this._candidates=A,this._originCandidates=Dr(A),this._iceParameters=i,this._dtlsParameters=l,this._localCapabilities=f,this.setup=m,this.cname=b,[this.sessionDesc]=this.updateRemoteRTPCapabilities(u),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var s;return et(s=this.preloadSsrcs).call(s,t)})}preloadRemoteMedia(e){let t=0;const s=[],r=[];for(;e>0;){const i=[qN({ssrcId:Zw+t},G("USE_SUB_RTX")?{rtx:Zw+t+1}:{})],l="".concat(Zw+t,"_").concat(YN+t),{ssrcs:A,ssrcGroups:u}=$0(i,this.cname,G("SYNC_GROUP")?l:void 0),m=this.preCreateOrRecycleSendMedia("video",A,u,void 0),f=[{ssrcId:YN+t}],b="".concat(Zw+t,"_").concat(YN+t),{ssrcs:w,ssrcGroups:_}=$0(f,this.cname,G("SYNC_GROUP")?b:void 0),S=this.preCreateOrRecycleSendMedia("audio",w,_,void 0);e--,t+=2,s.push(m,S),r.push(A[0].ssrcId,w[0].ssrcId)}return this.useLocalCodecsMids.push(...s),this.preloadSsrcs=r,{mids:s,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,s,r){const i=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||i.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;N.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const A=e===Nt.VIDEO?l.videoCodecs:l.audioCodecs,u=e===Nt.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let f={media:{mediaType:e,port:$w,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};return f=this.mungSendMediaDesc(f,r),this.sessionDesc.mediaDescriptions.push(f),this.updateBundleMids(),m}toString(){return SA(this.sessionDesc)}send(e,t,s,r){const{ssrcs:i,ssrcGroups:l}=$0(t,this.cname,G("SYNC_GROUP")?s:void 0),A=this.findPreloadMediaDesc(i);if(A){if(kr()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,A.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(A);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(A,r),{mid:A.attributes.mid,needExchangeSDP:!0}}return{mid:A.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,i);let m;return u===-1||u===1&&(ii()||function(){const f=$s();return!(f.name!==er.CHROME||!f.osVersion)&&Number(f.version)<=90}()||Ll(143)||Cu(143)||G("RESERVE_MID_1_MLINE")||G("ENABLE_ENCODED_TRANSFORM")&&EA())||u===0&&!function(f){const b=$s();return!(b.name!==er.FIREFOX||!b.osVersion)&&Number(b.version)===f}(138)&&G("USE_SUB_RTX")||NL()?(m=this.createOrRecycleSendMedia(e,i,l,"sendonly",r),this.updateBundleMids()):(m=Dr(this.sessionDesc.mediaDescriptions[u]),m.attributes.direction="sendonly",m.attributes.ssrcs=i,m.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(m,r)),kr()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(i=>{let{kind:l,ssrcMsg:A,mslabel:u}=i;return this.send(l,A,u)}),s=[];let r=!1;return t.forEach(i=>{let{mid:l,needExchangeSDP:A}=i;A&&(r=!0),s.push(l)}),{mids:s,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.mid==="0"||kr()||NL()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}receive(e,t,s,r){e.forEach((i,l)=>{this.createOrRecycleRecvMedia(i,[],"recvonly",t,s,r[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||ba((s=this._isUseExtmapAllowMixed,this._isUseDataChannel?$ee(s):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(s?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var s;this._rtpCapabilities=e;let r=!1;const i=this.rtpCapabilities.send,l=this.localCapabilities.send,A=this.localCapabilities.recv,u=A.videoCodecs,m=A.audioCodecs,f=A.videoExtensions,b=A.audioExtensions;for(const F of t.mediaDescriptions){var w;if(F.attributes.direction!=="sendonly"||typeof F.attributes.mid!="string"||!et(w=this.useLocalCodecsMids).call(w,F.attributes.mid)){if(r=!0,F.attributes.iceUfrag=this._iceParameters.iceUfrag,F.attributes.icePwd=this._iceParameters.icePwd,F.attributes.fingerprints=this._dtlsParameters.fingerprints,F.attributes.candidates=this._candidates,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var _;F.media.fmts=u.map(j=>j.payloadType.toString(10)),F.attributes.payloads=u,F.attributes.extmaps=f;const B=F.attributes.mid;typeof B!="string"||et(_=this.useLocalCodecsMids).call(_,B)||this.useLocalCodecsMids.push(B)}else if(i.videoCodecs.length===0){const B=l.videoCodecs.filter(j=>{var K,X;return(K=j.rtpMap)===null||K===void 0?void 0:et(X=K.encodingName.toLowerCase()).call(X,"vp8")});B.length===0&&B.push(l.videoCodecs[0]),F.media.fmts=B.map(j=>j.payloadType.toString(10)),F.attributes.payloads=B,F.attributes.extmaps=[]}else F.media.fmts=i.videoCodecs.map(B=>B.payloadType.toString(10)),F.attributes.payloads=i.videoCodecs,F.attributes.extmaps=i.videoExtensions;if(F.media.mediaType==="audio")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var S;F.media.fmts=m.map(j=>j.payloadType.toString(10)),F.attributes.payloads=m,F.attributes.extmaps=b;const B=F.attributes.mid;typeof B!="string"||et(S=this.useLocalCodecsMids).call(S,B)||this.useLocalCodecsMids.push(B)}else if(i.audioCodecs.length===0){const B=l.audioCodecs.filter(j=>{var K,X;return(K=j.rtpMap)===null||K===void 0?void 0:et(X=K.encodingName.toLowerCase()).call(X,"opus")})||[l.audioCodecs[0]];F.media.fmts=B.map(j=>j.payloadType.toString(10)),F.attributes.payloads=B,F.attributes.extmaps=[]}else F.media.fmts=i.audioCodecs.map(B=>B.payloadType.toString(10)),F.attributes.payloads=i.audioCodecs,F.attributes.extmaps=i.audioExtensions,Bf(F)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){const t=this._originCandidates.filter(r=>r.transport==="udp"),s=[];if(t.forEach(r=>{s.push(qN(qN({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case oi.TCP_RELAY:this._candidates=s;break;case oi.UDP_TCP_RELAY:case oi.RELAY:this._candidates=[...t,...s];break;default:this._candidates=t}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Dr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const r=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(kr()){if(r){const i=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(i||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!i||i!==s.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const s of this.sessionDesc.mediaDescriptions)if(s.media.mediaType==="application")return{mediaDesc:s,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:$w,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,s,r,i,l){const A=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,m=eb(A,u,this.localCapabilities.send,A===Nt.VIDEO?r:i),f=A===Nt.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let w={media:{mediaType:A,port:$w,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};w=this.mungRecvMediaDsec(w,e,l);const _=this.findFirstClosedMedia(A);if(_){const S=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[S]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(i=>i.fingerprint)),s=new Set(e.map(i=>i.fingerprint));let r=!1;t.size!==s.size&&(r=!0);for(const i of t)s.has(i)||(r=!0);return r}updateRemoteCodec(e,t,s){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").filter(w=>{var _;return et(_=Object.keys(dp)).call(_,w)}))],i=new Set(t);if(r.every(w=>i.has(w)))return N.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(w=>t.some(_=>{var S;return et(S=w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||"").call(S,_)}));if(l.length===0)return N.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const A=[...new Set(l.map(w=>w.rtpMap&&w.rtpMap.encodingName.toLowerCase()||""))];let u;if(N.debug("updateRemoteCodec, from ".concat(r," to ").concat(A)),e.length===0)u=this.sessionDesc.mediaDescriptions.filter(w=>w.media.mediaType==="video"&&w.attributes.direction==="recvonly");else if(u=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&w.media.mediaType==="video"&&et(e).call(e,w.attributes.mid)&&w.attributes.direction==="recvonly"),u.length!==e.length)return N.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const w=Du(l,this.rtpCapabilities.recv.videoCodecs);l.push(...w)}this._rtpCapabilities.recv.videoCodecs=l;const m=this.localCapabilities.send,f=this.rtpCapabilities.recv,b=eb(Nt.VIDEO,f,m,s);return u.forEach(w=>{const _=b.map(S=>S.payloadType.toString(10));N.debug("updateRemoteCodec mid: ".concat(w.attributes.mid,", from"),w.attributes.payloads,"to",b),w.attributes.payloads=b,w.media.fmts=_}),N.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,s,r,i){const l=this.rtpCapabilities.send.videoCodecs,A=this._isUseLocalCodecs||l.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,u=e===Nt.VIDEO?A.videoCodecs:A.audioCodecs,m=e===Nt.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let b={media:{mediaType:e,port:$w,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};b=this.mungSendMediaDesc(b,i);const w=this.findFirstClosedMedia(e);if(w){const _=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[_]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,s){const r=Dr(e);return DN(r),wp(r,t),BN(r,t),a4(r),Kw(r,s,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const s=Dr(e);return s.attributes&&s.attributes.payloads&&Array.isArray(s.attributes.payloads)&&s.attributes.payloads.length>0&&s.attributes.payloads.forEach(r=>{r.rtpMap&&r.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G("ENABLE_DOWN_SPS_PPS")&&(r.fmtp&&r.fmtp.parameters||(r.fmtp={parameters:{}}),r.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),Kw(s,t,this.localCapabilities.recv),Bf(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(s!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>kr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function D4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function IA(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?D4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):D4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}var Pf=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Pf||{});const e_=new Map;function B4(e,t,s,r){let{scale:i}=e;if(i===0&&r===Pf.UP||i>=t.length-1&&r===Pf.DOWN)return e;let l=IA(IA({},e),{},{scale:r===Pf.DOWN?++i:--i});switch(s){case"maintain-framerate":l=IA(IA({},l),t[i].motion);break;case"maintain-resolution":l=IA(IA({},l),t[i].detail);break;case"balanced":l=IA(IA({},l),t[i].balanced)}return l}function L4(e,t){if(t){const s={overUse:0,underUse:0,adaptationList:j4(t)};e_.set(e,s)}else e_.delete(e)}function j4(e){const t=IA({},e),{bitrateMax:s,frameRate:r,scaleResolutionDownBy:i,bitrateMin:l}=t,{MIN_FRAME_RATE:A,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:F,BALANCE_BITRATE_FACTOR:B,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:X,MOTION_BITRATE_FACTOR:oe,DETAIL_FRAMERATE_FACTOR:xe,DETAIL_BITRATE_FACTOR:Ee}=Q1,me=Math.min(t.frameRate,u),Re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(S,1)*me),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:s,bitrateMin:l}}];for(let He=1;He<=m;He++){const Xe={bwe_up:Math.round(Math.pow(w,He)*s),bwe_down:Math.round(Math.pow(_,He+1)*s),fps_up:Math.round(Math.pow(F,He)*me),fps_down:Math.round(Math.pow(S,He+1)*me)},_t={scaleResolutionDownBy:i/Math.pow(K,He),frameRate:Math.max(Math.round(Math.pow(j,He)*r),A),bitrateMax:Math.max(Math.round(Math.pow(B,He)*s),b),bitrateMin:Math.max(Math.round(Math.pow(B,He)*l),f)},ns={scaleResolutionDownBy:i/Math.pow(X,He),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(oe,He)*s),b),bitrateMin:Math.max(Math.round(Math.pow(oe,He)*l),f)},es={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(xe,He)*r),A),bitrateMax:Math.max(Math.round(Math.pow(Ee,He)*s),b),bitrateMin:Math.max(Math.round(Math.pow(Ee,He)*l),f)};Re.push({scale:He,threshold:Xe,balanced:_t,motion:ns,detail:es})}return Re}function Zee(e,t,s,r,i,l){const A=e_.get(e)||{overUse:0,underUse:0,adaptationList:j4(i)},{adaptationList:u}=A;e_.set(e,A);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:f}=Q1,{scale:b}=r;let w,_;return typeof t=="number"&&t>0&&function(S,F,B,j){if(F>=B.length)return!1;let{threshold:{fps_down:K}}=B[F];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=B[0].threshold.fps_down),S<K}(t,b,u,l)&&(A.overUse++,_=mf.CPU,A.overUse>m)||typeof s=="number"&&s>0&&function(S,F,B){if(F>=B.length)return!1;const{threshold:{bwe_down:j}}=B[F];return S<j}(s,b,u)&&(A.overUse++,_=mf.BANDWIDTH,A.overUse>m)?(A.overUse=0,A.underUse=0,w=B4(r,u,l,Pf.DOWN),[w,_]):(typeof t=="number"&&t>0&&typeof s=="number"&&s>0&&function(S,F,B,j){if(F===0)return;let{threshold:{fps_up:K}}=B[F];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=B[1].threshold.fps_up),S>K}(t,b,u,l)&&function(S,F,B){if(F===0)return;const{threshold:{bwe_up:j}}=B[F];return S>j}(s,b,u)&&(A.underUse++,A.underUse>f&&(A.overUse=0,A.underUse=0,w=B4(r,u,l,Pf.UP),w.scale===0&&(_=mf.NONE))),[w,_])}function P4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function XN(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?P4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):P4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function U4(e){var t;return!!G("ENABLE_AG_ADAPTATION")&&!!(e instanceof Ew||et(t=e._hints).call(t,or.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(CL(14,0,!1)&&SL(17,4,!0)||EL(14)&&_1(17,4,!0)))}const t_=new Map;function F4(e,t,s,r,i,l){if(Uf(e,s),i(t),r!=="balanced"&&r!=="maintain-framerate"&&r!=="maintain-resolution")return;let A=-1;L4(e,t);const u=window.setInterval(()=>{const f=t_.get(e);if(!G("ENABLE_AG_ADAPTATION")||!f)return Uf(e,s),void i(t);const b=l();if(b.sendPackets>0&&b.OutgoingAvailableBandwidth>0){if(A===-1)return void(A=Date.now());if(Date.now()-A<1e3)return;const w=b.sendFrameRate,_=b.OutgoingAvailableBandwidth,[S,F]=Zee(e,w,_,f.adaptationConfig,t,r);F&&(s.qualityLimitationReason=F),S&&f.adaptationConfig.scale!==S.scale&&(N.debug("[".concat(e,"] applyAdaptation: ").concat(s.qualityLimitationReason,`
           sendFps `).concat(w,", bwe ").concat(_,", switch from ").concat(f.adaptationConfig.scale," to ").concat(S.scale," ")),f.adaptationConfig=XN(XN({},f.adaptationConfig),S),i(S))}},G("CHECK_LOCAL_STATS_INTERVAL")),m=XN({},t);t_.set(e,{timer:u,adaptationConfig:m,originConfig:t,adaptationFunc:i}),N.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}function Uf(e,t){const s=t_.get(e);if(s){const{timer:r}=s;window.clearTimeout(r),t_.delete(e)}t.qualityLimitationReason=mf.NONE,L4(e)}function ete(e,t){var s;let r;switch(t){case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoTrack:r=et(s=e._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:r=ur.Low}return r}function JN(e){const t=Ls();if(e.some(s=>s._bypassWebAudio))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function $N(e,t){JN(e);const s=new Ln;return e.forEach(r=>s.addAudioTrack(r)),s}const tte=!Ls().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd();function nb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return s={spec:t,store:e},Vl("DataChannelConnection").create(s);var s;return tte?function(i){return Vl("PlanBConnection").create(i)}({spec:t,store:e}):new qo(t,e)}function ZN(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function e2(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(rp(e.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var qs;function M4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Hl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?M4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):M4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let qo=(qs=class Mp extends Fw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return et(s=Object.keys(dp)).call(s,t)}))]}constructor(t,s){super(t,s),U(this,"id",dr(5,"connection-")),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"forceTurn",!1),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"transportEventReceiver",void 0),U(this,"statsFilter",void 0),U(this,"extension",{useXR:G("USE_XR")}),U(this,"localCapabilities",void 0),U(this,"remoteCodecs",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"isPreallocation",!1),U(this,"isPreRender",!1),U(this,"preMediaMap",new Map),U(this,"dataStreamChannelMap",new Map),U(this,"establishPromise",void 0),U(this,"recoveredDataChannelIds",[]),U(this,"currentDataChannelId",1),U(this,"supportAV1RtpSpec",!1),U(this,"mutex",void 0),U(this,"qualityLimitationReason",mf.NONE),U(this,"isFirstConnected",!1),this.store=s,this.forceTurn=e2(t),this.mutex=new ai("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Mp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=hw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void N.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else N.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=kd(s.sdp),i=await jN({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Z0(i),this.initialOffer=s,G("ENABLE_SVC")&&this.store.codec=="av1"){const A=await o4();var t;A&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(A))}let l;return s.sdp&&Ww(s.sdp)&&(l=Dr(i),ZU(l)),Hl(Hl({},r),{},{rtpCapabilities:l||i,offerSDP:s.sdp})}catch(s){throw new Fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Ww(this.initialOffer.sdp)&&e4(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new k4(Hl(Hl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&G0(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),r=PN(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),G0(this.store))if(t.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const A=G("PRE_SUB_NUM"),{mids:u,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(A);await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(u,m)}else{const{preSSRCs:A=[]}=t,u=A.map(f=>f.ssrcMsg[0].ssrcId);if(A.length===0)return;const{mids:m}=this.remoteSDP.batchSend(A.map(f=>Object.assign({},f)));await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(m,u)}}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}presetMedia(t,s){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&r===l.mid&&l.receiver.track){const A=l.receiver.track;let u;A.kind==="video"&&G("ENABLE_PRE_RENDER")&&(u=new yw({trackId:"track-".concat(A.kind,"-unknown-").concat(this.store.clientId,"_").concat(dr(5,""))},!0),u.updateVideoTrack(A),u.onFirstVideoFrameRender=()=>{var m;const f=this.preMediaMap.get(s[i]);f&&(f.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,s[i])},u.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,s[i])},u.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(s[i],{mid:r,track:A,player:u,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:r}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const A=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||A}const{preSSRCs:i=[]}=t,l=i.map(A=>A.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const A=[],u=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[f,{mid:b,player:w,track:_}]=m;return A.push(b),u.push(f),this.preMediaMap.delete(f),w&&w.destroy(),!0}),A.length>0&&(this.remoteSDP.stopSending(A),await $a(this.peerConnection,this.remoteSDP,this.extension),N.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),Ot.reportApiInvoke(this.store.sessionId,{name:Pr.PRELOAD_MEDIA_FAILED,options:[i,u],tag:yr.TRACER}).onSuccess()),i.length>0){const{mids:m}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}s?(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):N.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return ka(function*(){const l=yield _s(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[],u=X0();t.forEach(j=>{const K=i.peerConnection.addTransceiver(j._mediaStreamTrack,Hl({direction:"sendonly"},j.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));A.push(K),j._updateRtpTransceiver(K)}),kr()&&G("SIMULCAST")===!0&&(yield _s(i.applySimulcastForFirefox(A,t)));const m=yield _s(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),b=i.mungSendOfferSDP(m.sdp,t,f),w=ba(b),_=f.map(j=>{const K=w.mediaDescriptions.find(X=>X.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return kN(K,G("USE_PUB_RTX"))});let S;try{S=yield _}catch(j){S=[],i.remoteSDP.receive(t,s,r,S);const K=i.remoteSDP.toString();throw yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield _s(i.stopSending(f,!0)),j}i.remoteSDP.receive(t,s,r,S);const F=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(i.applySimulcastEncodings(A,t)),yield _s(i.applySendEncodings(A,t)),B==null||B(F),yield _s(i.peerConnection.setRemoteDescription({type:"answer",sdp:F})),A.map((j,K)=>{const X=f[K];return{localSSRC:_[K],id:X,transceiver:j}})}catch(A){throw A instanceof Fe?A:new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{l()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")N.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}s.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),N.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else N.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Fe?r:new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof Fe?s:new Fe(W.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(m=>{var f;Uf(this.id+m.mid,this),m.direction="inactive",(f=m.stop)===null||f===void 0||f.call(m)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);A&&(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:l,transceiver:u}}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(i=>{const l=this.peerConnection.getTransceivers().find(A=>A.mid===i);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:i,transceiver:l}})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(A=>{let[u,{mid:m,player:f}]=A;if(m===l)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(A,u)=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return ka(function*(){const r=yield _s(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration,l=G("FORCE_TURN_TCP")||s.forceTurn;if(t===oi.RELAY&&!i)return;if(i&&!l){const w=t===oi.RELAY?"relay":"all",_=s.peerConnection.getConfiguration();_.iceTransportPolicy!==w&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(w,"]")),_.iceTransportPolicy=w,s.peerConnection.setConfiguration(_))}s.remoteSDP.updateCandidates(t);const A=yield _s(s.peerConnection.createOffer({iceRestart:!0}));if(!A.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=kd(A.sdp),{remoteIceParameters:m}=yield u.iceParameters;s.remoteSDP.restartICE(m);const f=s.remoteSDP.toString(),b=s.logSDPExchange(A.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield _s(s.peerConnection.setLocalDescription(A)),b==null||b(f),yield _s(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(oi.TCP_RELAY),await $a(this.peerConnection,this.remoteSDP,this.extension)}catch(s){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{Uf(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:r}=s;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Hl(Hl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Fe(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?kr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:Hl(Hl({},Xc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Hl(Hl({},Xc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",l=Od(t.url||"");N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(l||"",", host_candidate:").concat(i)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(rp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&s.iceServers&&r==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...Mp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...Mp.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Mp.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Mp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{const i=G("NEW_TURN_MODE");i===1?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":443?transport=tcp")}):i===4&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){const s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var i;s!=null&&s.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,s.state))},s.onerror=i=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in i?i.error:i)};const r=s.iceTransport;r&&(r.onstatechange=()=>{const i=s==null?void 0:s.iceTransport.state;var l;i&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:l}=r.getSelectedCandidatePair()||{};if(i&&l){const A=i.address+":"+i.port,u=l.address+":"+l.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Od(A)),", remote ").concat(JSON.stringify(Od(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r,i;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},A={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const u=JU(this.peerConnection,t._mediaStreamTrack),m=Mj(t);if(U4(t)&&u&&s&&m&&this.getLocalVideoStats&&et(r=["vp8","vp9"]).call(r,this.store.codec)){var f;const B=l.degradationPreference||(et(f=t._hints).call(f,or.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");F4(this.id+u.mid,m,this,B,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var b;const{bitrateMax:B,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;B&&(A.maxBitrate=1e3*B),(et(b=t._hints).call(b,or.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(A.maxFramerate=Pa(j)),K&&K>=1&&(A.scaleResolutionDownBy=K))}const{maxFramerate:w}=G("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(A.maxFramerate=A.maxFramerate?Math.min(A.maxFramerate,w):w),G("DSCP_TYPE")&&Sd()){var _;const B=G("DSCP_TYPE");et(_=["very-low","low","medium","high"]).call(_,B)&&(A.networkPriority=B)}const S=s.getParameters(),F=(i=S.encodings)===null||i===void 0?void 0:i[0];kr()&&!F&&(l.encodings=[A]),F&&Object.assign(F,A),Object.assign(S,l),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await s.setParameters(S),await d4(this.store.codec,s,G("SVC_MODE"))}async updateAdaptation(t,s){var r,i;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!Ls().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:A,frameRate:u,scaleResolutionDownBy:m}=s;A&&(l.maxBitrate=1e3*A),u&&(l.maxFramerate=Pa(u)),m&&m>=1&&et(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=m);const f=t.getParameters(),b=(i=f.encodings)===null||i===void 0?void 0:i[0];b&&Object.assign(b,l),Object.assign(f,{});try{await t.setParameters(f),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof Er&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const i=ba(t);return s.forEach((l,A)=>{const u=r[A],m=i.mediaDescriptions.find(f=>f.attributes.mid===u);m&&(wp(m,l),LN(m,l,this.store.codec))}),SA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let m=0;m<t.length;m++){var r,i,l,A,u;const f=t[m],b=s[m];if(b instanceof Er&&!et(r=b._hints).call(r,or.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const S=f.sender.getParameters();await f.sender.setParameters(Object.assign(S,w))}}}async applySimulcastEncodings(t,s){if(!kr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof Er&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof Er&&G("SIMULCAST")&&this.store.codec==="vp8"&&!et(s=t._hints).call(s,or.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during P2PConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=Mp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},ft(qs.prototype,"updateRemoteRTPCapabilities",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"updateRemoteRTPCapabilities"),qs.prototype),ft(qs.prototype,"connect",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"connect"),qs.prototype),ft(qs.prototype,"updateRemoteConnect",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"updateRemoteConnect"),qs.prototype),ft(qs.prototype,"createDataChannels",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"createDataChannels"),qs.prototype),ft(qs.prototype,"receive",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"receive"),qs.prototype),ft(qs.prototype,"batchReceive",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"batchReceive"),qs.prototype),ft(qs.prototype,"stopReceiving",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"stopReceiving"),qs.prototype),ft(qs.prototype,"muteRemote",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"muteRemote"),qs.prototype),ft(qs.prototype,"unmuteRemote",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"unmuteRemote"),qs.prototype),ft(qs.prototype,"muteLocal",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"muteLocal"),qs.prototype),ft(qs.prototype,"unmuteLocal",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"unmuteLocal"),qs.prototype),ft(qs.prototype,"close",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"close"),qs.prototype),ft(qs.prototype,"updateEncoderConfig",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"updateEncoderConfig"),qs.prototype),ft(qs.prototype,"updateSendParameters",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"updateSendParameters"),qs.prototype),ft(qs.prototype,"replaceTrack",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"replaceTrack"),qs.prototype),ft(qs.prototype,"updateAdaptation",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"updateAdaptation"),qs.prototype),ft(qs.prototype,"getRemoteSSRC",[Ua],Object.getOwnPropertyDescriptor(qs.prototype,"getRemoteSSRC"),qs.prototype),qs);function Ua(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}function t2(e,t){let s=document.createElement("video"),r=document.createElement("canvas");s.setAttribute("style","display:none"),r.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),r.width=Pa(t.width),r.height=Pa(t.height);const i=Pa(t.framerate||15);document.body.append(s),document.body.append(r);let l=e._mediaStreamTrack;s.srcObject=new MediaStream([l]),s.play().catch(M0);const A=r.getContext("2d");if(!A)throw new Le(W.UNEXPECTED_ERROR,"can not get canvas context");const u=Ls(),m=r.captureStream(u.supportRequestFrame?0:i).getVideoTracks()[0];m.canvas||(m.canvas=r),r.startCapture=()=>{if(!s)return r.stopCapture&&r.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,w=s.videoHeight/b,_=r.width*w;Math.abs(_-r.height)>=2&&(N.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(_)),r.height=_)}A.drawImage(s,0,0,r.width,r.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,s.srcObject=new MediaStream([l]))},r.stopCapture=tN(()=>r.startCapture&&r.startCapture(),i);const f=m.stop;return m.stop=()=>{f.call(m),s&&(s.remove(),s.srcObject=null,s=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),N.debug("clean low stream renderer")},m}var V4=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(V4||{}),Gl=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(Gl||{}),hs=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(hs||{}),$n=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}($n||{}),vi=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(vi||{}),Ff=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(Ff||{}),s2=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(s2||{});const yp=1e3,s_=6,ib=3,ste=Math.max(s_,ib,60);function Zt(e,t,s){s!=null&&Number.isFinite(s)&&(e[t]=Math.round(Math.max(0,s)))}function Q4(e){const t={[vi.CONN_TYPE]:0,[vi.RTT]:e.rtt,[vi.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(t[vi.CONN_TYPE]=1),s==="tcp"&&(t[vi.CONN_TYPE]=3),s==="tls"&&(t[vi.CONN_TYPE]=4);break}case"srflx":t[vi.CONN_TYPE]=2;break;case"unknown":t[vi.CONN_TYPE]=5;break;default:t[vi.CONN_TYPE]=0}return t}function H4(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class G4 extends Vr{constructor(t){super(),U(this,"store",void 0),U(this,"uploadWRTCStatsTimer",void 0),U(this,"uploadOutboundDenoiserStatsTimer",void 0),U(this,"uploadExtStatsTimer",void 0),U(this,"uploadExtUsageStatsTimer",void 0),U(this,"uploadInboundExtStatsTimer",void 0),U(this,"requestStats",void 0),U(this,"requestTransportStats",void 0),U(this,"requestLocalMedia",void 0),U(this,"requestRemoteMedia",void 0),U(this,"requestAllTracks",void 0),U(this,"requestVideoIsReady",void 0),U(this,"requestUploadStats",void 0),U(this,"requestUpload",void 0),U(this,"uploadOutboundStarted",!1),U(this,"uploadInboundStarted",!1),U(this,"uploadTransportStarted",!1),U(this,"uploadBaseStatsStarted",!1),U(this,"uploadExtensionUsageStarted",!1),U(this,"lastRecvStats",void 0),U(this,"lastSendStats",void 0),U(this,"lastRefRecvStats",void 0),U(this,"lastRefSendStats",void 0),U(this,"lastNormalRecvStats",void 0),U(this,"lastNormalSendStats",void 0),U(this,"lastExtendStats",{}),U(this,"needUploadStats",{}),U(this,"needUploadRenderFreezeTime",!0),U(this,"lastUploadCompensateTime",-1),U(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const s=t%ib==0,r=t%s_==0,i=t%60==0;let l,A;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(A=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!A&&this.uploadInboundStarted&&(A=this.requestStats(!0)),l||A){var u;const m={};if(this.uploadTransportStarted&&l){const b=this.getTransportStats(l,s?this.lastRefSendStats:void 0,A,s);b&&(m.misc=[b])}if(this.uploadOutboundStarted&&l){const b=this.getOutboundStats(l,r?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,i);b&&(m.outbound=[b])}if(this.uploadInboundStarted&&A){this.uploadCompensateStats(t);const b=this.getInboundStats(A,r?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);b&&(m.inbound=b)}const f=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;if(f&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ff.RTC_PEER_CONNECTION_STATE]=F1[f]):m.misc=[{addition:{[Ff.RTC_PEER_CONNECTION_STATE]:F1[f]}}]),Co.needUploadStats.length>0||r){const b=Co.needUploadStats.shift()||(Co.visibility==="visible"?1:0);Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ff.PAGE_VISIBILITY]=b):m.misc=[{addition:{[Ff.PAGE_VISIBILITY]:b}}]}this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[V4.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=A,this.lastSendStats=l,r&&(this.lastNormalRecvStats=A,this.lastNormalSendStats=l),s&&(this.lastRefRecvStats=A,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Co.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,r;const i=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(i&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[Ff.RTC_PEER_CONNECTION_STATE]:F1[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===ste+1&&(t=1)},yp)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=t%ib==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const r=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=r,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;const l=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const A={};if(this.uploadInboundStarted&&l){const u=this.requestRemoteMedia()||[],m=[];u.forEach(f=>{let[b,w]=f;const _={peer:b.uid};if(b._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(b._videoSSRC)&&w.has(Nt.VIDEO)&&b.videoTrack){const S=function(F,B,j){if(!B.videoRecv.find(X=>X.ssrc===F))return;const K={};if(j&&j._player){const X=j._player,{renderFreezeAccTime2:oe,videoElementStatus:xe}=X;if(Co.visibility==="visible"&&xe===Mi.PLAYING&&Ls().supportRequestVideoFrameCallback){const Ee=Math.min(6e3,oe);X.renderFreezeAccTime2=Math.max(0,oe-Ee),Zt(K,Gl.Video_Render_Freeze_Time_Render2,Ee),G("USE_NEW_RENDER_FREEZE_TIME")&&Zt(K,Gl.Video_Render_Freeze_Time_Render,Ee)}}return K}(b._videoSSRC,l,b.videoTrack);S&&(_.video=S)}_.video&&m.push(_)}),m.length>0&&(A.inbound=m,this.requestUploadStats(A))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,s,r,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[vi.RTT]:t.rtt,[vi.CONN_TYPE]:void 0,[vi.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const l=Q4(t);if(this.store.useP2P){if(r){const A=Q4(r);l[vi.CONN_TYPE]&&A[vi.CONN_TYPE]&&(l[vi.CONN_TYPE]+=A[vi.CONN_TYPE]<<3)}l[vi.CONN_TYPE]?l[vi.CONN_TYPE]+=110:l[vi.CONN_TYPE]=110}else{l[vi.CONN_TYPE]?l[vi.CONN_TYPE]+=100:l[vi.CONN_TYPE]=100;const A=function(u,m){return m?[Math.ceil(8*(u.transport.bytesSent-m.transport.bytesSent)/(u.timestamp-m.timestamp)),Math.ceil(8*(u.transport.bytesReceived-m.transport.bytesReceived)/(u.timestamp-m.timestamp))]:[0,0]}(t,s);l[s2.Transport_Send_Bitrate]=A[0],l[s2.Transport_Recv_Bitrate]=A[1]}return{addition:l}}getOutboundStats(t,s,r,i,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const A=this.requestLocalMedia();if(!A||A.length===0)return;let u,m,f;return A.forEach(b=>{let[w,{track:_,ssrcs:S}]=b;switch(w){case rt.LocalVideoLowTrack:case rt.LocalVideoTrack:if(w===rt.LocalVideoTrack){var F;const B=function(oe,xe,Ee,me,Re,He){const Xe=xe.videoSend.find(vs=>vs.ssrc===oe);if(!Xe)return;const _t={},{sentFrame:ns,inputFrame:es}=Xe;if(me&&(Zt(_t,Gl.Video_Send_Qp_Sum,Xe.qpSumPerFrame),es&&ns)){const vs=es.frameRate,ps=ns.frameRate;_t[Gl.Video_Send_Freeze]=function(tr,Fr){let We=!0;return We=!(tr<=5)&&(tr<=10?Fr<3:tr<=20?Fr<4:Fr<5),We}(vs,ps)?1:0}if(Re){switch(ns&&(Zt(_t,hs.Video_Send_Height,ns.height),Zt(_t,hs.Video_Send_Width,ns.width),Zt(_t,hs.Video_Send_Frame_Rate,ns.frameRate)),_t[hs.Video_Send_Disabled]=Ee._originMediaStreamTrack&&!Ee._originMediaStreamTrack.enabled||Ee._mediaStreamTrack&&!Ee._mediaStreamTrack.enabled?1:0,Xe.adaptionChangeReason){case"none":_t[hs.Video_Send_Adaptation]=0;break;case"cpu":_t[hs.Video_Send_Adaptation]=1;break;case"bandwidth":_t[hs.Video_Send_Adaptation]=2;break;case"other":_t[hs.Video_Send_Adaptation]=3}let vs=0;Xe.adaptionChangeReason&&(vs+=H4(Xe.adaptionChangeReason)),xe.qualityLimitationReason&&(vs+=H4(xe.qualityLimitationReason)<<3),_t[hs.Video_Send_Adaptation]=vs,_t[hs.Video_Send_Player_Status]=$1[Ee._player?Ee._player.videoElementStatus:"uninit"],Zt(_t,hs.Video_Send_Nacks,Xe.nacksCount),Zt(_t,hs.Video_Send_Plis,Xe.plisCount),Zt(_t,hs.Video_Send_Firs,Xe.firsCount),Zt(_t,hs.Video_Send_Avg_Encode,Xe.avgEncodeMs),Zt(_t,hs.Video_Send_Huge_Frame_Sent,Xe.hugeFramesSent),Zt(_t,hs.Video_Send_Bytes_Retransmit,Xe.retransmittedBytesSent),Zt(_t,hs.Video_Send_Packages_Retransmit,Xe.retransmittedPacketsSent),Zt(_t,hs.Video_Send_Key_Frames_Encoded,Xe.keyFramesEncoded);const ps=Re.videoSend.find(tr=>tr.ssrc===oe);if(ps){let tr=yp*ib;ps.timestamp&&Xe.timestamp&&(tr=Xe.timestamp-ps.timestamp),ps.packets!=null&&Xe.packets!=null&&Zt(_t,hs.Video_Send_Package_Rate,1e3*(Xe.packets-ps.packets)/tr),Xe.packetsLost!=null&&ps.packetsLost!=null&&Zt(_t,hs.Video_Send_Package_Lost,Xe.packetsLost-ps.packetsLost),ps.bytes!=null&&Xe.bytes!=null&&Zt(_t,hs.Video_Send_Bitrate,8*(Xe.bytes-ps.bytes)/tr)}}return _t}(S[0].ssrcId,t,_,s,r),j=_.__className__==="CameraVideoTrack"?3:et(F=_._hints).call(F,or.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||l)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);const K=_&&function(oe,xe,Ee,me){const Re=xe.videoSend.find(Xe=>Xe.ssrc===oe);if(!Re)return null;const He={};if(me){const Xe=Re.inputFrame,_t=Xe&&Xe.height||Ee.videoHeight||0,ns=Xe&&Xe.width||Ee.videoWidth||0,es=Xe&&Xe.frameRate||0;Zt(He,hs.Video_Capture_Height,_t),Zt(He,hs.Video_Capture_Width,ns),Zt(He,hs.Video_Capture_Frame_Rate,es)}return He}(S[0].ssrcId,t,_,!!r),X=function(oe,xe){const Ee={};return xe&&(Zt(Ee,hs.Video_Send_Retransmit,oe.bitrate.retransmit),Zt(Ee,hs.Video_Send_Target_Encoded,oe.bitrate.targetEncoded),Zt(Ee,hs.Video_Send_Actual_Encoded,oe.bitrate.actualEncoded),Zt(Ee,hs.Video_Send_Transmit,oe.bitrate.transmit),Zt(Ee,hs.Video_Send_Bandwidth,oe.sendBandwidth)),Ee}(t,!!r);m=Object.assign({},B,K,X)}else f=function(B,j,K,X,oe){const xe=j.videoSend.find(me=>me.ssrc===B);if(!xe)return;const Ee={};if(X){const me=xe.sentFrame;me&&(Zt(Ee,hs.Video_Send_Low_Height,me.height),Zt(Ee,hs.Video_Send_Low_Width,me.width),Zt(Ee,hs.Video_Send_Low_Frame_Rate,me.frameRate));const Re=X.videoSend.find(He=>He.ssrc===B);if(Re){let He=yp*s_;Re.timestamp&&xe.timestamp&&(He=xe.timestamp-Re.timestamp),Re.packets!=null&&xe.packets!=null&&Zt(Ee,hs.Video_Send_Low_Package_Rate,1e3*(xe.packets-Re.packets)/He),xe.packetsLost!=null&&Re.packetsLost!=null&&Zt(Ee,hs.Video_Send_Low_Package_Lost,xe.packetsLost-Re.packetsLost),Re.bytes!=null&&xe.bytes!=null&&Zt(Ee,hs.Video_Send_Low_Bitrate,8*(xe.bytes-Re.bytes)/He)}}return Ee}(S[0].ssrcId,t,0,r);break;case rt.LocalAudioTrack:u=_&&function(B,j,K,X,oe,xe){const Ee=j.audioSend.find(Re=>Re.ssrc===B);if(!Ee)return;const me={};if(oe){me[hs.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;const Re=100*K._source.getAccurateVolumeLevel(),He=Ee.inputLevel;if(He!=null){const _t=Math.ceil(50*Math.log10(100*He+1));Zt(me,hs.Audio_Send_Level,_t)}Zt(me,hs.Audio_Capture_PCM_Level,Re),Zt(me,hs.Audio_Send_AEC_Return_Loss,Ee.aecReturnLoss),Zt(me,hs.Audio_Send_AEC_Return_Loss_Enhancement,Ee.aecReturnLossEnhancement),Zt(me,hs.Audio_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),Zt(me,hs.Audio_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),me[hs.Audio_Send_Freeze]=0;const Xe=oe.audioSend.find(_t=>_t.ssrc===B);if(Xe){let _t=yp*s_;Xe.timestamp&&Ee.timestamp&&(_t=Ee.timestamp-Xe.timestamp),Xe.bytes!=null&&Ee.bytes!=null&&Zt(me,hs.Audio_Send_Bitrate,8*(Ee.bytes-Xe.bytes)/_t),Xe.packets!=null&&Ee.packets!=null&&Zt(me,hs.Audio_Send_Package_Rate,1e3*(Ee.packets-Xe.packets)/_t)}}return me}(S[0].ssrcId,t,_,0,r)}}),{high:m,low:f,audio:u}}getInboundStats(t,s,r,i){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],A=[];return l.forEach(u=>{let[m,f]=u;const b={peer:m.uid};let w;if(f.has(Nt.VIDEO)&&m.videoTrack){const _=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,S=m.videoTrack?function(F,B,j,K,X,oe,xe,Ee){const me=B.videoRecv.find(ps=>ps.ssrc===F);if(!me)return;const Re={},{receivedFrame:He,outputFrame:Xe,decodeFrameRate:_t}=me;Zt(Re,$n.Video_Render_Frame_Rate_Decode,_t),me.framesRateFirefox&&Zt(Re,$n.Video_Recv_Frame_Rate,me.framesRateFirefox),He&&Zt(Re,$n.Video_Recv_Frame_Rate,He.frameRate),Zt(Re,$n.Video_Recv_Frame_Dropped,me.framesDroppedCount),Zt(Re,$n.Video_Recv_Bytes_Retransmit,me.retransmittedBytesReceived),Zt(Re,$n.Video_Recv_Packages_Retransmit,me.retransmittedPacketsReceived),Zt(Re,$n.Video_Recv_Packages_Discarded,me.packetsDiscarded),Zt(Re,$n.Video_Recv_Avg_Decode,me.avgDecodeMs),Zt(Re,$n.Video_Recv_Avg_Processing_Delay,me.avgProcessingDelayMs),Zt(Re,$n.Video_Recv_Avg_Assembly_Time,me.avgFramesAssembledFromMultiplePacketsMs),Zt(Re,$n.Video_Recv_Avg_Inter_Frame_Delay,me.avgInterFrameDelayMs),Zt(Re,$n.Video_Recv_Key_Frames_Decoded,me.keyFramesDecoded);const ns=Ee&&Ee.videoRecv.find(ps=>ps.ssrc===F);if(ns){const ps=B.timestamp-Ee.timestamp||yp;me.packetsLost!=null&&ns.packetsLost!=null&&Zt(Re,$n.Video_Recv_Package_Lost,me.packetsLost-ns.packetsLost),ns.bytes!=null&&me.bytes!=null&&Zt(Re,$n.Video_Recv_Bitrate,8*(me.bytes-ns.bytes)/ps),ns.packets!=null&&me.packets!=null&&Zt(Re,$n.Video_Recv_Package_Rate,1e3*(me.packets-ns.packets)/ps)}const es=oe&&oe.videoRecv.find(ps=>ps.ssrc===F);if(es&&(Zt(Re,Gl.Video_Recv_Qp_Sum,me.qpSumPerFrame),Re[Gl.Video_Recv_Freeze]=K&&rb.isRemoteVideoFreeze(j,me,es)?1:0),xe){var vs;const ps=xe.videoRecv.find(Fr=>Fr.ssrc===F);He?(Zt(Re,hs.Video_Recv_Height,He.height),Zt(Re,hs.Video_Recv_Width,He.width)):j&&(Zt(Re,hs.Video_Recv_Height,j._videoHeight||0),Zt(Re,hs.Video_Recv_Width,j._videoWidth||0)),Xe&&Zt(Re,hs.Video_Recv_Frame_Rate_Output,Xe.frameRate);const tr=(vs=j._player)===null||vs===void 0?void 0:vs.rendFrameRate.toFixed(0);if(tr&&Zt(Re,hs.Video_Render_Frame_Rate_Render,+tr),Zt(Re,hs.Video_Recv_Jitter_Buffer,me.jitterBufferMs),Zt(Re,hs.Video_Recv_Current_Delay,me.currentDelayMs),Zt(Re,hs.Video_Recv_Firs,me.firsCount),Zt(Re,hs.Video_Recv_Nacks,me.nacksCount),Zt(Re,hs.Video_Recv_Plis,me.plisCount),j){Re[hs.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Fr=j._player;if(Fr){const{freezeTimeCounterList:We,renderFreezeAccTime:ct,renderFreezeAccTime2:Rt,videoElementStatus:Ye}=Fr;if(We&&We.length>0&&Zt(Re,Gl.Video_Render_Freeze_Time,We.splice(0,1)[0]),X&&Co.visibility==="visible"&&Ye===Mi.PLAYING&&Ls().supportRequestVideoFrameCallback){const D=Math.min(6e3,Rt);Fr.renderFreezeAccTime2=Math.max(0,Rt-D),Zt(Re,Gl.Video_Render_Freeze_Time_Render2,D);const ae=Math.min(6e3,ct);Fr.renderFreezeAccTime=Math.max(0,ct-ae),Zt(Re,Gl.Video_Render_Freeze_Time_Render,G("USE_NEW_RENDER_FREEZE_TIME")?D:ae)}if(typeof me.totalFreezesDuration=="number"){const D=ps&&ps.totalFreezesDuration?me.totalFreezesDuration-ps.totalFreezesDuration:me.totalFreezesDuration;Zt(Re,hs.Video_Render_Freeze_Duration,1e3*D)}}}if(Re[hs.Video_Recv_Player_Status]=$1[j._player?j._player.videoElementStatus:"uninit"],ps&&me.totalInterFrameDelay!==void 0&&me.totalSquaredInterFrameDelay!==void 0&&ps.totalInterFrameDelay!==void 0&&ps.totalSquaredInterFrameDelay!==void 0){const Fr=me.totalInterFrameDelay-ps.totalInterFrameDelay,We=me.totalSquaredInterFrameDelay-ps.totalSquaredInterFrameDelay,ct=me.framesDecodeCount-ps.framesDecodeCount,Rt=Fr/ct*1e3,Ye=Math.round(1e3*Math.sqrt((We-Math.pow(Fr,2)/ct)/ct));!isNaN(Ye)&&Rt+Ye>Math.max(3*Rt,Rt+150)&&(Re[hs.Video_Recv_I_Frame_Delay]=Ye)}}return Re}(m._videoSSRC,t,m.videoTrack,_===!0,this.needUploadRenderFreezeTime,s,r,i):void 0;if(S&&(b.video=S),m.videoTrack){const F=t.videoRecv.find(B=>B.ssrc===m._videoSSRC);F&&F.estimatedPlayoutTimestamp&&(w=F.estimatedPlayoutTimestamp)}}if(f.has(Nt.AUDIO)&&m.audioTrack){const _=m.audioTrack?function(S,F,B,j,K,X){const oe=F.audioRecv.find(Re=>Re.ssrc===S);if(!oe)return;const xe={};Zt(xe,$n.Audio_Recv_Jitter,oe.jitterMs),Zt(xe,$n.Audio_Recv_Bytes_Retransmit,oe.retransmittedBytesReceived),Zt(xe,$n.Audio_Recv_Packages_Retransmit,oe.retransmittedPacketsReceived),Zt(xe,$n.Audio_Recv_Packages_Discarded,oe.packetsDiscarded),Zt(xe,$n.Audio_Recv_Avg_Processing_Delay,oe.avgProcessingDelayMs);const Ee=X&&X.audioRecv.find(Re=>Re.ssrc===S);if(Ee){const Re=yp;oe.packets!=null&&Ee.packets!=null&&Zt(xe,$n.Audio_Recv_Package_Rate,1e3*(oe.packets-Ee.packets)/Re),oe.packetsLost!=null&&Ee.packetsLost!=null&&Zt(xe,$n.Audio_Recv_Package_Lost,oe.packetsLost-Ee.packetsLost)}if(j){const{receivedFrames:Re,droppedFrames:He}=oe;Re!=null&&He!=null&&(xe[Gl.Audio_Recv_Freeze]=(me=Re)===0||100*He/me>20?1:0)}var me;if(K){const Re=100*B._source.getAccurateVolumeLevel(),He=oe.outputLevel;if(He!=null){const _t=Math.ceil(50*Math.log10(100*He+1));Zt(xe,hs.Audio_Render_Level,_t)}Zt(xe,hs.Audio_Recv_PCM_Level,Re),B&&(xe[hs.Audio_Recv_Disabled]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1),Zt(xe,hs.Audio_Recv_Jitter_Buffer,oe.jitterBufferMs),Zt(xe,hs.Audio_Recv_Current_Delay,oe.jitterBufferMs),xe[hs.Audio_Recv_Player_Status]=$1[na.getPlayerState(B.getTrackId())];const Xe=K.audioRecv.find(_t=>_t.ssrc===S);if(Xe){Xe.bytes!=null&&oe.bytes!=null&&Zt(xe,hs.Audio_Recv_Bitrate,8*(oe.bytes-Xe.bytes)/(yp*ib));const _t=oe.concealedSamples-Xe.concealedSamples;_t>0&&Zt(xe,hs.Audio_Recv_Concealed_Samples,_t);const ns=oe.totalSamplesReceived-Xe.totalSamplesReceived;ns>0&&Zt(xe,hs.Audio_Recv_Total_Samples_Received,ns);const es=oe.freezeSamples80-Xe.freezeSamples80;es>0&&Zt(xe,hs.Audio_Render_Freeze_Samples_80ms,es);const vs=oe.freezeSamples200-Xe.freezeSamples200;vs>0&&Zt(xe,hs.Audio_Render_Freeze_Samples_200ms,vs);const ps=oe.freezeMs80-Xe.freezeMs80;Zt(xe,hs.Audio_Render_Freeze_Time_80ms,ps<0?0:ps);const tr=oe.freezeMs200-Xe.freezeMs200;Zt(xe,hs.Audio_Render_Freeze_Time_200ms,tr<0?0:tr)}}return xe}(m._audioSSRC,t,m.audioTrack,s,r,i):void 0;if(_&&(b.audio=_),m.audioTrack&&w){const S=t.audioRecv.find(F=>F.ssrc===m._audioSSRC);if(S&&S.estimatedPlayoutTimestamp){const F=S.estimatedPlayoutTimestamp-w;b.audio?b.audio[$n.Audio_Recv_AV_Sync_TIME]=F:b.audio={[$n.Audio_Recv_AV_Sync_TIME]:F}}}}(b.video||b.audio)&&A.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,A}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(s=>s instanceof W0);if(t&&t._external.getDenoiserStats){const s=t._external.getDenoiserStats();s&&this.requestUpload(xp.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[s,r]=t;r.has(Nt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Nt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),r={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let i=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const f of l)!f.muted&&f.enabled&&(i=i.concat(await f.getProcessorUsage()));const A=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[f,b]of A)b.has(Nt.VIDEO)&&f.videoTrack&&(i=i.concat(await f.videoTrack.getProcessorUsage())),b.has(Nt.AUDIO)&&f.audioTrack&&(i=i.concat(await f.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(f,b){const w={};for(const{id:B,value:j,level:K,direction:X}of f){var _;const oe=(_=b.get(B))!==null&&_!==void 0?_:0,xe=j===2?oe+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:oe;var S,F;b.set(B,xe),w[B]?(j===2&&(w[B].value=j),K>w[B].level&&(w[B].level=K),X==="remote"&&(w[B].remoteUidCount+=1),w[B].totalTs=(S=b.get(B))!==null&&S!==void 0?S:0):w[B]={value:j,level:K,remoteUidCount:X==="local"?0:1,totalTs:(F=b.get(B))!==null&&F!==void 0?F:0}}return Object.keys(w).map(B=>{const{level:j,value:K,totalTs:X}=w[B];return{id:B,level:j,value:K,totalTs:X}})}(i,t);const u=Date.now(),m=u>s?u:s+1;this.requestUpload&&this.requestUpload(xp.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:m})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Co.stopCollectStats()}}const rte=G("ICE_RESTART_INTERVAL");let r_=new Map,Mf=new Map,Lu=[oi.UDP_TCP_RELAY,oi.TCP_RELAY,oi.RELAY],r2=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ls().supportPCSetConfiguration;function K4(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=r_.get(e.id);s&&(window.clearTimeout(s),r_.delete(e.id));const r=Mf.get(e.id);t&&r&&r.index===Lu.length-1&&(N.debug("[".concat(e.id,"] reset ICE restart policy")),Mf.delete(e.id))}function W4(e,t,s){if(r_.size===0&&Mf.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!function(u,m){if(u.length!==m.length)return!1;for(let f=0;f<u.length;f+=1){const b=u[f];if(u.filter(w=>w===b).length!==m.filter(w=>w===b).length)return!1}return!0}(Lu,G("RESTART_SEQUENCE"))&&(Lu=G("RESTART_SEQUENCE").filter(u=>{var m;if(et(m=Object.values(oi)).call(m,u))return!0}),N.debug("use reconnection policy from config distribution, queues: ".concat(Lu.join(" => ")))),r2=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ls().supportPCSetConfiguration),Lu.length===0)return void s();let r,{index:i=0,type:l}=Mf.get(e.id)||{};if(r2&&l===oi.RELAY)return void s();let A=l&&i>=Lu.length-1;if(r2)l=oi.RELAY;else{if(A)return void s();l?(i++,l=Lu[i]):(l=Lu[0],i=0)}N.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(i)),t(l),Mf.set(e.id,{index:i,type:l}),r=window.setTimeout(()=>W4(e,t,s),rte),r_.set(e.id,r)}var Ps;function z4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Ld(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?z4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):z4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}function q4(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=Xv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new n_(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function n_(e){function t(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var r=s.done;return pt.resolve(s.value).then(function(i){return{value:i,done:r}})}return n_=function(s){this.s=s,this.n=s.next},n_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?pt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?pt.reject(s):t(r.apply(this.s,arguments))}},new n_(e)}let Ep=(Ps=class extends Vr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Vt.StateChange,t,this._state)}constructor(e,t){super(),U(this,"isPlanB",void 0),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"connection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"remoteDataChannelMap",new Map),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"pendingLocalDataChannels",[]),U(this,"pendingRemoteDataChannels",[]),U(this,"statsCollector",void 0),U(this,"shouldForwardP2PCreation",void 0),U(this,"iceFailedCount",0),U(this,"dtlsFailedCount",0),U(this,"mutex",void 0),U(this,"_state",ir.Disconnected),U(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?RA.FIRST_CONNECTION:RA.OLD_FIRST_CONNECTION),U(this,"_isStartRestartIce",!1),U(this,"_restartTimer",void 0),U(this,"_isTryConnecting",!1),U(this,"_iceError",null),U(this,"_forceTurn",!1),U(this,"_isWaitPcToRePub",!1),U(this,"handleMuteLocalTrack",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void i(new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const A=this.filterTobeMutedTracks(s);if(A.length===0)return void r();const u=A.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];this.store.enableInstantMuteRestore?(f.track._originMediaStreamTrack.enabled=!1,N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):f.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const m=this.createMuteMessage(A);await Sr(this,Vt.RequestMuteLocal,m),r()}catch(A){i(A)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void i(new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const A=this.filterTobeUnmutedTracks(s);if(A.length===0)return void r();const u=A.find(f=>f[0]==="videoLowTrack");if(u){const f=u[1];if(this.store.enableInstantMuteRestore)f.track._originMediaStreamTrack.enabled=!0,N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(f.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();f.track._mediaStreamTrack=b,f.track._originMediaStreamTrack=b}else{const b=t2(s,ip(this,Vt.RequestLowStreamParameter));f.track._mediaStreamTrack=b,f.track._originMediaStreamTrack=b}await new pt((b,w)=>{this.handleReplaceTrack(f.track,b,w,!0)})}}this.store.enableInstantMuteRestore?N.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const m=this.createUnmuteMessage(A);await Sr(this,Vt.RequestUnmuteLocal,m),r()}catch(A){i(A)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(s,r,i,l)=>{let A;l||(A=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(rt.LocalVideoTrack);if(!this.connection||!m||m.track!==s||this.state!==ir.Connected)return void r();const{id:f,track:b}=m;await this.connection.updateSendParameters(f,b),await this.connection.updateEncoderConfig(f,b),this.emit(Vt.UpdateVideoEncoder,b),r()}catch(m){i(m)}finally{var u;(u=A)===null||u===void 0||u()}}),U(this,"handleUpdateVideoSendParameters",async(s,r,i)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const A=this.localTrackMap.get(rt.LocalVideoTrack);if(!this.connection||!A||A.track!==s||this.state!==ir.Connected)return void r();const{id:u,track:m}=A;await this.connection.updateSendParameters(u,m),r()}catch(A){i(A)}finally{l()}}),U(this,"handleReplaceMixingTrack",async(s,r,i,l)=>{if(!this.connection||this.state!==ir.Connected)return void r();const A=$N([s]);let u;N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(A.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,A),r()}catch(f){i(f)}finally{var m;(m=u)===null||m===void 0||m()}}),U(this,"handleReplaceTrack",async(s,r,i,l)=>{let A;N.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof l=="boolean"&&l||(A=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:w}]=b;return s===w});if(!this.connection||!f||this.state!==ir.Connected)return void r();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(s,f[1].id)),this.isPlanB){const b=f[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(f[0],b)}if(f[0]===rt.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const b=this.localTrackMap.get(rt.LocalVideoLowTrack);if(b){const w=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=w,b.track._originMediaStreamTrack=w,await new pt((_,S)=>{this.handleReplaceTrack(b.track,_,S,!0)})}}r()}catch(f){i(f)}finally{var m;(m=A)===null||m===void 0||m()}}),U(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),U(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),U(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new G4(this.store),this.bindStatsUploaderEvents(),this.mutex=new ai("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ls().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Sd(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&Ls().supportPCSetConfiguration&&OL(),this.shouldForwardP2PCreation&&(this.connection=nb(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var s;this.state=ir.New,this._forceTurn=e2(e),N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=nb(this.store,e),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?RA.FIRST_CONNECTION:RA.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==ir.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected,t}if(this.connection instanceof qo&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Ot.reportApiInvoke(this.store.sessionId,{name:Pr.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:yr.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Vt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(i=>{var l;let[A]=i;return et(l=[rt.LocalVideoLowTrack,rt.LocalVideoTrack]).call(l,A)}),s=t.map(i=>{let[,{id:l}]=i;return l}),r=t.map(i=>{let[l]=i;return l});if(this.connection instanceof qo||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(Ot.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!et(e).call(e,this.store.codec)){const i=["vp9","vp8","h264"].find(l=>et(e).call(e,l));i&&(this.store.codec=i,N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof qo&&this.connection.peerConnectionState!=="closed"&&et(e=[ir.New,ir.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==ir.Connected){if(this.state===ir.Disconnected)throw new Fe(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var r;et(r=this.pendingLocalDataChannels).call(r,s)||this.pendingLocalDataChannels.push(s)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(s=>{const r=Date.now();this.store.publish(s.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(s=>{this.localDataChannels.push(s);const r=Date.now();this.store.publish(s.id+"","datachannel",void 0,r)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,t,s){var r=this;return ka(function*(){const i=yield _s(r.mutex.lock("From P2PChannel.publish"));try{var l;const A=r.connection&&et(l=["disconnected","failed"]).call(l,r.connection.peerConnectionState);if(!r.connection||r.state!==ir.Connected||A){if(r.state===ir.Disconnected)throw new Fe(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const m=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(m),void(A&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Qi.markPublishStart(r.store.clientId,r.store.pubId);const u=r.filterTobePublishedTracks(e,t,s);if(u.length===0)return void(yield _s(r.tryToUnmuteAudio(e)));yield*lf(q4(r.doPublish(r.connection,u)))}finally{i()}})()}doPublish(e,t){var s=this;return ka(function*(){t.forEach(_=>{let{track:S,type:F}=_;const B=Date.now();s.store.publish(S.getTrackId(),F===rt.LocalAudioTrack?"audio":"video",B)}),s.bindLocalTrackEvents(t);const r=t.map(_=>{let{track:S}=_;return S}),i=yield _s(e.send(r,s.store.codec,s.store.audioCodec)),l=(yield _s(i.next())).value,A=s.createGatewayPublishMessage(t,l);let u;try{u=yield A}catch(_){throw i.throw(_),(_==null?void 0:_.code)===W.WS_ABORT&&t.forEach(S=>{let{track:F}=S;s.pendingLocalTracks.indexOf(F)===-1&&s.pendingLocalTracks.push(F)}),s.unbindLocalTrackEvents(t),_}const m=s.mapPubResToRemoteConfig(A,u,r),f=(yield _s(i.next(m))).value;if(s.state===ir.Disconnected)throw new Fe(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const b=G("ENABLE_ENCODED_TRANSFORM"),w=G("ENABLE_AUDIO_METADATA");r.forEach(async _=>{const S=_.getRTCRtpTransceiver();if(!S||!b)return;const{interceptLocalVideoFrame:F,interceptLocalAudioFrame:B}=zw();_.trackMediaType===Nt.VIDEO?await F(S.sender,_):_.trackMediaType===Nt.AUDIO&&await B(S.sender,{metadata:w?()=>{const j=_.metadata.shift();return j&&j.value}:void 0})}),t.forEach(_=>{let{type:S}=_;s.statsCollector.addLocalStats(S)}),s.assignLocalTracks(t,f),s.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:S,type:F}=_;const B=Date.now();s.store.publish(S.getTrackId(),F===rt.LocalAudioTrack?"audio":"video",void 0,B)})})()}async updateVideoStreamParameter(e,t){const s=this.localTrackMap.get(t);if(!s||!this.connection)return;if(!(s.track instanceof Er))return N.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=s,i=function(l,A){const u={};return l.height&&l.width&&(u.scaleResolutionDownBy=ON(l,A)),u.maxFramerate=l.framerate?Pa(l.framerate):void 0,u.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,u}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==rt.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const l=r._originMediaStreamTrack;if(!l.canvas)return N.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(A,u){const m=A.canvas;u.width&&(m.width=Pa(u.width)),u.height&&(m.height=Pa(u.height)),u.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=tN(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Pa(u.framerate)))})(l,e)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),N.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return ka(function*(){if(!t.connection||t.state!==ir.Connected)return;const s=yield _s(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get(rt.LocalVideoTrack);if(!i)throw new Fe(W.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(rt.LocalVideoLowTrack))throw new Fe(W.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(i.track,e),type:rt.LocalVideoLowTrack}];if(yield*lf(q4(t.doPublish(t.connection,l))),i.track.muted||!i.track.enabled){var r;const A=(r=t.localTrackMap.get(rt.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;A!==void 0&&(yield _s(t.connection.muteLocal([A])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cn(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Cn(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:s,kind:r}=this.pendingRemoteTracks[t];(r!==Nt.AUDIO||s._audio_added_&&s._audioSSRC)&&(r!==Nt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Cn(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:s}of this.pendingRemoteTracks)await this.subscribe(t,s,s===Nt.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:s}=t;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ir.Connected)return void e.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const s=t.find(r=>r[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ir.Connected)return void e.forEach(s=>{const r=this.pendingLocalDataChannels.indexOf(s);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(s=>{const r=this.localDataChannels.indexOf(s);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ir.Connected)return;const e=this.localTrackMap.get(rt.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[rt.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const s=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[i,{track:l}]=r;return{type:i,track:l}})),t.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ir.Connected)throw new Fe(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=t.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(r.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(r=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const l=this.pendingRemoteDataChannels.findIndex(A=>{let{user:u,id:m}=A;return u.uid===e.uid&&m===r.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),s.map(r=>r.id)}async subscribe(e,t,s,r,i){var l;if(!this.connection||this.state!==ir.Connected)throw new Fe(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let A,u,m,f;const b=this.connection.getPreMedia(s);if(b)N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),m=b.transceiver,A=b.track,u=b.mid,f=b.player,b.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:b.firstVideoRender});else if(i){const S=i.find(B=>{let{stream_type:j}=B;return j===t});if(!S)throw new Fe(W.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const F=await this.connection.receive(t,S.ssrcs,String(e._uintid),S.attributes);(this.connection instanceof qo||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=F.transceiver),A=F.track,u=F.id}else{const S=await this.connection.receive(t,[{ssrcId:s,rtx:r}],String(e._uintid),void 0);(this.connection instanceof qo||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=S.transceiver),A=S.track,u=S.id}if(t===Nt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(A):(e._audioTrack=new Sf(A,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(A):(e._videoTrack=new Cf(A,e.uid,e._uintid,this.store,f),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(bc.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(bc.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),f?e._videoTrack.once(bc.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(bc.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:F}=zw();t==Nt.VIDEO?await S(m.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(B=>{var j;return(j=e._videoTrack)===null||j===void 0?void 0:j._onSei(B)}),onFirstFrame:B=>{var j;const K=Array.from(Ji(j=this.remoteUserMap).call(j)).find(X=>X._videoSSRC===B.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:B.type,rtpTimestamp:B.rtpTimestamp,framePayloadType:B.payloadType,frameDataLength:B.length,mimeType:B.mimeType})}}):t==Nt.AUDIO&&await F(m.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Vt.AudioMetadata,B)},onPts:B=>{this.safeEmit(Vt.AudioPts,B)}})}const w=this.remoteUserMap.get(e);w?w.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(S=>{let{user:F,kind:B}=S;return F.uid===e.uid&&t===B});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Vt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ir.Connected)throw new Fe(W.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var l;let{user:A,mediaType:u}=i;return!((l=this.remoteUserMap.get(A))!==null&&l!==void 0&&l.has(u))});const t=[],s=new Map;e.forEach(i=>{if(!this.connection)return;const l=this.connection.getPreMedia(i.ssrcId);if(l){const{track:A,mid:u,transceiver:m,player:f}=l;s.set(i.ssrcId,{track:A,id:u,transceiver:m,player:f})}else t.push(i)});const r=await this.connection.batchReceive(t.map(i=>{let{user:l,mediaType:A,ssrcId:u,rtxSsrcId:m}=i;return{kind:A,ssrcMsg:[{ssrcId:u,rtx:m}],mslabel:String(l._uintid)}}));t.forEach((i,l)=>{s.set(i.ssrcId,r[l])});for(const{user:i,mediaType:l,ssrcId:A}of e){const u=s.get(A);if(!u)return void N.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(l,", ").concat(A));const{track:m,id:f,transceiver:b,player:w}=u;if(b&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:B}=zw();l==Nt.VIDEO?await F(b.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(j=>{var K;return(K=i._videoTrack)===null||K===void 0?void 0:K._onSei(j)}),onFirstFrame:j=>{var K;const X=Array.from(Ji(K=this.remoteUserMap).call(K)).find(oe=>oe._videoSSRC===j.ssrc);X&&this.store.firstVideoFrameDecoded(X.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):l==Nt.AUDIO&&await B(b.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Vt.AudioMetadata,j)},onPts:j=>{this.safeEmit(Vt.AudioPts,j)}})}if(l===Nt.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(m):(i._audioTrack=new Sf(m,i.uid,i._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),b&&i._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(m):(i._videoTrack=new Cf(m,i.uid,i._uintid,this.store,w),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),b&&i._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(i,i._videoTrack)),G("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:B}=zw();l==Nt.VIDEO?await F(b.receiver,{onSei:j=>{var K;(K=i._videoTrack)===null||K===void 0||K._onSei(j)},onFirstFrame:j=>{var K;const X=Array.from(Ji(K=this.remoteUserMap).call(K)).find(oe=>oe._videoSSRC===j.ssrc);X&&this.store.firstVideoFrameDecoded(X.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):l==Nt.AUDIO&&await B(b.receiver)}const _=this.remoteUserMap.get(i);_?_.set(l,f):this.remoteUserMap.set(i,new Map([[l,f]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(F=>{let{user:B,kind:j}=F;return B.uid===i.uid&&l===j});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Vt.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,s){const r=this.pendingRemoteTracks.filter(A=>{let{user:u,kind:m}=A;return t!==void 0?u.uid===e.uid&&t===m:u.uid===e.uid});if(r.forEach(A=>{const u=this.pendingRemoteTracks.indexOf(A);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===ir.Connected||s||r.forEach(A=>{let{kind:u}=A;var m;if(u===Nt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(u===Nt.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ir.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(A=>{let[,{id:u}]=A;return u}));const l=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(A=>{let[u,{kind:m}]=A;var f,b;if(m===Nt.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),m===Nt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),s||((b=u._videoTrack)===null||b===void 0||b._destroy(),u._videoTrack=void 0);else if(m===Nt.AUDIO){var w;this.unbindRemoteTrackEvents(u._audioTrack),!s&&((w=u._audioTrack)===null||w===void 0||w._destroy(),u._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{const l=this.pendingRemoteDataChannels.findIndex(A=>A.id===i.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(e,t);if(s.length===0)return;t.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(e);return s.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:l}of e){const A=this.pendingRemoteTracks.filter(u=>{let{user:m,kind:f}=u;return l!==void 0?m.uid===i.uid&&l===f:m.uid===i.uid});A.forEach(u=>{const m=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(A)}if(!this.connection||this.state!==ir.Connected)return void t.forEach(i=>{let{user:l,kind:A}=i;var u;if(A===Nt.AUDIO)(u=l._audioTrack)===null||u===void 0||u._destroy(),l._audioTrack=void 0;else if(A===Nt.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});const s=za(e).call(e,(i,l)=>{let{user:A,mediaType:u}=l;const m=this.filterTobeUnSubscribedTracks(A,u);return i.concat(m)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(i=>{let[,{id:l}]=i;return l}));const r=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(i=>{let[l,{kind:A}]=i;var u,m;if(A===Nt.VIDEO&&l._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),A===Nt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(A===Nt.AUDIO){var f;this.unbindRemoteTrackEvents(l._audioTrack),(f=l._audioTrack)===null||f===void 0||f._destroy(),l._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==ir.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Nt.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(rt.LocalAudioTrack),s=t&&t.track;s&&s.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(rt.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ln){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==rt.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===rt.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return!(e&&r===rt.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,s,r,i){if(e){const A=this.localTrackMap.get(rt.LocalAudioTrack),u=r?this.localTrackMap.get(rt.LocalVideoLowTrack):this.localTrackMap.get(rt.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var l;s||(s=[]);const A=s.find(m=>m instanceof nn),u=r?(l=this.localTrackMap.get(rt.LocalVideoTrack))===null||l===void 0?void 0:l.track:s.find(m=>m instanceof Er);Ot.publish(this.store.sessionId,{eventElapse:Qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,s,r){const i=r===Nt.VIDEO?s._videoSSRC:s._audioSSRC;i&&Ot.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Nt.VIDEO,audio:r===Nt.AUDIO,peerid:s.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Qi.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ai("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=nb(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(rt.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ln){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ir.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(rt.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(rt.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Er||t&&t.track instanceof nn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(Ji(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[r]=s;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(rt.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=zh(e).call(e,(s,r)=>s.level-r.level),e}async disconnectForReconnect(){this.connection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=nb(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:r}]=e;switch(s){case rt.LocalVideoTrack:et(t=r._hints).call(t,or.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case rt.LocalAudioTrack:r instanceof Ln?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case rt.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Ji(s).call(s)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Ji(s).call(s)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const s of this.pendingRemoteDataChannels){const{user:r,id:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:r,kind:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ka(function*(){if(!t.connection||t.state!==ir.Connected)return;const s=yield _s(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield _s(t.connection.restartICE(e));const l=yield _s(r.next());if(l.done)return;const A=l.value,u=yield A;switch(ZN(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case oi.UDP_TCP_RELAY:t._pcStatsUploadType=RA.UDP_TCP_RESTART;break;case oi.TCP_RELAY:t._pcStatsUploadType=RA.TCP_RESTART;break;case oi.RELAY:t._pcStatsUploadType=RA.RELAY_RESTART;break;default:t._pcStatsUploadType=RA.OLD_RESTART}t._isTryConnecting=!0,r.next(u)}catch(l){var i;(i=r)===null||i===void 0||i.throw(l)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(rt.LocalVideoTrack),s=this.localTrackMap.get(rt.LocalAudioTrack),r=e.videoSend.find(S=>S.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(S=>S.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!r||!i)return 1;const l=Eo(this,Vt.NeedSignalRTT),A=r?r.rttMs:void 0,u=i?i.rttMs:void 0,m=A&&u?(A+u)/2:A||u,f=(m&&l?(m+l)/2:m||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*f/1500,w=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,_=t==null?void 0:t.track;if(_&&_._encoderConfig&&_._hints.indexOf(or.SCREEN_TRACK)===-1){const S=_._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(S&&F){const B=(1e3*S-F)/(1e3*S);return BU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[r]=s;const i=r._audioSSRC,l=r._videoSSRC,A=e.audioRecv.find(F=>F.ssrc===i),u=e.videoRecv.find(F=>F.ssrc===l);if(!A&&!u)return void(t+=1);const m=Eo(this,Vt.NeedSignalRTT),f=e.rtt,b=(f&&m?(f+m)/2:f||m)||0,w=A?A.jitterMs:void 0,_=e.recvPacketLossRate;let S=.7*_*100/50+.3*b/1500;w&&(S=.6*_*100/50+.2*b/1500+.2*w/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new pt((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}async replaceTrack(e,t){var s;if(N.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ir.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:A}]=l;return e===A});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(t,r[1].id)),this.isPlanB){const l=r[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,l)}if(i===rt.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding){const l=this.localTrackMap.get(rt.LocalVideoLowTrack);if(l){const A=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=A,l.track._originMediaStreamTrack=A,await new pt((u,m)=>{this.handleReplaceTrack(l.track,u,m,!0)})}}}filterTobePublishedTracks(e,t,s){const r=[],i=this.getAllTracks();e=uf(e=e.filter(m=>i.indexOf(m)===-1));let l,A=!1;const u=this.localTrackMap.get(rt.LocalAudioTrack);for(const m of e){if(m instanceof Er&&(this.localTrackMap.has(rt.LocalVideoTrack)||A?new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:rt.LocalVideoTrack}),A=!0),t)){const f=this.getLowVideoTrack(m,s);r.push({track:f,type:rt.LocalVideoLowTrack})}if(m instanceof nn)if(u){const f=u.track;if(f instanceof Ln)JN([m]),f.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const b=$N([f,m]);N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(f,b)}}else l instanceof Ln?(JN([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&Ls().webAudioMediaStreamDest&&!m._bypassWebAudio?l=$N(l?[m,l]:[m]):l=m}return l&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),r.push({track:l,type:rt.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=uf(e=e.filter(r=>s.indexOf(r)!==-1));for(const r of e){if(r instanceof nn){const i=this.localTrackMap.get(rt.LocalAudioTrack);if(!i)continue;i.track instanceof Ln?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([rt.LocalAudioTrack,i]),i.track.close())):t.push([rt.LocalAudioTrack,i])}if(r instanceof Er){const i=this.localTrackMap.get(rt.LocalVideoTrack);if(!i)continue;t.push([rt.LocalVideoTrack,i]);const l=this.localTrackMap.get(rt.LocalVideoLowTrack);l&&t.push([rt.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=uf(e)).filter(t=>this.localDataChannels.findIndex(s=>s.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=uf(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:r}=t;switch(r){case rt.LocalVideoTrack:s.addListener(Dt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Dt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case rt.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case rt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ln?e.trackList.forEach(s=>{s.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Dt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:r}]=t;return{track:r,type:s}})),e.forEach(t=>{let{track:s,type:r}=t;switch(r){case rt.LocalVideoTrack:s.off(Dt.GET_STATS,this.handleGetLocalVideoStats),s.off(Dt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case rt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case rt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ln?e.trackList.forEach(t=>{t.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Dt.GET_STATS,this.handleGetLocalAudioStats),t.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Dt.GET_STATS,this.handleGetLocalAudioStats),e.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cf&&t.addListener(Dt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof Sf&&t.addListener(Dt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(Nt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(Nt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,r)=>{var i;let l,A,{track:u,type:m}=s;switch(m){case rt.LocalAudioTrack:l=ur.Audio,A={dtx:u instanceof W0&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case rt.LocalVideoTrack:l=et(i=u._hints).call(i,or.SCREEN_TRACK)?ur.Screen:ur.High,A=Ld(Ld({},YU(u)),{},{codec:this.store.codec,svc_mode:X0()});break;case rt.LocalVideoLowTrack:l=ur.Low,A=Ld(Ld({},YU(u)),{},{codec:this.store.codec,svc_mode:X0()})}return{stream_type:l,attributes:A,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}assignLocalTracks(e,t){e.forEach((s,r)=>{let{track:i,type:l}=s;this.localTrackMap.set(l,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Vt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof qo&&!kr()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},G("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof qo&&K4(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=RA.DISCONNECTED_OR_FAILED,Eo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(i=>i.getTrackId()),r=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));Ot.reportApiInvoke(this.store.sessionId,{name:Pr.REPUB_AFTER_PC_CONNECTED,options:s.concat(r),tag:yr.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&e instanceof qo&&!kr()&&!this._forceTurn&&!this.store.useDcSignal){if(et(HU).call(HU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=i=>{ZN(e)&&(N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Eo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,i))},r=()=>{ZN(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),N.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{W4(e,s,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&Eo(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:yr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(bc.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,Ur.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._audioSSRC===t);r&&Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,Ur.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,r)=>{var i;const l=Array.from(Ji(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===t);l&&this.store.firstVideoFrameDecoded(l.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,s,r)},e.onFirstVideoRender=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(r),this.emit(Vt.FirstVideoPreRender,r.uid,t))},e.onFirstVideoReceived=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&(this.store.firstVideoFrameDecoded(r.uid,{firstReceived:Date.now()}),Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,Ur.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&this.emit(Vt.FirstVideoBufferReady,r.uid,t)},e.onSelectedLocalCandidateChanged=(t,s)=>{const r=t.candidateType==="relay",i=s.candidateType==="relay";s.candidateType!=="unknown"&&r===i||this.emit(Vt.ConnectionTypeChange,r),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Ld(Ld({},t),s)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){N.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===ir.Connected?(N.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=nb(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof qo&&function(t){Mf.delete(t.id),K4(t)}(e),e.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const s=this.localTrackMap.get(rt.LocalAudioTrack);if(e instanceof nn&&(s==null?void 0:s.track)instanceof Ln)return s.track.isActive||t.push([rt.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r&&(t.push(r),r[0]===rt.LocalVideoTrack)){const i=this.localTrackMap.get(rt.LocalVideoLowTrack);i&&t.push([rt.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(rt.LocalAudioTrack);if(e instanceof nn&&(s==null?void 0:s.track)instanceof Ln)return s.track.isActive&&t.push([rt.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r)if(r[0]===rt.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(rt.LocalVideoLowTrack);i&&t.push([rt.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}filterTobeUnSubscribedTracks(e,t){const s=[],r=this.remoteUserMap.get(e);if(!r)return s;if(t){const i=r.get(t);if(!i)return s;s.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[l,A]=i;s.push([e,{kind:l,id:A}])});return s}filterTobeUnSubscribedDataChannels(e,t){const s=[];return t.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(r.id)&&s.push(r)}),s}createUnsubscribeMessage(e){const t=[];return e.forEach(s=>{let[r,{kind:i,id:l}]=s;switch(i){case Nt.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Nt.VIDEO,ssrcId:r._videoSSRC}));case Nt.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Nt.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(s=>{let[r,{kind:i}]=s;if(t.has(r)){let l=t.get(r);i===Nt.VIDEO?l|=Jn.Video:l|=Jn.Audio,t.set(r,l)}else i===Nt.VIDEO?t.set(r,Jn.Video):t.set(r,Jn.Audio)}),{users:Array.from(t.entries()).map(s=>{let[r,i]=s;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:r}]=t;const i=this.remoteUserMap.get(s);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(rt.LocalVideoTrack),s=this.localTrackMap.get(rt.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new pt((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new pt((r,i)=>{this.handleUpdateVideoEncoder(s.track,r,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof qo&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof qo)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof qo&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,s){return e.map((r,i)=>{var l;let{stream_type:A}=r;const u=(l=t.find(m=>{let{stream_type:f}=m;return A===f}))===null||l===void 0?void 0:l.attributes;if(u&&G("DISABLE_SCREEN_SHARE_REMB")){const m=s[i]._hints;(et(m).call(m,or.SCREEN_TRACK)||et(m).call(m,or.SCREEN_LOW_TRACK))&&(u.remb=!1,N.debug("disable remb for screen share, hints:",m))}return u})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof nn){var t;const r=this.filterTobeUnmutedTracks(e[s]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(l=>{let[,{id:A}]=l;return A})));const i=this.createUnmuteMessage(r);return void await Sr(this,Vt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yn(lw(this.dtlsFailedCount,gn)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Cn(this,Vt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(rt.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Er).length>1)throw new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof nn).length>1&&(e.some(t=>t instanceof nn&&t._bypassWebAudio)||!Ls().webAudioMediaStreamDest))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Er&&this.pendingLocalTracks.some(s=>s instanceof Er))throw new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof nn&&this.pendingLocalTracks.some(s=>s instanceof nn)&&(!Ls().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof nn&&s._bypassWebAudio)))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var s;const r=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding,i=Ld(Ld({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=r?e._mediaStreamTrack.clone():t2(e,i);const A=dr(8,"track-low-"),u=new Er(l,Ld(Ld({},r&&{scaleResolutionDownBy:ON(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,A);return u.on(up.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,xf.LOW_STREAM)}),u._hints.push(or.LOW_STREAM),et(s=e._hints).call(s,or.SCREEN_TRACK)&&u._hints.push(or.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{u.emit("sei-to-send",m)}),e.addListener(Dt.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof qo){var i,l,A,u;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:b,peerConnectionState:w}=this.connection,{local:_,remote:S}=await this.connection.getSelectedCandidatePair();Ot.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:f,dtlsstate:b,connectionstate:w,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(i=_==null?void 0:_.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(l=_.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(_.address,":").concat(_.port),selectedRemoteCandidateProtocol:(A=S.protocol)!==null&&A!==void 0?A:"",selectedRemoteCandidateType:(u=S.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,s=t.firstVideoFrameDecoded.find(b=>b.userId===e.uid);if(!s)return;const{isInternalUpload:r,isExternalUpload:i}=s;if(r&&i)return;const{subscribeEnd:l,firstPreRender:A,peerPublishDuration:u,peerPubStatusMs:m}=s;let{firstRender:f=0}=s;if(l&&(f||A)&&u&&m){s.isInternalUpload=!0;const{playEnd:b}=s;b&&(s.isExternalUpload=!0);const{firstPreRender:w=0}=s;f=w||f;const _=e.videoTrack,S={peer:e._uintid,width:(_==null?void 0:_._videoWidth)||0,height:(_==null?void 0:_._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:u,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:w||0,firstRender:b?Math.max(f,b):Math.max(f,l),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:mj(this.store),firstReceivedEncodedFrame:s.firstReceivedEncodedFrame||0,frameType:s.frameType||"",rtpTimestamp:s.rtpTimestamp||0,framePayloadType:s.framePayloadType||0,frameDataLength:s.frameDataLength||0,mimeType:s.mimeType||""};Ot.firstXLAPeerFirstVideoFrame(this.store.sessionId,S)}}reportVideoFirstFrameDecoded(e,t,s,r){var i;const l=Array.from(Ji(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const A=this.store.keyMetrics,u=A.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,Ur.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:s,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:A.requestAPEnd||0,apStart:A.requestAPStart||0,joinGwEnd:A.joinGatewayEnd||0,joinGwStart:A.joinGatewayStart||0,pcEnd:A.peerConnectionEnd||0,pcStart:A.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:r?1:0,firstFrame:(u==null?void 0:u.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const l=await this.connection.getRemoteSSRC(i);return l!==void 0&&l!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===rt.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,xf.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},ft(Ps.prototype,"startP2PConnection",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"startP2PConnection"),Ps.prototype),ft(Ps.prototype,"connect",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"connect"),Ps.prototype),ft(Ps.prototype,"updateRemoteRTPCapabilities",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"updateRemoteRTPCapabilities"),Ps.prototype),ft(Ps.prototype,"publishDataChannel",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"publishDataChannel"),Ps.prototype),ft(Ps.prototype,"unpublish",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublish"),Ps.prototype),ft(Ps.prototype,"unpublishDataChannel",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublishDataChannel"),Ps.prototype),ft(Ps.prototype,"unpublishLowStream",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unpublishLowStream"),Ps.prototype),ft(Ps.prototype,"subscribeDataChannel",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"subscribeDataChannel"),Ps.prototype),ft(Ps.prototype,"subscribe",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"subscribe"),Ps.prototype),ft(Ps.prototype,"massSubscribe",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"massSubscribe"),Ps.prototype),ft(Ps.prototype,"unsubscribe",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unsubscribe"),Ps.prototype),ft(Ps.prototype,"unsubscribeDataChannel",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unsubscribeDataChannel"),Ps.prototype),ft(Ps.prototype,"massUnsubscribe",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"massUnsubscribe"),Ps.prototype),ft(Ps.prototype,"muteRemote",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"muteRemote"),Ps.prototype),ft(Ps.prototype,"unmuteRemote",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"unmuteRemote"),Ps.prototype),ft(Ps.prototype,"hasRemoteMediaWithLock",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"hasRemoteMediaWithLock"),Ps.prototype),ft(Ps.prototype,"disconnectForReconnect",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"disconnectForReconnect"),Ps.prototype),ft(Ps.prototype,"updateBitrateLimit",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"updateBitrateLimit"),Ps.prototype),ft(Ps.prototype,"remoteMediaSsrcChanged",[ia],Object.getOwnPropertyDescriptor(Ps.prototype,"remoteMediaSsrcChanged"),Ps.prototype),Ps);function ia(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PChannel.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}function Y4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function X4(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Y4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Y4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const nte=Date.now(),ite=20,n2=new Map,i_=new Map;async function J4(e){const t=n2.get(e),s=Array.isArray(t)&&t[t.length-1],r=i_.get(e);if(!s)return void(r.isSyncing=!1);const i={uid:s.uid,payload:s.payload};r.firstRecvTs===0&&(r.firstRecvTs=s.recvTs,r.firstSendTs=s.sendTs);const l=s.sendTs-r.firstSendTs,A=l-(Date.now()-r.firstRecvTs);A>0&&(r.firstRecvTs=Date.now()-l);let u=s.mediaDelay+A;u<=0?(t.pop(),$4(s.context,i),u=0):u=Math.min(u,ite),setTimeout(()=>t.length&&J4(e),u)}function $4(e,t){e.safeEmit(Ss.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function ate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return $4(s,{uid:e.uid,payload:e.payload});const r="".concat(s.id,"-").concat(e.uid),i=n2.get(r)||[],l=i.findIndex(f=>e.sendTs>=f.sendTs),A=X4(X4({},e),{},{context:s,mediaDelay:t,recvTs:Date.now()});l===-1?i.push(A):i.splice(l,0,A),n2.set(r,i);let u=!1;var m;i_.has(r)?u=!((m=i_.get(r))===null||m===void 0||!m.isSyncing):i_.set(r,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||J4(r)}const ote=$s().name;function Z4(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function eF(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Z4(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Z4(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const Vf="websdk_ng_cache_parameter",cte=G("MAX_PRELOAD_ASYNC_LENGTH"),lte=1e4,Cp=new Map,Sp=[];let i2=null,a2=0,o2=0;const a_=new Map,tF=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),dte=function(e,t){const s=[];let r=0;const i=async()=>{const l=s.shift();l&&await l(),s.length>0&&r<t?i():r--};return async function(){for(var l=arguments.length,A=new Array(l),u=0;u<l;u++)A[u]=arguments[u];return new pt(async(m,f)=>{s.push(async()=>{try{const b=await e(...A);m(b)}catch(b){f(b)}}),r<t&&(r++,i())})}}(l2,cte),c2=Da.CancelToken.source();class Ate{constructor(){U(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,s=10*t,r=this._audioContext.createBuffer(2,s,t),i=this._audioContext.createBufferSource();i.buffer=r;const l=this._audioContext.createMediaStreamDestination();return i.connect(l),i.start(),l.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function l2(e,t,s,r,i,l,A){try{if(!G("ENABLE_PRELOAD"))return;if(!Ls().supportWebCrypto)return void Su(()=>{N.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Fe(W.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&bi(s,"token",1,2047),bi(e,"appid",1,2047),Lw(t),r&&jw(r);const u=cp();N.debug("preload channel ".concat(t,", uid is ").concat(r));const m={appId:e,cname:t,token:s||e,uid:typeof r!="string"?r:null,sid:u,proxyServer:i,role:A};let f,b;typeof r=="string"?(m.stringUid=r,[b,f]=await pt.all([Wee(r,{sid:u,appId:e},c2.token),C4(eF(eF({},m),{},{token:s||e,uid:0}),c2.token)]),m.uid=b.uid,f.gatewayInfo.uid=m.uid,f.gatewayInfo.res.uid=m.uid):(l&&(m.stringUid=l),f=await C4(m,c2.token));const w={sid:u,appId:e,cname:t,token:s||e,uid:m.stringUid||r,intUid:m.uid||f.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:b,ap:f};await A2(w),a2++}catch(u){throw o2++,function(m){i2||(i2=window.setTimeout(()=>{let b="";a_.forEach((w,_)=>{b+="".concat(_,": ").concat(w," ;")}),Ot.reportApiInvoke(null,{name:Pr.PRELOAD,options:{success:a2,failed:o2,err:b}}).onError(m),a2=0,o2=0,a_.clear(),i2=null},lte));const f=a_.get(m.code)||0;a_.set(m.code,f+1)}(u),u}}async function d2(e){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const t=sF(e);if(!t||e.cloudProxyServer!=="disabled")return;const s=await async function(r,i){try{const l=await window.crypto.subtle.importKey("raw",HL(i),"AES-GCM",!1,["decrypt"]),A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:tF},l,op(r));return JSON.parse(window.atob(Nu(new Uint8Array(A))))}catch{return}}(t,e.token||e.appId);if(!s||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<G("AP_CACHE_LIFETIME"))return s}catch(t){N.warn("Error get preloadInfo",t.message)}}function sF(e){let t;try{if(t=iF(Vf),!t)return;const s=JSON.parse(t),r=aF(e),i=function(A,u){for(let m=A.length-1;m>=0;m--)if(u(A[m]))return m;return-1}(s,A=>r in A);if(i===-1)return;const l=s.splice(i,1)[0];return o_(Vf,JSON.stringify(s)),l[r]}catch(s){N.warn("Error delete preload info: ".concat(t),s.message),o_(Vf,"")}}async function A2(e){let t;try{e.uid&&sF({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const s=aF(e),r=await async function(l,A){try{const u=await window.crypto.subtle.importKey("raw",HL(A),"AES-GCM",!1,["encrypt"]),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:tF},u,op(window.btoa(JSON.stringify(l))));return Nu(new Uint8Array(m))}catch{return}}(e,e.token||e.appId);if(!r)return;t=iF(Vf);const i=t?JSON.parse(t):[];i.push({[s]:r}),i.length>G("AP_CACHE_NUM")&&i.shift(),o_(Vf,JSON.stringify(i))}catch(s){N.warn("Error caching server parameters:",s.message),o_(Vf,"")}}function u2(e){if(e){let t=Cp.get(e);t&&(window.clearTimeout(t),t=null,Cp.delete(e)),et(Sp).call(Sp,e)||e.cloudProxyServer!=="disabled"||Sp.push(e)}if(Cp.size<G("AP_CACHE_NUM")&&Sp.length>0){const t=Sp.shift();Cp.set(t,window.setTimeout(async()=>{const{appId:s,cname:r,token:i,stringUid:l,uid:A,proxyServer:u,role:m}=t;try{await dte(s,r,i,A,u,l,m),Cp.has(t)&&u2(t)}catch(f){N.warn("update preload failed",f.message),rF(t)}},G("AP_UPDATE_INTERVAL")))}}function rF(e){const t=Sp.indexOf(e);t!==-1&&Sp.splice(t,1);let s=Cp.get(e);s&&(window.clearTimeout(s),s=null,Cp.delete(e),u2())}function nF(e,t){const s=e.sua,r=e.ap;t&&s&&Ot.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:t,uid:e.intUid,errorCode:null,extend:s.req}),Ot.reportResourceTiming(e.ap.url,e.sid),Ot.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[bn.CHOOSE_SERVER,bn.CLOUD_PROXY_FALLBACK].toString()}),Ot.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[bn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function iF(e){return window.atob(window.localStorage.getItem(e)||"")}function o_(e,t){window.localStorage.setItem(e,window.btoa(t))}function aF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),XL(t)}function ute(e){let t=function(){const s=mte.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,r){let i=s.appId;i!==void 0&&(xn(r,10),ju(r,i));let l=s.cid;l!==void 0&&(xn(r,16),xn(r,l));let A=s.cname;A!==void 0&&(xn(r,26),ju(r,A));let u=s.deviceId;u!==void 0&&(xn(r,34),ju(r,u));let m=s.elapse;m!==void 0&&(xn(r,40),Pu(r,m));let f=s.fileSize;f!==void 0&&(xn(r,48),Pu(r,Qf(f)));let b=s.height;b!==void 0&&(xn(r,56),Pu(r,Qf(b)));let w=s.jpg;w!==void 0&&(xn(r,66),xn(r,w.length),cF(r,w));let _=s.networkType;_!==void 0&&(xn(r,72),Pu(r,Qf(_)));let S=s.osType;S!==void 0&&(xn(r,80),Pu(r,Qf(S)));let F=s.requestId;F!==void 0&&(xn(r,90),ju(r,F));let B=s.sdkVersion;B!==void 0&&(xn(r,98),ju(r,B));let j=s.sequence;j!==void 0&&(xn(r,104),Pu(r,Qf(j)));let K=s.sid;K!==void 0&&(xn(r,114),ju(r,K));let X=s.timestamp;X!==void 0&&(xn(r,120),Pu(r,X));let oe=s.uid;oe!==void 0&&(xn(r,128),xn(r,oe));let xe=s.vid;xe!==void 0&&(xn(r,136),xn(r,xe));let Ee=s.width;Ee!==void 0&&(xn(r,144),Pu(r,Qf(Ee)));let me=s.service;me!==void 0&&(xn(r,152),xn(r,me));let Re=s.callbackData;Re!==void 0&&(xn(r,162),xn(r,Re.length),cF(r,Re));let He=s.ticket;He!==void 0&&(xn(r,170),ju(r,He));let Xe=s.vendorConfigs;Xe!==void 0&&(xn(r,178),ju(r,Xe))}(e,t),function(s){let r=s.bytes,i=s.limit;return r.length===i?r:r.subarray(0,i)}(t)}function hte(e){return function(s){let r={};e:for(;!fte(s);){let i=ab(s);switch(i>>>3){case 0:break e;case 1:r.code=ab(s);break;case 2:r.msg=lF(s,ab(s));break;case 3:r.requestId=lF(s,ab(s));break;case 4:r.timestamp=gte(s,!1);break;default:pte(s,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function pte(e,t){switch(t){case 0:for(;128&rl(e););break;case 2:h2(e,ab(e));break;case 5:h2(e,4);break;case 1:h2(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Qf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let mte=[];function h2(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function fte(e){return e.offset>=e.limit}function c_(e,t){let s=e.bytes,r=e.offset,i=e.limit,l=r+t;if(l>s.length){let A=new Uint8Array(2*l);A.set(s),e.bytes=A}return e.offset=l,l>i&&(e.limit=l),r}function oF(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function cF(e,t){let s=c_(e,t.length);e.bytes.set(t,s)}function lF(e,t){let s=oF(e,t),r=String.fromCharCode,i=e.bytes,l="",A="";for(let u=0;u<t;u++){let m,f,b,w,_=i[u+s];128&_?(224&_)==192?u+1>=t?A+=l:(m=i[u+s+1],(192&m)!=128?A+=l:(w=(31&_)<<6|63&m,w<128?A+=l:(A+=r(w),u++))):(240&_)==224?u+2>=t?A+=l:(m=i[u+s+1],f=i[u+s+2],(49344&(m|f<<8))!=32896?A+=l:(w=(15&_)<<12|(63&m)<<6|63&f,w<2048||w>=55296&&w<=57343?A+=l:(A+=r(w),u+=2))):(248&_)==240?u+3>=t?A+=l:(m=i[u+s+1],f=i[u+s+2],b=i[u+s+3],(12632256&(m|f<<8|b<<16))!=8421504?A+=l:(w=(7&_)<<18|(63&m)<<12|(63&f)<<6|63&b,w<65536||w>1114111?A+=l:(w-=65536,A+=r(55296+(w>>10),56320+(1023&w)),u+=3))):A+=l:A+=r(_)}return A}function ju(e,t){let s=t.length,r=0;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}xn(e,r);let i=c_(e,r),l=e.bytes;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),u<128?l[i++]=u:(u<2048?l[i++]=u>>6&31|192:(u<65536?l[i++]=u>>12&15|224:(l[i++]=u>>18&7|240,l[i++]=u>>12&63|128),l[i++]=u>>6&63|128),l[i++]=63&u|128)}}function rl(e){return e.bytes[oF(e,1)]}function dF(e,t){let s=c_(e,1);e.bytes[s]=t}function ab(e){let t,s=0,r=0;do t=rl(e),s<32&&(r|=(127&t)<<s),s+=7;while(128&t);return r}function xn(e,t){for(t>>>=0;t>=128;)dF(e,127&t|128),t>>>=7;dF(e,t)}function gte(e,t){let s,r=0,i=0,l=0;return s=rl(e),r=127&s,128&s&&(s=rl(e),r|=(127&s)<<7,128&s&&(s=rl(e),r|=(127&s)<<14,128&s&&(s=rl(e),r|=(127&s)<<21,128&s&&(s=rl(e),i=127&s,128&s&&(s=rl(e),i|=(127&s)<<7,128&s&&(s=rl(e),i|=(127&s)<<14,128&s&&(s=rl(e),i|=(127&s)<<21,128&s&&(s=rl(e),l=127&s,128&s&&(s=rl(e),l|=(127&s)<<7))))))))),{low:r|i<<28,high:i>>>4|l<<24,unsigned:t}}function Pu(e,t){let s=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,l=i===0?r===0?s<16384?s<128?1:2:s<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,A=c_(e,l),u=e.bytes;switch(l){case 10:u[A+9]=i>>>7&1;case 9:u[A+8]=l!==9?128|i:127&i;case 8:u[A+7]=l!==8?r>>>21|128:r>>>21&127;case 7:u[A+6]=l!==7?r>>>14|128:r>>>14&127;case 6:u[A+5]=l!==6?r>>>7|128:r>>>7&127;case 5:u[A+4]=l!==5?128|r:127&r;case 4:u[A+3]=l!==4?s>>>21|128:s>>>21&127;case 3:u[A+2]=l!==3?s>>>14|128:s>>>14&127;case 2:u[A+1]=l!==2?s>>>7|128:s>>>7&127;case 1:u[A]=l!==1?128|s:127&s}}const AF={},uF={},l_=4294967296,bte=l_*l_,hF=bte/2;mF(0,!0);const pF=mF(0),xte=ob(0,-2147483648,!1),vte=ob(-1,2147483647,!1);function mF(e,t){let s,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=uF[e],r)?r:(s=ob(e,0,!0),i&&(uF[e]=s),s):(i=-128<=(e|=0)&&e<128)&&(r=AF[e],r)?r:(s=ob(e,e<0?-1:0,!1),i&&(AF[e]=s),s)}function ob(e,t,s){return{low:0|e,high:0|t,unsigned:!!s}}function fF(e,t){if(isNaN(e))return pF;{if(e<=-hF)return xte;if(e+1>=hF)return vte}return e<0?pF:ob(e%l_|0,e/l_|0,t)}function gF(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class p2 extends Vr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const s=this._connectionState;this._connectionState=t,this.emit(Ml.CONNECTION_STATE_CHANGE,t,s)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var s;super(),U(this,"name","AgoraRTCImageModeration"),U(this,"_connectionState",wc.CONNECTING),U(this,"_sequence",0),U(this,"_moderationStartTime",void 0),U(this,"_workerConnection",void 0),U(this,"_workerMessageLengthLimit",void 0),U(this,"_qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Da.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"_moderationInterval",void 0),U(this,"_moderationTimer",null),U(this,"_moderationMode",1),U(this,"_quality",1),U(this,"_qualityTimer",null),U(this,"_ticket",void 0),U(this,"_moderationIntervalMinimum",void 0),U(this,"_uploadFailedNum",0),U(this,"_uploadNum",0),U(this,"_uploadTimer",null),U(this,"_extraInfo",void 0),U(this,"_vendor",""),U(this,"_encoder",new TextEncoder),U(this,"_moderationId",void 0),U(this,"inspectImage",()=>{if(this.connectionState!==wc.CONNECTED)throw new Le(W.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===wc.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new q0("worker-"+this._moderationId,gn),this.on(Ml.STATE_CHANGE,(r,i)=>{N.debug("[".concat(this._moderationId,"] Moderation operation :").concat(If[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,s){this.emit(Ml.STATE_CHANGE,If.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=s,new pt((i,l)=>{this.on(Ml.CONNECTION_STATE_CHANGE,(A,u)=>{A===wc.CONNECTED&&i()}),this.requestAP(t,r,s).then(A=>{this.connectWorker(A)}).catch(A=>{l(A)})})}updateConfig(t){var s;this._moderationInterval=(s=t.interval)!==null&&s!==void 0?s:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),N.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===wc.CONNECTED&&this.inspectImage()}async requestAP(t,s,r){const i=G("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,f,b,w){let{appId:_,areaCode:S,cname:F,sid:B,token:j,uid:K}=f;Lf++;const X="moderation_plugin",oe={service_name:X,json_body:JSON.stringify({appId:_,areaCode:S,cname:F,command:"allocateEdge",requestId:Lf,seq:Lf,sid:B,appToken:j,ts:Date.now(),uid:K+""})};let xe,Ee,me=m[0];return jl(async()=>{xe=Date.now();const Re=await Ql(me,{data:oe,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-xe,Re.code!==0){const es=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Re.code,{retry:!0,responseTime:Ee});throw N.error(es.toString()),es}const He=JSON.parse(Re.json_body);if(He.code!==200){const es=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(He.code,", reason: ").concat(He.reason),{code:He.code,responseTime:Ee});throw N.error(es.toString()),es}if(!He.servers||!Array.isArray(He.servers)||He.servers.length===0){const es=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:He.code,responseTime:Ee});throw N.error(es.toString()),es}if(!He.servers.some(es=>!!es.wss)){const es=new Le(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:He.code,responseTime:Ee});throw N.error(es.toString()),es}const Xe=G("IMAGE_MODERATION_WORKER_WSS");if(Xe)return{addressList:[Xe],workerToken:He.workerToken,vid:He.vid,responseTime:Ee};const _t=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:He.servers.map(es=>{let{address:vs,wss:ps}=es;if(vs&&ps)return"wss://".concat(vs.replace(/\./g,"-"),".").concat(_t,":").concat(ps,"/moderation")}).filter(es=>!!es),workerToken:He.workerToken,vid:He.vid,ticket:He.appTicket,responseTime:Ee}},(Re,He)=>(Ot.apworkerEvent(B,{success:!0,sc:200,serviceName:X,responseDetail:JSON.stringify(Re.addressList),firstSuccess:He===0,responseTime:Ee,serverIp:m[He%m.length]}),!1),(Re,He)=>(Ot.apworkerEvent(B,{success:!1,sc:Re.data&&Re.data.code||200,serviceName:X,responseTime:Ee,serverIp:m[He%m.length]}),!!(Re.code!==W.OPERATION_ABORTED&&Re.code!==W.UNEXPECTED_RESPONSE||Re.data&&Re.data.retry)&&(me=m[(He+1)%m.length],!0)),w)}(i,t,s,r);this.emit(Ml.STATE_CHANGE,If.AP_CONNECTED);const{addressList:A,ticket:u}=l;return this._ticket=u,A}async connectWorker(t){this.emit(Ml.STATE_CHANGE,If.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ms.CONNECTED,async()=>{this.emit(Ml.STATE_CHANGE,If.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=wc.CONNECTED}),this._workerConnection.on(ms.CLOSED,()=>{this.connectionState=wc.CLOSED}),this._workerConnection.on(ms.FAILED,()=>{this.connectionState=wc.CLOSED}),this._workerConnection.on(ms.RECONNECTING,()=>{this.connectionState=this.connectionState===wc.CONNECTED?wc.RECONNECTING:wc.CONNECTING}),this._workerConnection.on(ms.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const s=hte(new Uint8Array(t.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,N.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ot.reportApiInvoke(this._connectInfo.sid||null,{name:Pr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:yr.TRACER}).onError(new Le(W.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else N.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ms.WILL_RECONNECT,(t,s,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(ms.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Eo(this,Ml.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,s);this._workerConnection.sendMessage(r,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&N.debug("Only the track being published can be inspected")}async generateRequestData(t,s){let{appId:r,cname:i,cid:l,vid:A,sid:u,uid:m}=s;const f=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await Vj(b,r,i),_=this._sequence+"-"+l+"-"+m+"-"+f+"-"+dr(12,""),S={appId:r,cid:l,cname:i,deviceId:"",elapse:p2.intToLong(Number(f-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:w,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.2",sequence:this._sequence,sid:u,timestamp:fF(f),uid:m,vid:A,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;const F=ute(S);if(F.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const B=function(j){for(var K=1;K<arguments.length;K++){var X=arguments[K]!=null?arguments[K]:{};K%2?gF(Object(X),!0).forEach(function(oe){U(j,oe,X[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(X)):gF(Object(X)).forEach(function(oe){Object.defineProperty(j,oe,Object.getOwnPropertyDescriptor(X,oe))})}return j}({},S);delete B.jpg,N.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(B))}return F}{const B=this.quality*this._qualityRatio;return this.quality=B,await this.generateRequestData(t,{appId:r,cname:i,cid:l,vid:A,sid:u,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Da.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=wc.CLOSED,this.emit(Ml.STATE_CHANGE,If.CLOSED)}}function bF(e){if(_r(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Le(W.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Le(W.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const wte={name:"ImageModeration",create:function(e){let{config:t}=e;return bF(t),new p2(t)}};var xF,vF,wF,_F,yF,EF,CF,SF,NF,TF,RF,IF,OF,kF,DF,BF,LF,jF,PF,UF,FF,MF,VF,QF,HF,GF,KF,WF,zF,qF,YF,XF,JF,$F,ZF,eM,tM,sM,rM,nM,iM,aM,Et;function oM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function nl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?oM(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oM(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}ai.setLogger(N);let _te=(xF=$t(),vF=$t({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof _f))return[t];t=[t]}return t.map(s=>s?Object(s).toString():"null")}}),wF=$t({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==wf.DATA?(Array.isArray(t)||(t=[t]),t.map(s=>s.getTrackId())):[t.getChannelId()])}),_F=$t({argsMap:(e,t,s,r)=>[typeof t=="object"?t.uid:t,s,r]}),yF=$t({argsMap:(e,t,s)=>[t,s]}),EF=$t({argsMap:(e,t)=>t.map(s=>{let{user:r,mediaType:i}=s;return[r==null?void 0:r.uid,i]})}),CF=$t({argsMap:(e,t,s,r)=>[typeof t=="object"?t.uid:t,s,r]}),SF=$t({argsMap:(e,t)=>t.map(s=>{let{user:r,mediaType:i}=s;return{uid:r==null?void 0:r.uid,mediaType:i}})}),NF=$t(),TF=$t(),RF=$t(),IF=$t(),OF=$t(),kF=$t(),DF=$t(),BF=$t(),LF=$t(),jF=$t(),PF=$t(),UF=$t(),FF=$t(),MF=$t(),VF=$t(),QF=$t(),HF=$t({argsMap:(e,t)=>[t]}),GF=$t(),KF=$t(),WF=$t(),zF=$t(),qF=$t(),YF=$t(),XF=$t(),JF=$t(),$F=$t({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),ZF=$t(),eM=$t(),tM=$t(),sM=$t(),rM=$t(),nM=$t(),iM=$t({reportResult:!0}),aM=$t(),Et=class extends Vr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let s;if(super(),U(this,"store",void 0),U(this,"_uid",void 0),U(this,"_channelName",void 0),U(this,"_uintUid",void 0),U(this,"_users",[]),U(this,"_config",void 0),U(this,"_clientId",void 0),U(this,"_appId",void 0),U(this,"_sessionId",null),U(this,"_key",void 0),U(this,"_rtmConfig",{}),U(this,"_joinInfo",void 0),U(this,"_gateway",void 0),U(this,"_statsCollector",void 0),U(this,"_configDistribute",void 0),U(this,"_leaveMutex",void 0),U(this,"_publishMutex",void 0),U(this,"_renewTokenMutex",void 0),U(this,"_subscribeMutex",void 0),U(this,"_encryptionMode","none"),U(this,"_encryptionSecret",null),U(this,"_encryptionSalt",null),U(this,"_encryptDataStream",!1),U(this,"_encryptDataStreamKey",null),U(this,"_encryptDataStreamIv",null),U(this,"_proxyServer",void 0),U(this,"_turnServer",{servers:[],mode:"auto"}),U(this,"_cloudProxyServerMode","disabled"),U(this,"_isDualStreamEnabled",!1),U(this,"_defaultStreamFallbackType",void 0),U(this,"_lowStreamParameter",void 0),U(this,"_streamFallbackTypeCacheMap",new Map),U(this,"_remoteStreamTypeCacheMap",new Map),U(this,"_axiosCancelSource",Da.CancelToken.source()),U(this,"_audioVolumeIndicationInterval",void 0),U(this,"_networkQualityInterval",void 0),U(this,"_userOfflineTimeout",void 0),U(this,"_streamRemovedTimeout",void 0),U(this,"_rteDetailInterval",void 0),U(this,"_liveTranscodeStreamingClient",void 0),U(this,"_liveRawStreamingClient",void 0),U(this,"_channelMediaRelayClient",void 0),U(this,"_networkQualitySensitivity","normal"),U(this,"_p2pChannel",void 0),U(this,"_useLocalAccessPoint",!1),U(this,"_setLocalAPVersion",void 0),U(this,"_joinAndNotLeaveYet",!1),U(this,"_numberOfJoinCount",0),U(this,"_joinResponse",null),U(this,"_remoteDefaultVideoStreamType",void 0),U(this,"_inspect",void 0),U(this,"_moderation",void 0),U(this,"_license",void 0),U(this,"_pendingPublishedUsers",[]),U(this,"ntpAlignErrorCount",0),U(this,"remoteInboundOffset",0),U(this,"_peerConnectionState",void 0),U(this,"_pendingRtpCapabilityChange",void 0),U(this,"_fallbackServerInfo",void 0),U(this,"_dualStreamMode",void 0),U(this,"_handleLocalTrackEnable",(i,l,A)=>{this.publish(i,!1).then(l).catch(A)}),U(this,"_handleLocalTrackDisable",(i,l,A)=>{this.unpublish(i).then(l).catch(A)}),U(this,"_handleUserOnline",i=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(i.uid,this.channelName))return void N.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(A=>A.uid===i.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(Ss.USER_JOINED,l));else{const A=new Bu(i.uid,i.uint_id||i.uid);this._users.push(A),N.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(A.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ss.USER_JOINED,A)}}),U(this,"_handleUserOffline",i=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(i.uid,this.channelName))return;const l=this._users.find(A=>A.uid===i.uid);l&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:ow(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),N.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ss.USER_LEAVED,l,i.reason))}),U(this,"_handleAddAudioOrVideoStream",(i,l,A,u,m,f,b,w)=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(l,this.channelName))return;const _=this._users.find(B=>B.uid===l);if(!_)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(i)),this.store.subscribe(_.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(_.uid,{videoAddNotify:Date.now()});const S=i==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=f||l),i==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,i==="audio"?(_._audio_added_=!0,A!==void 0&&(_._audioSSRC=A),u!==void 0&&(_._cname=u),b&&(_._audioOrtc=b)):(_._video_added_=!0,A!==void 0&&(_._videoSSRC=A),u!==void 0&&(_._cname=u),w!==void 0&&(_._rtxSsrcId=w),b&&(_._videoOrtc=b)),(i==="audio"?_.hasAudio:_.hasVideo)&&!S&&(N.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(i)),this.safeEmit(Ss.USER_PUBLISHED,_,i)),i==="video"?Ot.onGatewayStream(this._sessionId,Bn.ON_ADD_VIDEO_STREAM,Ur.ON_ADD_VIDEO_STREAM,{peer:f||l,ssrc:_._videoSSRC}):Ot.onGatewayStream(this._sessionId,Bn.ON_ADD_AUDIO_STREAM,Ur.ON_ADD_AUDIO_STREAM,{peer:f||l,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,i,A).then(B=>{if(B&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ep))return this._p2pChannel.unsubscribe(_,i,!0).then(()=>this._subscribe(_,i,!0).catch(j=>{N.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,i)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,i,!0).catch(B=>{N.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}));const F=this._getEncodingName(m);i==="video"&&(F==="unknown"?this.safeEmit(Ss.AV1_DECODABLE_RESULT,!1):ii()||Xi()||(F==null?void 0:F.toLocaleLowerCase())!==dp.av1||Kee().then(B=>{G("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Ss.AV1_DECODABLE_RESULT,B),B||this._gateway.downgradeCodec(F)}))}),U(this,"_handleRemoveStream",i=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(i.uid,this.channelName))return;const l=this._users.find(u=>u.uid===i.uid);if(!l)return void N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));N.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let A=()=>{};l.hasAudio&&l.hasVideo?A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Ss.USER_UNPUBLISHED,l,"audio"),N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Ss.USER_UNPUBLISHED,l,"video")}:l.hasVideo?A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Ss.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(A=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Ss.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof Ep&&this._p2pChannel.unsubscribe(l).then(u=>{if(u)return this._gateway.unsubscribe(u,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Ot.onGatewayStream(this._sessionId,Bn.ON_REMOVE_STREAM,Ur.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),A()}),U(this,"_handleSetStreamLocalEnable",(i,l,A)=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(l,this.channelName))return;const u=this._users.find(b=>b.uid===l);if(!u)return void N.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));N.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(A?"enabled":"disabled"," with uid ").concat(l));const m=i==="audio"?u.hasAudio:u.hasVideo;if(i==="audio"){u._trust_audio_enabled_state_=!0;const b=u._audio_enabled_;if(u._audio_enabled_=A,u._audio_enabled_===b)return;{const w=u._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(w)),this.safeEmit(Ss.USER_INFO_UPDATED,l,w)}}else{u._trust_video_enabled_state_=!0;const b=u._video_enabled_;if(u._video_enabled_=A,u._video_enabled_===b)return;{const w=u._video_enabled_?"enable-local-video":"disable-local-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(w)),this.safeEmit(Ss.USER_INFO_UPDATED,l,w)}}const f=i==="audio"?u.hasAudio:u.hasVideo;return m!==f?!m&&f?(N.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(i)),void this.safeEmit(Ss.USER_PUBLISHED,u,i)):(i==="video"&&u._videoTrack&&u._videoTrack._destroy(),i==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,i),N.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(i)),void this.safeEmit(Ss.USER_UNPUBLISHED,u,i)):void 0}),U(this,"_handleMuteStream",(i,l,A)=>{if(G("BLOCK_LOCAL_CLIENT")&&bp(i,this.channelName))return;N.debug("[".concat(this._clientId,"] receive mute message"),i,l,A);const u=this._users.find(b=>b.uid===i);if(!u)return void N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const m=l==="audio"?u.hasAudio:u.hasVideo;if(l==="audio"){u._trust_audio_mute_state_=!0;const b=u._audio_muted_;if(u._audio_muted_=A,u._audio_muted_===b)return;{const w=u._audio_muted_?"mute-audio":"unmute-audio";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(w)),this.safeEmit(Ss.USER_INFO_UPDATED,i,w)}}else{u._trust_video_mute_state_=!0;const b=u._video_muted_;if(u._video_muted_=A,u._video_muted_===b)return;{const w=u._video_muted_?"mute-video":"unmute-video";N.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(w)),this.safeEmit(Ss.USER_INFO_UPDATED,i,w)}}const f=l==="audio"?u.hasAudio:u.hasVideo;if(m!==f){if(!m&&f)return(l==="audio"?u._audioSSRC:u._videoSSRC)?(N.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(l)),void this.safeEmit(Ss.USER_PUBLISHED,u,l)):void N.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),l==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,l),N.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(l)),this.safeEmit(Ss.USER_UNPUBLISHED,u,l)}}),U(this,"_handleP2PLost",async i=>{N.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():N.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),U(this,"_handleTokenWillExpire",()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ss.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),U(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),U(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ss.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ss.NETWORK_QUALITY,i)}),U(this,"_handleP2PAddAudioOrVideoStream",(i,l,A,u)=>{const m=this._users.find(b=>b.uid===l);if(!m)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));N.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(i)),this.store.subscribe(m.uid,i,void 0,void 0,void 0,Date.now());const f=i==="audio"?m.hasAudio:m.hasVideo;i==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,i==="audio"?(m._audio_added_=!0,A!==void 0&&(m._audioSSRC=A),u!==void 0&&(m._audioMid=u)):(m._video_added_=!0,A!==void 0&&(m._videoSSRC=A),u!==void 0&&(m._videoMid=u)),(i==="audio"?m.hasAudio:m.hasVideo)&&!f&&(N.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(i)),this.safeEmit(Ss.USER_PUBLISHED,m,i)),this._p2pChannel.hasPendingRemoteMedia(m,i)&&(N.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,i,!0).catch(b=>{N.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=e,this._clientId=t||dr(5,"client-"),this.store=new class{constructor(i,l,A,u,m){As(this,"state",void 0),this.state={codec:i,audioCodec:l,mode:A,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:lp.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!m}}dispatch(i){this.state=function(l,A){switch(A.type){case is.SET_SESSION_ID:return at(at({},l),{},{sessionId:A.sessionId});case is.SET_P2P_ID:return at(at({},l),{},{p2pId:A.p2pId});case is.SET_UID:return at(at({},l),{},{uid:A.uid});case is.SET_INT_UID:return at(at({},l),{},{intUid:A.intUid});case is.SET_PUB_ID:return at(at({},l),{},{pubId:A.pubId});case is.KEY_METRIC_CLIENT_CREATED:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{clientCreated:A.metric})});case is.KEY_METRIC_JOIN_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinStart:A.metric})});case is.KEY_METRIC_PRELOAD_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{preloadStart:A.metric})});case is.KEY_METRIC_PRELOAD_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{preloadEnd:A.metric})});case is.KEY_METRIC_JOIN_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinEnd:A.metric})});case is.KEY_METRIC_REQUEST_AP_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{requestAPStart:A.metric})});case is.KEY_METRIC_REQUEST_AP_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{requestAPEnd:A.metric})});case is.KEY_METRIC_REQUEST_SUA_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{requestSUAEnd:A.metric})});case is.KEY_METRIC_BEFORE_CONNECT:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{beforeConnect:A.metric})});case is.KEY_METRIC_PEER_RECEIVER:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{peerReceiver:A.metric})});case is.KEY_METRIC_SIGNAL_CONNECTED:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{signalConnected:A.metric})});case is.KEY_METRIC_JOIN_REQ:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinReq:A.metric})});case is.KEY_METRIC_JOIN_REP:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinRep:A.metric})});case is.KEY_METRIC_JOIN_GATEWAY_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinGatewayStart:A.metric})});case is.KEY_METRIC_JOIN_GATEWAY_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{joinGatewayEnd:A.metric})});case is.KEY_METRIC_PEER_CONNECTION_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{peerConnectionStart:A.metric})});case is.KEY_METRIC_PEER_CONNECTION_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{peerConnectionEnd:A.metric})});case is.KEY_METRIC_DESCRIPTION_START:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{descriptionStart:A.metric})});case is.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{signalChannelOpen:A.metric})});case is.KEY_METRIC_ICE_CONNECTION_END:return at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{iceConnectionEnd:A.metric})});case is.KEY_METRIC_PUBLISH:{const u=l.keyMetrics.publish,m=u.findIndex(f=>f.trackId===A.metric.trackId);return m!==-1?(u[m]=at(at({},u[m]),A.metric),at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{publish:[...u]})})):at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,A.metric]})})}case is.KEY_METRIC_SUBSCRIBE:{const u=l.keyMetrics.subscribe,m=u.findIndex(f=>f.userId===A.metric.userId&&f.type===A.metric.type);return m!==-1?(u[m]=at(at({},u[m]),A.metric),at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{subscribe:[...u]})})):at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,A.metric]})})}case is.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const u=l.keyMetrics.firstVideoFrameDecoded,m=u.findIndex(f=>f.userId===A.metric.userId);return m!==-1?(u[m]=at(at({},u[m]),A.metric),at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{firstVideoFrameDecoded:[...u]})})):at(at({},l),{},{keyMetrics:at(at({},l.keyMetrics),{},{firstVideoFrameDecoded:[...l.keyMetrics.firstVideoFrameDecoded,A.metric]})})}case is.RESET_FIRST_VIDEO_FRAME_DECODED:return l.keyMetrics.firstVideoFrameDecoded=[],l;case is.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=A.mode,l;case is.RECORD_JOIN_CHANNEL_SERVICE:return typeof A.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,A.record]:(l.joinChannelServiceRecords[A.index]=at(at({},l.joinChannelServiceRecords[A.index]),A.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case is.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case is.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},l;case is.SET_USE_P2P:return at(at({},l),{},{useP2P:A.val});case is.SET_TRANSPORT_TYPE:return at(at({},l),{},{p2pTransport:A.val});case is.SET_RTE_URL:return at(at({},l),{},{rteUrl:A.rteUrl});case is.SET_RTE_SID:return at(at({},l),{},{rteSid:A.rteSid});default:return l}}(this.state,i)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(i){this.state.useDcSignal=i}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(i){this.state.networkQualityProbe=i}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(i){this.dispatch({type:is.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set rteUrl(i){this.dispatch({type:is.SET_RTE_URL,rteUrl:i})}get rteUrl(){return this.state.rteUrl}set rteSid(i){this.dispatch({type:is.SET_RTE_SID,rteSid:i})}get rteSid(){return this.state.rteSid}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:is.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:is.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:is.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:is.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:is.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:is.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:is.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:is.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:is.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:is.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:is.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:is.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:is.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:is.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:is.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:is.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:is.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:is.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:is.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:is.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:is.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:is.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:is.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:is.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:is.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,l){this.dispatch({type:is.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:at({userId:i},l)})}descriptionStart(){this.dispatch({type:is.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:is.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:is.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,l,A,u){this.dispatch({type:is.KEY_METRIC_PUBLISH,metric:at(at({trackId:i,type:l},A&&{publishStart:A}),u&&{publishEnd:u})})}subscribe(i,l,A,u,m,f,b){this.dispatch({type:is.KEY_METRIC_SUBSCRIBE,metric:at(at(at(at(at({userId:i,type:l},A&&{subscribeStart:A}),u&&{subscribeEnd:u}),m&&{firstFrame:m}),f&&{streamAdded:f}),b&&{firstDecoded:b})})}massSubscribe(i,l,A,u){i.forEach(m=>{this.dispatch({type:is.KEY_METRIC_SUBSCRIBE,metric:at(at(at({userId:m.userId,type:m.type},l&&{subscribeStart:l}),A&&{subscribeEnd:A}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,l){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(A=>A.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:is.RECORD_JOIN_CHANNEL_SERVICE,record:at(at({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:is.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:is.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:is.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:is.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,G("SIGNAL_CHANNEL")===1),this._leaveMutex=new ai("client-leave",this._clientId),this._publishMutex=new ai("client-publish",this._clientId),this._renewTokenMutex=new ai("client-renewtoken",this._clientId),this._subscribeMutex=new ai("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),N.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(fc," build: ").concat(H1,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{T1(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(i){N.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var r;this._statsCollector=new rb(this.store),this._statsCollector.onStatsException=(i,l,A)=>{N.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(l,", uid: ").concat(A)),i===zN.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(u=>{u instanceof Ew&&G("ENABLE_ENCODE_EXCEPTION")&&u.findClosestProfile()}),this.safeEmit(Ss.EXCEPTION,{code:i,msg:l,uid:A})},this._statsCollector.onUploadPublishDuration=(i,l,A,u)=>{const m=this._users.find(f=>f.uid===i);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m.uid,{peerPublishDuration:A,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),Ot.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:l,videoPublishDuration:A,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(G("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){const l=this.localTracks.find(A=>A instanceof Er);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(i==="h264"?G("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Fee(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||gn,httpRetryConfig:e.httpRetryConfig||gn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new Xee(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Vl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Ep(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,s,r,i){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],A=arguments.length>6&&arguments[6]!==void 0&&arguments[6];xr("JOIN_GATEWAY_USE_443PORT_ONLY",l),xr("JOIN_GATEWAY_USE_DUAL_DOMAIN",A);const u=this._gateway.signal.websocket;return u instanceof TN&&(u.use443PortOnly=l,u.tryDoubleDomain=A),async function(m,f,b){rw.get(m)||rw.set(m,[]),nw.get(m)||nw.set(m,f),Cd.get(m)||Cd.set(m,0);const w=rw.get(m),_=nw.get(m);if(!w||!_)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Cd.get(m)===_){const K=L0();w.push(K),await K.promise}Cd.set(m,Cd.get(m)+1);for(var S=arguments.length,F=new Array(S>3?S-3:0),B=3;B<S;B++)F[B-3]=arguments[B];const j=await b(...F);return Cd.set(m,Cd.get(m)-1),Cd.get(m)===_-1&&w.length>0&&(w[0].resolve(),w.shift()),Cd.get(m)===0&&(rw.set(m,[]),nw.set(m,0),Cd.set(m,0)),j}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,s,r,i)}async join(e,t,s,r,i){const l=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const A=(dw||dw||(dw=(window.location.protocol.split(":")[0]||"").toUpperCase(),dw))==="HTTPS",u=$L()?window.isSecureContext:"Browser Not Support";(!$L()&&!A||!window.isSecureContext)&&N.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;Ot.setAppId(e);try{if(!s&&s!==null)throw new Le(W.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&bi(s,"token",1,2047),bi(e,"appid",1,2047),Lw(t),r&&jw(r),i)if(typeof i=="string")bi(i,"optionalInfo",1,256),m=i;else{if(typeof i!="object")throw new Le(W.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:j,enableInstantMuteRestore:K,networkQualityProbe:X}=i;j&&(qc(j,"autoSubscribe"),N.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),K&&(qc(K,"enableInstantMuteRestore"),N.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K),X&&(qc(X,"networkQualityProbe"),N.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(X)),this.store.networkQualityProbe=X)}}}catch(j){throw Ot.reportApiInvoke(cp(),{name:Pr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:yr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ot.reportApiInvoke(cp(),{name:Pr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:yr.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();const f=await d2({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const b=(f==null?void 0:f.sid)||cp();N.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=b,this.store.sessionId=this._sessionId);const w=Ot.reportApiInvoke(this._sessionId,{id:this._clientId,name:Pr.JOIN,options:[e,t,s,r],states:{isHttps:A,isSecureContext:u},tag:yr.TRACER}),_=nl(nl(nl({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!f},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(_.stringUid=r,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async j=>{const K=function(Ee){const me=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Re=new Uint8Array(new ArrayBuffer(me.length));for(let He=0;He<me.length;He+=1)Re[He]=me.charCodeAt(He);return Re}(),X=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),oe=S1(j),xe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},X,oe);return function(Ee){let me="";for(let Re=0;Re<Ee.length;Re+=1)me+=String.fromCharCode(Ee[Re]);return window.btoa(me)}(new Uint8Array(xe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,K=G("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(_.appId+this._encryptionSecret+this._encryptionSecret):j.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(X,oe,xe){const Ee=await window.crypto.subtle.importKey("raw",oe,"PBKDF2",!1,["deriveBits","deriveKey"]),me=X==="aes-128-gcm2"?128:256,Re=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:cj,hash:"SHA-256",salt:xe},Ee,me+gZ);return new Uint8Array(Re).subarray(me/8)}(this._encryptionMode,K,op(this._encryptionSalt)),this._encryptDataStreamKey=await async function(X,oe,xe){const Ee=await window.crypto.subtle.importKey("raw",oe,"PBKDF2",!1,["deriveBits","deriveKey"]),me=X==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:cj,hash:"SHA-256",salt:xe},Ee,{name:"AES-GCM",length:me},!0,["encrypt","decrypt"])}(this._encryptionMode,K,op(this._encryptionSalt))}else u?N.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):N.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,N.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:_.stringUid});const S=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&S===this._sessionId&&Ot.joinChannelTimeout(this._sessionId,5)},5e3);try{var F;let j;const K=_.cloudProxyServer;if(et(F=["proxy3","proxy4","proxy5"]).call(F,K)){const me=G("PROXY_SERVER_TYPE3");Array.isArray(me)?_.proxyServer=me[0]:_.proxyServer=me}if(Ot.setProxyServer(_.proxyServer),N.setProxyServer(_.proxyServer),this.store.requestAPStart(),f){if(N.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(f.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=f.intUid),j={gatewayInfo:f.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(f.ap.proxyInfo.addresses.length===0)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const me=(await XU(f.ap.proxyInfo,f.ap.gatewayInfo.uid)).map(Re=>({turnServerURL:Re.address,tcpport:Re.tcpport||Oi.tcpport,udpport:Re.udpport||Oi.udpport,username:Re.username||Oi.username,password:Re.password||Oi.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:me}}nF(f,_.stringUid)}else{if(_.stringUid&&!_.uid){let me;[me,j]=await pt.all([E4(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||gn,this.store).finally(()=>{this.store.requestSUAEnd()}),y4(_,this._axiosCancelSource.token,this._config.httpRetryConfig||gn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),N.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(me)),_.uid=me,j.gatewayInfo.uid=me,j.gatewayInfo.res.uid=me}else j=await y4(_,this._axiosCancelSource.token,this._config.httpRetryConfig||gn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(Fl.UPDATE_BITRATE_LIMIT,me=>{this._p2pChannel.updateBitrateLimit(me)}),this._configDistribute.on(Fl.UPDATE_CLIENT_ROLE_OPTIONS,me=>{this._setClientRoleOptions(me)}),this._configDistribute.on(Fl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,me=>{var Re;et(Re=[0,1,4,5,6,7,8,9]).call(Re,me)&&(this.remoteUsers.forEach(He=>{this._remoteStreamTypeCacheMap.get(He.uid)!==me&&this.setRemoteVideoStreamType(He.uid,me)}),this.setRemoteDefaultVideoStreamType(me))}),this._configDistribute.on(Fl.FALLBACK_TO_HLS,me=>{me&&this.safeEmit(Ss.FALLBACK_TO_HLS,R1.CONFIG)}),this._configDistribute.on(Fl.UPDATE_VOS_CONFIGURE,me=>{this._gateway.setConfigure(me).catch(Re=>{N.debug("[".concat(this._clientId,"] auto set vos config failed"),Re)})})},0),this._key=s||e;const X=j.gatewayInfo,oe=_.uid?_.uid:X.uid;this._joinInfo=nl(nl({},_),{},{cid:X.cid,uid:oe,vid:X.vid,apResponse:X.res,apGatewayAddress:X.apGatewayAddress,uni_lbs_ip:X.uni_lbs_ip,gatewayAddrs:X.gatewayAddrs}),this.store.intUid=oe,this.store.cid=X.cid;const xe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));w.onSuccess(xe),this._appId=e,this._channelName=_.cname,this._uid=xe,this.store.uid=xe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!ii()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Ee=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return N.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(Ee)),setTimeout(()=>{N.startUpload()},5e3),this.store.joinEnd(),B=this,et(gp).call(gp,B)||gp.push(B),this._cloudProxyServerMode==="disabled"&&Ls().supportWebCrypto&&G("ENABLE_PRELOAD")&&u2(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&Ot.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&Ot.reportRteDetail(this._sessionId)},G("RTE_DETAIL_REPORT_INTERVAL")||6e4),xe}catch(j){const K=Array.isArray(j)?j[0]:j;throw K&&K.code===W.OPERATION_ABORTED?N.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),K):N.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),K),K.code!==W.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),w.onError(K),K}var B}async _joinGateway(){if(!this._joinInfo||!this._key)throw new Le(W.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===W.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Ms.FALLBACK),N.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Le(W.INVALID_OPERATION);return Ot.reportApiInvoke(this._sessionId,{name:Pr.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:yr.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){N.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!ii()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(s){const r=gp.indexOf(s);r!==-1&&gp.splice(r,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ms.LEAVE),N.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof _f))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Le(W.INVALID_PARAMS,"param list is empty");const s=e;if(this._gateway.role==="audience")throw new Le(W.INVALID_OPERATION,"audience can not publish stream");for(const i of s){if(!(i instanceof _f))throw new Le(W.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new Le(W.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}N.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&s.forEach(i=>{const l=this._configDistribute.getBitrateLimit();i instanceof Er&&l&&i.setBitrateLimit(l.uplink)});try{await this._publishHighStream(s),N.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw N.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){if(e==null)throw new Le(W.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));_r(e.id,"id",0,65535,!0),qc(e.ordered,"ordered"),bi(e.metadata,"metadata",0,512),N.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new Le(W.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new Le(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(i){return p4(i,!1)}(e),r=await this._p2pChannel.publishDataChannel([s]);if(r.length>0){if(typeof s._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Le(W.CREATE_DATACHANNEL_ERROR);try{await pt.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await s._waitTillOpen()}catch(i){if(i.code!==W.DISCONNECT_P2P)throw i}}return N.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw N.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof _f))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);N.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(An.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),N.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw N.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),N.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));const t=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),N.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(s){throw N.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{t&&t()}}async subscribe(e,t,s){if(!(e instanceof Bu)){const r=this.remoteUsers.find(i=>i.uid===e);if(!r)throw new Le(W.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,t)}async presubscribe(e,t){if(fn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Le(W.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=t===Nt.AUDIO,r=t===Nt.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:A,rtxSsrcId:u,cname:m,uint_id:f}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new Le(W.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(_=>_.uid===e);b||(b=new Bu(e,f||e),b._is_pre_created=!0,this._users.push(b)),m&&(b._cname=m),b._uintid||(b._uintid=f||e),s&&(b._audioSSRC=l,b._audio_pre_subscribed=!0,A&&(b._audioOrtc=A)),r&&(b._videoSSRC=l,b._video_pre_subscribed=!0,A&&(b._videoOrtc=A),u!=null&&(b._rtxSsrcId=u)),N.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(b,t,l,u,A);const w=s?b._audioTrack:b._videoTrack;if(!w)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),r&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),w}catch(l){throw N.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{i()}}async _subscribeDataChannel(e,t){var s;if(_r(t,"channelId",0,65535,!0),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Le(W.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Le(W.INVALID_REMOTE_USER,"user is not published");const i=(s=e._dataChannels)===null||s===void 0?void 0:s.find(u=>u.id===t);if(!i)throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(e,[i]);if(u&&et(u).call(u,i.id))try{var A;if(typeof i._originDataChannelId!="number")throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Le(W.CREATE_DATACHANNEL_ERROR);const m={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(A=i.metadata)!==null&&A!==void 0?A:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await i._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),m;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{l()}}async _p2pSubscribe(e,t,s){if(fn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new Le(W.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!s&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const i=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const A=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,A,u)}catch(A){throw A}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(A=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),A)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{i()}}async _subscribe(e,t,s){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(fn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new Le(W.INVALID_REMOTE_USER,"user is not published");throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(s||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const f=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let i=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,A=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Nt.AUDIO:Nt.VIDEO,ssrcId:i};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const m=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const b=t==="audio"?e._audioSSRC:e._videoSSRC;b!==void 0&&b!==i&&(i=b,l=t==="audio"?e._audioOrtc:e._videoOrtc,A=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?Nt.AUDIO:Nt.VIDEO,ssrcId:i}),Qi.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,A,l);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,u,!0)}catch(w){if((w==null?void 0:w.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),w;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,e,t),b}N.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(b=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new Le(W.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),f}catch(f){throw N.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{m()}}async massSubscribe(e){if(CA(e,"subscribeList"),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),s=new Map,r=await this._subscribeMutex.lock();N.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:m,mediaType:f}=u;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(f)}).join("; ")));const i=(e=[...e]).map(u=>{let{user:m,mediaType:f}=u;return{user:m,mediaType:f}}),l=await this._p2pChannel.globalLock();try{var A;for(let m=e.length-1;m>=0;m--){const f=e[m],{user:b,mediaType:w}=f;if(fn(w,"mediaType",["audio","video"]),!b){const B=new Le(W.INVALID_PARAMS,"user property does not exist in subscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),B}if(!this._users.find(B=>B===b)){const B=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");N.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),i[m].error=B,e.splice(m,1);continue}if(w==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||w==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const B=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);N.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(w,", remote user is not published")),i[m].error=B,e.splice(m,1);continue}const S=Jn.Video|Jn.LwoVideo,F=s.get(b);if(F){if(w==="video"?F&S:F&Jn.Audio){e.splice(m,1),N.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(w," twice"));continue}s.set(b,F|(w==="video"?S:Jn.Audio))}else s.set(b,w==="video"?S:Jn.Audio)}for(let m=e.length-1;m>=0;m--){const f=e[m],{user:b,mediaType:w}=f,_=Jn.Video|Jn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,w)){await this._p2pChannel.unmuteRemoteNoLock(b,w);const S=s.get(b);s.set(b,w==="video"?S^_:S^Jn.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let u=za(A=Array.from(s.entries())).call(A,(m,f)=>{let[b,w]=f;if(w===0)return m;const _={stream_id:b.uid,stream_type:w};return w&Jn.Audio&&(_.audio_ssrc=b._audioSSRC),w&Jn.Video&&(_.video_ssrc=b._videoSSRC),m.push(_),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:b,mediaType:w}=f;return{user:b,mediaType:w,ssrcId:w===Nt.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:w===Nt.VIDEO?b._rtxSsrcId:void 0}}));const m=new Map;if(u=u.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),u.length>0){const f=await this._gateway.subscribeAll(u,!0);((f==null?void 0:f.users)||[]).forEach(b=>{let{stream_id:w,video_error_code:_,audio_error_code:S,error_code:F}=b;(_||S||F)&&m.set(w,{video_error_code:_,audio_error_code:S,error_code:F})})}if(Array.from(m.entries()).length>0){const f=[];Array.from(m.entries()).forEach(b=>{let[w,_]=b;const S=this.remoteUsers.find(F=>F.uid===w);if(S){let F;_.error_code||_.video_error_code&&_.audio_error_code?F=void 0:_.video_error_code?F=Nt.VIDEO:_.audio_error_code&&(F=Nt.AUDIO),f.push({user:S,mediaType:F})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of i){const b=m.get(f.user.uid);if(b){const w=b.error_code||f.mediaType==="audio"&&b.audio_error_code||f.mediaType==="video"&&b.video_error_code;if(w){const _=vp(w);N.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(_.desc)),f.error=new Le(W.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(_.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(i.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),i.forEach(f=>{var b;Ot.subscribe(this.store.sessionId,{succ:!!f.error,ec:((b=f.error)===null||b===void 0?void 0:b.code)||null,video:f.mediaType===Nt.VIDEO,audio:f.mediaType===Nt.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Nt.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),N.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:b,mediaType:w}=f;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(w)}).join("; "))),i}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),r()}}async unsubscribe(e,t,s){if(!(e instanceof Bu)){const l=this.remoteUsers.find(A=>A.uid===e);if(!l)throw new Le(W.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(t&&fn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&ow(this._users,e),N.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===W.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&_r(t,"id",0,65535,!0),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===e)){const i=new Le(W.INVALID_REMOTE_USER,"user is not in the channel");throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}let r;if(typeof t=="number"){const i=e._dataChannels.find(l=>l.id===t);i&&(r=[i])}else r=e._dataChannels;if(r===void 0){const i=new Le(W.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),i}N.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(e,r);i&&await this._gateway.unsubscribeDataChannel(i,e.uid),N.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===W.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");throw N.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}}async massUnsubscribe(e){if(CA(e,"unsubscribeList"),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");N.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:r,mediaType:i}=s;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];const t=new Map;for(let s=e.length-1;s>=0;s--){const{user:r,mediaType:i}=e[s];if(!r){const u=new Le(W.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw N.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(fn(i,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===r)){N.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(s,1);continue}const A=Jn.Video|Jn.LwoVideo;if(t.has(r)){const u=t.get(r);let m;switch(i){case"video":m=u&A;break;case"audio":m=u&Jn.Audio;break;default:m=u&(Jn.Audio|A)}if(m){N.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(s,1);continue}i?i==="audio"?t.set(r,u|Jn.Audio):i==="video"&&t.set(r,u|A):t.set(r,u|Jn.Audio|A)}else i?i==="audio"?t.set(r,Jn.Audio):i==="video"&&t.set(r,A):t.set(r,Jn.Audio|A)}try{const s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),N.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:i,mediaType:l}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(l,";")}).join()))}catch(s){if(s.code===W.DISCONNECT_P2P)return void N.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw N.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new Fe(W.INVALID_PARAMS);$r(s.width)||E1(s.width,"streamParameter.width"),$r(s.height)||E1(s.height,"streamParameter.height"),$r(s.framerate)||E1(s.framerate,"streamParameter.framerate"),$r(s.bitrate)||_r(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,rt.LocalVideoLowTrack)}async setDualStreamMode(e,t){fn(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(s=>{N.warning("[".concat(this._clientId,"] set dual stream mode failed"),s.toString())}):N.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case Af.AUTO_SIMULCAST_STREAM:N.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case Af.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Af.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(s){throw N.error("[".concat(this._clientId,"] set dual stream mode error"),s.toString()),s}}async enableDualStream(){if(!Ls().supportDualStream)throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Le(W.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Le(W.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=Af.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{N.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void N.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(rt.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=Af.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{N.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){fn(r,"role",["audience","host"])}(e),t&&T1(t),this.mode==="rtc"||this.mode==="p2p")throw N.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Le(W.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Le(W.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Le(W.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==s&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Ii.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),N.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),s==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Ep){const{video_codec:r}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var l;return et(l=Object.keys(dp)).call(l,i)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&T1(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{N.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const s=t.timestamp-Date.now();return Math.abs(s)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(bi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ot.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),N.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy")}if(rp(e))return this._turnServer={servers:e,mode:"original-manual"},void N.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>ML(s)),this._turnServer={servers:e,mode:"manual"},N.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"you should set license before join channel");if(bi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Le(W.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,N.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Le(W.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Le(W.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Le(W.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Le(W.INVALID_OPERATION,"Stop proxy server after leave channel");Ot.setProxyServer(),N.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Le(W.INVALID_PARAMS,"accessPoints is required.");CA(e.accessPoints.serverList,"accessPoints.serverList"),bi(e.accessPoints.domain,"accessPoints.domain");const t=(_,S)=>{_r(_,S,0,65535,!0)};let s=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Le(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(xr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),xr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,l=e.accessPoints.serverList.map(_=>r.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(i):_),A=l.map(_=>"".concat(_,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,xr("WEBCS_DOMAIN",A),xr("WEBCS_DOMAIN_BACKUP_LIST",A),xr("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(CA(e.report.hostname,"report.hostname"),xr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(xr("EVENT_REPORT_DOMAIN",l[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),xr("STATS_COLLECTOR_PORT",u),e.report?xr("ENABLE_EVENT_REPORT",!0):xr("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(CA(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),xr("LOG_UPLOAD_SERVER","".concat(m,":").concat(f));let b=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(CA(e.cds.hostname,"cds.hostname"),b=e.cds.hostname):b=l;let w=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),w=e.cds.port),xr("CDS_AP",b.map(_=>"".concat(_,":").concat(w))),e.cds?xr("ENABLE_CONFIG_DISTRIBUTE",!0):xr("ENABLE_CONFIG_DISTRIBUTE",!1),N.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(CA(e,"serverList"),bi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Le(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>s.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,xr("WEBCS_DOMAIN",e),xr("WEBCS_DOMAIN_BACKUP_LIST",e),xr("GATEWAY_DOMAINS",[t]),xr("EVENT_REPORT_DOMAIN",e[0]),xr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),xr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),N.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(fn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else N.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){fn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const s=this._users.find(r=>r.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw N.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}N.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){fn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(s){throw N.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}N.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,s,r){(function(l){fn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),bi(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(et(i).call(i,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Le(W.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Le(W.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(qc(r,"encryptDataStream"),!et(i).call(i,e))throw new Le(W.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,s&&(this._encryptionSalt=Nu(s))}async renewToken(e){if(bi(e,"token",1,2047),!this._key||!this._joinInfo)throw new Le(W.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const s=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){N.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Yee(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gn);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else N.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});N.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,N.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?N.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Ss.VOLUME_INDICATOR,e)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Le(W.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Le(W.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Le(W.LIVE_STREAMING_TASK_CONFLICT);const s=t?NA.TRANSCODE:NA.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(NA.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!t.length)throw new Le(W.INVALID_PARAMS,"can not find live streaming url to stop");await pt.all(t.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){I4(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){I4(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ep&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const i=new TextEncoder;e.payload=i.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(i,l,A){var u;const m=za(u=Array.from(A)).call(u,(B,j)=>B+j,0),f={serverTs:0,seq:bZ++,length:A.length,checkSum:m},b=new Uint8Array(YL(m,2)),w=new ArrayBuffer(gf),_=new DataView(w);_.setUint32(0,f.serverTs),_.setUint16(4,f.seq),_.setUint16(6,f.length),_.setUint16(8,f.checkSum);const S=16-A.length%16;A=GL(A,new Uint8Array(S));const F=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:oj,additionalData:b},l,A);return GL(new Uint8Array(w),new Uint8Array(F))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Le(W.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Mt.DATA_STREAM,{payload:Nu(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-nte},!s)}sendMetadata(e){if(!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Le(W.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Mt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Nu(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(NZ),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not send custom report, not joined");await Ot.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(G("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(s=>s.uid+"");Object.keys(e).forEach(s=>{et(t).call(t,s)||delete e[s]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){fn(t.spatialLayer,"spatialLayer",[0,1,2,3]),fn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(s){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:s}=e;if(qc(t,"apRTM"),_r(s,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=s,N.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(N.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Tf.indexOf(e);t!==-1&&Tf.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Da.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&rF(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&Ot.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ot.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ai("client-publish",this._clientId),this._subscribeMutex=new ai("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var s;const r=e||cp();e?N.debug("[".concat(this._clientId,"] new Session ").concat(r)):N.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,Ot.addSid(r);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};Ot.sessionInit(this._sessionId,nl({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new Le(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await s.next()).value;if(r){try{await this._gateway.sendExtensionMessage(An.PUBLISH,r,!0)}catch(i){throw s.throw(i),i}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await s.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw s.throw(l),l}await s.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of e)i instanceof Er&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(l=>{N.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===W.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Le(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Le(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await s.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw s.throw(l),l}s.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===W.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Le(W.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Vl("LiveStreaming").create(r));var r;return s.onLiveStreamError=(i,l)=>{Ot.reportApiInvoke(this._sessionId,{name:Pr.ON_LIVE_STREAM_ERROR,options:[i,l],tag:yr.TRACER}).onSuccess(),this.safeEmit(Ss.LIVE_STREAMING_ERROR,i,l)},s.onLiveStreamWarning=(i,l)=>{Ot.reportApiInvoke(this._sessionId,{name:Pr.ON_LIVE_STREAM_WARNING,options:[i,l],tag:yr.TRACER}).onSuccess(),this.safeEmit(Ss.LIVE_STREAMING_WARNING,i,l)},s.on(CN.REQUEST_WORKER_MANAGER_LIST,(i,l,A)=>{if(!this._joinInfo)return A(new Le(W.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,m,f,b){const w=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(_=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await Qee(w,u,m,f,b)})(i,this._joinInfo,this._axiosCancelSource.token,gn).then(l).catch(A)}),s};return e===NA.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Le(W.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:s}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:s}},Vl("ChannelMediaRelay").create(e));r.on("state",i=>{i===Ja.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Ss.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(Ss.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,l)=>{var A;i==="resolution"&&((A=this._channelMediaRelayClient)===null||A===void 0||A.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:s,deleted:r}=e,i=[];if(t){const l=[];this._users.forEach(A=>{A._dataChannels.forEach(u=>{s.every(m=>m.uid!==A._uintid||m.stream_id!==u.id)&&l.push({uid:A._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(s)&&s.length>0&&s.forEach(l=>{const{uid:A,stream_id:u,ordered:m,max_retrans_times:f,metadata:b}=l,w=this._users.find(_=>_._uintid===A);if(!w)return void N.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(N.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(A)),et(i).call(i,w)||i.push(w),w._uintid||(w._uintid=A),w._dataChannels.findIndex(_=>_.id===l.stream_id)===-1){const _={id:u,ordered:!!m,maxRetransmits:f,metadata:b},S=function(F){return p4(F,!0)}(_);w._dataChannels.push(S),N.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),t||this.safeEmit(Ss.USER_PUBLISHED,w,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(w,l.stream_id)&&(N.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,l.stream_id).catch(_=>{N.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),t&&(this.safeEmit(Ss.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(l=>{const{uid:A,stream_id:u}=l,m=this._users.find(b=>b._uintid===A);if(!m)return void N.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const f=m._dataChannels.find(b=>b.id===l.stream_id);f&&(N.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(A)),this._p2pChannel.unsubscribeDataChannel(m,[f]).then(b=>{if(m._dataChannels=m._dataChannels.filter(w=>w!==f),b)return this._gateway.unsubscribeDataChannel(b,m.uid)}),N.info("[".concat(this._clientId,"] remote user ").concat(A," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(Ss.USER_UNPUBLISHED,m,"datachannel",f._config))})}_getEncodingName(e){var t,s;if(!this._joinResponse)return;const r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!r)return;for(const u of r){var i;if(u.payloadType===e)return u==null||(i=u.rtpMap)===null||i===void 0?void 0:i.encodingName}const l=(s=this._joinResponse.ortc.rtpCapabilities.recv)===null||s===void 0?void 0:s.videoCodecs;if(l)for(const u of l){var A;if(u.payloadType===e)return u==null||(A=u.rtpMap)===null||A===void 0?void 0:A.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(s=>s.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){N.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const s=()=>{N.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Ss.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),s()}}else N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(dn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();Object.keys(t).forEach(r=>{const{value:i,type:l,expires:A}=t[r];A&&A<=s||l||bN()||!Object.prototype.hasOwnProperty.call(pw,r)||(Vo[r]=i,Ar[r]=i,N.debug("Update gateway parameters from config distribute",r,i))})}catch(t){N.error("Error update config from local cache",t.message)}})()}),this._gateway.on(dn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(dn.CONNECTION_STATE_CHANGE,(e,t,s)=>{var r;if(s===Ms.FALLBACK)return;const i=()=>{this.safeEmit(Ss.CONNECTION_STATE_CHANGE,e,t,s)};if(Ot.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Pr.CONNECTION_STATE_CHANGE,options:[e,t,s],tag:yr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:s})),N.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(A=>{A._trust_in_room_=!1,A._trust_audio_enabled_state_=!1,A._trust_video_enabled_state_=!1,A._trust_audio_mute_state_=!1,A._trust_video_mute_state_=!1,A._trust_audio_stream_added_state_=!1,A._trust_video_stream_added_state_=!1,A._is_pre_created||(A._audio_pre_subscribed||(A._audioSSRC=void 0,A._audioOrtc=void 0),A._video_pre_subscribed||(A._videoSSRC=void 0,A._videoOrtc=void 0,A._rtxSsrcId=void 0),A._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((A,u)=>{this._gateway.setStreamFallbackOption(u,A).catch(m=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((A,u)=>{this._gateway.setRemoteVideoStreamType(u,A).catch(m=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),G("VOS_CONFIGURE")&&Array.isArray(G("VOS_CONFIGURE"))&&G("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(G("VOS_CONFIGURE")).catch(A=>{N.debug("[".concat(this._clientId,"] auto set vos config failed"),A)}),N.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(A=>{N.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(A))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(A=>{N.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),A)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(A=>!A._trust_in_room_).forEach(A=>{N.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(A.uid)),this._handleUserOffline({uid:A.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(A=>{A._trust_audio_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,Nt.AUDIO,!1)),A._trust_video_mute_state_||(N.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,Nt.VIDEO,!1)),A._trust_audio_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(A.uid)),this._handleSetStreamLocalEnable("audio",A.uid,!0)),A._trust_video_enabled_state_||(N.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(A.uid)),this._handleSetStreamLocalEnable("video",A.uid,!0)),A._trust_video_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(A.uid)),this._handleResetAddStream(A,"video")),A._trust_audio_stream_added_state_||(N.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(A.uid)),this._handleResetAddStream(A,"audio")),A._video_added_||A._audio_added_||(N.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(A.uid)),this._handleRemoveStream({uid:A.uid,uint_id:A._uintid}))}))},1e3))}i()}),this._gateway.on(dn.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Le(W.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;if(this._fallbackServerInfo)s=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,Ot.reportApiInvoke(this._sessionId,{name:Pr.VOS_FALLBACK_CN,options:{cur:s.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:yr.TRACER}).onSuccess(),N.info("[".concat(this._clientId,"] use fallback cn server info"));else{const i=await d2(nl(nl({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(s=i.ap,nF(i),this._joinInfo.preload=!0):(s=await Jw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const r=[];s.gatewayInfo.gatewayAddrs.forEach(i=>{let{address:l}=i;const[A,u]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:A,port:u}):r.push({host:A,port:u})}),e(r)}catch(s){t(s)}}),this._gateway.on(dn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ss.NETWORK_QUALITY,e)}),this._gateway.on(dn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ss.STREAM_TYPE_CHANGED,e,t),Ot.reportApiInvoke(this._sessionId,{name:Pr.STREAM_TYPE_CHANGE,options:[e,t],tag:yr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(dn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(dn.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,s)=>{try{let r=await this._p2pChannel.getEstablishParams();r&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){s(r)}}),this._gateway.on(dn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let s;this._joinResponse=e,e.attributes?s=e.attributes.userAttributes.preSubSsrcs:N.debug("no attributes in joinResponse");const r=n4(e.ortc,t,s);this._p2pChannel.connect(r)}),this._gateway.on(dn.PRE_CONNECT_PC,async(e,t,s)=>{const{candidates:r,fingerprint:i,turnServer:l}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:u,cid:m}=this._joinInfo.apResponse,f="".concat(m,"_").concat(u);if(f.length<4||f.length>256)return void N.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(f.length));await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var A;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(m,"_").concat(u),icePwd:"".concat(m,"_").concat(u)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(A=G("FINGERPRINT"))!==null&&A!==void 0?A:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(b){b.code&&b.code===W.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),s(b)}}}),this._gateway.on(dn.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Ss.FALLBACK_TO_HLS,R1.VOSERROR)}),this._gateway.on(dn.RESET_SIGNAL,()=>{this._p2pChannel instanceof Ep&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(dn.DATACHANNEL_FAILBACK,()=>{Ot.reportApiInvoke(this._sessionId,{name:Pr.DATACHANNEL_FAILBACK,options:{},tag:yr.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(as.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(as.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(as.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(as.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(as.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(as.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(as.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(as.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(as.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Nt.AUDIO,!0)),this._gateway.signal.on(as.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Nt.AUDIO,!1)),this._gateway.signal.on(as.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Nt.VIDEO,!0)),this._gateway.signal.on(as.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Nt.VIDEO,!1)),this._gateway.signal.on(as.RECEIVE_METADATA,e=>{const t=op(e.metadata);this.safeEmit(Ss.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(as.ON_DATA_STREAM,async e=>{var t;if(!e)return;let s=op(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&et(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<gf)throw new Le(W.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(gf));s=await async function(l,A,u){const m=u.subarray(0,gf),f=m.slice(8,gf),b=(f[0]<<8)+f[1],w=(m[6]<<8)+m[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:oj,additionalData:new Uint8Array(YL(b,2))},A,u.subarray(gf));return new Uint8Array(_).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let r=0;if(e.ordered||e.syncWithAudio){const i=this._p2pChannel.getStats(),l=this.remoteUsers.find(u=>u.uid===e.uid),A=i==null?void 0:i.audioRecv.find(u=>u.ssrc===(l==null?void 0:l._audioSSRC));r=A==null?void 0:A.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),ate(nl(nl({},e),{},{payload:s}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(as.ON_CRYPT_ERROR,()=>{Su(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ss.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(as.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ms.TOKEN_EXPIRE),this.safeEmit(Ss.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(as.ON_STREAM_FALLBACK_UPDATE,e=>{N.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ss.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(as.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===Af.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{N.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(as.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),N.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(as.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(as.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Bt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Mt.PUBLISH:{if(!t)return;const i=t.ortc;if(i){var s,r;const l=i.some(m=>{let{stream_type:f}=m;return f===ur.Audio}),A=i.some(m=>{let{stream_type:f}=m;return f!==ur.Audio}),u=i.some(m=>{let{stream_type:f}=m;return f===ur.Screen||f===ur.ScreenLow});t.state==="offer"&&Ot.publish(this._joinInfo.sid,{eventElapse:Qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:W.TIMEOUT,audio:l,video:A,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:l?(s=i.find(m=>{let{stream_type:f}=m;return f===ur.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:A?(r=i.find(m=>{let{stream_type:f}=m;return f!==ur.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Mt.SUBSCRIBE:t&&Ot.subscribe(this._joinInfo.sid,{succ:!1,ec:W.TIMEOUT,audio:t.stream_type===Nt.AUDIO,video:t.stream_type===Nt.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Qi.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(as.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(as.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;G("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!bp(r.string_id||r.stream_id,this.channelName)));const t=[],s=[];for(const r of e.users){let i=this._users.find(b=>b._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Bu(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(Ss.PUBLISHED_USER_LIST).length===0&&(N.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ss.USER_JOINED,i)));const l=Jn.Audio&r.stream_type,A=(Jn.Video|Jn.LwoVideo)&r.stream_type,u=(65280&r.stream_type)!=0,m=l&&i.hasAudio,f=A&&i.hasVideo;A&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),l&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),l&&!m&&this.getListeners(Ss.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Ss.USER_PUBLISHED,i,"audio")),A&&!f&&this.getListeners(Ss.PUBLISHED_USER_LIST).length===0&&(N.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Ss.USER_PUBLISHED,i,"video")),(l&&!m||A&&!f||u)&&t.push(i),A&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&s.push({user:i,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&s.push({user:i,mediaType:"audio"})}s.length>0&&(N.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(r=>{N.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Ss.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(N.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Ss.PUBLISHED_USER_LIST,t)):N.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(as.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof Ep){if(this.role==="audience"&&G("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void N.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(s=>s.toLowerCase()).filter(s=>{var r;return et(r=Object.keys(dp)).call(r,s)}))}}),this._gateway.signal.on(Bt.VOS_FALLBACK_PROMISE,async(e,t,s)=>{if(e==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return s(new Le(W.UNEXPECTED_ERROR,"can not recover, no join info"));N.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const i=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const l=await Jw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gn,this.store);if(G("QUALITY_FALLBACK_REHEARSAL"))return Ot.reportApiInvoke(this._sessionId,{name:Pr.VOS_FALLBACK_CN,options:{cur:l.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:yr.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i,void s();this._fallbackServerInfo=l,t()}catch(l){var r;const A=l==null||(r=l.data)===null||r===void 0?void 0:r.desc;G("QUALITY_FALLBACK_REHEARSAL")?(Ot.reportApiInvoke(this._sessionId,{name:Pr.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+A||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:yr.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=i):Array.isArray(A)&&et(A).call(A,"request downgrade fallback")&&this.safeEmit(Ss.FALLBACK_TO_HLS,R1.AP_ERROR),s(l)}}else s()})}_handleP2PEvents(){this._gateway.signal.on(as.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(An.PUBLISH,(e,t,s)=>{const{uid:r}=e;e.forEach(i=>{const{kind:l,ssrcs:A,mid:u,isMuted:m}=i;this._handleP2PAddAudioOrVideoStream(l,r,A[0].ssrcId,u);const f=this._users.find(b=>b.uid===r);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,l,A[0].ssrcId,u).then(()=>{t()}).catch(s):t(),this._handleMuteStream(r,l,!!m)})}),this._gateway.signal.on(An.CALL,async(e,t,s)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(i){s(i)}}),this._gateway.signal.on(Bt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(An.UNPUBLISH,async(e,t,s)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,l=this._users.find(A=>A.uid===i);if(!l)return N.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async A=>{let{stream_type:u}=A;const m=u===ur.Audio?Nt.AUDIO:Nt.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(i,m,!0)}),t()}catch(A){s(A)}}}),this._gateway.signal.on(An.CONTROL,async(e,t)=>{const{action:s}=e;switch(s){case Ou.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Nt.VIDEO,!0);break;case Ou.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Nt.AUDIO,!0);break;case Ou.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Nt.VIDEO,!1);break;case Ou.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Nt.AUDIO,!1)}}),this._gateway.signal.on(An.RESTART_ICE,async(e,t,s)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:i}=e;r!==wa.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){s(r)}}),this._gateway.signal.on(An.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:s}=e;this._p2pChannel.addRemoteCandidate(t,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(e,t,s)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(An.RESTART_ICE,e,r===wa.SEND_ONLY))}catch(r){s(r)}}),this._p2pChannel.on(Vt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(An.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(e,t,s)=>{try{await this._gateway.sendExtensionMessage(An.CONTROL,e,!0),t()}catch(r){s(r)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.StateChange,(e,t)=>{t===ir.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Ss.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(e,t,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===W.DISCONNECT_P2P?t():s(r)}else t()}),this._p2pChannel.on(Vt.RequestRePublish,(e,t,s)=>{this.publish(e,!1).then(t).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(e,t,s)=>{pt.all(e.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==W.DISCONNECT_P2P)throw l}})).then(t).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(e,t,s)=>{try{for(const{user:r,kind:i}of e)i===Nt.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){s(r)}}),this._p2pChannel.on(Vt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Vt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Vt.MediaReconnectStart,e=>{this.safeEmit(Ss.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Vt.MediaReconnectEnd,e=>{this.safeEmit(Ss.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Vt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),s=await t.next();if(s.done)return;const r=s.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(A){return void t.throw(A)}const{iceParameters:l}=function(A){const u=A.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(i);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:s,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:s,rtpCapabilities:r}),A=n4(i,l);await this._p2pChannel.connect(A),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(e,t,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(Ss.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,e=>{this.safeEmit(Ss.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Vt.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Ss.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Vt.FirstVideoPreRender,(e,t)=>{this.safeEmit(Ss.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,e=>{this.safeEmit(Ss.AUDIO_METADATA,e)}),this._p2pChannel.on(Vt.AudioPts,e=>{this.safeEmit(Ss.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(t={config:e},Vl("ContentInspect").create(t));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:r,cname:i,sid:l,token:A,uid:u,cid:m,vid:f}=this._joinInfo;await s.init({appId:r,areaCode:"",cname:i,sid:l,token:A,uid:u,cid:m,vid:f?Number(f):0},gn)}catch(s){throw Array.isArray(s)?s[0]:s}var t}handleVideoInspectEvents(e){e.on(ci.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Ss.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,s),s===Zc.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ss.CONTENT_INSPECT_ERROR,new Le(W.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(ci.INSPECT_RESULT,(t,s)=>{var r;if((s==null?void 0:s.code)===W.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return N.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Ss.CONTENT_INSPECT_RESULT,t,s)}),e.on(ci.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(qc(e,"enabled"),e){if(!t)throw new Le(W.INVALID_PARAMS,"config is required");if(bF(t),!this._joinInfo)throw new Le(W.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(s={config:t},Vl("ImageModeration").create(s));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:l,sid:A,token:u,uid:m,cid:f,vid:b}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:l,sid:A,token:u,uid:m,cid:f,vid:b?Number(b):0},gn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var s;if(!this._moderation)throw new Le(W.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(Ml.CONNECTION_STATE_CHANGE,(t,s)=>{if(this.safeEmit(Ss.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,s),t===wc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Le(W.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Ml.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){fn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Le(W.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,N.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return N.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){qc(e,"enabled"),xr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ft(Et.prototype,"leave",[xF],Object.getOwnPropertyDescriptor(Et.prototype,"leave"),Et.prototype),ft(Et.prototype,"publish",[vF],Object.getOwnPropertyDescriptor(Et.prototype,"publish"),Et.prototype),ft(Et.prototype,"unpublish",[wF],Object.getOwnPropertyDescriptor(Et.prototype,"unpublish"),Et.prototype),ft(Et.prototype,"subscribe",[_F],Object.getOwnPropertyDescriptor(Et.prototype,"subscribe"),Et.prototype),ft(Et.prototype,"presubscribe",[yF],Object.getOwnPropertyDescriptor(Et.prototype,"presubscribe"),Et.prototype),ft(Et.prototype,"massSubscribe",[EF],Object.getOwnPropertyDescriptor(Et.prototype,"massSubscribe"),Et.prototype),ft(Et.prototype,"unsubscribe",[CF],Object.getOwnPropertyDescriptor(Et.prototype,"unsubscribe"),Et.prototype),ft(Et.prototype,"massUnsubscribe",[SF],Object.getOwnPropertyDescriptor(Et.prototype,"massUnsubscribe"),Et.prototype),ft(Et.prototype,"setLowStreamParameter",[NF],Object.getOwnPropertyDescriptor(Et.prototype,"setLowStreamParameter"),Et.prototype),ft(Et.prototype,"setDualStreamMode",[TF],Object.getOwnPropertyDescriptor(Et.prototype,"setDualStreamMode"),Et.prototype),ft(Et.prototype,"enableDualStream",[RF],Object.getOwnPropertyDescriptor(Et.prototype,"enableDualStream"),Et.prototype),ft(Et.prototype,"disableDualStream",[IF],Object.getOwnPropertyDescriptor(Et.prototype,"disableDualStream"),Et.prototype),ft(Et.prototype,"setClientRole",[OF],Object.getOwnPropertyDescriptor(Et.prototype,"setClientRole"),Et.prototype),ft(Et.prototype,"_setClientRoleOptions",[kF],Object.getOwnPropertyDescriptor(Et.prototype,"_setClientRoleOptions"),Et.prototype),ft(Et.prototype,"setProxyServer",[DF],Object.getOwnPropertyDescriptor(Et.prototype,"setProxyServer"),Et.prototype),ft(Et.prototype,"setTurnServer",[BF],Object.getOwnPropertyDescriptor(Et.prototype,"setTurnServer"),Et.prototype),ft(Et.prototype,"setLicense",[LF],Object.getOwnPropertyDescriptor(Et.prototype,"setLicense"),Et.prototype),ft(Et.prototype,"startProxyServer",[jF],Object.getOwnPropertyDescriptor(Et.prototype,"startProxyServer"),Et.prototype),ft(Et.prototype,"stopProxyServer",[PF],Object.getOwnPropertyDescriptor(Et.prototype,"stopProxyServer"),Et.prototype),ft(Et.prototype,"setLocalAccessPointsV2",[UF],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPointsV2"),Et.prototype),ft(Et.prototype,"setLocalAccessPoints",[FF],Object.getOwnPropertyDescriptor(Et.prototype,"setLocalAccessPoints"),Et.prototype),ft(Et.prototype,"setRemoteDefaultVideoStreamType",[MF],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteDefaultVideoStreamType"),Et.prototype),ft(Et.prototype,"setRemoteVideoStreamType",[VF],Object.getOwnPropertyDescriptor(Et.prototype,"setRemoteVideoStreamType"),Et.prototype),ft(Et.prototype,"setStreamFallbackOption",[QF],Object.getOwnPropertyDescriptor(Et.prototype,"setStreamFallbackOption"),Et.prototype),ft(Et.prototype,"setEncryptionConfig",[HF],Object.getOwnPropertyDescriptor(Et.prototype,"setEncryptionConfig"),Et.prototype),ft(Et.prototype,"renewToken",[GF],Object.getOwnPropertyDescriptor(Et.prototype,"renewToken"),Et.prototype),ft(Et.prototype,"enableAudioVolumeIndicator",[KF],Object.getOwnPropertyDescriptor(Et.prototype,"enableAudioVolumeIndicator"),Et.prototype),ft(Et.prototype,"startLiveStreaming",[WF],Object.getOwnPropertyDescriptor(Et.prototype,"startLiveStreaming"),Et.prototype),ft(Et.prototype,"setLiveTranscoding",[zF],Object.getOwnPropertyDescriptor(Et.prototype,"setLiveTranscoding"),Et.prototype),ft(Et.prototype,"stopLiveStreaming",[qF],Object.getOwnPropertyDescriptor(Et.prototype,"stopLiveStreaming"),Et.prototype),ft(Et.prototype,"startChannelMediaRelay",[YF],Object.getOwnPropertyDescriptor(Et.prototype,"startChannelMediaRelay"),Et.prototype),ft(Et.prototype,"updateChannelMediaRelay",[XF],Object.getOwnPropertyDescriptor(Et.prototype,"updateChannelMediaRelay"),Et.prototype),ft(Et.prototype,"stopChannelMediaRelay",[JF],Object.getOwnPropertyDescriptor(Et.prototype,"stopChannelMediaRelay"),Et.prototype),ft(Et.prototype,"sendCustomReportMessage",[$F],Object.getOwnPropertyDescriptor(Et.prototype,"sendCustomReportMessage"),Et.prototype),ft(Et.prototype,"pickSVCLayer",[ZF],Object.getOwnPropertyDescriptor(Et.prototype,"pickSVCLayer"),Et.prototype),ft(Et.prototype,"setRTMConfig",[eM],Object.getOwnPropertyDescriptor(Et.prototype,"setRTMConfig"),Et.prototype),ft(Et.prototype,"enableContentInspect",[tM],Object.getOwnPropertyDescriptor(Et.prototype,"enableContentInspect"),Et.prototype),ft(Et.prototype,"disableContentInspect",[sM],Object.getOwnPropertyDescriptor(Et.prototype,"disableContentInspect"),Et.prototype),ft(Et.prototype,"setImageModeration",[rM],Object.getOwnPropertyDescriptor(Et.prototype,"setImageModeration"),Et.prototype),ft(Et.prototype,"setP2PTransport",[nM],Object.getOwnPropertyDescriptor(Et.prototype,"setP2PTransport"),Et.prototype),ft(Et.prototype,"getJoinChannelServiceRecords",[iM],Object.getOwnPropertyDescriptor(Et.prototype,"getJoinChannelServiceRecords"),Et.prototype),ft(Et.prototype,"setPublishAudioFilterEnabled",[aM],Object.getOwnPropertyDescriptor(Et.prototype,"setPublishAudioFilterEnabled"),Et.prototype),Et);function cM(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=dr(5,"client-"),r=Ot.reportApiInvoke(null,{id:s,name:Pr.CREATE_CLIENT,options:[t],tag:yr.TRACER});try{(function(i){fn(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),fn(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&fn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&bi(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&ML(i.turnServer),i.httpRetryConfig!==void 0&&FL(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&FL(i.websocketRetryConfig)})(t)}catch(i){throw r.onError(i),i}return(SL(16,0,!0)||_1(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",N.debug("browser not support vp9, force use vp8")),xr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new _te(nl(nl({forceWaitGatewayResponse:!0},t),{},{role:et(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),s)}function yte(){let e=!1;const t=$s();return(t.name===er.CHROME&&Number(t.version)>=58&&(Bl.engine.name!=="WebKit"||function(){const s=$s();if(aw()){if(s.os===qn.MAC_OS)return!0;if(s.os===qn.IOS){const r=Bl.os.version&&Bl.os.version.split(".");if(r&&Number(r[0])===14&&r[1]&&Number(r[1])>=3||r&&Number(r[0])>14)return!0}}return!1}())||t.name===er.FIREFOX&&Number(t.version)>=56||t.name===er.OPERA&&Number(t.version)>=45||t.name===er.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Xi()||zc())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||RL()||$s().name===er.QQ)&&(e=!0),e}class cb{constructor(t,s){U(this,"id",0),U(this,"element",void 0),U(this,"peerPair",void 0),U(this,"context",void 0),U(this,"audioPlayerElement",void 0),U(this,"audioTrack",void 0),cb.count+=1,this.id=cb.count,this.element=t,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const s=document.createElement("audio");s.srcObject=new MediaStream([t.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const t=async(r,i)=>{const l=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(l),r.iceGatheringState==="complete"?r.localDescription:new pt(A=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&A(r.localDescription)}})},s=async(r,i)=>await r.setRemoteDescription(i);try{const r=await t(this.peerPair[0],"offer");await s(this.peerPair[1],r);const i=await t(this.peerPair[1],"answer");await s(this.peerPair[0],i)}catch(r){throw new Le(W.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let s;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(s)}catch(i){throw new Le(W.LOCAL_AEC_ERROR,i.toString()).print()}if(!s)throw new Le(W.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=s.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,s=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var lM,d_;U(cb,"count",0);const Ete=window.AudioContext||window.webkitAudioContext,Cte=new(lM=$t({report:Ot}),ft((d_=class{constructor(){U(this,"units",[]),U(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ete);let t=this.units.find(s=>s&&s.getElement()===e);return t||(t=new cb(e,this.context),this.units.push(t)),t.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return $s().name!==er.SAFARI}}).prototype,"processExternalMediaAEC",[lM],Object.getOwnPropertyDescriptor(d_.prototype,"processExternalMediaAEC"),d_.prototype),d_);function dM(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function AM(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?dM(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):dM(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}const m2=window||document;function uM(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!m2)return;const s=Sn._cspEventHandlerPointer;if(s&&t)return void console.error(s,t);const r=i=>{if(!(i&&i.blockedURI&&(Sn.onSecurityPolicyViolation||Sn.getListeners(Id.SECURITY_POLICY_VIOLATION).length>0)))return;const l=i.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(A=>et(l).call(l,A))&&(Sn.onSecurityPolicyViolation&&typeof Sn.onSecurityPolicyViolation=="function"&&Sn.onSecurityPolicyViolation(i),Sn.getListeners(Id.SECURITY_POLICY_VIOLATION).length>0&&Sn.safeEmit(Id.SECURITY_POLICY_VIOLATION,i))};s&&m2.removeEventListener("securitypolicyviolation",s),(t||e&&typeof e=="function"||Sn.getListeners(Id.SECURITY_POLICY_VIOLATION).length>0)&&m2.addEventListener("securitypolicyviolation",r),Sn._cspEventHandlerPointer=r}var Ste=O,Nte=TS,hM=RegExp.prototype,Tte=function(e){return e===hM||Ste(hM,e)?Nte(e):e.flags},aa=h(Tte);function Hf(e){let t=e.length;for(;--t>=0;)e[t]=0}const f2=256,pM=286,lb=30,db=15,g2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),A_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rte=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),mM=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),OA=new Array(576);Hf(OA);const Ab=new Array(60);Hf(Ab);const ub=new Array(512);Hf(ub);const hb=new Array(256);Hf(hb);const b2=new Array(29);Hf(b2);const u_=new Array(lb);function x2(e,t,s,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let fM,gM,bM;function v2(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Hf(u_);const xM=e=>e<256?ub[e]:ub[256+(e>>>7)],pb=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Yo=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,pb(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},jd=(e,t,s)=>{Yo(e,s[2*t],s[2*t+1])},vM=(e,t)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--t>0);return s>>>1},wM=(e,t,s)=>{const r=new Array(16);let i,l,A=0;for(i=1;i<=db;i++)A=A+s[i-1]<<1,r[i]=A;for(l=0;l<=t;l++){let u=e[2*l+1];u!==0&&(e[2*l]=vM(r[u]++,u))}},_M=e=>{let t;for(t=0;t<pM;t++)e.dyn_ltree[2*t]=0;for(t=0;t<lb;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},yM=e=>{e.bi_valid>8?pb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},EM=(e,t,s,r)=>{const i=2*t,l=2*s;return e[i]<e[l]||e[i]===e[l]&&r[t]<=r[s]},w2=(e,t,s)=>{const r=e.heap[s];let i=s<<1;for(;i<=e.heap_len&&(i<e.heap_len&&EM(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!EM(t,r,e.heap[i],e.depth));)e.heap[s]=e.heap[i],s=i,i<<=1;e.heap[s]=r},CM=(e,t,s)=>{let r,i,l,A,u=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+u++],r+=(255&e.pending_buf[e.sym_buf+u++])<<8,i=e.pending_buf[e.sym_buf+u++],r===0?jd(e,i,t):(l=hb[i],jd(e,l+f2+1,t),A=g2[l],A!==0&&(i-=b2[l],Yo(e,i,A)),r--,l=xM(r),jd(e,l,s),A=A_[l],A!==0&&(r-=u_[l],Yo(e,r,A)));while(u<e.sym_next);jd(e,256,t)},_2=(e,t)=>{const s=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,l=t.stat_desc.elems;let A,u,m,f=-1;for(e.heap_len=0,e.heap_max=573,A=0;A<l;A++)s[2*A]!==0?(e.heap[++e.heap_len]=f=A,e.depth[A]=0):s[2*A+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=f<2?++f:0,s[2*m]=1,e.depth[m]=0,e.opt_len--,i&&(e.static_len-=r[2*m+1]);for(t.max_code=f,A=e.heap_len>>1;A>=1;A--)w2(e,s,A);m=l;do A=e.heap[1],e.heap[1]=e.heap[e.heap_len--],w2(e,s,1),u=e.heap[1],e.heap[--e.heap_max]=A,e.heap[--e.heap_max]=u,s[2*m]=s[2*A]+s[2*u],e.depth[m]=(e.depth[A]>=e.depth[u]?e.depth[A]:e.depth[u])+1,s[2*A+1]=s[2*u+1]=m,e.heap[1]=m++,w2(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((b,w)=>{const _=w.dyn_tree,S=w.max_code,F=w.stat_desc.static_tree,B=w.stat_desc.has_stree,j=w.stat_desc.extra_bits,K=w.stat_desc.extra_base,X=w.stat_desc.max_length;let oe,xe,Ee,me,Re,He,Xe=0;for(me=0;me<=db;me++)b.bl_count[me]=0;for(_[2*b.heap[b.heap_max]+1]=0,oe=b.heap_max+1;oe<573;oe++)xe=b.heap[oe],me=_[2*_[2*xe+1]+1]+1,me>X&&(me=X,Xe++),_[2*xe+1]=me,xe>S||(b.bl_count[me]++,Re=0,xe>=K&&(Re=j[xe-K]),He=_[2*xe],b.opt_len+=He*(me+Re),B&&(b.static_len+=He*(F[2*xe+1]+Re)));if(Xe!==0){do{for(me=X-1;b.bl_count[me]===0;)me--;b.bl_count[me]--,b.bl_count[me+1]+=2,b.bl_count[X]--,Xe-=2}while(Xe>0);for(me=X;me!==0;me--)for(xe=b.bl_count[me];xe!==0;)Ee=b.heap[--oe],Ee>S||(_[2*Ee+1]!==me&&(b.opt_len+=(me-_[2*Ee+1])*_[2*Ee],_[2*Ee+1]=me),xe--)}})(e,t),wM(s,f,e.bl_count)},SM=(e,t,s)=>{let r,i,l=-1,A=t[1],u=0,m=7,f=4;for(A===0&&(m=138,f=3),t[2*(s+1)+1]=65535,r=0;r<=s;r++)i=A,A=t[2*(r+1)+1],++u<m&&i===A||(u<f?e.bl_tree[2*i]+=u:i!==0?(i!==l&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,l=i,A===0?(m=138,f=3):i===A?(m=6,f=3):(m=7,f=4))},NM=(e,t,s)=>{let r,i,l=-1,A=t[1],u=0,m=7,f=4;for(A===0&&(m=138,f=3),r=0;r<=s;r++)if(i=A,A=t[2*(r+1)+1],!(++u<m&&i===A)){if(u<f)do jd(e,i,e.bl_tree);while(--u!=0);else i!==0?(i!==l&&(jd(e,i,e.bl_tree),u--),jd(e,16,e.bl_tree),Yo(e,u-3,2)):u<=10?(jd(e,17,e.bl_tree),Yo(e,u-3,3)):(jd(e,18,e.bl_tree),Yo(e,u-11,7));u=0,l=i,A===0?(m=138,f=3):i===A?(m=6,f=3):(m=7,f=4)}};let TM=!1;const RM=(e,t,s,r)=>{Yo(e,0+(r?1:0),3),yM(e),pb(e,s),pb(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var Ite=e=>{TM||((()=>{let t,s,r,i,l;const A=new Array(16);for(r=0,i=0;i<28;i++)for(b2[i]=r,t=0;t<1<<g2[i];t++)hb[r++]=i;for(hb[r-1]=i,l=0,i=0;i<16;i++)for(u_[i]=l,t=0;t<1<<A_[i];t++)ub[l++]=i;for(l>>=7;i<lb;i++)for(u_[i]=l<<7,t=0;t<1<<A_[i]-7;t++)ub[256+l++]=i;for(s=0;s<=db;s++)A[s]=0;for(t=0;t<=143;)OA[2*t+1]=8,t++,A[8]++;for(;t<=255;)OA[2*t+1]=9,t++,A[9]++;for(;t<=279;)OA[2*t+1]=7,t++,A[7]++;for(;t<=287;)OA[2*t+1]=8,t++,A[8]++;for(wM(OA,287,A),t=0;t<lb;t++)Ab[2*t+1]=5,Ab[2*t]=vM(t,5);fM=new x2(OA,g2,257,pM,db),gM=new x2(Ab,A_,0,lb,db),bM=new x2(new Array(0),Rte,0,19,7)})(),TM=!0),e.l_desc=new v2(e.dyn_ltree,fM),e.d_desc=new v2(e.dyn_dtree,gM),e.bl_desc=new v2(e.bl_tree,bM),e.bi_buf=0,e.bi_valid=0,_M(e)},Ote=(e,t,s,r)=>{let i,l,A=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let m,f=4093624447;for(m=0;m<=31;m++,f>>>=1)if(1&f&&u.dyn_ltree[2*m]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(m=32;m<f2;m++)if(u.dyn_ltree[2*m]!==0)return 1;return 0})(e)),_2(e,e.l_desc),_2(e,e.d_desc),A=(u=>{let m;for(SM(u,u.dyn_ltree,u.l_desc.max_code),SM(u,u.dyn_dtree,u.d_desc.max_code),_2(u,u.bl_desc),m=18;m>=3&&u.bl_tree[2*mM[m]+1]===0;m--);return u.opt_len+=3*(m+1)+5+5+4,m})(e),i=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=i&&(i=l)):i=l=s+5,s+4<=i&&t!==-1?RM(e,t,s,r):e.strategy===4||l===i?(Yo(e,2+(r?1:0),3),CM(e,OA,Ab)):(Yo(e,4+(r?1:0),3),((u,m,f,b)=>{let w;for(Yo(u,m-257,5),Yo(u,f-1,5),Yo(u,b-4,4),w=0;w<b;w++)Yo(u,u.bl_tree[2*mM[w]+1],3);NM(u,u.dyn_ltree,m-1),NM(u,u.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,A+1),CM(e,e.dyn_ltree,e.dyn_dtree)),_M(e),r&&yM(e)},kte=(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,t===0?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(hb[s]+f2+1)]++,e.dyn_dtree[2*xM(t)]++),e.sym_next===e.sym_end),Dte=e=>{Yo(e,2,3),jd(e,256,OA),(t=>{t.bi_valid===16?(pb(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Bte={_tr_init:Ite,_tr_stored_block:RM,_tr_flush_block:Ote,_tr_tally:kte,_tr_align:Dte},mb=(e,t,s,r)=>{let i=65535&e|0,l=e>>>16&65535|0,A=0;for(;s!==0;){A=s>2e3?2e3:s,s-=A;do i=i+t[r++]|0,l=l+i|0;while(--A);i%=65521,l%=65521}return i|l<<16|0};const Lte=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var _a=(e,t,s,r)=>{const i=Lte,l=r+s;e^=-1;for(let A=r;A<l;A++)e=e>>>8^i[255&(e^t[A])];return-1^e},Np={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},h_={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:jte,_tr_stored_block:y2,_tr_flush_block:Pte,_tr_tally:Uu,_tr_align:Ute}=Bte,{Z_NO_FLUSH:Fu,Z_PARTIAL_FLUSH:Fte,Z_FULL_FLUSH:Mte,Z_FINISH:il,Z_BLOCK:IM,Z_OK:Fa,Z_STREAM_END:OM,Z_STREAM_ERROR:Pd,Z_DATA_ERROR:Vte,Z_BUF_ERROR:E2,Z_DEFAULT_COMPRESSION:Qte,Z_FILTERED:Hte,Z_HUFFMAN_ONLY:p_,Z_RLE:Gte,Z_FIXED:Kte,Z_DEFAULT_STRATEGY:Wte,Z_UNKNOWN:zte,Z_DEFLATED:m_}=h_,C2=286,qte=30,Yte=19,Xte=2*C2+1,Jte=15,Tp=258,Ud=262,Gf=42,Rp=113,fb=666,Ip=(e,t)=>(e.msg=Np[t],t),kM=e=>2*e-(e>4?9:0),Mu=e=>{let t=e.length;for(;--t>=0;)e[t]=0},$te=e=>{let t,s,r,i=e.w_size;t=e.hash_size,r=t;do s=e.head[--r],e.head[r]=s>=i?s-i:0;while(--t);t=i,r=t;do s=e.prev[--r],e.prev[r]=s>=i?s-i:0;while(--t)};let Vu=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const _c=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,t.pending===0&&(t.pending_out=0))},yc=(e,t)=>{Pte(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_c(e.strm)},on=(e,t)=>{e.pending_buf[e.pending++]=t},gb=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},S2=(e,t,s,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),s),e.state.wrap===1?e.adler=mb(e.adler,t,i,s):e.state.wrap===2&&(e.adler=_a(e.adler,t,i,s)),e.next_in+=i,e.total_in+=i,i)},DM=(e,t)=>{let s,r,i=e.max_chain_length,l=e.strstart,A=e.prev_length,u=e.nice_match;const m=e.strstart>e.w_size-Ud?e.strstart-(e.w_size-Ud):0,f=e.window,b=e.w_mask,w=e.prev,_=e.strstart+Tp;let S=f[l+A-1],F=f[l+A];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do if(s=t,f[s+A]===F&&f[s+A-1]===S&&f[s]===f[l]&&f[++s]===f[l+1]){l+=2,s++;do;while(f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&f[++l]===f[++s]&&l<_);if(r=Tp-(_-l),l=_-Tp,r>A){if(e.match_start=t,A=r,r>=u)break;S=f[l+A-1],F=f[l+A]}}while((t=w[t&b])>m&&--i!=0);return A<=e.lookahead?A:e.lookahead},Kf=e=>{const t=e.w_size;let s,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Ud)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),$te(e),r+=t),e.strm.avail_in===0)break;if(s=S2(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=s,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Vu(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Vu(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ud&&e.strm.avail_in!==0)},BM=(e,t)=>{let s,r,i,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,A=0,u=e.strm.avail_in;do{if(s=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,s>r+e.strm.avail_in&&(s=r+e.strm.avail_in),s>i&&(s=i),s<l&&(s===0&&t!==il||t===Fu||s!==r+e.strm.avail_in)))break;A=t===il&&s===r+e.strm.avail_in?1:0,y2(e,0,0,A),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,_c(e.strm),r&&(r>s&&(r=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,s-=r),s&&(S2(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(A===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),A?4:t!==Fu&&t!==il&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(S2(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,l=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=l||(r||t===il)&&t!==Fu&&e.strm.avail_in===0&&r<=i)&&(s=r>i?i:r,A=t===il&&e.strm.avail_in===0&&s===r?1:0,y2(e,e.block_start,s,A),e.block_start+=s,_c(e.strm)),A?3:1)},N2=(e,t)=>{let s,r;for(;;){if(e.lookahead<Ud){if(Kf(e),e.lookahead<Ud&&t===Fu)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-Ud&&(e.match_length=DM(e,s)),e.match_length>=3)if(r=Uu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+1]);else r=Uu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(yc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===il?(yc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yc(e,!1),e.strm.avail_out===0)?1:2},Wf=(e,t)=>{let s,r,i;for(;;){if(e.lookahead<Ud){if(Kf(e),e.lookahead<Ud&&t===Fu)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Ud&&(e.match_length=DM(e,s),e.match_length<=5&&(e.strategy===Hte||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Uu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Vu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(yc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=Uu(e,0,e.window[e.strstart-1]),r&&yc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Uu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===il?(yc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yc(e,!1),e.strm.avail_out===0)?1:2};function Fd(e,t,s,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=r,this.func=i}const bb=[new Fd(0,0,0,0,BM),new Fd(4,4,8,4,N2),new Fd(4,5,16,8,N2),new Fd(4,6,32,32,N2),new Fd(4,4,16,16,Wf),new Fd(8,16,32,32,Wf),new Fd(8,16,128,128,Wf),new Fd(8,32,128,256,Wf),new Fd(32,128,258,1024,Wf),new Fd(32,258,258,4096,Wf)];function Zte(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Xte),this.dyn_dtree=new Uint16Array(2*(2*qte+1)),this.bl_tree=new Uint16Array(2*(2*Yte+1)),Mu(this.dyn_ltree),Mu(this.dyn_dtree),Mu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Jte+1),this.heap=new Uint16Array(2*C2+1),Mu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*C2+1),Mu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const xb=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Gf&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Rp&&t.status!==fb?1:0},LM=e=>{if(xb(e))return Ip(e,Pd);e.total_in=e.total_out=0,e.data_type=zte;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Gf:Rp,e.adler=t.wrap===2?0:1,t.last_flush=-2,jte(t),Fa},jM=e=>{const t=LM(e);return t===Fa&&(s=>{s.window_size=2*s.w_size,Mu(s.head),s.max_lazy_match=bb[s.level].max_lazy,s.good_match=bb[s.level].good_length,s.nice_match=bb[s.level].nice_length,s.max_chain_length=bb[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),t},PM=(e,t,s,r,i,l)=>{if(!e)return Pd;let A=1;if(t===Qte&&(t=6),r<0?(A=0,r=-r):r>15&&(A=2,r-=16),i<1||i>9||s!==m_||r<8||r>15||t<0||t>9||l<0||l>Kte||r===8&&A!==1)return Ip(e,Pd);r===8&&(r=9);const u=new Zte;return e.state=u,u.strm=e,u.status=Gf,u.wrap=A,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=l,u.method=s,jM(e)};var ese=(e,t)=>{if(xb(e)||t>IM||t<0)return e?Ip(e,Pd):Pd;const s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===fb&&t!==il)return Ip(e,e.avail_out===0?E2:Pd);const r=s.last_flush;if(s.last_flush=t,s.pending!==0){if(_c(e),e.avail_out===0)return s.last_flush=-1,Fa}else if(e.avail_in===0&&kM(t)<=kM(r)&&t!==il)return Ip(e,E2);if(s.status===fb&&e.avail_in!==0)return Ip(e,E2);if(s.status===Gf&&s.wrap===0&&(s.status=Rp),s.status===Gf){let i=m_+(s.w_bits-8<<4)<<8,l=-1;if(l=s.strategy>=p_||s.level<2?0:s.level<6?1:s.level===6?2:3,i|=l<<6,s.strstart!==0&&(i|=32),i+=31-i%31,gb(s,i),s.strstart!==0&&(gb(s,e.adler>>>16),gb(s,65535&e.adler)),e.adler=1,s.status=Rp,_c(e),s.pending!==0)return s.last_flush=-1,Fa}if(s.status===57){if(e.adler=0,on(s,31),on(s,139),on(s,8),s.gzhead)on(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),on(s,255&s.gzhead.time),on(s,s.gzhead.time>>8&255),on(s,s.gzhead.time>>16&255),on(s,s.gzhead.time>>24&255),on(s,s.level===9?2:s.strategy>=p_||s.level<2?4:0),on(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(on(s,255&s.gzhead.extra.length),on(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=_a(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(on(s,0),on(s,0),on(s,0),on(s,0),on(s,0),on(s,s.level===9?2:s.strategy>=p_||s.level<2?4:0),on(s,3),s.status=Rp,_c(e),s.pending!==0)return s.last_flush=-1,Fa}if(s.status===69){if(s.gzhead.extra){let i=s.pending,l=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+l>s.pending_buf_size;){let u=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>i&&(e.adler=_a(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex+=u,_c(e),s.pending!==0)return s.last_flush=-1,Fa;i=0,l-=u}let A=new Uint8Array(s.gzhead.extra);s.pending_buf.set(A.subarray(s.gzindex,s.gzindex+l),s.pending),s.pending+=l,s.gzhead.hcrc&&s.pending>i&&(e.adler=_a(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let i,l=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>l&&(e.adler=_a(e.adler,s.pending_buf,s.pending-l,l)),_c(e),s.pending!==0)return s.last_flush=-1,Fa;l=0}i=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,on(s,i)}while(i!==0);s.gzhead.hcrc&&s.pending>l&&(e.adler=_a(e.adler,s.pending_buf,s.pending-l,l)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let i,l=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>l&&(e.adler=_a(e.adler,s.pending_buf,s.pending-l,l)),_c(e),s.pending!==0)return s.last_flush=-1,Fa;l=0}i=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,on(s,i)}while(i!==0);s.gzhead.hcrc&&s.pending>l&&(e.adler=_a(e.adler,s.pending_buf,s.pending-l,l))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(_c(e),s.pending!==0))return s.last_flush=-1,Fa;on(s,255&e.adler),on(s,e.adler>>8&255),e.adler=0}if(s.status=Rp,_c(e),s.pending!==0)return s.last_flush=-1,Fa}if(e.avail_in!==0||s.lookahead!==0||t!==Fu&&s.status!==fb){let i=s.level===0?BM(s,t):s.strategy===p_?((l,A)=>{let u;for(;;){if(l.lookahead===0&&(Kf(l),l.lookahead===0)){if(A===Fu)return 1;break}if(l.match_length=0,u=Uu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,u&&(yc(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,A===il?(yc(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(yc(l,!1),l.strm.avail_out===0)?1:2})(s,t):s.strategy===Gte?((l,A)=>{let u,m,f,b;const w=l.window;for(;;){if(l.lookahead<=Tp){if(Kf(l),l.lookahead<=Tp&&A===Fu)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(f=l.strstart-1,m=w[f],m===w[++f]&&m===w[++f]&&m===w[++f])){b=l.strstart+Tp;do;while(m===w[++f]&&m===w[++f]&&m===w[++f]&&m===w[++f]&&m===w[++f]&&m===w[++f]&&m===w[++f]&&m===w[++f]&&f<b);l.match_length=Tp-(b-f),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(u=Uu(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(u=Uu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),u&&(yc(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,A===il?(yc(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(yc(l,!1),l.strm.avail_out===0)?1:2})(s,t):bb[s.level].func(s,t);if(i!==3&&i!==4||(s.status=fb),i===1||i===3)return e.avail_out===0&&(s.last_flush=-1),Fa;if(i===2&&(t===Fte?Ute(s):t!==IM&&(y2(s,0,0,!1),t===Mte&&(Mu(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),_c(e),e.avail_out===0))return s.last_flush=-1,Fa}return t!==il?Fa:s.wrap<=0?OM:(s.wrap===2?(on(s,255&e.adler),on(s,e.adler>>8&255),on(s,e.adler>>16&255),on(s,e.adler>>24&255),on(s,255&e.total_in),on(s,e.total_in>>8&255),on(s,e.total_in>>16&255),on(s,e.total_in>>24&255)):(gb(s,e.adler>>>16),gb(s,65535&e.adler)),_c(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Fa:OM)},tse=(e,t)=>{let s=t.length;if(xb(e))return Pd;const r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==Gf||r.lookahead)return Pd;if(i===1&&(e.adler=mb(e.adler,t,s,0)),r.wrap=0,s>=r.w_size){i===0&&(Mu(r.head),r.strstart=0,r.block_start=0,r.insert=0);let m=new Uint8Array(r.w_size);m.set(t.subarray(s-r.w_size,s),0),t=m,s=r.w_size}const l=e.avail_in,A=e.next_in,u=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Kf(r);r.lookahead>=3;){let m=r.strstart,f=r.lookahead-2;do r.ins_h=Vu(r,r.ins_h,r.window[m+3-1]),r.prev[m&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=m,m++;while(--f);r.strstart=m,r.lookahead=2,Kf(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=A,e.input=u,e.avail_in=l,r.wrap=i,Fa},vb={deflateInit:(e,t)=>PM(e,t,m_,15,8,Wte),deflateInit2:PM,deflateReset:jM,deflateResetKeep:LM,deflateSetHeader:(e,t)=>xb(e)||e.state.wrap!==2?Pd:(e.state.gzhead=t,Fa),deflate:ese,deflateEnd:e=>{if(xb(e))return Pd;const t=e.state.status;return e.state=null,t===Rp?Ip(e,Vte):Fa},deflateSetDictionary:tse,deflateInfo:"pako deflate (from Nodeca project)"};const sse=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var f_={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const r in s)sse(s,r)&&(e[r]=s[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const s=new Uint8Array(t);for(let r=0,i=0,l=e.length;r<l;r++){let A=e[r];s.set(A,i),i+=A.length}return s}};let UM=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{UM=!1}const wb=new Uint8Array(256);for(let e=0;e<256;e++)wb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;wb[254]=wb[254]=1;var _b={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,s,r,i,l,A=e.length,u=0;for(i=0;i<A;i++)s=e.charCodeAt(i),(64512&s)==55296&&i+1<A&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(s=65536+(s-55296<<10)+(r-56320),i++)),u+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(u),l=0,i=0;l<u;i++)s=e.charCodeAt(i),(64512&s)==55296&&i+1<A&&(r=e.charCodeAt(i+1),(64512&r)==56320&&(s=65536+(s-55296<<10)+(r-56320),i++)),s<128?t[l++]=s:s<2048?(t[l++]=192|s>>>6,t[l++]=128|63&s):s<65536?(t[l++]=224|s>>>12,t[l++]=128|s>>>6&63,t[l++]=128|63&s):(t[l++]=240|s>>>18,t[l++]=128|s>>>12&63,t[l++]=128|s>>>6&63,t[l++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i;const l=new Array(2*s);for(i=0,r=0;r<s;){let A=e[r++];if(A<128){l[i++]=A;continue}let u=wb[A];if(u>4)l[i++]=65533,r+=u-1;else{for(A&=u===2?31:u===3?15:7;u>1&&r<s;)A=A<<6|63&e[r++],u--;u>1?l[i++]=65533:A<65536?l[i++]=A:(A-=65536,l[i++]=55296|A>>10&1023,l[i++]=56320|1023&A)}}return((A,u)=>{if(u<65534&&A.subarray&&UM)return String.fromCharCode.apply(null,A.length===u?A:A.subarray(0,u));let m="";for(let f=0;f<u;f++)m+=String.fromCharCode(A[f]);return m})(l,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?t:s+wb[e[s]]>t?s:t}},FM=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const MM=Object.prototype.toString,{Z_NO_FLUSH:rse,Z_SYNC_FLUSH:nse,Z_FULL_FLUSH:ise,Z_FINISH:ase,Z_OK:g_,Z_STREAM_END:ose,Z_DEFAULT_COMPRESSION:cse,Z_DEFAULT_STRATEGY:lse,Z_DEFLATED:dse}=h_;function b_(e){this.options=f_.assign({level:cse,method:dse,chunkSize:16384,windowBits:15,memLevel:8,strategy:lse},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FM,this.strm.avail_out=0;let s=vb.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==g_)throw new Error(Np[s]);if(t.header&&vb.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?_b.string2buf(t.dictionary):MM.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,s=vb.deflateSetDictionary(this.strm,r),s!==g_)throw new Error(Np[s]);this._dict_set=!0}}function VM(e,t){const s=new b_(t);if(s.push(e,!0),s.err)throw s.msg||Np[s.err];return s.result}b_.prototype.push=function(e,t){const s=this.strm,r=this.options.chunkSize;let i,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?ase:rse,typeof e=="string"?s.input=_b.string2buf(e):MM.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),(l===nse||l===ise)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=vb.deflate(s,l),i===ose)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=vb.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===g_;if(s.avail_out!==0){if(l>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},b_.prototype.onData=function(e){this.chunks.push(e)},b_.prototype.onEnd=function(e){e===g_&&(this.result=f_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ase={deflate:VM,deflateRaw:function(e,t){return(t=t||{}).raw=!0,VM(e,t)}};const x_=16209;var use=function(e,t){let s,r,i,l,A,u,m,f,b,w,_,S,F,B,j,K,X,oe,xe,Ee,me,Re,He,Xe;const _t=e.state;s=e.next_in,He=e.input,r=s+(e.avail_in-5),i=e.next_out,Xe=e.output,l=i-(t-e.avail_out),A=i+(e.avail_out-257),u=_t.dmax,m=_t.wsize,f=_t.whave,b=_t.wnext,w=_t.window,_=_t.hold,S=_t.bits,F=_t.lencode,B=_t.distcode,j=(1<<_t.lenbits)-1,K=(1<<_t.distbits)-1;e:do{S<15&&(_+=He[s++]<<S,S+=8,_+=He[s++]<<S,S+=8),X=F[_&j];t:for(;;){if(oe=X>>>24,_>>>=oe,S-=oe,oe=X>>>16&255,oe===0)Xe[i++]=65535&X;else{if(!(16&oe)){if(!(64&oe)){X=F[(65535&X)+(_&(1<<oe)-1)];continue t}if(32&oe){_t.mode=16191;break e}e.msg="invalid literal/length code",_t.mode=x_;break e}xe=65535&X,oe&=15,oe&&(S<oe&&(_+=He[s++]<<S,S+=8),xe+=_&(1<<oe)-1,_>>>=oe,S-=oe),S<15&&(_+=He[s++]<<S,S+=8,_+=He[s++]<<S,S+=8),X=B[_&K];s:for(;;){if(oe=X>>>24,_>>>=oe,S-=oe,oe=X>>>16&255,!(16&oe)){if(!(64&oe)){X=B[(65535&X)+(_&(1<<oe)-1)];continue s}e.msg="invalid distance code",_t.mode=x_;break e}if(Ee=65535&X,oe&=15,S<oe&&(_+=He[s++]<<S,S+=8,S<oe&&(_+=He[s++]<<S,S+=8)),Ee+=_&(1<<oe)-1,Ee>u){e.msg="invalid distance too far back",_t.mode=x_;break e}if(_>>>=oe,S-=oe,oe=i-l,Ee>oe){if(oe=Ee-oe,oe>f&&_t.sane){e.msg="invalid distance too far back",_t.mode=x_;break e}if(me=0,Re=w,b===0){if(me+=m-oe,oe<xe){xe-=oe;do Xe[i++]=w[me++];while(--oe);me=i-Ee,Re=Xe}}else if(b<oe){if(me+=m+b-oe,oe-=b,oe<xe){xe-=oe;do Xe[i++]=w[me++];while(--oe);if(me=0,b<xe){oe=b,xe-=oe;do Xe[i++]=w[me++];while(--oe);me=i-Ee,Re=Xe}}}else if(me+=b-oe,oe<xe){xe-=oe;do Xe[i++]=w[me++];while(--oe);me=i-Ee,Re=Xe}for(;xe>2;)Xe[i++]=Re[me++],Xe[i++]=Re[me++],Xe[i++]=Re[me++],xe-=3;xe&&(Xe[i++]=Re[me++],xe>1&&(Xe[i++]=Re[me++]))}else{me=i-Ee;do Xe[i++]=Xe[me++],Xe[i++]=Xe[me++],Xe[i++]=Xe[me++],xe-=3;while(xe>2);xe&&(Xe[i++]=Xe[me++],xe>1&&(Xe[i++]=Xe[me++]))}break}}break}}while(s<r&&i<A);xe=S>>3,s-=xe,S-=xe<<3,_&=(1<<S)-1,e.next_in=s,e.next_out=i,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=i<A?A-i+257:257-(i-A),_t.hold=_,_t.bits=S};const v_=15,hse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),pse=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),mse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fse=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var yb=(e,t,s,r,i,l,A,u)=>{const m=u.bits;let f,b,w,_,S,F,B=0,j=0,K=0,X=0,oe=0,xe=0,Ee=0,me=0,Re=0,He=0,Xe=null;const _t=new Uint16Array(16),ns=new Uint16Array(16);let es,vs,ps,tr=null;for(B=0;B<=v_;B++)_t[B]=0;for(j=0;j<r;j++)_t[t[s+j]]++;for(oe=m,X=v_;X>=1&&_t[X]===0;X--);if(oe>X&&(oe=X),X===0)return i[l++]=20971520,i[l++]=20971520,u.bits=1,0;for(K=1;K<X&&_t[K]===0;K++);for(oe<K&&(oe=K),me=1,B=1;B<=v_;B++)if(me<<=1,me-=_t[B],me<0)return-1;if(me>0&&(e===0||X!==1))return-1;for(ns[1]=0,B=1;B<v_;B++)ns[B+1]=ns[B]+_t[B];for(j=0;j<r;j++)t[s+j]!==0&&(A[ns[t[s+j]]++]=j);if(e===0?(Xe=tr=A,F=20):e===1?(Xe=hse,tr=pse,F=257):(Xe=mse,tr=fse,F=0),He=0,j=0,B=K,S=l,xe=oe,Ee=0,w=-1,Re=1<<oe,_=Re-1,e===1&&Re>852||e===2&&Re>592)return 1;for(;;){es=B-Ee,A[j]+1<F?(vs=0,ps=A[j]):A[j]>=F?(vs=tr[A[j]-F],ps=Xe[A[j]-F]):(vs=96,ps=0),f=1<<B-Ee,b=1<<xe,K=b;do b-=f,i[S+(He>>Ee)+b]=es<<24|vs<<16|ps|0;while(b!==0);for(f=1<<B-1;He&f;)f>>=1;if(f!==0?(He&=f-1,He+=f):He=0,j++,--_t[B]==0){if(B===X)break;B=t[s+A[j]]}if(B>oe&&(He&_)!==w){for(Ee===0&&(Ee=oe),S+=K,xe=B-Ee,me=1<<xe;xe+Ee<X&&(me-=_t[xe+Ee],!(me<=0));)xe++,me<<=1;if(Re+=1<<xe,e===1&&Re>852||e===2&&Re>592)return 1;w=He&_,i[w]=oe<<24|xe<<16|S-l|0}}return He!==0&&(i[S+He]=B-Ee<<24|64<<16|0),u.bits=oe,0};const{Z_FINISH:QM,Z_BLOCK:gse,Z_TREES:w_,Z_OK:Op,Z_STREAM_END:bse,Z_NEED_DICT:xse,Z_STREAM_ERROR:al,Z_DATA_ERROR:HM,Z_MEM_ERROR:GM,Z_BUF_ERROR:vse,Z_DEFLATED:KM}=h_,__=16180,y_=16190,kA=16191,T2=16192,R2=16194,E_=16199,C_=16200,I2=16206,di=16209,WM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function wse(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const kp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<__||t.mode>16211?1:0},zM=e=>{if(kp(e))return al;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=__,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Op},qM=e=>{if(kp(e))return al;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,zM(e)},YM=(e,t)=>{let s;if(kp(e))return al;const r=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?al:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=s,r.wbits=t,qM(e))},XM=(e,t)=>{if(!e)return al;const s=new wse;e.state=s,s.strm=e,s.window=null,s.mode=__;const r=YM(e,t);return r!==Op&&(e.state=null),r};let O2,k2,JM=!0;const _se=e=>{if(JM){O2=new Int32Array(512),k2=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(yb(1,e.lens,0,288,O2,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;yb(2,e.lens,0,32,k2,0,e.work,{bits:5}),JM=!1}e.lencode=O2,e.lenbits=9,e.distcode=k2,e.distbits=5},$M=(e,t,s,r)=>{let i;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(s-l.wsize,s),0),l.wnext=0,l.whave=l.wsize):(i=l.wsize-l.wnext,i>r&&(i=r),l.window.set(t.subarray(s-r,s-r+i),l.wnext),(r-=i)?(l.window.set(t.subarray(s-r,s),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=i,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=i))),0};var yse=(e,t)=>{let s,r,i,l,A,u,m,f,b,w,_,S,F,B,j,K,X,oe,xe,Ee,me,Re,He=0;const Xe=new Uint8Array(4);let _t,ns;const es=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(kp(e)||!e.output||!e.input&&e.avail_in!==0)return al;s=e.state,s.mode===kA&&(s.mode=T2),A=e.next_out,i=e.output,m=e.avail_out,l=e.next_in,r=e.input,u=e.avail_in,f=s.hold,b=s.bits,w=u,_=m,Re=Op;e:for(;;)switch(s.mode){case __:if(s.wrap===0){s.mode=T2;break}for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(2&s.wrap&&f===35615){s.wbits===0&&(s.wbits=15),s.check=0,Xe[0]=255&f,Xe[1]=f>>>8&255,s.check=_a(s.check,Xe,2,0),f=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",s.mode=di;break}if((15&f)!==KM){e.msg="unknown compression method",s.mode=di;break}if(f>>>=4,b-=4,me=8+(15&f),s.wbits===0&&(s.wbits=me),me>15||me>s.wbits){e.msg="invalid window size",s.mode=di;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&f?16189:kA,f=0,b=0;break;case 16181:for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(s.flags=f,(255&aa(s))!==KM){e.msg="unknown compression method",s.mode=di;break}if(57344&aa(s)){e.msg="unknown header flags set",s.mode=di;break}s.head&&(s.head.text=f>>8&1),512&aa(s)&&4&s.wrap&&(Xe[0]=255&f,Xe[1]=f>>>8&255,s.check=_a(s.check,Xe,2,0)),f=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.head&&(s.head.time=f),512&aa(s)&&4&s.wrap&&(Xe[0]=255&f,Xe[1]=f>>>8&255,Xe[2]=f>>>16&255,Xe[3]=f>>>24&255,s.check=_a(s.check,Xe,4,0)),f=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.head&&(s.head.xflags=255&f,s.head.os=f>>8),512&aa(s)&&4&s.wrap&&(Xe[0]=255&f,Xe[1]=f>>>8&255,s.check=_a(s.check,Xe,2,0)),f=0,b=0,s.mode=16184;case 16184:if(1024&aa(s)){for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.length=f,s.head&&(s.head.extra_len=f),512&aa(s)&&4&s.wrap&&(Xe[0]=255&f,Xe[1]=f>>>8&255,s.check=_a(s.check,Xe,2,0)),f=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&aa(s)&&(S=s.length,S>u&&(S=u),S&&(s.head&&(me=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(r.subarray(l,l+S),me)),512&aa(s)&&4&s.wrap&&(s.check=_a(s.check,r,S,l)),u-=S,l+=S,s.length-=S),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&aa(s)){if(u===0)break e;S=0;do me=r[l+S++],s.head&&me&&s.length<65536&&(s.head.name+=String.fromCharCode(me));while(me&&S<u);if(512&aa(s)&&4&s.wrap&&(s.check=_a(s.check,r,S,l)),u-=S,l+=S,me)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&aa(s)){if(u===0)break e;S=0;do me=r[l+S++],s.head&&me&&s.length<65536&&(s.head.comment+=String.fromCharCode(me));while(me&&S<u);if(512&aa(s)&&4&s.wrap&&(s.check=_a(s.check,r,S,l)),u-=S,l+=S,me)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&aa(s)){for(;b<16;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(4&s.wrap&&f!==(65535&s.check)){e.msg="header crc mismatch",s.mode=di;break}f=0,b=0}s.head&&(s.head.hcrc=aa(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=kA;break;case 16189:for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}e.adler=s.check=WM(f),f=0,b=0,s.mode=y_;case y_:if(s.havedict===0)return e.next_out=A,e.avail_out=m,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,xse;e.adler=s.check=1,s.mode=kA;case kA:if(t===gse||t===w_)break e;case T2:if(s.last){f>>>=7&b,b-=7&b,s.mode=I2;break}for(;b<3;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}switch(s.last=1&f,f>>>=1,b-=1,3&f){case 0:s.mode=16193;break;case 1:if(_se(s),s.mode=E_,t===w_){f>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=di}f>>>=2,b-=2;break;case 16193:for(f>>>=7&b,b-=7&b;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",s.mode=di;break}if(s.length=65535&f,f=0,b=0,s.mode=R2,t===w_)break e;case R2:s.mode=16195;case 16195:if(S=s.length,S){if(S>u&&(S=u),S>m&&(S=m),S===0)break e;i.set(r.subarray(l,l+S),A),u-=S,l+=S,m-=S,A+=S,s.length-=S;break}s.mode=kA;break;case 16196:for(;b<14;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(s.nlen=257+(31&f),f>>>=5,b-=5,s.ndist=1+(31&f),f>>>=5,b-=5,s.ncode=4+(15&f),f>>>=4,b-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=di;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.lens[es[s.have++]]=7&f,f>>>=3,b-=3}for(;s.have<19;)s.lens[es[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,_t={bits:s.lenbits},Re=yb(0,s.lens,0,19,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Re){e.msg="invalid code lengths set",s.mode=di;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;He=s.lencode[f&(1<<s.lenbits)-1],j=He>>>24,K=He>>>16&255,X=65535&He,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(X<16)f>>>=j,b-=j,s.lens[s.have++]=X;else{if(X===16){for(ns=j+2;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(f>>>=j,b-=j,s.have===0){e.msg="invalid bit length repeat",s.mode=di;break}me=s.lens[s.have-1],S=3+(3&f),f>>>=2,b-=2}else if(X===17){for(ns=j+3;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=j,b-=j,me=0,S=3+(7&f),f>>>=3,b-=3}else{for(ns=j+7;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=j,b-=j,me=0,S=11+(127&f),f>>>=7,b-=7}if(s.have+S>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=di;break}for(;S--;)s.lens[s.have++]=me}}if(s.mode===di)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=di;break}if(s.lenbits=9,_t={bits:s.lenbits},Re=yb(1,s.lens,0,s.nlen,s.lencode,0,s.work,_t),s.lenbits=_t.bits,Re){e.msg="invalid literal/lengths set",s.mode=di;break}if(s.distbits=6,s.distcode=s.distdyn,_t={bits:s.distbits},Re=yb(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,_t),s.distbits=_t.bits,Re){e.msg="invalid distances set",s.mode=di;break}if(s.mode=E_,t===w_)break e;case E_:s.mode=C_;case C_:if(u>=6&&m>=258){e.next_out=A,e.avail_out=m,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,use(e,_),A=e.next_out,i=e.output,m=e.avail_out,l=e.next_in,r=e.input,u=e.avail_in,f=s.hold,b=s.bits,s.mode===kA&&(s.back=-1);break}for(s.back=0;He=s.lencode[f&(1<<s.lenbits)-1],j=He>>>24,K=He>>>16&255,X=65535&He,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(K&&!(240&K)){for(oe=j,xe=K,Ee=X;He=s.lencode[Ee+((f&(1<<oe+xe)-1)>>oe)],j=He>>>24,K=He>>>16&255,X=65535&He,!(oe+j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=oe,b-=oe,s.back+=oe}if(f>>>=j,b-=j,s.back+=j,s.length=X,K===0){s.mode=16205;break}if(32&K){s.back=-1,s.mode=kA;break}if(64&K){e.msg="invalid literal/length code",s.mode=di;break}s.extra=15&K,s.mode=16201;case 16201:if(s.extra){for(ns=s.extra;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.length+=f&(1<<s.extra)-1,f>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;He=s.distcode[f&(1<<s.distbits)-1],j=He>>>24,K=He>>>16&255,X=65535&He,!(j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(!(240&K)){for(oe=j,xe=K,Ee=X;He=s.distcode[Ee+((f&(1<<oe+xe)-1)>>oe)],j=He>>>24,K=He>>>16&255,X=65535&He,!(oe+j<=b);){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}f>>>=oe,b-=oe,s.back+=oe}if(f>>>=j,b-=j,s.back+=j,64&K){e.msg="invalid distance code",s.mode=di;break}s.offset=X,s.extra=15&K,s.mode=16203;case 16203:if(s.extra){for(ns=s.extra;b<ns;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}s.offset+=f&(1<<s.extra)-1,f>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=di;break}s.mode=16204;case 16204:if(m===0)break e;if(S=_-m,s.offset>S){if(S=s.offset-S,S>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=di;break}S>s.wnext?(S-=s.wnext,F=s.wsize-S):F=s.wnext-S,S>s.length&&(S=s.length),B=s.window}else B=i,F=A-s.offset,S=s.length;S>m&&(S=m),m-=S,s.length-=S;do i[A++]=B[F++];while(--S);s.length===0&&(s.mode=C_);break;case 16205:if(m===0)break e;i[A++]=s.length,m--,s.mode=C_;break;case I2:if(s.wrap){for(;b<32;){if(u===0)break e;u--,f|=r[l++]<<b,b+=8}if(_-=m,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=aa(s)?_a(s.check,i,_,A-_):mb(s.check,i,_,A-_)),_=m,4&s.wrap&&(aa(s)?f:WM(f))!==s.check){e.msg="incorrect data check",s.mode=di;break}f=0,b=0}s.mode=16207;case 16207:if(s.wrap&&aa(s)){for(;b<32;){if(u===0)break e;u--,f+=r[l++]<<b,b+=8}if(4&s.wrap&&f!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=di;break}f=0,b=0}s.mode=16208;case 16208:Re=bse;break e;case di:Re=HM;break e;case 16210:return GM;default:return al}return e.next_out=A,e.avail_out=m,e.next_in=l,e.avail_in=u,s.hold=f,s.bits=b,(s.wsize||_!==e.avail_out&&s.mode<di&&(s.mode<I2||t!==QM))&&$M(e,e.output,e.next_out,_-e.avail_out),w-=e.avail_in,_-=e.avail_out,e.total_in+=w,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=aa(s)?_a(s.check,i,_,e.next_out-_):mb(s.check,i,_,e.next_out-_)),e.data_type=s.bits+(s.last?64:0)+(s.mode===kA?128:0)+(s.mode===E_||s.mode===R2?256:0),(w===0&&_===0||t===QM)&&Re===Op&&(Re=vse),Re},DA={inflateReset:qM,inflateReset2:YM,inflateResetKeep:zM,inflateInit:e=>XM(e,15),inflateInit2:XM,inflate:yse,inflateEnd:e=>{if(kp(e))return al;let t=e.state;return t.window&&(t.window=null),e.state=null,Op},inflateGetHeader:(e,t)=>{if(kp(e))return al;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Op):al},inflateSetDictionary:(e,t)=>{const s=t.length;let r,i,l;return kp(e)?al:(r=e.state,r.wrap!==0&&r.mode!==y_?al:r.mode===y_&&(i=1,i=mb(i,t,s,0),i!==r.check)?HM:(l=$M(e,t,s,s),l?(r.mode=16210,GM):(r.havedict=1,Op)))},inflateInfo:"pako inflate (from Nodeca project)"},Ese=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ZM=Object.prototype.toString,{Z_NO_FLUSH:Cse,Z_FINISH:Sse,Z_OK:Eb,Z_STREAM_END:D2,Z_NEED_DICT:B2,Z_STREAM_ERROR:Nse,Z_DATA_ERROR:e3,Z_MEM_ERROR:Tse}=h_;function S_(e){this.options=f_.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FM,this.strm.avail_out=0;let s=DA.inflateInit2(this.strm,t.windowBits);if(s!==Eb)throw new Error(Np[s]);if(this.header=new Ese,DA.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=_b.string2buf(t.dictionary):ZM.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=DA.inflateSetDictionary(this.strm,t.dictionary),s!==Eb)))throw new Error(Np[s])}function t3(e,t){const s=new S_(t);if(s.push(e),s.err)throw s.msg||Np[s.err];return s.result}S_.prototype.push=function(e,t){const s=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let l,A,u;if(this.ended)return!1;for(A=t===~~t?t:t===!0?Sse:Cse,ZM.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),l=DA.inflate(s,A),l===B2&&i&&(l=DA.inflateSetDictionary(s,i),l===Eb?l=DA.inflate(s,A):l===e3&&(l=B2));s.avail_in>0&&l===D2&&s.state.wrap>0&&e[s.next_in]!==0;)DA.inflateReset(s),l=DA.inflate(s,A);switch(l){case Nse:case e3:case B2:case Tse:return this.onEnd(l),this.ended=!0,!1}if(u=s.avail_out,s.next_out&&(s.avail_out===0||l===D2))if(this.options.to==="string"){let m=_b.utf8border(s.output,s.next_out),f=s.next_out-m,b=_b.buf2string(s.output,m);s.next_out=f,s.avail_out=r-f,f&&s.output.set(s.output.subarray(m,m+f),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(l!==Eb||u!==0){if(l===D2)return l=DA.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},S_.prototype.onData=function(e){this.chunks.push(e)},S_.prototype.onEnd=function(e){e===Eb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Rse={inflate:t3,inflateRaw:function(e,t){return(t=t||{}).raw=!0,t3(e,t)}};const{deflate:Ise,deflateRaw:Ose}=Ase,{inflate:kse,inflateRaw:Dse}=Rse;var Bse=Ise,Lse=Ose,jse=kse,Pse=Dse,s3=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(s3||{});class Use{constructor(){U(this,"_sequence",0),U(this,"_startTime",Date.now()),U(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const m={id:0,length:4,data:u.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};s.commonPacketHeader.extension=1,s.extension=f,s.payload=this.compress(t),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&N.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const r=new ArrayBuffer(s.commonPacketHeader.length),i=new Uint8Array(r),l=new DataView(r);let A=0;if(l.setUint16(A,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),A+=2,l.setUint32(A,s.commonPacketHeader.sequence,!0),A+=4,l.setUint16(A,s.commonStreamHeader,!0),A+=2,s.extension){const u=this.serializeExtension(s.extension);i.set(new Uint8Array(u),A),A+=u.byteLength}if(i.set(new Uint8Array(s.payload),A),A+=s.payload.byteLength,A!==s.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const s=new DataView(t);let r=0;const i=s.getUint16(r,!0);r+=2;const l={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:s.getUint16(r+2,!0)<<16|s.getUint16(r,!0)};let A,u;if(r+=4,G("SHOW_DATASTREAM2_LOG")&&N.debug("receive data header: ".concat(JSON.stringify(l))),s.getUint16(r,!0),r+=2,l.extension){u=this.deserializeExtension(t.slice(r)),r+=2+u.length,A=t.slice(r);let m=!1;if(u.datas.length>0){const f=u.datas.find(b=>b.id===0);f&&(m=(1&new DataView(f.data).getUint32(0,!0))==1)}A=m?this.decompress(A):A}else A=t.slice(8);return A}serializeExtension(t){const{profile:s,length:r,datas:i}=t,l=new ArrayBuffer(r+2),A=new Uint8Array(l),u=new DataView(l);let m=0;if(u.setUint8(m++,s),u.setUint8(m++,r),i.forEach(f=>{s?(u.setUint8(m++,f.id),u.setUint8(m++,f.length),A.set(new Uint8Array(f.data),m),m+=f.data.byteLength):(u.setUint8(m++,f.id|f.length<<4),A.set(new Uint8Array(f.data),m),m+=f.data.byteLength)}),m!==r+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(r+2));return l}deserializeExtension(t){const s=new DataView(t);let r=0;const i=s.getUint8(r);r++;const l=s.getUint8(r);r++;const A=i===s3.TWO_BYTE,u=[],m=new DataView(t,2);let f=0;for(;f<l;){let b=0,w=0,_=new ArrayBuffer(0);A?(b=m.getUint8(f),f++,w=m.getUint8(f),f++):(b=15&m.getUint8(f),w=m.getUint8(f)>>4,f++),w>0&&(_=m.buffer.slice(f+2,f+2+w),f+=_.byteLength),u.push({id:b,length:w,data:_})}if(f!==l)throw Error("parse error");return{profile:i,length:l,datas:u}}decompress(t){return jse(new Uint8Array(t))}compress(t){return Bse(new Uint8Array(t))}}const Fse={name:"DataStream",create:(e,t)=>{const s=t?new HZ(e):new GZ(e);return s.useDataStream(new Use),s}};class Mse extends Vr{constructor(t,s,r){super(),U(this,"ws",void 0),U(this,"requestId",1),U(this,"heartBeatTimer",void 0),U(this,"joinInfo",void 0),U(this,"clientId",void 0),U(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),U(this,"onClose",i=>{this.emit("close"),this.dispose()}),U(this,"onMessage",i=>{const l=JSON.parse(i.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=s,this.ws=new q0("cross-channel-".concat(this.clientId),r),this.ws.on(ms.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ms.CONNECTED,this.onOpen),this.ws.on(ms.ON_MESSAGE,this.onMessage),this.ws.on(ms.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const s=this.requestId++;return t.requestId=s,t.seq=s,this.ws.sendMessage(t),s}waitStatus(t){return new pt((s,r)=>{const i=window.setTimeout(()=>{r(new Le(W.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(i),l.state&&l.state!==0?r(new Le(W.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new Le(W.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Le(W.WS_DISCONNECT);const s=()=>new pt((A,u)=>{this.ws.once(ms.CLOSED,()=>u(new Le(W.WS_ABORT))),this.ws.once(ms.CONNECTED,A)});this.ws.state!=="connected"&&await s();const r=this.sendMessage(t),i=new pt((A,u)=>{const m=()=>{u(new Le(W.WS_ABORT))};this.ws.once(ms.RECONNECTING,m),this.ws.once(ms.CLOSED,m),this.once("req_".concat(r),A),Yn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(ms.RECONNECTING,m),this.ws.off(ms.CLOSED,m),u(new Le(W.TIMEOUT,"cross channel ws request timeout"))})}),l=await i;if(!l||l.code!==200)throw new Le(W.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(ms.REQUEST_NEW_URLS),this.ws.on(ms.REQUEST_NEW_URLS,s=>{s(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const s=this.requestId++;return t.requestId=s,this.ws.sendMessage(t),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Vse extends Vr{set state(t){t!==this._state&&(t!==Ja.RELAY_STATE_FAILURE&&(this.errorCode=Rf.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,s,r,i,l){super(),U(this,"joinInfo",void 0),U(this,"sid",void 0),U(this,"clientId",void 0),U(this,"cancelToken",Da.CancelToken.source()),U(this,"workerToken",void 0),U(this,"requestId",0),U(this,"signal",void 0),U(this,"prevChannelMediaConfig",void 0),U(this,"httpRetryConfig",void 0),U(this,"_resolution",void 0),U(this,"_state",Ja.RELAY_STATE_IDLE),U(this,"errorCode",Rf.RELAY_OK),U(this,"onStatus",A=>{N.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(A))),A&&A.command&&(A.command==="onAudioPacketReceived"&&this.emit("event",TA.PACKET_RECEIVED_AUDIO_FROM_SRC),A.command==="onVideoPacketReceived"&&this.emit("event",TA.PACKET_RECEIVED_VIDEO_FROM_SRC),A.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Rf.SRC_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE),A.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Rf.DEST_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE))}),U(this,"onReconnect",async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",TA.NETWORK_DISCONNECTED),this.state=Ja.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(A=>{this.state!==Ja.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",A.toString()),this.errorCode=Rf.SERVER_CONNECTION_LOST,this.state=Ja.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=s,this.sid=cp(),this.signal=new Mse(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==Ja.RELAY_STATE_IDLE)throw new Le(W.INVALID_OPERATION);this.state=Ja.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Le(W.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Le(W.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Le(W.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ja.RELAY_STATE_RUNNING)throw new Le(W.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ja.RELAY_STATE_RUNNING)throw new Le(W.INVALID_OPERATION);const s=this.genMessage(ja.SetVideoProfile);await this.signal.request(s),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ja.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Da.CancelToken.source(),this.state=Ja.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await qee(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",TA.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const s=this.genMessage(ja.SetSdkProfile,t);await this.signal.request(s),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(ja.SetSourceChannel,t);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",TA.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(ja.SetSourceUserId,t);await this.signal.request(i),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(ja.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",TA.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const A=this.genMessage(ja.StartPacketTransfer,t);await this.signal.request(A),this.emit("event",TA.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ja.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const s=this.genMessage(ja.UpdateDestChannel,t);await this.signal.request(s),this.emit("event",TA.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(ja.StopPacketTransfer);await this.signal.request(t),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,s){const r=[],i=[],l=[];this.requestId+=1;const A={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:fc,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};A.sdkVersion==="4.24.2"&&(A.sdkVersion="0.0.1");let u=null,m=null;switch(t){case ja.SetSdkProfile:return A.clientRequest={command:"SetSdkProfile",type:"multi_channel"},A;case ja.SetSourceChannel:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new Le(W.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},A;case ja.SetSourceUserId:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new Le(W.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceUserId",uid:m.uid+""},A;case ja.SetDestChannel:if(u=s&&s.getDestChannelMediaInfo(),!u)throw new Le(W.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),A.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:l},A;case ja.StartPacketTransfer:return A.clientRequest={command:"StartPacketTransfer"},A;case ja.Reconnect:return A.clientRequest={command:"Reconnect"},A;case ja.StopPacketTransfer:return A.clientRequest={command:"StopPacketTransfer"},A;case ja.UpdateDestChannel:if(u=s&&s.getDestChannelMediaInfo(),!u)throw new Le(W.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(f=>{r.push(f.channelName),i.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),A.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:l},A;case ja.SetVideoProfile:A.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return A}}const Qse={name:"ChannelMediaRelay",create:function(e){return new Vse(e.joinInfo,e.clientId,e.websocketRetryConfig||gn,e.httpRetryConfig||gn,e.resolution)}};function r3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Cb(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?r3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Hse extends Vr{constructor(t,s,r,i){super(),U(this,"spec",void 0),U(this,"token",void 0),U(this,"websocket",void 0),U(this,"pingpongTimer",void 0),U(this,"reconnectMode","retry"),U(this,"serviceMode",void 0),U(this,"reqId",0),U(this,"commandReqId",0),U(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),U(this,"handleWebSocketMessage",l=>{if(!l.data)return;const A=JSON.parse(l.data);A.requestId?this.emit("@".concat(A.requestId,"-").concat(A.sid),A):(Ot.workerEvent(this.spec.sid,{actionType:"status",serverCode:A.code,workerType:this.serviceMode===NA.TRANSCODE?1:2}),this.emit(Ru.PUBLISH_STREAM_STATUS,A))}),this.spec=s,this.token=t,this.serviceMode=i,this.websocket=new q0("live-streaming",r),this.websocket.on(ms.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ms.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ms.REQUEST_NEW_URLS,(l,A)=>{Cn(this,Ru.REQUEST_NEW_ADDRESS).then(l).catch(A)}),this.websocket.on(ms.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,s,r,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,A=this.reqId;if(!A||!this.websocket)throw new Le(W.UNEXPECTED_ERROR);const u=Cb({command:t,sdkVersion:fc==="4.24.2"?"0.0.1":fc,seq:A,requestId:A,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Le(W.WS_DISCONNECT);const m=()=>new pt((_,S)=>{this.websocket.once(ms.CLOSED,()=>S(new Le(W.WS_ABORT))),this.websocket.once(ms.CONNECTED,_)});this.websocket.state!=="connected"&&await m(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const f=new pt((_,S)=>{const F=()=>{S(new Le(W.WS_ABORT))};this.websocket.once(ms.RECONNECTING,F),this.websocket.once(ms.CLOSED,F),this.once("@".concat(A,"-").concat(this.spec.sid),B=>{_(B)})});i&&Ot.workerEvent(this.spec.sid,Cb(Cb({},i),{},{requestId:l,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(u);let w=null;try{w=await f}catch(_){if(this.websocket.state==="closed")throw _;return await m(),await this.request(t,s,r)}return i&&Ot.workerEvent(this.spec.sid,Cb(Cb({},i),{},{requestId:l,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-b})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=fc==="4.24.2"?"0.0.1":fc;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case jn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case jn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case jn.LIVE_STREAM_RESPONSE_BAD_STREAM:case jn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Le(W.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case jn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case jn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Le(W.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Le(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case jn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Le(W.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case jn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case jn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Le(W.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case jn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Le(W.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ru.WARNING,s,t.serverResponse.url)}case jn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case jn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case jn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Le(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(M0)},6e3)}}function n3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Za(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?n3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class Gse extends Vr{constructor(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gn;super(),U(this,"onLiveStreamWarning",void 0),U(this,"onLiveStreamError",void 0),U(this,"spec",void 0),U(this,"retryTimeout",1e4),U(this,"connection",void 0),U(this,"httpRetryConfig",void 0),U(this,"wsRetryConfig",void 0),U(this,"streamingTasks",new Map),U(this,"isStartingStreamingTask",!1),U(this,"taskMutex",new ai("live-streaming")),U(this,"cancelToken",Da.CancelToken.source()),U(this,"transcodingConfig",void 0),U(this,"uapResponse",void 0),U(this,"lastTaskId",1),U(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=s}async setTranscodingConfig(t){const s=Za(Za({},Nee),t);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(N.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(A=>Za(Za(Za({},See),A),{},{zOrder:A.zOrder?A.zOrder+1:1}))),function(A){$r(A.width)||_r(A.width,"config.width",0,1e4),$r(A.height)||_r(A.height,"config.height",0,1e4),$r(A.videoBitrate)||_r(A.videoBitrate,"config.videoBitrate",1,1e6),$r(A.videoFrameRate)||_r(A.videoFrameRate,"config.videoFrameRate"),$r(A.lowLatency)||qc(A.lowLatency,"config.lowLatency"),$r(A.audioSampleRate)||fn(A.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),$r(A.audioBitrate)||_r(A.audioBitrate,"config.audioBitrate",1,128),$r(A.audioChannels)||fn(A.audioChannels,"config.audioChannels",[1,2,3,4,5]),$r(A.videoGop)||_r(A.videoGop,"config.videoGop"),$r(A.videoCodecProfile)||fn(A.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),$r(A.userCount)||_r(A.userCount,"config.userCount",0,17),$r(A.backgroundColor)||_r(A.backgroundColor,"config.backgroundColor",0,16777215),$r(A.userConfigExtraInfo)||bi(A.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),A.transcodingUsers&&!$r(A.transcodingUsers)&&(CA(A.transcodingUsers,"config.transcodingUsers"),A.transcodingUsers.forEach((u,m)=>{jw(u.uid),$r(u.x)||_r(u.x,"transcodingUser[".concat(m,"].x"),0,1e4),$r(u.y)||_r(u.y,"transcodingUser[".concat(m,"].y"),0,1e4),$r(u.width)||_r(u.width,"transcodingUser[".concat(m,"].width"),0,1e4),$r(u.height)||_r(u.height,"transcodingUser[".concat(m,"].height"),0,1e4),$r(u.zOrder)||_r(u.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),$r(u.alpha)||_r(u.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),$r(A.watermark)||EN(A.watermark,"watermark"),$r(A.backgroundImage)||EN(A.backgroundImage,"backgroundImage"),A.images&&!$r(A.images)&&(CA(A.images,"config.images"),A.images.forEach((u,m)=>{EN(u,"images[".concat(m,"]"))}))}(s);const r=[];s.images&&r.push(...s.images.map(A=>Za(Za(Za({},yN),A),{},{zOrder:255}))),s.backgroundImage&&(r.push(Za(Za(Za({},yN),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(r.push(Za(Za(Za({},yN),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=r,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(A=>Za({},A)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const i=(s.userConfigs||[]).map(A=>typeof A.uid=="number"?pt.resolve(A.uid):E4(A.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pt.all(i)).forEach((A,u)=>{s.userConfigs&&s.userConfigs[u]&&(s.userConfigs[u].uid=A)}),this.transcodingConfig=s,this.connection)try{var l;const A=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(wo(l=this.streamingTasks).call(l)).map(u=>u.taskId).join("#")});N.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(A.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(A){if(!A.data||!A.data.retry)throw A;A.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),A.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,A).then(()=>{N.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(m=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,m)})})}}async startLiveStreamingTask(t,s,r){if(!this.transcodingConfig&&s===NA.TRANSCODE)throw new Le(W.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(s));const l=await this.taskMutex.lock();if(!this.connection&&r)return void l();if(this.streamingTasks.get(t)&&!r)return l(),new Le(W.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(u){throw l(),u}switch(s){case NA.TRANSCODE:i.transcodingConfig=Za({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const A=this.lastTaskId++;try{const u=new pt((f,b)=>{Yn(this.retryTimeout).then(()=>{if(r)return b(r);const w=this.statusError.get(t);return w?(this.statusError.delete(t),b(w)):void 0})}),m=await pt.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:s===NA.TRANSCODE?1:2,requestByUser:!r,tid:A.toString()}),u]);this.isStartingStreamingTask=!1,N.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:i,mode:s,url:t,taskId:A}),l()}catch(u){if(l(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||r)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,s,u)):await this.startLiveStreamingTask(t,s,u)}}stopLiveStreamingTask(t){return new pt((s,r)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new Le(W.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=i.mode;i.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:l===NA.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(A=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(A.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(r)})}resetAllTask(){var t;const s=Array.from(wo(t=this.streamingTasks).call(t));this.terminate();for(const r of s)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Da.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Le(W.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Cn(this,CN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=s,this.connection=new Hse(s.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ru.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Ru.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Ru.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new Le(W.UNEXPECTED_ERROR,"can not get new live streaming address list"));Cn(this,CN.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,r(l.addressList)}).catch(i)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(t){const s=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(s),i=t.reason;switch(t.code){case jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const A=new Le(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return N.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,A);if(!this.isStartingStreamingTask)return;this.statusError.set(s,A)}case jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const A=new Le(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,A)}case jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const A=Array.from(wo(l=this.streamingTasks).call(l));for(const u of A)u.abortTask?u.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new Le(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(m=>{N.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Kse={name:"LiveStreaming",create:function(e){return new Gse(e.joinInfo,e.websocketRetryConfig||gn,e.httpRetryConfig||gn)}};function Wse(e){let t=o3();return function(s,r){let i=s.appId;i!==void 0&&(mr(r,10),Md(r,i));let l=s.cid;l!==void 0&&(mr(r,16),mr(r,l));let A=s.cname;A!==void 0&&(mr(r,26),Md(r,A));let u=s.deviceId;u!==void 0&&(mr(r,34),Md(r,u));let m=s.elapse;m!==void 0&&(mr(r,40),Qu(r,m));let f=s.fileSize;f!==void 0&&(mr(r,48),Qu(r,zf(f)));let b=s.height;b!==void 0&&(mr(r,56),Qu(r,zf(b)));let w=s.jpg;w!==void 0&&(mr(r,66),mr(r,w.length),function(Fr,We){let ct=qf(Fr,We.length);Fr.bytes.set(We,ct)}(r,w));let _=s.networkType;_!==void 0&&(mr(r,72),Qu(r,zf(_)));let S=s.osType;S!==void 0&&(mr(r,80),Qu(r,zf(S)));let F=s.requestId;F!==void 0&&(mr(r,90),Md(r,F));let B=s.sdkVersion;B!==void 0&&(mr(r,98),Md(r,B));let j=s.sequence;j!==void 0&&(mr(r,104),Qu(r,zf(j)));let K=s.sid;K!==void 0&&(mr(r,114),Md(r,K));let X=s.timestamp;X!==void 0&&(mr(r,120),Qu(r,X));let oe=s.uid;oe!==void 0&&(mr(r,128),mr(r,oe));let xe=s.vid;xe!==void 0&&(mr(r,136),mr(r,xe));let Ee=s.width;Ee!==void 0&&(mr(r,144),Qu(r,zf(Ee)));let me=s.service;me!==void 0&&(mr(r,152),mr(r,me));let Re=s.callbackData;Re!==void 0&&(mr(r,162),Md(r,Re));let He=s.jpgEncryption;He!==void 0&&(mr(r,168),mr(r,He));let Xe=s.requestType;Xe!==void 0&&(mr(r,176),mr(r,Xe));let _t=s.scorePorn;_t!==void 0&&(mr(r,185),F2(r,_t));let ns=s.scoreSexy;ns!==void 0&&(mr(r,193),F2(r,ns));let es=s.scoreNeutral;es!==void 0&&(mr(r,201),F2(r,es));let vs=s.scene;vs!==void 0&&(mr(r,208),mr(r,vs));let ps=s.ossFilePrefix;ps!==void 0&&(mr(r,218),Md(r,ps));let tr=s.serviceVendor;if(tr!==void 0)for(let Fr of tr){mr(r,226);let We=o3();Yse(Fr,We),mr(r,We.limit),Zse(r,We),$se(We)}}(e,t),function(s){let r=s.bytes,i=s.limit;return r.length===i?r:r.subarray(0,i)}(t)}function zse(e){return function(s){let r={};e:for(;!c3(s);){let i=Vd(s);switch(i>>>3){case 0:break e;case 1:r.code=Vd(s);break;case 2:r.msg=l3(s,Vd(s));break;case 3:{let l=Xse(s);r.data=qse(s),s.limit=l;break}default:i3(s,7&i)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function qse(e){let t={};e:for(;!c3(e);){let s=Vd(e);switch(s>>>3){case 0:break e;case 1:t.requestId=l3(e,Vd(e));break;case 2:t.requestType=Vd(e)>>>0;break;case 3:t.scorePorn=U2(e);break;case 4:t.scoreSexy=U2(e);break;case 5:t.scoreNeutral=U2(e);break;case 6:t.requestScene=Vd(e)>>>0;break;case 7:t.scene=Vd(e)>>>0;break;default:i3(e,7&s)}}return t}function Yse(e,t){let s=e.service;s!==void 0&&(mr(t,8),mr(t,s));let r=e.vendor;r!==void 0&&(mr(t,16),mr(t,r));let i=e.token;i!==void 0&&(mr(t,26),Md(t,i));let l=e.callbackUrl;l!==void 0&&(mr(t,34),Md(t,l))}function Xse(e){let t=Vd(e),s=e.limit;return e.limit=e.offset+t,s}function i3(e,t){switch(t){case 0:for(;128&d3(e););break;case 2:j2(e,Vd(e));break;case 5:j2(e,4);break;case 1:j2(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Jse=new Float32Array(1);new Uint8Array(Jse.buffer);let L2=new Float64Array(1),eo=new Uint8Array(L2.buffer);function zf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let a3=[];function o3(){const e=a3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function $se(e){a3.push(e)}function j2(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function c3(e){return e.offset>=e.limit}function qf(e,t){let s=e.bytes,r=e.offset,i=e.limit,l=r+t;if(l>s.length){let A=new Uint8Array(2*l);A.set(s),e.bytes=A}return e.offset=l,l>i&&(e.limit=l),r}function P2(e,t){let s=e.offset;if(s+t>e.limit)throw new Error("Read past limit");return e.offset+=t,s}function l3(e,t){let s=P2(e,t),r=String.fromCharCode,i=e.bytes,l="",A="";for(let u=0;u<t;u++){let m,f,b,w,_=i[u+s];128&_?(224&_)==192?u+1>=t?A+=l:(m=i[u+s+1],(192&m)!=128?A+=l:(w=(31&_)<<6|63&m,w<128?A+=l:(A+=r(w),u++))):(240&_)==224?u+2>=t?A+=l:(m=i[u+s+1],f=i[u+s+2],(49344&(m|f<<8))!=32896?A+=l:(w=(15&_)<<12|(63&m)<<6|63&f,w<2048||w>=55296&&w<=57343?A+=l:(A+=r(w),u+=2))):(248&_)==240?u+3>=t?A+=l:(m=i[u+s+1],f=i[u+s+2],b=i[u+s+3],(12632256&(m|f<<8|b<<16))!=8421504?A+=l:(w=(7&_)<<18|(63&m)<<12|(63&f)<<6|63&b,w<65536||w>1114111?A+=l:(w-=65536,A+=r(55296+(w>>10),56320+(1023&w)),u+=3))):A+=l:A+=r(_)}return A}function Md(e,t){let s=t.length,r=0;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}mr(e,r);let i=qf(e,r),l=e.bytes;for(let A=0;A<s;A++){let u=t.charCodeAt(A);u>=55296&&u<=56319&&A+1<s&&(u=(u<<10)+t.charCodeAt(++A)-56613888),u<128?l[i++]=u:(u<2048?l[i++]=u>>6&31|192:(u<65536?l[i++]=u>>12&15|224:(l[i++]=u>>18&7|240,l[i++]=u>>12&63|128),l[i++]=u>>6&63|128),l[i++]=63&u|128)}}function Zse(e,t){let s=qf(e,t.limit),r=e.bytes,i=t.bytes;for(let l=0,A=t.limit;l<A;l++)r[l+s]=i[l]}function d3(e){return e.bytes[P2(e,1)]}function A3(e,t){let s=qf(e,1);e.bytes[s]=t}function U2(e){let t=P2(e,8),s=e.bytes;return eo[0]=s[t++],eo[1]=s[t++],eo[2]=s[t++],eo[3]=s[t++],eo[4]=s[t++],eo[5]=s[t++],eo[6]=s[t++],eo[7]=s[t++],L2[0]}function F2(e,t){let s=qf(e,8),r=e.bytes;L2[0]=t,r[s++]=eo[0],r[s++]=eo[1],r[s++]=eo[2],r[s++]=eo[3],r[s++]=eo[4],r[s++]=eo[5],r[s++]=eo[6],r[s++]=eo[7]}function Vd(e){let t,s=0,r=0;do t=d3(e),s<32&&(r|=(127&t)<<s),s+=7;while(128&t);return r}function mr(e,t){for(t>>>=0;t>=128;)A3(e,127&t|128),t>>>=7;A3(e,t)}function Qu(e,t){let s=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,l=i===0?r===0?s<16384?s<128?1:2:s<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,A=qf(e,l),u=e.bytes;switch(l){case 10:u[A+9]=i>>>7&1;case 9:u[A+8]=l!==9?128|i:127&i;case 8:u[A+7]=l!==8?r>>>21|128:r>>>21&127;case 7:u[A+6]=l!==7?r>>>14|128:r>>>14&127;case 6:u[A+5]=l!==6?r>>>7|128:r>>>7&127;case 5:u[A+4]=l!==5?128|r:127&r;case 4:u[A+3]=l!==4?s>>>21|128:s>>>21&127;case 3:u[A+2]=l!==3?s>>>14|128:s>>>14&127;case 2:u[A+1]=l!==2?s>>>7|128:s>>>7&127;case 1:u[A]=l!==1?128|s:127&s}}function u3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}const ere=new Map([["moderation",1],["supervise",2]]);class tre extends Vr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const s=this._connectionState;this._connectionState=t,this.emit(ci.CONNECTION_STATE_CHANGE,s,t)}get inspectType(){return this._inspectType}set inspectType(t){var s;this._inspectMode=za(s=t.map(r=>ere.get(r)||0)).call(s,(r,i)=>r+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),U(this,"name","AgoraRTCVideoContentInspect"),U(this,"_connectionState",Zc.CONNECTING),U(this,"_innerConnectionState",void 0),U(this,"sequence",0),U(this,"inspectStartTime",void 0),U(this,"workerManagerConnection",void 0),U(this,"workerConnection",void 0),U(this,"workerMessageLengthLimit",void 0),U(this,"inspectIntervalMinimum",void 0),U(this,"qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Da.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"wmSequence",0),U(this,"inspectInterval",void 0),U(this,"inspectTimer",null),U(this,"ossFilePrefix",void 0),U(this,"extraInfo",void 0),U(this,"_inspectType",void 0),U(this,"_inspectMode",void 0),U(this,"_quality",1),U(this,"qualityTimer",null),U(this,"_inspectId",void 0),U(this,"_needWorkUrlOnly",!1),U(this,"inspectImage",()=>{if(this.connectionState!==Zc.CONNECTED)throw new Le(W.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Zc.CONNECTED?this.requestToInspectImage():N.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new q0("worker-manager-"+this._inspectId,gn),this.on(ci.STATE_CHANGE,(s,r)=>{this._innerConnectionState=s,N.debug("[".concat(this._inspectId,"] Inspect operation :").concat(el[s]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new q0("worker-"+this._inspectId,gn),this.handleWorkerEvents()}async init(t,s){this.emit(ci.STATE_CHANGE,el.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=s,new pt((i,l)=>{this.on(ci.CONNECTION_STATE_CHANGE,(A,u)=>{u===Zc.CONNECTED&&i()}),this.requestAP(t,r,s).then(A=>{this.connectWorkerManager(A)}).catch(A=>{l(A)})})}async requestAP(t,s,r){const i=G("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),l=await function(u,m,f,b){let{appId:w,areaCode:_,cname:S,sid:F,token:B,uid:j}=m;Lf++;const K="image_moderation_api",X={service_name:K,json_body:JSON.stringify({appId:w,areaCode:_,cname:S,command:"allocateEdge",requestId:Lf,seq:Lf,sid:F,token:B,ts:Date.now(),uid:j+""})};let oe,xe,Ee=u[0];return jl(async()=>{oe=Date.now();const me=await Ql(Ee,{data:X,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(xe=Date.now()-oe,me.code!==0){const es=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:xe});throw N.error(es.toString()),es}const Re=JSON.parse(me.json_body);if(Re.code!==200){const es=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Re.code,", reason: ").concat(Re.reason),{code:Re.code,responseTime:xe});throw N.error(es.toString()),es}if(!Re.servers||!Array.isArray(Re.servers)||Re.servers.length===0){const es=new Le(W.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Re.code,responseTime:xe});throw N.error(es.toString()),es}const He=G("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(He)return{addressList:[He],workerToken:Re.workerToken,vid:Re.vid,responseTime:xe};const Xe=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_t=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Re.servers.map(es=>{let{address:vs,wss:ps}=es;if(vs&&ps)return"wss://".concat(vs.replace(/\./g,"-"),".").concat(Xe,":").concat(_t||ps)}).filter(es=>!!es),workerToken:Re.workerToken,vid:Re.vid,responseTime:xe}},(me,Re)=>(Ot.apworkerEvent(F,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(me.addressList),firstSuccess:Re===0,responseTime:xe,serverIp:u[Re%u.length]}),!1),(me,Re)=>(Ot.apworkerEvent(F,{success:!1,sc:me.data&&me.data.code||200,serviceName:K,responseTime:xe,serverIp:u[Re%u.length]}),!!(me.code!==W.OPERATION_ABORTED&&me.code!==W.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(Ee=u[(Re+1)%u.length],!0)),b)}(i,t,s,r);this.emit(ci.STATE_CHANGE,el.AP_CONNECTED);const{addressList:A}=l;return this.wmSequence++,A}async connectWorkerManager(t){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ci.STATE_CHANGE,el.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ms.CONNECTED,async()=>{this.emit(ci.STATE_CHANGE,el.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ms.CLOSED,()=>{this._innerConnectionState<el.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ms.FAILED,()=>{this._innerConnectionState<el.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ms.RECONNECTING,()=>{this._innerConnectionState<el.GET_WORKER_MANAGER_RESPONSE&&N.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ms.ON_MESSAGE,async t=>{this.emit(ci.STATE_CHANGE,el.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw N.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new Le(W.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&s))throw N.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new Le(W.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=G("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,l=s.replace(/:\d+\/?$/,":".concat(i));this.emit(ci.STATE_CHANGE,el.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(ci.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(ms.WILL_RECONNECT,(t,s,r)=>{r(t)}),this.workerManagerConnection.on(ms.REQUEST_NEW_URLS,(t,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(s)})}handleWorkerEvents(){this.workerConnection.on(ms.CONNECTED,async()=>{this.emit(ci.STATE_CHANGE,el.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Zc.CONNECTED}),this.workerConnection.on(ms.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=zse(new Uint8Array(t.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&N.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ci.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var s;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},l=za(s=Object.keys(i)).call(s,(u,m)=>i[u]>i[m]?u:m,"porn"),A=Object.keys(i).find(u=>u===l);this.emit(ci.INSPECT_RESULT,A)}else this.emit(ci.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(ci.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else N.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ci.INSPECT_RESULT,void 0,new Le(W.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ms.CLOSED,()=>{this.connectionState=Zc.CLOSED}),this.workerConnection.on(ms.FAILED,()=>{this.connectionState=Zc.CLOSED}),this.workerConnection.on(ms.RECONNECTING,()=>{this.connectionState=this.connectionState===Zc.CONNECTED?Zc.RECONNECTING:Zc.CONNECTING}),this.workerConnection.on(ms.WILL_RECONNECT,(t,s,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(ms.REQUEST_NEW_URLS,(t,s)=>{this.workerManagerConnection.close(),this.once(ci.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{s(r)})})}async requestToInspectImage(){this.sequence++;const t=Eo(this,ci.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(ci.INSPECT_RESULT,void 0,new Le(W.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,s);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(ci.INSPECT_RESULT,void 0,new Le(W.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,s){let{appId:r,cname:i,cid:l,vid:A,sid:u,uid:m}=s;const f=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),w=await Vj(b,r,i),_=this.sequence+"-"+l+"-"+m+"-"+f+"-"+dr(12,""),S={appId:r,cid:l,cname:i,deviceId:"",elapse:(F=Number(f-this.inspectStartTime),{low:F|=0,high:F>>31,unsigned:F>=0}),fileSize:w.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:w,networkType:6,osType:7,requestId:_,sdkVersion:"4.24.2",sequence:this.sequence,sid:u,timestamp:fF(f),uid:m,vid:A,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var F;this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const B=Wse(S);if(B.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(K){for(var X=1;X<arguments.length;X++){var oe=arguments[X]!=null?arguments[X]:{};X%2?u3(Object(oe),!0).forEach(function(xe){U(K,xe,oe[xe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(oe)):u3(Object(oe)).forEach(function(xe){Object.defineProperty(K,xe,Object.getOwnPropertyDescriptor(oe,xe))})}return K}({},S);delete j.jpg,N.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return B}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:r,cname:i,cid:l,vid:A,sid:u,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Da.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Zc.CLOSED,this.emit(ci.STATE_CHANGE,el.CLOSED)}}const sre={name:"ContentInspect",create:function(e){let{config:t}=e;return function(s){if(!s)throw new Le(W.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Le(W.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(s.inspectType)];r.forEach(i=>{var l;if(!et(l=["supervise","moderation"]).call(l,i))throw new Le(W.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),s.inspectType=r}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Le(W.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new tre(t)}};var h3=h($e.Object.getOwnPropertySymbols),rre=Is,nre=Wa.indexOf,ire=Ph,M2=ce([].indexOf),p3=!!M2&&1/M2([1],1,-0)<0;rre({target:"Array",proto:!0,forced:p3||!ire("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return p3?M2(this,e,t)||0:nre(this,e,t)}});var are=Ti("Array","indexOf"),ore=O,cre=are,V2=Array.prototype,lre=function(e){var t=e.indexOf;return e===V2||ore(V2,e)&&t===V2.indexOf?cre:t},m3=h(lre);function dre(e,t){if(e==null)return{};var s,r,i=function(A,u){if(A==null)return{};var m={};for(var f in A)if({}.hasOwnProperty.call(A,f)){if(m3(u).call(u,f)!==-1)continue;m[f]=A[f]}return m}(e,t);if(h3){var l=h3(e);for(r=0;r<l.length;r++)s=l[r],m3(t).call(t,s)===-1&&{}.propertyIsEnumerable.call(e,s)&&(i[s]=e[s])}return i}let f3=class{get localCapabilities(){return Dr(this._localCapabilities)}get rtpCapabilities(){return Dr(this._rtpCapabilities)}get candidates(){return Dr(this._candidates)}get iceParameters(){return Dr(this._iceParameters)}get dtlsParameters(){return Dr(this._dtlsParameters)}constructor(e){U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_iceParameters",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname","o/i14u9pJrxRKAsu"),U(this,"firefoxSsrcMidMap",new Map),e=Dr(e);const{remoteIceParameters:t,remoteDtlsParameters:s,candidates:r,remoteRTPCapabilities:i,localCapabilities:l,direction:A,setup:u,videoCodec:m,audioCodec:f}=e;let b;this.setup=u,b=A===wa.RECEIVE_ONLY?ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=s,this._localCapabilities=l;const w=A===wa.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=A===wa.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=A===wa.RECEIVE_ONLY?i.send.videoCodecs:eb(Nt.VIDEO,w,_,m),F=A===wa.RECEIVE_ONLY?i.send.audioCodecs:eb(Nt.AUDIO,w,_,f);for(const B of b.mediaDescriptions)B.attributes.iceUfrag=t.iceUfrag,B.attributes.icePwd=t.icePwd,B.attributes.fingerprints=s.fingerprints,B.attributes.candidates=r,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"&&(B.media.fmts=S.map(j=>j.payloadType.toString(10)),B.attributes.payloads=S,B.attributes.extmaps=w.videoExtensions),B.media.mediaType==="audio"&&(B.media.fmts=F.map(j=>j.payloadType.toString(10)),B.attributes.payloads=F,B.attributes.extmaps=w.audioExtensions,Bf(B));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return SA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,s,r,i){s=s.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:A}=$0(t,this.cname,G("SYNC_GROUP")?s:void 0),u=this.findPreloadMediaDesc(l);if(u){if(kr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,l,r);let f;return m===-1?(f=this.createOrRecycleSendMedia(e,l,A,"sendonly",r,i),this.updateBundleMids()):(f=Dr(this.sessionDesc.mediaDescriptions[m]),f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,i)),kr()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,s){const r=[];return e.forEach(i=>{const l=i._mediaStreamTrack.kind,A=this.findAvailableRecvMediaIndex(l);let u,m=!1;A===-1?(m=!0,u=this.createOrRecycleRecvMedia(i,[],"recvonly",t,s),this.updateBundleMids()):(u=Dr(this.sessionDesc.mediaDescriptions[A]),u.attributes.direction="recvonly"),r.push({mid:u.attributes.mid,needCreateTransceiver:m})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:s,address:r,port:i,type:l,relatedAddress:A,relatedPort:u,priority:m}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:s??"",priority:m?m+"":"",connectionAddress:r??"",port:i?i+"":"",type:l?l+"":"",relAddr:A??"",relPort:u?u+"":"",extension:{}};this.candidates.some(b=>b.priority===f.priority&&b.connectionAddress===f.connectionAddress&&b.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,s,r,i){const l=e._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,u=eb(l,A,this.localCapabilities.send,l===Nt.AUDIO?i:r),m=l===Nt.VIDEO?A.videoExtensions:A.audioExtensions,f="".concat(++this.currentMidIndex);let b={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};b=this.mungRecvMediaDsec(b,e);const w=this.findFirstClosedMedia(l);if(w){const _=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[_]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(s=>et(e).call(e,s.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,s){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(kr()){if(i){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!l||l!==r.attributes.mid)}return!1}return i&&r.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const s=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&s})}predictReceivingMids(e){const t=[];for(let s=0;s<e;s++)t.push((this.currentMidIndex+s+1).toString(10));return t}restartICE(e){e=Dr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,s,r,i,l){const A=this.rtpCapabilities.send,u=e===Nt.VIDEO?A.videoCodecs:A.audioCodecs,m=e===Nt.VIDEO?A.videoExtensions:A.audioExtensions;kr()&&(i="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};f=this.mungSendMediaDesc(f,l);const b=this.findFirstClosedMedia(e);if(b){const w=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[w]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,s){const r=Dr(e);return DN(r),wp(r,t),BN(r,t),a4(r),Kw(r,s,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const s=Dr(e);return Kw(s,t,this.localCapabilities.recv),Bf(s),s}updateRecvMedia(e,t){const s=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(s!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],t);this.sessionDesc.mediaDescriptions[s]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var s;return((s=t.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>kr()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Are=["sdp"];var Br;function g3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function Hu(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?g3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let b3=(Br=class lg extends QU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,s,r){super(t,s),U(this,"direction",void 0),U(this,"name",void 0),U(this,"store",void 0),U(this,"spec",void 0),U(this,"peerConnection",void 0),U(this,"initialOffer",void 0),U(this,"transport",void 0),U(this,"statsFilter",void 0),U(this,"localCandidateCount",0),U(this,"_isInRestartIce",!1),U(this,"mutex",void 0),U(this,"onLocalCandidate",void 0),U(this,"remoteSDP",void 0),U(this,"pendingCandidates",[]),U(this,"localCapabilities",void 0),U(this,"isReady",!1),U(this,"restartCnt",0),U(this,"curTurnServerIndex",0),this.store=s,this.spec=t,this.mutex=new ai("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(lg.resolvePCConfiguration(t,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??wa.SEND_ONLY,this.name=this.direction===wa.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=hw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const s=await jN();if(this.localCapabilities=Z0(s),t){const{sdp:r}=t,i=dre(t,Are),l=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=J0(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(sl(w,b,"videoExtensions",_,S,F),sl(w,b,"videoCodecs",_,S,F),sl(w,b,"audioExtensions",_,S,F),sl(w,b,"audioCodecs",_,S,F),G("RAISE_H264_BASELINE_PRIORITY")){const B=F.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(B!==-1){const j=F.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<B){N.debug("raising H264 baseline profile priority");const K=F.videoCodecs[B];F.videoCodecs.splice(B,1),F.videoCodecs.splice(j,0,K)}j!==-1&&G("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:S,sendrecv:F}}({},{},r);this.remoteSDP=new f3({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const A=await this.peerConnection.createAnswer();if(!A.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const u=kd(A.sdp);await this.peerConnection.setLocalDescription(A);const m=await c4({},{},A.sdp);this.localCapabilities=Z0(m);const f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Hu(Hu({},u),{},{sdp:A.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=kd(r.sdp);return this.initialOffer=r,Hu(Hu({},i),{},{sdp:r.sdp})}}catch(s){throw new Fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:r,dtlsParameters:i}=t,l=await c4({},{},s);this.remoteSDP=new f3({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const A=this.peerConnection.getTransceivers()[0];A!=null&&A.sender&&A.sender.transport&&this.tryBindTransportEvents(A.sender.transport)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Fe(W.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return ka(function*(){const l=yield _s(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[],u=i.remoteSDP.receive(t,s,r);t.forEach((j,K)=>{if(u[K].needCreateTransceiver){const X=i.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});A.push(X),j._updateRtpTransceiver(X)}else{const X=i.peerConnection.getTransceivers().find(oe=>oe.mid===u[K].mid);if(!X)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[K].mid));A.push(X),j._updateRtpTransceiver(X)}}),kr()&&G("SIMULCAST")===!0&&(yield _s(i.applySimulcastForFirefox(A,t)));const m=u.map(j=>j.mid),f=yield _s(i.peerConnection.createOffer()),b=i.mungSendOfferSDP(f.sdp,t,m),w=ba(b),_=m.map(j=>{const K=w.mediaDescriptions.find(X=>X.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return kN(K,G("USE_PUB_RTX"))}),S=A.map((j,K)=>{const X=m[K];return{localSSRC:_[K],id:X}});yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield S}catch(j){const K=i.remoteSDP.toString();throw yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield _s(i.stopSending(m,!0)),j}yield _s(i.applySimulcastEncodings(A,t)),yield _s(i.applySendEncodings(A,t));const F=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return B==null||B(F),yield _s(i.setRemoteDescription({type:"answer",sdp:F})),A.map((j,K)=>{const X=m[K];return{localSSRC:_[K],id:X}})}catch(A){throw A instanceof Fe?A:new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{l()}})()}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(m=>{var f;m.direction="inactive",(f=m.stop)===null||f===void 0||f.call(m)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);if(A){const m=this.remoteSDP.toString(),f=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const b=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(b.sdp,l,t);f==null||f(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);if(A){const u=this.remoteSDP.toString(),m=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(f.sdp,l,t);m==null||m(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else N.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===lp.Auto&&(this.store.p2pTransport=lp.SdRtn,Ls().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lg.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ls().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lg.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=kd(s.sdp);return this.store.descriptionStart(),this.direction===wa.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===wa.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=kd(s.sdp);return await this.peerConnection.setLocalDescription(s),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Fe(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?kr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:Hu(Hu({},Xc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Hu(Hu({},Xc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,s;et(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var s;t.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var l;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(rp(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...lg.turnServerConfigToIceServers(t.turnServer.servers,s,r)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...lg.turnServerConfigToIceServers(t.turnServer.serversFromGateway,s,r)),et(l=[lp.Relay,lp.SdRtn]).call(l,s)&&(i.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(A=>{A.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),N.debug("P2PConnection p2pTransport is ".concat(s)),i}static turnServerConfigToIceServers(t,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],l=t.filter(u=>u.tcpport);N.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(r));const A=l.length>r?l[r]:l[0];switch(s){case lp.SdRtn:const u=t.filter(f=>{var b;return et(b=f.username).call(b,"glb:")&&f.turnServerURL==f.turnServerURL}),m=u.length>r?u[r]:u[0];m&&(i.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(tl(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),i.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(tl(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case lp.Relay:A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(A.turnServerURL,":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(tl(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}));break;default:A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(A.turnServerURL,":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(tl(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"stun:".concat(A.turnServerURL,":").concat(A.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const s=t.iceTransport;s&&(s.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:r,remote:i}=s.getSelectedCandidatePair()||{};if(r&&i){const l=r.address+":"+r.port,A=i.address+":"+i.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Od(l)),", remote ").concat(JSON.stringify(Od(A))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},l={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var A;const{bitrateMax:b,frameRate:w,scaleResolutionDownBy:_}=t._encoderConfig;b&&(l.maxBitrate=1e3*b),et(A=t._hints).call(A,or.LOW_STREAM)&&(w&&(l.maxFramerate=Pa(w)),_&&_>=1&&(l.scaleResolutionDownBy=_))}if(G("DSCP_TYPE")&&Sd()){var u;const b=G("DSCP_TYPE");et(u=["very-low","low","medium","high"]).call(u,b)&&(l.networkPriority=b)}const m=s.getParameters(),f=(r=m.encodings)===null||r===void 0?void 0:r[0];kr()&&!f&&(i.encodings=[l]),f&&Object.assign(f,l),Object.assign(m,i),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof Er&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){const i=ba(t);return s.forEach((l,A)=>{const u=r[A],m=i.mediaDescriptions.find(f=>f.attributes.mid===u);m&&(wp(m,l),LN(m,l,this.store.codec))}),SA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let m=0;m<t.length;m++){var r,i,l,A,u;const f=t[m],b=s[m];if(b instanceof Er&&!et(r=b._hints).call(r,or.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const S=f.sender.getParameters();await f.sender.setParameters(Object.assign(S,w))}}}async applySimulcastEncodings(t,s){if(!kr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof Er&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof Er&&G("SIMULCAST")&&this.store.codec==="vp8"&&!et(s=t._hints).call(s,or.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during P2PConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async A=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(t,s){var r;if(s=s??((r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp)){var i;const l=(i=ba(s).mediaDescriptions.find(A=>A.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var s;await this.peerConnection.setRemoteDescription(t),et(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,s,r){const i=ba(t),l=i.mediaDescriptions.find(A=>A.attributes.mid===s);return l&&r===Nt.AUDIO&&l.media.mediaType==="audio"&&Bf(l),SA(i)}},ft(Br.prototype,"establish",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"establish"),Br.prototype),ft(Br.prototype,"connect",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"connect"),Br.prototype),ft(Br.prototype,"receive",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"receive"),Br.prototype),ft(Br.prototype,"mockReceive",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"mockReceive"),Br.prototype),ft(Br.prototype,"stopReceiving",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"stopReceiving"),Br.prototype),ft(Br.prototype,"restartICE",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"restartICE"),Br.prototype),ft(Br.prototype,"close",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"close"),Br.prototype),ft(Br.prototype,"updateEncoderConfig",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"updateEncoderConfig"),Br.prototype),ft(Br.prototype,"updateSendParameters",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"updateSendParameters"),Br.prototype),ft(Br.prototype,"replaceTrack",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"replaceTrack"),Br.prototype),ft(Br.prototype,"muteLocal",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"muteLocal"),Br.prototype),ft(Br.prototype,"unmuteLocal",[ol],Object.getOwnPropertyDescriptor(Br.prototype,"unmuteLocal"),Br.prototype),Br);function ol(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}let Kl=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var x3,v3,w3,_3,y3,E3,C3,S3,N3,T3,R3,Wr;function I3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function N_(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?I3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let ure=(x3=Wl(Kl.SEND_ONLY),v3=Wl(Kl.SEND_ONLY),w3=Wl(),_3=Wl(Kl.RECEIVE_ONLY),y3=Wl(Kl.RECEIVE_ONLY),E3=Wl(Kl.RECEIVE_ONLY),C3=Wl(Kl.RECEIVE_ONLY),S3=Wl(Kl.RECEIVE_ONLY),N3=Wl(Kl.RECEIVE_ONLY),T3=Wl(),R3=Wl(Kl.RECEIVE_ONLY),Wr=class extends Vr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Vt.StateChange,t,this._state)}constructor(e,t){super(),U(this,"isPlanB",!1),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"sendConnection",void 0),U(this,"recvConnection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"statsCollector",void 0),U(this,"dtlsFailedCount",0),U(this,"sendMutex",void 0),U(this,"recvMutex",void 0),U(this,"_state",ir.Disconnected),U(this,"_restartStates",["disconnected","failed"]),U(this,"reconnectInterval",void 0),U(this,"uploadUnplinkStarted",!1),U(this,"uploadDownlinkStarted",!1),U(this,"uplinkStateUploadInterval",void 0),U(this,"downlinkStatsUploadInterval",void 0),U(this,"handleMuteLocalTrack",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void i(new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(s);if(m.length===0)return void r();const f=m.find(S=>S[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(S=>{let[,{id:F}]=S;return F}));let b=!1;var A,u;s.trackMediaType==="video"?b=!((A=this.localTrackMap.get(rt.LocalAudioTrack))===null||A===void 0||!A.track._muted):b=((u=this.localTrackMap.get(rt.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;const w=this.createMuteMessage(m);await Sr(this,Vt.RequestMuteLocal,w);const _=s.trackMediaType==="video"?Ou.MUTE_LOCAL_VIDEO:Ou.MUTE_LOCAL_AUDIO;await Sr(this,Vt.RequestP2PMuteLocal,{action:_,message:w,isMuteAll:b}),r()}catch(m){i(m)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void i(new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const A=this.filterTobeUnmutedTracks(s);if(A.length===0)return void r();await this.sendConnection.unmuteLocal(A.map(f=>{let[,{id:b}]=f;return b}));const u=this.createUnmuteMessage(A),m=s.trackMediaType==="video"?Ou.UNMUTE_LOCAL_VIDEO:Ou.UNMUTE_LOCAL_AUDIO;await Sr(this,Vt.RequestP2PMuteLocal,{action:m,message:u}),r()}catch(A){i(A)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(s,r,i,l)=>{let A;typeof l=="boolean"&&l||(A=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(rt.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==s||this.state!==ir.Connected)return void r();const{id:f,track:b}=m;f&&(await this.sendConnection.updateSendParameters(f,b),await this.sendConnection.updateEncoderConfig(f,b),this.emit(Vt.UpdateVideoEncoder,b)),r()}catch(m){i(m)}finally{var u;(u=A)===null||u===void 0||u()}}),U(this,"handleUpdateVideoSendParameters",async(s,r,i)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const A=this.localTrackMap.get(rt.LocalVideoTrack);if(!this.sendConnection||!A||A.track!==s||this.state!==ir.Connected)return void r();const{id:u,track:m}=A;u&&await this.sendConnection.updateSendParameters(u,m),r()}catch(A){i(A)}finally{l()}}),U(this,"handleReplaceTrack",async(s,r,i,l)=>{let A;N.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof l=="boolean"&&l||(A=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;const f=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:w}]=b;return s===w});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==ir.Connected)return void r();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(s,f[1].id)),f[0]===rt.LocalVideoTrack&&Ls().supportDualStreamEncoding){const b=this.localTrackMap.get(rt.LocalVideoLowTrack);if(b){const w=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=w,b.track._originMediaStreamTrack=w,await new pt((_,S)=>{this.handleReplaceTrack(b.track,_,S,!0)})}}r()}catch(f){i(f)}finally{var m;(m=A)===null||m===void 0||m()}}),U(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),U(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new G4(e),this.bindStatsUploaderEvents(),this.sendMutex=new ai("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ai("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let s;try{if(t){this.recvConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new b3(e,this.store,wa.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=ir.New,this.sendConnection&&(N.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new b3(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new Fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected}async addRemoteCandidate(e,t){if(t===wa.RECEIVE_ONLY){if(!this.sendConnection)throw new Fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,s){var r=this;return ka(function*(){const i=yield _s(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==ir.Connected){r.throwIfTrackTypeNotMatch(e);const f=e.filter(b=>r.pendingLocalTracks.indexOf(b)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(f))}r.store.pubId=r.store.pubId+1,Qi.markPublishStart(r.store.clientId,r.store.pubId);const l=r.filterTobePublishedTracks(e,t,s);if(l.length===0)return void(yield _s(r.tryToUnmuteAudio(e)));l.forEach(f=>{let{track:b,type:w}=f;const _=Date.now();r.store.publish(b.getTrackId(),w===rt.LocalAudioTrack?"audio":"video",_)}),r.bindLocalTrackEvents(l);const A=yield _s(r.sendConnection.send(l.map(f=>{let{track:b}=f;return b}),r.store.codec,r.store.audioCodec)),u=(yield _s(A.next())).value,m=r.createGatewayPublishMessage(l,u);try{yield m}catch(f){throw A.throw(f),(f==null?void 0:f.code)===W.WS_ABORT&&l.forEach(b=>{let{track:w}=b;r.pendingLocalTracks.indexOf(w)===-1&&r.pendingLocalTracks.push(w)}),r.unbindLocalTrackEvents(l),f}yield _s(A.next()),l.forEach(f=>{let{type:b}=f;r.statsCollector.addLocalStats(b)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(l,u),l.forEach(f=>{let{track:b,type:w}=f;const _=Date.now();r.store.publish(b.getTrackId(),w===rt.LocalAudioTrack?"audio":"video",void 0,_)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==ir.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!et(e).call(e,i)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const s=t.find(i=>i[0]==="videoLowTrack");s&&s[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:l}]=i;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[l,{track:A}]=i;return{type:l,track:A}})),t.forEach(i=>{let[l]=i;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ir.Connected)return s&&s[1].track.close(),r;e.forEach(i=>{const l=this.pendingLocalTracks.indexOf(i);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],s=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:l,ssrcs:A}]=r;const u={stream_type:ete(l,i),ssrcs:A};l._muted||!l._enabled?t.push(u):s.push(u)}),t.length>0&&t.forEach(r=>{Sr(this,Vt.RequestMuteLocal,[r])}),s.length>0&&s.forEach(r=>{Sr(this,Vt.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ka(function*(){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(N.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cn(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,s,r){var i;if(!this.recvConnection)throw new Fe(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;const{track:l,mid:A,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:s}],String(e.uid),r);t===Nt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Sf(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Cf(l,e.uid,e._uintid,this.store),N.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,A):this.remoteUserMap.set(e,new Map([[t,A]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const f=this.pendingRemoteTracks.findIndex(b=>{let{user:w,kind:_}=b;return w.uid===e.uid&&t===_});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Vt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,s,r){if(!this.recvConnection)throw new Fe(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:s}],String(e.uid),r)}async unsubscribe(e,t,s){const r=this.pendingRemoteTracks.filter(l=>{let{user:A,kind:u}=l;return t!==void 0?A.uid===e.uid&&t===u:A.uid===e.uid});if(r.forEach(l=>{const A=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(A,1)}),this.recvConnection||s||r.forEach(l=>{let{kind:A}=l;var u;if(A===Nt.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(A===Nt.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(l=>{let[,{id:A}]=l;return A})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(l=>{let[A,{kind:u}]=l;var m,f;if(u===Nt.VIDEO&&A._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(A._videoSSRC,!1)),u===Nt.VIDEO)this.unbindRemoteTrackEvents(A._videoTrack),s||((f=A._videoTrack)===null||f===void 0||f._destroy(),A._videoTrack=void 0);else if(u===Nt.AUDIO){var b;this.unbindRemoteTrackEvents(A._audioTrack),!s&&((b=A._audioTrack)===null||b===void 0||b._destroy(),A._audioTrack=void 0)}}),i.forEach(l=>{let[,{kind:A}]=l;Sr(this,Vt.RequestP2PMuteRemote,A)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,s]=t;[Nt.VIDEO,Nt.AUDIO].forEach(r=>{s.has(r)?Sr(this,Vt.RequestP2PUnmuteRemote,r):Sr(this,Vt.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Fe(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(t))return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Nt.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(t)||N.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(rt.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ln){const s=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==rt.LocalAudioTrack}).filter(r=>{let[i]=r;return!(e&&i===rt.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[r]=s;return!(e&&r===rt.LocalVideoLowTrack)}).map(s=>{let[,{track:r}]=s;return r})}reportPublishEvent(e,t,s,r,i){if(e){const A=this.localTrackMap.get(rt.LocalAudioTrack),u=r?this.localTrackMap.get(rt.LocalVideoLowTrack):this.localTrackMap.get(rt.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var l;s||(s=[]);const A=s.find(m=>m instanceof nn),u=r?(l=this.localTrackMap.get(rt.LocalVideoTrack))===null||l===void 0?void 0:l.track:s.find(m=>m instanceof Er);Ot.publish(this.store.sessionId,{eventElapse:Qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:A==null?void 0:A.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(or.SCREEN_TRACK))!==-1,audio:!!A,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,s,r){const i=r===Nt.VIDEO?s._videoSSRC:s._audioSSRC;i&&Ot.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Nt.VIDEO,audio:r===Nt.AUDIO,peerid:s.uid,subscribeRequestid:r===Nt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Qi.measureFromSubscribeStart(this.store.clientId,i)})}reset(){N.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ai("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ai("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(rt.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ln){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(s=>{t.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ir.Disconnected}getStats(e){var t,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(rt.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(rt.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Er||t&&t.track instanceof nn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!t||s.has(t))}getRemoteMedia(e){var t;const s=Array.from(Ji(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[r]=s;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(rt.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=zh(e).call(e,(s,r)=>s.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(N.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var s;t._videoTrack&&t._videoTrack._player&&((s=t._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[s,{track:r}]=e;switch(s){case rt.LocalVideoTrack:et(t=r._hints).call(t,or.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case rt.LocalAudioTrack:r instanceof Ln?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case rt.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;Array.from(Ji(s).call(s)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),N.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const s of this.pendingRemoteTracks){const{user:r,kind:i}=s;if((e instanceof Bu?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let s,r;if(e===wa.SEND_ONLY){if(!this.sendConnection)throw new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const i=await r.restartICE(t);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const l=await Cn(this,Vt.RequestP2PRestartICE,{direction:wa.RECEIVE_ONLY,iceParameter:i});await r.restartICE(l),r.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(rt.LocalVideoTrack),s=this.localTrackMap.get(rt.LocalAudioTrack),r=e.videoSend.find(S=>{var F;return S.ssrc===(t==null||(F=t.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)}),i=e.audioSend.find(S=>{var F;return S.ssrc===(s==null||(F=s.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)});if(!r||!i)return 1;const l=Eo(this,Vt.NeedSignalRTT),A=r?r.rttMs:void 0,u=i?i.rttMs:void 0,m=A&&u?(A+u)/2:A||u,f=(m&&l?(m+l)/2:m||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*f/1500,w=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,_=t==null?void 0:t.track;if(_&&_._encoderConfig&&_._hints.indexOf(or.SCREEN_TRACK)===-1){const S=_._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(S&&F){const B=(1e3*S-F)/(1e3*S);return BU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[r]=s;const i=r._audioSSRC,l=r._videoSSRC,A=e.audioRecv.find(F=>F.ssrc===i),u=e.videoRecv.find(F=>F.ssrc===l);if(!A&&!u)return void(t+=1);const m=Eo(this,Vt.NeedSignalRTT),f=e.rtt,b=(f&&m?(f+m)/2:f||m)||0,w=A?A.jitterMs:void 0,_=e.recvPacketLossRate;let S=.7*_*100/50+.3*b/1500;w&&(S=.6*_*100/50+.2*b/1500+.2*w/400),t+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new pt((t,s)=>{this.handleMuteLocalTrack(e,t,s)})}filterTobePublishedTracks(e,t,s){const r=[],i=Ls(),l=this.getAllTracks();e=uf(e=e.filter(m=>l.indexOf(m)===-1));let A=!1,u=!1;for(const m of e){if(m instanceof Er&&(this.localTrackMap.has(rt.LocalVideoTrack)||A?new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:rt.LocalVideoTrack}),A=!0),t)){const f=this.getLowVideoTrack(m,s);r.push({track:f,type:rt.LocalVideoLowTrack})}if(m instanceof nn){const f=this.localTrackMap.get(rt.LocalAudioTrack);if(f){if(!(f.track instanceof Ln))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(u){const b=r.find(w=>{let{type:_}=w;return _===rt.LocalAudioTrack});if(!(b.track instanceof Ln))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(m)}else{if(!i.webAudioMediaStreamDest||m instanceof Ln||m._bypassWebAudio)r.push({track:m,type:rt.LocalAudioTrack});else{const b=new Ln;b.addAudioTrack(m),r.push({track:b,type:rt.LocalAudioTrack})}u=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],s=this.getAllTracks();e=uf(e=e.filter(r=>s.indexOf(r)!==-1));for(const r of e){if(r instanceof nn){const i=this.localTrackMap.get(rt.LocalAudioTrack);if(!i)continue;i.track instanceof Ln?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(t.push([rt.LocalAudioTrack,i]),i.track.close())):t.push([rt.LocalAudioTrack,i])}if(r instanceof Er){const i=this.localTrackMap.get(rt.LocalVideoTrack);if(!i)continue;t.push([rt.LocalVideoTrack,i]);const l=this.localTrackMap.get(rt.LocalVideoLowTrack);l&&t.push([rt.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:s,type:r}=t;switch(r){case rt.LocalVideoTrack:s.addListener(Dt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case rt.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case rt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ln?e.trackList.forEach(s=>{s.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Dt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[s,{track:r}]=t;return{track:r,type:s}})),e.forEach(t=>{let{track:s,type:r}=t;switch(r){case rt.LocalVideoTrack:s.off(Dt.GET_STATS,this.handleGetLocalVideoStats),s.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case rt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case rt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ln?e.trackList.forEach(t=>{t.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Dt.GET_STATS,this.handleGetLocalAudioStats),t.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Dt.GET_STATS,this.handleGetLocalAudioStats),e.off(Dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cf&&t.addListener(Dt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),t instanceof Sf&&t.addListener(Dt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,s]=e;s.has(Nt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),s.has(Nt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((s,r)=>{var i;let l,{track:A,type:u}=s;switch(u){case rt.LocalAudioTrack:l=ur.Audio;break;case rt.LocalVideoTrack:l=et(i=A._hints).call(i,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:l=ur.Low}return{kind:u===rt.LocalAudioTrack?Nt.AUDIO:Nt.VIDEO,stream_type:l,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:A.muted||!A.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}assignLocalTracks(e,t){e.forEach((s,r)=>{let{track:i,type:l}=s;this.localTrackMap.set(l,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[s]=t;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var s;N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Vt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),et(s=this._restartStates).call(s,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Yn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:yr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(l=>l._audioSSRC===t);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(bc.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_DECODE,Ur.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._audioSSRC===t);r&&Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_AUDIO_RECEIVED,Ur.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,s,r)=>{this.reportVideoFirstFrameDecoded(t,s,r)},e.onFirstVideoReceived=t=>{var s;const r=Array.from(Ji(s=this.remoteUserMap).call(s)).find(i=>i._videoSSRC===t);r&&Ot.firstRemoteFrame(this.store.sessionId,Bn.FIRST_VIDEO_RECEIVED,Ur.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,s)=>{const r=t.candidateType==="relay",i=s.candidateType==="relay";s.candidateType!=="unknown"&&r===i||this.emit(Vt.ConnectionTypeChange,r),N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,s)=>{N.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ku(s))," -> ").concat(JSON.stringify(ku(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Vt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===wa.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,N.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===wa.SEND_ONLY?this.restartICE(e):Cn(this,Vt.RequestP2PRestartICE,{direction:wa.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const s=this.localTrackMap.get(rt.LocalAudioTrack);if(e instanceof nn&&(s==null?void 0:s.track)instanceof Ln)return s.track.isActive||t.push([rt.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r&&(t.push(r),r[0]===rt.LocalVideoTrack)){const i=this.localTrackMap.get(rt.LocalVideoLowTrack);i&&t.push([rt.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){const t=[],s=this.localTrackMap.get(rt.LocalAudioTrack);if(e instanceof nn&&(s==null?void 0:s.track)instanceof Ln)return s.track.isActive&&t.push([rt.LocalAudioTrack,s]),t;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:l}]=i;return e===l});if(r)if(r[0]===rt.LocalVideoTrack){t.push(r);const i=this.localTrackMap.get(rt.LocalVideoLowTrack);i&&t.push([rt.LocalVideoLowTrack,i])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var s;let r,[i,{track:l,ssrcs:A,id:u}]=t;switch(i){case rt.LocalAudioTrack:r=ur.Audio;break;case rt.LocalVideoTrack:r=et(s=l._hints).call(s,or.SCREEN_TRACK)?ur.Screen:ur.High;break;case rt.LocalVideoLowTrack:r=ur.Low}return{stream_type:r,ssrcs:A,mid:u}})}filterTobeUnSubscribedTracks(e,t){const s=[],r=this.remoteUserMap.get(e);if(!r)return s;if(t){const i=r.get(t);if(!i)return s;s.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(i=>{let[l,A]=i;s.push([e,{kind:l,id:A}])});return s}createUnsubscribeMessage(e){const t=[];return e.forEach(s=>{let[r,{kind:i,id:l}]=s;switch(i){case Nt.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Nt.VIDEO,ssrcId:r._videoSSRC}));case Nt.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Nt.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[s,{kind:r}]=t;const i=this.remoteUserMap.get(s);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(rt.LocalVideoTrack),s=this.localTrackMap.get(rt.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new pt((r,i)=>{this.handleUpdateVideoEncoder(t.track,r,i,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new pt((r,i)=>{this.handleUpdateVideoEncoder(s.track,r,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof nn){const s=this.filterTobeUnmutedTracks(e[t]);if(s.length===0)continue;const r=this.createUnmuteMessage(s);return void await Sr(this,Vt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yn(lw(this.dtlsFailedCount,gn)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(rt.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Er)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Er).length>1)throw new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof nn).length>1&&(e.some(t=>t instanceof nn&&t._bypassWebAudio)||!Ls().webAudioMediaStreamDest))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Er&&this.pendingLocalTracks.some(s=>s instanceof Er))throw new Fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof nn&&this.pendingLocalTracks.some(s=>s instanceof nn)&&(!Ls().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof nn&&s._bypassWebAudio)))throw new Fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const s=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ls().supportDualStreamEncoding,r=N_(N_({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=s?e._mediaStreamTrack.clone():t2(e,r);const l=dr(8,"track-low-"),A=new Er(i,N_(N_({},s&&{scaleResolutionDownBy:ON(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,l);return A.on(up.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,xf.LOW_STREAM)}),A._hints.push(or.LOW_STREAM),e.addListener(Dt.NEED_CLOSE,()=>{A.close()}),A}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,s,r){var i;const l=Array.from(Ji(i=this.remoteUserMap).call(i)).find(A=>A._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const A=this.store.keyMetrics,u=A.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,Bn.FIRST_VIDEO_DECODE,Ur.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:s,subscribeElapse:Qi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:A.requestAPEnd||0,apStart:A.requestAPStart||0,joinGwEnd:A.joinGatewayEnd||0,joinGwStart:A.joinGatewayStart||0,pcEnd:A.peerConnectionEnd||0,pcStart:A.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,s){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const l=await this.recvConnection.getRemoteSSRC(i);return l!==void 0&&l!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Fe(W.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Fe(W.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Fe(W.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Fe(W.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Fe(W.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Fe(W.NOT_SUPPORTED)}async preConnect(e){throw new Fe(W.NOT_SUPPORTED)}getEstablishParams(){throw new Fe(W.NOT_SUPPORTED)}async reSubscribe(e){throw new Fe(W.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Fe(W.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:s}]=e;t===rt.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,xf.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},ft(Wr.prototype,"p2pConnect",[x3],Object.getOwnPropertyDescriptor(Wr.prototype,"p2pConnect"),Wr.prototype),ft(Wr.prototype,"unpublish",[v3],Object.getOwnPropertyDescriptor(Wr.prototype,"unpublish"),Wr.prototype),ft(Wr.prototype,"unpublishLowStream",[w3],Object.getOwnPropertyDescriptor(Wr.prototype,"unpublishLowStream"),Wr.prototype),ft(Wr.prototype,"subscribe",[_3],Object.getOwnPropertyDescriptor(Wr.prototype,"subscribe"),Wr.prototype),ft(Wr.prototype,"mockSubscribe",[y3],Object.getOwnPropertyDescriptor(Wr.prototype,"mockSubscribe"),Wr.prototype),ft(Wr.prototype,"unsubscribe",[E3],Object.getOwnPropertyDescriptor(Wr.prototype,"unsubscribe"),Wr.prototype),ft(Wr.prototype,"muteRemote",[C3],Object.getOwnPropertyDescriptor(Wr.prototype,"muteRemote"),Wr.prototype),ft(Wr.prototype,"unmuteRemote",[S3],Object.getOwnPropertyDescriptor(Wr.prototype,"unmuteRemote"),Wr.prototype),ft(Wr.prototype,"hasRemoteMediaWithLock",[N3],Object.getOwnPropertyDescriptor(Wr.prototype,"hasRemoteMediaWithLock"),Wr.prototype),ft(Wr.prototype,"disconnectForReconnect",[T3],Object.getOwnPropertyDescriptor(Wr.prototype,"disconnectForReconnect"),Wr.prototype),ft(Wr.prototype,"remoteMediaSsrcChanged",[R3],Object.getOwnPropertyDescriptor(Wr.prototype,"remoteMediaSsrcChanged"),Wr.prototype),Wr);function Wl(e){return function(t,s,r){const i=t[s];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var l=arguments.length,A=new Array(l),u=0;u<l;u++)A[u]=arguments[u];switch(e){case Kl.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{m()}}case Kl.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(s)),f=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await i.apply(this,A)}finally{m(),f()}}}},r}}class Dp extends Vr{constructor(t,s){super(),U(this,"signal",void 0),U(this,"token",void 0),U(this,"tokenTimeout",void 0),U(this,"tokenInterval",void 0),U(this,"_sequence",0),U(this,"userMap",new Map),U(this,"encoder",new TextEncoder),this.signal=t,this.token=s;const r=()=>{this.signal.connectionState===Vs.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*G("P2P_TOKEN_INTERVAL"))};r()}async send(t,s,r,i,l){var A;if(this.userMap.size===0)return;const u=Array.from(wo(A=this.userMap).call(A))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),i=i??dr(6,""),l=l??this._sequence++;const m={_id:i,_type:t,_seq:l,_message:s,token:"".concat(this.token,"_").concat(u)};G("SHOW_P2P_LOG")&&N.debug("send message",m,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(m)).forEach(b=>{this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(b))})});const f=new pt((b,w)=>{const _=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),S),this.off("res-@".concat(i),B),this.off(Of.ABORT,F),N.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?w(new Fe(W.INVALID_REMOTE_USER)):w(new Fe(W.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),S=()=>{_&&window.clearTimeout(_),this.off(Of.ABORT,F),r&&b()},F=()=>{_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),S),this.off("res-@".concat(i),B),w(new Fe(W.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(Of.ABORT,F),this.once("res-@".concat(i,"_ack"),S);const B=(K,X)=>{j=!0,_&&window.clearTimeout(_),this.off("res-@".concat(i,"_ack"),S),this.off(Of.ABORT,F),K==="success"?b(X):w(new Fe(W.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))};let j=!1;r||(this.once("res-@".concat(i),B),Yn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||N.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(m))}))});try{return await f}catch(b){if(b.code===W.TIMEOUT)return await this.send(t,s,r,i,l);throw b}}onMessage(t){var s;const{_uid:r}=t;let i,l=this.userMap.get(r);if(l)i=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==An.CHECK)return;const{token:f}=t;i=new Map,l={uid:r,isStart:!0,token:f,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,l),this.signal.emit(as.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var A;const{id:f,total:b}=t,w=(A=i.get(f))!==null&&A!==void 0?A:[];if(w.push(t),i.has(f)||i.set(f,w),w.length!==b)return;{const _=zh(w).call(w,(S,F)=>S.index-F.index).map(S=>S.payload).join("");i.delete(f),(t=JSON.parse(_))._uid=r}}const{_type:u,token:m}=t;if(et(s=[An.ACK,An.CHECK]).call(s,u))return u===An.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):N.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:dr(6,""),token:this.token,_type:An.CHECK};G("SHOW_P2P_LOG")&&N.debug("send message",t),this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(JSON.stringify(t)))})}ack(t){const s={_id:t,_type:An.ACK,token:this.token};G("SHOW_P2P_LOG")&&N.debug("send message",s),this.signal.request(Mt.DATA_STREAM,{payload:Nu(this.encoder.encode(JSON.stringify(s)))})}response(t,s,r){this.send(An.RESPONSE,JSON.stringify({success:!r,message:s}),!0,t)}handleReceivedMessage(t){const s=()=>{this.userMap.forEach(f=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:w}=f;for(;b.has(w);){const _=b.get(w);b.delete(w),this.receiveMessage(_),f.nextExpectedSequenceNumber++}})};if(!t)return void s();const{_uid:r,_seq:i}=t,l=this.userMap.get(r),{receivedMessagesMap:A,isStart:u,nextExpectedSequenceNumber:m}=l;if(i<m)return this.ack(t._id),void N.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));A.set(i,t),u&&i===m&&(this.receiveMessage(t),A.delete(m),l.nextExpectedSequenceNumber++,s())}receiveMessage(t){const{_id:s,_type:r,_message:i,_uid:l}=t;if(G("SHOW_P2P_LOG")&&N.debug("receive message",t),s){let A;switch(t._type!==An.ACK&&(i&&(A=JSON.parse(i)),this.ack(t._id)),t._type){case An.CANDIDATE:case An.CONTROL:this.signal.emit(r,A,l);break;case An.PUBLISH:case An.UNPUBLISH:case An.RESTART_ICE:case An.CALL:A.uid=l,Cn(this.signal,r,A).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case An.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case An.RESPONSE:{const{success:u,message:m}=A;this.emit("res-@".concat(s),u?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Dp.MAX_MESSAGE_SIZE)return[t];const s=[],{remoteToken:r}=JSON.parse(t),i=dr(6,"");let l=0,A=800;const u=Math.ceil(t.length/A);for(;t.length>0;){l++;const m={id:i,index:l,total:u,payload:t.slice(0,A),token:"".concat(this.token,"_").concat(r)};JSON.stringify(m).length>Dp.MAX_MESSAGE_SIZE?A-=50:(s.push(m),t=t.slice(A))}return s.map(m=>JSON.stringify(m))}handleCheckToken(t,s){return t.token!==s?(N.debug("token changed, from ".concat(t.token," to ").concat(s)),this.reset(t.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{N.debug("token timeout, ".concat(s)),this.reset(t.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Cn(this.signal,An.CALL,void 0),s=await this.send(An.CALL,t);this.signal.emit(Bt.P2P_CONNECTION,s,!0)}async reset(t,s){const r=this.userMap.get(t);r&&(this.emit(Of.ABORT),this.signal.emit(as.ON_USER_OFFLINE,{uid:r.uid,reason:Tee.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(N.debug("change local token from ".concat(s," to ").concat(s)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Of.ABORT)}}U(Dp,"MAX_SIZE",1),U(Dp,"MAX_MESSAGE_SIZE",1024);class hre extends Vr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Vs.CONNECTED?this.emit(Bt.WS_CONNECTED):t===Vs.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):t===Vs.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,s){super(),U(this,"__name__","P2PSignal"),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",Vs.CLOSED),U(this,"reconnectToken",void 0),U(this,"p2pToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new B1(5)),U(this,"pingpongTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"_external_signal",void 0),U(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case as.ON_DATA_STREAM:return void this.handleDataStream(i._message);case as.MUTE_AUDIO:case as.MUTE_VIDEO:case as.ON_P2P_LOST:case as.ON_USER_ONLINE:return;case as.ON_USER_OFFLINE:const{uid:l}=i._message;return N.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Ms.UID_BANNED);break;case 15:this.close(Ms.IP_BANNED);break;case 16:this.close(Ms.CHANNEL_BANNED)}if(i._type===as.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Wt.ERR_LICENSE_MISSING:this.close(Ms.LICENSE_MISSING);break;case Wt.ERR_LICENSE_EXPIRED:this.close(Ms.LICENSE_EXPIRED);break;case Wt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ms.LICENSE_MINUTES_EXCEEDED);break;case Wt.ERR_LICENSE_PERIOD_INVALID:this.close(Ms.LICENSE_PERIOD_INVALID);break;case Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ms.LICENSE_MULTIPLE_SDK_SERVICE);break;case Wt.ERR_LICENSE_ILLEGAL:this.close(Ms.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new TN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Vs.CONNECTED&&this.reconnect("retry",Ii.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new Dp(this,this.p2pToken)}async request(t,s,r,i){const l=dr(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,m=()=>new pt((F,B)=>{if(this.connectionState===Vs.CONNECTED)return F();const j=()=>{this.off(Bt.WS_CLOSED,K),F()},K=()=>{this.off(Bt.WS_CONNECTED,j),B(new Fe(W.WS_ABORT))};this.once(Bt.WS_CONNECTED,j),this.once(Bt.WS_CLOSED,K)});if(this.connectionState!==Vs.CONNECTING&&this.connectionState!==Vs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await m(),this.websocket.sendMessage(A,!0),i)return;const f=new pt((F,B)=>{let j=!1;const K=(oe,xe)=>{j=!0,F({isSuccess:oe==="success",message:xe||{}}),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.emit(Bt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const X=()=>{B(new Fe(W.WS_ABORT,"type: ".concat(t))),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.off("res-@".concat(l),K)};this.once(Bt.WS_CLOSED,X),this.once(Bt.WS_RECONNECTING,X),Yn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Bt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(F){if(this.connectionState===Vs.CLOSED||t===Mt.LEAVE)throw new Fe(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?F.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await m(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=vp(w),S=new Fe(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message,desc:_.desc});return _.action==="success"?b.message:(N.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Wt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=S,this.close()),S.throw()):_.action==="failed"?S.throw():_.action==="quit"?(this.initError=S,this.close(),S.throw()):(w===Wt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ii.MULTI_IP)):this.reconnect(_.action,Ii.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new pt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(xp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Vs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,s){const r={_type:t,_message:s};this.websocket.sendMessage(r)}async sendExtensionMessage(t,s,r){return await this._external_signal.send(t,s,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,r)=>{this.once(Bt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Bt.WS_CLOSED,()=>r(this.initError||new Fe(W.WS_ABORT))),this.connectionState=Vs.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ms.LEAVE,this.connectionState=Vs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new Dp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const t=await Cn(this,Bt.REQUEST_JOIN_INFO),s=await this.request(Mt.JOIN,t);if(!s)return this.emit(Bt.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Vs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){return!1}handleDataStream(t){try{var s;const r=op(t.payload),i=new TextDecoder().decode(r),l=JSON.parse(i);"total"in l&&"id"in l||et(s=Object.values(An)).call(s,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(as.ON_DATA_STREAM,t)}catch{this.emit(as.ON_DATA_STREAM,t)}}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=vp(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?t.code===Wt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Ms.UID_CONFLICT):(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ms.UID_BANNED),void this.close()):void this.reconnect(s.action,Ii.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ii.TIMEOUT):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(ms.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ms.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ms.CLOSED,()=>{this.connectionState=Vs.CLOSED}),this.websocket.on(ms.FAILED,()=>{this._disconnectedReason=Ms.NETWORK_ERROR,this.connectionState=Vs.CLOSED}),this.websocket.on(ms.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Vs.CONNECTED?this.connectionState=Vs.RECONNECTING:this.connectionState=Vs.CONNECTING}),this.websocket.on(ms.WILL_RECONNECT,(t,s,r)=>{t!=="retry"?(N.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):N.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(ms.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Fe&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Wt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ii.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ii.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ms.REQUEST_NEW_URLS,(t,s)=>{Cn(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(ms.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const pre={name:"P2PChannel",create:function(e){let{store:t,statsCollector:s}=e;return new ure(t,s)},createSubmodule:function(e){let{store:t,spec:s}=e;return new hre(s,t)}};function O3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function k3(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?O3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):O3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}class mre{constructor(t){U(this,"sessionDesc",void 0),U(this,"localCapabilities",void 0),U(this,"rtpCapabilities",void 0),U(this,"candidates",void 0),U(this,"_originCandidates",void 0),U(this,"iceParameters",void 0),U(this,"dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),t=Dr(t);const{iceParameters:s,dtlsParameters:r,candidates:i,rtpCapabilities:l,setup:A,localCapabilities:u,sdkCodec:m,cname:f}=t,b=ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=i,this._originCandidates=Dr(i),this.iceParameters=s,this.dtlsParameters=r,this.setup=A,this.localCapabilities=u,this.cname=f;for(let w=0;w<b.mediaDescriptions.length;w++){const _=b.mediaDescriptions[w];if(_.attributes.iceUfrag=s.iceUfrag,_.attributes.icePwd=s.icePwd,_.attributes.fingerprints=r.fingerprints,_.attributes.candidates=i,_.attributes.setup=A,_.media.mediaType==="video"){_.media.fmts=l.videoCodecs.map(B=>B.payloadType.toString(10));const S=l.videoCodecs.filter(B=>{var j,K;return(j=B.rtpMap)===null||j===void 0?void 0:et(K=j.encodingName.toLowerCase()).call(K,m)}),F=l.videoCodecs.filter(B=>!et(S).call(S,B));_.attributes.payloads=[...S,...F],_.attributes.extmaps=l.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=l.audioCodecs.map(S=>S.payloadType.toString(10)),_.attributes.payloads=l.audioCodecs,_.attributes.extmaps=l.audioExtensions),b.mediaDescriptions[w]=this.mungMediaDesc(_)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return SA(this.sessionDesc)}send(t,s,r){const{ssrcs:i,ssrcGroups:l}=$0(s,this.cname),A=this.sessionDesc.mediaDescriptions.find(f=>t===Nt.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=i[0].attributes.label,m=i[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(i),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(l),{id:u,mslabel:m}}batchSend(t){return t.map(s=>{let{kind:r,ssrcMsg:i}=s;return this.send(r,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(s=>{const r=[],i=[],l=[];s.attributes.ssrcs.forEach(A=>{et(t).call(t,A.attributes.label||"")?l.push(A):r.push(A)}),s.attributes.ssrcGroups.forEach(A=>{var u;et(u=l.map(m=>m.ssrcId)).call(u,A.ssrcIds[0])||i.push(A)}),s.attributes.ssrcs=r,s.attributes.ssrcGroups=i})}mute(t){const s=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){const s=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(t,s,r){t.forEach((i,l)=>{const A=i._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===A.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],i);this.sessionDesc.mediaDescriptions[u]=m})}stopReceiving(t){}updateCandidates(t){const s=this._originCandidates.filter(i=>i.transport==="udp"),r=[];if(s.forEach(i=>{r.push(k3(k3({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),s.length!==0){switch(t){case oi.TCP_RELAY:this.candidates=r;break;case oi.UDP_TCP_RELAY:case oi.RELAY:this.candidates=[...s,...r];break;default:this.candidates=s}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Dr(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=t.iceUfrag,s.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const s=[];for(let r=0;r<t;r++)s.push((this.currentMidIndex+r+1).toString(10));return s}mungRecvMediaDsec(t,s){const r=Dr(t);return wp(r,s),BN(r,s),r}updateRecvMedia(t,s){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],s);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,s,r){const i=this.sessionDesc.mediaDescriptions.find(A=>t===Nt.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(i){const A=i.attributes.ssrcs.find(u=>u.attributes.label===s);var l;A&&(A.attributes.label=r,(l=A.attributes.msid)===null||l===void 0||l.replace(s,r))}}mungMediaDesc(t){const s=Dr(t);return DN(s),function(r){const i=r.attributes.extmaps.find(l=>Gw(l.extensionName));i&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(i),1),r.attributes.payloads.forEach(l=>{const A=l.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");A!==-1&&l.rtcpFeedbacks.splice(A,1)})}(s),s}getSSRC(t){for(const s of this.sessionDesc.mediaDescriptions)for(const r of s.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Nr;function D3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function T_(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?D3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):D3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let fre=(Nr=class Pb extends Fw{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return et(s=Object.keys(dp)).call(s,t)}))]}constructor(t,s){super(t,s),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"statsFilter",void 0),U(this,"useRTX",!1),U(this,"localCapabilities",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"establishPromise",void 0),U(this,"mutex",void 0),this.store=s,this.mutex=new ai("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Pb.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=hw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=kd(t.sdp),r=J0(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,T_(T_({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new Fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new mre(T_(T_({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(t,s){throw new Fe(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,s){var r=this;return ka(function*(){const i=yield _s(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(_=>r.peerConnection.addTrack(_._mediaStreamTrack)),A=yield _s(r.peerConnection.createOffer()),u=ba(A.sdp),m=t.map(_=>{const S=_._mediaStreamTrack,F=u.mediaDescriptions.find(B=>B.attributes.mid===S.kind);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return function(B,j,K){const X=B.attributes.ssrcs.filter(xe=>xe.attributes.label===j),oe=B.attributes.ssrcGroups;if(X.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(oe&&X.length>1){const xe=oe.find(Ee=>Ee.ssrcIds.indexOf(X[0].ssrcId)!==-1);return xe?[{ssrcId:xe.ssrcIds[0],rtx:K?xe.ssrcIds[1]:void 0}]:[{ssrcId:X[0].ssrcId}]}return[{ssrcId:X[0].ssrcId}]}(F,S.id,r.useRTX)});let f;try{f=yield m}catch(_){throw l.forEach(S=>{ii()&&S.replaceTrack(null),r.peerConnection.removeTrack(S)}),_}const b=r.mungSendOfferSDP(A.sdp,t);r.remoteSDP.receive(t,s,f);const w=r.remoteSDP.toString();return yield _s(r.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(r.applySendEncodings(l,t)),yield _s(r.peerConnection.setRemoteDescription({type:"answer",sdp:w})),t.map((_,S)=>{const F=_._mediaStreamTrack.id;return{localSSRC:m[S],id:F}})}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(l=>{var A;return t.indexOf(((A=l.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(l=>{ii()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:A}=this.remoteSDP.send(t,s,i),u=new pt((b,w)=>{const _=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(l)))},1e4),S=F=>{const B=$s();if((B.name==="Safari"&&Number(B.version)===11||Xi())&&F.track.id!==l&&F.streams[0].id===A){var j;const K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,l,F.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(_),void b(K)}if(F.track.id===l)return this.peerConnection.removeEventListener("track",S),clearTimeout(_),void b(F.track)};this.peerConnection.addEventListener("track",S)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await u,id:l}}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(r=>{var i;return t.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(s.length!==t.length)throw new Error("sender' length doesn't match mids' length.");s.map(r=>{if(ii()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(l=>l.active=!1),r.setParameters(i)}})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(l=>{var A;return t.indexOf(((A=l.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(s.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async l=>{if(ii()&&l.track)l.track.enabled=!0;else{const A=l.getParameters();A.encodings.forEach(u=>u.active=!0),await l.setParameters(A)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return ka(function*(){const r=yield _s(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration;if(t===oi.RELAY&&!i)return;if(i){const f=s.peerConnection.getConfiguration(),b=t===oi.RELAY?"relay":"all";f.iceTransportPolicy!==b&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(b,"]")),f.iceTransportPolicy=b,s.peerConnection.setConfiguration(f))}t!==oi.RELAY&&s.remoteSDP.updateCandidates(t);const l=yield _s(s.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const A=kd(l.sdp),{remoteIceParameters:u}=yield A.iceParameters;s.remoteSDP.restartICE(u);const m=s.remoteSDP.toString();yield _s(s.peerConnection.setLocalDescription(l)),yield _s(s.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Fe(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getSenders().filter(i=>{var l;return((l=i.track)===null||l===void 0?void 0:l.id)===t});r.length===1&&await this.applySendEncodings(r,[s])}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getSenders().find(i=>{var l;return((l=i.track)===null||l===void 0?void 0:l.id)===s});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,s){throw new Fe(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Fe(W.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(rp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Pb.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Pb.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(t,s){var r;if(s||(s=this.peerConnection.getSenders().find(f=>{var b;return((b=f.track)===null||b===void 0?void 0:b.id)===t._mediaStreamTrack.id})),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Ls().supportSetRtpSenderParameters)return N.warn("Browser not support set rtp-sender parameters");const i={},l={};if(t instanceof Er)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(G("DSCP_TYPE")&&Sd()){var A;const f=G("DSCP_TYPE");et(A=["very-low","low","medium","high"]).call(A,f)&&(l.networkPriority=f)}const u=s.getParameters(),m=(r=u.encodings)===null||r===void 0?void 0:r[0];m&&Object.assign(m,l),Object.assign(u,i),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await s.setParameters(u)}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];i&&l&&await this.updateRtpSenderEncodings(l,i)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s){const r=ba(t);return s.forEach((i,l)=>{const A=i._mediaStreamTrack,u=r.mediaDescriptions.find(m=>m.attributes.mid===A.kind);u&&wp(u,i)}),SA(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(t).map((l,A)=>{let{id:u,mslabel:m}=l;const{kind:f}=t[A];return new pt((b,w)=>{const _=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),S=F=>{const B=$s();if(B.name==="Safari"&&Number(B.version)===11&&F.track.id!==u&&F.streams[0].id===m){var j;const K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(f,u,F.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(_),void b({track:K,id:u})}if(F.track.id===u)return this.peerConnection.removeEventListener("track",S),clearTimeout(_),void b({track:F.track,id:u})};this.peerConnection.addEventListener("track",S)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await pt.all(s)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s==null?void 0:s[0].ssrcId}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=Pb.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}}},ft(Nr.prototype,"connect",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"connect"),Nr.prototype),ft(Nr.prototype,"stopSending",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"stopSending"),Nr.prototype),ft(Nr.prototype,"receive",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"receive"),Nr.prototype),ft(Nr.prototype,"stopReceiving",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"stopReceiving"),Nr.prototype),ft(Nr.prototype,"muteRemote",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"muteRemote"),Nr.prototype),ft(Nr.prototype,"unmuteRemote",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"unmuteRemote"),Nr.prototype),ft(Nr.prototype,"muteLocal",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"muteLocal"),Nr.prototype),ft(Nr.prototype,"unmuteLocal",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"unmuteLocal"),Nr.prototype),ft(Nr.prototype,"close",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"close"),Nr.prototype),ft(Nr.prototype,"updateEncoderConfig",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"updateEncoderConfig"),Nr.prototype),ft(Nr.prototype,"updateSendParameters",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"updateSendParameters"),Nr.prototype),ft(Nr.prototype,"replaceTrack",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"replaceTrack"),Nr.prototype),ft(Nr.prototype,"getRemoteSSRC",[Ec],Object.getOwnPropertyDescriptor(Nr.prototype,"getRemoteSSRC"),Nr.prototype),Nr);function Ec(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("Locking from P2PConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}const gre={name:"PlanBConnection",create:function(e){let{store:t,spec:s}=e;return new fre(s,t)}},bre={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(Sw.has(e)||!e.track)return;const s={track:e.track};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create audio-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){s.controller||(s.controller=u),e.track&&e.track.id!==s.track.id&&(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const m=t.metadata&&t.metadata();m?function(f,b){const{chunk:w,controller:_}=b,S=Tu.METADATA;w.data=function(F,B,j){const K=j.byteLength,X=K+AN+SU,oe=lN+dN+X,xe=new ArrayBuffer(F.byteLength+oe),Ee=new DataView(xe);Ee.setUint8(0,CU),Ee.setUint16(1,X),Ee.setUint8(3,B),Ee.setUint16(4,K);for(let Re=0;Re<K;Re++)Ee.setUint8(6+Re,j[Re]);const me=new Uint8Array(Ee.buffer);return me.set(new Uint8Array(F),oe),me.buffer}(w.data,S,f),_.enqueue(w)}(m,{chunk:A,controller:u}):u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else if(ii()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=Cw(),l=new MessageChannel;await new pt(u=>i.onmessage=m=>{m.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=A,await new pt(u=>i.onmessage=m=>{m.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var m;if(u.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==s.track.id)N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r);else if(u.data.getMetadata){const f=t.metadata&&t.metadata();f&&l.port1.postMessage({metadata:f})}},s.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Sw.get(e);if(i){Sw.delete(e);try{var l,A;(l=i.controller)===null||l===void 0||l.terminate(),(A=i.worker)===null||A===void 0||A.terminate()}catch(u){N.warning(u&&u.message)}}}Sw.set(e,s),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support audio encoded transform");if(kw.has(e))return;const s={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(EA()&&!Xi()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");v1(er.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create audio-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){s.controller||(s.controller=u),e.track&&e.track.id!==s.track.id&&(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r)),t.enableTopn?function(m,f,b){var w;const _=uN(new DataView(f.data));if(!_)return b.enqueue(f);const S=m.track.id;YZ.set(S,m.track);const F=(w=_.tlv.find(xe=>xe.tag===Tu.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let B=0;typeof F=="number"&&(B=127-F);const j=Math.round(Math.pow(10,B/60)-1),{selected:K,speaker:X}=function(xe,Ee){let me=Nf.get(xe);if(me||(me=function(Re){const He=new TU;return Nf.set(Re,He),Pl||(Pl=new zZ(G("TOPN_SILENCE_THRESHOLD")||500),Pl.on("ActiveSpeakerChanged",Xe=>{Xe!=null&&(Rw=Xe)})),Pl.addSpeakers([He]),He}(xe)),Nf.size<=RU)return{selected:!0,speaker:me};if(!Pl)throw new Error("no active speaker detector");return Pl.levelChanged(me.id,Ee),fp=Pl.loudest.map(Re=>Re.id),Rw&&!et(fp).call(fp,Rw)&&fp.length>=RU&&fp.pop(),{selected:et(fp).call(fp,me.id)||me.id===Rw,speaker:me}}(m,j),oe=function(xe,Ee,me){const Re=Ul.get(xe)||new qZ(xe,Ee);return Re.score=me,Ul.set(xe,Re),function(He){if(Iw.set(He,!0),!Ow)return void(Ow=Date.now());const Xe=Date.now();Xe-Ow>1e3&&(Iw.get(He)?Iw.set(He,!1):(IU(He),Iw.delete(He)),Ow=Xe)}(xe),Re}(S,m.track,X.energyScore);oe.addSample(K),oe.active&&(f.data=_.frame.buffer,b.enqueue(f))}(e,A,u):t.enableMetadata||t.enablePts?function(m,f,b,w){const _=new DataView(m.data),S=_.getUint8(0);let F;if(128&S&&S!==71){const K=function(X){if(X.byteLength<=0)return[];const oe=[];let xe=0;for(;xe<X.byteLength;){const me=(128&X.getUint8(xe))>>7,Re=127&X.getUint8(xe);if(!(me&&xe+4<=X.byteLength)){xe++;break}{const He=X.getUint32(xe,!1),Xe=(16776192&He)>>10,_t=1023&He;oe.push({pt:Re,ts_offset:Xe,length:_t,data:new Uint8Array}),xe+=4}}let Ee=X.byteLength-xe;for(const me of oe){if(me.length>Ee)return console.warn("Broken red payload"),[];me.length>0&&(me.data=new Uint8Array(X.buffer,X.byteOffset+xe,me.length),xe+=me.length,Ee-=me.length)}if(Ee>0){const me={pt:oe.length>0?oe[oe.length-1].pt:0,ts_offset:0,length:Ee,data:new Uint8Array(X.buffer,X.byteOffset+xe,Ee)};oe.push(me)}return oe}(_);if(K.length>0){const X=function(oe){let xe=0;for(let Re=0;Re<oe.length;Re++)xe+=Re<oe.length-1?4:1,xe+=oe[Re].length;const Ee=new Uint8Array(xe);let me=0;for(let Re=0;Re<oe.length;Re++)if(Re<oe.length-1){const He=(2147483648|(127&oe[Re].pt)<<24|(262143&oe[Re].ts_offset)<<10|1023&oe[Re].length)>>>0;Ee[me++]=He>>24&255,Ee[me++]=He>>16&255,Ee[me++]=He>>8&255,Ee[me++]=255&He}else Ee[me++]=127&oe[Re].pt;for(const Re of oe)Ee.set(Re.data,me),me+=Re.length;return Ee}(K.map(oe=>{const xe=new Uint8Array(oe.length);xe.set(oe.data);const Ee=uN(new DataView(xe.buffer));return Ee!=null&&Ee.frame&&(oe.data=Ee==null?void 0:Ee.frame),F=Ee,oe}));m.data=X.buffer}}else F=uN(_),F&&(m.data=F.frame.buffer);if(f.enqueue(m),!F)return;const B=F.tlv.find(K=>K.tag===Tu.METADATA);B&&b&&B.value instanceof Uint8Array&&b(B.value);const j=F.tlv.find(K=>K.tag===Tu.AUDIO_64_BIT_PTS);j&&w&&j.value instanceof Uint8Array&&j.value.length==8&&w(new DataView(j.value.buffer).getBigUint64(0,!0))}(A,u,t.onMetadata,t.onPts):u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=Cw(),l=new MessageChannel;await new pt(u=>i.onmessage=m=>{m.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=A,await new pt(u=>i.onmessage=m=>{m.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var m;u.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==s.track.id?(N.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r)):u.data.metadata&&s.onMetadata?s.onMetadata(u.data.metadata):u.data.pts&&s.onPts&&s.onPts(u.data.pts)},s.worker=i}function r(){e.track.removeEventListener("ended",r),function(i){const l=kw.get(i);if(l){(function(m){const f=Nf.get(m);f&&(Nf.delete(m),Pl&&(Pl.removeSpeakers([f]),Nf.size===0&&(Pl.destroy(),Pl=null)))})(i),IU(i.track.id),kw.delete(i);try{var A,u;(A=l.controller)===null||A===void 0||A.terminate(),(u=l.worker)===null||u===void 0||u.terminate()}catch(m){N.warning(m&&m.message)}}}(e)}kw.set(e,s),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(Dw.has(e)||!e.track)return;const s={track:e.track};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(u){return void N.error("create video-encoded-streams error",u&&u.message)}const l=[];t.on("sei-to-send",u=>{l.push(u)});const A=new TransformStream({transform(u,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const f=DU(new Uint8Array(u.data)),b=l.shift();if(b){const w=function(_,S,F){switch(F){case fN:return function(B,j){const K=kU(j),X=K.length,oe=Math.floor(X/255),xe=X%255,Ee=new Uint8Array(6+oe+1+X+B.byteLength);Ee[0]=0,Ee[1]=0,Ee[2]=0,Ee[3]=1,Ee[4]=6,Ee[5]=101;let me=0;for(;me<oe;)Ee[6+me]=255,me++;return Ee[6+me]=xe,me++,Ee.set(K,6+me),Ee.set(new Uint8Array(B),6+me+X),Ee.buffer}(_,S);case gN:return function(B,j){const K=kU(j),X=K.length,oe=Math.floor(X/255),xe=X%255,Ee=new Uint8Array(7+oe+1+X+1+B.byteLength);Ee[0]=0,Ee[1]=0,Ee[2]=0,Ee[3]=1,Ee[4]=78,Ee[5]=1,Ee[6]=101;let me=0;for(;me<oe;)Ee[7+me]=255,me++;return Ee[7+me]=xe,me++,Ee.set(K,7+me),me+=X,Ee[7+me]=128,me++,Ee.set(new Uint8Array(B),7+me),Ee.buffer}(_,S);default:return null}}(u.data,b,f);w&&(u.data=w)}m.enqueue(u)}});i.readable.pipeThrough(A).pipeTo(i.writable)}else{if(!ii())return;{if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=Cw(),l=new MessageChannel;await new pt(u=>i.onmessage=m=>{m.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=A,await new pt(u=>i.onmessage=m=>{m.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{l.port1.postMessage({sei:u})}),l.port1.onmessage=u=>{var m;u.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r))},s.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const i=Dw.get(e);if(i){Dw.delete(e);try{var l,A;(l=i.controller)===null||l===void 0||l.terminate(),(A=i.worker)===null||A===void 0||A.terminate()}catch(u){N.warning(u&&u.message)}}}Dw.set(e,s),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ls().supportWebRTCEncodedTransform)return void N.warning("browser not support video encoded transform");if(!e.track)return;if(z0.has(e)){const i=z0.get(e);return void(i&&(i.onSei=t.onSei))}const s={track:e.track,onSei:t.onSei};if(EA()){if(!e.createEncodedStreams)return void N.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(A){return void N.error("create video-encoded-streams error",A&&A.message)}const l=new TransformStream({transform(A,u){if(s.controller||(s.controller=u),!s.firstFrameInfo){var m;const b=A.getMetadata()||{};s.firstFrameInfo=Rr({type:A.type,rtpTimestamp:A.timestamp,payloadType:b.payloadType||0,ssrc:b.synchronizationSource||0,length:A.data.byteLength},"mimeType"in b?{mimeType:b.mimeType}:{}),(m=t.onFirstFrame)===null||m===void 0||m.call(t,s.firstFrameInfo)}e.track&&e.track.id!==s.track.id&&(N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r));const f=function(b,w){switch(w){case fN:return function(_){const S=new DataView(_.data);let F=0;for(;F+4<_.data.byteLength;){if(S.getUint8(F+0)===0&&S.getUint8(F+1)===0&&S.getUint8(F+2)===0&&S.getUint8(F+3)===1&&S.getUint8(F+4)===6){let B=F+6,j=0,K=0;for(;(K=S.getUint8(B++))===255;)j+=255;j+=K;const X=OU(_.data,B,j);return new Uint8Array(X)}F++}return null}(b);case gN:return function(_){const S=new DataView(_.data);let F=0;for(;F+5<_.data.byteLength;){if(S.getUint8(F+0)===0&&S.getUint8(F+1)===0&&S.getUint8(F+2)===0&&S.getUint8(F+3)===1&&S.getUint8(F+4)===78&&S.getUint8(F+5)===1&&S.getUint8(F+6)===101){let B=F+7,j=0,K=0;for(;(K=S.getUint8(B++))===255;)j+=255;j+=K;const X=OU(_.data,B,j);return new Uint8Array(X)}F++}return null}(b);default:return null}}(A,DU(new Uint8Array(A.data)));f&&s.onSei&&s.onSei(f),u.enqueue(A)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else if(ii()){if(typeof RTCRtpScriptTransform>"u")return void N.warning("browser not support RTCRtpScriptTransform");const i=Cw(),l=new MessageChannel;await new pt(u=>i.onmessage=m=>{m.data==="registered"&&u(void 0)});const A=new RTCRtpScriptTransform(i,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=A,await new pt(u=>i.onmessage=m=>{m.data==="started"&&u(void 0)}),l.port1.onmessage=u=>{var m;if(u.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==s.track.id)N.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",r),s.track=e.track,s.track.addEventListener("ended",r);else if(u.data.sei&&s.onSei)s.onSei(u.data.sei);else if(u.data.firstFrameInfo&&t.onFirstFrame){var f;(f=t.onFirstFrame)===null||f===void 0||f.call(t,u.data.firstFrameInfo)}},s.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(i){const l=z0.get(i);if(l){z0.delete(i);try{var A,u;(A=l.controller)===null||A===void 0||A.terminate(),(u=l.worker)===null||u===void 0||u.terminate()}catch(m){N.warning(m&&m.message)}}})(e)}z0.set(e,s),e.track.addEventListener("ended",r)}},xre={name:"InterceptFrame",create:()=>bre};var Ys;function B3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}function zl(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?B3(Object(s),!0).forEach(function(r){U(e,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):B3(Object(s)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(s,r))})}return e}let vre=(Ys=class dg extends Fw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,s;return(t=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var s;return et(s=Object.keys(dp)).call(s,t)}))]}constructor(t,s,r){super(t,s),U(this,"id",dr(5,"connection-")),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"forceTurn",!1),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"transportEventReceiver",void 0),U(this,"statsFilter",void 0),U(this,"extension",{useXR:G("USE_XR")}),U(this,"localCapabilities",void 0),U(this,"remoteCodecs",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"isPreallocation",!1),U(this,"preMediaMap",new Map),U(this,"dataStreamChannelMap",new Map),U(this,"establishPromise",void 0),U(this,"recoveredDataChannelIds",[]),U(this,"currentDataChannelId",1),U(this,"supportAV1RtpSpec",!1),U(this,"mutex",void 0),U(this,"qualityLimitationReason",mf.NONE),U(this,"isFirstConnected",!1),this.store=s,this.forceTurn=e2(t),this.mutex=new ai("NVConnectionExtension-mutex",s.clientId),this.peerConnection=r,this.isFirstConnected=!1,this.statsFilter=hw(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,kr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,s){if(this.remoteCodecs=s,!this.remoteSDP)return void N.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(t,s,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else N.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=kd(s.sdp),i=await jN({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=Z0(i),this.initialOffer=s,G("ENABLE_SVC")&&this.store.codec=="av1"){const A=await o4();var t;A&&(this.supportAV1RtpSpec=!0,(t=i.send)===null||t===void 0||t.videoExtensions.push(A))}let l;return s.sdp&&Ww(s.sdp)&&(l=Dr(i),ZU(l)),zl(zl({},r),{},{rtpCapabilities:l||i,offerSDP:s.sdp})}catch(s){throw new Fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&Ww(this.initialOffer.sdp)&&e4(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new k4(zl(zl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&G0(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),r=PN(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),G0(this.store))if(t.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const A=G("PRE_SUB_NUM"),{mids:u,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(A);await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(u,m)}else{const{preSSRCs:A=[]}=t,u=A.map(f=>f.ssrcMsg[0].ssrcId);if(A.length===0)return;const{mids:m}=this.remoteSDP.batchSend(A.map(f=>Object.assign({},f)));await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(m,u)}}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(s.toString()))}}presetMedia(t,s){t.forEach((r,i)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&r===l.mid&&l.receiver.track){const A=l.receiver.track;let u;A.kind==="video"&&G("ENABLE_PRE_RENDER")&&(u=new yw({trackId:"track-".concat(A.kind,"-unknown-").concat(this.store.clientId,"_").concat(dr(5,""))},!0),u.updateVideoTrack(A),u.onFirstVideoFrameRender=()=>{var m;const f=this.preMediaMap.get(s[i]);f&&(f.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,s[i])},u.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,s[i])},u.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[i],{mid:r,track:A,player:u,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:r}=t;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const A=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||A}const{preSSRCs:i=[]}=t,l=i.map(A=>A.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const A=[],u=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[f,{mid:b,player:w,track:_}]=m;return A.push(b),u.push(f),this.preMediaMap.delete(f),w&&w.destroy(),!0}),A.length>0&&(this.remoteSDP.stopSending(A),await $a(this.peerConnection,this.remoteSDP,this.extension),N.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(u)),Ot.reportApiInvoke(this.store.sessionId,{name:Pr.PRELOAD_MEDIA_FAILED,options:[i,u],tag:yr.TRACER}).onSuccess()),i.length>0){const{mids:m}=this.remoteSDP.batchSend(i.map(f=>Object.assign({},f)));await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}s?(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):N.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(s.toString()))}}send(t,s,r){var i=this;return ka(function*(){const l=yield _s(i.mutex.lock("From NVConnectionExtension.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const A=[],u=X0();t.forEach(j=>{const K=i.peerConnection.addTransceiver(j._mediaStreamTrack,zl({direction:"sendonly"},j.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));A.push(K),j._updateRtpTransceiver(K)}),kr()&&G("SIMULCAST")===!0&&(yield _s(i.applySimulcastForFirefox(A,t)));const m=yield _s(i.peerConnection.createOffer()),f=i.remoteSDP.predictReceivingMids(t.length),b=i.mungSendOfferSDP(m.sdp,t,f),w=ba(b),_=f.map(j=>{const K=w.mediaDescriptions.find(X=>X.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return kN(K,G("USE_PUB_RTX"))});let S;try{S=yield _}catch(j){S=[],i.remoteSDP.receive(t,s,r,S);const K=i.remoteSDP.toString();throw yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(i.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield _s(i.stopSending(f,!0)),j}i.remoteSDP.receive(t,s,r,S);const F=i.remoteSDP.toString(),B=i.logSDPExchange(b,"offer","local","send");return yield _s(i.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield _s(i.applySimulcastEncodings(A,t)),yield _s(i.applySendEncodings(A,t)),B==null||B(F),yield _s(i.peerConnection.setRemoteDescription({type:"answer",sdp:F})),A.map((j,K)=>{const X=f[K];return{localSSRC:_[K],id:X,transceiver:j}})}catch(A){throw A instanceof Fe?A:new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(A.toString()))}finally{l()}})()}async createDataChannels(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")N.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}s.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),N.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else N.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof Fe?r:new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const s=this.dataStreamChannelMap.get(t);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(t)}catch(s){throw s instanceof Fe?s:new Fe(W.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(t,s){const r=s?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");i.map(m=>{var f;Uf(this.id+m.mid,this),m.direction="inactive",(f=m.stop)===null||f===void 0||f.call(m)});const l=await this.peerConnection.createOffer(),A=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();A==null||A(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(t,s,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:A}=this.remoteSDP.send(t,s,r,i);A&&(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const u=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:l,transceiver:u}}catch(l){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await $a(this.peerConnection,this.remoteSDP,this.extension),N.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),s.map(i=>{const l=this.peerConnection.getTransceivers().find(A=>A.mid===i);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:i,transceiver:l}})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(s.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(A=>{let[u,{mid:m,player:f}]=A;if(m===l)return this.preMediaMap.delete(u),f&&f.destroy(),!0})}),this.remoteSDP.stopSending(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(s.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const s=this.remoteSDP.toString(),r=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(A=>{A.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(A=>A.mid&&t.indexOf(A.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(A,u)=>{A.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();i==null||i(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new Fe(W.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(s.toString()))}}restartICE(t){var s=this;return ka(function*(){const r=yield _s(s.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const i=Ls().supportPCSetConfiguration,l=G("FORCE_TURN_TCP")||s.forceTurn;if(t===oi.RELAY&&!i)return;if(i&&!l){const w=t===oi.RELAY?"relay":"all",_=s.peerConnection.getConfiguration();_.iceTransportPolicy!==w&&(N.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(w,"]")),_.iceTransportPolicy=w,s.peerConnection.setConfiguration(_))}s.remoteSDP.updateCandidates(t);const A=yield _s(s.peerConnection.createOffer({iceRestart:!0}));if(!A.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=kd(A.sdp),{remoteIceParameters:m}=yield u.iceParameters;s.remoteSDP.restartICE(m);const f=s.remoteSDP.toString(),b=s.logSDPExchange(A.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield _s(s.peerConnection.setLocalDescription(A)),b==null||b(f),yield _s(s.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(i){N.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(oi.TCP_RELAY),await $a(this.peerConnection,this.remoteSDP,this.extension)}catch(s){N.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(s=>{Uf(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:r}=s;r&&r.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return zl(zl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[s],[t]);this.remoteSDP.updateRecvMedia(t,s);const l=this.remoteSDP.toString(),A=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),A==null||A(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Fe(W.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,s){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===t);r.length===1&&(this.isVP8Simulcast(s)?kr()||await this.applySimulcastEncodings(r,[s]):await this.applySendEncodings(r,[s]))}setStatsRemoteVideoIsReady(t,s){this.statsFilter.setVideoIsReady2(t,s)}async replaceTrack(t,s){const r=this.peerConnection.getTransceivers().find(i=>i.mid===s);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const s=t[0].transport.iceTransport,{local:r,remote:i}=s.getSelectedCandidatePair();return{local:zl(zl({},Xc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:zl(zl({},Xc),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var s;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"",l=Od(t.url||"");N.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(r,"), url: ").concat(l||"",", host_candidate:").concat(i)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const s={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&(rp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&s.iceServers&&r==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&s.iceServers.push(...dg.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):s.iceServers.push(...dg.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...dg.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...dg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{const i=G("NEW_TURN_MODE");i===1?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):i===2?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):i===3?s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":443?transport=tcp")}):i===4&&(s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(t){const s=t.transport;if(s){this.transportEventReceiver=t,s.onstatechange=()=>{var i;s!=null&&s.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,s.state))},s.onerror=i=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in i?i.error:i)};const r=s.iceTransport;r&&(r.onstatechange=()=>{const i=s==null?void 0:s.iceTransport.state;var l;i&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:l}=r.getSelectedCandidatePair()||{};if(i&&l){const A=i.address+":"+i.port,u=l.address+":"+l.port;N.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Od(A)),", remote ").concat(JSON.stringify(Od(u))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,s){var r,i;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!s)return N.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return N.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ls().supportSetRtpSenderParameters)return N.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},A={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const u=JU(this.peerConnection,t._mediaStreamTrack),m=Mj(t);if(U4(t)&&u&&s&&m&&this.getLocalVideoStats&&et(r=["vp8","vp9"]).call(r,this.store.codec)){var f;const B=l.degradationPreference||(et(f=t._hints).call(f,or.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");F4(this.id+u.mid,m,this,B,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var b;const{bitrateMax:B,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;B&&(A.maxBitrate=1e3*B),(et(b=t._hints).call(b,or.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(A.maxFramerate=Pa(j)),K&&K>=1&&(A.scaleResolutionDownBy=K))}const{maxFramerate:w}=G("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(A.maxFramerate=A.maxFramerate?Math.min(A.maxFramerate,w):w),G("DSCP_TYPE")&&Sd()){var _;const B=G("DSCP_TYPE");et(_=["very-low","low","medium","high"]).call(_,B)&&(A.networkPriority=B)}const S=s.getParameters(),F=(i=S.encodings)===null||i===void 0?void 0:i[0];kr()&&!F&&(l.encodings=[A]),F&&Object.assign(F,A),Object.assign(S,l),N.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await s.setParameters(S),await d4(this.store.codec,s,G("SVC_MODE"))}async updateAdaptation(t,s){var r,i;if(!t)return N.debug("[updateAdaptation] no rtpSender found");if(!Ls().supportSetRtpSenderParameters)return N.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:A,frameRate:u,scaleResolutionDownBy:m}=s;A&&(l.maxBitrate=1e3*A),u&&(l.maxFramerate=Pa(u)),m&&m>=1&&et(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=m);const f=t.getParameters(),b=(i=f.encodings)===null||i===void 0?void 0:i[0];b&&Object.assign(b,l),Object.assign(f,{});try{await t.setParameters(f),N.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(w){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?N.debug("[updateAdaptation] peerConnection not connected}"):N.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):N.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,s){try{if(!Ls().supportSetRtpSenderParameters||t.length!==s.length)return;for(let r=0;r<t.length;r++){const i=t[r],l=s[r];l instanceof Er&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,i.sender)}}catch{N.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,s,r){const i=ba(t);return s.forEach((l,A)=>{const u=r[A],m=i.mediaDescriptions.find(f=>f.attributes.mid===u);m&&(wp(m,l),LN(m,l,this.store.codec))}),SA(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,s,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,s,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,s)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,s)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,s)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,s){if(t.length===s.length)for(let m=0;m<t.length;m++){var r,i,l,A,u;const f=t[m],b=s[m];if(b instanceof Er&&!et(r=b._hints).call(r,or.LOW_STREAM)&&(i=b._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(A=b._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((u=b._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},_={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const S=f.sender.getParameters();await f.sender.setParameters(Object.assign(S,w))}}}async applySimulcastEncodings(t,s){if(!kr()&&t.length===s.length)for(let r=0;r<t.length;r++){const i=s[r];if(i instanceof Er&&this.isVP8Simulcast(i)){const l=t[r],A={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,A))}}}isVP8Simulcast(t){var s,r,i,l,A;return!!(t instanceof Er&&G("SIMULCAST")&&this.store.codec==="vp8"&&!et(s=t._hints).call(s,or.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((A=t._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(s," SDP during NVConnectionExtension.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(t);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(t){if(Ls().supportPCSetConfiguration){const s=dg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(s)}t.isPreallocation&&(this.isPreallocation=!0)}},ft(Ys.prototype,"updateRemoteRTPCapabilities",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"updateRemoteRTPCapabilities"),Ys.prototype),ft(Ys.prototype,"connect",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"connect"),Ys.prototype),ft(Ys.prototype,"updateRemoteConnect",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"updateRemoteConnect"),Ys.prototype),ft(Ys.prototype,"createDataChannels",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"createDataChannels"),Ys.prototype),ft(Ys.prototype,"receive",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"receive"),Ys.prototype),ft(Ys.prototype,"batchReceive",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"batchReceive"),Ys.prototype),ft(Ys.prototype,"stopReceiving",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"stopReceiving"),Ys.prototype),ft(Ys.prototype,"muteRemote",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"muteRemote"),Ys.prototype),ft(Ys.prototype,"unmuteRemote",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"unmuteRemote"),Ys.prototype),ft(Ys.prototype,"muteLocal",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"muteLocal"),Ys.prototype),ft(Ys.prototype,"unmuteLocal",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"unmuteLocal"),Ys.prototype),ft(Ys.prototype,"close",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"close"),Ys.prototype),ft(Ys.prototype,"updateEncoderConfig",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"updateEncoderConfig"),Ys.prototype),ft(Ys.prototype,"updateSendParameters",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"updateSendParameters"),Ys.prototype),ft(Ys.prototype,"replaceTrack",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"replaceTrack"),Ys.prototype),ft(Ys.prototype,"updateAdaptation",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"updateAdaptation"),Ys.prototype),ft(Ys.prototype,"getRemoteSSRC",[Ma],Object.getOwnPropertyDescriptor(Ys.prototype,"getRemoteSSRC"),Ys.prototype),Ys);function Ma(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From NVConnectionExtension.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}var fr;function L3(e){var t,s,r,i=2;for(typeof Symbol<"u"&&(s=Xv,r=Symbol.iterator);i--;){if(s&&(t=e[s])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new R_(t.call(e));s="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function R_(e){function t(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var r=s.done;return pt.resolve(s.value).then(function(i){return{value:i,done:r}})}return R_=function(s){this.s=s,this.n=s.next},R_.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(s){var r=this.s.return;return r===void 0?pt.resolve({value:s,done:!0}):t(r.apply(this.s,arguments))},throw:function(s){var r=this.s.return;return r===void 0?pt.reject(s):t(r.apply(this.s,arguments))}},new R_(e)}let wre=(fr=class _y extends Fw{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,s){super(t,s),U(this,"name","DataChannelConnection"),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"cname",void 0),U(this,"mutex",new ai("DataChannelConnection-mutex")),U(this,"dataChannel",void 0),U(this,"_p2pConnection",void 0),U(this,"establishPromise",void 0),U(this,"_nvMedia",void 0),this.store=s,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(_y.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new vre(t,s,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var s;return(s=this._p2pConnection)===null||s===void 0?void 0:s.getPreMedia(t)}isPreSub(){var t,s;return(t=(s=this._p2pConnection)===null||s===void 0?void 0:s.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new pt((s,r)=>{const i=setTimeout(()=>{this.closeSignal(),r(new Le(W.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},G("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(i),void s()},this.dataChannel.onerror=l=>{this.closeSignal(),r(l)},this.dataChannel.addEventListener("close",()=>{r(new Le(W.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,s){return this._p2pConnection.updateRemoteRTPCapabilities(t,s)}send(t,s,r){var i=this;return ka(function*(){const l=yield _s(i.mutex.lock("From DataChannelConnection.send"));try{return yield*lf(L3(i._p2pConnection.send(t,s,r)))}finally{l()}})()}async stopSending(t,s){return this._p2pConnection.stopSending(t,s)}async createDataChannels(t,s){return this._p2pConnection.createDataChannels(t,s)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,s,r,i){return this._nvMedia?(N.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,s,this.cname)):(N.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,s,r,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var s=this;return ka(function*(){return yield*lf(L3(s._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var s;return(s=this._nvMedia)===null||s===void 0||s.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,s){return await this._p2pConnection.updateEncoderConfig(t,s)}async updateSendParameters(t,s){return await this._p2pConnection.updateSendParameters(t,s)}setStatsRemoteVideoIsReady(t,s){this._p2pConnection.setStatsRemoteVideoIsReady(t,s)}async replaceTrack(t,s){return await this._p2pConnection.replaceTrack(t,s)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,s,r,i){if(G("SDP_LOGGING"))return N.upload("exchanging ".concat(r," ").concat(s," SDP during DataChannelConnection.").concat(i,`
`),t),s==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const s={iceServers:[]};return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(rp(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(..._y.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(..._y.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(s.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&Ls().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(t){const s=[];return t.forEach(r=>{r.security?r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(tl(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&s.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),s}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var s;return(s=this.onICEConnectionStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var s;return(s=this.onConnectionStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var s;return(s=this.onDTLSTransportStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var s;return(s=this.onDTLSTransportError)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var s;return(s=this.onICETransportStateChange)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var s;return(s=this.onFirstAudioReceived)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var s;return(s=this.onFirstVideoReceived)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var s;return(s=this.onFirstAudioDecoded)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var s;return(s=this.onFirstVideoRender)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var s;return(s=this.onFirstVideoBufferReady)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,s,r)=>{var i;return(i=this.onFirstVideoDecoded)===null||i===void 0?void 0:i.call(this,t,s,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var s;return(s=this.onFirstVideoDecodedTimeout)===null||s===void 0?void 0:s.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,s)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,s)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,s)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,s)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},ft(fr.prototype,"connect",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"connect"),fr.prototype),ft(fr.prototype,"updateRemoteRTPCapabilities",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"updateRemoteRTPCapabilities"),fr.prototype),ft(fr.prototype,"createDataChannels",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"createDataChannels"),fr.prototype),ft(fr.prototype,"receive",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"receive"),fr.prototype),ft(fr.prototype,"stopReceiving",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"stopReceiving"),fr.prototype),ft(fr.prototype,"muteRemote",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"muteRemote"),fr.prototype),ft(fr.prototype,"unmuteRemote",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteRemote"),fr.prototype),ft(fr.prototype,"muteLocal",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"muteLocal"),fr.prototype),ft(fr.prototype,"unmuteLocal",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteLocal"),fr.prototype),ft(fr.prototype,"close",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"close"),fr.prototype),ft(fr.prototype,"updateEncoderConfig",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"updateEncoderConfig"),fr.prototype),ft(fr.prototype,"updateSendParameters",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"updateSendParameters"),fr.prototype),ft(fr.prototype,"replaceTrack",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"replaceTrack"),fr.prototype),ft(fr.prototype,"getRemoteSSRC",[Xo],Object.getOwnPropertyDescriptor(fr.prototype,"getRemoteSSRC"),fr.prototype),fr);function Xo(e,t,s){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const i=this.mutex,l=await i.lock("From DataChannelConnection.".concat(t));try{for(var A=arguments.length,u=new Array(A),m=0;m<A;m++)u[m]=arguments[m];return await r.apply(this,u)}finally{l()}},s}function j3(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,r)}return s}class _re extends Vr{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var s;et(s=["tryNext","recover"]).call(s,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Pn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Pn.CONNECTED):this._state==="closed"?this.emit(Pn.CLOSED):this._state==="failed"&&this.emit(Pn.FAILED))}constructor(t,s,r,i){super(),U(this,"connectionID",0),U(this,"currentURLIndex",0),U(this,"reconnectReason",void 0),U(this,"_reconnectMode","tryNext"),U(this,"_initMutex",void 0),U(this,"_name",void 0),U(this,"_state","closed"),U(this,"_reconnectInterrupter",void 0),U(this,"_url",void 0),U(this,"_retryConfig",void 0),U(this,"_reconnectCount",0),U(this,"_forceCloseTimeout",5e3),U(this,"_onlineReconnectListener",void 0),U(this,"_closeEstablishingTransmitter",()=>{}),U(this,"_store",void 0),U(this,"_joinChannelServiceRecordIndex",void 0),U(this,"_transmitter",void 0),U(this,"_useCompress",void 0),U(this,"_inflateLength",0),U(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(l){for(var A=1;A<arguments.length;A++){var u=arguments[A]!=null?arguments[A]:{};A%2?j3(Object(u),!0).forEach(function(m){U(l,m,u[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(u)):j3(Object(u)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(u,m))})}return l}({},s),this._useCompress=r}resetReconnectCount(t){N.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;s?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,s){if(!this._transmitter)return void N.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(s)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:s})}getInflateData(){const t=this._inflateLength,s=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:s}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let ql=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class yre{constructor(t,s,r){U(this,"version",1),U(this,"initialRTO",void 0),U(this,"maxBatchAckCount",void 0),U(this,"maxRTO",void 0),U(this,"initialRTT",void 0),U(this,"ID",void 0),U(this,"rtt",void 0),U(this,"packetNumber",1),U(this,"rtoRatioMap",new Map),U(this,"timeoutMap",new Map),U(this,"unorderedPacketQueue",[]),U(this,"batchAckPacketQueue",[]),U(this,"lastOrderedPacketNumber",0),U(this,"batchAckTimer",void 0),U(this,"sendImpl",void 0),U(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=s,this.ID=dr(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:G("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:G("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:G("TRANSMITTER_MAX_RTO")}packetize(t,s){return{type:ql.Default,version:this.version,packetNumber:s,payload:t}}serialize(t){switch(t.type){case ql.Default:{let s;typeof t.payload=="string"?s=new TextEncoder().encode(t.payload):s=t.payload;const r=new ArrayBuffer(s.length+15),i=new DataView(r);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),LL(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(s,15),r}case ql.Ack:{const s=new ArrayBuffer(16),r=new DataView(s);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),LL(r,8,BigInt(t.ackSendTs)),s}}}deserialize(t){const s=new DataView(t),r=s.getUint16(0),i=s.getUint8(2);switch(i){case ql.Default:{const l=s.getUint32(3),A=BL(s,7),u=t.slice(15),m=new Uint8Array(u);return{version:r,type:i,packetNumber:l,sendTs:Number(A),payload:m}}case ql.Ack:{const l=s.getUint32(3),A=s.getUint8(7),u=BL(s,8);return{version:r,type:i,maxAckPacketNumber:l,shift:A,ackSendTs:Number(u)}}default:throw N.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){G("DC_DEBUG_LOG")&&typeof t=="string"&&N.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const s=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(s),i=window.setTimeout(()=>{this.resendMessage(s)},r);this.timeoutMap.set(s.packetNumber,i),this.sendPacket(s)}onData(t){const s=this.deserialize(t);s.type===ql.Default?this.ack(s):s.type===ql.Ack&&(this.updateRTT(s,Math.round(performance.now())),this.clearRTO(s))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[s,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const s=this.calculateRTO(t),r=window.setTimeout(()=>{G("DC_DEBUG_LOG")&&typeof t.payload=="string"&&N.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(s)),this.resendMessage(t)},s);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const s=this.rtoRatioMap.get(t.packetNumber);if(s===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*s;return this.rtoRatioMap.set(t.packetNumber,s+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,s){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(s-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const s=this.unorderedPacketQueue[0];if(!s){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(s.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const s={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ql.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(s)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const s={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ql.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending ack packet"),s,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(s)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ql.Ack,version:this.version};G("DC_DEBUG_LOG")&&N.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===ql.Default&&(t.sendTs=Math.round(performance.now()));const s=this.serialize(t);this.sendImpl(s)}clearRTO(t){for(let s=t.maxAckPacketNumber-t.shift;s<=t.maxAckPacketNumber;s++){const r=this.timeoutMap.get(s);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(s),this.rtoRatioMap.delete(s)}}}class P3 extends _re{constructor(t,s){super(t,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),U(this,"_initMutex",void 0),U(this,"_reconnectInterrupter",void 0),U(this,"_url",void 0),U(this,"_transmitter",void 0),U(this,"_addresses",void 0),U(this,"_reliableTransmission",void 0),U(this,"_textEncoder",void 0),U(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new ai("datachannel");const{timeout:r,timeoutFactor:i}=s,l=Math.max(300,Math.floor(3*r/5)),A=Math.max(1.2,Math.floor(8*i)/10);ga.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=A),Zr.on(np.NETWORK_STATE_CHANGE,(u,m)=>{u!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(u)),u===ga.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=A):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=i))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=s;const r=(i,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||G("FINGERPRINT"));const A=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(A).then(i).catch(l),this.once(Pn.CLOSED,()=>l(new Le(W.WS_DISCONNECT))),this.once(Pn.CONNECTED,()=>i())};return this._initMutex.lock().then(i=>new pt((l,A)=>{r(l,A)}).then(()=>{i()}).catch(()=>{i()}))}async sendMessage(t){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Le(W.WS_ABORT,"datachannel is not ready");try{s||(t=JSON.stringify(t));const r=this._textEncoder.encode(t),i=Lse(r,{raw:!0});this._reliableTransmission.sendMessage(i)}catch(r){throw new Le(W.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const s=JSON.stringify(t);return{compressed:s,compressedLength:s.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new pt((s,r)=>{var i;const l=()=>{N.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),s()},A=async b=>{var w;if((w=this._closeEstablishingTransmitter)===null||w===void 0||w.call(this),N.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const _=Eo(this,Pn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,S=await this.reconnectWithAction(_);if(this.state==="closed")return void N.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!S)return r(new Le(W.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void this.close(!0);s()}else r(new Le(W.WS_DISCONNECT,"datachannel close: ".concat(b.code))),this.close()},u=async b=>{try{var w;(w=this._reliableTransmission)===null||w===void 0||w.onData(b.data)}catch(_){console.log(_)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),N.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const m=(i=this._store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();Cn(this,Pn.TO_CONNECT_DATACHANNEL).then(b=>{var w,_;if(!b)throw new Error("transmissonInfo not exist yet");const{transmitter:S,close:F}=b;this._transmitter=S,(w=this._store)===null||w===void 0||w.signalChannelOpen();const B=Date.now()-f;N.debug("[choose dc] dc open cost ".concat(B,"ms")),this._reliableTransmission=new yre(j=>{var K;this._transmitter&&this._transmitter.readyState==="open"&&((K=this._transmitter)===null||K===void 0||K.send(j))},j=>{if(typeof j=="string")this.emit(Pn.ON_MESSAGE,j);else{const K=Pse(j,{raw:!0}).buffer,X=this._textDecoder.decode(K);this.emit(Pn.ON_MESSAGE,X)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,F()},l&&l(),S.onclose=A,S.onmessage=u,(_=this._store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(b=>{var w;if((w=this._store)===null||w===void 0||w.recordJoinChannelService({endTs:Date.now(),status:b instanceof Le&&b.code===W.WS_ABORT?"aborted":"error",errors:[b]},m),this.state!=="closed"){if(b instanceof Le&&b.code===W.WS_ERR){const _=new Le(W.WS_ERR,"init datachannel failed! Error: ".concat(b.toString()));return N.error("[".concat(this._name,"]").concat(_)),void r(_)}A&&A(b)}else r(new Le(W.WS_DISCONNECT,"datachannel is closed: ".concat(b.toString())))})})}async reconnectWithAction(t){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Zr.networkState!==ga.OFFLINE||(this._onlineReconnectListener=Zr.onlineWaiter&&Zr.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},s){const u=lw(this._reconnectCount,this._retryConfig);N.debug("[".concat(this._name,"] wait ").concat(u,"ms to reconnect datachannel, mode: ").concat(t)),await pt.race([Yn(u),this._onlineReconnectListener||new pt(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const i=async(u,m)=>{this.emit(Pn.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(u)};try{if(t==="retry"){const u=this._addresses[this.currentURLIndex];await i(u,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||G("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return N.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);N.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const u=this._addresses[this.currentURLIndex];await i(u,t)}else t==="recover"&&(N.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Pn.FAILBACK));return!0}catch(u){var l,A;return N.error("[".concat(this._name,"] reconnect failed"),u.toString()),u!=null&&(l=u.data)!==null&&l!==void 0&&l.desc&&Array.isArray(u.data.desc)&&u.data.desc.length&&et(A=u.data.desc).call(A,"dynamic key expired")?(this.emit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,s)}}}class Ere extends Vr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Vs.CONNECTED?this.emit(Bt.WS_CONNECTED):t===Vs.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):t===Vs.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(N.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:s,message:r}=t;this.emit(s,r),s===as.ON_NOTIFICATION&&this.handleNotification(r),s===as.ON_USER_BANNED&&this.handleUserBanned(r)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Ms.UID_BANNED);break;case 15:this.close(Ms.IP_BANNED);break;case 16:this.close(Ms.CHANNEL_BANNED)}}constructor(t,s){super(),U(this,"__name__","DataChannelSignal"),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",Vs.CLOSED),U(this,"reconnectToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new B1(5)),U(this,"pingpongTimer",void 0),U(this,"inflateDataTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"ortc",void 0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"isJoining",!1),U(this,"pendingNotifications",[]),U(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,r);const i=JSON.parse(r);if(G("DC_DEBUG_LOG")&&N.debug("[datachannel-signal] received packet",i),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const l="res-@".concat(i._id);this.emit(l,i._result,i._message)}else Object.prototype.hasOwnProperty.call(i,"_type")&&(this.isJoining?i._type===as.ON_NOTIFICATION||i._type===as.ON_USER_BANNED?(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED&&this.handleUserBanned(i._message)):(this.pendingNotifications.push({type:i._type,message:i._message}),N.debug("[".concat(this.clientId,"] cached notification during join: ").concat(i._type))):(this.emit(i._type,i._message),i._type===as.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===as.ON_USER_BANNED&&this.handleUserBanned(i._message)))}),this.clientId=t.clientId,this.spec=t,this.store=s,this.websocket=new P3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Vs.CONNECTED&&this.reconnect("retry",Iu.OFFLINE)})}async request(t,s,r,i){const l=dr(6,""),A={_id:l,_type:t,_message:s},u=this.websocket.connectionID,m=()=>new pt((F,B)=>{if(this.connectionState===Vs.CONNECTED)return F();const j=()=>{this.off(Bt.WS_CLOSED,K),F()},K=()=>{this.off(Bt.WS_CONNECTED,j),B(new Le(W.WS_ABORT))};this.once(Bt.WS_CONNECTED,j),this.once(Bt.WS_CLOSED,K),t!==Mt.PUBLISH&&t!==Mt.SUBSCRIBE&&t!==Mt.UNSUBSCRIBE&&t!==Mt.UNPUBLISH&&t!==Mt.CONTROL&&t!==Mt.RESTART_ICE||this.once(Bt.DISCONNECT_P2P,()=>{B(new Le(W.DISCONNECT_P2P))}),t!==Mt.PUBLISH&&t!==Mt.RESTART_ICE||this.once(Bt.ABORT_P2P_EXECUTION,()=>{B(new Le(W.DISCONNECT_P2P))})});if(this.connectionState!==Vs.CONNECTING&&this.connectionState!==Vs.RECONNECTING||t===Mt.JOIN||t===Mt.REJOIN||await m(),t===Mt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),G("DC_DEBUG_LOG")&&N.debug("[datachannel-signal] sendMessage",A),await this.websocket.sendMessage(A,!0,!1),i)return;const f=new pt((F,B)=>{let j=!1;const K=(oe,xe)=>{j=!0,F({isSuccess:oe==="success",message:xe||{}}),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.emit(Bt.REQUEST_SUCCESS,t,s)};this.once("res-@".concat(l),K);const X=()=>{B(new Le(W.WS_ABORT,"type: ".concat(t))),this.off(Bt.WS_CLOSED,X),this.off(Bt.WS_RECONNECTING,X),this.off("res-@".concat(l),K)};this.once(Bt.WS_CLOSED,X),this.once(Bt.WS_RECONNECTING,X),Yn(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||j||(N.warning("dc request timeout, type: ".concat(t)),this.emit(Bt.REQUEST_TIMEOUT,t,s))})});let b=null;try{b=await f}catch(F){if(this.connectionState===Vs.CLOSED||t===Mt.LEAVE)throw new Le(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?F.throw():t===Mt.JOIN||t===Mt.REJOIN?null:(await m(),await this.request(t,s))}if(b.isSuccess)return b.message;const w=Number(b.message.error_code||b.message.code),_=vp(w),S=new Le(W.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(b.message.error_str),{code:w,data:b.message});return _.action==="success"?b.message:(N.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(w,", message: ").concat(_.desc,", action: ").concat(_.action)),w===Wt.ERR_TOO_MANY_BROADCASTERS?((t===Mt.JOIN||t===Mt.REJOIN)&&(this.initError=S,this.close()),S.throw()):_.action==="failed"?S.throw():_.action==="quit"?(this.initError=S,this.close(),S.throw()):(w===Wt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Iu.MULTI_IP)):this.reconnect(_.action,Iu.SERVER_ERROR),t===Mt.JOIN||t===Mt.REJOIN?null:await this.request(t,s)))}waitMessage(t,s){return new pt(r=>{const i=l=>{(!s||s(l))&&(this.off(t,i),r(l))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void N.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(xp.WRTC_STATS,s)}upload(t,s){const r={_type:t,_message:s};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Vs.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,s){const r={_type:t,_message:s};await this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,r)=>{this.once(Bt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Bt.WS_CLOSED,()=>r(this.initError||new Le(W.WS_ABORT))),this.connectionState=Vs.CONNECTING,this.websocket.init(t).catch(r),this.websocket.once(Pn.FAILBACK,()=>{r(new Le(W.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(N.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new Le(W.INIT_DATACHANNEL_TIMEOUT)))},G("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Ms.LEAVE,this.connectionState=Vs.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ms.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new P3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Cn(this,Bt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const s=await this.request(Mt.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!s)return this.emit(Bt.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Vs.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new Le(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ip(this,Bt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const s=await this.request(Mt.REJOIN,t);return!!s&&(this.connectionState=Vs.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),s.peers&&s.peers.forEach(r=>{this.emit(as.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(as.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(as.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(as.MUTE_AUDIO,{uid:r.uid}):this.emit(as.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(as.MUTE_VIDEO,{uid:r.uid}):this.emit(as.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(as.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(as.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(as.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(as.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,s)}async downgradeCodec(t){if(!this.ortc)return!1;const s={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Mt.DOWNGRADE_CODEC,s)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t);const s=vp(t.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ms.UID_BANNED),void this.close()):void this.reconnect(s.action,Iu.SERVER_ERROR);N.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,G("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=G("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=t&&(N.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Iu.FALLBACK):this.request(Mt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-s;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Mt.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:s}=this.websocket.getInflateData();t!==0&&s!==0&&this.upload(xp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Pn.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Pn.CLOSED,()=>{this.connectionState=Vs.CLOSED}),this.websocket.on(Pn.FAILED,()=>{this._disconnectedReason=Ms.NETWORK_ERROR,this.connectionState=Vs.CLOSED}),this.websocket.on(Pn.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Vs.CONNECTED?this.connectionState=Vs.RECONNECTING:this.connectionState=Vs.CONNECTING}),this.websocket.on(Pn.WILL_RECONNECT,(t,s)=>{if(ip(this,Bt.IS_P2P_DISCONNECTED)&&t==="retry")return N.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Bt.NEED_RENEW_SESSION),this.emit(Bt.DISCONNECT_P2P),s("tryNext");t!=="retry"&&(N.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Bt.NEED_RENEW_SESSION),this.emit(Bt.DISCONNECT_P2P)),s(t)}),this.websocket.on(Pn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{N.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Iu.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Le&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Wt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Iu.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Iu.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Pn.REQUEST_NEW_URLS,(t,s)=>{Cn(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(s)}),this.websocket.on(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(as.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Pn.TO_CONNECT_DATACHANNEL,(t,s)=>{Cn(this,Bt.PRE_CONNECT_PC).then(t).catch(s)}),this.websocket.on(Pn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Bt.DATACHANNEL_FAILBACK)})}}const Cre={name:"DataChannelConnection",create:function(e){let{store:t,spec:s}=e;return new wre(s,t)}},Sre={name:"DataChannelSignal",create:function(e){let{store:t,spec:s}=e;return new Ere(s,t)}};M1(),xr("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void N.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),s=Date.now();N.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Ar,r)){const{value:i,expires:l}=t[r];if(l&&l<=s)return;Vo[r]=i,Ar[r]=i}})}catch(t){N.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Vo.AREAS)&&Vo.AREAS.length>0&&VN(Vo.AREAS,!0);const U3=(e,t,s)=>{N.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),xr(e,t,s)};Dd(Qse,!1),Dd(Kse,!1),Dd(wte,!1),Dd(sre,!1),Dd(Fse,!1),Dd(pre,!1),Dd(gre,!1),Dd(xre,!1),Dd(Cre,!1),Dd(Sre,!1);const Sn=function(e){const t=new Vr,s=e,r={getListeners:t.getListeners.bind(t),on:(i,l)=>(function(A,u){A===Id.SECURITY_POLICY_VIOLATION&&uM(u,!0)}(i,l),t.on.bind(t)(i,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return AM(AM({},s),r)}({__TRACK_LIST__:Ap,VERSION:fc,BUILD:H1,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:U3,getParameter:G,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const s=await async function(r){let i;return Ls().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!s)return e;t.close(),t=null,e=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(s)}catch(t){throw new Le(W.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=Ot.reportApiInvoke(null,{name:Pr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:yr.TRACER}),s=function(){let l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],A=!1;try{const u=window.RTCPeerConnection,m=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;A=!(!u||!f),l&&!m&&(A=!1),A&&j0()&&yL(75)&&new u().close()}catch(u){N.error("check system requirement failed: ",u),A=!1}return A}(e),r=yte();N.debug("checkSystemRequirements, api:",s,"browser",r);const i=s&&r;return t.onSuccess(i),G("IGNORE_RTC_DEVICE_CHECK")?s:i},getDevices:function(e){return Wo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Wo.getRecordingDevices(e)},getCameras:function(e){return Wo.getCamerasDevices(e)},getElectronScreenSources:Tj,getPlaybackDevices:function(e){return Wo.getSpeakers(e)},createClient:cM,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=G("CAMERA_CAPTURE_CONFIG"),s=dr(8,"track-cam-"),r=Ot.reportApiInvoke(null,{id:s,tag:yr.TRACER,name:Pr.CREATE_CAM_VIDEO_TRACK,options:[Rr({},e),t]});t&&(e.encoderConfig=t);const i=_w(e);let l=null;N.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{l=(await Ko({video:i},s)).getVideoTracks()[0]||null}catch(u){throw r.onError(u),u}if(!l){const u=new Fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(u),u.throw(N)}if(e.optimizationMode&&cN(s,l,e,$c(e.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const u=$c(e.encoderConfig);e.encoderConfig=u,delete u.bitrateMax,delete u.bitrateMin}const A=new Ew(l,e,i,e.scalabiltyMode?bw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return r.onSuccess(A.getTrackId()),N.info("create camera video success, trackId:",s),A},createCustomVideoTrack:function(e){const t=dr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:t,tag:yr.TRACER,name:Pr.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});G("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new Er(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?bw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[or.CUSTOM_TRACK]);return s.onSuccess(r.getTrackId()),N.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof t=="object"?function(_){const S=Uj(_);return gj()&&_.suppressLocalAudioPlayback&&(S.suppressLocalAudioPlayback=_.suppressLocalAudioPlayback),bj()&&_.restrictOwnAudio&&(S.restrictOwnAudio=!0),S}(t):void 0;s&&(t="auto");const r=dr(8,"track-scr-v-"),i=Ot.reportApiInvoke(null,{id:r,tag:yr.TRACER,name:Pr.CREATE_SCREEN_VIDEO_TRACK,options:[Rr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(_){const S={};_.screenSourceType&&(S.mediaSource=_.screenSourceType),_.extensionId&&EA()&&(S.extensionId=_.extensionId);const{displaySurface:F,selfBrowserSurface:B,surfaceSwitching:j,systemAudio:K,preferCurrentTab:X,windowAudio:oe,monitorTypeSurfaces:xe}=_;(Ll(107)||Cu(107)||sp(93))&&(F&&(fn(F,"displaySurface",["browser","window","monitor"]),S.displaySurface=F),B?(fn(B,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=B):S.selfBrowserSurface="include",j&&(fn(j,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=j)),(Ll(105)||Cu(105)||sp(91))&&K&&(fn(K,"systemAudio",["exclude","include"]),S.systemAudio=K),(Ll(94)||Cu(94)||sp(80))&&X&&(S.preferCurrentTab=!0),(Ll(141)||Cu(141)||sp(125))&&oe&&(fn(oe,"windowAudio",["exclude","system"]),S.windowAudio=oe),(Ll(119)||Cu(119)||sp(105))&&xe&&(fn(xe,"monitorTypeSurfaces",["exclude","include"]),S.monitorTypeSurfaces=xe),_.electronScreenSourceId&&(S.sourceId=_.electronScreenSourceId);const Ee=_.encoderConfig?Y1(_.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:Ee?Ee.width:void 0,maxHeight:Ee?Ee.height:void 0},Ee&&(Ee.frameRate&&(typeof Ee.frameRate=="number"?(S.mandatory.maxFrameRate=Ee.frameRate,S.mandatory.minFrameRate=Ee.frameRate):(S.mandatory.maxFrameRate=Ee.frameRate.max||Ee.frameRate.ideal||Ee.frameRate.exact||void 0,S.mandatory.minFrameRate=Ee.frameRate.min||Ee.frameRate.ideal||Ee.frameRate.exact||void 0),S.frameRate=Ee.frameRate),Ee.width&&(S.width=Ee.width),Ee.height&&(S.height=Ee.height)),S}(e);let A=null,u=null;const m=Ls();if(!m.supportShareAudio&&t==="enable"){const _=new Fe(W.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(_),_.throw(N)}N.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const f=m.supportShareAudio&&t!=="disable";try{const _=await Ko({screen:l,screenAudio:f?s||!0:void 0},r);A=_.getVideoTracks()[0]||null,u=_.getAudioTracks()[0]||null}catch(_){throw i.onError(_),_}if(!A){const _=new Fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(_),_.throw(N)}if(!u&&t==="enable"){A&&A.stop();const _=new Fe(W.SHARE_AUDIO_NOT_ALLOWED);return i.onError(_),_.throw(N)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(cN(r,A,e,e.encoderConfig&&Y1(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const b=new Er(A,e.encoderConfig?Y1(e.encoderConfig):{},e.scalabiltyMode?bw(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[or.SCREEN_TRACK]);if(!u)return i.onSuccess(b.getTrackId()),N.info("create screen video track success","video:",b.getTrackId()),b;const w=new nn(u,void 0,dr(8,"track-scr-a-"),!1);return i.onSuccess([b.getTrackId(),w.getTrackId()]),N.info("create screen video track success","video:",b.getTrackId(),"audio:",w.getTrackId()),[b,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=G("CAMERA_CAPTURE_CONFIG"),r=dr(8,"track-mic-"),i=dr(8,"track-cam-"),l=Ot.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:yr.TRACER,name:Pr.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,s]});s&&(t.encoderConfig=s);const A=_w(t),u=Fj(e);let m=null,f=null;N.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const _=await Ko({audio:u,video:A},"".concat(r,"-").concat(i));m=_.getAudioTracks()[0],f=_.getVideoTracks()[0]}catch(_){throw l.onError(_),_}if(!m||!f){const _=new Fe(W.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(_),_.throw(N)}if(t.optimizationMode&&cN(i,f,t,$c(t.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const _=$c(t.encoderConfig);t.encoderConfig=_,delete _.bitrateMax,delete _.bitrateMin}const b=new W0(m,e,u,r),w=new Ew(f,t,A,t.scalabiltyMode?bw(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return l.onSuccess([b.getTrackId(),w.getTrackId()]),N.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[b,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=dr(8,"track-mic-"),s=Ot.reportApiInvoke(null,{id:t,tag:yr.TRACER,name:Pr.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=Fj(e);let i=null;N.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Ko({audio:r},t)).getAudioTracks()[0]||null}catch(A){throw s.onError(A),A}if(!i){const A=new Fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(A),A.throw(N)}const l=new W0(i,e,r,t);return s.onSuccess(l.getTrackId()),N.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:AU,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:s,encoderConfig:r}=e;let{source:i}=e;const l={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:s,encoderConfig:r},A=dr(8,"track-buf-"),u=Ot.reportApiInvoke(null,{id:A,tag:yr.TRACER,name:Pr.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(G("DISABLE_WEBAUDIO"))throw new Fe(W.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");N.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",A);const m=i;if(!(i instanceof AudioBuffer))try{i=await async function(w,_){let S=null;if(typeof w=="string"){const B=SP.get(w);if(B)return N.debug("use cached audio resource: ",w),B;try{S=(await jl(()=>Da.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Fe(W.FETCH_AUDIO_FILE_FAILED,j.toString())}}else S=await new pt((j,K)=>{const X=new FileReader;X.onload=oe=>{oe.target?j(oe.target.result):K(new Fe(W.READ_LOCAL_AUDIO_FILE_ERROR))},X.onerror=()=>{K(new Fe(W.READ_LOCAL_AUDIO_FILE_ERROR))},X.readAsArrayBuffer(w)});const F=await function(B){const j=yf();return new pt((K,X)=>{j.decodeAudioData(B,oe=>{K(oe)},oe=>{X(new Fe(W.DECODE_AUDIO_FILE_FAILED,oe.toString()))})})}(S);return typeof w=="string"&&_&&SP.set(w,F),F}(i,s)}catch(w){return u.onError(w),w.throw(N)}const f=new QZ(i),b=new VZ(m,f,r?xw(r):{},A);return N.info("create buffer source audio track success, trackId:",A),u.onSuccess(b.getTrackId()),b},setAppType:function(e){if(N.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw N.debug("Invalid appType"),new Le(W.INVALID_PARAMS,"invalid app type",e);xr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){N.setLogLevel(e)},enableLogUpload:function(){G("USE_NEW_LOG")?xr("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?xr("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new R4},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:yr.TRACER,name:Pr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof nn||e instanceof Sf)){const m=new Le(W.INVALID_TRACK,"the parameter is not a audio track");return s.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof nn?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let l=i,A=i;const u=Date.now();return new pt(m=>{const f=setInterval(()=>{const b=e.getVolumeLevel();l=b>l?b:l,A=b<A?b:A;const w=l-A>1e-4,_=Date.now()-u;if(w||_>t){clearInterval(f);const S=w,F={duration:_,deviceLabel:r,maxVolumeLevel:l,result:S};N.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(F))),s.onSuccess(F),m(S)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:yr.TRACER,name:Pr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Er||e instanceof Cf)){const w=new Le(W.INVALID_TRACK,"the parameter is not a video track");return s.onError(w),w.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Er?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(ii()||aw())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([i]),l.play();const A=document.createElement("canvas");A.width=160,A.height=120;let u=0,m=0;try{const w=Date.now();u=await function(_,S,F,B){let j,K=0,X=null;return new pt((oe,xe)=>{function Ee(){K>B&&j&&(j(),oe(K));const me=F.getContext("2d");if(!me){const Xe=new Le(W.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(Xe.toString()),void xe(Xe)}me.drawImage(_,0,0,160,120);const Re=me.getImageData(0,0,F.width,F.height),He=Math.floor(Re.data.length/3);if(X){for(let Xe=0;Xe<He;Xe+=3)if(Re.data[Xe]!==X[Xe])return K+=1,void(X=Re.data);X=Re.data}else X=Re.data}setTimeout(()=>{j&&(j(),oe(K))},S),j=tN(()=>{Ee()},30)})}(l,t,A,4),m=Date.now()-w}catch(w){throw s.onError(w),w}ote===er.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const f=u>4,b={duration:m,changedPicNum:u,deviceLabel:r,result:f};return N.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),f},setArea:VN,audioElementPlayCenter:na,resumeAudioContext:function(){return na.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Cte.processExternalMediaAEC(e)},registerExtensions:function(e){const t=G("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!et(t).call(t,s.name)&&t.push(s.name);const r=s;r.__registered__=!0,r.logger.hookLog=N.extLog,r.reporter.hookApiInvoke=Ot.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=G(i)})}),U3("PLUGIN_INFO",t)},ChannelMediaRelayError:Rf,ChannelMediaRelayEvent:TA,ChannelMediaRelayState:Ja,RemoteStreamFallbackType:LZ,RemoteStreamType:BZ,ConnectionDisconnectedReason:Ms,AudienceLatencyLevelType:lZ,AREAS:rr,preload:async function(e,t,s,r){return l2(e,t,s,r)},startLastmileProbeTest:async function(e,t,s,r){let i={state:"unavailable"};await l2(e,t,s,r);const l=await d2({appId:e,cname:t,token:s||e,uid:r,cloudProxyServer:"disabled"});if(!l)return i;await A2(l);let A,u=cM({mode:"rtc",codec:"vp8"});try{A=await u.join(e,t,s,r,{networkQualityProbe:!0})}catch{return i}const m=new Ate,f=m.createMuteAudioTrack();let b=await AU({mediaStreamTrack:f});await u.publish([b]);let[w,_,S]=await new pt((oe,xe)=>{const Ee=setTimeout(()=>{clearTimeout(Ee),oe([!0,null,"audio"])},5e3);u.on("user-published",async(me,Re)=>{me.uid===A&&(clearTimeout(Ee),oe([!1,me,Re]))})});if(w||!_)return await u.unpublish([b]),await u.leave(),b.close(),m.close(),i;await u.subscribe(_,S),await new pt((oe,xe)=>{const Ee=setTimeout(()=>{clearTimeout(Ee),oe(null)},5e3)});let F=u.getRTCStats(),B=u.getLocalAudioStats();const j=F.RTT,K=B.sendJitterMs,X=B.currentPacketLossRate;return i={state:"complete",rtt:j,packetLossRate:X,jitter:K,networkQuality:((oe,xe,Ee)=>{let me=1;if(Ee>0){let ns=Math.log(100*Ee)/Math.log(2)+1;ns=Math.min(5,Math.max(0,ns)),me=1-ns/5}let Re=1;if(oe>0){let ns=Math.log(oe/40)/Math.log(2)+1;ns=Math.min(5,Math.max(0,ns)),Re=1-ns/5}let He=1;if(xe>0){let ns=Math.log(xe/10)/Math.log(2.5)+1;ns=Math.min(5,Math.max(0,ns)),He=1-ns/5}const Xe=.5*me+.3*Re+.2*He;let _t=0;return _t=Xe>=.8?1:Xe>=.6?2:Xe>=.4?3:Xe>=.2?4:5,_t})(j,K,X)},await u.unsubscribe(_),await u.unpublish([b]),await u.leave(),b.close(),m.close(),await A2(l),i}});return Object.defineProperties(Sn,{onAudioAutoplayFailed:{get:()=>La.onAudioAutoplayFailed,set:e=>{La.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>La.onAutoplayFailed,set:e=>{La.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Sn._onSecurityPolicyViolation,set(e){Sn._onSecurityPolicyViolation=e,uM(e)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?gp:[]}}),Wo.on(hp.CAMERA_DEVICE_CHANGED,e=>{N.info("camera device changed",JSON.stringify(e)),Sn.onCameraChanged&&Sn.onCameraChanged(e),Sn.safeEmit(Id.CAMERA_CHANGED,e)}),Wo.on(hp.RECORDING_DEVICE_CHANGED,e=>{N.info("microphone device changed",JSON.stringify(e)),Sn.onMicrophoneChanged&&Sn.onMicrophoneChanged(e),Sn.safeEmit(Id.MICROPHONE_CHANGED,e)}),Wo.on(hp.PLAYOUT_DEVICE_CHANGED,e=>{N.debug("playout device changed",JSON.stringify(e)),Sn.onPlaybackDeviceChanged&&Sn.onPlaybackDeviceChanged(e),Sn.safeEmit(Id.PLAYBACK_DEVICE_CHANGED,e)}),na.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),La.onAudioAutoplayFailed&&La.onAudioAutoplayFailed()},vr.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),La.onAudioAutoplayFailed&&La.onAudioAutoplayFailed(),Sn.safeEmit(Id.AUTOPLAY_FAILED)}),vr.on(xi.STATE_CHANGE,(e,t)=>{N.info("audio context state changed: ".concat(t," => ").concat(e)),Sn.onAudioContextStateChanged&&Sn.onAudioContextStateChanged(e,t),Sn.safeEmit(Id.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Zr.on(np.NETWORK_STATE_CHANGE,(e,t)=>{N.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Sn),Sn})})(wH);var Ole=wH.exports;const $2=Ore(Ole);function kle(){var Pe,ne,ve,ue,Te,Be,Ue,tt,ot,ut,Tt;const{appointmentId:a}=ox(),o=Ha(),[c,d]=ee.useState(null),[h,p]=ee.useState(!0),[g,x]=ee.useState(!1),[v,E]=ee.useState("video"),[C,I]=ee.useState([]),[O,R]=ee.useState(""),[k,M]=ee.useState({video:!0,audio:!0,speaker:!0}),[P,H]=ee.useState(null),[$,re]=ee.useState(null),[J,ge]=ee.useState(null),[ie,we]=ee.useState([]),[Ae,V]=ee.useState(!1),ce=ee.useRef(null),Y=ee.useRef(null);ee.useEffect(()=>(se(),z(),()=>{te()}),[a]);const z=()=>{const Qe=$2.createClient({mode:"rtc",codec:"vp8"});Qe.on("user-published",async(it,kt)=>{await Qe.subscribe(it,kt),kt==="video"&&(we(_e=>[..._e.filter(xt=>xt.uid!==it.uid),it]),Y.current&&it.videoTrack.play(Y.current)),kt==="audio"&&it.audioTrack.play()}),Qe.on("user-unpublished",it=>{we(kt=>kt.filter(_e=>_e.uid!==it.uid))}),Qe.on("user-left",it=>{we(kt=>kt.filter(_e=>_e.uid!==it.uid))}),H(Qe)},te=async()=>{$&&($.stop(),$.close()),J&&(J.stop(),J.close()),P&&Ae&&await P.leave()},se=async()=>{try{const{data:Qe}=await $o.getAppointmentDetails(a);d(Qe)}catch{St.error("Failed to load appointment details"),o("/doctors")}finally{p(!1)}},Ce=async()=>{if(!P||!(c!=null&&c.videoRoom)){St.error("Video call not available");return}try{const{config:Qe}=c.videoRoom;if(Qe.type==="agora"&&Qe.appId&&Qe.token){await P.join(Qe.appId,Qe.channelName,Qe.token,Qe.uid);const it=await $2.createCameraVideoTrack(),kt=await $2.createMicrophoneAudioTrack();re(it),ge(kt),ce.current&&it.play(ce.current),await P.publish([it,kt]),V(!0),St.success("Joined video call successfully")}else St.error("Video call configuration not available")}catch(Qe){console.error("Error joining video call:",Qe),St.error("Failed to join video call")}},he=async()=>{try{await te(),V(!1),we([]),St.success("Left video call")}catch(Qe){console.error("Error leaving video call:",Qe)}},Ne=async()=>{try{await $o.startConsultation(a),x(!0),(c==null?void 0:c.type)==="video"&&await Ce(),St.success("Consultation started")}catch{St.error("Failed to start consultation")}},Z=async()=>{try{Ae&&await he(),await $o.endConsultation(a),x(!1),St.success("Consultation ended"),o("/consultation-summary/"+a)}catch{St.error("Failed to end consultation")}},Ie=()=>{if(!O.trim())return;const Qe={id:Date.now(),text:O,sender:"patient",timestamp:new Date};I([...C,Qe]),R("")},Ve=async Qe=>{if(Qe==="video"&&$){const it=!k.video;await $.setEnabled(it),M(kt=>({...kt,video:it}))}else if(Qe==="audio"&&J){const it=!k.audio;await J.setEnabled(it),M(kt=>({...kt,audio:it}))}else Qe==="speaker"&&M(it=>({...it,speaker:!it.speaker}))};return h?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):c?n.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[n.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:n.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>o("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:n.jsx(Vn,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-lg font-bold text-white",children:((ve=(ne=(Pe=c.doctor)==null?void 0:Pe.name)==null?void 0:ne[0])==null?void 0:ve.toUpperCase())||"D"}),n.jsxs("div",{children:[n.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(ue=c.doctor)==null?void 0:ue.name]}),n.jsx("p",{className:"text-sm text-slate-400",children:(Te=c.doctor)==null?void 0:Te.specialization})]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${c.status==="confirmed"?"bg-green-500/20 text-green-400":c.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:c.status})})]})}),g?n.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[n.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[v==="video"&&n.jsxs("div",{className:"h-full relative",children:[n.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:ie.length>0?n.jsx("div",{ref:Y,className:"w-full h-full",style:{background:"#1e293b"}}):n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((ut=(ot=(tt=c.doctor)==null?void 0:tt.name)==null?void 0:ot[0])==null?void 0:ut.toUpperCase())||"D"}),n.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(Tt=c.doctor)==null?void 0:Tt.name]}),n.jsx("p",{className:"text-slate-400",children:Ae?"Waiting for doctor to join...":"Video consultation ready"})]})}),Ae&&n.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[n.jsx("div",{ref:ce,className:"w-full h-full",style:{background:"#1e293b"}}),n.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),n.jsx("div",{className:"absolute top-4 left-4",children:n.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${Ae?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${Ae?"bg-green-400":"bg-yellow-400"} animate-pulse`}),Ae?"Connected":"Connecting..."]})}),Ae&&n.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:n.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[n.jsx(yg,{className:"w-4 h-4"}),ie.length+1," participants"]})})]}),n.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:n.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[n.jsx("button",{onClick:()=>Ve("audio"),className:`p-3 rounded-full transition-colors ${k.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:k.audio?"Mute microphone":"Unmute microphone",children:k.audio?n.jsx(Zre,{className:"w-5 h-5"}):n.jsx(ene,{className:"w-5 h-5"})}),n.jsx("button",{onClick:()=>Ve("video"),className:`p-3 rounded-full transition-colors ${k.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:k.video?"Turn off camera":"Turn on camera",children:k.video?n.jsx(ZR,{className:"w-5 h-5"}):n.jsx(tne,{className:"w-5 h-5"})}),n.jsx("button",{onClick:()=>Ve("speaker"),className:`p-3 rounded-full transition-colors ${k.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:k.speaker?"Mute speaker":"Unmute speaker",children:k.speaker?n.jsx(sne,{className:"w-5 h-5"}):n.jsx(rne,{className:"w-5 h-5"})}),n.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:n.jsx(nne,{className:"w-5 h-5"})}),n.jsx("button",{onClick:Z,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:n.jsx(Gn,{className:"w-5 h-5"})})]})})]}),n.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[n.jsx("div",{className:"p-4 border-b border-slate-700",children:n.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),n.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:C.map(Qe=>n.jsx("div",{className:`flex ${Qe.sender==="patient"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Qe.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Qe.text})},Qe.id))}),n.jsx("div",{className:"p-4 border-t border-slate-700",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:O,onChange:Qe=>R(Qe.target.value),onKeyPress:Qe=>Qe.key==="Enter"&&Ie(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),n.jsx("button",{onClick:Ie,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:n.jsx(oE,{className:"w-4 h-4"})})]})})]})]}):n.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(yi,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),n.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(c.date).toLocaleDateString()," at ",c.timeSlot]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(gg,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),n.jsx("p",{className:"text-slate-400 text-sm capitalize",children:c.type})]})]}),c.symptoms&&n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Hn,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),n.jsx("p",{className:"text-slate-400 text-sm",children:c.symptoms})]})]})]})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(JR,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Experience"}),n.jsxs("p",{className:"text-slate-400 text-sm",children:[((Be=c.doctor)==null?void 0:Be.experience)||"5+"," years"]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(WT,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Location"}),n.jsx("p",{className:"text-slate-400 text-sm",children:((Ue=c.doctor)==null?void 0:Ue.location)||"Online"})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(zA,{className:"w-5 h-5 text-cyan-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Rating"}),n.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Qe=>n.jsx(zA,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Qe)),n.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),n.jsx("div",{className:"mt-8 text-center",children:n.jsxs("button",{onClick:Ne,className:"bg-gradient-to-r from-purple-500 to-orange-500 hover:from-purple-600 hover:to-orange-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[n.jsx(gg,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Li,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),n.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),n.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function Dle(){const{appointmentId:a}=ox(),o=Ha(),[c,d]=ee.useState(null),[h,p]=ee.useState(!0),[g,x]=ee.useState(0),[v,E]=ee.useState(""),[C,I]=ee.useState(!1),[O,R]=ee.useState("summary");ee.useEffect(()=>{k()},[a]);const k=async()=>{try{const{data:re}=await $o.getConsultationSummary(a);d(re)}catch{St.error("Failed to load consultation summary"),o("/doctors")}finally{p(!1)}},M=async()=>{if(g===0){St.error("Please provide a rating");return}I(!0);try{await $o.submitReview(a,{rating:g,review:v}),St.success("Review submitted successfully"),d(re=>({...re,reviewSubmitted:!0}))}catch{St.error("Failed to submit review")}finally{I(!1)}},P=async()=>{try{const re=await $o.downloadPrescription(a),J=new Blob([re.data],{type:"application/pdf"}),ge=window.URL.createObjectURL(J),ie=document.createElement("a");ie.href=ge,ie.download=`prescription-${a}.pdf`,ie.click(),window.URL.revokeObjectURL(ge)}catch{St.error("Failed to download prescription")}};if(h)return n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const H={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},$=c||H;return n.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[n.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:n.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>o("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:n.jsx(Vn,{className:"w-5 h-5 text-slate-400"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),n.jsxs("p",{className:"text-sm text-slate-400",children:[new Date($.date).toLocaleDateString(),"  ",$.duration]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[n.jsx(iE,{className:"w-4 h-4"}),"Download"]}),n.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[n.jsx(iQ,{className:"w-4 h-4"}),"Share"]})]})]})}),n.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[n.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-purple-500 to-orange-500 flex items-center justify-center text-xl font-bold text-white",children:$.doctor.name[0]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h2",{className:"text-xl font-bold text-white",children:$.doctor.name}),n.jsx("p",{className:"text-slate-400",children:$.doctor.specialization})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(re=>n.jsx(zA,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},re))}),n.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),n.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[n.jsx("button",{onClick:()=>R("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${O==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),n.jsx("button",{onClick:()=>R("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${O==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),n.jsx("button",{onClick:()=>R("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${O==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),n.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[O==="summary"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:n.jsx(br,{className:"w-5 h-5 text-blue-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),n.jsx("p",{className:"text-slate-300 leading-relaxed",children:$.diagnosis})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:n.jsx(Hn,{className:"w-5 h-5 text-green-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),n.jsx("p",{className:"text-slate-300 leading-relaxed",children:$.notes})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:n.jsx(Tn,{className:"w-5 h-5 text-cyan-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),n.jsx("ul",{className:"space-y-3",children:$.recommendations.map((re,J)=>n.jsxs("li",{className:"flex items-start gap-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),n.jsx("span",{className:"text-slate-300",children:re})]},J))})]})]}),O==="prescription"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:n.jsx(eh,{className:"w-5 h-5 text-purple-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),n.jsx("div",{className:"space-y-4",children:$.prescription.map((re,J)=>n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsx("h4",{className:"font-bold text-white",children:re.medication}),n.jsx("span",{className:"text-sm text-slate-400",children:re.duration})]}),n.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:re.dosage}),n.jsx("p",{className:"text-slate-300 text-sm",children:re.instructions})]},J))}),n.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(th,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),n.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),O==="followup"&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:n.jsx(yi,{className:"w-5 h-5 text-orange-400"})}),n.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(Oc,{className:"w-5 h-5 text-cyan-400"}),n.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),n.jsxs("p",{className:"text-slate-300",children:[new Date($.followUp.date).toLocaleDateString()," - ",$.followUp.type]})]}),n.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[n.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),n.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),n.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(yi,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(cx,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Message Doctor"})]}),n.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[n.jsx(ine,{className:"w-5 h-5 text-cyan-400"}),n.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!$.reviewSubmitted&&n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),n.jsxs("div",{className:"mb-4",children:[n.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),n.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(re=>n.jsx("button",{onClick:()=>x(re),className:`p-1 transition-colors ${re<=g?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:n.jsx(zA,{className:"w-6 h-6 fill-current"})},re))})]}),n.jsx("textarea",{value:v,onChange:re=>E(re.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),n.jsx("button",{onClick:M,disabled:C||g===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:C?n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):n.jsxs(n.Fragment,{children:[n.jsx(oE,{className:"w-4 h-4"}),"Submit Review"]})})]}),n.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),n.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Energy Level"}),n.jsx("span",{className:"text-green-400",children:"Stable"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),n.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}const Ble=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PA={startTime:"09:00",endTime:"18:00",slotDuration:30};function Lle(){const[a,o]=ee.useState(PA),[c,d]=ee.useState({}),[h,p]=ee.useState({}),[g,x]=ee.useState(!1),[v,E]=ee.useState(!0),C=()=>{const J=[],ge=new Date;for(let ie=0;ie<7;ie++){const we=new Date(ge);we.setDate(ge.getDate()+ie),J.push({date:we.toISOString().split("T")[0],dayName:Ble[we.getDay()],displayDate:we.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:ie===0})}return J},[I]=ee.useState(C());ee.useEffect(()=>{O()},[]);const O=async()=>{var J,ge,ie,we,Ae,V,ce;try{const{data:Y}=await $o.getMyAvailability(),z={startTime:((ge=(J=Y.availability)==null?void 0:J.settings)==null?void 0:ge.startTime)||PA.startTime,endTime:((we=(ie=Y.availability)==null?void 0:ie.settings)==null?void 0:we.endTime)||PA.endTime,slotDuration:((V=(Ae=Y.availability)==null?void 0:Ae.settings)==null?void 0:V.slotDuration)||PA.slotDuration};o(z),(ce=Y.availability)!=null&&ce.blockedSlots&&p(Y.availability.blockedSlots),R(z)}catch(Y){console.error("Failed to fetch availability:",Y),R(PA)}finally{E(!1)}},R=J=>{J||(J=PA);const ge={},ie=J.startTime||PA.startTime,we=J.endTime||PA.endTime,Ae=J.slotDuration||PA.slotDuration,V=ie.split(":"),ce=we.split(":");if(V.length<2||ce.length<2){console.error("Invalid time format");return}const Y=parseInt(V[0],10),z=parseInt(V[1],10),te=parseInt(ce[0],10),se=parseInt(ce[1],10);I.forEach(Ce=>{ge[Ce.date]=[];let he=Y*60+z;const Ne=te*60+se;for(;he<Ne;){const Z=Math.floor(he/60),Ie=he%60,Ve=`${Z.toString().padStart(2,"0")}:${Ie.toString().padStart(2,"0")}`,Pe=new Date(`2000-01-01T${Ve}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});ge[Ce.date].push({time:Ve,display:Pe}),he+=Ae}}),d(ge)},k=(J,ge)=>{const ie={...a,[J]:ge};o(ie),R(ie)},M=(J,ge)=>{p(ie=>{const we=ie[J]||[];return we.includes(ge)?{...ie,[J]:we.filter(Ae=>Ae!==ge)}:{...ie,[J]:[...we,ge]}})},P=J=>{const ge=c[J]||[];(h[J]||[]).length===ge.length?p(we=>({...we,[J]:[]})):p(we=>({...we,[J]:ge.map(Ae=>Ae.time)}))},H=(J,ge)=>(h[J]||[]).includes(ge),$=J=>{const ge=c[J]||[],ie=h[J]||[];return ge.length>0&&ie.length===ge.length},re=async()=>{var J,ge;x(!0);try{const ie=await $o.updateMyAvailability({settings:a,blockedSlots:h});console.log("Save response:",ie.data),St.success("Availability saved successfully!")}catch(ie){console.error("Failed to save:",ie),St.error(((ge=(J=ie.response)==null?void 0:J.data)==null?void 0:ge.message)||"Failed to save availability")}finally{x(!1)}};return v?n.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),n.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),n.jsxs("button",{onClick:re,disabled:g,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-purple-500 to-orange-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[g?n.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):n.jsx(oQ,{className:"w-5 h-5"}),"Save Changes"]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(Oc,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),n.jsx("select",{value:a.startTime,onChange:J=>k("startTime",J.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(J,ge)=>{const ie=`${ge.toString().padStart(2,"0")}:00`,we=new Date(`2000-01-01T${ie}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return n.jsx("option",{value:ie,children:we},ie)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),n.jsx("select",{value:a.endTime,onChange:J=>k("endTime",J.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(J,ge)=>{const ie=`${ge.toString().padStart(2,"0")}:00`,we=new Date(`2000-01-01T${ie}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return n.jsx("option",{value:ie,children:we},ie)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),n.jsxs("select",{value:a.slotDuration,onChange:J=>k("slotDuration",parseInt(J.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[n.jsx("option",{value:15,children:"15 minutes"}),n.jsx("option",{value:30,children:"30 minutes"}),n.jsx("option",{value:45,children:"45 minutes"}),n.jsx("option",{value:60,children:"60 minutes"})]})]})]}),n.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",a.startTime," to ",a.endTime,", ",a.slotDuration," min slots"]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),n.jsx("span",{className:"text-slate-600",children:"Available"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),n.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),n.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),n.jsx("div",{className:"space-y-4",children:I.map(J=>{const ge=c[J.date]||[],ie=$(J.date);return n.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(yi,{className:"w-5 h-5 text-cyan-500"}),n.jsxs("div",{children:[n.jsxs("h3",{className:"font-semibold text-slate-800",children:[J.dayName,J.isToday&&n.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),n.jsx("p",{className:"text-sm text-slate-500",children:J.displayDate})]})]}),n.jsx("button",{onClick:()=>P(J.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${ie?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:ie?n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(GA,{className:"w-4 h-4"})," Unblock All"]}):n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Gn,{className:"w-4 h-4"})," Block Day"]})})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[ge.map(we=>{const Ae=H(J.date,we.time);return n.jsx("button",{onClick:()=>M(J.date,we.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Ae?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:we.display},we.time)}),ge.length===0&&n.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},J.date)})}),n.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[n.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),n.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[n.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),n.jsx("li",{children:" Click individual slots to block specific times"}),n.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),n.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}function jle({onClose:a}){var P,H,$,re,J,ge,ie,we,Ae;const[o,c]=ee.useState(!0),[d,h]=ee.useState(!1),[p,g]=ee.useState({preferredFoods:[],foodsToAvoid:[],dietaryRestrictions:[]}),[x,v]=ee.useState(null),[E,C]=ee.useState({preferred:"",avoid:"",restriction:""});ee.useEffect(()=>{I()},[]);const I=async()=>{try{const V=await Ft.get("/users/food-preferences");V.data.success&&g(V.data.data)}catch(V){console.error("Failed to fetch preferences:",V)}finally{c(!1)}},O=async()=>{try{if((await Ft.post("/users/food-preferences",p)).data.success)return St.success("Preferences saved!"),!0}catch{return St.error("Failed to save preferences"),!1}},R=async()=>{var V,ce;if(!p.preferredFoods||p.preferredFoods.length===0){St.error("Please add at least one preferred food");return}h(!0);try{if(!await O()){h(!1);return}const z=await Ft.post("/users/analyze-food-choices");z.data.success&&(v(z.data.data),St.success("Analysis complete!"))}catch(Y){St.error(((ce=(V=Y.response)==null?void 0:V.data)==null?void 0:ce.message)||"Analysis failed")}finally{h(!1)}},k=V=>{const ce=E[V].trim();if(!ce)return;const Y=V==="preferred"?"preferredFoods":V==="avoid"?"foodsToAvoid":"dietaryRestrictions";if(p[Y].includes(ce)){St.error("Already added");return}g(z=>({...z,[Y]:[...z[Y],ce]})),C(z=>({...z,[V]:""}))},M=(V,ce)=>{const Y=V==="preferred"?"preferredFoods":V==="avoid"?"foodsToAvoid":"dietaryRestrictions";g(z=>({...z,[Y]:z[Y].filter((te,se)=>se!==ce)}))};return o?n.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:n.jsx("div",{className:"bg-white rounded-3xl p-8 max-w-md w-full",children:n.jsx(Al,{className:"w-8 h-8 animate-spin text-[#2FC8B9] mx-auto"})})}):n.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 overflow-y-auto p-4",children:n.jsx("div",{className:"min-h-screen flex items-center justify-center py-8",children:n.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-100 p-6 flex items-center justify-between z-10",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-black text-black uppercase tracking-tight",children:"Food Preferences"}),n.jsx("p",{className:"text-xs text-slate-500 font-bold mt-1",children:"Personalize your diet plan"})]}),n.jsx("button",{onClick:a,className:"w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-all",children:n.jsx(Gn,{className:"w-5 h-5 text-slate-600"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"bg-emerald-50/50 rounded-2xl p-6 border border-emerald-100",children:[n.jsx("h3",{className:"text-sm font-black text-emerald-900 uppercase tracking-wide mb-4",children:" Foods You Love"}),n.jsxs("div",{className:"flex gap-2 mb-3",children:[n.jsx("input",{type:"text",value:E.preferred,onChange:V=>C(ce=>({...ce,preferred:V.target.value})),onKeyPress:V=>V.key==="Enter"&&k("preferred"),placeholder:"e.g., Chicken, Rice, Broccoli",className:"flex-1 px-4 py-3 bg-white border-2 border-emerald-200 rounded-xl focus:outline-none focus:border-emerald-400 text-sm font-semibold"}),n.jsx("button",{onClick:()=>k("preferred"),className:"px-6 py-3 bg-emerald-500 text-white rounded-xl font-bold hover:bg-emerald-600 transition-all",children:n.jsx(Zo,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:p.preferredFoods.map((V,ce)=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-white border border-emerald-200 rounded-xl text-xs font-bold text-emerald-900",children:[V,n.jsx("button",{onClick:()=>M("preferred",ce),className:"hover:text-red-500",children:n.jsx(Gn,{className:"w-3 h-3"})})]},ce))})]}),n.jsxs("div",{className:"bg-rose-50/50 rounded-2xl p-6 border border-rose-100",children:[n.jsx("h3",{className:"text-sm font-black text-rose-900 uppercase tracking-wide mb-4",children:" Foods to Avoid"}),n.jsxs("div",{className:"flex gap-2 mb-3",children:[n.jsx("input",{type:"text",value:E.avoid,onChange:V=>C(ce=>({...ce,avoid:V.target.value})),onKeyPress:V=>V.key==="Enter"&&k("avoid"),placeholder:"e.g., Dairy, Gluten, Spicy Food",className:"flex-1 px-4 py-3 bg-white border-2 border-rose-200 rounded-xl focus:outline-none focus:border-rose-400 text-sm font-semibold"}),n.jsx("button",{onClick:()=>k("avoid"),className:"px-6 py-3 bg-rose-500 text-white rounded-xl font-bold hover:bg-rose-600 transition-all",children:n.jsx(Zo,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:p.foodsToAvoid.map((V,ce)=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-white border border-rose-200 rounded-xl text-xs font-bold text-rose-900",children:[V,n.jsx("button",{onClick:()=>M("avoid",ce),className:"hover:text-red-500",children:n.jsx(Gn,{className:"w-3 h-3"})})]},ce))})]}),n.jsxs("div",{className:"bg-amber-50/50 rounded-2xl p-6 border border-amber-100",children:[n.jsx("h3",{className:"text-sm font-black text-amber-900 uppercase tracking-wide mb-4",children:" Dietary Restrictions"}),n.jsxs("div",{className:"flex gap-2 mb-3",children:[n.jsx("input",{type:"text",value:E.restriction,onChange:V=>C(ce=>({...ce,restriction:V.target.value})),onKeyPress:V=>V.key==="Enter"&&k("restriction"),placeholder:"e.g., Lactose Intolerant, Nut Allergy",className:"flex-1 px-4 py-3 bg-white border-2 border-amber-200 rounded-xl focus:outline-none focus:border-amber-400 text-sm font-semibold"}),n.jsx("button",{onClick:()=>k("restriction"),className:"px-6 py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600 transition-all",children:n.jsx(Zo,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:p.dietaryRestrictions.map((V,ce)=>n.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-white border border-amber-200 rounded-xl text-xs font-bold text-amber-900",children:[V,n.jsx("button",{onClick:()=>M("restriction",ce),className:"hover:text-red-500",children:n.jsx(Gn,{className:"w-3 h-3"})})]},ce))})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{onClick:O,className:"flex-1 py-4 bg-slate-900 text-white rounded-2xl font-black text-sm uppercase tracking-wide hover:bg-slate-800 transition-all",children:"Save Preferences"}),n.jsx("button",{onClick:R,disabled:d,className:"flex-1 py-4 bg-[#2FC8B9] text-white rounded-2xl font-black text-sm uppercase tracking-wide hover:bg-[#25a89b] transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:d?n.jsxs(n.Fragment,{children:[n.jsx(Al,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):n.jsxs(n.Fragment,{children:[n.jsx(KA,{className:"w-5 h-5"}),"AI Analysis"]})})]}),x&&n.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[n.jsxs("div",{className:"bg-gradient-to-br from-[#2FC8B9] to-[#25a89b] rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-lg font-black uppercase",children:"Overall Score"}),n.jsxs("div",{className:"text-4xl font-black",children:[x.overallScore,"/100"]})]}),n.jsx("div",{className:"h-3 bg-white/20 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-white rounded-full transition-all duration-1000",style:{width:`${x.overallScore}%`}})})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-emerald-50 rounded-2xl p-5 border border-emerald-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-emerald-600"}),n.jsx("h4",{className:"text-sm font-black text-emerald-900 uppercase",children:"Strengths"})]}),n.jsx("ul",{className:"space-y-2",children:(P=x.strengths)==null?void 0:P.map((V,ce)=>n.jsxs("li",{className:"text-xs text-emerald-800 font-bold flex items-start gap-2",children:[n.jsx("span",{className:"text-emerald-500 mt-0.5",children:""}),V]},ce))})]}),n.jsxs("div",{className:"bg-rose-50 rounded-2xl p-5 border border-rose-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx(Li,{className:"w-5 h-5 text-rose-600"}),n.jsx("h4",{className:"text-sm font-black text-rose-900 uppercase",children:"Concerns"})]}),n.jsx("ul",{className:"space-y-2",children:(H=x.concerns)==null?void 0:H.map((V,ce)=>n.jsxs("li",{className:"text-xs text-rose-800 font-bold flex items-start gap-2",children:[n.jsx("span",{className:"text-rose-500 mt-0.5",children:""}),V]},ce))})]})]}),((re=($=x.recommendations)==null?void 0:$.foodsToAdd)==null?void 0:re.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(qi,{className:"w-5 h-5 text-[#2FC8B9]"}),n.jsx("h4",{className:"text-sm font-black text-black uppercase",children:"Foods to Add"})]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:x.recommendations.foodsToAdd.map((V,ce)=>n.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[n.jsx("p",{className:"text-sm font-black text-black mb-1",children:V.name}),n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-2",children:V.reason}),n.jsxs("p",{className:"text-xs text-[#2FC8B9] font-bold",children:[" ",V.benefit]})]},ce))})]}),((ge=(J=x.recommendations)==null?void 0:J.foodsToLimit)==null?void 0:ge.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-slate-100",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(ah,{className:"w-5 h-5 text-rose-500"}),n.jsx("h4",{className:"text-sm font-black text-black uppercase",children:"Foods to Limit"})]}),n.jsx("div",{className:"space-y-3",children:x.recommendations.foodsToLimit.map((V,ce)=>n.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-black text-black mb-1",children:V.name}),n.jsx("p",{className:"text-xs text-slate-600 font-semibold",children:V.reason})]}),V.alternative&&n.jsxs("div",{className:"text-xs font-bold text-[#2FC8B9] whitespace-nowrap",children:["Try: ",V.alternative]})]},ce))})]}),((we=(ie=x.recommendations)==null?void 0:ie.mealIdeas)==null?void 0:we.length)>0&&n.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-white rounded-2xl p-6 border border-slate-100",children:[n.jsx("h4",{className:"text-sm font-black text-black uppercase mb-4",children:" Meal Ideas"}),n.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:x.recommendations.mealIdeas.map((V,ce)=>n.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-100",children:[n.jsx("p",{className:"text-xs font-black text-[#2FC8B9] uppercase mb-2",children:V.meal}),n.jsx("p",{className:"text-sm font-bold text-black",children:V.suggestion})]},ce))})]}),((Ae=x.tips)==null?void 0:Ae.length)>0&&n.jsxs("div",{className:"bg-amber-50 rounded-2xl p-6 border border-amber-100",children:[n.jsx("h4",{className:"text-sm font-black text-amber-900 uppercase mb-4",children:" Quick Tips"}),n.jsx("ul",{className:"space-y-2",children:x.tips.map((V,ce)=>n.jsxs("li",{className:"text-xs text-amber-900 font-bold flex items-start gap-2",children:[n.jsx("span",{className:"text-amber-500 mt-0.5",children:""}),V]},ce))})]})]})]})]})})})}function Ple(a,o){const c=(a||"").toLowerCase(),d=[{q:["idli"],e:""},{q:["dosa"],e:""},{q:["upma","poha"],e:""},{q:["paratha","chapati","roti"],e:""},{q:["oat","porridge"],e:""},{q:["egg"],e:""},{q:["sandwich","toast","bread"],e:""},{q:["smoothie","shake"],e:""},{q:["dal","lentil"],e:""},{q:["rice","biryani"],e:""},{q:["chicken"],e:""},{q:["fish"],e:""},{q:["paneer","tofu"],e:""},{q:["salad"],e:""},{q:["soup"],e:""},{q:["curry"],e:""},{q:["nut","almond"],e:""},{q:["yogurt","curd"],e:""},{q:["fruit","apple","banana"],e:""}];for(const{q:p,e:g}of d)if(p.some(x=>c.includes(x)))return g;return{breakfast:"",lunch:"",snacks:"",dinner:""}[o]||""}const L6=["breakfast","lunch","snacks","dinner"],Z2={breakfast:{label:"Breakfast",time:"7:00  9:00 AM",emoji:""},lunch:{label:"Lunch",time:"12:00  2:00 PM",emoji:""},snacks:{label:"Snacks",time:"Anytime",emoji:""},dinner:{label:"Dinner",time:"7:00  9:00 PM",emoji:""}};function EH(a){return typeof a=="string"?a:String((a==null?void 0:a.name)||(a==null?void 0:a.meal)||"Meal")}function CH(a){var c;if(typeof a=="string")return null;const o=((c=a==null?void 0:a.nutrients)==null?void 0:c.calories)||(a==null?void 0:a.calories);return o?String(o):null}function Ule(a){return typeof a=="string"?"":String((a==null?void 0:a.description)||(a==null?void 0:a.tip)||"")}function F_({label:a,value:o,unit:c,color:d,emoji:h}){return n.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center",children:[n.jsx("div",{className:"text-2xl mb-2",children:h}),n.jsx("p",{className:"text-2xl font-black text-slate-800",children:o||""}),n.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase mt-1",children:c}),n.jsx("p",{className:"text-xs font-bold uppercase mt-1",style:{color:d},children:a})]})}function Fle({meal:a,mealType:o,onClose:c,onLogged:d}){const h=EH(a),p=CH(a)||"200",[g,x]=ee.useState({name:h,calories:p,protein:"10",carbs:"25",fats:"8",mealType:o==="snacks"?"snack":o}),[v,E]=ee.useState(!1),C=async()=>{E(!0);try{await KQ.logMeal({mealType:g.mealType,foodItems:[{name:g.name,quantity:"1 serving",nutrition:{calories:Number(g.calories),protein:Number(g.protein),carbs:Number(g.carbs),fats:Number(g.fats)}}],source:"meal_plan"}),St.success(`${g.name} logged successfully! `),d(),c()}catch{St.error("Failed to log food")}finally{E(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:c,children:n.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-md",onClick:I=>I.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-xl font-black text-slate-800",children:"Log Food"}),n.jsx("button",{onClick:c,className:"p-2 hover:bg-slate-100 rounded-full",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("input",{value:g.name,onChange:I=>x(O=>({...O,name:I.target.value})),className:"w-full px-4 py-3 rounded-xl border border-slate-200 font-bold",placeholder:"Food name"}),n.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{label:"Calories",key:"calories",emoji:""},{label:"Protein (g)",key:"protein",emoji:""},{label:"Carbs (g)",key:"carbs",emoji:""},{label:"Fats (g)",key:"fats",emoji:""}].map(I=>n.jsxs("div",{className:"bg-slate-50 rounded-xl p-3",children:[n.jsxs("p",{className:"text-xs text-slate-500 font-bold mb-1",children:[I.emoji," ",I.label]}),n.jsx("input",{type:"number",value:g[I.key],onChange:O=>x(R=>({...R,[I.key]:O.target.value})),className:"w-full text-lg font-black bg-transparent border-none outline-none"})]},I.key))}),n.jsx("button",{onClick:C,disabled:v,className:"w-full bg-[#2FC8B9] text-white py-3 rounded-xl font-black uppercase text-sm disabled:opacity-50",children:v?"Logging...":"Log Meal"})]})]})})}function Mle(){var we,Ae,V,ce,Y,z,te;const{user:a}=da();Ha();const[o,c]=ee.useState(!0),[d,h]=ee.useState(!1),[p,g]=ee.useState(null),[x,v]=ee.useState(null),[E,C]=ee.useState("all"),[I,O]=ee.useState({}),[R,k]=ee.useState(null),[M,P]=ee.useState({}),[H,$]=ee.useState(!1);ee.useEffect(()=>{window.scrollTo(0,0),J(),ge()},[]);const re={calories:(p==null?void 0:p.dailyCalorieTarget)||2e3,protein:((we=p==null?void 0:p.macroTargets)==null?void 0:we.protein)||150,carbs:((Ae=p==null?void 0:p.macroTargets)==null?void 0:Ae.carbs)||250,fats:((V=p==null?void 0:p.macroTargets)==null?void 0:V.fats)||65},J=async()=>{try{const se=localStorage.getItem("token"),Ce=await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${se}`}});if(Ce.status===404)return;const he=await Ce.json();if(he.success&&he.dietPlan){const Ne=he.dietPlan;Ne.mealPlan&&!Ne.mealPlan.snacks&&(Ne.mealPlan.snacks=[...Array.isArray(Ne.mealPlan.midMorningSnack)?Ne.mealPlan.midMorningSnack:[],...Array.isArray(Ne.mealPlan.eveningSnack)?Ne.mealPlan.eveningSnack:[]]),g(Ne)}}catch(se){console.error("Error fetching diet plan:",se)}finally{c(!1)}},ge=async()=>{try{const se=localStorage.getItem("token"),Ce=await fetch("/api/diet-recommendations/supplements/active",{headers:{Authorization:`Bearer ${se}`}});if(Ce.status===404)return;const he=await Ce.json();he.success&&he.recommendations&&v(he.recommendations)}catch(se){console.error("Error fetching supplements:",se)}},ie=async()=>{h(!0);try{const se=localStorage.getItem("token"),he=await(await fetch("/api/diet-recommendations/diet-plan/generate",{method:"POST",headers:{Authorization:`Bearer ${se}`,"Content-Type":"application/json"}})).json();he.success?(St.success("Diet plan generated successfully!"),J()):St.error(he.message||"Failed to generate plan")}catch{St.error("Error generating diet plan")}finally{h(!1)}};return o?n.jsx("div",{className:"min-h-screen flex items-center justify-center",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#2FC8B9]"})}):n.jsxs("div",{className:"min-h-screen bg-[#FAF8F5] pb-24",children:[n.jsxs("div",{className:"w-full px-4 pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6 bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-black text-black uppercase tracking-tight",children:"Diet Plan"}),n.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase tracking-widest mt-1",children:"Based on Your Health Goals"})]}),n.jsxs("button",{onClick:()=>$(!0),className:"flex items-center gap-2 px-4 py-2 bg-[#2FC8B9] text-white rounded-xl font-bold text-sm hover:bg-[#25a89b] transition-all",children:[n.jsx($R,{className:"w-4 h-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Food Preferences"})]})]}),!p&&n.jsx("div",{className:"bg-white p-8 rounded-3xl border border-slate-100 shadow-xl mb-8",children:n.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6 text-center md:text-left",children:[n.jsx("div",{className:"w-20 h-20 rounded-2xl bg-[#2FC8B9]/10 flex items-center justify-center shrink-0",children:n.jsx(KA,{className:"w-10 h-10 text-[#2FC8B9]"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h2",{className:"text-2xl font-black uppercase tracking-tight mb-2",children:"Generate Your Diet Plan"}),n.jsx("p",{className:"text-slate-500 font-bold text-sm uppercase tracking-widest leading-relaxed",children:!((ce=a==null?void 0:a.nutritionGoal)!=null&&ce.goal)&&!(a!=null&&a.hasReports)?"Set your fitness goals or upload a health report to get a hyper-personalized diet plan.":"Create a personalized diet plan based on your custom food preferences, health reports, and fitness goals."}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 justify-center md:justify-start",children:[!((Y=a==null?void 0:a.nutritionGoal)!=null&&Y.goal)&&n.jsx(Hs,{to:"/profile?tab=goals",className:"px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold uppercase hover:bg-slate-200",children:"+ Set Fitness Goal"}),n.jsx("button",{onClick:()=>$(!0),className:"px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-bold uppercase hover:bg-slate-200",children:"+ Add Preferences"})]})]}),n.jsx("button",{onClick:ie,disabled:d,className:"px-8 py-4 bg-[#2FC8B9] text-white rounded-2xl font-black uppercase text-sm shadow-lg disabled:opacity-50 hover:bg-[#25a89b] transition-colors shrink-0",children:d?"Generating...":"Generate Plan"})]})}),p&&n.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[n.jsxs("div",{className:"lg:w-[400px] space-y-6 order-1",children:[n.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-lg font-black text-black uppercase tracking-tight",children:"Bio-Protocol"}),n.jsx(Hs,{to:"/profile?tab=goals",className:"text-xs font-black text-[#2FC8B9] hover:text-black uppercase tracking-widest",children:"Adjust"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(F_,{label:"CALORIES",value:Math.round(re.calories),unit:"kcal",color:"#2FC8B9",emoji:""}),n.jsx(F_,{label:"PROTEIN",value:Math.round(re.protein),unit:"g",color:"#1A1A2E",emoji:""}),n.jsx(F_,{label:"CARBS",value:Math.round(re.carbs),unit:"g",color:"#3B82F6",emoji:""}),n.jsx(F_,{label:"FATS",value:Math.round(re.fats),unit:"g",color:"#F59E0B",emoji:""})]})]}),((z=x==null?void 0:x.supplements)==null?void 0:z.length)>0&&n.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-xl",children:[n.jsx("h2",{className:"text-lg font-black text-black uppercase tracking-tight mb-4",children:"Supplements"}),n.jsx("div",{className:"space-y-3",children:x.supplements.slice(0,3).map((se,Ce)=>n.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-black text-black uppercase",children:se.name}),n.jsx("span",{className:`text-xs font-black px-2 py-1 rounded-full uppercase ${se.priority==="high"?"bg-rose-100 text-rose-600":"bg-[#2FC8B9]/10 text-[#2FC8B9]"}`,children:se.priority})]}),n.jsx("p",{className:"text-xs text-slate-500 font-bold mb-2",children:se.reason}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("span",{className:"px-3 py-1 bg-white rounded-lg text-xs font-black text-slate-600",children:se.dosage}),n.jsx("span",{className:"px-3 py-1 bg-white rounded-lg text-xs font-black text-slate-600",children:se.timing})]})]},Ce))})]}),((te=p.lifestyleRecommendations)==null?void 0:te.length)>0&&n.jsxs("div",{className:"bg-black rounded-3xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(ane,{className:"w-6 h-6 text-[#2FC8B9]"}),n.jsx("h2",{className:"text-xl font-black uppercase tracking-tight",children:"Insights"})]}),n.jsx("div",{className:"space-y-3",children:p.lifestyleRecommendations.map((se,Ce)=>n.jsxs("div",{className:"flex gap-3 items-start",children:[n.jsx(Tn,{className:"w-4 h-4 text-[#2FC8B9] shrink-0 mt-0.5"}),n.jsx("p",{className:"text-xs text-slate-400 font-bold leading-relaxed",children:se})]},Ce))})]})]}),n.jsxs("div",{className:"flex-1 space-y-6 order-2",children:[n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[{id:"all",label:"All Meals",emoji:""},...L6.map(se=>({id:se,label:Z2[se].label,emoji:Z2[se].emoji}))].map(se=>n.jsxs("button",{onClick:()=>C(se.id),className:`whitespace-nowrap px-6 py-3 rounded-2xl font-black text-xs uppercase tracking-widest transition-all ${E===se.id?"bg-[#2FC8B9] text-white shadow-lg":"bg-white text-slate-400 border border-slate-100"}`,children:[se.emoji," ",se.label]},se.id))}),n.jsx("div",{className:"space-y-8",children:L6.map(se=>{var Ne;if(E!=="all"&&E!==se)return null;const Ce=((Ne=p.mealPlan)==null?void 0:Ne[se])||[];if(Ce.length===0)return null;const he=Z2[se];return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center text-2xl",children:he.emoji}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-black text-black uppercase",children:he.label}),n.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:he.time})]})]}),n.jsxs("span",{className:"bg-[#2FC8B9]/10 text-[#2FC8B9] px-3 py-1 rounded-full text-xs font-black uppercase",children:[Ce.length," Items"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ce.slice(0,3).map((Z,Ie)=>{const Ve=EH(Z),Pe=CH(Z),ne=Ule(Z),ve=`${se}-${Ie}`,ue=I[ve],Te=M[ve];return n.jsxs("div",{className:"bg-white rounded-3xl border border-slate-100 p-5 hover:shadow-xl transition-all relative pt-8 mt-4",children:[n.jsx("div",{className:"absolute -top-3 left-6",children:n.jsxs("span",{className:"bg-slate-800 text-white text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full shadow-sm",children:["Option ",Ie+1]})}),n.jsx("button",{onClick:()=>O(Be=>({...Be,[ve]:!Be[ve]})),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center",children:n.jsx(Ca,{className:`w-4 h-4 ${ue?"text-rose-500 fill-rose-500":"text-slate-300"}`})}),n.jsxs("div",{className:"flex gap-4 mb-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-50 flex items-center justify-center text-3xl shrink-0",children:Ple(Ve,se)}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-base font-black text-black leading-tight mb-1",children:Ve}),ne&&n.jsx("p",{className:"text-xs text-slate-500 font-bold line-clamp-2",children:ne})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("div",{className:"flex items-center gap-1 text-xs font-black text-slate-400",children:[n.jsx(Oc,{className:"w-3 h-3"})," 15 min"]}),Pe&&n.jsxs("div",{className:"flex items-center gap-1 text-xs font-black text-[#2FC8B9]",children:[n.jsx(ul,{className:"w-3 h-3"})," ",Pe," kcal"]})]}),n.jsx("button",{onClick:()=>k({meal:Z,mealType:se}),className:`px-4 py-2 rounded-xl text-xs font-black uppercase ${Te?"bg-emerald-50 text-emerald-600":"bg-black text-white hover:bg-[#2FC8B9]"}`,children:Te?"Logged":"Log"})]})]},ve)})})]},se)})})]})]})]}),R&&n.jsx(Fle,{meal:R.meal,mealType:R.mealType,onClose:()=>k(null),onLogged:()=>{const se=`${R.mealType}-logged`;P(Ce=>({...Ce,[se]:!0}))}}),H&&n.jsx(jle,{onClose:()=>$(!1)})]})}function Vle(){var z,te,se;const{user:a}=da(),o=rE(),[c,d]=ee.useState([]),[h,p]=ee.useState(""),[g,x]=ee.useState(!1),[v,E]=ee.useState(!1),[C,I]=ee.useState(""),[O,R]=ee.useState(null),[k,M]=ee.useState([]),[P,H]=ee.useState(!1),$=ee.useRef(null),re=ee.useRef(null);ee.useEffect(()=>{(async()=>{try{const he=localStorage.getItem("token"),Ne=await fetch("/api/health/reports",{headers:{Authorization:`Bearer ${he}`}});if(Ne.ok){const Z=await Ne.json();M(Z.reports||[])}}catch(he){console.error("Failed to load reports:",he)}})()},[]),ee.useEffect(()=>{var he,Ne;a&&(async()=>{try{const Z=localStorage.getItem("token"),Ie=await fetch("/api/chat/history",{headers:{Authorization:`Bearer ${Z}`}});if(Ie.ok){const Pe=await Ie.json();if(Pe.success&&Pe.messages&&Pe.messages.length>0){d(Pe.messages),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Pe.messages));return}}const Ve=localStorage.getItem(`chat_history_${a==null?void 0:a.id}`);if(Ve){const Pe=JSON.parse(Ve);d(Pe)}else{const Pe=J();d([{role:"assistant",content:Pe,timestamp:new Date}])}}catch(Z){console.error("Failed to load chat history:",Z);const Ie=localStorage.getItem(`chat_history_${a==null?void 0:a.id}`);if(Ie)d(JSON.parse(Ie));else{const Ve=J();d([{role:"assistant",content:Ve,timestamp:new Date}])}}})(),(he=o.state)!=null&&he.initialQuery?(p(o.state.initialQuery),setTimeout(()=>{const Z=document.querySelector("form");Z&&Z.requestSubmit()},500)):(Ne=o.state)!=null&&Ne.selectedText&&p(`Can you explain this: "${o.state.selectedText}"`)},[a==null?void 0:a.id,o.state,a==null?void 0:a.name]),ee.useEffect(()=>{var Ce;(Ce=$.current)==null||Ce.scrollIntoView({behavior:"smooth"})},[c,C]);const J=()=>{let Ce=`Hello ${(a==null?void 0:a.name)||"there"}!  I'm your AI health assistant.

`;return k&&k.length>0?(Ce+=`I've reviewed your uploaded health reports:

`,k.slice(0,3).forEach(he=>{const Ne=new Date(he.uploadDate).toLocaleDateString();if(Ce+=` **${he.reportType}** (${Ne})
`,he.analysis&&(Ce+=`   ${he.analysis.substring(0,100)}...
`),he.metrics&&Object.keys(he.metrics).length>0){const Z=Object.keys(he.metrics).slice(0,2);Ce+=`   Key metrics: ${Z.join(", ")}
`}Ce+=`
`}),Ce+=`I have a complete understanding of your health profile. Feel free to ask me about your reports, health concerns, or get personalized recommendations!

What would you like to know?`):Ce+="I can help you understand your health reports, explain medical terms, provide diet guidance, and answer health-related questions. What would you like to know?",Ce},ge=(Ce,he)=>{E(!0),I("");let Ne=0;const Z=setInterval(()=>{Ne<=Ce.length?(I(Ce.substring(0,Ne)),Ne++):(clearInterval(Z),E(!1),he())},15);return()=>clearInterval(Z)},ie=async Ce=>{try{const he=localStorage.getItem("token"),Ne=Ce.slice(-2);await fetch("/api/chat/history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${he}`},body:JSON.stringify({messages:Ne})}),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Ce))}catch(he){console.error("Failed to save chat to backend:",he),localStorage.setItem(`chat_history_${a==null?void 0:a.id}`,JSON.stringify(Ce))}},we=async()=>{if(confirm("Are you sure you want to clear the chat history?"))try{const Ce=localStorage.getItem("token");await fetch("/api/chat/history",{method:"DELETE",headers:{Authorization:`Bearer ${Ce}`}}),localStorage.removeItem(`chat_history_${a==null?void 0:a.id}`);const he=J();d([{role:"assistant",content:he,timestamp:new Date}]),St.success("Chat cleared")}catch(Ce){console.error("Failed to clear chat:",Ce),localStorage.removeItem(`chat_history_${a==null?void 0:a.id}`);const he=J();d([{role:"assistant",content:he,timestamp:new Date}]),St.error("Chat cleared locally")}},Ae=()=>{const Ce=J();d([{role:"assistant",content:Ce,timestamp:new Date}]),H(!1),St.success("New chat started")},V=async Ce=>{if(Ce.preventDefault(),!h.trim()||g)return;const he={role:"user",content:h,timestamp:new Date};d(Z=>[...Z,he]);const Ne=h;p(""),x(!0);try{const Z=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:Ne,conversationHistory:c.slice(-10),userReports:k.map(Ve=>({type:Ve.reportType,date:Ve.uploadDate,analysis:Ve.analysis,metrics:Ve.metrics}))})});if(!Z.ok)throw new Error("Failed to get AI response");const Ie=await Z.json();Ie.success&&Ie.response&&ge(Ie.response,()=>{const Ve={role:"assistant",content:Ie.response,timestamp:new Date},Pe=[...c,he,Ve];d(Pe),I(""),ie(Pe)})}catch(Z){console.error("AI Chat error:",Z),St.error("Failed to get response");const Ie=ce(Ne);ge(Ie,()=>{const Ve={role:"assistant",content:Ie,timestamp:new Date},Pe=[...c,he,Ve];d(Pe),I(""),ie(Pe)})}finally{x(!1)}},ce=Ce=>{const he=Ce.toLowerCase();return he.includes("vitamin d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)`:he.includes("iron")||he.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals`:"Thank you for your question. I'm here to help with understanding your health reports, explaining medical terms, providing diet guidance, and answering health-related questions."},Y=(Ce,he)=>{navigator.clipboard.writeText(Ce),R(he),setTimeout(()=>R(null),2e3),St.success("Copied to clipboard")};return n.jsxs("div",{className:"w-full h-full bg-white flex flex-col md:flex-row",children:[n.jsxs("div",{className:"md:hidden fixed top-0 left-0 right-0 z-30 bg-white border-b border-gray-200 px-4 py-2.5 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-xs font-bold shadow-md flex-shrink-0",children:((te=(z=a==null?void 0:a.name)==null?void 0:z[0])==null?void 0:te.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const Ce=new Date().getHours();return Ce<12?"Good Morning":Ce<18?"Good Afternoon":"Good Evening"})(),", ",((se=a==null?void 0:a.name)==null?void 0:se.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all border border-gray-200 flex-shrink-0",children:n.jsx(dh,{className:"w-4 h-4 text-slate-700"})})]}),P&&n.jsx("div",{className:"fixed inset-0 bg-black/30 z-40 md:hidden",onClick:()=>H(!1)}),n.jsxs("div",{className:`fixed md:static left-0 top-0 h-full w-64 bg-white border-r border-gray-200 flex flex-col transition-transform duration-300 z-50 md:z-auto ${P?"translate-x-0":"-translate-x-full md:translate-x-0"} md:translate-x-0 shrink-0`,children:[n.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between shrink-0",children:[n.jsx("h2",{className:"font-bold text-gray-900 text-xs",children:"Chat History"}),n.jsx("button",{onClick:()=>H(!1),className:"p-1 hover:bg-gray-100 rounded md:hidden",children:n.jsx(Gn,{className:"w-4 h-4"})})]}),n.jsx("button",{onClick:Ae,className:"m-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 font-medium text-xs shrink-0",children:"+ New Chat"}),n.jsx("div",{className:"flex-1 overflow-y-auto px-2 space-y-1",children:n.jsxs("div",{className:"p-3 text-center",children:[n.jsx("p",{className:"text-xs text-gray-500",children:"Chat history is saved automatically"}),n.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[c.length," messages in current chat"]})]})}),n.jsx("div",{className:"p-2 border-t border-gray-200 space-y-1 shrink-0",children:n.jsxs("button",{onClick:we,className:"w-full px-2 py-1.5 text-xs text-red-600 hover:bg-red-50 rounded-lg transition flex items-center justify-center gap-2",children:[n.jsx(qp,{className:"w-3 h-3"}),"Clear Chat"]})})]}),n.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[n.jsx("div",{className:"flex items-center px-3 py-2 border-b border-gray-200 bg-white shrink-0 mt-16 md:mt-0",children:n.jsx("button",{onClick:()=>H(!P),className:"p-1.5 hover:bg-gray-100 rounded-lg transition md:hidden",title:"Toggle chat history",children:n.jsx(JV,{className:"w-5 h-5 text-gray-700"})})}),n.jsxs("div",{ref:re,className:"flex-1 overflow-y-auto px-3 py-4 space-y-3 pb-24 md:pb-4",style:{userSelect:"text"},children:[c.map((Ce,he)=>n.jsxs("div",{className:`flex gap-2 ${Ce.role==="user"?"justify-end":"justify-start"}`,children:[Ce.role==="assistant"&&n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(Q2,{className:"w-4 h-4 text-white"})}),n.jsxs("div",{className:`max-w-xs md:max-w-md rounded-2xl px-3 py-2 ${Ce.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[n.jsx("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:Ce.content}),n.jsxs("div",{className:"flex items-center justify-between mt-1 gap-2",children:[n.jsx("span",{className:`text-xs ${Ce.role==="user"?"text-blue-100":"text-gray-500"}`,children:Ce.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),Ce.role==="assistant"&&n.jsx("button",{onClick:()=>Y(Ce.content,he),className:"transition-colors p-0.5 rounded hover:bg-gray-200",title:"Copy response",children:O===he?n.jsx(GA,{className:"w-3 h-3 text-green-500"}):n.jsx(one,{className:"w-3 h-3 text-gray-500"})})]})]}),Ce.role==="user"&&n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-gray-300",children:n.jsx(Jd,{className:"w-4 h-4 text-gray-700"})})]},he)),v&&C&&n.jsxs("div",{className:"flex gap-2 justify-start",children:[n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(Q2,{className:"w-4 h-4 text-white"})}),n.jsx("div",{className:"max-w-xs md:max-w-md bg-gray-100 rounded-2xl px-3 py-2",children:n.jsxs("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed text-gray-900",children:[C,n.jsx("span",{className:"inline-block w-1 h-3 ml-1 animate-pulse bg-blue-600"})]})})]}),g&&!v&&n.jsxs("div",{className:"flex gap-2 justify-start",children:[n.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:n.jsx(Q2,{className:"w-4 h-4 text-white"})}),n.jsx("div",{className:"bg-gray-100 rounded-2xl px-3 py-2",children:n.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[n.jsx(Al,{className:"w-3 h-3 animate-spin text-blue-600"}),n.jsx("span",{className:"text-xs",children:"Analyzing..."})]})})]}),n.jsx("div",{ref:$})]}),n.jsx("div",{className:"fixed md:relative bottom-0 left-0 right-0 md:bottom-auto border-t border-gray-200 bg-white p-3 shrink-0 md:w-auto",children:n.jsxs("form",{onSubmit:V,className:"flex gap-2 items-end",children:[n.jsxs("div",{className:"flex-1 relative",children:[n.jsx("input",{type:"text",value:h,onChange:Ce=>p(Ce.target.value),placeholder:"Ask...",className:"w-full px-3 py-2.5 bg-gray-50 rounded-2xl focus:outline-none transition-all text-sm border border-gray-200 focus:border-blue-500 focus:bg-white",disabled:g||v}),h&&n.jsx("button",{type:"button",onClick:()=>p(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-lg hover:opacity-70 transition-opacity text-gray-500",children:""})]}),n.jsx("button",{type:"submit",disabled:!h.trim()||g||v,className:"px-3 py-2.5 text-white rounded-2xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 flex-shrink-0 bg-blue-600 hover:bg-blue-700",title:h.trim()?"Send message":"Type a message first",children:g||v?n.jsx(Al,{className:"w-4 h-4 animate-spin"}):n.jsx(oE,{className:"w-4 h-4"})})]})})]})]})}function Qle(){var us,Ws,ji,qr,Ga,ti,Fs,pn,Ao;const{user:a}=da(),{invalidateCache:o}=lH(),c=Ha(),[d,h]=ee.useState(!1),[p,g]=ee.useState(!0),[x,v]=ee.useState([]),[E,C]=ee.useState(null),[I,O]=ee.useState(null),[R,k]=ee.useState(!1),[M,P]=ee.useState(""),[H,$]=ee.useState(0),[re,J]=ee.useState(null),[ge,ie]=ee.useState(""),[we,Ae]=ee.useState(""),[V,ce]=ee.useState(!1),[Y,z]=ee.useState(null),[te,se]=ee.useState(""),[Ce,he]=ee.useState(""),[Ne,Z]=ee.useState(""),[Ie,Ve]=ee.useState(""),[Pe,ne]=ee.useState(null),[ve,ue]=ee.useState([]),[Te,Be]=ee.useState(""),Ue=vt=>{const Jt=vt.toLowerCase();return Jt.includes("roti")||Jt.includes("naan")||Jt.includes("paratha")?["1 pc","2 pcs","3 pcs","4 pcs"]:Jt.includes("rice")||Jt.includes("biryani")||Jt.includes("khichdi")?["1 bowl","1 plate","1 cup","2 cups"]:Jt.includes("samosa")||Jt.includes("pakora")||Jt.includes("momos")?["1 pc","2 pcs","3 pcs","5 pcs"]:Jt.includes("idli")||Jt.includes("dosa")||Jt.includes("vada")?["1 pc","2 pcs","3 pcs","1 plate"]:Jt.includes("pizza")||Jt.includes("burger")?["1 slice","2 slices","1 whole","1 med"]:Jt.includes("chicken")||Jt.includes("paneer")||Jt.includes("tikka")?["1 bowl","1 plate","150g","200g"]:["1 bowl","1 plate","1 piece","100g","150g"]},[tt,ot]=ee.useState([]),[ut,Tt]=ee.useState(new Date().toISOString().split("T")[0]),[Qe,it]=ee.useState([]),[kt,_e]=ee.useState(!1),[xt,Ke]=ee.useState("calories"),Je=ee.useRef(null);ee.useEffect(()=>{jt(ut),kt&&$e()},[ut,kt]),ee.useEffect(()=>{kt&&Je.current&&setTimeout(()=>{Je.current.scrollIntoView({behavior:"smooth",block:"start"})},100)},[kt]);const $e=async vt=>{try{const Jt=vt||ut,Js=localStorage.getItem("token"),Os=await zr.get(`/api/nutrition/activity/week?date=${Jt}`,{headers:{Authorization:`Bearer ${Js}`}});Os.data.success&&it(Os.data.weekData)}catch(Jt){console.error("Failed to fetch trends:",Jt)}},jt=async vt=>{h(!0);const Jt=vt||new Date().toISOString().split("T")[0];try{const Os={Authorization:`Bearer ${localStorage.getItem("token")}`},[jr,In,On]=await Promise.all([zr.get(`/api/nutrition/logs?date=${Jt}`,{headers:Os}),zr.get(`/api/nutrition/summary/daily?date=${Jt}`,{headers:Os}),zr.get("/api/nutrition/goals",{headers:Os}).catch(()=>({data:{healthGoal:null}}))]);v(jr.data.foodLogs||[]),C(In.data.summary),O(On.data.healthGoal);const Xr=localStorage.getItem(`waterIntake_${Jt}`);$(Xr?parseInt(Xr):0),g(!1)}catch(Js){console.error("Failed to fetch data:",Js),St.error("Failed to load nutrition data"),g(!1)}finally{h(!1)}},Kt=vt=>{const Jt=new Date().toISOString().split("T")[0],Js=new Date(ut);Js.setDate(Js.getDate()+vt);const Os=Js.toISOString().split("T")[0];if(Os>Jt){St.error("Can't view future data!");return}Tt(Os)},os=()=>{const vt=H+1;$(vt),localStorage.setItem(`waterIntake_${ut}`,vt),St.success("Water added! ")},ss=vt=>{if(!I){St.error("Please set your fitness goal first"),c("/profile?tab=goals");return}P(vt),k(!0),J(null),ie(""),Ae(""),ce(!1),z(null),se(""),he(""),Z(""),Ve(""),ne(null)},mt=vt=>{var Jt,Js,Os,jr,In,On,Xr,Aa,ea,Ka,ua,rc,Sa,nc;J(vt),P(vt.mealType),ie(((Js=(Jt=vt.foodItems)==null?void 0:Jt[0])==null?void 0:Js.name)||""),Ae(""),z({calories:((Os=vt.totalNutrition)==null?void 0:Os.calories)||0,protein:((jr=vt.totalNutrition)==null?void 0:jr.protein)||0,carbs:((In=vt.totalNutrition)==null?void 0:In.carbs)||0,fats:((On=vt.totalNutrition)==null?void 0:On.fats)||0}),se(((Aa=(Xr=vt.totalNutrition)==null?void 0:Xr.calories)==null?void 0:Aa.toString())||""),he(((Ka=(ea=vt.totalNutrition)==null?void 0:ea.protein)==null?void 0:Ka.toString())||""),Z(((rc=(ua=vt.totalNutrition)==null?void 0:ua.carbs)==null?void 0:rc.toString())||""),Ve(((nc=(Sa=vt.totalNutrition)==null?void 0:Sa.fats)==null?void 0:nc.toString())||""),ne({healthScore:vt.healthScore,healthScore10:vt.healthScore10,micronutrients:vt.micronutrients||[],enhancementTips:vt.enhancementTips||[],healthBenefitsSummary:vt.healthBenefitsSummary}),k(!0)},Ht=async()=>{var vt,Jt,Js,Os,jr;if(!ge.trim()||!we.trim()){St.error("Please enter food name and quantity");return}ce(!0);try{const In=localStorage.getItem("token"),On=await zr.post("/api/nutrition/quick-check",{foodDescription:`${we} ${ge} ${Te}`},{headers:{Authorization:`Bearer ${In}`}});if(On.data.success&&((vt=On.data.data)!=null&&vt.foodItem)){const Xr=On.data.data.foodItem.nutrition;ne(On.data.data),z(Xr),se(((Jt=Xr.calories)==null?void 0:Jt.toString())||"0"),he(((Js=Xr.protein)==null?void 0:Js.toString())||"0"),Z(((Os=Xr.carbs)==null?void 0:Os.toString())||"0"),Ve(((jr=Xr.fats)==null?void 0:jr.toString())||"0"),St.success("Food analyzed! ")}else St.error("Could not analyze food")}catch(In){console.error("Analysis error:",In),St.error("Failed to analyze food")}finally{ce(!1)}},qe=async()=>{if(!ge.trim()||!Y){St.error("Please analyze food first");return}try{const vt=localStorage.getItem("token");re?(await zr.put(`/api/nutrition/logs/${re._id}`,{foodItems:[{name:`${we} ${ge}`,nutrition:{calories:parseFloat(te)||0,protein:parseFloat(Ce)||0,carbs:parseFloat(Ne)||0,fats:parseFloat(Ie)||0}}]},{headers:{Authorization:`Bearer ${vt}`}}),St.success("Meal updated!")):(await zr.post("/api/nutrition/log-meal",{mealType:M,foodItems:[{name:`${we} ${ge}`,nutrition:{calories:parseFloat(te)||0,protein:parseFloat(Ce)||0,carbs:parseFloat(Ne)||0,fats:parseFloat(Ie)||0}}],healthScore:Pe==null?void 0:Pe.healthScore,healthScore10:Pe==null?void 0:Pe.healthScore10,micronutrients:Pe==null?void 0:Pe.micronutrients,enhancementTips:Pe==null?void 0:Pe.enhancementTips,healthBenefitsSummary:Pe==null?void 0:Pe.healthBenefitsSummary,timestamp:ut},{headers:{Authorization:`Bearer ${vt}`}}),St.success("Meal logged!")),k(!1),o(["dashboard"]),jt(ut)}catch(vt){console.error("Log meal error:",vt),St.error("Failed to log meal")}},ht=async vt=>{if(confirm("Delete this meal?"))try{const Jt=localStorage.getItem("token");await zr.delete(`/api/nutrition/logs/${vt}`,{headers:{Authorization:`Bearer ${Jt}`}}),St.success("Meal deleted"),o(["dashboard"]),jt()}catch(Jt){console.error("Delete error:",Jt),St.error("Failed to delete meal")}},Xt=vt=>({breakfast:"",lunch:"",snack:"",dinner:""})[vt]||"";if(p&&d)return n.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:n.jsx(Al,{className:"w-8 h-8 animate-spin text-purple-500"})});const zt=((I==null?void 0:I.dailyCalorieTarget)||2e3)-((E==null?void 0:E.totalCalories)||0),ds=(E==null?void 0:E.totalCalories)||0,Qt=(I==null?void 0:I.dailyCalorieTarget)||2e3,Us=Math.min(ds/Qt*100,100),bs=(E==null?void 0:E.totalProtein)||0,cs=((us=I==null?void 0:I.macroTargets)==null?void 0:us.protein)||150,Ds=Math.min(bs/cs*100,100),zs=(E==null?void 0:E.totalCarbs)||0,rs=((Ws=I==null?void 0:I.macroTargets)==null?void 0:Ws.carbs)||250,Gs=Math.min(zs/rs*100,100),dt=(E==null?void 0:E.totalFats)||0,Pt=((ji=I==null?void 0:I.macroTargets)==null?void 0:ji.fats)||80,qt=Math.min(dt/Pt*100,100),Yt=8;return n.jsxs("div",{className:"w-full min-h-screen pb-24 bg-white",children:[n.jsxs("div",{className:"w-full max-w-7xl mx-auto px-4 py-6",children:[n.jsx("div",{className:"mb-6",children:n.jsxs("div",{className:"flex items-center justify-between gap-4",children:[n.jsx("button",{onClick:()=>Kt(-1),className:"w-10 h-10 flex-shrink-0 hover:bg-slate-100 rounded-xl transition-all active:scale-90 flex items-center justify-center",children:n.jsx(eQ,{className:"w-5 h-5 text-slate-600"})}),n.jsx("div",{className:"flex-1 flex items-center justify-center gap-2",children:[-3,-2,-1,0,1,2,3].map(vt=>{const Jt=new Date;Jt.setDate(Jt.getDate()+vt);const Js=Jt.toISOString().split("T")[0],Os=ut===Js,jr=Js===new Date().toISOString().split("T")[0];return n.jsxs("button",{onClick:()=>Tt(Js),className:`relative flex flex-col items-center justify-center px-3 py-2.5 rounded-xl transition-all ${Os?"bg-slate-900 text-white shadow-lg scale-105":"bg-slate-50 hover:bg-slate-100 text-slate-600"}`,children:[jr&&n.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"}),n.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wide ${Os?"text-white/70":"text-slate-400"}`,children:Jt.toLocaleDateString("en-US",{weekday:"short"}).slice(0,3)}),n.jsx("span",{className:"text-lg font-black mt-0.5",children:Jt.getDate()})]},vt)})}),n.jsxs("div",{className:"relative flex-shrink-0",children:[n.jsx("input",{type:"date",max:new Date().toISOString().split("T")[0],value:ut,onChange:vt=>{const Jt=vt.target.value,Js=new Date().toISOString().split("T")[0];if(Jt>Js){St.error("Future dates not allowed");return}Tt(Jt)},className:"absolute inset-0 opacity-0 cursor-pointer"}),n.jsx("div",{className:"w-10 h-10 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center",children:n.jsx(yi,{className:"w-5 h-5"})})]}),n.jsx("button",{onClick:()=>Kt(1),className:"w-10 h-10 flex-shrink-0 hover:bg-slate-100 rounded-xl transition-all active:scale-90 flex items-center justify-center",children:n.jsx(Ju,{className:"w-5 h-5 text-slate-600"})})]})}),n.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[n.jsxs("div",{className:"flex-1 space-y-6 order-2 lg:order-1",children:[kt&&Qe.length>0&&n.jsx("div",{ref:Je,className:"animate-in slide-in-from-top-4 duration-500 space-y-6 order-2 scroll-mt-24",children:n.jsxs("div",{className:"card p-6 border-none shadow-xl bg-gradient-to-br from-indigo-50/50 to-purple-50/50 relative",children:[n.jsx("button",{onClick:()=>_e(!1),className:"absolute top-4 right-4 z-20 p-2 rounded-xl bg-white text-slate-600 hover:bg-slate-100 shadow-md transition-all",children:n.jsx(Gn,{className:"w-5 h-5"})}),n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-sm font-black text-slate-800 tracking-widest uppercase flex items-center gap-2",children:[n.jsx(qi,{className:"w-4 h-4 text-purple-600"}),"Trend Analysis"]}),n.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase mt-1",children:[xt.toUpperCase()," Performance"]})]}),n.jsx("span",{className:"text-[10px] font-black text-purple-600 bg-purple-100 px-2 py-1 rounded-full uppercase",children:"Last 7 Days"})]}),n.jsx("div",{className:"flex items-center gap-2 mb-6 overflow-x-auto no-scrollbar pb-1",children:[{id:"calories",label:"Cals",color:"bg-orange-500",text:"text-orange-600"},{id:"protein",label:"Prot",color:"bg-blue-500",text:"text-blue-600"},{id:"carbs",label:"Carbs",color:"bg-emerald-500",text:"text-emerald-600"},{id:"fats",label:"Fats",color:"bg-rose-500",text:"text-rose-600"}].map(vt=>n.jsx("button",{onClick:()=>Ke(vt.id),className:`px-4 py-2 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all ${xt===vt.id?"bg-slate-900 text-white shadow-md":"bg-white/60 text-slate-500 border border-white hover:border-slate-200"}`,children:vt.label},vt.id))}),n.jsx("div",{className:"h-48 w-full mt-2",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(By,{data:Qe,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"colorTrend",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:xt==="calories"?"#f97316":xt==="protein"?"#3b82f6":xt==="carbs"?"#10b981":"#f43f5e",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:xt==="calories"?"#f97316":xt==="protein"?"#3b82f6":xt==="carbs"?"#10b981":"#f43f5e",stopOpacity:0})]})}),n.jsx(Eg,{strokeDasharray:"3 3",vertical:!1,stroke:"#e2e8f0"}),n.jsx(Cg,{dataKey:"date",tick:{fill:"#94a3b8",fontSize:10,fontWeight:800},axisLine:!1,tickLine:!1,dy:10,tickFormatter:vt=>new Date(vt).toLocaleDateString("en-US",{weekday:"short"})}),n.jsx(Sg,{hide:!0,domain:["dataMin","auto"]}),n.jsx(ex,{contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 10px 25px -5px rgba(0,0,0,0.1)",fontWeight:"bold"},labelFormatter:vt=>new Date(vt).toLocaleDateString()}),n.jsx(Ly,{type:"monotone",dataKey:xt,stroke:xt==="calories"?"#f97316":xt==="protein"?"#3b82f6":xt==="carbs"?"#10b981":"#f43f5e",strokeWidth:3,fillOpacity:1,fill:"url(#colorTrend)",animationDuration:1500})]})})}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[n.jsxs("div",{className:"bg-white/60 p-4 rounded-2xl border border-white/50",children:[n.jsxs("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:["Avg ",xt]}),n.jsxs("p",{className:"text-xl font-black text-slate-800",children:[Math.round(Qe.reduce((vt,Jt)=>vt+(Jt[xt]||0),0)/Qe.length),n.jsx("span",{className:"text-[10px] ml-1 text-slate-500",children:xt==="calories"?"kcal":"g"})]})]}),n.jsxs("div",{className:"bg-white/60 p-4 rounded-2xl border border-white/50",children:[n.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Goal vs Avg"}),n.jsxs("p",{className:`text-xl font-black ${Math.round(Qe.reduce((vt,Jt)=>vt+(Jt[xt]||0),0)/Qe.length)<=(xt==="calories"?(I==null?void 0:I.dailyCalorieTarget)||2e3:xt==="protein"?((qr=I==null?void 0:I.macroTargets)==null?void 0:qr.protein)||150:xt==="carbs"?((Ga=I==null?void 0:I.macroTargets)==null?void 0:Ga.carbs)||250:((ti=I==null?void 0:I.macroTargets)==null?void 0:ti.fats)||80)?"text-emerald-600":"text-rose-600"}`,children:[Math.round(Math.round(Qe.reduce((vt,Jt)=>vt+(Jt[xt]||0),0)/Qe.length)/(xt==="calories"?(I==null?void 0:I.dailyCalorieTarget)||2e3:xt==="protein"?((Fs=I==null?void 0:I.macroTargets)==null?void 0:Fs.protein)||150:xt==="carbs"?((pn=I==null?void 0:I.macroTargets)==null?void 0:pn.carbs)||250:((Ao=I==null?void 0:I.macroTargets)==null?void 0:Ao.fats)||80)*100),"%",n.jsx("span",{className:"text-[10px] ml-1 text-slate-500 text-xs",children:"Goal"})]})]})]})]})}),n.jsx("div",{className:"space-y-4",children:["breakfast","lunch","snack","dinner"].map(vt=>{const Jt=x.filter(Os=>Os.mealType===vt),Js=Jt.reduce((Os,jr)=>{var In;return Os+(((In=jr.totalNutrition)==null?void 0:In.calories)||0)},0);return n.jsxs("div",{className:"card p-6 border-none shadow-xl bg-white/60 backdrop-blur-md",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white flex items-center justify-center border border-slate-100 shadow-sm text-3xl",children:Xt(vt)}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-black text-slate-800 tracking-tight uppercase",children:vt}),n.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[Jt.length," items "," ",n.jsxs("span",{className:"text-purple-600",children:[Math.round(Js)," kcal"]})]})]})]}),n.jsx("button",{onClick:()=>ss(vt),className:"w-12 h-12 rounded-[1.25rem] bg-slate-900 text-white flex items-center justify-center hover:bg-slate-800 transition-all shadow-xl hover:scale-110 active:scale-95 group",children:n.jsx(Zo,{className:"w-6 h-6 group-hover:rotate-90 transition-transform duration-300"})})]}),Jt.length>0&&n.jsx("div",{className:"space-y-3",children:Jt.map(Os=>{var jr,In,On,Xr,Aa,ea;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 border border-slate-50 rounded-2xl",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-semibold text-slate-800",children:((In=(jr=Os.foodItems)==null?void 0:jr[0])==null?void 0:In.name)||"Food"}),n.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-slate-500",children:[n.jsxs("span",{children:["P:"," ",Math.round(((On=Os.totalNutrition)==null?void 0:On.protein)||0),"g"]}),n.jsxs("span",{children:["C:"," ",Math.round(((Xr=Os.totalNutrition)==null?void 0:Xr.carbs)||0),"g"]}),n.jsxs("span",{children:["F: ",Math.round(((Aa=Os.totalNutrition)==null?void 0:Aa.fats)||0),"g"]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[Os.healthScore10!==void 0&&n.jsxs("div",{className:`px-2 py-1 rounded-lg text-[10px] font-black shadow-sm flex flex-col items-center justify-center min-w-[32px] ${Os.healthScore10*10>=80?"bg-emerald-50 text-emerald-600 border border-emerald-100":Os.healthScore10*10>=60?"bg-amber-50 text-amber-600 border border-amber-100":"bg-rose-50 text-rose-600 border border-rose-100"}`,children:[n.jsx("span",{className:"leading-none",children:Math.round(Os.healthScore10*10)}),n.jsx("span",{className:"text-[6px] opacity-70",children:"SCR"})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-black text-slate-800 leading-none",children:Math.round(((ea=Os.totalNutrition)==null?void 0:ea.calories)||0)}),n.jsx("p",{className:"text-[8px] text-slate-400 font-bold uppercase tracking-tighter",children:"kcal"})]}),n.jsx("button",{onClick:()=>mt(Os),className:"p-2 hover:bg-white rounded-lg transition-all ml-2 border border-transparent hover:border-slate-100",children:n.jsx(sQ,{className:"w-4 h-4 text-slate-600"})}),n.jsx("button",{onClick:()=>ht(Os._id),className:"p-2 hover:bg-rose-50 rounded-lg transition-all border border-transparent hover:border-rose-100",children:n.jsx(qp,{className:"w-4 h-4 text-red-500"})})]})]},Os._id)})})]},vt)})})]}),n.jsxs("div",{className:"lg:w-[400px] flex-shrink-0 lg:sticky lg:top-24 h-fit space-y-6 order-1 lg:order-2",children:[!kt&&n.jsxs("div",{className:"card card-gradient p-5 sm:p-8 text-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-white/50 border-none",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsx("button",{onClick:()=>_e(!0),className:"absolute top-4 right-4 z-20 p-2.5 rounded-xl shadow-lg flex items-center justify-center transition-all bg-white text-slate-600 hover:bg-purple-50",children:n.jsx(XR,{className:"w-5 h-5"})}),n.jsxs("div",{className:"flex items-start justify-between mb-4 sm:mb-8 relative z-10",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-[9px] sm:text-[10px] font-black uppercase tracking-[0.2em] text-slate-600 mb-1 sm:mb-2",children:"Remaining"}),n.jsxs("div",{className:"flex items-baseline gap-2",children:[n.jsx("span",{className:"text-4xl sm:text-6xl font-black tracking-tighter text-slate-900",children:Math.max(zt,0).toLocaleString()}),n.jsx("span",{className:"text-slate-500 font-bold text-sm sm:text-lg",children:"kcal"})]})]}),n.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-[1.25rem] sm:rounded-[1.5rem] bg-white/40 backdrop-blur-md flex items-center justify-center border border-white/50 shadow-inner group",children:n.jsx(ul,{className:"w-6 h-6 sm:w-8 sm:h-8 text-orange-500 drop-shadow-md"})})]}),n.jsxs("div",{className:"flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-500 mb-4 px-1",children:[n.jsxs("span",{children:["GOAL: ",Qt]}),n.jsxs("span",{className:"text-purple-600",children:["CONSUMED: ",ds]})]}),n.jsx("div",{className:"relative h-4 bg-white/30 rounded-full overflow-hidden mb-8 border border-white/50",children:n.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-purple-500 via-pink-500 to-orange-500 rounded-full transition-all duration-1000 ease-out shadow-[0_0_20px_rgba(139,92,246,0.3)]",style:{width:`${Us}%`}})}),n.jsx("div",{className:"grid grid-cols-3 gap-6 relative z-10",children:[{label:"Prot",value:Math.round(bs),goal:cs,color:"from-purple-400 to-orange-600",text:"text-blue-600",bg:"bg-blue-50/50",iconSize:"w-2 h-2",percentage:Ds},{label:"Carbs",value:Math.round(zs),goal:rs,color:"from-purple-400 to-orange-600",text:"text-emerald-600",bg:"bg-emerald-50/50",iconSize:"w-2 h-2",percentage:Gs},{label:"Fat",value:Math.round(dt),goal:Pt,color:"from-purple-400 to-orange-600",text:"text-amber-600",bg:"bg-amber-50/50",iconSize:"w-2 h-2",percentage:qt}].map(vt=>n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2 px-1",children:[n.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${vt.text.replace("text-","bg-")}`}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:vt.label})]}),n.jsxs("div",{className:`${vt.bg} backdrop-blur-md p-3 rounded-2xl border border-white/50 shadow-inner`,children:[n.jsxs("p",{className:"text-xl font-black text-slate-800 tracking-tight",children:[vt.value,n.jsx("span",{className:"text-[10px] ml-0.5",children:"g"})]}),n.jsx("div",{className:"w-full h-1.5 bg-white/40 rounded-full mt-2 overflow-hidden",children:n.jsx("div",{className:`h-full bg-gradient-to-r ${vt.color} rounded-full transition-all duration-700`,style:{width:`${vt.percentage}%`}})})]})]},vt.label))})]}),n.jsxs("div",{className:"card p-6 border-none shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-blue-50/50 backdrop-blur-md flex items-center justify-center border border-blue-100 shadow-inner",children:n.jsx(Kb,{className:"w-7 h-7 text-blue-500 drop-shadow-sm"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-black text-slate-800 tracking-tight",children:"HYDRATION"}),n.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:[H," of ",Yt," glasses"]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-4xl font-black text-blue-600 tracking-tighter",children:H}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] -mt-1",children:"Glasses"})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2.5 mb-6",children:[Array.from({length:Yt}).map((vt,Jt)=>n.jsx("button",{onClick:os,className:`w-10 h-11 rounded-xl flex items-center justify-center transition-all transform hover:scale-110 active:scale-95 border-2 ${Jt<H?"bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200":"bg-white/40 border-slate-100 text-slate-400 hover:border-blue-200"}`,children:n.jsx(Kb,{className:`w-5 h-5 ${Jt<H?"animate-bounce":""}`})},Jt)),n.jsx("button",{onClick:os,className:"w-10 h-11 rounded-xl flex items-center justify-center bg-slate-50 border-2 border-dashed border-slate-200 text-slate-400 hover:border-blue-300 hover:bg-white transition-all transition-all",children:n.jsx(Zo,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"w-full h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-orange-600 rounded-full transition-all duration-1000 ease-out",style:{width:`${H/Yt*100}%`}})})]})]})]})]}),R&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center md:justify-center",onClick:()=>k(!1),children:n.jsxs("div",{className:"bg-white w-full md:w-full md:max-w-lg rounded-t-3xl md:rounded-3xl p-6 pb-24 md:pb-6 max-h-[90vh] overflow-y-auto",onClick:vt=>vt.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center",children:n.jsx(lx,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:[re?"Edit":"Add"," ",M.charAt(0).toUpperCase()+M.slice(1)]}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5",children:"Track your nutrition"})]})]}),n.jsx("button",{onClick:()=>k(!1),className:"w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-all",children:n.jsx(Gn,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"space-y-4",children:Y?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-6 duration-700 ease-out",children:[n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/5 to-orange-500/5 rounded-[2.5rem] blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),n.jsxs("div",{className:"bg-white rounded-[2.5rem] p-6 border border-slate-100 shadow-[0_20px_50px_rgba(0,0,0,0.04)] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("h3",{className:"text-3xl font-black text-slate-800 tracking-tighter mb-1 truncate",title:ge,children:ge}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-emerald-50 text-emerald-600 rounded-full border border-emerald-100/50",children:[n.jsx(cne,{className:"w-3 h-3"}),n.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider",children:"Verified by AI Health"})]})})]}),n.jsxs("div",{className:"bg-orange-50 rounded-2xl p-3 border border-orange-100 text-center min-w-[80px] shadow-sm",children:[n.jsx("p",{className:"text-[9px] font-black text-orange-400 uppercase tracking-widest mb-0.5",children:"SCORE"}),n.jsx("p",{className:"text-3xl font-black text-orange-600 leading-none",children:Math.round(((Pe==null?void 0:Pe.healthScore10)||(Pe==null?void 0:Pe.healthScore)/10)*10)}),n.jsx("p",{className:"text-[9px] font-black text-orange-400 uppercase tracking-tighter mt-1",children:"out of 100"})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"flex items-center justify-between px-1",children:n.jsx("h4",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"MACRONUTRIENTS"})}),n.jsx("div",{className:"grid grid-cols-4 gap-2.5",children:[{label:"CALORIES",value:Math.round(Y.calories),unit:"kcal",color:"text-orange-600",bg:"bg-slate-50"},{label:"PROTEIN",value:Math.round(Y.protein),unit:"g",color:"text-blue-600",bg:"bg-slate-50"},{label:"CARBS",value:Math.round(Y.carbs),unit:"g",color:"text-emerald-600",bg:"bg-slate-50"},{label:"FATS",value:Math.round(Y.fats),unit:"g",color:"text-rose-600",bg:"bg-slate-50"}].map(vt=>n.jsxs("div",{className:`${vt.bg} rounded-[1.25rem] p-3 border border-slate-100/50 shadow-sm transition-all hover:scale-[1.02] hover:bg-white`,children:[n.jsx("p",{className:"text-[8px] font-black text-slate-400 uppercase tracking-tighter mb-1.5",children:vt.label}),n.jsxs("div",{className:"flex items-baseline gap-0.5",children:[n.jsx("span",{className:"text-lg font-black text-slate-800 leading-none",children:vt.value}),n.jsx("span",{className:"text-[9px] font-bold text-slate-400",children:vt.unit})]})]},vt.label))})]})]})]}),n.jsxs("div",{className:"bg-blue-50/40 rounded-[2.5rem] p-7 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-100/50 flex items-center justify-center text-blue-600",children:n.jsx(br,{className:"w-4 h-4"})}),n.jsx("h4",{className:"text-sm font-black text-slate-700 tracking-tight uppercase",children:"Micronutrients"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((Pe==null?void 0:Pe.micronutrients)||[]).map((vt,Jt)=>n.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-blue-100 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700 truncate",children:vt.name}),n.jsxs("span",{className:"text-[10px] font-black text-blue-600",children:[vt.percentage,"%"]})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:vt.value}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${vt.percentage}%`}})})]},Jt)),(!(Pe!=null&&Pe.micronutrients)||Pe.micronutrients.length===0)&&["Vitamin A","Vitamin C","Iron","Calcium"].map(vt=>n.jsxs("div",{className:"bg-white/80 rounded-2xl p-4 border border-blue-100 shadow-sm opacity-60",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700",children:vt}),n.jsx("span",{className:"text-[10px] font-black text-blue-600",children:"--%"})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:"--"}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full"})]},vt))]})]}),n.jsxs("div",{className:"bg-emerald-50/50 rounded-[2.5rem] p-7 border border-emerald-100 relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-200 group-hover:rotate-12 transition-transform",children:n.jsx(qR,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-emerald-900 tracking-tight uppercase",children:"Health Benefits"})]}),n.jsx("p",{className:"text-xs font-bold text-emerald-800/80 leading-relaxed",children:(Pe==null?void 0:Pe.healthBenefitsSummary)||(Pe==null?void 0:Pe.analysis)||"This meal provides essential nutrients for your daily requirements."})]}),n.jsxs("div",{className:"bg-amber-50/40 rounded-[2.5rem] p-7 border border-amber-100 group",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white border border-amber-100 flex items-center justify-center text-orange-500 group-hover:scale-110 transition-transform",children:n.jsx(KA,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-amber-900 tracking-tight uppercase",children:"Make it even Healthier"})]}),n.jsxs("div",{className:"space-y-3",children:[((Pe==null?void 0:Pe.enhancementTips)||[]).map((vt,Jt)=>n.jsxs("div",{className:"bg-white rounded-[1.5rem] p-4 flex items-center gap-4 border border-amber-100 shadow-sm hover:shadow-md transition-all",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center text-white shrink-0",children:n.jsx(Zo,{className:"w-5 h-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-sm font-black text-slate-800 mb-0.5",children:vt.name||vt}),n.jsx("p",{className:"text-[10px] font-bold text-slate-500 truncate",children:vt.benefit||"Adds nutritional value"})]})]},Jt)),(!(Pe!=null&&Pe.enhancementTips)||Pe.enhancementTips.length===0)&&n.jsx("div",{className:"text-center py-4 text-slate-400 text-xs font-bold uppercase tracking-widest italic",children:"Already optimal!"})]})]})]}),n.jsxs("div",{className:"flex gap-4 pt-4",children:[n.jsx("button",{onClick:()=>{z(null),Ae("")},className:"flex-1 py-5 bg-slate-100 text-slate-600 rounded-[2rem] font-black text-sm uppercase tracking-widest hover:bg-slate-200 transition-all active:scale-95",children:"Back"}),n.jsxs("button",{onClick:qe,className:"flex-[2] py-5 bg-[#2FC8B9] text-white rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-lg shadow-[#2FC8B9]/20 hover:bg-[#28b5a6] transition-all active:scale-95 flex items-center justify-center gap-3 group relative overflow-hidden",children:[n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"}),n.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-white/80 group-hover:scale-110 transition-transform"}),re?"Update Meal":"Add to Diary"]})]})]})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2 ml-1",children:"Food Name"}),n.jsx("input",{type:"text",value:ge,onChange:vt=>{ie(vt.target.value),ot(Ue(vt.target.value))},placeholder:"e.g., Chicken Salad",className:"w-full px-5 py-4 bg-slate-50/80 border-2 border-slate-100 rounded-[1.5rem] focus:border-purple-500 focus:bg-white focus:outline-none text-slate-900 font-bold transition-all placeholder:text-slate-400 shadow-inner",onKeyPress:vt=>vt.key==="Enter"&&Ht()})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Quantity"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:tt.map((vt,Jt)=>n.jsx("button",{type:"button",onClick:()=>Ae(vt),className:`px-3 py-2 rounded-xl text-[11px] font-bold transition-all border-2 ${we===vt?"bg-purple-600 border-purple-600 text-white shadow-lg shadow-purple-200":"bg-white border-slate-100 text-slate-600 hover:border-purple-200"}`,children:vt},Jt))}),n.jsx("input",{type:"text",value:we,onChange:vt=>Ae(vt.target.value),placeholder:"e.g., 1 bowl, 100g",className:"w-full px-5 py-3.5 bg-slate-50/80 border-2 border-slate-100 rounded-[1.5rem] focus:border-purple-500 focus:bg-white focus:outline-none text-slate-900 font-bold transition-all placeholder:text-slate-400 shadow-inner",onKeyPress:vt=>vt.key==="Enter"&&Ht()})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Preparation"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{label:"Fried",icon:""},{label:"Baked",icon:""},{label:"Grilled",icon:""},{label:"Home",icon:""},{label:"Dine-in",icon:""},{label:"Packaged",icon:""}].map(vt=>n.jsxs("button",{type:"button",onClick:()=>Be(vt.label),className:`p-2.5 rounded-xl transition-all border-2 flex flex-col items-center gap-1.5 ${Te===vt.label?"bg-purple-600 border-purple-600 text-white shadow-lg shadow-purple-200":"bg-white border-slate-100 text-slate-600 hover:border-purple-200"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:vt.icon}),n.jsx("span",{className:"text-[9px] font-black uppercase tracking-tighter",children:vt.label})]},vt.label))})]}),n.jsxs("button",{onClick:Ht,disabled:V||!ge.trim()||!we.trim(),className:"w-full bg-slate-900 text-white font-black py-5 rounded-[2rem] hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 transition-all shadow-[0_20px_40px_-12px_rgba(15,23,42,0.3)] uppercase tracking-widest text-sm relative overflow-hidden group active:scale-[0.98]",children:[n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"}),n.jsx("div",{className:"relative z-10 flex items-center gap-3",children:V?n.jsxs(n.Fragment,{children:[n.jsx(Al,{className:"w-5 h-5 animate-spin text-purple-400"}),"Analyzing..."]}):n.jsxs(n.Fragment,{children:[n.jsx(td,{className:"w-5 h-5 text-purple-400 group-hover:animate-pulse"}),"Calculate Nutrition"]})})]})]})})})]})})]})}const Hle=()=>n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-pink-900 to-slate-900 p-4 sm:p-6 animate-pulse",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("div",{className:"h-8 bg-slate-700/50 rounded w-48 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-64"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(a=>n.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-5 border border-slate-700/50",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"h-5 bg-slate-700/50 rounded w-32 mb-2"}),n.jsx("div",{className:"h-4 bg-slate-700/50 rounded w-24"})]}),n.jsx("div",{className:"w-10 h-10 bg-slate-700/50 rounded-lg"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-3 bg-slate-700/50 rounded w-full"}),n.jsx("div",{className:"h-3 bg-slate-700/50 rounded w-3/4"})]}),n.jsx("div",{className:"mt-4 h-9 bg-slate-700/50 rounded-lg"})]},a))})]});function Gle(){var I,O,R;const{user:a}=da(),[o,c]=ee.useState([]),[d,h]=ee.useState(!0),[p,g]=ee.useState("all");ee.useEffect(()=>{window.scrollTo(0,0),x()},[]);const x=async()=>{try{const{data:k}=await sd.getReports();c(k)}catch{St.error("Failed to load reports")}finally{h(!1)}},v=async(k,M)=>{if(M.preventDefault(),M.stopPropagation(),!!window.confirm("Are you sure you want to delete this report? This action cannot be undone."))try{await sd.deleteReport(k),c(o.filter(P=>P._id!==k)),St.success("Report deleted successfully")}catch{St.error("Failed to delete report")}},E=p==="all"?o:o.filter(k=>k.reportType.toLowerCase().includes(p.toLowerCase())),C=["all",...new Set(o.map(k=>k.reportType))];return d?n.jsx(Hle,{}):n.jsxs("div",{className:"w-full mx-auto space-y-8 animate-fade-in p-6 pb-24",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((O=(I=a==null?void 0:a.name)==null?void 0:I[0])==null?void 0:O.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const k=new Date().getHours();return k<12?"Good Morning":k<18?"Good Afternoon":"Good Evening"})(),", ",((R=a==null?void 0:a.name)==null?void 0:R.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(dh,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"card card-gradient p-8 text-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-white/50 border-none",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/20 rounded-full blur-3xl -mr-20 -mt-20"}),n.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-6",children:[n.jsxs("div",{children:[n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-500 hover:text-purple-600 font-black transition-all mb-4 text-[10px] uppercase tracking-widest group",children:[n.jsx("div",{className:"p-1.5 bg-white/50 rounded-lg group-hover:scale-110 transition-transform shadow-sm border border-white",children:n.jsx(Vn,{className:"w-3.5 h-3.5"})}),"Back to Dashboard"]}),n.jsx("h1",{className:"text-3xl font-black text-slate-900 tracking-tight mb-2 uppercase",children:"Your Health Archive"}),n.jsxs("p",{className:"text-slate-500 text-sm font-bold opacity-80",children:["Track your progress across ",o.length," diagnostic reports"]})]}),n.jsxs(Hs,{to:"/upload",className:"px-6 py-4 bg-slate-900 text-white rounded-[1.5rem] font-black hover:shadow-2xl transition-all flex items-center justify-center gap-3 text-sm uppercase tracking-widest active:scale-95 group shadow-xl",children:[n.jsx(lo,{className:"w-4 h-4 group-hover:-translate-y-1 transition-transform"}),"Upload New Report"]})]})]}),o.length>0&&n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(Hn,{className:"w-5 h-5 text-purple-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-3xl font-black text-slate-900 tracking-tighter leading-none",children:o.length}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Reports"})]})]})}),n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-emerald-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(qi,{className:"w-5 h-5 text-emerald-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-3xl font-black text-slate-900 tracking-tighter leading-none",children:o.filter(k=>k.status==="completed").length}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Analyzed"})]})]})}),n.jsx("div",{className:"card p-5 group hover:scale-[1.02] transition-all duration-300",children:n.jsxs("div",{className:"flex flex-col items-center sm:items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-amber-50 flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform",children:n.jsx(yi,{className:"w-5 h-5 text-amber-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xl sm:text-2xl font-black text-slate-900 tracking-tighter leading-none pt-1",children:o.length>0?new Date(o[0].createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A"}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:"Latest"})]})]})})]}),n.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4 snap-x snap-mandatory scrollbar-hide -mx-6 px-6 sm:mx-0 sm:px-0",children:C.map(k=>n.jsx("button",{onClick:()=>g(k),className:`px-5 py-2.5 rounded-2xl font-black whitespace-nowrap transition-all text-[11px] uppercase tracking-widest leading-none snap-start border-2 ${p===k?"bg-slate-900 border-slate-900 text-white shadow-xl scale-105":"bg-white/50 backdrop-blur-sm text-slate-600 border-white hover:border-purple-200 hover:bg-white"}`,children:k==="all"?"All Diagnostics":k},k))}),E.length>0?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden sm:grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(k=>{var M;return n.jsxs("div",{className:"card p-6 border-none hover:shadow-2xl transition-all duration-300 group relative ring-1 ring-white/50",children:[n.jsx("button",{onClick:P=>v(k._id,P),className:"absolute top-4 right-4 w-9 h-9 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10 shadow-sm opacity-0 group-hover:opacity-100",children:n.jsx(qp,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-5 mb-6",children:[n.jsx("div",{className:"w-16 h-16 rounded-[1.25rem] bg-indigo-50 flex items-center justify-center shadow-inner group-hover:bg-indigo-100 transition-colors",children:n.jsx(Hn,{className:"w-8 h-8 text-indigo-600"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("span",{className:`text-[9px] font-black px-2.5 py-1 rounded-lg uppercase tracking-widest ${k.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:k.status})}),n.jsx("h3",{className:"text-xl font-black text-slate-800 leading-tight uppercase group-hover:text-purple-600 transition-colors mb-1",children:k.reportType}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest font-mono",children:[n.jsx(yi,{className:"w-3 h-3"}),new Date(k.reportDate||k.createdAt).toLocaleDateString()]})]})]}),((M=k.aiAnalysis)==null?void 0:M.healthScore)&&n.jsxs("div",{className:"bg-slate-50/50 backdrop-blur-md rounded-2xl p-4 border border-white/50 mb-6 shadow-inner flex items-center justify-between",children:[n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Health Score"}),n.jsxs("div",{className:"flex items-baseline gap-1",children:[n.jsx("span",{className:"text-3xl font-black text-slate-900 tracking-tighter",children:k.aiAnalysis.healthScore}),n.jsx("span",{className:"text-slate-400 font-bold text-xs",children:"/100"})]})]}),n.jsxs(Hs,{to:`/reports/${k._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-4 bg-white border-2 border-slate-100 text-slate-800 rounded-2xl font-black text-xs uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(zp,{className:"w-4 h-4"}),"Analysis Details"]})]},k._id)})}),n.jsx("div",{className:"sm:hidden",children:E.length<=3?n.jsx("div",{className:"grid grid-cols-1 gap-4",children:E.map(k=>{var M;return n.jsxs("div",{className:"card p-5 relative border-none ring-1 ring-white/50",children:[n.jsx("button",{onClick:P=>v(k._id,P),className:"absolute top-3 right-3 w-8 h-8 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10",children:n.jsx(qp,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Hn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0 pr-8",children:[n.jsx("div",{className:"flex items-start justify-between gap-2 mb-1",children:n.jsx("h3",{className:"text-sm font-black text-slate-800 truncate uppercase",children:k.reportType})}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("span",{className:`text-[8px] font-black px-2 py-0.5 rounded-md uppercase tracking-widest whitespace-nowrap ${k.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:k.status})}),n.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 font-mono mb-2",children:new Date(k.reportDate||k.createdAt).toLocaleDateString()}),((M=k.aiAnalysis)==null?void 0:M.healthScore)&&n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Score:"}),n.jsx("span",{className:"text-lg font-black text-slate-900 tracking-tighter",children:k.aiAnalysis.healthScore}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:"/100"})]})]})]}),n.jsxs(Hs,{to:`/reports/${k._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(zp,{className:"w-3 h-3"}),"Details"]})]},k._id)})}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex overflow-x-auto gap-4 pb-6 snap-x snap-mandatory scrollbar-hide -mx-6 px-6",children:E.map(k=>{var M;return n.jsxs("div",{className:"min-w-[280px] card p-5 relative snap-start flex-shrink-0 border-none ring-1 ring-white/50",children:[n.jsx("button",{onClick:P=>v(k._id,P),className:"absolute top-3 right-3 w-8 h-8 rounded-xl bg-red-50 hover:bg-red-500 hover:text-white flex items-center justify-center transition-all z-10",children:n.jsx(qp,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-start gap-4 mb-4 pr-8",children:[n.jsx("div",{className:"w-12 h-12 rounded-[1rem] bg-indigo-50 flex items-center justify-center flex-shrink-0 shadow-inner",children:n.jsx(Hn,{className:"w-6 h-6 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h3",{className:"text-sm font-black text-slate-800 mb-1 uppercase truncate",children:k.reportType}),n.jsx("span",{className:`text-[8px] px-2 py-0.5 rounded-md font-black uppercase tracking-widest inline-block ${k.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:k.status})]})]}),n.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest font-mono mb-4",children:new Date(k.reportDate||k.createdAt).toLocaleDateString()}),((M=k.aiAnalysis)==null?void 0:M.healthScore)&&n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50/50 backdrop-blur-md border border-white/50 rounded-xl mb-4 shadow-inner",children:[n.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Health Score"}),n.jsxs("div",{className:"flex items-baseline gap-1",children:[n.jsx("span",{className:"text-2xl font-black text-slate-900 tracking-tighter",children:k.aiAnalysis.healthScore}),n.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:"/100"})]})]}),n.jsxs(Hs,{to:`/reports/${k._id}`,onClick:()=>window.scrollTo(0,0),className:"w-full py-3 bg-white border-2 border-slate-100 text-slate-800 rounded-xl font-black text-[10px] uppercase tracking-widest hover:border-purple-600 hover:text-purple-600 transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[n.jsx(zp,{className:"w-3 h-3"}),"Details"]})]},k._id)})}),n.jsx("div",{className:"flex items-center justify-center gap-2 text-slate-400 text-[10px] font-black uppercase tracking-widest mt-2",children:n.jsx("span",{children:" Swipe for more "})})]})})]}):n.jsxs("div",{className:"text-center py-16 px-6 card border-none shadow-xl flex flex-col items-center max-w-lg mx-auto mt-12",children:[n.jsxs("div",{className:"w-24 h-24 bg-purple-50 rounded-3xl flex items-center justify-center mb-6 shadow-inner relative",children:[n.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-3xl blur"}),n.jsx(Hn,{className:"w-12 h-12 text-purple-300 relative z-10"})]}),n.jsx("h3",{className:"text-xl font-black text-slate-800 tracking-tight mb-2 uppercase",children:"No Data Found"}),n.jsx("p",{className:"text-slate-500 mb-8 text-sm font-bold opacity-80 max-w-xs leading-relaxed",children:p==="all"?"Start your health journey by uploading your first diagnostic report.":`No ${p} diagnostic records exist yet.`}),n.jsxs(Hs,{to:"/upload",className:"w-full sm:w-auto px-8 py-4 bg-slate-900 text-white rounded-[1.5rem] font-black hover:shadow-2xl transition-all flex items-center justify-center gap-3 text-sm uppercase tracking-widest active:scale-95 shadow-xl",children:[n.jsx(lo,{className:"w-4 h-4"}),"Upload Report"]})]})]})}const $f=[{id:"water",label:"Drink 8 glasses of water",icon:""},{id:"workout",label:"Workout/Yoga (30 mins)",icon:""},{id:"nutrition",label:"Healthy Nutrition (within goal)",icon:""},{id:"sleep",label:"Sleep 7-8 hours",icon:""}];function Kle(){const[a,o]=ee.useState(()=>{const R=localStorage.getItem("challenge30DaysCurrentDay");return R?parseInt(R):1}),[c,d]=ee.useState({}),[h,p]=ee.useState(0),[g,x]=ee.useState(!0);ee.useEffect(()=>{window.scrollTo(0,0),v()},[]),ee.useEffect(()=>{localStorage.setItem("challenge30DaysCurrentDay",a)},[a]);const v=async()=>{const R=localStorage.getItem("challenge30Days"),k=localStorage.getItem("challenge30DaysStreak");if(R)try{const M=JSON.parse(R);d(M),p(parseInt(k)||0)}catch(M){console.error("Error parsing saved data:",M)}try{const M=await Ft.get("/health/challenge"),P=M.data.challengeData||{},H={};P&&typeof P=="object"&&Object.keys(P).forEach($=>{H[$]=P[$]}),d(H),p(M.data.streakDays||0),localStorage.setItem("challenge30Days",JSON.stringify(H)),localStorage.setItem("challenge30DaysStreak",M.data.streakDays||0)}catch(M){console.error("Failed to load challenge data from server:",M)}finally{x(!1)}},E=async R=>{let k=0;const M=Object.keys(R).map(Number).sort((P,H)=>H-P);for(const P of M){const H=R[P];if(Object.values(H).filter(Boolean).length>=$f.length)k++;else break}p(k),localStorage.setItem("challenge30Days",JSON.stringify(R)),localStorage.setItem("challenge30DaysStreak",k);try{const P=await Ft.post("/health/challenge",{challengeData:R});P.data.streakDays!==k&&(p(P.data.streakDays),localStorage.setItem("challenge30DaysStreak",P.data.streakDays))}catch(P){console.error("Failed to save challenge data to server:",P)}},C=(R,k)=>{var H;const M={...c,[R]:{...c[R],[k]:!((H=c[R])!=null&&H[k])}};d(M),E(M),Object.values(M[R]).filter(Boolean).length===$f.length&&St.success(" Amazing! You completed all tasks for today!")},I=R=>{const k=c[R]||{};return Object.values(k).filter(Boolean).length/$f.length*100},O=()=>{let R=0;for(let k=1;k<=30;k++){const M=c[k]||{};Object.values(M).filter(Boolean).length>=$f.length&&R++}return R};return n.jsx("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:g?n.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-slate-600",children:"Loading your challenge..."})]})}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-[#E2D5FF] rounded-[2.5rem] p-6 shadow-xl relative overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsx("button",{onClick:()=>o(Math.max(1,a-1)),className:"w-10 h-10 rounded-full bg-white/50 flex items-center justify-center text-slate-700 hover:bg-white transition-colors",children:n.jsx(Vn,{className:"w-5 h-5"})}),n.jsx("div",{className:"text-center",children:n.jsxs("h2",{className:"text-xl font-bold text-indigo-900",children:[a===1?"Today, ":`Day ${a}, `,new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})]})}),n.jsx("button",{onClick:()=>o(Math.min(30,a+1)),className:"w-10 h-10 rounded-full bg-white/50 flex items-center justify-center text-slate-700 hover:bg-white transition-colors rotate-180",children:n.jsx(Vn,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex justify-between items-end gap-2 overflow-x-auto pb-4 scrollbar-hide",children:(()=>{const R=["Sa","Su","Mo","Tu","We","Th","Fr"],k=Math.max(1,a-3);return Array.from({length:7},(P,H)=>{const $=k+H;return $>30?null:$}).filter(Boolean).map(P=>{const H=I(P),$=P===a,re=R[(P-1)%7];return n.jsxs("div",{className:"flex flex-col items-center gap-3 min-w-[50px]",children:[n.jsx("span",{className:`text-sm font-semibold ${$?"text-indigo-800":"text-slate-500"}`,children:re}),n.jsxs("button",{onClick:()=>o(P),className:`w-14 h-14 rounded-full flex items-center justify-center relative transition-all ${$?"bg-white shadow-xl scale-110":"bg-white/30 hover:bg-white/50"}`,children:[n.jsxs("svg",{className:"absolute inset-0 w-full h-full -rotate-90",viewBox:"0 0 56 56",children:[n.jsx("circle",{cx:"28",cy:"28",r:"25",fill:"none",stroke:$?"#EEF2FF":"rgba(255,255,255,0.2)",strokeWidth:"3"}),n.jsx("circle",{cx:"28",cy:"28",r:"25",fill:"none",stroke:"#818CF8",strokeWidth:"3",strokeDasharray:`${H/100*157} 157`,strokeLinecap:"round",className:"transition-all duration-700 ease-out"})]}),$?n.jsx(ul,{className:"w-6 h-6 text-orange-500 relative z-10 fill-orange-500"}):n.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-200/50"})]}),n.jsx("span",{className:`text-xs font-bold ${$?"text-indigo-800":"text-slate-500"}`,children:P})]},P)})})()})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-white rounded-[2rem] p-5 shadow-md border border-slate-100 flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-orange-100 flex items-center justify-center",children:n.jsx(ul,{className:"w-6 h-6 text-orange-500"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-black text-slate-800",children:h}),n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Day Streak"})]})]}),n.jsxs("div",{className:"bg-white rounded-[2rem] p-5 shadow-md border border-slate-100 flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-100 flex items-center justify-center",children:n.jsx(KT,{className:"w-6 h-6 text-indigo-500"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-black text-slate-800",children:O()}),n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Days Done"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-xl font-bold text-slate-800",children:["Day ",a," Tasks"]}),n.jsxs("p",{className:"text-slate-500 text-sm",children:[Object.values(c[a]||{}).filter(Boolean).length," of ",$f.length," completed"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("div",{className:"text-2xl font-bold text-cyan-600",children:[I(a).toFixed(0),"%"]}),n.jsx("div",{className:"text-xs text-slate-500",children:"Progress"})]})]}),n.jsx("div",{className:"w-full bg-slate-100 rounded-full h-3 mb-6",children:n.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-purple-500 to-orange-500 transition-all duration-500",style:{width:`${I(a)}%`}})}),n.jsx("div",{className:"space-y-3",children:$f.map(R=>{var M;const k=(M=c[a])==null?void 0:M[R.id];return n.jsxs("button",{onClick:()=>C(a,R.id),className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${k?"bg-emerald-50 border-emerald-200 hover:bg-emerald-100":"bg-white border-slate-200 hover:bg-slate-50"}`,children:[n.jsx("div",{className:"text-3xl",children:R.icon}),n.jsx("div",{className:"flex-1 text-left",children:n.jsx("p",{className:`font-medium ${k?"text-emerald-700 line-through":"text-slate-800"}`,children:R.label})}),n.jsx("div",{children:k?n.jsx(Tn,{className:"w-6 h-6 text-emerald-500"}):n.jsx(lne,{className:"w-6 h-6 text-slate-300"})})]},R.id)})})]}),n.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx(JR,{className:"w-6 h-6"}),n.jsx("h3",{className:"text-lg font-semibold",children:"Achievements"})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[n.jsxs("div",{className:`p-3 rounded-xl text-center ${h>=3?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"3 Day Streak"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${h>=7?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"1 Week Streak"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${O()>=15?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"Half Way"})]}),n.jsxs("div",{className:`p-3 rounded-xl text-center ${O()>=30?"bg-white/20":"bg-white/10 opacity-50"}`,children:[n.jsx("div",{className:"text-2xl mb-1",children:""}),n.jsx("p",{className:"text-xs font-medium",children:"Champion"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:" Tips for Success"}),n.jsxs("ul",{className:"space-y-2 text-slate-600",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Complete all 4 tasks daily to maintain your streak"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Set reminders on your phone for each task"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Start with easier tasks and gradually increase difficulty"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-cyan-500 mt-1",children:""}),n.jsx("span",{children:"Share your progress with friends for accountability"})]})]})]})]})})}function Wle(){var R,k,M;const{user:a}=da(),[o,c]=ee.useState("HbA1c"),[d,h]=ee.useState([]),[p,g]=ee.useState(5.8),[x,v]=ee.useState(108);ee.useEffect(()=>{const P=localStorage.getItem("glucose_readings");if(P)h(JSON.parse(P));else{const H=[{id:1,type:"Fasting",value:98,time:"Today  08:00 AM",status:"optimal",date:new Date().toISOString()},{id:2,type:"Post-Meal",value:142,time:"Today  01:30 PM",status:"monitor",date:new Date().toISOString()},{id:3,type:"HbA1c",value:5.8,time:"Feb 15  Last Lab",status:"target",date:"2026-02-15"}];h(H),localStorage.setItem("glucose_readings",JSON.stringify(H))}},[]);const E=[{day:"Tue",value:105},{day:"Wed",value:110},{day:"Thu",value:115},{day:"Fri",value:108},{day:"Sat",value:102},{day:"Sun",value:108}],C=P=>{switch(P){case"optimal":return"text-green-600 bg-green-100";case"monitor":return"text-orange-600 bg-orange-100";case"target":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},I=P=>{switch(P){case"optimal":return"OPTIMAL";case"monitor":return"MONITOR";case"target":return"TARGET";default:return"NORMAL"}},O=P=>{switch(P){case"Fasting":return"bg-green-100 text-green-600";case"Post-Meal":return"bg-orange-100 text-orange-600";case"HbA1c":return"bg-red-100 text-red-600";default:return"bg-gray-100 text-gray-600"}};return n.jsx("div",{className:"min-h-screen bg-gray-50 pb-20",children:n.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[n.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-orange-600 flex items-center justify-center text-white text-sm font-bold shadow-md flex-shrink-0",children:((k=(R=a==null?void 0:a.name)==null?void 0:R[0])==null?void 0:k.toUpperCase())||"U"}),n.jsxs("h1",{className:"text-sm font-bold text-slate-800 truncate",children:[(()=>{const P=new Date().getHours();return P<12?"Good Morning":P<18?"Good Afternoon":"Good Evening"})(),", ",((M=a==null?void 0:a.name)==null?void 0:M.split(" ")[0])||"there","!"]})]}),n.jsx("button",{className:"w-9 h-9 rounded-full bg-white shadow-md flex items-center justify-center hover:shadow-lg transition-all flex-shrink-0",children:n.jsx(dh,{className:"w-4 h-4 text-slate-700"})})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-900",children:"Diabetes Care"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Glycemic Control & Trends"})]}),n.jsx("button",{className:"w-12 h-12 md:w-14 md:h-14 rounded-2xl bg-blue-600 text-white flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all",children:n.jsx(Zo,{className:"w-6 h-6 md:w-7 md:h-7"})})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:n.jsx(qi,{className:"w-5 h-5 text-blue-600"})}),n.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"WEEKLY PROGRESS"})]}),n.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg text-sm font-medium text-slate-700",children:[o,n.jsx(uh,{className:"w-4 h-4"})]})]}),n.jsx("div",{className:"relative h-48 mb-4",children:n.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"chartGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[n.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.3"}),n.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0"})]})}),n.jsx("path",{d:"M 0 40 Q 16.67 35 33.33 30 T 66.67 45 T 100 40 L 100 100 L 0 100 Z",fill:"url(#chartGradient)"}),n.jsx("path",{d:"M 0 40 Q 16.67 35 33.33 30 T 66.67 45 T 100 40",fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeLinecap:"round"})]})}),n.jsx("div",{className:"grid grid-cols-6 gap-2 text-center text-xs text-slate-500",children:E.map((P,H)=>n.jsx("div",{children:P.day},H))})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-5 text-white shadow-xl",children:[n.jsx("p",{className:"text-slate-400 text-xs uppercase tracking-wide mb-2",children:"CURRENT HBA1C"}),n.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[n.jsx("span",{className:"text-4xl font-bold",children:p}),n.jsx("span",{className:"text-green-400 text-lg",children:"%"})]}),n.jsx("div",{className:"w-full h-2 bg-slate-700 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-gradient-to-r from-purple-400 to-orange-400 rounded-full",style:{width:"60%"}})}),n.jsx("p",{className:"text-xs text-cyan-400 mt-2 uppercase tracking-wide",children:"Target Range"})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg border-2 border-slate-200",children:[n.jsx("p",{className:"text-slate-600 text-xs uppercase tracking-wide mb-2",children:"DAILY AVG"}),n.jsxs("div",{className:"flex items-baseline gap-2 mb-3",children:[n.jsx("span",{className:"text-4xl font-bold text-slate-900",children:x}),n.jsx("span",{className:"text-slate-500 text-sm",children:"mg/dL"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(br,{className:"w-4 h-4 text-blue-600"}),n.jsx("span",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Stable Baseline"})]})]})]}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"RECENT ACTIVITY"}),n.jsx(Hs,{to:"/diabetes/history",className:"text-sm text-blue-600 font-semibold hover:underline",children:"View All"})]}),n.jsx("div",{className:"space-y-3",children:d.map(P=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-2xl hover:bg-gray-100 transition-all",children:[n.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[n.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${O(P.type)}`,children:n.jsx(YR,{className:"w-6 h-6"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"font-bold text-slate-900",children:[P.type," Reading"]}),n.jsx("p",{className:"text-sm text-slate-500",children:P.time})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-2xl font-bold text-slate-900",children:[P.value,n.jsx("span",{className:"text-sm text-slate-500 ml-1",children:P.type==="HbA1c"?"%":"MG/DL"})]}),n.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-semibold uppercase ${C(P.status)}`,children:I(P.status)})]})]},P.id))})]}),n.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-orange-50 rounded-3xl p-6 border-2 border-blue-200",children:n.jsxs("div",{className:"flex items-start gap-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center flex-shrink-0",children:n.jsx(qd,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-2",children:"SMART FORECAST"}),n.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:"Your post-meal glucose has increased by 4% compared to last week. Consider tracking fiber intake to stabilize spikes."})]})]})}),n.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-900 mb-4",children:"Quick Tips"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Test fasting glucose before breakfast for accurate baseline readings"})]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Check post-meal levels 2 hours after eating to monitor spikes"})]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Li,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-sm text-slate-700",children:"Aim for HbA1c below 7% for optimal diabetes management"})]})]})]})]})})}function SH({vital:a,onClose:o}){const[c,d]=ee.useState("overview"),[h,p]=ee.useState(null),[g,x]=ee.useState(!0);if(!a)return console.error("VitalDetailsPopup: vital prop is null or undefined"),null;const{name:v="Unknown Metric",value:E="N/A",unit:C="",normalRange:I="N/A",status:O="normal",description:R="",recommendations:k=[],foodsToConsume:M=[],foodsToAvoid:P=[],symptoms:H=[],severity:$=""}=a||{};ee.useEffect(()=>{v&&v!=="Unknown Metric"?(async()=>{try{x(!0),console.log(" Fetching AI info for vital:",v);const Y=await sd.getMetricInfo({metricName:v,metricValue:E,normalRange:I,unit:C});Y.data&&Y.data.metricInfo&&(console.log(" Received AI info for vital:",v),p(Y.data.metricInfo.en))}catch(Y){console.error(" Error fetching AI info:",Y)}finally{x(!1)}})():x(!1)},[v,E,I,C]);const J=(ce=>{if(!ce)return{min:0,max:100};const Y=ce.split("-").map(z=>parseFloat(z.trim()));return{min:Y[0],max:Y[1]}})(I),ge=parseFloat(E),ie=()=>ge<J.min?0:ge>J.max?100:(ge-J.min)/(J.max-J.min)*100,Ae=O==="normal"?{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-700",badge:"bg-emerald-100"}:O==="borderline"?{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700",badge:"bg-amber-100"}:{bg:"bg-red-50",border:"border-red-200",text:"text-red-700",badge:"bg-red-100"},V=ie();return n.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",onClick:ce=>{ce.target===ce.currentTarget&&o()},children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:ce=>ce.stopPropagation(),children:[n.jsxs("div",{className:`${Ae.bg} border-b-2 ${Ae.border} p-6 flex items-center justify-between sticky top-0 z-10`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:`w-12 h-12 rounded-xl ${Ae.badge} flex items-center justify-center`,children:[O==="normal"&&n.jsx(Tn,{className:`w-6 h-6 ${Ae.text}`}),O==="borderline"&&n.jsx(Li,{className:`w-6 h-6 ${Ae.text}`}),O==="high"&&n.jsx(qi,{className:`w-6 h-6 ${Ae.text}`})]}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:v}),n.jsx("p",{className:`text-sm ${Ae.text} font-medium capitalize`,children:O})]})]}),n.jsx("button",{onClick:o,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:n.jsx(Gn,{className:"w-6 h-6 text-slate-600"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[n.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Your Value"}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[E," ",n.jsx("span",{className:"text-sm text-slate-500",children:C})]})]}),n.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[n.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Normal Range"}),n.jsx("p",{className:"text-2xl font-bold text-blue-700",children:I})]}),n.jsxs("div",{className:`${Ae.bg} rounded-xl p-4 border-2 ${Ae.border}`,children:[n.jsx("p",{className:`text-xs ${Ae.text} font-medium mb-1`,children:"Status"}),n.jsx("p",{className:`text-2xl font-bold ${Ae.text} capitalize`,children:O})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Range Indicator"}),n.jsxs("div",{className:"relative h-12 bg-gradient-to-r from-purple-200 via-pink-200 to-orange-200 rounded-xl overflow-hidden border-2 border-slate-200",children:[n.jsx("div",{className:"absolute top-0 bottom-0 bg-white/40 border-l-2 border-r-2 border-blue-500",style:{left:`${J.min/(J.max*1.2)*100}%`,right:`${100-J.max/(J.max*1.2)*100}%`}}),n.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-full bg-slate-800 border-2 border-white shadow-lg",style:{left:`${V}%`},children:n.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 left-0 w-8 h-8 bg-slate-800 rounded-full border-4 border-white shadow-lg"})})]}),n.jsxs("div",{className:"flex justify-between text-xs text-slate-600 font-medium",children:[n.jsx("span",{children:"Low"}),n.jsx("span",{children:"Normal"}),n.jsx("span",{children:"High"})]})]})]}),n.jsx("div",{className:"flex gap-2 border-b border-slate-200",children:[{id:"overview",label:"Overview"},{id:"recommendations",label:"What to Do"},{id:"foods",label:"Foods & Diet"}].map(ce=>n.jsx("button",{onClick:()=>d(ce.id),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${c===ce.id?"border-cyan-500 text-cyan-600":"border-transparent text-slate-600 hover:text-slate-800"}`,children:ce.label},ce.id))}),n.jsxs("div",{className:"space-y-4",children:[c==="overview"&&n.jsx("div",{className:"space-y-4",children:g?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Loading AI insights..."})]}):n.jsxs(n.Fragment,{children:[((h==null?void 0:h.whatIsIt)||R)&&n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[n.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[n.jsx(qd,{className:"w-4 h-4"}),"What is ",v,"?"]}),n.jsx("p",{className:"text-sm text-blue-900 leading-relaxed",children:(h==null?void 0:h.whatIsIt)||R||`${v} is a health metric that helps monitor your overall health.`})]}),n.jsxs("div",{className:`p-4 rounded-xl border-2 ${Ae.border} ${Ae.bg}`,children:[n.jsxs("h3",{className:`font-semibold ${Ae.text} mb-2 flex items-center gap-2`,children:[n.jsx(qd,{className:"w-4 h-4"}),"What This Means"]}),n.jsxs("p",{className:`text-sm ${Ae.text}`,children:[O==="normal"&&"Your value is within the normal range. Keep maintaining your current lifestyle and habits.",O==="borderline"&&"Your value is slightly outside the normal range. Consider making lifestyle adjustments and monitor regularly.",O==="high"&&"Your value is significantly outside the normal range. Consult with a healthcare provider and make necessary changes.",O==="low"&&"Your value is below the normal range. Consult with a healthcare provider for guidance."]})]}),(h==null?void 0:h.whenLowEffects)&&h.whenLowEffects.length>0&&n.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-200",children:[n.jsxs("h3",{className:"font-semibold text-amber-900 mb-3 flex items-center gap-2",children:[n.jsx(ah,{className:"w-4 h-4"}),h.whenLowTitle||"When Low"]}),n.jsx("ul",{className:"space-y-2",children:h.whenLowEffects.map((ce,Y)=>n.jsxs("li",{className:"text-sm text-amber-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-600 rounded-full mt-1.5 flex-shrink-0"}),ce]},Y))})]}),(h==null?void 0:h.whenHighEffects)&&h.whenHighEffects.length>0&&n.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[n.jsxs("h3",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[n.jsx(qi,{className:"w-4 h-4"}),h.whenHighTitle||"When High"]}),n.jsx("ul",{className:"space-y-2",children:h.whenHighEffects.map((ce,Y)=>n.jsxs("li",{className:"text-sm text-red-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-red-600 rounded-full mt-1.5 flex-shrink-0"}),ce]},Y))})]}),!h&&H&&Array.isArray(H)&&H.length>0&&n.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-200",children:[n.jsxs("h3",{className:"font-semibold text-amber-900 mb-3 flex items-center gap-2",children:[n.jsx(Li,{className:"w-4 h-4"}),"Associated Symptoms"]}),n.jsx("ul",{className:"space-y-2",children:H.map((ce,Y)=>n.jsxs("li",{className:"text-sm text-amber-800 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-600 rounded-full mt-1.5 flex-shrink-0"}),ce]},Y))})]})]})}),c==="recommendations"&&n.jsx("div",{className:"space-y-4",children:g?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-3"}),n.jsx("p",{className:"text-slate-500 text-sm",children:"Loading recommendations..."})]}):n.jsxs(n.Fragment,{children:[h!=null&&h.solutions&&h.solutions.length>0?n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(Tn,{className:"w-4 h-4"}),"How to Improve"]}),n.jsx("ul",{className:"space-y-3",children:h.solutions.map((ce,Y)=>n.jsxs("li",{className:"text-sm text-emerald-800 flex items-start gap-3 p-3 bg-white rounded-lg",children:[n.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",children:Y+1}),n.jsx("span",{children:ce})]},Y))})]}):k&&Array.isArray(k)&&k.length>0?n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(Tn,{className:"w-4 h-4"}),"Recommendations"]}),n.jsx("ul",{className:"space-y-3",children:k.map((ce,Y)=>n.jsxs("li",{className:"text-sm text-emerald-800 flex items-start gap-3 p-3 bg-white rounded-lg",children:[n.jsx("span",{className:"w-6 h-6 bg-emerald-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0",children:Y+1}),n.jsx("span",{children:ce})]},Y))})]}):n.jsxs("div",{className:"text-center py-8 text-slate-500",children:[n.jsx(qd,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),n.jsx("p",{children:"Consult with a healthcare professional for personalized recommendations."})]}),n.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[n.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"General Tips"}),n.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Monitor this value regularly"]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Maintain a healthy lifestyle"]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Consult a healthcare provider if concerned"]})]})]})]})}),c==="foods"&&n.jsxs("div",{className:"space-y-4",children:[M&&Array.isArray(M)&&M.length>0&&n.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[n.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[n.jsx(Tn,{className:"w-4 h-4"}),"Foods to Consume"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:M.map((ce,Y)=>n.jsx("span",{className:"px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium",children:ce},Y))})]}),P&&Array.isArray(P)&&P.length>0&&n.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[n.jsxs("h3",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[n.jsx(Li,{className:"w-4 h-4"}),"Foods to Avoid"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((ce,Y)=>n.jsx("span",{className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:ce},Y))})]}),(!M||!Array.isArray(M)||M.length===0)&&(!P||!Array.isArray(P)||P.length===0)&&n.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:n.jsx("p",{className:"text-sm text-slate-600",children:"No specific dietary recommendations available."})})]})]}),$&&n.jsx("div",{className:`p-4 rounded-xl border-2 ${$==="severe"?"bg-red-50 border-red-200":$==="moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:n.jsxs("p",{className:`text-sm font-medium ${$==="severe"?"text-red-700":$==="moderate"?"text-amber-700":"text-yellow-700"}`,children:[n.jsx("strong",{children:"Severity:"})," ",$.charAt(0).toUpperCase()+$.slice(1)]})})]}),n.jsx("div",{className:"border-t border-slate-200 p-6 bg-slate-50",children:n.jsx("p",{className:"text-xs text-slate-600 text-center",children:"This information is for educational purposes only. Always consult with a healthcare provider for medical advice."})})]})})}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hR=function(a,o){return hR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(c[h]=d[h])},hR(a,o)};function id(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");hR(a,o);function c(){this.constructor=a}a.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}var pR=function(){return pR=Object.assign||function(o){for(var c,d=1,h=arguments.length;d<h;d++){c=arguments[d];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(o[p]=c[p])}return o},pR.apply(this,arguments)};function No(a,o,c,d){function h(p){return p instanceof c?p:new c(function(g){g(p)})}return new(c||(c=Promise))(function(p,g){function x(C){try{E(d.next(C))}catch(I){g(I)}}function v(C){try{E(d.throw(C))}catch(I){g(I)}}function E(C){C.done?p(C.value):h(C.value).then(x,v)}E((d=d.apply(a,[])).next())})}function ao(a,o){var c={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},d,h,p,g;return g={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function x(E){return function(C){return v([E,C])}}function v(E){if(d)throw new TypeError("Generator is already executing.");for(;c;)try{if(d=1,h&&(p=E[0]&2?h.return:E[0]?h.throw||((p=h.return)&&p.call(h),0):h.next)&&!(p=p.call(h,E[1])).done)return p;switch(h=0,p&&(E=[E[0]&2,p.value]),E[0]){case 0:case 1:p=E;break;case 4:return c.label++,{value:E[1],done:!1};case 5:c.label++,h=E[1],E=[0];continue;case 7:E=c.ops.pop(),c.trys.pop();continue;default:if(p=c.trys,!(p=p.length>0&&p[p.length-1])&&(E[0]===6||E[0]===2)){c=0;continue}if(E[0]===3&&(!p||E[1]>p[0]&&E[1]<p[3])){c.label=E[1];break}if(E[0]===6&&c.label<p[1]){c.label=p[1],p=E;break}if(p&&c.label<p[2]){c.label=p[2],c.ops.push(E);break}p[2]&&c.ops.pop(),c.trys.pop();continue}E=o.call(a,c)}catch(C){E=[6,C],h=0}finally{d=p=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function M_(a,o,c){if(arguments.length===2)for(var d=0,h=o.length,p;d<h;d++)(p||!(d in o))&&(p||(p=Array.prototype.slice.call(o,0,d)),p[d]=o[d]);return a.concat(p||o)}var YA=function(){function a(o,c,d,h){this.left=o,this.top=c,this.width=d,this.height=h}return a.prototype.add=function(o,c,d,h){return new a(this.left+o,this.top+c,this.width+d,this.height+h)},a.fromClientRect=function(o,c){return new a(c.left+o.windowBounds.left,c.top+o.windowBounds.top,c.width,c.height)},a.fromDOMRectList=function(o,c){var d=Array.from(c).find(function(h){return h.width!==0});return d?new a(d.left+o.windowBounds.left,d.top+o.windowBounds.top,d.width,d.height):a.EMPTY},a.EMPTY=new a(0,0,0,0),a}(),fE=function(a,o){return YA.fromClientRect(a,o.getBoundingClientRect())},zle=function(a){var o=a.body,c=a.documentElement;if(!o||!c)throw new Error("Unable to get document size");var d=Math.max(Math.max(o.scrollWidth,c.scrollWidth),Math.max(o.offsetWidth,c.offsetWidth),Math.max(o.clientWidth,c.clientWidth)),h=Math.max(Math.max(o.scrollHeight,c.scrollHeight),Math.max(o.offsetHeight,c.offsetHeight),Math.max(o.clientHeight,c.clientHeight));return new YA(0,0,d,h)},gE=function(a){for(var o=[],c=0,d=a.length;c<d;){var h=a.charCodeAt(c++);if(h>=55296&&h<=56319&&c<d){var p=a.charCodeAt(c++);(p&64512)===56320?o.push(((h&1023)<<10)+(p&1023)+65536):(o.push(h),c--)}else o.push(h)}return o},Gi=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if(String.fromCodePoint)return String.fromCodePoint.apply(String,a);var c=a.length;if(!c)return"";for(var d=[],h=-1,p="";++h<c;){var g=a[h];g<=65535?d.push(g):(g-=65536,d.push((g>>10)+55296,g%1024+56320)),(h+1===c||d.length>16384)&&(p+=String.fromCharCode.apply(String,d),d.length=0)}return p},j6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qle=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var V_=0;V_<j6.length;V_++)qle[j6.charCodeAt(V_)]=V_;var P6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ub=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Q_=0;Q_<P6.length;Q_++)Ub[P6.charCodeAt(Q_)]=Q_;var Yle=function(a){var o=a.length*.75,c=a.length,d,h=0,p,g,x,v;a[a.length-1]==="="&&(o--,a[a.length-2]==="="&&o--);var E=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(o):new Array(o),C=Array.isArray(E)?E:new Uint8Array(E);for(d=0;d<c;d+=4)p=Ub[a.charCodeAt(d)],g=Ub[a.charCodeAt(d+1)],x=Ub[a.charCodeAt(d+2)],v=Ub[a.charCodeAt(d+3)],C[h++]=p<<2|g>>4,C[h++]=(g&15)<<4|x>>2,C[h++]=(x&3)<<6|v&63;return E},Xle=function(a){for(var o=a.length,c=[],d=0;d<o;d+=2)c.push(a[d+1]<<8|a[d]);return c},Jle=function(a){for(var o=a.length,c=[],d=0;d<o;d+=4)c.push(a[d+3]<<24|a[d+2]<<16|a[d+1]<<8|a[d]);return c},Jp=5,oI=11,eT=2,$le=oI-Jp,NH=65536>>Jp,Zle=1<<Jp,tT=Zle-1,ede=1024>>Jp,tde=NH+ede,sde=tde,rde=32,nde=sde+rde,ide=65536>>oI,ade=1<<$le,ode=ade-1,U6=function(a,o,c){return a.slice?a.slice(o,c):new Uint16Array(Array.prototype.slice.call(a,o,c))},cde=function(a,o,c){return a.slice?a.slice(o,c):new Uint32Array(Array.prototype.slice.call(a,o,c))},lde=function(a,o){var c=Yle(a),d=Array.isArray(c)?Jle(c):new Uint32Array(c),h=Array.isArray(c)?Xle(c):new Uint16Array(c),p=24,g=U6(h,p/2,d[4]/2),x=d[5]===2?U6(h,(p+d[4])/2):cde(d,Math.ceil((p+d[4])/4));return new dde(d[0],d[1],d[2],d[3],g,x)},dde=function(){function a(o,c,d,h,p,g){this.initialValue=o,this.errorValue=c,this.highStart=d,this.highValueIndex=h,this.index=p,this.data=g}return a.prototype.get=function(o){var c;if(o>=0){if(o<55296||o>56319&&o<=65535)return c=this.index[o>>Jp],c=(c<<eT)+(o&tT),this.data[c];if(o<=65535)return c=this.index[NH+(o-55296>>Jp)],c=(c<<eT)+(o&tT),this.data[c];if(o<this.highStart)return c=nde-ide+(o>>oI),c=this.index[c],c+=o>>Jp&ode,c=this.index[c],c=(c<<eT)+(o&tT),this.data[c];if(o<=1114111)return this.data[this.highValueIndex]}return this.errorValue},a}(),F6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ade=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var H_=0;H_<F6.length;H_++)Ade[F6.charCodeAt(H_)]=H_;var ude="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",M6=50,hde=1,TH=2,RH=3,pde=4,mde=5,V6=7,IH=8,Q6=9,sh=10,mR=11,H6=12,fR=13,fde=14,Fb=15,gR=16,G_=17,Ob=18,gde=19,G6=20,bR=21,kb=22,sT=23,Zf=24,Nc=25,Mb=26,Vb=27,eg=28,bde=29,Hp=30,xde=31,K_=32,W_=33,xR=34,vR=35,wR=36,sx=37,_R=38,yy=39,Ey=40,rT=41,OH=42,vde=43,wde=[9001,65288],kH="!",Qr="",z_="",yR=lde(ude),UA=[Hp,wR],ER=[hde,TH,RH,mde],DH=[sh,IH],K6=[Vb,Mb],_de=ER.concat(DH),W6=[_R,yy,Ey,xR,vR],yde=[Fb,fR],Ede=function(a,o){o===void 0&&(o="strict");var c=[],d=[],h=[];return a.forEach(function(p,g){var x=yR.get(p);if(x>M6?(h.push(!0),x-=M6):h.push(!1),["normal","auto","loose"].indexOf(o)!==-1&&[8208,8211,12316,12448].indexOf(p)!==-1)return d.push(g),c.push(gR);if(x===pde||x===mR){if(g===0)return d.push(g),c.push(Hp);var v=c[g-1];return _de.indexOf(v)===-1?(d.push(d[g-1]),c.push(v)):(d.push(g),c.push(Hp))}if(d.push(g),x===xde)return c.push(o==="strict"?bR:sx);if(x===OH||x===bde)return c.push(Hp);if(x===vde)return p>=131072&&p<=196605||p>=196608&&p<=262141?c.push(sx):c.push(Hp);c.push(x)}),[d,c,h]},nT=function(a,o,c,d){var h=d[c];if(Array.isArray(a)?a.indexOf(h)!==-1:a===h)for(var p=c;p<=d.length;){p++;var g=d[p];if(g===o)return!0;if(g!==sh)break}if(h===sh)for(var p=c;p>0;){p--;var x=d[p];if(Array.isArray(a)?a.indexOf(x)!==-1:a===x)for(var v=c;v<=d.length;){v++;var g=d[v];if(g===o)return!0;if(g!==sh)break}if(x!==sh)break}return!1},z6=function(a,o){for(var c=a;c>=0;){var d=o[c];if(d===sh)c--;else return d}return 0},Cde=function(a,o,c,d,h){if(c[d]===0)return Qr;var p=d-1;if(Array.isArray(h)&&h[p]===!0)return Qr;var g=p-1,x=p+1,v=o[p],E=g>=0?o[g]:0,C=o[x];if(v===TH&&C===RH)return Qr;if(ER.indexOf(v)!==-1)return kH;if(ER.indexOf(C)!==-1||DH.indexOf(C)!==-1)return Qr;if(z6(p,o)===IH)return z_;if(yR.get(a[p])===mR||(v===K_||v===W_)&&yR.get(a[x])===mR||v===V6||C===V6||v===Q6||[sh,fR,Fb].indexOf(v)===-1&&C===Q6||[G_,Ob,gde,Zf,eg].indexOf(C)!==-1||z6(p,o)===kb||nT(sT,kb,p,o)||nT([G_,Ob],bR,p,o)||nT(H6,H6,p,o))return Qr;if(v===sh)return z_;if(v===sT||C===sT)return Qr;if(C===gR||v===gR)return z_;if([fR,Fb,bR].indexOf(C)!==-1||v===fde||E===wR&&yde.indexOf(v)!==-1||v===eg&&C===wR||C===G6||UA.indexOf(C)!==-1&&v===Nc||UA.indexOf(v)!==-1&&C===Nc||v===Vb&&[sx,K_,W_].indexOf(C)!==-1||[sx,K_,W_].indexOf(v)!==-1&&C===Mb||UA.indexOf(v)!==-1&&K6.indexOf(C)!==-1||K6.indexOf(v)!==-1&&UA.indexOf(C)!==-1||[Vb,Mb].indexOf(v)!==-1&&(C===Nc||[kb,Fb].indexOf(C)!==-1&&o[x+1]===Nc)||[kb,Fb].indexOf(v)!==-1&&C===Nc||v===Nc&&[Nc,eg,Zf].indexOf(C)!==-1)return Qr;if([Nc,eg,Zf,G_,Ob].indexOf(C)!==-1)for(var I=p;I>=0;){var O=o[I];if(O===Nc)return Qr;if([eg,Zf].indexOf(O)!==-1)I--;else break}if([Vb,Mb].indexOf(C)!==-1)for(var I=[G_,Ob].indexOf(v)!==-1?g:p;I>=0;){var O=o[I];if(O===Nc)return Qr;if([eg,Zf].indexOf(O)!==-1)I--;else break}if(_R===v&&[_R,yy,xR,vR].indexOf(C)!==-1||[yy,xR].indexOf(v)!==-1&&[yy,Ey].indexOf(C)!==-1||[Ey,vR].indexOf(v)!==-1&&C===Ey||W6.indexOf(v)!==-1&&[G6,Mb].indexOf(C)!==-1||W6.indexOf(C)!==-1&&v===Vb||UA.indexOf(v)!==-1&&UA.indexOf(C)!==-1||v===Zf&&UA.indexOf(C)!==-1||UA.concat(Nc).indexOf(v)!==-1&&C===kb&&wde.indexOf(a[x])===-1||UA.concat(Nc).indexOf(C)!==-1&&v===Ob)return Qr;if(v===rT&&C===rT){for(var R=c[p],k=1;R>0&&(R--,o[R]===rT);)k++;if(k%2!==0)return Qr}return v===K_&&C===W_?Qr:z_},Sde=function(a,o){o||(o={lineBreak:"normal",wordBreak:"normal"});var c=Ede(a,o.lineBreak),d=c[0],h=c[1],p=c[2];(o.wordBreak==="break-all"||o.wordBreak==="break-word")&&(h=h.map(function(x){return[Nc,Hp,OH].indexOf(x)!==-1?sx:x}));var g=o.wordBreak==="keep-all"?p.map(function(x,v){return x&&a[v]>=19968&&a[v]<=40959}):void 0;return[d,h,g]},Nde=function(){function a(o,c,d,h){this.codePoints=o,this.required=c===kH,this.start=d,this.end=h}return a.prototype.slice=function(){return Gi.apply(void 0,this.codePoints.slice(this.start,this.end))},a}(),Tde=function(a,o){var c=gE(a),d=Sde(c,o),h=d[0],p=d[1],g=d[2],x=c.length,v=0,E=0;return{next:function(){if(E>=x)return{done:!0,value:null};for(var C=Qr;E<x&&(C=Cde(c,p,h,++E,g))===Qr;);if(C!==Qr||E===x){var I=new Nde(c,C,v,E);return v=E,{value:I,done:!1}}return{done:!0,value:null}}}},Rde=1,Ide=2,mx=4,q6=8,Hy=10,Y6=47,Wb=92,Ode=9,kde=32,q_=34,Db=61,Dde=35,Bde=36,Lde=37,Y_=39,X_=40,Bb=41,jde=95,Jo=45,Pde=33,Ude=60,Fde=62,Mde=64,Vde=91,Qde=93,Hde=61,Gde=123,J_=63,Kde=125,X6=124,Wde=126,zde=128,J6=65533,iT=42,Wp=43,qde=44,Yde=58,Xde=59,rx=46,Jde=0,$de=8,Zde=11,eAe=14,tAe=31,sAe=127,Kd=-1,BH=48,LH=97,jH=101,rAe=102,nAe=117,iAe=122,PH=65,UH=69,FH=70,aAe=85,oAe=90,oo=function(a){return a>=BH&&a<=57},cAe=function(a){return a>=55296&&a<=57343},tg=function(a){return oo(a)||a>=PH&&a<=FH||a>=LH&&a<=rAe},lAe=function(a){return a>=LH&&a<=iAe},dAe=function(a){return a>=PH&&a<=oAe},AAe=function(a){return lAe(a)||dAe(a)},uAe=function(a){return a>=zde},$_=function(a){return a===Hy||a===Ode||a===kde},Gy=function(a){return AAe(a)||uAe(a)||a===jde},$6=function(a){return Gy(a)||oo(a)||a===Jo},hAe=function(a){return a>=Jde&&a<=$de||a===Zde||a>=eAe&&a<=tAe||a===sAe},$u=function(a,o){return a!==Wb?!1:o!==Hy},Z_=function(a,o,c){return a===Jo?Gy(o)||$u(o,c):Gy(a)?!0:!!(a===Wb&&$u(a,o))},aT=function(a,o,c){return a===Wp||a===Jo?oo(o)?!0:o===rx&&oo(c):oo(a===rx?o:a)},pAe=function(a){var o=0,c=1;(a[o]===Wp||a[o]===Jo)&&(a[o]===Jo&&(c=-1),o++);for(var d=[];oo(a[o]);)d.push(a[o++]);var h=d.length?parseInt(Gi.apply(void 0,d),10):0;a[o]===rx&&o++;for(var p=[];oo(a[o]);)p.push(a[o++]);var g=p.length,x=g?parseInt(Gi.apply(void 0,p),10):0;(a[o]===UH||a[o]===jH)&&o++;var v=1;(a[o]===Wp||a[o]===Jo)&&(a[o]===Jo&&(v=-1),o++);for(var E=[];oo(a[o]);)E.push(a[o++]);var C=E.length?parseInt(Gi.apply(void 0,E),10):0;return c*(h+x*Math.pow(10,-g))*Math.pow(10,v*C)},mAe={type:2},fAe={type:3},gAe={type:4},bAe={type:13},xAe={type:8},vAe={type:21},wAe={type:9},_Ae={type:10},yAe={type:11},EAe={type:12},CAe={type:14},ey={type:23},SAe={type:1},NAe={type:25},TAe={type:24},RAe={type:26},IAe={type:27},OAe={type:28},kAe={type:29},DAe={type:31},CR={type:32},MH=function(){function a(){this._value=[]}return a.prototype.write=function(o){this._value=this._value.concat(gE(o))},a.prototype.read=function(){for(var o=[],c=this.consumeToken();c!==CR;)o.push(c),c=this.consumeToken();return o},a.prototype.consumeToken=function(){var o=this.consumeCodePoint();switch(o){case q_:return this.consumeStringToken(q_);case Dde:var c=this.peekCodePoint(0),d=this.peekCodePoint(1),h=this.peekCodePoint(2);if($6(c)||$u(d,h)){var p=Z_(c,d,h)?Ide:Rde,g=this.consumeName();return{type:5,value:g,flags:p}}break;case Bde:if(this.peekCodePoint(0)===Db)return this.consumeCodePoint(),bAe;break;case Y_:return this.consumeStringToken(Y_);case X_:return mAe;case Bb:return fAe;case iT:if(this.peekCodePoint(0)===Db)return this.consumeCodePoint(),CAe;break;case Wp:if(aT(o,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(o),this.consumeNumericToken();break;case qde:return gAe;case Jo:var x=o,v=this.peekCodePoint(0),E=this.peekCodePoint(1);if(aT(x,v,E))return this.reconsumeCodePoint(o),this.consumeNumericToken();if(Z_(x,v,E))return this.reconsumeCodePoint(o),this.consumeIdentLikeToken();if(v===Jo&&E===Fde)return this.consumeCodePoint(),this.consumeCodePoint(),TAe;break;case rx:if(aT(o,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(o),this.consumeNumericToken();break;case Y6:if(this.peekCodePoint(0)===iT)for(this.consumeCodePoint();;){var C=this.consumeCodePoint();if(C===iT&&(C=this.consumeCodePoint(),C===Y6))return this.consumeToken();if(C===Kd)return this.consumeToken()}break;case Yde:return RAe;case Xde:return IAe;case Ude:if(this.peekCodePoint(0)===Pde&&this.peekCodePoint(1)===Jo&&this.peekCodePoint(2)===Jo)return this.consumeCodePoint(),this.consumeCodePoint(),NAe;break;case Mde:var I=this.peekCodePoint(0),O=this.peekCodePoint(1),R=this.peekCodePoint(2);if(Z_(I,O,R)){var g=this.consumeName();return{type:7,value:g}}break;case Vde:return OAe;case Wb:if($u(o,this.peekCodePoint(0)))return this.reconsumeCodePoint(o),this.consumeIdentLikeToken();break;case Qde:return kAe;case Hde:if(this.peekCodePoint(0)===Db)return this.consumeCodePoint(),xAe;break;case Gde:return yAe;case Kde:return EAe;case nAe:case aAe:var k=this.peekCodePoint(0),M=this.peekCodePoint(1);return k===Wp&&(tg(M)||M===J_)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(o),this.consumeIdentLikeToken();case X6:if(this.peekCodePoint(0)===Db)return this.consumeCodePoint(),wAe;if(this.peekCodePoint(0)===X6)return this.consumeCodePoint(),vAe;break;case Wde:if(this.peekCodePoint(0)===Db)return this.consumeCodePoint(),_Ae;break;case Kd:return CR}return $_(o)?(this.consumeWhiteSpace(),DAe):oo(o)?(this.reconsumeCodePoint(o),this.consumeNumericToken()):Gy(o)?(this.reconsumeCodePoint(o),this.consumeIdentLikeToken()):{type:6,value:Gi(o)}},a.prototype.consumeCodePoint=function(){var o=this._value.shift();return typeof o>"u"?-1:o},a.prototype.reconsumeCodePoint=function(o){this._value.unshift(o)},a.prototype.peekCodePoint=function(o){return o>=this._value.length?-1:this._value[o]},a.prototype.consumeUnicodeRangeToken=function(){for(var o=[],c=this.consumeCodePoint();tg(c)&&o.length<6;)o.push(c),c=this.consumeCodePoint();for(var d=!1;c===J_&&o.length<6;)o.push(c),c=this.consumeCodePoint(),d=!0;if(d){var h=parseInt(Gi.apply(void 0,o.map(function(v){return v===J_?BH:v})),16),p=parseInt(Gi.apply(void 0,o.map(function(v){return v===J_?FH:v})),16);return{type:30,start:h,end:p}}var g=parseInt(Gi.apply(void 0,o),16);if(this.peekCodePoint(0)===Jo&&tg(this.peekCodePoint(1))){this.consumeCodePoint(),c=this.consumeCodePoint();for(var x=[];tg(c)&&x.length<6;)x.push(c),c=this.consumeCodePoint();var p=parseInt(Gi.apply(void 0,x),16);return{type:30,start:g,end:p}}else return{type:30,start:g,end:g}},a.prototype.consumeIdentLikeToken=function(){var o=this.consumeName();return o.toLowerCase()==="url"&&this.peekCodePoint(0)===X_?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===X_?(this.consumeCodePoint(),{type:19,value:o}):{type:20,value:o}},a.prototype.consumeUrlToken=function(){var o=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Kd)return{type:22,value:""};var c=this.peekCodePoint(0);if(c===Y_||c===q_){var d=this.consumeStringToken(this.consumeCodePoint());return d.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Kd||this.peekCodePoint(0)===Bb)?(this.consumeCodePoint(),{type:22,value:d.value}):(this.consumeBadUrlRemnants(),ey)}for(;;){var h=this.consumeCodePoint();if(h===Kd||h===Bb)return{type:22,value:Gi.apply(void 0,o)};if($_(h))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Kd||this.peekCodePoint(0)===Bb?(this.consumeCodePoint(),{type:22,value:Gi.apply(void 0,o)}):(this.consumeBadUrlRemnants(),ey);if(h===q_||h===Y_||h===X_||hAe(h))return this.consumeBadUrlRemnants(),ey;if(h===Wb)if($u(h,this.peekCodePoint(0)))o.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),ey;else o.push(h)}},a.prototype.consumeWhiteSpace=function(){for(;$_(this.peekCodePoint(0));)this.consumeCodePoint()},a.prototype.consumeBadUrlRemnants=function(){for(;;){var o=this.consumeCodePoint();if(o===Bb||o===Kd)return;$u(o,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},a.prototype.consumeStringSlice=function(o){for(var c=5e4,d="";o>0;){var h=Math.min(c,o);d+=Gi.apply(void 0,this._value.splice(0,h)),o-=h}return this._value.shift(),d},a.prototype.consumeStringToken=function(o){var c="",d=0;do{var h=this._value[d];if(h===Kd||h===void 0||h===o)return c+=this.consumeStringSlice(d),{type:0,value:c};if(h===Hy)return this._value.splice(0,d),SAe;if(h===Wb){var p=this._value[d+1];p!==Kd&&p!==void 0&&(p===Hy?(c+=this.consumeStringSlice(d),d=-1,this._value.shift()):$u(h,p)&&(c+=this.consumeStringSlice(d),c+=Gi(this.consumeEscapedCodePoint()),d=-1))}d++}while(!0)},a.prototype.consumeNumber=function(){var o=[],c=mx,d=this.peekCodePoint(0);for((d===Wp||d===Jo)&&o.push(this.consumeCodePoint());oo(this.peekCodePoint(0));)o.push(this.consumeCodePoint());d=this.peekCodePoint(0);var h=this.peekCodePoint(1);if(d===rx&&oo(h))for(o.push(this.consumeCodePoint(),this.consumeCodePoint()),c=q6;oo(this.peekCodePoint(0));)o.push(this.consumeCodePoint());d=this.peekCodePoint(0),h=this.peekCodePoint(1);var p=this.peekCodePoint(2);if((d===UH||d===jH)&&((h===Wp||h===Jo)&&oo(p)||oo(h)))for(o.push(this.consumeCodePoint(),this.consumeCodePoint()),c=q6;oo(this.peekCodePoint(0));)o.push(this.consumeCodePoint());return[pAe(o),c]},a.prototype.consumeNumericToken=function(){var o=this.consumeNumber(),c=o[0],d=o[1],h=this.peekCodePoint(0),p=this.peekCodePoint(1),g=this.peekCodePoint(2);if(Z_(h,p,g)){var x=this.consumeName();return{type:15,number:c,flags:d,unit:x}}return h===Lde?(this.consumeCodePoint(),{type:16,number:c,flags:d}):{type:17,number:c,flags:d}},a.prototype.consumeEscapedCodePoint=function(){var o=this.consumeCodePoint();if(tg(o)){for(var c=Gi(o);tg(this.peekCodePoint(0))&&c.length<6;)c+=Gi(this.consumeCodePoint());$_(this.peekCodePoint(0))&&this.consumeCodePoint();var d=parseInt(c,16);return d===0||cAe(d)||d>1114111?J6:d}return o===Kd?J6:o},a.prototype.consumeName=function(){for(var o="";;){var c=this.consumeCodePoint();if($6(c))o+=Gi(c);else if($u(c,this.peekCodePoint(0)))o+=Gi(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(c),o}},a}(),VH=function(){function a(o){this._tokens=o}return a.create=function(o){var c=new MH;return c.write(o),new a(c.read())},a.parseValue=function(o){return a.create(o).parseComponentValue()},a.parseValues=function(o){return a.create(o).parseComponentValues()},a.prototype.parseComponentValue=function(){for(var o=this.consumeToken();o.type===31;)o=this.consumeToken();if(o.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(o);var c=this.consumeComponentValue();do o=this.consumeToken();while(o.type===31);if(o.type===32)return c;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},a.prototype.parseComponentValues=function(){for(var o=[];;){var c=this.consumeComponentValue();if(c.type===32)return o;o.push(c),o.push()}},a.prototype.consumeComponentValue=function(){var o=this.consumeToken();switch(o.type){case 11:case 28:case 2:return this.consumeSimpleBlock(o.type);case 19:return this.consumeFunction(o)}return o},a.prototype.consumeSimpleBlock=function(o){for(var c={type:o,values:[]},d=this.consumeToken();;){if(d.type===32||LAe(d,o))return c;this.reconsumeToken(d),c.values.push(this.consumeComponentValue()),d=this.consumeToken()}},a.prototype.consumeFunction=function(o){for(var c={name:o.value,values:[],type:18};;){var d=this.consumeToken();if(d.type===32||d.type===3)return c;this.reconsumeToken(d),c.values.push(this.consumeComponentValue())}},a.prototype.consumeToken=function(){var o=this._tokens.shift();return typeof o>"u"?CR:o},a.prototype.reconsumeToken=function(o){this._tokens.unshift(o)},a}(),fx=function(a){return a.type===15},Pg=function(a){return a.type===17},Rn=function(a){return a.type===20},BAe=function(a){return a.type===0},SR=function(a,o){return Rn(a)&&a.value===o},QH=function(a){return a.type!==31},Rg=function(a){return a.type!==31&&a.type!==4},$d=function(a){var o=[],c=[];return a.forEach(function(d){if(d.type===4){if(c.length===0)throw new Error("Error parsing function args, zero tokens for arg");o.push(c),c=[];return}d.type!==31&&c.push(d)}),c.length&&o.push(c),o},LAe=function(a,o){return o===11&&a.type===12||o===28&&a.type===29?!0:o===2&&a.type===3},hh=function(a){return a.type===17||a.type===15},Zi=function(a){return a.type===16||hh(a)},HH=function(a){return a.length>1?[a[0],a[1]]:[a[0]]},Qa={type:17,number:0,flags:mx},cI={type:16,number:50,flags:mx},rh={type:16,number:100,flags:mx},Qb=function(a,o,c){var d=a[0],h=a[1];return[Qn(d,o),Qn(typeof h<"u"?h:d,c)]},Qn=function(a,o){if(a.type===16)return a.number/100*o;if(fx(a))switch(a.unit){case"rem":case"em":return 16*a.number;case"px":default:return a.number}return a.number},GH="deg",KH="grad",WH="rad",zH="turn",bE={name:"angle",parse:function(a,o){if(o.type===15)switch(o.unit){case GH:return Math.PI*o.number/180;case KH:return Math.PI/200*o.number;case WH:return o.number;case zH:return Math.PI*2*o.number}throw new Error("Unsupported angle type")}},qH=function(a){return a.type===15&&(a.unit===GH||a.unit===KH||a.unit===WH||a.unit===zH)},YH=function(a){var o=a.filter(Rn).map(function(c){return c.value}).join(" ");switch(o){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Qa,Qa];case"to top":case"bottom":return hl(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Qa,rh];case"to right":case"left":return hl(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[rh,rh];case"to bottom":case"top":return hl(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[rh,Qa];case"to left":case"right":return hl(270)}return 0},hl=function(a){return Math.PI*a/180},oh={name:"color",parse:function(a,o){if(o.type===18){var c=jAe[o.name];if(typeof c>"u")throw new Error('Attempting to parse an unsupported color function "'+o.name+'"');return c(a,o.values)}if(o.type===5){if(o.value.length===3){var d=o.value.substring(0,1),h=o.value.substring(1,2),p=o.value.substring(2,3);return nh(parseInt(d+d,16),parseInt(h+h,16),parseInt(p+p,16),1)}if(o.value.length===4){var d=o.value.substring(0,1),h=o.value.substring(1,2),p=o.value.substring(2,3),g=o.value.substring(3,4);return nh(parseInt(d+d,16),parseInt(h+h,16),parseInt(p+p,16),parseInt(g+g,16)/255)}if(o.value.length===6){var d=o.value.substring(0,2),h=o.value.substring(2,4),p=o.value.substring(4,6);return nh(parseInt(d,16),parseInt(h,16),parseInt(p,16),1)}if(o.value.length===8){var d=o.value.substring(0,2),h=o.value.substring(2,4),p=o.value.substring(4,6),g=o.value.substring(6,8);return nh(parseInt(d,16),parseInt(h,16),parseInt(p,16),parseInt(g,16)/255)}}if(o.type===20){var x=WA[o.value.toUpperCase()];if(typeof x<"u")return x}return WA.TRANSPARENT}},ch=function(a){return(255&a)===0},ya=function(a){var o=255&a,c=255&a>>8,d=255&a>>16,h=255&a>>24;return o<255?"rgba("+h+","+d+","+c+","+o/255+")":"rgb("+h+","+d+","+c+")"},nh=function(a,o,c,d){return(a<<24|o<<16|c<<8|Math.round(d*255)<<0)>>>0},Z6=function(a,o){if(a.type===17)return a.number;if(a.type===16){var c=o===3?1:255;return o===3?a.number/100*c:Math.round(a.number/100*c)}return 0},e8=function(a,o){var c=o.filter(Rg);if(c.length===3){var d=c.map(Z6),h=d[0],p=d[1],g=d[2];return nh(h,p,g,1)}if(c.length===4){var x=c.map(Z6),h=x[0],p=x[1],g=x[2],v=x[3];return nh(h,p,g,v)}return 0};function oT(a,o,c){return c<0&&(c+=1),c>=1&&(c-=1),c<1/6?(o-a)*c*6+a:c<1/2?o:c<2/3?(o-a)*6*(2/3-c)+a:a}var t8=function(a,o){var c=o.filter(Rg),d=c[0],h=c[1],p=c[2],g=c[3],x=(d.type===17?hl(d.number):bE.parse(a,d))/(Math.PI*2),v=Zi(h)?h.number/100:0,E=Zi(p)?p.number/100:0,C=typeof g<"u"&&Zi(g)?Qn(g,1):1;if(v===0)return nh(E*255,E*255,E*255,1);var I=E<=.5?E*(v+1):E+v-E*v,O=E*2-I,R=oT(O,I,x+1/3),k=oT(O,I,x),M=oT(O,I,x-1/3);return nh(R*255,k*255,M*255,C)},jAe={hsl:t8,hsla:t8,rgb:e8,rgba:e8},zb=function(a,o){return oh.parse(a,VH.create(o).parseComponentValue())},WA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},PAe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(a,o){return o.map(function(c){if(Rn(c))switch(c.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},UAe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},xE=function(a,o){var c=oh.parse(a,o[0]),d=o[1];return d&&Zi(d)?{color:c,stop:d}:{color:c,stop:null}},s8=function(a,o){var c=a[0],d=a[a.length-1];c.stop===null&&(c.stop=Qa),d.stop===null&&(d.stop=rh);for(var h=[],p=0,g=0;g<a.length;g++){var x=a[g].stop;if(x!==null){var v=Qn(x,o);v>p?h.push(v):h.push(p),p=v}else h.push(null)}for(var E=null,g=0;g<h.length;g++){var C=h[g];if(C===null)E===null&&(E=g);else if(E!==null){for(var I=g-E,O=h[E-1],R=(C-O)/(I+1),k=1;k<=I;k++)h[E+k-1]=R*k;E=null}}return a.map(function(M,P){var H=M.color;return{color:H,stop:Math.max(Math.min(1,h[P]/o),0)}})},FAe=function(a,o,c){var d=o/2,h=c/2,p=Qn(a[0],o)-d,g=h-Qn(a[1],c);return(Math.atan2(g,p)+Math.PI*2)%(Math.PI*2)},MAe=function(a,o,c){var d=typeof a=="number"?a:FAe(a,o,c),h=Math.abs(o*Math.sin(d))+Math.abs(c*Math.cos(d)),p=o/2,g=c/2,x=h/2,v=Math.sin(d-Math.PI/2)*x,E=Math.cos(d-Math.PI/2)*x;return[h,p-E,p+E,g-v,g+v]},ed=function(a,o){return Math.sqrt(a*a+o*o)},r8=function(a,o,c,d,h){var p=[[0,0],[0,o],[a,0],[a,o]];return p.reduce(function(g,x){var v=x[0],E=x[1],C=ed(c-v,d-E);return(h?C<g.optimumDistance:C>g.optimumDistance)?{optimumCorner:x,optimumDistance:C}:g},{optimumDistance:h?1/0:-1/0,optimumCorner:null}).optimumCorner},VAe=function(a,o,c,d,h){var p=0,g=0;switch(a.size){case 0:a.shape===0?p=g=Math.min(Math.abs(o),Math.abs(o-d),Math.abs(c),Math.abs(c-h)):a.shape===1&&(p=Math.min(Math.abs(o),Math.abs(o-d)),g=Math.min(Math.abs(c),Math.abs(c-h)));break;case 2:if(a.shape===0)p=g=Math.min(ed(o,c),ed(o,c-h),ed(o-d,c),ed(o-d,c-h));else if(a.shape===1){var x=Math.min(Math.abs(c),Math.abs(c-h))/Math.min(Math.abs(o),Math.abs(o-d)),v=r8(d,h,o,c,!0),E=v[0],C=v[1];p=ed(E-o,(C-c)/x),g=x*p}break;case 1:a.shape===0?p=g=Math.max(Math.abs(o),Math.abs(o-d),Math.abs(c),Math.abs(c-h)):a.shape===1&&(p=Math.max(Math.abs(o),Math.abs(o-d)),g=Math.max(Math.abs(c),Math.abs(c-h)));break;case 3:if(a.shape===0)p=g=Math.max(ed(o,c),ed(o,c-h),ed(o-d,c),ed(o-d,c-h));else if(a.shape===1){var x=Math.max(Math.abs(c),Math.abs(c-h))/Math.max(Math.abs(o),Math.abs(o-d)),I=r8(d,h,o,c,!1),E=I[0],C=I[1];p=ed(E-o,(C-c)/x),g=x*p}break}return Array.isArray(a.size)&&(p=Qn(a.size[0],d),g=a.size.length===2?Qn(a.size[1],h):p),[p,g]},QAe=function(a,o){var c=hl(180),d=[];return $d(o).forEach(function(h,p){if(p===0){var g=h[0];if(g.type===20&&g.value==="to"){c=YH(h);return}else if(qH(g)){c=bE.parse(a,g);return}}var x=xE(a,h);d.push(x)}),{angle:c,stops:d,type:1}},ty=function(a,o){var c=hl(180),d=[];return $d(o).forEach(function(h,p){if(p===0){var g=h[0];if(g.type===20&&["top","left","right","bottom"].indexOf(g.value)!==-1){c=YH(h);return}else if(qH(g)){c=(bE.parse(a,g)+hl(270))%hl(360);return}}var x=xE(a,h);d.push(x)}),{angle:c,stops:d,type:1}},HAe=function(a,o){var c=hl(180),d=[],h=1,p=0,g=3,x=[];return $d(o).forEach(function(v,E){var C=v[0];if(E===0){if(Rn(C)&&C.value==="linear"){h=1;return}else if(Rn(C)&&C.value==="radial"){h=2;return}}if(C.type===18){if(C.name==="from"){var I=oh.parse(a,C.values[0]);d.push({stop:Qa,color:I})}else if(C.name==="to"){var I=oh.parse(a,C.values[0]);d.push({stop:rh,color:I})}else if(C.name==="color-stop"){var O=C.values.filter(Rg);if(O.length===2){var I=oh.parse(a,O[1]),R=O[0];Pg(R)&&d.push({stop:{type:16,number:R.number*100,flags:R.flags},color:I})}}}}),h===1?{angle:(c+hl(180))%hl(360),stops:d,type:h}:{size:g,shape:p,stops:d,position:x,type:h}},XH="closest-side",JH="farthest-side",$H="closest-corner",ZH="farthest-corner",e7="circle",t7="ellipse",s7="cover",r7="contain",GAe=function(a,o){var c=0,d=3,h=[],p=[];return $d(o).forEach(function(g,x){var v=!0;if(x===0){var E=!1;v=g.reduce(function(I,O){if(E)if(Rn(O))switch(O.value){case"center":return p.push(cI),I;case"top":case"left":return p.push(Qa),I;case"right":case"bottom":return p.push(rh),I}else(Zi(O)||hh(O))&&p.push(O);else if(Rn(O))switch(O.value){case e7:return c=0,!1;case t7:return c=1,!1;case"at":return E=!0,!1;case XH:return d=0,!1;case s7:case JH:return d=1,!1;case r7:case $H:return d=2,!1;case ZH:return d=3,!1}else if(hh(O)||Zi(O))return Array.isArray(d)||(d=[]),d.push(O),!1;return I},v)}if(v){var C=xE(a,g);h.push(C)}}),{size:d,shape:c,stops:h,position:p,type:2}},sy=function(a,o){var c=0,d=3,h=[],p=[];return $d(o).forEach(function(g,x){var v=!0;if(x===0?v=g.reduce(function(C,I){if(Rn(I))switch(I.value){case"center":return p.push(cI),!1;case"top":case"left":return p.push(Qa),!1;case"right":case"bottom":return p.push(rh),!1}else if(Zi(I)||hh(I))return p.push(I),!1;return C},v):x===1&&(v=g.reduce(function(C,I){if(Rn(I))switch(I.value){case e7:return c=0,!1;case t7:return c=1,!1;case r7:case XH:return d=0,!1;case JH:return d=1,!1;case $H:return d=2,!1;case s7:case ZH:return d=3,!1}else if(hh(I)||Zi(I))return Array.isArray(d)||(d=[]),d.push(I),!1;return C},v)),v){var E=xE(a,g);h.push(E)}}),{size:d,shape:c,stops:h,position:p,type:2}},KAe=function(a){return a.type===1},WAe=function(a){return a.type===2},lI={name:"image",parse:function(a,o){if(o.type===22){var c={url:o.value,type:0};return a.cache.addImage(o.value),c}if(o.type===18){var d=n7[o.name];if(typeof d>"u")throw new Error('Attempting to parse an unsupported image function "'+o.name+'"');return d(a,o.values)}throw new Error("Unsupported image type "+o.type)}};function zAe(a){return!(a.type===20&&a.value==="none")&&(a.type!==18||!!n7[a.name])}var n7={"linear-gradient":QAe,"-moz-linear-gradient":ty,"-ms-linear-gradient":ty,"-o-linear-gradient":ty,"-webkit-linear-gradient":ty,"radial-gradient":GAe,"-moz-radial-gradient":sy,"-ms-radial-gradient":sy,"-o-radial-gradient":sy,"-webkit-radial-gradient":sy,"-webkit-gradient":HAe},qAe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(a,o){if(o.length===0)return[];var c=o[0];return c.type===20&&c.value==="none"?[]:o.filter(function(d){return Rg(d)&&zAe(d)}).map(function(d){return lI.parse(a,d)})}},YAe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(a,o){return o.map(function(c){if(Rn(c))switch(c.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},XAe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(a,o){return $d(o).map(function(c){return c.filter(Zi)}).map(HH)}},JAe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(a,o){return $d(o).map(function(c){return c.filter(Rn).map(function(d){return d.value}).join(" ")}).map($Ae)}},$Ae=function(a){switch(a){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},bg;(function(a){a.AUTO="auto",a.CONTAIN="contain",a.COVER="cover"})(bg||(bg={}));var ZAe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(a,o){return $d(o).map(function(c){return c.filter(eue)})}},eue=function(a){return Rn(a)||Zi(a)},vE=function(a){return{name:"border-"+a+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},tue=vE("top"),sue=vE("right"),rue=vE("bottom"),nue=vE("left"),wE=function(a){return{name:"border-radius-"+a,initialValue:"0 0",prefix:!1,type:1,parse:function(o,c){return HH(c.filter(Zi))}}},iue=wE("top-left"),aue=wE("top-right"),oue=wE("bottom-right"),cue=wE("bottom-left"),_E=function(a){return{name:"border-"+a+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(o,c){switch(c){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},lue=_E("top"),due=_E("right"),Aue=_E("bottom"),uue=_E("left"),yE=function(a){return{name:"border-"+a+"-width",initialValue:"0",type:0,prefix:!1,parse:function(o,c){return fx(c)?c.number:0}}},hue=yE("top"),pue=yE("right"),mue=yE("bottom"),fue=yE("left"),gue={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},bue={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(a,o){switch(o){case"rtl":return 1;case"ltr":default:return 0}}},xue={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(a,o){return o.filter(Rn).reduce(function(c,d){return c|vue(d.value)},0)}},vue=function(a){switch(a){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},wue={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},_ue={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(a,o){return o.type===20&&o.value==="normal"?0:o.type===17||o.type===15?o.number:0}},Ky;(function(a){a.NORMAL="normal",a.STRICT="strict"})(Ky||(Ky={}));var yue={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"strict":return Ky.STRICT;case"normal":default:return Ky.NORMAL}}},Eue={name:"line-height",initialValue:"normal",prefix:!1,type:4},n8=function(a,o){return Rn(a)&&a.value==="normal"?1.2*o:a.type===17?o*a.number:Zi(a)?Qn(a,o):o},Cue={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(a,o){return o.type===20&&o.value==="none"?null:lI.parse(a,o)}},Sue={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(a,o){switch(o){case"inside":return 0;case"outside":default:return 1}}},NR={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},EE=function(a){return{name:"margin-"+a,initialValue:"0",prefix:!1,type:4}},Nue=EE("top"),Tue=EE("right"),Rue=EE("bottom"),Iue=EE("left"),Oue={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(a,o){return o.filter(Rn).map(function(c){switch(c.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},kue={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"break-word":return"break-word";case"normal":default:return"normal"}}},CE=function(a){return{name:"padding-"+a,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Due=CE("top"),Bue=CE("right"),Lue=CE("bottom"),jue=CE("left"),Pue={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(a,o){switch(o){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Uue={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(a,o){switch(o){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Fue={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.length===1&&SR(o[0],"none")?[]:$d(o).map(function(c){for(var d={color:WA.TRANSPARENT,offsetX:Qa,offsetY:Qa,blur:Qa},h=0,p=0;p<c.length;p++){var g=c[p];hh(g)?(h===0?d.offsetX=g:h===1?d.offsetY=g:d.blur=g,h++):d.color=oh.parse(a,g)}return d})}},Mue={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Vue={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(a,o){if(o.type===20&&o.value==="none")return null;if(o.type===18){var c=Gue[o.name];if(typeof c>"u")throw new Error('Attempting to parse an unsupported transform function "'+o.name+'"');return c(o.values)}return null}},Que=function(a){var o=a.filter(function(c){return c.type===17}).map(function(c){return c.number});return o.length===6?o:null},Hue=function(a){var o=a.filter(function(v){return v.type===17}).map(function(v){return v.number}),c=o[0],d=o[1];o[2],o[3];var h=o[4],p=o[5];o[6],o[7],o[8],o[9],o[10],o[11];var g=o[12],x=o[13];return o[14],o[15],o.length===16?[c,d,h,p,g,x]:null},Gue={matrix:Que,matrix3d:Hue},i8={type:16,number:50,flags:mx},Kue=[i8,i8],Wue={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(a,o){var c=o.filter(Zi);return c.length!==2?Kue:[c[0],c[1]]}},zue={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(a,o){switch(o){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},qb;(function(a){a.NORMAL="normal",a.BREAK_ALL="break-all",a.KEEP_ALL="keep-all"})(qb||(qb={}));var que={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"break-all":return qb.BREAK_ALL;case"keep-all":return qb.KEEP_ALL;case"normal":default:return qb.NORMAL}}},Yue={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(a,o){if(o.type===20)return{auto:!0,order:0};if(Pg(o))return{auto:!1,order:o.number};throw new Error("Invalid z-index number parsed")}},i7={name:"time",parse:function(a,o){if(o.type===15)switch(o.unit.toLowerCase()){case"s":return 1e3*o.number;case"ms":return o.number}throw new Error("Unsupported time type")}},Xue={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(a,o){return Pg(o)?o.number:1}},Jue={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},$ue={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(a,o){return o.filter(Rn).map(function(c){switch(c.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(c){return c!==0})}},Zue={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(a,o){var c=[],d=[];return o.forEach(function(h){switch(h.type){case 20:case 0:c.push(h.value);break;case 17:c.push(h.number.toString());break;case 4:d.push(c.join(" ")),c.length=0;break}}),c.length&&d.push(c.join(" ")),d.map(function(h){return h.indexOf(" ")===-1?h:"'"+h+"'"})}},ehe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},the={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(a,o){if(Pg(o))return o.number;if(Rn(o))switch(o.value){case"bold":return 700;case"normal":default:return 400}return 400}},she={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.filter(Rn).map(function(c){return c.value})}},rhe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(a,o){switch(o){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},la=function(a,o){return(a&o)!==0},nhe={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(a,o){if(o.length===0)return[];var c=o[0];return c.type===20&&c.value==="none"?[]:o}},ihe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return null;var c=o[0];if(c.type===20&&c.value==="none")return null;for(var d=[],h=o.filter(QH),p=0;p<h.length;p++){var g=h[p],x=h[p+1];if(g.type===20){var v=x&&Pg(x)?x.number:1;d.push({counter:g.value,increment:v})}}return d}},ahe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return[];for(var c=[],d=o.filter(QH),h=0;h<d.length;h++){var p=d[h],g=d[h+1];if(Rn(p)&&p.value!=="none"){var x=g&&Pg(g)?g.number:0;c.push({counter:p.value,reset:x})}}return c}},ohe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(a,o){return o.filter(fx).map(function(c){return i7.parse(a,c)})}},che={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(a,o){if(o.length===0)return null;var c=o[0];if(c.type===20&&c.value==="none")return null;var d=[],h=o.filter(BAe);if(h.length%2!==0)return null;for(var p=0;p<h.length;p+=2){var g=h[p].value,x=h[p+1].value;d.push({open:g,close:x})}return d}},a8=function(a,o,c){if(!a)return"";var d=a[Math.min(o,a.length-1)];return d?c?d.open:d.close:""},lhe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(a,o){return o.length===1&&SR(o[0],"none")?[]:$d(o).map(function(c){for(var d={color:255,offsetX:Qa,offsetY:Qa,blur:Qa,spread:Qa,inset:!1},h=0,p=0;p<c.length;p++){var g=c[p];SR(g,"inset")?d.inset=!0:hh(g)?(h===0?d.offsetX=g:h===1?d.offsetY=g:h===2?d.blur=g:d.spread=g,h++):d.color=oh.parse(a,g)}return d})}},dhe={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(a,o){var c=[0,1,2],d=[];return o.filter(Rn).forEach(function(h){switch(h.value){case"stroke":d.push(1);break;case"fill":d.push(0);break;case"markers":d.push(2);break}}),c.forEach(function(h){d.indexOf(h)===-1&&d.push(h)}),d}},Ahe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},uhe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(a,o){return fx(o)?o.number:0}},hhe=function(){function a(o,c){var d,h;this.animationDuration=xs(o,ohe,c.animationDuration),this.backgroundClip=xs(o,PAe,c.backgroundClip),this.backgroundColor=xs(o,UAe,c.backgroundColor),this.backgroundImage=xs(o,qAe,c.backgroundImage),this.backgroundOrigin=xs(o,YAe,c.backgroundOrigin),this.backgroundPosition=xs(o,XAe,c.backgroundPosition),this.backgroundRepeat=xs(o,JAe,c.backgroundRepeat),this.backgroundSize=xs(o,ZAe,c.backgroundSize),this.borderTopColor=xs(o,tue,c.borderTopColor),this.borderRightColor=xs(o,sue,c.borderRightColor),this.borderBottomColor=xs(o,rue,c.borderBottomColor),this.borderLeftColor=xs(o,nue,c.borderLeftColor),this.borderTopLeftRadius=xs(o,iue,c.borderTopLeftRadius),this.borderTopRightRadius=xs(o,aue,c.borderTopRightRadius),this.borderBottomRightRadius=xs(o,oue,c.borderBottomRightRadius),this.borderBottomLeftRadius=xs(o,cue,c.borderBottomLeftRadius),this.borderTopStyle=xs(o,lue,c.borderTopStyle),this.borderRightStyle=xs(o,due,c.borderRightStyle),this.borderBottomStyle=xs(o,Aue,c.borderBottomStyle),this.borderLeftStyle=xs(o,uue,c.borderLeftStyle),this.borderTopWidth=xs(o,hue,c.borderTopWidth),this.borderRightWidth=xs(o,pue,c.borderRightWidth),this.borderBottomWidth=xs(o,mue,c.borderBottomWidth),this.borderLeftWidth=xs(o,fue,c.borderLeftWidth),this.boxShadow=xs(o,lhe,c.boxShadow),this.color=xs(o,gue,c.color),this.direction=xs(o,bue,c.direction),this.display=xs(o,xue,c.display),this.float=xs(o,wue,c.cssFloat),this.fontFamily=xs(o,Zue,c.fontFamily),this.fontSize=xs(o,ehe,c.fontSize),this.fontStyle=xs(o,rhe,c.fontStyle),this.fontVariant=xs(o,she,c.fontVariant),this.fontWeight=xs(o,the,c.fontWeight),this.letterSpacing=xs(o,_ue,c.letterSpacing),this.lineBreak=xs(o,yue,c.lineBreak),this.lineHeight=xs(o,Eue,c.lineHeight),this.listStyleImage=xs(o,Cue,c.listStyleImage),this.listStylePosition=xs(o,Sue,c.listStylePosition),this.listStyleType=xs(o,NR,c.listStyleType),this.marginTop=xs(o,Nue,c.marginTop),this.marginRight=xs(o,Tue,c.marginRight),this.marginBottom=xs(o,Rue,c.marginBottom),this.marginLeft=xs(o,Iue,c.marginLeft),this.opacity=xs(o,Xue,c.opacity);var p=xs(o,Oue,c.overflow);this.overflowX=p[0],this.overflowY=p[p.length>1?1:0],this.overflowWrap=xs(o,kue,c.overflowWrap),this.paddingTop=xs(o,Due,c.paddingTop),this.paddingRight=xs(o,Bue,c.paddingRight),this.paddingBottom=xs(o,Lue,c.paddingBottom),this.paddingLeft=xs(o,jue,c.paddingLeft),this.paintOrder=xs(o,dhe,c.paintOrder),this.position=xs(o,Uue,c.position),this.textAlign=xs(o,Pue,c.textAlign),this.textDecorationColor=xs(o,Jue,(d=c.textDecorationColor)!==null&&d!==void 0?d:c.color),this.textDecorationLine=xs(o,$ue,(h=c.textDecorationLine)!==null&&h!==void 0?h:c.textDecoration),this.textShadow=xs(o,Fue,c.textShadow),this.textTransform=xs(o,Mue,c.textTransform),this.transform=xs(o,Vue,c.transform),this.transformOrigin=xs(o,Wue,c.transformOrigin),this.visibility=xs(o,zue,c.visibility),this.webkitTextStrokeColor=xs(o,Ahe,c.webkitTextStrokeColor),this.webkitTextStrokeWidth=xs(o,uhe,c.webkitTextStrokeWidth),this.wordBreak=xs(o,que,c.wordBreak),this.zIndex=xs(o,Yue,c.zIndex)}return a.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},a.prototype.isTransparent=function(){return ch(this.backgroundColor)},a.prototype.isTransformed=function(){return this.transform!==null},a.prototype.isPositioned=function(){return this.position!==0},a.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},a.prototype.isFloating=function(){return this.float!==0},a.prototype.isInlineLevel=function(){return la(this.display,4)||la(this.display,33554432)||la(this.display,268435456)||la(this.display,536870912)||la(this.display,67108864)||la(this.display,134217728)},a}(),phe=function(){function a(o,c){this.content=xs(o,nhe,c.content),this.quotes=xs(o,che,c.quotes)}return a}(),o8=function(){function a(o,c){this.counterIncrement=xs(o,ihe,c.counterIncrement),this.counterReset=xs(o,ahe,c.counterReset)}return a}(),xs=function(a,o,c){var d=new MH,h=c!==null&&typeof c<"u"?c.toString():o.initialValue;d.write(h);var p=new VH(d.read());switch(o.type){case 2:var g=p.parseComponentValue();return o.parse(a,Rn(g)?g.value:o.initialValue);case 0:return o.parse(a,p.parseComponentValue());case 1:return o.parse(a,p.parseComponentValues());case 4:return p.parseComponentValue();case 3:switch(o.format){case"angle":return bE.parse(a,p.parseComponentValue());case"color":return oh.parse(a,p.parseComponentValue());case"image":return lI.parse(a,p.parseComponentValue());case"length":var x=p.parseComponentValue();return hh(x)?x:Qa;case"length-percentage":var v=p.parseComponentValue();return Zi(v)?v:Qa;case"time":return i7.parse(a,p.parseComponentValue())}break}},mhe="data-html2canvas-debug",fhe=function(a){var o=a.getAttribute(mhe);switch(o){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},TR=function(a,o){var c=fhe(a);return c===1||o===c},Zd=function(){function a(o,c){if(this.context=o,this.textNodes=[],this.elements=[],this.flags=0,TR(c,3))debugger;this.styles=new hhe(o,window.getComputedStyle(c,null)),OR(c)&&(this.styles.animationDuration.some(function(d){return d>0})&&(c.style.animationDuration="0s"),this.styles.transform!==null&&(c.style.transform="none")),this.bounds=fE(this.context,c),TR(c,4)&&(this.flags|=16)}return a}(),ghe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",c8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hb=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ry=0;ry<c8.length;ry++)Hb[c8.charCodeAt(ry)]=ry;var bhe=function(a){var o=a.length*.75,c=a.length,d,h=0,p,g,x,v;a[a.length-1]==="="&&(o--,a[a.length-2]==="="&&o--);var E=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(o):new Array(o),C=Array.isArray(E)?E:new Uint8Array(E);for(d=0;d<c;d+=4)p=Hb[a.charCodeAt(d)],g=Hb[a.charCodeAt(d+1)],x=Hb[a.charCodeAt(d+2)],v=Hb[a.charCodeAt(d+3)],C[h++]=p<<2|g>>4,C[h++]=(g&15)<<4|x>>2,C[h++]=(x&3)<<6|v&63;return E},xhe=function(a){for(var o=a.length,c=[],d=0;d<o;d+=2)c.push(a[d+1]<<8|a[d]);return c},vhe=function(a){for(var o=a.length,c=[],d=0;d<o;d+=4)c.push(a[d+3]<<24|a[d+2]<<16|a[d+1]<<8|a[d]);return c},$p=5,dI=11,cT=2,whe=dI-$p,a7=65536>>$p,_he=1<<$p,lT=_he-1,yhe=1024>>$p,Ehe=a7+yhe,Che=Ehe,She=32,Nhe=Che+She,The=65536>>dI,Rhe=1<<whe,Ihe=Rhe-1,l8=function(a,o,c){return a.slice?a.slice(o,c):new Uint16Array(Array.prototype.slice.call(a,o,c))},Ohe=function(a,o,c){return a.slice?a.slice(o,c):new Uint32Array(Array.prototype.slice.call(a,o,c))},khe=function(a,o){var c=bhe(a),d=Array.isArray(c)?vhe(c):new Uint32Array(c),h=Array.isArray(c)?xhe(c):new Uint16Array(c),p=24,g=l8(h,p/2,d[4]/2),x=d[5]===2?l8(h,(p+d[4])/2):Ohe(d,Math.ceil((p+d[4])/4));return new Dhe(d[0],d[1],d[2],d[3],g,x)},Dhe=function(){function a(o,c,d,h,p,g){this.initialValue=o,this.errorValue=c,this.highStart=d,this.highValueIndex=h,this.index=p,this.data=g}return a.prototype.get=function(o){var c;if(o>=0){if(o<55296||o>56319&&o<=65535)return c=this.index[o>>$p],c=(c<<cT)+(o&lT),this.data[c];if(o<=65535)return c=this.index[a7+(o-55296>>$p)],c=(c<<cT)+(o&lT),this.data[c];if(o<this.highStart)return c=Nhe-The+(o>>dI),c=this.index[c],c+=o>>$p&Ihe,c=this.index[c],c=(c<<cT)+(o&lT),this.data[c];if(o<=1114111)return this.data[this.highValueIndex]}return this.errorValue},a}(),d8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bhe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ny=0;ny<d8.length;ny++)Bhe[d8.charCodeAt(ny)]=ny;var Lhe=1,dT=2,AT=3,A8=4,u8=5,jhe=7,h8=8,uT=9,hT=10,p8=11,m8=12,f8=13,g8=14,pT=15,Phe=function(a){for(var o=[],c=0,d=a.length;c<d;){var h=a.charCodeAt(c++);if(h>=55296&&h<=56319&&c<d){var p=a.charCodeAt(c++);(p&64512)===56320?o.push(((h&1023)<<10)+(p&1023)+65536):(o.push(h),c--)}else o.push(h)}return o},Uhe=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if(String.fromCodePoint)return String.fromCodePoint.apply(String,a);var c=a.length;if(!c)return"";for(var d=[],h=-1,p="";++h<c;){var g=a[h];g<=65535?d.push(g):(g-=65536,d.push((g>>10)+55296,g%1024+56320)),(h+1===c||d.length>16384)&&(p+=String.fromCharCode.apply(String,d),d.length=0)}return p},Fhe=khe(ghe),ll="",mT="",Mhe=function(a){return Fhe.get(a)},Vhe=function(a,o,c){var d=c-2,h=o[d],p=o[c-1],g=o[c];if(p===dT&&g===AT)return ll;if(p===dT||p===AT||p===A8||g===dT||g===AT||g===A8)return mT;if(p===h8&&[h8,uT,p8,m8].indexOf(g)!==-1||(p===p8||p===uT)&&(g===uT||g===hT)||(p===m8||p===hT)&&g===hT||g===f8||g===u8||g===jhe||p===Lhe)return ll;if(p===f8&&g===g8){for(;h===u8;)h=o[--d];if(h===g8)return ll}if(p===pT&&g===pT){for(var x=0;h===pT;)x++,h=o[--d];if(x%2===0)return ll}return mT},Qhe=function(a){var o=Phe(a),c=o.length,d=0,h=0,p=o.map(Mhe);return{next:function(){if(d>=c)return{done:!0,value:null};for(var g=ll;d<c&&(g=Vhe(o,p,++d))===ll;);if(g!==ll||d===c){var x=Uhe.apply(null,o.slice(h,d));return h=d,{value:x,done:!1}}return{done:!0,value:null}}}},Hhe=function(a){for(var o=Qhe(a),c=[],d;!(d=o.next()).done;)d.value&&c.push(d.value.slice());return c},Ghe=function(a){var o=123;if(a.createRange){var c=a.createRange();if(c.getBoundingClientRect){var d=a.createElement("boundtest");d.style.height=o+"px",d.style.display="block",a.body.appendChild(d),c.selectNode(d);var h=c.getBoundingClientRect(),p=Math.round(h.height);if(a.body.removeChild(d),p===o)return!0}}return!1},Khe=function(a){var o=a.createElement("boundtest");o.style.width="50px",o.style.display="block",o.style.fontSize="12px",o.style.letterSpacing="0px",o.style.wordSpacing="0px",a.body.appendChild(o);var c=a.createRange();o.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var d=o.firstChild,h=gE(d.data).map(function(v){return Gi(v)}),p=0,g={},x=h.every(function(v,E){c.setStart(d,p),c.setEnd(d,p+v.length);var C=c.getBoundingClientRect();p+=v.length;var I=C.x>g.x||C.y>g.y;return g=C,E===0?!0:I});return a.body.removeChild(o),x},Whe=function(){return typeof new Image().crossOrigin<"u"},zhe=function(){return typeof new XMLHttpRequest().responseType=="string"},qhe=function(a){var o=new Image,c=a.createElement("canvas"),d=c.getContext("2d");if(!d)return!1;o.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{d.drawImage(o,0,0),c.toDataURL()}catch{return!1}return!0},b8=function(a){return a[0]===0&&a[1]===255&&a[2]===0&&a[3]===255},Yhe=function(a){var o=a.createElement("canvas"),c=100;o.width=c,o.height=c;var d=o.getContext("2d");if(!d)return Promise.reject(!1);d.fillStyle="rgb(0, 255, 0)",d.fillRect(0,0,c,c);var h=new Image,p=o.toDataURL();h.src=p;var g=RR(c,c,0,0,h);return d.fillStyle="red",d.fillRect(0,0,c,c),x8(g).then(function(x){d.drawImage(x,0,0);var v=d.getImageData(0,0,c,c).data;d.fillStyle="red",d.fillRect(0,0,c,c);var E=a.createElement("div");return E.style.backgroundImage="url("+p+")",E.style.height=c+"px",b8(v)?x8(RR(c,c,0,0,E)):Promise.reject(!1)}).then(function(x){return d.drawImage(x,0,0),b8(d.getImageData(0,0,c,c).data)}).catch(function(){return!1})},RR=function(a,o,c,d,h){var p="http://www.w3.org/2000/svg",g=document.createElementNS(p,"svg"),x=document.createElementNS(p,"foreignObject");return g.setAttributeNS(null,"width",a.toString()),g.setAttributeNS(null,"height",o.toString()),x.setAttributeNS(null,"width","100%"),x.setAttributeNS(null,"height","100%"),x.setAttributeNS(null,"x",c.toString()),x.setAttributeNS(null,"y",d.toString()),x.setAttributeNS(null,"externalResourcesRequired","true"),g.appendChild(x),x.appendChild(h),g},x8=function(a){return new Promise(function(o,c){var d=new Image;d.onload=function(){return o(d)},d.onerror=c,d.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(a))})},Va={get SUPPORT_RANGE_BOUNDS(){var a=Ghe(document);return Object.defineProperty(Va,"SUPPORT_RANGE_BOUNDS",{value:a}),a},get SUPPORT_WORD_BREAKING(){var a=Va.SUPPORT_RANGE_BOUNDS&&Khe(document);return Object.defineProperty(Va,"SUPPORT_WORD_BREAKING",{value:a}),a},get SUPPORT_SVG_DRAWING(){var a=qhe(document);return Object.defineProperty(Va,"SUPPORT_SVG_DRAWING",{value:a}),a},get SUPPORT_FOREIGNOBJECT_DRAWING(){var a=typeof Array.from=="function"&&typeof window.fetch=="function"?Yhe(document):Promise.resolve(!1);return Object.defineProperty(Va,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:a}),a},get SUPPORT_CORS_IMAGES(){var a=Whe();return Object.defineProperty(Va,"SUPPORT_CORS_IMAGES",{value:a}),a},get SUPPORT_RESPONSE_TYPE(){var a=zhe();return Object.defineProperty(Va,"SUPPORT_RESPONSE_TYPE",{value:a}),a},get SUPPORT_CORS_XHR(){var a="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Va,"SUPPORT_CORS_XHR",{value:a}),a},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var a=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Va,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:a}),a}},Yb=function(){function a(o,c){this.text=o,this.bounds=c}return a}(),Xhe=function(a,o,c,d){var h=Zhe(o,c),p=[],g=0;return h.forEach(function(x){if(c.textDecorationLine.length||x.trim().length>0)if(Va.SUPPORT_RANGE_BOUNDS){var v=v8(d,g,x.length).getClientRects();if(v.length>1){var E=AI(x),C=0;E.forEach(function(O){p.push(new Yb(O,YA.fromDOMRectList(a,v8(d,C+g,O.length).getClientRects()))),C+=O.length})}else p.push(new Yb(x,YA.fromDOMRectList(a,v)))}else{var I=d.splitText(x.length);p.push(new Yb(x,Jhe(a,d))),d=I}else Va.SUPPORT_RANGE_BOUNDS||(d=d.splitText(x.length));g+=x.length}),p},Jhe=function(a,o){var c=o.ownerDocument;if(c){var d=c.createElement("html2canvaswrapper");d.appendChild(o.cloneNode(!0));var h=o.parentNode;if(h){h.replaceChild(d,o);var p=fE(a,d);return d.firstChild&&h.replaceChild(d.firstChild,d),p}}return YA.EMPTY},v8=function(a,o,c){var d=a.ownerDocument;if(!d)throw new Error("Node has no owner document");var h=d.createRange();return h.setStart(a,o),h.setEnd(a,o+c),h},AI=function(a){if(Va.SUPPORT_NATIVE_TEXT_SEGMENTATION){var o=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(o.segment(a)).map(function(c){return c.segment})}return Hhe(a)},$he=function(a,o){if(Va.SUPPORT_NATIVE_TEXT_SEGMENTATION){var c=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(c.segment(a)).map(function(d){return d.segment})}return tpe(a,o)},Zhe=function(a,o){return o.letterSpacing!==0?AI(a):$he(a,o)},epe=[32,160,4961,65792,65793,4153,4241],tpe=function(a,o){for(var c=Tde(a,{lineBreak:o.lineBreak,wordBreak:o.overflowWrap==="break-word"?"break-word":o.wordBreak}),d=[],h,p=function(){if(h.value){var g=h.value.slice(),x=gE(g),v="";x.forEach(function(E){epe.indexOf(E)===-1?v+=Gi(E):(v.length&&d.push(v),d.push(Gi(E)),v="")}),v.length&&d.push(v)}};!(h=c.next()).done;)p();return d},spe=function(){function a(o,c,d){this.text=rpe(c.data,d.textTransform),this.textBounds=Xhe(o,this.text,d,c)}return a}(),rpe=function(a,o){switch(o){case 1:return a.toLowerCase();case 3:return a.replace(npe,ipe);case 2:return a.toUpperCase();default:return a}},npe=/(^|\s|:|-|\(|\))([a-z])/g,ipe=function(a,o,c){return a.length>0?o+c.toUpperCase():a},o7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.src=d.currentSrc||d.src,h.intrinsicWidth=d.naturalWidth,h.intrinsicHeight=d.naturalHeight,h.context.cache.addImage(h.src),h}return o}(Zd),c7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.canvas=d,h.intrinsicWidth=d.width,h.intrinsicHeight=d.height,h}return o}(Zd),l7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this,p=new XMLSerializer,g=fE(c,d);return d.setAttribute("width",g.width+"px"),d.setAttribute("height",g.height+"px"),h.svg="data:image/svg+xml,"+encodeURIComponent(p.serializeToString(d)),h.intrinsicWidth=d.width.baseVal.value,h.intrinsicHeight=d.height.baseVal.value,h.context.cache.addImage(h.svg),h}return o}(Zd),d7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.value=d.value,h}return o}(Zd),IR=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.start=d.start,h.reversed=typeof d.reversed=="boolean"&&d.reversed===!0,h}return o}(Zd),ape=[{type:15,flags:0,unit:"px",number:3}],ope=[{type:16,flags:0,number:50}],cpe=function(a){return a.width>a.height?new YA(a.left+(a.width-a.height)/2,a.top,a.height,a.height):a.width<a.height?new YA(a.left,a.top+(a.height-a.width)/2,a.width,a.width):a},lpe=function(a){var o=a.type===dpe?new Array(a.value.length+1).join(""):a.value;return o.length===0?a.placeholder||"":o},Wy="checkbox",zy="radio",dpe="password",w8=707406591,uI=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;switch(h.type=d.type.toLowerCase(),h.checked=d.checked,h.value=lpe(d),(h.type===Wy||h.type===zy)&&(h.styles.backgroundColor=3739148031,h.styles.borderTopColor=h.styles.borderRightColor=h.styles.borderBottomColor=h.styles.borderLeftColor=2779096575,h.styles.borderTopWidth=h.styles.borderRightWidth=h.styles.borderBottomWidth=h.styles.borderLeftWidth=1,h.styles.borderTopStyle=h.styles.borderRightStyle=h.styles.borderBottomStyle=h.styles.borderLeftStyle=1,h.styles.backgroundClip=[0],h.styles.backgroundOrigin=[0],h.bounds=cpe(h.bounds)),h.type){case Wy:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=ape;break;case zy:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=ope;break}return h}return o}(Zd),A7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this,p=d.options[d.selectedIndex||0];return h.value=p&&p.text||"",h}return o}(Zd),u7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.value=d.value,h}return o}(Zd),h7=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;h.src=d.src,h.width=parseInt(d.width,10)||0,h.height=parseInt(d.height,10)||0,h.backgroundColor=h.styles.backgroundColor;try{if(d.contentWindow&&d.contentWindow.document&&d.contentWindow.document.documentElement){h.tree=m7(c,d.contentWindow.document.documentElement);var p=d.contentWindow.document.documentElement?zb(c,getComputedStyle(d.contentWindow.document.documentElement).backgroundColor):WA.TRANSPARENT,g=d.contentWindow.document.body?zb(c,getComputedStyle(d.contentWindow.document.body).backgroundColor):WA.TRANSPARENT;h.backgroundColor=ch(p)?ch(g)?h.styles.backgroundColor:g:p}}catch{}return h}return o}(Zd),Ape=["OL","UL","MENU"],Cy=function(a,o,c,d){for(var h=o.firstChild,p=void 0;h;h=p)if(p=h.nextSibling,f7(h)&&h.data.trim().length>0)c.textNodes.push(new spe(a,h,c.styles));else if(mg(h))if(v7(h)&&h.assignedNodes)h.assignedNodes().forEach(function(x){return Cy(a,x,c,d)});else{var g=p7(a,h);g.styles.isVisible()&&(upe(h,g,d)?g.flags|=4:hpe(g.styles)&&(g.flags|=2),Ape.indexOf(h.tagName)!==-1&&(g.flags|=8),c.elements.push(g),h.slot,h.shadowRoot?Cy(a,h.shadowRoot,g,d):!qy(h)&&!g7(h)&&!Yy(h)&&Cy(a,h,g,d))}},p7=function(a,o){return kR(o)?new o7(a,o):b7(o)?new c7(a,o):g7(o)?new l7(a,o):ppe(o)?new d7(a,o):mpe(o)?new IR(a,o):fpe(o)?new uI(a,o):Yy(o)?new A7(a,o):qy(o)?new u7(a,o):x7(o)?new h7(a,o):new Zd(a,o)},m7=function(a,o){var c=p7(a,o);return c.flags|=4,Cy(a,o,c,c),c},upe=function(a,o,c){return o.styles.isPositionedWithZIndex()||o.styles.opacity<1||o.styles.isTransformed()||hI(a)&&c.styles.isTransparent()},hpe=function(a){return a.isPositioned()||a.isFloating()},f7=function(a){return a.nodeType===Node.TEXT_NODE},mg=function(a){return a.nodeType===Node.ELEMENT_NODE},OR=function(a){return mg(a)&&typeof a.style<"u"&&!Sy(a)},Sy=function(a){return typeof a.className=="object"},ppe=function(a){return a.tagName==="LI"},mpe=function(a){return a.tagName==="OL"},fpe=function(a){return a.tagName==="INPUT"},gpe=function(a){return a.tagName==="HTML"},g7=function(a){return a.tagName==="svg"},hI=function(a){return a.tagName==="BODY"},b7=function(a){return a.tagName==="CANVAS"},_8=function(a){return a.tagName==="VIDEO"},kR=function(a){return a.tagName==="IMG"},x7=function(a){return a.tagName==="IFRAME"},y8=function(a){return a.tagName==="STYLE"},bpe=function(a){return a.tagName==="SCRIPT"},qy=function(a){return a.tagName==="TEXTAREA"},Yy=function(a){return a.tagName==="SELECT"},v7=function(a){return a.tagName==="SLOT"},E8=function(a){return a.tagName.indexOf("-")>0},xpe=function(){function a(){this.counters={}}return a.prototype.getCounterValue=function(o){var c=this.counters[o];return c&&c.length?c[c.length-1]:1},a.prototype.getCounterValues=function(o){var c=this.counters[o];return c||[]},a.prototype.pop=function(o){var c=this;o.forEach(function(d){return c.counters[d].pop()})},a.prototype.parse=function(o){var c=this,d=o.counterIncrement,h=o.counterReset,p=!0;d!==null&&d.forEach(function(x){var v=c.counters[x.counter];v&&x.increment!==0&&(p=!1,v.length||v.push(1),v[Math.max(0,v.length-1)]+=x.increment)});var g=[];return p&&h.forEach(function(x){var v=c.counters[x.counter];g.push(x.counter),v||(v=c.counters[x.counter]=[]),v.push(x.reset)}),g},a}(),C8={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},S8={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},vpe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},wpe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},sg=function(a,o,c,d,h,p){return a<o||a>c?nx(a,h,p.length>0):d.integers.reduce(function(g,x,v){for(;a>=x;)a-=x,g+=d.values[v];return g},"")+p},w7=function(a,o,c,d){var h="";do c||a--,h=d(a)+h,a/=o;while(a*o>=o);return h},Hi=function(a,o,c,d,h){var p=c-o+1;return(a<0?"-":"")+(w7(Math.abs(a),p,d,function(g){return Gi(Math.floor(g%p)+o)})+h)},Up=function(a,o,c){c===void 0&&(c=". ");var d=o.length;return w7(Math.abs(a),d,!1,function(h){return o[Math.floor(h%d)]})+c},Ag=1,Yu=2,Xu=4,Gb=8,FA=function(a,o,c,d,h,p){if(a<-9999||a>9999)return nx(a,4,h.length>0);var g=Math.abs(a),x=h;if(g===0)return o[0]+x;for(var v=0;g>0&&v<=4;v++){var E=g%10;E===0&&la(p,Ag)&&x!==""?x=o[E]+x:E>1||E===1&&v===0||E===1&&v===1&&la(p,Yu)||E===1&&v===1&&la(p,Xu)&&a>100||E===1&&v>1&&la(p,Gb)?x=o[E]+(v>0?c[v-1]:"")+x:E===1&&v>0&&(x=c[v-1]+x),g=Math.floor(g/10)}return(a<0?d:"")+x},N8="",T8="",R8="",fT="",nx=function(a,o,c){var d=c?". ":"",h=c?"":"",p=c?", ":"",g=c?" ":"";switch(o){case 0:return""+g;case 1:return""+g;case 2:return""+g;case 5:var x=Hi(a,48,57,!0,d);return x.length<4?"0"+x:x;case 4:return Up(a,"",h);case 6:return sg(a,1,3999,C8,3,d).toLowerCase();case 7:return sg(a,1,3999,C8,3,d);case 8:return Hi(a,945,969,!1,d);case 9:return Hi(a,97,122,!1,d);case 10:return Hi(a,65,90,!1,d);case 11:return Hi(a,1632,1641,!0,d);case 12:case 49:return sg(a,1,9999,S8,3,d);case 35:return sg(a,1,9999,S8,3,d).toLowerCase();case 13:return Hi(a,2534,2543,!0,d);case 14:case 30:return Hi(a,6112,6121,!0,d);case 15:return Up(a,"",h);case 16:return Up(a,"",h);case 17:case 48:return FA(a,"",N8,"",h,Yu|Xu|Gb);case 47:return FA(a,"",T8,"",h,Ag|Yu|Xu|Gb);case 42:return FA(a,"",N8,"",h,Yu|Xu|Gb);case 41:return FA(a,"",T8,"",h,Ag|Yu|Xu|Gb);case 26:return FA(a,"","",R8,h,0);case 25:return FA(a,"","",R8,h,Ag|Yu|Xu);case 31:return FA(a,"","",fT,p,Ag|Yu|Xu);case 33:return FA(a,"","",fT,p,0);case 32:return FA(a,"","",fT,p,Ag|Yu|Xu);case 18:return Hi(a,2406,2415,!0,d);case 20:return sg(a,1,19999,wpe,3,d);case 21:return Hi(a,2790,2799,!0,d);case 22:return Hi(a,2662,2671,!0,d);case 22:return sg(a,1,10999,vpe,3,d);case 23:return Up(a,"");case 24:return Up(a,"");case 27:return Hi(a,3302,3311,!0,d);case 28:return Up(a,"",h);case 29:return Up(a,"",h);case 34:return Hi(a,3792,3801,!0,d);case 37:return Hi(a,6160,6169,!0,d);case 38:return Hi(a,4160,4169,!0,d);case 39:return Hi(a,2918,2927,!0,d);case 40:return Hi(a,1776,1785,!0,d);case 43:return Hi(a,3046,3055,!0,d);case 44:return Hi(a,3174,3183,!0,d);case 45:return Hi(a,3664,3673,!0,d);case 46:return Hi(a,3872,3881,!0,d);case 3:default:return Hi(a,48,57,!0,d)}},_7="data-html2canvas-ignore",I8=function(){function a(o,c,d){if(this.context=o,this.options=d,this.scrolledElements=[],this.referenceElement=c,this.counters=new xpe,this.quoteDepth=0,!c.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(c.ownerDocument.documentElement,!1)}return a.prototype.toIFrame=function(o,c){var d=this,h=_pe(o,c);if(!h.contentWindow)return Promise.reject("Unable to find iframe window");var p=o.defaultView.pageXOffset,g=o.defaultView.pageYOffset,x=h.contentWindow,v=x.document,E=Cpe(h).then(function(){return No(d,void 0,void 0,function(){var C,I;return ao(this,function(O){switch(O.label){case 0:return this.scrolledElements.forEach(Rpe),x&&(x.scrollTo(c.left,c.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(x.scrollY!==c.top||x.scrollX!==c.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(x.scrollX-c.left,x.scrollY-c.top,0,0))),C=this.options.onclone,I=this.clonedReferenceElement,typeof I>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:v.fonts&&v.fonts.ready?[4,v.fonts.ready]:[3,2];case 1:O.sent(),O.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Epe(v)]:[3,4];case 3:O.sent(),O.label=4;case 4:return typeof C=="function"?[2,Promise.resolve().then(function(){return C(v,I)}).then(function(){return h})]:[2,h]}})})});return v.open(),v.write(Npe(document.doctype)+"<html></html>"),Tpe(this.referenceElement.ownerDocument,p,g),v.replaceChild(v.adoptNode(this.documentElement),v.documentElement),v.close(),E},a.prototype.createElementClone=function(o){if(TR(o,2))debugger;if(b7(o))return this.createCanvasClone(o);if(_8(o))return this.createVideoClone(o);if(y8(o))return this.createStyleClone(o);var c=o.cloneNode(!1);return kR(c)&&(kR(o)&&o.currentSrc&&o.currentSrc!==o.src&&(c.src=o.currentSrc,c.srcset=""),c.loading==="lazy"&&(c.loading="eager")),E8(c)?this.createCustomElementClone(c):c},a.prototype.createCustomElementClone=function(o){var c=document.createElement("html2canvascustomelement");return gT(o.style,c),c},a.prototype.createStyleClone=function(o){try{var c=o.sheet;if(c&&c.cssRules){var d=[].slice.call(c.cssRules,0).reduce(function(p,g){return g&&typeof g.cssText=="string"?p+g.cssText:p},""),h=o.cloneNode(!1);return h.textContent=d,h}}catch(p){if(this.context.logger.error("Unable to access cssRules property",p),p.name!=="SecurityError")throw p}return o.cloneNode(!1)},a.prototype.createCanvasClone=function(o){var c;if(this.options.inlineImages&&o.ownerDocument){var d=o.ownerDocument.createElement("img");try{return d.src=o.toDataURL(),d}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",o)}}var h=o.cloneNode(!1);try{h.width=o.width,h.height=o.height;var p=o.getContext("2d"),g=h.getContext("2d");if(g)if(!this.options.allowTaint&&p)g.putImageData(p.getImageData(0,0,o.width,o.height),0,0);else{var x=(c=o.getContext("webgl2"))!==null&&c!==void 0?c:o.getContext("webgl");if(x){var v=x.getContextAttributes();(v==null?void 0:v.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",o)}g.drawImage(o,0,0)}return h}catch{this.context.logger.info("Unable to clone canvas as it is tainted",o)}return h},a.prototype.createVideoClone=function(o){var c=o.ownerDocument.createElement("canvas");c.width=o.offsetWidth,c.height=o.offsetHeight;var d=c.getContext("2d");try{return d&&(d.drawImage(o,0,0,c.width,c.height),this.options.allowTaint||d.getImageData(0,0,c.width,c.height)),c}catch{this.context.logger.info("Unable to clone video as it is tainted",o)}var h=o.ownerDocument.createElement("canvas");return h.width=o.offsetWidth,h.height=o.offsetHeight,h},a.prototype.appendChildNode=function(o,c,d){(!mg(c)||!bpe(c)&&!c.hasAttribute(_7)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(c)))&&(!this.options.copyStyles||!mg(c)||!y8(c))&&o.appendChild(this.cloneNode(c,d))},a.prototype.cloneChildNodes=function(o,c,d){for(var h=this,p=o.shadowRoot?o.shadowRoot.firstChild:o.firstChild;p;p=p.nextSibling)if(mg(p)&&v7(p)&&typeof p.assignedNodes=="function"){var g=p.assignedNodes();g.length&&g.forEach(function(x){return h.appendChildNode(c,x,d)})}else this.appendChildNode(c,p,d)},a.prototype.cloneNode=function(o,c){if(f7(o))return document.createTextNode(o.data);if(!o.ownerDocument)return o.cloneNode(!1);var d=o.ownerDocument.defaultView;if(d&&mg(o)&&(OR(o)||Sy(o))){var h=this.createElementClone(o);h.style.transitionProperty="none";var p=d.getComputedStyle(o),g=d.getComputedStyle(o,":before"),x=d.getComputedStyle(o,":after");this.referenceElement===o&&OR(h)&&(this.clonedReferenceElement=h),hI(h)&&kpe(h);var v=this.counters.parse(new o8(this.context,p)),E=this.resolvePseudoContent(o,h,g,Xb.BEFORE);E8(o)&&(c=!0),_8(o)||this.cloneChildNodes(o,h,c),E&&h.insertBefore(E,h.firstChild);var C=this.resolvePseudoContent(o,h,x,Xb.AFTER);return C&&h.appendChild(C),this.counters.pop(v),(p&&(this.options.copyStyles||Sy(o))&&!x7(o)||c)&&gT(p,h),(o.scrollTop!==0||o.scrollLeft!==0)&&this.scrolledElements.push([h,o.scrollLeft,o.scrollTop]),(qy(o)||Yy(o))&&(qy(h)||Yy(h))&&(h.value=o.value),h}return o.cloneNode(!1)},a.prototype.resolvePseudoContent=function(o,c,d,h){var p=this;if(d){var g=d.content,x=c.ownerDocument;if(!(!x||!g||g==="none"||g==="-moz-alt-content"||d.display==="none")){this.counters.parse(new o8(this.context,d));var v=new phe(this.context,d),E=x.createElement("html2canvaspseudoelement");gT(d,E),v.content.forEach(function(I){if(I.type===0)E.appendChild(x.createTextNode(I.value));else if(I.type===22){var O=x.createElement("img");O.src=I.value,O.style.opacity="1",E.appendChild(O)}else if(I.type===18){if(I.name==="attr"){var R=I.values.filter(Rn);R.length&&E.appendChild(x.createTextNode(o.getAttribute(R[0].value)||""))}else if(I.name==="counter"){var k=I.values.filter(Rg),M=k[0],P=k[1];if(M&&Rn(M)){var H=p.counters.getCounterValue(M.value),$=P&&Rn(P)?NR.parse(p.context,P.value):3;E.appendChild(x.createTextNode(nx(H,$,!1)))}}else if(I.name==="counters"){var re=I.values.filter(Rg),M=re[0],J=re[1],P=re[2];if(M&&Rn(M)){var ge=p.counters.getCounterValues(M.value),ie=P&&Rn(P)?NR.parse(p.context,P.value):3,we=J&&J.type===0?J.value:"",Ae=ge.map(function(Y){return nx(Y,ie,!1)}).join(we);E.appendChild(x.createTextNode(Ae))}}}else if(I.type===20)switch(I.value){case"open-quote":E.appendChild(x.createTextNode(a8(v.quotes,p.quoteDepth++,!0)));break;case"close-quote":E.appendChild(x.createTextNode(a8(v.quotes,--p.quoteDepth,!1)));break;default:E.appendChild(x.createTextNode(I.value))}}),E.className=DR+" "+BR;var C=h===Xb.BEFORE?" "+DR:" "+BR;return Sy(c)?c.className.baseValue+=C:c.className+=C,E}}},a.destroy=function(o){return o.parentNode?(o.parentNode.removeChild(o),!0):!1},a}(),Xb;(function(a){a[a.BEFORE=0]="BEFORE",a[a.AFTER=1]="AFTER"})(Xb||(Xb={}));var _pe=function(a,o){var c=a.createElement("iframe");return c.className="html2canvas-container",c.style.visibility="hidden",c.style.position="fixed",c.style.left="-10000px",c.style.top="0px",c.style.border="0",c.width=o.width.toString(),c.height=o.height.toString(),c.scrolling="no",c.setAttribute(_7,"true"),a.body.appendChild(c),c},ype=function(a){return new Promise(function(o){if(a.complete){o();return}if(!a.src){o();return}a.onload=o,a.onerror=o})},Epe=function(a){return Promise.all([].slice.call(a.images,0).map(ype))},Cpe=function(a){return new Promise(function(o,c){var d=a.contentWindow;if(!d)return c("No window assigned for iframe");var h=d.document;d.onload=a.onload=function(){d.onload=a.onload=null;var p=setInterval(function(){h.body.childNodes.length>0&&h.readyState==="complete"&&(clearInterval(p),o(a))},50)}})},Spe=["all","d","content"],gT=function(a,o){for(var c=a.length-1;c>=0;c--){var d=a.item(c);Spe.indexOf(d)===-1&&o.style.setProperty(d,a.getPropertyValue(d))}return o},Npe=function(a){var o="";return a&&(o+="<!DOCTYPE ",a.name&&(o+=a.name),a.internalSubset&&(o+=a.internalSubset),a.publicId&&(o+='"'+a.publicId+'"'),a.systemId&&(o+='"'+a.systemId+'"'),o+=">"),o},Tpe=function(a,o,c){a&&a.defaultView&&(o!==a.defaultView.pageXOffset||c!==a.defaultView.pageYOffset)&&a.defaultView.scrollTo(o,c)},Rpe=function(a){var o=a[0],c=a[1],d=a[2];o.scrollLeft=c,o.scrollTop=d},Ipe=":before",Ope=":after",DR="___html2canvas___pseudoelement_before",BR="___html2canvas___pseudoelement_after",O8=`{
    content: "" !important;
    display: none !important;
}`,kpe=function(a){Dpe(a,"."+DR+Ipe+O8+`
         .`+BR+Ope+O8)},Dpe=function(a,o){var c=a.ownerDocument;if(c){var d=c.createElement("style");d.textContent=o,a.appendChild(d)}},y7=function(){function a(){}return a.getOrigin=function(o){var c=a._link;return c?(c.href=o,c.href=c.href,c.protocol+c.hostname+c.port):"about:blank"},a.isSameOrigin=function(o){return a.getOrigin(o)===a._origin},a.setContext=function(o){a._link=o.document.createElement("a"),a._origin=a.getOrigin(o.location.href)},a._origin="about:blank",a}(),Bpe=function(){function a(o,c){this.context=o,this._options=c,this._cache={}}return a.prototype.addImage=function(o){var c=Promise.resolve();return this.has(o)||(xT(o)||Upe(o))&&(this._cache[o]=this.loadImage(o)).catch(function(){}),c},a.prototype.match=function(o){return this._cache[o]},a.prototype.loadImage=function(o){return No(this,void 0,void 0,function(){var c,d,h,p,g=this;return ao(this,function(x){switch(x.label){case 0:return c=y7.isSameOrigin(o),d=!bT(o)&&this._options.useCORS===!0&&Va.SUPPORT_CORS_IMAGES&&!c,h=!bT(o)&&!c&&!xT(o)&&typeof this._options.proxy=="string"&&Va.SUPPORT_CORS_XHR&&!d,!c&&this._options.allowTaint===!1&&!bT(o)&&!xT(o)&&!h&&!d?[2]:(p=o,h?[4,this.proxy(p)]:[3,2]);case 1:p=x.sent(),x.label=2;case 2:return this.context.logger.debug("Added image "+o.substring(0,256)),[4,new Promise(function(v,E){var C=new Image;C.onload=function(){return v(C)},C.onerror=E,(Fpe(p)||d)&&(C.crossOrigin="anonymous"),C.src=p,C.complete===!0&&setTimeout(function(){return v(C)},500),g._options.imageTimeout>0&&setTimeout(function(){return E("Timed out ("+g._options.imageTimeout+"ms) loading image")},g._options.imageTimeout)})];case 3:return[2,x.sent()]}})})},a.prototype.has=function(o){return typeof this._cache[o]<"u"},a.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},a.prototype.proxy=function(o){var c=this,d=this._options.proxy;if(!d)throw new Error("No proxy defined");var h=o.substring(0,256);return new Promise(function(p,g){var x=Va.SUPPORT_RESPONSE_TYPE?"blob":"text",v=new XMLHttpRequest;v.onload=function(){if(v.status===200)if(x==="text")p(v.response);else{var I=new FileReader;I.addEventListener("load",function(){return p(I.result)},!1),I.addEventListener("error",function(O){return g(O)},!1),I.readAsDataURL(v.response)}else g("Failed to proxy resource "+h+" with status code "+v.status)},v.onerror=g;var E=d.indexOf("?")>-1?"&":"?";if(v.open("GET",""+d+E+"url="+encodeURIComponent(o)+"&responseType="+x),x!=="text"&&v instanceof XMLHttpRequest&&(v.responseType=x),c._options.imageTimeout){var C=c._options.imageTimeout;v.timeout=C,v.ontimeout=function(){return g("Timed out ("+C+"ms) proxying "+h)}}v.send()})},a}(),Lpe=/^data:image\/svg\+xml/i,jpe=/^data:image\/.*;base64,/i,Ppe=/^data:image\/.*/i,Upe=function(a){return Va.SUPPORT_SVG_DRAWING||!Mpe(a)},bT=function(a){return Ppe.test(a)},Fpe=function(a){return jpe.test(a)},xT=function(a){return a.substr(0,4)==="blob"},Mpe=function(a){return a.substr(-3).toLowerCase()==="svg"||Lpe.test(a)},fs=function(){function a(o,c){this.type=0,this.x=o,this.y=c}return a.prototype.add=function(o,c){return new a(this.x+o,this.y+c)},a}(),rg=function(a,o,c){return new fs(a.x+(o.x-a.x)*c,a.y+(o.y-a.y)*c)},iy=function(){function a(o,c,d,h){this.type=1,this.start=o,this.startControl=c,this.endControl=d,this.end=h}return a.prototype.subdivide=function(o,c){var d=rg(this.start,this.startControl,o),h=rg(this.startControl,this.endControl,o),p=rg(this.endControl,this.end,o),g=rg(d,h,o),x=rg(h,p,o),v=rg(g,x,o);return c?new a(this.start,d,g,v):new a(v,x,p,this.end)},a.prototype.add=function(o,c){return new a(this.start.add(o,c),this.startControl.add(o,c),this.endControl.add(o,c),this.end.add(o,c))},a.prototype.reverse=function(){return new a(this.end,this.endControl,this.startControl,this.start)},a}(),dl=function(a){return a.type===1},Vpe=function(){function a(o){var c=o.styles,d=o.bounds,h=Qb(c.borderTopLeftRadius,d.width,d.height),p=h[0],g=h[1],x=Qb(c.borderTopRightRadius,d.width,d.height),v=x[0],E=x[1],C=Qb(c.borderBottomRightRadius,d.width,d.height),I=C[0],O=C[1],R=Qb(c.borderBottomLeftRadius,d.width,d.height),k=R[0],M=R[1],P=[];P.push((p+v)/d.width),P.push((k+I)/d.width),P.push((g+M)/d.height),P.push((E+O)/d.height);var H=Math.max.apply(Math,P);H>1&&(p/=H,g/=H,v/=H,E/=H,I/=H,O/=H,k/=H,M/=H);var $=d.width-v,re=d.height-O,J=d.width-I,ge=d.height-M,ie=c.borderTopWidth,we=c.borderRightWidth,Ae=c.borderBottomWidth,V=c.borderLeftWidth,ce=Qn(c.paddingTop,o.bounds.width),Y=Qn(c.paddingRight,o.bounds.width),z=Qn(c.paddingBottom,o.bounds.width),te=Qn(c.paddingLeft,o.bounds.width);this.topLeftBorderDoubleOuterBox=p>0||g>0?Ai(d.left+V/3,d.top+ie/3,p-V/3,g-ie/3,hn.TOP_LEFT):new fs(d.left+V/3,d.top+ie/3),this.topRightBorderDoubleOuterBox=p>0||g>0?Ai(d.left+$,d.top+ie/3,v-we/3,E-ie/3,hn.TOP_RIGHT):new fs(d.left+d.width-we/3,d.top+ie/3),this.bottomRightBorderDoubleOuterBox=I>0||O>0?Ai(d.left+J,d.top+re,I-we/3,O-Ae/3,hn.BOTTOM_RIGHT):new fs(d.left+d.width-we/3,d.top+d.height-Ae/3),this.bottomLeftBorderDoubleOuterBox=k>0||M>0?Ai(d.left+V/3,d.top+ge,k-V/3,M-Ae/3,hn.BOTTOM_LEFT):new fs(d.left+V/3,d.top+d.height-Ae/3),this.topLeftBorderDoubleInnerBox=p>0||g>0?Ai(d.left+V*2/3,d.top+ie*2/3,p-V*2/3,g-ie*2/3,hn.TOP_LEFT):new fs(d.left+V*2/3,d.top+ie*2/3),this.topRightBorderDoubleInnerBox=p>0||g>0?Ai(d.left+$,d.top+ie*2/3,v-we*2/3,E-ie*2/3,hn.TOP_RIGHT):new fs(d.left+d.width-we*2/3,d.top+ie*2/3),this.bottomRightBorderDoubleInnerBox=I>0||O>0?Ai(d.left+J,d.top+re,I-we*2/3,O-Ae*2/3,hn.BOTTOM_RIGHT):new fs(d.left+d.width-we*2/3,d.top+d.height-Ae*2/3),this.bottomLeftBorderDoubleInnerBox=k>0||M>0?Ai(d.left+V*2/3,d.top+ge,k-V*2/3,M-Ae*2/3,hn.BOTTOM_LEFT):new fs(d.left+V*2/3,d.top+d.height-Ae*2/3),this.topLeftBorderStroke=p>0||g>0?Ai(d.left+V/2,d.top+ie/2,p-V/2,g-ie/2,hn.TOP_LEFT):new fs(d.left+V/2,d.top+ie/2),this.topRightBorderStroke=p>0||g>0?Ai(d.left+$,d.top+ie/2,v-we/2,E-ie/2,hn.TOP_RIGHT):new fs(d.left+d.width-we/2,d.top+ie/2),this.bottomRightBorderStroke=I>0||O>0?Ai(d.left+J,d.top+re,I-we/2,O-Ae/2,hn.BOTTOM_RIGHT):new fs(d.left+d.width-we/2,d.top+d.height-Ae/2),this.bottomLeftBorderStroke=k>0||M>0?Ai(d.left+V/2,d.top+ge,k-V/2,M-Ae/2,hn.BOTTOM_LEFT):new fs(d.left+V/2,d.top+d.height-Ae/2),this.topLeftBorderBox=p>0||g>0?Ai(d.left,d.top,p,g,hn.TOP_LEFT):new fs(d.left,d.top),this.topRightBorderBox=v>0||E>0?Ai(d.left+$,d.top,v,E,hn.TOP_RIGHT):new fs(d.left+d.width,d.top),this.bottomRightBorderBox=I>0||O>0?Ai(d.left+J,d.top+re,I,O,hn.BOTTOM_RIGHT):new fs(d.left+d.width,d.top+d.height),this.bottomLeftBorderBox=k>0||M>0?Ai(d.left,d.top+ge,k,M,hn.BOTTOM_LEFT):new fs(d.left,d.top+d.height),this.topLeftPaddingBox=p>0||g>0?Ai(d.left+V,d.top+ie,Math.max(0,p-V),Math.max(0,g-ie),hn.TOP_LEFT):new fs(d.left+V,d.top+ie),this.topRightPaddingBox=v>0||E>0?Ai(d.left+Math.min($,d.width-we),d.top+ie,$>d.width+we?0:Math.max(0,v-we),Math.max(0,E-ie),hn.TOP_RIGHT):new fs(d.left+d.width-we,d.top+ie),this.bottomRightPaddingBox=I>0||O>0?Ai(d.left+Math.min(J,d.width-V),d.top+Math.min(re,d.height-Ae),Math.max(0,I-we),Math.max(0,O-Ae),hn.BOTTOM_RIGHT):new fs(d.left+d.width-we,d.top+d.height-Ae),this.bottomLeftPaddingBox=k>0||M>0?Ai(d.left+V,d.top+Math.min(ge,d.height-Ae),Math.max(0,k-V),Math.max(0,M-Ae),hn.BOTTOM_LEFT):new fs(d.left+V,d.top+d.height-Ae),this.topLeftContentBox=p>0||g>0?Ai(d.left+V+te,d.top+ie+ce,Math.max(0,p-(V+te)),Math.max(0,g-(ie+ce)),hn.TOP_LEFT):new fs(d.left+V+te,d.top+ie+ce),this.topRightContentBox=v>0||E>0?Ai(d.left+Math.min($,d.width+V+te),d.top+ie+ce,$>d.width+V+te?0:v-V+te,E-(ie+ce),hn.TOP_RIGHT):new fs(d.left+d.width-(we+Y),d.top+ie+ce),this.bottomRightContentBox=I>0||O>0?Ai(d.left+Math.min(J,d.width-(V+te)),d.top+Math.min(re,d.height+ie+ce),Math.max(0,I-(we+Y)),O-(Ae+z),hn.BOTTOM_RIGHT):new fs(d.left+d.width-(we+Y),d.top+d.height-(Ae+z)),this.bottomLeftContentBox=k>0||M>0?Ai(d.left+V+te,d.top+ge,Math.max(0,k-(V+te)),M-(Ae+z),hn.BOTTOM_LEFT):new fs(d.left+V+te,d.top+d.height-(Ae+z))}return a}(),hn;(function(a){a[a.TOP_LEFT=0]="TOP_LEFT",a[a.TOP_RIGHT=1]="TOP_RIGHT",a[a.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",a[a.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(hn||(hn={}));var Ai=function(a,o,c,d,h){var p=4*((Math.sqrt(2)-1)/3),g=c*p,x=d*p,v=a+c,E=o+d;switch(h){case hn.TOP_LEFT:return new iy(new fs(a,E),new fs(a,E-x),new fs(v-g,o),new fs(v,o));case hn.TOP_RIGHT:return new iy(new fs(a,o),new fs(a+g,o),new fs(v,E-x),new fs(v,E));case hn.BOTTOM_RIGHT:return new iy(new fs(v,o),new fs(v,o+x),new fs(a+g,E),new fs(a,E));case hn.BOTTOM_LEFT:default:return new iy(new fs(v,E),new fs(v-g,E),new fs(a,o+x),new fs(a,o))}},Xy=function(a){return[a.topLeftBorderBox,a.topRightBorderBox,a.bottomRightBorderBox,a.bottomLeftBorderBox]},Qpe=function(a){return[a.topLeftContentBox,a.topRightContentBox,a.bottomRightContentBox,a.bottomLeftContentBox]},Jy=function(a){return[a.topLeftPaddingBox,a.topRightPaddingBox,a.bottomRightPaddingBox,a.bottomLeftPaddingBox]},Hpe=function(){function a(o,c,d){this.offsetX=o,this.offsetY=c,this.matrix=d,this.type=0,this.target=6}return a}(),ay=function(){function a(o,c){this.path=o,this.target=c,this.type=1}return a}(),Gpe=function(){function a(o){this.opacity=o,this.type=2,this.target=6}return a}(),Kpe=function(a){return a.type===0},E7=function(a){return a.type===1},Wpe=function(a){return a.type===2},k8=function(a,o){return a.length===o.length?a.some(function(c,d){return c===o[d]}):!1},zpe=function(a,o,c,d,h){return a.map(function(p,g){switch(g){case 0:return p.add(o,c);case 1:return p.add(o+d,c);case 2:return p.add(o+d,c+h);case 3:return p.add(o,c+h)}return p})},C7=function(){function a(o){this.element=o,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return a}(),S7=function(){function a(o,c){if(this.container=o,this.parent=c,this.effects=[],this.curves=new Vpe(this.container),this.container.styles.opacity<1&&this.effects.push(new Gpe(this.container.styles.opacity)),this.container.styles.transform!==null){var d=this.container.bounds.left+this.container.styles.transformOrigin[0].number,h=this.container.bounds.top+this.container.styles.transformOrigin[1].number,p=this.container.styles.transform;this.effects.push(new Hpe(d,h,p))}if(this.container.styles.overflowX!==0){var g=Xy(this.curves),x=Jy(this.curves);k8(g,x)?this.effects.push(new ay(g,6)):(this.effects.push(new ay(g,2)),this.effects.push(new ay(x,4)))}}return a.prototype.getEffects=function(o){for(var c=[2,3].indexOf(this.container.styles.position)===-1,d=this.parent,h=this.effects.slice(0);d;){var p=d.effects.filter(function(v){return!E7(v)});if(c||d.container.styles.position!==0||!d.parent){if(h.unshift.apply(h,p),c=[2,3].indexOf(d.container.styles.position)===-1,d.container.styles.overflowX!==0){var g=Xy(d.curves),x=Jy(d.curves);k8(g,x)||h.unshift(new ay(x,6))}}else h.unshift.apply(h,p);d=d.parent}return h.filter(function(v){return la(v.target,o)})},a}(),LR=function(a,o,c,d){a.container.elements.forEach(function(h){var p=la(h.flags,4),g=la(h.flags,2),x=new S7(h,a);la(h.styles.display,2048)&&d.push(x);var v=la(h.flags,8)?[]:d;if(p||g){var E=p||h.styles.isPositioned()?c:o,C=new C7(x);if(h.styles.isPositioned()||h.styles.opacity<1||h.styles.isTransformed()){var I=h.styles.zIndex.order;if(I<0){var O=0;E.negativeZIndex.some(function(k,M){return I>k.element.container.styles.zIndex.order?(O=M,!1):O>0}),E.negativeZIndex.splice(O,0,C)}else if(I>0){var R=0;E.positiveZIndex.some(function(k,M){return I>=k.element.container.styles.zIndex.order?(R=M+1,!1):R>0}),E.positiveZIndex.splice(R,0,C)}else E.zeroOrAutoZIndexOrTransformedOrOpacity.push(C)}else h.styles.isFloating()?E.nonPositionedFloats.push(C):E.nonPositionedInlineLevel.push(C);LR(x,C,p?C:c,v)}else h.styles.isInlineLevel()?o.inlineLevel.push(x):o.nonInlineLevel.push(x),LR(x,o,c,v);la(h.flags,8)&&N7(h,v)})},N7=function(a,o){for(var c=a instanceof IR?a.start:1,d=a instanceof IR?a.reversed:!1,h=0;h<o.length;h++){var p=o[h];p.container instanceof d7&&typeof p.container.value=="number"&&p.container.value!==0&&(c=p.container.value),p.listValue=nx(c,p.container.styles.listStyleType,!0),c+=d?-1:1}},qpe=function(a){var o=new S7(a,null),c=new C7(o),d=[];return LR(o,c,c,d),N7(o.container,d),c},D8=function(a,o){switch(o){case 0:return pl(a.topLeftBorderBox,a.topLeftPaddingBox,a.topRightBorderBox,a.topRightPaddingBox);case 1:return pl(a.topRightBorderBox,a.topRightPaddingBox,a.bottomRightBorderBox,a.bottomRightPaddingBox);case 2:return pl(a.bottomRightBorderBox,a.bottomRightPaddingBox,a.bottomLeftBorderBox,a.bottomLeftPaddingBox);case 3:default:return pl(a.bottomLeftBorderBox,a.bottomLeftPaddingBox,a.topLeftBorderBox,a.topLeftPaddingBox)}},Ype=function(a,o){switch(o){case 0:return pl(a.topLeftBorderBox,a.topLeftBorderDoubleOuterBox,a.topRightBorderBox,a.topRightBorderDoubleOuterBox);case 1:return pl(a.topRightBorderBox,a.topRightBorderDoubleOuterBox,a.bottomRightBorderBox,a.bottomRightBorderDoubleOuterBox);case 2:return pl(a.bottomRightBorderBox,a.bottomRightBorderDoubleOuterBox,a.bottomLeftBorderBox,a.bottomLeftBorderDoubleOuterBox);case 3:default:return pl(a.bottomLeftBorderBox,a.bottomLeftBorderDoubleOuterBox,a.topLeftBorderBox,a.topLeftBorderDoubleOuterBox)}},Xpe=function(a,o){switch(o){case 0:return pl(a.topLeftBorderDoubleInnerBox,a.topLeftPaddingBox,a.topRightBorderDoubleInnerBox,a.topRightPaddingBox);case 1:return pl(a.topRightBorderDoubleInnerBox,a.topRightPaddingBox,a.bottomRightBorderDoubleInnerBox,a.bottomRightPaddingBox);case 2:return pl(a.bottomRightBorderDoubleInnerBox,a.bottomRightPaddingBox,a.bottomLeftBorderDoubleInnerBox,a.bottomLeftPaddingBox);case 3:default:return pl(a.bottomLeftBorderDoubleInnerBox,a.bottomLeftPaddingBox,a.topLeftBorderDoubleInnerBox,a.topLeftPaddingBox)}},Jpe=function(a,o){switch(o){case 0:return oy(a.topLeftBorderStroke,a.topRightBorderStroke);case 1:return oy(a.topRightBorderStroke,a.bottomRightBorderStroke);case 2:return oy(a.bottomRightBorderStroke,a.bottomLeftBorderStroke);case 3:default:return oy(a.bottomLeftBorderStroke,a.topLeftBorderStroke)}},oy=function(a,o){var c=[];return dl(a)?c.push(a.subdivide(.5,!1)):c.push(a),dl(o)?c.push(o.subdivide(.5,!0)):c.push(o),c},pl=function(a,o,c,d){var h=[];return dl(a)?h.push(a.subdivide(.5,!1)):h.push(a),dl(c)?h.push(c.subdivide(.5,!0)):h.push(c),dl(d)?h.push(d.subdivide(.5,!0).reverse()):h.push(d),dl(o)?h.push(o.subdivide(.5,!1).reverse()):h.push(o),h},T7=function(a){var o=a.bounds,c=a.styles;return o.add(c.borderLeftWidth,c.borderTopWidth,-(c.borderRightWidth+c.borderLeftWidth),-(c.borderTopWidth+c.borderBottomWidth))},$y=function(a){var o=a.styles,c=a.bounds,d=Qn(o.paddingLeft,c.width),h=Qn(o.paddingRight,c.width),p=Qn(o.paddingTop,c.width),g=Qn(o.paddingBottom,c.width);return c.add(d+o.borderLeftWidth,p+o.borderTopWidth,-(o.borderRightWidth+o.borderLeftWidth+d+h),-(o.borderTopWidth+o.borderBottomWidth+p+g))},$pe=function(a,o){return a===0?o.bounds:a===2?$y(o):T7(o)},Zpe=function(a,o){return a===0?o.bounds:a===2?$y(o):T7(o)},vT=function(a,o,c){var d=$pe(ug(a.styles.backgroundOrigin,o),a),h=Zpe(ug(a.styles.backgroundClip,o),a),p=eme(ug(a.styles.backgroundSize,o),c,d),g=p[0],x=p[1],v=Qb(ug(a.styles.backgroundPosition,o),d.width-g,d.height-x),E=tme(ug(a.styles.backgroundRepeat,o),v,p,d,h),C=Math.round(d.left+v[0]),I=Math.round(d.top+v[1]);return[E,C,I,g,x]},ng=function(a){return Rn(a)&&a.value===bg.AUTO},cy=function(a){return typeof a=="number"},eme=function(a,o,c){var d=o[0],h=o[1],p=o[2],g=a[0],x=a[1];if(!g)return[0,0];if(Zi(g)&&x&&Zi(x))return[Qn(g,c.width),Qn(x,c.height)];var v=cy(p);if(Rn(g)&&(g.value===bg.CONTAIN||g.value===bg.COVER)){if(cy(p)){var E=c.width/c.height;return E<p!=(g.value===bg.COVER)?[c.width,c.width/p]:[c.height*p,c.height]}return[c.width,c.height]}var C=cy(d),I=cy(h),O=C||I;if(ng(g)&&(!x||ng(x))){if(C&&I)return[d,h];if(!v&&!O)return[c.width,c.height];if(O&&v){var R=C?d:h*p,k=I?h:d/p;return[R,k]}var M=C?d:c.width,P=I?h:c.height;return[M,P]}if(v){var H=0,$=0;return Zi(g)?H=Qn(g,c.width):Zi(x)&&($=Qn(x,c.height)),ng(g)?H=$*p:(!x||ng(x))&&($=H/p),[H,$]}var re=null,J=null;if(Zi(g)?re=Qn(g,c.width):x&&Zi(x)&&(J=Qn(x,c.height)),re!==null&&(!x||ng(x))&&(J=C&&I?re/d*h:c.height),J!==null&&ng(g)&&(re=C&&I?J/h*d:c.width),re!==null&&J!==null)return[re,J];throw new Error("Unable to calculate background-size for element")},ug=function(a,o){var c=a[o];return typeof c>"u"?a[0]:c},tme=function(a,o,c,d,h){var p=o[0],g=o[1],x=c[0],v=c[1];switch(a){case 2:return[new fs(Math.round(d.left),Math.round(d.top+g)),new fs(Math.round(d.left+d.width),Math.round(d.top+g)),new fs(Math.round(d.left+d.width),Math.round(v+d.top+g)),new fs(Math.round(d.left),Math.round(v+d.top+g))];case 3:return[new fs(Math.round(d.left+p),Math.round(d.top)),new fs(Math.round(d.left+p+x),Math.round(d.top)),new fs(Math.round(d.left+p+x),Math.round(d.height+d.top)),new fs(Math.round(d.left+p),Math.round(d.height+d.top))];case 1:return[new fs(Math.round(d.left+p),Math.round(d.top+g)),new fs(Math.round(d.left+p+x),Math.round(d.top+g)),new fs(Math.round(d.left+p+x),Math.round(d.top+g+v)),new fs(Math.round(d.left+p),Math.round(d.top+g+v))];default:return[new fs(Math.round(h.left),Math.round(h.top)),new fs(Math.round(h.left+h.width),Math.round(h.top)),new fs(Math.round(h.left+h.width),Math.round(h.height+h.top)),new fs(Math.round(h.left),Math.round(h.height+h.top))]}},sme="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",B8="Hidden Text",rme=function(){function a(o){this._data={},this._document=o}return a.prototype.parseMetrics=function(o,c){var d=this._document.createElement("div"),h=this._document.createElement("img"),p=this._document.createElement("span"),g=this._document.body;d.style.visibility="hidden",d.style.fontFamily=o,d.style.fontSize=c,d.style.margin="0",d.style.padding="0",d.style.whiteSpace="nowrap",g.appendChild(d),h.src=sme,h.width=1,h.height=1,h.style.margin="0",h.style.padding="0",h.style.verticalAlign="baseline",p.style.fontFamily=o,p.style.fontSize=c,p.style.margin="0",p.style.padding="0",p.appendChild(this._document.createTextNode(B8)),d.appendChild(p),d.appendChild(h);var x=h.offsetTop-p.offsetTop+2;d.removeChild(p),d.appendChild(this._document.createTextNode(B8)),d.style.lineHeight="normal",h.style.verticalAlign="super";var v=h.offsetTop-d.offsetTop+2;return g.removeChild(d),{baseline:x,middle:v}},a.prototype.getMetrics=function(o,c){var d=o+" "+c;return typeof this._data[d]>"u"&&(this._data[d]=this.parseMetrics(o,c)),this._data[d]},a}(),R7=function(){function a(o,c){this.context=o,this.options=c}return a}(),nme=1e4,ime=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h._activeEffects=[],h.canvas=d.canvas?d.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),d.canvas||(h.canvas.width=Math.floor(d.width*d.scale),h.canvas.height=Math.floor(d.height*d.scale),h.canvas.style.width=d.width+"px",h.canvas.style.height=d.height+"px"),h.fontMetrics=new rme(document),h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-d.x,-d.y),h.ctx.textBaseline="bottom",h._activeEffects=[],h.context.logger.debug("Canvas renderer initialized ("+d.width+"x"+d.height+") with scale "+d.scale),h}return o.prototype.applyEffects=function(c){for(var d=this;this._activeEffects.length;)this.popEffect();c.forEach(function(h){return d.applyEffect(h)})},o.prototype.applyEffect=function(c){this.ctx.save(),Wpe(c)&&(this.ctx.globalAlpha=c.opacity),Kpe(c)&&(this.ctx.translate(c.offsetX,c.offsetY),this.ctx.transform(c.matrix[0],c.matrix[1],c.matrix[2],c.matrix[3],c.matrix[4],c.matrix[5]),this.ctx.translate(-c.offsetX,-c.offsetY)),E7(c)&&(this.path(c.path),this.ctx.clip()),this._activeEffects.push(c)},o.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},o.prototype.renderStack=function(c){return No(this,void 0,void 0,function(){var d;return ao(this,function(h){switch(h.label){case 0:return d=c.element.container.styles,d.isVisible()?[4,this.renderStackContent(c)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},o.prototype.renderNode=function(c){return No(this,void 0,void 0,function(){return ao(this,function(d){switch(d.label){case 0:if(la(c.container.flags,16))debugger;return c.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(c)]:[3,3];case 1:return d.sent(),[4,this.renderNodeContent(c)];case 2:d.sent(),d.label=3;case 3:return[2]}})})},o.prototype.renderTextWithLetterSpacing=function(c,d,h){var p=this;if(d===0)this.ctx.fillText(c.text,c.bounds.left,c.bounds.top+h);else{var g=AI(c.text);g.reduce(function(x,v){return p.ctx.fillText(v,x,c.bounds.top+h),x+p.ctx.measureText(v).width},c.bounds.left)}},o.prototype.createFontStyle=function(c){var d=c.fontVariant.filter(function(g){return g==="normal"||g==="small-caps"}).join(""),h=dme(c.fontFamily).join(", "),p=fx(c.fontSize)?""+c.fontSize.number+c.fontSize.unit:c.fontSize.number+"px";return[[c.fontStyle,d,c.fontWeight,p,h].join(" "),h,p]},o.prototype.renderTextNode=function(c,d){return No(this,void 0,void 0,function(){var h,p,g,x,v,E,C,I,O=this;return ao(this,function(R){return h=this.createFontStyle(d),p=h[0],g=h[1],x=h[2],this.ctx.font=p,this.ctx.direction=d.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",v=this.fontMetrics.getMetrics(g,x),E=v.baseline,C=v.middle,I=d.paintOrder,c.textBounds.forEach(function(k){I.forEach(function(M){switch(M){case 0:O.ctx.fillStyle=ya(d.color),O.renderTextWithLetterSpacing(k,d.letterSpacing,E);var P=d.textShadow;P.length&&k.text.trim().length&&(P.slice(0).reverse().forEach(function(H){O.ctx.shadowColor=ya(H.color),O.ctx.shadowOffsetX=H.offsetX.number*O.options.scale,O.ctx.shadowOffsetY=H.offsetY.number*O.options.scale,O.ctx.shadowBlur=H.blur.number,O.renderTextWithLetterSpacing(k,d.letterSpacing,E)}),O.ctx.shadowColor="",O.ctx.shadowOffsetX=0,O.ctx.shadowOffsetY=0,O.ctx.shadowBlur=0),d.textDecorationLine.length&&(O.ctx.fillStyle=ya(d.textDecorationColor||d.color),d.textDecorationLine.forEach(function(H){switch(H){case 1:O.ctx.fillRect(k.bounds.left,Math.round(k.bounds.top+E),k.bounds.width,1);break;case 2:O.ctx.fillRect(k.bounds.left,Math.round(k.bounds.top),k.bounds.width,1);break;case 3:O.ctx.fillRect(k.bounds.left,Math.ceil(k.bounds.top+C),k.bounds.width,1);break}}));break;case 1:d.webkitTextStrokeWidth&&k.text.trim().length&&(O.ctx.strokeStyle=ya(d.webkitTextStrokeColor),O.ctx.lineWidth=d.webkitTextStrokeWidth,O.ctx.lineJoin=window.chrome?"miter":"round",O.ctx.strokeText(k.text,k.bounds.left,k.bounds.top+E)),O.ctx.strokeStyle="",O.ctx.lineWidth=0,O.ctx.lineJoin="miter";break}})}),[2]})})},o.prototype.renderReplacedElement=function(c,d,h){if(h&&c.intrinsicWidth>0&&c.intrinsicHeight>0){var p=$y(c),g=Jy(d);this.path(g),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(h,0,0,c.intrinsicWidth,c.intrinsicHeight,p.left,p.top,p.width,p.height),this.ctx.restore()}},o.prototype.renderNodeContent=function(c){return No(this,void 0,void 0,function(){var d,h,p,g,x,v,$,$,E,C,I,O,J,R,k,ge,M,P,H,$,re,J,ge;return ao(this,function(ie){switch(ie.label){case 0:this.applyEffects(c.getEffects(4)),d=c.container,h=c.curves,p=d.styles,g=0,x=d.textNodes,ie.label=1;case 1:return g<x.length?(v=x[g],[4,this.renderTextNode(v,p)]):[3,4];case 2:ie.sent(),ie.label=3;case 3:return g++,[3,1];case 4:if(!(d instanceof o7))return[3,8];ie.label=5;case 5:return ie.trys.push([5,7,,8]),[4,this.context.cache.match(d.src)];case 6:return $=ie.sent(),this.renderReplacedElement(d,h,$),[3,8];case 7:return ie.sent(),this.context.logger.error("Error loading image "+d.src),[3,8];case 8:if(d instanceof c7&&this.renderReplacedElement(d,h,d.canvas),!(d instanceof l7))return[3,12];ie.label=9;case 9:return ie.trys.push([9,11,,12]),[4,this.context.cache.match(d.svg)];case 10:return $=ie.sent(),this.renderReplacedElement(d,h,$),[3,12];case 11:return ie.sent(),this.context.logger.error("Error loading svg "+d.svg.substring(0,255)),[3,12];case 12:return d instanceof h7&&d.tree?(E=new o(this.context,{scale:this.options.scale,backgroundColor:d.backgroundColor,x:0,y:0,width:d.width,height:d.height}),[4,E.render(d.tree)]):[3,14];case 13:C=ie.sent(),d.width&&d.height&&this.ctx.drawImage(C,0,0,d.width,d.height,d.bounds.left,d.bounds.top,d.bounds.width,d.bounds.height),ie.label=14;case 14:if(d instanceof uI&&(I=Math.min(d.bounds.width,d.bounds.height),d.type===Wy?d.checked&&(this.ctx.save(),this.path([new fs(d.bounds.left+I*.39363,d.bounds.top+I*.79),new fs(d.bounds.left+I*.16,d.bounds.top+I*.5549),new fs(d.bounds.left+I*.27347,d.bounds.top+I*.44071),new fs(d.bounds.left+I*.39694,d.bounds.top+I*.5649),new fs(d.bounds.left+I*.72983,d.bounds.top+I*.23),new fs(d.bounds.left+I*.84,d.bounds.top+I*.34085),new fs(d.bounds.left+I*.39363,d.bounds.top+I*.79)]),this.ctx.fillStyle=ya(w8),this.ctx.fill(),this.ctx.restore()):d.type===zy&&d.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(d.bounds.left+I/2,d.bounds.top+I/2,I/4,0,Math.PI*2,!0),this.ctx.fillStyle=ya(w8),this.ctx.fill(),this.ctx.restore())),ame(d)&&d.value.length){switch(O=this.createFontStyle(p),J=O[0],R=O[1],k=this.fontMetrics.getMetrics(J,R).baseline,this.ctx.font=J,this.ctx.fillStyle=ya(p.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=cme(d.styles.textAlign),ge=$y(d),M=0,d.styles.textAlign){case 1:M+=ge.width/2;break;case 2:M+=ge.width;break}P=ge.add(M,0,0,-ge.height/2+1),this.ctx.save(),this.path([new fs(ge.left,ge.top),new fs(ge.left+ge.width,ge.top),new fs(ge.left+ge.width,ge.top+ge.height),new fs(ge.left,ge.top+ge.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Yb(d.value,P),p.letterSpacing,k),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!la(d.styles.display,2048))return[3,20];if(d.styles.listStyleImage===null)return[3,19];if(H=d.styles.listStyleImage,H.type!==0)return[3,18];$=void 0,re=H.url,ie.label=15;case 15:return ie.trys.push([15,17,,18]),[4,this.context.cache.match(re)];case 16:return $=ie.sent(),this.ctx.drawImage($,d.bounds.left-($.width+10),d.bounds.top),[3,18];case 17:return ie.sent(),this.context.logger.error("Error loading list-style-image "+re),[3,18];case 18:return[3,20];case 19:c.listValue&&d.styles.listStyleType!==-1&&(J=this.createFontStyle(p)[0],this.ctx.font=J,this.ctx.fillStyle=ya(p.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",ge=new YA(d.bounds.left,d.bounds.top+Qn(d.styles.paddingTop,d.bounds.width),d.bounds.width,n8(p.lineHeight,p.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Yb(c.listValue,ge),p.letterSpacing,n8(p.lineHeight,p.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),ie.label=20;case 20:return[2]}})})},o.prototype.renderStackContent=function(c){return No(this,void 0,void 0,function(){var d,h,H,p,g,H,x,v,H,E,C,H,I,O,H,R,k,H,M,P,H;return ao(this,function($){switch($.label){case 0:if(la(c.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(c.element)];case 1:$.sent(),d=0,h=c.negativeZIndex,$.label=2;case 2:return d<h.length?(H=h[d],[4,this.renderStack(H)]):[3,5];case 3:$.sent(),$.label=4;case 4:return d++,[3,2];case 5:return[4,this.renderNodeContent(c.element)];case 6:$.sent(),p=0,g=c.nonInlineLevel,$.label=7;case 7:return p<g.length?(H=g[p],[4,this.renderNode(H)]):[3,10];case 8:$.sent(),$.label=9;case 9:return p++,[3,7];case 10:x=0,v=c.nonPositionedFloats,$.label=11;case 11:return x<v.length?(H=v[x],[4,this.renderStack(H)]):[3,14];case 12:$.sent(),$.label=13;case 13:return x++,[3,11];case 14:E=0,C=c.nonPositionedInlineLevel,$.label=15;case 15:return E<C.length?(H=C[E],[4,this.renderStack(H)]):[3,18];case 16:$.sent(),$.label=17;case 17:return E++,[3,15];case 18:I=0,O=c.inlineLevel,$.label=19;case 19:return I<O.length?(H=O[I],[4,this.renderNode(H)]):[3,22];case 20:$.sent(),$.label=21;case 21:return I++,[3,19];case 22:R=0,k=c.zeroOrAutoZIndexOrTransformedOrOpacity,$.label=23;case 23:return R<k.length?(H=k[R],[4,this.renderStack(H)]):[3,26];case 24:$.sent(),$.label=25;case 25:return R++,[3,23];case 26:M=0,P=c.positiveZIndex,$.label=27;case 27:return M<P.length?(H=P[M],[4,this.renderStack(H)]):[3,30];case 28:$.sent(),$.label=29;case 29:return M++,[3,27];case 30:return[2]}})})},o.prototype.mask=function(c){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(c.slice(0).reverse()),this.ctx.closePath()},o.prototype.path=function(c){this.ctx.beginPath(),this.formatPath(c),this.ctx.closePath()},o.prototype.formatPath=function(c){var d=this;c.forEach(function(h,p){var g=dl(h)?h.start:h;p===0?d.ctx.moveTo(g.x,g.y):d.ctx.lineTo(g.x,g.y),dl(h)&&d.ctx.bezierCurveTo(h.startControl.x,h.startControl.y,h.endControl.x,h.endControl.y,h.end.x,h.end.y)})},o.prototype.renderRepeat=function(c,d,h,p){this.path(c),this.ctx.fillStyle=d,this.ctx.translate(h,p),this.ctx.fill(),this.ctx.translate(-h,-p)},o.prototype.resizeImage=function(c,d,h){var p;if(c.width===d&&c.height===h)return c;var g=(p=this.canvas.ownerDocument)!==null&&p!==void 0?p:document,x=g.createElement("canvas");x.width=Math.max(1,d),x.height=Math.max(1,h);var v=x.getContext("2d");return v.drawImage(c,0,0,c.width,c.height,0,0,d,h),x},o.prototype.renderBackgroundImage=function(c){return No(this,void 0,void 0,function(){var d,h,p,g,x,v;return ao(this,function(E){switch(E.label){case 0:d=c.styles.backgroundImage.length-1,h=function(C){var I,O,R,ce,he,Ne,te,se,Ae,k,ce,he,Ne,te,se,M,P,H,$,re,J,ge,ie,we,Ae,V,ce,Y,z,te,se,Ce,he,Ne,Z,Ie,Ve,Pe,ne,ve,ue,Te;return ao(this,function(Be){switch(Be.label){case 0:if(C.type!==0)return[3,5];I=void 0,O=C.url,Be.label=1;case 1:return Be.trys.push([1,3,,4]),[4,p.context.cache.match(O)];case 2:return I=Be.sent(),[3,4];case 3:return Be.sent(),p.context.logger.error("Error loading background-image "+O),[3,4];case 4:return I&&(R=vT(c,d,[I.width,I.height,I.width/I.height]),ce=R[0],he=R[1],Ne=R[2],te=R[3],se=R[4],Ae=p.ctx.createPattern(p.resizeImage(I,te,se),"repeat"),p.renderRepeat(ce,Ae,he,Ne)),[3,6];case 5:KAe(C)?(k=vT(c,d,[null,null,null]),ce=k[0],he=k[1],Ne=k[2],te=k[3],se=k[4],M=MAe(C.angle,te,se),P=M[0],H=M[1],$=M[2],re=M[3],J=M[4],ge=document.createElement("canvas"),ge.width=te,ge.height=se,ie=ge.getContext("2d"),we=ie.createLinearGradient(H,re,$,J),s8(C.stops,P).forEach(function(Ue){return we.addColorStop(Ue.stop,ya(Ue.color))}),ie.fillStyle=we,ie.fillRect(0,0,te,se),te>0&&se>0&&(Ae=p.ctx.createPattern(ge,"repeat"),p.renderRepeat(ce,Ae,he,Ne))):WAe(C)&&(V=vT(c,d,[null,null,null]),ce=V[0],Y=V[1],z=V[2],te=V[3],se=V[4],Ce=C.position.length===0?[cI]:C.position,he=Qn(Ce[0],te),Ne=Qn(Ce[Ce.length-1],se),Z=VAe(C,he,Ne,te,se),Ie=Z[0],Ve=Z[1],Ie>0&&Ve>0&&(Pe=p.ctx.createRadialGradient(Y+he,z+Ne,0,Y+he,z+Ne,Ie),s8(C.stops,Ie*2).forEach(function(Ue){return Pe.addColorStop(Ue.stop,ya(Ue.color))}),p.path(ce),p.ctx.fillStyle=Pe,Ie!==Ve?(ne=c.bounds.left+.5*c.bounds.width,ve=c.bounds.top+.5*c.bounds.height,ue=Ve/Ie,Te=1/ue,p.ctx.save(),p.ctx.translate(ne,ve),p.ctx.transform(1,0,0,ue,0,0),p.ctx.translate(-ne,-ve),p.ctx.fillRect(Y,Te*(z-ve)+ve,te,se*Te),p.ctx.restore()):p.ctx.fill())),Be.label=6;case 6:return d--,[2]}})},p=this,g=0,x=c.styles.backgroundImage.slice(0).reverse(),E.label=1;case 1:return g<x.length?(v=x[g],[5,h(v)]):[3,4];case 2:E.sent(),E.label=3;case 3:return g++,[3,1];case 4:return[2]}})})},o.prototype.renderSolidBorder=function(c,d,h){return No(this,void 0,void 0,function(){return ao(this,function(p){return this.path(D8(h,d)),this.ctx.fillStyle=ya(c),this.ctx.fill(),[2]})})},o.prototype.renderDoubleBorder=function(c,d,h,p){return No(this,void 0,void 0,function(){var g,x;return ao(this,function(v){switch(v.label){case 0:return d<3?[4,this.renderSolidBorder(c,h,p)]:[3,2];case 1:return v.sent(),[2];case 2:return g=Ype(p,h),this.path(g),this.ctx.fillStyle=ya(c),this.ctx.fill(),x=Xpe(p,h),this.path(x),this.ctx.fill(),[2]}})})},o.prototype.renderNodeBackgroundAndBorders=function(c){return No(this,void 0,void 0,function(){var d,h,p,g,x,v,E,C,I=this;return ao(this,function(O){switch(O.label){case 0:return this.applyEffects(c.getEffects(2)),d=c.container.styles,h=!ch(d.backgroundColor)||d.backgroundImage.length,p=[{style:d.borderTopStyle,color:d.borderTopColor,width:d.borderTopWidth},{style:d.borderRightStyle,color:d.borderRightColor,width:d.borderRightWidth},{style:d.borderBottomStyle,color:d.borderBottomColor,width:d.borderBottomWidth},{style:d.borderLeftStyle,color:d.borderLeftColor,width:d.borderLeftWidth}],g=ome(ug(d.backgroundClip,0),c.curves),h||d.boxShadow.length?(this.ctx.save(),this.path(g),this.ctx.clip(),ch(d.backgroundColor)||(this.ctx.fillStyle=ya(d.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:O.sent(),this.ctx.restore(),d.boxShadow.slice(0).reverse().forEach(function(R){I.ctx.save();var k=Xy(c.curves),M=R.inset?0:nme,P=zpe(k,-M+(R.inset?1:-1)*R.spread.number,(R.inset?1:-1)*R.spread.number,R.spread.number*(R.inset?-2:2),R.spread.number*(R.inset?-2:2));R.inset?(I.path(k),I.ctx.clip(),I.mask(P)):(I.mask(k),I.ctx.clip(),I.path(P)),I.ctx.shadowOffsetX=R.offsetX.number+M,I.ctx.shadowOffsetY=R.offsetY.number,I.ctx.shadowColor=ya(R.color),I.ctx.shadowBlur=R.blur.number,I.ctx.fillStyle=R.inset?ya(R.color):"rgba(0,0,0,1)",I.ctx.fill(),I.ctx.restore()}),O.label=2;case 2:x=0,v=0,E=p,O.label=3;case 3:return v<E.length?(C=E[v],C.style!==0&&!ch(C.color)&&C.width>0?C.style!==2?[3,5]:[4,this.renderDashedDottedBorder(C.color,C.width,x,c.curves,2)]:[3,11]):[3,13];case 4:return O.sent(),[3,11];case 5:return C.style!==3?[3,7]:[4,this.renderDashedDottedBorder(C.color,C.width,x,c.curves,3)];case 6:return O.sent(),[3,11];case 7:return C.style!==4?[3,9]:[4,this.renderDoubleBorder(C.color,C.width,x,c.curves)];case 8:return O.sent(),[3,11];case 9:return[4,this.renderSolidBorder(C.color,x,c.curves)];case 10:O.sent(),O.label=11;case 11:x++,O.label=12;case 12:return v++,[3,3];case 13:return[2]}})})},o.prototype.renderDashedDottedBorder=function(c,d,h,p,g){return No(this,void 0,void 0,function(){var x,v,E,C,I,O,R,k,M,P,H,$,re,J,ge,ie,ge,ie;return ao(this,function(we){return this.ctx.save(),x=Jpe(p,h),v=D8(p,h),g===2&&(this.path(v),this.ctx.clip()),dl(v[0])?(E=v[0].start.x,C=v[0].start.y):(E=v[0].x,C=v[0].y),dl(v[1])?(I=v[1].end.x,O=v[1].end.y):(I=v[1].x,O=v[1].y),h===0||h===2?R=Math.abs(E-I):R=Math.abs(C-O),this.ctx.beginPath(),g===3?this.formatPath(x):this.formatPath(v.slice(0,2)),k=d<3?d*3:d*2,M=d<3?d*2:d,g===3&&(k=d,M=d),P=!0,R<=k*2?P=!1:R<=k*2+M?(H=R/(2*k+M),k*=H,M*=H):($=Math.floor((R+M)/(k+M)),re=(R-$*k)/($-1),J=(R-($+1)*k)/$,M=J<=0||Math.abs(M-re)<Math.abs(M-J)?re:J),P&&(g===3?this.ctx.setLineDash([0,k+M]):this.ctx.setLineDash([k,M])),g===3?(this.ctx.lineCap="round",this.ctx.lineWidth=d):this.ctx.lineWidth=d*2+1.1,this.ctx.strokeStyle=ya(c),this.ctx.stroke(),this.ctx.setLineDash([]),g===2&&(dl(v[0])&&(ge=v[3],ie=v[0],this.ctx.beginPath(),this.formatPath([new fs(ge.end.x,ge.end.y),new fs(ie.start.x,ie.start.y)]),this.ctx.stroke()),dl(v[1])&&(ge=v[1],ie=v[2],this.ctx.beginPath(),this.formatPath([new fs(ge.end.x,ge.end.y),new fs(ie.start.x,ie.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},o.prototype.render=function(c){return No(this,void 0,void 0,function(){var d;return ao(this,function(h){switch(h.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ya(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),d=qpe(c),[4,this.renderStack(d)];case 1:return h.sent(),this.applyEffects([]),[2,this.canvas]}})})},o}(R7),ame=function(a){return a instanceof u7||a instanceof A7?!0:a instanceof uI&&a.type!==zy&&a.type!==Wy},ome=function(a,o){switch(a){case 0:return Xy(o);case 2:return Qpe(o);case 1:default:return Jy(o)}},cme=function(a){switch(a){case 1:return"center";case 2:return"right";case 0:default:return"left"}},lme=["-apple-system","system-ui"],dme=function(a){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?a.filter(function(o){return lme.indexOf(o)===-1}):a},Ame=function(a){id(o,a);function o(c,d){var h=a.call(this,c,d)||this;return h.canvas=d.canvas?d.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),h.options=d,h.canvas.width=Math.floor(d.width*d.scale),h.canvas.height=Math.floor(d.height*d.scale),h.canvas.style.width=d.width+"px",h.canvas.style.height=d.height+"px",h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-d.x,-d.y),h.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+d.width+"x"+d.height+" at "+d.x+","+d.y+") with scale "+d.scale),h}return o.prototype.render=function(c){return No(this,void 0,void 0,function(){var d,h;return ao(this,function(p){switch(p.label){case 0:return d=RR(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,c),[4,ume(d)];case 1:return h=p.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ya(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(h,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},o}(R7),ume=function(a){return new Promise(function(o,c){var d=new Image;d.onload=function(){o(d)},d.onerror=c,d.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(a))})},hme=function(){function a(o){var c=o.id,d=o.enabled;this.id=c,this.enabled=d,this.start=Date.now()}return a.prototype.debug=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,M_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.prototype.getTime=function(){return Date.now()-this.start},a.prototype.info=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,M_([this.id,this.getTime()+"ms"],o))},a.prototype.warn=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,M_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.prototype.error=function(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,M_([this.id,this.getTime()+"ms"],o)):this.info.apply(this,o))},a.instances={},a}(),pme=function(){function a(o,c){var d;this.windowBounds=c,this.instanceName="#"+a.instanceCount++,this.logger=new hme({id:this.instanceName,enabled:o.logging}),this.cache=(d=o.cache)!==null&&d!==void 0?d:new Bpe(this,o)}return a.instanceCount=1,a}(),I7=function(a,o){return o===void 0&&(o={}),mme(a,o)};typeof window<"u"&&y7.setContext(window);var mme=function(a,o){return No(void 0,void 0,void 0,function(){var c,d,h,p,g,x,v,E,C,I,O,R,k,M,P,H,$,re,J,ge,we,ie,we,Ae,V,ce,Y,z,te,se,Ce,he,Ne,Z,Ie,Ve,Pe,ne,ve,ue;return ao(this,function(Te){switch(Te.label){case 0:if(!a||typeof a!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(c=a.ownerDocument,!c)throw new Error("Element is not attached to a Document");if(d=c.defaultView,!d)throw new Error("Document is not attached to a Window");return h={allowTaint:(Ae=o.allowTaint)!==null&&Ae!==void 0?Ae:!1,imageTimeout:(V=o.imageTimeout)!==null&&V!==void 0?V:15e3,proxy:o.proxy,useCORS:(ce=o.useCORS)!==null&&ce!==void 0?ce:!1},p=pR({logging:(Y=o.logging)!==null&&Y!==void 0?Y:!0,cache:o.cache},h),g={windowWidth:(z=o.windowWidth)!==null&&z!==void 0?z:d.innerWidth,windowHeight:(te=o.windowHeight)!==null&&te!==void 0?te:d.innerHeight,scrollX:(se=o.scrollX)!==null&&se!==void 0?se:d.pageXOffset,scrollY:(Ce=o.scrollY)!==null&&Ce!==void 0?Ce:d.pageYOffset},x=new YA(g.scrollX,g.scrollY,g.windowWidth,g.windowHeight),v=new pme(p,x),E=(he=o.foreignObjectRendering)!==null&&he!==void 0?he:!1,C={allowTaint:(Ne=o.allowTaint)!==null&&Ne!==void 0?Ne:!1,onclone:o.onclone,ignoreElements:o.ignoreElements,inlineImages:E,copyStyles:E},v.logger.debug("Starting document clone with size "+x.width+"x"+x.height+" scrolled to "+-x.left+","+-x.top),I=new I8(v,a,C),O=I.clonedReferenceElement,O?[4,I.toIFrame(c,x)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return R=Te.sent(),k=hI(O)||gpe(O)?zle(O.ownerDocument):fE(v,O),M=k.width,P=k.height,H=k.left,$=k.top,re=fme(v,O,o.backgroundColor),J={canvas:o.canvas,backgroundColor:re,scale:(Ie=(Z=o.scale)!==null&&Z!==void 0?Z:d.devicePixelRatio)!==null&&Ie!==void 0?Ie:1,x:((Ve=o.x)!==null&&Ve!==void 0?Ve:0)+H,y:((Pe=o.y)!==null&&Pe!==void 0?Pe:0)+$,width:(ne=o.width)!==null&&ne!==void 0?ne:Math.ceil(M),height:(ve=o.height)!==null&&ve!==void 0?ve:Math.ceil(P)},E?(v.logger.debug("Document cloned, using foreign object rendering"),we=new Ame(v,J),[4,we.render(O)]):[3,3];case 2:return ge=Te.sent(),[3,5];case 3:return v.logger.debug("Document cloned, element located at "+H+","+$+" with size "+M+"x"+P+" using computed rendering"),v.logger.debug("Starting DOM parsing"),ie=m7(v,O),re===ie.styles.backgroundColor&&(ie.styles.backgroundColor=WA.TRANSPARENT),v.logger.debug("Starting renderer for element at "+J.x+","+J.y+" with size "+J.width+"x"+J.height),we=new ime(v,J),[4,we.render(ie)];case 4:ge=Te.sent(),Te.label=5;case 5:return(!((ue=o.removeContainer)!==null&&ue!==void 0)||ue)&&(I8.destroy(R)||v.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),v.logger.debug("Finished rendering"),[2,ge]}})})},fme=function(a,o,c){var d=o.ownerDocument,h=d.documentElement?zb(a,getComputedStyle(d.documentElement).backgroundColor):WA.TRANSPARENT,p=d.body?zb(a,getComputedStyle(d.body).backgroundColor):WA.TRANSPARENT,g=typeof c=="string"?zb(a,c):c===null?WA.TRANSPARENT:4294967295;return o===d.documentElement?ch(h)?ch(p)?g:p:h:g};const gme=Object.freeze(Object.defineProperty({__proto__:null,default:I7},Symbol.toStringTag,{value:"Module"})),bme="modulepreload",xme=function(a){return"/"+a},L8={},wT=function(o,c,d){let h=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),x=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));h=Promise.allSettled(c.map(v=>{if(v=xme(v),v in L8)return;L8[v]=!0;const E=v.endsWith(".css"),C=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${C}`))return;const I=document.createElement("link");if(I.rel=E?"stylesheet":bme,E||(I.as="script"),I.crossOrigin="",I.href=v,x&&I.setAttribute("nonce",x),document.head.appendChild(I),E)return new Promise((O,R)=>{I.addEventListener("load",O),I.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${v}`)))})}))}function p(g){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=g,window.dispatchEvent(x),!x.defaultPrevented)throw g}return h.then(g=>{for(const x of g||[])x.status==="rejected"&&p(x.reason);return o().catch(p)})};function _n(a){"@babel/helpers - typeof";return _n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_n(a)}var rd=Uint8Array,Rc=Uint16Array,pI=Int32Array,mI=new rd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fI=new rd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),j8=new rd([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O7=function(a,o){for(var c=new Rc(31),d=0;d<31;++d)c[d]=o+=1<<a[d-1];for(var h=new pI(c[30]),d=1;d<30;++d)for(var p=c[d];p<c[d+1];++p)h[p]=p-c[d]<<5|d;return{b:c,r:h}},k7=O7(mI,2),vme=k7.b,jR=k7.r;vme[28]=258,jR[258]=28;var wme=O7(fI,0),P8=wme.r,PR=new Rc(32768);for(var ei=0;ei<32768;++ei){var zu=(ei&43690)>>1|(ei&21845)<<1;zu=(zu&52428)>>2|(zu&13107)<<2,zu=(zu&61680)>>4|(zu&3855)<<4,PR[ei]=((zu&65280)>>8|(zu&255)<<8)>>1}var Jb=function(a,o,c){for(var d=a.length,h=0,p=new Rc(o);h<d;++h)a[h]&&++p[a[h]-1];var g=new Rc(o);for(h=1;h<o;++h)g[h]=g[h-1]+p[h-1]<<1;var x;if(c){x=new Rc(1<<o);var v=15-o;for(h=0;h<d;++h)if(a[h])for(var E=h<<4|a[h],C=o-a[h],I=g[a[h]-1]++<<C,O=I|(1<<C)-1;I<=O;++I)x[PR[I]>>v]=E}else for(x=new Rc(d),h=0;h<d;++h)a[h]&&(x[h]=PR[g[a[h]-1]++]>>15-a[h]);return x},tm=new rd(288);for(var ei=0;ei<144;++ei)tm[ei]=8;for(var ei=144;ei<256;++ei)tm[ei]=9;for(var ei=256;ei<280;++ei)tm[ei]=7;for(var ei=280;ei<288;++ei)tm[ei]=8;var Zy=new rd(32);for(var ei=0;ei<32;++ei)Zy[ei]=5;var _me=Jb(tm,9,0),yme=Jb(Zy,5,0),D7=function(a){return(a+7)/8|0},Eme=function(a,o,c){return(c==null||c>a.length)&&(c=a.length),new rd(a.subarray(o,c))},MA=function(a,o,c){c<<=o&7;var d=o/8|0;a[d]|=c,a[d+1]|=c>>8},Lb=function(a,o,c){c<<=o&7;var d=o/8|0;a[d]|=c,a[d+1]|=c>>8,a[d+2]|=c>>16},_T=function(a,o){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var h=c.length,p=c.slice();if(!h)return{t:L7,l:0};if(h==1){var g=new rd(c[0].s+1);return g[c[0].s]=1,{t:g,l:1}}c.sort(function(ge,ie){return ge.f-ie.f}),c.push({s:-1,f:25001});var x=c[0],v=c[1],E=0,C=1,I=2;for(c[0]={s:-1,f:x.f+v.f,l:x,r:v};C!=h-1;)x=c[c[E].f<c[I].f?E++:I++],v=c[E!=C&&c[E].f<c[I].f?E++:I++],c[C++]={s:-1,f:x.f+v.f,l:x,r:v};for(var O=p[0].s,d=1;d<h;++d)p[d].s>O&&(O=p[d].s);var R=new Rc(O+1),k=UR(c[C-1],R,0);if(k>o){var d=0,M=0,P=k-o,H=1<<P;for(p.sort(function(ie,we){return R[we.s]-R[ie.s]||ie.f-we.f});d<h;++d){var $=p[d].s;if(R[$]>o)M+=H-(1<<k-R[$]),R[$]=o;else break}for(M>>=P;M>0;){var re=p[d].s;R[re]<o?M-=1<<o-R[re]++-1:++d}for(;d>=0&&M;--d){var J=p[d].s;R[J]==o&&(--R[J],++M)}k=o}return{t:new rd(R),l:k}},UR=function(a,o,c){return a.s==-1?Math.max(UR(a.l,o,c+1),UR(a.r,o,c+1)):o[a.s]=c},U8=function(a){for(var o=a.length;o&&!a[--o];);for(var c=new Rc(++o),d=0,h=a[0],p=1,g=function(v){c[d++]=v},x=1;x<=o;++x)if(a[x]==h&&x!=o)++p;else{if(!h&&p>2){for(;p>138;p-=138)g(32754);p>2&&(g(p>10?p-11<<5|28690:p-3<<5|12305),p=0)}else if(p>3){for(g(h),--p;p>6;p-=6)g(8304);p>2&&(g(p-3<<5|8208),p=0)}for(;p--;)g(h);p=1,h=a[x]}return{c:c.subarray(0,d),n:o}},jb=function(a,o){for(var c=0,d=0;d<o.length;++d)c+=a[d]*o[d];return c},B7=function(a,o,c){var d=c.length,h=D7(o+2);a[h]=d&255,a[h+1]=d>>8,a[h+2]=a[h]^255,a[h+3]=a[h+1]^255;for(var p=0;p<d;++p)a[h+p+4]=c[p];return(h+4+d)*8},F8=function(a,o,c,d,h,p,g,x,v,E,C){MA(o,C++,c),++h[256];for(var I=_T(h,15),O=I.t,R=I.l,k=_T(p,15),M=k.t,P=k.l,H=U8(O),$=H.c,re=H.n,J=U8(M),ge=J.c,ie=J.n,we=new Rc(19),Ae=0;Ae<$.length;++Ae)++we[$[Ae]&31];for(var Ae=0;Ae<ge.length;++Ae)++we[ge[Ae]&31];for(var V=_T(we,7),ce=V.t,Y=V.l,z=19;z>4&&!ce[j8[z-1]];--z);var te=E+5<<3,se=jb(h,tm)+jb(p,Zy)+g,Ce=jb(h,O)+jb(p,M)+g+14+3*z+jb(we,ce)+2*we[16]+3*we[17]+7*we[18];if(v>=0&&te<=se&&te<=Ce)return B7(o,C,a.subarray(v,v+E));var he,Ne,Z,Ie;if(MA(o,C,1+(Ce<se)),C+=2,Ce<se){he=Jb(O,R,0),Ne=O,Z=Jb(M,P,0),Ie=M;var Ve=Jb(ce,Y,0);MA(o,C,re-257),MA(o,C+5,ie-1),MA(o,C+10,z-4),C+=14;for(var Ae=0;Ae<z;++Ae)MA(o,C+3*Ae,ce[j8[Ae]]);C+=3*z;for(var Pe=[$,ge],ne=0;ne<2;++ne)for(var ve=Pe[ne],Ae=0;Ae<ve.length;++Ae){var ue=ve[Ae]&31;MA(o,C,Ve[ue]),C+=ce[ue],ue>15&&(MA(o,C,ve[Ae]>>5&127),C+=ve[Ae]>>12)}}else he=_me,Ne=tm,Z=yme,Ie=Zy;for(var Ae=0;Ae<x;++Ae){var Te=d[Ae];if(Te>255){var ue=Te>>18&31;Lb(o,C,he[ue+257]),C+=Ne[ue+257],ue>7&&(MA(o,C,Te>>23&31),C+=mI[ue]);var Be=Te&31;Lb(o,C,Z[Be]),C+=Ie[Be],Be>3&&(Lb(o,C,Te>>5&8191),C+=fI[Be])}else Lb(o,C,he[Te]),C+=Ne[Te]}return Lb(o,C,he[256]),C+Ne[256]},Cme=new pI([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),L7=new rd(0),Sme=function(a,o,c,d,h,p){var g=p.z||a.length,x=new rd(d+g+5*(1+Math.ceil(g/7e3))+h),v=x.subarray(d,x.length-h),E=p.l,C=(p.r||0)&7;if(o){C&&(v[0]=p.r>>3);for(var I=Cme[o-1],O=I>>13,R=I&8191,k=(1<<c)-1,M=p.p||new Rc(32768),P=p.h||new Rc(k+1),H=Math.ceil(c/3),$=2*H,re=function(kt){return(a[kt]^a[kt+1]<<H^a[kt+2]<<$)&k},J=new pI(25e3),ge=new Rc(288),ie=new Rc(32),we=0,Ae=0,V=p.i||0,ce=0,Y=p.w||0,z=0;V+2<g;++V){var te=re(V),se=V&32767,Ce=P[te];if(M[se]=Ce,P[te]=se,Y<=V){var he=g-V;if((we>7e3||ce>24576)&&(he>423||!E)){C=F8(a,v,0,J,ge,ie,Ae,ce,z,V-z,C),ce=we=Ae=0,z=V;for(var Ne=0;Ne<286;++Ne)ge[Ne]=0;for(var Ne=0;Ne<30;++Ne)ie[Ne]=0}var Z=2,Ie=0,Ve=R,Pe=se-Ce&32767;if(he>2&&te==re(V-Pe))for(var ne=Math.min(O,he)-1,ve=Math.min(32767,V),ue=Math.min(258,he);Pe<=ve&&--Ve&&se!=Ce;){if(a[V+Z]==a[V+Z-Pe]){for(var Te=0;Te<ue&&a[V+Te]==a[V+Te-Pe];++Te);if(Te>Z){if(Z=Te,Ie=Pe,Te>ne)break;for(var Be=Math.min(Pe,Te-2),Ue=0,Ne=0;Ne<Be;++Ne){var tt=V-Pe+Ne&32767,ot=M[tt],ut=tt-ot&32767;ut>Ue&&(Ue=ut,Ce=tt)}}}se=Ce,Ce=M[se],Pe+=se-Ce&32767}if(Ie){J[ce++]=268435456|jR[Z]<<18|P8[Ie];var Tt=jR[Z]&31,Qe=P8[Ie]&31;Ae+=mI[Tt]+fI[Qe],++ge[257+Tt],++ie[Qe],Y=V+Z,++we}else J[ce++]=a[V],++ge[a[V]]}}for(V=Math.max(V,Y);V<g;++V)J[ce++]=a[V],++ge[a[V]];C=F8(a,v,E,J,ge,ie,Ae,ce,z,V-z,C),E||(p.r=C&7|v[C/8|0]<<3,C-=7,p.h=P,p.p=M,p.i=V,p.w=Y)}else{for(var V=p.w||0;V<g+E;V+=65535){var it=V+65535;it>=g&&(v[C/8|0]=E,it=g),C=B7(v,C+1,a.subarray(V,it))}p.i=g}return Eme(x,0,d+D7(C)+h)},j7=function(){var a=1,o=0;return{p:function(c){for(var d=a,h=o,p=c.length|0,g=0;g!=p;){for(var x=Math.min(g+2655,p);g<x;++g)h+=d+=c[g];d=(d&65535)+15*(d>>16),h=(h&65535)+15*(h>>16)}a=d,o=h},d:function(){return a%=65521,o%=65521,(a&255)<<24|(a&65280)<<8|(o&255)<<8|o>>8}}},Nme=function(a,o,c,d,h){if(!h&&(h={l:1},o.dictionary)){var p=o.dictionary.subarray(-32768),g=new rd(p.length+a.length);g.set(p),g.set(a,p.length),a=g,h.w=p.length}return Sme(a,o.level==null?6:o.level,o.mem==null?h.l?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):20:12+o.mem,c,d,h)},P7=function(a,o,c){for(;c;++o)a[o]=c,c>>>=8},Tme=function(a,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;if(a[0]=120,a[1]=d<<6|(o.dictionary&&32),a[1]|=31-(a[0]<<8|a[1])%31,o.dictionary){var h=j7();h.p(o.dictionary),P7(a,2,h.d())}};function FR(a,o){o||(o={});var c=j7();c.p(a);var d=Nme(a,o,o.dictionary?6:2,4);return Tme(d,o),P7(d,d.length-4,c.d()),d}var Rme=typeof TextDecoder<"u"&&new TextDecoder,Ime=0;try{Rme.decode(L7,{stream:!0}),Ime=1}catch{}function Ome(a){if(Array.isArray(a))return a}function kme(a,o){var c=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(c!=null){var d,h,p,g,x=[],v=!0,E=!1;try{if(p=(c=c.call(a)).next,o!==0)for(;!(v=(d=p.call(c)).done)&&(x.push(d.value),x.length!==o);v=!0);}catch(C){E=!0,h=C}finally{try{if(!v&&c.return!=null&&(g=c.return(),Object(g)!==g))return}finally{if(E)throw h}}return x}}function M8(a,o){(o==null||o>a.length)&&(o=a.length);for(var c=0,d=Array(o);c<o;c++)d[c]=a[c];return d}function Dme(a,o){if(a){if(typeof a=="string")return M8(a,o);var c={}.toString.call(a).slice(8,-1);return c==="Object"&&a.constructor&&(c=a.constructor.name),c==="Map"||c==="Set"?Array.from(a):c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?M8(a,o):void 0}}function Bme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V8(a,o){return Ome(a)||kme(a,o)||Dme(a,o)||Bme()}function Q8(a,o="utf8"){return new TextDecoder(o).decode(a)}const Lme=new TextEncoder;function jme(a){return Lme.encode(a)}const Pme=1024*8,Ume=(()=>{const a=new Uint8Array(4),o=new Uint32Array(a.buffer);return!((o[0]=1)&a[0])})(),yT={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class gI{constructor(o=Pme,c={}){vn(this,"buffer");vn(this,"byteLength");vn(this,"byteOffset");vn(this,"length");vn(this,"offset");vn(this,"lastWrittenByte");vn(this,"littleEndian");vn(this,"_data");vn(this,"_mark");vn(this,"_marks");let d=!1;typeof o=="number"?o=new ArrayBuffer(o):(d=!0,this.lastWrittenByte=o.byteLength);const h=c.offset?c.offset>>>0:0,p=o.byteLength-h;let g=h;(ArrayBuffer.isView(o)||o instanceof gI)&&(o.byteLength!==o.buffer.byteLength&&(g=o.byteOffset+h),o=o.buffer),d?this.lastWrittenByte=p:this.lastWrittenByte=0,this.buffer=o,this.length=p,this.byteLength=p,this.byteOffset=g,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,g,p),this._mark=0,this._marks=[]}available(o=1){return this.offset+o<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(o=1){return this.offset+=o,this}back(o=1){return this.offset-=o,this}seek(o){return this.offset=o,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const o=this._marks.pop();if(o===void 0)throw new Error("Mark stack empty");return this.seek(o),this}rewind(){return this.offset=0,this}ensureAvailable(o=1){if(!this.available(o)){const d=(this.offset+o)*2,h=new Uint8Array(d);h.set(new Uint8Array(this.buffer)),this.buffer=h.buffer,this.length=d,this.byteLength=d,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(o=1){return this.readArray(o,"uint8")}readArray(o,c){const d=yT[c].BYTES_PER_ELEMENT*o,h=this.byteOffset+this.offset,p=this.buffer.slice(h,h+d);if(this.littleEndian===Ume&&c!=="uint8"&&c!=="int8"){const x=new Uint8Array(this.buffer.slice(h,h+d));x.reverse();const v=new yT[c](x.buffer);return this.offset+=d,v.reverse(),v}const g=new yT[c](p);return this.offset+=d,g}readInt16(){const o=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,o}readUint16(){const o=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,o}readInt32(){const o=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,o}readUint32(){const o=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat32(){const o=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,o}readFloat64(){const o=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,o}readBigInt64(){const o=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,o}readBigUint64(){const o=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,o}readChar(){return String.fromCharCode(this.readInt8())}readChars(o=1){let c="";for(let d=0;d<o;d++)c+=this.readChar();return c}readUtf8(o=1){return Q8(this.readBytes(o))}decodeText(o=1,c="utf8"){return Q8(this.readBytes(o),c)}writeBoolean(o){return this.writeUint8(o?255:0),this}writeInt8(o){return this.ensureAvailable(1),this._data.setInt8(this.offset++,o),this._updateLastWrittenByte(),this}writeUint8(o){return this.ensureAvailable(1),this._data.setUint8(this.offset++,o),this._updateLastWrittenByte(),this}writeByte(o){return this.writeUint8(o)}writeBytes(o){this.ensureAvailable(o.length);for(let c=0;c<o.length;c++)this._data.setUint8(this.offset++,o[c]);return this._updateLastWrittenByte(),this}writeInt16(o){return this.ensureAvailable(2),this._data.setInt16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(o){return this.ensureAvailable(2),this._data.setUint16(this.offset,o,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(o){return this.ensureAvailable(4),this._data.setInt32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(o){return this.ensureAvailable(4),this._data.setUint32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(o){return this.ensureAvailable(4),this._data.setFloat32(this.offset,o,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(o){return this.ensureAvailable(8),this._data.setFloat64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(o){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(o){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,o,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(o){return this.writeUint8(o.charCodeAt(0))}writeChars(o){for(let c=0;c<o.length;c++)this.writeUint8(o.charCodeAt(c));return this}writeUtf8(o){return this.writeBytes(jme(o))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Ug(a){let o=a.length;for(;--o>=0;)a[o]=0}const Fme=3,Mme=258,U7=29,Vme=256,Qme=Vme+1+U7,F7=30,Hme=512,Gme=new Array((Qme+2)*2);Ug(Gme);const Kme=new Array(F7*2);Ug(Kme);const Wme=new Array(Hme);Ug(Wme);const zme=new Array(Mme-Fme+1);Ug(zme);const qme=new Array(U7);Ug(qme);const Yme=new Array(F7);Ug(Yme);const Xme=(a,o,c,d)=>{let h=a&65535|0,p=a>>>16&65535|0,g=0;for(;c!==0;){g=c>2e3?2e3:c,c-=g;do h=h+o[d++]|0,p=p+h|0;while(--g);h%=65521,p%=65521}return h|p<<16|0};var MR=Xme;const Jme=()=>{let a,o=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;o[c]=a}return o},$me=new Uint32Array(Jme()),Zme=(a,o,c,d)=>{const h=$me,p=d+c;a^=-1;for(let g=d;g<p;g++)a=a>>>8^h[(a^o[g])&255];return a^-1};var Wd=Zme,VR={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},M7={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const efe=(a,o)=>Object.prototype.hasOwnProperty.call(a,o);var tfe=function(a){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const c=o.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(const d in c)efe(c,d)&&(a[d]=c[d])}}return a},sfe=a=>{let o=0;for(let d=0,h=a.length;d<h;d++)o+=a[d].length;const c=new Uint8Array(o);for(let d=0,h=0,p=a.length;d<p;d++){let g=a[d];c.set(g,h),h+=g.length}return c},V7={assign:tfe,flattenChunks:sfe};let Q7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Q7=!1}const ix=new Uint8Array(256);for(let a=0;a<256;a++)ix[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;ix[254]=ix[254]=1;var rfe=a=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(a);let o,c,d,h,p,g=a.length,x=0;for(h=0;h<g;h++)c=a.charCodeAt(h),(c&64512)===55296&&h+1<g&&(d=a.charCodeAt(h+1),(d&64512)===56320&&(c=65536+(c-55296<<10)+(d-56320),h++)),x+=c<128?1:c<2048?2:c<65536?3:4;for(o=new Uint8Array(x),p=0,h=0;p<x;h++)c=a.charCodeAt(h),(c&64512)===55296&&h+1<g&&(d=a.charCodeAt(h+1),(d&64512)===56320&&(c=65536+(c-55296<<10)+(d-56320),h++)),c<128?o[p++]=c:c<2048?(o[p++]=192|c>>>6,o[p++]=128|c&63):c<65536?(o[p++]=224|c>>>12,o[p++]=128|c>>>6&63,o[p++]=128|c&63):(o[p++]=240|c>>>18,o[p++]=128|c>>>12&63,o[p++]=128|c>>>6&63,o[p++]=128|c&63);return o};const nfe=(a,o)=>{if(o<65534&&a.subarray&&Q7)return String.fromCharCode.apply(null,a.length===o?a:a.subarray(0,o));let c="";for(let d=0;d<o;d++)c+=String.fromCharCode(a[d]);return c};var ife=(a,o)=>{const c=o||a.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(a.subarray(0,o));let d,h;const p=new Array(c*2);for(h=0,d=0;d<c;){let g=a[d++];if(g<128){p[h++]=g;continue}let x=ix[g];if(x>4){p[h++]=65533,d+=x-1;continue}for(g&=x===2?31:x===3?15:7;x>1&&d<c;)g=g<<6|a[d++]&63,x--;if(x>1){p[h++]=65533;continue}g<65536?p[h++]=g:(g-=65536,p[h++]=55296|g>>10&1023,p[h++]=56320|g&1023)}return nfe(p,h)},afe=(a,o)=>{o=o||a.length,o>a.length&&(o=a.length);let c=o-1;for(;c>=0&&(a[c]&192)===128;)c--;return c<0||c===0?o:c+ix[a[c]]>o?c:o},QR={string2buf:rfe,buf2string:ife,utf8border:afe};function ofe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var cfe=ofe;const ly=16209,lfe=16191;var dfe=function(o,c){let d,h,p,g,x,v,E,C,I,O,R,k,M,P,H,$,re,J,ge,ie,we,Ae,V,ce;const Y=o.state;d=o.next_in,V=o.input,h=d+(o.avail_in-5),p=o.next_out,ce=o.output,g=p-(c-o.avail_out),x=p+(o.avail_out-257),v=Y.dmax,E=Y.wsize,C=Y.whave,I=Y.wnext,O=Y.window,R=Y.hold,k=Y.bits,M=Y.lencode,P=Y.distcode,H=(1<<Y.lenbits)-1,$=(1<<Y.distbits)-1;e:do{k<15&&(R+=V[d++]<<k,k+=8,R+=V[d++]<<k,k+=8),re=M[R&H];t:for(;;){if(J=re>>>24,R>>>=J,k-=J,J=re>>>16&255,J===0)ce[p++]=re&65535;else if(J&16){ge=re&65535,J&=15,J&&(k<J&&(R+=V[d++]<<k,k+=8),ge+=R&(1<<J)-1,R>>>=J,k-=J),k<15&&(R+=V[d++]<<k,k+=8,R+=V[d++]<<k,k+=8),re=P[R&$];s:for(;;){if(J=re>>>24,R>>>=J,k-=J,J=re>>>16&255,J&16){if(ie=re&65535,J&=15,k<J&&(R+=V[d++]<<k,k+=8,k<J&&(R+=V[d++]<<k,k+=8)),ie+=R&(1<<J)-1,ie>v){o.msg="invalid distance too far back",Y.mode=ly;break e}if(R>>>=J,k-=J,J=p-g,ie>J){if(J=ie-J,J>C&&Y.sane){o.msg="invalid distance too far back",Y.mode=ly;break e}if(we=0,Ae=O,I===0){if(we+=E-J,J<ge){ge-=J;do ce[p++]=O[we++];while(--J);we=p-ie,Ae=ce}}else if(I<J){if(we+=E+I-J,J-=I,J<ge){ge-=J;do ce[p++]=O[we++];while(--J);if(we=0,I<ge){J=I,ge-=J;do ce[p++]=O[we++];while(--J);we=p-ie,Ae=ce}}}else if(we+=I-J,J<ge){ge-=J;do ce[p++]=O[we++];while(--J);we=p-ie,Ae=ce}for(;ge>2;)ce[p++]=Ae[we++],ce[p++]=Ae[we++],ce[p++]=Ae[we++],ge-=3;ge&&(ce[p++]=Ae[we++],ge>1&&(ce[p++]=Ae[we++]))}else{we=p-ie;do ce[p++]=ce[we++],ce[p++]=ce[we++],ce[p++]=ce[we++],ge-=3;while(ge>2);ge&&(ce[p++]=ce[we++],ge>1&&(ce[p++]=ce[we++]))}}else if(J&64){o.msg="invalid distance code",Y.mode=ly;break e}else{re=P[(re&65535)+(R&(1<<J)-1)];continue s}break}}else if(J&64)if(J&32){Y.mode=lfe;break e}else{o.msg="invalid literal/length code",Y.mode=ly;break e}else{re=M[(re&65535)+(R&(1<<J)-1)];continue t}break}}while(d<h&&p<x);ge=k>>3,d-=ge,k-=ge<<3,R&=(1<<k)-1,o.next_in=d,o.next_out=p,o.avail_in=d<h?5+(h-d):5-(d-h),o.avail_out=p<x?257+(x-p):257-(p-x),Y.hold=R,Y.bits=k};const ig=15,H8=852,G8=592,K8=0,ET=1,W8=2,Afe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ufe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hfe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pfe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),mfe=(a,o,c,d,h,p,g,x)=>{const v=x.bits;let E=0,C=0,I=0,O=0,R=0,k=0,M=0,P=0,H=0,$=0,re,J,ge,ie,we,Ae=null,V;const ce=new Uint16Array(ig+1),Y=new Uint16Array(ig+1);let z=null,te,se,Ce;for(E=0;E<=ig;E++)ce[E]=0;for(C=0;C<d;C++)ce[o[c+C]]++;for(R=v,O=ig;O>=1&&ce[O]===0;O--);if(R>O&&(R=O),O===0)return h[p++]=1<<24|64<<16|0,h[p++]=1<<24|64<<16|0,x.bits=1,0;for(I=1;I<O&&ce[I]===0;I++);for(R<I&&(R=I),P=1,E=1;E<=ig;E++)if(P<<=1,P-=ce[E],P<0)return-1;if(P>0&&(a===K8||O!==1))return-1;for(Y[1]=0,E=1;E<ig;E++)Y[E+1]=Y[E]+ce[E];for(C=0;C<d;C++)o[c+C]!==0&&(g[Y[o[c+C]]++]=C);if(a===K8?(Ae=z=g,V=20):a===ET?(Ae=Afe,z=ufe,V=257):(Ae=hfe,z=pfe,V=0),$=0,C=0,E=I,we=p,k=R,M=0,ge=-1,H=1<<R,ie=H-1,a===ET&&H>H8||a===W8&&H>G8)return 1;for(;;){te=E-M,g[C]+1<V?(se=0,Ce=g[C]):g[C]>=V?(se=z[g[C]-V],Ce=Ae[g[C]-V]):(se=96,Ce=0),re=1<<E-M,J=1<<k,I=J;do J-=re,h[we+($>>M)+J]=te<<24|se<<16|Ce|0;while(J!==0);for(re=1<<E-1;$&re;)re>>=1;if(re!==0?($&=re-1,$+=re):$=0,C++,--ce[E]===0){if(E===O)break;E=o[c+g[C]]}if(E>R&&($&ie)!==ge){for(M===0&&(M=R),we+=I,k=E-M,P=1<<k;k+M<O&&(P-=ce[k+M],!(P<=0));)k++,P<<=1;if(H+=1<<k,a===ET&&H>H8||a===W8&&H>G8)return 1;ge=$&ie,h[ge]=R<<24|k<<16|we-p|0}}return $!==0&&(h[we+$]=E-M<<24|64<<16|0),x.bits=R,0};var $b=mfe;const ffe=0,H7=1,G7=2,{Z_FINISH:z8,Z_BLOCK:gfe,Z_TREES:dy,Z_OK:sm,Z_STREAM_END:bfe,Z_NEED_DICT:xfe,Z_STREAM_ERROR:ml,Z_DATA_ERROR:K7,Z_MEM_ERROR:W7,Z_BUF_ERROR:vfe,Z_DEFLATED:q8}=M7,SE=16180,Y8=16181,X8=16182,J8=16183,$8=16184,Z8=16185,eV=16186,tV=16187,sV=16188,rV=16189,eE=16190,VA=16191,CT=16192,nV=16193,ST=16194,iV=16195,aV=16196,oV=16197,cV=16198,Ay=16199,uy=16200,lV=16201,dV=16202,AV=16203,uV=16204,hV=16205,NT=16206,pV=16207,mV=16208,ui=16209,z7=16210,q7=16211,wfe=852,_fe=592,yfe=15,Efe=yfe,fV=a=>(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24);function Cfe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const im=a=>{if(!a)return 1;const o=a.state;return!o||o.strm!==a||o.mode<SE||o.mode>q7?1:0},Y7=a=>{if(im(a))return ml;const o=a.state;return a.total_in=a.total_out=o.total=0,a.msg="",o.wrap&&(a.adler=o.wrap&1),o.mode=SE,o.last=0,o.havedict=0,o.flags=-1,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Int32Array(wfe),o.distcode=o.distdyn=new Int32Array(_fe),o.sane=1,o.back=-1,sm},X7=a=>{if(im(a))return ml;const o=a.state;return o.wsize=0,o.whave=0,o.wnext=0,Y7(a)},J7=(a,o)=>{let c;if(im(a))return ml;const d=a.state;return o<0?(c=0,o=-o):(c=(o>>4)+5,o<48&&(o&=15)),o&&(o<8||o>15)?ml:(d.window!==null&&d.wbits!==o&&(d.window=null),d.wrap=c,d.wbits=o,X7(a))},$7=(a,o)=>{if(!a)return ml;const c=new Cfe;a.state=c,c.strm=a,c.window=null,c.mode=SE;const d=J7(a,o);return d!==sm&&(a.state=null),d},Sfe=a=>$7(a,Efe);let gV=!0,TT,RT;const Nfe=a=>{if(gV){TT=new Int32Array(512),RT=new Int32Array(32);let o=0;for(;o<144;)a.lens[o++]=8;for(;o<256;)a.lens[o++]=9;for(;o<280;)a.lens[o++]=7;for(;o<288;)a.lens[o++]=8;for($b(H7,a.lens,0,288,TT,0,a.work,{bits:9}),o=0;o<32;)a.lens[o++]=5;$b(G7,a.lens,0,32,RT,0,a.work,{bits:5}),gV=!1}a.lencode=TT,a.lenbits=9,a.distcode=RT,a.distbits=5},Z7=(a,o,c,d)=>{let h;const p=a.state;return p.window===null&&(p.wsize=1<<p.wbits,p.wnext=0,p.whave=0,p.window=new Uint8Array(p.wsize)),d>=p.wsize?(p.window.set(o.subarray(c-p.wsize,c),0),p.wnext=0,p.whave=p.wsize):(h=p.wsize-p.wnext,h>d&&(h=d),p.window.set(o.subarray(c-d,c-d+h),p.wnext),d-=h,d?(p.window.set(o.subarray(c-d,c),0),p.wnext=d,p.whave=p.wsize):(p.wnext+=h,p.wnext===p.wsize&&(p.wnext=0),p.whave<p.wsize&&(p.whave+=h))),0},Tfe=(a,o)=>{let c,d,h,p,g,x,v,E,C,I,O,R,k,M,P=0,H,$,re,J,ge,ie,we,Ae;const V=new Uint8Array(4);let ce,Y;const z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(im(a)||!a.output||!a.input&&a.avail_in!==0)return ml;c=a.state,c.mode===VA&&(c.mode=CT),g=a.next_out,h=a.output,v=a.avail_out,p=a.next_in,d=a.input,x=a.avail_in,E=c.hold,C=c.bits,I=x,O=v,Ae=sm;e:for(;;)switch(c.mode){case SE:if(c.wrap===0){c.mode=CT;break}for(;C<16;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(c.wrap&2&&E===35615){c.wbits===0&&(c.wbits=15),c.check=0,V[0]=E&255,V[1]=E>>>8&255,c.check=Wd(c.check,V,2,0),E=0,C=0,c.mode=Y8;break}if(c.head&&(c.head.done=!1),!(c.wrap&1)||(((E&255)<<8)+(E>>8))%31){a.msg="incorrect header check",c.mode=ui;break}if((E&15)!==q8){a.msg="unknown compression method",c.mode=ui;break}if(E>>>=4,C-=4,we=(E&15)+8,c.wbits===0&&(c.wbits=we),we>15||we>c.wbits){a.msg="invalid window size",c.mode=ui;break}c.dmax=1<<c.wbits,c.flags=0,a.adler=c.check=1,c.mode=E&512?rV:VA,E=0,C=0;break;case Y8:for(;C<16;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(c.flags=E,(c.flags&255)!==q8){a.msg="unknown compression method",c.mode=ui;break}if(c.flags&57344){a.msg="unknown header flags set",c.mode=ui;break}c.head&&(c.head.text=E>>8&1),c.flags&512&&c.wrap&4&&(V[0]=E&255,V[1]=E>>>8&255,c.check=Wd(c.check,V,2,0)),E=0,C=0,c.mode=X8;case X8:for(;C<32;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.head&&(c.head.time=E),c.flags&512&&c.wrap&4&&(V[0]=E&255,V[1]=E>>>8&255,V[2]=E>>>16&255,V[3]=E>>>24&255,c.check=Wd(c.check,V,4,0)),E=0,C=0,c.mode=J8;case J8:for(;C<16;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.head&&(c.head.xflags=E&255,c.head.os=E>>8),c.flags&512&&c.wrap&4&&(V[0]=E&255,V[1]=E>>>8&255,c.check=Wd(c.check,V,2,0)),E=0,C=0,c.mode=$8;case $8:if(c.flags&1024){for(;C<16;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.length=E,c.head&&(c.head.extra_len=E),c.flags&512&&c.wrap&4&&(V[0]=E&255,V[1]=E>>>8&255,c.check=Wd(c.check,V,2,0)),E=0,C=0}else c.head&&(c.head.extra=null);c.mode=Z8;case Z8:if(c.flags&1024&&(R=c.length,R>x&&(R=x),R&&(c.head&&(we=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Uint8Array(c.head.extra_len)),c.head.extra.set(d.subarray(p,p+R),we)),c.flags&512&&c.wrap&4&&(c.check=Wd(c.check,d,R,p)),x-=R,p+=R,c.length-=R),c.length))break e;c.length=0,c.mode=eV;case eV:if(c.flags&2048){if(x===0)break e;R=0;do we=d[p+R++],c.head&&we&&c.length<65536&&(c.head.name+=String.fromCharCode(we));while(we&&R<x);if(c.flags&512&&c.wrap&4&&(c.check=Wd(c.check,d,R,p)),x-=R,p+=R,we)break e}else c.head&&(c.head.name=null);c.length=0,c.mode=tV;case tV:if(c.flags&4096){if(x===0)break e;R=0;do we=d[p+R++],c.head&&we&&c.length<65536&&(c.head.comment+=String.fromCharCode(we));while(we&&R<x);if(c.flags&512&&c.wrap&4&&(c.check=Wd(c.check,d,R,p)),x-=R,p+=R,we)break e}else c.head&&(c.head.comment=null);c.mode=sV;case sV:if(c.flags&512){for(;C<16;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(c.wrap&4&&E!==(c.check&65535)){a.msg="header crc mismatch",c.mode=ui;break}E=0,C=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=VA;break;case rV:for(;C<32;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}a.adler=c.check=fV(E),E=0,C=0,c.mode=eE;case eE:if(c.havedict===0)return a.next_out=g,a.avail_out=v,a.next_in=p,a.avail_in=x,c.hold=E,c.bits=C,xfe;a.adler=c.check=1,c.mode=VA;case VA:if(o===gfe||o===dy)break e;case CT:if(c.last){E>>>=C&7,C-=C&7,c.mode=NT;break}for(;C<3;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}switch(c.last=E&1,E>>>=1,C-=1,E&3){case 0:c.mode=nV;break;case 1:if(Nfe(c),c.mode=Ay,o===dy){E>>>=2,C-=2;break e}break;case 2:c.mode=aV;break;case 3:a.msg="invalid block type",c.mode=ui}E>>>=2,C-=2;break;case nV:for(E>>>=C&7,C-=C&7;C<32;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if((E&65535)!==(E>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ui;break}if(c.length=E&65535,E=0,C=0,c.mode=ST,o===dy)break e;case ST:c.mode=iV;case iV:if(R=c.length,R){if(R>x&&(R=x),R>v&&(R=v),R===0)break e;h.set(d.subarray(p,p+R),g),x-=R,p+=R,v-=R,g+=R,c.length-=R;break}c.mode=VA;break;case aV:for(;C<14;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(c.nlen=(E&31)+257,E>>>=5,C-=5,c.ndist=(E&31)+1,E>>>=5,C-=5,c.ncode=(E&15)+4,E>>>=4,C-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ui;break}c.have=0,c.mode=oV;case oV:for(;c.have<c.ncode;){for(;C<3;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.lens[z[c.have++]]=E&7,E>>>=3,C-=3}for(;c.have<19;)c.lens[z[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ce={bits:c.lenbits},Ae=$b(ffe,c.lens,0,19,c.lencode,0,c.work,ce),c.lenbits=ce.bits,Ae){a.msg="invalid code lengths set",c.mode=ui;break}c.have=0,c.mode=cV;case cV:for(;c.have<c.nlen+c.ndist;){for(;P=c.lencode[E&(1<<c.lenbits)-1],H=P>>>24,$=P>>>16&255,re=P&65535,!(H<=C);){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(re<16)E>>>=H,C-=H,c.lens[c.have++]=re;else{if(re===16){for(Y=H+2;C<Y;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(E>>>=H,C-=H,c.have===0){a.msg="invalid bit length repeat",c.mode=ui;break}we=c.lens[c.have-1],R=3+(E&3),E>>>=2,C-=2}else if(re===17){for(Y=H+3;C<Y;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}E>>>=H,C-=H,we=0,R=3+(E&7),E>>>=3,C-=3}else{for(Y=H+7;C<Y;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}E>>>=H,C-=H,we=0,R=11+(E&127),E>>>=7,C-=7}if(c.have+R>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ui;break}for(;R--;)c.lens[c.have++]=we}}if(c.mode===ui)break;if(c.lens[256]===0){a.msg="invalid code -- missing end-of-block",c.mode=ui;break}if(c.lenbits=9,ce={bits:c.lenbits},Ae=$b(H7,c.lens,0,c.nlen,c.lencode,0,c.work,ce),c.lenbits=ce.bits,Ae){a.msg="invalid literal/lengths set",c.mode=ui;break}if(c.distbits=6,c.distcode=c.distdyn,ce={bits:c.distbits},Ae=$b(G7,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ce),c.distbits=ce.bits,Ae){a.msg="invalid distances set",c.mode=ui;break}if(c.mode=Ay,o===dy)break e;case Ay:c.mode=uy;case uy:if(x>=6&&v>=258){a.next_out=g,a.avail_out=v,a.next_in=p,a.avail_in=x,c.hold=E,c.bits=C,dfe(a,O),g=a.next_out,h=a.output,v=a.avail_out,p=a.next_in,d=a.input,x=a.avail_in,E=c.hold,C=c.bits,c.mode===VA&&(c.back=-1);break}for(c.back=0;P=c.lencode[E&(1<<c.lenbits)-1],H=P>>>24,$=P>>>16&255,re=P&65535,!(H<=C);){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if($&&!($&240)){for(J=H,ge=$,ie=re;P=c.lencode[ie+((E&(1<<J+ge)-1)>>J)],H=P>>>24,$=P>>>16&255,re=P&65535,!(J+H<=C);){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}E>>>=J,C-=J,c.back+=J}if(E>>>=H,C-=H,c.back+=H,c.length=re,$===0){c.mode=hV;break}if($&32){c.back=-1,c.mode=VA;break}if($&64){a.msg="invalid literal/length code",c.mode=ui;break}c.extra=$&15,c.mode=lV;case lV:if(c.extra){for(Y=c.extra;C<Y;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.length+=E&(1<<c.extra)-1,E>>>=c.extra,C-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=dV;case dV:for(;P=c.distcode[E&(1<<c.distbits)-1],H=P>>>24,$=P>>>16&255,re=P&65535,!(H<=C);){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(!($&240)){for(J=H,ge=$,ie=re;P=c.distcode[ie+((E&(1<<J+ge)-1)>>J)],H=P>>>24,$=P>>>16&255,re=P&65535,!(J+H<=C);){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}E>>>=J,C-=J,c.back+=J}if(E>>>=H,C-=H,c.back+=H,$&64){a.msg="invalid distance code",c.mode=ui;break}c.offset=re,c.extra=$&15,c.mode=AV;case AV:if(c.extra){for(Y=c.extra;C<Y;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}c.offset+=E&(1<<c.extra)-1,E>>>=c.extra,C-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ui;break}c.mode=uV;case uV:if(v===0)break e;if(R=O-v,c.offset>R){if(R=c.offset-R,R>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ui;break}R>c.wnext?(R-=c.wnext,k=c.wsize-R):k=c.wnext-R,R>c.length&&(R=c.length),M=c.window}else M=h,k=g-c.offset,R=c.length;R>v&&(R=v),v-=R,c.length-=R;do h[g++]=M[k++];while(--R);c.length===0&&(c.mode=uy);break;case hV:if(v===0)break e;h[g++]=c.length,v--,c.mode=uy;break;case NT:if(c.wrap){for(;C<32;){if(x===0)break e;x--,E|=d[p++]<<C,C+=8}if(O-=v,a.total_out+=O,c.total+=O,c.wrap&4&&O&&(a.adler=c.check=c.flags?Wd(c.check,h,O,g-O):MR(c.check,h,O,g-O)),O=v,c.wrap&4&&(c.flags?E:fV(E))!==c.check){a.msg="incorrect data check",c.mode=ui;break}E=0,C=0}c.mode=pV;case pV:if(c.wrap&&c.flags){for(;C<32;){if(x===0)break e;x--,E+=d[p++]<<C,C+=8}if(c.wrap&4&&E!==(c.total&4294967295)){a.msg="incorrect length check",c.mode=ui;break}E=0,C=0}c.mode=mV;case mV:Ae=bfe;break e;case ui:Ae=K7;break e;case z7:return W7;case q7:default:return ml}return a.next_out=g,a.avail_out=v,a.next_in=p,a.avail_in=x,c.hold=E,c.bits=C,(c.wsize||O!==a.avail_out&&c.mode<ui&&(c.mode<NT||o!==z8))&&Z7(a,a.output,a.next_out,O-a.avail_out),I-=a.avail_in,O-=a.avail_out,a.total_in+=I,a.total_out+=O,c.total+=O,c.wrap&4&&O&&(a.adler=c.check=c.flags?Wd(c.check,h,O,a.next_out-O):MR(c.check,h,O,a.next_out-O)),a.data_type=c.bits+(c.last?64:0)+(c.mode===VA?128:0)+(c.mode===Ay||c.mode===ST?256:0),(I===0&&O===0||o===z8)&&Ae===sm&&(Ae=vfe),Ae},Rfe=a=>{if(im(a))return ml;let o=a.state;return o.window&&(o.window=null),a.state=null,sm},Ife=(a,o)=>{if(im(a))return ml;const c=a.state;return c.wrap&2?(c.head=o,o.done=!1,sm):ml},Ofe=(a,o)=>{const c=o.length;let d,h,p;return im(a)||(d=a.state,d.wrap!==0&&d.mode!==eE)?ml:d.mode===eE&&(h=1,h=MR(h,o,c,0),h!==d.check)?K7:(p=Z7(a,o,c,c),p?(d.mode=z7,W7):(d.havedict=1,sm))};var kfe=X7,Dfe=J7,Bfe=Y7,Lfe=Sfe,jfe=$7,Pfe=Tfe,Ufe=Rfe,Ffe=Ife,Mfe=Ofe,Vfe="pako inflate (from Nodeca project)",QA={inflateReset:kfe,inflateReset2:Dfe,inflateResetKeep:Bfe,inflateInit:Lfe,inflateInit2:jfe,inflate:Pfe,inflateEnd:Ufe,inflateGetHeader:Ffe,inflateSetDictionary:Mfe,inflateInfo:Vfe};function Qfe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Hfe=Qfe;const eG=Object.prototype.toString,{Z_NO_FLUSH:Gfe,Z_FINISH:Kfe,Z_OK:ax,Z_STREAM_END:IT,Z_NEED_DICT:OT,Z_STREAM_ERROR:Wfe,Z_DATA_ERROR:bV,Z_MEM_ERROR:zfe}=M7;function gx(a){this.options=V7.assign({chunkSize:1024*64,windowBits:15,to:""},a||{});const o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,o.windowBits===0&&(o.windowBits=-15)),o.windowBits>=0&&o.windowBits<16&&!(a&&a.windowBits)&&(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&(o.windowBits&15||(o.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cfe,this.strm.avail_out=0;let c=QA.inflateInit2(this.strm,o.windowBits);if(c!==ax)throw new Error(VR[c]);if(this.header=new Hfe,QA.inflateGetHeader(this.strm,this.header),o.dictionary&&(typeof o.dictionary=="string"?o.dictionary=QR.string2buf(o.dictionary):eG.call(o.dictionary)==="[object ArrayBuffer]"&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(c=QA.inflateSetDictionary(this.strm,o.dictionary),c!==ax)))throw new Error(VR[c])}gx.prototype.push=function(a,o){const c=this.strm,d=this.options.chunkSize,h=this.options.dictionary;let p,g,x;if(this.ended)return!1;for(o===~~o?g=o:g=o===!0?Kfe:Gfe,eG.call(a)==="[object ArrayBuffer]"?c.input=new Uint8Array(a):c.input=a,c.next_in=0,c.avail_in=c.input.length;;){for(c.avail_out===0&&(c.output=new Uint8Array(d),c.next_out=0,c.avail_out=d),p=QA.inflate(c,g),p===OT&&h&&(p=QA.inflateSetDictionary(c,h),p===ax?p=QA.inflate(c,g):p===bV&&(p=OT));c.avail_in>0&&p===IT&&c.state.wrap>0&&a[c.next_in]!==0;)QA.inflateReset(c),p=QA.inflate(c,g);switch(p){case Wfe:case bV:case OT:case zfe:return this.onEnd(p),this.ended=!0,!1}if(x=c.avail_out,c.next_out&&(c.avail_out===0||p===IT))if(this.options.to==="string"){let v=QR.utf8border(c.output,c.next_out),E=c.next_out-v,C=QR.buf2string(c.output,v);c.next_out=E,c.avail_out=d-E,E&&c.output.set(c.output.subarray(v,v+E),0),this.onData(C)}else this.onData(c.output.length===c.next_out?c.output:c.output.subarray(0,c.next_out));if(!(p===ax&&x===0)){if(p===IT)return p=QA.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,!0;if(c.avail_in===0)break}}return!0};gx.prototype.onData=function(a){this.chunks.push(a)};gx.prototype.onEnd=function(a){a===ax&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=V7.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function qfe(a,o){const c=new gx(o);if(c.push(a),c.err)throw c.msg||VR[c.err];return c.result}var Yfe=gx,Xfe=qfe,Jfe={Inflate:Yfe,inflate:Xfe};const{Inflate:$fe,inflate:Zfe}=Jfe;var xV=$fe,ege=Zfe;const tG=[];for(let a=0;a<256;a++){let o=a;for(let c=0;c<8;c++)o&1?o=3988292384^o>>>1:o=o>>>1;tG[a]=o}const vV=4294967295;function tge(a,o,c){let d=a;for(let h=0;h<c;h++)d=tG[(d^o[h])&255]^d>>>8;return d}function sge(a,o){return(tge(vV,a,o)^vV)>>>0}function wV(a,o,c){const d=a.readUint32(),h=sge(new Uint8Array(a.buffer,a.byteOffset+a.offset-o-4,o),o);if(h!==d)throw new Error(`CRC mismatch for chunk ${c}. Expected ${d}, found ${h}`)}function sG(a,o,c){for(let d=0;d<c;d++)o[d]=a[d]}function rG(a,o,c,d){let h=0;for(;h<d;h++)o[h]=a[h];for(;h<c;h++)o[h]=a[h]+o[h-d]&255}function nG(a,o,c,d){let h=0;if(c.length===0)for(;h<d;h++)o[h]=a[h];else for(;h<d;h++)o[h]=a[h]+c[h]&255}function iG(a,o,c,d,h){let p=0;if(c.length===0){for(;p<h;p++)o[p]=a[p];for(;p<d;p++)o[p]=a[p]+(o[p-h]>>1)&255}else{for(;p<h;p++)o[p]=a[p]+(c[p]>>1)&255;for(;p<d;p++)o[p]=a[p]+(o[p-h]+c[p]>>1)&255}}function aG(a,o,c,d,h){let p=0;if(c.length===0){for(;p<h;p++)o[p]=a[p];for(;p<d;p++)o[p]=a[p]+o[p-h]&255}else{for(;p<h;p++)o[p]=a[p]+c[p]&255;for(;p<d;p++)o[p]=a[p]+rge(o[p-h],c[p],c[p-h])&255}}function rge(a,o,c){const d=a+o-c,h=Math.abs(d-a),p=Math.abs(d-o),g=Math.abs(d-c);return h<=p&&h<=g?a:p<=g?o:c}function nge(a,o,c,d,h,p){switch(a){case 0:sG(o,c,h);break;case 1:rG(o,c,h,p);break;case 2:nG(o,c,d,h);break;case 3:iG(o,c,d,h,p);break;case 4:aG(o,c,d,h,p);break;default:throw new Error(`Unsupported filter: ${a}`)}}const ige=new Uint16Array([255]),age=new Uint8Array(ige.buffer),oge=age[0]===255;function cge(a){const{data:o,width:c,height:d,channels:h,depth:p}=a,g=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],x=Math.ceil(p/8)*h,v=new Uint8Array(d*c*x);let E=0;for(let C=0;C<7;C++){const I=g[C],O=Math.ceil((c-I.x)/I.xStep),R=Math.ceil((d-I.y)/I.yStep);if(O<=0||R<=0)continue;const k=O*x,M=new Uint8Array(k);for(let P=0;P<R;P++){const H=o[E++],$=o.subarray(E,E+k);E+=k;const re=new Uint8Array(k);nge(H,$,re,M,k,x),M.set(re);for(let J=0;J<O;J++){const ge=I.x+J*I.xStep,ie=I.y+P*I.yStep;if(!(ge>=c||ie>=d))for(let we=0;we<x;we++)v[(ie*c+ge)*x+we]=re[J*x+we]}}}if(p===16){const C=new Uint16Array(v.buffer);if(oge)for(let I=0;I<C.length;I++)C[I]=lge(C[I]);return C}else return v}function lge(a){return(a&255)<<8|a>>8&255}const dge=new Uint16Array([255]),Age=new Uint8Array(dge.buffer),uge=Age[0]===255,hge=new Uint8Array(0);function _V(a){const{data:o,width:c,height:d,channels:h,depth:p}=a,g=Math.ceil(p/8)*h,x=Math.ceil(p/8*h*c),v=new Uint8Array(d*x);let E=hge,C=0,I,O;for(let R=0;R<d;R++){switch(I=o.subarray(C+1,C+1+x),O=v.subarray(R*x,(R+1)*x),o[C]){case 0:sG(I,O,x);break;case 1:rG(I,O,x,g);break;case 2:nG(I,O,E,x);break;case 3:iG(I,O,E,x,g);break;case 4:aG(I,O,E,x,g);break;default:throw new Error(`Unsupported filter: ${o[C]}`)}E=O,C+=x+1}if(p===16){const R=new Uint16Array(v.buffer);if(uge)for(let k=0;k<R.length;k++)R[k]=pge(R[k]);return R}else return v}function pge(a){return(a&255)<<8|a>>8&255}const Ny=Uint8Array.of(137,80,78,71,13,10,26,10);function yV(a){if(!mge(a.readBytes(Ny.length)))throw new Error("wrong PNG signature")}function mge(a){if(a.length<Ny.length)return!1;for(let o=0;o<Ny.length;o++)if(a[o]!==Ny[o])return!1;return!0}const fge="tEXt",gge=0,oG=new TextDecoder("latin1");function bge(a){if(vge(a),a.length===0||a.length>79)throw new Error("keyword length must be between 1 and 79")}const xge=/^[\u0000-\u00FF]*$/;function vge(a){if(!xge.test(a))throw new Error("invalid latin1 text")}function wge(a,o,c){const d=cG(o);a[d]=_ge(o,c-d.length-1)}function cG(a){for(a.mark();a.readByte()!==gge;);const o=a.offset;a.reset();const c=oG.decode(a.readBytes(o-a.offset-1));return a.skip(1),bge(c),c}function _ge(a,o){return oG.decode(a.readBytes(o))}const Sc={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},kT={UNKNOWN:-1,DEFLATE:0},EV={UNKNOWN:-1,ADAPTIVE:0},DT={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},hy={NONE:0,BACKGROUND:1,PREVIOUS:2},BT={SOURCE:0,OVER:1};class yge extends gI{constructor(c,d={}){super(c);vn(this,"_checkCrc");vn(this,"_inflator");vn(this,"_png");vn(this,"_apng");vn(this,"_end");vn(this,"_hasPalette");vn(this,"_palette");vn(this,"_hasTransparency");vn(this,"_transparency");vn(this,"_compressionMethod");vn(this,"_filterMethod");vn(this,"_interlaceMethod");vn(this,"_colorType");vn(this,"_isAnimated");vn(this,"_numberOfFrames");vn(this,"_numberOfPlays");vn(this,"_frames");vn(this,"_writingDataChunks");const{checkCrc:h=!1}=d;this._checkCrc=h,this._inflator=new xV,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=kT.UNKNOWN,this._filterMethod=EV.UNKNOWN,this._interlaceMethod=DT.UNKNOWN,this._colorType=Sc.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(yV(this);!this._end;){const c=this.readUint32(),d=this.readChars(4);this.decodeChunk(c,d)}return this.decodeImage(),this._png}decodeApng(){for(yV(this);!this._end;){const c=this.readUint32(),d=this.readChars(4);this.decodeApngChunk(c,d)}return this.decodeApngImage(),this._apng}decodeChunk(c,d){const h=this.offset;switch(d){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(c);break;case"IDAT":this.decodeIDAT(c);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(c);break;case"iCCP":this.decodeiCCP(c);break;case fge:wge(this._png.text,this,c);break;case"pHYs":this.decodepHYs();break;default:this.skip(c);break}if(this.offset-h!==c)throw new Error(`Length mismatch while decoding chunk ${d}`);this._checkCrc?wV(this,c+4,d):this.skip(4)}decodeApngChunk(c,d){const h=this.offset;switch(d!=="fdAT"&&d!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),d){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(c);break;default:this.decodeChunk(c,d),this.offset=h+c;break}if(this.offset-h!==c)throw new Error(`Length mismatch while decoding chunk ${d}`);this._checkCrc?wV(this,c+4,d):this.skip(4)}decodeIHDR(){const c=this._png;c.width=this.readUint32(),c.height=this.readUint32(),c.depth=Ege(this.readUint8());const d=this.readUint8();this._colorType=d;let h;switch(d){case Sc.GREYSCALE:h=1;break;case Sc.TRUECOLOUR:h=3;break;case Sc.INDEXED_COLOUR:h=1;break;case Sc.GREYSCALE_ALPHA:h=2;break;case Sc.TRUECOLOUR_ALPHA:h=4;break;case Sc.UNKNOWN:default:throw new Error(`Unknown color type: ${d}`)}if(this._png.channels=h,this._compressionMethod=this.readUint8(),this._compressionMethod!==kT.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const c={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(c)}decodePLTE(c){if(c%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${c}`);const d=c/3;this._hasPalette=!0;const h=[];this._palette=h;for(let p=0;p<d;p++)h.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(c){this._writingDataChunks=!0;const d=c,h=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,h,d)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(c)}decodeFDAT(c){this._writingDataChunks=!0;let d=c,h=this.offset+this.byteOffset;if(h+=4,d-=4,this._inflator.push(new Uint8Array(this.buffer,h,d)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(c)}decodetRNS(c){switch(this._colorType){case Sc.GREYSCALE:case Sc.TRUECOLOUR:{if(c%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${c}`);if(c/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${c/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(c/2);for(let d=0;d<c/2;d++)this._transparency[d]=this.readUint16();break}case Sc.INDEXED_COLOUR:{if(c>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${c} vs ${this._palette.length})`);let d=0;for(;d<c;d++){const h=this.readByte();this._palette[d].push(h)}for(;d<this._palette.length;d++)this._palette[d].push(255);break}case Sc.UNKNOWN:case Sc.GREYSCALE_ALPHA:case Sc.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(c){const d=cG(this),h=this.readUint8();if(h!==kT.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${h}`);const p=this.readBytes(c-d.length-2);this._png.iccEmbeddedProfile={name:d,profile:ege(p)}}decodepHYs(){const c=this.readUint32(),d=this.readUint32(),h=this.readByte();this._png.resolution={x:c,y:d,unit:h}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let c=0;c<this._numberOfFrames;c++){const d={sequenceNumber:this._frames[c].sequenceNumber,delayNumber:this._frames[c].delayNumber,delayDenominator:this._frames[c].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},h=this._frames.at(c);if(h){if(h.data=_V({data:h.data,width:h.width,height:h.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),c===0||h.xOffset===0&&h.yOffset===0&&h.width===this._png.width&&h.height===this._png.height)d.data=h.data;else{const p=this._apng.frames.at(c-1);this.disposeFrame(h,p,d),this.addFrameDataToCanvas(d,h)}this._apng.frames.push(d)}}return this._apng}disposeFrame(c,d,h){switch(c.disposeOp){case hy.NONE:break;case hy.BACKGROUND:for(let p=0;p<this._png.height;p++)for(let g=0;g<this._png.width;g++){const x=(p*c.width+g)*this._png.channels;for(let v=0;v<this._png.channels;v++)h.data[x+v]=0}break;case hy.PREVIOUS:h.data.set(d.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(c,d){const h=1<<this._png.depth,p=(g,x)=>{const v=((g+d.yOffset)*this._png.width+d.xOffset+x)*this._png.channels,E=(g*d.width+x)*this._png.channels;return{index:v,frameIndex:E}};switch(d.blendOp){case BT.SOURCE:for(let g=0;g<d.height;g++)for(let x=0;x<d.width;x++){const{index:v,frameIndex:E}=p(g,x);for(let C=0;C<this._png.channels;C++)c.data[v+C]=d.data[E+C]}break;case BT.OVER:for(let g=0;g<d.height;g++)for(let x=0;x<d.width;x++){const{index:v,frameIndex:E}=p(g,x);for(let C=0;C<this._png.channels;C++){const I=d.data[E+this._png.channels-1]/h,O=C%(this._png.channels-1)===0?1:d.data[E+C],R=Math.floor(I*O+(1-I)*c.data[v+C]);c.data[v+C]+=R}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var d;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const c=this._isAnimated?((d=this._frames)==null?void 0:d.at(0)).data:this._inflator.result;if(this._filterMethod!==EV.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===DT.NO_INTERLACE)this._png.data=_V({data:c,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===DT.ADAM7)this._png.data=cge({data:c,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const c=this._inflator.result,d=this._frames.at(-1);d?d.data=c:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:hy.NONE,blendOp:BT.SOURCE,data:c}),this._inflator=new xV,this._writingDataChunks=!1}}function Ege(a){if(a!==1&&a!==2&&a!==4&&a!==8&&a!==16)throw new Error(`invalid bit depth: ${a}`);return a}var CV;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.METRE=1]="METRE"})(CV||(CV={}));function Cge(a,o){return new yge(a,o).decode()}var ar=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function LT(){ar.console&&typeof ar.console.log=="function"&&ar.console.log.apply(ar.console,arguments)}var Mn={log:LT,warn:function(a){ar.console&&(typeof ar.console.warn=="function"?ar.console.warn.apply(ar.console,arguments):LT.call(null,arguments))},error:function(a){ar.console&&(typeof ar.console.error=="function"?ar.console.error.apply(ar.console,arguments):LT(a))}};function jT(a,o,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){Vp(d.response,o,c)},d.onerror=function(){Mn.error("could not download file")},d.send()}function SV(a){var o=new XMLHttpRequest;o.open("HEAD",a,!1);try{o.send()}catch{}return o.status>=200&&o.status<=299}function py(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(o)}}var Vp=ar.saveAs||((typeof window>"u"?"undefined":_n(window))!=="object"||window!==ar?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(a,o,c){var d=ar.URL||ar.webkitURL,h=document.createElement("a");o=o||a.name||"download",h.download=o,h.rel="noopener",typeof a=="string"?(h.href=a,h.origin!==location.origin?SV(h.href)?jT(a,o,c):py(h,h.target="_blank"):py(h)):(h.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(h.href)},4e4),setTimeout(function(){py(h)},0))}:"msSaveOrOpenBlob"in navigator?function(a,o,c){if(o=o||a.name||"download",typeof a=="string")if(SV(a))jT(a,o,c);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){py(d)})}else navigator.msSaveOrOpenBlob(function(h,p){return p===void 0?p={autoBom:!1}:_n(p)!=="object"&&(Mn.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}(a,c),o)}:function(a,o,c,d){if((d=d||open("","_blank"))&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return jT(a,o,c);var h=a.type==="application/octet-stream",p=/constructor/i.test(ar.HTMLElement)||ar.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||h&&p)&&(typeof FileReader>"u"?"undefined":_n(FileReader))==="object"){var x=new FileReader;x.onloadend=function(){var C=x.result;C=g?C:C.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=C:location=C,d=null},x.readAsDataURL(a)}else{var v=ar.URL||ar.webkitURL,E=v.createObjectURL(a);d?d.location=E:location.href=E,d=null,setTimeout(function(){v.revokeObjectURL(E)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function lG(a){var o;a=a||"",this.ok=!1,a.charAt(0)=="#"&&(a=a.substr(1,6)),a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[a=(a=a.replace(/ /g,"")).toLowerCase()]||a;for(var c=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(x){return[parseInt(x[1]),parseInt(x[2]),parseInt(x[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(x){return[parseInt(x[1],16),parseInt(x[2],16),parseInt(x[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(x){return[parseInt(x[1]+x[1],16),parseInt(x[2]+x[2],16),parseInt(x[3]+x[3],16)]}}],d=0;d<c.length;d++){var h=c[d].re,p=c[d].process,g=h.exec(a);g&&(o=p(g),this.r=o[0],this.g=o[1],this.b=o[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var x=this.r.toString(16),v=this.g.toString(16),E=this.b.toString(16);return x.length==1&&(x="0"+x),v.length==1&&(v="0"+v),E.length==1&&(E="0"+E),"#"+x+v+E}}var Ty=ar.atob.bind(ar),NV=ar.btoa.bind(ar);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function PT(a,o){var c=a[0],d=a[1],h=a[2],p=a[3];c=so(c,d,h,p,o[0],7,-680876936),p=so(p,c,d,h,o[1],12,-389564586),h=so(h,p,c,d,o[2],17,606105819),d=so(d,h,p,c,o[3],22,-1044525330),c=so(c,d,h,p,o[4],7,-176418897),p=so(p,c,d,h,o[5],12,1200080426),h=so(h,p,c,d,o[6],17,-1473231341),d=so(d,h,p,c,o[7],22,-45705983),c=so(c,d,h,p,o[8],7,1770035416),p=so(p,c,d,h,o[9],12,-1958414417),h=so(h,p,c,d,o[10],17,-42063),d=so(d,h,p,c,o[11],22,-1990404162),c=so(c,d,h,p,o[12],7,1804603682),p=so(p,c,d,h,o[13],12,-40341101),h=so(h,p,c,d,o[14],17,-1502002290),c=ro(c,d=so(d,h,p,c,o[15],22,1236535329),h,p,o[1],5,-165796510),p=ro(p,c,d,h,o[6],9,-1069501632),h=ro(h,p,c,d,o[11],14,643717713),d=ro(d,h,p,c,o[0],20,-373897302),c=ro(c,d,h,p,o[5],5,-701558691),p=ro(p,c,d,h,o[10],9,38016083),h=ro(h,p,c,d,o[15],14,-660478335),d=ro(d,h,p,c,o[4],20,-405537848),c=ro(c,d,h,p,o[9],5,568446438),p=ro(p,c,d,h,o[14],9,-1019803690),h=ro(h,p,c,d,o[3],14,-187363961),d=ro(d,h,p,c,o[8],20,1163531501),c=ro(c,d,h,p,o[13],5,-1444681467),p=ro(p,c,d,h,o[2],9,-51403784),h=ro(h,p,c,d,o[7],14,1735328473),c=no(c,d=ro(d,h,p,c,o[12],20,-1926607734),h,p,o[5],4,-378558),p=no(p,c,d,h,o[8],11,-2022574463),h=no(h,p,c,d,o[11],16,1839030562),d=no(d,h,p,c,o[14],23,-35309556),c=no(c,d,h,p,o[1],4,-1530992060),p=no(p,c,d,h,o[4],11,1272893353),h=no(h,p,c,d,o[7],16,-155497632),d=no(d,h,p,c,o[10],23,-1094730640),c=no(c,d,h,p,o[13],4,681279174),p=no(p,c,d,h,o[0],11,-358537222),h=no(h,p,c,d,o[3],16,-722521979),d=no(d,h,p,c,o[6],23,76029189),c=no(c,d,h,p,o[9],4,-640364487),p=no(p,c,d,h,o[12],11,-421815835),h=no(h,p,c,d,o[15],16,530742520),c=io(c,d=no(d,h,p,c,o[2],23,-995338651),h,p,o[0],6,-198630844),p=io(p,c,d,h,o[7],10,1126891415),h=io(h,p,c,d,o[14],15,-1416354905),d=io(d,h,p,c,o[5],21,-57434055),c=io(c,d,h,p,o[12],6,1700485571),p=io(p,c,d,h,o[3],10,-1894986606),h=io(h,p,c,d,o[10],15,-1051523),d=io(d,h,p,c,o[1],21,-2054922799),c=io(c,d,h,p,o[8],6,1873313359),p=io(p,c,d,h,o[15],10,-30611744),h=io(h,p,c,d,o[6],15,-1560198380),d=io(d,h,p,c,o[13],21,1309151649),c=io(c,d,h,p,o[4],6,-145523070),p=io(p,c,d,h,o[11],10,-1120210379),h=io(h,p,c,d,o[2],15,718787259),d=io(d,h,p,c,o[9],21,-343485551),a[0]=ih(c,a[0]),a[1]=ih(d,a[1]),a[2]=ih(h,a[2]),a[3]=ih(p,a[3])}function NE(a,o,c,d,h,p){return o=ih(ih(o,a),ih(d,p)),ih(o<<h|o>>>32-h,c)}function so(a,o,c,d,h,p,g){return NE(o&c|~o&d,a,o,h,p,g)}function ro(a,o,c,d,h,p,g){return NE(o&d|c&~d,a,o,h,p,g)}function no(a,o,c,d,h,p,g){return NE(o^c^d,a,o,h,p,g)}function io(a,o,c,d,h,p,g){return NE(c^(o|~d),a,o,h,p,g)}function dG(a){var o,c=a.length,d=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=a.length;o+=64)PT(d,Sge(a.substring(o-64,o)));a=a.substring(o-64);var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<a.length;o++)h[o>>2]|=a.charCodeAt(o)<<(o%4<<3);if(h[o>>2]|=128<<(o%4<<3),o>55)for(PT(d,h),o=0;o<16;o++)h[o]=0;return h[14]=8*c,PT(d,h),d}function Sge(a){var o,c=[];for(o=0;o<64;o+=4)c[o>>2]=a.charCodeAt(o)+(a.charCodeAt(o+1)<<8)+(a.charCodeAt(o+2)<<16)+(a.charCodeAt(o+3)<<24);return c}var TV="0123456789abcdef".split("");function Nge(a){for(var o="",c=0;c<4;c++)o+=TV[a>>8*c+4&15]+TV[a>>8*c&15];return o}function Tge(a){return String.fromCharCode(255&a,(65280&a)>>8,(16711680&a)>>16,(4278190080&a)>>24)}function HR(a){return dG(a).map(Tge).join("")}var Rge=function(a){for(var o=0;o<a.length;o++)a[o]=Nge(a[o]);return a.join("")}(dG("hello"))!="5d41402abc4b2a76b9719d911017c592";function ih(a,o){if(Rge){var c=(65535&a)+(65535&o);return(a>>16)+(o>>16)+(c>>16)<<16|65535&c}return a+o&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function GR(a,o){var c,d,h,p;if(a!==c){for(var g=(h=a,p=1+(256/a.length|0),new Array(p+1).join(h)),x=[],v=0;v<256;v++)x[v]=v;var E=0;for(v=0;v<256;v++){var C=x[v];E=(E+C+g.charCodeAt(v))%256,x[v]=x[E],x[E]=C}c=a,d=x}else x=d;var I=o.length,O=0,R=0,k="";for(v=0;v<I;v++)R=(R+(C=x[O=(O+1)%256]))%256,x[O]=x[R],x[R]=C,g=x[(x[O]+x[R])%256],k+=String.fromCharCode(o.charCodeAt(v)^g);return k}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var RV={print:4,modify:8,copy:16,"annot-forms":32};function hg(a,o,c,d){this.v=1,this.r=2;var h=192;a.forEach(function(x){if(RV.perm!==void 0)throw new Error("Invalid permission: "+x);h+=RV[x]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var p=(o+this.padding).substr(0,32),g=(c+this.padding).substr(0,32);this.O=this.processOwnerPassword(p,g),this.P=-(1+(255^h)),this.encryptionKey=HR(p+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(d)).substr(0,5),this.U=GR(this.encryptionKey,this.padding)}function pg(a){if(/[^\u0000-\u00ff]/.test(a))throw new Error("Invalid PDF Name Object: "+a+", Only accept ASCII characters.");for(var o="",c=a.length,d=0;d<c;d++){var h=a.charCodeAt(d);o+=h<33||h===35||h===37||h===40||h===41||h===47||h===60||h===62||h===91||h===93||h===123||h===125||h>126?"#"+("0"+h.toString(16)).slice(-2):a[d]}return o}function IV(a){if(_n(a)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var o={};this.subscribe=function(c,d,h){if(h=h||!1,typeof c!="string"||typeof d!="function"||typeof h!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");o.hasOwnProperty(c)||(o[c]={});var p=Math.random().toString(35);return o[c][p]=[d,!!h],p},this.unsubscribe=function(c){for(var d in o)if(o[d][c])return delete o[d][c],Object.keys(o[d]).length===0&&delete o[d],!0;return!1},this.publish=function(c){if(o.hasOwnProperty(c)){var d=Array.prototype.slice.call(arguments,1),h=[];for(var p in o[c]){var g=o[c][p];try{g[0].apply(a,d)}catch(x){ar.console&&Mn.error("jsPDF PubSub Error",x.message,x)}g[1]&&h.push(p)}h.length&&h.forEach(this.unsubscribe)}},this.getTopics=function(){return o}}function tE(a){if(!(this instanceof tE))return new tE(a);var o="opacity,stroke-opacity".split(",");for(var c in a)a.hasOwnProperty(c)&&o.indexOf(c)>=0&&(this[c]=a[c]);this.id="",this.objectNumber=-1}function AG(a,o){this.gState=a,this.matrix=o,this.id="",this.objectNumber=-1}function Gp(a,o,c,d,h){if(!(this instanceof Gp))return new Gp(a,o,c,d,h);this.type=a==="axial"?2:3,this.coords=o,this.colors=c,AG.call(this,d,h)}function fg(a,o,c,d,h){if(!(this instanceof fg))return new fg(a,o,c,d,h);this.boundingBox=a,this.xStep=o,this.yStep=c,this.stream="",this.cloneIndex=0,AG.call(this,d,h)}function Qs(a){var o,c=typeof arguments[0]=="string"?arguments[0]:"p",d=arguments[1],h=arguments[2],p=arguments[3],g=[],x=1,v=16,E="S",C=null;_n(a=a||{})==="object"&&(c=a.orientation,d=a.unit||d,h=a.format||h,p=a.compress||a.compressPdf||p,(C=a.encryption||null)!==null&&(C.userPassword=C.userPassword||"",C.ownerPassword=C.ownerPassword||"",C.userPermissions=C.userPermissions||[]),x=typeof a.userUnit=="number"?Math.abs(a.userUnit):1,a.precision!==void 0&&(o=a.precision),a.floatPrecision!==void 0&&(v=a.floatPrecision),E=a.defaultPathOperation||"S"),g=a.filters||(p===!0?["FlateEncode"]:g),d=d||"mm",c=(""+(c||"P")).toLowerCase();var I=a.putOnlyUsedFonts||!1,O={},R={internal:{},__private__:{}};R.__private__.PubSub=IV;var k="1.3",M=R.__private__.getPdfVersion=function(){return k};R.__private__.setPdfVersion=function(L){k=L};var P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};R.__private__.getPageFormats=function(){return P};var H=R.__private__.getPageFormat=function(L){return P[L]};h=h||"a4";var $="compat",re="advanced",J=$;function ge(){this.saveGraphicsState(),_e(new Fs(ds,0,0,-ds,0,wl()*ds).toString()+" cm"),this.setFontSize(this.getFontSize()/ds),E="n",J=re}function ie(){this.restoreGraphicsState(),E="S",J=$}var we=R.__private__.combineFontStyleAndFontWeight=function(L,le){if(L=="bold"&&le=="normal"||L=="bold"&&le==400||L=="normal"&&le=="italic"||L=="bold"&&le=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return le&&(L=le==400||le==="normal"?L==="italic"?"italic":"normal":le!=700&&le!=="bold"||L!=="normal"?(le==700?"bold":le)+""+L:"bold"),L};R.advancedAPI=function(L){var le=J===$;return le&&ge.call(this),typeof L!="function"||(L(this),le&&ie.call(this)),this},R.compatAPI=function(L){var le=J===re;return le&&ie.call(this),typeof L!="function"||(L(this),le&&ge.call(this)),this},R.isAdvancedAPI=function(){return J===re};var Ae,V=function(L){if(J!==re)throw new Error(L+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ce=R.roundToPrecision=R.__private__.roundToPrecision=function(L,le){var Oe=o||le;if(isNaN(L)||isNaN(Oe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return L.toFixed(Oe).replace(/0+$/,"")};Ae=R.hpf=R.__private__.hpf=typeof v=="number"?function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return ce(L,v)}:v==="smart"?function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return ce(L,L>-1&&L<1?16:5)}:function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.hpf");return ce(L,16)};var Y=R.f2=R.__private__.f2=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.f2");return ce(L,2)},z=R.__private__.f3=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.f3");return ce(L,3)},te=R.scale=R.__private__.scale=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.scale");return J===$?L*ds:J===re?L:void 0},se=function(L){return te(function(le){return J===$?wl()-le:J===re?le:void 0}(L))};R.__private__.setPrecision=R.setPrecision=function(L){typeof parseInt(L,10)=="number"&&(o=parseInt(L,10))};var Ce,he="00000000000000000000000000000000",Ne=R.__private__.getFileId=function(){return he},Z=R.__private__.setFileId=function(L){return he=L!==void 0&&/^[a-fA-F0-9]{32}$/.test(L)?L.toUpperCase():he.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),C!==null&&(Ei=new hg(C.userPermissions,C.userPassword,C.ownerPassword,he)),he};R.setFileId=function(L){return Z(L),this},R.getFileId=function(){return Ne()};var Ie=R.__private__.convertDateToPDFDate=function(L){var le=L.getTimezoneOffset(),Oe=le<0?"+":"-",Me=Math.floor(Math.abs(le/60)),Ze=Math.abs(le%60),yt=[Oe,ue(Me),"'",ue(Ze),"'"].join("");return["D:",L.getFullYear(),ue(L.getMonth()+1),ue(L.getDate()),ue(L.getHours()),ue(L.getMinutes()),ue(L.getSeconds()),yt].join("")},Ve=R.__private__.convertPDFDateToDate=function(L){var le=parseInt(L.substr(2,4),10),Oe=parseInt(L.substr(6,2),10)-1,Me=parseInt(L.substr(8,2),10),Ze=parseInt(L.substr(10,2),10),yt=parseInt(L.substr(12,2),10),Lt=parseInt(L.substr(14,2),10);return new Date(le,Oe,Me,Ze,yt,Lt,0)},Pe=R.__private__.setCreationDate=function(L){var le;if(L===void 0&&(L=new Date),L instanceof Date)le=Ie(L);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(L))throw new Error("Invalid argument passed to jsPDF.setCreationDate");le=L}return Ce=le},ne=R.__private__.getCreationDate=function(L){var le=Ce;return L==="jsDate"&&(le=Ve(Ce)),le};R.setCreationDate=function(L){return Pe(L),this},R.getCreationDate=function(L){return ne(L)};var ve,ue=R.__private__.padd2=function(L){return("0"+parseInt(L)).slice(-2)},Te=R.__private__.padd2Hex=function(L){return("00"+(L=L.toString())).substr(L.length)},Be=0,Ue=[],tt=[],ot=0,ut=[],Tt=[],Qe=!1,it=tt;R.__private__.setCustomOutputDestination=function(L){Qe=!0,it=L};var kt=function(L){Qe||(it=L)};R.__private__.resetCustomOutputDestination=function(){Qe=!1,it=tt};var _e=R.__private__.out=function(L){return L=L.toString(),ot+=L.length+1,it.push(L),it},xt=R.__private__.write=function(L){return _e(arguments.length===1?L.toString():Array.prototype.join.call(arguments," "))},Ke=R.__private__.getArrayBuffer=function(L){for(var le=L.length,Oe=new ArrayBuffer(le),Me=new Uint8Array(Oe);le--;)Me[le]=L.charCodeAt(le);return Oe},Je=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];R.__private__.getStandardFonts=function(){return Je};var $e=a.fontSize||16;R.__private__.setFontSize=R.setFontSize=function(L){return $e=J===re?L/ds:L,this};var jt,Kt=R.__private__.getFontSize=R.getFontSize=function(){return J===$?$e:$e*ds},os=a.R2L||!1;R.__private__.setR2L=R.setR2L=function(L){return os=L,this},R.__private__.getR2L=R.getR2L=function(){return os};var ss,mt=R.__private__.setZoomMode=function(L){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(L))jt=L;else if(isNaN(L)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(L)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+L+'" is not recognized.');jt=L}else jt=parseInt(L,10)};R.__private__.getZoomMode=function(){return jt};var Ht,qe=R.__private__.setPageMode=function(L){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(L)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+L+'" is not recognized.');ss=L};R.__private__.getPageMode=function(){return ss};var ht=R.__private__.setLayoutMode=function(L){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(L)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+L+'" is not recognized.');Ht=L};R.__private__.getLayoutMode=function(){return Ht},R.__private__.setDisplayMode=R.setDisplayMode=function(L,le,Oe){return mt(L),ht(le),qe(Oe),this};var Xt={title:"",subject:"",author:"",keywords:"",creator:""};R.__private__.getDocumentProperty=function(L){if(Object.keys(Xt).indexOf(L)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Xt[L]},R.__private__.getDocumentProperties=function(){return Xt},R.__private__.setDocumentProperties=R.setProperties=R.setDocumentProperties=function(L){for(var le in Xt)Xt.hasOwnProperty(le)&&L[le]&&(Xt[le]=L[le]);return this},R.__private__.setDocumentProperty=function(L,le){if(Object.keys(Xt).indexOf(L)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Xt[L]=le};var zt,ds,Qt,Us,bs,cs={},Ds={},zs=[],rs={},Gs={},dt={},Pt={},qt=null,Yt=0,us=[],Ws=new IV(R),ji=a.hotfixes||[],qr={},Ga={},ti=[],Fs=function L(le,Oe,Me,Ze,yt,Lt){if(!(this instanceof L))return new L(le,Oe,Me,Ze,yt,Lt);isNaN(le)&&(le=1),isNaN(Oe)&&(Oe=0),isNaN(Me)&&(Me=0),isNaN(Ze)&&(Ze=1),isNaN(yt)&&(yt=0),isNaN(Lt)&&(Lt=0),this._matrix=[le,Oe,Me,Ze,yt,Lt]};Object.defineProperty(Fs.prototype,"sx",{get:function(){return this._matrix[0]},set:function(L){this._matrix[0]=L}}),Object.defineProperty(Fs.prototype,"shy",{get:function(){return this._matrix[1]},set:function(L){this._matrix[1]=L}}),Object.defineProperty(Fs.prototype,"shx",{get:function(){return this._matrix[2]},set:function(L){this._matrix[2]=L}}),Object.defineProperty(Fs.prototype,"sy",{get:function(){return this._matrix[3]},set:function(L){this._matrix[3]=L}}),Object.defineProperty(Fs.prototype,"tx",{get:function(){return this._matrix[4]},set:function(L){this._matrix[4]=L}}),Object.defineProperty(Fs.prototype,"ty",{get:function(){return this._matrix[5]},set:function(L){this._matrix[5]=L}}),Object.defineProperty(Fs.prototype,"a",{get:function(){return this._matrix[0]},set:function(L){this._matrix[0]=L}}),Object.defineProperty(Fs.prototype,"b",{get:function(){return this._matrix[1]},set:function(L){this._matrix[1]=L}}),Object.defineProperty(Fs.prototype,"c",{get:function(){return this._matrix[2]},set:function(L){this._matrix[2]=L}}),Object.defineProperty(Fs.prototype,"d",{get:function(){return this._matrix[3]},set:function(L){this._matrix[3]=L}}),Object.defineProperty(Fs.prototype,"e",{get:function(){return this._matrix[4]},set:function(L){this._matrix[4]=L}}),Object.defineProperty(Fs.prototype,"f",{get:function(){return this._matrix[5]},set:function(L){this._matrix[5]=L}}),Object.defineProperty(Fs.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Fs.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Fs.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Fs.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Fs.prototype.join=function(L){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Ae).join(L)},Fs.prototype.multiply=function(L){var le=L.sx*this.sx+L.shy*this.shx,Oe=L.sx*this.shy+L.shy*this.sy,Me=L.shx*this.sx+L.sy*this.shx,Ze=L.shx*this.shy+L.sy*this.sy,yt=L.tx*this.sx+L.ty*this.shx+this.tx,Lt=L.tx*this.shy+L.ty*this.sy+this.ty;return new Fs(le,Oe,Me,Ze,yt,Lt)},Fs.prototype.decompose=function(){var L=this.sx,le=this.shy,Oe=this.shx,Me=this.sy,Ze=this.tx,yt=this.ty,Lt=Math.sqrt(L*L+le*le),ys=(L/=Lt)*Oe+(le/=Lt)*Me;Oe-=L*ys,Me-=le*ys;var ks=Math.sqrt(Oe*Oe+Me*Me);return ys/=ks,L*(Me/=ks)<le*(Oe/=ks)&&(L=-L,le=-le,ys=-ys,Lt=-Lt),{scale:new Fs(Lt,0,0,ks,0,0),translate:new Fs(1,0,0,1,Ze,yt),rotate:new Fs(L,le,-le,L,0,0),skew:new Fs(1,0,ys,1,0,0)}},Fs.prototype.toString=function(L){return this.join(" ")},Fs.prototype.inversed=function(){var L=this.sx,le=this.shy,Oe=this.shx,Me=this.sy,Ze=this.tx,yt=this.ty,Lt=1/(L*Me-le*Oe),ys=Me*Lt,ks=-le*Lt,sr=-Oe*Lt,hr=L*Lt;return new Fs(ys,ks,sr,hr,-ys*Ze-sr*yt,-ks*Ze-hr*yt)},Fs.prototype.applyToPoint=function(L){var le=L.x*this.sx+L.y*this.shx+this.tx,Oe=L.x*this.shy+L.y*this.sy+this.ty;return new Lc(le,Oe)},Fs.prototype.applyToRectangle=function(L){var le=this.applyToPoint(L),Oe=this.applyToPoint(new Lc(L.x+L.w,L.y+L.h));return new Eh(le.x,le.y,Oe.x-le.x,Oe.y-le.y)},Fs.prototype.clone=function(){var L=this.sx,le=this.shy,Oe=this.shx,Me=this.sy,Ze=this.tx,yt=this.ty;return new Fs(L,le,Oe,Me,Ze,yt)},R.Matrix=Fs;var pn=R.matrixMult=function(L,le){return le.multiply(L)},Ao=new Fs(1,0,0,1,0,0);R.unitMatrix=R.identityMatrix=Ao;var vt=function(L,le){if(!Gs[L]){var Oe=(le instanceof Gp?"Sh":"P")+(Object.keys(rs).length+1).toString(10);le.id=Oe,Gs[L]=Oe,rs[Oe]=le,Ws.publish("addPattern",le)}};R.ShadingPattern=Gp,R.TilingPattern=fg,R.addShadingPattern=function(L,le){return V("addShadingPattern()"),vt(L,le),this},R.beginTilingPattern=function(L){V("beginTilingPattern()"),Ch(L.boundingBox[0],L.boundingBox[1],L.boundingBox[2]-L.boundingBox[0],L.boundingBox[3]-L.boundingBox[1],L.matrix)},R.endTilingPattern=function(L,le){V("endTilingPattern()"),le.stream=Tt[ve].join(`
`),vt(L,le),Ws.publish("endTilingPattern",le),ti.pop().restore()};var Jt,Js=R.__private__.newObject=function(){var L=Os();return jr(L,!0),L},Os=R.__private__.newObjectDeferred=function(){return Be++,Ue[Be]=function(){return ot},Be},jr=function(L,le){return le=typeof le=="boolean"&&le,Ue[L]=ot,le&&_e(L+" 0 obj"),L},In=R.__private__.newAdditionalObject=function(){var L={objId:Os(),content:""};return ut.push(L),L},On=Os(),Xr=Os(),Aa=R.__private__.decodeColorString=function(L){var le=L.split(" ");if(le.length!==2||le[1]!=="g"&&le[1]!=="G")le.length!==5||le[4]!=="k"&&le[4]!=="K"||(le=[(1-le[0])*(1-le[3]),(1-le[1])*(1-le[3]),(1-le[2])*(1-le[3]),"r"]);else{var Oe=parseFloat(le[0]);le=[Oe,Oe,Oe,"r"]}for(var Me="#",Ze=0;Ze<3;Ze++)Me+=("0"+Math.floor(255*parseFloat(le[Ze])).toString(16)).slice(-2);return Me},ea=R.__private__.encodeColorString=function(L){var le;typeof L=="string"&&(L={ch1:L});var Oe=L.ch1,Me=L.ch2,Ze=L.ch3,yt=L.ch4,Lt=L.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Oe=="string"&&Oe.charAt(0)!=="#"){var ys=new lG(Oe);if(ys.ok)Oe=ys.toHex();else if(!/^\d*\.?\d*$/.test(Oe))throw new Error('Invalid color "'+Oe+'" passed to jsPDF.encodeColorString.')}if(typeof Oe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Oe)&&(Oe="#"+Oe[1]+Oe[1]+Oe[2]+Oe[2]+Oe[3]+Oe[3]),typeof Oe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Oe)){var ks=parseInt(Oe.substr(1),16);Oe=ks>>16&255,Me=ks>>8&255,Ze=255&ks}if(Me===void 0||yt===void 0&&Oe===Me&&Me===Ze)le=typeof Oe=="string"?Oe+" "+Lt[0]:L.precision===2?Y(Oe/255)+" "+Lt[0]:z(Oe/255)+" "+Lt[0];else if(yt===void 0||_n(yt)==="object"){if(yt&&!isNaN(yt.a)&&yt.a===0)return["1.","1.","1.",Lt[1]].join(" ");le=typeof Oe=="string"?[Oe,Me,Ze,Lt[1]].join(" "):L.precision===2?[Y(Oe/255),Y(Me/255),Y(Ze/255),Lt[1]].join(" "):[z(Oe/255),z(Me/255),z(Ze/255),Lt[1]].join(" ")}else le=typeof Oe=="string"?[Oe,Me,Ze,yt,Lt[2]].join(" "):L.precision===2?[Y(Oe),Y(Me),Y(Ze),Y(yt),Lt[2]].join(" "):[z(Oe),z(Me),z(Ze),z(yt),Lt[2]].join(" ");return le},Ka=R.__private__.getFilters=function(){return g},ua=R.__private__.putStream=function(L){var le=(L=L||{}).data||"",Oe=L.filters||Ka(),Me=L.alreadyAppliedFilters||[],Ze=L.addLength1||!1,yt=le.length,Lt=L.objectId,ys=function(Si){return Si};if(C!==null&&Lt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");C!==null&&(ys=Ei.encryptor(Lt,0));var ks={};Oe===!0&&(Oe=["FlateEncode"]);var sr=L.additionalKeyValues||[],hr=(ks=Qs.API.processDataByFilters!==void 0?Qs.API.processDataByFilters(le,Oe):{data:le,reverseChain:[]}).reverseChain+(Array.isArray(Me)?Me.join(" "):Me.toString());if(ks.data.length!==0&&(sr.push({key:"Length",value:ks.data.length}),Ze===!0&&sr.push({key:"Length1",value:yt})),hr.length!=0)if(hr.split("/").length-1==1)sr.push({key:"Filter",value:hr});else{sr.push({key:"Filter",value:"["+hr+"]"});for(var Gr=0;Gr<sr.length;Gr+=1)if(sr[Gr].key==="DecodeParms"){for(var cn=[],Ci=0;Ci<ks.reverseChain.split("/").length-1;Ci+=1)cn.push("null");cn.push(sr[Gr].value),sr[Gr].value="["+cn.join(" ")+"]"}}_e("<<");for(var Jr=0;Jr<sr.length;Jr++)_e("/"+sr[Jr].key+" "+sr[Jr].value);_e(">>"),ks.data.length!==0&&(_e("stream"),_e(ys(ks.data)),_e("endstream"))},rc=R.__private__.putPage=function(L){var le=L.number,Oe=L.data,Me=L.objId,Ze=L.contentsObjId;jr(Me,!0),_e("<</Type /Page"),_e("/Parent "+L.rootDictionaryObjId+" 0 R"),_e("/Resources "+L.resourceDictionaryObjId+" 0 R"),_e("/MediaBox ["+parseFloat(Ae(L.mediaBox.bottomLeftX))+" "+parseFloat(Ae(L.mediaBox.bottomLeftY))+" "+Ae(L.mediaBox.topRightX)+" "+Ae(L.mediaBox.topRightY)+"]"),L.cropBox!==null&&_e("/CropBox ["+Ae(L.cropBox.bottomLeftX)+" "+Ae(L.cropBox.bottomLeftY)+" "+Ae(L.cropBox.topRightX)+" "+Ae(L.cropBox.topRightY)+"]"),L.bleedBox!==null&&_e("/BleedBox ["+Ae(L.bleedBox.bottomLeftX)+" "+Ae(L.bleedBox.bottomLeftY)+" "+Ae(L.bleedBox.topRightX)+" "+Ae(L.bleedBox.topRightY)+"]"),L.trimBox!==null&&_e("/TrimBox ["+Ae(L.trimBox.bottomLeftX)+" "+Ae(L.trimBox.bottomLeftY)+" "+Ae(L.trimBox.topRightX)+" "+Ae(L.trimBox.topRightY)+"]"),L.artBox!==null&&_e("/ArtBox ["+Ae(L.artBox.bottomLeftX)+" "+Ae(L.artBox.bottomLeftY)+" "+Ae(L.artBox.topRightX)+" "+Ae(L.artBox.topRightY)+"]"),typeof L.userUnit=="number"&&L.userUnit!==1&&_e("/UserUnit "+L.userUnit),Ws.publish("putPage",{objId:Me,pageContext:us[le],pageNumber:le,page:Oe}),_e("/Contents "+Ze+" 0 R"),_e(">>"),_e("endobj");var yt=Oe.join(`
`);return J===re&&(yt+=`
Q`),jr(Ze,!0),ua({data:yt,filters:Ka(),objectId:Ze}),_e("endobj"),Me},Sa=R.__private__.putPages=function(){var L,le,Oe=[];for(L=1;L<=Yt;L++)us[L].objId=Os(),us[L].contentsObjId=Os();for(L=1;L<=Yt;L++)Oe.push(rc({number:L,data:Tt[L],objId:us[L].objId,contentsObjId:us[L].contentsObjId,mediaBox:us[L].mediaBox,cropBox:us[L].cropBox,bleedBox:us[L].bleedBox,trimBox:us[L].trimBox,artBox:us[L].artBox,userUnit:us[L].userUnit,rootDictionaryObjId:On,resourceDictionaryObjId:Xr}));jr(On,!0),_e("<</Type /Pages");var Me="/Kids [";for(le=0;le<Yt;le++)Me+=Oe[le]+" 0 R ";_e(Me+"]"),_e("/Count "+Yt),_e(">>"),_e("endobj"),Ws.publish("postPutPages")},nc=function(L){Ws.publish("putFont",{font:L,out:_e,newObject:Js,putStream:ua}),L.isAlreadyPutted!==!0&&(L.objectNumber=Js(),_e("<<"),_e("/Type /Font"),_e("/BaseFont /"+pg(L.postScriptName)),_e("/Subtype /Type1"),typeof L.encoding=="string"&&_e("/Encoding /"+L.encoding),_e("/FirstChar 32"),_e("/LastChar 255"),_e(">>"),_e("endobj"))},ic=function(L){L.objectNumber=Js();var le=[];le.push({key:"Type",value:"/XObject"}),le.push({key:"Subtype",value:"/Form"}),le.push({key:"BBox",value:"["+[Ae(L.x),Ae(L.y),Ae(L.x+L.width),Ae(L.y+L.height)].join(" ")+"]"}),le.push({key:"Matrix",value:"["+L.matrix.toString()+"]"});var Oe=L.pages[1].join(`
`);ua({data:Oe,additionalKeyValues:le,objectId:L.objectNumber}),_e("endobj")},JA=function(L,le){le||(le=21);var Oe=Js(),Me=function(Lt,ys){var ks,sr=[],hr=1/(ys-1);for(ks=0;ks<1;ks+=hr)sr.push(ks);if(sr.push(1),Lt[0].offset!=0){var Gr={offset:0,color:Lt[0].color};Lt.unshift(Gr)}if(Lt[Lt.length-1].offset!=1){var cn={offset:1,color:Lt[Lt.length-1].color};Lt.push(cn)}for(var Ci="",Jr=0,Si=0;Si<sr.length;Si++){for(ks=sr[Si];ks>Lt[Jr+1].offset;)Jr++;var Ni=Lt[Jr].offset,Is=(ks-Ni)/(Lt[Jr+1].offset-Ni),_l=Lt[Jr].color,oc=Lt[Jr+1].color;Ci+=Te(Math.round((1-Is)*_l[0]+Is*oc[0]).toString(16))+Te(Math.round((1-Is)*_l[1]+Is*oc[1]).toString(16))+Te(Math.round((1-Is)*_l[2]+Is*oc[2]).toString(16))}return Ci.trim()}(L.colors,le),Ze=[];Ze.push({key:"FunctionType",value:"0"}),Ze.push({key:"Domain",value:"[0.0 1.0]"}),Ze.push({key:"Size",value:"["+le+"]"}),Ze.push({key:"BitsPerSample",value:"8"}),Ze.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ze.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),ua({data:Me,additionalKeyValues:Ze,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Oe}),_e("endobj"),L.objectNumber=Js(),_e("<< /ShadingType "+L.type),_e("/ColorSpace /DeviceRGB");var yt="/Coords ["+Ae(parseFloat(L.coords[0]))+" "+Ae(parseFloat(L.coords[1]))+" ";L.type===2?yt+=Ae(parseFloat(L.coords[2]))+" "+Ae(parseFloat(L.coords[3])):yt+=Ae(parseFloat(L.coords[2]))+" "+Ae(parseFloat(L.coords[3]))+" "+Ae(parseFloat(L.coords[4]))+" "+Ae(parseFloat(L.coords[5])),_e(yt+="]"),L.matrix&&_e("/Matrix ["+L.matrix.toString()+"]"),_e("/Function "+Oe+" 0 R"),_e("/Extend [true true]"),_e(">>"),_e("endobj")},$A=function(L,le){var Oe=Os(),Me=Js();le.push({resourcesOid:Oe,objectOid:Me}),L.objectNumber=Me;var Ze=[];Ze.push({key:"Type",value:"/Pattern"}),Ze.push({key:"PatternType",value:"1"}),Ze.push({key:"PaintType",value:"1"}),Ze.push({key:"TilingType",value:"1"}),Ze.push({key:"BBox",value:"["+L.boundingBox.map(Ae).join(" ")+"]"}),Ze.push({key:"XStep",value:Ae(L.xStep)}),Ze.push({key:"YStep",value:Ae(L.yStep)}),Ze.push({key:"Resources",value:Oe+" 0 R"}),L.matrix&&Ze.push({key:"Matrix",value:"["+L.matrix.toString()+"]"}),ua({data:L.stream,additionalKeyValues:Ze,objectId:L.objectNumber}),_e("endobj")},Ro=function(L){for(var le in L.objectNumber=Js(),_e("<<"),L)switch(le){case"opacity":_e("/ca "+Y(L[le]));break;case"stroke-opacity":_e("/CA "+Y(L[le]))}_e(">>"),_e("endobj")},fh=function(L){jr(L.resourcesOid,!0),_e("<<"),_e("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var le in _e("/Font <<"),cs)cs.hasOwnProperty(le)&&(I===!1||I===!0&&O.hasOwnProperty(le))&&_e("/"+le+" "+cs[le].objectNumber+" 0 R");_e(">>")}(),function(){if(Object.keys(rs).length>0){for(var le in _e("/Shading <<"),rs)rs.hasOwnProperty(le)&&rs[le]instanceof Gp&&rs[le].objectNumber>=0&&_e("/"+le+" "+rs[le].objectNumber+" 0 R");Ws.publish("putShadingPatternDict"),_e(">>")}}(),function(le){if(Object.keys(rs).length>0){for(var Oe in _e("/Pattern <<"),rs)rs.hasOwnProperty(Oe)&&rs[Oe]instanceof R.TilingPattern&&rs[Oe].objectNumber>=0&&rs[Oe].objectNumber<le&&_e("/"+Oe+" "+rs[Oe].objectNumber+" 0 R");Ws.publish("putTilingPatternDict"),_e(">>")}}(L.objectOid),function(){if(Object.keys(dt).length>0){var le;for(le in _e("/ExtGState <<"),dt)dt.hasOwnProperty(le)&&dt[le].objectNumber>=0&&_e("/"+le+" "+dt[le].objectNumber+" 0 R");Ws.publish("putGStateDict"),_e(">>")}}(),function(){for(var le in _e("/XObject <<"),qr)qr.hasOwnProperty(le)&&qr[le].objectNumber>=0&&_e("/"+le+" "+qr[le].objectNumber+" 0 R");Ws.publish("putXobjectDict"),_e(">>")}(),_e(">>"),_e("endobj")},om=function(L){Ds[L.fontName]=Ds[L.fontName]||{},Ds[L.fontName][L.fontStyle]=L.id},Kn=function(L,le,Oe,Me,Ze){var yt={id:"F"+(Object.keys(cs).length+1).toString(10),postScriptName:L,fontName:le,fontStyle:Oe,encoding:Me,isStandardFont:Ze||!1,metadata:{}};return Ws.publish("addFont",{font:yt,instance:this}),cs[yt.id]=yt,om(yt),yt.id},Io=R.__private__.pdfEscape=R.pdfEscape=function(L,le){return function(Oe,Me){var Ze,yt,Lt,ys,ks,sr,hr,Gr,cn;if(Lt=(Me=Me||{}).sourceEncoding||"Unicode",ks=Me.outputEncoding,(Me.autoencode||ks)&&cs[zt].metadata&&cs[zt].metadata[Lt]&&cs[zt].metadata[Lt].encoding&&(ys=cs[zt].metadata[Lt].encoding,!ks&&cs[zt].encoding&&(ks=cs[zt].encoding),!ks&&ys.codePages&&(ks=ys.codePages[0]),typeof ks=="string"&&(ks=ys[ks]),ks)){for(hr=!1,sr=[],Ze=0,yt=Oe.length;Ze<yt;Ze++)(Gr=ks[Oe.charCodeAt(Ze)])?sr.push(String.fromCharCode(Gr)):sr.push(Oe[Ze]),sr[Ze].charCodeAt(0)>>8&&(hr=!0);Oe=sr.join("")}for(Ze=Oe.length;hr===void 0&&Ze!==0;)Oe.charCodeAt(Ze-1)>>8&&(hr=!0),Ze--;if(!hr)return Oe;for(sr=Me.noBOM?[]:[254,255],Ze=0,yt=Oe.length;Ze<yt;Ze++){if((cn=(Gr=Oe.charCodeAt(Ze))>>8)>>8)throw new Error("Character at position "+Ze+" of string '"+Oe+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");sr.push(cn),sr.push(Gr-(cn<<8))}return String.fromCharCode.apply(void 0,sr)}(L,le).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},gh=R.__private__.beginPage=function(L){Tt[++Yt]=[],us[Yt]={objId:0,contentsObjId:0,userUnit:Number(x),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(L[0]),topRightY:Number(L[1])}},ZA(Yt),kt(Tt[ve])},cm=function(L,le){var Oe,Me,Ze;switch(c=le||c,typeof L=="string"&&(Oe=H(L.toLowerCase()),Array.isArray(Oe)&&(Me=Oe[0],Ze=Oe[1])),Array.isArray(L)&&(Me=L[0]*ds,Ze=L[1]*ds),isNaN(Me)&&(Me=h[0],Ze=h[1]),(Me>14400||Ze>14400)&&(Mn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Me=Math.min(14400,Me),Ze=Math.min(14400,Ze)),h=[Me,Ze],c.substr(0,1)){case"l":Ze>Me&&(h=[Ze,Me]);break;case"p":Me>Ze&&(h=[Ze,Me])}gh(h),nr(wh),_e(nu),yh!==0&&_e(yh+" J"),Oo!==0&&_e(Oo+" j"),Ws.publish("addPage",{pageNumber:Yt})},bh=function(L){L>0&&L<=Yt&&(Tt.splice(L,1),us.splice(L,1),Yt--,ve>Yt&&(ve=Yt),this.setPage(ve))},ZA=function(L){L>0&&L<=Yt&&(ve=L)},lm=R.__private__.getNumberOfPages=R.getNumberOfPages=function(){return Tt.length-1},xh=function(L,le,Oe){var Me,Ze=void 0;return Oe=Oe||{},L=L!==void 0?L:cs[zt].fontName,le=le!==void 0?le:cs[zt].fontStyle,Me=L.toLowerCase(),Ds[Me]!==void 0&&Ds[Me][le]!==void 0?Ze=Ds[Me][le]:Ds[L]!==void 0&&Ds[L][le]!==void 0?Ze=Ds[L][le]:Oe.disableWarning===!1&&Mn.warn("Unable to look up font label for font '"+L+"', '"+le+"'. Refer to getFontList() for available fonts."),Ze||Oe.noFallback||(Ze=Ds.times[le])==null&&(Ze=Ds.times.normal),Ze},kc=R.__private__.putInfo=function(){var L=Js(),le=function(Me){return Me};for(var Oe in C!==null&&(le=Ei.encryptor(L,0)),_e("<<"),_e("/Producer ("+Io(le("jsPDF "+Qs.version))+")"),Xt)Xt.hasOwnProperty(Oe)&&Xt[Oe]&&_e("/"+Oe.substr(0,1).toUpperCase()+Oe.substr(1)+" ("+Io(le(Xt[Oe]))+")");_e("/CreationDate ("+Io(le(Ce))+")"),_e(">>"),_e("endobj")},eu=R.__private__.putCatalog=function(L){var le=(L=L||{}).rootDictionaryObjId||On;switch(Js(),_e("<<"),_e("/Type /Catalog"),_e("/Pages "+le+" 0 R"),jt||(jt="fullwidth"),jt){case"fullwidth":_e("/OpenAction [3 0 R /FitH null]");break;case"fullheight":_e("/OpenAction [3 0 R /FitV null]");break;case"fullpage":_e("/OpenAction [3 0 R /Fit]");break;case"original":_e("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Oe=""+jt;Oe.substr(Oe.length-1)==="%"&&(jt=parseInt(jt)/100),typeof jt=="number"&&_e("/OpenAction [3 0 R /XYZ null null "+Y(jt)+"]")}switch(Ht||(Ht="continuous"),Ht){case"continuous":_e("/PageLayout /OneColumn");break;case"single":_e("/PageLayout /SinglePage");break;case"two":case"twoleft":_e("/PageLayout /TwoColumnLeft");break;case"tworight":_e("/PageLayout /TwoColumnRight")}ss&&_e("/PageMode /"+ss),Ws.publish("putCatalog"),_e(">>"),_e("endobj")},Fg=R.__private__.putTrailer=function(){_e("trailer"),_e("<<"),_e("/Size "+(Be+1)),_e("/Root "+Be+" 0 R"),_e("/Info "+(Be-1)+" 0 R"),C!==null&&_e("/Encrypt "+Ei.oid+" 0 R"),_e("/ID [ <"+he+"> <"+he+"> ]"),_e(">>")},kn=R.__private__.putHeader=function(){_e("%PDF-"+k),_e("%")},tu=R.__private__.putXRef=function(){var L="0000000000";_e("xref"),_e("0 "+(Be+1)),_e("0000000000 65535 f ");for(var le=1;le<=Be;le++)typeof Ue[le]=="function"?_e((L+Ue[le]()).slice(-10)+" 00000 n "):Ue[le]!==void 0?_e((L+Ue[le]).slice(-10)+" 00000 n "):_e("0000000000 00000 n ")},Dc=R.__private__.buildDocument=function(){var L;Be=0,ot=0,tt=[],Ue=[],ut=[],On=Os(),Xr=Os(),kt(tt),Ws.publish("buildDocument"),kn(),Sa(),function(){Ws.publish("putAdditionalObjects");for(var Oe=0;Oe<ut.length;Oe++){var Me=ut[Oe];jr(Me.objId,!0),_e(Me.content),_e("endobj")}Ws.publish("postPutAdditionalObjects")}(),L=[],function(){for(var Oe in cs)cs.hasOwnProperty(Oe)&&(I===!1||I===!0&&O.hasOwnProperty(Oe))&&nc(cs[Oe])}(),function(){var Oe;for(Oe in dt)dt.hasOwnProperty(Oe)&&Ro(dt[Oe])}(),function(){for(var Oe in qr)qr.hasOwnProperty(Oe)&&ic(qr[Oe])}(),function(Oe){var Me;for(Me in rs)rs.hasOwnProperty(Me)&&(rs[Me]instanceof Gp?JA(rs[Me]):rs[Me]instanceof fg&&$A(rs[Me],Oe))}(L),Ws.publish("putResources"),L.forEach(fh),fh({resourcesOid:Xr,objectOid:Number.MAX_SAFE_INTEGER}),Ws.publish("postPutResources"),C!==null&&(Ei.oid=Js(),_e("<<"),_e("/Filter /Standard"),_e("/V "+Ei.v),_e("/R "+Ei.r),_e("/U <"+Ei.toHexString(Ei.U)+">"),_e("/O <"+Ei.toHexString(Ei.O)+">"),_e("/P "+Ei.P),_e(">>"),_e("endobj")),kc(),eu();var le=ot;return tu(),Fg(),_e("startxref"),_e(""+le),_e("%%EOF"),kt(Tt[ve]),tt.join(`
`)},Hr=R.__private__.getBlob=function(L){return new Blob([Ke(L)],{type:"application/pdf"})},dm=R.output=R.__private__.output=(Jt=function(L,le){switch(typeof(le=le||{})=="string"?le={filename:le}:le.filename=le.filename||"generated.pdf",L){case void 0:return Dc();case"save":R.save(le.filename);break;case"arraybuffer":return Ke(Dc());case"blob":return Hr(Dc());case"bloburi":case"bloburl":if(ar.URL!==void 0&&typeof ar.URL.createObjectURL=="function")return ar.URL&&ar.URL.createObjectURL(Hr(Dc()))||void 0;Mn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Oe="",Me=Dc();try{Oe=NV(Me)}catch{Oe=NV(unescape(encodeURIComponent(Me)))}return"data:application/pdf;filename="+le.filename+";base64,"+Oe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ar)==="[object Window]"){var Ze="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",yt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';le.pdfObjectUrl&&(Ze=le.pdfObjectUrl,yt="");var Lt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ze+'"'+yt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(le)+");<\/script></body></html>",ys=ar.open();return ys!==null&&ys.document.write(Lt),ys}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ar)==="[object Window]"){var ks='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(le.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+le.filename+'" width="500px" height="400px" /></body></html>',sr=ar.open();if(sr!==null){sr.document.write(ks);var hr=this;sr.document.documentElement.querySelector("#pdfViewer").onload=function(){sr.document.title=le.filename,sr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(hr.output("bloburl"))}}return sr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ar)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Gr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",le)+'"></iframe></body></html>',cn=ar.open();if(cn!==null&&(cn.document.write(Gr),cn.document.title=le.filename),cn||typeof safari>"u")return cn;break;case"datauri":case"dataurl":return ar.document.location.href=this.output("datauristring",le);default:return null}},Jt.foo=function(){try{return Jt.apply(this,arguments)}catch(Oe){var L=Oe.stack||"";~L.indexOf(" at ")&&(L=L.split(" at ")[1]);var le="Error in function "+L.split(`
`)[0].split("<")[0]+": "+Oe.message;if(!ar.console)throw new Error(le);ar.console.error(le,Oe),ar.alert&&alert(le)}},Jt.foo.bar=Jt,Jt.foo),uo=function(L){return Array.isArray(ji)===!0&&ji.indexOf(L)>-1};switch(d){case"pt":ds=1;break;case"mm":ds=72/25.4;break;case"cm":ds=72/2.54;break;case"in":ds=72;break;case"px":ds=uo("px_scaling")==1?.75:96/72;break;case"pc":case"em":ds=12;break;case"ex":ds=6;break;default:if(typeof d!="number")throw new Error("Invalid unit: "+d);ds=d}var Ei=null;Pe(),Z();var fl=R.__private__.getPageInfo=R.getPageInfo=function(L){if(isNaN(L)||L%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:us[L].objId,pageNumber:L,pageContext:us[L]}},Am=R.__private__.getPageInfoByObjId=function(L){if(isNaN(L)||L%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var le in us)if(us[le].objId===L)break;return fl(le)},Mg=R.__private__.getCurrentPageInfo=R.getCurrentPageInfo=function(){return{objId:us[ve].objId,pageNumber:ve,pageContext:us[ve]}};R.addPage=function(){return cm.apply(this,arguments),this},R.setPage=function(){return ZA.apply(this,arguments),kt.call(this,Tt[ve]),this},R.insertPage=function(L){return this.addPage(),this.movePage(ve,L),this},R.movePage=function(L,le){var Oe,Me;if(L>le){Oe=Tt[L],Me=us[L];for(var Ze=L;Ze>le;Ze--)Tt[Ze]=Tt[Ze-1],us[Ze]=us[Ze-1];Tt[le]=Oe,us[le]=Me,this.setPage(le)}else if(L<le){Oe=Tt[L],Me=us[L];for(var yt=L;yt<le;yt++)Tt[yt]=Tt[yt+1],us[yt]=us[yt+1];Tt[le]=Oe,us[le]=Me,this.setPage(le)}return this},R.deletePage=function(){return bh.apply(this,arguments),this},R.__private__.text=R.text=function(L,le,Oe,Me,Ze){var yt,Lt,ys,ks,sr,hr,Gr,cn,Ci,Jr=(Me=Me||{}).scope||this;if(typeof L=="number"&&typeof le=="number"&&(typeof Oe=="string"||Array.isArray(Oe))){var Si=Oe;Oe=le,le=L,L=Si}if(arguments[3]instanceof Fs==0?(ys=arguments[4],ks=arguments[5],_n(Gr=arguments[3])==="object"&&Gr!==null||(typeof ys=="string"&&(ks=ys,ys=null),typeof Gr=="string"&&(ks=Gr,Gr=null),typeof Gr=="number"&&(ys=Gr,Gr=null),Me={flags:Gr,angle:ys,align:ks})):(V("The transform parameter of text() with a Matrix value"),Ci=Ze),isNaN(le)||isNaN(Oe)||L==null)throw new Error("Invalid arguments passed to jsPDF.text");if(L.length===0)return Jr;var Ni,Is="",_l=typeof Me.lineHeightFactor=="number"?Me.lineHeightFactor:sA,oc=Jr.internal.scaleFactor;function yl(tn){return tn=tn.split("	").join(Array(Me.TabLen||9).join(" ")),Io(tn,Gr)}function Nh(tn){for(var mn,pi=tn.concat(),Ri=[],Cl=pi.length;Cl--;)typeof(mn=pi.shift())=="string"?Ri.push(mn):Array.isArray(tn)&&(mn.length===1||mn[1]===void 0&&mn[2]===void 0)?Ri.push(mn[0]):Ri.push([mn[0],mn[1],mn[2]]);return Ri}function cd(tn,mn){var pi;if(typeof tn=="string")pi=mn(tn)[0];else if(Array.isArray(tn)){for(var Ri,Cl,jh=tn.concat(),fd=[],ou=jh.length;ou--;)typeof(Ri=jh.shift())=="string"?fd.push(mn(Ri)[0]):Array.isArray(Ri)&&typeof Ri[0]=="string"&&(Cl=mn(Ri[0],Ri[1],Ri[2]),fd.push([Cl[0],Cl[1],Cl[2]]));pi=fd}return pi}var ld=!1,iA=!0;if(typeof L=="string")ld=!0;else if(Array.isArray(L)){var aA=L.concat();Lt=[];for(var Pc,ta=aA.length;ta--;)(typeof(Pc=aA.shift())!="string"||Array.isArray(Pc)&&typeof Pc[0]!="string")&&(iA=!1);ld=iA}if(ld===!1)throw new Error('Type of text must be string or Array. "'+L+'" is not recognized.');typeof L=="string"&&(L=L.match(/[\r?\n]/)?L.split(/\r\n|\r|\n/g):[L]);var oA=$e/Jr.internal.scaleFactor,dd=oA*(_l-1);switch(Me.baseline){case"bottom":Oe-=dd;break;case"top":Oe+=oA-dd;break;case"hanging":Oe+=oA-2*dd;break;case"middle":Oe+=oA/2-dd}if((hr=Me.maxWidth||0)>0&&(typeof L=="string"?L=Jr.splitTextToSize(L,hr):Object.prototype.toString.call(L)==="[object Array]"&&(L=L.reduce(function(tn,mn){return tn.concat(Jr.splitTextToSize(mn,hr))},[]))),yt={text:L,x:le,y:Oe,options:Me,mutex:{pdfEscape:Io,activeFontKey:zt,fonts:cs,activeFontSize:$e}},Ws.publish("preProcessText",yt),L=yt.text,ys=(Me=yt.options).angle,Ci instanceof Fs==0&&ys&&typeof ys=="number"){ys*=Math.PI/180,Me.rotationDirection===0&&(ys=-ys),J===re&&(ys=-ys);var Th=Math.cos(ys),Do=Math.sin(ys);Ci=new Fs(Th,Do,-Do,Th,0,0)}else ys&&ys instanceof Fs&&(Ci=ys);J!==re||Ci||(Ci=Ao),(sr=Me.charSpace||vl)!==void 0&&(Is+=Ae(te(sr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(cn=Me.horizontalScale)!==void 0&&(Is+=Ae(100*cn)+` Tz
`),Me.lang;var Ta=-1,El=Me.renderingMode!==void 0?Me.renderingMode:Me.stroke,au=Jr.internal.getCurrentPageInfo().pageContext;switch(El){case 0:case!1:case"fill":Ta=0;break;case 1:case!0:case"stroke":Ta=1;break;case 2:case"fillThenStroke":Ta=2;break;case 3:case"invisible":Ta=3;break;case 4:case"fillAndAddForClipping":Ta=4;break;case 5:case"strokeAndAddPathForClipping":Ta=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Ta=6;break;case 7:case"addToPathForClipping":Ta=7}var Rh=au.usedRenderingMode!==void 0?au.usedRenderingMode:-1;Ta!==-1?Is+=Ta+` Tr
`:Rh!==-1&&(Is+=`0 Tr
`),Ta!==-1&&(au.usedRenderingMode=Ta),ks=Me.align||"left";var Wa,cA=$e*_l,Ih=Jr.internal.pageSize.getWidth(),Oh=cs[zt];sr=Me.charSpace||vl,hr=Me.maxWidth||0,Gr=Object.assign({autoencode:!0,noBOM:!0},Me.flags);var Ti=[],lA=function(tn){return Jr.getStringUnitWidth(tn,{font:Oh,charSpace:sr,fontSize:$e,doKerning:!1})*$e/oc};if(Object.prototype.toString.call(L)==="[object Array]"){var ho;Lt=Nh(L),ks!=="left"&&(Wa=Lt.map(lA));var po,Ad=0;if(ks==="right"){le-=Wa[0],L=[],ta=Lt.length;for(var cc=0;cc<ta;cc++)cc===0?(po=bl(le),ho=xl(Oe)):(po=te(Ad-Wa[cc]),ho=-cA),L.push([Lt[cc],po,ho]),Ad=Wa[cc]}else if(ks==="center"){le-=Wa[0]/2,L=[],ta=Lt.length;for(var ud=0;ud<ta;ud++)ud===0?(po=bl(le),ho=xl(Oe)):(po=te((Ad-Wa[ud])/2),ho=-cA),L.push([Lt[ud],po,ho]),Ad=Wa[ud]}else if(ks==="left"){L=[],ta=Lt.length;for(var kh=0;kh<ta;kh++)L.push(Lt[kh])}else if(ks==="justify"&&Oh.encoding==="Identity-H"){L=[],ta=Lt.length,hr=hr!==0?hr:Ih;for(var dA=0,Wn=0;Wn<ta;Wn++)if(ho=Wn===0?xl(Oe):-cA,po=Wn===0?bl(le):dA,Wn<ta-1){var vm=te((hr-Wa[Wn])/(Lt[Wn].split(" ").length-1)),Uc=Lt[Wn].split(" ");L.push([Uc[0]+" ",po,ho]),dA=0;for(var mo=1;mo<Uc.length;mo++){var Dh=(lA(Uc[mo-1]+" "+Uc[mo])-lA(Uc[mo]))*oc+vm;mo==Uc.length-1?L.push([Uc[mo],Dh,0]):L.push([Uc[mo]+" ",Dh,0]),dA-=Dh}}else L.push([Lt[Wn],po,ho]);L.push(["",dA,0])}else{if(ks!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(L=[],ta=Lt.length,hr=hr!==0?hr:Ih,Wn=0;Wn<ta;Wn++){ho=Wn===0?xl(Oe):-cA,po=Wn===0?bl(le):0;var Bh=Lt[Wn].split(" ").length-1,Lh=Bh>0?(hr-Wa[Wn])/Bh:0;Wn<ta-1?Ti.push(Ae(te(Lh))):Ti.push(0),L.push([Lt[Wn],po,ho])}}}(typeof Me.R2L=="boolean"?Me.R2L:os)===!0&&(L=cd(L,function(tn,mn,pi){return[tn.split("").reverse().join(""),mn,pi]})),yt={text:L,x:le,y:Oe,options:Me,mutex:{pdfEscape:Io,activeFontKey:zt,fonts:cs,activeFontSize:$e}},Ws.publish("postProcessText",yt),L=yt.text,Ni=yt.mutex.isHex||!1;var Bo=cs[zt].encoding;Bo!=="WinAnsiEncoding"&&Bo!=="StandardEncoding"||(L=cd(L,function(tn,mn,pi){return[yl(tn),mn,pi]})),Lt=Nh(L),L=[];for(var hd,pd,si,AA=Array.isArray(Lt[0])?1:0,md="",uA=function(tn,mn,pi){var Ri="";return pi instanceof Fs?(pi=typeof Me.angle=="number"?pn(pi,new Fs(1,0,0,1,tn,mn)):pn(new Fs(1,0,0,1,tn,mn),pi),J===re&&(pi=pn(new Fs(1,0,0,-1,0,0),pi)),Ri=pi.join(" ")+` Tm
`):Ri=Ae(tn)+" "+Ae(mn)+` Td
`,Ri},Lo=0;Lo<Lt.length;Lo++){switch(md="",AA){case 1:si=(Ni?"<":"(")+Lt[Lo][0]+(Ni?">":")"),hd=parseFloat(Lt[Lo][1]),pd=parseFloat(Lt[Lo][2]);break;case 0:si=(Ni?"<":"(")+Lt[Lo]+(Ni?">":")"),hd=bl(le),pd=xl(Oe)}Ti!==void 0&&Ti[Lo]!==void 0&&(md=Ti[Lo]+` Tw
`),Lo===0?L.push(md+uA(hd,pd,Ci)+si):AA===0?L.push(md+si):AA===1&&L.push(md+uA(hd,pd,Ci)+si)}L=AA===0?L.join(` Tj
T* `):L.join(` Tj
`),L+=` Tj
`;var lc=`BT
/`;return lc+=zt+" "+$e+` Tf
`,lc+=Ae($e*_l)+` TL
`,lc+=nA+`
`,lc+=Is,lc+=L,_e(lc+="ET"),O[zt]=!0,Jr};var Vg=R.__private__.clip=R.clip=function(L){return _e(L==="evenodd"?"W*":"W"),this};R.clipEvenOdd=function(){return Vg("evenodd")},R.__private__.discardPath=R.discardPath=function(){return _e("n"),this};var Bc=R.__private__.isValidStyle=function(L){var le=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(L)!==-1&&(le=!0),le};R.__private__.setDefaultPathOperation=R.setDefaultPathOperation=function(L){return Bc(L)&&(E=L),this};var um=R.__private__.getStyle=R.getStyle=function(L){var le=E;switch(L){case"D":case"S":le="S";break;case"F":le="f";break;case"FD":case"DF":le="B";break;case"f":case"f*":case"B":case"B*":le=L}return le},su=R.close=function(){return _e("h"),this};R.stroke=function(){return _e("S"),this},R.fill=function(L){return tA("f",L),this},R.fillEvenOdd=function(L){return tA("f*",L),this},R.fillStroke=function(L){return tA("B",L),this},R.fillStrokeEvenOdd=function(L){return tA("B*",L),this};var tA=function(L,le){_n(le)==="object"?vh(le,L):_e(L)},gl=function(L){L===null||J===re&&L===void 0||(L=um(L),_e(L))};function Qg(L,le,Oe,Me,Ze){var yt=new fg(le||this.boundingBox,Oe||this.xStep,Me||this.yStep,this.gState,Ze||this.matrix);yt.stream=this.stream;var Lt=L+"$$"+this.cloneIndex+++"$$";return vt(Lt,yt),yt}var vh=function(L,le){var Oe=Gs[L.key],Me=rs[Oe];if(Me instanceof Gp)_e("q"),_e(Hg(le)),Me.gState&&R.setGState(Me.gState),_e(L.matrix.toString()+" cm"),_e("/"+Oe+" sh"),_e("Q");else if(Me instanceof fg){var Ze=new Fs(1,0,0,-1,0,wl());L.matrix&&(Ze=Ze.multiply(L.matrix||Ao),Oe=Qg.call(Me,L.key,L.boundingBox,L.xStep,L.yStep,Ze).id),_e("q"),_e("/Pattern cs"),_e("/"+Oe+" scn"),Me.gState&&R.setGState(Me.gState),_e(le),_e("Q")}},Hg=function(L){switch(L){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},ru=R.moveTo=function(L,le){return _e(Ae(te(L))+" "+Ae(se(le))+" m"),this},hm=R.lineTo=function(L,le){return _e(Ae(te(L))+" "+Ae(se(le))+" l"),this},ac=R.curveTo=function(L,le,Oe,Me,Ze,yt){return _e([Ae(te(L)),Ae(se(le)),Ae(te(Oe)),Ae(se(Me)),Ae(te(Ze)),Ae(se(yt)),"c"].join(" ")),this};R.__private__.line=R.line=function(L,le,Oe,Me,Ze){if(isNaN(L)||isNaN(le)||isNaN(Oe)||isNaN(Me)||!Bc(Ze))throw new Error("Invalid arguments passed to jsPDF.line");return J===$?this.lines([[Oe-L,Me-le]],L,le,[1,1],Ze||"S"):this.lines([[Oe-L,Me-le]],L,le,[1,1]).stroke()},R.__private__.lines=R.lines=function(L,le,Oe,Me,Ze,yt){var Lt,ys,ks,sr,hr,Gr,cn,Ci,Jr,Si,Ni,Is;if(typeof L=="number"&&(Is=Oe,Oe=le,le=L,L=Is),Me=Me||[1,1],yt=yt||!1,isNaN(le)||isNaN(Oe)||!Array.isArray(L)||!Array.isArray(Me)||!Bc(Ze)||typeof yt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(ru(le,Oe),Lt=Me[0],ys=Me[1],sr=L.length,Si=le,Ni=Oe,ks=0;ks<sr;ks++)(hr=L[ks]).length===2?(Si=hr[0]*Lt+Si,Ni=hr[1]*ys+Ni,hm(Si,Ni)):(Gr=hr[0]*Lt+Si,cn=hr[1]*ys+Ni,Ci=hr[2]*Lt+Si,Jr=hr[3]*ys+Ni,Si=hr[4]*Lt+Si,Ni=hr[5]*ys+Ni,ac(Gr,cn,Ci,Jr,Si,Ni));return yt&&su(),gl(Ze),this},R.path=function(L){for(var le=0;le<L.length;le++){var Oe=L[le],Me=Oe.c;switch(Oe.op){case"m":ru(Me[0],Me[1]);break;case"l":hm(Me[0],Me[1]);break;case"c":ac.apply(this,Me);break;case"h":su()}}return this},R.__private__.rect=R.rect=function(L,le,Oe,Me,Ze){if(isNaN(L)||isNaN(le)||isNaN(Oe)||isNaN(Me)||!Bc(Ze))throw new Error("Invalid arguments passed to jsPDF.rect");return J===$&&(Me=-Me),_e([Ae(te(L)),Ae(se(le)),Ae(te(Oe)),Ae(te(Me)),"re"].join(" ")),gl(Ze),this},R.__private__.triangle=R.triangle=function(L,le,Oe,Me,Ze,yt,Lt){if(isNaN(L)||isNaN(le)||isNaN(Oe)||isNaN(Me)||isNaN(Ze)||isNaN(yt)||!Bc(Lt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Oe-L,Me-le],[Ze-Oe,yt-Me],[L-Ze,le-yt]],L,le,[1,1],Lt,!0),this},R.__private__.roundedRect=R.roundedRect=function(L,le,Oe,Me,Ze,yt,Lt){if(isNaN(L)||isNaN(le)||isNaN(Oe)||isNaN(Me)||isNaN(Ze)||isNaN(yt)||!Bc(Lt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ys=4/3*(Math.SQRT2-1);return Ze=Math.min(Ze,.5*Oe),yt=Math.min(yt,.5*Me),this.lines([[Oe-2*Ze,0],[Ze*ys,0,Ze,yt-yt*ys,Ze,yt],[0,Me-2*yt],[0,yt*ys,-Ze*ys,yt,-Ze,yt],[2*Ze-Oe,0],[-Ze*ys,0,-Ze,-yt*ys,-Ze,-yt],[0,2*yt-Me],[0,-yt*ys,Ze*ys,-yt,Ze,-yt]],L+Ze,le,[1,1],Lt,!0),this},R.__private__.ellipse=R.ellipse=function(L,le,Oe,Me,Ze){if(isNaN(L)||isNaN(le)||isNaN(Oe)||isNaN(Me)||!Bc(Ze))throw new Error("Invalid arguments passed to jsPDF.ellipse");var yt=4/3*(Math.SQRT2-1)*Oe,Lt=4/3*(Math.SQRT2-1)*Me;return ru(L+Oe,le),ac(L+Oe,le-Lt,L+yt,le-Me,L,le-Me),ac(L-yt,le-Me,L-Oe,le-Lt,L-Oe,le),ac(L-Oe,le+Lt,L-yt,le+Me,L,le+Me),ac(L+yt,le+Me,L+Oe,le+Lt,L+Oe,le),gl(Ze),this},R.__private__.circle=R.circle=function(L,le,Oe,Me){if(isNaN(L)||isNaN(le)||isNaN(Oe)||!Bc(Me))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(L,le,Oe,Oe,Me)},R.setFont=function(L,le,Oe){return Oe&&(le=we(le,Oe)),zt=xh(L,le,{disableWarning:!1}),this};var Gg=R.__private__.getFont=R.getFont=function(){return cs[xh.apply(R,arguments)]};R.__private__.getFontList=R.getFontList=function(){var L,le,Oe={};for(L in Ds)if(Ds.hasOwnProperty(L))for(le in Oe[L]=[],Ds[L])Ds[L].hasOwnProperty(le)&&Oe[L].push(le);return Oe},R.addFont=function(L,le,Oe,Me,Ze){var yt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&yt.indexOf(arguments[3])!==-1?Ze=arguments[3]:arguments[3]&&yt.indexOf(arguments[3])==-1&&(Oe=we(Oe,Me)),Kn.call(this,L,le,Oe,Ze=Ze||"Identity-H")};var sA,wh=a.lineWidth||.200025,Kg=R.__private__.getLineWidth=R.getLineWidth=function(){return wh},nr=R.__private__.setLineWidth=R.setLineWidth=function(L){return wh=L,_e(Ae(te(L))+" w"),this};R.__private__.setLineDash=Qs.API.setLineDash=Qs.API.setLineDashPattern=function(L,le){if(L=L||[],le=le||0,isNaN(le)||!Array.isArray(L))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return L=L.map(function(Oe){return Ae(te(Oe))}).join(" "),le=Ae(te(le)),_e("["+L+"] "+le+" d"),this};var Wg=R.__private__.getLineHeight=R.getLineHeight=function(){return $e*sA};R.__private__.getLineHeight=R.getLineHeight=function(){return $e*sA};var pm=R.__private__.setLineHeightFactor=R.setLineHeightFactor=function(L){return typeof(L=L||1.15)=="number"&&(sA=L),this},zg=R.__private__.getLineHeightFactor=R.getLineHeightFactor=function(){return sA};pm(a.lineHeight);var bl=R.__private__.getHorizontalCoordinate=function(L){return te(L)},xl=R.__private__.getVerticalCoordinate=function(L){return J===re?L:us[ve].mediaBox.topRightY-us[ve].mediaBox.bottomLeftY-te(L)},rA=R.__private__.getHorizontalCoordinateString=R.getHorizontalCoordinateString=function(L){return Ae(bl(L))},qg=R.__private__.getVerticalCoordinateString=R.getVerticalCoordinateString=function(L){return Ae(xl(L))},nu=a.strokeColor||"0 G";R.__private__.getStrokeColor=R.getDrawColor=function(){return Aa(nu)},R.__private__.setStrokeColor=R.setDrawColor=function(L,le,Oe,Me){return nu=ea({ch1:L,ch2:le,ch3:Oe,ch4:Me,pdfColorType:"draw",precision:2}),_e(nu),this};var _h=a.fillColor||"0 g";R.__private__.getFillColor=R.getFillColor=function(){return Aa(_h)},R.__private__.setFillColor=R.setFillColor=function(L,le,Oe,Me){return _h=ea({ch1:L,ch2:le,ch3:Oe,ch4:Me,pdfColorType:"fill",precision:2}),_e(_h),this};var nA=a.textColor||"0 g",mm=R.__private__.getTextColor=R.getTextColor=function(){return Aa(nA)};R.__private__.setTextColor=R.setTextColor=function(L,le,Oe,Me){return nA=ea({ch1:L,ch2:le,ch3:Oe,ch4:Me,pdfColorType:"text",precision:3}),this};var vl=a.charSpace,Yg=R.__private__.getCharSpace=R.getCharSpace=function(){return parseFloat(vl||0)};R.__private__.setCharSpace=R.setCharSpace=function(L){if(isNaN(L))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return vl=L,this};var yh=0;R.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},R.__private__.setLineCap=R.setLineCap=function(L){var le=R.CapJoinStyles[L];if(le===void 0)throw new Error("Line cap style of '"+L+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return yh=le,_e(le+" J"),this};var Oo=0;R.__private__.setLineJoin=R.setLineJoin=function(L){var le=R.CapJoinStyles[L];if(le===void 0)throw new Error("Line join style of '"+L+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Oo=le,_e(le+" j"),this},R.__private__.setLineMiterLimit=R.__private__.setMiterLimit=R.setLineMiterLimit=R.setMiterLimit=function(L){if(L=L||0,isNaN(L))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return _e(Ae(te(L))+" M"),this},R.GState=tE,R.setGState=function(L){(L=typeof L=="string"?dt[Pt[L]]:Na(null,L)).equals(qt)||(_e("/"+L.id+" gs"),qt=L)};var Na=function(L,le){if(!L||!Pt[L]){var Oe=!1;for(var Me in dt)if(dt.hasOwnProperty(Me)&&dt[Me].equals(le)){Oe=!0;break}if(Oe)le=dt[Me];else{var Ze="GS"+(Object.keys(dt).length+1).toString(10);dt[Ze]=le,le.id=Ze}return L&&(Pt[L]=le.id),Ws.publish("addGState",le),le}};R.addGState=function(L,le){return Na(L,le),this},R.saveGraphicsState=function(){return _e("q"),zs.push({key:zt,size:$e,color:nA}),this},R.restoreGraphicsState=function(){_e("Q");var L=zs.pop();return zt=L.key,$e=L.size,nA=L.color,qt=null,this},R.setCurrentTransformationMatrix=function(L){return _e(L.toString()+" cm"),this},R.comment=function(L){return _e("#"+L),this};var Lc=function(L,le){var Oe=L||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Oe},set:function(yt){isNaN(yt)||(Oe=parseFloat(yt))}});var Me=le||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Me},set:function(yt){isNaN(yt)||(Me=parseFloat(yt))}});var Ze="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ze},set:function(yt){Ze=yt.toString()}}),this},Eh=function(L,le,Oe,Me){Lc.call(this,L,le),this.type="rect";var Ze=Oe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ze},set:function(Lt){isNaN(Lt)||(Ze=parseFloat(Lt))}});var yt=Me||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return yt},set:function(Lt){isNaN(Lt)||(yt=parseFloat(Lt))}}),this},iu=function(){this.page=Yt,this.currentPage=ve,this.pages=Tt.slice(0),this.pagesContext=us.slice(0),this.x=Qt,this.y=Us,this.matrix=bs,this.width=Sh(ve),this.height=gm(ve),this.outputDestination=it,this.id="",this.objectNumber=-1};iu.prototype.restore=function(){Yt=this.page,ve=this.currentPage,us=this.pagesContext,Tt=this.pages,Qt=this.x,Us=this.y,bs=this.matrix,fm(ve,this.width),ko(ve,this.height),it=this.outputDestination};var Ch=function(L,le,Oe,Me,Ze){ti.push(new iu),Yt=ve=0,Tt=[],Qt=L,Us=le,bs=Ze,gh([Oe,Me])};for(var hi in R.beginFormObject=function(L,le,Oe,Me,Ze){return Ch(L,le,Oe,Me,Ze),this},R.endFormObject=function(L){return function(le){if(Ga[le])ti.pop().restore();else{var Oe=new iu,Me="Xo"+(Object.keys(qr).length+1).toString(10);Oe.id=Me,Ga[le]=Me,qr[Me]=Oe,Ws.publish("addFormObject",Oe),ti.pop().restore()}}(L),this},R.doFormObject=function(L,le){var Oe=qr[Ga[L]];return _e("q"),_e(le.toString()+" cm"),_e("/"+Oe.id+" Do"),_e("Q"),this},R.getFormObject=function(L){var le=qr[Ga[L]];return{x:le.x,y:le.y,width:le.width,height:le.height,matrix:le.matrix}},R.save=function(L,le){return L=L||"generated.pdf",(le=le||{}).returnPromise=le.returnPromise||!1,le.returnPromise===!1?(Vp(Hr(Dc()),L),typeof Vp.unload=="function"&&ar.setTimeout&&setTimeout(Vp.unload,911),this):new Promise(function(Oe,Me){try{var Ze=Vp(Hr(Dc()),L);typeof Vp.unload=="function"&&ar.setTimeout&&setTimeout(Vp.unload,911),Oe(Ze)}catch(yt){Me(yt.message)}})},Qs.API)Qs.API.hasOwnProperty(hi)&&(hi==="events"&&Qs.API.events.length?function(L,le){var Oe,Me,Ze;for(Ze=le.length-1;Ze!==-1;Ze--)Oe=le[Ze][0],Me=le[Ze][1],L.subscribe.apply(L,[Oe].concat(typeof Me=="function"?[Me]:Me))}(Ws,Qs.API.events):R[hi]=Qs.API[hi]);function Sh(L){return us[L].mediaBox.topRightX-us[L].mediaBox.bottomLeftX}function fm(L,le){us[L].mediaBox.topRightX=le+us[L].mediaBox.bottomLeftX}function gm(L){return us[L].mediaBox.topRightY-us[L].mediaBox.bottomLeftY}function ko(L,le){us[L].mediaBox.topRightY=le+us[L].mediaBox.bottomLeftY}var jc=R.getPageWidth=function(L){return Sh(L=L||ve)/ds},bm=R.setPageWidth=function(L,le){fm(L,le*ds)},wl=R.getPageHeight=function(L){return gm(L=L||ve)/ds},xm=R.setPageHeight=function(L,le){ko(L,le*ds)};return R.internal={pdfEscape:Io,getStyle:um,getFont:Gg,getFontSize:Kt,getCharSpace:Yg,getTextColor:mm,getLineHeight:Wg,getLineHeightFactor:zg,getLineWidth:Kg,write:xt,getHorizontalCoordinate:bl,getVerticalCoordinate:xl,getCoordinateString:rA,getVerticalCoordinateString:qg,collections:{},newObject:Js,newAdditionalObject:In,newObjectDeferred:Os,newObjectDeferredBegin:jr,getFilters:Ka,putStream:ua,events:Ws,scaleFactor:ds,pageSize:{getWidth:function(){return jc(ve)},setWidth:function(L){bm(ve,L)},getHeight:function(){return wl(ve)},setHeight:function(L){xm(ve,L)}},encryptionOptions:C,encryption:Ei,getEncryptor:function(L){return C!==null?Ei.encryptor(L,0):function(le){return le}},output:dm,getNumberOfPages:lm,get pages(){return Tt},out:_e,f2:Y,f3:z,getPageInfo:fl,getPageInfoByObjId:Am,getCurrentPageInfo:Mg,getPDFVersion:M,Point:Lc,Rectangle:Eh,Matrix:Fs,hasHotfix:uo},Object.defineProperty(R.internal.pageSize,"width",{get:function(){return jc(ve)},set:function(L){bm(ve,L)},enumerable:!0,configurable:!0}),Object.defineProperty(R.internal.pageSize,"height",{get:function(){return wl(ve)},set:function(L){xm(ve,L)},enumerable:!0,configurable:!0}),(function(L){for(var le=0,Oe=Je.length;le<Oe;le++){var Me=Kn.call(this,L[le][0],L[le][1],L[le][2],Je[le][3],!0);I===!1&&(O[Me]=!0);var Ze=L[le][0].split("-");om({id:Me,fontName:Ze[0],fontStyle:Ze[1]||""})}Ws.publish("addFonts",{fonts:cs,dictionary:Ds})}).call(R,Je),zt="F1",cm(h,c),Ws.publish("initialized"),R}hg.prototype.lsbFirstWord=function(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)},hg.prototype.toHexString=function(a){return a.split("").map(function(o){return("0"+(255&o.charCodeAt(0)).toString(16)).slice(-2)}).join("")},hg.prototype.hexToBytes=function(a){for(var o=[],c=0;c<a.length;c+=2)o.push(String.fromCharCode(parseInt(a.substr(c,2),16)));return o.join("")},hg.prototype.processOwnerPassword=function(a,o){return GR(HR(o).substr(0,5),a)},hg.prototype.encryptor=function(a,o){var c=HR(this.encryptionKey+String.fromCharCode(255&a,a>>8&255,a>>16&255,255&o,o>>8&255)).substr(0,10);return function(d){return GR(c,d)}},tE.prototype.equals=function(a){var o,c="id,objectNumber,equals";if(!a||_n(a)!==_n(this))return!1;var d=0;for(o in this)if(!(c.indexOf(o)>=0)){if(this.hasOwnProperty(o)&&!a.hasOwnProperty(o)||this[o]!==a[o])return!1;d++}for(o in a)a.hasOwnProperty(o)&&c.indexOf(o)<0&&d--;return d===0},Qs.API={events:[]},Qs.version="4.2.0";var Bi=Qs.API,bI=1,am=function(a){return a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ag=function(a){return a.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},rm=function(a){return a.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(o){var c=o.charCodeAt(0).toString(16).toUpperCase();return"#"+(c.length===1?"0"+c:c)})},gr=function(a){return a.toFixed(2)},qu=function(a){return a.toFixed(5)};Bi.__acroform__={};var sc=function(a,o){a.prototype=Object.create(o.prototype),a.prototype.constructor=a},OV=function(a){return a*bI},zd=function(a){var o=new hG,c=Rs.internal.getHeight(a)||0,d=Rs.internal.getWidth(a)||0;return o.BBox=[0,0,Number(gr(d)),Number(gr(c))],o},Ige=Bi.__acroform__.setBit=function(a,o){if(a=a||0,o=o||0,isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return a|1<<o},Oge=Bi.__acroform__.clearBit=function(a,o){if(a=a||0,o=o||0,isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return a&~(1<<o)},kge=Bi.__acroform__.getBit=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return a&1<<o?1:0},Ki=Bi.__acroform__.getBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return kge(a,o-1)},Wi=Bi.__acroform__.setBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Ige(a,o-1)},zi=Bi.__acroform__.clearBitForPdf=function(a,o){if(isNaN(a)||isNaN(o))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Oge(a,o-1)},Dge=Bi.__acroform__.calculateCoordinates=function(a,o){var c=o.internal.getHorizontalCoordinate,d=o.internal.getVerticalCoordinate,h=a[0],p=a[1],g=a[2],x=a[3],v={};return v.lowerLeft_X=c(h)||0,v.lowerLeft_Y=d(p+x)||0,v.upperRight_X=c(h+g)||0,v.upperRight_Y=d(p)||0,[Number(gr(v.lowerLeft_X)),Number(gr(v.lowerLeft_Y)),Number(gr(v.upperRight_X)),Number(gr(v.upperRight_Y))]},Bge=function(a){if(a.appearanceStreamContent)return a.appearanceStreamContent;if(a.V||a.DV){var o=[],c=a._V||a.DV,d=KR(a,c),h=a.scope.internal.getFont(a.fontName,a.fontStyle).id;o.push("/Tx BMC"),o.push("q"),o.push("BT"),o.push(a.scope.__private__.encodeColorString(a.color)),o.push("/"+h+" "+gr(d.fontSize)+" Tf"),o.push("1 0 0 1 0 0 Tm"),o.push(d.text),o.push("ET"),o.push("Q"),o.push("EMC");var p=zd(a);return p.scope=a.scope,p.stream=o.join(`
`),p}},KR=function(a,o){var c=a.fontSize===0?a.maxFontSize:a.fontSize,d={text:"",fontSize:""},h=(o=(o=o.substr(0,1)=="("?o.substr(1):o).substr(o.length-1)==")"?o.substr(0,o.length-1):o).split(" ");h=a.multiline?h.map(function(Y){return Y.split(`
`)}):h.map(function(Y){return[Y]});var p=c,g=Rs.internal.getHeight(a)||0;g=g<0?-g:g;var x=Rs.internal.getWidth(a)||0;x=x<0?-x:x;var v=function(Y,z,te){if(Y+1<h.length){var se=z+" "+h[Y+1][0];return my(se,a,te).width<=x-4}return!1};p++;e:for(;p>0;){o="",p--;var E,C,I=my("3",a,p).height,O=a.multiline?g-p:(g-I)/2,R=O+=2,k=0,M=0,P=0;if(p<=0){o=`(...) Tj
`,o+="% Width of Text: "+my(o,a,p=12).width+", FieldWidth:"+x+`
`;break}for(var H="",$=0,re=0;re<h.length;re++)if(h.hasOwnProperty(re)){var J=!1;if(h[re].length!==1&&P!==h[re].length-1){if((I+2)*($+2)+2>g)continue e;H+=h[re][P],J=!0,M=re,re--}else{H=(H+=h[re][P]+" ").substr(H.length-1)==" "?H.substr(0,H.length-1):H;var ge=parseInt(re),ie=v(ge,H,p),we=re>=h.length-1;if(ie&&!we){H+=" ",P=0;continue}if(ie||we){if(we)M=ge;else if(a.multiline&&(I+2)*($+2)+2>g)continue e}else{if(!a.multiline||(I+2)*($+2)+2>g)continue e;M=ge}}for(var Ae="",V=k;V<=M;V++){var ce=h[V];if(a.multiline){if(V===M){Ae+=ce[P]+" ",P=(P+1)%ce.length;continue}if(V===k){Ae+=ce[ce.length-1]+" ";continue}}Ae+=ce[0]+" "}switch(Ae=Ae.substr(Ae.length-1)==" "?Ae.substr(0,Ae.length-1):Ae,C=my(Ae,a,p).width,a.textAlign){case"right":E=x-C-2;break;case"center":E=(x-C)/2;break;default:E=2}o+=gr(E)+" "+gr(R)+` Td
`,o+="("+am(Ae)+`) Tj
`,o+=-gr(E)+` 0 Td
`,R=-(p+2),C=0,k=J?M:M+1,$++,H=""}break}return d.text=o,d.fontSize=p,d},my=function(a,o,c){var d=o.scope.internal.getFont(o.fontName,o.fontStyle),h=o.scope.getStringUnitWidth(a,{font:d,fontSize:parseFloat(c),charSpace:0})*parseFloat(c);return{height:o.scope.getStringUnitWidth("3",{font:d,fontSize:parseFloat(c),charSpace:0})*parseFloat(c)*1.5,width:h}},Lge={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},jge=function(a,o){var c={type:"reference",object:a};o.internal.getPageInfo(a.page).pageContext.annotations.find(function(d){return d.type===c.type&&d.object===c.object})===void 0&&o.internal.getPageInfo(a.page).pageContext.annotations.push(c)},Pge=function(a,o){if(o.scope=a,a.internal!==void 0&&(a.internal.acroformPlugin===void 0||a.internal.acroformPlugin.isInitialized===!1)){if(ad.FieldNum=0,a.internal.acroformPlugin=JSON.parse(JSON.stringify(Lge)),a.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");bI=a.internal.scaleFactor,a.internal.acroformPlugin.acroFormDictionaryRoot=new pG,a.internal.acroformPlugin.acroFormDictionaryRoot.scope=a,a.internal.acroformPlugin.acroFormDictionaryRoot._eventID=a.internal.events.subscribe("postPutResources",function(){(function(c){c.internal.events.unsubscribe(c.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete c.internal.acroformPlugin.acroFormDictionaryRoot._eventID,c.internal.acroformPlugin.printedOut=!0})(a)}),a.internal.events.subscribe("buildDocument",function(){(function(c){c.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var d=c.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var h in d)if(d.hasOwnProperty(h)){var p=d[h];p.objId=void 0,p.hasAnnotation&&jge(p,c)}})(a)}),a.internal.events.subscribe("putCatalog",function(){(function(c){if(c.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");c.internal.write("/AcroForm "+c.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(a)}),a.internal.events.subscribe("postPutPages",function(c){(function(d,h){var p=!d;for(var g in d||(h.internal.newObjectDeferredBegin(h.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),h.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),d=d||h.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(d.hasOwnProperty(g)){var x=d[g],v=[],E=x.Rect;if(x.Rect&&(x.Rect=Dge(x.Rect,h)),h.internal.newObjectDeferredBegin(x.objId,!0),x.DA=Rs.createDefaultAppearanceStream(x),_n(x)==="object"&&typeof x.getKeyValueListForStream=="function"&&(v=x.getKeyValueListForStream()),x.Rect=E,x.hasAppearanceStream&&!x.appearanceStreamContent){var C=Bge(x);v.push({key:"AP",value:"<</N "+C+">>"}),h.internal.acroformPlugin.xForms.push(C)}if(x.appearanceStreamContent){var I="";for(var O in x.appearanceStreamContent)if(x.appearanceStreamContent.hasOwnProperty(O)){var R=x.appearanceStreamContent[O];if(I+="/"+O+" ",I+="<<",Object.keys(R).length>=1||Array.isArray(R)){for(var g in R)if(R.hasOwnProperty(g)){var k=R[g];typeof k=="function"&&(k=k.call(h,x)),I+="/"+g+" "+k+" ",h.internal.acroformPlugin.xForms.indexOf(k)>=0||h.internal.acroformPlugin.xForms.push(k)}}else typeof(k=R)=="function"&&(k=k.call(h,x)),I+="/"+g+" "+k,h.internal.acroformPlugin.xForms.indexOf(k)>=0||h.internal.acroformPlugin.xForms.push(k);I+=">>"}v.push({key:"AP",value:`<<
`+I+">>"})}h.internal.putStream({additionalKeyValues:v,objectId:x.objId}),h.internal.out("endobj")}p&&function(M,P){for(var H in M)if(M.hasOwnProperty(H)){var $=H,re=M[H];P.internal.newObjectDeferredBegin(re.objId,!0),_n(re)==="object"&&typeof re.putStream=="function"&&re.putStream(),delete M[$]}}(h.internal.acroformPlugin.xForms,h)})(c,a)}),a.internal.acroformPlugin.isInitialized=!0}},uG=Bi.__acroform__.arrayToPdfArray=function(a,o,c){var d=function(g){return g};if(Array.isArray(a)){for(var h="[",p=0;p<a.length;p++)switch(p!==0&&(h+=" "),_n(a[p])){case"boolean":case"number":case"object":h+=a[p].toString();break;case"string":a[p].substr(0,1)==="/"?h+="/"+rm(a[p].substr(1)):(o!==void 0&&c&&(d=c.internal.getEncryptor(o)),h+="("+am(d(a[p].toString()))+")")}return h+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},UT=function(a,o,c){var d=function(h){return h};return o!==void 0&&c&&(d=c.internal.getEncryptor(o)),(a=a||"").toString(),"("+am(d(a))+")"},Xd=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(a){this._objId=a}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Xd.prototype.toString=function(){return this.objId+" 0 R"},Xd.prototype.putStream=function(){var a=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:a,objectId:this.objId}),this.scope.internal.out("endobj")},Xd.prototype.getKeyValueListForStream=function(){var a=[],o=Object.getOwnPropertyNames(this).filter(function(p){return p!="content"&&p!="appearanceStreamContent"&&p!="scope"&&p!="objId"&&p.substring(0,1)!="_"});for(var c in o)if(Object.getOwnPropertyDescriptor(this,o[c]).configurable===!1){var d=o[c],h=this[d];h&&(Array.isArray(h)?a.push({key:d,value:uG(h,this.objId,this.scope)}):h instanceof Xd?(h.scope=this.scope,a.push({key:d,value:h.objId+" 0 R"})):typeof h!="function"&&a.push({key:d,value:h}))}return a};var hG=function(){Xd.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var a,o=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return o},set:function(c){o=c}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(c){a=c.trim()},get:function(){return a||null}})};sc(hG,Xd);var pG=function(){Xd.call(this);var a,o=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return o.length>0?o:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return o}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(a){var c=function(d){return d};return this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),"("+am(c(a))+")"}},set:function(c){a=c}})};sc(pG,Xd);var ad=function a(){Xd.call(this);var o=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return o},set:function(H){if(isNaN(H))throw new Error('Invalid value "'+H+'" for attribute F supplied.');o=H}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ki(o,3)},set:function(H){H?this.F=Wi(o,3):this.F=zi(o,3)}});var c=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return c},set:function(H){if(isNaN(H))throw new Error('Invalid value "'+H+'" for attribute Ff supplied.');c=H}});var d=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(d.length!==0)return d},set:function(H){d=H!==void 0?H:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[0])?0:d[0]},set:function(H){d[0]=H}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[1])?0:d[1]},set:function(H){d[1]=H}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[2])?0:d[2]},set:function(H){d[2]=H}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!d||isNaN(d[3])?0:d[3]},set:function(H){d[3]=H}});var h="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return h},set:function(H){switch(H){case"/Btn":case"/Tx":case"/Ch":case"/Sig":h=H;break;default:throw new Error('Invalid value "'+H+'" for attribute FT supplied.')}}});var p=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!p||p.length<1){if(this instanceof sE)return;p="FieldObject"+a.FieldNum++}var H=function($){return $};return this.scope&&(H=this.scope.internal.getEncryptor(this.objId)),"("+am(H(p))+")"},set:function(H){p=H.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return p},set:function(H){p=H}});var g="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return g},set:function(H){g=H}});var x="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return x},set:function(H){x=H}});var v=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return v},set:function(H){v=H}});var E=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return E===void 0?50/bI:E},set:function(H){E=H}});var C="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return C},set:function(H){C=H}});var I="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!I||this instanceof sE||this instanceof Zp))return UT(I,this.objId,this.scope)},set:function(H){H=H.toString(),I=H}});var O=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(O)return this instanceof Ea==0?UT(O,this.objId,this.scope):O},set:function(H){H=H.toString(),O=this instanceof Ea==0?H.substr(0,1)==="("?ag(H.substr(1,H.length-2)):ag(H):H}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ea==1?ag(O.substr(1,O.length-1)):O},set:function(H){H=H.toString(),O=this instanceof Ea==1?"/"+rm(H):H}});var R=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(R)return R},set:function(H){this.V=H}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(R)return this instanceof Ea==0?UT(R,this.objId,this.scope):R},set:function(H){H=H.toString(),R=this instanceof Ea==0?H.substr(0,1)==="("?ag(H.substr(1,H.length-2)):ag(H):H}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ea==1?ag(R.substr(1,R.length-1)):R},set:function(H){H=H.toString(),R=this instanceof Ea==1?"/"+rm(H):H}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var k,M=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return M},set:function(H){H=!!H,M=H}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(k)return k},set:function(H){k=H}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,1)},set:function(H){H?this.Ff=Wi(this.Ff,1):this.Ff=zi(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,2)},set:function(H){H?this.Ff=Wi(this.Ff,2):this.Ff=zi(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,3)},set:function(H){H?this.Ff=Wi(this.Ff,3):this.Ff=zi(this.Ff,3)}});var P=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(P!==null)return P},set:function(H){if([0,1,2].indexOf(H)===-1)throw new Error('Invalid value "'+H+'" for attribute Q supplied.');P=H}}),Object.defineProperty(this,"textAlign",{get:function(){var H;switch(P){case 0:default:H="left";break;case 1:H="center";break;case 2:H="right"}return H},configurable:!0,enumerable:!0,set:function(H){switch(H){case"right":case 2:P=2;break;case"center":case 1:P=1;break;default:P=0}}})};sc(ad,Xd);var xg=function(){ad.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var a=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return a},set:function(c){a=c}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return a},set:function(c){a=c}});var o=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return uG(o,this.objId,this.scope)},set:function(c){var d,h;h=[],typeof(d=c)=="string"&&(h=function(p,g,x){x||(x=1);for(var v,E=[];v=g.exec(p);)E.push(v[x]);return E}(d,/\((.*?)\)/g)),o=h}}),this.getOptions=function(){return o},this.setOptions=function(c){o=c,this.sort&&o.sort()},this.addOption=function(c){c=(c=c||"").toString(),o.push(c),this.sort&&o.sort()},this.removeOption=function(c,d){for(d=d||!1,c=(c=c||"").toString();o.indexOf(c)!==-1&&(o.splice(o.indexOf(c),1),d!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,18)},set:function(c){c?this.Ff=Wi(this.Ff,18):this.Ff=zi(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,19)},set:function(c){this.combo===!0&&(c?this.Ff=Wi(this.Ff,19):this.Ff=zi(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,20)},set:function(c){c?(this.Ff=Wi(this.Ff,20),o.sort()):this.Ff=zi(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,22)},set:function(c){c?this.Ff=Wi(this.Ff,22):this.Ff=zi(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,23)},set:function(c){c?this.Ff=Wi(this.Ff,23):this.Ff=zi(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,27)},set:function(c){c?this.Ff=Wi(this.Ff,27):this.Ff=zi(this.Ff,27)}}),this.hasAppearanceStream=!1};sc(xg,ad);var vg=function(){xg.call(this),this.fontName="helvetica",this.combo=!1};sc(vg,xg);var wg=function(){vg.call(this),this.combo=!0};sc(wg,vg);var Ry=function(){wg.call(this),this.edit=!0};sc(Ry,wg);var Ea=function(){ad.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,15)},set:function(c){c?this.Ff=Wi(this.Ff,15):this.Ff=zi(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,16)},set:function(c){c?this.Ff=Wi(this.Ff,16):this.Ff=zi(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,17)},set:function(c){c?this.Ff=Wi(this.Ff,17):this.Ff=zi(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,26)},set:function(c){c?this.Ff=Wi(this.Ff,26):this.Ff=zi(this.Ff,26)}});var a,o={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var c=function(p){return p};if(this.scope&&(c=this.scope.internal.getEncryptor(this.objId)),Object.keys(o).length!==0){var d,h=[];for(d in h.push("<<"),o)h.push("/"+d+" ("+am(c(o[d]))+")");return h.push(">>"),h.join(`
`)}},set:function(c){_n(c)==="object"&&(o=c)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return o.CA||""},set:function(c){typeof c=="string"&&(o.CA=c)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return a},set:function(c){var d=c==null?"":c.toString();d.substr(0,1)==="/"&&(d=d.substr(1)),a="/"+rm(d)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return a.substr(1,a.length-1)},set:function(c){a="/"+rm(c)}})};sc(Ea,ad);var Iy=function(){Ea.call(this),this.pushButton=!0};sc(Iy,Ea);var _g=function(){Ea.call(this),this.radio=!0,this.pushButton=!1;var a=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return a},set:function(o){a=o!==void 0?o:[]}})};sc(_g,Ea);var sE=function(){var a,o;ad.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return a},set:function(h){a=h}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return o},set:function(h){o=h}});var c,d={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var h=function(x){return x};this.scope&&(h=this.scope.internal.getEncryptor(this.objId));var p,g=[];for(p in g.push("<<"),d)g.push("/"+p+" ("+am(h(d[p]))+")");return g.push(">>"),g.join(`
`)},set:function(h){_n(h)==="object"&&(d=h)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return d.CA||""},set:function(h){typeof h=="string"&&(d.CA=h)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return c},set:function(h){var p=h==null?"":h.toString();p.substr(0,1)==="/"&&(p=p.substr(1)),c="/"+rm(p)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return c.substr(1,c.length-1)},set:function(h){var p=h==null?"":h.toString();p.substr(0,1)==="/"&&(p=p.substr(1)),c="/"+rm(p)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Rs.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};sc(sE,ad),_g.prototype.setAppearance=function(a){if(!("createAppearanceStream"in a)||!("getCA"in a))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var o in this.Kids)if(this.Kids.hasOwnProperty(o)){var c=this.Kids[o];c.appearanceStreamContent=a.createAppearanceStream(c.optionName),c.caption=a.getCA()}},_g.prototype.createOption=function(a){var o=new sE;return o.Parent=this,o.optionName=a,this.Kids.push(o),Uge.call(this.scope,o),o};var Oy=function(){Ea.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Rs.CheckBox.createAppearanceStream()};sc(Oy,Ea);var Zp=function(){ad.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,13)},set:function(o){o?this.Ff=Wi(this.Ff,13):this.Ff=zi(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,21)},set:function(o){o?this.Ff=Wi(this.Ff,21):this.Ff=zi(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,23)},set:function(o){o?this.Ff=Wi(this.Ff,23):this.Ff=zi(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,24)},set:function(o){o?this.Ff=Wi(this.Ff,24):this.Ff=zi(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,25)},set:function(o){o?this.Ff=Wi(this.Ff,25):this.Ff=zi(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,26)},set:function(o){o?this.Ff=Wi(this.Ff,26):this.Ff=zi(this.Ff,26)}});var a=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return a},set:function(o){Number.isInteger(o)&&(a=o)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};sc(Zp,ad);var ky=function(){Zp.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ki(this.Ff,14)},set:function(a){a?this.Ff=Wi(this.Ff,14):this.Ff=zi(this.Ff,14)}}),this.password=!0};sc(ky,Zp);var Rs={CheckBox:{createAppearanceStream:function(){return{N:{On:Rs.CheckBox.YesNormal},D:{On:Rs.CheckBox.YesPushDown,Off:Rs.CheckBox.OffPushDown}}},YesPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=[],d=a.scope.internal.getFont(a.fontName,a.fontStyle).id,h=a.scope.__private__.encodeColorString(a.color),p=KR(a,a.caption);return c.push("0.749023 g"),c.push("0 0 "+gr(Rs.internal.getWidth(a))+" "+gr(Rs.internal.getHeight(a))+" re"),c.push("f"),c.push("BMC"),c.push("q"),c.push("0 0 1 rg"),c.push("/"+d+" "+gr(p.fontSize)+" Tf "+h),c.push("BT"),c.push(p.text),c.push("ET"),c.push("Q"),c.push("EMC"),o.stream=c.join(`
`),o},YesNormal:function(a){var o=zd(a);o.scope=a.scope;var c=a.scope.internal.getFont(a.fontName,a.fontStyle).id,d=a.scope.__private__.encodeColorString(a.color),h=[],p=Rs.internal.getHeight(a),g=Rs.internal.getWidth(a),x=KR(a,a.caption);return h.push("1 g"),h.push("0 0 "+gr(g)+" "+gr(p)+" re"),h.push("f"),h.push("q"),h.push("0 0 1 rg"),h.push("0 0 "+gr(g-1)+" "+gr(p-1)+" re"),h.push("W"),h.push("n"),h.push("0 g"),h.push("BT"),h.push("/"+c+" "+gr(x.fontSize)+" Tf "+d),h.push(x.text),h.push("ET"),h.push("Q"),o.stream=h.join(`
`),o},OffPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+gr(Rs.internal.getWidth(a))+" "+gr(Rs.internal.getHeight(a))+" re"),c.push("f"),o.stream=c.join(`
`),o}},RadioButton:{Circle:{createAppearanceStream:function(a){var o={D:{Off:Rs.RadioButton.Circle.OffPushDown},N:{}};return o.N[a]=Rs.RadioButton.Circle.YesNormal,o.D[a]=Rs.RadioButton.Circle.YesPushDown,o},getCA:function(){return"l"},YesNormal:function(a){var o=zd(a);o.scope=a.scope;var c=[],d=Rs.internal.getWidth(a)<=Rs.internal.getHeight(a)?Rs.internal.getWidth(a)/4:Rs.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Rs.internal.Bezier_C,p=Number((d*h).toFixed(5));return c.push("q"),c.push("1 0 0 1 "+qu(Rs.internal.getWidth(a)/2)+" "+qu(Rs.internal.getHeight(a)/2)+" cm"),c.push(d+" 0 m"),c.push(d+" "+p+" "+p+" "+d+" 0 "+d+" c"),c.push("-"+p+" "+d+" -"+d+" "+p+" -"+d+" 0 c"),c.push("-"+d+" -"+p+" -"+p+" -"+d+" 0 -"+d+" c"),c.push(p+" -"+d+" "+d+" -"+p+" "+d+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o},YesPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=[],d=Rs.internal.getWidth(a)<=Rs.internal.getHeight(a)?Rs.internal.getWidth(a)/4:Rs.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Number((2*d).toFixed(5)),p=Number((h*Rs.internal.Bezier_C).toFixed(5)),g=Number((d*Rs.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+qu(Rs.internal.getWidth(a)/2)+" "+qu(Rs.internal.getHeight(a)/2)+" cm"),c.push(h+" 0 m"),c.push(h+" "+p+" "+p+" "+h+" 0 "+h+" c"),c.push("-"+p+" "+h+" -"+h+" "+p+" -"+h+" 0 c"),c.push("-"+h+" -"+p+" -"+p+" -"+h+" 0 -"+h+" c"),c.push(p+" -"+h+" "+h+" -"+p+" "+h+" 0 c"),c.push("f"),c.push("Q"),c.push("0 g"),c.push("q"),c.push("1 0 0 1 "+qu(Rs.internal.getWidth(a)/2)+" "+qu(Rs.internal.getHeight(a)/2)+" cm"),c.push(d+" 0 m"),c.push(d+" "+g+" "+g+" "+d+" 0 "+d+" c"),c.push("-"+g+" "+d+" -"+d+" "+g+" -"+d+" 0 c"),c.push("-"+d+" -"+g+" -"+g+" -"+d+" 0 -"+d+" c"),c.push(g+" -"+d+" "+d+" -"+g+" "+d+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o},OffPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=[],d=Rs.internal.getWidth(a)<=Rs.internal.getHeight(a)?Rs.internal.getWidth(a)/4:Rs.internal.getHeight(a)/4;d=Number((.9*d).toFixed(5));var h=Number((2*d).toFixed(5)),p=Number((h*Rs.internal.Bezier_C).toFixed(5));return c.push("0.749023 g"),c.push("q"),c.push("1 0 0 1 "+qu(Rs.internal.getWidth(a)/2)+" "+qu(Rs.internal.getHeight(a)/2)+" cm"),c.push(h+" 0 m"),c.push(h+" "+p+" "+p+" "+h+" 0 "+h+" c"),c.push("-"+p+" "+h+" -"+h+" "+p+" -"+h+" 0 c"),c.push("-"+h+" -"+p+" -"+p+" -"+h+" 0 -"+h+" c"),c.push(p+" -"+h+" "+h+" -"+p+" "+h+" 0 c"),c.push("f"),c.push("Q"),o.stream=c.join(`
`),o}},Cross:{createAppearanceStream:function(a){var o={D:{Off:Rs.RadioButton.Cross.OffPushDown},N:{}};return o.N[a]=Rs.RadioButton.Cross.YesNormal,o.D[a]=Rs.RadioButton.Cross.YesPushDown,o},getCA:function(){return"8"},YesNormal:function(a){var o=zd(a);o.scope=a.scope;var c=[],d=Rs.internal.calculateCross(a);return c.push("q"),c.push("1 1 "+gr(Rs.internal.getWidth(a)-2)+" "+gr(Rs.internal.getHeight(a)-2)+" re"),c.push("W"),c.push("n"),c.push(gr(d.x1.x)+" "+gr(d.x1.y)+" m"),c.push(gr(d.x2.x)+" "+gr(d.x2.y)+" l"),c.push(gr(d.x4.x)+" "+gr(d.x4.y)+" m"),c.push(gr(d.x3.x)+" "+gr(d.x3.y)+" l"),c.push("s"),c.push("Q"),o.stream=c.join(`
`),o},YesPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=Rs.internal.calculateCross(a),d=[];return d.push("0.749023 g"),d.push("0 0 "+gr(Rs.internal.getWidth(a))+" "+gr(Rs.internal.getHeight(a))+" re"),d.push("f"),d.push("q"),d.push("1 1 "+gr(Rs.internal.getWidth(a)-2)+" "+gr(Rs.internal.getHeight(a)-2)+" re"),d.push("W"),d.push("n"),d.push(gr(c.x1.x)+" "+gr(c.x1.y)+" m"),d.push(gr(c.x2.x)+" "+gr(c.x2.y)+" l"),d.push(gr(c.x4.x)+" "+gr(c.x4.y)+" m"),d.push(gr(c.x3.x)+" "+gr(c.x3.y)+" l"),d.push("s"),d.push("Q"),o.stream=d.join(`
`),o},OffPushDown:function(a){var o=zd(a);o.scope=a.scope;var c=[];return c.push("0.749023 g"),c.push("0 0 "+gr(Rs.internal.getWidth(a))+" "+gr(Rs.internal.getHeight(a))+" re"),c.push("f"),o.stream=c.join(`
`),o}}},createDefaultAppearanceStream:function(a){var o=a.scope.internal.getFont(a.fontName,a.fontStyle).id,c=a.scope.__private__.encodeColorString(a.color);return"/"+o+" "+a.fontSize+" Tf "+c}};Rs.internal={Bezier_C:.551915024494,calculateCross:function(a){var o=Rs.internal.getWidth(a),c=Rs.internal.getHeight(a),d=Math.min(o,c);return{x1:{x:(o-d)/2,y:(c-d)/2+d},x2:{x:(o-d)/2+d,y:(c-d)/2},x3:{x:(o-d)/2,y:(c-d)/2},x4:{x:(o-d)/2+d,y:(c-d)/2+d}}}},Rs.internal.getWidth=function(a){var o=0;return _n(a)==="object"&&(o=OV(a.Rect[2])),o},Rs.internal.getHeight=function(a){var o=0;return _n(a)==="object"&&(o=OV(a.Rect[3])),o};var Uge=Bi.addField=function(a){if(Pge(this,a),!(a instanceof ad))throw new Error("Invalid argument passed to jsPDF.addField.");var o;return(o=a).scope.internal.acroformPlugin.printedOut&&(o.scope.internal.acroformPlugin.printedOut=!1,o.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),o.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(o),a.page=a.scope.internal.getCurrentPageInfo().pageNumber,this};Bi.AcroFormChoiceField=xg,Bi.AcroFormListBox=vg,Bi.AcroFormComboBox=wg,Bi.AcroFormEditBox=Ry,Bi.AcroFormButton=Ea,Bi.AcroFormPushButton=Iy,Bi.AcroFormRadioButton=_g,Bi.AcroFormCheckBox=Oy,Bi.AcroFormTextField=Zp,Bi.AcroFormPasswordField=ky,Bi.AcroFormAppearance=Rs,Bi.AcroForm={ChoiceField:xg,ListBox:vg,ComboBox:wg,EditBox:Ry,Button:Ea,PushButton:Iy,RadioButton:_g,CheckBox:Oy,TextField:Zp,PasswordField:ky,Appearance:Rs},Qs.AcroForm={ChoiceField:xg,ListBox:vg,ComboBox:wg,EditBox:Ry,Button:Ea,PushButton:Iy,RadioButton:_g,CheckBox:Oy,TextField:Zp,PasswordField:ky,Appearance:Rs};Qs.AcroForm;function mG(a){return a.reduce(function(o,c,d){return o[c]=d,o},{})}(function(a){var o="addImage_";a.__addimage__={};var c="UNKNOWN",d={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},h=a.__addimage__.getImageFileTypeByImageData=function(Y,z){var te,se,Ce,he,Ne,Z=c;if((z=z||c)==="RGBA"||Y.data!==void 0&&Y.data instanceof Uint8ClampedArray&&"height"in Y&&"width"in Y)return"RGBA";if(ie(Y))for(Ne in d)for(Ce=d[Ne],te=0;te<Ce.length;te+=1){for(he=!0,se=0;se<Ce[te].length;se+=1)if(Ce[te][se]!==void 0&&Ce[te][se]!==Y[se]){he=!1;break}if(he===!0){Z=Ne;break}}else for(Ne in d)for(Ce=d[Ne],te=0;te<Ce.length;te+=1){for(he=!0,se=0;se<Ce[te].length;se+=1)if(Ce[te][se]!==void 0&&Ce[te][se]!==Y.charCodeAt(se)){he=!1;break}if(he===!0){Z=Ne;break}}return Z===c&&z!==c&&(Z=z),Z},p=function Y(z){for(var te=this.internal.write,se=this.internal.putStream,Ce=(0,this.internal.getFilters)();Ce.indexOf("FlateEncode")!==-1;)Ce.splice(Ce.indexOf("FlateEncode"),1);z.objectId=this.internal.newObject();var he=[];if(he.push({key:"Type",value:"/XObject"}),he.push({key:"Subtype",value:"/Image"}),he.push({key:"Width",value:z.width}),he.push({key:"Height",value:z.height}),z.colorSpace===H.INDEXED?he.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(z.palette.length/3-1)+" "+("sMask"in z&&z.sMask!==void 0?z.objectId+2:z.objectId+1)+" 0 R]"}):(he.push({key:"ColorSpace",value:"/"+z.colorSpace}),z.colorSpace===H.DEVICE_CMYK&&he.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),he.push({key:"BitsPerComponent",value:z.bitsPerComponent}),"decodeParameters"in z&&z.decodeParameters!==void 0&&he.push({key:"DecodeParms",value:"<<"+z.decodeParameters+">>"}),"transparency"in z&&Array.isArray(z.transparency)&&z.transparency.length>0){for(var Ne="",Z=0,Ie=z.transparency.length;Z<Ie;Z++)Ne+=z.transparency[Z]+" "+z.transparency[Z]+" ";he.push({key:"Mask",value:"["+Ne+"]"})}z.sMask!==void 0&&he.push({key:"SMask",value:z.objectId+1+" 0 R"});var Ve=z.filter!==void 0?["/"+z.filter]:void 0;if(se({data:z.data,additionalKeyValues:he,alreadyAppliedFilters:Ve,objectId:z.objectId}),te("endobj"),"sMask"in z&&z.sMask!==void 0){var Pe,ne=(Pe=z.sMaskBitsPerComponent)!==null&&Pe!==void 0?Pe:z.bitsPerComponent,ve={width:z.width,height:z.height,colorSpace:"DeviceGray",bitsPerComponent:ne,data:z.sMask};"filter"in z&&(ve.decodeParameters="/Predictor ".concat(z.predictor," /Colors 1 /BitsPerComponent ").concat(ne," /Columns ").concat(z.width),ve.filter=z.filter),Y.call(this,ve)}if(z.colorSpace===H.INDEXED){var ue=this.internal.newObject();se({data:Ae(new Uint8Array(z.palette)),objectId:ue}),te("endobj")}},g=function(){var Y=this.internal.collections[o+"images"];for(var z in Y)p.call(this,Y[z])},x=function(){var Y,z=this.internal.collections[o+"images"],te=this.internal.write;for(var se in z)te("/I"+(Y=z[se]).index,Y.objectId,"0","R")},v=function(){this.internal.collections[o+"images"]||(this.internal.collections[o+"images"]={},this.internal.events.subscribe("putResources",g),this.internal.events.subscribe("putXobjectDict",x))},E=function(){var Y=this.internal.collections[o+"images"];return v.call(this),Y},C=function(){return Object.keys(this.internal.collections[o+"images"]).length},I=function(Y){return typeof a["process"+Y.toUpperCase()]=="function"},O=function(Y){return _n(Y)==="object"&&Y.nodeType===1},R=function(Y,z){if(Y.nodeName==="IMG"&&Y.hasAttribute("src")){var te=""+Y.getAttribute("src");if(te.indexOf("data:image/")===0)return Ty(unescape(te).split("base64,").pop());var se=a.loadFile(te,!0);if(se!==void 0)return se}if(Y.nodeName==="CANVAS"){if(Y.width===0||Y.height===0)throw new Error("Given canvas must have data. Canvas width: "+Y.width+", height: "+Y.height);var Ce;switch(z){case"PNG":Ce="image/png";break;case"WEBP":Ce="image/webp";break;default:Ce="image/jpeg"}return Ty(Y.toDataURL(Ce,1).split("base64,").pop())}},k=function(Y){var z=this.internal.collections[o+"images"];if(z){for(var te in z)if(Y===z[te].alias)return z[te]}},M=function(Y,z,te){return Y||z||(Y=-96,z=-96),Y<0&&(Y=-1*te.width*72/Y/this.internal.scaleFactor),z<0&&(z=-1*te.height*72/z/this.internal.scaleFactor),Y===0&&(Y=z*te.width/te.height),z===0&&(z=Y*te.height/te.width),[Y,z]},P=function(Y,z,te,se,Ce,he){var Ne=M.call(this,te,se,Ce),Z=this.internal.getCoordinateString,Ie=this.internal.getVerticalCoordinateString,Ve=E.call(this);if(te=Ne[0],se=Ne[1],Ve[Ce.index]=Ce,he){he*=Math.PI/180;var Pe=Math.cos(he),ne=Math.sin(he),ve=function(Te){return Te.toFixed(4)},ue=[ve(Pe),ve(ne),ve(-1*ne),ve(Pe),0,0,"cm"]}this.internal.write("q"),he?(this.internal.write([1,"0","0",1,Z(Y),Ie(z+se),"cm"].join(" ")),this.internal.write(ue.join(" ")),this.internal.write([Z(te),"0","0",Z(se),"0","0","cm"].join(" "))):this.internal.write([Z(te),"0","0",Z(se),Z(Y),Ie(z+se),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ce.index+" Do"),this.internal.write("Q")},H=a.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};a.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var $=a.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},re=a.__addimage__.sHashCode=function(Y){var z,te,se=0;if(typeof Y=="string")for(te=Y.length,z=0;z<te;z++)se=(se<<5)-se+Y.charCodeAt(z),se|=0;else if(ie(Y))for(te=Y.byteLength/2,z=0;z<te;z++)se=(se<<5)-se+Y[z],se|=0;return se},J=a.__addimage__.validateStringAsBase64=function(Y){(Y=Y||"").toString().trim();var z=!0;return Y.length===0&&(z=!1),Y.length%4!=0&&(z=!1),/^[A-Za-z0-9+/]+$/.test(Y.substr(0,Y.length-2))===!1&&(z=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(Y.substr(-2))===!1&&(z=!1),z},ge=a.__addimage__.extractImageFromDataUrl=function(Y){if(Y==null||!(Y=Y.trim()).startsWith("data:"))return null;var z=Y.indexOf(",");return z<0?null:Y.substring(0,z).trim().endsWith("base64")?Y.substring(z+1):null};a.__addimage__.isArrayBuffer=function(Y){return Y instanceof ArrayBuffer};var ie=a.__addimage__.isArrayBufferView=function(Y){return Y instanceof Int8Array||Y instanceof Uint8Array||Y instanceof Uint8ClampedArray||Y instanceof Int16Array||Y instanceof Uint16Array||Y instanceof Int32Array||Y instanceof Uint32Array||Y instanceof Float32Array||Y instanceof Float64Array},we=a.__addimage__.binaryStringToUint8Array=function(Y){for(var z=Y.length,te=new Uint8Array(z),se=0;se<z;se++)te[se]=Y.charCodeAt(se);return te},Ae=a.__addimage__.arrayBufferToBinaryString=function(Y){for(var z="",te=ie(Y)?Y:new Uint8Array(Y),se=0;se<te.length;se+=8192)z+=String.fromCharCode.apply(null,te.subarray(se,se+8192));return z};a.addImage=function(){var Y,z,te,se,Ce,he,Ne,Z,Ie;if(typeof arguments[1]=="number"?(z=c,te=arguments[1],se=arguments[2],Ce=arguments[3],he=arguments[4],Ne=arguments[5],Z=arguments[6],Ie=arguments[7]):(z=arguments[1],te=arguments[2],se=arguments[3],Ce=arguments[4],he=arguments[5],Ne=arguments[6],Z=arguments[7],Ie=arguments[8]),_n(Y=arguments[0])==="object"&&!O(Y)&&"imageData"in Y){var Ve=Y;Y=Ve.imageData,z=Ve.format||z||c,te=Ve.x||te||0,se=Ve.y||se||0,Ce=Ve.w||Ve.width||Ce,he=Ve.h||Ve.height||he,Ne=Ve.alias||Ne,Z=Ve.compression||Z,Ie=Ve.rotation||Ve.angle||Ie}var Pe=this.internal.getFilters();if(Z===void 0&&Pe.indexOf("FlateEncode")!==-1&&(Z="SLOW"),isNaN(te)||isNaN(se))throw new Error("Invalid coordinates passed to jsPDF.addImage");v.call(this);var ne=V.call(this,Y,z,Ne,Z);return P.call(this,te,se,Ce,he,ne,Ie),this};var V=function(Y,z,te,se){var Ce,he,Ne;if(typeof Y=="string"&&h(Y)===c){Y=unescape(Y);var Z=ce(Y,!1);(Z!==""||(Z=a.loadFile(Y,!0))!==void 0)&&(Y=Z)}if(O(Y)&&(Y=R(Y,z)),z=h(Y,z),!I(z))throw new Error("addImage does not support files of type '"+z+"', please ensure that a plugin for '"+z+"' support is added.");if(((Ne=te)==null||Ne.length===0)&&(te=function(Ie){return typeof Ie=="string"||ie(Ie)?re(Ie):ie(Ie.data)?re(Ie.data):null}(Y)),(Ce=k.call(this,te))||(Y instanceof Uint8Array||z==="RGBA"||(he=Y,Y=we(Y)),Ce=this["process"+z.toUpperCase()](Y,C.call(this),te,function(Ie){return Ie&&typeof Ie=="string"&&(Ie=Ie.toUpperCase()),Ie in a.image_compression?Ie:$.NONE}(se),he)),!Ce)throw new Error("An unknown error occurred whilst processing the image.");return Ce},ce=a.__addimage__.convertBase64ToBinaryString=function(Y,z){z=typeof z!="boolean"||z;var te,se="";if(typeof Y=="string"){var Ce;te=(Ce=ge(Y))!==null&&Ce!==void 0?Ce:Y;try{se=Ty(te)}catch(he){if(z)throw J(te)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+he.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return se};a.getImageProperties=function(Y){var z,te,se="";if(O(Y)&&(Y=R(Y)),typeof Y=="string"&&h(Y)===c&&((se=ce(Y,!1))===""&&(se=a.loadFile(Y)||""),Y=se),te=h(Y),!I(te))throw new Error("addImage does not support files of type '"+te+"', please ensure that a plugin for '"+te+"' support is added.");if(Y instanceof Uint8Array||(Y=we(Y)),!(z=this["process"+te.toUpperCase()](Y)))throw new Error("An unknown error occurred whilst processing the image");return z.fileType=te,z}})(Qs.API),function(a){var o=function(c){if(c!==void 0&&c!="")return!0};Qs.API.events.push(["addPage",function(c){this.internal.getPageInfo(c.pageNumber).pageContext.annotations=[]}]),a.events.push(["putPage",function(c){for(var d,h,p,g=this.internal.getCoordinateString,x=this.internal.getVerticalCoordinateString,v=this.internal.getPageInfoByObjId(c.objId),E=c.pageContext.annotations,C=!1,I=0;I<E.length&&!C;I++)switch((d=E[I]).type){case"link":(o(d.options.url)||o(d.options.pageNumber))&&(C=!0);break;case"reference":case"text":case"freetext":C=!0}if(C!=0){this.internal.write("/Annots [");for(var O=0;O<E.length;O++){d=E[O];var R=this.internal.pdfEscape,k=this.internal.getEncryptor(c.objId);switch(d.type){case"reference":this.internal.write(" "+d.object.objId+" 0 R ");break;case"text":var M=this.internal.newAdditionalObject(),P=this.internal.newAdditionalObject(),H=this.internal.getEncryptor(M.objId),$=d.title||"Note";p="<</Type /Annot /Subtype /Text "+(h="/Rect ["+g(d.bounds.x)+" "+x(d.bounds.y+d.bounds.h)+" "+g(d.bounds.x+d.bounds.w)+" "+x(d.bounds.y)+"] ")+"/Contents ("+R(H(d.contents))+")",p+=" /Popup "+P.objId+" 0 R",p+=" /P "+v.objId+" 0 R",p+=" /T ("+R(H($))+") >>",M.content=p;var re=M.objId+" 0 R";p="<</Type /Annot /Subtype /Popup "+(h="/Rect ["+g(d.bounds.x+30)+" "+x(d.bounds.y+d.bounds.h)+" "+g(d.bounds.x+d.bounds.w+30)+" "+x(d.bounds.y)+"] ")+" /Parent "+re,d.open&&(p+=" /Open true"),p+=" >>",P.content=p,this.internal.write(M.objId,"0 R",P.objId,"0 R");break;case"freetext":h="/Rect ["+g(d.bounds.x)+" "+x(d.bounds.y)+" "+g(d.bounds.x+d.bounds.w)+" "+x(d.bounds.y+d.bounds.h)+"] ";var J=d.color||"#000000";p="<</Type /Annot /Subtype /FreeText "+h+"/Contents ("+R(k(d.contents))+")",p+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+J+")",p+=" /Border [0 0 0]",p+=" >>",this.internal.write(p);break;case"link":if(d.options.name){var ge=this.annotations._nameMap[d.options.name];d.options.pageNumber=ge.page,d.options.top=ge.y}else d.options.top||(d.options.top=0);if(h="/Rect ["+d.finalBounds.x+" "+d.finalBounds.y+" "+d.finalBounds.w+" "+d.finalBounds.h+"] ",p="",d.options.url)p="<</Type /Annot /Subtype /Link "+h+"/Border [0 0 0] /A <</S /URI /URI ("+R(k(d.options.url))+") >>";else if(d.options.pageNumber)switch(p="<</Type /Annot /Subtype /Link "+h+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(d.options.pageNumber).objId+" 0 R",d.options.magFactor=d.options.magFactor||"XYZ",d.options.magFactor){case"Fit":p+=" /Fit]";break;case"FitH":p+=" /FitH "+d.options.top+"]";break;case"FitV":d.options.left=d.options.left||0,p+=" /FitV "+d.options.left+"]";break;default:var ie=x(d.options.top);d.options.left=d.options.left||0,d.options.zoom===void 0&&(d.options.zoom=0),p+=" /XYZ "+d.options.left+" "+ie+" "+d.options.zoom+"]"}p!=""&&(p+=" >>",this.internal.write(p))}}this.internal.write("]")}}]),a.createAnnotation=function(c){var d=this.internal.getCurrentPageInfo();switch(c.type){case"link":this.link(c.bounds.x,c.bounds.y,c.bounds.w,c.bounds.h,c);break;case"text":case"freetext":d.pageContext.annotations.push(c)}},a.link=function(c,d,h,p,g){var x=this.internal.getCurrentPageInfo(),v=this.internal.getCoordinateString,E=this.internal.getVerticalCoordinateString;x.pageContext.annotations.push({finalBounds:{x:v(c),y:E(d),w:v(c+h),h:E(d+p)},options:g,type:"link"})},a.textWithLink=function(c,d,h,p){var g,x,v=this.getTextWidth(c),E=this.internal.getLineHeight()/this.internal.scaleFactor;if(p.maxWidth!==void 0){x=p.maxWidth;var C=this.splitTextToSize(c,x).length;g=Math.ceil(E*C)}else x=v,g=E;return this.text(c,d,h,p),h+=.2*E,p.align==="center"&&(d-=v/2),p.align==="right"&&(d-=v),this.link(d,h-E,x,g,p),v},a.getTextWidth=function(c){var d=this.internal.getFontSize();return this.getStringUnitWidth(c)*d/this.internal.scaleFactor}}(Qs.API),function(a){var o={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},c={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},d={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},h=[1570,1571,1573,1575];a.__arabicParser__={};var p=a.__arabicParser__.isInArabicSubstitutionA=function(M){return o[M.charCodeAt(0)]!==void 0},g=a.__arabicParser__.isArabicLetter=function(M){return typeof M=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(M)},x=a.__arabicParser__.isArabicEndLetter=function(M){return g(M)&&p(M)&&o[M.charCodeAt(0)].length<=2},v=a.__arabicParser__.isArabicAlfLetter=function(M){return g(M)&&h.indexOf(M.charCodeAt(0))>=0};a.__arabicParser__.arabicLetterHasIsolatedForm=function(M){return g(M)&&p(M)&&o[M.charCodeAt(0)].length>=1};var E=a.__arabicParser__.arabicLetterHasFinalForm=function(M){return g(M)&&p(M)&&o[M.charCodeAt(0)].length>=2};a.__arabicParser__.arabicLetterHasInitialForm=function(M){return g(M)&&p(M)&&o[M.charCodeAt(0)].length>=3};var C=a.__arabicParser__.arabicLetterHasMedialForm=function(M){return g(M)&&p(M)&&o[M.charCodeAt(0)].length==4},I=a.__arabicParser__.resolveLigatures=function(M){var P=0,H=c,$="",re=0;for(P=0;P<M.length;P+=1)H[M.charCodeAt(P)]!==void 0?(re++,typeof(H=H[M.charCodeAt(P)])=="number"&&($+=String.fromCharCode(H),H=c,re=0),P===M.length-1&&(H=c,$+=M.charAt(P-(re-1)),P-=re-1,re=0)):(H=c,$+=M.charAt(P-re),P-=re,re=0);return $};a.__arabicParser__.isArabicDiacritic=function(M){return M!==void 0&&d[M.charCodeAt(0)]!==void 0};var O=a.__arabicParser__.getCorrectForm=function(M,P,H){return g(M)?p(M)===!1?-1:!E(M)||!g(P)&&!g(H)||!g(H)&&x(P)||x(M)&&!g(P)||x(M)&&v(P)||x(M)&&x(P)?0:C(M)&&g(P)&&!x(P)&&g(H)&&E(H)?3:x(M)||!g(H)?1:2:-1},R=function(M){var P=0,H=0,$=0,re="",J="",ge="",ie=(M=M||"").split("\\s+"),we=[];for(P=0;P<ie.length;P+=1){for(we.push(""),H=0;H<ie[P].length;H+=1)re=ie[P][H],J=ie[P][H-1],ge=ie[P][H+1],g(re)?($=O(re,J,ge),we[P]+=$!==-1?String.fromCharCode(o[re.charCodeAt(0)][$]):re):we[P]+=re;we[P]=I(we[P])}return we.join(" ")},k=a.__arabicParser__.processArabic=a.processArabic=function(){var M,P=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,H=[];if(Array.isArray(P)){var $=0;for(H=[],$=0;$<P.length;$+=1)Array.isArray(P[$])?H.push([R(P[$][0]),P[$][1],P[$][2]]):H.push([R(P[$])]);M=H}else M=R(P);return typeof arguments[0]=="string"?M:(arguments[0].text=M,arguments[0])};a.events.push(["preProcessText",k])}(Qs.API),Qs.API.autoPrint=function(a){var o;return(a=a||{}).variant=a.variant||"non-conform",a.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){o=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+o+" 0 R")})),this},function(a){var o=function(){var c=void 0;Object.defineProperty(this,"pdf",{get:function(){return c},set:function(x){c=x}});var d=150;Object.defineProperty(this,"width",{get:function(){return d},set:function(x){d=isNaN(x)||Number.isInteger(x)===!1||x<0?150:x,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=d+1)}});var h=300;Object.defineProperty(this,"height",{get:function(){return h},set:function(x){h=isNaN(x)||Number.isInteger(x)===!1||x<0?300:x,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=h+1)}});var p=[];Object.defineProperty(this,"childNodes",{get:function(){return p},set:function(x){p=x}});var g={};Object.defineProperty(this,"style",{get:function(){return g},set:function(x){g=x}}),Object.defineProperty(this,"parentNode",{})};o.prototype.getContext=function(c,d){var h;if((c=c||"2d")!=="2d")return null;for(h in d)this.pdf.context2d.hasOwnProperty(h)&&(this.pdf.context2d[h]=d[h]);return this.pdf.context2d._canvas=this,this.pdf.context2d},o.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},a.events.push(["initialized",function(){this.canvas=new o,this.canvas.pdf=this}])}(Qs.API),function(a){var o={left:0,top:0,bottom:0,right:0},c=!1,d=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},o),this.internal.__cell__.margins.width=this.getPageWidth(),h.call(this))},h=function(){this.internal.__cell__.lastCell=new p,this.internal.__cell__.pages=1},p=function(){var v=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return v},set:function(M){v=M}});var E=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return E},set:function(M){E=M}});var C=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return C},set:function(M){C=M}});var I=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return I},set:function(M){I=M}});var O=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return O},set:function(M){O=M}});var R=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return R},set:function(M){R=M}});var k=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return k},set:function(M){k=M}}),this};p.prototype.clone=function(){return new p(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},p.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},a.setHeaderFunction=function(v){return d.call(this),this.internal.__cell__.headerFunction=typeof v=="function"?v:void 0,this},a.getTextDimensions=function(v,E){d.call(this);var C=(E=E||{}).fontSize||this.getFontSize(),I=E.font||this.getFont(),O=E.scaleFactor||this.internal.scaleFactor,R=0,k=0,M=0,P=this;if(!Array.isArray(v)&&typeof v!="string"){if(typeof v!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");v=String(v)}var H=E.maxWidth;H>0?typeof v=="string"?v=this.splitTextToSize(v,H):Object.prototype.toString.call(v)==="[object Array]"&&(v=v.reduce(function(re,J){return re.concat(P.splitTextToSize(J,H))},[])):v=Array.isArray(v)?v:[v];for(var $=0;$<v.length;$++)R<(M=this.getStringUnitWidth(v[$],{font:I})*C)&&(R=M);return R!==0&&(k=v.length),{w:R/=O,h:Math.max((k*C*this.getLineHeightFactor()-C*(this.getLineHeightFactor()-1))/O,0)}},a.cellAddPage=function(){d.call(this),this.addPage();var v=this.internal.__cell__.margins||o;return this.internal.__cell__.lastCell=new p(v.left,v.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var g=a.cell=function(){var v;v=arguments[0]instanceof p?arguments[0]:new p(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),d.call(this);var E=this.internal.__cell__.lastCell,C=this.internal.__cell__.padding,I=this.internal.__cell__.margins||o,O=this.internal.__cell__.tableHeaderRow,R=this.internal.__cell__.printHeaders;return E.lineNumber!==void 0&&(E.lineNumber===v.lineNumber?(v.x=(E.x||0)+(E.width||0),v.y=E.y||0):E.y+E.height+v.height+I.bottom>this.getPageHeight()?(this.cellAddPage(),v.y=I.top,R&&O&&(this.printHeaderRow(v.lineNumber,!0),v.y+=O[0].height)):v.y=E.y+E.height||v.y),v.text[0]!==void 0&&(this.rect(v.x,v.y,v.width,v.height,c===!0?"FD":void 0),v.align==="right"?this.text(v.text,v.x+v.width-C,v.y+C,{align:"right",baseline:"top"}):v.align==="center"?this.text(v.text,v.x+v.width/2,v.y+C,{align:"center",baseline:"top",maxWidth:v.width-C-C}):this.text(v.text,v.x+C,v.y+C,{align:"left",baseline:"top",maxWidth:v.width-C-C})),this.internal.__cell__.lastCell=v,this};a.table=function(v,E,C,I,O){if(d.call(this),!C)throw new Error("No data for PDF table.");var R,k,M,P,H=[],$=[],re=[],J={},ge={},ie=[],we=[],Ae=(O=O||{}).autoSize||!1,V=O.printHeaders!==!1,ce=O.css&&O.css["font-size"]!==void 0?16*O.css["font-size"]:O.fontSize||12,Y=O.margins||Object.assign({width:this.getPageWidth()},o),z=typeof O.padding=="number"?O.padding:3,te=O.headerBackgroundColor||"#c8c8c8",se=O.headerTextColor||"#000";if(h.call(this),this.internal.__cell__.printHeaders=V,this.internal.__cell__.margins=Y,this.internal.__cell__.table_font_size=ce,this.internal.__cell__.padding=z,this.internal.__cell__.headerBackgroundColor=te,this.internal.__cell__.headerTextColor=se,this.setFontSize(ce),I==null)$=H=Object.keys(C[0]),re=H.map(function(){return"left"});else if(Array.isArray(I)&&_n(I[0])==="object")for(H=I.map(function(Ve){return Ve.name}),$=I.map(function(Ve){return Ve.prompt||Ve.name||""}),re=I.map(function(Ve){return Ve.align||"left"}),R=0;R<I.length;R+=1)ge[I[R].name]=.7499990551181103*I[R].width;else Array.isArray(I)&&typeof I[0]=="string"&&($=H=I,re=H.map(function(){return"left"}));if(Ae||Array.isArray(I)&&typeof I[0]=="string")for(R=0;R<H.length;R+=1){for(J[P=H[R]]=C.map(function(Ve){return Ve[P]}),this.setFont(void 0,"bold"),ie.push(this.getTextDimensions($[R],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),k=J[P],this.setFont(void 0,"normal"),M=0;M<k.length;M+=1)ie.push(this.getTextDimensions(k[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ge[P]=Math.max.apply(null,ie)+z+z,ie=[]}if(V){var Ce={};for(R=0;R<H.length;R+=1)Ce[H[R]]={},Ce[H[R]].text=$[R],Ce[H[R]].align=re[R];var he=x.call(this,Ce,ge);we=H.map(function(Ve){return new p(v,E,ge[Ve],he,Ce[Ve].text,void 0,Ce[Ve].align)}),this.setTableHeaderRow(we),this.printHeaderRow(1,!1)}var Ne=I.reduce(function(Ve,Pe){return Ve[Pe.name]=Pe.align,Ve},{});for(R=0;R<C.length;R+=1){"rowStart"in O&&O.rowStart instanceof Function&&O.rowStart({row:R,data:C[R]},this);var Z=x.call(this,C[R],ge);for(M=0;M<H.length;M+=1){var Ie=C[R][H[M]];"cellStart"in O&&O.cellStart instanceof Function&&O.cellStart({row:R,col:M,data:Ie},this),g.call(this,new p(v,E,ge[H[M]],Z,Ie,R+2,Ne[H[M]]))}}return this.internal.__cell__.table_x=v,this.internal.__cell__.table_y=E,this};var x=function(v,E){var C=this.internal.__cell__.padding,I=this.internal.__cell__.table_font_size,O=this.internal.scaleFactor;return Object.keys(v).map(function(R){var k=v[R];return this.splitTextToSize(k.hasOwnProperty("text")?k.text:k,E[R]-C-C)},this).map(function(R){return this.getLineHeightFactor()*R.length*I/O+C+C},this).reduce(function(R,k){return Math.max(R,k)},0)};a.setTableHeaderRow=function(v){d.call(this),this.internal.__cell__.tableHeaderRow=v},a.printHeaderRow=function(v,E){if(d.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var C;if(c=!0,typeof this.internal.__cell__.headerFunction=="function"){var I=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new p(I[0],I[1],I[2],I[3],void 0,-1)}this.setFont(void 0,"bold");for(var O=[],R=0;R<this.internal.__cell__.tableHeaderRow.length;R+=1){C=this.internal.__cell__.tableHeaderRow[R].clone(),E&&(C.y=this.internal.__cell__.margins.top||0,O.push(C)),C.lineNumber=v;var k=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),g.call(this,C),this.setTextColor(k)}O.length>0&&this.setTableHeaderRow(O),this.setFont(void 0,"normal"),c=!1}}(Qs.API);var fG={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},gG=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],WR=mG(gG),bG=[100,200,300,400,500,600,700,800,900],Fge=mG(bG);function FT(a){var o=a.family.replace(/"|'/g,"").toLowerCase(),c=function(p){return fG[p=p||"normal"]?p:"normal"}(a.style),d=function(p){return p?typeof p=="number"?p>=100&&p<=900&&p%100==0?p:400:/^\d00$/.test(p)?parseInt(p):p==="bold"?700:400:400}(a.weight),h=function(p){return typeof WR[p=p||"normal"]=="number"?p:"normal"}(a.stretch);return{family:o,style:c,weight:d,stretch:h,src:a.src||[],ref:a.ref||{name:o,style:[h,c,d].join(" ")}}}function kV(a,o,c,d){var h;for(h=c;h>=0&&h<o.length;h+=d)if(a[o[h]])return a[o[h]];for(h=c;h>=0&&h<o.length;h-=d)if(a[o[h]])return a[o[h]]}var Mge={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},DV={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function BV(a){return[a.stretch,a.style,a.weight,a.family].join(" ")}function LV(a){return a.trimLeft()}function Vge(a,o){for(var c=0;c<a.length;){if(a.charAt(c)===o)return[a.substring(0,c),a.substring(c+1)];c+=1}return null}function Qge(a){var o=a.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return o===null?null:[o[0],a.substring(o[0].length)]}var og,fy,jV,PV,UV,MT=["times"];function FV(a,o,c,d,h){var p=4,g=VV;switch(h){case Qs.API.image_compression.FAST:p=1,g=MV;break;case Qs.API.image_compression.MEDIUM:p=6,g=QV;break;case Qs.API.image_compression.SLOW:p=9,g=HV}a=function(v,E,C,I){for(var O,R=v.length/E,k=new Uint8Array(v.length+R),M=[Hge,MV,VV,QV,HV],P=0;P<R;P+=1){var H=P*E,$=v.subarray(H,H+E);if(I)k.set(I($,C,O),H+P);else{for(var re=M.length,J=[],ge=0;ge<re;ge+=1)J[ge]=M[ge]($,C,O);var ie=Kge(J.concat());k.set(J[ie],H+P)}O=$}return k}(a,o,Math.ceil(c*d/8),g);var x=FR(a,{level:p});return Qs.API.__addimage__.arrayBufferToBinaryString(x)}function Hge(a){var o=Array.apply([],a);return o.unshift(0),o}function MV(a,o){var c=a.length,d=[];d[0]=1;for(var h=0;h<c;h+=1){var p=a[h-o]||0;d[h+1]=a[h]-p+256&255}return d}function VV(a,o,c){var d=a.length,h=[];h[0]=2;for(var p=0;p<d;p+=1){var g=c&&c[p]||0;h[p+1]=a[p]-g+256&255}return h}function QV(a,o,c){var d=a.length,h=[];h[0]=3;for(var p=0;p<d;p+=1){var g=a[p-o]||0,x=c&&c[p]||0;h[p+1]=a[p]+256-(g+x>>>1)&255}return h}function HV(a,o,c){var d=a.length,h=[];h[0]=4;for(var p=0;p<d;p+=1){var g=Gge(a[p-o]||0,c&&c[p]||0,c&&c[p-o]||0);h[p+1]=a[p]-g+256&255}return h}function Gge(a,o,c){if(a===o&&o===c)return a;var d=Math.abs(o-c),h=Math.abs(a-c),p=Math.abs(a+o-c-c);return d<=h&&d<=p?a:h<=p?o:c}function Kge(a){var o=a.map(function(c){return c.reduce(function(d,h){return d+Math.abs(h)},0)});return o.indexOf(Math.min.apply(null,o))}function VT(a,o,c){var d=o*c,h=Math.floor(d/8),p=16-(d-8*h+c),g=(1<<c)-1;return xG(a,h)>>p&g}function GV(a,o,c,d){var h=c*d,p=Math.floor(h/8),g=16-(h-8*p+d),x=(1<<d)-1,v=(o&x)<<g;(function(E,C,I){if(C+1<E.byteLength)E.setUint16(C,I,!1);else{var O=I>>8&255;E.setUint8(C,O)}})(a,p,xG(a,p)&~(x<<g)&65535|v)}function xG(a,o){return o+1<a.byteLength?a.getUint16(o,!1):a.getUint8(o)<<8}function Wge(a){var o=0;if(a[o++]!==71||a[o++]!==73||a[o++]!==70||a[o++]!==56||(a[o++]+1&253)!=56||a[o++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=a[o++]|a[o++]<<8,d=a[o++]|a[o++]<<8,h=a[o++],p=h>>7,g=1<<1+(7&h);a[o++],a[o++];var x=null,v=null;p&&(x=o,v=g,o+=3*g);var E=!0,C=[],I=0,O=null,R=0,k=null;for(this.width=c,this.height=d;E&&o<a.length;)switch(a[o++]){case 33:switch(a[o++]){case 255:if(a[o]!==11||a[o+1]==78&&a[o+2]==69&&a[o+3]==84&&a[o+4]==83&&a[o+5]==67&&a[o+6]==65&&a[o+7]==80&&a[o+8]==69&&a[o+9]==50&&a[o+10]==46&&a[o+11]==48&&a[o+12]==3&&a[o+13]==1&&a[o+16]==0)o+=14,k=a[o++]|a[o++]<<8,o++;else for(o+=12;;){if(!((Y=a[o++])>=0))throw Error("Invalid block size");if(Y===0)break;o+=Y}break;case 249:if(a[o++]!==4||a[o+4]!==0)throw new Error("Invalid graphics extension block.");var M=a[o++];I=a[o++]|a[o++]<<8,O=a[o++],1&M||(O=null),R=M>>2&7,o++;break;case 254:for(;;){if(!((Y=a[o++])>=0))throw Error("Invalid block size");if(Y===0)break;o+=Y}break;default:throw new Error("Unknown graphic control label: 0x"+a[o-1].toString(16))}break;case 44:var P=a[o++]|a[o++]<<8,H=a[o++]|a[o++]<<8,$=a[o++]|a[o++]<<8,re=a[o++]|a[o++]<<8,J=a[o++],ge=J>>6&1,ie=1<<1+(7&J),we=x,Ae=v,V=!1;J>>7&&(V=!0,we=o,Ae=ie,o+=3*ie);var ce=o;for(o++;;){var Y;if(!((Y=a[o++])>=0))throw Error("Invalid block size");if(Y===0)break;o+=Y}C.push({x:P,y:H,width:$,height:re,has_local_palette:V,palette_offset:we,palette_size:Ae,data_offset:ce,data_length:o-ce,transparent_index:O,interlaced:!!ge,delay:I,disposal:R});break;case 59:E=!1;break;default:throw new Error("Unknown gif block: 0x"+a[o-1].toString(16))}this.numFrames=function(){return C.length},this.loopCount=function(){return k},this.frameInfo=function(z){if(z<0||z>=C.length)throw new Error("Frame index out of range.");return C[z]},this.decodeAndBlitFrameBGRA=function(z,te){var se=this.frameInfo(z),Ce=se.width*se.height;if(Ce>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var he=new Uint8Array(Ce);KV(a,se.data_offset,he,Ce);var Ne=se.palette_offset,Z=se.transparent_index;Z===null&&(Z=256);var Ie=se.width,Ve=c-Ie,Pe=Ie,ne=4*(se.y*c+se.x),ve=4*((se.y+se.height)*c+se.x),ue=ne,Te=4*Ve;se.interlaced===!0&&(Te+=4*c*7);for(var Be=8,Ue=0,tt=he.length;Ue<tt;++Ue){var ot=he[Ue];if(Pe===0&&(Pe=Ie,(ue+=Te)>=ve&&(Te=4*Ve+4*c*(Be-1),ue=ne+(Ie+Ve)*(Be<<1),Be>>=1)),ot===Z)ue+=4;else{var ut=a[Ne+3*ot],Tt=a[Ne+3*ot+1],Qe=a[Ne+3*ot+2];te[ue++]=Qe,te[ue++]=Tt,te[ue++]=ut,te[ue++]=255}--Pe}},this.decodeAndBlitFrameRGBA=function(z,te){var se=this.frameInfo(z),Ce=se.width*se.height;if(Ce>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var he=new Uint8Array(Ce);KV(a,se.data_offset,he,Ce);var Ne=se.palette_offset,Z=se.transparent_index;Z===null&&(Z=256);var Ie=se.width,Ve=c-Ie,Pe=Ie,ne=4*(se.y*c+se.x),ve=4*((se.y+se.height)*c+se.x),ue=ne,Te=4*Ve;se.interlaced===!0&&(Te+=4*c*7);for(var Be=8,Ue=0,tt=he.length;Ue<tt;++Ue){var ot=he[Ue];if(Pe===0&&(Pe=Ie,(ue+=Te)>=ve&&(Te=4*Ve+4*c*(Be-1),ue=ne+(Ie+Ve)*(Be<<1),Be>>=1)),ot===Z)ue+=4;else{var ut=a[Ne+3*ot],Tt=a[Ne+3*ot+1],Qe=a[Ne+3*ot+2];te[ue++]=ut,te[ue++]=Tt,te[ue++]=Qe,te[ue++]=255}--Pe}}}function KV(a,o,c,d){for(var h=a[o++],p=1<<h,g=p+1,x=g+1,v=h+1,E=(1<<v)-1,C=0,I=0,O=0,R=a[o++],k=new Int32Array(4096),M=null;;){for(;C<16&&R!==0;)I|=a[o++]<<C,C+=8,R===1?R=a[o++]:--R;if(C<v)break;var P=I&E;if(I>>=v,C-=v,P!==p){if(P===g)break;for(var H=P<x?P:M,$=0,re=H;re>p;)re=k[re]>>8,++$;var J=re;if(O+$+(H!==P?1:0)>d)return void Mn.log("Warning, gif stream longer than expected.");c[O++]=J;var ge=O+=$;for(H!==P&&(c[O++]=J),re=H;$--;)re=k[re],c[--ge]=255&re,re>>=8;M!==null&&x<4096&&(k[x++]=M<<8|J,x>=E+1&&v<12&&(++v,E=E<<1|1)),M=P}else x=g+1,E=(1<<(v=h+1))-1,M=null}return O!==d&&Mn.log("Warning, gif stream shorter than expected."),c}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function QT(a){var o,c,d,h,p,g=Math.floor,x=new Array(64),v=new Array(64),E=new Array(64),C=new Array(64),I=new Array(65535),O=new Array(65535),R=new Array(64),k=new Array(64),M=[],P=0,H=7,$=new Array(64),re=new Array(64),J=new Array(64),ge=new Array(256),ie=new Array(2048),we=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ae=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],ce=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],z=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],te=[0,1,2,3,4,5,6,7,8,9,10,11],se=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ce=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function he(ne,ve){for(var ue=0,Te=0,Be=new Array,Ue=1;Ue<=16;Ue++){for(var tt=1;tt<=ne[Ue];tt++)Be[ve[Te]]=[],Be[ve[Te]][0]=ue,Be[ve[Te]][1]=Ue,Te++,ue++;ue*=2}return Be}function Ne(ne){for(var ve=ne[0],ue=ne[1]-1;ue>=0;)ve&1<<ue&&(P|=1<<H),ue--,--H<0&&(P==255?(Z(255),Z(0)):Z(P),H=7,P=0)}function Z(ne){M.push(ne)}function Ie(ne){Z(ne>>8&255),Z(255&ne)}function Ve(ne,ve,ue,Te,Be){for(var Ue,tt=Be[0],ot=Be[240],ut=function($e,jt){var Kt,os,ss,mt,Ht,qe,ht,Xt,zt,ds,Qt=0;for(zt=0;zt<8;++zt){Kt=$e[Qt],os=$e[Qt+1],ss=$e[Qt+2],mt=$e[Qt+3],Ht=$e[Qt+4],qe=$e[Qt+5],ht=$e[Qt+6];var Us=Kt+(Xt=$e[Qt+7]),bs=Kt-Xt,cs=os+ht,Ds=os-ht,zs=ss+qe,rs=ss-qe,Gs=mt+Ht,dt=mt-Ht,Pt=Us+Gs,qt=Us-Gs,Yt=cs+zs,us=cs-zs;$e[Qt]=Pt+Yt,$e[Qt+4]=Pt-Yt;var Ws=.707106781*(us+qt);$e[Qt+2]=qt+Ws,$e[Qt+6]=qt-Ws;var ji=.382683433*((Pt=dt+rs)-(us=Ds+bs)),qr=.5411961*Pt+ji,Ga=1.306562965*us+ji,ti=.707106781*(Yt=rs+Ds),Fs=bs+ti,pn=bs-ti;$e[Qt+5]=pn+qr,$e[Qt+3]=pn-qr,$e[Qt+1]=Fs+Ga,$e[Qt+7]=Fs-Ga,Qt+=8}for(Qt=0,zt=0;zt<8;++zt){Kt=$e[Qt],os=$e[Qt+8],ss=$e[Qt+16],mt=$e[Qt+24],Ht=$e[Qt+32],qe=$e[Qt+40],ht=$e[Qt+48];var Ao=Kt+(Xt=$e[Qt+56]),vt=Kt-Xt,Jt=os+ht,Js=os-ht,Os=ss+qe,jr=ss-qe,In=mt+Ht,On=mt-Ht,Xr=Ao+In,Aa=Ao-In,ea=Jt+Os,Ka=Jt-Os;$e[Qt]=Xr+ea,$e[Qt+32]=Xr-ea;var ua=.707106781*(Ka+Aa);$e[Qt+16]=Aa+ua,$e[Qt+48]=Aa-ua;var rc=.382683433*((Xr=On+jr)-(Ka=Js+vt)),Sa=.5411961*Xr+rc,nc=1.306562965*Ka+rc,ic=.707106781*(ea=jr+Js),JA=vt+ic,$A=vt-ic;$e[Qt+40]=$A+Sa,$e[Qt+24]=$A-Sa,$e[Qt+8]=JA+nc,$e[Qt+56]=JA-nc,Qt++}for(zt=0;zt<64;++zt)ds=$e[zt]*jt[zt],R[zt]=ds>0?ds+.5|0:ds-.5|0;return R}(ne,ve),Tt=0;Tt<64;++Tt)k[we[Tt]]=ut[Tt];var Qe=k[0]-ue;ue=k[0],Qe==0?Ne(Te[0]):(Ne(Te[O[Ue=32767+Qe]]),Ne(I[Ue]));for(var it=63;it>0&&k[it]==0;)it--;if(it==0)return Ne(tt),ue;for(var kt,_e=1;_e<=it;){for(var xt=_e;k[_e]==0&&_e<=it;)++_e;var Ke=_e-xt;if(Ke>=16){kt=Ke>>4;for(var Je=1;Je<=kt;++Je)Ne(ot);Ke&=15}Ue=32767+k[_e],Ne(Be[(Ke<<4)+O[Ue]]),Ne(I[Ue]),_e++}return it!=63&&Ne(tt),ue}function Pe(ne){ne=Math.min(Math.max(ne,1),100),p!=ne&&(function(ve){for(var ue=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Te=0;Te<64;Te++){var Be=g((ue[Te]*ve+50)/100);Be=Math.min(Math.max(Be,1),255),x[we[Te]]=Be}for(var Ue=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],tt=0;tt<64;tt++){var ot=g((Ue[tt]*ve+50)/100);ot=Math.min(Math.max(ot,1),255),v[we[tt]]=ot}for(var ut=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Tt=0,Qe=0;Qe<8;Qe++)for(var it=0;it<8;it++)E[Tt]=1/(x[we[Tt]]*ut[Qe]*ut[it]*8),C[Tt]=1/(v[we[Tt]]*ut[Qe]*ut[it]*8),Tt++}(ne<50?Math.floor(5e3/ne):Math.floor(200-2*ne)),p=ne)}this.encode=function(ne,ve){ve&&Pe(ve),M=new Array,P=0,H=7,Ie(65496),Ie(65504),Ie(16),Z(74),Z(70),Z(73),Z(70),Z(0),Z(1),Z(1),Z(0),Ie(1),Ie(1),Z(0),Z(0),function(){Ie(65499),Ie(132),Z(0);for(var os=0;os<64;os++)Z(x[os]);Z(1);for(var ss=0;ss<64;ss++)Z(v[ss])}(),function(os,ss){Ie(65472),Ie(17),Z(8),Ie(ss),Ie(os),Z(3),Z(1),Z(17),Z(0),Z(2),Z(17),Z(1),Z(3),Z(17),Z(1)}(ne.width,ne.height),function(){Ie(65476),Ie(418),Z(0);for(var os=0;os<16;os++)Z(Ae[os+1]);for(var ss=0;ss<=11;ss++)Z(V[ss]);Z(16);for(var mt=0;mt<16;mt++)Z(ce[mt+1]);for(var Ht=0;Ht<=161;Ht++)Z(Y[Ht]);Z(1);for(var qe=0;qe<16;qe++)Z(z[qe+1]);for(var ht=0;ht<=11;ht++)Z(te[ht]);Z(17);for(var Xt=0;Xt<16;Xt++)Z(se[Xt+1]);for(var zt=0;zt<=161;zt++)Z(Ce[zt])}(),Ie(65498),Ie(12),Z(3),Z(1),Z(0),Z(2),Z(17),Z(3),Z(17),Z(0),Z(63),Z(0);var ue=0,Te=0,Be=0;P=0,H=7,this.encode.displayName="_encode_";for(var Ue,tt,ot,ut,Tt,Qe,it,kt,_e,xt=ne.data,Ke=ne.width,Je=ne.height,$e=4*Ke,jt=0;jt<Je;){for(Ue=0;Ue<$e;){for(Tt=$e*jt+Ue,it=-1,kt=0,_e=0;_e<64;_e++)Qe=Tt+(kt=_e>>3)*$e+(it=4*(7&_e)),jt+kt>=Je&&(Qe-=$e*(jt+1+kt-Je)),Ue+it>=$e&&(Qe-=Ue+it-$e+4),tt=xt[Qe++],ot=xt[Qe++],ut=xt[Qe++],$[_e]=(ie[tt]+ie[ot+256|0]+ie[ut+512|0]>>16)-128,re[_e]=(ie[tt+768|0]+ie[ot+1024|0]+ie[ut+1280|0]>>16)-128,J[_e]=(ie[tt+1280|0]+ie[ot+1536|0]+ie[ut+1792|0]>>16)-128;ue=Ve($,E,ue,o,d),Te=Ve(re,C,Te,c,h),Be=Ve(J,C,Be,c,h),Ue+=32}jt+=8}if(H>=0){var Kt=[];Kt[1]=H+1,Kt[0]=(1<<H+1)-1,Ne(Kt)}return Ie(65497),new Uint8Array(M)},a=a||50,function(){for(var ne=String.fromCharCode,ve=0;ve<256;ve++)ge[ve]=ne(ve)}(),o=he(Ae,V),c=he(z,te),d=he(ce,Y),h=he(se,Ce),function(){for(var ne=1,ve=2,ue=1;ue<=15;ue++){for(var Te=ne;Te<ve;Te++)O[32767+Te]=ue,I[32767+Te]=[],I[32767+Te][1]=ue,I[32767+Te][0]=Te;for(var Be=-(ve-1);Be<=-ne;Be++)O[32767+Be]=ue,I[32767+Be]=[],I[32767+Be][1]=ue,I[32767+Be][0]=ve-1+Be;ne<<=1,ve<<=1}}(),function(){for(var ne=0;ne<256;ne++)ie[ne]=19595*ne,ie[ne+256|0]=38470*ne,ie[ne+512|0]=7471*ne+32768,ie[ne+768|0]=-11059*ne,ie[ne+1024|0]=-21709*ne,ie[ne+1280|0]=32768*ne+8421375,ie[ne+1536|0]=-27439*ne,ie[ne+1792|0]=-5329*ne}(),Pe(a)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Zl(a,o){if(this.pos=0,this.buffer=a,this.datav=new DataView(a.buffer),this.is_with_alpha=!!o,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function WV(a){function o(V){if(!V)throw Error("assert :P")}function c(V,ce,Y){for(var z=0;4>z;z++)if(V[ce+z]!=Y.charCodeAt(z))return!0;return!1}function d(V,ce,Y,z,te){for(var se=0;se<te;se++)V[ce+se]=Y[z+se]}function h(V,ce,Y,z){for(var te=0;te<z;te++)V[ce+te]=Y}function p(V){return new Int32Array(V)}function g(V,ce){for(var Y=[],z=0;z<V;z++)Y.push(new ce);return Y}function x(V,ce){var Y=[];return function z(te,se,Ce){for(var he=Ce[se],Ne=0;Ne<he&&(te.push(Ce.length>se+1?[]:new ce),!(Ce.length<se+1));Ne++)z(te[Ne],se+1,Ce)}(Y,0,V),Y}var v=function(){var V=this;function ce(y,T){for(var Q=1<<T-1>>>0;y&Q;)Q>>>=1;return Q?(y&Q-1)+Q:y}function Y(y,T,Q,q,de){o(!(q%Q));do y[T+(q-=Q)]=de;while(0<q)}function z(y,T,Q,q,de){if(o(2328>=de),512>=de)var pe=p(512);else if((pe=p(de))==null)return 0;return function(fe,ye,Se,ke,Ge,At){var De,ze,st=ye,wt=1<<Se,lt=p(16),Ct=p(16);for(o(Ge!=0),o(ke!=null),o(fe!=null),o(0<Se),ze=0;ze<Ge;++ze){if(15<ke[ze])return 0;++lt[ke[ze]]}if(lt[0]==Ge)return 0;for(Ct[1]=0,De=1;15>De;++De){if(lt[De]>1<<De)return 0;Ct[De+1]=Ct[De]+lt[De]}for(ze=0;ze<Ge;++ze)De=ke[ze],0<ke[ze]&&(At[Ct[De]++]=ze);if(Ct[15]==1)return(ke=new te).g=0,ke.value=At[0],Y(fe,st,1,wt,ke),wt;var It,Gt=-1,Ut=wt-1,Bs=0,ws=1,cr=1,Es=1<<Se;for(ze=0,De=1,Ge=2;De<=Se;++De,Ge<<=1){if(ws+=cr<<=1,0>(cr-=lt[De]))return 0;for(;0<lt[De];--lt[De])(ke=new te).g=De,ke.value=At[ze++],Y(fe,st+Bs,Ge,Es,ke),Bs=ce(Bs,De)}for(De=Se+1,Ge=2;15>=De;++De,Ge<<=1){if(ws+=cr<<=1,0>(cr-=lt[De]))return 0;for(;0<lt[De];--lt[De]){if(ke=new te,(Bs&Ut)!=Gt){for(st+=Es,It=1<<(Gt=De)-Se;15>Gt&&!(0>=(It-=lt[Gt]));)++Gt,It<<=1;wt+=Es=1<<(It=Gt-Se),fe[ye+(Gt=Bs&Ut)].g=It+Se,fe[ye+Gt].value=st-ye-Gt}ke.g=De-Se,ke.value=At[ze++],Y(fe,st+(Bs>>Se),Ge,Es,ke),Bs=ce(Bs,De)}}return ws!=2*Ct[15]-1?0:wt}(y,T,Q,q,de,pe)}function te(){this.value=this.g=0}function se(){this.value=this.g=0}function Ce(){this.G=g(5,te),this.H=p(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=g(lA,se)}function he(y,T,Q,q){o(y!=null),o(T!=null),o(2147483648>q),y.Ca=254,y.I=0,y.b=-8,y.Ka=0,y.oa=T,y.pa=Q,y.Jd=T,y.Yc=Q+q,y.Zc=4<=q?Q+q-4+1:Q,tt(y)}function Ne(y,T){for(var Q=0;0<T--;)Q|=ut(y,128)<<T;return Q}function Z(y,T){var Q=Ne(y,T);return ot(y)?-Q:Q}function Ie(y,T,Q,q){var de,pe=0;for(o(y!=null),o(T!=null),o(4294967288>q),y.Sb=q,y.Ra=0,y.u=0,y.h=0,4<q&&(q=4),de=0;de<q;++de)pe+=T[Q+de]<<8*de;y.Ra=pe,y.bb=q,y.oa=T,y.pa=Q}function Ve(y){for(;8<=y.u&&y.bb<y.Sb;)y.Ra>>>=8,y.Ra+=y.oa[y.pa+y.bb]<<Ad-8>>>0,++y.bb,y.u-=8;Te(y)&&(y.h=1,y.u=0)}function Pe(y,T){if(o(0<=T),!y.h&&T<=po){var Q=ue(y)&ho[T];return y.u+=T,Ve(y),Q}return y.h=1,y.u=0}function ne(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function ve(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function ue(y){return y.Ra>>>(y.u&Ad-1)>>>0}function Te(y){return o(y.bb<=y.Sb),y.h||y.bb==y.Sb&&y.u>Ad}function Be(y,T){y.u=T,y.h=Te(y)}function Ue(y){y.u>=cc&&(o(y.u>=cc),Ve(y))}function tt(y){o(y!=null&&y.oa!=null),y.pa<y.Zc?(y.I=(y.oa[y.pa++]|y.I<<8)>>>0,y.b+=8):(o(y!=null&&y.oa!=null),y.pa<y.Yc?(y.b+=8,y.I=y.oa[y.pa++]|y.I<<8):y.Ka?y.b=0:(y.I<<=8,y.b+=8,y.Ka=1))}function ot(y){return Ne(y,1)}function ut(y,T){var Q=y.Ca;0>y.b&&tt(y);var q=y.b,de=Q*T>>>8,pe=(y.I>>>q>de)+0;for(pe?(Q-=de,y.I-=de+1<<q>>>0):Q=de+1,q=Q,de=0;256<=q;)de+=8,q>>=8;return q=7^de+ud[q],y.b-=q,y.Ca=(Q<<q)-1,pe}function Tt(y,T,Q){y[T+0]=Q>>24&255,y[T+1]=Q>>16&255,y[T+2]=Q>>8&255,y[T+3]=255&Q}function Qe(y,T){return y[T+0]|y[T+1]<<8}function it(y,T){return Qe(y,T)|y[T+2]<<16}function kt(y,T){return Qe(y,T)|Qe(y,T+2)<<16}function _e(y,T){var Q=1<<T;return o(y!=null),o(0<T),y.X=p(Q),y.X==null?0:(y.Mb=32-T,y.Xa=T,1)}function xt(y,T){o(y!=null),o(T!=null),o(y.Xa==T.Xa),d(T.X,0,y.X,0,1<<T.Xa)}function Ke(){this.X=[],this.Xa=this.Mb=0}function Je(y,T,Q,q){o(Q!=null),o(q!=null);var de=Q[0],pe=q[0];return de==0&&(de=(y*pe+T/2)/T),pe==0&&(pe=(T*de+y/2)/y),0>=de||0>=pe?0:(Q[0]=de,q[0]=pe,1)}function $e(y,T){return y+(1<<T)-1>>>T}function jt(y,T){return((4278255360&y)+(4278255360&T)>>>0&4278255360)+((16711935&y)+(16711935&T)>>>0&16711935)>>>0}function Kt(y,T){V[T]=function(Q,q,de,pe,fe,ye,Se){var ke;for(ke=0;ke<fe;++ke){var Ge=V[y](ye[Se+ke-1],de,pe+ke);ye[Se+ke]=jt(Q[q+ke],Ge)}}}function os(){this.ud=this.hd=this.jd=0}function ss(y,T){return((4278124286&(y^T))>>>1)+(y&T)>>>0}function mt(y){return 0<=y&&256>y?y:0>y?0:255<y?255:void 0}function Ht(y,T){return mt(y+(y-T+.5>>1))}function qe(y,T,Q){return Math.abs(T-Q)-Math.abs(y-Q)}function ht(y,T,Q,q,de,pe,fe){for(q=pe[fe-1],Q=0;Q<de;++Q)pe[fe+Q]=q=jt(y[T+Q],q)}function Xt(y,T,Q,q,de){var pe;for(pe=0;pe<Q;++pe){var fe=y[T+pe],ye=fe>>8&255,Se=16711935&(Se=(Se=16711935&fe)+((ye<<16)+ye));q[de+pe]=(4278255360&fe)+Se>>>0}}function zt(y,T){T.jd=255&y,T.hd=y>>8&255,T.ud=y>>16&255}function ds(y,T,Q,q,de,pe){var fe;for(fe=0;fe<q;++fe){var ye=T[Q+fe],Se=ye>>>8,ke=ye,Ge=255&(Ge=(Ge=ye>>>16)+((y.jd<<24>>24)*(Se<<24>>24)>>>5));ke=255&(ke=(ke+=(y.hd<<24>>24)*(Se<<24>>24)>>>5)+((y.ud<<24>>24)*(Ge<<24>>24)>>>5)),de[pe+fe]=(4278255360&ye)+(Ge<<16)+ke}}function Qt(y,T,Q,q,de){V[T]=function(pe,fe,ye,Se,ke,Ge,At,De,ze){for(Se=At;Se<De;++Se)for(At=0;At<ze;++At)ke[Ge++]=de(ye[q(pe[fe++])])},V[y]=function(pe,fe,ye,Se,ke,Ge,At){var De=8>>pe.b,ze=pe.Ea,st=pe.K[0],wt=pe.w;if(8>De)for(pe=(1<<pe.b)-1,wt=(1<<De)-1;fe<ye;++fe){var lt,Ct=0;for(lt=0;lt<ze;++lt)lt&pe||(Ct=q(Se[ke++])),Ge[At++]=de(st[Ct&wt]),Ct>>=De}else V["VP8LMapColor"+Q](Se,ke,st,wt,Ge,At,fe,ye,ze)}}function Us(y,T,Q,q,de){for(Q=T+Q;T<Q;){var pe=y[T++];q[de++]=pe>>16&255,q[de++]=pe>>8&255,q[de++]=255&pe}}function bs(y,T,Q,q,de){for(Q=T+Q;T<Q;){var pe=y[T++];q[de++]=pe>>16&255,q[de++]=pe>>8&255,q[de++]=255&pe,q[de++]=pe>>24&255}}function cs(y,T,Q,q,de){for(Q=T+Q;T<Q;){var pe=(fe=y[T++])>>16&240|fe>>12&15,fe=240&fe|fe>>28&15;q[de++]=pe,q[de++]=fe}}function Ds(y,T,Q,q,de){for(Q=T+Q;T<Q;){var pe=(fe=y[T++])>>16&248|fe>>13&7,fe=fe>>5&224|fe>>3&31;q[de++]=pe,q[de++]=fe}}function zs(y,T,Q,q,de){for(Q=T+Q;T<Q;){var pe=y[T++];q[de++]=255&pe,q[de++]=pe>>8&255,q[de++]=pe>>16&255}}function rs(y,T,Q,q,de,pe){if(pe==0)for(Q=T+Q;T<Q;)Tt(q,((pe=y[T++])[0]>>24|pe[1]>>8&65280|pe[2]<<8&16711680|pe[3]<<24)>>>0),de+=32;else d(q,de,y,T,Q)}function Gs(y,T){V[T][0]=V[y+"0"],V[T][1]=V[y+"1"],V[T][2]=V[y+"2"],V[T][3]=V[y+"3"],V[T][4]=V[y+"4"],V[T][5]=V[y+"5"],V[T][6]=V[y+"6"],V[T][7]=V[y+"7"],V[T][8]=V[y+"8"],V[T][9]=V[y+"9"],V[T][10]=V[y+"10"],V[T][11]=V[y+"11"],V[T][12]=V[y+"12"],V[T][13]=V[y+"13"],V[T][14]=V[y+"0"],V[T][15]=V[y+"0"]}function dt(y){return y==Jg||y==hA||y==Cm||y==$g}function Pt(){this.eb=[],this.size=this.A=this.fb=0}function qt(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Yt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Pt,this.f.kb=new qt,this.sd=null}function us(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ws(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ji(y){return alert("todo:WebPSamplerProcessPlane"),y.T}function qr(y,T){var Q=y.T,q=T.ba.f.RGBA,de=q.eb,pe=q.fb+y.ka*q.A,fe=Po[T.ba.S],ye=y.y,Se=y.O,ke=y.f,Ge=y.N,At=y.ea,De=y.W,ze=T.cc,st=T.dc,wt=T.Mc,lt=T.Nc,Ct=y.ka,It=y.ka+y.T,Gt=y.U,Ut=Gt+1>>1;for(Ct==0?fe(ye,Se,null,null,ke,Ge,At,De,ke,Ge,At,De,de,pe,null,null,Gt):(fe(T.ec,T.fc,ye,Se,ze,st,wt,lt,ke,Ge,At,De,de,pe-q.A,de,pe,Gt),++Q);Ct+2<It;Ct+=2)ze=ke,st=Ge,wt=At,lt=De,Ge+=y.Rc,De+=y.Rc,pe+=2*q.A,fe(ye,(Se+=2*y.fa)-y.fa,ye,Se,ze,st,wt,lt,ke,Ge,At,De,de,pe-q.A,de,pe,Gt);return Se+=y.fa,y.j+It<y.o?(d(T.ec,T.fc,ye,Se,Gt),d(T.cc,T.dc,ke,Ge,Ut),d(T.Mc,T.Nc,At,De,Ut),Q--):1&It||fe(ye,Se,null,null,ke,Ge,At,De,ke,Ge,At,De,de,pe+q.A,null,null,Gt),Q}function Ga(y,T,Q){var q=y.F,de=[y.J];if(q!=null){var pe=y.U,fe=T.ba.S,ye=fe==ym||fe==Cm;T=T.ba.f.RGBA;var Se=[0],ke=y.ka;Se[0]=y.T,y.Kb&&(ke==0?--Se[0]:(--ke,de[0]-=y.width),y.j+y.ka+y.T==y.o&&(Se[0]=y.o-y.j-ke));var Ge=T.eb;ke=T.fb+ke*T.A,y=yx(q,de[0],y.width,pe,Se,Ge,ke+(ye?0:3),T.A),o(Q==Se),y&&dt(fe)&&cu(Ge,ke,ye,pe,Se,T.A)}return 0}function ti(y){var T=y.ma,Q=T.ba.S,q=11>Q,de=Q==_m||Q==uu||Q==ym||Q==Em||Q==12||dt(Q);if(T.memory=null,T.Ib=null,T.Jb=null,T.Nd=null,!Ih(T.Oa,y,de?11:12))return 0;if(de&&dt(Q)&&Nh(),y.da)alert("todo:use_scaling");else{if(q){if(T.Ib=ji,y.Kb){if(Q=y.U+1>>1,T.memory=p(y.U+2*Q),T.memory==null)return 0;T.ec=T.memory,T.fc=0,T.cc=T.ec,T.dc=T.fc+y.U,T.Mc=T.cc,T.Nc=T.dc+Q,T.Ib=qr,Nh()}}else alert("todo:EmitYUV");de&&(T.Jb=Ga,q&&oc())}if(q&&!Fx){for(y=0;256>y;++y)Mx[y]=89858*(y-128)+mA>>pA,VE[y]=-22014*(y-128)+mA,s0[y]=-45773*(y-128),Vx[y]=113618*(y-128)+mA>>pA;for(y=fA;y<t0;++y)T=76283*(y-16)+mA>>pA,QE[y-fA]=kc(T,255),Uh[y-fA]=kc(T+8>>4,15);Fx=1}return 1}function Fs(y){var T=y.ma,Q=y.U,q=y.T;return o(!(1&y.ka)),0>=Q||0>=q?0:(Q=T.Ib(y,T),T.Jb!=null&&T.Jb(y,T,Q),T.Dc+=Q,1)}function pn(y){y.ma.memory=null}function Ao(y,T,Q,q){return Pe(y,8)!=47?0:(T[0]=Pe(y,14)+1,Q[0]=Pe(y,14)+1,q[0]=Pe(y,1),Pe(y,3)!=0?0:!y.h)}function vt(y,T){if(4>y)return y+1;var Q=y-2>>1;return(2+(1&y)<<Q)+Pe(T,Q)+1}function Jt(y,T){return 120<T?T-120:1<=(Q=((Q=Zg[T-1])>>4)*y+(8-(15&Q)))?Q:1;var Q}function Js(y,T,Q){var q=ue(Q),de=y[T+=255&q].g-8;return 0<de&&(Be(Q,Q.u+8),q=ue(Q),T+=y[T].value,T+=q&(1<<de)-1),Be(Q,Q.u+y[T].g),y[T].value}function Os(y,T,Q){return Q.g+=y.g,Q.value+=y.value<<T>>>0,o(8>=Q.g),y.g}function jr(y,T,Q){var q=y.xc;return o((T=q==0?0:y.vc[y.md*(Q>>q)+(T>>q)])<y.Wb),y.Ya[T]}function In(y,T,Q,q){var de=y.ab,pe=y.c*T,fe=y.C;T=fe+T;var ye=Q,Se=q;for(q=y.Ta,Q=y.Ua;0<de--;){var ke=y.gc[de],Ge=fe,At=T,De=ye,ze=Se,st=(Se=q,ye=Q,ke.Ea);switch(o(Ge<At),o(At<=ke.nc),ke.hc){case 2:Wn(De,ze,(At-Ge)*st,Se,ye);break;case 0:var wt=Ge,lt=At,Ct=Se,It=ye,Gt=(Es=ke).Ea;wt==0&&(kh(De,ze,null,null,1,Ct,It),ht(De,ze+1,0,0,Gt-1,Ct,It+1),ze+=Gt,It+=Gt,++wt);for(var Ut=1<<Es.b,Bs=Ut-1,ws=$e(Gt,Es.b),cr=Es.K,Es=Es.w+(wt>>Es.b)*ws;wt<lt;){var Or=cr,mi=Es,pr=1;for(dA(De,ze,Ct,It-Gt,1,Ct,It);pr<Gt;){var Cs=(pr&~Bs)+Ut;Cs>Gt&&(Cs=Gt),(0,Bh[Or[mi++]>>8&15])(De,ze+ +pr,Ct,It+pr-Gt,Cs-pr,Ct,It+pr),pr=Cs}ze+=Gt,It+=Gt,++wt&Bs||(Es+=ws)}At!=ke.nc&&d(Se,ye-st,Se,ye+(At-Ge-1)*st,st);break;case 1:for(st=De,lt=ze,Gt=(De=ke.Ea)-(It=De&~(Ct=(ze=1<<ke.b)-1)),wt=$e(De,ke.b),Ut=ke.K,ke=ke.w+(Ge>>ke.b)*wt;Ge<At;){for(Bs=Ut,ws=ke,cr=new os,Es=lt+It,Or=lt+De;lt<Es;)zt(Bs[ws++],cr),Lh(cr,st,lt,ze,Se,ye),lt+=ze,ye+=ze;lt<Or&&(zt(Bs[ws++],cr),Lh(cr,st,lt,Gt,Se,ye),lt+=Gt,ye+=Gt),++Ge&Ct||(ke+=wt)}break;case 3:if(De==Se&&ze==ye&&0<ke.b){for(lt=Se,De=st=ye+(At-Ge)*st-(It=(At-Ge)*$e(ke.Ea,ke.b)),ze=Se,Ct=ye,wt=[],It=(Gt=It)-1;0<=It;--It)wt[It]=ze[Ct+It];for(It=Gt-1;0<=It;--It)lt[De+It]=wt[It];vm(ke,Ge,At,Se,st,Se,ye)}else vm(ke,Ge,At,De,ze,Se,ye)}ye=q,Se=Q}Se!=Q&&d(q,Q,ye,Se,pe)}function On(y,T){var Q=y.V,q=y.Ba+y.c*y.C,de=T-y.C;if(o(T<=y.l.o),o(16>=de),0<de){var pe=y.l,fe=y.Ta,ye=y.Ua,Se=pe.width;if(In(y,de,Q,q),de=ye=[ye],o((Q=y.C)<(q=T)),o(pe.v<pe.va),q>pe.o&&(q=pe.o),Q<pe.j){var ke=pe.j-Q;Q=pe.j,de[0]+=ke*Se}if(Q>=q?Q=0:(de[0]+=4*pe.v,pe.ka=Q-pe.j,pe.U=pe.va-pe.v,pe.T=q-Q,Q=1),Q){if(ye=ye[0],11>(Q=y.ca).S){var Ge=Q.f.RGBA,At=(q=Q.S,de=pe.U,pe=pe.T,ke=Ge.eb,Ge.A),De=pe;for(Ge=Ge.fb+y.Ma*Ge.A;0<De--;){var ze=fe,st=ye,wt=de,lt=ke,Ct=Ge;switch(q){case wm:Bo(ze,st,wt,lt,Ct);break;case _m:hd(ze,st,wt,lt,Ct);break;case Jg:hd(ze,st,wt,lt,Ct),cu(lt,Ct,0,wt,1,0);break;case Tx:AA(ze,st,wt,lt,Ct);break;case uu:rs(ze,st,wt,lt,Ct,1);break;case hA:rs(ze,st,wt,lt,Ct,1),cu(lt,Ct,0,wt,1,0);break;case ym:rs(ze,st,wt,lt,Ct,0);break;case Cm:rs(ze,st,wt,lt,Ct,0),cu(lt,Ct,1,wt,1,0);break;case Em:pd(ze,st,wt,lt,Ct);break;case $g:pd(ze,st,wt,lt,Ct),Xg(lt,Ct,wt,1,0);break;case za:si(ze,st,wt,lt,Ct);break;default:o(0)}ye+=Se,Ge+=At}y.Ma+=pe}else alert("todo:EmitRescaledRowsYUVA");o(y.Ma<=Q.height)}}y.C=T,o(y.C<=y.i)}function Xr(y){var T;if(0<y.ua)return 0;for(T=0;T<y.Wb;++T){var Q=y.Ya[T].G,q=y.Ya[T].H;if(0<Q[1][q[1]+0].g||0<Q[2][q[2]+0].g||0<Q[3][q[3]+0].g)return 0}return 1}function Aa(y,T,Q,q,de,pe){if(y.Z!=0){var fe=y.qd,ye=y.rd;for(o(gd[y.Z]!=null);T<Q;++T)gd[y.Z](fe,ye,q,de,q,de,pe),fe=q,ye=de,de+=pe;y.qd=fe,y.rd=ye}}function ea(y,T){var Q=y.l.ma,q=Q.Z==0||Q.Z==1?y.l.j:y.C;if(q=y.C<q?q:y.C,o(T<=y.l.o),T>q){var de=y.l.width,pe=Q.ca,fe=Q.tb+de*q,ye=y.V,Se=y.Ba+y.c*q,ke=y.gc;o(y.ab==1),o(ke[0].hc==3),mo(ke[0],q,T,ye,Se,pe,fe),Aa(Q,q,T,pe,fe,de)}y.C=y.Ma=T}function Ka(y,T,Q,q,de,pe,fe){var ye=y.$/q,Se=y.$%q,ke=y.m,Ge=y.s,At=Q+y.$,De=At;de=Q+q*de;var ze=Q+q*pe,st=280+Ge.ua,wt=y.Pb?ye:16777216,lt=0<Ge.ua?Ge.Wa:null,Ct=Ge.wc,It=At<ze?jr(Ge,Se,ye):null;o(y.C<pe),o(ze<=de);var Gt=!1;e:for(;;){for(;Gt||At<ze;){var Ut=0;if(ye>=wt){var Bs=At-Q;o((wt=y).Pb),wt.wd=wt.m,wt.xd=Bs,0<wt.s.ua&&xt(wt.s.Wa,wt.s.vb),wt=ye+Ox}if(Se&Ct||(It=jr(Ge,Se,ye)),o(It!=null),It.Qb&&(T[At]=It.qb,Gt=!0),!Gt)if(Ue(ke),It.jc){Ut=ke,Bs=T;var ws=At,cr=It.pd[ue(Ut)&lA-1];o(It.jc),256>cr.g?(Be(Ut,Ut.u+cr.g),Bs[ws]=cr.value,Ut=0):(Be(Ut,Ut.u+cr.g-256),o(256<=cr.value),Ut=cr.value),Ut==0&&(Gt=!0)}else Ut=Js(It.G[0],It.H[0],ke);if(ke.h)break;if(Gt||256>Ut){if(!Gt)if(It.nd)T[At]=(It.qb|Ut<<8)>>>0;else{if(Ue(ke),Gt=Js(It.G[1],It.H[1],ke),Ue(ke),Bs=Js(It.G[2],It.H[2],ke),ws=Js(It.G[3],It.H[3],ke),ke.h)break;T[At]=(ws<<24|Gt<<16|Ut<<8|Bs)>>>0}if(Gt=!1,++At,++Se>=q&&(Se=0,++ye,fe!=null&&ye<=pe&&!(ye%16)&&fe(y,ye),lt!=null))for(;De<At;)Ut=T[De++],lt.X[(506832829*Ut&4294967295)>>>lt.Mb]=Ut}else if(280>Ut){if(Ut=vt(Ut-256,ke),Bs=Js(It.G[4],It.H[4],ke),Ue(ke),Bs=Jt(q,Bs=vt(Bs,ke)),ke.h)break;if(At-Q<Bs||de-At<Ut)break e;for(ws=0;ws<Ut;++ws)T[At+ws]=T[At+ws-Bs];for(At+=Ut,Se+=Ut;Se>=q;)Se-=q,++ye,fe!=null&&ye<=pe&&!(ye%16)&&fe(y,ye);if(o(At<=de),Se&Ct&&(It=jr(Ge,Se,ye)),lt!=null)for(;De<At;)Ut=T[De++],lt.X[(506832829*Ut&4294967295)>>>lt.Mb]=Ut}else{if(!(Ut<st))break e;for(Gt=Ut-280,o(lt!=null);De<At;)Ut=T[De++],lt.X[(506832829*Ut&4294967295)>>>lt.Mb]=Ut;Ut=At,o(!(Gt>>>(Bs=lt).Xa)),T[Ut]=Bs.X[Gt],Gt=!0}Gt||o(ke.h==Te(ke))}if(y.Pb&&ke.h&&At<de)o(y.m.h),y.a=5,y.m=y.wd,y.$=y.xd,0<y.s.ua&&xt(y.s.vb,y.s.Wa);else{if(ke.h)break e;fe!=null&&fe(y,ye>pe?pe:ye),y.a=0,y.$=At-Q}return 1}return y.a=3,0}function ua(y){o(y!=null),y.vc=null,y.yc=null,y.Ya=null;var T=y.Wa;T!=null&&(T.X=null),y.vb=null,o(y!=null)}function rc(){var y=new sr;return y==null?null:(y.a=0,y.xb=Bx,Gs("Predictor","VP8LPredictors"),Gs("Predictor","VP8LPredictors_C"),Gs("PredictorAdd","VP8LPredictorsAdd"),Gs("PredictorAdd","VP8LPredictorsAdd_C"),Wn=Xt,Lh=ds,Bo=Us,hd=bs,pd=cs,si=Ds,AA=zs,V.VP8LMapColor32b=Uc,V.VP8LMapColor8b=Dh,y)}function Sa(y,T,Q,q,de){var pe=1,fe=[y],ye=[T],Se=q.m,ke=q.s,Ge=null,At=0;e:for(;;){if(Q)for(;pe&&Pe(Se,1);){var De=fe,ze=ye,st=q,wt=1,lt=st.m,Ct=st.gc[st.ab],It=Pe(lt,2);if(st.Oc&1<<It)pe=0;else{switch(st.Oc|=1<<It,Ct.hc=It,Ct.Ea=De[0],Ct.nc=ze[0],Ct.K=[null],++st.ab,o(4>=st.ab),It){case 0:case 1:Ct.b=Pe(lt,3)+2,wt=Sa($e(Ct.Ea,Ct.b),$e(Ct.nc,Ct.b),0,st,Ct.K),Ct.K=Ct.K[0];break;case 3:var Gt,Ut=Pe(lt,8)+1,Bs=16<Ut?0:4<Ut?1:2<Ut?2:3;if(De[0]=$e(Ct.Ea,Bs),Ct.b=Bs,Gt=wt=Sa(Ut,1,0,st,Ct.K)){var ws,cr=Ut,Es=Ct,Or=1<<(8>>Es.b),mi=p(Or);if(mi==null)Gt=0;else{var pr=Es.K[0],Cs=Es.w;for(mi[0]=Es.K[0][0],ws=1;ws<1*cr;++ws)mi[ws]=jt(pr[Cs+ws],mi[ws-1]);for(;ws<4*Or;++ws)mi[ws]=0;Es.K[0]=null,Es.K[0]=mi,Gt=1}}wt=Gt;break;case 2:break;default:o(0)}pe=wt}}if(fe=fe[0],ye=ye[0],pe&&Pe(Se,1)&&!(pe=1<=(At=Pe(Se,4))&&11>=At)){q.a=3;break e}var ts;if(ts=pe)t:{var Dn,lr,Mr,yn=q,sa=fe,Ra=ye,zn=At,pa=Q,Ia=yn.m,Pi=yn.s,Kr=[null],an=1,ri=0,sn=OE[zn];s:for(;;){if(pa&&Pe(Ia,1)){var ni=Pe(Ia,3)+2,uc=$e(sa,ni),fi=$e(Ra,ni),qa=uc*fi;if(!Sa(uc,fi,0,yn,Kr))break s;for(Kr=Kr[0],Pi.xc=ni,Dn=0;Dn<qa;++Dn){var ln=Kr[Dn]>>8&65535;Kr[Dn]=ln,ln>=an&&(an=ln+1)}}if(Ia.h)break s;for(lr=0;5>lr;++lr){var Ui=Ix[lr];!lr&&0<zn&&(Ui+=1<<zn),ri<Ui&&(ri=Ui)}var Ya=g(an*sn,te),Oa=an,fo=g(Oa,Ce);if(fo==null)var go=null;else o(65536>=Oa),go=fo;var ra=p(ri);if(go==null||ra==null||Ya==null){yn.a=1;break s}var bo=Ya;for(Dn=Mr=0;Dn<an;++Dn){var En=go[Dn],xo=En.G,hc=En.H,gA=0,Sl=1,Fi=0;for(lr=0;5>lr;++lr){Ui=Ix[lr],xo[lr]=bo,hc[lr]=Mr,!lr&&0<zn&&(Ui+=1<<zn);n:{var Rm,Im=Ui,Om=yn,pu=ra,KE=bo,WE=Mr,r0=0,bd=Om.m,zE=Pe(bd,1);if(h(pu,0,0,Im),zE){var qE=Pe(bd,1)+1,Gx=Pe(bd,1),Kx=Pe(bd,Gx==0?1:8);pu[Kx]=1,qE==2&&(pu[Kx=Pe(bd,8)]=1);var km=1}else{var n0=p(19),Wx=Pe(bd,4)+4;if(19<Wx){Om.a=3;var bA=0;break n}for(Rm=0;Rm<Wx;++Rm)n0[IE[Rm]]=Pe(bd,3);var Dm=void 0,Nl=void 0,zx=Om,YE=n0,Bm=Im,qx=pu,mu=0,xd=zx.m,i0=8,Lm=g(128,te);r:for(;z(Lm,0,7,YE,19);){if(Pe(xd,1)){var a0=2+2*Pe(xd,3);if((Dm=2+Pe(xd,a0))>Bm)break r}else Dm=Bm;for(Nl=0;Nl<Bm&&Dm--;){Ue(xd);var Yx=Lm[0+(127&ue(xd))];Be(xd,xd.u+Yx.g);var fu=Yx.value;if(16>fu)qx[Nl++]=fu,fu!=0&&(i0=fu);else{var XE=fu==16,Xx=fu-16,JE=Rx[Xx],Fh=Pe(xd,TE[Xx])+JE;if(Nl+Fh>Bm)break r;for(var $E=XE?i0:0;0<Fh--;)qx[Nl++]=$E}}mu=1;break r}mu||(zx.a=3),km=mu}(km=km&&!bd.h)&&(r0=z(KE,WE,8,pu,Im)),km&&r0!=0?bA=r0:(Om.a=3,bA=0)}if(bA==0)break s;if(Sl&&RE[lr]==1&&(Sl=bo[Mr].g==0),gA+=bo[Mr].g,Mr+=bA,3>=lr){var Mc,Mh=ra[0];for(Mc=1;Mc<Ui;++Mc)ra[Mc]>Mh&&(Mh=ra[Mc]);Fi+=Mh}}if(En.nd=Sl,En.Qb=0,Sl&&(En.qb=(xo[3][hc[3]+0].value<<24|xo[1][hc[1]+0].value<<16|xo[2][hc[2]+0].value)>>>0,gA==0&&256>xo[0][hc[0]+0].value&&(En.Qb=1,En.qb+=xo[0][hc[0]+0].value<<8)),En.jc=!En.Qb&&6>Fi,En.jc){var xA,vo=En;for(xA=0;xA<lA;++xA){var pc=xA,vd=vo.pd[pc],Vh=vo.G[0][vo.H[0]+pc];256<=Vh.value?(vd.g=Vh.g+256,vd.value=Vh.value):(vd.g=0,vd.value=0,pc>>=Os(Vh,8,vd),pc>>=Os(vo.G[1][vo.H[1]+pc],16,vd),pc>>=Os(vo.G[2][vo.H[2]+pc],0,vd),Os(vo.G[3][vo.H[3]+pc],24,vd))}}}Pi.vc=Kr,Pi.Wb=an,Pi.Ya=go,Pi.yc=Ya,ts=1;break t}ts=0}if(!(pe=ts)){q.a=3;break e}if(0<At){if(ke.ua=1<<At,!_e(ke.Wa,At)){q.a=1,pe=0;break e}}else ke.ua=0;var o0=q,c0=fe,ZE=ye,l0=o0.s,Qh=l0.xc;if(o0.c=c0,o0.i=ZE,l0.md=$e(c0,Qh),l0.wc=Qh==0?-1:(1<<Qh)-1,Q){q.xb=jE;break e}if((Ge=p(fe*ye))==null){q.a=1,pe=0;break e}pe=(pe=Ka(q,Ge,0,fe,ye,ye,null))&&!Se.h;break e}return pe?(de!=null?de[0]=Ge:(o(Ge==null),o(Q)),q.$=0,Q||ua(ke)):ua(ke),pe}function nc(y,T){var Q=y.c*y.i,q=Q+T+16*T;return o(y.c<=T),y.V=p(q),y.V==null?(y.Ta=null,y.Ua=0,y.a=1,0):(y.Ta=y.V,y.Ua=y.Ba+Q+T,1)}function ic(y,T){var Q=y.C,q=T-Q,de=y.V,pe=y.Ba+y.c*Q;for(o(T<=y.l.o);0<q;){var fe=16<q?16:q,ye=y.l.ma,Se=y.l.width,ke=Se*fe,Ge=ye.ca,At=ye.tb+Se*Q,De=y.Ta,ze=y.Ua;In(y,fe,de,pe),Ex(De,ze,Ge,At,ke),Aa(ye,Q,Q+fe,Ge,At,Se),q-=fe,de+=fe*y.c,Q+=fe}o(Q==T),y.C=y.Ma=T}function JA(){this.ub=this.yd=this.td=this.Rb=0}function $A(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Ro(){this.Fb=this.Bb=this.Cb=0,this.Zb=p(4),this.Lb=p(4)}function fh(){this.Yb=function(){var y=[];return function T(Q,q,de){for(var pe=de[q],fe=0;fe<pe&&(Q.push(de.length>q+1?[]:0),!(de.length<q+1));fe++)T(Q[fe],q+1,de)}(y,0,[3,11]),y}()}function om(){this.jb=p(3),this.Wc=x([4,8],fh),this.Xc=x([4,17],fh)}function Kn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new p(4),this.od=new p(4)}function Io(){this.ld=this.La=this.dd=this.tc=0}function gh(){this.Na=this.la=0}function cm(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function bh(){this.ad=p(384),this.Za=0,this.Ob=p(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ZA(){this.uc=this.M=this.Nb=0,this.wa=Array(new Io),this.Y=0,this.ya=Array(new bh),this.aa=0,this.l=new eu}function lm(){this.y=p(16),this.f=p(8),this.ea=p(8)}function xh(){this.cb=this.a=0,this.sc="",this.m=new ne,this.Od=new JA,this.Kc=new $A,this.ed=new Kn,this.Qa=new Ro,this.Ic=this.$c=this.Aa=0,this.D=new ZA,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=g(8,ne),this.ia=0,this.pb=g(4,cm),this.Pa=new om,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new lm),this.Hd=0,this.rb=Array(new gh),this.sb=0,this.wa=Array(new Io),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new bh),this.L=this.aa=0,this.gd=x([4,2],Io),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function kc(y,T){return 0>y?0:y>T?T:y}function eu(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Fg(){var y=new xh;return y!=null&&(y.a=0,y.sc="OK",y.cb=0,y.Xb=0,hu||(hu=Hr)),y}function kn(y,T,Q){return y.a==0&&(y.a=T,y.sc=Q,y.cb=0),0}function tu(y,T,Q){return 3<=Q&&y[T+0]==157&&y[T+1]==1&&y[T+2]==42}function Dc(y,T){if(y==null)return 0;if(y.a=0,y.sc="OK",T==null)return kn(y,2,"null VP8Io passed to VP8GetHeaders()");var Q=T.data,q=T.w,de=T.ha;if(4>de)return kn(y,7,"Truncated header.");var pe=Q[q+0]|Q[q+1]<<8|Q[q+2]<<16,fe=y.Od;if(fe.Rb=!(1&pe),fe.td=pe>>1&7,fe.yd=pe>>4&1,fe.ub=pe>>5,3<fe.td)return kn(y,3,"Incorrect keyframe parameters.");if(!fe.yd)return kn(y,4,"Frame not displayable.");q+=3,de-=3;var ye=y.Kc;if(fe.Rb){if(7>de)return kn(y,7,"cannot parse picture header");if(!tu(Q,q,de))return kn(y,3,"Bad code word");ye.c=16383&(Q[q+4]<<8|Q[q+3]),ye.Td=Q[q+4]>>6,ye.i=16383&(Q[q+6]<<8|Q[q+5]),ye.Ud=Q[q+6]>>6,q+=7,de-=7,y.za=ye.c+15>>4,y.Ub=ye.i+15>>4,T.width=ye.c,T.height=ye.i,T.Da=0,T.j=0,T.v=0,T.va=T.width,T.o=T.height,T.da=0,T.ib=T.width,T.hb=T.height,T.U=T.width,T.T=T.height,h((pe=y.Pa).jb,0,255,pe.jb.length),o((pe=y.Qa)!=null),pe.Cb=0,pe.Bb=0,pe.Fb=1,h(pe.Zb,0,0,pe.Zb.length),h(pe.Lb,0,0,pe.Lb)}if(fe.ub>de)return kn(y,7,"bad partition length");he(pe=y.m,Q,q,fe.ub),q+=fe.ub,de-=fe.ub,fe.Rb&&(ye.Ld=ot(pe),ye.Kd=ot(pe)),ye=y.Qa;var Se,ke=y.Pa;if(o(pe!=null),o(ye!=null),ye.Cb=ot(pe),ye.Cb){if(ye.Bb=ot(pe),ot(pe)){for(ye.Fb=ot(pe),Se=0;4>Se;++Se)ye.Zb[Se]=ot(pe)?Z(pe,7):0;for(Se=0;4>Se;++Se)ye.Lb[Se]=ot(pe)?Z(pe,6):0}if(ye.Bb)for(Se=0;3>Se;++Se)ke.jb[Se]=ot(pe)?Ne(pe,8):255}else ye.Bb=0;if(pe.Ka)return kn(y,3,"cannot parse segment header");if((ye=y.ed).zd=ot(pe),ye.Tb=Ne(pe,6),ye.wb=Ne(pe,3),ye.Pc=ot(pe),ye.Pc&&ot(pe)){for(ke=0;4>ke;++ke)ot(pe)&&(ye.vd[ke]=Z(pe,6));for(ke=0;4>ke;++ke)ot(pe)&&(ye.od[ke]=Z(pe,6))}if(y.L=ye.Tb==0?0:ye.zd?1:2,pe.Ka)return kn(y,3,"cannot parse filter header");var Ge=de;if(de=Se=q,q=Se+Ge,ye=Ge,y.Xb=(1<<Ne(y.m,2))-1,Ge<3*(ke=y.Xb))Q=7;else{for(Se+=3*ke,ye-=3*ke,Ge=0;Ge<ke;++Ge){var At=Q[de+0]|Q[de+1]<<8|Q[de+2]<<16;At>ye&&(At=ye),he(y.Jc[+Ge],Q,Se,At),Se+=At,ye-=At,de+=3}he(y.Jc[+ke],Q,Se,ye),Q=Se<q?0:5}if(Q!=0)return kn(y,Q,"cannot parse partitions");for(Q=Ne(Se=y.m,7),de=ot(Se)?Z(Se,4):0,q=ot(Se)?Z(Se,4):0,ye=ot(Se)?Z(Se,4):0,ke=ot(Se)?Z(Se,4):0,Se=ot(Se)?Z(Se,4):0,Ge=y.Qa,At=0;4>At;++At){if(Ge.Cb){var De=Ge.Zb[At];Ge.Fb||(De+=Q)}else{if(0<At){y.pb[At]=y.pb[0];continue}De=Q}var ze=y.pb[At];ze.Sc[0]=Sm[kc(De+de,127)],ze.Sc[1]=e0[kc(De+0,127)],ze.Eb[0]=2*Sm[kc(De+q,127)],ze.Eb[1]=101581*e0[kc(De+ye,127)]>>16,8>ze.Eb[1]&&(ze.Eb[1]=8),ze.Qc[0]=Sm[kc(De+ke,117)],ze.Qc[1]=e0[kc(De+Se,127)],ze.lc=De+Se}if(!fe.Rb)return kn(y,4,"Not a key frame.");for(ot(pe),fe=y.Pa,Q=0;4>Q;++Q){for(de=0;8>de;++de)for(q=0;3>q;++q)for(ye=0;11>ye;++ye)ke=ut(pe,LE[Q][de][q][ye])?Ne(pe,8):DE[Q][de][q][ye],fe.Wc[Q][de].Yb[q][ye]=ke;for(de=0;17>de;++de)fe.Xc[Q][de]=fe.Wc[Q][Dx[de]]}return y.kc=ot(pe),y.kc&&(y.Bd=Ne(pe,8)),y.cb=1}function Hr(y,T,Q,q,de,pe,fe){var ye=T[de].Yb[Q];for(Q=0;16>de;++de){if(!ut(y,ye[Q+0]))return de;for(;!ut(y,ye[Q+1]);)if(ye=T[++de].Yb[0],Q=0,de==16)return 16;var Se=T[de+1].Yb;if(ut(y,ye[Q+2])){var ke=y,Ge=0;if(ut(ke,(De=ye)[(At=Q)+3]))if(ut(ke,De[At+6])){for(ye=0,At=2*(Ge=ut(ke,De[At+8]))+(De=ut(ke,De[At+9+Ge])),Ge=0,De=Nm[At];De[ye];++ye)Ge+=Ge+ut(ke,De[ye]);Ge+=3+(8<<At)}else ut(ke,De[At+7])?(Ge=7+2*ut(ke,165),Ge+=ut(ke,145)):Ge=5+ut(ke,159);else Ge=ut(ke,De[At+4])?3+ut(ke,De[At+5]):2;ye=Se[2]}else Ge=1,ye=Se[1];Se=fe+kE[de],0>(ke=y).b&&tt(ke);var At,De=ke.b,ze=(At=ke.Ca>>1)-(ke.I>>De)>>31;--ke.b,ke.Ca+=ze,ke.Ca|=1,ke.I-=(At+1&ze)<<De,pe[Se]=((Ge^ze)-ze)*q[(0<de)+0]}return 16}function dm(y){var T=y.rb[y.sb-1];T.la=0,T.Na=0,h(y.zc,0,0,y.zc.length),y.ja=0}function uo(y,T,Q,q,de){de=y[T+Q+32*q]+(de>>3),y[T+Q+32*q]=-256&de?0>de?0:255:de}function Ei(y,T,Q,q,de,pe){uo(y,T,0,Q,q+de),uo(y,T,1,Q,q+pe),uo(y,T,2,Q,q-pe),uo(y,T,3,Q,q-de)}function fl(y){return(20091*y>>16)+y}function Am(y,T,Q,q){var de,pe=0,fe=p(16);for(de=0;4>de;++de){var ye=y[T+0]+y[T+8],Se=y[T+0]-y[T+8],ke=(35468*y[T+4]>>16)-fl(y[T+12]),Ge=fl(y[T+4])+(35468*y[T+12]>>16);fe[pe+0]=ye+Ge,fe[pe+1]=Se+ke,fe[pe+2]=Se-ke,fe[pe+3]=ye-Ge,pe+=4,T++}for(de=pe=0;4>de;++de)ye=(y=fe[pe+0]+4)+fe[pe+8],Se=y-fe[pe+8],ke=(35468*fe[pe+4]>>16)-fl(fe[pe+12]),uo(Q,q,0,0,ye+(Ge=fl(fe[pe+4])+(35468*fe[pe+12]>>16))),uo(Q,q,1,0,Se+ke),uo(Q,q,2,0,Se-ke),uo(Q,q,3,0,ye-Ge),pe++,q+=32}function Mg(y,T,Q,q){var de=y[T+0]+4,pe=35468*y[T+4]>>16,fe=fl(y[T+4]),ye=35468*y[T+1]>>16;Ei(Q,q,0,de+fe,y=fl(y[T+1]),ye),Ei(Q,q,1,de+pe,y,ye),Ei(Q,q,2,de-pe,y,ye),Ei(Q,q,3,de-fe,y,ye)}function Vg(y,T,Q,q,de){Am(y,T,Q,q),de&&Am(y,T+16,Q,q+4)}function Bc(y,T,Q,q){uA(y,T+0,Q,q,1),uA(y,T+32,Q,q+128,1)}function um(y,T,Q,q){var de;for(y=y[T+0]+4,de=0;4>de;++de)for(T=0;4>T;++T)uo(Q,q,T,de,y)}function su(y,T,Q,q){y[T+0]&&tn(y,T+0,Q,q),y[T+16]&&tn(y,T+16,Q,q+4),y[T+32]&&tn(y,T+32,Q,q+128),y[T+48]&&tn(y,T+48,Q,q+128+4)}function tA(y,T,Q,q){var de,pe=p(16);for(de=0;4>de;++de){var fe=y[T+0+de]+y[T+12+de],ye=y[T+4+de]+y[T+8+de],Se=y[T+4+de]-y[T+8+de],ke=y[T+0+de]-y[T+12+de];pe[0+de]=fe+ye,pe[8+de]=fe-ye,pe[4+de]=ke+Se,pe[12+de]=ke-Se}for(de=0;4>de;++de)fe=(y=pe[0+4*de]+3)+pe[3+4*de],ye=pe[1+4*de]+pe[2+4*de],Se=pe[1+4*de]-pe[2+4*de],ke=y-pe[3+4*de],Q[q+0]=fe+ye>>3,Q[q+16]=ke+Se>>3,Q[q+32]=fe-ye>>3,Q[q+48]=ke-Se>>3,q+=64}function gl(y,T,Q){var q,de=T-32,pe=ha,fe=255-y[de-1];for(q=0;q<Q;++q){var ye,Se=pe,ke=fe+y[T-1];for(ye=0;ye<Q;++ye)y[T+ye]=Se[ke+y[de+ye]];T+=32}}function Qg(y,T){gl(y,T,4)}function vh(y,T){gl(y,T,8)}function Hg(y,T){gl(y,T,16)}function ru(y,T){var Q;for(Q=0;16>Q;++Q)d(y,T+32*Q,y,T-32,16)}function hm(y,T){var Q;for(Q=16;0<Q;--Q)h(y,T,y[T-1],16),T+=32}function ac(y,T,Q){var q;for(q=0;16>q;++q)h(T,Q+32*q,y,16)}function Gg(y,T){var Q,q=16;for(Q=0;16>Q;++Q)q+=y[T-1+32*Q]+y[T+Q-32];ac(q>>5,y,T)}function sA(y,T){var Q,q=8;for(Q=0;16>Q;++Q)q+=y[T-1+32*Q];ac(q>>4,y,T)}function wh(y,T){var Q,q=8;for(Q=0;16>Q;++Q)q+=y[T+Q-32];ac(q>>4,y,T)}function Kg(y,T){ac(128,y,T)}function nr(y,T,Q){return y+2*T+Q+2>>2}function Wg(y,T){var Q,q=T-32;for(q=new Uint8Array([nr(y[q-1],y[q+0],y[q+1]),nr(y[q+0],y[q+1],y[q+2]),nr(y[q+1],y[q+2],y[q+3]),nr(y[q+2],y[q+3],y[q+4])]),Q=0;4>Q;++Q)d(y,T+32*Q,q,0,q.length)}function pm(y,T){var Q=y[T-1],q=y[T-1+32],de=y[T-1+64],pe=y[T-1+96];Tt(y,T+0,16843009*nr(y[T-1-32],Q,q)),Tt(y,T+32,16843009*nr(Q,q,de)),Tt(y,T+64,16843009*nr(q,de,pe)),Tt(y,T+96,16843009*nr(de,pe,pe))}function zg(y,T){var Q,q=4;for(Q=0;4>Q;++Q)q+=y[T+Q-32]+y[T-1+32*Q];for(q>>=3,Q=0;4>Q;++Q)h(y,T+32*Q,q,4)}function bl(y,T){var Q=y[T-1+0],q=y[T-1+32],de=y[T-1+64],pe=y[T-1-32],fe=y[T+0-32],ye=y[T+1-32],Se=y[T+2-32],ke=y[T+3-32];y[T+0+96]=nr(q,de,y[T-1+96]),y[T+1+96]=y[T+0+64]=nr(Q,q,de),y[T+2+96]=y[T+1+64]=y[T+0+32]=nr(pe,Q,q),y[T+3+96]=y[T+2+64]=y[T+1+32]=y[T+0+0]=nr(fe,pe,Q),y[T+3+64]=y[T+2+32]=y[T+1+0]=nr(ye,fe,pe),y[T+3+32]=y[T+2+0]=nr(Se,ye,fe),y[T+3+0]=nr(ke,Se,ye)}function xl(y,T){var Q=y[T+1-32],q=y[T+2-32],de=y[T+3-32],pe=y[T+4-32],fe=y[T+5-32],ye=y[T+6-32],Se=y[T+7-32];y[T+0+0]=nr(y[T+0-32],Q,q),y[T+1+0]=y[T+0+32]=nr(Q,q,de),y[T+2+0]=y[T+1+32]=y[T+0+64]=nr(q,de,pe),y[T+3+0]=y[T+2+32]=y[T+1+64]=y[T+0+96]=nr(de,pe,fe),y[T+3+32]=y[T+2+64]=y[T+1+96]=nr(pe,fe,ye),y[T+3+64]=y[T+2+96]=nr(fe,ye,Se),y[T+3+96]=nr(ye,Se,Se)}function rA(y,T){var Q=y[T-1+0],q=y[T-1+32],de=y[T-1+64],pe=y[T-1-32],fe=y[T+0-32],ye=y[T+1-32],Se=y[T+2-32],ke=y[T+3-32];y[T+0+0]=y[T+1+64]=pe+fe+1>>1,y[T+1+0]=y[T+2+64]=fe+ye+1>>1,y[T+2+0]=y[T+3+64]=ye+Se+1>>1,y[T+3+0]=Se+ke+1>>1,y[T+0+96]=nr(de,q,Q),y[T+0+64]=nr(q,Q,pe),y[T+0+32]=y[T+1+96]=nr(Q,pe,fe),y[T+1+32]=y[T+2+96]=nr(pe,fe,ye),y[T+2+32]=y[T+3+96]=nr(fe,ye,Se),y[T+3+32]=nr(ye,Se,ke)}function qg(y,T){var Q=y[T+0-32],q=y[T+1-32],de=y[T+2-32],pe=y[T+3-32],fe=y[T+4-32],ye=y[T+5-32],Se=y[T+6-32],ke=y[T+7-32];y[T+0+0]=Q+q+1>>1,y[T+1+0]=y[T+0+64]=q+de+1>>1,y[T+2+0]=y[T+1+64]=de+pe+1>>1,y[T+3+0]=y[T+2+64]=pe+fe+1>>1,y[T+0+32]=nr(Q,q,de),y[T+1+32]=y[T+0+96]=nr(q,de,pe),y[T+2+32]=y[T+1+96]=nr(de,pe,fe),y[T+3+32]=y[T+2+96]=nr(pe,fe,ye),y[T+3+64]=nr(fe,ye,Se),y[T+3+96]=nr(ye,Se,ke)}function nu(y,T){var Q=y[T-1+0],q=y[T-1+32],de=y[T-1+64],pe=y[T-1+96];y[T+0+0]=Q+q+1>>1,y[T+2+0]=y[T+0+32]=q+de+1>>1,y[T+2+32]=y[T+0+64]=de+pe+1>>1,y[T+1+0]=nr(Q,q,de),y[T+3+0]=y[T+1+32]=nr(q,de,pe),y[T+3+32]=y[T+1+64]=nr(de,pe,pe),y[T+3+64]=y[T+2+64]=y[T+0+96]=y[T+1+96]=y[T+2+96]=y[T+3+96]=pe}function _h(y,T){var Q=y[T-1+0],q=y[T-1+32],de=y[T-1+64],pe=y[T-1+96],fe=y[T-1-32],ye=y[T+0-32],Se=y[T+1-32],ke=y[T+2-32];y[T+0+0]=y[T+2+32]=Q+fe+1>>1,y[T+0+32]=y[T+2+64]=q+Q+1>>1,y[T+0+64]=y[T+2+96]=de+q+1>>1,y[T+0+96]=pe+de+1>>1,y[T+3+0]=nr(ye,Se,ke),y[T+2+0]=nr(fe,ye,Se),y[T+1+0]=y[T+3+32]=nr(Q,fe,ye),y[T+1+32]=y[T+3+64]=nr(q,Q,fe),y[T+1+64]=y[T+3+96]=nr(de,q,Q),y[T+1+96]=nr(pe,de,q)}function nA(y,T){var Q;for(Q=0;8>Q;++Q)d(y,T+32*Q,y,T-32,8)}function mm(y,T){var Q;for(Q=0;8>Q;++Q)h(y,T,y[T-1],8),T+=32}function vl(y,T,Q){var q;for(q=0;8>q;++q)h(T,Q+32*q,y,8)}function Yg(y,T){var Q,q=8;for(Q=0;8>Q;++Q)q+=y[T+Q-32]+y[T-1+32*Q];vl(q>>4,y,T)}function yh(y,T){var Q,q=4;for(Q=0;8>Q;++Q)q+=y[T+Q-32];vl(q>>3,y,T)}function Oo(y,T){var Q,q=4;for(Q=0;8>Q;++Q)q+=y[T-1+32*Q];vl(q>>3,y,T)}function Na(y,T){vl(128,y,T)}function Lc(y,T,Q){var q=y[T-Q],de=y[T+0],pe=3*(de-q)+du[1020+y[T-2*Q]-y[T+Q]],fe=Au[112+(pe+4>>3)];y[T-Q]=ha[255+q+Au[112+(pe+3>>3)]],y[T+0]=ha[255+de-fe]}function Eh(y,T,Q,q){var de=y[T+0],pe=y[T+Q];return jo[255+y[T-2*Q]-y[T-Q]]>q||jo[255+pe-de]>q}function iu(y,T,Q,q){return 4*jo[255+y[T-Q]-y[T+0]]+jo[255+y[T-2*Q]-y[T+Q]]<=q}function Ch(y,T,Q,q,de){var pe=y[T-3*Q],fe=y[T-2*Q],ye=y[T-Q],Se=y[T+0],ke=y[T+Q],Ge=y[T+2*Q],At=y[T+3*Q];return 4*jo[255+ye-Se]+jo[255+fe-ke]>q?0:jo[255+y[T-4*Q]-pe]<=de&&jo[255+pe-fe]<=de&&jo[255+fe-ye]<=de&&jo[255+At-Ge]<=de&&jo[255+Ge-ke]<=de&&jo[255+ke-Se]<=de}function hi(y,T,Q,q){var de=2*q+1;for(q=0;16>q;++q)iu(y,T+q,Q,de)&&Lc(y,T+q,Q)}function Sh(y,T,Q,q){var de=2*q+1;for(q=0;16>q;++q)iu(y,T+q*Q,1,de)&&Lc(y,T+q*Q,1)}function fm(y,T,Q,q){var de;for(de=3;0<de;--de)hi(y,T+=4*Q,Q,q)}function gm(y,T,Q,q){var de;for(de=3;0<de;--de)Sh(y,T+=4,Q,q)}function ko(y,T,Q,q,de,pe,fe,ye){for(pe=2*pe+1;0<de--;){if(Ch(y,T,Q,pe,fe))if(Eh(y,T,Q,ye))Lc(y,T,Q);else{var Se=y,ke=T,Ge=Q,At=Se[ke-2*Ge],De=Se[ke-Ge],ze=Se[ke+0],st=Se[ke+Ge],wt=Se[ke+2*Ge],lt=27*(It=du[1020+3*(ze-De)+du[1020+At-st]])+63>>7,Ct=18*It+63>>7,It=9*It+63>>7;Se[ke-3*Ge]=ha[255+Se[ke-3*Ge]+It],Se[ke-2*Ge]=ha[255+At+Ct],Se[ke-Ge]=ha[255+De+lt],Se[ke+0]=ha[255+ze-lt],Se[ke+Ge]=ha[255+st-Ct],Se[ke+2*Ge]=ha[255+wt-It]}T+=q}}function jc(y,T,Q,q,de,pe,fe,ye){for(pe=2*pe+1;0<de--;){if(Ch(y,T,Q,pe,fe))if(Eh(y,T,Q,ye))Lc(y,T,Q);else{var Se=y,ke=T,Ge=Q,At=Se[ke-Ge],De=Se[ke+0],ze=Se[ke+Ge],st=Au[112+(4+(wt=3*(De-At))>>3)],wt=Au[112+(wt+3>>3)],lt=st+1>>1;Se[ke-2*Ge]=ha[255+Se[ke-2*Ge]+lt],Se[ke-Ge]=ha[255+At+wt],Se[ke+0]=ha[255+De-st],Se[ke+Ge]=ha[255+ze-lt]}T+=q}}function bm(y,T,Q,q,de,pe){ko(y,T,Q,1,16,q,de,pe)}function wl(y,T,Q,q,de,pe){ko(y,T,1,Q,16,q,de,pe)}function xm(y,T,Q,q,de,pe){var fe;for(fe=3;0<fe;--fe)jc(y,T+=4*Q,Q,1,16,q,de,pe)}function L(y,T,Q,q,de,pe){var fe;for(fe=3;0<fe;--fe)jc(y,T+=4,1,Q,16,q,de,pe)}function le(y,T,Q,q,de,pe,fe,ye){ko(y,T,de,1,8,pe,fe,ye),ko(Q,q,de,1,8,pe,fe,ye)}function Oe(y,T,Q,q,de,pe,fe,ye){ko(y,T,1,de,8,pe,fe,ye),ko(Q,q,1,de,8,pe,fe,ye)}function Me(y,T,Q,q,de,pe,fe,ye){jc(y,T+4*de,de,1,8,pe,fe,ye),jc(Q,q+4*de,de,1,8,pe,fe,ye)}function Ze(y,T,Q,q,de,pe,fe,ye){jc(y,T+4,1,de,8,pe,fe,ye),jc(Q,q+4,1,de,8,pe,fe,ye)}function yt(){this.ba=new Yt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ws,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Lt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function ys(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function ks(){this.ua=0,this.Wa=new Ke,this.vb=new Ke,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ce,this.yc=new te}function sr(){this.xb=this.a=0,this.l=new eu,this.ca=new Yt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new ve,this.Pb=0,this.wd=new ve,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new ks,this.ab=0,this.gc=g(4,ys),this.Oc=0}function hr(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new eu,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Gr(y,T,Q,q,de,pe,fe){for(y=y==null?0:y[T+0],T=0;T<fe;++T)de[pe+T]=y+Q[q+T]&255,y=de[pe+T]}function cn(y,T,Q,q,de,pe,fe){var ye;if(y==null)Gr(null,null,Q,q,de,pe,fe);else for(ye=0;ye<fe;++ye)de[pe+ye]=y[T+ye]+Q[q+ye]&255}function Ci(y,T,Q,q,de,pe,fe){if(y==null)Gr(null,null,Q,q,de,pe,fe);else{var ye,Se=y[T+0],ke=Se,Ge=Se;for(ye=0;ye<fe;++ye)ke=Ge+(Se=y[T+ye])-ke,Ge=Q[q+ye]+(-256&ke?0>ke?0:255:ke)&255,ke=Se,de[pe+ye]=Ge}}function Jr(y,T,Q,q){var de=T.width,pe=T.o;if(o(y!=null&&T!=null),0>Q||0>=q||Q+q>pe)return null;if(!y.Cc){if(y.ga==null){var fe;if(y.ga=new hr,(fe=y.ga==null)||(fe=T.width*T.o,o(y.Gb.length==0),y.Gb=p(fe),y.Uc=0,y.Gb==null?fe=0:(y.mb=y.Gb,y.nb=y.Uc,y.rc=null,fe=1),fe=!fe),!fe){fe=y.ga;var ye=y.Fa,Se=y.P,ke=y.qc,Ge=y.mb,At=y.nb,De=Se+1,ze=ke-1,st=fe.l;if(o(ye!=null&&Ge!=null&&T!=null),gd[0]=null,gd[1]=Gr,gd[2]=cn,gd[3]=Ci,fe.ca=Ge,fe.tb=At,fe.c=T.width,fe.i=T.height,o(0<fe.c&&0<fe.i),1>=ke)T=0;else if(fe.$a=3&ye[Se+0],fe.Z=ye[Se+0]>>2&3,fe.Lc=ye[Se+0]>>4&3,Se=ye[Se+0]>>6&3,0>fe.$a||1<fe.$a||4<=fe.Z||1<fe.Lc||Se)T=0;else if(st.put=Fs,st.ac=ti,st.bc=pn,st.ma=fe,st.width=T.width,st.height=T.height,st.Da=T.Da,st.v=T.v,st.va=T.va,st.j=T.j,st.o=T.o,fe.$a)e:{o(fe.$a==1),T=rc();t:for(;;){if(T==null){T=0;break e}if(o(fe!=null),fe.mc=T,T.c=fe.c,T.i=fe.i,T.l=fe.l,T.l.ma=fe,T.l.width=fe.c,T.l.height=fe.i,T.a=0,Ie(T.m,ye,De,ze),!Sa(fe.c,fe.i,1,T,null)||(T.ab==1&&T.gc[0].hc==3&&Xr(T.s)?(fe.ic=1,ye=T.c*T.i,T.Ta=null,T.Ua=0,T.V=p(ye),T.Ba=0,T.V==null?(T.a=1,T=0):T=1):(fe.ic=0,T=nc(T,fe.c)),!T))break t;T=1;break e}fe.mc=null,T=0}else T=ze>=fe.c*fe.i;fe=!T}if(fe)return null;y.ga.Lc!=1?y.Ga=0:q=pe-Q}o(y.ga!=null),o(Q+q<=pe);e:{if(T=(ye=y.ga).c,pe=ye.l.o,ye.$a==0){if(De=y.rc,ze=y.Vc,st=y.Fa,Se=y.P+1+Q*T,ke=y.mb,Ge=y.nb+Q*T,o(Se<=y.P+y.qc),ye.Z!=0)for(o(gd[ye.Z]!=null),fe=0;fe<q;++fe)gd[ye.Z](De,ze,st,Se,ke,Ge,T),De=ke,ze=Ge,Ge+=T,Se+=T;else for(fe=0;fe<q;++fe)d(ke,Ge,st,Se,T),De=ke,ze=Ge,Ge+=T,Se+=T;y.rc=De,y.Vc=ze}else{if(o(ye.mc!=null),T=Q+q,o((fe=ye.mc)!=null),o(T<=fe.i),fe.C>=T)T=1;else if(ye.ic||oc(),ye.ic){ye=fe.V,De=fe.Ba,ze=fe.c;var wt=fe.i,lt=(st=1,Se=fe.$/ze,ke=fe.$%ze,Ge=fe.m,At=fe.s,fe.$),Ct=ze*wt,It=ze*T,Gt=At.wc,Ut=lt<It?jr(At,ke,Se):null;o(lt<=Ct),o(T<=wt),o(Xr(At));t:for(;;){for(;!Ge.h&&lt<It;){if(ke&Gt||(Ut=jr(At,ke,Se)),o(Ut!=null),Ue(Ge),256>(wt=Js(Ut.G[0],Ut.H[0],Ge)))ye[De+lt]=wt,++lt,++ke>=ze&&(ke=0,++Se<=T&&!(Se%16)&&ea(fe,Se));else{if(!(280>wt)){st=0;break t}wt=vt(wt-256,Ge);var Bs,ws=Js(Ut.G[4],Ut.H[4],Ge);if(Ue(Ge),!(lt>=(ws=Jt(ze,ws=vt(ws,Ge)))&&Ct-lt>=wt)){st=0;break t}for(Bs=0;Bs<wt;++Bs)ye[De+lt+Bs]=ye[De+lt+Bs-ws];for(lt+=wt,ke+=wt;ke>=ze;)ke-=ze,++Se<=T&&!(Se%16)&&ea(fe,Se);lt<It&&ke&Gt&&(Ut=jr(At,ke,Se))}o(Ge.h==Te(Ge))}ea(fe,Se>T?T:Se);break t}!st||Ge.h&&lt<Ct?(st=0,fe.a=Ge.h?5:3):fe.$=lt,T=st}else T=Ka(fe,fe.V,fe.Ba,fe.c,fe.i,T,ic);if(!T){q=0;break e}}Q+q>=pe&&(y.Cc=1),q=1}if(!q)return null;if(y.Cc&&((q=y.ga)!=null&&(q.mc=null),y.ga=null,0<y.Ga))return alert("todo:WebPDequantizeLevels"),null}return y.nb+Q*de}function Si(y,T,Q,q,de,pe){for(;0<de--;){var fe,ye=y,Se=T+(Q?1:0),ke=y,Ge=T+(Q?0:3);for(fe=0;fe<q;++fe){var At=ke[Ge+4*fe];At!=255&&(At*=32897,ye[Se+4*fe+0]=ye[Se+4*fe+0]*At>>23,ye[Se+4*fe+1]=ye[Se+4*fe+1]*At>>23,ye[Se+4*fe+2]=ye[Se+4*fe+2]*At>>23)}T+=pe}}function Ni(y,T,Q,q,de){for(;0<q--;){var pe;for(pe=0;pe<Q;++pe){var fe=y[T+2*pe+0],ye=15&(ke=y[T+2*pe+1]),Se=4369*ye,ke=(240&ke|ke>>4)*Se>>16;y[T+2*pe+0]=(240&fe|fe>>4)*Se>>16&240|(15&fe|fe<<4)*Se>>16>>4&15,y[T+2*pe+1]=240&ke|ye}T+=de}}function Is(y,T,Q,q,de,pe,fe,ye){var Se,ke,Ge=255;for(ke=0;ke<de;++ke){for(Se=0;Se<q;++Se){var At=y[T+Se];pe[fe+4*Se]=At,Ge&=At}T+=Q,fe+=ye}return Ge!=255}function _l(y,T,Q,q,de){var pe;for(pe=0;pe<de;++pe)Q[q+pe]=y[T+pe]>>8}function oc(){cu=Si,Xg=Ni,yx=Is,Ex=_l}function yl(y,T,Q){V[y]=function(q,de,pe,fe,ye,Se,ke,Ge,At,De,ze,st,wt,lt,Ct,It,Gt){var Ut,Bs=Gt-1>>1,ws=ye[Se+0]|ke[Ge+0]<<16,cr=At[De+0]|ze[st+0]<<16;o(q!=null);var Es=3*ws+cr+131074>>2;for(T(q[de+0],255&Es,Es>>16,wt,lt),pe!=null&&(Es=3*cr+ws+131074>>2,T(pe[fe+0],255&Es,Es>>16,Ct,It)),Ut=1;Ut<=Bs;++Ut){var Or=ye[Se+Ut]|ke[Ge+Ut]<<16,mi=At[De+Ut]|ze[st+Ut]<<16,pr=ws+Or+cr+mi+524296,Cs=pr+2*(Or+cr)>>3;Es=Cs+ws>>1,ws=(pr=pr+2*(ws+mi)>>3)+Or>>1,T(q[de+2*Ut-1],255&Es,Es>>16,wt,lt+(2*Ut-1)*Q),T(q[de+2*Ut-0],255&ws,ws>>16,wt,lt+(2*Ut-0)*Q),pe!=null&&(Es=pr+cr>>1,ws=Cs+mi>>1,T(pe[fe+2*Ut-1],255&Es,Es>>16,Ct,It+(2*Ut-1)*Q),T(pe[fe+2*Ut+0],255&ws,ws>>16,Ct,It+(2*Ut+0)*Q)),ws=Or,cr=mi}1&Gt||(Es=3*ws+cr+131074>>2,T(q[de+Gt-1],255&Es,Es>>16,wt,lt+(Gt-1)*Q),pe!=null&&(Es=3*cr+ws+131074>>2,T(pe[fe+Gt-1],255&Es,Es>>16,Ct,It+(Gt-1)*Q)))}}function Nh(){Po[wm]=PE,Po[_m]=Lx,Po[Tx]=UE,Po[uu]=jx,Po[ym]=Px,Po[Em]=Ux,Po[za]=FE,Po[Jg]=Lx,Po[hA]=jx,Po[Cm]=Px,Po[$g]=Ux}function cd(y){return y&-16384?0>y?0:255:y>>ME}function ld(y,T){return cd((19077*y>>8)+(26149*T>>8)-14234)}function iA(y,T,Q){return cd((19077*y>>8)-(6419*T>>8)-(13320*Q>>8)+8708)}function aA(y,T){return cd((19077*y>>8)+(33050*T>>8)-17685)}function Pc(y,T,Q,q,de){q[de+0]=ld(y,Q),q[de+1]=iA(y,T,Q),q[de+2]=aA(y,T)}function ta(y,T,Q,q,de){q[de+0]=aA(y,T),q[de+1]=iA(y,T,Q),q[de+2]=ld(y,Q)}function oA(y,T,Q,q,de){var pe=iA(y,T,Q);T=pe<<3&224|aA(y,T)>>3,q[de+0]=248&ld(y,Q)|pe>>5,q[de+1]=T}function dd(y,T,Q,q,de){var pe=240&aA(y,T)|15;q[de+0]=240&ld(y,Q)|iA(y,T,Q)>>4,q[de+1]=pe}function Th(y,T,Q,q,de){q[de+0]=255,Pc(y,T,Q,q,de+1)}function Do(y,T,Q,q,de){ta(y,T,Q,q,de),q[de+3]=255}function Ta(y,T,Q,q,de){Pc(y,T,Q,q,de),q[de+3]=255}function El(y,T,Q){V[y]=function(q,de,pe,fe,ye,Se,ke,Ge,At){for(var De=Ge+(-2&At)*Q;Ge!=De;)T(q[de+0],pe[fe+0],ye[Se+0],ke,Ge),T(q[de+1],pe[fe+0],ye[Se+0],ke,Ge+Q),de+=2,++fe,++Se,Ge+=2*Q;1&At&&T(q[de+0],pe[fe+0],ye[Se+0],ke,Ge)}}function au(y,T,Q){return Q==0?y==0?T==0?6:5:T==0?4:0:Q}function Rh(y,T,Q,q,de){switch(y>>>30){case 3:uA(T,Q,q,de,0);break;case 2:Lo(T,Q,q,de);break;case 1:tn(T,Q,q,de)}}function Wa(y,T){var Q,q,de=T.M,pe=T.Nb,fe=y.oc,ye=y.pc+40,Se=y.oc,ke=y.pc+584,Ge=y.oc,At=y.pc+600;for(Q=0;16>Q;++Q)fe[ye+32*Q-1]=129;for(Q=0;8>Q;++Q)Se[ke+32*Q-1]=129,Ge[At+32*Q-1]=129;for(0<de?fe[ye-1-32]=Se[ke-1-32]=Ge[At-1-32]=129:(h(fe,ye-32-1,127,21),h(Se,ke-32-1,127,9),h(Ge,At-32-1,127,9)),q=0;q<y.za;++q){var De=T.ya[T.aa+q];if(0<q){for(Q=-1;16>Q;++Q)d(fe,ye+32*Q-4,fe,ye+32*Q+12,4);for(Q=-1;8>Q;++Q)d(Se,ke+32*Q-4,Se,ke+32*Q+4,4),d(Ge,At+32*Q-4,Ge,At+32*Q+4,4)}var ze=y.Gd,st=y.Hd+q,wt=De.ad,lt=De.Hc;if(0<de&&(d(fe,ye-32,ze[st].y,0,16),d(Se,ke-32,ze[st].f,0,8),d(Ge,At-32,ze[st].ea,0,8)),De.Za){var Ct=fe,It=ye-32+16;for(0<de&&(q>=y.za-1?h(Ct,It,ze[st].y[15],4):d(Ct,It,ze[st+1].y,0,4)),Q=0;4>Q;Q++)Ct[It+128+Q]=Ct[It+256+Q]=Ct[It+384+Q]=Ct[It+0+Q];for(Q=0;16>Q;++Q,lt<<=2)Ct=fe,It=ye+Qx[Q],dc[De.Ob[Q]](Ct,It),Rh(lt,wt,16*+Q,Ct,It)}else if(Ct=au(q,de,De.Ob[0]),Fc[Ct](fe,ye),lt!=0)for(Q=0;16>Q;++Q,lt<<=2)Rh(lt,wt,16*+Q,fe,ye+Qx[Q]);for(Q=De.Gc,Ct=au(q,de,De.Dd),Ac[Ct](Se,ke),Ac[Ct](Ge,At),lt=wt,Ct=Se,It=ke,255&(De=0|Q)&&(170&De?lc(lt,256,Ct,It):mn(lt,256,Ct,It)),De=Ge,lt=At,255&(Q>>=8)&&(170&Q?lc(wt,320,De,lt):mn(wt,320,De,lt)),de<y.Ub-1&&(d(ze[st].y,0,fe,ye+480,16),d(ze[st].f,0,Se,ke+224,8),d(ze[st].ea,0,Ge,At+224,8)),Q=8*pe*y.B,ze=y.sa,st=y.ta+16*q+16*pe*y.R,wt=y.qa,De=y.ra+8*q+Q,lt=y.Ha,Ct=y.Ia+8*q+Q,Q=0;16>Q;++Q)d(ze,st+Q*y.R,fe,ye+32*Q,16);for(Q=0;8>Q;++Q)d(wt,De+Q*y.B,Se,ke+32*Q,8),d(lt,Ct+Q*y.B,Ge,At+32*Q,8)}}function cA(y,T,Q,q,de,pe,fe,ye,Se){var ke=[0],Ge=[0],At=0,De=Se!=null?Se.kd:0,ze=Se??new Lt;if(y==null||12>Q)return 7;ze.data=y,ze.w=T,ze.ha=Q,T=[T],Q=[Q],ze.gb=[ze.gb];e:{var st=T,wt=Q,lt=ze.gb;if(o(y!=null),o(wt!=null),o(lt!=null),lt[0]=0,12<=wt[0]&&!c(y,st[0],"RIFF")){if(c(y,st[0]+8,"WEBP")){lt=3;break e}var Ct=kt(y,st[0]+4);if(12>Ct||4294967286<Ct){lt=3;break e}if(De&&Ct>wt[0]-8){lt=7;break e}lt[0]=Ct,st[0]+=12,wt[0]-=12}lt=0}if(lt!=0)return lt;for(Ct=0<ze.gb[0],Q=Q[0];;){e:{var It=y;wt=T,lt=Q;var Gt=ke,Ut=Ge,Bs=st=[0];if((Es=At=[At])[0]=0,8>lt[0])lt=7;else{if(!c(It,wt[0],"VP8X")){if(kt(It,wt[0]+4)!=10){lt=3;break e}if(18>lt[0]){lt=7;break e}var ws=kt(It,wt[0]+8),cr=1+it(It,wt[0]+12);if(2147483648<=cr*(It=1+it(It,wt[0]+15))){lt=3;break e}Bs!=null&&(Bs[0]=ws),Gt!=null&&(Gt[0]=cr),Ut!=null&&(Ut[0]=It),wt[0]+=18,lt[0]-=18,Es[0]=1}lt=0}}if(At=At[0],st=st[0],lt!=0)return lt;if(wt=!!(2&st),!Ct&&At)return 3;if(pe!=null&&(pe[0]=!!(16&st)),fe!=null&&(fe[0]=wt),ye!=null&&(ye[0]=0),fe=ke[0],st=Ge[0],At&&wt&&Se==null){lt=0;break}if(4>Q){lt=7;break}if(Ct&&At||!Ct&&!At&&!c(y,T[0],"ALPH")){Q=[Q],ze.na=[ze.na],ze.P=[ze.P],ze.Sa=[ze.Sa];e:{ws=y,lt=T,Ct=Q;var Es=ze.gb;Gt=ze.na,Ut=ze.P,Bs=ze.Sa,cr=22,o(ws!=null),o(Ct!=null),It=lt[0];var Or=Ct[0];for(o(Gt!=null),o(Bs!=null),Gt[0]=null,Ut[0]=null,Bs[0]=0;;){if(lt[0]=It,Ct[0]=Or,8>Or){lt=7;break e}var mi=kt(ws,It+4);if(4294967286<mi){lt=3;break e}var pr=8+mi+1&-2;if(cr+=pr,0<Es&&cr>Es){lt=3;break e}if(!c(ws,It,"VP8 ")||!c(ws,It,"VP8L")){lt=0;break e}if(Or[0]<pr){lt=7;break e}c(ws,It,"ALPH")||(Gt[0]=ws,Ut[0]=It+8,Bs[0]=mi),It+=pr,Or-=pr}}if(Q=Q[0],ze.na=ze.na[0],ze.P=ze.P[0],ze.Sa=ze.Sa[0],lt!=0)break}Q=[Q],ze.Ja=[ze.Ja],ze.xa=[ze.xa];e:if(Es=y,lt=T,Ct=Q,Gt=ze.gb[0],Ut=ze.Ja,Bs=ze.xa,ws=lt[0],It=!c(Es,ws,"VP8 "),cr=!c(Es,ws,"VP8L"),o(Es!=null),o(Ct!=null),o(Ut!=null),o(Bs!=null),8>Ct[0])lt=7;else{if(It||cr){if(Es=kt(Es,ws+4),12<=Gt&&Es>Gt-12){lt=3;break e}if(De&&Es>Ct[0]-8){lt=7;break e}Ut[0]=Es,lt[0]+=8,Ct[0]-=8,Bs[0]=cr}else Bs[0]=5<=Ct[0]&&Es[ws+0]==47&&!(Es[ws+4]>>5),Ut[0]=Ct[0];lt=0}if(Q=Q[0],ze.Ja=ze.Ja[0],ze.xa=ze.xa[0],T=T[0],lt!=0)break;if(4294967286<ze.Ja)return 3;if(ye==null||wt||(ye[0]=ze.xa?2:1),fe=[fe],st=[st],ze.xa){if(5>Q){lt=7;break}ye=fe,De=st,wt=pe,y==null||5>Q?y=0:5<=Q&&y[T+0]==47&&!(y[T+4]>>5)?(Ct=[0],Es=[0],Gt=[0],Ie(Ut=new ve,y,T,Q),Ao(Ut,Ct,Es,Gt)?(ye!=null&&(ye[0]=Ct[0]),De!=null&&(De[0]=Es[0]),wt!=null&&(wt[0]=Gt[0]),y=1):y=0):y=0}else{if(10>Q){lt=7;break}ye=st,y==null||10>Q||!tu(y,T+3,Q-3)?y=0:(De=y[T+0]|y[T+1]<<8|y[T+2]<<16,wt=16383&(y[T+7]<<8|y[T+6]),y=16383&(y[T+9]<<8|y[T+8]),1&De||3<(De>>1&7)||!(De>>4&1)||De>>5>=ze.Ja||!wt||!y?y=0:(fe&&(fe[0]=wt),ye&&(ye[0]=y),y=1))}if(!y||(fe=fe[0],st=st[0],At&&(ke[0]!=fe||Ge[0]!=st)))return 3;Se!=null&&(Se[0]=ze,Se.offset=T-Se.w,o(4294967286>T-Se.w),o(Se.offset==Se.ha-Q));break}return lt==0||lt==7&&At&&Se==null?(pe!=null&&(pe[0]|=ze.na!=null&&0<ze.na.length),q!=null&&(q[0]=fe),de!=null&&(de[0]=st),0):lt}function Ih(y,T,Q){var q=T.width,de=T.height,pe=0,fe=0,ye=q,Se=de;if(T.Da=y!=null&&0<y.Da,T.Da&&(ye=y.cd,Se=y.bd,pe=y.v,fe=y.j,11>Q||(pe&=-2,fe&=-2),0>pe||0>fe||0>=ye||0>=Se||pe+ye>q||fe+Se>de))return 0;if(T.v=pe,T.j=fe,T.va=pe+ye,T.o=fe+Se,T.U=ye,T.T=Se,T.da=y!=null&&0<y.da,T.da){if(!Je(ye,Se,Q=[y.ib],pe=[y.hb]))return 0;T.ib=Q[0],T.hb=pe[0]}return T.ob=y!=null&&y.ob,T.Kb=y==null||!y.Sd,T.da&&(T.ob=T.ib<3*q/4&&T.hb<3*de/4,T.Kb=0),1}function Oh(y){if(y==null)return 2;if(11>y.S){var T=y.f.RGBA;T.fb+=(y.height-1)*T.A,T.A=-T.A}else T=y.f.kb,y=y.height,T.O+=(y-1)*T.fa,T.fa=-T.fa,T.N+=(y-1>>1)*T.Ab,T.Ab=-T.Ab,T.W+=(y-1>>1)*T.Db,T.Db=-T.Db,T.F!=null&&(T.J+=(y-1)*T.lb,T.lb=-T.lb);return 0}function Ti(y,T,Q,q){if(q==null||0>=y||0>=T)return 2;if(Q!=null){if(Q.Da){var de=Q.cd,pe=Q.bd,fe=-2&Q.v,ye=-2&Q.j;if(0>fe||0>ye||0>=de||0>=pe||fe+de>y||ye+pe>T)return 2;y=de,T=pe}if(Q.da){if(!Je(y,T,de=[Q.ib],pe=[Q.hb]))return 2;y=de[0],T=pe[0]}}q.width=y,q.height=T;e:{var Se=q.width,ke=q.height;if(y=q.S,0>=Se||0>=ke||!(y>=wm&&13>y))y=2;else{if(0>=q.Rd&&q.sd==null){fe=pe=de=T=0;var Ge=(ye=Se*Hx[y])*ke;if(11>y||(pe=(ke+1)/2*(T=(Se+1)/2),y==12&&(fe=(de=Se)*ke)),(ke=p(Ge+2*pe+fe))==null){y=1;break e}q.sd=ke,11>y?((Se=q.f.RGBA).eb=ke,Se.fb=0,Se.A=ye,Se.size=Ge):((Se=q.f.kb).y=ke,Se.O=0,Se.fa=ye,Se.Fd=Ge,Se.f=ke,Se.N=0+Ge,Se.Ab=T,Se.Cd=pe,Se.ea=ke,Se.W=0+Ge+pe,Se.Db=T,Se.Ed=pe,y==12&&(Se.F=ke,Se.J=0+Ge+2*pe),Se.Tc=fe,Se.lb=de)}if(T=1,de=q.S,pe=q.width,fe=q.height,de>=wm&&13>de)if(11>de)y=q.f.RGBA,T&=(ye=Math.abs(y.A))*(fe-1)+pe<=y.size,T&=ye>=pe*Hx[de],T&=y.eb!=null;else{y=q.f.kb,ye=(pe+1)/2,Ge=(fe+1)/2,Se=Math.abs(y.fa),ke=Math.abs(y.Ab);var At=Math.abs(y.Db),De=Math.abs(y.lb),ze=De*(fe-1)+pe;T&=Se*(fe-1)+pe<=y.Fd,T&=ke*(Ge-1)+ye<=y.Cd,T=(T&=At*(Ge-1)+ye<=y.Ed)&Se>=pe&ke>=ye&At>=ye,T&=y.y!=null,T&=y.f!=null,T&=y.ea!=null,de==12&&(T&=De>=pe,T&=ze<=y.Tc,T&=y.F!=null)}else T=0;y=T?0:2}}return y!=0||Q!=null&&Q.fd&&(y=Oh(q)),y}var lA=64,ho=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],po=24,Ad=32,cc=8,ud=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Kt("Predictor0","PredictorAdd0"),V.Predictor0=function(){return 4278190080},V.Predictor1=function(y){return y},V.Predictor2=function(y,T,Q){return T[Q+0]},V.Predictor3=function(y,T,Q){return T[Q+1]},V.Predictor4=function(y,T,Q){return T[Q-1]},V.Predictor5=function(y,T,Q){return ss(ss(y,T[Q+1]),T[Q+0])},V.Predictor6=function(y,T,Q){return ss(y,T[Q-1])},V.Predictor7=function(y,T,Q){return ss(y,T[Q+0])},V.Predictor8=function(y,T,Q){return ss(T[Q-1],T[Q+0])},V.Predictor9=function(y,T,Q){return ss(T[Q+0],T[Q+1])},V.Predictor10=function(y,T,Q){return ss(ss(y,T[Q-1]),ss(T[Q+0],T[Q+1]))},V.Predictor11=function(y,T,Q){var q=T[Q+0];return 0>=qe(q>>24&255,y>>24&255,(T=T[Q-1])>>24&255)+qe(q>>16&255,y>>16&255,T>>16&255)+qe(q>>8&255,y>>8&255,T>>8&255)+qe(255&q,255&y,255&T)?q:y},V.Predictor12=function(y,T,Q){var q=T[Q+0];return(mt((y>>24&255)+(q>>24&255)-((T=T[Q-1])>>24&255))<<24|mt((y>>16&255)+(q>>16&255)-(T>>16&255))<<16|mt((y>>8&255)+(q>>8&255)-(T>>8&255))<<8|mt((255&y)+(255&q)-(255&T)))>>>0},V.Predictor13=function(y,T,Q){var q=T[Q-1];return(Ht((y=ss(y,T[Q+0]))>>24&255,q>>24&255)<<24|Ht(y>>16&255,q>>16&255)<<16|Ht(y>>8&255,q>>8&255)<<8|Ht(255&y,255&q))>>>0};var kh=V.PredictorAdd0;V.PredictorAdd1=ht,Kt("Predictor2","PredictorAdd2"),Kt("Predictor3","PredictorAdd3"),Kt("Predictor4","PredictorAdd4"),Kt("Predictor5","PredictorAdd5"),Kt("Predictor6","PredictorAdd6"),Kt("Predictor7","PredictorAdd7"),Kt("Predictor8","PredictorAdd8"),Kt("Predictor9","PredictorAdd9"),Kt("Predictor10","PredictorAdd10"),Kt("Predictor11","PredictorAdd11"),Kt("Predictor12","PredictorAdd12"),Kt("Predictor13","PredictorAdd13");var dA=V.PredictorAdd2;Qt("ColorIndexInverseTransform","MapARGB","32b",function(y){return y>>8&255},function(y){return y}),Qt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(y){return y},function(y){return y>>8&255});var Wn,vm=V.ColorIndexInverseTransform,Uc=V.MapARGB,mo=V.VP8LColorIndexInverseTransformAlpha,Dh=V.MapAlpha,Bh=V.VP8LPredictorsAdd=[];Bh.length=16,(V.VP8LPredictors=[]).length=16,(V.VP8LPredictorsAdd_C=[]).length=16,(V.VP8LPredictors_C=[]).length=16;var Lh,Bo,hd,pd,si,AA,md,uA,Lo,lc,tn,mn,pi,Ri,Cl,jh,fd,ou,bx,et,xx,vx,wx,_x,cu,Xg,yx,Ex,Cx=p(511),Ph=p(2041),lu=p(225),Sx=p(767),Nx=0,du=Ph,Au=lu,ha=Sx,jo=Cx,wm=0,_m=1,Tx=2,uu=3,ym=4,Em=5,za=6,Jg=7,hA=8,Cm=9,$g=10,TE=[2,3,7],Rx=[3,3,11],Ix=[280,256,256,256,40],RE=[0,1,1,1,0],IE=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zg=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],OE=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Ox=8,Sm=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],e0=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],hu=null,Nm=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],kE=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],kx=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],DE=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],BE=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],LE=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Dx=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Fc=[],dc=[],Ac=[],jE=1,Bx=2,gd=[],Po=[];yl("UpsampleRgbLinePair",Pc,3),yl("UpsampleBgrLinePair",ta,3),yl("UpsampleRgbaLinePair",Ta,4),yl("UpsampleBgraLinePair",Do,4),yl("UpsampleArgbLinePair",Th,4),yl("UpsampleRgba4444LinePair",dd,2),yl("UpsampleRgb565LinePair",oA,2);var PE=V.UpsampleRgbLinePair,UE=V.UpsampleBgrLinePair,Lx=V.UpsampleRgbaLinePair,jx=V.UpsampleBgraLinePair,Px=V.UpsampleArgbLinePair,Ux=V.UpsampleRgba4444LinePair,FE=V.UpsampleRgb565LinePair,pA=16,mA=1<<pA-1,fA=-227,t0=482,ME=6,Fx=0,Mx=p(256),Vx=p(256),s0=p(256),VE=p(256),QE=p(t0-fA),Uh=p(t0-fA);El("YuvToRgbRow",Pc,3),El("YuvToBgrRow",ta,3),El("YuvToRgbaRow",Ta,4),El("YuvToBgraRow",Do,4),El("YuvToArgbRow",Th,4),El("YuvToRgba4444Row",dd,2),El("YuvToRgb565Row",oA,2);var Qx=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Tm=[0,2,8],HE=[8,7,6,4,4,2,2,2,1,1,1,1],GE=1;this.WebPDecodeRGBA=function(y,T,Q,q,de){var pe=_m,fe=new yt,ye=new Yt;fe.ba=ye,ye.S=pe,ye.width=[ye.width],ye.height=[ye.height];var Se=ye.width,ke=ye.height,Ge=new us;if(Ge==null||y==null)var At=2;else o(Ge!=null),At=cA(y,T,Q,Ge.width,Ge.height,Ge.Pd,Ge.Qd,Ge.format,null);if(At!=0?Se=0:(Se!=null&&(Se[0]=Ge.width[0]),ke!=null&&(ke[0]=Ge.height[0]),Se=1),Se){ye.width=ye.width[0],ye.height=ye.height[0],q!=null&&(q[0]=ye.width),de!=null&&(de[0]=ye.height);e:{if(q=new eu,(de=new Lt).data=y,de.w=T,de.ha=Q,de.kd=1,T=[0],o(de!=null),((y=cA(de.data,de.w,de.ha,null,null,null,T,null,de))==0||y==7)&&T[0]&&(y=4),(T=y)==0){if(o(fe!=null),q.data=de.data,q.w=de.w+de.offset,q.ha=de.ha-de.offset,q.put=Fs,q.ac=ti,q.bc=pn,q.ma=fe,de.xa){if((y=rc())==null){fe=1;break e}if(function(De,ze){var st=[0],wt=[0],lt=[0];t:for(;;){if(De==null)return 0;if(ze==null)return De.a=2,0;if(De.l=ze,De.a=0,Ie(De.m,ze.data,ze.w,ze.ha),!Ao(De.m,st,wt,lt)){De.a=3;break t}if(De.xb=Bx,ze.width=st[0],ze.height=wt[0],!Sa(st[0],wt[0],1,De,null))break t;return 1}return o(De.a!=0),0}(y,q)){if(q=(T=Ti(q.width,q.height,fe.Oa,fe.ba))==0){t:{q=y;s:for(;;){if(q==null){q=0;break t}if(o(q.s.yc!=null),o(q.s.Ya!=null),o(0<q.s.Wb),o((Q=q.l)!=null),o((de=Q.ma)!=null),q.xb!=0){if(q.ca=de.ba,q.tb=de.tb,o(q.ca!=null),!Ih(de.Oa,Q,uu)){q.a=2;break s}if(!nc(q,Q.width)||Q.da)break s;if((Q.da||dt(q.ca.S))&&oc(),11>q.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),q.ca.f.kb.F!=null&&oc()),q.Pb&&0<q.s.ua&&q.s.vb.X==null&&!_e(q.s.vb,q.s.Wa.Xa)){q.a=1;break s}q.xb=0}if(!Ka(q,q.V,q.Ba,q.c,q.i,Q.o,On))break s;de.Dc=q.Ma,q=1;break t}o(q.a!=0),q=0}q=!q}q&&(T=y.a)}else T=y.a}else{if((y=new Fg)==null){fe=1;break e}if(y.Fa=de.na,y.P=de.P,y.qc=de.Sa,Dc(y,q)){if((T=Ti(q.width,q.height,fe.Oa,fe.ba))==0){if(y.Aa=0,Q=fe.Oa,o((de=y)!=null),Q!=null){if(0<(Se=0>(Se=Q.Md)?0:100<Se?255:255*Se/100)){for(ke=Ge=0;4>ke;++ke)12>(At=de.pb[ke]).lc&&(At.ia=Se*HE[0>At.lc?0:At.lc]>>3),Ge|=At.ia;Ge&&(alert("todo:VP8InitRandom"),de.ia=1)}de.Ga=Q.Id,100<de.Ga?de.Ga=100:0>de.Ga&&(de.Ga=0)}(function(De,ze){if(De==null)return 0;if(ze==null)return kn(De,2,"NULL VP8Io parameter in VP8Decode().");if(!De.cb&&!Dc(De,ze))return 0;if(o(De.cb),ze.ac==null||ze.ac(ze)){ze.ob&&(De.L=0);var st=Tm[De.L];if(De.L==2?(De.yb=0,De.zb=0):(De.yb=ze.v-st>>4,De.zb=ze.j-st>>4,0>De.yb&&(De.yb=0),0>De.zb&&(De.zb=0)),De.Va=ze.o+15+st>>4,De.Hb=ze.va+15+st>>4,De.Hb>De.za&&(De.Hb=De.za),De.Va>De.Ub&&(De.Va=De.Ub),0<De.L){var wt=De.ed;for(st=0;4>st;++st){var lt;if(De.Qa.Cb){var Ct=De.Qa.Lb[st];De.Qa.Fb||(Ct+=wt.Tb)}else Ct=wt.Tb;for(lt=0;1>=lt;++lt){var It=De.gd[st][lt],Gt=Ct;if(wt.Pc&&(Gt+=wt.vd[0],lt&&(Gt+=wt.od[0])),0<(Gt=0>Gt?0:63<Gt?63:Gt)){var Ut=Gt;0<wt.wb&&(Ut=4<wt.wb?Ut>>2:Ut>>1)>9-wt.wb&&(Ut=9-wt.wb),1>Ut&&(Ut=1),It.dd=Ut,It.tc=2*Gt+Ut,It.ld=40<=Gt?2:15<=Gt?1:0}else It.tc=0;It.La=lt}}}st=0}else kn(De,6,"Frame setup failed"),st=De.a;if(st=st==0){if(st){De.$c=0,0<De.Aa||(De.Ic=GE);t:{st=De.Ic,wt=4*(Ut=De.za);var Bs=32*Ut,ws=Ut+1,cr=0<De.L?Ut*(0<De.Aa?2:1):0,Es=(De.Aa==2?2:1)*Ut;if((It=wt+832+(lt=3*(16*st+Tm[De.L])/2*Bs)+(Ct=De.Fa!=null&&0<De.Fa.length?De.Kc.c*De.Kc.i:0))!=It)st=0;else{if(It>De.Vb){if(De.Vb=0,De.Ec=p(It),De.Fc=0,De.Ec==null){st=kn(De,1,"no memory during frame initialization.");break t}De.Vb=It}It=De.Ec,Gt=De.Fc,De.Ac=It,De.Bc=Gt,Gt+=wt,De.Gd=g(Bs,lm),De.Hd=0,De.rb=g(ws+1,gh),De.sb=1,De.wa=cr?g(cr,Io):null,De.Y=0,De.D.Nb=0,De.D.wa=De.wa,De.D.Y=De.Y,0<De.Aa&&(De.D.Y+=Ut),o(!0),De.oc=It,De.pc=Gt,Gt+=832,De.ya=g(Es,bh),De.aa=0,De.D.ya=De.ya,De.D.aa=De.aa,De.Aa==2&&(De.D.aa+=Ut),De.R=16*Ut,De.B=8*Ut,Ut=(Bs=Tm[De.L])*De.R,Bs=Bs/2*De.B,De.sa=It,De.ta=Gt+Ut,De.qa=De.sa,De.ra=De.ta+16*st*De.R+Bs,De.Ha=De.qa,De.Ia=De.ra+8*st*De.B+Bs,De.$c=0,Gt+=lt,De.mb=Ct?It:null,De.nb=Ct?Gt:null,o(Gt+Ct<=De.Fc+De.Vb),dm(De),h(De.Ac,De.Bc,0,wt),st=1}}if(st){if(ze.ka=0,ze.y=De.sa,ze.O=De.ta,ze.f=De.qa,ze.N=De.ra,ze.ea=De.Ha,ze.Vd=De.Ia,ze.fa=De.R,ze.Rc=De.B,ze.F=null,ze.J=0,!Nx){for(st=-255;255>=st;++st)Cx[255+st]=0>st?-st:st;for(st=-1020;1020>=st;++st)Ph[1020+st]=-128>st?-128:127<st?127:st;for(st=-112;112>=st;++st)lu[112+st]=-16>st?-16:15<st?15:st;for(st=-255;510>=st;++st)Sx[255+st]=0>st?0:255<st?255:st;Nx=1}md=tA,uA=Vg,lc=Bc,tn=um,mn=su,Lo=Mg,pi=bm,Ri=wl,Cl=le,jh=Oe,fd=xm,ou=L,bx=Me,et=Ze,xx=hi,vx=Sh,wx=fm,_x=gm,dc[0]=zg,dc[1]=Qg,dc[2]=Wg,dc[3]=pm,dc[4]=bl,dc[5]=rA,dc[6]=xl,dc[7]=qg,dc[8]=_h,dc[9]=nu,Fc[0]=Gg,Fc[1]=Hg,Fc[2]=ru,Fc[3]=hm,Fc[4]=sA,Fc[5]=wh,Fc[6]=Kg,Ac[0]=Yg,Ac[1]=vh,Ac[2]=nA,Ac[3]=mm,Ac[4]=Oo,Ac[5]=yh,Ac[6]=Na,st=1}else st=0}st&&(st=function(Or,mi){for(Or.M=0;Or.M<Or.Va;++Or.M){var pr,Cs=Or.Jc[Or.M&Or.Xb],ts=Or.m,Dn=Or;for(pr=0;pr<Dn.za;++pr){var lr=ts,Mr=Dn,yn=Mr.Ac,sa=Mr.Bc+4*pr,Ra=Mr.zc,zn=Mr.ya[Mr.aa+pr];if(Mr.Qa.Bb?zn.$b=ut(lr,Mr.Pa.jb[0])?2+ut(lr,Mr.Pa.jb[2]):ut(lr,Mr.Pa.jb[1]):zn.$b=0,Mr.kc&&(zn.Ad=ut(lr,Mr.Bd)),zn.Za=!ut(lr,145)+0,zn.Za){var pa=zn.Ob,Ia=0;for(Mr=0;4>Mr;++Mr){var Pi,Kr=Ra[0+Mr];for(Pi=0;4>Pi;++Pi){Kr=BE[yn[sa+Pi]][Kr];for(var an=kx[ut(lr,Kr[0])];0<an;)an=kx[2*an+ut(lr,Kr[an])];Kr=-an,yn[sa+Pi]=Kr}d(pa,Ia,yn,sa,4),Ia+=4,Ra[0+Mr]=Kr}}else Kr=ut(lr,156)?ut(lr,128)?1:3:ut(lr,163)?2:0,zn.Ob[0]=Kr,h(yn,sa,Kr,4),h(Ra,0,Kr,4);zn.Dd=ut(lr,142)?ut(lr,114)?ut(lr,183)?1:3:2:0}if(Dn.m.Ka)return kn(Or,7,"Premature end-of-partition0 encountered.");for(;Or.ja<Or.za;++Or.ja){if(Dn=Cs,lr=(ts=Or).rb[ts.sb-1],yn=ts.rb[ts.sb+ts.ja],pr=ts.ya[ts.aa+ts.ja],sa=ts.kc?pr.Ad:0)lr.la=yn.la=0,pr.Za||(lr.Na=yn.Na=0),pr.Hc=0,pr.Gc=0,pr.ia=0;else{var ri,sn;if(lr=yn,yn=Dn,sa=ts.Pa.Xc,Ra=ts.ya[ts.aa+ts.ja],zn=ts.pb[Ra.$b],Mr=Ra.ad,pa=0,Ia=ts.rb[ts.sb-1],Kr=Pi=0,h(Mr,pa,0,384),Ra.Za)var ni=0,uc=sa[3];else{an=p(16);var fi=lr.Na+Ia.Na;if(fi=hu(yn,sa[1],fi,zn.Eb,0,an,0),lr.Na=Ia.Na=(0<fi)+0,1<fi)md(an,0,Mr,pa);else{var qa=an[0]+3>>3;for(an=0;256>an;an+=16)Mr[pa+an]=qa}ni=1,uc=sa[0]}var ln=15&lr.la,Ui=15&Ia.la;for(an=0;4>an;++an){var Ya=1&Ui;for(qa=sn=0;4>qa;++qa)ln=ln>>1|(Ya=(fi=hu(yn,uc,fi=Ya+(1&ln),zn.Sc,ni,Mr,pa))>ni)<<7,sn=sn<<2|(3<fi?3:1<fi?2:Mr[pa+0]!=0),pa+=16;ln>>=4,Ui=Ui>>1|Ya<<7,Pi=(Pi<<8|sn)>>>0}for(uc=ln,ni=Ui>>4,ri=0;4>ri;ri+=2){for(sn=0,ln=lr.la>>4+ri,Ui=Ia.la>>4+ri,an=0;2>an;++an){for(Ya=1&Ui,qa=0;2>qa;++qa)fi=Ya+(1&ln),ln=ln>>1|(Ya=0<(fi=hu(yn,sa[2],fi,zn.Qc,0,Mr,pa)))<<3,sn=sn<<2|(3<fi?3:1<fi?2:Mr[pa+0]!=0),pa+=16;ln>>=2,Ui=Ui>>1|Ya<<5}Kr|=sn<<4*ri,uc|=ln<<4<<ri,ni|=(240&Ui)<<ri}lr.la=uc,Ia.la=ni,Ra.Hc=Pi,Ra.Gc=Kr,Ra.ia=43690&Kr?0:zn.ia,sa=!(Pi|Kr)}if(0<ts.L&&(ts.wa[ts.Y+ts.ja]=ts.gd[pr.$b][pr.Za],ts.wa[ts.Y+ts.ja].La|=!sa),Dn.Ka)return kn(Or,7,"Premature end-of-file encountered.")}if(dm(Or),ts=mi,Dn=1,pr=(Cs=Or).D,lr=0<Cs.L&&Cs.M>=Cs.zb&&Cs.M<=Cs.Va,Cs.Aa==0)t:{if(pr.M=Cs.M,pr.uc=lr,Wa(Cs,pr),Dn=1,pr=(sn=Cs.D).Nb,lr=(Kr=Tm[Cs.L])*Cs.R,yn=Kr/2*Cs.B,an=16*pr*Cs.R,qa=8*pr*Cs.B,sa=Cs.sa,Ra=Cs.ta-lr+an,zn=Cs.qa,Mr=Cs.ra-yn+qa,pa=Cs.Ha,Ia=Cs.Ia-yn+qa,Ui=(ln=sn.M)==0,Pi=ln>=Cs.Va-1,Cs.Aa==2&&Wa(Cs,sn),sn.uc)for(Ya=(fi=Cs).D.M,o(fi.D.uc),sn=fi.yb;sn<fi.Hb;++sn){ni=sn,uc=Ya;var Oa=(fo=(Fi=fi).D).Nb;ri=Fi.R;var fo=fo.wa[fo.Y+ni],go=Fi.sa,ra=Fi.ta+16*Oa*ri+16*ni,bo=fo.dd,En=fo.tc;if(En!=0)if(o(3<=En),Fi.L==1)0<ni&&vx(go,ra,ri,En+4),fo.La&&_x(go,ra,ri,En),0<uc&&xx(go,ra,ri,En+4),fo.La&&wx(go,ra,ri,En);else{var xo=Fi.B,hc=Fi.qa,gA=Fi.ra+8*Oa*xo+8*ni,Sl=Fi.Ha,Fi=Fi.Ia+8*Oa*xo+8*ni;Oa=fo.ld,0<ni&&(Ri(go,ra,ri,En+4,bo,Oa),jh(hc,gA,Sl,Fi,xo,En+4,bo,Oa)),fo.La&&(ou(go,ra,ri,En,bo,Oa),et(hc,gA,Sl,Fi,xo,En,bo,Oa)),0<uc&&(pi(go,ra,ri,En+4,bo,Oa),Cl(hc,gA,Sl,Fi,xo,En+4,bo,Oa)),fo.La&&(fd(go,ra,ri,En,bo,Oa),bx(hc,gA,Sl,Fi,xo,En,bo,Oa))}}if(Cs.ia&&alert("todo:DitherRow"),ts.put!=null){if(sn=16*ln,ln=16*(ln+1),Ui?(ts.y=Cs.sa,ts.O=Cs.ta+an,ts.f=Cs.qa,ts.N=Cs.ra+qa,ts.ea=Cs.Ha,ts.W=Cs.Ia+qa):(sn-=Kr,ts.y=sa,ts.O=Ra,ts.f=zn,ts.N=Mr,ts.ea=pa,ts.W=Ia),Pi||(ln-=Kr),ln>ts.o&&(ln=ts.o),ts.F=null,ts.J=null,Cs.Fa!=null&&0<Cs.Fa.length&&sn<ln&&(ts.J=Jr(Cs,ts,sn,ln-sn),ts.F=Cs.mb,ts.F==null&&ts.F.length==0)){Dn=kn(Cs,3,"Could not decode alpha data.");break t}sn<ts.j&&(Kr=ts.j-sn,sn=ts.j,o(!(1&Kr)),ts.O+=Cs.R*Kr,ts.N+=Cs.B*(Kr>>1),ts.W+=Cs.B*(Kr>>1),ts.F!=null&&(ts.J+=ts.width*Kr)),sn<ln&&(ts.O+=ts.v,ts.N+=ts.v>>1,ts.W+=ts.v>>1,ts.F!=null&&(ts.J+=ts.v),ts.ka=sn-ts.j,ts.U=ts.va-ts.v,ts.T=ln-sn,Dn=ts.put(ts))}pr+1!=Cs.Ic||Pi||(d(Cs.sa,Cs.ta-lr,sa,Ra+16*Cs.R,lr),d(Cs.qa,Cs.ra-yn,zn,Mr+8*Cs.B,yn),d(Cs.Ha,Cs.Ia-yn,pa,Ia+8*Cs.B,yn))}if(!Dn)return kn(Or,6,"Output aborted.")}return 1}(De,ze)),ze.bc!=null&&ze.bc(ze),st&=1}return st?(De.cb=0,st):0})(y,q)||(T=y.a)}}else T=y.a}T==0&&fe.Oa!=null&&fe.Oa.fd&&(T=Oh(fe.ba))}fe=T}pe=fe!=0?null:11>pe?ye.f.RGBA.eb:ye.f.kb.y}else pe=null;return pe};var Hx=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function E(V,ce){for(var Y="",z=0;z<4;z++)Y+=String.fromCharCode(V[ce++]);return Y}function C(V,ce){return V[ce+0]|V[ce+1]<<8}function I(V,ce){return(V[ce+0]|V[ce+1]<<8|V[ce+2]<<16)>>>0}function O(V,ce){return(V[ce+0]|V[ce+1]<<8|V[ce+2]<<16|V[ce+3]<<24)>>>0}new v;var R=[0],k=[0],M=[],P=new v,H=a,$=function(V,ce){var Y={},z=0,te=!1,se=0,Ce=0;if(Y.frames=[],!function(ne,ve){for(var ue=0;ue<4;ue++)if(ne[ve+ue]!="RIFF".charCodeAt(ue))return!0;return!1}(V,ce)){for(O(V,ce+=4),ce+=8;ce<V.length;){var he=E(V,ce),Ne=O(V,ce+=4);ce+=4;var Z=Ne+(1&Ne);switch(he){case"VP8 ":case"VP8L":Y.frames[z]===void 0&&(Y.frames[z]={}),(Pe=Y.frames[z]).src_off=te?Ce:ce-8,Pe.src_size=se+Ne+8,z++,te&&(te=!1,se=0,Ce=0);break;case"VP8X":(Pe=Y.header={}).feature_flags=V[ce];var Ie=ce+4;Pe.canvas_width=1+I(V,Ie),Ie+=3,Pe.canvas_height=1+I(V,Ie),Ie+=3;break;case"ALPH":te=!0,se=Z+8,Ce=ce-8;break;case"ANIM":(Pe=Y.header).bgcolor=O(V,ce),Ie=ce+4,Pe.loop_count=C(V,Ie),Ie+=2;break;case"ANMF":var Ve,Pe;(Pe=Y.frames[z]={}).offset_x=2*I(V,ce),ce+=3,Pe.offset_y=2*I(V,ce),ce+=3,Pe.width=1+I(V,ce),ce+=3,Pe.height=1+I(V,ce),ce+=3,Pe.duration=I(V,ce),ce+=3,Ve=V[ce++],Pe.dispose=1&Ve,Pe.blend=Ve>>1&1}he!="ANMF"&&(ce+=Z)}return Y}}(H,0);$.response=H,$.rgbaoutput=!0,$.dataurl=!1;var re=$.header?$.header:null,J=$.frames?$.frames:null;if(re){re.loop_counter=re.loop_count,R=[re.canvas_height],k=[re.canvas_width];for(var ge=0;ge<J.length&&J[ge].blend!=0;ge++);}var ie=J[0],we=P.WebPDecodeRGBA(H,ie.src_off,ie.src_size,k,R);ie.rgba=we,ie.imgwidth=k[0],ie.imgheight=R[0];for(var Ae=0;Ae<k[0]*R[0]*4;Ae++)M[Ae]=we[Ae];return this.width=k,this.height=R,this.data=M,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function zge(){var a,o=this.internal.__metadata__.metadata,c=unescape(encodeURIComponent(o));a=this.internal.__metadata__.rawXml?c:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+a.length+" >>"),this.internal.write("stream"),this.internal.write(a),this.internal.write("endstream"),this.internal.write("endobj")}function qge(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(a){var o,c,d,h,p,g,x,v,E,C=function(ne){return ne=ne||{},this.isStrokeTransparent=ne.isStrokeTransparent||!1,this.strokeOpacity=ne.strokeOpacity||1,this.strokeStyle=ne.strokeStyle||"#000000",this.fillStyle=ne.fillStyle||"#000000",this.isFillTransparent=ne.isFillTransparent||!1,this.fillOpacity=ne.fillOpacity||1,this.font=ne.font||"10px sans-serif",this.textBaseline=ne.textBaseline||"alphabetic",this.textAlign=ne.textAlign||"left",this.lineWidth=ne.lineWidth||1,this.lineJoin=ne.lineJoin||"miter",this.lineCap=ne.lineCap||"butt",this.path=ne.path||[],this.transform=ne.transform!==void 0?ne.transform.clone():new v,this.globalCompositeOperation=ne.globalCompositeOperation||"normal",this.globalAlpha=ne.globalAlpha||1,this.clip_path=ne.clip_path||[],this.currentPoint=ne.currentPoint||new g,this.miterLimit=ne.miterLimit||10,this.lastPoint=ne.lastPoint||new g,this.lineDashOffset=ne.lineDashOffset||0,this.lineDash=ne.lineDash||[],this.margin=ne.margin||[0,0,0,0],this.prevPageLastElemOffset=ne.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ne.ignoreClearRect!="boolean"||ne.ignoreClearRect,this};a.events.push(["initialized",function(){this.context2d=new I(this),o=this.internal.f2,c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString,h=this.internal.getHorizontalCoordinate,p=this.internal.getVerticalCoordinate,g=this.internal.Point,x=this.internal.Rectangle,v=this.internal.Matrix,E=new C}]);var I=function(ne){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var ve=ne;Object.defineProperty(this,"pdf",{get:function(){return ve}});var ue=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return ue},set:function(_e){ue=!!_e}});var Te=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Te},set:function(_e){Te=!!_e}});var Be=0;Object.defineProperty(this,"posX",{get:function(){return Be},set:function(_e){isNaN(_e)||(Be=_e)}});var Ue=0;Object.defineProperty(this,"posY",{get:function(){return Ue},set:function(_e){isNaN(_e)||(Ue=_e)}}),Object.defineProperty(this,"margin",{get:function(){return E.margin},set:function(_e){var xt;typeof _e=="number"?xt=[_e,_e,_e,_e]:((xt=new Array(4))[0]=_e[0],xt[1]=_e.length>=2?_e[1]:xt[0],xt[2]=_e.length>=3?_e[2]:xt[0],xt[3]=_e.length>=4?_e[3]:xt[1]),E.margin=xt}});var tt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return tt},set:function(_e){tt=_e}});var ot=0;Object.defineProperty(this,"lastBreak",{get:function(){return ot},set:function(_e){ot=_e}});var ut=[];Object.defineProperty(this,"pageBreaks",{get:function(){return ut},set:function(_e){ut=_e}}),Object.defineProperty(this,"ctx",{get:function(){return E},set:function(_e){_e instanceof C&&(E=_e)}}),Object.defineProperty(this,"path",{get:function(){return E.path},set:function(_e){E.path=_e}});var Tt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Tt},set:function(_e){Tt=_e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(_e){var xt;xt=O(_e),this.ctx.fillStyle=xt.style,this.ctx.isFillTransparent=xt.a===0,this.ctx.fillOpacity=xt.a,this.pdf.setFillColor(xt.r,xt.g,xt.b,{a:xt.a}),this.pdf.setTextColor(xt.r,xt.g,xt.b,{a:xt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(_e){var xt=O(_e);this.ctx.strokeStyle=xt.style,this.ctx.isStrokeTransparent=xt.a===0,this.ctx.strokeOpacity=xt.a,xt.a===0?this.pdf.setDrawColor(255,255,255):(xt.a,this.pdf.setDrawColor(xt.r,xt.g,xt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(_e){["butt","round","square"].indexOf(_e)!==-1&&(this.ctx.lineCap=_e,this.pdf.setLineCap(_e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(_e){isNaN(_e)||(this.ctx.lineWidth=_e,this.pdf.setLineWidth(_e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(_e){["bevel","round","miter"].indexOf(_e)!==-1&&(this.ctx.lineJoin=_e,this.pdf.setLineJoin(_e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(_e){isNaN(_e)||(this.ctx.miterLimit=_e,this.pdf.setMiterLimit(_e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(_e){this.ctx.textBaseline=_e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(_e){["right","end","center","left","start"].indexOf(_e)!==-1&&(this.ctx.textAlign=_e)}});var Qe=null,it=null,kt=null;Object.defineProperty(this,"fontFaces",{get:function(){return kt},set:function(_e){Qe=null,it=null,kt=_e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(_e){var xt;if(this.ctx.font=_e,(xt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(_e))!==null){var Ke=xt[1];xt[2];var Je=xt[3],$e=xt[4];xt[5];var jt=xt[6],Kt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec($e)[2];$e=Math.floor(Kt==="px"?parseFloat($e)*this.pdf.internal.scaleFactor:Kt==="em"?parseFloat($e)*this.pdf.getFontSize():parseFloat($e)*this.pdf.internal.scaleFactor),this.pdf.setFontSize($e);var os=function(Qt){var Us,bs,cs=[],Ds=Qt.trim();if(Ds==="")return MT;if(Ds in DV)return[DV[Ds]];for(;Ds!=="";){switch(bs=null,Us=(Ds=LV(Ds)).charAt(0)){case'"':case"'":bs=Vge(Ds.substring(1),Us);break;default:bs=Qge(Ds)}if(bs===null||(cs.push(bs[0]),(Ds=LV(bs[1]))!==""&&Ds.charAt(0)!==","))return MT;Ds=Ds.replace(/^,/,"")}return cs}(jt);if(this.fontFaces){var ss=function(Qt,Us){var bs=Qt.getFontList(),cs=JSON.stringify(bs);if(Qe===null||it!==cs){var Ds=function(zs){var rs=[];return Object.keys(zs).forEach(function(Gs){zs[Gs].forEach(function(dt){var Pt=null;switch(dt){case"bold":Pt={family:Gs,weight:"bold"};break;case"italic":Pt={family:Gs,style:"italic"};break;case"bolditalic":Pt={family:Gs,weight:"bold",style:"italic"};break;case"":case"normal":Pt={family:Gs}}Pt!==null&&(Pt.ref={name:Gs,style:dt},rs.push(Pt))})}),rs}(bs);Qe=function(zs){for(var rs={},Gs=0;Gs<zs.length;++Gs){var dt=FT(zs[Gs]),Pt=dt.family,qt=dt.stretch,Yt=dt.style,us=dt.weight;rs[Pt]=rs[Pt]||{},rs[Pt][qt]=rs[Pt][qt]||{},rs[Pt][qt][Yt]=rs[Pt][qt][Yt]||{},rs[Pt][qt][Yt][us]=dt}return rs}(Ds.concat(Us)),it=cs}return Qe}(this.pdf,this.fontFaces),mt=os.map(function(Qt){return{family:Qt,stretch:"normal",weight:Je,style:Ke}}),Ht=function(Qt,Us,bs){for(var cs=(bs=bs||{}).defaultFontFamily||"times",Ds=Object.assign({},Mge,bs.genericFontFamilies||{}),zs=null,rs=null,Gs=0;Gs<Us.length;++Gs)if(Ds[(zs=FT(Us[Gs])).family]&&(zs.family=Ds[zs.family]),Qt.hasOwnProperty(zs.family)){rs=Qt[zs.family];break}if(!(rs=rs||Qt[cs]))throw new Error("Could not find a font-family for the rule '"+BV(zs)+"' and default family '"+cs+"'.");if(rs=function(dt,Pt){if(Pt[dt])return Pt[dt];var qt=WR[dt],Yt=qt<=WR.normal?-1:1,us=kV(Pt,gG,qt,Yt);if(!us)throw new Error("Could not find a matching font-stretch value for "+dt);return us}(zs.stretch,rs),rs=function(dt,Pt){if(Pt[dt])return Pt[dt];for(var qt=fG[dt],Yt=0;Yt<qt.length;++Yt)if(Pt[qt[Yt]])return Pt[qt[Yt]];throw new Error("Could not find a matching font-style for "+dt)}(zs.style,rs),!(rs=function(dt,Pt){if(Pt[dt])return Pt[dt];if(dt===400&&Pt[500])return Pt[500];if(dt===500&&Pt[400])return Pt[400];var qt=Fge[dt],Yt=kV(Pt,bG,qt,dt<400?-1:1);if(!Yt)throw new Error("Could not find a matching font-weight for value "+dt);return Yt}(zs.weight,rs)))throw new Error("Failed to resolve a font for the rule '"+BV(zs)+"'.");return rs}(ss,mt);this.pdf.setFont(Ht.ref.name,Ht.ref.style)}else{var qe="";(Je==="bold"||parseInt(Je,10)>=700||Ke==="bold")&&(qe="bold"),Ke==="italic"&&(qe+="italic"),qe.length===0&&(qe="normal");for(var ht="",Xt={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},zt=0;zt<os.length;zt++){if(this.pdf.internal.getFont(os[zt],qe,{noFallback:!0,disableWarning:!0})!==void 0){ht=os[zt];break}if(qe==="bolditalic"&&this.pdf.internal.getFont(os[zt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ht=os[zt],qe="bold";else if(this.pdf.internal.getFont(os[zt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ht=os[zt],qe="normal";break}}if(ht===""){for(var ds=0;ds<os.length;ds++)if(Xt[os[ds]]){ht=Xt[os[ds]];break}}ht=ht===""?"Times":ht,this.pdf.setFont(ht,qe)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(_e){this.ctx.globalCompositeOperation=_e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(_e){this.ctx.globalAlpha=_e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(_e){this.ctx.lineDashOffset=_e,Pe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(_e){this.ctx.lineDash=_e,Pe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(_e){this.ctx.ignoreClearRect=!!_e}})};I.prototype.setLineDash=function(ne){this.lineDash=ne},I.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},I.prototype.fill=function(){J.call(this,"fill",!1)},I.prototype.stroke=function(){J.call(this,"stroke",!1)},I.prototype.beginPath=function(){this.path=[{type:"begin"}]},I.prototype.moveTo=function(ne,ve){if(isNaN(ne)||isNaN(ve))throw Mn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var ue=this.ctx.transform.applyToPoint(new g(ne,ve));this.path.push({type:"mt",x:ue.x,y:ue.y}),this.ctx.lastPoint=new g(ne,ve)},I.prototype.closePath=function(){var ne=new g(0,0),ve=0;for(ve=this.path.length-1;ve!==-1;ve--)if(this.path[ve].type==="begin"&&_n(this.path[ve+1])==="object"&&typeof this.path[ve+1].x=="number"){ne=new g(this.path[ve+1].x,this.path[ve+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new g(ne.x,ne.y)},I.prototype.lineTo=function(ne,ve){if(isNaN(ne)||isNaN(ve))throw Mn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var ue=this.ctx.transform.applyToPoint(new g(ne,ve));this.path.push({type:"lt",x:ue.x,y:ue.y}),this.ctx.lastPoint=new g(ue.x,ue.y)},I.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),J.call(this,null,!0)},I.prototype.quadraticCurveTo=function(ne,ve,ue,Te){if(isNaN(ue)||isNaN(Te)||isNaN(ne)||isNaN(ve))throw Mn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Be=this.ctx.transform.applyToPoint(new g(ue,Te)),Ue=this.ctx.transform.applyToPoint(new g(ne,ve));this.path.push({type:"qct",x1:Ue.x,y1:Ue.y,x:Be.x,y:Be.y}),this.ctx.lastPoint=new g(Be.x,Be.y)},I.prototype.bezierCurveTo=function(ne,ve,ue,Te,Be,Ue){if(isNaN(Be)||isNaN(Ue)||isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te))throw Mn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var tt=this.ctx.transform.applyToPoint(new g(Be,Ue)),ot=this.ctx.transform.applyToPoint(new g(ne,ve)),ut=this.ctx.transform.applyToPoint(new g(ue,Te));this.path.push({type:"bct",x1:ot.x,y1:ot.y,x2:ut.x,y2:ut.y,x:tt.x,y:tt.y}),this.ctx.lastPoint=new g(tt.x,tt.y)},I.prototype.arc=function(ne,ve,ue,Te,Be,Ue){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te)||isNaN(Be))throw Mn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Ue=!!Ue,!this.ctx.transform.isIdentity){var tt=this.ctx.transform.applyToPoint(new g(ne,ve));ne=tt.x,ve=tt.y;var ot=this.ctx.transform.applyToPoint(new g(0,ue)),ut=this.ctx.transform.applyToPoint(new g(0,0));ue=Math.sqrt(Math.pow(ot.x-ut.x,2)+Math.pow(ot.y-ut.y,2))}Math.abs(Be-Te)>=2*Math.PI&&(Te=0,Be=2*Math.PI),this.path.push({type:"arc",x:ne,y:ve,radius:ue,startAngle:Te,endAngle:Be,counterclockwise:Ue})},I.prototype.arcTo=function(ne,ve,ue,Te,Be){throw new Error("arcTo not implemented.")},I.prototype.rect=function(ne,ve,ue,Te){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te))throw Mn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ne,ve),this.lineTo(ne+ue,ve),this.lineTo(ne+ue,ve+Te),this.lineTo(ne,ve+Te),this.lineTo(ne,ve),this.lineTo(ne+ue,ve),this.lineTo(ne,ve)},I.prototype.fillRect=function(ne,ve,ue,Te){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te))throw Mn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!R.call(this)){var Be={};this.lineCap!=="butt"&&(Be.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Be.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ne,ve,ue,Te),this.fill(),Be.hasOwnProperty("lineCap")&&(this.lineCap=Be.lineCap),Be.hasOwnProperty("lineJoin")&&(this.lineJoin=Be.lineJoin)}},I.prototype.strokeRect=function(ne,ve,ue,Te){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te))throw Mn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");k.call(this)||(this.beginPath(),this.rect(ne,ve,ue,Te),this.stroke())},I.prototype.clearRect=function(ne,ve,ue,Te){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te))throw Mn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ne,ve,ue,Te))},I.prototype.save=function(ne){ne=typeof ne!="boolean"||ne;for(var ve=this.pdf.internal.getCurrentPageInfo().pageNumber,ue=0;ue<this.pdf.internal.getNumberOfPages();ue++)this.pdf.setPage(ue+1),this.pdf.internal.out("q");if(this.pdf.setPage(ve),ne){this.ctx.fontSize=this.pdf.internal.getFontSize();var Te=new C(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Te}},I.prototype.restore=function(ne){ne=typeof ne!="boolean"||ne;for(var ve=this.pdf.internal.getCurrentPageInfo().pageNumber,ue=0;ue<this.pdf.internal.getNumberOfPages();ue++)this.pdf.setPage(ue+1),this.pdf.internal.out("Q");this.pdf.setPage(ve),ne&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},I.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var O=function(ne){var ve,ue,Te,Be;if(ne.isCanvasGradient===!0&&(ne=ne.getColor()),!ne)return{r:0,g:0,b:0,a:0,style:ne};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ne))ve=0,ue=0,Te=0,Be=0;else{var Ue=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ne);if(Ue!==null)ve=parseInt(Ue[1]),ue=parseInt(Ue[2]),Te=parseInt(Ue[3]),Be=1;else if((Ue=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ne))!==null)ve=parseInt(Ue[1]),ue=parseInt(Ue[2]),Te=parseInt(Ue[3]),Be=parseFloat(Ue[4]);else{if(Be=1,typeof ne=="string"&&ne.charAt(0)!=="#"){var tt=new lG(ne);ne=tt.ok?tt.toHex():"#000000"}ne.length===4?(ve=ne.substring(1,2),ve+=ve,ue=ne.substring(2,3),ue+=ue,Te=ne.substring(3,4),Te+=Te):(ve=ne.substring(1,3),ue=ne.substring(3,5),Te=ne.substring(5,7)),ve=parseInt(ve,16),ue=parseInt(ue,16),Te=parseInt(Te,16)}}return{r:ve,g:ue,b:Te,a:Be,style:ne}},R=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},k=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};I.prototype.fillText=function(ne,ve,ue,Te){if(isNaN(ve)||isNaN(ue)||typeof ne!="string")throw Mn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Te=isNaN(Te)?void 0:Te,!R.call(this)){var Be=Z(this.ctx.transform.rotation),Ue=this.ctx.transform.scaleX;z.call(this,{text:ne,x:ve,y:ue,scale:Ue,angle:Be,align:this.textAlign,maxWidth:Te})}},I.prototype.strokeText=function(ne,ve,ue,Te){if(isNaN(ve)||isNaN(ue)||typeof ne!="string")throw Mn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!k.call(this)){Te=isNaN(Te)?void 0:Te;var Be=Z(this.ctx.transform.rotation),Ue=this.ctx.transform.scaleX;z.call(this,{text:ne,x:ve,y:ue,scale:Ue,renderingMode:"stroke",angle:Be,align:this.textAlign,maxWidth:Te})}},I.prototype.measureText=function(ne){if(typeof ne!="string")throw Mn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var ve=this.pdf,ue=this.pdf.internal.scaleFactor,Te=ve.internal.getFontSize(),Be=ve.getStringUnitWidth(ne)*Te/ve.internal.scaleFactor;return new function(Ue){var tt=(Ue=Ue||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return tt}}),this}({width:Be*=Math.round(96*ue/72*1e4)/1e4})},I.prototype.scale=function(ne,ve){if(isNaN(ne)||isNaN(ve))throw Mn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var ue=new v(ne,0,0,ve,0,0);this.ctx.transform=this.ctx.transform.multiply(ue)},I.prototype.rotate=function(ne){if(isNaN(ne))throw Mn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var ve=new v(Math.cos(ne),Math.sin(ne),-Math.sin(ne),Math.cos(ne),0,0);this.ctx.transform=this.ctx.transform.multiply(ve)},I.prototype.translate=function(ne,ve){if(isNaN(ne)||isNaN(ve))throw Mn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var ue=new v(1,0,0,1,ne,ve);this.ctx.transform=this.ctx.transform.multiply(ue)},I.prototype.transform=function(ne,ve,ue,Te,Be,Ue){if(isNaN(ne)||isNaN(ve)||isNaN(ue)||isNaN(Te)||isNaN(Be)||isNaN(Ue))throw Mn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var tt=new v(ne,ve,ue,Te,Be,Ue);this.ctx.transform=this.ctx.transform.multiply(tt)},I.prototype.setTransform=function(ne,ve,ue,Te,Be,Ue){ne=isNaN(ne)?1:ne,ve=isNaN(ve)?0:ve,ue=isNaN(ue)?0:ue,Te=isNaN(Te)?1:Te,Be=isNaN(Be)?0:Be,Ue=isNaN(Ue)?0:Ue,this.ctx.transform=new v(ne,ve,ue,Te,Be,Ue)};var M=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};I.prototype.drawImage=function(ne,ve,ue,Te,Be,Ue,tt,ot,ut){var Tt=this.pdf.getImageProperties(ne),Qe=1,it=1,kt=1,_e=1;Te!==void 0&&ot!==void 0&&(kt=ot/Te,_e=ut/Be,Qe=Tt.width/Te*ot/Te,it=Tt.height/Be*ut/Be),Ue===void 0&&(Ue=ve,tt=ue,ve=0,ue=0),Te!==void 0&&ot===void 0&&(ot=Te,ut=Be),Te===void 0&&ot===void 0&&(ot=Tt.width,ut=Tt.height);var xt=this.ctx.transform.decompose(),Ke=Z(xt.rotate.shx),Je=new v,$e=(Je=(Je=(Je=Je.multiply(xt.translate)).multiply(xt.skew)).multiply(xt.scale)).applyToRectangle(new x(Ue-ve*kt,tt-ue*_e,Te*Qe,Be*it));if(this.autoPaging){for(var jt,Kt=P.call(this,$e),os=[],ss=0;ss<Kt.length;ss+=1)os.indexOf(Kt[ss])===-1&&os.push(Kt[ss]);re(os);for(var mt=os[0],Ht=os[os.length-1],qe=mt;qe<Ht+1;qe++){this.pdf.setPage(qe);var ht=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Xt=qe===1?this.posY+this.margin[0]:this.margin[0],zt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ds=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Qt=qe===1?0:zt+(qe-2)*ds;if(this.ctx.clip_path.length!==0){var Us=this.path;jt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(jt,this.posX+this.margin[3],-Qt+Xt+this.ctx.prevPageLastElemOffset),ge.call(this,"fill",!0),this.path=Us}var bs=JSON.parse(JSON.stringify($e));bs=$([bs],this.posX+this.margin[3],-Qt+Xt+this.ctx.prevPageLastElemOffset)[0];var cs=(qe>mt||qe<Ht)&&M.call(this);cs&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ht,ds,null).clip().discardPath()),this.pdf.addImage(ne,"JPEG",bs.x,bs.y,bs.w,bs.h,null,null,Ke),cs&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(ne,"JPEG",$e.x,$e.y,$e.w,$e.h,null,null,Ke)};var P=function(ne,ve,ue){var Te=[];ve=ve||this.pdf.internal.pageSize.width,ue=ue||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Be=this.posY+this.ctx.prevPageLastElemOffset;switch(ne.type){default:case"mt":case"lt":Te.push(Math.floor((ne.y+Be)/ue)+1);break;case"arc":Te.push(Math.floor((ne.y+Be-ne.radius)/ue)+1),Te.push(Math.floor((ne.y+Be+ne.radius)/ue)+1);break;case"qct":var Ue=Ie(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ne.x1,ne.y1,ne.x,ne.y);Te.push(Math.floor((Ue.y+Be)/ue)+1),Te.push(Math.floor((Ue.y+Ue.h+Be)/ue)+1);break;case"bct":var tt=Ve(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ne.x1,ne.y1,ne.x2,ne.y2,ne.x,ne.y);Te.push(Math.floor((tt.y+Be)/ue)+1),Te.push(Math.floor((tt.y+tt.h+Be)/ue)+1);break;case"rect":Te.push(Math.floor((ne.y+Be)/ue)+1),Te.push(Math.floor((ne.y+ne.h+Be)/ue)+1)}for(var ot=0;ot<Te.length;ot+=1)for(;this.pdf.internal.getNumberOfPages()<Te[ot];)H.call(this);return Te},H=function(){var ne=this.fillStyle,ve=this.strokeStyle,ue=this.font,Te=this.lineCap,Be=this.lineWidth,Ue=this.lineJoin;this.pdf.addPage(),this.fillStyle=ne,this.strokeStyle=ve,this.font=ue,this.lineCap=Te,this.lineWidth=Be,this.lineJoin=Ue},$=function(ne,ve,ue){for(var Te=0;Te<ne.length;Te++)switch(ne[Te].type){case"bct":ne[Te].x2+=ve,ne[Te].y2+=ue;case"qct":ne[Te].x1+=ve,ne[Te].y1+=ue;default:ne[Te].x+=ve,ne[Te].y+=ue}return ne},re=function(ne){return ne.sort(function(ve,ue){return ve-ue})},J=function(ne,ve){var ue=this.fillStyle,Te=this.strokeStyle,Be=this.lineCap,Ue=this.lineWidth,tt=Math.abs(Ue*this.ctx.transform.scaleX),ot=this.lineJoin;if(this.autoPaging){for(var ut,Tt,Qe=JSON.parse(JSON.stringify(this.path)),it=JSON.parse(JSON.stringify(this.path)),kt=[],_e=0;_e<it.length;_e++)if(it[_e].x!==void 0)for(var xt=P.call(this,it[_e]),Ke=0;Ke<xt.length;Ke+=1)kt.indexOf(xt[Ke])===-1&&kt.push(xt[Ke]);for(var Je=0;Je<kt.length;Je++)for(;this.pdf.internal.getNumberOfPages()<kt[Je];)H.call(this);re(kt);for(var $e=kt[0],jt=kt[kt.length-1],Kt=$e;Kt<jt+1;Kt++){this.pdf.setPage(Kt),this.fillStyle=ue,this.strokeStyle=Te,this.lineCap=Be,this.lineWidth=tt,this.lineJoin=ot;var os=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ss=Kt===1?this.posY+this.margin[0]:this.margin[0],mt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ht=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],qe=Kt===1?0:mt+(Kt-2)*Ht;if(this.ctx.clip_path.length!==0){var ht=this.path;ut=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(ut,this.posX+this.margin[3],-qe+ss+this.ctx.prevPageLastElemOffset),ge.call(this,ne,!0),this.path=ht}if(Tt=JSON.parse(JSON.stringify(Qe)),this.path=$(Tt,this.posX+this.margin[3],-qe+ss+this.ctx.prevPageLastElemOffset),ve===!1||Kt===0){var Xt=(Kt>$e||Kt<jt)&&M.call(this);Xt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],os,Ht,null).clip().discardPath()),ge.call(this,ne,ve),Xt&&this.pdf.restoreGraphicsState()}this.lineWidth=Ue}this.path=Qe}else this.lineWidth=tt,ge.call(this,ne,ve),this.lineWidth=Ue},ge=function(ne,ve){if((ne!=="stroke"||ve||!k.call(this))&&(ne==="stroke"||ve||!R.call(this))){for(var ue,Te,Be=[],Ue=this.path,tt=0;tt<Ue.length;tt++){var ot=Ue[tt];switch(ot.type){case"begin":Be.push({begin:!0});break;case"close":Be.push({close:!0});break;case"mt":Be.push({start:ot,deltas:[],abs:[]});break;case"lt":var ut=Be.length;if(Ue[tt-1]&&!isNaN(Ue[tt-1].x)&&(ue=[ot.x-Ue[tt-1].x,ot.y-Ue[tt-1].y],ut>0)){for(;ut>=0;ut--)if(Be[ut-1].close!==!0&&Be[ut-1].begin!==!0){Be[ut-1].deltas.push(ue),Be[ut-1].abs.push(ot);break}}break;case"bct":ue=[ot.x1-Ue[tt-1].x,ot.y1-Ue[tt-1].y,ot.x2-Ue[tt-1].x,ot.y2-Ue[tt-1].y,ot.x-Ue[tt-1].x,ot.y-Ue[tt-1].y],Be[Be.length-1].deltas.push(ue);break;case"qct":var Tt=Ue[tt-1].x+2/3*(ot.x1-Ue[tt-1].x),Qe=Ue[tt-1].y+2/3*(ot.y1-Ue[tt-1].y),it=ot.x+2/3*(ot.x1-ot.x),kt=ot.y+2/3*(ot.y1-ot.y),_e=ot.x,xt=ot.y;ue=[Tt-Ue[tt-1].x,Qe-Ue[tt-1].y,it-Ue[tt-1].x,kt-Ue[tt-1].y,_e-Ue[tt-1].x,xt-Ue[tt-1].y],Be[Be.length-1].deltas.push(ue);break;case"arc":Be.push({deltas:[],abs:[],arc:!0}),Array.isArray(Be[Be.length-1].abs)&&Be[Be.length-1].abs.push(ot)}}Te=ve?null:ne==="stroke"?"stroke":"fill";for(var Ke=!1,Je=0;Je<Be.length;Je++)if(Be[Je].arc)for(var $e=Be[Je].abs,jt=0;jt<$e.length;jt++){var Kt=$e[jt];Kt.type==="arc"?Ae.call(this,Kt.x,Kt.y,Kt.radius,Kt.startAngle,Kt.endAngle,Kt.counterclockwise,void 0,ve,!Ke):te.call(this,Kt.x,Kt.y),Ke=!0}else if(Be[Je].close===!0)this.pdf.internal.out("h"),Ke=!1;else if(Be[Je].begin!==!0){var os=Be[Je].start.x,ss=Be[Je].start.y;se.call(this,Be[Je].deltas,os,ss),Ke=!0}Te&&V.call(this,Te),ve&&ce.call(this)}},ie=function(ne){var ve=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,ue=ve*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ne-ue;case"top":return ne+ve-ue;case"hanging":return ne+ve-2*ue;case"middle":return ne+ve/2-ue;default:return ne}},we=function(ne){return ne+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};I.prototype.createLinearGradient=function(){var ne=function(){};return ne.colorStops=[],ne.addColorStop=function(ve,ue){this.colorStops.push([ve,ue])},ne.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ne.isCanvasGradient=!0,ne},I.prototype.createPattern=function(){return this.createLinearGradient()},I.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ae=function(ne,ve,ue,Te,Be,Ue,tt,ot,ut){for(var Tt=he.call(this,ue,Te,Be,Ue),Qe=0;Qe<Tt.length;Qe++){var it=Tt[Qe];Qe===0&&(ut?Y.call(this,it.x1+ne,it.y1+ve):te.call(this,it.x1+ne,it.y1+ve)),Ce.call(this,ne,ve,it.x2,it.y2,it.x3,it.y3,it.x4,it.y4)}ot?ce.call(this):V.call(this,tt)},V=function(ne){switch(ne){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ce=function(){this.pdf.clip(),this.pdf.discardPath()},Y=function(ne,ve){this.pdf.internal.out(c(ne)+" "+d(ve)+" m")},z=function(ne){var ve;switch(ne.align){case"right":case"end":ve="right";break;case"center":ve="center";break;default:ve="left"}var ue,Te,Be,Ue=this.pdf.getTextDimensions(ne.text),tt=ie.call(this,ne.y),ot=we.call(this,tt)-Ue.h,ut=this.ctx.transform.applyToPoint(new g(ne.x,tt));if(this.autoPaging){var Tt=this.ctx.transform.decompose(),Qe=new v;Qe=(Qe=(Qe=Qe.multiply(Tt.translate)).multiply(Tt.skew)).multiply(Tt.scale);for(var it=this.ctx.transform.applyToRectangle(new x(ne.x,tt,Ue.w,Ue.h)),kt=Qe.applyToRectangle(new x(ne.x,ot,Ue.w,Ue.h)),_e=P.call(this,kt),xt=[],Ke=0;Ke<_e.length;Ke+=1)xt.indexOf(_e[Ke])===-1&&xt.push(_e[Ke]);re(xt);for(var Je=xt[0],$e=xt[xt.length-1],jt=Je;jt<$e+1;jt++){this.pdf.setPage(jt);var Kt=jt===1?this.posY+this.margin[0]:this.margin[0],os=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ss=this.pdf.internal.pageSize.height-this.margin[2],mt=ss-this.margin[0],Ht=this.pdf.internal.pageSize.width-this.margin[1],qe=Ht-this.margin[3],ht=jt===1?0:os+(jt-2)*mt;if(this.ctx.clip_path.length!==0){var Xt=this.path;ue=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(ue,this.posX+this.margin[3],-1*ht+Kt),ge.call(this,"fill",!0),this.path=Xt}var zt=$([JSON.parse(JSON.stringify(kt))],this.posX+this.margin[3],-ht+Kt+this.ctx.prevPageLastElemOffset)[0];ne.scale>=.01&&(Te=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Te*ne.scale),Be=this.lineWidth,this.lineWidth=Be*ne.scale);var ds=this.autoPaging!=="text";if(ds||zt.y+zt.h<=ss){if(ds||zt.y>=Kt&&zt.x<=Ht){var Qt=ds?ne.text:this.pdf.splitTextToSize(ne.text,ne.maxWidth||Ht-zt.x)[0],Us=$([JSON.parse(JSON.stringify(it))],this.posX+this.margin[3],-ht+Kt+this.ctx.prevPageLastElemOffset)[0],bs=ds&&(jt>Je||jt<$e)&&M.call(this);bs&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],qe,mt,null).clip().discardPath()),this.pdf.text(Qt,Us.x,Us.y,{angle:ne.angle,align:ve,renderingMode:ne.renderingMode}),bs&&this.pdf.restoreGraphicsState()}}else zt.y<ss&&(this.ctx.prevPageLastElemOffset+=ss-zt.y);ne.scale>=.01&&(this.pdf.setFontSize(Te),this.lineWidth=Be)}}else ne.scale>=.01&&(Te=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Te*ne.scale),Be=this.lineWidth,this.lineWidth=Be*ne.scale),this.pdf.text(ne.text,ut.x+this.posX,ut.y+this.posY,{angle:ne.angle,align:ve,renderingMode:ne.renderingMode,maxWidth:ne.maxWidth}),ne.scale>=.01&&(this.pdf.setFontSize(Te),this.lineWidth=Be)},te=function(ne,ve,ue,Te){ue=ue||0,Te=Te||0,this.pdf.internal.out(c(ne+ue)+" "+d(ve+Te)+" l")},se=function(ne,ve,ue){return this.pdf.lines(ne,ve,ue,null,null)},Ce=function(ne,ve,ue,Te,Be,Ue,tt,ot){this.pdf.internal.out([o(h(ue+ne)),o(p(Te+ve)),o(h(Be+ne)),o(p(Ue+ve)),o(h(tt+ne)),o(p(ot+ve)),"c"].join(" "))},he=function(ne,ve,ue,Te){for(var Be=2*Math.PI,Ue=Math.PI/2;ve>ue;)ve-=Be;var tt=Math.abs(ue-ve);tt<Be&&Te&&(tt=Be-tt);for(var ot=[],ut=Te?-1:1,Tt=ve;tt>1e-5;){var Qe=Tt+ut*Math.min(tt,Ue);ot.push(Ne.call(this,ne,Tt,Qe)),tt-=Math.abs(Qe-Tt),Tt=Qe}return ot},Ne=function(ne,ve,ue){var Te=(ue-ve)/2,Be=ne*Math.cos(Te),Ue=ne*Math.sin(Te),tt=Be,ot=-Ue,ut=tt*tt+ot*ot,Tt=ut+tt*Be+ot*Ue,Qe=4/3*(Math.sqrt(2*ut*Tt)-Tt)/(tt*Ue-ot*Be),it=tt-Qe*ot,kt=ot+Qe*tt,_e=it,xt=-kt,Ke=Te+ve,Je=Math.cos(Ke),$e=Math.sin(Ke);return{x1:ne*Math.cos(ve),y1:ne*Math.sin(ve),x2:it*Je-kt*$e,y2:it*$e+kt*Je,x3:_e*Je-xt*$e,y3:_e*$e+xt*Je,x4:ne*Math.cos(ue),y4:ne*Math.sin(ue)}},Z=function(ne){return 180*ne/Math.PI},Ie=function(ne,ve,ue,Te,Be,Ue){var tt=ne+.5*(ue-ne),ot=ve+.5*(Te-ve),ut=Be+.5*(ue-Be),Tt=Ue+.5*(Te-Ue),Qe=Math.min(ne,Be,tt,ut),it=Math.max(ne,Be,tt,ut),kt=Math.min(ve,Ue,ot,Tt),_e=Math.max(ve,Ue,ot,Tt);return new x(Qe,kt,it-Qe,_e-kt)},Ve=function(ne,ve,ue,Te,Be,Ue,tt,ot){var ut,Tt,Qe,it,kt,_e,xt,Ke,Je,$e,jt,Kt,os,ss,mt=ue-ne,Ht=Te-ve,qe=Be-ue,ht=Ue-Te,Xt=tt-Be,zt=ot-Ue;for(Tt=0;Tt<41;Tt++)Je=(xt=(Qe=ne+(ut=Tt/40)*mt)+ut*((kt=ue+ut*qe)-Qe))+ut*(kt+ut*(Be+ut*Xt-kt)-xt),$e=(Ke=(it=ve+ut*Ht)+ut*((_e=Te+ut*ht)-it))+ut*(_e+ut*(Ue+ut*zt-_e)-Ke),Tt==0?(jt=Je,Kt=$e,os=Je,ss=$e):(jt=Math.min(jt,Je),Kt=Math.min(Kt,$e),os=Math.max(os,Je),ss=Math.max(ss,$e));return new x(Math.round(jt),Math.round(Kt),Math.round(os-jt),Math.round(ss-Kt))},Pe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ne,ve,ue=(ne=this.ctx.lineDash,ve=this.ctx.lineDashOffset,JSON.stringify({lineDash:ne,lineDashOffset:ve}));this.prevLineDash!==ue&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=ue)}}})(Qs.API),function(a){var o=function(g){var x,v,E,C,I,O,R,k,M,P;for(v=[],E=0,C=(g+=x="\0\0\0\0".slice(g.length%4||4)).length;C>E;E+=4)(I=(g.charCodeAt(E)<<24)+(g.charCodeAt(E+1)<<16)+(g.charCodeAt(E+2)<<8)+g.charCodeAt(E+3))!==0?(O=(I=((I=((I=((I=(I-(P=I%85))/85)-(M=I%85))/85)-(k=I%85))/85)-(R=I%85))/85)%85,v.push(O+33,R+33,k+33,M+33,P+33)):v.push(122);return function(H,$){for(var re=$;re>0;re--)H.pop()}(v,x.length),String.fromCharCode.apply(String,v)+"~>"},c=function(g){var x,v,E,C,I,O=String,R="length",k=255,M="charCodeAt",P="slice",H="replace";for(g[P](-2),g=g[P](0,-2)[H](/\s/g,"")[H]("z","!!!!!"),E=[],C=0,I=(g+=x="uuuuu"[P](g[R]%5||5))[R];I>C;C+=5)v=52200625*(g[M](C)-33)+614125*(g[M](C+1)-33)+7225*(g[M](C+2)-33)+85*(g[M](C+3)-33)+(g[M](C+4)-33),E.push(k&v>>24,k&v>>16,k&v>>8,k&v);return function($,re){for(var J=re;J>0;J--)$.pop()}(E,x[R]),O.fromCharCode.apply(O,E)},d=function(g){return g.split("").map(function(x){return("0"+x.charCodeAt().toString(16)).slice(-2)}).join("")+">"},h=function(g){var x=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((g=g.replace(/\s/g,"")).indexOf(">")!==-1&&(g=g.substr(0,g.indexOf(">"))),g.length%2&&(g+="0"),x.test(g)===!1)return"";for(var v="",E=0;E<g.length;E+=2)v+=String.fromCharCode("0x"+(g[E]+g[E+1]));return v},p=function(g){for(var x=new Uint8Array(g.length),v=g.length;v--;)x[v]=g.charCodeAt(v);return(x=FR(x)).reduce(function(E,C){return E+String.fromCharCode(C)},"")};a.processDataByFilters=function(g,x){var v=0,E=g||"",C=[];for(typeof(x=x||[])=="string"&&(x=[x]),v=0;v<x.length;v+=1)switch(x[v]){case"ASCII85Decode":case"/ASCII85Decode":E=c(E),C.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":E=o(E),C.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":E=h(E),C.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":E=d(E),C.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":E=p(E),C.push("/FlateDecode");break;default:throw new Error('The filter: "'+x[v]+'" is not implemented')}return{data:E,reverseChain:C.reverse().join(" ")}}}(Qs.API),function(a){a.loadFile=function(o,c,d){return function(h,p,g){p=p!==!1,g=typeof g=="function"?g:function(){};var x=void 0;try{x=function(v,E,C){var I=new XMLHttpRequest,O=0,R=function(k){var M=k.length,P=[],H=String.fromCharCode;for(O=0;O<M;O+=1)P.push(H(255&k.charCodeAt(O)));return P.join("")};if(I.open("GET",v,!E),I.overrideMimeType("text/plain; charset=x-user-defined"),E===!1&&(I.onload=function(){I.status===200?C(R(this.responseText)):C(void 0)}),I.send(null),E&&I.status===200)return R(I.responseText)}(h,p,g)}catch{}return x}(o,c,d)},a.allowFsRead=void 0,a.loadImageFile=a.loadFile}(Qs.API),function(a){function o(){return(ar.html2canvas?Promise.resolve(ar.html2canvas):wT(()=>Promise.resolve().then(()=>gme),void 0)).catch(function(x){return Promise.reject(new Error("Could not load html2canvas: "+x))}).then(function(x){return x.default?x.default:x})}function c(){return(ar.DOMPurify?Promise.resolve(ar.DOMPurify):wT(()=>import("./purify.es-B9ZVCkUG.js"),[])).catch(function(x){return Promise.reject(new Error("Could not load dompurify: "+x))}).then(function(x){return x.default?x.default:x})}var d=function(x){var v=_n(x);return v==="undefined"?"undefined":v==="string"||x instanceof String?"string":v==="number"||x instanceof Number?"number":v==="function"||x instanceof Function?"function":x&&x.constructor===Array?"array":x&&x.nodeType===1?"element":v==="object"?"object":"unknown"},h=function(x,v){var E=document.createElement(x);for(var C in v.className&&(E.className=v.className),v.innerHTML&&v.dompurify&&(E.innerHTML=v.dompurify.sanitize(v.innerHTML)),v.style)E.style[C]=v.style[C];return E},p=function x(v,E){for(var C=v.nodeType===3?document.createTextNode(v.nodeValue):v.cloneNode(!1),I=v.firstChild;I;I=I.nextSibling)E!==!0&&I.nodeType===1&&I.nodeName==="SCRIPT"||C.appendChild(x(I,E));return v.nodeType===1&&(v.nodeName==="CANVAS"?(C.width=v.width,C.height=v.height,C.getContext("2d").drawImage(v,0,0)):v.nodeName!=="TEXTAREA"&&v.nodeName!=="SELECT"||(C.value=v.value),C.addEventListener("load",function(){C.scrollTop=v.scrollTop,C.scrollLeft=v.scrollLeft},!0)),C},g=function x(v){var E=Object.assign(x.convert(Promise.resolve()),JSON.parse(JSON.stringify(x.template))),C=x.convert(Promise.resolve(),E);return(C=C.setProgress(1,x,1,[x])).set(v)};(g.prototype=Object.create(Promise.prototype)).constructor=g,g.convert=function(x,v){return x.__proto__=v||g.prototype,x},g.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},g.prototype.from=function(x,v){return this.then(function(){switch(v=v||function(E){switch(d(E)){case"string":return"string";case"element":return E.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(x),v){case"string":return this.then(c).then(function(E){return this.set({src:h("div",{innerHTML:x,dompurify:E})})});case"element":return this.set({src:x});case"canvas":return this.set({canvas:x});case"img":return this.set({img:x});default:return this.error("Unknown source type.")}})},g.prototype.to=function(x){switch(x){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},g.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var x={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},v=p(this.prop.src,this.opt.html2canvas.javascriptEnabled);v.tagName==="BODY"&&(x.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=h("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=h("div",{className:"html2pdf__container",style:x}),this.prop.container.appendChild(v),this.prop.container.firstChild.appendChild(h("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},g.prototype.toCanvas=function(){var x=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(x).then(o).then(function(v){var E=Object.assign({},this.opt.html2canvas);return delete E.onrendered,v(this.prop.container,E)}).then(function(v){(this.opt.html2canvas.onrendered||function(){})(v),this.prop.canvas=v,document.body.removeChild(this.prop.overlay)})},g.prototype.toContext2d=function(){var x=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(x).then(o).then(function(v){var E=this.opt.jsPDF,C=this.opt.fontFaces,I=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,O=Object.assign({async:!0,allowTaint:!0,scale:I,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete O.onrendered,E.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,E.context2d.posX=this.opt.x,E.context2d.posY=this.opt.y,E.context2d.margin=this.opt.margin,E.context2d.fontFaces=C,C)for(var R=0;R<C.length;++R){var k=C[R],M=k.src.find(function(P){return P.format==="truetype"});M&&E.addFont(M.url,k.ref.name,k.ref.style)}return O.windowHeight=O.windowHeight||0,O.windowHeight=O.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):O.windowHeight,E.context2d.save(!0),v(this.prop.container,O)}).then(function(v){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(v),this.prop.canvas=v,document.body.removeChild(this.prop.overlay)})},g.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var x=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=x})},g.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},g.prototype.output=function(x,v,E){return(E=E||"pdf").toLowerCase()==="img"||E.toLowerCase()==="image"?this.outputImg(x,v):this.outputPdf(x,v)},g.prototype.outputPdf=function(x,v){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(x,v)})},g.prototype.outputImg=function(x){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(x){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+x+'" is not supported.'}})},g.prototype.save=function(x){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(x?{filename:x}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},g.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},g.prototype.set=function(x){if(d(x)!=="object")return this;var v=Object.keys(x||{}).map(function(E){if(E in g.template.prop)return function(){this.prop[E]=x[E]};switch(E){case"margin":return this.setMargin.bind(this,x.margin);case"jsPDF":return function(){return this.opt.jsPDF=x.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,x.pageSize);default:return function(){this.opt[E]=x[E]}}},this);return this.then(function(){return this.thenList(v)})},g.prototype.get=function(x,v){return this.then(function(){var E=x in g.template.prop?this.prop[x]:this.opt[x];return v?v(E):E})},g.prototype.setMargin=function(x){return this.then(function(){switch(d(x)){case"number":x=[x,x,x,x];case"array":if(x.length===2&&(x=[x[0],x[1],x[0],x[1]]),x.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=x}).then(this.setPageSize)},g.prototype.setPageSize=function(x){function v(E,C){return Math.floor(E*C/72*96)}return this.then(function(){(x=x||Qs.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(x.inner={width:x.width-this.opt.margin[1]-this.opt.margin[3],height:x.height-this.opt.margin[0]-this.opt.margin[2]},x.inner.px={width:v(x.inner.width,x.k),height:v(x.inner.height,x.k)},x.inner.ratio=x.inner.height/x.inner.width),this.prop.pageSize=x})},g.prototype.setProgress=function(x,v,E,C){return x!=null&&(this.progress.val=x),v!=null&&(this.progress.state=v),E!=null&&(this.progress.n=E),C!=null&&(this.progress.stack=C),this.progress.ratio=this.progress.val/this.progress.state,this},g.prototype.updateProgress=function(x,v,E,C){return this.setProgress(x?this.progress.val+x:null,v||null,E?this.progress.n+E:null,C?this.progress.stack.concat(C):null)},g.prototype.then=function(x,v){var E=this;return this.thenCore(x,v,function(C,I){return E.updateProgress(null,null,1,[C]),Promise.prototype.then.call(this,function(O){return E.updateProgress(null,C),O}).then(C,I).then(function(O){return E.updateProgress(1),O})})},g.prototype.thenCore=function(x,v,E){E=E||Promise.prototype.then;var C=this;x&&(x=x.bind(C)),v&&(v=v.bind(C));var I=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?C:g.convert(Object.assign({},C),Promise.prototype),O=E.call(I,x,v);return g.convert(O,C.__proto__)},g.prototype.thenExternal=function(x,v){return Promise.prototype.then.call(this,x,v)},g.prototype.thenList=function(x){var v=this;return x.forEach(function(E){v=v.thenCore(E)}),v},g.prototype.catch=function(x){x&&(x=x.bind(this));var v=Promise.prototype.catch.call(this,x);return g.convert(v,this)},g.prototype.catchExternal=function(x){return Promise.prototype.catch.call(this,x)},g.prototype.error=function(x){return this.then(function(){throw new Error(x)})},g.prototype.using=g.prototype.set,g.prototype.saveAs=g.prototype.save,g.prototype.export=g.prototype.output,g.prototype.run=g.prototype.then,Qs.getPageSize=function(x,v,E){if(_n(x)==="object"){var C=x;x=C.orientation,v=C.unit||v,E=C.format||E}v=v||"mm",E=E||"a4",x=(""+(x||"P")).toLowerCase();var I,O=(""+E).toLowerCase(),R={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(v){case"pt":I=1;break;case"mm":I=72/25.4;break;case"cm":I=72/2.54;break;case"in":I=72;break;case"px":I=.75;break;case"pc":case"em":I=12;break;case"ex":I=6;break;default:throw"Invalid unit: "+v}var k,M=0,P=0;if(R.hasOwnProperty(O))M=R[O][1]/I,P=R[O][0]/I;else try{M=E[1],P=E[0]}catch{throw new Error("Invalid format: "+E)}if(x==="p"||x==="portrait")x="p",P>M&&(k=P,P=M,M=k);else{if(x!=="l"&&x!=="landscape")throw"Invalid orientation: "+x;x="l",M>P&&(k=P,P=M,M=k)}return{width:P,height:M,unit:v,k:I,orientation:x}},a.html=function(x,v){(v=v||{}).callback=v.callback||function(){},v.html2canvas=v.html2canvas||{},v.html2canvas.canvas=v.html2canvas.canvas||this.canvas,v.jsPDF=v.jsPDF||this,v.fontFaces=v.fontFaces?v.fontFaces.map(FT):null;var E=new g(v);return v.worker?E:E.from(x).doCallback()}}(Qs.API),Qs.API.addJS=function(a){var o,c,d=function(h){for(var p="",g=0;g<h.length;g++){var x=h[g];if(x==="("||x===")"){for(var v=0,E=g-1;E>=0&&h[E]==="\\";E--)v++;p+=v%2==0?"\\"+x:x}else p+=x}return p}(a);return this.internal.events.subscribe("postPutResources",function(){o=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(o+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),c=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+d+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){o!==void 0&&c!==void 0&&this.internal.out("/Names <</JavaScript "+o+" 0 R>>")}),this},function(a){var o;a.events.push(["postPutResources",function(){var c=this,d=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var h=c.outline.render().split(/\r\n/),p=0;p<h.length;p++){var g=h[p],x=d.exec(g);if(x!=null){var v=x[1];c.internal.newObjectDeferredBegin(v,!1)}c.internal.write(g)}if(this.outline.createNamedDestinations){var E=this.internal.pages.length,C=[];for(p=0;p<E;p++){var I=c.internal.newObject();C.push(I);var O=c.internal.getPageInfo(p+1);c.internal.write("<< /D["+O.objId+" 0 R /XYZ null null null]>> endobj")}var R=c.internal.newObject();for(c.internal.write("<< /Names [ "),p=0;p<C.length;p++)c.internal.write("(page_"+(p+1)+")"+C[p]+" 0 R");c.internal.write(" ] >>","endobj"),o=c.internal.newObject(),c.internal.write("<< /Dests "+R+" 0 R"),c.internal.write(">>","endobj")}}]),a.events.push(["putCatalog",function(){var c=this;c.outline.root.children.length>0&&(c.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&c.internal.write("/Names "+o+" 0 R"))}]),a.events.push(["initialized",function(){var c=this;c.outline={createNamedDestinations:!1,root:{children:[]}},c.outline.add=function(d,h,p){var g={title:h,options:p,children:[]};return d==null&&(d=this.root),d.children.push(g),g},c.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=c,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},c.outline.genIds_r=function(d){d.id=c.internal.newObjectDeferred();for(var h=0;h<d.children.length;h++)this.genIds_r(d.children[h])},c.outline.renderRoot=function(d){this.objStart(d),this.line("/Type /Outlines"),d.children.length>0&&(this.line("/First "+this.makeRef(d.children[0])),this.line("/Last "+this.makeRef(d.children[d.children.length-1]))),this.line("/Count "+this.count_r({count:0},d)),this.objEnd()},c.outline.renderItems=function(d){for(var h=this.ctx.pdf.internal.getVerticalCoordinateString,p=0;p<d.children.length;p++){var g=d.children[p];this.objStart(g),this.line("/Title "+this.makeString(g.title)),this.line("/Parent "+this.makeRef(d)),p>0&&this.line("/Prev "+this.makeRef(d.children[p-1])),p<d.children.length-1&&this.line("/Next "+this.makeRef(d.children[p+1])),g.children.length>0&&(this.line("/First "+this.makeRef(g.children[0])),this.line("/Last "+this.makeRef(g.children[g.children.length-1])));var x=this.count=this.count_r({count:0},g);if(x>0&&this.line("/Count "+x),g.options&&g.options.pageNumber){var v=c.internal.getPageInfo(g.options.pageNumber);this.line("/Dest ["+v.objId+" 0 R /XYZ 0 "+h(0)+" 0]")}this.objEnd()}for(var E=0;E<d.children.length;E++)this.renderItems(d.children[E])},c.outline.line=function(d){this.ctx.val+=d+`\r
`},c.outline.makeRef=function(d){return d.id+" 0 R"},c.outline.makeString=function(d){return"("+c.internal.pdfEscape(d)+")"},c.outline.objStart=function(d){this.ctx.val+=`\r
`+d.id+` 0 obj\r
<<\r
`},c.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},c.outline.count_r=function(d,h){for(var p=0;p<h.children.length;p++)d.count++,this.count_r(d,h.children[p]);return d.count}}])}(Qs.API),function(a){var o=[192,193,194,195,196,197,198,199];a.processJPEG=function(c,d,h,p,g,x){var v,E=this.decode.DCT_DECODE,C=null;if(typeof c=="string"||this.__addimage__.isArrayBuffer(c)||this.__addimage__.isArrayBufferView(c)){switch(c=g||c,c=this.__addimage__.isArrayBuffer(c)?new Uint8Array(c):c,v=function(I){for(var O,R=256*I.charCodeAt(4)+I.charCodeAt(5),k=I.length,M={width:0,height:0,numcomponents:1},P=4;P<k;P+=2){if(P+=R,o.indexOf(I.charCodeAt(P+1))!==-1){O=256*I.charCodeAt(P+5)+I.charCodeAt(P+6),M={width:256*I.charCodeAt(P+7)+I.charCodeAt(P+8),height:O,numcomponents:I.charCodeAt(P+9)};break}R=256*I.charCodeAt(P+2)+I.charCodeAt(P+3)}return M}(c=this.__addimage__.isArrayBufferView(c)?this.__addimage__.arrayBufferToBinaryString(c):c),v.numcomponents){case 1:x=this.color_spaces.DEVICE_GRAY;break;case 4:x=this.color_spaces.DEVICE_CMYK;break;case 3:x=this.color_spaces.DEVICE_RGB}C={data:c,width:v.width,height:v.height,colorSpace:x,bitsPerComponent:8,filter:E,index:d,alias:h}}return C}}(Qs.API),Qs.API.processPNG=function(a,o,c,d){if(this.__addimage__.isArrayBuffer(a)&&(a=new Uint8Array(a)),this.__addimage__.isArrayBufferView(a)){var h,p=Cge(a,{checkCrc:!0}),g=p.width,x=p.height,v=p.channels,E=p.palette,C=p.depth;h=E&&v===1?function(Ae){for(var V=Ae.width,ce=Ae.height,Y=Ae.data,z=Ae.palette,te=Ae.depth,se=!1,Ce=[],he=[],Ne=void 0,Z=!1,Ie=0,Ve=0;Ve<z.length;Ve++){var Pe=V8(z[Ve],4),ne=Pe[0],ve=Pe[1],ue=Pe[2],Te=Pe[3];Ce.push(ne,ve,ue),Te!=null&&(Te===0?(Ie++,he.length<1&&he.push(Ve)):Te<255&&(Z=!0))}if(Z||Ie>1){se=!0,he=void 0;var Be=V*ce;Ne=new Uint8Array(Be);for(var Ue=new DataView(Y.buffer),tt=0;tt<Be;tt++){var ot=VT(Ue,tt,te),ut=V8(z[ot],4)[3];Ne[tt]=ut}}else Ie===0&&(he=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:se?8:void 0,colorBytes:Y,alphaBytes:Ne,needSMask:se,palette:Ce,mask:he}}(p):v===2||v===4?function(Ae){for(var V=Ae.data,ce=Ae.width,Y=Ae.height,z=Ae.channels,te=Ae.depth,se=z===2?"DeviceGray":"DeviceRGB",Ce=z-1,he=ce*Y,Ne=Ce,Z=he*Ne,Ie=1*he,Ve=Math.ceil(Z*te/8),Pe=Math.ceil(Ie*te/8),ne=new Uint8Array(Ve),ve=new Uint8Array(Pe),ue=new DataView(V.buffer),Te=new DataView(ne.buffer),Be=new DataView(ve.buffer),Ue=!1,tt=0;tt<he;tt++){for(var ot=tt*z,ut=0;ut<Ne;ut++)GV(Te,VT(ue,ot+ut,te),tt*Ne+ut,te);var Tt=VT(ue,ot+Ne,te);Tt<(1<<te)-1&&(Ue=!0),GV(Be,Tt,1*tt,te)}return{colorSpace:se,colorsPerPixel:Ce,sMaskBitsPerComponent:Ue?te:void 0,colorBytes:ne,alphaBytes:ve,needSMask:Ue}}(p):function(Ae){var V=Ae.data,ce=Ae.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:ce,colorsPerPixel:ce==="DeviceGray"?1:3,colorBytes:V instanceof Uint16Array?function(Y){for(var z=Y.length,te=new Uint8Array(2*z),se=new DataView(te.buffer,te.byteOffset,te.byteLength),Ce=0;Ce<z;Ce++)se.setUint16(2*Ce,Y[Ce],!1);return te}(V):V,needSMask:!1}}(p);var I,O,R,k=h,M=k.colorSpace,P=k.colorsPerPixel,H=k.sMaskBitsPerComponent,$=k.colorBytes,re=k.alphaBytes,J=k.needSMask,ge=k.palette,ie=k.mask,we=null;return d!==Qs.API.image_compression.NONE&&typeof FR=="function"?(we=function(Ae){var V;switch(Ae){case Qs.API.image_compression.FAST:V=11;break;case Qs.API.image_compression.MEDIUM:V=13;break;case Qs.API.image_compression.SLOW:V=14;break;default:V=12}return V}(d),I=this.decode.FLATE_DECODE,O="/Predictor ".concat(we," /Colors ").concat(P," /BitsPerComponent ").concat(C," /Columns ").concat(g),a=FV($,Math.ceil(g*P*C/8),P,C,d),J&&(R=FV(re,Math.ceil(g*H/8),1,H,d))):(I=void 0,O=void 0,a=$,J&&(R=re)),(this.__addimage__.isArrayBuffer(a)||this.__addimage__.isArrayBufferView(a))&&(a=this.__addimage__.arrayBufferToBinaryString(a)),(R&&this.__addimage__.isArrayBuffer(R)||this.__addimage__.isArrayBufferView(R))&&(R=this.__addimage__.arrayBufferToBinaryString(R)),{alias:c,data:a,index:o,filter:I,decodeParameters:O,transparency:ie,palette:ge,sMask:R,predictor:we,width:g,height:x,bitsPerComponent:C,sMaskBitsPerComponent:H,colorSpace:M}}},function(a){a.processGIF89A=function(o,c,d,h){var p=new Wge(o),g=p.width,x=p.height,v=[];p.decodeAndBlitFrameRGBA(0,v);var E={data:v,width:g,height:x},C=new QT(100).encode(E,100);return a.processJPEG.call(this,C,c,d,h)},a.processGIF87A=a.processGIF89A}(Qs.API),Zl.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var a=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(a);for(var o=0;o<a;o++){var c=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),p=this.datav.getUint8(this.pos++,!0);this.palette[o]={red:h,green:d,blue:c,quad:p}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Zl.prototype.parseBGR=function(){this.pos=this.offset;var a="bit"+this.bitPP,o=this.width*this.height*4;if(o>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(o);try{this[a]()}catch(c){Mn.log("bit decode error:"+c)}},Zl.prototype.bit1=function(){var a,o=Math.ceil(this.width/8),c=o%4;for(a=this.height-1;a>=0;a--){for(var d=this.bottom_up?a:this.height-1-a,h=0;h<o;h++)for(var p=this.datav.getUint8(this.pos++,!0),g=d*this.width*4+8*h*4,x=0;x<8&&8*h+x<this.width;x++){var v=this.palette[p>>7-x&1];this.data[g+4*x]=v.blue,this.data[g+4*x+1]=v.green,this.data[g+4*x+2]=v.red,this.data[g+4*x+3]=255}c!==0&&(this.pos+=4-c)}},Zl.prototype.bit4=function(){for(var a=Math.ceil(this.width/2),o=a%4,c=this.height-1;c>=0;c--){for(var d=this.bottom_up?c:this.height-1-c,h=0;h<a;h++){var p=this.datav.getUint8(this.pos++,!0),g=d*this.width*4+2*h*4,x=p>>4,v=15&p,E=this.palette[x];if(this.data[g]=E.blue,this.data[g+1]=E.green,this.data[g+2]=E.red,this.data[g+3]=255,2*h+1>=this.width)break;E=this.palette[v],this.data[g+4]=E.blue,this.data[g+4+1]=E.green,this.data[g+4+2]=E.red,this.data[g+4+3]=255}o!==0&&(this.pos+=4-o)}},Zl.prototype.bit8=function(){for(var a=this.width%4,o=this.height-1;o>=0;o--){for(var c=this.bottom_up?o:this.height-1-o,d=0;d<this.width;d++){var h=this.datav.getUint8(this.pos++,!0),p=c*this.width*4+4*d;if(h<this.palette.length){var g=this.palette[h];this.data[p]=g.red,this.data[p+1]=g.green,this.data[p+2]=g.blue,this.data[p+3]=255}else this.data[p]=255,this.data[p+1]=255,this.data[p+2]=255,this.data[p+3]=255}a!==0&&(this.pos+=4-a)}},Zl.prototype.bit15=function(){for(var a=this.width%3,o=parseInt("11111",2),c=this.height-1;c>=0;c--){for(var d=this.bottom_up?c:this.height-1-c,h=0;h<this.width;h++){var p=this.datav.getUint16(this.pos,!0);this.pos+=2;var g=(p&o)/o*255|0,x=(p>>5&o)/o*255|0,v=(p>>10&o)/o*255|0,E=p>>15?255:0,C=d*this.width*4+4*h;this.data[C]=v,this.data[C+1]=x,this.data[C+2]=g,this.data[C+3]=E}this.pos+=a}},Zl.prototype.bit16=function(){for(var a=this.width%3,o=parseInt("11111",2),c=parseInt("111111",2),d=this.height-1;d>=0;d--){for(var h=this.bottom_up?d:this.height-1-d,p=0;p<this.width;p++){var g=this.datav.getUint16(this.pos,!0);this.pos+=2;var x=(g&o)/o*255|0,v=(g>>5&c)/c*255|0,E=(g>>11)/o*255|0,C=h*this.width*4+4*p;this.data[C]=E,this.data[C+1]=v,this.data[C+2]=x,this.data[C+3]=255}this.pos+=a}},Zl.prototype.bit24=function(){for(var a=this.height-1;a>=0;a--){for(var o=this.bottom_up?a:this.height-1-a,c=0;c<this.width;c++){var d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),p=this.datav.getUint8(this.pos++,!0),g=o*this.width*4+4*c;this.data[g]=p,this.data[g+1]=h,this.data[g+2]=d,this.data[g+3]=255}this.pos+=this.width%4}},Zl.prototype.bit32=function(){for(var a=this.height-1;a>=0;a--)for(var o=this.bottom_up?a:this.height-1-a,c=0;c<this.width;c++){var d=this.datav.getUint8(this.pos++,!0),h=this.datav.getUint8(this.pos++,!0),p=this.datav.getUint8(this.pos++,!0),g=this.datav.getUint8(this.pos++,!0),x=o*this.width*4+4*c;this.data[x]=p,this.data[x+1]=h,this.data[x+2]=d,this.data[x+3]=g}},Zl.prototype.getData=function(){return this.data},function(a){a.processBMP=function(o,c,d,h){var p=new Zl(o,!1),g=p.width,x=p.height,v={data:p.getData(),width:g,height:x},E=new QT(100).encode(v,100);return a.processJPEG.call(this,E,c,d,h)}}(Qs.API),WV.prototype.getData=function(){return this.data},function(a){a.processWEBP=function(o,c,d,h){var p=new WV(o),g=p.width,x=p.height,v={data:p.getData(),width:g,height:x},E=new QT(100).encode(v,100);return a.processJPEG.call(this,E,c,d,h)}}(Qs.API),Qs.API.processRGBA=function(a,o,c){for(var d=a.data,h=d.length,p=new Uint8Array(h/4*3),g=new Uint8Array(h/4),x=0,v=0,E=0;E<h;E+=4){var C=d[E],I=d[E+1],O=d[E+2],R=d[E+3];p[x++]=C,p[x++]=I,p[x++]=O,g[v++]=R}var k=this.__addimage__.arrayBufferToBinaryString(p);return{alpha:this.__addimage__.arrayBufferToBinaryString(g),data:k,index:o,alias:c,colorSpace:"DeviceRGB",bitsPerComponent:8,width:a.width,height:a.height}},Qs.API.setLanguage=function(a){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[a]!==void 0&&(this.internal.languageSettings.languageCode=a,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},og=Qs.API,fy=og.getCharWidthsArray=function(a,o){var c,d,h=(o=o||{}).font||this.internal.getFont(),p=o.fontSize||this.internal.getFontSize(),g=o.charSpace||this.internal.getCharSpace(),x=o.widths?o.widths:h.metadata.Unicode.widths,v=x.fof?x.fof:1,E=o.kerning?o.kerning:h.metadata.Unicode.kerning,C=E.fof?E.fof:1,I=o.doKerning!==!1,O=0,R=a.length,k=0,M=x[0]||v,P=[];for(c=0;c<R;c++)d=a.charCodeAt(c),typeof h.metadata.widthOfString=="function"?P.push((h.metadata.widthOfGlyph(h.metadata.characterToGlyph(d))+g*(1e3/p)||0)/1e3):(O=I&&_n(E[d])==="object"&&!isNaN(parseInt(E[d][k],10))?E[d][k]/C:0,P.push((x[d]||M)/v+O)),k=d;return P},jV=og.getStringUnitWidth=function(a,o){var c=(o=o||{}).fontSize||this.internal.getFontSize(),d=o.font||this.internal.getFont(),h=o.charSpace||this.internal.getCharSpace();return og.processArabic&&(a=og.processArabic(a)),typeof d.metadata.widthOfString=="function"?d.metadata.widthOfString(a,c,h)/c:fy.apply(this,arguments).reduce(function(p,g){return p+g},0)},PV=function(a,o,c,d){for(var h=[],p=0,g=a.length,x=0;p!==g&&x+o[p]<c;)x+=o[p],p++;h.push(a.slice(0,p));var v=p;for(x=0;p!==g;)x+o[p]>d&&(h.push(a.slice(v,p)),x=0,v=p),x+=o[p],p++;return v!==p&&h.push(a.slice(v,p)),h},UV=function(a,o,c){c||(c={});var d,h,p,g,x,v,E,C=[],I=[C],O=c.textIndent||0,R=0,k=0,M=a.split(" "),P=fy.apply(this,[" ",c])[0];if(v=c.lineIndent===-1?M[0].length+2:c.lineIndent||0){var H=Array(v).join(" "),$=[];M.map(function(J){(J=J.split(/\s*\n/)).length>1?$=$.concat(J.map(function(ge,ie){return(ie&&ge.length?`
`:"")+ge})):$.push(J[0])}),M=$,v=jV.apply(this,[H,c])}for(p=0,g=M.length;p<g;p++){var re=0;if(d=M[p],v&&d[0]==`
`&&(d=d.substr(1),re=1),O+R+(k=(h=fy.apply(this,[d,c])).reduce(function(J,ge){return J+ge},0))>o||re){if(k>o){for(x=PV.apply(this,[d,h,o-(O+R),o]),C.push(x.shift()),C=[x.pop()];x.length;)I.push([x.shift()]);k=h.slice(d.length-(C[0]?C[0].length:0)).reduce(function(J,ge){return J+ge},0)}else C=[d];I.push(C),O=k+v,R=P}else C.push(d),O+=R+k,R=P}return E=v?function(J,ge){return(ge?H:"")+J.join(" ")}:function(J){return J.join(" ")},I.map(E)},og.splitTextToSize=function(a,o,c){var d,h=(c=c||{}).fontSize||this.internal.getFontSize(),p=(function(C){if(C.widths&&C.kerning)return{widths:C.widths,kerning:C.kerning};var I=this.internal.getFont(C.fontName,C.fontStyle),O="Unicode";return I.metadata[O]?{widths:I.metadata[O].widths||{0:1},kerning:I.metadata[O].kerning||{}}:{font:I.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,c);d=Array.isArray(a)?a:String(a).split(/\r?\n/);var g=1*this.internal.scaleFactor*o/h;p.textIndent=c.textIndent?1*c.textIndent*this.internal.scaleFactor/h:0,p.lineIndent=c.lineIndent;var x,v,E=[];for(x=0,v=d.length;x<v;x++)E=E.concat(UV.apply(this,[d[x],g,p]));return E},function(a){a.__fontmetrics__=a.__fontmetrics__||{};for(var o="0123456789abcdef",c="klmnopqrstuvwxyz",d={},h={},p=0;p<16;p++)d[c[p]]=o[p],h[o[p]]=c[p];var g=function(O){return"0x"+parseInt(O,10).toString(16)},x=a.__fontmetrics__.compress=function(O){var R,k,M,P,H=["{"];for(var $ in O){if(R=O[$],isNaN(parseInt($,10))?k="'"+$+"'":($=parseInt($,10),k=(k=g($).slice(2)).slice(0,-1)+h[k.slice(-1)]),typeof R=="number")R<0?(M=g(R).slice(3),P="-"):(M=g(R).slice(2),P=""),M=P+M.slice(0,-1)+h[M.slice(-1)];else{if(_n(R)!=="object")throw new Error("Don't know what to do with value type "+_n(R)+".");M=x(R)}H.push(k+M)}return H.push("}"),H.join("")},v=a.__fontmetrics__.uncompress=function(O){if(typeof O!="string")throw new Error("Invalid argument passed to uncompress.");for(var R,k,M,P,H={},$=1,re=H,J=[],ge="",ie="",we=O.length-1,Ae=1;Ae<we;Ae+=1)(P=O[Ae])=="'"?R?(M=R.join(""),R=void 0):R=[]:R?R.push(P):P=="{"?(J.push([re,M]),re={},M=void 0):P=="}"?((k=J.pop())[0][k[1]]=re,M=void 0,re=k[0]):P=="-"?$=-1:M===void 0?d.hasOwnProperty(P)?(ge+=d[P],M=parseInt(ge,16)*$,$=1,ge=""):ge+=P:d.hasOwnProperty(P)?(ie+=d[P],re[M]=parseInt(ie,16)*$,$=1,M=void 0,ie=""):ie+=P;return H},E={codePages:["WinAnsiEncoding"],WinAnsiEncoding:v("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},C={Unicode:{Courier:E,"Courier-Bold":E,"Courier-BoldOblique":E,"Courier-Oblique":E,Helvetica:E,"Helvetica-Bold":E,"Helvetica-BoldOblique":E,"Helvetica-Oblique":E,"Times-Roman":E,"Times-Bold":E,"Times-BoldItalic":E,"Times-Italic":E}},I={Unicode:{"Courier-Oblique":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":v("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":v("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":v("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:v("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:v("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":v("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:v("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":v("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":v("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":v("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":v("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};a.events.push(["addFont",function(O){var R=O.font,k=I.Unicode[R.postScriptName];k&&(R.metadata.Unicode={},R.metadata.Unicode.widths=k.widths,R.metadata.Unicode.kerning=k.kerning);var M=C.Unicode[R.postScriptName];M&&(R.metadata.Unicode.encoding=M,R.encoding=M.codePages[0])}])}(Qs.API),function(a){var o=function(c){for(var d=c.length,h=new Uint8Array(d),p=0;p<d;p++)h[p]=c.charCodeAt(p);return h};a.API.events.push(["addFont",function(c){var d=void 0,h=c.font,p=c.instance;if(!h.isStandardFont){if(p===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+h.postScriptName+"').");if(typeof(d=p.existsFileInVFS(h.postScriptName)===!1?p.loadFile(h.postScriptName):p.getFileFromVFS(h.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+h.postScriptName+"').");(function(g,x){x=/^\x00\x01\x00\x00/.test(x)?o(x):o(Ty(x)),g.metadata=a.API.TTFFont.open(x),g.metadata.Unicode=g.metadata.Unicode||{encoding:{},kerning:{},widths:[]},g.metadata.glyIdsUsed=[0]})(h,d)}}])}(Qs),Qs.API.addSvgAsImage=function(a,o,c,d,h,p,g,x){if(isNaN(o)||isNaN(c))throw Mn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(d)||isNaN(h))throw Mn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var v=document.createElement("canvas");v.width=d,v.height=h;var E=v.getContext("2d");E.fillStyle="#fff",E.fillRect(0,0,v.width,v.height);var C={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return(ar.canvg?Promise.resolve(ar.canvg):wT(()=>import("./index.es-Dnu_DjK3.js"),__vite__mapDeps([0,1,2]))).catch(function(O){return Promise.reject(new Error("Could not load canvg: "+O))}).then(function(O){return O.default?O.default:O}).then(function(O){return O.fromString(E,a,C)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(O){return O.render(C)}).then(function(){I.addImage(v.toDataURL("image/jpeg",1),o,c,d,h,g,x)})},Qs.API.putTotalPages=function(a){var o,c=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(o=new RegExp(a,"g"),c=this.internal.getNumberOfPages()):(o=new RegExp(this.pdfEscape16(a,this.internal.getFont()),"g"),c=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var d=1;d<=this.internal.getNumberOfPages();d++)for(var h=0;h<this.internal.pages[d].length;h++)this.internal.pages[d][h]=this.internal.pages[d][h].replace(o,c);return this},Qs.API.viewerPreferences=function(a,o){var c;a=a||{},o=o||!1;var d,h,p,g={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},x=Object.keys(g),v=[],E=0,C=0,I=0;function O(k,M){var P,H=!1;for(P=0;P<k.length;P+=1)k[P]===M&&(H=!0);return H}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(g)),this.internal.viewerpreferences.isSubscribed=!1),c=this.internal.viewerpreferences.configuration,a==="reset"||o===!0){var R=x.length;for(I=0;I<R;I+=1)c[x[I]].value=c[x[I]].defaultValue,c[x[I]].explicitSet=!1}if(_n(a)==="object"){for(h in a)if(p=a[h],O(x,h)&&p!==void 0){if(c[h].type==="boolean"&&typeof p=="boolean")c[h].value=p;else if(c[h].type==="name"&&O(c[h].valueSet,p))c[h].value=p;else if(c[h].type==="integer"&&Number.isInteger(p))c[h].value=p;else if(c[h].type==="array"){for(E=0;E<p.length;E+=1)if(d=!0,p[E].length===1&&typeof p[E][0]=="number")v.push(String(p[E]-1));else if(p[E].length>1){for(C=0;C<p[E].length;C+=1)typeof p[E][C]!="number"&&(d=!1);d===!0&&v.push([p[E][0]-1,p[E][1]-1].join(" "))}c[h].value="["+v.join(" ")+"]"}else c[h].value=c[h].defaultValue;c[h].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var k,M=[];for(k in c)c[k].explicitSet===!0&&(c[k].type==="name"?M.push("/"+k+" /"+c[k].value):M.push("/"+k+" "+c[k].value));M.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+M.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=c,this},Qs.API.addMetadata=function(a,o){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:a,namespaceUri:o??"http://jspdf.default.namespaceuri/",rawXml:typeof o=="boolean"&&o},this.internal.events.subscribe("putCatalog",qge),this.internal.events.subscribe("postPutResources",zge)),this},function(a){var o=a.API,c=o.pdfEscape16=function(p,g){for(var x,v=g.metadata.Unicode.widths,E=["","0","00","000","0000"],C=[""],I=0,O=p.length;I<O;++I){if(x=g.metadata.characterToGlyph(p.charCodeAt(I)),g.metadata.glyIdsUsed.push(x),g.metadata.toUnicode[x]=p.charCodeAt(I),v.indexOf(x)==-1&&(v.push(x),v.push([parseInt(g.metadata.widthOfGlyph(x),10)])),x=="0")return C.join("");x=x.toString(16),C.push(E[4-x.length],x)}return C.join("")},d=function(p){var g,x,v,E,C,I,O;for(C=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,v=[],I=0,O=(x=Object.keys(p).sort(function(R,k){return R-k})).length;I<O;I++)g=x[I],v.length>=100&&(C+=`
`+v.length+` beginbfchar
`+v.join(`
`)+`
endbfchar`,v=[]),p[g]!==void 0&&p[g]!==null&&typeof p[g].toString=="function"&&(E=("0000"+p[g].toString(16)).slice(-4),g=("0000"+(+g).toString(16)).slice(-4),v.push("<"+g+"><"+E+">"));return v.length&&(C+=`
`+v.length+` beginbfchar
`+v.join(`
`)+`
endbfchar
`),C+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};o.events.push(["putFont",function(p){(function(g){var x=g.font,v=g.out,E=g.newObject,C=g.putStream;if(x.metadata instanceof a.API.TTFFont&&x.encoding==="Identity-H"){for(var I=x.metadata.Unicode.widths,O=x.metadata.subset.encode(x.metadata.glyIdsUsed,1),R="",k=0;k<O.length;k++)R+=String.fromCharCode(O[k]);var M=E();C({data:R,addLength1:!0,objectId:M}),v("endobj");var P=E();C({data:d(x.metadata.toUnicode),addLength1:!0,objectId:P}),v("endobj");var H=E();v("<<"),v("/Type /FontDescriptor"),v("/FontName /"+pg(x.fontName)),v("/FontFile2 "+M+" 0 R"),v("/FontBBox "+a.API.PDFObject.convert(x.metadata.bbox)),v("/Flags "+x.metadata.flags),v("/StemV "+x.metadata.stemV),v("/ItalicAngle "+x.metadata.italicAngle),v("/Ascent "+x.metadata.ascender),v("/Descent "+x.metadata.decender),v("/CapHeight "+x.metadata.capHeight),v(">>"),v("endobj");var $=E();v("<<"),v("/Type /Font"),v("/BaseFont /"+pg(x.fontName)),v("/FontDescriptor "+H+" 0 R"),v("/W "+a.API.PDFObject.convert(I)),v("/CIDToGIDMap /Identity"),v("/DW 1000"),v("/Subtype /CIDFontType2"),v("/CIDSystemInfo"),v("<<"),v("/Supplement 0"),v("/Registry (Adobe)"),v("/Ordering ("+x.encoding+")"),v(">>"),v(">>"),v("endobj"),x.objectNumber=E(),v("<<"),v("/Type /Font"),v("/Subtype /Type0"),v("/ToUnicode "+P+" 0 R"),v("/BaseFont /"+pg(x.fontName)),v("/Encoding /"+x.encoding),v("/DescendantFonts ["+$+" 0 R]"),v(">>"),v("endobj"),x.isAlreadyPutted=!0}})(p)}]),o.events.push(["putFont",function(p){(function(g){var x=g.font,v=g.out,E=g.newObject,C=g.putStream;if(x.metadata instanceof a.API.TTFFont&&x.encoding==="WinAnsiEncoding"){for(var I=x.metadata.rawData,O="",R=0;R<I.length;R++)O+=String.fromCharCode(I[R]);var k=E();C({data:O,addLength1:!0,objectId:k}),v("endobj");var M=E();C({data:d(x.metadata.toUnicode),addLength1:!0,objectId:M}),v("endobj");var P=E();v("<<"),v("/Descent "+x.metadata.decender),v("/CapHeight "+x.metadata.capHeight),v("/StemV "+x.metadata.stemV),v("/Type /FontDescriptor"),v("/FontFile2 "+k+" 0 R"),v("/Flags 96"),v("/FontBBox "+a.API.PDFObject.convert(x.metadata.bbox)),v("/FontName /"+pg(x.fontName)),v("/ItalicAngle "+x.metadata.italicAngle),v("/Ascent "+x.metadata.ascender),v(">>"),v("endobj"),x.objectNumber=E();for(var H=0;H<x.metadata.hmtx.widths.length;H++)x.metadata.hmtx.widths[H]=parseInt(x.metadata.hmtx.widths[H]*(1e3/x.metadata.head.unitsPerEm));v("<</Subtype/TrueType/Type/Font/ToUnicode "+M+" 0 R/BaseFont/"+pg(x.fontName)+"/FontDescriptor "+P+" 0 R/Encoding/"+x.encoding+" /FirstChar 29 /LastChar 255 /Widths "+a.API.PDFObject.convert(x.metadata.hmtx.widths)+">>"),v("endobj"),x.isAlreadyPutted=!0}})(p)}]);var h=function(p){var g,x=p.text||"",v=p.x,E=p.y,C=p.options||{},I=p.mutex||{},O=I.pdfEscape,R=I.activeFontKey,k=I.fonts,M=R,P="",H=0,$="",re=k[M].encoding;if(k[M].encoding!=="Identity-H")return{text:x,x:v,y:E,options:C,mutex:I};for($=x,M=R,Array.isArray(x)&&($=x[0]),H=0;H<$.length;H+=1)k[M].metadata.hasOwnProperty("cmap")&&(g=k[M].metadata.cmap.unicode.codeMap[$[H].charCodeAt(0)]),g||$[H].charCodeAt(0)<256&&k[M].metadata.hasOwnProperty("Unicode")?P+=$[H]:P+="";var J="";return parseInt(M.slice(1))<14||re==="WinAnsiEncoding"?J=O(P,M).split("").map(function(ge){return ge.charCodeAt(0).toString(16)}).join(""):re==="Identity-H"&&(J=c(P,k[M])),I.isHex=!0,{text:J,x:v,y:E,options:C,mutex:I}};o.events.push(["postProcessText",function(p){var g=p.text||"",x=[],v={text:g,x:p.x,y:p.y,options:p.options,mutex:p.mutex};if(Array.isArray(g)){var E=0;for(E=0;E<g.length;E+=1)Array.isArray(g[E])&&g[E].length===3?x.push([h(Object.assign({},v,{text:g[E][0]})).text,g[E][1],g[E][2]]):x.push(h(Object.assign({},v,{text:g[E]})).text);p.text=x}else p.text=h(Object.assign({},v,{text:g})).text}])}(Qs),function(a){var o=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};a.existsFileInVFS=function(c){return o.call(this),this.internal.vFS[c]!==void 0},a.addFileToVFS=function(c,d){return o.call(this),this.internal.vFS[c]=d,this},a.getFileFromVFS=function(c){return o.call(this),this.internal.vFS[c]!==void 0?this.internal.vFS[c]:null}}(Qs.API),function(a){a.__bidiEngine__=a.prototype.__bidiEngine__=function(d){var h,p,g,x,v,E,C,I=o,O=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],R=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],k={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},M={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},P=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],H=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),$=!1,re=0;this.__bidiEngine__={};var J=function(Y){var z=Y.charCodeAt(),te=z>>8,se=M[te];return se!==void 0?I[256*se+(255&z)]:te===252||te===253?"AL":H.test(te)?"L":te===8?"R":"N"},ge=function(Y){for(var z,te=0;te<Y.length;te++){if((z=J(Y.charAt(te)))==="L")return!1;if(z==="R")return!0}return!1},ie=function(Y,z,te,se){var Ce,he,Ne,Z,Ie=z[se];switch(Ie){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":$=!1;break;case"N":case"AN":break;case"EN":$&&(Ie="AN");break;case"AL":$=!0,Ie="R";break;case"WS":case"BN":Ie="N";break;case"CS":se<1||se+1>=z.length||(Ce=te[se-1])!=="EN"&&Ce!=="AN"||(he=z[se+1])!=="EN"&&he!=="AN"?Ie="N":$&&(he="AN"),Ie=he===Ce?he:"N";break;case"ES":Ie=(Ce=se>0?te[se-1]:"B")==="EN"&&se+1<z.length&&z[se+1]==="EN"?"EN":"N";break;case"ET":if(se>0&&te[se-1]==="EN"){Ie="EN";break}if($){Ie="N";break}for(Ne=se+1,Z=z.length;Ne<Z&&z[Ne]==="ET";)Ne++;Ie=Ne<Z&&z[Ne]==="EN"?"EN":"N";break;case"NSM":if(g&&!x){for(Z=z.length,Ne=se+1;Ne<Z&&z[Ne]==="NSM";)Ne++;if(Ne<Z){var Ve=Y[se],Pe=Ve>=1425&&Ve<=2303||Ve===64286;if(Ce=z[Ne],Pe&&(Ce==="R"||Ce==="AL")){Ie="R";break}}}Ie=se<1||(Ce=z[se-1])==="B"?"N":te[se-1];break;case"B":$=!1,h=!0,Ie=re;break;case"S":p=!0,Ie="N"}return Ie},we=function(Y,z,te){var se=Y.split("");return te&&Ae(se,te,{hiLevel:re}),se.reverse(),z&&z.reverse(),se.join("")},Ae=function(Y,z,te){var se,Ce,he,Ne,Z,Ie=-1,Ve=Y.length,Pe=0,ne=[],ve=re?R:O,ue=[];for($=!1,h=!1,p=!1,Ce=0;Ce<Ve;Ce++)ue[Ce]=J(Y[Ce]);for(he=0;he<Ve;he++){if(Z=Pe,ne[he]=ie(Y,ue,ne,he),se=240&(Pe=ve[Z][k[ne[he]]]),Pe&=15,z[he]=Ne=ve[Pe][5],se>0)if(se===16){for(Ce=Ie;Ce<he;Ce++)z[Ce]=1;Ie=-1}else Ie=-1;if(ve[Pe][6])Ie===-1&&(Ie=he);else if(Ie>-1){for(Ce=Ie;Ce<he;Ce++)z[Ce]=Ne;Ie=-1}ue[he]==="B"&&(z[he]=0),te.hiLevel|=Ne}p&&function(Te,Be,Ue){for(var tt=0;tt<Ue;tt++)if(Te[tt]==="S"){Be[tt]=re;for(var ot=tt-1;ot>=0&&Te[ot]==="WS";ot--)Be[ot]=re}}(ue,z,Ve)},V=function(Y,z,te,se,Ce){if(!(Ce.hiLevel<Y)){if(Y===1&&re===1&&!h)return z.reverse(),void(te&&te.reverse());for(var he,Ne,Z,Ie,Ve=z.length,Pe=0;Pe<Ve;){if(se[Pe]>=Y){for(Z=Pe+1;Z<Ve&&se[Z]>=Y;)Z++;for(Ie=Pe,Ne=Z-1;Ie<Ne;Ie++,Ne--)he=z[Ie],z[Ie]=z[Ne],z[Ne]=he,te&&(he=te[Ie],te[Ie]=te[Ne],te[Ne]=he);Pe=Z}Pe++}}},ce=function(Y,z,te){var se=Y.split(""),Ce={hiLevel:re};return te||(te=[]),Ae(se,te,Ce),function(he,Ne,Z){if(Z.hiLevel!==0&&C)for(var Ie,Ve=0;Ve<he.length;Ve++)Ne[Ve]===1&&(Ie=P.indexOf(he[Ve]))>=0&&(he[Ve]=P[Ie+1])}(se,te,Ce),V(2,se,z,te,Ce),V(1,se,z,te,Ce),se.join("")};return this.__bidiEngine__.doBidiReorder=function(Y,z,te){if(function(Ce,he){if(he)for(var Ne=0;Ne<Ce.length;Ne++)he[Ne]=Ne;x===void 0&&(x=ge(Ce)),E===void 0&&(E=ge(Ce))}(Y,z),g||!v||E)if(g&&v&&x^E)re=x?1:0,Y=we(Y,z,te);else if(!g&&v&&E)re=x?1:0,Y=ce(Y,z,te),Y=we(Y,z);else if(!g||x||v||E){if(g&&!v&&x^E)Y=we(Y,z),x?(re=0,Y=ce(Y,z,te)):(re=1,Y=ce(Y,z,te),Y=we(Y,z));else if(g&&x&&!v&&E)re=1,Y=ce(Y,z,te),Y=we(Y,z);else if(!g&&!v&&x^E){var se=C;x?(re=1,Y=ce(Y,z,te),re=0,C=!1,Y=ce(Y,z,te),C=se):(re=0,Y=ce(Y,z,te),Y=we(Y,z),re=1,C=!1,Y=ce(Y,z,te),C=se,Y=we(Y,z))}}else re=0,Y=ce(Y,z,te);else re=x?1:0,Y=ce(Y,z,te);return Y},this.__bidiEngine__.setOptions=function(Y){Y&&(g=Y.isInputVisual,v=Y.isOutputVisual,x=Y.isInputRtl,E=Y.isOutputRtl,C=Y.isSymmetricSwapping)},this.__bidiEngine__.setOptions(d),this.__bidiEngine__};var o=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],c=new a.__bidiEngine__({isInputVisual:!0});a.API.events.push(["postProcessText",function(d){var h=d.text;d.x,d.y;var p=d.options||{};d.mutex,p.lang;var g=[];if(p.isInputVisual=typeof p.isInputVisual!="boolean"||p.isInputVisual,c.setOptions(p),Object.prototype.toString.call(h)==="[object Array]"){var x=0;for(g=[],x=0;x<h.length;x+=1)Object.prototype.toString.call(h[x])==="[object Array]"?g.push([c.doBidiReorder(h[x][0]),h[x][1],h[x][2]]):g.push([c.doBidiReorder(h[x])]);d.text=g}else d.text=c.doBidiReorder(h);c.setOptions({isInputVisual:!0})}])}(Qs),Qs.API.TTFFont=function(){function a(o){var c;if(this.rawData=o,c=this.contents=new ph(o),this.contents.pos=4,c.readString(4)==="ttcf")throw new Error("TTCF not supported.");c.pos=0,this.parse(),this.subset=new l0e(this),this.registerTTF()}return a.open=function(o){return new a(o)},a.prototype.parse=function(){return this.directory=new Yge(this.contents),this.head=new Jge(this),this.name=new s0e(this),this.cmap=new vG(this),this.toUnicode={},this.hhea=new $ge(this),this.maxp=new r0e(this),this.hmtx=new n0e(this),this.post=new e0e(this),this.os2=new Zge(this),this.loca=new c0e(this),this.glyf=new i0e(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},a.prototype.registerTTF=function(){var o,c,d,h,p;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var g,x,v,E;for(E=[],g=0,x=(v=this.bbox).length;g<x;g++)o=v[g],E.push(Math.round(o*this.scaleFactor));return E}).call(this),this.stemV=0,this.post.exists?(d=255&(h=this.post.italic_angle),32768&(c=h>>16)&&(c=-(1+(65535^c))),this.italicAngle=+(c+"."+d)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(p=this.familyClass)===1||p===2||p===3||p===4||p===5||p===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},a.prototype.characterToGlyph=function(o){var c;return((c=this.cmap.unicode)!=null?c.codeMap[o]:void 0)||0},a.prototype.widthOfGlyph=function(o){var c;return c=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(o).advance*c},a.prototype.widthOfString=function(o,c,d){var h,p,g,x;for(g=0,p=0,x=(o=""+o).length;0<=x?p<x:p>x;p=0<=x?++p:--p)h=o.charCodeAt(p),g+=this.widthOfGlyph(this.characterToGlyph(h))+d*(1e3/c)||0;return g*(c/1e3)},a.prototype.lineHeight=function(o,c){var d;return c==null&&(c=!1),d=c?this.lineGap:0,(this.ascender+d-this.decender)/1e3*o},a}();var od,ph=function(){function a(o){this.data=o??[],this.pos=0,this.length=this.data.length}return a.prototype.readByte=function(){return this.data[this.pos++]},a.prototype.writeByte=function(o){return this.data[this.pos++]=o},a.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},a.prototype.writeUInt32=function(o){return this.writeByte(o>>>24&255),this.writeByte(o>>16&255),this.writeByte(o>>8&255),this.writeByte(255&o)},a.prototype.readInt32=function(){var o;return(o=this.readUInt32())>=2147483648?o-4294967296:o},a.prototype.writeInt32=function(o){return o<0&&(o+=4294967296),this.writeUInt32(o)},a.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},a.prototype.writeUInt16=function(o){return this.writeByte(o>>8&255),this.writeByte(255&o)},a.prototype.readInt16=function(){var o;return(o=this.readUInt16())>=32768?o-65536:o},a.prototype.writeInt16=function(o){return o<0&&(o+=65536),this.writeUInt16(o)},a.prototype.readString=function(o){var c,d;for(d=[],c=0;0<=o?c<o:c>o;c=0<=o?++c:--c)d[c]=String.fromCharCode(this.readByte());return d.join("")},a.prototype.writeString=function(o){var c,d,h;for(h=[],c=0,d=o.length;0<=d?c<d:c>d;c=0<=d?++c:--c)h.push(this.writeByte(o.charCodeAt(c)));return h},a.prototype.readShort=function(){return this.readInt16()},a.prototype.writeShort=function(o){return this.writeInt16(o)},a.prototype.readLongLong=function(){var o,c,d,h,p,g,x,v;return o=this.readByte(),c=this.readByte(),d=this.readByte(),h=this.readByte(),p=this.readByte(),g=this.readByte(),x=this.readByte(),v=this.readByte(),128&o?-1*(72057594037927940*(255^o)+281474976710656*(255^c)+1099511627776*(255^d)+4294967296*(255^h)+16777216*(255^p)+65536*(255^g)+256*(255^x)+(255^v)+1):72057594037927940*o+281474976710656*c+1099511627776*d+4294967296*h+16777216*p+65536*g+256*x+v},a.prototype.writeLongLong=function(o){var c,d;return c=Math.floor(o/4294967296),d=4294967295&o,this.writeByte(c>>24&255),this.writeByte(c>>16&255),this.writeByte(c>>8&255),this.writeByte(255&c),this.writeByte(d>>24&255),this.writeByte(d>>16&255),this.writeByte(d>>8&255),this.writeByte(255&d)},a.prototype.readInt=function(){return this.readInt32()},a.prototype.writeInt=function(o){return this.writeInt32(o)},a.prototype.read=function(o){var c,d;for(c=[],d=0;0<=o?d<o:d>o;d=0<=o?++d:--d)c.push(this.readByte());return c},a.prototype.write=function(o){var c,d,h,p;for(p=[],d=0,h=o.length;d<h;d++)c=o[d],p.push(this.writeByte(c));return p},a}(),Yge=function(){var a;function o(c){var d,h,p;for(this.scalarType=c.readInt(),this.tableCount=c.readShort(),this.searchRange=c.readShort(),this.entrySelector=c.readShort(),this.rangeShift=c.readShort(),this.tables={},h=0,p=this.tableCount;0<=p?h<p:h>p;h=0<=p?++h:--h)d={tag:c.readString(4),checksum:c.readInt(),offset:c.readInt(),length:c.readInt()},this.tables[d.tag]=d}return o.prototype.encode=function(c){var d,h,p,g,x,v,E,C,I,O,R,k,M;for(M in R=Object.keys(c).length,v=Math.log(2),I=16*Math.floor(Math.log(R)/v),g=Math.floor(I/v),C=16*R-I,(h=new ph).writeInt(this.scalarType),h.writeShort(R),h.writeShort(I),h.writeShort(g),h.writeShort(C),p=16*R,E=h.pos+p,x=null,k=[],c)for(O=c[M],h.writeString(M),h.writeInt(a(O)),h.writeInt(E),h.writeInt(O.length),k=k.concat(O),M==="head"&&(x=E),E+=O.length;E%4;)k.push(0),E++;return h.write(k),d=2981146554-a(h.data),h.pos=x+8,h.writeUInt32(d),h.data},a=function(c){var d,h,p,g;for(c=wG.call(c);c.length%4;)c.push(0);for(p=new ph(c),h=0,d=0,g=c.length;d<g;d=d+=4)h+=p.readUInt32();return 4294967295&h},o}(),Xge={}.hasOwnProperty,eA=function(a,o){for(var c in o)Xge.call(o,c)&&(a[c]=o[c]);function d(){this.constructor=a}return d.prototype=o.prototype,a.prototype=new d,a.__super__=o.prototype,a};od=function(){function a(o){var c;this.file=o,c=this.file.directory.tables[this.tag],this.exists=!!c,c&&(this.offset=c.offset,this.length=c.length,this.parse(this.file.contents))}return a.prototype.parse=function(){},a.prototype.encode=function(){},a.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},a}();var Jge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="head",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.revision=o.readInt(),this.checkSumAdjustment=o.readInt(),this.magicNumber=o.readInt(),this.flags=o.readShort(),this.unitsPerEm=o.readShort(),this.created=o.readLongLong(),this.modified=o.readLongLong(),this.xMin=o.readShort(),this.yMin=o.readShort(),this.xMax=o.readShort(),this.yMax=o.readShort(),this.macStyle=o.readShort(),this.lowestRecPPEM=o.readShort(),this.fontDirectionHint=o.readShort(),this.indexToLocFormat=o.readShort(),this.glyphDataFormat=o.readShort()},a.prototype.encode=function(o){var c;return(c=new ph).writeInt(this.version),c.writeInt(this.revision),c.writeInt(this.checkSumAdjustment),c.writeInt(this.magicNumber),c.writeShort(this.flags),c.writeShort(this.unitsPerEm),c.writeLongLong(this.created),c.writeLongLong(this.modified),c.writeShort(this.xMin),c.writeShort(this.yMin),c.writeShort(this.xMax),c.writeShort(this.yMax),c.writeShort(this.macStyle),c.writeShort(this.lowestRecPPEM),c.writeShort(this.fontDirectionHint),c.writeShort(o),c.writeShort(this.glyphDataFormat),c.data},a}(),zV=function(){function a(o,c){var d,h,p,g,x,v,E,C,I,O,R,k,M,P,H,$,re;switch(this.platformID=o.readUInt16(),this.encodingID=o.readShort(),this.offset=c+o.readInt(),I=o.pos,o.pos=this.offset,this.format=o.readUInt16(),this.length=o.readUInt16(),this.language=o.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(v=0;v<256;++v)this.codeMap[v]=o.readByte();break;case 4:for(R=o.readUInt16(),O=R/2,o.pos+=6,p=function(){var J,ge;for(ge=[],v=J=0;0<=O?J<O:J>O;v=0<=O?++J:--J)ge.push(o.readUInt16());return ge}(),o.pos+=2,M=function(){var J,ge;for(ge=[],v=J=0;0<=O?J<O:J>O;v=0<=O?++J:--J)ge.push(o.readUInt16());return ge}(),E=function(){var J,ge;for(ge=[],v=J=0;0<=O?J<O:J>O;v=0<=O?++J:--J)ge.push(o.readUInt16());return ge}(),C=function(){var J,ge;for(ge=[],v=J=0;0<=O?J<O:J>O;v=0<=O?++J:--J)ge.push(o.readUInt16());return ge}(),h=(this.length-o.pos+this.offset)/2,x=function(){var J,ge;for(ge=[],v=J=0;0<=h?J<h:J>h;v=0<=h?++J:--J)ge.push(o.readUInt16());return ge}(),v=H=0,re=p.length;H<re;v=++H)for(P=p[v],d=$=k=M[v];k<=P?$<=P:$>=P;d=k<=P?++$:--$)C[v]===0?g=d+E[v]:(g=x[C[v]/2+(d-k)-(O-v)]||0)!==0&&(g+=E[v]),this.codeMap[d]=65535&g}o.pos=I}return a.encode=function(o,c){var d,h,p,g,x,v,E,C,I,O,R,k,M,P,H,$,re,J,ge,ie,we,Ae,V,ce,Y,z,te,se,Ce,he,Ne,Z,Ie,Ve,Pe,ne,ve,ue,Te,Be,Ue,tt,ot,ut,Tt,Qe;switch(se=new ph,g=Object.keys(o).sort(function(it,kt){return it-kt}),c){case"macroman":for(M=0,P=function(){var it=[];for(k=0;k<256;++k)it.push(0);return it}(),$={0:0},p={},Ce=0,Ie=g.length;Ce<Ie;Ce++)$[ot=o[h=g[Ce]]]==null&&($[ot]=++M),p[h]={old:o[h],new:$[o[h]]},P[h]=$[o[h]];return se.writeUInt16(1),se.writeUInt16(0),se.writeUInt32(12),se.writeUInt16(0),se.writeUInt16(262),se.writeUInt16(0),se.write(P),{charMap:p,subtable:se.data,maxGlyphID:M+1};case"unicode":for(z=[],I=[],re=0,$={},d={},H=E=null,he=0,Ve=g.length;he<Ve;he++)$[ge=o[h=g[he]]]==null&&($[ge]=++re),d[h]={old:ge,new:$[ge]},x=$[ge]-h,H!=null&&x===E||(H&&I.push(H),z.push(h),E=x),H=h;for(H&&I.push(H),I.push(65535),z.push(65535),ce=2*(V=z.length),Ae=2*Math.pow(Math.log(V)/Math.LN2,2),O=Math.log(Ae/2)/Math.LN2,we=2*V-Ae,v=[],ie=[],R=[],k=Ne=0,Pe=z.length;Ne<Pe;k=++Ne){if(Y=z[k],C=I[k],Y===65535){v.push(0),ie.push(0);break}if(Y-(te=d[Y].new)>=32768)for(v.push(0),ie.push(2*(R.length+V-k)),h=Z=Y;Y<=C?Z<=C:Z>=C;h=Y<=C?++Z:--Z)R.push(d[h].new);else v.push(te-Y),ie.push(0)}for(se.writeUInt16(3),se.writeUInt16(1),se.writeUInt32(12),se.writeUInt16(4),se.writeUInt16(16+8*V+2*R.length),se.writeUInt16(0),se.writeUInt16(ce),se.writeUInt16(Ae),se.writeUInt16(O),se.writeUInt16(we),Ue=0,ne=I.length;Ue<ne;Ue++)h=I[Ue],se.writeUInt16(h);for(se.writeUInt16(0),tt=0,ve=z.length;tt<ve;tt++)h=z[tt],se.writeUInt16(h);for(ut=0,ue=v.length;ut<ue;ut++)x=v[ut],se.writeUInt16(x);for(Tt=0,Te=ie.length;Tt<Te;Tt++)J=ie[Tt],se.writeUInt16(J);for(Qe=0,Be=R.length;Qe<Be;Qe++)M=R[Qe],se.writeUInt16(M);return{charMap:d,subtable:se.data,maxGlyphID:re+1}}},a}(),vG=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="cmap",a.prototype.parse=function(o){var c,d,h;for(o.pos=this.offset,this.version=o.readUInt16(),h=o.readUInt16(),this.tables=[],this.unicode=null,d=0;0<=h?d<h:d>h;d=0<=h?++d:--d)c=new zV(o,this.offset),this.tables.push(c),c.isUnicode&&this.unicode==null&&(this.unicode=c);return!0},a.encode=function(o,c){var d,h;return c==null&&(c="macroman"),d=zV.encode(o,c),(h=new ph).writeUInt16(0),h.writeUInt16(1),d.table=h.data.concat(d.subtable),d},a}(),$ge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="hhea",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.ascender=o.readShort(),this.decender=o.readShort(),this.lineGap=o.readShort(),this.advanceWidthMax=o.readShort(),this.minLeftSideBearing=o.readShort(),this.minRightSideBearing=o.readShort(),this.xMaxExtent=o.readShort(),this.caretSlopeRise=o.readShort(),this.caretSlopeRun=o.readShort(),this.caretOffset=o.readShort(),o.pos+=8,this.metricDataFormat=o.readShort(),this.numberOfMetrics=o.readUInt16()},a}(),Zge=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="OS/2",a.prototype.parse=function(o){if(o.pos=this.offset,this.version=o.readUInt16(),this.averageCharWidth=o.readShort(),this.weightClass=o.readUInt16(),this.widthClass=o.readUInt16(),this.type=o.readShort(),this.ySubscriptXSize=o.readShort(),this.ySubscriptYSize=o.readShort(),this.ySubscriptXOffset=o.readShort(),this.ySubscriptYOffset=o.readShort(),this.ySuperscriptXSize=o.readShort(),this.ySuperscriptYSize=o.readShort(),this.ySuperscriptXOffset=o.readShort(),this.ySuperscriptYOffset=o.readShort(),this.yStrikeoutSize=o.readShort(),this.yStrikeoutPosition=o.readShort(),this.familyClass=o.readShort(),this.panose=function(){var c,d;for(d=[],c=0;c<10;++c)d.push(o.readByte());return d}(),this.charRange=function(){var c,d;for(d=[],c=0;c<4;++c)d.push(o.readInt());return d}(),this.vendorID=o.readString(4),this.selection=o.readShort(),this.firstCharIndex=o.readShort(),this.lastCharIndex=o.readShort(),this.version>0&&(this.ascent=o.readShort(),this.descent=o.readShort(),this.lineGap=o.readShort(),this.winAscent=o.readShort(),this.winDescent=o.readShort(),this.codePageRange=function(){var c,d;for(d=[],c=0;c<2;c=++c)d.push(o.readInt());return d}(),this.version>1))return this.xHeight=o.readShort(),this.capHeight=o.readShort(),this.defaultChar=o.readShort(),this.breakChar=o.readShort(),this.maxContext=o.readShort()},a}(),e0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="post",a.prototype.parse=function(o){var c,d,h;switch(o.pos=this.offset,this.format=o.readInt(),this.italicAngle=o.readInt(),this.underlinePosition=o.readShort(),this.underlineThickness=o.readShort(),this.isFixedPitch=o.readInt(),this.minMemType42=o.readInt(),this.maxMemType42=o.readInt(),this.minMemType1=o.readInt(),this.maxMemType1=o.readInt(),this.format){case 65536:case 196608:break;case 131072:var p;for(d=o.readUInt16(),this.glyphNameIndex=[],p=0;0<=d?p<d:p>d;p=0<=d?++p:--p)this.glyphNameIndex.push(o.readUInt16());for(this.names=[],h=[];o.pos<this.offset+this.length;)c=o.readByte(),h.push(this.names.push(o.readString(c)));return h;case 151552:return d=o.readUInt16(),this.offsets=o.read(d);case 262144:return this.map=(function(){var g,x,v;for(v=[],p=g=0,x=this.file.maxp.numGlyphs;0<=x?g<x:g>x;p=0<=x?++g:--g)v.push(o.readUInt32());return v}).call(this)}},a}(),t0e=function(a,o){this.raw=a,this.length=a.length,this.platformID=o.platformID,this.encodingID=o.encodingID,this.languageID=o.languageID},s0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="name",a.prototype.parse=function(o){var c,d,h,p,g,x,v,E,C,I,O;for(o.pos=this.offset,o.readShort(),c=o.readShort(),x=o.readShort(),d=[],p=0;0<=c?p<c:p>c;p=0<=c?++p:--p)d.push({platformID:o.readShort(),encodingID:o.readShort(),languageID:o.readShort(),nameID:o.readShort(),length:o.readShort(),offset:this.offset+x+o.readShort()});for(v={},p=C=0,I=d.length;C<I;p=++C)h=d[p],o.pos=h.offset,E=o.readString(h.length),g=new t0e(E,h),v[O=h.nameID]==null&&(v[O]=[]),v[h.nameID].push(g);this.strings=v,this.copyright=v[0],this.fontFamily=v[1],this.fontSubfamily=v[2],this.uniqueSubfamily=v[3],this.fontName=v[4],this.version=v[5];try{this.postscriptName=v[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=v[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=v[7],this.manufacturer=v[8],this.designer=v[9],this.description=v[10],this.vendorUrl=v[11],this.designerUrl=v[12],this.license=v[13],this.licenseUrl=v[14],this.preferredFamily=v[15],this.preferredSubfamily=v[17],this.compatibleFull=v[18],this.sampleText=v[19]},a}(),r0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="maxp",a.prototype.parse=function(o){return o.pos=this.offset,this.version=o.readInt(),this.numGlyphs=o.readUInt16(),this.maxPoints=o.readUInt16(),this.maxContours=o.readUInt16(),this.maxCompositePoints=o.readUInt16(),this.maxComponentContours=o.readUInt16(),this.maxZones=o.readUInt16(),this.maxTwilightPoints=o.readUInt16(),this.maxStorage=o.readUInt16(),this.maxFunctionDefs=o.readUInt16(),this.maxInstructionDefs=o.readUInt16(),this.maxStackElements=o.readUInt16(),this.maxSizeOfInstructions=o.readUInt16(),this.maxComponentElements=o.readUInt16(),this.maxComponentDepth=o.readUInt16()},a}(),n0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="hmtx",a.prototype.parse=function(o){var c,d,h,p,g,x,v;for(o.pos=this.offset,this.metrics=[],c=0,x=this.file.hhea.numberOfMetrics;0<=x?c<x:c>x;c=0<=x?++c:--c)this.metrics.push({advance:o.readUInt16(),lsb:o.readInt16()});for(h=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var E,C;for(C=[],c=E=0;0<=h?E<h:E>h;c=0<=h?++E:--E)C.push(o.readInt16());return C}(),this.widths=(function(){var E,C,I,O;for(O=[],E=0,C=(I=this.metrics).length;E<C;E++)p=I[E],O.push(p.advance);return O}).call(this),d=this.widths[this.widths.length-1],v=[],c=g=0;0<=h?g<h:g>h;c=0<=h?++g:--g)v.push(this.widths.push(d));return v},a.prototype.forGlyph=function(o){return o in this.metrics?this.metrics[o]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[o-this.metrics.length]}},a}(),wG=[].slice,i0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="glyf",a.prototype.parse=function(){return this.cache={}},a.prototype.glyphFor=function(o){var c,d,h,p,g,x,v,E,C,I;return o in this.cache?this.cache[o]:(p=this.file.loca,c=this.file.contents,d=p.indexOf(o),(h=p.lengthOf(o))===0?this.cache[o]=null:(c.pos=this.offset+d,g=(x=new ph(c.read(h))).readShort(),E=x.readShort(),I=x.readShort(),v=x.readShort(),C=x.readShort(),this.cache[o]=g===-1?new o0e(x,E,I,v,C):new a0e(x,g,E,I,v,C),this.cache[o]))},a.prototype.encode=function(o,c,d){var h,p,g,x,v;for(g=[],p=[],x=0,v=c.length;x<v;x++)h=o[c[x]],p.push(g.length),h&&(g=g.concat(h.encode(d)));return p.push(g.length),{table:g,offsets:p}},a}(),a0e=function(){function a(o,c,d,h,p,g){this.raw=o,this.numberOfContours=c,this.xMin=d,this.yMin=h,this.xMax=p,this.yMax=g,this.compound=!1}return a.prototype.encode=function(){return this.raw.data},a}(),o0e=function(){function a(o,c,d,h,p){var g,x;for(this.raw=o,this.xMin=c,this.yMin=d,this.xMax=h,this.yMax=p,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],g=this.raw;x=g.readShort(),this.glyphOffsets.push(g.pos),this.glyphIDs.push(g.readUInt16()),32&x;)g.pos+=1&x?4:2,128&x?g.pos+=8:64&x?g.pos+=4:8&x&&(g.pos+=2)}return a.prototype.encode=function(){var o,c,d;for(c=new ph(wG.call(this.raw.data)),o=0,d=this.glyphIDs.length;o<d;++o)c.pos=this.glyphOffsets[o];return c.data},a}(),c0e=function(){function a(){return a.__super__.constructor.apply(this,arguments)}return eA(a,od),a.prototype.tag="loca",a.prototype.parse=function(o){var c,d;return o.pos=this.offset,c=this.file.head.indexToLocFormat,this.offsets=c===0?(function(){var h,p;for(p=[],d=0,h=this.length;d<h;d+=2)p.push(2*o.readUInt16());return p}).call(this):(function(){var h,p;for(p=[],d=0,h=this.length;d<h;d+=4)p.push(o.readUInt32());return p}).call(this)},a.prototype.indexOf=function(o){return this.offsets[o]},a.prototype.lengthOf=function(o){return this.offsets[o+1]-this.offsets[o]},a.prototype.encode=function(o,c){for(var d=new Uint32Array(this.offsets.length),h=0,p=0,g=0;g<d.length;++g)if(d[g]=h,p<c.length&&c[p]==g){++p,d[g]=h;var x=this.offsets[g],v=this.offsets[g+1]-x;v>0&&(h+=v)}for(var E=new Array(4*d.length),C=0;C<d.length;++C)E[4*C+3]=255&d[C],E[4*C+2]=(65280&d[C])>>8,E[4*C+1]=(16711680&d[C])>>16,E[4*C]=(4278190080&d[C])>>24;return E},a}(),l0e=function(){function a(o){this.font=o,this.subset={},this.unicodes={},this.next=33}return a.prototype.generateCmap=function(){var o,c,d,h,p;for(c in h=this.font.cmap.tables[0].codeMap,o={},p=this.subset)d=p[c],o[c]=h[d];return o},a.prototype.glyphsFor=function(o){var c,d,h,p,g,x,v;for(h={},g=0,x=o.length;g<x;g++)h[p=o[g]]=this.font.glyf.glyphFor(p);for(p in c=[],h)(d=h[p])!=null&&d.compound&&c.push.apply(c,d.glyphIDs);if(c.length>0)for(p in v=this.glyphsFor(c))d=v[p],h[p]=d;return h},a.prototype.encode=function(o,c){var d,h,p,g,x,v,E,C,I,O,R,k,M,P,H;for(h in d=vG.encode(this.generateCmap(),"unicode"),g=this.glyphsFor(o),R={0:0},H=d.charMap)R[(v=H[h]).old]=v.new;for(k in O=d.maxGlyphID,g)k in R||(R[k]=O++);return C=function($){var re,J;for(re in J={},$)J[$[re]]=re;return J}(R),I=Object.keys(C).sort(function($,re){return $-re}),M=function(){var $,re,J;for(J=[],$=0,re=I.length;$<re;$++)x=I[$],J.push(C[x]);return J}(),p=this.font.glyf.encode(g,M,R),E=this.font.loca.encode(p.offsets,M),P={cmap:this.font.cmap.raw(),glyf:p.table,loca:E,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(c)},this.font.os2.exists&&(P["OS/2"]=this.font.os2.raw()),this.font.directory.encode(P)},a}();Qs.API.PDFObject=function(){var a;function o(){}return a=function(c,d){return(Array(d+1).join("0")+c).slice(-d)},o.convert=function(c){var d,h,p,g;if(Array.isArray(c))return"["+function(){var x,v,E;for(E=[],x=0,v=c.length;x<v;x++)d=c[x],E.push(o.convert(d));return E}().join(" ")+"]";if(typeof c=="string")return"/"+c;if(c!=null&&c.isString)return"("+c+")";if(c instanceof Date)return"(D:"+a(c.getUTCFullYear(),4)+a(c.getUTCMonth(),2)+a(c.getUTCDate(),2)+a(c.getUTCHours(),2)+a(c.getUTCMinutes(),2)+a(c.getUTCSeconds(),2)+"Z)";if({}.toString.call(c)==="[object Object]"){for(h in p=["<<"],c)g=c[h],p.push("/"+h+" "+o.convert(g));return p.push(">>"),p.join(`
`)}return""+c},o}();function d0e(){var k,M,P,H,$,re,J,ge,ie,we,Ae,V,ce,Y;const{id:a}=ox(),[o,c]=ee.useState(null),[d,h]=ee.useState(!0),[p,g]=ee.useState(null),[x,v]=ee.useState(!1);ee.useEffect(()=>{(async()=>{try{const{data:te}=await sd.getReport(a);c(te.report)}catch{St.error("Failed to load report")}finally{h(!1)}})()},[a]);const E=(z,te)=>{const se={name:z,value:te.value,unit:te.unit||"",normalRange:te.normalRange||"N/A",status:te.status||"normal",description:te.description||"",recommendations:te.recommendations||[],foodsToConsume:te.foodsToConsume||[],foodsToAvoid:te.foodsToAvoid||[],symptoms:te.symptoms||[],severity:te.severity||""};g(se),v(!0)},C=()=>{v(!1),g(null)},I=async()=>{const z=document.getElementById("report-content");if(!z){St.error("Could not find report content");return}const te=St.loading("Generating PDF...");try{const se=z.querySelectorAll(".no-pdf");se.forEach(Te=>Te.style.display="none");const Ce=await I7(z,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"});se.forEach(Te=>Te.style.display="");const he=Ce.toDataURL("image/png"),Ne=new Qs("p","mm","a4"),Z=Ne.internal.pageSize.getWidth(),Ie=Ne.internal.pageSize.getHeight(),Ve=Ce.width,Pe=Ce.height,ne=Math.min(Z/Ve,Ie/Pe),ve=(Z-Ve*ne)/2;Ne.addImage(he,"PNG",ve,0,Ve*ne,Pe*ne),Ne.save(`Health_Report_${o.reportType}_${a.substring(0,8)}.pdf`),St.success("Report downloaded successfully!",{id:te})}catch(se){console.error("PDF Generation Error:",se),St.error("Failed to generate PDF. Falling back to print...",{id:te}),window.print()}};if(d)return n.jsx(XA,{});if(!o)return n.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:O}=o,R=(O==null?void 0:O.healthScore)||0;return n.jsxs("div",{id:"report-content",className:"max-w-6xl mx-auto space-y-6 animate-fade-in p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between no-pdf",children:[n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsx(Hs,{to:`/reports/${a}`,className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:"Back to Report Details "})]}),n.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-orange-600 rounded-2xl p-8 text-white",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[n.jsxs("div",{children:[(o.patientName||(O==null?void 0:O.patientName))&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-sm text-white/60 uppercase tracking-wide",children:"Patient Name"}),n.jsx("p",{className:"text-xl font-semibold",children:o.patientName||(O==null?void 0:O.patientName)})]}),n.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[o.reportType," Analysis"]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-white/70",children:[n.jsxs("p",{children:["Analyzed on ",new Date(o.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),(o.reportDate||(O==null?void 0:O.reportDate))&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"hidden sm:inline",children:""}),n.jsxs("p",{children:["Report Date: ",new Date(o.reportDate||(O==null?void 0:O.reportDate)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-5xl font-bold mb-2",children:R}),n.jsx("div",{className:"text-sm text-white/70",children:"Health Score"})]}),n.jsx("div",{className:"no-pdf flex flex-col gap-2",children:n.jsxs("button",{onClick:I,className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-medium border border-white/20",children:[n.jsx(iE,{className:"w-4 h-4"})," Download PDF"]})})]})}),(O==null?void 0:O.summary)&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-blue-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx(br,{className:"w-6 h-6 text-cyan-500"})," Report Summary"]}),n.jsx("p",{className:"text-slate-700 leading-relaxed text-lg",children:O.summary})]}),((k=O==null?void 0:O.keyFindings)==null?void 0:k.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Ca,{className:"w-6 h-6 text-red-500"})," Key Findings"]}),n.jsx("div",{className:"space-y-3",children:O.keyFindings.map((z,te)=>n.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[n.jsx(Tn,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-1"}),n.jsx("p",{className:"text-slate-700 text-base",children:z})]},te))})]}),(O==null?void 0:O.metrics)&&Object.keys(O.metrics).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(br,{className:"w-6 h-6 text-cyan-500"})," All Health Metrics"]}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(O.metrics).map(([z,te])=>n.jsxs("button",{onClick:()=>E(z,te),className:`p-5 rounded-xl border-2 text-left transition-all hover:scale-105 hover:shadow-lg cursor-pointer ${te.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":te.status==="high"?"bg-red-50 border-red-200 hover:border-red-300":"bg-amber-50 border-amber-200 hover:border-amber-300"}`,children:[n.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:z}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800 mb-2",children:[te.value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:te.unit})]}),n.jsxs("p",{className:"text-xs text-slate-600 mb-3",children:["Normal: ",te.normalRange]}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${te.status==="normal"?"bg-emerald-100 text-emerald-700":te.status==="high"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:te.status.toUpperCase()})]},z))})]}),((M=O==null?void 0:O.deficiencies)==null?void 0:M.length)>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(th,{className:"w-6 h-6 text-amber-500"})," Detected Deficiencies"]}),n.jsx("div",{className:"space-y-4",children:O.deficiencies.map((z,te)=>{var se;return n.jsxs("div",{className:`p-5 rounded-xl border-2 ${z.severity==="Severe"?"bg-red-50 border-red-200":z.severity==="Moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800",children:z.name}),n.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${z.severity==="Severe"?"bg-red-100 text-red-700":z.severity==="Moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:z.severity})]}),z.explanation&&n.jsx("p",{className:"text-slate-700 mb-3",children:z.explanation}),((se=z.symptoms)==null?void 0:se.length)>0&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Symptoms:"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:z.symptoms.map((Ce,he)=>n.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-slate-300",children:Ce},he))})]}),z.currentValue&&n.jsxs("p",{className:"text-sm text-slate-600",children:[n.jsx("strong",{children:"Current:"})," ",z.currentValue," | ",n.jsx("strong",{children:"Normal:"})," ",z.normalRange]})]},te)})})]}),(O==null?void 0:O.foodRecommendations)&&Object.keys(O.foodRecommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(lh,{className:"w-6 h-6 text-emerald-500"})," Recommended Food Categories"]}),n.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:Object.entries(O.foodRecommendations).map(([z,te])=>n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-2 text-lg",children:z}),te.explanation&&n.jsx("p",{className:"text-sm text-emerald-600 mb-3",children:te.explanation}),te.frequency&&n.jsxs("p",{className:"text-xs text-emerald-700 font-medium mb-3",children:["Frequency: ",te.frequency]}),te.foods&&n.jsx("div",{className:"flex flex-wrap gap-2",children:te.foods.map((se,Ce)=>n.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full font-medium",children:se},Ce))})]},z))})]}),(O==null?void 0:O.dietPlan)&&n.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-green-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[n.jsx($R,{className:"w-6 h-6 text-green-500"})," Personalized Meal Plan (4 Options Per Meal)"]}),n.jsx("p",{className:"text-slate-700 mb-8 font-medium text-lg",children:O.dietPlan.overview}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-8",children:[((P=O.dietPlan.breakfast)==null?void 0:P.length)>0&&n.jsxs("div",{className:"p-6 bg-orange-50 rounded-2xl border-2 border-orange-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-orange-700 mb-4 text-xl flex items-center gap-2",children:" Breakfast"}),n.jsx("div",{className:"space-y-4",children:O.dietPlan.breakfast.map((z,te)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-orange-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:z.meal}),z.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(z.nutrients)?z.nutrients.join(", "):z.nutrients]}),z.tip&&n.jsxs("p",{className:"text-sm text-orange-600 italic mt-2",children:[" ",z.tip]})]},te))})]}),((H=O.dietPlan.lunch)==null?void 0:H.length)>0&&n.jsxs("div",{className:"p-6 bg-blue-50 rounded-2xl border-2 border-blue-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-xl flex items-center gap-2",children:" Lunch"}),n.jsx("div",{className:"space-y-4",children:O.dietPlan.lunch.map((z,te)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-blue-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:z.meal}),z.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(z.nutrients)?z.nutrients.join(", "):z.nutrients]}),z.tip&&n.jsxs("p",{className:"text-sm text-blue-600 italic mt-2",children:[" ",z.tip]})]},te))})]}),(($=O.dietPlan.dinner)==null?void 0:$.length)>0&&n.jsxs("div",{className:"p-6 bg-indigo-50 rounded-2xl border-2 border-indigo-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-indigo-700 mb-4 text-xl flex items-center gap-2",children:" Dinner"}),n.jsx("div",{className:"space-y-4",children:O.dietPlan.dinner.map((z,te)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-indigo-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:z.meal}),z.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(z.nutrients)?z.nutrients.join(", "):z.nutrients]}),z.tip&&n.jsxs("p",{className:"text-sm text-indigo-600 italic mt-2",children:[" ",z.tip]})]},te))})]}),((re=O.dietPlan.snacks)==null?void 0:re.length)>0&&n.jsxs("div",{className:"p-6 bg-pink-50 rounded-2xl border-2 border-pink-200 shadow-sm transition-all hover:shadow-md",children:[n.jsx("h3",{className:"font-bold text-pink-700 mb-4 text-xl flex items-center gap-2",children:" Snacks"}),n.jsx("div",{className:"space-y-4",children:O.dietPlan.snacks.map((z,te)=>n.jsxs("div",{className:"bg-white/60 p-4 rounded-xl border border-pink-100",children:[n.jsx("p",{className:"font-bold text-slate-800 text-base",children:z.meal}),z.nutrients&&n.jsxs("p",{className:"text-xs text-slate-500 mt-1 uppercase tracking-wider font-semibold",children:["Nutrients: ",Array.isArray(z.nutrients)?z.nutrients.join(", "):z.nutrients]}),z.tip&&n.jsxs("p",{className:"text-sm text-pink-600 italic mt-2",children:[" ",z.tip]})]},te))})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[((J=O.dietPlan.foodsToIncrease)==null?void 0:J.length)>0&&n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-2xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-4 text-lg",children:" Foods to Increase"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:O.dietPlan.foodsToIncrease.map((z,te)=>n.jsx("span",{className:"bg-white px-3 py-1.5 rounded-lg border border-emerald-200 text-sm font-semibold text-emerald-800 shadow-sm",children:z},te))})]}),((ge=O.dietPlan.foodsToLimit)==null?void 0:ge.length)>0&&n.jsxs("div",{className:"p-6 bg-red-50 rounded-2xl border-2 border-red-200",children:[n.jsx("h3",{className:"font-bold text-red-700 mb-4 text-lg",children:" Foods to Limit"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:O.dietPlan.foodsToLimit.map((z,te)=>n.jsx("span",{className:"bg-white px-3 py-1.5 rounded-lg border border-red-200 text-sm font-semibold text-red-800 shadow-sm",children:z},te))})]})]}),O.dietPlan.hydration&&n.jsxs("div",{className:"p-6 bg-cyan-50 rounded-2xl border-2 border-cyan-200 mb-6",children:[n.jsx("h3",{className:"font-bold text-cyan-700 mb-2 flex items-center gap-2",children:" Hydration"}),n.jsx("p",{className:"text-slate-700 font-medium",children:O.dietPlan.hydration})]}),((ie=O.dietPlan.tips)==null?void 0:ie.length)>0&&n.jsxs("div",{className:"p-6 bg-yellow-50 rounded-2xl border-2 border-yellow-200",children:[n.jsx("h3",{className:"font-bold text-yellow-700 mb-4 flex items-center gap-2",children:" Health Tips"}),n.jsx("ul",{className:"space-y-3",children:O.dietPlan.tips.map((z,te)=>n.jsxs("li",{className:"text-slate-700 flex items-start gap-3",children:[n.jsx("span",{className:"bg-yellow-200 text-yellow-700 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5",children:te+1}),n.jsx("span",{className:"font-medium",children:z})]},te))})]})]}),(O==null?void 0:O.supplementRecommendations)&&Object.keys(O.supplementRecommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(eh,{className:"w-6 h-6 text-blue-600"})," Recommended Supplements"]}),n.jsx("div",{className:"space-y-6",children:Object.entries(O.supplementRecommendations).map(([z,te])=>n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:z}),Array.isArray(te)?n.jsx("div",{className:"space-y-3",children:te.map((se,Ce)=>n.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsx("p",{className:"font-semibold text-slate-800",children:se.name}),se.frequency&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-medium",children:se.frequency})]}),se.dosage&&n.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[n.jsx("strong",{children:"Dosage:"})," ",se.dosage]}),se.timing&&n.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[n.jsx("strong",{children:"Timing:"})," ",se.timing]}),se.whyItHelps&&n.jsxs("p",{className:"text-sm text-slate-600 mb-1",children:[n.jsx("strong",{children:"Why:"})," ",se.whyItHelps]}),se.note&&n.jsxs("p",{className:"text-xs text-slate-600 italic",children:[" ",se.note]})]},Ce))}):null]},z))})]}),(O==null?void 0:O.recommendations)&&Object.keys(O.recommendations).length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[n.jsx(Ca,{className:"w-6 h-6 text-red-500"})," Health Recommendations"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((we=O.recommendations.immediate)==null?void 0:we.length)>0&&n.jsxs("div",{className:"p-6 bg-red-50 rounded-xl border-2 border-red-200",children:[n.jsx("h3",{className:"font-bold text-red-700 mb-4 text-lg",children:" Immediate Actions"}),n.jsx("ul",{className:"space-y-2",children:O.recommendations.immediate.map((z,te)=>n.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5 flex-shrink-0"}),z]},te))})]}),((Ae=O.recommendations.shortTerm)==null?void 0:Ae.length)>0&&n.jsxs("div",{className:"p-6 bg-amber-50 rounded-xl border-2 border-amber-200",children:[n.jsx("h3",{className:"font-bold text-amber-700 mb-4 text-lg",children:" Short-Term (2-4 weeks)"}),n.jsx("ul",{className:"space-y-2",children:O.recommendations.shortTerm.map((z,te)=>n.jsxs("li",{className:"text-sm text-amber-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full mt-1.5 flex-shrink-0"}),z]},te))})]}),((V=O.recommendations.longTerm)==null?void 0:V.length)>0&&n.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[n.jsx("h3",{className:"font-bold text-emerald-700 mb-4 text-lg",children:" Long-Term (Ongoing)"}),n.jsx("ul",{className:"space-y-2",children:O.recommendations.longTerm.map((z,te)=>n.jsxs("li",{className:"text-sm text-emerald-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full mt-1.5 flex-shrink-0"}),z]},te))})]}),O.recommendations.diet&&n.jsxs("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[n.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:" Diet Recommendations"}),n.jsx("p",{className:"text-sm text-blue-700",children:O.recommendations.diet})]}),((ce=O.recommendations.lifestyle)==null?void 0:ce.length)>0&&n.jsxs("div",{className:"p-6 bg-violet-50 rounded-xl border-2 border-violet-200",children:[n.jsx("h3",{className:"font-bold text-violet-700 mb-4 text-lg",children:" Lifestyle Changes"}),n.jsx("ul",{className:"space-y-2",children:O.recommendations.lifestyle.map((z,te)=>n.jsxs("li",{className:"text-sm text-violet-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-violet-500 rounded-full mt-1.5 flex-shrink-0"}),z]},te))})]}),((Y=O.recommendations.followUpTests)==null?void 0:Y.length)>0&&n.jsxs("div",{className:"p-6 bg-cyan-50 rounded-xl border-2 border-cyan-200",children:[n.jsx("h3",{className:"font-bold text-cyan-700 mb-4 text-lg",children:" Follow-Up Tests"}),n.jsx("ul",{className:"space-y-2",children:O.recommendations.followUpTests.map((z,te)=>n.jsxs("li",{className:"text-sm text-cyan-700 flex items-start gap-2",children:[n.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-1.5 flex-shrink-0"}),z]},te))})]})]})]}),n.jsx("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:n.jsxs("p",{className:"text-sm text-blue-700",children:[n.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})}),x&&p&&n.jsx(SH,{vital:p,onClose:C})]})}function A0e(){var Y,z;const[a,o]=ee.useState([]),[c,d]=ee.useState(null),[h,p]=ee.useState(null),[g,x]=ee.useState(!0),[v,E]=ee.useState(null),[C,I]=ee.useState(!1),[O,R]=ee.useState(null);ee.useEffect(()=>{k()},[]),ee.useEffect(()=>{if(c){const te=a.find(se=>se._id===c);p(te)}},[c,a]);const k=async()=>{try{const{data:te}=await sd.getReports();o(te),te.length>0&&d(te[0]._id)}catch(te){console.error("Failed to fetch reports:",te)}finally{x(!1)}},M=(te,se)=>{if(!se||typeof se!="object")return;const Ce={name:te||"Unknown Metric",value:se.value!==void 0?se.value:"N/A",unit:se.unit||"",normalRange:se.normalRange||"N/A",status:se.status||"normal",description:se.description||`Details for ${te}`,recommendations:Array.isArray(se.recommendations)?se.recommendations:[],foodsToConsume:Array.isArray(se.foodsToConsume)?se.foodsToConsume:[],foodsToAvoid:Array.isArray(se.foodsToAvoid)?se.foodsToAvoid:[],symptoms:Array.isArray(se.symptoms)?se.symptoms:[],severity:se.severity||""};E(Ce),I(!0)},P=()=>{I(!1),E(null)},H=()=>{const te=new Set;return a.forEach(se=>{var Ce;(Ce=se.aiAnalysis)!=null&&Ce.metrics&&Object.keys(se.aiAnalysis.metrics).forEach(he=>te.add(he))}),Array.from(te).sort()},$=te=>te?a.filter(se=>{var Ce,he;return(he=(Ce=se.aiAnalysis)==null?void 0:Ce.metrics)==null?void 0:he[te]}).reverse().map(se=>({date:new Date(se.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}),value:se.aiAnalysis.metrics[te].value,unit:se.aiAnalysis.metrics[te].unit,status:se.aiAnalysis.metrics[te].status,normalRange:se.aiAnalysis.metrics[te].normalRange,fullDate:new Date(se.createdAt)})):[],re=te=>{if(te.length<2)return{direction:"stable",change:0,percentChange:0};const se=te[te.length-1].value,Ce=te[te.length-2].value,he=se-Ce,Ne=(he/Ce*100).toFixed(1);let Z="stable";return he>0?Z="up":he<0&&(Z="down"),{direction:Z,change:he.toFixed(2),percentChange:Ne}},J=(te,se)=>{if(se.length<2)return{message:"Not enough data to analyze trend. Upload more reports to track progress.",color:"text-slate-600",bgColor:"bg-slate-50",icon:"info"};const Ce=re(se),he=se[se.length-1],Ne=he.status==="normal",Z=["Cholesterol","LDL","Triglycerides","Blood Sugar","Glucose","HbA1c","Blood Pressure","Systolic","Diastolic","Weight","BMI"],Ie=["HDL","Hemoglobin","RBC","Vitamin D","Vitamin B12","Iron","Calcium"],Ve=Z.some(ue=>te.toLowerCase().includes(ue.toLowerCase())),Pe=Ie.some(ue=>te.toLowerCase().includes(ue.toLowerCase()));let ne=!1,ve="";return Ce.direction==="stable"?Ne?(ve=` Your ${te} is stable and within normal range. Great job maintaining your health!`,ne=!0):(ve=` Your ${te} remains outside normal range. Consider consulting your doctor for guidance.`,ne=!1):Ce.direction==="up"?Pe?(ve=` Your ${te} is increasing (${Ce.change} ${he.unit}). This is a positive trend! Keep up the good work.`,ne=!0):Ve?(ve=` Your ${te} is rising (${Ce.change} ${he.unit}). Consider lifestyle changes to bring it down.`,ne=!1):(ve=` Your ${te} increased by ${Ce.change} ${he.unit}. ${Ne?"Still within normal range.":"Monitor this closely."}`,ne=Ne):Ve?(ve=` Your ${te} is decreasing (${Ce.change} ${he.unit}). Excellent progress! Keep it up.`,ne=!0):Pe?(ve=` Your ${te} is dropping (${Ce.change} ${he.unit}). You may need to improve this value.`,ne=!1):(ve=` Your ${te} decreased by ${Math.abs(Ce.change)} ${he.unit}. ${Ne?"Still within normal range.":"Monitor this closely."}`,ne=Ne),{message:ve,color:ne?"text-green-700":"text-amber-700",bgColor:ne?"bg-green-50":"bg-amber-50",borderColor:ne?"border-green-200":"border-amber-200",icon:ne?"good":"warning"}};if(g)return n.jsx(XA,{});if(a.length===0)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(br,{className:"w-10 h-10 text-red-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Vital Signs Available"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Upload your health report to view your vital signs and health metrics extracted from your reports."}),n.jsxs(Hs,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-colors",children:[n.jsx(lo,{className:"w-5 h-5"}),"Upload Report"]})]})]});const ge=((Y=h==null?void 0:h.aiAnalysis)==null?void 0:Y.metrics)||{},ie=Object.keys(ge).length>0,we=H(),Ae=O?$(O):[],V=Ae.length>0?re(Ae):null,ce=O&&Ae.length>0?J(O,Ae):null;return n.jsxs("div",{className:"w-full mx-auto space-y-6 animate-fade-in p-4 pb-20",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[n.jsx(br,{className:"w-8 h-8 text-red-500"}),"Vital Signs"]}),n.jsx("p",{className:"text-slate-600 mt-2",children:"View your health metrics from reports"})]}),a.length>1&&n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:te=>d(te.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(te=>n.jsxs("option",{value:te._id,children:[te.reportType," - ",new Date(te.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},te._id))}),n.jsx(uh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),h&&n.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(Hn,{className:"w-6 h-6"}),n.jsx("h2",{className:"text-xl font-bold",children:h.reportType})]}),n.jsxs("p",{className:"text-white/80 text-sm",children:["Report Date: ",new Date(h.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),((z=h.aiAnalysis)==null?void 0:z.healthScore)&&n.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[n.jsx("span",{className:"text-sm",children:"Health Score:"}),n.jsx("span",{className:"text-2xl font-bold",children:h.aiAnalysis.healthScore})]})]}),a.length>1&&we.length>0&&n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Vital Progress Tracker"}),n.jsx("p",{className:"text-slate-600 text-sm",children:"Select a vital to see its progress over time"})]}),n.jsxs("div",{className:"relative min-w-[200px]",children:[n.jsxs("select",{value:O||"",onChange:te=>R(te.target.value),className:"appearance-none w-full px-4 py-3 pr-10 bg-gradient-to-r from-purple-50 to-orange-50 border-2 border-cyan-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:[n.jsx("option",{value:"",children:"Select Vital"}),we.map(te=>n.jsx("option",{value:te,children:te},te))]}),n.jsx(uh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-600 pointer-events-none"})]})]}),O&&Ae.length>0?n.jsxs("div",{className:"space-y-4",children:[V&&Ae.length>1&&n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Current Value"}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[Ae[Ae.length-1].value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:Ae[Ae.length-1].unit})]}),n.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Normal: ",Ae[Ae.length-1].normalRange]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Trend"}),n.jsx("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full font-bold ${V.direction==="up"?"bg-blue-100 text-blue-700":V.direction==="down"?"bg-purple-100 text-purple-700":"bg-slate-100 text-slate-700"}`,children:V.direction==="up"?n.jsxs(n.Fragment,{children:[n.jsx(qi,{className:"w-5 h-5"}),n.jsxs("span",{children:["+",V.change]})]}):V.direction==="down"?n.jsxs(n.Fragment,{children:[n.jsx(ah,{className:"w-5 h-5"}),n.jsx("span",{children:V.change})]}):n.jsxs(n.Fragment,{children:[n.jsx(kg,{className:"w-5 h-5"}),n.jsx("span",{children:"Stable"})]})}),n.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[Math.abs(V.percentChange),"% change"]})]})]}),n.jsx("div",{className:"h-64 sm:h-80",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(By,{data:Ae,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"vitalGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),n.jsx(Eg,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),n.jsx(Cg,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1}),n.jsx(Sg,{stroke:"#94a3b8",fontSize:12,tickLine:!1}),n.jsx(ex,{contentStyle:{backgroundColor:"#fff",border:"2px solid #06b6d4",borderRadius:"12px",padding:"12px"},labelStyle:{color:"#64748b",fontWeight:"bold",marginBottom:"4px"},formatter:(te,se,Ce)=>[`${te} ${Ce.payload.unit}`,O]}),n.jsx(Ly,{type:"monotone",dataKey:"value",stroke:"#06b6d4",strokeWidth:3,fill:"url(#vitalGradient)",dot:{fill:"#06b6d4",strokeWidth:2,r:5},activeDot:{r:7,fill:"#0891b2"}})]})})}),n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:Ae.slice(-4).reverse().map((te,se)=>n.jsxs("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200",children:[n.jsx("p",{className:"text-xs text-slate-500 mb-1",children:te.date}),n.jsx("p",{className:"text-lg font-bold text-slate-800",children:te.value}),n.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded text-xs font-semibold ${te.status==="normal"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,children:te.status})]},se))}),ce&&n.jsx("div",{className:`p-4 rounded-xl border-2 ${ce.borderColor} ${ce.bgColor}`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:ce.icon==="good"?n.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):ce.icon==="warning"?n.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center",children:n.jsx(Li,{className:"w-5 h-5 text-white"})}):n.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-400 flex items-center justify-center",children:n.jsx(br,{className:"w-5 h-5 text-white"})})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:`font-semibold mb-1 ${ce.color}`,children:"Health Insight"}),n.jsx("p",{className:`text-sm ${ce.color} leading-relaxed`,children:ce.message})]})]})})]}):O?n.jsxs("div",{className:"text-center py-12 text-slate-400",children:[n.jsx(br,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:"No data available for this vital across your reports"})]}):n.jsxs("div",{className:"text-center py-12 text-slate-400",children:[n.jsx(br,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:"Select a vital from the dropdown to see its progress"})]})]}),ie?n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-6",children:"Current Health Metrics"}),n.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(ge).map(([te,se])=>n.jsxs("button",{onClick:()=>M(te,se),className:`p-5 rounded-xl border-2 text-left transition-all hover:scale-105 hover:shadow-lg cursor-pointer ${se.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":se.status==="high"||se.status==="low"?"bg-red-50 border-red-200 hover:border-red-300":"bg-amber-50 border-amber-200 hover:border-amber-300"}`,children:[n.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:te}),n.jsxs("p",{className:"text-2xl font-bold text-slate-800 mb-2",children:[se.value," ",n.jsx("span",{className:"text-sm font-normal text-slate-500",children:se.unit})]}),n.jsxs("p",{className:"text-xs text-slate-600 mb-3",children:["Normal: ",se.normalRange]}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${se.status==="normal"?"bg-emerald-100 text-emerald-700":se.status==="high"||se.status==="low"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:se.status.toUpperCase()})]},te))})]}):n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx(br,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Metrics Found"}),n.jsx("p",{className:"text-slate-600 mb-6",children:"This report doesn't contain any extracted health metrics. Try uploading a different report."}),n.jsxs(Hs,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-colors",children:[n.jsx(lo,{className:"w-5 h-5"}),"Upload New Report"]})]}),C&&v&&n.jsx(SH,{vital:v,onClose:P})]})}function u0e(){const[a,o]=ee.useState([]),[c,d]=ee.useState(null),[h,p]=ee.useState(null),[g,x]=ee.useState([]),[v,E]=ee.useState(!0);ee.useEffect(()=>{C()},[]),ee.useEffect(()=>{if(c){const R=a.find(k=>k._id===c);p(R),I(R)}},[c,a]);const C=async()=>{try{const{data:R}=await sd.getReports();o(R),R.length>0&&d(R[0]._id)}catch(R){console.error("Failed to fetch reports:",R)}finally{E(!1)}},I=R=>{var M;if(!R){x([]);return}const k=[];(M=R.aiAnalysis)!=null&&M.supplementRecommendations&&Object.entries(R.aiAnalysis.supplementRecommendations).forEach(([P,H])=>{Array.isArray(H)&&H.forEach($=>{k.push({...$,category:P,reportId:R._id,reportType:R.reportType,reportDate:R.createdAt})})}),x(k)};if(v)return n.jsx(XA,{});if(a.length===0)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(eh,{className:"w-10 h-10 text-purple-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Supplement Recommendations Yet"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Upload your health report to get personalized supplement recommendations based on your deficiencies and health conditions."}),n.jsxs(Hs,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-purple-500 text-white rounded-xl font-semibold hover:bg-purple-600 transition-colors",children:[n.jsx(lo,{className:"w-5 h-5"}),"Upload Report"]})]})]});if(g.length===0&&h)return n.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[n.jsx("div",{className:"flex items-center gap-4 mb-6",children:n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]})}),a.length>1&&n.jsx("div",{className:"flex justify-end",children:n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:R=>d(R.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(R=>n.jsxs("option",{value:R._id,children:[R.reportType," - ",new Date(R.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},R._id))}),n.jsx(uh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})}),n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-12 text-center",children:[n.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(Tn,{className:"w-10 h-10 text-green-500"})}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"No Supplements Needed"}),n.jsx("p",{className:"text-slate-600 mb-6 max-w-md mx-auto",children:"Great news! This report doesn't show any deficiencies that require supplements. Keep maintaining your healthy lifestyle!"}),a.length>1?n.jsx("p",{className:"text-sm text-slate-500",children:"Try selecting a different report above to view its supplement recommendations."}):n.jsx(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 px-6 py-3 bg-cyan-500 text-white rounded-xl font-semibold hover:bg-cyan-600 transition-colors",children:"Back to Dashboard"})]})]});const O=g.reduce((R,k)=>(R[k.category]||(R[k.category]=[]),R[k.category].push(k),R),{});return n.jsxs("div",{className:"w-full mx-auto space-y-6 animate-fade-in p-4 pb-20",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[n.jsxs("div",{children:[n.jsxs(Hs,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2",children:[n.jsx(Vn,{className:"w-4 h-4"})," Back to Dashboard"]}),n.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[n.jsx(eh,{className:"w-8 h-8 text-purple-500"}),"Supplement Recommendations"]}),n.jsx("p",{className:"text-slate-600 mt-2",children:"Based on your selected health report"})]}),a.length>1&&n.jsxs("div",{className:"relative",children:[n.jsx("select",{value:c||"",onChange:R=>d(R.target.value),className:"appearance-none px-4 py-3 pr-10 bg-white border-2 border-slate-200 rounded-xl text-sm font-medium text-slate-800 hover:border-cyan-400 focus:border-cyan-500 focus:outline-none cursor-pointer transition-colors",children:a.map(R=>n.jsxs("option",{value:R._id,children:[R.reportType," - ",new Date(R.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]},R._id))}),n.jsx(uh,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"})]})]}),h&&n.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-orange-500 rounded-2xl p-6 text-white",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx(Hn,{className:"w-6 h-6"}),n.jsx("h2",{className:"text-xl font-bold",children:h.reportType})]}),n.jsxs("p",{className:"text-white/80 text-sm",children:["Report Date: ",new Date(h.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),g.length>0&&n.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[n.jsx(eh,{className:"w-5 h-5"}),n.jsxs("span",{className:"text-sm",children:[g.length," Supplement",g.length!==1?"s":""," Recommended"]})]})]}),n.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 flex items-start gap-3",children:[n.jsx(qd,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),n.jsxs("div",{className:"text-sm text-blue-800",children:[n.jsx("p",{className:"font-semibold mb-1",children:"Important Information"}),n.jsx("p",{children:"These recommendations are based on your selected health report. Always consult with a healthcare provider before starting any new supplements."})]})]}),Object.entries(O).map(([R,k])=>n.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[n.jsxs("h2",{className:"text-xl font-bold text-purple-700 mb-4 flex items-center gap-2",children:[n.jsx(eh,{className:"w-6 h-6"}),R]}),n.jsx("div",{className:"space-y-4",children:k.map((M,P)=>n.jsxs("div",{className:"p-5 bg-purple-50 rounded-xl border-2 border-purple-200",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-1",children:M.name}),n.jsxs("p",{className:"text-xs text-slate-500",children:["From ",M.reportType,"  ",new Date(M.reportDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),M.frequency&&n.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold",children:M.frequency})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-3",children:[M.dosage&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Dosage"}),n.jsx("p",{className:"text-sm text-slate-800",children:M.dosage})]}),M.timing&&n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Timing"}),n.jsx("p",{className:"text-sm text-slate-800",children:M.timing})]})]}),M.whyItHelps&&n.jsxs("div",{className:"mb-3",children:[n.jsx("p",{className:"text-xs text-slate-600 font-semibold mb-1",children:"Why It Helps"}),n.jsx("p",{className:"text-sm text-slate-700",children:M.whyItHelps})]}),M.note&&n.jsxs("div",{className:"flex items-start gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[n.jsx(Li,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),n.jsx("p",{className:"text-xs text-amber-800",children:M.note})]})]},P))})]},R)),n.jsxs("div",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-6",children:[n.jsxs("h3",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[n.jsx(Li,{className:"w-5 h-5 text-slate-600"}),"Disclaimer"]}),n.jsx("p",{className:"text-sm text-slate-600",children:"These supplement recommendations are generated based on your health reports and are for informational purposes only. They should not replace professional medical advice. Always consult with a qualified healthcare provider before starting any new supplements, especially if you have existing medical conditions or are taking medications."})]})]})}function h0e(){var ot,ut,Tt,Qe,it,kt,_e,xt,Ke,Je,$e,jt,Kt,os,ss,mt,Ht;const a=Ha(),o=ee.useRef(!1),[c,d]=ee.useState(""),[h,p]=ee.useState(null),[g,x]=ee.useState(null),[v,E]=ee.useState(!1),[C,I]=ee.useState(!1),[O,R]=ee.useState(null),[k,M]=ee.useState(null),[P,H]=ee.useState(!1),[$,re]=ee.useState(!1),[J,ge]=ee.useState(!1),[ie,we]=ee.useState({quantity:"",prepMethod:"",additionalInfo:""}),[Ae,V]=ee.useState(!1),[ce]=ee.useState(["Chicken Biryani","Paneer Tikka","Dal Makhani","Butter Chicken","Roti","Naan","Rice","Pasta","Pizza","Burger","Salad","Sandwich","Idli","Dosa","Samosa","Paratha","Chole Bhature","Rajma Chawal","Khichdi","Fried Rice","Momos","Spring Roll","Manchurian"]),[Y,z]=ee.useState([]),te=qe=>{const ht=qe.toLowerCase();return ht.includes("roti")||ht.includes("naan")||ht.includes("paratha")?["1 piece","2 pieces","3 pieces","4 pieces"]:ht.includes("rice")||ht.includes("biryani")||ht.includes("khichdi")||ht.includes("dal")||ht.includes("rajma")||ht.includes("chole")?["1 bowl","1 plate","1 cup","2 cups"]:ht.includes("samosa")||ht.includes("pakora")||ht.includes("momos")||ht.includes("spring roll")?["1 piece","2 pieces","3 pieces","5 pieces","1 plate"]:ht.includes("idli")||ht.includes("dosa")||ht.includes("vada")?["1 piece","2 pieces","3 pieces","1 plate"]:ht.includes("pizza")||ht.includes("burger")?["1 slice","2 slices","1 whole","1 medium","1 large"]:ht.includes("chicken")||ht.includes("paneer")||ht.includes("tikka")?["1 bowl","1 plate","100g","150g","200g"]:ht.includes("pasta")||ht.includes("noodles")||ht.includes("manchurian")?["1 bowl","1 plate","1 cup"]:ht.includes("salad")||ht.includes("sandwich")?["1 bowl","1 plate","1 piece","1 full"]:["1 bowl","1 plate","1 piece","100g","150g"]},[se,Ce]=ee.useState([]),[he,Ne]=ee.useState(!1),[Z,Ie]=ee.useState("breakfast");ee.useEffect(()=>{const qe=sessionStorage.getItem("foodScanResult"),ht=sessionStorage.getItem("foodScanImage"),Xt=sessionStorage.getItem("foodScanInput"),zt=sessionStorage.getItem("foodScanDetails"),ds=sessionStorage.getItem("foodScanBinaryImage");if(console.log("Checking for persisted data...",{hasResult:!!qe,hasImage:!!ht,hasBinary:!!ds,hasInput:!!Xt,hasDetails:!!zt}),Xt&&!c&&(d(Xt),Ce(te(Xt))),zt&&!ie.quantity&&!ie.prepMethod)try{we(JSON.parse(zt))}catch{}if(ds&&!h)try{console.log(" Attempting to recover image from storage...");let Qt,Us=ds;if(ds.startsWith("data:")){const[bs,cs]=ds.split(";base64,"),Ds=bs.split(":")[1],zs=atob(cs),rs=[];for(let dt=0;dt<zs.length;dt++)rs.push(zs.charCodeAt(dt));const Gs=new Blob([new Uint8Array(rs)],{type:Ds});Qt=new File([Gs],"captured_food.jpg",{type:Ds}),Us=URL.createObjectURL(Qt)}if(Qt){p(Qt),x(Us),console.log(" Recovered image successfully");const bs=zt?JSON.parse(zt):null;(Xt||bs!=null&&bs.quantity)&&(console.log(" Auto-resuming analysis..."),setTimeout(()=>{Te(null,Qt)},800))}}catch(Qt){console.error(" Recovery failed:",Qt)}if(qe)try{const Qt=JSON.parse(qe);R(Qt),I(!0),ht&&M(ht),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage"),St.success("Food analysis recovered!",{duration:2e3})}catch(Qt){console.error(" Failed to recover persisted result:",Qt),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage")}},[a]),ee.useEffect(()=>{c&&sessionStorage.setItem("foodScanInput",c),(ie.quantity||ie.prepMethod||ie.additionalInfo)&&sessionStorage.setItem("foodScanDetails",JSON.stringify(ie)),!c&&!h&&(sessionStorage.removeItem("foodScanInput"),sessionStorage.removeItem("foodScanDetails"),sessionStorage.removeItem("foodScanBinaryImage"))},[c,ie,h]),ee.useEffect(()=>{if(v){console.log(" Blocking navigation - analysis in progress");const qe=Xt=>{Xt.preventDefault(),Xt.returnValue=""};window.addEventListener("beforeunload",qe);const ht=Xt=>{Xt.preventDefault(),window.history.pushState(null,"",window.location.pathname),St.error("Please wait for analysis to complete")};return window.addEventListener("popstate",ht),window.history.pushState(null,"",window.location.pathname),()=>{window.removeEventListener("beforeunload",qe),window.removeEventListener("popstate",ht)}}},[v]),ee.useEffect(()=>{var qe;if(C&&O)return console.log("Modal is now visible with result:",(qe=O.foodItem)==null?void 0:qe.name),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}},[C,O]);const Ve=qe=>{const ht=qe.target.value;if(d(ht),ht.trim().length>0){const Xt=ce.filter(ds=>ds.toLowerCase().includes(ht.toLowerCase()));z(Xt.slice(0,5)),V(Xt.length>0);const zt=Xt[0]||ht;Ce(te(zt))}else V(!1),z([]),Ce([])},Pe=qe=>{d(qe),V(!1),z([]),Ce(te(qe))},ne=async qe=>new Promise((ht,Xt)=>{const zt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(qe.size>20*1024*1024)return Xt(new Error("Image is too large (max 20MB). Please take a smaller photo or use a screenshot."));const ds=qe.size>2*1024*1024;let Qt=.5,Us=800;zt?(Qt=.6,Us=1024):ds&&(Qt=.7,Us=1200),console.log(" Compression starting...",{isMobile:zt,targetQuality:Qt,maxDimension:Us,originalSize:(qe.size/1024).toFixed(2)+" KB",fileType:qe.type});const bs=URL.createObjectURL(qe),cs=new Image,Ds=setTimeout(()=>{cs.src="",console.warn(" Image processing timed out after 30s"),cs.onload=null,cs.onerror=null,ht(qe)},3e4);cs.onload=()=>{clearTimeout(Ds),URL.revokeObjectURL(bs);try{const zs=document.createElement("canvas");let rs=cs.width,Gs=cs.height;rs>Gs?rs>Us&&(Gs=Math.round(Gs*Us/rs),rs=Us):Gs>Us&&(rs=Math.round(rs*Us/Gs),Gs=Us),console.log(" Resizing to",rs,"x",Gs),zs.width=rs,zs.height=Gs;const dt=zs.getContext("2d",{alpha:!1});if(!dt)throw new Error("Could not get canvas context - low memory");dt.drawImage(cs,0,0,rs,Gs),cs.src="",zs.toBlob(Pt=>{if(zs.width=0,zs.height=0,!Pt){console.warn(" Canvas toBlob returned null, using original file"),ht(qe);return}const qt=new File([Pt],qe.name.replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});console.log(" Final size:",(qt.size/1024).toFixed(2),"KB"),ht(qt)},"image/jpeg",Qt)}catch(zs){console.error("Canvas compression error:",zs),ht(qe)}},cs.onerror=zs=>{clearTimeout(Ds),URL.revokeObjectURL(bs),console.warn(" Failed to load image in canvas, using original file. Error:",zs),ht(qe)},cs.crossOrigin="anonymous",cs.src=bs}),ve=async qe=>{var zt;console.log("--- HANDLE IMAGE SELECT START ---");const ht=(zt=qe.target.files)==null?void 0:zt[0],Xt=qe.target.id;if(console.log(` Image selected from ${Xt}`,ht?{name:ht.name,size:`${(ht.size/1024/1024).toFixed(2)} MB`,type:ht.type}:"No file"),ht){if(ht.size>50*1024*1024){St.error("Image too large. Please use an image smaller than 50MB");return}re(!0);const ds=St.loading("Processing image...");try{const Qt=URL.createObjectURL(ht);x(Qt),p(ht),console.log(" Preview set successfully"),await new Promise(bs=>setTimeout(bs,300));let Us;try{Us=await ne(ht),Us&&Us!==ht&&(p(Us),console.log(" Image optimized"))}catch(bs){console.warn("Optimization skipped:",bs.message),Us=ht,p(Us)}if(Us.size<3*1024*1024)try{const bs=new FileReader;bs.onloadend=()=>{try{sessionStorage.setItem("foodScanBinaryImage",bs.result),console.log(" Image persisted to sessionStorage")}catch{console.warn(" Storage quota exceeded - image not persisted"),sessionStorage.removeItem("foodScanBinaryImage")}},bs.readAsDataURL(Us)}catch(bs){console.warn("Failed to persist image:",bs)}else console.log(" Image too large for sessionStorage (>3MB), skipping persistence");St.success(`Image ready! ${(Us.size/1024).toFixed(0)}KB`,{id:ds})}catch(Qt){console.error("Image processing error:",Qt),St.error("Failed to process image. Please try a different image.",{id:ds})}finally{re(!1)}}qe.target.value=""},ue=async qe=>{H(!0);try{const ht=await Ft.get(`/nutrition/food-image?foodName=${encodeURIComponent(qe)}`,{skipAutoLogout:!0});if(ht.data.success&&ht.data.imageUrl){M(ht.data.imageUrl);try{sessionStorage.setItem("foodScanImage",ht.data.imageUrl)}catch{console.warn("Failed to persist food image")}}}catch(ht){console.error("Failed to fetch food image:",ht)}finally{H(!1)}},Te=async(qe,ht=null)=>{var bs,cs,Ds,zs,rs,Gs,dt,Pt;if(qe&&qe.preventDefault(),v||o.current){console.log("Analysis already in progress, skipping...");return}const Xt=ht||h;if(!c.trim()&&!Xt){St.error("Please enter a food item or upload an image");return}if(Xt&&!ie.quantity&&!ie.prepMethod){St.error("Please provide quantity and preparation method for the image");return}if(!localStorage.getItem("token")){St.error("Please login to use this feature"),setTimeout(()=>{window.location.href="/login"},1500);return}E(!0),o.current=!0,M(null);const ds=St.loading("AI is carefully scanning your food...");let Qt=null,Us=!1;try{let qt=new FormData;Xt&&(console.log("Using binary upload via FormData..."),console.log("Image size:",(Xt.size/1024).toFixed(2),"KB"),qt.append("image",Xt));let Yt="";if(h&&(ie.quantity||ie.prepMethod||ie.additionalInfo)){const Ws=[];ie.quantity&&Ws.push(`Quantity: ${ie.quantity}`),ie.prepMethod&&Ws.push(`Preparation: ${ie.prepMethod}`),ie.additionalInfo&&Ws.push(ie.additionalInfo),c&&Ws.push(`Additional info: ${c}`),Yt=Ws.join(", ")}else Yt=c;qt.append("foodDescription",c||"Food from image"),qt.append("additionalContext",Yt),console.log("Sending analysis request (FormData) via api instance...");const us=await Ft.post("/nutrition/quick-check",qt,{headers:{"Content-Type":"multipart/form-data"},timeout:18e4,skipAutoLogout:!0});if(St.dismiss(ds),!us.data||!us.data.data)throw new Error("Invalid response from server");Qt=us.data.data,Us=!0,console.log("Analysis successful, persisting result...");try{sessionStorage.setItem("foodScanResult",JSON.stringify(Qt)),console.log(" Result persisted to sessionStorage")}catch(Ws){console.warn(" Failed to persist result:",Ws);try{localStorage.setItem("foodScanResult",JSON.stringify(Qt)),console.log(" Result persisted to localStorage (fallback)")}catch{console.error(" Both storage methods failed")}}console.log("Setting state now..."),R(Qt),I(!0),E(!1),console.log(" State updated, modal should be visible"),console.log("Modal state:",{showResultModal:!0,hasResult:!!Qt}),(bs=Qt==null?void 0:Qt.foodItem)!=null&&bs.name&&ue(Qt.foodItem.name),St.success("Food analyzed!"),o.current=!1,E(!1);return}catch(qt){if(St.dismiss(ds),console.error("Analysis error:",qt),console.error("Error response:",qt.response),console.error("Error status:",(cs=qt.response)==null?void 0:cs.status),E(!1),o.current=!1,((Ds=qt.response)==null?void 0:Ds.status)===401){St.error("Session issue. Please try again. If the problem persists, re-login.",{duration:5e3});return}((zs=qt.response)==null?void 0:zs.status)===400&&((Gs=(rs=qt.response)==null?void 0:rs.data)==null?void 0:Gs.error)==="UNABLE_TO_DETECT_FOOD"?(p(null),x(null),St.error("Could not detect food in image. Please type the food name for accurate results.",{duration:5e3})):qt.code==="ECONNABORTED"?St.error("Request timeout. Please try again or use text description."):qt.message&&qt.message.includes("memory")?(St.error("Image too large for device. Please try a smaller image or type the food name."),p(null),x(null)):qt.message&&qt.message.includes("Network Error")?St.error("Network error. Please check your connection and try again."):St.error(((Pt=(dt=qt.response)==null?void 0:dt.data)==null?void 0:Pt.message)||"Failed to analyze food. Please try again.")}},Be=()=>{console.log("Resetting form..."),I(!1),R(null),M(null),d(""),g&&g.startsWith("blob:")&&URL.revokeObjectURL(g),p(null),x(null),we({quantity:"",prepMethod:"",additionalInfo:""}),Ne(!1),Ie("breakfast"),sessionStorage.removeItem("foodScanResult"),sessionStorage.removeItem("foodScanImage"),localStorage.removeItem("foodScanResult"),localStorage.removeItem("foodScanImage"),window.gc&&window.gc()},Ue=()=>{Ne(!0)},tt=async()=>{var ht,Xt;if(J)return;ge(!0);const qe=St.loading("Logging meal...");try{const zt={name:((ht=O.foodItem)==null?void 0:ht.name)||"Food from scan",quantity:ie.quantity||"1 serving",nutrition:((Xt=O.foodItem)==null?void 0:Xt.nutrition)||{},notes:ie.prepMethod?`Preparation: ${ie.prepMethod}`:""};console.log("Logging meal with user input:",{quantity:ie.quantity,prepMethod:ie.prepMethod,foodItem:zt}),(await Ft.post("/nutrition/log-meal",{mealType:Z,foodItems:[zt],notes:"Logged from Quick Food Scan",imageUrl:O.imageUrl,healthScore:O.healthScore,healthScore10:O.healthScore10,micronutrients:O.micronutrients,enhancementTips:O.enhancementTips,healthBenefitsSummary:O.healthBenefitsSummary,timestamp:new Date().toISOString().split("T")[0]},{skipAutoLogout:!0})).data.success&&(St.success(`Meal logged to ${Z}! `,{id:qe}),Ne(!1),Be(),setTimeout(()=>{a("/nutrition#daily-target")},1e3))}catch(zt){console.error("Log meal error:",zt),St.error("Failed to log meal. Please try again.",{id:qe})}finally{ge(!1)}};return n.jsxs("div",{className:"min-h-screen bg-[#f8fafc] flex flex-col font-sans selection:bg-[#2FC8B9]/20",children:[n.jsx("div",{className:"w-full px-6 py-5 bg-white/80 backdrop-blur-2xl border-b border-[#2FC8B9]/10 sticky top-0 z-[100] shadow-[0_4px_20px_-5px_rgba(0,0,0,0.05)]",children:n.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>a(-1),className:"group p-2.5 bg-white rounded-2xl shadow-sm border border-[#2FC8B9]/5 hover:bg-slate-50 transition-all active:scale-95",children:n.jsx(Vn,{className:"w-5 h-5 text-slate-600 group-hover:text-[#2FC8B9] transition-colors"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-extrabold text-[#1e293b] leading-tight tracking-tight",children:"Food Scanner"}),n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[#2FC8B9] animate-pulse"}),n.jsx("p",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"AI Nutrition Analysis"})]})]})]}),n.jsx("div",{className:"flex items-center gap-3",children:n.jsx("div",{className:"bg-[#2FC8B9]/10 p-2 rounded-xl border border-[#2FC8B9]/20",children:n.jsx(XV,{className:"w-5 h-5 text-[#2FC8B9]"})})})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto pb-32",children:n.jsxs("div",{className:"max-w-4xl mx-auto px-5 py-8 space-y-8",children:[!g&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-[#2FC8B9] to-[#25a89b] rounded-[2rem] blur opacity-20 group-hover:opacity-30 transition duration-1000"}),n.jsxs("div",{className:"relative bg-white rounded-[2rem] p-6 sm:p-8 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.08)] border border-slate-100",children:[!c.trim()&&!g&&n.jsxs("div",{className:"flex flex-col items-center text-center mb-8 animate-in fade-in zoom-in duration-500",children:[n.jsx("div",{className:"w-16 h-16 bg-[#2FC8B9]/10 rounded-2xl flex items-center justify-center mb-4 border border-[#2FC8B9]/20",children:n.jsx(K3,{className:"w-8 h-8 text-[#2FC8B9]"})}),n.jsx("h2",{className:"text-2xl font-black text-[#1e293b] mb-2",children:"Track Your Meal"}),n.jsx("p",{className:"text-slate-500 text-sm max-w-[280px]",children:"Take a photo or type what you ate for instant nutritional insights."})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-[#2FC8B9]/10 p-1.5 rounded-lg border border-[#2FC8B9]/20",children:n.jsx(qd,{className:"w-4 h-4 text-[#2FC8B9]"})}),n.jsx("input",{type:"text",value:c,onChange:Ve,onFocus:()=>{c.trim()&&Y.length>0&&V(!0)},placeholder:"What's on your plate?",className:"w-full pl-14 pr-4 py-6 bg-slate-50/50 border-2 border-[#2FC8B9]/40 rounded-2xl focus:outline-none focus:border-[#2FC8B9] focus:bg-white transition-all text-xl text-slate-800 font-black placeholder-slate-400 shadow-xl"}),Ae&&Y.length>0&&n.jsx("div",{className:"absolute z-[110] w-full mt-2 bg-white/95 backdrop-blur-md border border-slate-200 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2",children:Y.map((qe,ht)=>n.jsxs("button",{onClick:()=>Pe(qe),className:"w-full px-5 py-3.5 text-left hover:bg-[#2FC8B9]/10 transition-colors text-sm font-semibold text-slate-700 flex items-center gap-3 border-b border-slate-50 last:border-0",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[#2FC8B9]"}),qe]},ht))})]}),n.jsxs("div",{className:"flex items-center gap-4 py-2",children:[n.jsx("div",{className:"flex-1 h-[1px] bg-slate-100"}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"OR"}),n.jsx("div",{className:"flex-1 h-[1px] bg-slate-100"})]}),n.jsx("input",{id:"camera-input",type:"file",accept:"image/*",capture:"environment",onChange:ve,className:"hidden",disabled:$}),n.jsx("input",{id:"gallery-input",type:"file",accept:"image/*",onChange:ve,className:"hidden",disabled:$}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("label",{htmlFor:"camera-input",className:`w-full group relative overflow-hidden py-5 bg-slate-900 text-white rounded-2xl font-bold text-sm tracking-wide transition-all active:scale-[0.98] shadow-xl hover:shadow-2xl hover:bg-slate-800 flex items-center justify-center cursor-pointer ${$?"opacity-75 cursor-not-allowed":""}`,children:[n.jsx("div",{className:"relative z-10 flex items-center justify-center gap-3",children:$?n.jsxs(n.Fragment,{children:[n.jsx(Al,{className:"w-5 h-5 animate-spin text-[#2FC8B9]"}),n.jsx("span",{children:"Optimizing Image..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(ZR,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),n.jsx("span",{children:"Scan Food with Camera"})]})}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#2FC8B9]/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),n.jsx("label",{htmlFor:"gallery-input",className:`w-full group relative overflow-hidden py-4 bg-white text-slate-600 border border-slate-200 rounded-2xl font-bold text-sm tracking-wide transition-all active:scale-[0.98] hover:bg-slate-50 flex items-center justify-center cursor-pointer ${$?"opacity-75 cursor-not-allowed":""}`,children:n.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-3",children:[n.jsx(dne,{className:"w-5 h-5 text-[#2FC8B9] group-hover:scale-110 transition-transform"}),n.jsx("span",{children:"Select from Gallery"})]})})]})]})]})]}),!c.trim()&&!g&&n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-emerald-50/50 p-4 rounded-3xl border border-emerald-100 flex flex-col gap-2",children:[n.jsx("div",{className:"w-8 h-8 bg-emerald-100 rounded-xl flex items-center justify-center",children:n.jsx(ul,{className:"w-4 h-4 text-emerald-600"})}),n.jsx("p",{className:"text-xs font-bold text-emerald-900",children:"Track Calories"}),n.jsx("p",{className:"text-[10px] text-emerald-700/80 leading-snug",children:"Instantly see the energy content of your meals."})]}),n.jsxs("div",{className:"bg-amber-50/50 p-4 rounded-3xl border border-amber-100 flex flex-col gap-2",children:[n.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-xl flex items-center justify-center",children:n.jsx(td,{className:"w-4 h-4 text-amber-600"})}),n.jsx("p",{className:"text-xs font-bold text-amber-900",children:"Health Score"}),n.jsx("p",{className:"text-[10px] text-amber-700/80 leading-snug",children:"Know how healthy your food choices are."})]})]})]}),(c.trim()||g)&&n.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4 duration-500",children:[g&&n.jsxs("div",{className:"relative group",children:[n.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-purple-500 to-orange-500 rounded-[2.2rem] blur opacity-10"}),n.jsxs("div",{className:"relative rounded-[2rem] overflow-hidden border-4 border-white shadow-2xl",children:[n.jsx("img",{src:g,alt:"Scanned Food",className:"w-full h-72 object-cover transition-transform duration-700 group-hover:scale-105"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"}),n.jsx("button",{onClick:()=>{g&&g.startsWith("blob:")&&URL.revokeObjectURL(g),p(null),x(null),we({quantity:"",prepMethod:"",additionalInfo:""})},className:"absolute top-4 right-4 p-2.5 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl hover:bg-red-50 hover:text-red-500 transition-all active:scale-95",children:n.jsx(Gn,{className:"w-5 h-5"})}),n.jsx("div",{className:"absolute bottom-4 left-4 flex items-center gap-2",children:n.jsxs("div",{className:"bg-white/95 backdrop-blur-md text-[#2FC8B9] px-4 py-2 rounded-2xl text-[11px] font-black uppercase tracking-wider shadow-lg flex items-center gap-2",children:[n.jsx(Tn,{className:"w-4 h-4"}),"Image Ready"]})})]})]}),n.jsxs("div",{className:"bg-white rounded-[2rem] p-6 sm:p-8 shadow-[0_20px_50px_-12px_rgba(0,0,0,0.06)] border border-slate-100 space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[n.jsx("div",{className:"w-10 h-10 bg-[#2FC8B9]/10 rounded-xl flex items-center justify-center",children:n.jsx(ul,{className:"w-5 h-5 text-[#2FC8B9]"})}),n.jsx("h3",{className:"text-xl font-extrabold text-[#1e293b]",children:"Refine Details"})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3 ml-1",children:"Serving Quantity"}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:(se.length>0?se:["1 serving","1 bowl","1 plate","100g"]).map((qe,ht)=>n.jsx("button",{type:"button",onClick:()=>we({...ie,quantity:qe}),className:`px-3 py-2 rounded-xl text-[11px] font-bold transition-all border-2 ${ie.quantity===qe?"bg-[#2FC8B9] border-[#2FC8B9] text-white shadow-lg shadow-[#2FC8B9]/20":"bg-white border-slate-100 text-slate-600 hover:border-[#2FC8B9]/30"}`,children:qe},ht))}),n.jsx("input",{type:"text",value:ie.quantity,onChange:qe=>we({...ie,quantity:qe.target.value}),placeholder:"Or specify exact amount",className:"w-full px-5 py-3.5 bg-slate-50/80 border-2 border-[#2FC8B9]/20 rounded-xl focus:outline-none focus:border-[#2FC8B9] focus:bg-white transition-all text-sm font-semibold text-slate-800 placeholder-slate-400"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 ml-1",children:"Preparation Method"}),n.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:[{label:"Fried",icon:""},{label:"Baked",icon:""},{label:"Grilled",icon:""},{label:"Home",icon:""},{label:"Dine-in",icon:""},{label:"Packaged",icon:""}].map(qe=>n.jsxs("button",{type:"button",onClick:()=>we({...ie,prepMethod:qe.label}),className:`p-2.5 rounded-xl transition-all border-2 flex flex-col items-center gap-1.5 ${ie.prepMethod===qe.label?"bg-[#2FC8B9] border-[#2FC8B9] text-white shadow-lg shadow-[#2FC8B9]/20":"bg-white border-slate-100 text-slate-600 hover:border-[#2FC8B9]/30"}`,children:[n.jsx("span",{className:"text-lg leading-none",children:qe.icon}),n.jsx("span",{className:"text-[9px] font-black uppercase tracking-tighter",children:qe.label})]},qe.label))})]}),n.jsxs("button",{type:"button",onClick:qe=>{qe.preventDefault(),Te()},disabled:v,className:"w-full group relative overflow-hidden py-5 bg-[#2FC8B9] text-white rounded-[2rem] font-black text-base tracking-widest transition-all active:scale-[0.98] shadow-[0_20px_40px_-12px_rgba(47,200,185,0.3)] disabled:opacity-50",children:[n.jsx("div",{className:"relative z-10 flex items-center justify-center gap-3 uppercase",children:v?n.jsxs(n.Fragment,{children:[n.jsx(Al,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Processing..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(td,{className:"w-5 h-5 group-hover:animate-pulse"}),n.jsx("span",{children:"Analyze Now"})]})}),n.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-white/20 transform translate-y-2 group-hover:translate-y-0 transition-transform"})]})]})]})]}),n.jsx("div",{className:"max-w-md mx-auto text-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 px-6 py-3 bg-[#2FC8B9]/5 backdrop-blur-sm rounded-full border border-[#2FC8B9]/20 group",children:[n.jsx(qd,{className:"w-4 h-4 text-[#2FC8B9] group-hover:rotate-12 transition-transform"}),n.jsx("p",{className:"text-[11px] font-semibold text-[#2FC8B9] tracking-wide",children:"AI analysis is an estimate. Portions may impact accuracy."})]})})]})}),C&&O&&n.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[200] overflow-y-auto px-4 py-8",onClick:qe=>{qe.target===qe.currentTarget&&Be()},children:n.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-[2.5rem] shadow-[0_32px_100px_-12px_rgba(0,0,0,0.25)] overflow-hidden relative animate-in zoom-in-95 slide-in-from-bottom-5 duration-500 ease-out",onClick:qe=>qe.stopPropagation(),children:[n.jsxs("div",{className:"relative p-8 pb-0",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-8",children:[n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsxs("div",{className:"relative w-32 h-32 flex-shrink-0",children:[n.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[n.jsx("circle",{cx:"64",cy:"64",r:"58",stroke:"#f1f5f9",strokeWidth:"10",fill:"none"}),n.jsx("circle",{cx:"64",cy:"64",r:"58",stroke:O.healthScore10>=7?"#10b981":O.healthScore10>=4?"#f59e0b":"#ef4444",strokeWidth:"10",fill:"none",strokeDasharray:364.4,strokeDashoffset:364.4-Math.round((O.healthScore10||O.healthScore/10)*10)/100*364.4,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[n.jsx("span",{className:"text-4xl font-black text-slate-800",children:Math.round((O.healthScore10||O.healthScore/10)*10)}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"out of 100"})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-2 ${O.isHealthy?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:[O.isHealthy?n.jsx(Tn,{className:"w-3 h-3"}):n.jsx(Li,{className:"w-3 h-3"}),O.isHealthy?"Healthy Choice":"Watch Portions"]}),n.jsx("h2",{className:"text-3xl font-black text-slate-800 leading-tight mb-1",children:(ot=O.foodItem)==null?void 0:ot.name}),n.jsxs("p",{className:"text-slate-500 font-bold flex items-center gap-2 uppercase text-[11px] tracking-widest",children:[n.jsx(td,{className:"w-4 h-4 text-[#2FC8B9]"}),((ut=O.foodItem)==null?void 0:ut.quantity)||"Standard Serving"]})]})]}),n.jsx("div",{className:"flex md:flex-col gap-2",children:n.jsx("button",{onClick:Be,className:"p-3 bg-slate-100 text-slate-400 rounded-2xl hover:bg-slate-200 transition-all active:scale-95",children:n.jsx(Gn,{className:"w-6 h-6"})})})]}),(O.imageUrl||g||k)&&n.jsx("div",{className:"mt-8 relative rounded-[2rem] overflow-hidden border-2 border-slate-100 shadow-inner group",children:P&&!O.imageUrl&&!g?n.jsxs("div",{className:"w-full h-48 bg-slate-100 flex flex-col items-center justify-center gap-3",children:[n.jsx(Al,{className:"w-8 h-8 animate-spin text-[#2FC8B9]"}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Finding Photo..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("img",{src:O.imageUrl||g||k,alt:(Tt=O.foodItem)==null?void 0:Tt.name,className:"w-full h-48 object-cover transition-transform duration-700 group-hover:scale-105"}),n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"}),n.jsx("div",{className:"absolute bottom-4 right-4 bg-white/90 backdrop-blur-md px-3 py-1.5 rounded-xl text-[9px] font-black text-slate-600 uppercase tracking-widest border border-white shadow-sm",children:k&&!O.imageUrl&&!g?"Sample Image":"Analyzed Image"})]})})]}),n.jsx("div",{className:"px-8 mt-10",children:n.jsxs("div",{className:"bg-slate-50 rounded-[2.5rem] p-8 border border-slate-100 shadow-inner",children:[n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[{label:"Calories",value:(it=(Qe=O.foodItem)==null?void 0:Qe.nutrition)==null?void 0:it.calories,icon:ul,color:"text-orange-500",bg:"bg-orange-100",b:"border-orange-200"},{label:"Protein",value:(_e=(kt=O.foodItem)==null?void 0:kt.nutrition)==null?void 0:_e.protein,icon:td,color:"text-[#2FC8B9]",bg:"bg-[#2FC8B9]/10",b:"border-[#2FC8B9]/20"},{label:"Carbs",value:(Ke=(xt=O.foodItem)==null?void 0:xt.nutrition)==null?void 0:Ke.carbs,icon:br,color:"text-emerald-500",bg:"bg-emerald-100",b:"border-emerald-200"},{label:"Fats",value:($e=(Je=O.foodItem)==null?void 0:Je.nutrition)==null?void 0:$e.fats,icon:Ca,color:"text-rose-500",bg:"bg-rose-100",b:"border-rose-200"}].map(qe=>{const ht=qe.icon;return n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:`w-14 h-14 rounded-2xl ${qe.bg} flex items-center justify-center mb-3 shadow-sm border ${qe.b}`,children:n.jsx(ht,{className:`w-7 h-7 ${qe.color}`})}),n.jsx("span",{className:"text-sm font-black text-slate-800",children:qe.value||0}),n.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:qe.label})]},qe.label)})}),n.jsx("div",{className:"flex flex-wrap justify-center gap-6 mt-8 pt-8 border-t border-slate-200",children:[{label:"Fiber",value:(Kt=(jt=O.foodItem)==null?void 0:jt.nutrition)==null?void 0:Kt.fiber,unit:"g"},{label:"Sugar",value:(ss=(os=O.foodItem)==null?void 0:os.nutrition)==null?void 0:ss.sugar,unit:"g"},{label:"Sodium",value:(Ht=(mt=O.foodItem)==null?void 0:mt.nutrition)==null?void 0:Ht.sodium,unit:"mg"}].map(qe=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-300"}),n.jsxs("span",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:[qe.label,":"]}),n.jsxs("span",{className:"text-xs font-black text-slate-800",children:[qe.value||0,qe.unit]})]},qe.label))})]})}),n.jsxs("div",{className:"px-8 py-10 space-y-10",children:[n.jsxs("div",{className:"bg-[#2FC8B9]/10 rounded-[2.5rem] p-7 border border-[#2FC8B9]/20 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-8 h-8 rounded-xl bg-[#2FC8B9]/20 flex items-center justify-center text-[#2FC8B9]",children:n.jsx(br,{className:"w-4 h-4"})}),n.jsx("h4",{className:"text-sm font-black text-slate-700 tracking-tight uppercase",children:"Micronutrients Breakdown"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(O.micronutrients||[]).map((qe,ht)=>n.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-[#2FC8B9]/10 shadow-sm",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-[11px] font-black text-slate-700 truncate",children:typeof qe=="object"?qe.name:qe}),n.jsxs("span",{className:"text-[10px] font-black text-[#2FC8B9]",children:[typeof qe=="object"?qe.percentage:"--","%"]})]}),n.jsx("p",{className:"text-xl font-black text-slate-800 mb-2",children:typeof qe=="object"?qe.value:"--"}),n.jsx("div",{className:"h-1.5 bg-slate-100 rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full bg-[#2FC8B9] rounded-full transition-all duration-1000",style:{width:`${typeof qe=="object"?qe.percentage:0}%`}})})]},ht)),(!O.micronutrients||O.micronutrients.length===0)&&n.jsx("p",{className:"text-slate-400 text-xs italic p-4 text-center col-span-2",children:"No micronutrient data available"})]})]}),n.jsxs("div",{className:"bg-emerald-50/50 rounded-[2.5rem] p-7 border border-emerald-100 relative overflow-hidden group",children:[n.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full blur-2xl -mr-10 -mt-10"}),n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-500 flex items-center justify-center text-white shadow-lg shadow-emerald-200 group-hover:rotate-12 transition-transform",children:n.jsx(qR,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-emerald-900 tracking-tight uppercase",children:"Health Benefits"})]}),n.jsx("p",{className:"text-xs font-bold text-emerald-800/80 leading-relaxed",children:O.healthBenefitsSummary||O.analysis||"This meal provides essential nutrients for your daily requirements."})]}),n.jsxs("div",{className:"bg-amber-50/40 rounded-[2.5rem] p-7 border border-amber-100 group",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[n.jsx("div",{className:"w-10 h-10 rounded-2xl bg-white border border-amber-100 flex items-center justify-center text-orange-500 group-hover:scale-110 transition-transform",children:n.jsx(KA,{className:"w-5 h-5"})}),n.jsx("h4",{className:"text-sm font-black text-amber-900 tracking-tight uppercase",children:"Make it even Healthier"})]}),n.jsxs("div",{className:"space-y-3",children:[(O.enhancementTips||[]).map((qe,ht)=>n.jsxs("div",{className:"bg-white rounded-[1.5rem] p-4 flex items-center gap-4 border border-amber-100 shadow-sm hover:shadow-md transition-all",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center text-white shrink-0",children:n.jsx(Zo,{className:"w-5 h-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-sm font-black text-slate-800 mb-0.5",children:typeof qe=="object"?qe.name:qe}),n.jsx("p",{className:"text-[10px] font-bold text-slate-500 truncate",children:typeof qe=="object"?qe.benefit:"Adds nutritional value"})]})]},ht)),(!O.enhancementTips||O.enhancementTips.length===0)&&n.jsx("div",{className:"text-center py-4 text-slate-400 text-xs font-bold uppercase tracking-widest italic",children:"Already optimal!"})]})]}),n.jsxs("div",{className:"relative group p-1",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 flex items-center gap-2",children:[n.jsx(qd,{className:"w-4 h-4 text-[#2FC8B9]"}),"Analysis Detail"]}),n.jsx("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm",children:n.jsx("p",{className:"text-slate-600 font-medium leading-relaxed",children:O.analysis})})]})]}),O.warnings&&O.warnings.length>0&&n.jsxs("div",{className:"px-8 pb-10 space-y-4",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 flex items-center gap-2",children:[n.jsx(Li,{className:"w-4 h-4 text-rose-500"}),"Nutritional Alerts"]}),n.jsx("div",{className:"grid gap-3",children:O.warnings.map((qe,ht)=>n.jsxs("div",{className:"bg-rose-50/50 border border-rose-100 rounded-2xl p-4 flex items-center gap-4 group",children:[n.jsx("div",{className:"w-10 h-10 bg-rose-100 rounded-xl flex items-center justify-center shrink-0 group-hover:rotate-12 transition-transform",children:n.jsx(Li,{className:"w-5 h-5 text-rose-600"})}),n.jsx("p",{className:"text-xs font-bold text-rose-900 leading-tight",children:qe})]},ht))})]}),O.alternatives&&O.alternatives.length>0&&n.jsxs("div",{className:"space-y-4 px-8 pb-10",children:[n.jsxs("h3",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-1 flex items-center gap-2",children:[n.jsx(ul,{className:"w-4 h-4 text-emerald-500"}),"Smart Alternatives"]}),n.jsx("div",{className:"flex overflow-x-auto scrollbar-hide gap-5 -mx-8 px-8",children:O.alternatives.map((qe,ht)=>{var Xt;return n.jsxs("div",{className:"min-w-[280px] group bg-white border border-slate-100 rounded-[2rem] p-6 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-black text-slate-800 text-base leading-tight group-hover:text-emerald-600 transition-colors uppercase tracking-tight",children:qe.name}),n.jsxs("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[qe.prepTime||"Quick"," Prep"]})]}),n.jsxs("div",{className:"bg-emerald-50 text-emerald-600 text-[11px] font-black px-3 py-1.5 rounded-xl border border-emerald-100",children:[(Xt=qe.nutrition)==null?void 0:Xt.calories," Kcal"]})]}),n.jsxs("p",{className:"text-xs text-slate-500 font-medium leading-relaxed mb-6 line-clamp-2 italic",children:['"',qe.description,'"']}),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-50",children:[n.jsx("div",{className:"flex gap-2",children:n.jsx("div",{className:"px-2 py-1 bg-[#2FC8B9]/10 text-[#2FC8B9] text-[9px] font-black rounded-lg uppercase",children:"High Prot"})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Satiety"}),n.jsxs("span",{className:"text-xs font-black text-slate-800",children:[qe.satietyScore||8,"/10"]})]})]})]},ht)})})]}),n.jsxs("div",{className:"flex gap-4 pt-6",children:[n.jsx("button",{onClick:Be,className:"flex-1 py-5 bg-slate-100 text-slate-600 rounded-[2rem] font-black text-sm uppercase tracking-widest hover:bg-slate-200 transition-all active:scale-95",children:"Discard"}),n.jsxs("button",{onClick:Ue,className:"flex-[2] py-5 bg-[#2FC8B9] text-white rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-[0_20px_40px_-12px_rgba(47,200,185,0.3)] hover:opacity-90 transition-all active:scale-95 flex items-center justify-center gap-3",children:[n.jsx(Tn,{className:"w-5 h-5 text-white/80"}),"Add to Diary"]})]})]})}),he&&n.jsx("div",{className:"fixed inset-0 bg-black/60 z-[10001] flex items-end sm:items-center justify-center",onClick:()=>Ne(!1),children:n.jsxs("div",{className:"bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl p-6",onClick:qe=>qe.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Select Meal Type"}),n.jsx("button",{onClick:()=>Ne(!1),className:"p-2 hover:bg-gray-100 rounded-full",children:n.jsx(Gn,{className:"w-5 h-5 text-gray-700"})})]}),n.jsx("div",{className:"space-y-3 mb-6",children:[{type:"breakfast",icon:"",label:"Breakfast",color:"from-[#2FC8B9] to-[#25a89b]"},{type:"lunch",icon:"",label:"Lunch",color:"from-[#2FC8B9] to-[#25a89b]"},{type:"dinner",icon:"",label:"Dinner",color:"from-[#2FC8B9] to-[#25a89b]"},{type:"snack",icon:"",label:"Snacks",color:"from-[#2FC8B9] to-[#25a89b]"}].map(qe=>n.jsxs("button",{onClick:()=>Ie(qe.type),className:`w-full p-4 rounded-xl flex items-center gap-4 transition-all ${Z===qe.type?`bg-gradient-to-r ${qe.color} text-white shadow-lg scale-105`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx("span",{className:"text-3xl",children:qe.icon}),n.jsx("div",{className:"flex-1 text-left",children:n.jsx("p",{className:"font-bold text-lg",children:qe.label})}),Z===qe.type&&n.jsx(Tn,{className:"w-6 h-6"})]},qe.type))}),n.jsx("button",{onClick:tt,disabled:J,className:"w-full py-4 bg-[#2FC8B9] text-white rounded-xl font-bold hover:shadow-lg transition-all active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-70",children:J?n.jsxs(n.Fragment,{children:[n.jsx(Al,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Logging..."})]}):n.jsxs(n.Fragment,{children:[n.jsx(Tn,{className:"w-5 h-5"}),n.jsxs("span",{children:["Log to ",Z.charAt(0).toUpperCase()+Z.slice(1)]})]})})]})}),v&&n.jsxs("div",{className:"fixed inset-0 bg-slate-900 z-[10000] flex items-center justify-center overflow-hidden",style:{position:"fixed",top:0,left:0,right:0,bottom:0,touchAction:"none"},children:[n.jsxs("div",{className:"absolute top-0 left-0 w-full h-full",children:[n.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-[#2FC8B9]/20 rounded-full blur-[120px] animate-pulse"}),n.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-[#2FC8B9]/10 rounded-full blur-[120px] animate-pulse",style:{animationDelay:"1s"}})]}),n.jsxs("div",{className:"relative text-center px-8 w-full max-w-lg",children:[n.jsx("div",{className:"relative mb-12",children:n.jsxs("div",{className:"w-48 h-48 mx-auto relative",children:[n.jsx("div",{className:"absolute inset-0 border-[3px] border-dashed border-[#2FC8B9]/30 rounded-full animate-spin",style:{animationDuration:"8s"}}),n.jsx("div",{className:"absolute inset-4 bg-gradient-to-br from-[#2FC8B9] to-[#25a89b] rounded-full p-1 shadow-[0_0_50px_rgba(47,200,185,0.5)]",children:n.jsxs("div",{className:"w-full h-full bg-slate-900 rounded-full flex items-center justify-center overflow-hidden",children:[n.jsx("div",{className:"absolute inset-x-0 h-1 bg-[#2FC8B9]/50 blur-sm animate-[scan_2s_linear_infinite]"}),n.jsx(K3,{className:"w-16 h-16 text-[#2FC8B9] drop-shadow-[0_0_10px_rgba(47,200,185,0.8)]"})]})})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("h2",{className:"text-4xl font-black text-white tracking-tighter",children:["Scanning ",n.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#2FC8B9] to-[#bafff9]",children:"Nutrition"})]}),n.jsx("p",{className:"text-slate-400 font-bold text-sm uppercase tracking-[0.3em]",children:"AI processing active"})]}),n.jsx("div",{className:"mt-12 space-y-3 bg-white/5 backdrop-blur-md rounded-[2.5rem] p-8 border border-white/10 shadow-2xl",children:[{text:"Optimizing high-res capture",active:!1,done:!0},{text:"Neural food recognition",active:!0,done:!1},{text:"Cross-referencing database",active:!1,done:!1},{text:"Calculating health impact",active:!1,done:!1}].map((qe,ht)=>n.jsxs("div",{className:`flex items-center gap-4 transition-opacity duration-500 ${qe.done||qe.active?"opacity-100":"opacity-20"}`,children:[qe.done?n.jsx("div",{className:"w-2 h-2 rounded-full bg-[#2FC8B9] shadow-[0_0_10px_rgba(47,200,185,1)]"}):qe.active?n.jsx("div",{className:"w-2 h-2 rounded-full bg-[#2FC8B9] animate-ping"}):n.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-600"}),n.jsx("span",{className:`text-xs font-bold uppercase tracking-widest ${qe.active?"text-[#2FC8B9]":"text-slate-300"}`,children:qe.text})]},ht))}),n.jsxs("div",{className:"mt-8 flex items-center justify-center gap-3",children:[n.jsx(qd,{className:"w-4 h-4 text-[#2FC8B9]/70"}),n.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest leading-loose",children:"DO NOT DISCONNECT  ANALYZING COMPOSITION"})]})]}),n.jsx("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes scan {
                  0% { transform: translateY(-100%); opacity: 0; }
                  50% { opacity: 1; }
                  100% { transform: translateY(100%); opacity: 0; }
                }
                .scrollbar-hide::-webkit-scrollbar { display: none; }
                .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
              `}})]})]})}const p0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=ee.useState(150),[p,g]=ee.useState("fasting"),x=new Date;x.setMinutes(x.getMinutes()-x.getTimezoneOffset());const[v,E]=ee.useState(x.toISOString().slice(0,16)),C=ee.useRef(null),I=ee.useRef(!1),O=40,R=400;ee.useEffect(()=>{if(a&&C.current){const we=(d-O)*8-C.current.clientWidth/2;C.current.scrollLeft=Math.max(0,we)}},[a]);const k=()=>{if(!C.current)return;const ie=8,we=C.current.scrollLeft,Ae=C.current.clientWidth/2,V=Math.round((we+Ae)/ie)+O;V>=O&&V<=R&&h(V)},M=ie=>{const we=parseInt(ie.target.value);if(isNaN(we))h("");else if(h(we),C.current&&we>=O&&we<=R){const V=(we-O)*8-C.current.clientWidth/2;C.current.scrollLeft=Math.max(0,V)}},P=ie=>{h(we=>{const Ae=Math.min(Math.max(we+ie,O),R);if(C.current){const ce=(Ae-O)*8-C.current.clientWidth/2;C.current.scrollLeft=Math.max(0,ce)}return Ae})},H=()=>{const ie={value:d,type:p,time:new Date(v).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(v).toISOString()};c(ie),o(),h(150),g("fasting")},$=()=>d>=70&&d<=130?"text-slate-800":d>130?"text-red-600":"text-yellow-600";if(!a)return null;const re=[{id:"fasting",label:"Fasting",description:"Reading taken after an overnight fast",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx(Oc,{className:"w-5 h-5 text-gray-500"})})},{id:"before-meal",label:"Before meal",description:"Reading taken within 15 minutes before a major meal",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})},{id:"after-meal",label:"After meal",description:"Reading taken 2 hours after a meal",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})},{id:"bedtime",label:"Bedtime",description:"Reading taken before going to sleep",icon:n.jsx("div",{className:"w-11 h-11 bg-gray-100 rounded-full flex items-center justify-center",children:n.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})}],J=R-O,ge=[];for(let ie=0;ie<=J;ie++){const we=O+ie,Ae=we%10===0,V=we%5===0&&!Ae;ge.push({val:we,isMajor:Ae,isMid:V})}return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto pb-24",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:o,children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full cursor-pointer"})}),n.jsxs("div",{className:"px-5 pb-8 pt-4",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",value:d,onChange:M,className:`w-28 text-6xl font-extrabold ${$()} tracking-tight text-center bg-transparent border-none outline-none focus:ring-0`}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"mg/dL"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-[#2FC8B9]"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>P(-5),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(kg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:C,onScroll:k,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:I.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{I.current=!0},onTouchEnd:()=>{I.current=!1},onMouseDown:()=>{I.current=!0},onMouseUp:()=>{I.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${J*8}px`,paddingLeft:"50%",paddingRight:"50%"},children:ge.map((ie,we)=>n.jsxs("div",{className:"flex flex-col items-center",style:{width:"8px",flexShrink:0},children:[n.jsx("div",{className:`w-px ${ie.isMajor?"h-10 bg-gray-700":ie.isMid?"h-6 bg-gray-400":"h-3 bg-gray-300"}`}),ie.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:ie.val})]},we))})}),n.jsx("button",{onClick:()=>P(5),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Zo,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:v,onChange:ie=>E(ie.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"Type of reading"}),n.jsx("div",{className:"space-y-3",children:re.map(ie=>n.jsx("button",{onClick:()=>g(ie.id),className:`w-full p-4 rounded-2xl border-2 transition-all duration-200 ${p===ie.id?"border-[#2FC8B9] bg-[#2FC8B9]/10 shadow-sm":"border-gray-200 bg-white hover:border-gray-300"}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[ie.icon,n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-sm",children:ie.label}),n.jsx("div",{className:"text-xs text-gray-500 mt-0.5 leading-relaxed",children:ie.description})]})]}),n.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ml-3 transition-all ${p===ie.id?"border-[#2FC8B9] bg-[#2FC8B9]":"border-gray-300"}`,children:p===ie.id&&n.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-full"})})]})},ie.id))})]}),n.jsx("button",{onClick:H,className:"w-full bg-[#2FC8B9] text-white py-4 rounded-full font-bold text-base hover:bg-[#1db7a6] transition-all shadow-lg shadow-[#2FC8B9]/30 active:scale-[0.98]",children:"Save Reading"})]})]})}),n.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.35s cubic-bezier(0.32, 0.72, 0, 1);
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
      `})]})},m0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=ee.useState(5.7),p=new Date;p.setMinutes(p.getMinutes()-p.getTimezoneOffset());const[g,x]=ee.useState(p.toISOString().slice(0,16)),v=ee.useRef(null),E=ee.useRef(!1),C=30,I=150;ee.useEffect(()=>{if(a&&v.current){const J=(d*10-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,J)}},[a]);const O=()=>{if(!v.current)return;const re=8,J=v.current.scrollLeft,ge=v.current.clientWidth/2,ie=Math.round((J+ge)/re)+C;ie>=C&&ie<=I&&h(ie/10)},R=re=>{const J=parseFloat(re.target.value);if(isNaN(J))h("");else if(h(J),v.current&&J*10>=C&&J*10<=I){const ie=(J*10-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,ie)}},k=re=>{h(J=>{const ge=Math.min(Math.max(J*10+re,C),I),ie=ge/10;if(v.current){const Ae=(ge-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,Ae)}return ie})},M=()=>{const re={value:d,type:"hba1c",time:new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(g).toISOString()};c(re),o()},P=()=>d>=4&&d<=5.6?"text-emerald-600":d>=5.7&&d<=6.4?"text-yellow-600":"text-red-600";if(!a)return null;const H=I-C,$=[];for(let re=0;re<=H;re++){const J=C+re,ge=J%10===0,ie=J%5===0&&!ge;$.push({val:J/10,isMajor:ge,isMid:ie})}return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto pb-24",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:o,children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full cursor-pointer"})}),n.jsxs("div",{className:"px-5 pb-8 pt-4",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",step:"0.1",value:d,onChange:R,className:`w-32 text-6xl font-extrabold ${P()} tracking-tight text-center bg-transparent border-none outline-none focus:ring-0`}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"%"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-[#2FC8B9]"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>k(-1),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(kg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:v,onScroll:O,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:E.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{E.current=!0},onTouchEnd:()=>{E.current=!1},onMouseDown:()=>{E.current=!0},onMouseUp:()=>{E.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${H*8}px`,paddingLeft:"50%",paddingRight:"50%"},children:$.map((re,J)=>n.jsxs("div",{className:"flex flex-col items-center",style:{width:"8px",flexShrink:0},children:[n.jsx("div",{className:`w-px ${re.isMajor?"h-10 bg-gray-700":re.isMid?"h-6 bg-gray-400":"h-3 bg-gray-300"}`}),re.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:re.val})]},J))})}),n.jsx("button",{onClick:()=>k(1),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Zo,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:g,onChange:re=>x(re.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsx("button",{onClick:M,className:"w-full bg-[#2FC8B9] text-white py-4 rounded-full font-bold text-base hover:bg-[#1db7a6] transition-all shadow-lg shadow-[#2FC8B9]/30 active:scale-[0.98]",children:"Save Reading"})]})]})})]})},f0e=({isOpen:a,onClose:o,onSave:c})=>{const[d,h]=ee.useState(70),p=new Date;p.setMinutes(p.getMinutes()-p.getTimezoneOffset());const[g,x]=ee.useState(p.toISOString().slice(0,16)),v=ee.useRef(null),E=ee.useRef(!1),C=200,I=2500;ee.useEffect(()=>{if(a&&v.current){const re=(d*10-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,re)}},[a]);const O=$=>{const re=parseFloat($.target.value);if(isNaN(re))h("");else if(h(re),v.current&&re*10>=C&&re*10<=I){const ge=(re*10-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,ge)}},R=$=>{h(re=>{const J=Math.min(Math.max(re*10+$,C),I),ge=J/10;if(v.current){const we=(J-C)*8-v.current.clientWidth/2;v.current.scrollLeft=Math.max(0,we)}return ge})},k=()=>{const $={value:d,type:"weight",time:new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),timestamp:new Date(g).toISOString()};c($),o()};if(!a)return null;const M=[];for(let $=0;$<=(I-C)/10;$++){const re=C/10+$,J=re%5===0,ge=re%1===0&&!J;M.push({val:re,isMajor:J,isMid:ge})}const P=80,H=()=>{if(!v.current)return;const $=v.current.scrollLeft,re=v.current.clientWidth/2,J=Math.round(($+re)/(P/10))+C;J>=C&&J<=I&&h(J/10)};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity duration-300",onClick:o}),n.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-slide-up",children:n.jsxs("div",{className:"bg-white rounded-t-3xl shadow-2xl max-h-[92vh] overflow-y-auto pb-24",children:[n.jsx("div",{className:"flex justify-center pt-3 pb-1",onClick:o,children:n.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full cursor-pointer"})}),n.jsxs("div",{className:"px-5 pb-8 pt-4",children:[n.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6 mb-6 text-center flex items-center justify-center",children:[n.jsx("input",{type:"number",step:"0.1",value:d,onChange:O,className:"w-36 text-6xl font-extrabold text-slate-800 tracking-tight text-center bg-transparent border-none outline-none focus:ring-0"}),n.jsx("span",{className:"text-lg text-gray-400 font-medium ml-1",children:"kg"})]}),n.jsxs("div",{className:"mb-8 relative",children:[n.jsx("div",{className:"flex justify-center mb-1",children:n.jsx("div",{className:"w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-[#2FC8B9]"})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>R(-10),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(kg,{className:"w-4 h-4 text-gray-600"})}),n.jsx("div",{ref:v,onScroll:H,className:"flex-1 overflow-x-auto scrollbar-hide relative",style:{scrollBehavior:E.current?"auto":"smooth",WebkitOverflowScrolling:"touch"},onTouchStart:()=>{E.current=!0},onTouchEnd:()=>{E.current=!1},onMouseDown:()=>{E.current=!0},onMouseUp:()=>{E.current=!1},children:n.jsx("div",{className:"flex items-end h-20",style:{width:`${M.length*P}px`,paddingLeft:"50%",paddingRight:"50%"},children:M.map(($,re)=>n.jsxs("div",{className:"flex justify-between items-end",style:{width:`${P}px`,flexShrink:0},children:[n.jsxs("div",{className:"flex flex-col items-center flex-1",children:[n.jsx("div",{className:`w-px ${$.isMajor?"h-10 bg-gray-700":"h-6 bg-gray-400"}`}),$.isMajor&&n.jsx("span",{className:"text-[10px] text-gray-500 mt-1 font-medium",children:$.val})]}),n.jsx("div",{className:"w-px h-3 bg-gray-300"}),n.jsx("div",{className:"w-px h-3 bg-gray-300"}),n.jsx("div",{className:"w-px h-3 bg-gray-300"})]},re))})}),n.jsx("button",{onClick:()=>R(10),className:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors active:scale-95",children:n.jsx(Zo,{className:"w-4 h-4 text-gray-600"})})]})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-3",children:"When was this reading taken?"}),n.jsx("div",{className:"bg-gray-50 rounded-xl p-4 flex items-center justify-between border border-gray-200",children:n.jsx("input",{type:"datetime-local",value:g,onChange:$=>x($.target.value),className:"bg-transparent text-gray-700 text-sm font-medium w-full outline-none"})})]}),n.jsx("button",{onClick:k,className:"w-full bg-[#2FC8B9] text-white py-4 rounded-full font-bold text-base hover:bg-[#1db7a6] transition-all shadow-lg shadow-[#2FC8B9]/30 active:scale-[0.98]",children:"Save Reading"})]})]})})]})},g0e=()=>{const a=Ha(),[o,c]=ee.useState(!1),[d,h]=ee.useState(!1),[p,g]=ee.useState(!1),[x,v]=ee.useState([]),[E,C]=ee.useState([]),[I,O]=ee.useState([]),[R,k]=ee.useState([]),[M,P]=ee.useState(108),[H,$]=ee.useState("stable"),[re,J]=ee.useState(!1),[ge,ie]=ee.useState("108"),[we,Ae]=ee.useState(!0),[V,ce]=ee.useState("blood_sugar"),[Y,z]=ee.useState("Week"),[te,se]=ee.useState(!1),Ce=ee.useRef(null),he=ee.useRef(null);ee.useEffect(()=>{Ne()},[]);const Ne=async()=>{try{Ae(!0);const Qe=await Ft.get("/metrics/blood_sugar?limit=10");v(Qe.data);const[it,kt,_e]=await Promise.all([Ft.get("/metrics/blood_sugar?limit=50"),Ft.get("/metrics/hba1c?limit=50"),Ft.get("/metrics/weight?limit=50")]);if(C(it.data),O(kt.data),k(_e.data),Qe.data&&Qe.data.length>0){const xt=Qe.data[0].value;P(xt),ie(String(xt)),Z(xt)}}catch(Qe){console.error("Error fetching metrics:",Qe)}finally{Ae(!1)}},Z=Qe=>{Qe>=70&&Qe<=130?$("stable"):Qe>130?$("high"):$("low")},Ie=async(Qe,it,kt,_e,xt)=>{try{const Ke={type:Qe,value:it,unit:kt,readingContext:_e,recordedAt:xt,notes:""};await Ft.post("/metrics",Ke),Ne()}catch(Ke){console.error("Error saving reading:",Ke)}},Ve=async Qe=>{await Ie("blood_sugar",Qe.value,"mg/dL",Qe.type,Qe.timestamp)},Pe=async Qe=>{await Ie("hba1c",Qe.value,"%","fasting",Qe.timestamp),ce("hba1c")},ne=async Qe=>{await Ie("weight",Qe.value,"kg","general",Qe.timestamp),ce("weight")},ve=()=>{J(!0),ie(String(M)),setTimeout(()=>{var Qe;return(Qe=Ce.current)==null?void 0:Qe.select()},50)},ue=Qe=>{const it=Qe.target.value.replace(/[^0-9]/g,"");if(it.length<=3){ie(it);const kt=parseInt(it)||0;kt>=40&&kt<=400&&(P(kt),Z(kt))}},Te=()=>{J(!1);const Qe=parseInt(ge)||108,it=Math.min(Math.max(Qe,40),400);P(it),ie(String(it)),Z(it)},Be=Qe=>{Qe.key==="Enter"&&Te()},Ue=Qe=>{if(!he.current)return;const it=he.current.getBoundingClientRect(),kt=it.left+it.width/2,_e=it.top+it.height*.85,xt=Qe.touches?Qe.touches[0].clientX:Qe.clientX,Ke=Qe.touches?Qe.touches[0].clientY:Qe.clientY,Je=xt-kt,$e=_e-Ke;let jt=Math.atan2(Je,$e)*(180/Math.PI);jt=Math.max(-135,Math.min(135,jt));const Kt=40,os=400,ss=Math.round(Kt+(jt+135)/270*(os-Kt)),mt=Math.min(Math.max(ss,Kt),os);P(mt),ie(String(mt)),Z(mt)},tt=()=>-135+(Math.min(Math.max(M,40),400)-40)/360*270,ot=()=>{let Qe=[];if(V==="blood_sugar"?Qe=E:V==="hba1c"?Qe=I:V==="weight"&&(Qe=R),!Qe||Qe.length===0)return[{day:"N/A",value:0}];const it=[...Qe].sort((Je,$e)=>new Date(Je.recordedAt)-new Date($e.recordedAt)),kt=new Date;let _e=new Date;Y==="Week"?_e.setDate(kt.getDate()-7):Y==="Month"?_e.setMonth(kt.getMonth()-1):Y==="3 Months"&&_e.setMonth(kt.getMonth()-3);const xt=it.filter(Je=>new Date(Je.recordedAt)>=_e);return(xt.length>0?xt:it.slice(-7)).map(Je=>{const $e=new Date(Je.recordedAt);return{day:$e.toLocaleDateString("en-US",{weekday:"short"}),value:Je.value,fullDate:$e.toLocaleDateString()}})},ut=()=>V==="hba1c"?[4,6,8,10]:V==="weight"?[50,70,90,110]:[1,48,95,142,190],Tt=Qe=>{const{cx:it,cy:kt,value:_e}=Qe;let xt="#10b981";return V==="blood_sugar"&&(_e>150&&(xt="#f59e0b"),_e<50&&(xt="#ef4444")),n.jsx("circle",{cx:it,cy:kt,r:4,strokeWidth:2,stroke:"#fff",fill:xt})};return n.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-100 pb-28",children:[n.jsx("div",{className:"sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-white/40",children:n.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("button",{onClick:()=>a("/dashboard"),className:"mr-3 p-2 hover:bg-white/60 rounded-full transition-colors",children:n.jsx(Vn,{className:"w-5 h-5 text-slate-700"})}),n.jsx("h1",{className:"text-lg font-bold text-slate-800",children:"Blood Sugar"})]}),n.jsx("div",{children:n.jsx("span",{className:`px-3 py-1 text-white rounded-full text-[11px] font-bold tracking-wide ${H==="stable"?"bg-emerald-500":H==="high"?"bg-red-500":"bg-yellow-500"}`,children:H==="stable"?"IN RANGE":H.toUpperCase()})})]})}),n.jsxs("div",{className:"px-3 md:px-4 py-4 space-y-6 max-w-7xl mx-auto",children:[n.jsx("p",{className:"text-center text-gray-500 text-sm",children:H==="stable"?"Your current status is stable":`Your glucose is ${H}`}),n.jsxs("div",{ref:he,className:"relative w-64 h-40 mx-auto cursor-pointer select-none",onClick:Ue,onMouseDown:Qe=>{const it=_e=>Ue(_e),kt=()=>{document.removeEventListener("mousemove",it),document.removeEventListener("mouseup",kt)};document.addEventListener("mousemove",it),document.addEventListener("mouseup",kt)},onTouchStart:Qe=>{Ue(Qe);const it=_e=>Ue(_e),kt=()=>{document.removeEventListener("touchmove",it),document.removeEventListener("touchend",kt)};document.addEventListener("touchmove",it),document.addEventListener("touchend",kt)},children:[n.jsxs("svg",{viewBox:"0 0 200 130",className:"w-full h-full",children:[n.jsx("path",{d:"M 20 120 A 80 80 0 0 1 180 120",fill:"none",stroke:"#e5e7eb",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 20 120 A 80 80 0 0 1 55 45",fill:"none",stroke:"#22c55e",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 55 45 A 80 80 0 0 1 100 30",fill:"none",stroke:"#f59e0b",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 100 30 A 80 80 0 0 1 145 45",fill:"none",stroke:"#ef4444",strokeWidth:"18",strokeLinecap:"round"}),n.jsx("path",{d:"M 145 45 A 80 80 0 0 1 180 120",fill:"none",stroke:"#f3f4f6",strokeWidth:"18",strokeLinecap:"round"}),n.jsxs("g",{transform:`rotate(${tt()}, 100, 120)`,className:"transition-transform duration-200",children:[n.jsx("line",{x1:"100",y1:"120",x2:"100",y2:"48",stroke:"#1e293b",strokeWidth:"3",strokeLinecap:"round"}),n.jsx("circle",{cx:"100",cy:"120",r:"6",fill:"#1e293b"}),n.jsx("circle",{cx:"100",cy:"120",r:"3",fill:"white"})]})]}),n.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 text-center",children:re?n.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[n.jsx("input",{ref:Ce,type:"text",inputMode:"numeric",value:ge,onChange:ue,onBlur:Te,onKeyDown:Be,className:"w-24 text-5xl font-extrabold text-center bg-transparent outline-none border-b-2 border-blue-500 text-slate-800",autoFocus:!0}),n.jsx("span",{className:"text-sm text-gray-400 font-semibold tracking-wider",children:"MG/DL"})]}):n.jsxs("button",{onClick:ve,className:"group",children:[n.jsx("div",{className:"text-5xl font-extrabold text-slate-800 leading-none group-hover:text-blue-600 transition-colors",children:M}),n.jsx("div",{className:"text-sm text-gray-400 font-semibold tracking-wider mt-1",children:"MG/DL"}),n.jsx("div",{className:"text-[10px] text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity",children:"tap to edit"})]})})]}),n.jsxs("div",{className:"flex justify-center gap-2 px-2 mt-8",children:[n.jsx("button",{onClick:()=>h(!0),className:"flex-1 bg-white border border-blue-100 shadow-sm text-blue-600 py-3 rounded-2xl font-bold text-[13px] hover:bg-blue-50 transition-colors",children:"Log HbA1c"}),n.jsx("button",{onClick:()=>c(!0),className:"flex-[1.5] bg-gradient-to-r from-purple-500 to-orange-600 text-white shadow-md shadow-blue-200 py-3 rounded-2xl font-bold text-[13px] hover:from-purple-600 hover:to-orange-700 transition-colors focus:scale-95",children:"+ Log Glucose"}),n.jsx("button",{onClick:()=>g(!0),className:"flex-1 bg-white border border-blue-100 shadow-sm text-blue-600 py-3 rounded-2xl font-bold text-[13px] hover:bg-blue-50 transition-colors",children:"Log Weight"})]}),n.jsxs("div",{className:"mt-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[n.jsx("h2",{className:"text-lg font-bold text-slate-800",children:"Trend"}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>se(!te),className:"flex items-center gap-1.5 text-sm font-semibold text-blue-600 bg-blue-50/80 px-3 py-1.5 rounded-full",children:[V==="blood_sugar"?"Glucose":V==="hba1c"?"HbA1c":"Weight",n.jsx(uh,{className:"w-4 h-4"})]}),te&&n.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden z-20 w-36",children:[n.jsx("button",{onClick:()=>{ce("blood_sugar"),se(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${V==="blood_sugar"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"Glucose"}),n.jsx("button",{onClick:()=>{ce("hba1c"),se(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${V==="hba1c"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"HbA1c"}),n.jsx("button",{onClick:()=>{ce("weight"),se(!1)},className:`w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-blue-50 ${V==="weight"?"text-blue-600 bg-blue-50/50":"text-slate-700"}`,children:"Weight"})]})]})]}),n.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-3xl p-5 shadow-[0_4px_20px_rgba(0,0,0,0.04)] border border-white",children:[n.jsx("div",{className:"bg-gray-100/80 rounded-full p-1 flex items-center justify-between mb-4",children:["Week","Month","3 Months"].map(Qe=>n.jsx("button",{onClick:()=>z(Qe),className:`flex-1 py-2 text-[13px] font-bold rounded-full transition-all ${Y===Qe?"bg-[#1e293b] text-white shadow-md":"text-slate-500 hover:text-slate-700"}`,children:Qe},Qe))}),n.jsxs("div",{className:"flex justify-between items-end mb-4",children:[n.jsx("div",{children:n.jsxs("div",{className:"text-2xl font-extrabold text-[#112340] leading-none flex items-baseline gap-1",children:[(()=>{const it=ot().filter(_e=>_e.day!=="N/A");if(it.length===0)return"0%";const kt=it.filter(_e=>V==="blood_sugar"?_e.value>=70&&_e.value<=130:V==="hba1c"?_e.value<7:!0).length;return Math.round(kt/it.length*100)+"%"})()," ",n.jsx("span",{className:"text-sm font-bold text-slate-800",children:V==="blood_sugar"?"normal":V==="hba1c"?"goal":"recorded"})]})}),n.jsx("div",{className:"text-xs font-semibold text-slate-400",children:Y==="Week"?"Last 7 days":Y==="Month"?"Last 30 days":"Last 90 days"})]}),V==="blood_sugar"&&n.jsxs("div",{className:"flex items-center gap-4 mb-6 flex-wrap",children:[n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#10b981]"})," ","Normal"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#f59e0b]"})," High"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#ef4444]"})," ","Critical"]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-[11.5px] font-bold text-slate-700",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#d97706]"})," Low"]})]}),n.jsx("div",{className:"h-56 w-full -ml-3",children:n.jsx(Yp,{width:"100%",height:"100%",children:n.jsxs(cQ,{data:ot(),margin:{top:10,right:10,left:0,bottom:0},children:[n.jsx(Eg,{strokeDasharray:"3 3",vertical:!0,horizontal:!0,stroke:"#f1f5f9"}),n.jsx(Cg,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},dy:10}),n.jsx(Sg,{axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"#94a3b8",fontWeight:600},ticks:ut(),domain:["dataMin - 10","dataMax + 10"]}),n.jsx(lQ,{type:"monotone",dataKey:"value",stroke:"#94a3b8",strokeWidth:1.5,dot:Tt,isAnimationActive:!0})]})})}),V==="blood_sugar"&&n.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide gap-2 mt-6 pb-1",children:[n.jsx("button",{className:"flex-shrink-0 bg-[#1e293b] text-white px-4 py-1.5 rounded-full text-xs font-bold",children:"All"}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500 rotate-45"})," ","Fasting"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500"})," ","Pre-meal"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-sm bg-blue-500 rotate-45"})," ","Post-meal"]}),n.jsxs("button",{className:"flex-shrink-0 bg-blue-50/50 text-[#1c5dfd] px-4 py-1.5 rounded-full text-xs font-bold flex items-center gap-1",children:[n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," ","Random"]})]})]})]}),(()=>{const Qe=V==="blood_sugar"?E:V==="hba1c"?I:R;return!Qe||Qe.length===0?null:n.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-3xl border border-white/60 shadow-sm p-4 sm:p-6 !mt-6",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-800 mb-3",children:["Recent ",V==="blood_sugar"?"Glucose":V==="hba1c"?"HbA1c":"Weight"," Logs"]}),n.jsx("div",{className:"space-y-2",children:Qe.slice(0,5).map((it,kt)=>{var Ke,Je;const xt=new Date(it.recordedAt||it.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/60 rounded-xl",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center ${it.value>=70&&it.value<=130?"bg-green-100":it.value>130?"bg-red-100":"bg-yellow-100"}`,children:n.jsx(YR,{className:`w-4 h-4 ${it.value>=70&&it.value<=130?"text-green-600":it.value>130?"text-red-600":"text-yellow-600"}`})}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[it.value," ",it.type==="hba1c"?"%":it.type==="weight"?"kg":"mg/dL"]}),n.jsx("p",{className:"text-xs text-gray-400 capitalize",children:((Ke=it.readingContext)==null?void 0:Ke.replace("-"," "))||((Je=it.type)==null?void 0:Je.replace("_"," "))})]})]}),n.jsx("span",{className:"text-xs text-gray-400",children:xt})]},kt)})})]})})()]}),n.jsx(p0e,{isOpen:o,onClose:()=>c(!1),onSave:Ve}),n.jsx(m0e,{isOpen:d,onClose:()=>h(!1),onSave:Pe}),n.jsx(f0e,{isOpen:p,onClose:()=>g(!1),onSave:ne})]})},$i=({children:a,allowedRoles:o})=>{const{user:c,loading:d}=da();return d?n.jsx(XA,{}):c?o&&!o.includes(c.role)?c.role==="admin"?n.jsx(Tc,{to:"/admin"}):c.role==="doctor"?n.jsx(Tc,{to:"/doctor/dashboard"}):n.jsx(Tc,{to:"/dashboard"}):a:n.jsx(Tc,{to:"/login"})},b0e=({children:a})=>{const{user:o,loading:c,isAdmin:d}=da();return c?n.jsx(XA,{}):o?d()?a:n.jsx(Tc,{to:"/dashboard"}):n.jsx(Tc,{to:"/login"})},HT=({children:a})=>{const{user:o,loading:c,isDoctor:d}=da();return c?n.jsx(XA,{}):o?d()?a:n.jsx(Tc,{to:"/dashboard"}):n.jsx(Tc,{to:"/login"})};function x0e(){const{user:a,isAdmin:o,isDoctor:c}=da(),d=()=>a?o()?n.jsx(Tc,{to:"/admin"}):c()?n.jsx(Tc,{to:"/doctor/dashboard"}):n.jsx(Tc,{to:"/dashboard"}):n.jsx(oce,{});return n.jsxs("div",{className:"min-h-screen bg-white",children:[n.jsx(zQ,{}),n.jsxs(kre,{children:[n.jsx(wn,{path:"/",element:n.jsx(ace,{})}),n.jsx(wn,{path:"/login",element:d()}),n.jsx(wn,{path:"/register",element:a?n.jsx(Tc,{to:"/dashboard"}):n.jsx(cce,{})}),n.jsx(wn,{path:"/register/doctor",element:a?n.jsx(Tc,{to:"/doctor/dashboard"}):n.jsx(dce,{})}),n.jsx(wn,{path:"/dashboard",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(xce,{})})})}),n.jsx(wn,{path:"/upload",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(mle,{})})})}),n.jsx(wn,{path:"/reports",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Gle,{})})})}),n.jsx(wn,{path:"/reports/:id",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(fle,{})})})}),n.jsx(wn,{path:"/reports/:id/summary",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(d0e,{})})})}),n.jsx(wn,{path:"/challenge",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Kle,{})})})}),n.jsx(wn,{path:"/diabetes",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Wle,{})})})}),n.jsx(wn,{path:"/doctors",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(ble,{})})})}),n.jsx(wn,{path:"/consultation/:appointmentId",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(kle,{})})}),n.jsx(wn,{path:"/consultation-summary/:appointmentId",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Dle,{})})})}),n.jsx(wn,{path:"/wearables",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Rle,{})})})}),n.jsx(wn,{path:"/nutrition",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Qle,{})})})}),n.jsx(wn,{path:"/quick-food-scan",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(h0e,{})})})}),n.jsx(wn,{path:"/glucose-log",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(g0e,{})})})}),n.jsx(wn,{path:"/vital-signs",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(A0e,{})})})}),n.jsx(wn,{path:"/supplements",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(u0e,{})})})}),n.jsx(wn,{path:"/subscription",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Tle,{})})})}),n.jsx(wn,{path:"/diet-plan",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Mle,{})})})}),n.jsx(wn,{path:"/ai-chat",element:n.jsx($i,{allowedRoles:["patient","client"],children:n.jsx(wi,{children:n.jsx(Vle,{})})})}),n.jsx(wn,{path:"/doctor/dashboard",element:n.jsx(HT,{children:n.jsx(wi,{isDoctor:!0,children:n.jsx(vce,{})})})}),n.jsx(wn,{path:"/doctor/availability",element:n.jsx(HT,{children:n.jsx(wi,{isDoctor:!0,children:n.jsx(Lle,{})})})}),n.jsx(wn,{path:"/patient/:patientId",element:n.jsx(HT,{children:n.jsx(wi,{isDoctor:!0,children:n.jsx(Ile,{})})})}),n.jsx(wn,{path:"/profile",element:n.jsx($i,{children:n.jsx(wi,{children:n.jsx(xle,{})})})}),n.jsx(wn,{path:"/admin",element:n.jsx(b0e,{children:n.jsx(wi,{isAdmin:!0,children:n.jsx(Ele,{})})})}),n.jsx(wn,{path:"/demo",element:n.jsx(yle,{})})]})]})}qT.createRoot(document.getElementById("root")).render(n.jsx(qV.StrictMode,{children:n.jsx(Dre,{children:n.jsx(Pae,{children:n.jsxs(Ace,{children:[n.jsx(x0e,{}),n.jsx(nie,{position:"top-right"})]})})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(a=>{console.log(" Service Worker registered:",a.scope)}).catch(a=>{console.log(" Service Worker registration failed:",a)})});export{_n as _};
