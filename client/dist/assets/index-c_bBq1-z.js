function f_e(e,n){for(var a=0;a<n.length;a++){const o=n[a];if(typeof o!="string"&&!Array.isArray(o)){for(const d in o)if(d!=="default"&&!(d in e)){const h=Object.getOwnPropertyDescriptor(o,d);h&&Object.defineProperty(e,d,h.get?h:{enumerable:!0,get:()=>o[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const h of d)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function a(d){const h={};return d.integrity&&(h.integrity=d.integrity),d.referrerPolicy&&(h.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?h.credentials="include":d.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(d){if(d.ep)return;d.ep=!0;const h=a(d);fetch(d.href,h)}})();var jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ar(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var BY={exports:{}},Dw={},GY={exports:{}},Cn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j0=Symbol.for("react.element"),g_e=Symbol.for("react.portal"),v_e=Symbol.for("react.fragment"),y_e=Symbol.for("react.strict_mode"),__e=Symbol.for("react.profiler"),b_e=Symbol.for("react.provider"),x_e=Symbol.for("react.context"),E_e=Symbol.for("react.forward_ref"),S_e=Symbol.for("react.suspense"),w_e=Symbol.for("react.memo"),T_e=Symbol.for("react.lazy"),Y$=Symbol.iterator;function C_e(e){return e===null||typeof e!="object"?null:(e=Y$&&e[Y$]||e["@@iterator"],typeof e=="function"?e:null)}var WY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$Y=Object.assign,HY={};function Ff(e,n,a){this.props=e,this.context=n,this.refs=HY,this.updater=a||WY}Ff.prototype.isReactComponent={};Ff.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};Ff.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function zY(){}zY.prototype=Ff.prototype;function u2(e,n,a){this.props=e,this.context=n,this.refs=HY,this.updater=a||WY}var h2=u2.prototype=new zY;h2.constructor=u2;$Y(h2,Ff.prototype);h2.isPureReactComponent=!0;var q$=Array.isArray,KY=Object.prototype.hasOwnProperty,p2={current:null},YY={key:!0,ref:!0,__self:!0,__source:!0};function qY(e,n,a){var o,d={},h=null,f=null;if(n!=null)for(o in n.ref!==void 0&&(f=n.ref),n.key!==void 0&&(h=""+n.key),n)KY.call(n,o)&&!YY.hasOwnProperty(o)&&(d[o]=n[o]);var y=arguments.length-2;if(y===1)d.children=a;else if(1<y){for(var b=Array(y),x=0;x<y;x++)b[x]=arguments[x+2];d.children=b}if(e&&e.defaultProps)for(o in y=e.defaultProps,y)d[o]===void 0&&(d[o]=y[o]);return{$$typeof:j0,type:e,key:h,ref:f,props:d,_owner:p2.current}}function N_e(e,n){return{$$typeof:j0,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function m2(e){return typeof e=="object"&&e!==null&&e.$$typeof===j0}function R_e(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return n[a]})}var X$=/\/+/g;function mO(e,n){return typeof e=="object"&&e!==null&&e.key!=null?R_e(""+e.key):n.toString(36)}function ME(e,n,a,o,d){var h=typeof e;(h==="undefined"||h==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(h){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case j0:case g_e:f=!0}}if(f)return f=e,d=d(f),e=o===""?"."+mO(f,0):o,q$(d)?(a="",e!=null&&(a=e.replace(X$,"$&/")+"/"),ME(d,n,a,"",function(x){return x})):d!=null&&(m2(d)&&(d=N_e(d,a+(!d.key||f&&f.key===d.key?"":(""+d.key).replace(X$,"$&/")+"/")+e)),n.push(d)),1;if(f=0,o=o===""?".":o+":",q$(e))for(var y=0;y<e.length;y++){h=e[y];var b=o+mO(h,y);f+=ME(h,n,a,b,d)}else if(b=C_e(e),typeof b=="function")for(e=b.call(e),y=0;!(h=e.next()).done;)h=h.value,b=o+mO(h,y++),f+=ME(h,n,a,b,d);else if(h==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return f}function nE(e,n,a){if(e==null)return e;var o=[],d=0;return ME(e,o,"","",function(h){return n.call(a,h,d++)}),o}function A_e(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var Aa={current:null},UE={transition:null},I_e={ReactCurrentDispatcher:Aa,ReactCurrentBatchConfig:UE,ReactCurrentOwner:p2};function XY(){throw Error("act(...) is not supported in production builds of React.")}Cn.Children={map:nE,forEach:function(e,n,a){nE(e,function(){n.apply(this,arguments)},a)},count:function(e){var n=0;return nE(e,function(){n++}),n},toArray:function(e){return nE(e,function(n){return n})||[]},only:function(e){if(!m2(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Cn.Component=Ff;Cn.Fragment=v_e;Cn.Profiler=__e;Cn.PureComponent=u2;Cn.StrictMode=y_e;Cn.Suspense=S_e;Cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I_e;Cn.act=XY;Cn.cloneElement=function(e,n,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=$Y({},e.props),d=e.key,h=e.ref,f=e._owner;if(n!=null){if(n.ref!==void 0&&(h=n.ref,f=p2.current),n.key!==void 0&&(d=""+n.key),e.type&&e.type.defaultProps)var y=e.type.defaultProps;for(b in n)KY.call(n,b)&&!YY.hasOwnProperty(b)&&(o[b]=n[b]===void 0&&y!==void 0?y[b]:n[b])}var b=arguments.length-2;if(b===1)o.children=a;else if(1<b){y=Array(b);for(var x=0;x<b;x++)y[x]=arguments[x+2];o.children=y}return{$$typeof:j0,type:e.type,key:d,ref:h,props:o,_owner:f}};Cn.createContext=function(e){return e={$$typeof:x_e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:b_e,_context:e},e.Consumer=e};Cn.createElement=qY;Cn.createFactory=function(e){var n=qY.bind(null,e);return n.type=e,n};Cn.createRef=function(){return{current:null}};Cn.forwardRef=function(e){return{$$typeof:E_e,render:e}};Cn.isValidElement=m2;Cn.lazy=function(e){return{$$typeof:T_e,_payload:{_status:-1,_result:e},_init:A_e}};Cn.memo=function(e,n){return{$$typeof:w_e,type:e,compare:n===void 0?null:n}};Cn.startTransition=function(e){var n=UE.transition;UE.transition={};try{e()}finally{UE.transition=n}};Cn.unstable_act=XY;Cn.useCallback=function(e,n){return Aa.current.useCallback(e,n)};Cn.useContext=function(e){return Aa.current.useContext(e)};Cn.useDebugValue=function(){};Cn.useDeferredValue=function(e){return Aa.current.useDeferredValue(e)};Cn.useEffect=function(e,n){return Aa.current.useEffect(e,n)};Cn.useId=function(){return Aa.current.useId()};Cn.useImperativeHandle=function(e,n,a){return Aa.current.useImperativeHandle(e,n,a)};Cn.useInsertionEffect=function(e,n){return Aa.current.useInsertionEffect(e,n)};Cn.useLayoutEffect=function(e,n){return Aa.current.useLayoutEffect(e,n)};Cn.useMemo=function(e,n){return Aa.current.useMemo(e,n)};Cn.useReducer=function(e,n,a){return Aa.current.useReducer(e,n,a)};Cn.useRef=function(e){return Aa.current.useRef(e)};Cn.useState=function(e){return Aa.current.useState(e)};Cn.useSyncExternalStore=function(e,n,a){return Aa.current.useSyncExternalStore(e,n,a)};Cn.useTransition=function(){return Aa.current.useTransition()};Cn.version="18.3.1";GY.exports=Cn;var Y=GY.exports;const ge=ar(Y),O_e=f_e({__proto__:null,default:ge},[Y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P_e=Y,D_e=Symbol.for("react.element"),k_e=Symbol.for("react.fragment"),j_e=Object.prototype.hasOwnProperty,L_e=P_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M_e={key:!0,ref:!0,__self:!0,__source:!0};function JY(e,n,a){var o,d={},h=null,f=null;a!==void 0&&(h=""+a),n.key!==void 0&&(h=""+n.key),n.ref!==void 0&&(f=n.ref);for(o in n)j_e.call(n,o)&&!M_e.hasOwnProperty(o)&&(d[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)d[o]===void 0&&(d[o]=n[o]);return{$$typeof:D_e,type:e,key:h,ref:f,props:d,_owner:L_e.current}}Dw.Fragment=k_e;Dw.jsx=JY;Dw.jsxs=JY;BY.exports=Dw;var l=BY.exports,C1={},QY={exports:{}},Rs={},ZY={exports:{}},eq={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(Q,le){var we=Q.length;Q.push(le);e:for(;0<we;){var Ue=we-1>>>1,Le=Q[Ue];if(0<d(Le,le))Q[Ue]=le,Q[we]=Le,we=Ue;else break e}}function a(Q){return Q.length===0?null:Q[0]}function o(Q){if(Q.length===0)return null;var le=Q[0],we=Q.pop();if(we!==le){Q[0]=we;e:for(var Ue=0,Le=Q.length,tt=Le>>>1;Ue<tt;){var Te=2*(Ue+1)-1,De=Q[Te],qe=Te+1,It=Q[qe];if(0>d(De,we))qe<Le&&0>d(It,De)?(Q[Ue]=It,Q[qe]=we,Ue=qe):(Q[Ue]=De,Q[Te]=we,Ue=Te);else if(qe<Le&&0>d(It,we))Q[Ue]=It,Q[qe]=we,Ue=qe;else break e}}return le}function d(Q,le){var we=Q.sortIndex-le.sortIndex;return we!==0?we:Q.id-le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var f=Date,y=f.now();e.unstable_now=function(){return f.now()-y}}var b=[],x=[],T=1,S=null,N=3,O=!1,A=!1,I=!1,P=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(Q){for(var le=a(x);le!==null;){if(le.callback===null)o(x);else if(le.startTime<=Q)o(x),le.sortIndex=le.expirationTime,n(b,le);else break;le=a(x)}}function G(Q){if(I=!1,V(Q),!A)if(a(b)!==null)A=!0,se(B);else{var le=a(x);le!==null&&he(G,le.startTime-Q)}}function B(Q,le){A=!1,I&&(I=!1,L(Z),Z=-1),O=!0;var we=N;try{for(V(le),S=a(b);S!==null&&(!(S.expirationTime>le)||Q&&!re());){var Ue=S.callback;if(typeof Ue=="function"){S.callback=null,N=S.priorityLevel;var Le=Ue(S.expirationTime<=le);le=e.unstable_now(),typeof Le=="function"?S.callback=Le:S===a(b)&&o(b),V(le)}else o(b);S=a(b)}if(S!==null)var tt=!0;else{var Te=a(x);Te!==null&&he(G,Te.startTime-le),tt=!1}return tt}finally{S=null,N=we,O=!1}}var z=!1,q=null,Z=-1,ie=5,ue=-1;function re(){return!(e.unstable_now()-ue<ie)}function pe(){if(q!==null){var Q=e.unstable_now();ue=Q;var le=!0;try{le=q(!0,Q)}finally{le?Se():(z=!1,q=null)}}else z=!1}var Se;if(typeof F=="function")Se=function(){F(pe)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,be=fe.port2;fe.port1.onmessage=pe,Se=function(){be.postMessage(null)}}else Se=function(){P(pe,0)};function se(Q){q=Q,z||(z=!0,Se())}function he(Q,le){Z=P(function(){Q(e.unstable_now())},le)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Q){Q.callback=null},e.unstable_continueExecution=function(){A||O||(A=!0,se(B))},e.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ie=0<Q?Math.floor(1e3/Q):5},e.unstable_getCurrentPriorityLevel=function(){return N},e.unstable_getFirstCallbackNode=function(){return a(b)},e.unstable_next=function(Q){switch(N){case 1:case 2:case 3:var le=3;break;default:le=N}var we=N;N=le;try{return Q()}finally{N=we}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Q,le){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var we=N;N=Q;try{return le()}finally{N=we}},e.unstable_scheduleCallback=function(Q,le,we){var Ue=e.unstable_now();switch(typeof we=="object"&&we!==null?(we=we.delay,we=typeof we=="number"&&0<we?Ue+we:Ue):we=Ue,Q){case 1:var Le=-1;break;case 2:Le=250;break;case 5:Le=1073741823;break;case 4:Le=1e4;break;default:Le=5e3}return Le=we+Le,Q={id:T++,callback:le,priorityLevel:Q,startTime:we,expirationTime:Le,sortIndex:-1},we>Ue?(Q.sortIndex=we,n(x,Q),a(b)===null&&Q===a(x)&&(I?(L(Z),Z=-1):I=!0,he(G,we-Ue))):(Q.sortIndex=Le,n(b,Q),A||O||(A=!0,se(B))),Q},e.unstable_shouldYield=re,e.unstable_wrapCallback=function(Q){var le=N;return function(){var we=N;N=le;try{return Q.apply(this,arguments)}finally{N=we}}}})(eq);ZY.exports=eq;var U_e=ZY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F_e=Y,Ns=U_e;function it(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var tq=new Set,Ay={};function Gh(e,n){nf(e,n),nf(e+"Capture",n)}function nf(e,n){for(Ay[e]=n,e=0;e<n.length;e++)tq.add(n[e])}var Nl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),N1=Object.prototype.hasOwnProperty,V_e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,J$={},Q$={};function B_e(e){return N1.call(Q$,e)?!0:N1.call(J$,e)?!1:V_e.test(e)?Q$[e]=!0:(J$[e]=!0,!1)}function G_e(e,n,a,o){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return o?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function W_e(e,n,a,o){if(n===null||typeof n>"u"||G_e(e,n,a,o))return!0;if(o)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Ia(e,n,a,o,d,h,f){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=o,this.attributeNamespace=d,this.mustUseProperty=a,this.propertyName=e,this.type=n,this.sanitizeURL=h,this.removeEmptyString=f}var Yi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Yi[e]=new Ia(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];Yi[n]=new Ia(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Yi[e]=new Ia(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Yi[e]=new Ia(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Yi[e]=new Ia(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Yi[e]=new Ia(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Yi[e]=new Ia(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Yi[e]=new Ia(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Yi[e]=new Ia(e,5,!1,e.toLowerCase(),null,!1,!1)});var f2=/[\-:]([a-z])/g;function g2(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(f2,g2);Yi[n]=new Ia(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(f2,g2);Yi[n]=new Ia(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(f2,g2);Yi[n]=new Ia(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Yi[e]=new Ia(e,1,!1,e.toLowerCase(),null,!1,!1)});Yi.xlinkHref=new Ia("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Yi[e]=new Ia(e,1,!1,e.toLowerCase(),null,!0,!0)});function v2(e,n,a,o){var d=Yi.hasOwnProperty(n)?Yi[n]:null;(d!==null?d.type!==0:o||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(W_e(n,a,d,o)&&(a=null),o||d===null?B_e(n)&&(a===null?e.removeAttribute(n):e.setAttribute(n,""+a)):d.mustUseProperty?e[d.propertyName]=a===null?d.type===3?!1:"":a:(n=d.attributeName,o=d.attributeNamespace,a===null?e.removeAttribute(n):(d=d.type,a=d===3||d===4&&a===!0?"":""+a,o?e.setAttributeNS(o,n,a):e.setAttribute(n,a))))}var Vl=F_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rE=Symbol.for("react.element"),Am=Symbol.for("react.portal"),Im=Symbol.for("react.fragment"),y2=Symbol.for("react.strict_mode"),R1=Symbol.for("react.profiler"),nq=Symbol.for("react.provider"),rq=Symbol.for("react.context"),_2=Symbol.for("react.forward_ref"),A1=Symbol.for("react.suspense"),I1=Symbol.for("react.suspense_list"),b2=Symbol.for("react.memo"),Nd=Symbol.for("react.lazy"),iq=Symbol.for("react.offscreen"),Z$=Symbol.iterator;function Uv(e){return e===null||typeof e!="object"?null:(e=Z$&&e[Z$]||e["@@iterator"],typeof e=="function"?e:null)}var Gr=Object.assign,fO;function sy(e){if(fO===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);fO=n&&n[1]||""}return`
`+fO+e}var gO=!1;function vO(e,n){if(!e||gO)return"";gO=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(x){var o=x}Reflect.construct(e,[],n)}else{try{n.call()}catch(x){o=x}e.call(n.prototype)}else{try{throw Error()}catch(x){o=x}e()}}catch(x){if(x&&o&&typeof x.stack=="string"){for(var d=x.stack.split(`
`),h=o.stack.split(`
`),f=d.length-1,y=h.length-1;1<=f&&0<=y&&d[f]!==h[y];)y--;for(;1<=f&&0<=y;f--,y--)if(d[f]!==h[y]){if(f!==1||y!==1)do if(f--,y--,0>y||d[f]!==h[y]){var b=`
`+d[f].replace(" at new "," at ");return e.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",e.displayName)),b}while(1<=f&&0<=y);break}}}finally{gO=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?sy(e):""}function $_e(e){switch(e.tag){case 5:return sy(e.type);case 16:return sy("Lazy");case 13:return sy("Suspense");case 19:return sy("SuspenseList");case 0:case 2:case 15:return e=vO(e.type,!1),e;case 11:return e=vO(e.type.render,!1),e;case 1:return e=vO(e.type,!0),e;default:return""}}function O1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Im:return"Fragment";case Am:return"Portal";case R1:return"Profiler";case y2:return"StrictMode";case A1:return"Suspense";case I1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case rq:return(e.displayName||"Context")+".Consumer";case nq:return(e._context.displayName||"Context")+".Provider";case _2:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case b2:return n=e.displayName||null,n!==null?n:O1(e.type)||"Memo";case Nd:n=e._payload,e=e._init;try{return O1(e(n))}catch{}}return null}function H_e(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O1(n);case 8:return n===y2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Zd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function aq(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function z_e(e){var n=aq(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var d=a.get,h=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(f){o=""+f,h.call(this,f)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(f){o=""+f},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function iE(e){e._valueTracker||(e._valueTracker=z_e(e))}function sq(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return e&&(o=aq(e)?e.checked?"true":"false":e.value),e=o,e!==a?(n.setValue(e),!0):!1}function tS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function P1(e,n){var a=n.checked;return Gr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function eH(e,n){var a=n.defaultValue==null?"":n.defaultValue,o=n.checked!=null?n.checked:n.defaultChecked;a=Zd(n.value!=null?n.value:a),e._wrapperState={initialChecked:o,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function oq(e,n){n=n.checked,n!=null&&v2(e,"checked",n,!1)}function D1(e,n){oq(e,n);var a=Zd(n.value),o=n.type;if(a!=null)o==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?k1(e,n.type,a):n.hasOwnProperty("defaultValue")&&k1(e,n.type,Zd(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function tH(e,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var o=n.type;if(!(o!=="submit"&&o!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,a||n===e.value||(e.value=n),e.defaultValue=n}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function k1(e,n,a){(n!=="number"||tS(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var oy=Array.isArray;function $m(e,n,a,o){if(e=e.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<e.length;a++)d=n.hasOwnProperty("$"+e[a].value),e[a].selected!==d&&(e[a].selected=d),d&&o&&(e[a].defaultSelected=!0)}else{for(a=""+Zd(a),n=null,d=0;d<e.length;d++){if(e[d].value===a){e[d].selected=!0,o&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function j1(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(it(91));return Gr({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function nH(e,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(it(92));if(oy(a)){if(1<a.length)throw Error(it(93));a=a[0]}n=a}n==null&&(n=""),a=n}e._wrapperState={initialValue:Zd(a)}}function cq(e,n){var a=Zd(n.value),o=Zd(n.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),n.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),o!=null&&(e.defaultValue=""+o)}function rH(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function lq(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function L1(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?lq(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var aE,dq=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,o,d){MSApp.execUnsafeLocalFunction(function(){return e(n,a,o,d)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(aE=aE||document.createElement("div"),aE.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=aE.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function Iy(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var py={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},K_e=["Webkit","ms","Moz","O"];Object.keys(py).forEach(function(e){K_e.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),py[n]=py[e]})});function uq(e,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||py.hasOwnProperty(e)&&py[e]?(""+n).trim():n+"px"}function hq(e,n){e=e.style;for(var a in n)if(n.hasOwnProperty(a)){var o=a.indexOf("--")===0,d=uq(a,n[a],o);a==="float"&&(a="cssFloat"),o?e.setProperty(a,d):e[a]=d}}var Y_e=Gr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function M1(e,n){if(n){if(Y_e[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(it(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(it(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(it(61))}if(n.style!=null&&typeof n.style!="object")throw Error(it(62))}}function U1(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var F1=null;function x2(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var V1=null,Hm=null,zm=null;function iH(e){if(e=U0(e)){if(typeof V1!="function")throw Error(it(280));var n=e.stateNode;n&&(n=Uw(n),V1(e.stateNode,e.type,n))}}function pq(e){Hm?zm?zm.push(e):zm=[e]:Hm=e}function mq(){if(Hm){var e=Hm,n=zm;if(zm=Hm=null,iH(e),n)for(e=0;e<n.length;e++)iH(n[e])}}function fq(e,n){return e(n)}function gq(){}var yO=!1;function vq(e,n,a){if(yO)return e(n,a);yO=!0;try{return fq(e,n,a)}finally{yO=!1,(Hm!==null||zm!==null)&&(gq(),mq())}}function Oy(e,n){var a=e.stateNode;if(a===null)return null;var o=Uw(a);if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(it(231,n,typeof a));return a}var B1=!1;if(Nl)try{var Fv={};Object.defineProperty(Fv,"passive",{get:function(){B1=!0}}),window.addEventListener("test",Fv,Fv),window.removeEventListener("test",Fv,Fv)}catch{B1=!1}function q_e(e,n,a,o,d,h,f,y,b){var x=Array.prototype.slice.call(arguments,3);try{n.apply(a,x)}catch(T){this.onError(T)}}var my=!1,nS=null,rS=!1,G1=null,X_e={onError:function(e){my=!0,nS=e}};function J_e(e,n,a,o,d,h,f,y,b){my=!1,nS=null,q_e.apply(X_e,arguments)}function Q_e(e,n,a,o,d,h,f,y,b){if(J_e.apply(this,arguments),my){if(my){var x=nS;my=!1,nS=null}else throw Error(it(198));rS||(rS=!0,G1=x)}}function Wh(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function yq(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function aH(e){if(Wh(e)!==e)throw Error(it(188))}function Z_e(e){var n=e.alternate;if(!n){if(n=Wh(e),n===null)throw Error(it(188));return n!==e?null:e}for(var a=e,o=n;;){var d=a.return;if(d===null)break;var h=d.alternate;if(h===null){if(o=d.return,o!==null){a=o;continue}break}if(d.child===h.child){for(h=d.child;h;){if(h===a)return aH(d),e;if(h===o)return aH(d),n;h=h.sibling}throw Error(it(188))}if(a.return!==o.return)a=d,o=h;else{for(var f=!1,y=d.child;y;){if(y===a){f=!0,a=d,o=h;break}if(y===o){f=!0,o=d,a=h;break}y=y.sibling}if(!f){for(y=h.child;y;){if(y===a){f=!0,a=h,o=d;break}if(y===o){f=!0,o=h,a=d;break}y=y.sibling}if(!f)throw Error(it(189))}}if(a.alternate!==o)throw Error(it(190))}if(a.tag!==3)throw Error(it(188));return a.stateNode.current===a?e:n}function _q(e){return e=Z_e(e),e!==null?bq(e):null}function bq(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=bq(e);if(n!==null)return n;e=e.sibling}return null}var xq=Ns.unstable_scheduleCallback,sH=Ns.unstable_cancelCallback,ebe=Ns.unstable_shouldYield,tbe=Ns.unstable_requestPaint,ei=Ns.unstable_now,nbe=Ns.unstable_getCurrentPriorityLevel,E2=Ns.unstable_ImmediatePriority,Eq=Ns.unstable_UserBlockingPriority,iS=Ns.unstable_NormalPriority,rbe=Ns.unstable_LowPriority,Sq=Ns.unstable_IdlePriority,kw=null,Lc=null;function ibe(e){if(Lc&&typeof Lc.onCommitFiberRoot=="function")try{Lc.onCommitFiberRoot(kw,e,void 0,(e.current.flags&128)===128)}catch{}}var Jo=Math.clz32?Math.clz32:obe,abe=Math.log,sbe=Math.LN2;function obe(e){return e>>>=0,e===0?32:31-(abe(e)/sbe|0)|0}var sE=64,oE=4194304;function cy(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function aS(e,n){var a=e.pendingLanes;if(a===0)return 0;var o=0,d=e.suspendedLanes,h=e.pingedLanes,f=a&268435455;if(f!==0){var y=f&~d;y!==0?o=cy(y):(h&=f,h!==0&&(o=cy(h)))}else f=a&~d,f!==0?o=cy(f):h!==0&&(o=cy(h));if(o===0)return 0;if(n!==0&&n!==o&&!(n&d)&&(d=o&-o,h=n&-n,d>=h||d===16&&(h&4194240)!==0))return n;if(o&4&&(o|=a&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=o;0<n;)a=31-Jo(n),d=1<<a,o|=e[a],n&=~d;return o}function cbe(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lbe(e,n){for(var a=e.suspendedLanes,o=e.pingedLanes,d=e.expirationTimes,h=e.pendingLanes;0<h;){var f=31-Jo(h),y=1<<f,b=d[f];b===-1?(!(y&a)||y&o)&&(d[f]=cbe(y,n)):b<=n&&(e.expiredLanes|=y),h&=~y}}function W1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function wq(){var e=sE;return sE<<=1,!(sE&4194240)&&(sE=64),e}function _O(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function L0(e,n,a){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-Jo(n),e[n]=a}function dbe(e,n){var a=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<a;){var d=31-Jo(a),h=1<<d;n[d]=0,o[d]=-1,e[d]=-1,a&=~h}}function S2(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var o=31-Jo(a),d=1<<o;d&n|e[o]&n&&(e[o]|=n),a&=~d}}var Xn=0;function Tq(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Cq,w2,Nq,Rq,Aq,$1=!1,cE=[],Bd=null,Gd=null,Wd=null,Py=new Map,Dy=new Map,Id=[],ube="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function oH(e,n){switch(e){case"focusin":case"focusout":Bd=null;break;case"dragenter":case"dragleave":Gd=null;break;case"mouseover":case"mouseout":Wd=null;break;case"pointerover":case"pointerout":Py.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dy.delete(n.pointerId)}}function Vv(e,n,a,o,d,h){return e===null||e.nativeEvent!==h?(e={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:h,targetContainers:[d]},n!==null&&(n=U0(n),n!==null&&w2(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function hbe(e,n,a,o,d){switch(n){case"focusin":return Bd=Vv(Bd,e,n,a,o,d),!0;case"dragenter":return Gd=Vv(Gd,e,n,a,o,d),!0;case"mouseover":return Wd=Vv(Wd,e,n,a,o,d),!0;case"pointerover":var h=d.pointerId;return Py.set(h,Vv(Py.get(h)||null,e,n,a,o,d)),!0;case"gotpointercapture":return h=d.pointerId,Dy.set(h,Vv(Dy.get(h)||null,e,n,a,o,d)),!0}return!1}function Iq(e){var n=fh(e.target);if(n!==null){var a=Wh(n);if(a!==null){if(n=a.tag,n===13){if(n=yq(a),n!==null){e.blockedOn=n,Aq(e.priority,function(){Nq(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function FE(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=H1(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);F1=o,a.target.dispatchEvent(o),F1=null}else return n=U0(a),n!==null&&w2(n),e.blockedOn=a,!1;n.shift()}return!0}function cH(e,n,a){FE(e)&&a.delete(n)}function pbe(){$1=!1,Bd!==null&&FE(Bd)&&(Bd=null),Gd!==null&&FE(Gd)&&(Gd=null),Wd!==null&&FE(Wd)&&(Wd=null),Py.forEach(cH),Dy.forEach(cH)}function Bv(e,n){e.blockedOn===n&&(e.blockedOn=null,$1||($1=!0,Ns.unstable_scheduleCallback(Ns.unstable_NormalPriority,pbe)))}function ky(e){function n(d){return Bv(d,e)}if(0<cE.length){Bv(cE[0],e);for(var a=1;a<cE.length;a++){var o=cE[a];o.blockedOn===e&&(o.blockedOn=null)}}for(Bd!==null&&Bv(Bd,e),Gd!==null&&Bv(Gd,e),Wd!==null&&Bv(Wd,e),Py.forEach(n),Dy.forEach(n),a=0;a<Id.length;a++)o=Id[a],o.blockedOn===e&&(o.blockedOn=null);for(;0<Id.length&&(a=Id[0],a.blockedOn===null);)Iq(a),a.blockedOn===null&&Id.shift()}var Km=Vl.ReactCurrentBatchConfig,sS=!0;function mbe(e,n,a,o){var d=Xn,h=Km.transition;Km.transition=null;try{Xn=1,T2(e,n,a,o)}finally{Xn=d,Km.transition=h}}function fbe(e,n,a,o){var d=Xn,h=Km.transition;Km.transition=null;try{Xn=4,T2(e,n,a,o)}finally{Xn=d,Km.transition=h}}function T2(e,n,a,o){if(sS){var d=H1(e,n,a,o);if(d===null)AO(e,n,o,oS,a),oH(e,o);else if(hbe(d,e,n,a,o))o.stopPropagation();else if(oH(e,o),n&4&&-1<ube.indexOf(e)){for(;d!==null;){var h=U0(d);if(h!==null&&Cq(h),h=H1(e,n,a,o),h===null&&AO(e,n,o,oS,a),h===d)break;d=h}d!==null&&o.stopPropagation()}else AO(e,n,o,null,a)}}var oS=null;function H1(e,n,a,o){if(oS=null,e=x2(o),e=fh(e),e!==null)if(n=Wh(e),n===null)e=null;else if(a=n.tag,a===13){if(e=yq(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return oS=e,null}function Oq(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(nbe()){case E2:return 1;case Eq:return 4;case iS:case rbe:return 16;case Sq:return 536870912;default:return 16}default:return 16}}var Ld=null,C2=null,VE=null;function Pq(){if(VE)return VE;var e,n=C2,a=n.length,o,d="value"in Ld?Ld.value:Ld.textContent,h=d.length;for(e=0;e<a&&n[e]===d[e];e++);var f=a-e;for(o=1;o<=f&&n[a-o]===d[h-o];o++);return VE=d.slice(e,1<o?1-o:void 0)}function BE(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function lE(){return!0}function lH(){return!1}function As(e){function n(a,o,d,h,f){this._reactName=a,this._targetInst=d,this.type=o,this.nativeEvent=h,this.target=f,this.currentTarget=null;for(var y in e)e.hasOwnProperty(y)&&(a=e[y],this[y]=a?a(h):h[y]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?lE:lH,this.isPropagationStopped=lH,this}return Gr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=lE)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=lE)},persist:function(){},isPersistent:lE}),n}var Vf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},N2=As(Vf),M0=Gr({},Vf,{view:0,detail:0}),gbe=As(M0),bO,xO,Gv,jw=Gr({},M0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:R2,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Gv&&(Gv&&e.type==="mousemove"?(bO=e.screenX-Gv.screenX,xO=e.screenY-Gv.screenY):xO=bO=0,Gv=e),bO)},movementY:function(e){return"movementY"in e?e.movementY:xO}}),dH=As(jw),vbe=Gr({},jw,{dataTransfer:0}),ybe=As(vbe),_be=Gr({},M0,{relatedTarget:0}),EO=As(_be),bbe=Gr({},Vf,{animationName:0,elapsedTime:0,pseudoElement:0}),xbe=As(bbe),Ebe=Gr({},Vf,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Sbe=As(Ebe),wbe=Gr({},Vf,{data:0}),uH=As(wbe),Tbe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cbe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nbe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rbe(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=Nbe[e])?!!n[e]:!1}function R2(){return Rbe}var Abe=Gr({},M0,{key:function(e){if(e.key){var n=Tbe[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=BE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Cbe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:R2,charCode:function(e){return e.type==="keypress"?BE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?BE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ibe=As(Abe),Obe=Gr({},jw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hH=As(Obe),Pbe=Gr({},M0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:R2}),Dbe=As(Pbe),kbe=Gr({},Vf,{propertyName:0,elapsedTime:0,pseudoElement:0}),jbe=As(kbe),Lbe=Gr({},jw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Mbe=As(Lbe),Ube=[9,13,27,32],A2=Nl&&"CompositionEvent"in window,fy=null;Nl&&"documentMode"in document&&(fy=document.documentMode);var Fbe=Nl&&"TextEvent"in window&&!fy,Dq=Nl&&(!A2||fy&&8<fy&&11>=fy),pH=" ",mH=!1;function kq(e,n){switch(e){case"keyup":return Ube.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Om=!1;function Vbe(e,n){switch(e){case"compositionend":return jq(n);case"keypress":return n.which!==32?null:(mH=!0,pH);case"textInput":return e=n.data,e===pH&&mH?null:e;default:return null}}function Bbe(e,n){if(Om)return e==="compositionend"||!A2&&kq(e,n)?(e=Pq(),VE=C2=Ld=null,Om=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Dq&&n.locale!=="ko"?null:n.data;default:return null}}var Gbe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fH(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Gbe[e.type]:n==="textarea"}function Lq(e,n,a,o){pq(o),n=cS(n,"onChange"),0<n.length&&(a=new N2("onChange","change",null,a,o),e.push({event:a,listeners:n}))}var gy=null,jy=null;function Wbe(e){Kq(e,0)}function Lw(e){var n=km(e);if(sq(n))return e}function $be(e,n){if(e==="change")return n}var Mq=!1;if(Nl){var SO;if(Nl){var wO="oninput"in document;if(!wO){var gH=document.createElement("div");gH.setAttribute("oninput","return;"),wO=typeof gH.oninput=="function"}SO=wO}else SO=!1;Mq=SO&&(!document.documentMode||9<document.documentMode)}function vH(){gy&&(gy.detachEvent("onpropertychange",Uq),jy=gy=null)}function Uq(e){if(e.propertyName==="value"&&Lw(jy)){var n=[];Lq(n,jy,e,x2(e)),vq(Wbe,n)}}function Hbe(e,n,a){e==="focusin"?(vH(),gy=n,jy=a,gy.attachEvent("onpropertychange",Uq)):e==="focusout"&&vH()}function zbe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Lw(jy)}function Kbe(e,n){if(e==="click")return Lw(n)}function Ybe(e,n){if(e==="input"||e==="change")return Lw(n)}function qbe(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Zo=typeof Object.is=="function"?Object.is:qbe;function Ly(e,n){if(Zo(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var d=a[o];if(!N1.call(n,d)||!Zo(e[d],n[d]))return!1}return!0}function yH(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function _H(e,n){var a=yH(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=n&&o>=n)return{node:a,offset:n-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=yH(a)}}function Fq(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Fq(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Vq(){for(var e=window,n=tS();n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=tS(e.document)}return n}function I2(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function Xbe(e){var n=Vq(),a=e.focusedElem,o=e.selectionRange;if(n!==a&&a&&a.ownerDocument&&Fq(a.ownerDocument.documentElement,a)){if(o!==null&&I2(a)){if(n=o.start,e=o.end,e===void 0&&(e=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(e,a.value.length);else if(e=(n=a.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var d=a.textContent.length,h=Math.min(o.start,d);o=o.end===void 0?h:Math.min(o.end,d),!e.extend&&h>o&&(d=o,o=h,h=d),d=_H(a,h);var f=_H(a,o);d&&f&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(n=n.createRange(),n.setStart(d.node,d.offset),e.removeAllRanges(),h>o?(e.addRange(n),e.extend(f.node,f.offset)):(n.setEnd(f.node,f.offset),e.addRange(n)))}}for(n=[],e=a;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)e=n[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Jbe=Nl&&"documentMode"in document&&11>=document.documentMode,Pm=null,z1=null,vy=null,K1=!1;function bH(e,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;K1||Pm==null||Pm!==tS(o)||(o=Pm,"selectionStart"in o&&I2(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),vy&&Ly(vy,o)||(vy=o,o=cS(z1,"onSelect"),0<o.length&&(n=new N2("onSelect","select",null,n,a),e.push({event:n,listeners:o}),n.target=Pm)))}function dE(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var Dm={animationend:dE("Animation","AnimationEnd"),animationiteration:dE("Animation","AnimationIteration"),animationstart:dE("Animation","AnimationStart"),transitionend:dE("Transition","TransitionEnd")},TO={},Bq={};Nl&&(Bq=document.createElement("div").style,"AnimationEvent"in window||(delete Dm.animationend.animation,delete Dm.animationiteration.animation,delete Dm.animationstart.animation),"TransitionEvent"in window||delete Dm.transitionend.transition);function Mw(e){if(TO[e])return TO[e];if(!Dm[e])return e;var n=Dm[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in Bq)return TO[e]=n[a];return e}var Gq=Mw("animationend"),Wq=Mw("animationiteration"),$q=Mw("animationstart"),Hq=Mw("transitionend"),zq=new Map,xH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nu(e,n){zq.set(e,n),Gh(n,[e])}for(var CO=0;CO<xH.length;CO++){var NO=xH[CO],Qbe=NO.toLowerCase(),Zbe=NO[0].toUpperCase()+NO.slice(1);nu(Qbe,"on"+Zbe)}nu(Gq,"onAnimationEnd");nu(Wq,"onAnimationIteration");nu($q,"onAnimationStart");nu("dblclick","onDoubleClick");nu("focusin","onFocus");nu("focusout","onBlur");nu(Hq,"onTransitionEnd");nf("onMouseEnter",["mouseout","mouseover"]);nf("onMouseLeave",["mouseout","mouseover"]);nf("onPointerEnter",["pointerout","pointerover"]);nf("onPointerLeave",["pointerout","pointerover"]);Gh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ly="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),exe=new Set("cancel close invalid load scroll toggle".split(" ").concat(ly));function EH(e,n,a){var o=e.type||"unknown-event";e.currentTarget=a,Q_e(o,n,void 0,e),e.currentTarget=null}function Kq(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],d=o.event;o=o.listeners;e:{var h=void 0;if(n)for(var f=o.length-1;0<=f;f--){var y=o[f],b=y.instance,x=y.currentTarget;if(y=y.listener,b!==h&&d.isPropagationStopped())break e;EH(d,y,x),h=b}else for(f=0;f<o.length;f++){if(y=o[f],b=y.instance,x=y.currentTarget,y=y.listener,b!==h&&d.isPropagationStopped())break e;EH(d,y,x),h=b}}}if(rS)throw e=G1,rS=!1,G1=null,e}function Er(e,n){var a=n[Q1];a===void 0&&(a=n[Q1]=new Set);var o=e+"__bubble";a.has(o)||(Yq(n,e,2,!1),a.add(o))}function RO(e,n,a){var o=0;n&&(o|=4),Yq(a,e,o,n)}var uE="_reactListening"+Math.random().toString(36).slice(2);function My(e){if(!e[uE]){e[uE]=!0,tq.forEach(function(a){a!=="selectionchange"&&(exe.has(a)||RO(a,!1,e),RO(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[uE]||(n[uE]=!0,RO("selectionchange",!1,n))}}function Yq(e,n,a,o){switch(Oq(n)){case 1:var d=mbe;break;case 4:d=fbe;break;default:d=T2}a=d.bind(null,n,a,e),d=void 0,!B1||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),o?d!==void 0?e.addEventListener(n,a,{capture:!0,passive:d}):e.addEventListener(n,a,!0):d!==void 0?e.addEventListener(n,a,{passive:d}):e.addEventListener(n,a,!1)}function AO(e,n,a,o,d){var h=o;if(!(n&1)&&!(n&2)&&o!==null)e:for(;;){if(o===null)return;var f=o.tag;if(f===3||f===4){var y=o.stateNode.containerInfo;if(y===d||y.nodeType===8&&y.parentNode===d)break;if(f===4)for(f=o.return;f!==null;){var b=f.tag;if((b===3||b===4)&&(b=f.stateNode.containerInfo,b===d||b.nodeType===8&&b.parentNode===d))return;f=f.return}for(;y!==null;){if(f=fh(y),f===null)return;if(b=f.tag,b===5||b===6){o=h=f;continue e}y=y.parentNode}}o=o.return}vq(function(){var x=h,T=x2(a),S=[];e:{var N=zq.get(e);if(N!==void 0){var O=N2,A=e;switch(e){case"keypress":if(BE(a)===0)break e;case"keydown":case"keyup":O=Ibe;break;case"focusin":A="focus",O=EO;break;case"focusout":A="blur",O=EO;break;case"beforeblur":case"afterblur":O=EO;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":O=dH;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":O=ybe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":O=Dbe;break;case Gq:case Wq:case $q:O=xbe;break;case Hq:O=jbe;break;case"scroll":O=gbe;break;case"wheel":O=Mbe;break;case"copy":case"cut":case"paste":O=Sbe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":O=hH}var I=(n&4)!==0,P=!I&&e==="scroll",L=I?N!==null?N+"Capture":null:N;I=[];for(var F=x,V;F!==null;){V=F;var G=V.stateNode;if(V.tag===5&&G!==null&&(V=G,L!==null&&(G=Oy(F,L),G!=null&&I.push(Uy(F,G,V)))),P)break;F=F.return}0<I.length&&(N=new O(N,A,null,a,T),S.push({event:N,listeners:I}))}}if(!(n&7)){e:{if(N=e==="mouseover"||e==="pointerover",O=e==="mouseout"||e==="pointerout",N&&a!==F1&&(A=a.relatedTarget||a.fromElement)&&(fh(A)||A[Rl]))break e;if((O||N)&&(N=T.window===T?T:(N=T.ownerDocument)?N.defaultView||N.parentWindow:window,O?(A=a.relatedTarget||a.toElement,O=x,A=A?fh(A):null,A!==null&&(P=Wh(A),A!==P||A.tag!==5&&A.tag!==6)&&(A=null)):(O=null,A=x),O!==A)){if(I=dH,G="onMouseLeave",L="onMouseEnter",F="mouse",(e==="pointerout"||e==="pointerover")&&(I=hH,G="onPointerLeave",L="onPointerEnter",F="pointer"),P=O==null?N:km(O),V=A==null?N:km(A),N=new I(G,F+"leave",O,a,T),N.target=P,N.relatedTarget=V,G=null,fh(T)===x&&(I=new I(L,F+"enter",A,a,T),I.target=V,I.relatedTarget=P,G=I),P=G,O&&A)t:{for(I=O,L=A,F=0,V=I;V;V=xm(V))F++;for(V=0,G=L;G;G=xm(G))V++;for(;0<F-V;)I=xm(I),F--;for(;0<V-F;)L=xm(L),V--;for(;F--;){if(I===L||L!==null&&I===L.alternate)break t;I=xm(I),L=xm(L)}I=null}else I=null;O!==null&&SH(S,N,O,I,!1),A!==null&&P!==null&&SH(S,P,A,I,!0)}}e:{if(N=x?km(x):window,O=N.nodeName&&N.nodeName.toLowerCase(),O==="select"||O==="input"&&N.type==="file")var B=$be;else if(fH(N))if(Mq)B=Ybe;else{B=zbe;var z=Hbe}else(O=N.nodeName)&&O.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(B=Kbe);if(B&&(B=B(e,x))){Lq(S,B,a,T);break e}z&&z(e,N,x),e==="focusout"&&(z=N._wrapperState)&&z.controlled&&N.type==="number"&&k1(N,"number",N.value)}switch(z=x?km(x):window,e){case"focusin":(fH(z)||z.contentEditable==="true")&&(Pm=z,z1=x,vy=null);break;case"focusout":vy=z1=Pm=null;break;case"mousedown":K1=!0;break;case"contextmenu":case"mouseup":case"dragend":K1=!1,bH(S,a,T);break;case"selectionchange":if(Jbe)break;case"keydown":case"keyup":bH(S,a,T)}var q;if(A2)e:{switch(e){case"compositionstart":var Z="onCompositionStart";break e;case"compositionend":Z="onCompositionEnd";break e;case"compositionupdate":Z="onCompositionUpdate";break e}Z=void 0}else Om?kq(e,a)&&(Z="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Z="onCompositionStart");Z&&(Dq&&a.locale!=="ko"&&(Om||Z!=="onCompositionStart"?Z==="onCompositionEnd"&&Om&&(q=Pq()):(Ld=T,C2="value"in Ld?Ld.value:Ld.textContent,Om=!0)),z=cS(x,Z),0<z.length&&(Z=new uH(Z,e,null,a,T),S.push({event:Z,listeners:z}),q?Z.data=q:(q=jq(a),q!==null&&(Z.data=q)))),(q=Fbe?Vbe(e,a):Bbe(e,a))&&(x=cS(x,"onBeforeInput"),0<x.length&&(T=new uH("onBeforeInput","beforeinput",null,a,T),S.push({event:T,listeners:x}),T.data=q))}Kq(S,n)})}function Uy(e,n,a){return{instance:e,listener:n,currentTarget:a}}function cS(e,n){for(var a=n+"Capture",o=[];e!==null;){var d=e,h=d.stateNode;d.tag===5&&h!==null&&(d=h,h=Oy(e,a),h!=null&&o.unshift(Uy(e,h,d)),h=Oy(e,n),h!=null&&o.push(Uy(e,h,d))),e=e.return}return o}function xm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function SH(e,n,a,o,d){for(var h=n._reactName,f=[];a!==null&&a!==o;){var y=a,b=y.alternate,x=y.stateNode;if(b!==null&&b===o)break;y.tag===5&&x!==null&&(y=x,d?(b=Oy(a,h),b!=null&&f.unshift(Uy(a,b,y))):d||(b=Oy(a,h),b!=null&&f.push(Uy(a,b,y)))),a=a.return}f.length!==0&&e.push({event:n,listeners:f})}var txe=/\r\n?/g,nxe=/\u0000|\uFFFD/g;function wH(e){return(typeof e=="string"?e:""+e).replace(txe,`
`).replace(nxe,"")}function hE(e,n,a){if(n=wH(n),wH(e)!==n&&a)throw Error(it(425))}function lS(){}var Y1=null,q1=null;function X1(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var J1=typeof setTimeout=="function"?setTimeout:void 0,rxe=typeof clearTimeout=="function"?clearTimeout:void 0,TH=typeof Promise=="function"?Promise:void 0,ixe=typeof queueMicrotask=="function"?queueMicrotask:typeof TH<"u"?function(e){return TH.resolve(null).then(e).catch(axe)}:J1;function axe(e){setTimeout(function(){throw e})}function IO(e,n){var a=n,o=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(o===0){e.removeChild(d),ky(n);return}o--}else a!=="$"&&a!=="$?"&&a!=="$!"||o++;a=d}while(a);ky(n)}function $d(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function CH(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}var Bf=Math.random().toString(36).slice(2),Pc="__reactFiber$"+Bf,Fy="__reactProps$"+Bf,Rl="__reactContainer$"+Bf,Q1="__reactEvents$"+Bf,sxe="__reactListeners$"+Bf,oxe="__reactHandles$"+Bf;function fh(e){var n=e[Pc];if(n)return n;for(var a=e.parentNode;a;){if(n=a[Rl]||a[Pc]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=CH(e);e!==null;){if(a=e[Pc])return a;e=CH(e)}return n}e=a,a=e.parentNode}return null}function U0(e){return e=e[Pc]||e[Rl],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function km(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(it(33))}function Uw(e){return e[Fy]||null}var Z1=[],jm=-1;function ru(e){return{current:e}}function Tr(e){0>jm||(e.current=Z1[jm],Z1[jm]=null,jm--)}function pr(e,n){jm++,Z1[jm]=e.current,e.current=n}var eu={},ha=ru(eu),Ja=ru(!1),Ih=eu;function rf(e,n){var a=e.type.contextTypes;if(!a)return eu;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===n)return o.__reactInternalMemoizedMaskedChildContext;var d={},h;for(h in a)d[h]=n[h];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=d),d}function Qa(e){return e=e.childContextTypes,e!=null}function dS(){Tr(Ja),Tr(ha)}function NH(e,n,a){if(ha.current!==eu)throw Error(it(168));pr(ha,n),pr(Ja,a)}function qq(e,n,a){var o=e.stateNode;if(n=n.childContextTypes,typeof o.getChildContext!="function")return a;o=o.getChildContext();for(var d in o)if(!(d in n))throw Error(it(108,H_e(e)||"Unknown",d));return Gr({},a,o)}function uS(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||eu,Ih=ha.current,pr(ha,e),pr(Ja,Ja.current),!0}function RH(e,n,a){var o=e.stateNode;if(!o)throw Error(it(169));a?(e=qq(e,n,Ih),o.__reactInternalMemoizedMergedChildContext=e,Tr(Ja),Tr(ha),pr(ha,e)):Tr(Ja),pr(Ja,a)}var pl=null,Fw=!1,OO=!1;function Xq(e){pl===null?pl=[e]:pl.push(e)}function cxe(e){Fw=!0,Xq(e)}function iu(){if(!OO&&pl!==null){OO=!0;var e=0,n=Xn;try{var a=pl;for(Xn=1;e<a.length;e++){var o=a[e];do o=o(!0);while(o!==null)}pl=null,Fw=!1}catch(d){throw pl!==null&&(pl=pl.slice(e+1)),xq(E2,iu),d}finally{Xn=n,OO=!1}}return null}var Lm=[],Mm=0,hS=null,pS=0,ro=[],io=0,Oh=null,ml=1,fl="";function ch(e,n){Lm[Mm++]=pS,Lm[Mm++]=hS,hS=e,pS=n}function Jq(e,n,a){ro[io++]=ml,ro[io++]=fl,ro[io++]=Oh,Oh=e;var o=ml;e=fl;var d=32-Jo(o)-1;o&=~(1<<d),a+=1;var h=32-Jo(n)+d;if(30<h){var f=d-d%5;h=(o&(1<<f)-1).toString(32),o>>=f,d-=f,ml=1<<32-Jo(n)+d|a<<d|o,fl=h+e}else ml=1<<h|a<<d|o,fl=e}function O2(e){e.return!==null&&(ch(e,1),Jq(e,1,0))}function P2(e){for(;e===hS;)hS=Lm[--Mm],Lm[Mm]=null,pS=Lm[--Mm],Lm[Mm]=null;for(;e===Oh;)Oh=ro[--io],ro[io]=null,fl=ro[--io],ro[io]=null,ml=ro[--io],ro[io]=null}var Cs=null,ws=null,Pr=!1,Yo=null;function Qq(e,n){var a=ao(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=e,n=e.deletions,n===null?(e.deletions=[a],e.flags|=16):n.push(a)}function AH(e,n){switch(e.tag){case 5:var a=e.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,Cs=e,ws=$d(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,Cs=e,ws=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=Oh!==null?{id:ml,overflow:fl}:null,e.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=ao(18,null,null,0),a.stateNode=n,a.return=e,e.child=a,Cs=e,ws=null,!0):!1;default:return!1}}function eP(e){return(e.mode&1)!==0&&(e.flags&128)===0}function tP(e){if(Pr){var n=ws;if(n){var a=n;if(!AH(e,n)){if(eP(e))throw Error(it(418));n=$d(a.nextSibling);var o=Cs;n&&AH(e,n)?Qq(o,a):(e.flags=e.flags&-4097|2,Pr=!1,Cs=e)}}else{if(eP(e))throw Error(it(418));e.flags=e.flags&-4097|2,Pr=!1,Cs=e}}}function IH(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Cs=e}function pE(e){if(e!==Cs)return!1;if(!Pr)return IH(e),Pr=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!X1(e.type,e.memoizedProps)),n&&(n=ws)){if(eP(e))throw Zq(),Error(it(418));for(;n;)Qq(e,n),n=$d(n.nextSibling)}if(IH(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(it(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(n===0){ws=$d(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}e=e.nextSibling}ws=null}}else ws=Cs?$d(e.stateNode.nextSibling):null;return!0}function Zq(){for(var e=ws;e;)e=$d(e.nextSibling)}function af(){ws=Cs=null,Pr=!1}function D2(e){Yo===null?Yo=[e]:Yo.push(e)}var lxe=Vl.ReactCurrentBatchConfig;function Wv(e,n,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(it(309));var o=a.stateNode}if(!o)throw Error(it(147,e));var d=o,h=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===h?n.ref:(n=function(f){var y=d.refs;f===null?delete y[h]:y[h]=f},n._stringRef=h,n)}if(typeof e!="string")throw Error(it(284));if(!a._owner)throw Error(it(290,e))}return e}function mE(e,n){throw e=Object.prototype.toString.call(n),Error(it(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function OH(e){var n=e._init;return n(e._payload)}function eX(e){function n(L,F){if(e){var V=L.deletions;V===null?(L.deletions=[F],L.flags|=16):V.push(F)}}function a(L,F){if(!e)return null;for(;F!==null;)n(L,F),F=F.sibling;return null}function o(L,F){for(L=new Map;F!==null;)F.key!==null?L.set(F.key,F):L.set(F.index,F),F=F.sibling;return L}function d(L,F){return L=Yd(L,F),L.index=0,L.sibling=null,L}function h(L,F,V){return L.index=V,e?(V=L.alternate,V!==null?(V=V.index,V<F?(L.flags|=2,F):V):(L.flags|=2,F)):(L.flags|=1048576,F)}function f(L){return e&&L.alternate===null&&(L.flags|=2),L}function y(L,F,V,G){return F===null||F.tag!==6?(F=UO(V,L.mode,G),F.return=L,F):(F=d(F,V),F.return=L,F)}function b(L,F,V,G){var B=V.type;return B===Im?T(L,F,V.props.children,G,V.key):F!==null&&(F.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Nd&&OH(B)===F.type)?(G=d(F,V.props),G.ref=Wv(L,F,V),G.return=L,G):(G=YE(V.type,V.key,V.props,null,L.mode,G),G.ref=Wv(L,F,V),G.return=L,G)}function x(L,F,V,G){return F===null||F.tag!==4||F.stateNode.containerInfo!==V.containerInfo||F.stateNode.implementation!==V.implementation?(F=FO(V,L.mode,G),F.return=L,F):(F=d(F,V.children||[]),F.return=L,F)}function T(L,F,V,G,B){return F===null||F.tag!==7?(F=Ch(V,L.mode,G,B),F.return=L,F):(F=d(F,V),F.return=L,F)}function S(L,F,V){if(typeof F=="string"&&F!==""||typeof F=="number")return F=UO(""+F,L.mode,V),F.return=L,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case rE:return V=YE(F.type,F.key,F.props,null,L.mode,V),V.ref=Wv(L,null,F),V.return=L,V;case Am:return F=FO(F,L.mode,V),F.return=L,F;case Nd:var G=F._init;return S(L,G(F._payload),V)}if(oy(F)||Uv(F))return F=Ch(F,L.mode,V,null),F.return=L,F;mE(L,F)}return null}function N(L,F,V,G){var B=F!==null?F.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return B!==null?null:y(L,F,""+V,G);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case rE:return V.key===B?b(L,F,V,G):null;case Am:return V.key===B?x(L,F,V,G):null;case Nd:return B=V._init,N(L,F,B(V._payload),G)}if(oy(V)||Uv(V))return B!==null?null:T(L,F,V,G,null);mE(L,V)}return null}function O(L,F,V,G,B){if(typeof G=="string"&&G!==""||typeof G=="number")return L=L.get(V)||null,y(F,L,""+G,B);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case rE:return L=L.get(G.key===null?V:G.key)||null,b(F,L,G,B);case Am:return L=L.get(G.key===null?V:G.key)||null,x(F,L,G,B);case Nd:var z=G._init;return O(L,F,V,z(G._payload),B)}if(oy(G)||Uv(G))return L=L.get(V)||null,T(F,L,G,B,null);mE(F,G)}return null}function A(L,F,V,G){for(var B=null,z=null,q=F,Z=F=0,ie=null;q!==null&&Z<V.length;Z++){q.index>Z?(ie=q,q=null):ie=q.sibling;var ue=N(L,q,V[Z],G);if(ue===null){q===null&&(q=ie);break}e&&q&&ue.alternate===null&&n(L,q),F=h(ue,F,Z),z===null?B=ue:z.sibling=ue,z=ue,q=ie}if(Z===V.length)return a(L,q),Pr&&ch(L,Z),B;if(q===null){for(;Z<V.length;Z++)q=S(L,V[Z],G),q!==null&&(F=h(q,F,Z),z===null?B=q:z.sibling=q,z=q);return Pr&&ch(L,Z),B}for(q=o(L,q);Z<V.length;Z++)ie=O(q,L,Z,V[Z],G),ie!==null&&(e&&ie.alternate!==null&&q.delete(ie.key===null?Z:ie.key),F=h(ie,F,Z),z===null?B=ie:z.sibling=ie,z=ie);return e&&q.forEach(function(re){return n(L,re)}),Pr&&ch(L,Z),B}function I(L,F,V,G){var B=Uv(V);if(typeof B!="function")throw Error(it(150));if(V=B.call(V),V==null)throw Error(it(151));for(var z=B=null,q=F,Z=F=0,ie=null,ue=V.next();q!==null&&!ue.done;Z++,ue=V.next()){q.index>Z?(ie=q,q=null):ie=q.sibling;var re=N(L,q,ue.value,G);if(re===null){q===null&&(q=ie);break}e&&q&&re.alternate===null&&n(L,q),F=h(re,F,Z),z===null?B=re:z.sibling=re,z=re,q=ie}if(ue.done)return a(L,q),Pr&&ch(L,Z),B;if(q===null){for(;!ue.done;Z++,ue=V.next())ue=S(L,ue.value,G),ue!==null&&(F=h(ue,F,Z),z===null?B=ue:z.sibling=ue,z=ue);return Pr&&ch(L,Z),B}for(q=o(L,q);!ue.done;Z++,ue=V.next())ue=O(q,L,Z,ue.value,G),ue!==null&&(e&&ue.alternate!==null&&q.delete(ue.key===null?Z:ue.key),F=h(ue,F,Z),z===null?B=ue:z.sibling=ue,z=ue);return e&&q.forEach(function(pe){return n(L,pe)}),Pr&&ch(L,Z),B}function P(L,F,V,G){if(typeof V=="object"&&V!==null&&V.type===Im&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case rE:e:{for(var B=V.key,z=F;z!==null;){if(z.key===B){if(B=V.type,B===Im){if(z.tag===7){a(L,z.sibling),F=d(z,V.props.children),F.return=L,L=F;break e}}else if(z.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Nd&&OH(B)===z.type){a(L,z.sibling),F=d(z,V.props),F.ref=Wv(L,z,V),F.return=L,L=F;break e}a(L,z);break}else n(L,z);z=z.sibling}V.type===Im?(F=Ch(V.props.children,L.mode,G,V.key),F.return=L,L=F):(G=YE(V.type,V.key,V.props,null,L.mode,G),G.ref=Wv(L,F,V),G.return=L,L=G)}return f(L);case Am:e:{for(z=V.key;F!==null;){if(F.key===z)if(F.tag===4&&F.stateNode.containerInfo===V.containerInfo&&F.stateNode.implementation===V.implementation){a(L,F.sibling),F=d(F,V.children||[]),F.return=L,L=F;break e}else{a(L,F);break}else n(L,F);F=F.sibling}F=FO(V,L.mode,G),F.return=L,L=F}return f(L);case Nd:return z=V._init,P(L,F,z(V._payload),G)}if(oy(V))return A(L,F,V,G);if(Uv(V))return I(L,F,V,G);mE(L,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,F!==null&&F.tag===6?(a(L,F.sibling),F=d(F,V),F.return=L,L=F):(a(L,F),F=UO(V,L.mode,G),F.return=L,L=F),f(L)):a(L,F)}return P}var sf=eX(!0),tX=eX(!1),mS=ru(null),fS=null,Um=null,k2=null;function j2(){k2=Um=fS=null}function L2(e){var n=mS.current;Tr(mS),e._currentValue=n}function nP(e,n,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===a)break;e=e.return}}function Ym(e,n){fS=e,k2=Um=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Ka=!0),e.firstContext=null)}function ho(e){var n=e._currentValue;if(k2!==e)if(e={context:e,memoizedValue:n,next:null},Um===null){if(fS===null)throw Error(it(308));Um=e,fS.dependencies={lanes:0,firstContext:e}}else Um=Um.next=e;return n}var gh=null;function M2(e){gh===null?gh=[e]:gh.push(e)}function nX(e,n,a,o){var d=n.interleaved;return d===null?(a.next=a,M2(n)):(a.next=d.next,d.next=a),n.interleaved=a,Al(e,o)}function Al(e,n){e.lanes|=n;var a=e.alternate;for(a!==null&&(a.lanes|=n),a=e,e=e.return;e!==null;)e.childLanes|=n,a=e.alternate,a!==null&&(a.childLanes|=n),a=e,e=e.return;return a.tag===3?a.stateNode:null}var Rd=!1;function U2(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rX(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function bl(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Hd(e,n,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,jn&2){var d=o.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),o.pending=n,Al(e,a)}return d=o.interleaved,d===null?(n.next=n,M2(o)):(n.next=d.next,d.next=n),o.interleaved=n,Al(e,a)}function GE(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,S2(e,a)}}function PH(e,n){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var d=null,h=null;if(a=a.firstBaseUpdate,a!==null){do{var f={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};h===null?d=h=f:h=h.next=f,a=a.next}while(a!==null);h===null?d=h=n:h=h.next=n}else d=h=n;a={baseState:o.baseState,firstBaseUpdate:d,lastBaseUpdate:h,shared:o.shared,effects:o.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}function gS(e,n,a,o){var d=e.updateQueue;Rd=!1;var h=d.firstBaseUpdate,f=d.lastBaseUpdate,y=d.shared.pending;if(y!==null){d.shared.pending=null;var b=y,x=b.next;b.next=null,f===null?h=x:f.next=x,f=b;var T=e.alternate;T!==null&&(T=T.updateQueue,y=T.lastBaseUpdate,y!==f&&(y===null?T.firstBaseUpdate=x:y.next=x,T.lastBaseUpdate=b))}if(h!==null){var S=d.baseState;f=0,T=x=b=null,y=h;do{var N=y.lane,O=y.eventTime;if((o&N)===N){T!==null&&(T=T.next={eventTime:O,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var A=e,I=y;switch(N=n,O=a,I.tag){case 1:if(A=I.payload,typeof A=="function"){S=A.call(O,S,N);break e}S=A;break e;case 3:A.flags=A.flags&-65537|128;case 0:if(A=I.payload,N=typeof A=="function"?A.call(O,S,N):A,N==null)break e;S=Gr({},S,N);break e;case 2:Rd=!0}}y.callback!==null&&y.lane!==0&&(e.flags|=64,N=d.effects,N===null?d.effects=[y]:N.push(y))}else O={eventTime:O,lane:N,tag:y.tag,payload:y.payload,callback:y.callback,next:null},T===null?(x=T=O,b=S):T=T.next=O,f|=N;if(y=y.next,y===null){if(y=d.shared.pending,y===null)break;N=y,y=N.next,N.next=null,d.lastBaseUpdate=N,d.shared.pending=null}}while(!0);if(T===null&&(b=S),d.baseState=b,d.firstBaseUpdate=x,d.lastBaseUpdate=T,n=d.shared.interleaved,n!==null){d=n;do f|=d.lane,d=d.next;while(d!==n)}else h===null&&(d.shared.lanes=0);Dh|=f,e.lanes=f,e.memoizedState=S}}function DH(e,n,a){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var o=e[n],d=o.callback;if(d!==null){if(o.callback=null,o=a,typeof d!="function")throw Error(it(191,d));d.call(o)}}}var F0={},Mc=ru(F0),Vy=ru(F0),By=ru(F0);function vh(e){if(e===F0)throw Error(it(174));return e}function F2(e,n){switch(pr(By,n),pr(Vy,e),pr(Mc,F0),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:L1(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=L1(n,e)}Tr(Mc),pr(Mc,n)}function of(){Tr(Mc),Tr(Vy),Tr(By)}function iX(e){vh(By.current);var n=vh(Mc.current),a=L1(n,e.type);n!==a&&(pr(Vy,e),pr(Mc,a))}function V2(e){Vy.current===e&&(Tr(Mc),Tr(Vy))}var Vr=ru(0);function vS(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var PO=[];function B2(){for(var e=0;e<PO.length;e++)PO[e]._workInProgressVersionPrimary=null;PO.length=0}var WE=Vl.ReactCurrentDispatcher,DO=Vl.ReactCurrentBatchConfig,Ph=0,Br=null,gi=null,Oi=null,yS=!1,yy=!1,Gy=0,dxe=0;function na(){throw Error(it(321))}function G2(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!Zo(e[a],n[a]))return!1;return!0}function W2(e,n,a,o,d,h){if(Ph=h,Br=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,WE.current=e===null||e.memoizedState===null?mxe:fxe,e=a(o,d),yy){h=0;do{if(yy=!1,Gy=0,25<=h)throw Error(it(301));h+=1,Oi=gi=null,n.updateQueue=null,WE.current=gxe,e=a(o,d)}while(yy)}if(WE.current=_S,n=gi!==null&&gi.next!==null,Ph=0,Oi=gi=Br=null,yS=!1,n)throw Error(it(300));return e}function $2(){var e=Gy!==0;return Gy=0,e}function Ic(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?Br.memoizedState=Oi=e:Oi=Oi.next=e,Oi}function po(){if(gi===null){var e=Br.alternate;e=e!==null?e.memoizedState:null}else e=gi.next;var n=Oi===null?Br.memoizedState:Oi.next;if(n!==null)Oi=n,gi=e;else{if(e===null)throw Error(it(310));gi=e,e={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},Oi===null?Br.memoizedState=Oi=e:Oi=Oi.next=e}return Oi}function Wy(e,n){return typeof n=="function"?n(e):n}function kO(e){var n=po(),a=n.queue;if(a===null)throw Error(it(311));a.lastRenderedReducer=e;var o=gi,d=o.baseQueue,h=a.pending;if(h!==null){if(d!==null){var f=d.next;d.next=h.next,h.next=f}o.baseQueue=d=h,a.pending=null}if(d!==null){h=d.next,o=o.baseState;var y=f=null,b=null,x=h;do{var T=x.lane;if((Ph&T)===T)b!==null&&(b=b.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),o=x.hasEagerState?x.eagerState:e(o,x.action);else{var S={lane:T,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};b===null?(y=b=S,f=o):b=b.next=S,Br.lanes|=T,Dh|=T}x=x.next}while(x!==null&&x!==h);b===null?f=o:b.next=y,Zo(o,n.memoizedState)||(Ka=!0),n.memoizedState=o,n.baseState=f,n.baseQueue=b,a.lastRenderedState=o}if(e=a.interleaved,e!==null){d=e;do h=d.lane,Br.lanes|=h,Dh|=h,d=d.next;while(d!==e)}else d===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function jO(e){var n=po(),a=n.queue;if(a===null)throw Error(it(311));a.lastRenderedReducer=e;var o=a.dispatch,d=a.pending,h=n.memoizedState;if(d!==null){a.pending=null;var f=d=d.next;do h=e(h,f.action),f=f.next;while(f!==d);Zo(h,n.memoizedState)||(Ka=!0),n.memoizedState=h,n.baseQueue===null&&(n.baseState=h),a.lastRenderedState=h}return[h,o]}function aX(){}function sX(e,n){var a=Br,o=po(),d=n(),h=!Zo(o.memoizedState,d);if(h&&(o.memoizedState=d,Ka=!0),o=o.queue,H2(lX.bind(null,a,o,e),[e]),o.getSnapshot!==n||h||Oi!==null&&Oi.memoizedState.tag&1){if(a.flags|=2048,$y(9,cX.bind(null,a,o,d,n),void 0,null),Pi===null)throw Error(it(349));Ph&30||oX(a,n,d)}return d}function oX(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=Br.updateQueue,n===null?(n={lastEffect:null,stores:null},Br.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function cX(e,n,a,o){n.value=a,n.getSnapshot=o,dX(n)&&uX(e)}function lX(e,n,a){return a(function(){dX(n)&&uX(e)})}function dX(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!Zo(e,a)}catch{return!0}}function uX(e){var n=Al(e,1);n!==null&&Qo(n,e,1,-1)}function kH(e){var n=Ic();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wy,lastRenderedState:e},n.queue=e,e=e.dispatch=pxe.bind(null,Br,e),[n.memoizedState,e]}function $y(e,n,a,o){return e={tag:e,create:n,destroy:a,deps:o,next:null},n=Br.updateQueue,n===null?(n={lastEffect:null,stores:null},Br.updateQueue=n,n.lastEffect=e.next=e):(a=n.lastEffect,a===null?n.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,n.lastEffect=e)),e}function hX(){return po().memoizedState}function $E(e,n,a,o){var d=Ic();Br.flags|=e,d.memoizedState=$y(1|n,a,void 0,o===void 0?null:o)}function Vw(e,n,a,o){var d=po();o=o===void 0?null:o;var h=void 0;if(gi!==null){var f=gi.memoizedState;if(h=f.destroy,o!==null&&G2(o,f.deps)){d.memoizedState=$y(n,a,h,o);return}}Br.flags|=e,d.memoizedState=$y(1|n,a,h,o)}function jH(e,n){return $E(8390656,8,e,n)}function H2(e,n){return Vw(2048,8,e,n)}function pX(e,n){return Vw(4,2,e,n)}function mX(e,n){return Vw(4,4,e,n)}function fX(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function gX(e,n,a){return a=a!=null?a.concat([e]):null,Vw(4,4,fX.bind(null,n,e),a)}function z2(){}function vX(e,n){var a=po();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&G2(n,o[1])?o[0]:(a.memoizedState=[e,n],e)}function yX(e,n){var a=po();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&G2(n,o[1])?o[0]:(e=e(),a.memoizedState=[e,n],e)}function _X(e,n,a){return Ph&21?(Zo(a,n)||(a=wq(),Br.lanes|=a,Dh|=a,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Ka=!0),e.memoizedState=a)}function uxe(e,n){var a=Xn;Xn=a!==0&&4>a?a:4,e(!0);var o=DO.transition;DO.transition={};try{e(!1),n()}finally{Xn=a,DO.transition=o}}function bX(){return po().memoizedState}function hxe(e,n,a){var o=Kd(e);if(a={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null},xX(e))EX(n,a);else if(a=nX(e,n,a,o),a!==null){var d=Na();Qo(a,e,o,d),SX(a,n,o)}}function pxe(e,n,a){var o=Kd(e),d={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null};if(xX(e))EX(n,d);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=n.lastRenderedReducer,h!==null))try{var f=n.lastRenderedState,y=h(f,a);if(d.hasEagerState=!0,d.eagerState=y,Zo(y,f)){var b=n.interleaved;b===null?(d.next=d,M2(n)):(d.next=b.next,b.next=d),n.interleaved=d;return}}catch{}finally{}a=nX(e,n,d,o),a!==null&&(d=Na(),Qo(a,e,o,d),SX(a,n,o))}}function xX(e){var n=e.alternate;return e===Br||n!==null&&n===Br}function EX(e,n){yy=yS=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function SX(e,n,a){if(a&4194240){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,S2(e,a)}}var _S={readContext:ho,useCallback:na,useContext:na,useEffect:na,useImperativeHandle:na,useInsertionEffect:na,useLayoutEffect:na,useMemo:na,useReducer:na,useRef:na,useState:na,useDebugValue:na,useDeferredValue:na,useTransition:na,useMutableSource:na,useSyncExternalStore:na,useId:na,unstable_isNewReconciler:!1},mxe={readContext:ho,useCallback:function(e,n){return Ic().memoizedState=[e,n===void 0?null:n],e},useContext:ho,useEffect:jH,useImperativeHandle:function(e,n,a){return a=a!=null?a.concat([e]):null,$E(4194308,4,fX.bind(null,n,e),a)},useLayoutEffect:function(e,n){return $E(4194308,4,e,n)},useInsertionEffect:function(e,n){return $E(4,2,e,n)},useMemo:function(e,n){var a=Ic();return n=n===void 0?null:n,e=e(),a.memoizedState=[e,n],e},useReducer:function(e,n,a){var o=Ic();return n=a!==void 0?a(n):n,o.memoizedState=o.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},o.queue=e,e=e.dispatch=hxe.bind(null,Br,e),[o.memoizedState,e]},useRef:function(e){var n=Ic();return e={current:e},n.memoizedState=e},useState:kH,useDebugValue:z2,useDeferredValue:function(e){return Ic().memoizedState=e},useTransition:function(){var e=kH(!1),n=e[0];return e=uxe.bind(null,e[1]),Ic().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,a){var o=Br,d=Ic();if(Pr){if(a===void 0)throw Error(it(407));a=a()}else{if(a=n(),Pi===null)throw Error(it(349));Ph&30||oX(o,n,a)}d.memoizedState=a;var h={value:a,getSnapshot:n};return d.queue=h,jH(lX.bind(null,o,h,e),[e]),o.flags|=2048,$y(9,cX.bind(null,o,h,a,n),void 0,null),a},useId:function(){var e=Ic(),n=Pi.identifierPrefix;if(Pr){var a=fl,o=ml;a=(o&~(1<<32-Jo(o)-1)).toString(32)+a,n=":"+n+"R"+a,a=Gy++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=dxe++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},fxe={readContext:ho,useCallback:vX,useContext:ho,useEffect:H2,useImperativeHandle:gX,useInsertionEffect:pX,useLayoutEffect:mX,useMemo:yX,useReducer:kO,useRef:hX,useState:function(){return kO(Wy)},useDebugValue:z2,useDeferredValue:function(e){var n=po();return _X(n,gi.memoizedState,e)},useTransition:function(){var e=kO(Wy)[0],n=po().memoizedState;return[e,n]},useMutableSource:aX,useSyncExternalStore:sX,useId:bX,unstable_isNewReconciler:!1},gxe={readContext:ho,useCallback:vX,useContext:ho,useEffect:H2,useImperativeHandle:gX,useInsertionEffect:pX,useLayoutEffect:mX,useMemo:yX,useReducer:jO,useRef:hX,useState:function(){return jO(Wy)},useDebugValue:z2,useDeferredValue:function(e){var n=po();return gi===null?n.memoizedState=e:_X(n,gi.memoizedState,e)},useTransition:function(){var e=jO(Wy)[0],n=po().memoizedState;return[e,n]},useMutableSource:aX,useSyncExternalStore:sX,useId:bX,unstable_isNewReconciler:!1};function $o(e,n){if(e&&e.defaultProps){n=Gr({},n),e=e.defaultProps;for(var a in e)n[a]===void 0&&(n[a]=e[a]);return n}return n}function rP(e,n,a,o){n=e.memoizedState,a=a(o,n),a=a==null?n:Gr({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Bw={isMounted:function(e){return(e=e._reactInternals)?Wh(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var o=Na(),d=Kd(e),h=bl(o,d);h.payload=n,a!=null&&(h.callback=a),n=Hd(e,h,d),n!==null&&(Qo(n,e,d,o),GE(n,e,d))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var o=Na(),d=Kd(e),h=bl(o,d);h.tag=1,h.payload=n,a!=null&&(h.callback=a),n=Hd(e,h,d),n!==null&&(Qo(n,e,d,o),GE(n,e,d))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=Na(),o=Kd(e),d=bl(a,o);d.tag=2,n!=null&&(d.callback=n),n=Hd(e,d,o),n!==null&&(Qo(n,e,o,a),GE(n,e,o))}};function LH(e,n,a,o,d,h,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,h,f):n.prototype&&n.prototype.isPureReactComponent?!Ly(a,o)||!Ly(d,h):!0}function wX(e,n,a){var o=!1,d=eu,h=n.contextType;return typeof h=="object"&&h!==null?h=ho(h):(d=Qa(n)?Ih:ha.current,o=n.contextTypes,h=(o=o!=null)?rf(e,d):eu),n=new n(a,h),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Bw,e.stateNode=n,n._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=h),n}function MH(e,n,a,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==e&&Bw.enqueueReplaceState(n,n.state,null)}function iP(e,n,a,o){var d=e.stateNode;d.props=a,d.state=e.memoizedState,d.refs={},U2(e);var h=n.contextType;typeof h=="object"&&h!==null?d.context=ho(h):(h=Qa(n)?Ih:ha.current,d.context=rf(e,h)),d.state=e.memoizedState,h=n.getDerivedStateFromProps,typeof h=="function"&&(rP(e,n,h,a),d.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(n=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),n!==d.state&&Bw.enqueueReplaceState(d,d.state,null),gS(e,a,d,o),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function cf(e,n){try{var a="",o=n;do a+=$_e(o),o=o.return;while(o);var d=a}catch(h){d=`
Error generating stack: `+h.message+`
`+h.stack}return{value:e,source:n,stack:d,digest:null}}function LO(e,n,a){return{value:e,source:null,stack:a??null,digest:n??null}}function aP(e,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var vxe=typeof WeakMap=="function"?WeakMap:Map;function TX(e,n,a){a=bl(-1,a),a.tag=3,a.payload={element:null};var o=n.value;return a.callback=function(){xS||(xS=!0,fP=o),aP(e,n)},a}function CX(e,n,a){a=bl(-1,a),a.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;a.payload=function(){return o(d)},a.callback=function(){aP(e,n)}}var h=e.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(a.callback=function(){aP(e,n),typeof o!="function"&&(zd===null?zd=new Set([this]):zd.add(this));var f=n.stack;this.componentDidCatch(n.value,{componentStack:f!==null?f:""})}),a}function UH(e,n,a){var o=e.pingCache;if(o===null){o=e.pingCache=new vxe;var d=new Set;o.set(n,d)}else d=o.get(n),d===void 0&&(d=new Set,o.set(n,d));d.has(a)||(d.add(a),e=Oxe.bind(null,e,n,a),n.then(e,e))}function FH(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function VH(e,n,a,o,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===n?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=bl(-1,1),n.tag=2,Hd(a,n,1))),a.lanes|=1),e)}var yxe=Vl.ReactCurrentOwner,Ka=!1;function Sa(e,n,a,o){n.child=e===null?tX(n,null,a,o):sf(n,e.child,a,o)}function BH(e,n,a,o,d){a=a.render;var h=n.ref;return Ym(n,d),o=W2(e,n,a,o,h,d),a=$2(),e!==null&&!Ka?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Il(e,n,d)):(Pr&&a&&O2(n),n.flags|=1,Sa(e,n,o,d),n.child)}function GH(e,n,a,o,d){if(e===null){var h=a.type;return typeof h=="function"&&!ek(h)&&h.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=h,NX(e,n,h,o,d)):(e=YE(a.type,null,o,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(h=e.child,!(e.lanes&d)){var f=h.memoizedProps;if(a=a.compare,a=a!==null?a:Ly,a(f,o)&&e.ref===n.ref)return Il(e,n,d)}return n.flags|=1,e=Yd(h,o),e.ref=n.ref,e.return=n,n.child=e}function NX(e,n,a,o,d){if(e!==null){var h=e.memoizedProps;if(Ly(h,o)&&e.ref===n.ref)if(Ka=!1,n.pendingProps=o=h,(e.lanes&d)!==0)e.flags&131072&&(Ka=!0);else return n.lanes=e.lanes,Il(e,n,d)}return sP(e,n,a,o,d)}function RX(e,n,a){var o=n.pendingProps,d=o.children,h=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},pr(Vm,bs),bs|=a;else{if(!(a&1073741824))return e=h!==null?h.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,pr(Vm,bs),bs|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=h!==null?h.baseLanes:a,pr(Vm,bs),bs|=o}else h!==null?(o=h.baseLanes|a,n.memoizedState=null):o=a,pr(Vm,bs),bs|=o;return Sa(e,n,d,a),n.child}function AX(e,n){var a=n.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function sP(e,n,a,o,d){var h=Qa(a)?Ih:ha.current;return h=rf(n,h),Ym(n,d),a=W2(e,n,a,o,h,d),o=$2(),e!==null&&!Ka?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Il(e,n,d)):(Pr&&o&&O2(n),n.flags|=1,Sa(e,n,a,d),n.child)}function WH(e,n,a,o,d){if(Qa(a)){var h=!0;uS(n)}else h=!1;if(Ym(n,d),n.stateNode===null)HE(e,n),wX(n,a,o),iP(n,a,o,d),o=!0;else if(e===null){var f=n.stateNode,y=n.memoizedProps;f.props=y;var b=f.context,x=a.contextType;typeof x=="object"&&x!==null?x=ho(x):(x=Qa(a)?Ih:ha.current,x=rf(n,x));var T=a.getDerivedStateFromProps,S=typeof T=="function"||typeof f.getSnapshotBeforeUpdate=="function";S||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(y!==o||b!==x)&&MH(n,f,o,x),Rd=!1;var N=n.memoizedState;f.state=N,gS(n,o,f,d),b=n.memoizedState,y!==o||N!==b||Ja.current||Rd?(typeof T=="function"&&(rP(n,a,T,o),b=n.memoizedState),(y=Rd||LH(n,a,y,o,N,b,x))?(S||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(n.flags|=4194308)):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=b),f.props=o,f.state=b,f.context=x,o=y):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{f=n.stateNode,rX(e,n),y=n.memoizedProps,x=n.type===n.elementType?y:$o(n.type,y),f.props=x,S=n.pendingProps,N=f.context,b=a.contextType,typeof b=="object"&&b!==null?b=ho(b):(b=Qa(a)?Ih:ha.current,b=rf(n,b));var O=a.getDerivedStateFromProps;(T=typeof O=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(y!==S||N!==b)&&MH(n,f,o,b),Rd=!1,N=n.memoizedState,f.state=N,gS(n,o,f,d);var A=n.memoizedState;y!==S||N!==A||Ja.current||Rd?(typeof O=="function"&&(rP(n,a,O,o),A=n.memoizedState),(x=Rd||LH(n,a,x,o,N,A,b)||!1)?(T||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(o,A,b),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(o,A,b)),typeof f.componentDidUpdate=="function"&&(n.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof f.componentDidUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=A),f.props=o,f.state=A,f.context=b,o=x):(typeof f.componentDidUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),o=!1)}return oP(e,n,a,o,h,d)}function oP(e,n,a,o,d,h){AX(e,n);var f=(n.flags&128)!==0;if(!o&&!f)return d&&RH(n,a,!1),Il(e,n,h);o=n.stateNode,yxe.current=n;var y=f&&typeof a.getDerivedStateFromError!="function"?null:o.render();return n.flags|=1,e!==null&&f?(n.child=sf(n,e.child,null,h),n.child=sf(n,null,y,h)):Sa(e,n,y,h),n.memoizedState=o.state,d&&RH(n,a,!0),n.child}function IX(e){var n=e.stateNode;n.pendingContext?NH(e,n.pendingContext,n.pendingContext!==n.context):n.context&&NH(e,n.context,!1),F2(e,n.containerInfo)}function $H(e,n,a,o,d){return af(),D2(d),n.flags|=256,Sa(e,n,a,o),n.child}var cP={dehydrated:null,treeContext:null,retryLane:0};function lP(e){return{baseLanes:e,cachePool:null,transitions:null}}function OX(e,n,a){var o=n.pendingProps,d=Vr.current,h=!1,f=(n.flags&128)!==0,y;if((y=f)||(y=e!==null&&e.memoizedState===null?!1:(d&2)!==0),y?(h=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),pr(Vr,d&1),e===null)return tP(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(f=o.children,e=o.fallback,h?(o=n.mode,h=n.child,f={mode:"hidden",children:f},!(o&1)&&h!==null?(h.childLanes=0,h.pendingProps=f):h=$w(f,o,0,null),e=Ch(e,o,a,null),h.return=n,e.return=n,h.sibling=e,n.child=h,n.child.memoizedState=lP(a),n.memoizedState=cP,e):K2(n,f));if(d=e.memoizedState,d!==null&&(y=d.dehydrated,y!==null))return _xe(e,n,f,o,y,d,a);if(h){h=o.fallback,f=n.mode,d=e.child,y=d.sibling;var b={mode:"hidden",children:o.children};return!(f&1)&&n.child!==d?(o=n.child,o.childLanes=0,o.pendingProps=b,n.deletions=null):(o=Yd(d,b),o.subtreeFlags=d.subtreeFlags&14680064),y!==null?h=Yd(y,h):(h=Ch(h,f,a,null),h.flags|=2),h.return=n,o.return=n,o.sibling=h,n.child=o,o=h,h=n.child,f=e.child.memoizedState,f=f===null?lP(a):{baseLanes:f.baseLanes|a,cachePool:null,transitions:f.transitions},h.memoizedState=f,h.childLanes=e.childLanes&~a,n.memoizedState=cP,o}return h=e.child,e=h.sibling,o=Yd(h,{mode:"visible",children:o.children}),!(n.mode&1)&&(o.lanes=a),o.return=n,o.sibling=null,e!==null&&(a=n.deletions,a===null?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=o,n.memoizedState=null,o}function K2(e,n){return n=$w({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function fE(e,n,a,o){return o!==null&&D2(o),sf(n,e.child,null,a),e=K2(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function _xe(e,n,a,o,d,h,f){if(a)return n.flags&256?(n.flags&=-257,o=LO(Error(it(422))),fE(e,n,f,o)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(h=o.fallback,d=n.mode,o=$w({mode:"visible",children:o.children},d,0,null),h=Ch(h,d,f,null),h.flags|=2,o.return=n,h.return=n,o.sibling=h,n.child=o,n.mode&1&&sf(n,e.child,null,f),n.child.memoizedState=lP(f),n.memoizedState=cP,h);if(!(n.mode&1))return fE(e,n,f,null);if(d.data==="$!"){if(o=d.nextSibling&&d.nextSibling.dataset,o)var y=o.dgst;return o=y,h=Error(it(419)),o=LO(h,o,void 0),fE(e,n,f,o)}if(y=(f&e.childLanes)!==0,Ka||y){if(o=Pi,o!==null){switch(f&-f){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(o.suspendedLanes|f)?0:d,d!==0&&d!==h.retryLane&&(h.retryLane=d,Al(e,d),Qo(o,e,d,-1))}return Z2(),o=LO(Error(it(421))),fE(e,n,f,o)}return d.data==="$?"?(n.flags|=128,n.child=e.child,n=Pxe.bind(null,e),d._reactRetry=n,null):(e=h.treeContext,ws=$d(d.nextSibling),Cs=n,Pr=!0,Yo=null,e!==null&&(ro[io++]=ml,ro[io++]=fl,ro[io++]=Oh,ml=e.id,fl=e.overflow,Oh=n),n=K2(n,o.children),n.flags|=4096,n)}function HH(e,n,a){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),nP(e.return,n,a)}function MO(e,n,a,o,d){var h=e.memoizedState;h===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:d}:(h.isBackwards=n,h.rendering=null,h.renderingStartTime=0,h.last=o,h.tail=a,h.tailMode=d)}function PX(e,n,a){var o=n.pendingProps,d=o.revealOrder,h=o.tail;if(Sa(e,n,o.children,a),o=Vr.current,o&2)o=o&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&HH(e,a,n);else if(e.tag===19)HH(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(pr(Vr,o),!(n.mode&1))n.memoizedState=null;else switch(d){case"forwards":for(a=n.child,d=null;a!==null;)e=a.alternate,e!==null&&vS(e)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),MO(n,!1,d,a,h);break;case"backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&vS(e)===null){n.child=d;break}e=d.sibling,d.sibling=a,a=d,d=e}MO(n,!0,a,null,h);break;case"together":MO(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function HE(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Il(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),Dh|=n.lanes,!(a&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(it(153));if(n.child!==null){for(e=n.child,a=Yd(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=Yd(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function bxe(e,n,a){switch(n.tag){case 3:IX(n),af();break;case 5:iX(n);break;case 1:Qa(n.type)&&uS(n);break;case 4:F2(n,n.stateNode.containerInfo);break;case 10:var o=n.type._context,d=n.memoizedProps.value;pr(mS,o._currentValue),o._currentValue=d;break;case 13:if(o=n.memoizedState,o!==null)return o.dehydrated!==null?(pr(Vr,Vr.current&1),n.flags|=128,null):a&n.child.childLanes?OX(e,n,a):(pr(Vr,Vr.current&1),e=Il(e,n,a),e!==null?e.sibling:null);pr(Vr,Vr.current&1);break;case 19:if(o=(a&n.childLanes)!==0,e.flags&128){if(o)return PX(e,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),pr(Vr,Vr.current),o)break;return null;case 22:case 23:return n.lanes=0,RX(e,n,a)}return Il(e,n,a)}var DX,dP,kX,jX;DX=function(e,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};dP=function(){};kX=function(e,n,a,o){var d=e.memoizedProps;if(d!==o){e=n.stateNode,vh(Mc.current);var h=null;switch(a){case"input":d=P1(e,d),o=P1(e,o),h=[];break;case"select":d=Gr({},d,{value:void 0}),o=Gr({},o,{value:void 0}),h=[];break;case"textarea":d=j1(e,d),o=j1(e,o),h=[];break;default:typeof d.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=lS)}M1(a,o);var f;a=null;for(x in d)if(!o.hasOwnProperty(x)&&d.hasOwnProperty(x)&&d[x]!=null)if(x==="style"){var y=d[x];for(f in y)y.hasOwnProperty(f)&&(a||(a={}),a[f]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(Ay.hasOwnProperty(x)?h||(h=[]):(h=h||[]).push(x,null));for(x in o){var b=o[x];if(y=d!=null?d[x]:void 0,o.hasOwnProperty(x)&&b!==y&&(b!=null||y!=null))if(x==="style")if(y){for(f in y)!y.hasOwnProperty(f)||b&&b.hasOwnProperty(f)||(a||(a={}),a[f]="");for(f in b)b.hasOwnProperty(f)&&y[f]!==b[f]&&(a||(a={}),a[f]=b[f])}else a||(h||(h=[]),h.push(x,a)),a=b;else x==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,y=y?y.__html:void 0,b!=null&&y!==b&&(h=h||[]).push(x,b)):x==="children"?typeof b!="string"&&typeof b!="number"||(h=h||[]).push(x,""+b):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(Ay.hasOwnProperty(x)?(b!=null&&x==="onScroll"&&Er("scroll",e),h||y===b||(h=[])):(h=h||[]).push(x,b))}a&&(h=h||[]).push("style",a);var x=h;(n.updateQueue=x)&&(n.flags|=4)}};jX=function(e,n,a,o){a!==o&&(n.flags|=4)};function $v(e,n){if(!Pr)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function ra(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(n)for(var d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags&14680064,o|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags,o|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=o,e.childLanes=a,n}function xxe(e,n,a){var o=n.pendingProps;switch(P2(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ra(n),null;case 1:return Qa(n.type)&&dS(),ra(n),null;case 3:return o=n.stateNode,of(),Tr(Ja),Tr(ha),B2(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(pE(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Yo!==null&&(yP(Yo),Yo=null))),dP(e,n),ra(n),null;case 5:V2(n);var d=vh(By.current);if(a=n.type,e!==null&&n.stateNode!=null)kX(e,n,a,o,d),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!o){if(n.stateNode===null)throw Error(it(166));return ra(n),null}if(e=vh(Mc.current),pE(n)){o=n.stateNode,a=n.type;var h=n.memoizedProps;switch(o[Pc]=n,o[Fy]=h,e=(n.mode&1)!==0,a){case"dialog":Er("cancel",o),Er("close",o);break;case"iframe":case"object":case"embed":Er("load",o);break;case"video":case"audio":for(d=0;d<ly.length;d++)Er(ly[d],o);break;case"source":Er("error",o);break;case"img":case"image":case"link":Er("error",o),Er("load",o);break;case"details":Er("toggle",o);break;case"input":eH(o,h),Er("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!h.multiple},Er("invalid",o);break;case"textarea":nH(o,h),Er("invalid",o)}M1(a,h),d=null;for(var f in h)if(h.hasOwnProperty(f)){var y=h[f];f==="children"?typeof y=="string"?o.textContent!==y&&(h.suppressHydrationWarning!==!0&&hE(o.textContent,y,e),d=["children",y]):typeof y=="number"&&o.textContent!==""+y&&(h.suppressHydrationWarning!==!0&&hE(o.textContent,y,e),d=["children",""+y]):Ay.hasOwnProperty(f)&&y!=null&&f==="onScroll"&&Er("scroll",o)}switch(a){case"input":iE(o),tH(o,h,!0);break;case"textarea":iE(o),rH(o);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(o.onclick=lS)}o=d,n.updateQueue=o,o!==null&&(n.flags|=4)}else{f=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=lq(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=f.createElement(a,{is:o.is}):(e=f.createElement(a),a==="select"&&(f=e,o.multiple?f.multiple=!0:o.size&&(f.size=o.size))):e=f.createElementNS(e,a),e[Pc]=n,e[Fy]=o,DX(e,n,!1,!1),n.stateNode=e;e:{switch(f=U1(a,o),a){case"dialog":Er("cancel",e),Er("close",e),d=o;break;case"iframe":case"object":case"embed":Er("load",e),d=o;break;case"video":case"audio":for(d=0;d<ly.length;d++)Er(ly[d],e);d=o;break;case"source":Er("error",e),d=o;break;case"img":case"image":case"link":Er("error",e),Er("load",e),d=o;break;case"details":Er("toggle",e),d=o;break;case"input":eH(e,o),d=P1(e,o),Er("invalid",e);break;case"option":d=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},d=Gr({},o,{value:void 0}),Er("invalid",e);break;case"textarea":nH(e,o),d=j1(e,o),Er("invalid",e);break;default:d=o}M1(a,d),y=d;for(h in y)if(y.hasOwnProperty(h)){var b=y[h];h==="style"?hq(e,b):h==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&dq(e,b)):h==="children"?typeof b=="string"?(a!=="textarea"||b!=="")&&Iy(e,b):typeof b=="number"&&Iy(e,""+b):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Ay.hasOwnProperty(h)?b!=null&&h==="onScroll"&&Er("scroll",e):b!=null&&v2(e,h,b,f))}switch(a){case"input":iE(e),tH(e,o,!1);break;case"textarea":iE(e),rH(e);break;case"option":o.value!=null&&e.setAttribute("value",""+Zd(o.value));break;case"select":e.multiple=!!o.multiple,h=o.value,h!=null?$m(e,!!o.multiple,h,!1):o.defaultValue!=null&&$m(e,!!o.multiple,o.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=lS)}switch(a){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return ra(n),null;case 6:if(e&&n.stateNode!=null)jX(e,n,e.memoizedProps,o);else{if(typeof o!="string"&&n.stateNode===null)throw Error(it(166));if(a=vh(By.current),vh(Mc.current),pE(n)){if(o=n.stateNode,a=n.memoizedProps,o[Pc]=n,(h=o.nodeValue!==a)&&(e=Cs,e!==null))switch(e.tag){case 3:hE(o.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&hE(o.nodeValue,a,(e.mode&1)!==0)}h&&(n.flags|=4)}else o=(a.nodeType===9?a:a.ownerDocument).createTextNode(o),o[Pc]=n,n.stateNode=o}return ra(n),null;case 13:if(Tr(Vr),o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Pr&&ws!==null&&n.mode&1&&!(n.flags&128))Zq(),af(),n.flags|=98560,h=!1;else if(h=pE(n),o!==null&&o.dehydrated!==null){if(e===null){if(!h)throw Error(it(318));if(h=n.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(it(317));h[Pc]=n}else af(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;ra(n),h=!1}else Yo!==null&&(yP(Yo),Yo=null),h=!0;if(!h)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(n.child.flags|=8192,n.mode&1&&(e===null||Vr.current&1?yi===0&&(yi=3):Z2())),n.updateQueue!==null&&(n.flags|=4),ra(n),null);case 4:return of(),dP(e,n),e===null&&My(n.stateNode.containerInfo),ra(n),null;case 10:return L2(n.type._context),ra(n),null;case 17:return Qa(n.type)&&dS(),ra(n),null;case 19:if(Tr(Vr),h=n.memoizedState,h===null)return ra(n),null;if(o=(n.flags&128)!==0,f=h.rendering,f===null)if(o)$v(h,!1);else{if(yi!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(f=vS(e),f!==null){for(n.flags|=128,$v(h,!1),o=f.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),n.subtreeFlags=0,o=a,a=n.child;a!==null;)h=a,e=o,h.flags&=14680066,f=h.alternate,f===null?(h.childLanes=0,h.lanes=e,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=f.childLanes,h.lanes=f.lanes,h.child=f.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=f.memoizedProps,h.memoizedState=f.memoizedState,h.updateQueue=f.updateQueue,h.type=f.type,e=f.dependencies,h.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return pr(Vr,Vr.current&1|2),n.child}e=e.sibling}h.tail!==null&&ei()>lf&&(n.flags|=128,o=!0,$v(h,!1),n.lanes=4194304)}else{if(!o)if(e=vS(f),e!==null){if(n.flags|=128,o=!0,a=e.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),$v(h,!0),h.tail===null&&h.tailMode==="hidden"&&!f.alternate&&!Pr)return ra(n),null}else 2*ei()-h.renderingStartTime>lf&&a!==1073741824&&(n.flags|=128,o=!0,$v(h,!1),n.lanes=4194304);h.isBackwards?(f.sibling=n.child,n.child=f):(a=h.last,a!==null?a.sibling=f:n.child=f,h.last=f)}return h.tail!==null?(n=h.tail,h.rendering=n,h.tail=n.sibling,h.renderingStartTime=ei(),n.sibling=null,a=Vr.current,pr(Vr,o?a&1|2:a&1),n):(ra(n),null);case 22:case 23:return Q2(),o=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(n.flags|=8192),o&&n.mode&1?bs&1073741824&&(ra(n),n.subtreeFlags&6&&(n.flags|=8192)):ra(n),null;case 24:return null;case 25:return null}throw Error(it(156,n.tag))}function Exe(e,n){switch(P2(n),n.tag){case 1:return Qa(n.type)&&dS(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return of(),Tr(Ja),Tr(ha),B2(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return V2(n),null;case 13:if(Tr(Vr),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(it(340));af()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Tr(Vr),null;case 4:return of(),null;case 10:return L2(n.type._context),null;case 22:case 23:return Q2(),null;case 24:return null;default:return null}}var gE=!1,oa=!1,Sxe=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function Fm(e,n){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(o){Kr(e,n,o)}else a.current=null}function uP(e,n,a){try{a()}catch(o){Kr(e,n,o)}}var zH=!1;function wxe(e,n){if(Y1=sS,e=Vq(),I2(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var d=o.anchorOffset,h=o.focusNode;o=o.focusOffset;try{a.nodeType,h.nodeType}catch{a=null;break e}var f=0,y=-1,b=-1,x=0,T=0,S=e,N=null;t:for(;;){for(var O;S!==a||d!==0&&S.nodeType!==3||(y=f+d),S!==h||o!==0&&S.nodeType!==3||(b=f+o),S.nodeType===3&&(f+=S.nodeValue.length),(O=S.firstChild)!==null;)N=S,S=O;for(;;){if(S===e)break t;if(N===a&&++x===d&&(y=f),N===h&&++T===o&&(b=f),(O=S.nextSibling)!==null)break;S=N,N=S.parentNode}S=O}a=y===-1||b===-1?null:{start:y,end:b}}else a=null}a=a||{start:0,end:0}}else a=null;for(q1={focusedElem:e,selectionRange:a},sS=!1,Rt=n;Rt!==null;)if(n=Rt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Rt=e;else for(;Rt!==null;){n=Rt;try{var A=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(A!==null){var I=A.memoizedProps,P=A.memoizedState,L=n.stateNode,F=L.getSnapshotBeforeUpdate(n.elementType===n.type?I:$o(n.type,I),P);L.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var V=n.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(it(163))}}catch(G){Kr(n,n.return,G)}if(e=n.sibling,e!==null){e.return=n.return,Rt=e;break}Rt=n.return}return A=zH,zH=!1,A}function _y(e,n,a){var o=n.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&e)===e){var h=d.destroy;d.destroy=void 0,h!==void 0&&uP(n,a,h)}d=d.next}while(d!==o)}}function Gw(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.create;a.destroy=o()}a=a.next}while(a!==n)}}function hP(e){var n=e.ref;if(n!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof n=="function"?n(e):n.current=e}}function LX(e){var n=e.alternate;n!==null&&(e.alternate=null,LX(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Pc],delete n[Fy],delete n[Q1],delete n[sxe],delete n[oxe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function MX(e){return e.tag===5||e.tag===3||e.tag===4}function KH(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||MX(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function pP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=lS));else if(o!==4&&(e=e.child,e!==null))for(pP(e,n,a),e=e.sibling;e!==null;)pP(e,n,a),e=e.sibling}function mP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(mP(e,n,a),e=e.sibling;e!==null;)mP(e,n,a),e=e.sibling}var $i=null,Ho=!1;function Td(e,n,a){for(a=a.child;a!==null;)UX(e,n,a),a=a.sibling}function UX(e,n,a){if(Lc&&typeof Lc.onCommitFiberUnmount=="function")try{Lc.onCommitFiberUnmount(kw,a)}catch{}switch(a.tag){case 5:oa||Fm(a,n);case 6:var o=$i,d=Ho;$i=null,Td(e,n,a),$i=o,Ho=d,$i!==null&&(Ho?(e=$i,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):$i.removeChild(a.stateNode));break;case 18:$i!==null&&(Ho?(e=$i,a=a.stateNode,e.nodeType===8?IO(e.parentNode,a):e.nodeType===1&&IO(e,a),ky(e)):IO($i,a.stateNode));break;case 4:o=$i,d=Ho,$i=a.stateNode.containerInfo,Ho=!0,Td(e,n,a),$i=o,Ho=d;break;case 0:case 11:case 14:case 15:if(!oa&&(o=a.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){d=o=o.next;do{var h=d,f=h.destroy;h=h.tag,f!==void 0&&(h&2||h&4)&&uP(a,n,f),d=d.next}while(d!==o)}Td(e,n,a);break;case 1:if(!oa&&(Fm(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=a.memoizedProps,o.state=a.memoizedState,o.componentWillUnmount()}catch(y){Kr(a,n,y)}Td(e,n,a);break;case 21:Td(e,n,a);break;case 22:a.mode&1?(oa=(o=oa)||a.memoizedState!==null,Td(e,n,a),oa=o):Td(e,n,a);break;default:Td(e,n,a)}}function YH(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new Sxe),n.forEach(function(o){var d=Dxe.bind(null,e,o);a.has(o)||(a.add(o),o.then(d,d))})}}function Bo(e,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];try{var h=e,f=n,y=f;e:for(;y!==null;){switch(y.tag){case 5:$i=y.stateNode,Ho=!1;break e;case 3:$i=y.stateNode.containerInfo,Ho=!0;break e;case 4:$i=y.stateNode.containerInfo,Ho=!0;break e}y=y.return}if($i===null)throw Error(it(160));UX(h,f,d),$i=null,Ho=!1;var b=d.alternate;b!==null&&(b.return=null),d.return=null}catch(x){Kr(d,n,x)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)FX(n,e),n=n.sibling}function FX(e,n){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Bo(n,e),Nc(e),o&4){try{_y(3,e,e.return),Gw(3,e)}catch(I){Kr(e,e.return,I)}try{_y(5,e,e.return)}catch(I){Kr(e,e.return,I)}}break;case 1:Bo(n,e),Nc(e),o&512&&a!==null&&Fm(a,a.return);break;case 5:if(Bo(n,e),Nc(e),o&512&&a!==null&&Fm(a,a.return),e.flags&32){var d=e.stateNode;try{Iy(d,"")}catch(I){Kr(e,e.return,I)}}if(o&4&&(d=e.stateNode,d!=null)){var h=e.memoizedProps,f=a!==null?a.memoizedProps:h,y=e.type,b=e.updateQueue;if(e.updateQueue=null,b!==null)try{y==="input"&&h.type==="radio"&&h.name!=null&&oq(d,h),U1(y,f);var x=U1(y,h);for(f=0;f<b.length;f+=2){var T=b[f],S=b[f+1];T==="style"?hq(d,S):T==="dangerouslySetInnerHTML"?dq(d,S):T==="children"?Iy(d,S):v2(d,T,S,x)}switch(y){case"input":D1(d,h);break;case"textarea":cq(d,h);break;case"select":var N=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!h.multiple;var O=h.value;O!=null?$m(d,!!h.multiple,O,!1):N!==!!h.multiple&&(h.defaultValue!=null?$m(d,!!h.multiple,h.defaultValue,!0):$m(d,!!h.multiple,h.multiple?[]:"",!1))}d[Fy]=h}catch(I){Kr(e,e.return,I)}}break;case 6:if(Bo(n,e),Nc(e),o&4){if(e.stateNode===null)throw Error(it(162));d=e.stateNode,h=e.memoizedProps;try{d.nodeValue=h}catch(I){Kr(e,e.return,I)}}break;case 3:if(Bo(n,e),Nc(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{ky(n.containerInfo)}catch(I){Kr(e,e.return,I)}break;case 4:Bo(n,e),Nc(e);break;case 13:Bo(n,e),Nc(e),d=e.child,d.flags&8192&&(h=d.memoizedState!==null,d.stateNode.isHidden=h,!h||d.alternate!==null&&d.alternate.memoizedState!==null||(X2=ei())),o&4&&YH(e);break;case 22:if(T=a!==null&&a.memoizedState!==null,e.mode&1?(oa=(x=oa)||T,Bo(n,e),oa=x):Bo(n,e),Nc(e),o&8192){if(x=e.memoizedState!==null,(e.stateNode.isHidden=x)&&!T&&e.mode&1)for(Rt=e,T=e.child;T!==null;){for(S=Rt=T;Rt!==null;){switch(N=Rt,O=N.child,N.tag){case 0:case 11:case 14:case 15:_y(4,N,N.return);break;case 1:Fm(N,N.return);var A=N.stateNode;if(typeof A.componentWillUnmount=="function"){o=N,a=N.return;try{n=o,A.props=n.memoizedProps,A.state=n.memoizedState,A.componentWillUnmount()}catch(I){Kr(o,a,I)}}break;case 5:Fm(N,N.return);break;case 22:if(N.memoizedState!==null){XH(S);continue}}O!==null?(O.return=N,Rt=O):XH(S)}T=T.sibling}e:for(T=null,S=e;;){if(S.tag===5){if(T===null){T=S;try{d=S.stateNode,x?(h=d.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(y=S.stateNode,b=S.memoizedProps.style,f=b!=null&&b.hasOwnProperty("display")?b.display:null,y.style.display=uq("display",f))}catch(I){Kr(e,e.return,I)}}}else if(S.tag===6){if(T===null)try{S.stateNode.nodeValue=x?"":S.memoizedProps}catch(I){Kr(e,e.return,I)}}else if((S.tag!==22&&S.tag!==23||S.memoizedState===null||S===e)&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===e)break e;for(;S.sibling===null;){if(S.return===null||S.return===e)break e;T===S&&(T=null),S=S.return}T===S&&(T=null),S.sibling.return=S.return,S=S.sibling}}break;case 19:Bo(n,e),Nc(e),o&4&&YH(e);break;case 21:break;default:Bo(n,e),Nc(e)}}function Nc(e){var n=e.flags;if(n&2){try{e:{for(var a=e.return;a!==null;){if(MX(a)){var o=a;break e}a=a.return}throw Error(it(160))}switch(o.tag){case 5:var d=o.stateNode;o.flags&32&&(Iy(d,""),o.flags&=-33);var h=KH(e);mP(e,h,d);break;case 3:case 4:var f=o.stateNode.containerInfo,y=KH(e);pP(e,y,f);break;default:throw Error(it(161))}}catch(b){Kr(e,e.return,b)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function Txe(e,n,a){Rt=e,VX(e)}function VX(e,n,a){for(var o=(e.mode&1)!==0;Rt!==null;){var d=Rt,h=d.child;if(d.tag===22&&o){var f=d.memoizedState!==null||gE;if(!f){var y=d.alternate,b=y!==null&&y.memoizedState!==null||oa;y=gE;var x=oa;if(gE=f,(oa=b)&&!x)for(Rt=d;Rt!==null;)f=Rt,b=f.child,f.tag===22&&f.memoizedState!==null?JH(d):b!==null?(b.return=f,Rt=b):JH(d);for(;h!==null;)Rt=h,VX(h),h=h.sibling;Rt=d,gE=y,oa=x}qH(e)}else d.subtreeFlags&8772&&h!==null?(h.return=d,Rt=h):qH(e)}}function qH(e){for(;Rt!==null;){var n=Rt;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:oa||Gw(5,n);break;case 1:var o=n.stateNode;if(n.flags&4&&!oa)if(a===null)o.componentDidMount();else{var d=n.elementType===n.type?a.memoizedProps:$o(n.type,a.memoizedProps);o.componentDidUpdate(d,a.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var h=n.updateQueue;h!==null&&DH(n,h,o);break;case 3:var f=n.updateQueue;if(f!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}DH(n,f,a)}break;case 5:var y=n.stateNode;if(a===null&&n.flags&4){a=y;var b=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&a.focus();break;case"img":b.src&&(a.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var x=n.alternate;if(x!==null){var T=x.memoizedState;if(T!==null){var S=T.dehydrated;S!==null&&ky(S)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(it(163))}oa||n.flags&512&&hP(n)}catch(N){Kr(n,n.return,N)}}if(n===e){Rt=null;break}if(a=n.sibling,a!==null){a.return=n.return,Rt=a;break}Rt=n.return}}function XH(e){for(;Rt!==null;){var n=Rt;if(n===e){Rt=null;break}var a=n.sibling;if(a!==null){a.return=n.return,Rt=a;break}Rt=n.return}}function JH(e){for(;Rt!==null;){var n=Rt;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{Gw(4,n)}catch(b){Kr(n,a,b)}break;case 1:var o=n.stateNode;if(typeof o.componentDidMount=="function"){var d=n.return;try{o.componentDidMount()}catch(b){Kr(n,d,b)}}var h=n.return;try{hP(n)}catch(b){Kr(n,h,b)}break;case 5:var f=n.return;try{hP(n)}catch(b){Kr(n,f,b)}}}catch(b){Kr(n,n.return,b)}if(n===e){Rt=null;break}var y=n.sibling;if(y!==null){y.return=n.return,Rt=y;break}Rt=n.return}}var Cxe=Math.ceil,bS=Vl.ReactCurrentDispatcher,Y2=Vl.ReactCurrentOwner,co=Vl.ReactCurrentBatchConfig,jn=0,Pi=null,oi=null,Ki=0,bs=0,Vm=ru(0),yi=0,Hy=null,Dh=0,Ww=0,q2=0,by=null,za=null,X2=0,lf=1/0,hl=null,xS=!1,fP=null,zd=null,vE=!1,Md=null,ES=0,xy=0,gP=null,zE=-1,KE=0;function Na(){return jn&6?ei():zE!==-1?zE:zE=ei()}function Kd(e){return e.mode&1?jn&2&&Ki!==0?Ki&-Ki:lxe.transition!==null?(KE===0&&(KE=wq()),KE):(e=Xn,e!==0||(e=window.event,e=e===void 0?16:Oq(e.type)),e):1}function Qo(e,n,a,o){if(50<xy)throw xy=0,gP=null,Error(it(185));L0(e,a,o),(!(jn&2)||e!==Pi)&&(e===Pi&&(!(jn&2)&&(Ww|=a),yi===4&&Od(e,Ki)),Za(e,o),a===1&&jn===0&&!(n.mode&1)&&(lf=ei()+500,Fw&&iu()))}function Za(e,n){var a=e.callbackNode;lbe(e,n);var o=aS(e,e===Pi?Ki:0);if(o===0)a!==null&&sH(a),e.callbackNode=null,e.callbackPriority=0;else if(n=o&-o,e.callbackPriority!==n){if(a!=null&&sH(a),n===1)e.tag===0?cxe(QH.bind(null,e)):Xq(QH.bind(null,e)),ixe(function(){!(jn&6)&&iu()}),a=null;else{switch(Tq(o)){case 1:a=E2;break;case 4:a=Eq;break;case 16:a=iS;break;case 536870912:a=Sq;break;default:a=iS}a=YX(a,BX.bind(null,e))}e.callbackPriority=n,e.callbackNode=a}}function BX(e,n){if(zE=-1,KE=0,jn&6)throw Error(it(327));var a=e.callbackNode;if(qm()&&e.callbackNode!==a)return null;var o=aS(e,e===Pi?Ki:0);if(o===0)return null;if(o&30||o&e.expiredLanes||n)n=SS(e,o);else{n=o;var d=jn;jn|=2;var h=WX();(Pi!==e||Ki!==n)&&(hl=null,lf=ei()+500,Th(e,n));do try{Axe();break}catch(y){GX(e,y)}while(!0);j2(),bS.current=h,jn=d,oi!==null?n=0:(Pi=null,Ki=0,n=yi)}if(n!==0){if(n===2&&(d=W1(e),d!==0&&(o=d,n=vP(e,d))),n===1)throw a=Hy,Th(e,0),Od(e,o),Za(e,ei()),a;if(n===6)Od(e,o);else{if(d=e.current.alternate,!(o&30)&&!Nxe(d)&&(n=SS(e,o),n===2&&(h=W1(e),h!==0&&(o=h,n=vP(e,h))),n===1))throw a=Hy,Th(e,0),Od(e,o),Za(e,ei()),a;switch(e.finishedWork=d,e.finishedLanes=o,n){case 0:case 1:throw Error(it(345));case 2:lh(e,za,hl);break;case 3:if(Od(e,o),(o&130023424)===o&&(n=X2+500-ei(),10<n)){if(aS(e,0)!==0)break;if(d=e.suspendedLanes,(d&o)!==o){Na(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=J1(lh.bind(null,e,za,hl),n);break}lh(e,za,hl);break;case 4:if(Od(e,o),(o&4194240)===o)break;for(n=e.eventTimes,d=-1;0<o;){var f=31-Jo(o);h=1<<f,f=n[f],f>d&&(d=f),o&=~h}if(o=d,o=ei()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*Cxe(o/1960))-o,10<o){e.timeoutHandle=J1(lh.bind(null,e,za,hl),o);break}lh(e,za,hl);break;case 5:lh(e,za,hl);break;default:throw Error(it(329))}}}return Za(e,ei()),e.callbackNode===a?BX.bind(null,e):null}function vP(e,n){var a=by;return e.current.memoizedState.isDehydrated&&(Th(e,n).flags|=256),e=SS(e,n),e!==2&&(n=za,za=a,n!==null&&yP(n)),e}function yP(e){za===null?za=e:za.push.apply(za,e)}function Nxe(e){for(var n=e;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var o=0;o<a.length;o++){var d=a[o],h=d.getSnapshot;d=d.value;try{if(!Zo(h(),d))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Od(e,n){for(n&=~q2,n&=~Ww,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var a=31-Jo(n),o=1<<a;e[a]=-1,n&=~o}}function QH(e){if(jn&6)throw Error(it(327));qm();var n=aS(e,0);if(!(n&1))return Za(e,ei()),null;var a=SS(e,n);if(e.tag!==0&&a===2){var o=W1(e);o!==0&&(n=o,a=vP(e,o))}if(a===1)throw a=Hy,Th(e,0),Od(e,n),Za(e,ei()),a;if(a===6)throw Error(it(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,lh(e,za,hl),Za(e,ei()),null}function J2(e,n){var a=jn;jn|=1;try{return e(n)}finally{jn=a,jn===0&&(lf=ei()+500,Fw&&iu())}}function kh(e){Md!==null&&Md.tag===0&&!(jn&6)&&qm();var n=jn;jn|=1;var a=co.transition,o=Xn;try{if(co.transition=null,Xn=1,e)return e()}finally{Xn=o,co.transition=a,jn=n,!(jn&6)&&iu()}}function Q2(){bs=Vm.current,Tr(Vm)}function Th(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,rxe(a)),oi!==null)for(a=oi.return;a!==null;){var o=a;switch(P2(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&dS();break;case 3:of(),Tr(Ja),Tr(ha),B2();break;case 5:V2(o);break;case 4:of();break;case 13:Tr(Vr);break;case 19:Tr(Vr);break;case 10:L2(o.type._context);break;case 22:case 23:Q2()}a=a.return}if(Pi=e,oi=e=Yd(e.current,null),Ki=bs=n,yi=0,Hy=null,q2=Ww=Dh=0,za=by=null,gh!==null){for(n=0;n<gh.length;n++)if(a=gh[n],o=a.interleaved,o!==null){a.interleaved=null;var d=o.next,h=a.pending;if(h!==null){var f=h.next;h.next=d,o.next=f}a.pending=o}gh=null}return e}function GX(e,n){do{var a=oi;try{if(j2(),WE.current=_S,yS){for(var o=Br.memoizedState;o!==null;){var d=o.queue;d!==null&&(d.pending=null),o=o.next}yS=!1}if(Ph=0,Oi=gi=Br=null,yy=!1,Gy=0,Y2.current=null,a===null||a.return===null){yi=1,Hy=n,oi=null;break}e:{var h=e,f=a.return,y=a,b=n;if(n=Ki,y.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var x=b,T=y,S=T.tag;if(!(T.mode&1)&&(S===0||S===11||S===15)){var N=T.alternate;N?(T.updateQueue=N.updateQueue,T.memoizedState=N.memoizedState,T.lanes=N.lanes):(T.updateQueue=null,T.memoizedState=null)}var O=FH(f);if(O!==null){O.flags&=-257,VH(O,f,y,h,n),O.mode&1&&UH(h,x,n),n=O,b=x;var A=n.updateQueue;if(A===null){var I=new Set;I.add(b),n.updateQueue=I}else A.add(b);break e}else{if(!(n&1)){UH(h,x,n),Z2();break e}b=Error(it(426))}}else if(Pr&&y.mode&1){var P=FH(f);if(P!==null){!(P.flags&65536)&&(P.flags|=256),VH(P,f,y,h,n),D2(cf(b,y));break e}}h=b=cf(b,y),yi!==4&&(yi=2),by===null?by=[h]:by.push(h),h=f;do{switch(h.tag){case 3:h.flags|=65536,n&=-n,h.lanes|=n;var L=TX(h,b,n);PH(h,L);break e;case 1:y=b;var F=h.type,V=h.stateNode;if(!(h.flags&128)&&(typeof F.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(zd===null||!zd.has(V)))){h.flags|=65536,n&=-n,h.lanes|=n;var G=CX(h,y,n);PH(h,G);break e}}h=h.return}while(h!==null)}HX(a)}catch(B){n=B,oi===a&&a!==null&&(oi=a=a.return);continue}break}while(!0)}function WX(){var e=bS.current;return bS.current=_S,e===null?_S:e}function Z2(){(yi===0||yi===3||yi===2)&&(yi=4),Pi===null||!(Dh&268435455)&&!(Ww&268435455)||Od(Pi,Ki)}function SS(e,n){var a=jn;jn|=2;var o=WX();(Pi!==e||Ki!==n)&&(hl=null,Th(e,n));do try{Rxe();break}catch(d){GX(e,d)}while(!0);if(j2(),jn=a,bS.current=o,oi!==null)throw Error(it(261));return Pi=null,Ki=0,yi}function Rxe(){for(;oi!==null;)$X(oi)}function Axe(){for(;oi!==null&&!ebe();)$X(oi)}function $X(e){var n=KX(e.alternate,e,bs);e.memoizedProps=e.pendingProps,n===null?HX(e):oi=n,Y2.current=null}function HX(e){var n=e;do{var a=n.alternate;if(e=n.return,n.flags&32768){if(a=Exe(a,n),a!==null){a.flags&=32767,oi=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{yi=6,oi=null;return}}else if(a=xxe(a,n,bs),a!==null){oi=a;return}if(n=n.sibling,n!==null){oi=n;return}oi=n=e}while(n!==null);yi===0&&(yi=5)}function lh(e,n,a){var o=Xn,d=co.transition;try{co.transition=null,Xn=1,Ixe(e,n,a,o)}finally{co.transition=d,Xn=o}return null}function Ixe(e,n,a,o){do qm();while(Md!==null);if(jn&6)throw Error(it(327));a=e.finishedWork;var d=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(it(177));e.callbackNode=null,e.callbackPriority=0;var h=a.lanes|a.childLanes;if(dbe(e,h),e===Pi&&(oi=Pi=null,Ki=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||vE||(vE=!0,YX(iS,function(){return qm(),null})),h=(a.flags&15990)!==0,a.subtreeFlags&15990||h){h=co.transition,co.transition=null;var f=Xn;Xn=1;var y=jn;jn|=4,Y2.current=null,wxe(e,a),FX(a,e),Xbe(q1),sS=!!Y1,q1=Y1=null,e.current=a,Txe(a),tbe(),jn=y,Xn=f,co.transition=h}else e.current=a;if(vE&&(vE=!1,Md=e,ES=d),h=e.pendingLanes,h===0&&(zd=null),ibe(a.stateNode),Za(e,ei()),n!==null)for(o=e.onRecoverableError,a=0;a<n.length;a++)d=n[a],o(d.value,{componentStack:d.stack,digest:d.digest});if(xS)throw xS=!1,e=fP,fP=null,e;return ES&1&&e.tag!==0&&qm(),h=e.pendingLanes,h&1?e===gP?xy++:(xy=0,gP=e):xy=0,iu(),null}function qm(){if(Md!==null){var e=Tq(ES),n=co.transition,a=Xn;try{if(co.transition=null,Xn=16>e?16:e,Md===null)var o=!1;else{if(e=Md,Md=null,ES=0,jn&6)throw Error(it(331));var d=jn;for(jn|=4,Rt=e.current;Rt!==null;){var h=Rt,f=h.child;if(Rt.flags&16){var y=h.deletions;if(y!==null){for(var b=0;b<y.length;b++){var x=y[b];for(Rt=x;Rt!==null;){var T=Rt;switch(T.tag){case 0:case 11:case 15:_y(8,T,h)}var S=T.child;if(S!==null)S.return=T,Rt=S;else for(;Rt!==null;){T=Rt;var N=T.sibling,O=T.return;if(LX(T),T===x){Rt=null;break}if(N!==null){N.return=O,Rt=N;break}Rt=O}}}var A=h.alternate;if(A!==null){var I=A.child;if(I!==null){A.child=null;do{var P=I.sibling;I.sibling=null,I=P}while(I!==null)}}Rt=h}}if(h.subtreeFlags&2064&&f!==null)f.return=h,Rt=f;else e:for(;Rt!==null;){if(h=Rt,h.flags&2048)switch(h.tag){case 0:case 11:case 15:_y(9,h,h.return)}var L=h.sibling;if(L!==null){L.return=h.return,Rt=L;break e}Rt=h.return}}var F=e.current;for(Rt=F;Rt!==null;){f=Rt;var V=f.child;if(f.subtreeFlags&2064&&V!==null)V.return=f,Rt=V;else e:for(f=F;Rt!==null;){if(y=Rt,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:Gw(9,y)}}catch(B){Kr(y,y.return,B)}if(y===f){Rt=null;break e}var G=y.sibling;if(G!==null){G.return=y.return,Rt=G;break e}Rt=y.return}}if(jn=d,iu(),Lc&&typeof Lc.onPostCommitFiberRoot=="function")try{Lc.onPostCommitFiberRoot(kw,e)}catch{}o=!0}return o}finally{Xn=a,co.transition=n}}return!1}function ZH(e,n,a){n=cf(a,n),n=TX(e,n,1),e=Hd(e,n,1),n=Na(),e!==null&&(L0(e,1,n),Za(e,n))}function Kr(e,n,a){if(e.tag===3)ZH(e,e,a);else for(;n!==null;){if(n.tag===3){ZH(n,e,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(zd===null||!zd.has(o))){e=cf(a,e),e=CX(n,e,1),n=Hd(n,e,1),e=Na(),n!==null&&(L0(n,1,e),Za(n,e));break}}n=n.return}}function Oxe(e,n,a){var o=e.pingCache;o!==null&&o.delete(n),n=Na(),e.pingedLanes|=e.suspendedLanes&a,Pi===e&&(Ki&a)===a&&(yi===4||yi===3&&(Ki&130023424)===Ki&&500>ei()-X2?Th(e,0):q2|=a),Za(e,n)}function zX(e,n){n===0&&(e.mode&1?(n=oE,oE<<=1,!(oE&130023424)&&(oE=4194304)):n=1);var a=Na();e=Al(e,n),e!==null&&(L0(e,n,a),Za(e,a))}function Pxe(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),zX(e,a)}function Dxe(e,n){var a=0;switch(e.tag){case 13:var o=e.stateNode,d=e.memoizedState;d!==null&&(a=d.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(it(314))}o!==null&&o.delete(n),zX(e,a)}var KX;KX=function(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps||Ja.current)Ka=!0;else{if(!(e.lanes&a)&&!(n.flags&128))return Ka=!1,bxe(e,n,a);Ka=!!(e.flags&131072)}else Ka=!1,Pr&&n.flags&1048576&&Jq(n,pS,n.index);switch(n.lanes=0,n.tag){case 2:var o=n.type;HE(e,n),e=n.pendingProps;var d=rf(n,ha.current);Ym(n,a),d=W2(null,n,o,e,d,a);var h=$2();return n.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Qa(o)?(h=!0,uS(n)):h=!1,n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,U2(n),d.updater=Bw,n.stateNode=d,d._reactInternals=n,iP(n,o,e,a),n=oP(null,n,o,!0,h,a)):(n.tag=0,Pr&&h&&O2(n),Sa(null,n,d,a),n=n.child),n;case 16:o=n.elementType;e:{switch(HE(e,n),e=n.pendingProps,d=o._init,o=d(o._payload),n.type=o,d=n.tag=jxe(o),e=$o(o,e),d){case 0:n=sP(null,n,o,e,a);break e;case 1:n=WH(null,n,o,e,a);break e;case 11:n=BH(null,n,o,e,a);break e;case 14:n=GH(null,n,o,$o(o.type,e),a);break e}throw Error(it(306,o,""))}return n;case 0:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:$o(o,d),sP(e,n,o,d,a);case 1:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:$o(o,d),WH(e,n,o,d,a);case 3:e:{if(IX(n),e===null)throw Error(it(387));o=n.pendingProps,h=n.memoizedState,d=h.element,rX(e,n),gS(n,o,null,a);var f=n.memoizedState;if(o=f.element,h.isDehydrated)if(h={element:o,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},n.updateQueue.baseState=h,n.memoizedState=h,n.flags&256){d=cf(Error(it(423)),n),n=$H(e,n,o,a,d);break e}else if(o!==d){d=cf(Error(it(424)),n),n=$H(e,n,o,a,d);break e}else for(ws=$d(n.stateNode.containerInfo.firstChild),Cs=n,Pr=!0,Yo=null,a=tX(n,null,o,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(af(),o===d){n=Il(e,n,a);break e}Sa(e,n,o,a)}n=n.child}return n;case 5:return iX(n),e===null&&tP(n),o=n.type,d=n.pendingProps,h=e!==null?e.memoizedProps:null,f=d.children,X1(o,d)?f=null:h!==null&&X1(o,h)&&(n.flags|=32),AX(e,n),Sa(e,n,f,a),n.child;case 6:return e===null&&tP(n),null;case 13:return OX(e,n,a);case 4:return F2(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=sf(n,null,o,a):Sa(e,n,o,a),n.child;case 11:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:$o(o,d),BH(e,n,o,d,a);case 7:return Sa(e,n,n.pendingProps,a),n.child;case 8:return Sa(e,n,n.pendingProps.children,a),n.child;case 12:return Sa(e,n,n.pendingProps.children,a),n.child;case 10:e:{if(o=n.type._context,d=n.pendingProps,h=n.memoizedProps,f=d.value,pr(mS,o._currentValue),o._currentValue=f,h!==null)if(Zo(h.value,f)){if(h.children===d.children&&!Ja.current){n=Il(e,n,a);break e}}else for(h=n.child,h!==null&&(h.return=n);h!==null;){var y=h.dependencies;if(y!==null){f=h.child;for(var b=y.firstContext;b!==null;){if(b.context===o){if(h.tag===1){b=bl(-1,a&-a),b.tag=2;var x=h.updateQueue;if(x!==null){x=x.shared;var T=x.pending;T===null?b.next=b:(b.next=T.next,T.next=b),x.pending=b}}h.lanes|=a,b=h.alternate,b!==null&&(b.lanes|=a),nP(h.return,a,n),y.lanes|=a;break}b=b.next}}else if(h.tag===10)f=h.type===n.type?null:h.child;else if(h.tag===18){if(f=h.return,f===null)throw Error(it(341));f.lanes|=a,y=f.alternate,y!==null&&(y.lanes|=a),nP(f,a,n),f=h.sibling}else f=h.child;if(f!==null)f.return=h;else for(f=h;f!==null;){if(f===n){f=null;break}if(h=f.sibling,h!==null){h.return=f.return,f=h;break}f=f.return}h=f}Sa(e,n,d.children,a),n=n.child}return n;case 9:return d=n.type,o=n.pendingProps.children,Ym(n,a),d=ho(d),o=o(d),n.flags|=1,Sa(e,n,o,a),n.child;case 14:return o=n.type,d=$o(o,n.pendingProps),d=$o(o.type,d),GH(e,n,o,d,a);case 15:return NX(e,n,n.type,n.pendingProps,a);case 17:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:$o(o,d),HE(e,n),n.tag=1,Qa(o)?(e=!0,uS(n)):e=!1,Ym(n,a),wX(n,o,d),iP(n,o,d,a),oP(null,n,o,!0,e,a);case 19:return PX(e,n,a);case 22:return RX(e,n,a)}throw Error(it(156,n.tag))};function YX(e,n){return xq(e,n)}function kxe(e,n,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ao(e,n,a,o){return new kxe(e,n,a,o)}function ek(e){return e=e.prototype,!(!e||!e.isReactComponent)}function jxe(e){if(typeof e=="function")return ek(e)?1:0;if(e!=null){if(e=e.$$typeof,e===_2)return 11;if(e===b2)return 14}return 2}function Yd(e,n){var a=e.alternate;return a===null?(a=ao(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function YE(e,n,a,o,d,h){var f=2;if(o=e,typeof e=="function")ek(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case Im:return Ch(a.children,d,h,n);case y2:f=8,d|=8;break;case R1:return e=ao(12,a,n,d|2),e.elementType=R1,e.lanes=h,e;case A1:return e=ao(13,a,n,d),e.elementType=A1,e.lanes=h,e;case I1:return e=ao(19,a,n,d),e.elementType=I1,e.lanes=h,e;case iq:return $w(a,d,h,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case nq:f=10;break e;case rq:f=9;break e;case _2:f=11;break e;case b2:f=14;break e;case Nd:f=16,o=null;break e}throw Error(it(130,e==null?e:typeof e,""))}return n=ao(f,a,n,d),n.elementType=e,n.type=o,n.lanes=h,n}function Ch(e,n,a,o){return e=ao(7,e,o,n),e.lanes=a,e}function $w(e,n,a,o){return e=ao(22,e,o,n),e.elementType=iq,e.lanes=a,e.stateNode={isHidden:!1},e}function UO(e,n,a){return e=ao(6,e,null,n),e.lanes=a,e}function FO(e,n,a){return n=ao(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Lxe(e,n,a,o,d){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_O(0),this.expirationTimes=_O(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_O(0),this.identifierPrefix=o,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function tk(e,n,a,o,d,h,f,y,b){return e=new Lxe(e,n,a,y,b),n===1?(n=1,h===!0&&(n|=8)):n=0,h=ao(3,null,null,n),e.current=h,h.stateNode=e,h.memoizedState={element:o,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},U2(h),e}function Mxe(e,n,a){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Am,key:o==null?null:""+o,children:e,containerInfo:n,implementation:a}}function qX(e){if(!e)return eu;e=e._reactInternals;e:{if(Wh(e)!==e||e.tag!==1)throw Error(it(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Qa(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(it(171))}if(e.tag===1){var a=e.type;if(Qa(a))return qq(e,a,n)}return n}function XX(e,n,a,o,d,h,f,y,b){return e=tk(a,o,!0,e,d,h,f,y,b),e.context=qX(null),a=e.current,o=Na(),d=Kd(a),h=bl(o,d),h.callback=n??null,Hd(a,h,d),e.current.lanes=d,L0(e,d,o),Za(e,o),e}function Hw(e,n,a,o){var d=n.current,h=Na(),f=Kd(d);return a=qX(a),n.context===null?n.context=a:n.pendingContext=a,n=bl(h,f),n.payload={element:e},o=o===void 0?null:o,o!==null&&(n.callback=o),e=Hd(d,n,f),e!==null&&(Qo(e,d,f,h),GE(e,d,f)),f}function wS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function e7(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function nk(e,n){e7(e,n),(e=e.alternate)&&e7(e,n)}function Uxe(){return null}var JX=typeof reportError=="function"?reportError:function(e){console.error(e)};function rk(e){this._internalRoot=e}zw.prototype.render=rk.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(it(409));Hw(e,n,null,null)};zw.prototype.unmount=rk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;kh(function(){Hw(null,e,null,null)}),n[Rl]=null}};function zw(e){this._internalRoot=e}zw.prototype.unstable_scheduleHydration=function(e){if(e){var n=Rq();e={blockedOn:null,target:e,priority:n};for(var a=0;a<Id.length&&n!==0&&n<Id[a].priority;a++);Id.splice(a,0,e),a===0&&Iq(e)}};function ik(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Kw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function t7(){}function Fxe(e,n,a,o,d){if(d){if(typeof o=="function"){var h=o;o=function(){var x=wS(f);h.call(x)}}var f=XX(n,o,e,0,null,!1,!1,"",t7);return e._reactRootContainer=f,e[Rl]=f.current,My(e.nodeType===8?e.parentNode:e),kh(),f}for(;d=e.lastChild;)e.removeChild(d);if(typeof o=="function"){var y=o;o=function(){var x=wS(b);y.call(x)}}var b=tk(e,0,!1,null,null,!1,!1,"",t7);return e._reactRootContainer=b,e[Rl]=b.current,My(e.nodeType===8?e.parentNode:e),kh(function(){Hw(n,b,a,o)}),b}function Yw(e,n,a,o,d){var h=a._reactRootContainer;if(h){var f=h;if(typeof d=="function"){var y=d;d=function(){var b=wS(f);y.call(b)}}Hw(n,f,e,d)}else f=Fxe(a,n,e,d,o);return wS(f)}Cq=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var a=cy(n.pendingLanes);a!==0&&(S2(n,a|1),Za(n,ei()),!(jn&6)&&(lf=ei()+500,iu()))}break;case 13:kh(function(){var o=Al(e,1);if(o!==null){var d=Na();Qo(o,e,1,d)}}),nk(e,1)}};w2=function(e){if(e.tag===13){var n=Al(e,134217728);if(n!==null){var a=Na();Qo(n,e,134217728,a)}nk(e,134217728)}};Nq=function(e){if(e.tag===13){var n=Kd(e),a=Al(e,n);if(a!==null){var o=Na();Qo(a,e,n,o)}nk(e,n)}};Rq=function(){return Xn};Aq=function(e,n){var a=Xn;try{return Xn=e,n()}finally{Xn=a}};V1=function(e,n,a){switch(n){case"input":if(D1(e,a),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==e&&o.form===e.form){var d=Uw(o);if(!d)throw Error(it(90));sq(o),D1(o,d)}}}break;case"textarea":cq(e,a);break;case"select":n=a.value,n!=null&&$m(e,!!a.multiple,n,!1)}};fq=J2;gq=kh;var Vxe={usingClientEntryPoint:!1,Events:[U0,km,Uw,pq,mq,J2]},Hv={findFiberByHostInstance:fh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Bxe={bundleType:Hv.bundleType,version:Hv.version,rendererPackageName:Hv.rendererPackageName,rendererConfig:Hv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vl.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=_q(e),e===null?null:e.stateNode},findFiberByHostInstance:Hv.findFiberByHostInstance||Uxe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yE.isDisabled&&yE.supportsFiber)try{kw=yE.inject(Bxe),Lc=yE}catch{}}Rs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vxe;Rs.createPortal=function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ik(n))throw Error(it(200));return Mxe(e,n,null,a)};Rs.createRoot=function(e,n){if(!ik(e))throw Error(it(299));var a=!1,o="",d=JX;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),n=tk(e,1,!1,null,null,a,!1,o,d),e[Rl]=n.current,My(e.nodeType===8?e.parentNode:e),new rk(n)};Rs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(it(188)):(e=Object.keys(e).join(","),Error(it(268,e)));return e=_q(n),e=e===null?null:e.stateNode,e};Rs.flushSync=function(e){return kh(e)};Rs.hydrate=function(e,n,a){if(!Kw(n))throw Error(it(200));return Yw(null,e,n,!0,a)};Rs.hydrateRoot=function(e,n,a){if(!ik(e))throw Error(it(405));var o=a!=null&&a.hydratedSources||null,d=!1,h="",f=JX;if(a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onRecoverableError!==void 0&&(f=a.onRecoverableError)),n=XX(n,null,e,1,a??null,d,!1,h,f),e[Rl]=n.current,My(e),o)for(e=0;e<o.length;e++)a=o[e],d=a._getVersion,d=d(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,d]:n.mutableSourceEagerHydrationData.push(a,d);return new zw(n)};Rs.render=function(e,n,a){if(!Kw(n))throw Error(it(200));return Yw(null,e,n,!1,a)};Rs.unmountComponentAtNode=function(e){if(!Kw(e))throw Error(it(40));return e._reactRootContainer?(kh(function(){Yw(null,null,e,!1,function(){e._reactRootContainer=null,e[Rl]=null})}),!0):!1};Rs.unstable_batchedUpdates=J2;Rs.unstable_renderSubtreeIntoContainer=function(e,n,a,o){if(!Kw(a))throw Error(it(200));if(e==null||e._reactInternals===void 0)throw Error(it(38));return Yw(e,n,a,!1,o)};Rs.version="18.3.1-next-f1338f8080-20240426";function QX(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(QX)}catch(e){console.error(e)}}QX(),QY.exports=Rs;var Gxe=QY.exports,n7=Gxe;C1.createRoot=n7.createRoot,C1.hydrateRoot=n7.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zy(){return zy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},zy.apply(this,arguments)}var Ud;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ud||(Ud={}));const r7="popstate";function Wxe(e){e===void 0&&(e={});function n(o,d){let{pathname:h,search:f,hash:y}=o.location;return _P("",{pathname:h,search:f,hash:y},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function a(o,d){return typeof d=="string"?d:TS(d)}return Hxe(n,a,null,e)}function ti(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function ak(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function $xe(){return Math.random().toString(36).substr(2,8)}function i7(e,n){return{usr:e.state,key:e.key,idx:n}}function _P(e,n,a,o){return a===void 0&&(a=null),zy({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?Gf(n):n,{state:a,key:n&&n.key||o||$xe()})}function TS(e){let{pathname:n="/",search:a="",hash:o=""}=e;return a&&a!=="?"&&(n+=a.charAt(0)==="?"?a:"?"+a),o&&o!=="#"&&(n+=o.charAt(0)==="#"?o:"#"+o),n}function Gf(e){let n={};if(e){let a=e.indexOf("#");a>=0&&(n.hash=e.substr(a),e=e.substr(0,a));let o=e.indexOf("?");o>=0&&(n.search=e.substr(o),e=e.substr(0,o)),e&&(n.pathname=e)}return n}function Hxe(e,n,a,o){o===void 0&&(o={});let{window:d=document.defaultView,v5Compat:h=!1}=o,f=d.history,y=Ud.Pop,b=null,x=T();x==null&&(x=0,f.replaceState(zy({},f.state,{idx:x}),""));function T(){return(f.state||{idx:null}).idx}function S(){y=Ud.Pop;let P=T(),L=P==null?null:P-x;x=P,b&&b({action:y,location:I.location,delta:L})}function N(P,L){y=Ud.Push;let F=_P(I.location,P,L);x=T()+1;let V=i7(F,x),G=I.createHref(F);try{f.pushState(V,"",G)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;d.location.assign(G)}h&&b&&b({action:y,location:I.location,delta:1})}function O(P,L){y=Ud.Replace;let F=_P(I.location,P,L);x=T();let V=i7(F,x),G=I.createHref(F);f.replaceState(V,"",G),h&&b&&b({action:y,location:I.location,delta:0})}function A(P){let L=d.location.origin!=="null"?d.location.origin:d.location.href,F=typeof P=="string"?P:TS(P);return F=F.replace(/ $/,"%20"),ti(L,"No window.location.(origin|href) available to create URL for href: "+F),new URL(F,L)}let I={get action(){return y},get location(){return e(d,f)},listen(P){if(b)throw new Error("A history only accepts one active listener");return d.addEventListener(r7,S),b=P,()=>{d.removeEventListener(r7,S),b=null}},createHref(P){return n(d,P)},createURL:A,encodeLocation(P){let L=A(P);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:N,replace:O,go(P){return f.go(P)}};return I}var a7;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(a7||(a7={}));function zxe(e,n,a){return a===void 0&&(a="/"),Kxe(e,n,a)}function Kxe(e,n,a,o){let d=typeof n=="string"?Gf(n):n,h=sk(d.pathname||"/",a);if(h==null)return null;let f=ZX(e);Yxe(f);let y=null;for(let b=0;y==null&&b<f.length;++b){let x=sEe(h);y=rEe(f[b],x)}return y}function ZX(e,n,a,o){n===void 0&&(n=[]),a===void 0&&(a=[]),o===void 0&&(o="");let d=(h,f,y)=>{let b={relativePath:y===void 0?h.path||"":y,caseSensitive:h.caseSensitive===!0,childrenIndex:f,route:h};b.relativePath.startsWith("/")&&(ti(b.relativePath.startsWith(o),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(o.length));let x=qd([o,b.relativePath]),T=a.concat(b);h.children&&h.children.length>0&&(ti(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),ZX(h.children,n,T,x)),!(h.path==null&&!h.index)&&n.push({path:x,score:tEe(x,h.index),routesMeta:T})};return e.forEach((h,f)=>{var y;if(h.path===""||!((y=h.path)!=null&&y.includes("?")))d(h,f);else for(let b of eJ(h.path))d(h,f,b)}),n}function eJ(e){let n=e.split("/");if(n.length===0)return[];let[a,...o]=n,d=a.endsWith("?"),h=a.replace(/\?$/,"");if(o.length===0)return d?[h,""]:[h];let f=eJ(o.join("/")),y=[];return y.push(...f.map(b=>b===""?h:[h,b].join("/"))),d&&y.push(...f),y.map(b=>e.startsWith("/")&&b===""?"/":b)}function Yxe(e){e.sort((n,a)=>n.score!==a.score?a.score-n.score:nEe(n.routesMeta.map(o=>o.childrenIndex),a.routesMeta.map(o=>o.childrenIndex)))}const qxe=/^:[\w-]+$/,Xxe=3,Jxe=2,Qxe=1,Zxe=10,eEe=-2,s7=e=>e==="*";function tEe(e,n){let a=e.split("/"),o=a.length;return a.some(s7)&&(o+=eEe),n&&(o+=Jxe),a.filter(d=>!s7(d)).reduce((d,h)=>d+(qxe.test(h)?Xxe:h===""?Qxe:Zxe),o)}function nEe(e,n){return e.length===n.length&&e.slice(0,-1).every((o,d)=>o===n[d])?e[e.length-1]-n[n.length-1]:0}function rEe(e,n,a){let{routesMeta:o}=e,d={},h="/",f=[];for(let y=0;y<o.length;++y){let b=o[y],x=y===o.length-1,T=h==="/"?n:n.slice(h.length)||"/",S=iEe({path:b.relativePath,caseSensitive:b.caseSensitive,end:x},T),N=b.route;if(!S)return null;Object.assign(d,S.params),f.push({params:d,pathname:qd([h,S.pathname]),pathnameBase:uEe(qd([h,S.pathnameBase])),route:N}),S.pathnameBase!=="/"&&(h=qd([h,S.pathnameBase]))}return f}function iEe(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[a,o]=aEe(e.path,e.caseSensitive,e.end),d=n.match(a);if(!d)return null;let h=d[0],f=h.replace(/(.)\/+$/,"$1"),y=d.slice(1);return{params:o.reduce((x,T,S)=>{let{paramName:N,isOptional:O}=T;if(N==="*"){let I=y[S]||"";f=h.slice(0,h.length-I.length).replace(/(.)\/+$/,"$1")}const A=y[S];return O&&!A?x[N]=void 0:x[N]=(A||"").replace(/%2F/g,"/"),x},{}),pathname:h,pathnameBase:f,pattern:e}}function aEe(e,n,a){n===void 0&&(n=!1),a===void 0&&(a=!0),ak(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,y,b)=>(o.push({paramName:y,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,n?void 0:"i"),o]}function sEe(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return ak(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function sk(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,o=e.charAt(a);return o&&o!=="/"?null:e.slice(a)||"/"}const oEe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cEe=e=>oEe.test(e);function lEe(e,n){n===void 0&&(n="/");let{pathname:a,search:o="",hash:d=""}=typeof e=="string"?Gf(e):e,h;if(a)if(cEe(a))h=a;else{if(a.includes("//")){let f=a;a=a.replace(/\/\/+/g,"/"),ak(!1,"Pathnames cannot have embedded double slashes - normalizing "+(f+" -> "+a))}a.startsWith("/")?h=o7(a.substring(1),"/"):h=o7(a,n)}else h=n;return{pathname:h,search:hEe(o),hash:pEe(d)}}function o7(e,n){let a=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?a.length>1&&a.pop():d!=="."&&a.push(d)}),a.length>1?a.join("/"):"/"}function VO(e,n,a,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function dEe(e){return e.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function ok(e,n){let a=dEe(e);return n?a.map((o,d)=>d===a.length-1?o.pathname:o.pathnameBase):a.map(o=>o.pathnameBase)}function ck(e,n,a,o){o===void 0&&(o=!1);let d;typeof e=="string"?d=Gf(e):(d=zy({},e),ti(!d.pathname||!d.pathname.includes("?"),VO("?","pathname","search",d)),ti(!d.pathname||!d.pathname.includes("#"),VO("#","pathname","hash",d)),ti(!d.search||!d.search.includes("#"),VO("#","search","hash",d)));let h=e===""||d.pathname==="",f=h?"/":d.pathname,y;if(f==null)y=a;else{let S=n.length-1;if(!o&&f.startsWith("..")){let N=f.split("/");for(;N[0]==="..";)N.shift(),S-=1;d.pathname=N.join("/")}y=S>=0?n[S]:"/"}let b=lEe(d,y),x=f&&f!=="/"&&f.endsWith("/"),T=(h||f===".")&&a.endsWith("/");return!b.pathname.endsWith("/")&&(x||T)&&(b.pathname+="/"),b}const qd=e=>e.join("/").replace(/\/\/+/g,"/"),uEe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),hEe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,pEe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function mEe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const tJ=["post","put","patch","delete"];new Set(tJ);const fEe=["get",...tJ];new Set(fEe);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ky(){return Ky=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ky.apply(this,arguments)}const lk=Y.createContext(null),gEe=Y.createContext(null),au=Y.createContext(null),qw=Y.createContext(null),Bl=Y.createContext({outlet:null,matches:[],isDataRoute:!1}),nJ=Y.createContext(null);function vEe(e,n){let{relative:a}=n===void 0?{}:n;Wf()||ti(!1);let{basename:o,navigator:d}=Y.useContext(au),{hash:h,pathname:f,search:y}=iJ(e,{relative:a}),b=f;return o!=="/"&&(b=f==="/"?o:qd([o,f])),d.createHref({pathname:b,search:y,hash:h})}function Wf(){return Y.useContext(qw)!=null}function Gl(){return Wf()||ti(!1),Y.useContext(qw).location}function rJ(e){Y.useContext(au).static||Y.useLayoutEffect(e)}function ns(){let{isDataRoute:e}=Y.useContext(Bl);return e?IEe():yEe()}function yEe(){Wf()||ti(!1);let e=Y.useContext(lk),{basename:n,future:a,navigator:o}=Y.useContext(au),{matches:d}=Y.useContext(Bl),{pathname:h}=Gl(),f=JSON.stringify(ok(d,a.v7_relativeSplatPath)),y=Y.useRef(!1);return rJ(()=>{y.current=!0}),Y.useCallback(function(x,T){if(T===void 0&&(T={}),!y.current)return;if(typeof x=="number"){o.go(x);return}let S=ck(x,JSON.parse(f),h,T.relative==="path");e==null&&n!=="/"&&(S.pathname=S.pathname==="/"?n:qd([n,S.pathname])),(T.replace?o.replace:o.push)(S,T.state,T)},[n,o,f,h,e])}function V0(){let{matches:e}=Y.useContext(Bl),n=e[e.length-1];return n?n.params:{}}function iJ(e,n){let{relative:a}=n===void 0?{}:n,{future:o}=Y.useContext(au),{matches:d}=Y.useContext(Bl),{pathname:h}=Gl(),f=JSON.stringify(ok(d,o.v7_relativeSplatPath));return Y.useMemo(()=>ck(e,JSON.parse(f),h,a==="path"),[e,f,h,a])}function _Ee(e,n){return bEe(e,n)}function bEe(e,n,a,o){Wf()||ti(!1);let{navigator:d}=Y.useContext(au),{matches:h}=Y.useContext(Bl),f=h[h.length-1],y=f?f.params:{};f&&f.pathname;let b=f?f.pathnameBase:"/";f&&f.route;let x=Gl(),T;if(n){var S;let P=typeof n=="string"?Gf(n):n;b==="/"||(S=P.pathname)!=null&&S.startsWith(b)||ti(!1),T=P}else T=x;let N=T.pathname||"/",O=N;if(b!=="/"){let P=b.replace(/^\//,"").split("/");O="/"+N.replace(/^\//,"").split("/").slice(P.length).join("/")}let A=zxe(e,{pathname:O}),I=TEe(A&&A.map(P=>Object.assign({},P,{params:Object.assign({},y,P.params),pathname:qd([b,d.encodeLocation?d.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?b:qd([b,d.encodeLocation?d.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),h,a,o);return n&&I?Y.createElement(qw.Provider,{value:{location:Ky({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:Ud.Pop}},I):I}function xEe(){let e=AEe(),n=mEe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},n),a?Y.createElement("pre",{style:d},a):null,null)}const EEe=Y.createElement(xEe,null);class SEe extends Y.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,a){return a.location!==n.location||a.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:a.error,location:a.location,revalidation:n.revalidation||a.revalidation}}componentDidCatch(n,a){console.error("React Router caught the following error during render",n,a)}render(){return this.state.error!==void 0?Y.createElement(Bl.Provider,{value:this.props.routeContext},Y.createElement(nJ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function wEe(e){let{routeContext:n,match:a,children:o}=e,d=Y.useContext(lk);return d&&d.static&&d.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=a.route.id),Y.createElement(Bl.Provider,{value:n},o)}function TEe(e,n,a,o){var d;if(n===void 0&&(n=[]),a===void 0&&(a=null),o===void 0&&(o=null),e==null){var h;if(!a)return null;if(a.errors)e=a.matches;else if((h=o)!=null&&h.v7_partialHydration&&n.length===0&&!a.initialized&&a.matches.length>0)e=a.matches;else return null}let f=e,y=(d=a)==null?void 0:d.errors;if(y!=null){let T=f.findIndex(S=>S.route.id&&(y==null?void 0:y[S.route.id])!==void 0);T>=0||ti(!1),f=f.slice(0,Math.min(f.length,T+1))}let b=!1,x=-1;if(a&&o&&o.v7_partialHydration)for(let T=0;T<f.length;T++){let S=f[T];if((S.route.HydrateFallback||S.route.hydrateFallbackElement)&&(x=T),S.route.id){let{loaderData:N,errors:O}=a,A=S.route.loader&&N[S.route.id]===void 0&&(!O||O[S.route.id]===void 0);if(S.route.lazy||A){b=!0,x>=0?f=f.slice(0,x+1):f=[f[0]];break}}}return f.reduceRight((T,S,N)=>{let O,A=!1,I=null,P=null;a&&(O=y&&S.route.id?y[S.route.id]:void 0,I=S.route.errorElement||EEe,b&&(x<0&&N===0?(OEe("route-fallback"),A=!0,P=null):x===N&&(A=!0,P=S.route.hydrateFallbackElement||null)));let L=n.concat(f.slice(0,N+1)),F=()=>{let V;return O?V=I:A?V=P:S.route.Component?V=Y.createElement(S.route.Component,null):S.route.element?V=S.route.element:V=T,Y.createElement(wEe,{match:S,routeContext:{outlet:T,matches:L,isDataRoute:a!=null},children:V})};return a&&(S.route.ErrorBoundary||S.route.errorElement||N===0)?Y.createElement(SEe,{location:a.location,revalidation:a.revalidation,component:I,error:O,children:F(),routeContext:{outlet:null,matches:L,isDataRoute:!0}}):F()},null)}var aJ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(aJ||{}),sJ=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(sJ||{});function CEe(e){let n=Y.useContext(lk);return n||ti(!1),n}function NEe(e){let n=Y.useContext(gEe);return n||ti(!1),n}function REe(e){let n=Y.useContext(Bl);return n||ti(!1),n}function oJ(e){let n=REe(),a=n.matches[n.matches.length-1];return a.route.id||ti(!1),a.route.id}function AEe(){var e;let n=Y.useContext(nJ),a=NEe(),o=oJ();return n!==void 0?n:(e=a.errors)==null?void 0:e[o]}function IEe(){let{router:e}=CEe(aJ.UseNavigateStable),n=oJ(sJ.UseNavigateStable),a=Y.useRef(!1);return rJ(()=>{a.current=!0}),Y.useCallback(function(d,h){h===void 0&&(h={}),a.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,Ky({fromRouteId:n},h)))},[e,n])}const c7={};function OEe(e,n,a){c7[e]||(c7[e]=!0)}function PEe(e,n){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Es(e){let{to:n,replace:a,state:o,relative:d}=e;Wf()||ti(!1);let{future:h,static:f}=Y.useContext(au),{matches:y}=Y.useContext(Bl),{pathname:b}=Gl(),x=ns(),T=ck(n,ok(y,h.v7_relativeSplatPath),b,d==="path"),S=JSON.stringify(T);return Y.useEffect(()=>x(JSON.parse(S),{replace:a,state:o,relative:d}),[x,S,d,a,o]),null}function rr(e){ti(!1)}function DEe(e){let{basename:n="/",children:a=null,location:o,navigationType:d=Ud.Pop,navigator:h,static:f=!1,future:y}=e;Wf()&&ti(!1);let b=n.replace(/^\/*/,"/"),x=Y.useMemo(()=>({basename:b,navigator:h,static:f,future:Ky({v7_relativeSplatPath:!1},y)}),[b,y,h,f]);typeof o=="string"&&(o=Gf(o));let{pathname:T="/",search:S="",hash:N="",state:O=null,key:A="default"}=o,I=Y.useMemo(()=>{let P=sk(T,b);return P==null?null:{location:{pathname:P,search:S,hash:N,state:O,key:A},navigationType:d}},[b,T,S,N,O,A,d]);return I==null?null:Y.createElement(au.Provider,{value:x},Y.createElement(qw.Provider,{children:a,value:I}))}function kEe(e){let{children:n,location:a}=e;return _Ee(bP(n),a)}new Promise(()=>{});function bP(e,n){n===void 0&&(n=[]);let a=[];return Y.Children.forEach(e,(o,d)=>{if(!Y.isValidElement(o))return;let h=[...n,d];if(o.type===Y.Fragment){a.push.apply(a,bP(o.props.children,h));return}o.type!==rr&&ti(!1),!o.props.index||!o.props.children||ti(!1);let f={id:o.props.id||h.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(f.children=bP(o.props.children,h)),a.push(f)}),a}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xP(){return xP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},xP.apply(this,arguments)}function jEe(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,h;for(h=0;h<o.length;h++)d=o[h],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function LEe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function MEe(e,n){return e.button===0&&(!n||n==="_self")&&!LEe(e)}function EP(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,a)=>{let o=e[a];return n.concat(Array.isArray(o)?o.map(d=>[a,d]):[[a,o]])},[]))}function UEe(e,n){let a=EP(e);return n&&n.forEach((o,d)=>{a.has(d)||n.getAll(d).forEach(h=>{a.append(d,h)})}),a}const FEe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],VEe="6";try{window.__reactRouterVersion=VEe}catch{}const BEe="startTransition",l7=O_e[BEe];function GEe(e){let{basename:n,children:a,future:o,window:d}=e,h=Y.useRef();h.current==null&&(h.current=Wxe({window:d,v5Compat:!0}));let f=h.current,[y,b]=Y.useState({action:f.action,location:f.location}),{v7_startTransition:x}=o||{},T=Y.useCallback(S=>{x&&l7?l7(()=>b(S)):b(S)},[b,x]);return Y.useLayoutEffect(()=>f.listen(T),[f,T]),Y.useEffect(()=>PEe(o),[o]),Y.createElement(DEe,{basename:n,children:a,location:y.location,navigationType:y.action,navigator:f,future:o})}const WEe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$Ee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ut=Y.forwardRef(function(n,a){let{onClick:o,relative:d,reloadDocument:h,replace:f,state:y,target:b,to:x,preventScrollReset:T,viewTransition:S}=n,N=jEe(n,FEe),{basename:O}=Y.useContext(au),A,I=!1;if(typeof x=="string"&&$Ee.test(x)&&(A=x,WEe))try{let V=new URL(window.location.href),G=x.startsWith("//")?new URL(V.protocol+x):new URL(x),B=sk(G.pathname,O);G.origin===V.origin&&B!=null?x=B+G.search+G.hash:I=!0}catch{}let P=vEe(x,{relative:d}),L=HEe(x,{replace:f,state:y,target:b,preventScrollReset:T,relative:d,viewTransition:S});function F(V){o&&o(V),V.defaultPrevented||L(V)}return Y.createElement("a",xP({},N,{href:A||P,onClick:I||h?o:F,ref:a,target:b}))});var d7;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(d7||(d7={}));var u7;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(u7||(u7={}));function HEe(e,n){let{target:a,replace:o,state:d,preventScrollReset:h,relative:f,viewTransition:y}=n===void 0?{}:n,b=ns(),x=Gl(),T=iJ(e,{relative:f});return Y.useCallback(S=>{if(MEe(S,a)){S.preventDefault();let N=o!==void 0?o:TS(x)===TS(T);b(e,{replace:N,state:d,preventScrollReset:h,relative:f,viewTransition:y})}},[x,b,T,o,d,a,e,h,f,y])}function cJ(e){let n=Y.useRef(EP(e)),a=Y.useRef(!1),o=Gl(),d=Y.useMemo(()=>UEe(o.search,a.current?null:n.current),[o.search]),h=ns(),f=Y.useCallback((y,b)=>{const x=EP(typeof y=="function"?y(d):y);a.current=!0,h("?"+x,b)},[h,d]);return[d,f]}let zEe={data:""},KEe=e=>{if(typeof window=="object"){let n=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return n.nonce=window.__nonce__,n.parentNode||(e||document.head).appendChild(n),n.firstChild}return e||zEe},YEe=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,qEe=/\/\*[^]*?\*\/|  +/g,h7=/\n+/g,Pd=(e,n)=>{let a="",o="",d="";for(let h in e){let f=e[h];h[0]=="@"?h[1]=="i"?a=h+" "+f+";":o+=h[1]=="f"?Pd(f,h):h+"{"+Pd(f,h[1]=="k"?"":n)+"}":typeof f=="object"?o+=Pd(f,n?n.replace(/([^,])+/g,y=>h.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,y):y?y+" "+b:b)):h):f!=null&&(h=/^--/.test(h)?h:h.replace(/[A-Z]/g,"-$&").toLowerCase(),d+=Pd.p?Pd.p(h,f):h+":"+f+";")}return a+(n&&d?n+"{"+d+"}":d)+o},ll={},lJ=e=>{if(typeof e=="object"){let n="";for(let a in e)n+=a+lJ(e[a]);return n}return e},XEe=(e,n,a,o,d)=>{let h=lJ(e),f=ll[h]||(ll[h]=(b=>{let x=0,T=11;for(;x<b.length;)T=101*T+b.charCodeAt(x++)>>>0;return"go"+T})(h));if(!ll[f]){let b=h!==e?e:(x=>{let T,S,N=[{}];for(;T=YEe.exec(x.replace(qEe,""));)T[4]?N.shift():T[3]?(S=T[3].replace(h7," ").trim(),N.unshift(N[0][S]=N[0][S]||{})):N[0][T[1]]=T[2].replace(h7," ").trim();return N[0]})(e);ll[f]=Pd(d?{["@keyframes "+f]:b}:b,a?"":"."+f)}let y=a&&ll.g?ll.g:null;return a&&(ll.g=ll[f]),((b,x,T,S)=>{S?x.data=x.data.replace(S,b):x.data.indexOf(b)===-1&&(x.data=T?b+x.data:x.data+b)})(ll[f],n,o,y),f},JEe=(e,n,a)=>e.reduce((o,d,h)=>{let f=n[h];if(f&&f.call){let y=f(a),b=y&&y.props&&y.props.className||/^go/.test(y)&&y;f=b?"."+b:y&&typeof y=="object"?y.props?"":Pd(y,""):y===!1?"":y}return o+d+(f??"")},"");function Xw(e){let n=this||{},a=e.call?e(n.p):e;return XEe(a.unshift?a.raw?JEe(a,[].slice.call(arguments,1),n.p):a.reduce((o,d)=>Object.assign(o,d&&d.call?d(n.p):d),{}):a,KEe(n.target),n.g,n.o,n.k)}let dJ,SP,wP;Xw.bind({g:1});let Ol=Xw.bind({k:1});function QEe(e,n,a,o){Pd.p=n,dJ=e,SP=a,wP=o}function su(e,n){let a=this||{};return function(){let o=arguments;function d(h,f){let y=Object.assign({},h),b=y.className||d.className;a.p=Object.assign({theme:SP&&SP()},y),a.o=/ *go\d+/.test(b),y.className=Xw.apply(a,o)+(b?" "+b:"");let x=e;return e[0]&&(x=y.as||e,delete y.as),wP&&x[0]&&wP(y),dJ(x,y)}return d}}var ZEe=e=>typeof e=="function",CS=(e,n)=>ZEe(e)?e(n):e,eSe=(()=>{let e=0;return()=>(++e).toString()})(),uJ=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");e=!n||n.matches}return e}})(),tSe=20,dk="default",hJ=(e,n)=>{let{toastLimit:a}=e.settings;switch(n.type){case 0:return{...e,toasts:[n.toast,...e.toasts].slice(0,a)};case 1:return{...e,toasts:e.toasts.map(f=>f.id===n.toast.id?{...f,...n.toast}:f)};case 2:let{toast:o}=n;return hJ(e,{type:e.toasts.find(f=>f.id===o.id)?1:0,toast:o});case 3:let{toastId:d}=n;return{...e,toasts:e.toasts.map(f=>f.id===d||d===void 0?{...f,dismissed:!0,visible:!1}:f)};case 4:return n.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(f=>f.id!==n.toastId)};case 5:return{...e,pausedAt:n.time};case 6:let h=n.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(f=>({...f,pauseDuration:f.pauseDuration+h}))}}},qE=[],pJ={toasts:[],pausedAt:void 0,settings:{toastLimit:tSe}},Dc={},mJ=(e,n=dk)=>{Dc[n]=hJ(Dc[n]||pJ,e),qE.forEach(([a,o])=>{a===n&&o(Dc[n])})},fJ=e=>Object.keys(Dc).forEach(n=>mJ(e,n)),nSe=e=>Object.keys(Dc).find(n=>Dc[n].toasts.some(a=>a.id===e)),Jw=(e=dk)=>n=>{mJ(n,e)},rSe={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},iSe=(e={},n=dk)=>{let[a,o]=Y.useState(Dc[n]||pJ),d=Y.useRef(Dc[n]);Y.useEffect(()=>(d.current!==Dc[n]&&o(Dc[n]),qE.push([n,o]),()=>{let f=qE.findIndex(([y])=>y===n);f>-1&&qE.splice(f,1)}),[n]);let h=a.toasts.map(f=>{var y,b,x;return{...e,...e[f.type],...f,removeDelay:f.removeDelay||((y=e[f.type])==null?void 0:y.removeDelay)||(e==null?void 0:e.removeDelay),duration:f.duration||((b=e[f.type])==null?void 0:b.duration)||(e==null?void 0:e.duration)||rSe[f.type],style:{...e.style,...(x=e[f.type])==null?void 0:x.style,...f.style}}});return{...a,toasts:h}},aSe=(e,n="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...a,id:(a==null?void 0:a.id)||eSe()}),B0=e=>(n,a)=>{let o=aSe(n,e,a);return Jw(o.toasterId||nSe(o.id))({type:2,toast:o}),o.id},vi=(e,n)=>B0("blank")(e,n);vi.error=B0("error");vi.success=B0("success");vi.loading=B0("loading");vi.custom=B0("custom");vi.dismiss=(e,n)=>{let a={type:3,toastId:e};n?Jw(n)(a):fJ(a)};vi.dismissAll=e=>vi.dismiss(void 0,e);vi.remove=(e,n)=>{let a={type:4,toastId:e};n?Jw(n)(a):fJ(a)};vi.removeAll=e=>vi.remove(void 0,e);vi.promise=(e,n,a)=>{let o=vi.loading(n.loading,{...a,...a==null?void 0:a.loading});return typeof e=="function"&&(e=e()),e.then(d=>{let h=n.success?CS(n.success,d):void 0;return h?vi.success(h,{id:o,...a,...a==null?void 0:a.success}):vi.dismiss(o),d}).catch(d=>{let h=n.error?CS(n.error,d):void 0;h?vi.error(h,{id:o,...a,...a==null?void 0:a.error}):vi.dismiss(o)}),e};var sSe=1e3,oSe=(e,n="default")=>{let{toasts:a,pausedAt:o}=iSe(e,n),d=Y.useRef(new Map).current,h=Y.useCallback((S,N=sSe)=>{if(d.has(S))return;let O=setTimeout(()=>{d.delete(S),f({type:4,toastId:S})},N);d.set(S,O)},[]);Y.useEffect(()=>{if(o)return;let S=Date.now(),N=a.map(O=>{if(O.duration===1/0)return;let A=(O.duration||0)+O.pauseDuration-(S-O.createdAt);if(A<0){O.visible&&vi.dismiss(O.id);return}return setTimeout(()=>vi.dismiss(O.id,n),A)});return()=>{N.forEach(O=>O&&clearTimeout(O))}},[a,o,n]);let f=Y.useCallback(Jw(n),[n]),y=Y.useCallback(()=>{f({type:5,time:Date.now()})},[f]),b=Y.useCallback((S,N)=>{f({type:1,toast:{id:S,height:N}})},[f]),x=Y.useCallback(()=>{o&&f({type:6,time:Date.now()})},[o,f]),T=Y.useCallback((S,N)=>{let{reverseOrder:O=!1,gutter:A=8,defaultPosition:I}=N||{},P=a.filter(V=>(V.position||I)===(S.position||I)&&V.height),L=P.findIndex(V=>V.id===S.id),F=P.filter((V,G)=>G<L&&V.visible).length;return P.filter(V=>V.visible).slice(...O?[F+1]:[0,F]).reduce((V,G)=>V+(G.height||0)+A,0)},[a]);return Y.useEffect(()=>{a.forEach(S=>{if(S.dismissed)h(S.id,S.removeDelay);else{let N=d.get(S.id);N&&(clearTimeout(N),d.delete(S.id))}})},[a,h]),{toasts:a,handlers:{updateHeight:b,startPause:y,endPause:x,calculateOffset:T}}},cSe=Ol`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,lSe=Ol`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,dSe=Ol`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,uSe=su("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${cSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${lSe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${dSe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,hSe=Ol`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,pSe=su("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${hSe} 1s linear infinite;
`,mSe=Ol`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,fSe=Ol`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,gSe=su("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${mSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${fSe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,vSe=su("div")`
  position: absolute;
`,ySe=su("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,_Se=Ol`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,bSe=su("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${_Se} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,xSe=({toast:e})=>{let{icon:n,type:a,iconTheme:o}=e;return n!==void 0?typeof n=="string"?Y.createElement(bSe,null,n):n:a==="blank"?null:Y.createElement(ySe,null,Y.createElement(pSe,{...o}),a!=="loading"&&Y.createElement(vSe,null,a==="error"?Y.createElement(uSe,{...o}):Y.createElement(gSe,{...o})))},ESe=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,SSe=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,wSe="0%{opacity:0;} 100%{opacity:1;}",TSe="0%{opacity:1;} 100%{opacity:0;}",CSe=su("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,NSe=su("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,RSe=(e,n)=>{let a=e.includes("top")?1:-1,[o,d]=uJ()?[wSe,TSe]:[ESe(a),SSe(a)];return{animation:n?`${Ol(o)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ol(d)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},ASe=Y.memo(({toast:e,position:n,style:a,children:o})=>{let d=e.height?RSe(e.position||n||"top-center",e.visible):{opacity:0},h=Y.createElement(xSe,{toast:e}),f=Y.createElement(NSe,{...e.ariaProps},CS(e.message,e));return Y.createElement(CSe,{className:e.className,style:{...d,...a,...e.style}},typeof o=="function"?o({icon:h,message:f}):Y.createElement(Y.Fragment,null,h,f))});QEe(Y.createElement);var ISe=({id:e,className:n,style:a,onHeightUpdate:o,children:d})=>{let h=Y.useCallback(f=>{if(f){let y=()=>{let b=f.getBoundingClientRect().height;o(e,b)};y(),new MutationObserver(y).observe(f,{subtree:!0,childList:!0,characterData:!0})}},[e,o]);return Y.createElement("div",{ref:h,className:n,style:a},d)},OSe=(e,n)=>{let a=e.includes("top"),o=a?{top:0}:{bottom:0},d=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:uJ()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${n*(a?1:-1)}px)`,...o,...d}},PSe=Xw`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,_E=16,DSe=({reverseOrder:e,position:n="top-center",toastOptions:a,gutter:o,children:d,toasterId:h,containerStyle:f,containerClassName:y})=>{let{toasts:b,handlers:x}=oSe(a,h);return Y.createElement("div",{"data-rht-toaster":h||"",style:{position:"fixed",zIndex:9999,top:_E,left:_E,right:_E,bottom:_E,pointerEvents:"none",...f},className:y,onMouseEnter:x.startPause,onMouseLeave:x.endPause},b.map(T=>{let S=T.position||n,N=x.calculateOffset(T,{reverseOrder:e,gutter:o,defaultPosition:n}),O=OSe(S,N);return Y.createElement(ISe,{id:T.id,key:T.id,onHeightUpdate:x.updateHeight,className:T.visible?PSe:"",style:O},T.type==="custom"?CS(T.message,T):d?d(T):Y.createElement(ASe,{toast:T,position:S}))}))},et=vi;function gJ(e,n){return function(){return e.apply(n,arguments)}}const{toString:kSe}=Object.prototype,{getPrototypeOf:uk}=Object,{iterator:Qw,toStringTag:vJ}=Symbol,Zw=(e=>n=>{const a=kSe.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),tc=e=>(e=e.toLowerCase(),n=>Zw(n)===e),eT=e=>n=>typeof n===e,{isArray:$f}=Array,df=eT("undefined");function G0(e){return e!==null&&!df(e)&&e.constructor!==null&&!df(e.constructor)&&es(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const yJ=tc("ArrayBuffer");function jSe(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&yJ(e.buffer),n}const LSe=eT("string"),es=eT("function"),_J=eT("number"),W0=e=>e!==null&&typeof e=="object",MSe=e=>e===!0||e===!1,XE=e=>{if(Zw(e)!=="object")return!1;const n=uk(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(vJ in e)&&!(Qw in e)},USe=e=>{if(!W0(e)||G0(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},FSe=tc("Date"),VSe=tc("File"),BSe=tc("Blob"),GSe=tc("FileList"),WSe=e=>W0(e)&&es(e.pipe),$Se=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||es(e.append)&&((n=Zw(e))==="formdata"||n==="object"&&es(e.toString)&&e.toString()==="[object FormData]"))},HSe=tc("URLSearchParams"),[zSe,KSe,YSe,qSe]=["ReadableStream","Request","Response","Headers"].map(tc),XSe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function $0(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let o,d;if(typeof e!="object"&&(e=[e]),$f(e))for(o=0,d=e.length;o<d;o++)n.call(null,e[o],o,e);else{if(G0(e))return;const h=a?Object.getOwnPropertyNames(e):Object.keys(e),f=h.length;let y;for(o=0;o<f;o++)y=h[o],n.call(null,e[y],y,e)}}function bJ(e,n){if(G0(e))return null;n=n.toLowerCase();const a=Object.keys(e);let o=a.length,d;for(;o-- >0;)if(d=a[o],n===d.toLowerCase())return d;return null}const yh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xJ=e=>!df(e)&&e!==yh;function TP(){const{caseless:e,skipUndefined:n}=xJ(this)&&this||{},a={},o=(d,h)=>{const f=e&&bJ(a,h)||h;XE(a[f])&&XE(d)?a[f]=TP(a[f],d):XE(d)?a[f]=TP({},d):$f(d)?a[f]=d.slice():(!n||!df(d))&&(a[f]=d)};for(let d=0,h=arguments.length;d<h;d++)arguments[d]&&$0(arguments[d],o);return a}const JSe=(e,n,a,{allOwnKeys:o}={})=>($0(n,(d,h)=>{a&&es(d)?e[h]=gJ(d,a):e[h]=d},{allOwnKeys:o}),e),QSe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),ZSe=(e,n,a,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},ewe=(e,n,a,o)=>{let d,h,f;const y={};if(n=n||{},e==null)return n;do{for(d=Object.getOwnPropertyNames(e),h=d.length;h-- >0;)f=d[h],(!o||o(f,e,n))&&!y[f]&&(n[f]=e[f],y[f]=!0);e=a!==!1&&uk(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},twe=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const o=e.indexOf(n,a);return o!==-1&&o===a},nwe=e=>{if(!e)return null;if($f(e))return e;let n=e.length;if(!_J(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},rwe=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&uk(Uint8Array)),iwe=(e,n)=>{const o=(e&&e[Qw]).call(e);let d;for(;(d=o.next())&&!d.done;){const h=d.value;n.call(e,h[0],h[1])}},awe=(e,n)=>{let a;const o=[];for(;(a=e.exec(n))!==null;)o.push(a);return o},swe=tc("HTMLFormElement"),owe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,o,d){return o.toUpperCase()+d}),p7=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),cwe=tc("RegExp"),EJ=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),o={};$0(a,(d,h)=>{let f;(f=n(d,h,e))!==!1&&(o[h]=f||d)}),Object.defineProperties(e,o)},lwe=e=>{EJ(e,(n,a)=>{if(es(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const o=e[a];if(es(o)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},dwe=(e,n)=>{const a={},o=d=>{d.forEach(h=>{a[h]=!0})};return $f(e)?o(e):o(String(e).split(n)),a},uwe=()=>{},hwe=(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n;function pwe(e){return!!(e&&es(e.append)&&e[vJ]==="FormData"&&e[Qw])}const mwe=e=>{const n=new Array(10),a=(o,d)=>{if(W0(o)){if(n.indexOf(o)>=0)return;if(G0(o))return o;if(!("toJSON"in o)){n[d]=o;const h=$f(o)?[]:{};return $0(o,(f,y)=>{const b=a(f,d+1);!df(b)&&(h[y]=b)}),n[d]=void 0,h}}return o};return a(e,0)},fwe=tc("AsyncFunction"),gwe=e=>e&&(W0(e)||es(e))&&es(e.then)&&es(e.catch),SJ=((e,n)=>e?setImmediate:n?((a,o)=>(yh.addEventListener("message",({source:d,data:h})=>{d===yh&&h===a&&o.length&&o.shift()()},!1),d=>{o.push(d),yh.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",es(yh.postMessage)),vwe=typeof queueMicrotask<"u"?queueMicrotask.bind(yh):typeof process<"u"&&process.nextTick||SJ,ywe=e=>e!=null&&es(e[Qw]),Me={isArray:$f,isArrayBuffer:yJ,isBuffer:G0,isFormData:$Se,isArrayBufferView:jSe,isString:LSe,isNumber:_J,isBoolean:MSe,isObject:W0,isPlainObject:XE,isEmptyObject:USe,isReadableStream:zSe,isRequest:KSe,isResponse:YSe,isHeaders:qSe,isUndefined:df,isDate:FSe,isFile:VSe,isBlob:BSe,isRegExp:cwe,isFunction:es,isStream:WSe,isURLSearchParams:HSe,isTypedArray:rwe,isFileList:GSe,forEach:$0,merge:TP,extend:JSe,trim:XSe,stripBOM:QSe,inherits:ZSe,toFlatObject:ewe,kindOf:Zw,kindOfTest:tc,endsWith:twe,toArray:nwe,forEachEntry:iwe,matchAll:awe,isHTMLForm:swe,hasOwnProperty:p7,hasOwnProp:p7,reduceDescriptors:EJ,freezeMethods:lwe,toObjectSet:dwe,toCamelCase:owe,noop:uwe,toFiniteNumber:hwe,findKey:bJ,global:yh,isContextDefined:xJ,isSpecCompliantForm:pwe,toJSONObject:mwe,isAsyncFn:fwe,isThenable:gwe,setImmediate:SJ,asap:vwe,isIterable:ywe};function hn(e,n,a,o,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),o&&(this.request=o),d&&(this.response=d,this.status=d.status?d.status:null)}Me.inherits(hn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Me.toJSONObject(this.config),code:this.code,status:this.status}}});const wJ=hn.prototype,TJ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{TJ[e]={value:e}});Object.defineProperties(hn,TJ);Object.defineProperty(wJ,"isAxiosError",{value:!0});hn.from=(e,n,a,o,d,h)=>{const f=Object.create(wJ);Me.toFlatObject(e,f,function(T){return T!==Error.prototype},x=>x!=="isAxiosError");const y=e&&e.message?e.message:"Error",b=n==null&&e?e.code:n;return hn.call(f,y,b,a,o,d),e&&f.cause==null&&Object.defineProperty(f,"cause",{value:e,configurable:!0}),f.name=e&&e.name||"Error",h&&Object.assign(f,h),f};const _we=null;function CP(e){return Me.isPlainObject(e)||Me.isArray(e)}function CJ(e){return Me.endsWith(e,"[]")?e.slice(0,-2):e}function m7(e,n,a){return e?e.concat(n).map(function(d,h){return d=CJ(d),!a&&h?"["+d+"]":d}).join(a?".":""):n}function bwe(e){return Me.isArray(e)&&!e.some(CP)}const xwe=Me.toFlatObject(Me,{},null,function(n){return/^is[A-Z]/.test(n)});function tT(e,n,a){if(!Me.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=Me.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,P){return!Me.isUndefined(P[I])});const o=a.metaTokens,d=a.visitor||T,h=a.dots,f=a.indexes,b=(a.Blob||typeof Blob<"u"&&Blob)&&Me.isSpecCompliantForm(n);if(!Me.isFunction(d))throw new TypeError("visitor must be a function");function x(A){if(A===null)return"";if(Me.isDate(A))return A.toISOString();if(Me.isBoolean(A))return A.toString();if(!b&&Me.isBlob(A))throw new hn("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(A)||Me.isTypedArray(A)?b&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function T(A,I,P){let L=A;if(A&&!P&&typeof A=="object"){if(Me.endsWith(I,"{}"))I=o?I:I.slice(0,-2),A=JSON.stringify(A);else if(Me.isArray(A)&&bwe(A)||(Me.isFileList(A)||Me.endsWith(I,"[]"))&&(L=Me.toArray(A)))return I=CJ(I),L.forEach(function(V,G){!(Me.isUndefined(V)||V===null)&&n.append(f===!0?m7([I],G,h):f===null?I:I+"[]",x(V))}),!1}return CP(A)?!0:(n.append(m7(P,I,h),x(A)),!1)}const S=[],N=Object.assign(xwe,{defaultVisitor:T,convertValue:x,isVisitable:CP});function O(A,I){if(!Me.isUndefined(A)){if(S.indexOf(A)!==-1)throw Error("Circular reference detected in "+I.join("."));S.push(A),Me.forEach(A,function(L,F){(!(Me.isUndefined(L)||L===null)&&d.call(n,L,Me.isString(F)?F.trim():F,I,N))===!0&&O(L,I?I.concat(F):[F])}),S.pop()}}if(!Me.isObject(e))throw new TypeError("data must be an object");return O(e),n}function f7(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return n[o]})}function hk(e,n){this._pairs=[],e&&tT(e,this,n)}const NJ=hk.prototype;NJ.append=function(n,a){this._pairs.push([n,a])};NJ.toString=function(n){const a=n?function(o){return n.call(this,o,f7)}:f7;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function Ewe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function RJ(e,n,a){if(!n)return e;const o=a&&a.encode||Ewe;Me.isFunction(a)&&(a={serialize:a});const d=a&&a.serialize;let h;if(d?h=d(n,a):h=Me.isURLSearchParams(n)?n.toString():new hk(n,a).toString(o),h){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+h}return e}class g7{constructor(){this.handlers=[]}use(n,a,o){return this.handlers.push({fulfilled:n,rejected:a,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Me.forEach(this.handlers,function(o){o!==null&&n(o)})}}const AJ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Swe=typeof URLSearchParams<"u"?URLSearchParams:hk,wwe=typeof FormData<"u"?FormData:null,Twe=typeof Blob<"u"?Blob:null,Cwe={isBrowser:!0,classes:{URLSearchParams:Swe,FormData:wwe,Blob:Twe},protocols:["http","https","file","blob","url","data"]},pk=typeof window<"u"&&typeof document<"u",NP=typeof navigator=="object"&&navigator||void 0,Nwe=pk&&(!NP||["ReactNative","NativeScript","NS"].indexOf(NP.product)<0),Rwe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Awe=pk&&window.location.href||"http://localhost",Iwe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:pk,hasStandardBrowserEnv:Nwe,hasStandardBrowserWebWorkerEnv:Rwe,navigator:NP,origin:Awe},Symbol.toStringTag,{value:"Module"})),da={...Iwe,...Cwe};function Owe(e,n){return tT(e,new da.classes.URLSearchParams,{visitor:function(a,o,d,h){return da.isNode&&Me.isBuffer(a)?(this.append(o,a.toString("base64")),!1):h.defaultVisitor.apply(this,arguments)},...n})}function Pwe(e){return Me.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function Dwe(e){const n={},a=Object.keys(e);let o;const d=a.length;let h;for(o=0;o<d;o++)h=a[o],n[h]=e[h];return n}function IJ(e){function n(a,o,d,h){let f=a[h++];if(f==="__proto__")return!0;const y=Number.isFinite(+f),b=h>=a.length;return f=!f&&Me.isArray(d)?d.length:f,b?(Me.hasOwnProp(d,f)?d[f]=[d[f],o]:d[f]=o,!y):((!d[f]||!Me.isObject(d[f]))&&(d[f]=[]),n(a,o,d[f],h)&&Me.isArray(d[f])&&(d[f]=Dwe(d[f])),!y)}if(Me.isFormData(e)&&Me.isFunction(e.entries)){const a={};return Me.forEachEntry(e,(o,d)=>{n(Pwe(o),d,a,0)}),a}return null}function kwe(e,n,a){if(Me.isString(e))try{return(n||JSON.parse)(e),Me.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(a||JSON.stringify)(e)}const H0={transitional:AJ,adapter:["xhr","http","fetch"],transformRequest:[function(n,a){const o=a.getContentType()||"",d=o.indexOf("application/json")>-1,h=Me.isObject(n);if(h&&Me.isHTMLForm(n)&&(n=new FormData(n)),Me.isFormData(n))return d?JSON.stringify(IJ(n)):n;if(Me.isArrayBuffer(n)||Me.isBuffer(n)||Me.isStream(n)||Me.isFile(n)||Me.isBlob(n)||Me.isReadableStream(n))return n;if(Me.isArrayBufferView(n))return n.buffer;if(Me.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let y;if(h){if(o.indexOf("application/x-www-form-urlencoded")>-1)return Owe(n,this.formSerializer).toString();if((y=Me.isFileList(n))||o.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return tT(y?{"files[]":n}:n,b&&new b,this.formSerializer)}}return h||d?(a.setContentType("application/json",!1),kwe(n)):n}],transformResponse:[function(n){const a=this.transitional||H0.transitional,o=a&&a.forcedJSONParsing,d=this.responseType==="json";if(Me.isResponse(n)||Me.isReadableStream(n))return n;if(n&&Me.isString(n)&&(o&&!this.responseType||d)){const f=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(n,this.parseReviver)}catch(y){if(f)throw y.name==="SyntaxError"?hn.from(y,hn.ERR_BAD_RESPONSE,this,null,this.response):y}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:da.classes.FormData,Blob:da.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Me.forEach(["delete","get","head","post","put","patch"],e=>{H0.headers[e]={}});const jwe=Me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Lwe=e=>{const n={};let a,o,d;return e&&e.split(`
`).forEach(function(f){d=f.indexOf(":"),a=f.substring(0,d).trim().toLowerCase(),o=f.substring(d+1).trim(),!(!a||n[a]&&jwe[a])&&(a==="set-cookie"?n[a]?n[a].push(o):n[a]=[o]:n[a]=n[a]?n[a]+", "+o:o)}),n},v7=Symbol("internals");function zv(e){return e&&String(e).trim().toLowerCase()}function JE(e){return e===!1||e==null?e:Me.isArray(e)?e.map(JE):String(e)}function Mwe(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=a.exec(e);)n[o[1]]=o[2];return n}const Uwe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function BO(e,n,a,o,d){if(Me.isFunction(o))return o.call(this,n,a);if(d&&(n=a),!!Me.isString(n)){if(Me.isString(o))return n.indexOf(o)!==-1;if(Me.isRegExp(o))return o.test(n)}}function Fwe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,o)=>a.toUpperCase()+o)}function Vwe(e,n){const a=Me.toCamelCase(" "+n);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+a,{value:function(d,h,f){return this[o].call(this,n,d,h,f)},configurable:!0})})}let ts=class{constructor(n){n&&this.set(n)}set(n,a,o){const d=this;function h(y,b,x){const T=zv(b);if(!T)throw new Error("header name must be a non-empty string");const S=Me.findKey(d,T);(!S||d[S]===void 0||x===!0||x===void 0&&d[S]!==!1)&&(d[S||b]=JE(y))}const f=(y,b)=>Me.forEach(y,(x,T)=>h(x,T,b));if(Me.isPlainObject(n)||n instanceof this.constructor)f(n,a);else if(Me.isString(n)&&(n=n.trim())&&!Uwe(n))f(Lwe(n),a);else if(Me.isObject(n)&&Me.isIterable(n)){let y={},b,x;for(const T of n){if(!Me.isArray(T))throw TypeError("Object iterator must return a key-value pair");y[x=T[0]]=(b=y[x])?Me.isArray(b)?[...b,T[1]]:[b,T[1]]:T[1]}f(y,a)}else n!=null&&h(a,n,o);return this}get(n,a){if(n=zv(n),n){const o=Me.findKey(this,n);if(o){const d=this[o];if(!a)return d;if(a===!0)return Mwe(d);if(Me.isFunction(a))return a.call(this,d,o);if(Me.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=zv(n),n){const o=Me.findKey(this,n);return!!(o&&this[o]!==void 0&&(!a||BO(this,this[o],o,a)))}return!1}delete(n,a){const o=this;let d=!1;function h(f){if(f=zv(f),f){const y=Me.findKey(o,f);y&&(!a||BO(o,o[y],y,a))&&(delete o[y],d=!0)}}return Me.isArray(n)?n.forEach(h):h(n),d}clear(n){const a=Object.keys(this);let o=a.length,d=!1;for(;o--;){const h=a[o];(!n||BO(this,this[h],h,n,!0))&&(delete this[h],d=!0)}return d}normalize(n){const a=this,o={};return Me.forEach(this,(d,h)=>{const f=Me.findKey(o,h);if(f){a[f]=JE(d),delete a[h];return}const y=n?Fwe(h):String(h).trim();y!==h&&delete a[h],a[y]=JE(d),o[y]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return Me.forEach(this,(o,d)=>{o!=null&&o!==!1&&(a[d]=n&&Me.isArray(o)?o.join(", "):o)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const o=new this(n);return a.forEach(d=>o.set(d)),o}static accessor(n){const o=(this[v7]=this[v7]={accessors:{}}).accessors,d=this.prototype;function h(f){const y=zv(f);o[y]||(Vwe(d,f),o[y]=!0)}return Me.isArray(n)?n.forEach(h):h(n),this}};ts.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Me.reduceDescriptors(ts.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(o){this[a]=o}}});Me.freezeMethods(ts);function GO(e,n){const a=this||H0,o=n||a,d=ts.from(o.headers);let h=o.data;return Me.forEach(e,function(y){h=y.call(a,h,d.normalize(),n?n.status:void 0)}),d.normalize(),h}function OJ(e){return!!(e&&e.__CANCEL__)}function Hf(e,n,a){hn.call(this,e??"canceled",hn.ERR_CANCELED,n,a),this.name="CanceledError"}Me.inherits(Hf,hn,{__CANCEL__:!0});function PJ(e,n,a){const o=a.config.validateStatus;!a.status||!o||o(a.status)?e(a):n(new hn("Request failed with status code "+a.status,[hn.ERR_BAD_REQUEST,hn.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function Bwe(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Gwe(e,n){e=e||10;const a=new Array(e),o=new Array(e);let d=0,h=0,f;return n=n!==void 0?n:1e3,function(b){const x=Date.now(),T=o[h];f||(f=x),a[d]=b,o[d]=x;let S=h,N=0;for(;S!==d;)N+=a[S++],S=S%e;if(d=(d+1)%e,d===h&&(h=(h+1)%e),x-f<n)return;const O=T&&x-T;return O?Math.round(N*1e3/O):void 0}}function Wwe(e,n){let a=0,o=1e3/n,d,h;const f=(x,T=Date.now())=>{a=T,d=null,h&&(clearTimeout(h),h=null),e(...x)};return[(...x)=>{const T=Date.now(),S=T-a;S>=o?f(x,T):(d=x,h||(h=setTimeout(()=>{h=null,f(d)},o-S)))},()=>d&&f(d)]}const NS=(e,n,a=3)=>{let o=0;const d=Gwe(50,250);return Wwe(h=>{const f=h.loaded,y=h.lengthComputable?h.total:void 0,b=f-o,x=d(b),T=f<=y;o=f;const S={loaded:f,total:y,progress:y?f/y:void 0,bytes:b,rate:x||void 0,estimated:x&&y&&T?(y-f)/x:void 0,event:h,lengthComputable:y!=null,[n?"download":"upload"]:!0};e(S)},a)},y7=(e,n)=>{const a=e!=null;return[o=>n[0]({lengthComputable:a,total:e,loaded:o}),n[1]]},_7=e=>(...n)=>Me.asap(()=>e(...n)),$we=da.hasStandardBrowserEnv?((e,n)=>a=>(a=new URL(a,da.origin),e.protocol===a.protocol&&e.host===a.host&&(n||e.port===a.port)))(new URL(da.origin),da.navigator&&/(msie|trident)/i.test(da.navigator.userAgent)):()=>!0,Hwe=da.hasStandardBrowserEnv?{write(e,n,a,o,d,h,f){if(typeof document>"u")return;const y=[`${e}=${encodeURIComponent(n)}`];Me.isNumber(a)&&y.push(`expires=${new Date(a).toUTCString()}`),Me.isString(o)&&y.push(`path=${o}`),Me.isString(d)&&y.push(`domain=${d}`),h===!0&&y.push("secure"),Me.isString(f)&&y.push(`SameSite=${f}`),document.cookie=y.join("; ")},read(e){if(typeof document>"u")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function zwe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Kwe(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function DJ(e,n,a){let o=!zwe(n);return e&&(o||a==!1)?Kwe(e,n):n}const b7=e=>e instanceof ts?{...e}:e;function jh(e,n){n=n||{};const a={};function o(x,T,S,N){return Me.isPlainObject(x)&&Me.isPlainObject(T)?Me.merge.call({caseless:N},x,T):Me.isPlainObject(T)?Me.merge({},T):Me.isArray(T)?T.slice():T}function d(x,T,S,N){if(Me.isUndefined(T)){if(!Me.isUndefined(x))return o(void 0,x,S,N)}else return o(x,T,S,N)}function h(x,T){if(!Me.isUndefined(T))return o(void 0,T)}function f(x,T){if(Me.isUndefined(T)){if(!Me.isUndefined(x))return o(void 0,x)}else return o(void 0,T)}function y(x,T,S){if(S in n)return o(x,T);if(S in e)return o(void 0,x)}const b={url:h,method:h,data:h,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:y,headers:(x,T,S)=>d(b7(x),b7(T),S,!0)};return Me.forEach(Object.keys({...e,...n}),function(T){const S=b[T]||d,N=S(e[T],n[T],T);Me.isUndefined(N)&&S!==y||(a[T]=N)}),a}const kJ=e=>{const n=jh({},e);let{data:a,withXSRFToken:o,xsrfHeaderName:d,xsrfCookieName:h,headers:f,auth:y}=n;if(n.headers=f=ts.from(f),n.url=RJ(DJ(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),y&&f.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),Me.isFormData(a)){if(da.hasStandardBrowserEnv||da.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(Me.isFunction(a.getHeaders)){const b=a.getHeaders(),x=["content-type","content-length"];Object.entries(b).forEach(([T,S])=>{x.includes(T.toLowerCase())&&f.set(T,S)})}}if(da.hasStandardBrowserEnv&&(o&&Me.isFunction(o)&&(o=o(n)),o||o!==!1&&$we(n.url))){const b=d&&h&&Hwe.read(h);b&&f.set(d,b)}return n},Ywe=typeof XMLHttpRequest<"u",qwe=Ywe&&function(e){return new Promise(function(a,o){const d=kJ(e);let h=d.data;const f=ts.from(d.headers).normalize();let{responseType:y,onUploadProgress:b,onDownloadProgress:x}=d,T,S,N,O,A;function I(){O&&O(),A&&A(),d.cancelToken&&d.cancelToken.unsubscribe(T),d.signal&&d.signal.removeEventListener("abort",T)}let P=new XMLHttpRequest;P.open(d.method.toUpperCase(),d.url,!0),P.timeout=d.timeout;function L(){if(!P)return;const V=ts.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders()),B={data:!y||y==="text"||y==="json"?P.responseText:P.response,status:P.status,statusText:P.statusText,headers:V,config:e,request:P};PJ(function(q){a(q),I()},function(q){o(q),I()},B),P=null}"onloadend"in P?P.onloadend=L:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(L)},P.onabort=function(){P&&(o(new hn("Request aborted",hn.ECONNABORTED,e,P)),P=null)},P.onerror=function(G){const B=G&&G.message?G.message:"Network Error",z=new hn(B,hn.ERR_NETWORK,e,P);z.event=G||null,o(z),P=null},P.ontimeout=function(){let G=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const B=d.transitional||AJ;d.timeoutErrorMessage&&(G=d.timeoutErrorMessage),o(new hn(G,B.clarifyTimeoutError?hn.ETIMEDOUT:hn.ECONNABORTED,e,P)),P=null},h===void 0&&f.setContentType(null),"setRequestHeader"in P&&Me.forEach(f.toJSON(),function(G,B){P.setRequestHeader(B,G)}),Me.isUndefined(d.withCredentials)||(P.withCredentials=!!d.withCredentials),y&&y!=="json"&&(P.responseType=d.responseType),x&&([N,A]=NS(x,!0),P.addEventListener("progress",N)),b&&P.upload&&([S,O]=NS(b),P.upload.addEventListener("progress",S),P.upload.addEventListener("loadend",O)),(d.cancelToken||d.signal)&&(T=V=>{P&&(o(!V||V.type?new Hf(null,e,P):V),P.abort(),P=null)},d.cancelToken&&d.cancelToken.subscribe(T),d.signal&&(d.signal.aborted?T():d.signal.addEventListener("abort",T)));const F=Bwe(d.url);if(F&&da.protocols.indexOf(F)===-1){o(new hn("Unsupported protocol "+F+":",hn.ERR_BAD_REQUEST,e));return}P.send(h||null)})},Xwe=(e,n)=>{const{length:a}=e=e?e.filter(Boolean):[];if(n||a){let o=new AbortController,d;const h=function(x){if(!d){d=!0,y();const T=x instanceof Error?x:this.reason;o.abort(T instanceof hn?T:new Hf(T instanceof Error?T.message:T))}};let f=n&&setTimeout(()=>{f=null,h(new hn(`timeout ${n} of ms exceeded`,hn.ETIMEDOUT))},n);const y=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(x=>{x.unsubscribe?x.unsubscribe(h):x.removeEventListener("abort",h)}),e=null)};e.forEach(x=>x.addEventListener("abort",h));const{signal:b}=o;return b.unsubscribe=()=>Me.asap(y),b}},Jwe=function*(e,n){let a=e.byteLength;if(a<n){yield e;return}let o=0,d;for(;o<a;)d=o+n,yield e.slice(o,d),o=d},Qwe=async function*(e,n){for await(const a of Zwe(e))yield*Jwe(a,n)},Zwe=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const n=e.getReader();try{for(;;){const{done:a,value:o}=await n.read();if(a)break;yield o}}finally{await n.cancel()}},x7=(e,n,a,o)=>{const d=Qwe(e,n);let h=0,f,y=b=>{f||(f=!0,o&&o(b))};return new ReadableStream({async pull(b){try{const{done:x,value:T}=await d.next();if(x){y(),b.close();return}let S=T.byteLength;if(a){let N=h+=S;a(N)}b.enqueue(new Uint8Array(T))}catch(x){throw y(x),x}},cancel(b){return y(b),d.return()}},{highWaterMark:2})},E7=64*1024,{isFunction:bE}=Me,eTe=(({Request:e,Response:n})=>({Request:e,Response:n}))(Me.global),{ReadableStream:S7,TextEncoder:w7}=Me.global,T7=(e,...n)=>{try{return!!e(...n)}catch{return!1}},tTe=e=>{e=Me.merge.call({skipUndefined:!0},eTe,e);const{fetch:n,Request:a,Response:o}=e,d=n?bE(n):typeof fetch=="function",h=bE(a),f=bE(o);if(!d)return!1;const y=d&&bE(S7),b=d&&(typeof w7=="function"?(A=>I=>A.encode(I))(new w7):async A=>new Uint8Array(await new a(A).arrayBuffer())),x=h&&y&&T7(()=>{let A=!1;const I=new a(da.origin,{body:new S7,method:"POST",get duplex(){return A=!0,"half"}}).headers.has("Content-Type");return A&&!I}),T=f&&y&&T7(()=>Me.isReadableStream(new o("").body)),S={stream:T&&(A=>A.body)};d&&["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!S[A]&&(S[A]=(I,P)=>{let L=I&&I[A];if(L)return L.call(I);throw new hn(`Response type '${A}' is not supported`,hn.ERR_NOT_SUPPORT,P)})});const N=async A=>{if(A==null)return 0;if(Me.isBlob(A))return A.size;if(Me.isSpecCompliantForm(A))return(await new a(da.origin,{method:"POST",body:A}).arrayBuffer()).byteLength;if(Me.isArrayBufferView(A)||Me.isArrayBuffer(A))return A.byteLength;if(Me.isURLSearchParams(A)&&(A=A+""),Me.isString(A))return(await b(A)).byteLength},O=async(A,I)=>{const P=Me.toFiniteNumber(A.getContentLength());return P??N(I)};return async A=>{let{url:I,method:P,data:L,signal:F,cancelToken:V,timeout:G,onDownloadProgress:B,onUploadProgress:z,responseType:q,headers:Z,withCredentials:ie="same-origin",fetchOptions:ue}=kJ(A),re=n||fetch;q=q?(q+"").toLowerCase():"text";let pe=Xwe([F,V&&V.toAbortSignal()],G),Se=null;const fe=pe&&pe.unsubscribe&&(()=>{pe.unsubscribe()});let be;try{if(z&&x&&P!=="get"&&P!=="head"&&(be=await O(Z,L))!==0){let Ue=new a(I,{method:"POST",body:L,duplex:"half"}),Le;if(Me.isFormData(L)&&(Le=Ue.headers.get("content-type"))&&Z.setContentType(Le),Ue.body){const[tt,Te]=y7(be,NS(_7(z)));L=x7(Ue.body,E7,tt,Te)}}Me.isString(ie)||(ie=ie?"include":"omit");const se=h&&"credentials"in a.prototype,he={...ue,signal:pe,method:P.toUpperCase(),headers:Z.normalize().toJSON(),body:L,duplex:"half",credentials:se?ie:void 0};Se=h&&new a(I,he);let Q=await(h?re(Se,ue):re(I,he));const le=T&&(q==="stream"||q==="response");if(T&&(B||le&&fe)){const Ue={};["status","statusText","headers"].forEach(De=>{Ue[De]=Q[De]});const Le=Me.toFiniteNumber(Q.headers.get("content-length")),[tt,Te]=B&&y7(Le,NS(_7(B),!0))||[];Q=new o(x7(Q.body,E7,tt,()=>{Te&&Te(),fe&&fe()}),Ue)}q=q||"text";let we=await S[Me.findKey(S,q)||"text"](Q,A);return!le&&fe&&fe(),await new Promise((Ue,Le)=>{PJ(Ue,Le,{data:we,headers:ts.from(Q.headers),status:Q.status,statusText:Q.statusText,config:A,request:Se})})}catch(se){throw fe&&fe(),se&&se.name==="TypeError"&&/Load failed|fetch/i.test(se.message)?Object.assign(new hn("Network Error",hn.ERR_NETWORK,A,Se),{cause:se.cause||se}):hn.from(se,se&&se.code,A,Se)}}},nTe=new Map,jJ=e=>{let n=e&&e.env||{};const{fetch:a,Request:o,Response:d}=n,h=[o,d,a];let f=h.length,y=f,b,x,T=nTe;for(;y--;)b=h[y],x=T.get(b),x===void 0&&T.set(b,x=y?new Map:tTe(n)),T=x;return x};jJ();const mk={http:_we,xhr:qwe,fetch:{get:jJ}};Me.forEach(mk,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const C7=e=>`- ${e}`,rTe=e=>Me.isFunction(e)||e===null||e===!1;function iTe(e,n){e=Me.isArray(e)?e:[e];const{length:a}=e;let o,d;const h={};for(let f=0;f<a;f++){o=e[f];let y;if(d=o,!rTe(o)&&(d=mk[(y=String(o)).toLowerCase()],d===void 0))throw new hn(`Unknown adapter '${y}'`);if(d&&(Me.isFunction(d)||(d=d.get(n))))break;h[y||"#"+f]=d}if(!d){const f=Object.entries(h).map(([b,x])=>`adapter ${b} `+(x===!1?"is not supported by the environment":"is not available in the build"));let y=a?f.length>1?`since :
`+f.map(C7).join(`
`):" "+C7(f[0]):"as no adapter specified";throw new hn("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return d}const LJ={getAdapter:iTe,adapters:mk};function WO(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Hf(null,e)}function N7(e){return WO(e),e.headers=ts.from(e.headers),e.data=GO.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),LJ.getAdapter(e.adapter||H0.adapter,e)(e).then(function(o){return WO(e),o.data=GO.call(e,e.transformResponse,o),o.headers=ts.from(o.headers),o},function(o){return OJ(o)||(WO(e),o&&o.response&&(o.response.data=GO.call(e,e.transformResponse,o.response),o.response.headers=ts.from(o.response.headers))),Promise.reject(o)})}const MJ="1.13.2",nT={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{nT[e]=function(o){return typeof o===e||"a"+(n<1?"n ":" ")+e}});const R7={};nT.transitional=function(n,a,o){function d(h,f){return"[Axios v"+MJ+"] Transitional option '"+h+"'"+f+(o?". "+o:"")}return(h,f,y)=>{if(n===!1)throw new hn(d(f," has been removed"+(a?" in "+a:"")),hn.ERR_DEPRECATED);return a&&!R7[f]&&(R7[f]=!0,console.warn(d(f," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(h,f,y):!0}};nT.spelling=function(n){return(a,o)=>(console.warn(`${o} is likely a misspelling of ${n}`),!0)};function aTe(e,n,a){if(typeof e!="object")throw new hn("options must be an object",hn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let d=o.length;for(;d-- >0;){const h=o[d],f=n[h];if(f){const y=e[h],b=y===void 0||f(y,h,e);if(b!==!0)throw new hn("option "+h+" must be "+b,hn.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new hn("Unknown option "+h,hn.ERR_BAD_OPTION)}}const QE={assertOptions:aTe,validators:nT},Rc=QE.validators;let Nh=class{constructor(n){this.defaults=n||{},this.interceptors={request:new g7,response:new g7}}async request(n,a){try{return await this._request(n,a)}catch(o){if(o instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const h=d.stack?d.stack.replace(/^.+\n/,""):"";try{o.stack?h&&!String(o.stack).endsWith(h.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+h):o.stack=h}catch{}}throw o}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=jh(this.defaults,a);const{transitional:o,paramsSerializer:d,headers:h}=a;o!==void 0&&QE.assertOptions(o,{silentJSONParsing:Rc.transitional(Rc.boolean),forcedJSONParsing:Rc.transitional(Rc.boolean),clarifyTimeoutError:Rc.transitional(Rc.boolean)},!1),d!=null&&(Me.isFunction(d)?a.paramsSerializer={serialize:d}:QE.assertOptions(d,{encode:Rc.function,serialize:Rc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),QE.assertOptions(a,{baseUrl:Rc.spelling("baseURL"),withXsrfToken:Rc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let f=h&&Me.merge(h.common,h[a.method]);h&&Me.forEach(["delete","get","head","post","put","patch","common"],A=>{delete h[A]}),a.headers=ts.concat(f,h);const y=[];let b=!0;this.interceptors.request.forEach(function(I){typeof I.runWhen=="function"&&I.runWhen(a)===!1||(b=b&&I.synchronous,y.unshift(I.fulfilled,I.rejected))});const x=[];this.interceptors.response.forEach(function(I){x.push(I.fulfilled,I.rejected)});let T,S=0,N;if(!b){const A=[N7.bind(this),void 0];for(A.unshift(...y),A.push(...x),N=A.length,T=Promise.resolve(a);S<N;)T=T.then(A[S++],A[S++]);return T}N=y.length;let O=a;for(;S<N;){const A=y[S++],I=y[S++];try{O=A(O)}catch(P){I.call(this,P);break}}try{T=N7.call(this,O)}catch(A){return Promise.reject(A)}for(S=0,N=x.length;S<N;)T=T.then(x[S++],x[S++]);return T}getUri(n){n=jh(this.defaults,n);const a=DJ(n.baseURL,n.url,n.allowAbsoluteUrls);return RJ(a,n.params,n.paramsSerializer)}};Me.forEach(["delete","get","head","options"],function(n){Nh.prototype[n]=function(a,o){return this.request(jh(o||{},{method:n,url:a,data:(o||{}).data}))}});Me.forEach(["post","put","patch"],function(n){function a(o){return function(h,f,y){return this.request(jh(y||{},{method:n,headers:o?{"Content-Type":"multipart/form-data"}:{},url:h,data:f}))}}Nh.prototype[n]=a(),Nh.prototype[n+"Form"]=a(!0)});let sTe=class UJ{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(h){a=h});const o=this;this.promise.then(d=>{if(!o._listeners)return;let h=o._listeners.length;for(;h-- >0;)o._listeners[h](d);o._listeners=null}),this.promise.then=d=>{let h;const f=new Promise(y=>{o.subscribe(y),h=y}).then(d);return f.cancel=function(){o.unsubscribe(h)},f},n(function(h,f,y){o.reason||(o.reason=new Hf(h,f,y),a(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const n=new AbortController,a=o=>{n.abort(o)};return this.subscribe(a),n.signal.unsubscribe=()=>this.unsubscribe(a),n.signal}static source(){let n;return{token:new UJ(function(d){n=d}),cancel:n}}};function oTe(e){return function(a){return e.apply(null,a)}}function cTe(e){return Me.isObject(e)&&e.isAxiosError===!0}const RP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(RP).forEach(([e,n])=>{RP[n]=e});function FJ(e){const n=new Nh(e),a=gJ(Nh.prototype.request,n);return Me.extend(a,Nh.prototype,n,{allOwnKeys:!0}),Me.extend(a,n,null,{allOwnKeys:!0}),a.create=function(d){return FJ(jh(e,d))},a}const kn=FJ(H0);kn.Axios=Nh;kn.CanceledError=Hf;kn.CancelToken=sTe;kn.isCancel=OJ;kn.VERSION=MJ;kn.toFormData=tT;kn.AxiosError=hn;kn.Cancel=kn.CanceledError;kn.all=function(n){return Promise.all(n)};kn.spread=oTe;kn.isAxiosError=cTe;kn.mergeConfig=jh;kn.AxiosHeaders=ts;kn.formToJSON=e=>IJ(Me.isHTMLForm(e)?new FormData(e):e);kn.getAdapter=LJ.getAdapter;kn.HttpStatusCode=RP;kn.default=kn;const{Axios:BKe,AxiosError:GKe,CanceledError:WKe,isCancel:$Ke,CancelToken:HKe,VERSION:zKe,all:KKe,Cancel:YKe,isAxiosError:qKe,spread:XKe,toFormData:JKe,AxiosHeaders:QKe,HttpStatusCode:ZKe,formToJSON:e9e,getAdapter:t9e,mergeConfig:n9e}=kn,lTe=()=>"/api",dt=kn.create({baseURL:lTe(),headers:{"Content-Type":"application/json"}});dt.interceptors.request.use(e=>{const n=localStorage.getItem("token");return n&&(e.headers.Authorization=`Bearer ${n}`),e});dt.interceptors.response.use(e=>e,e=>{var n;return((n=e.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),e.response||console.error("Network Error:",{message:e.message,apiUrl:dt.defaults.baseURL,currentHost:window.location.hostname,currentPort:window.location.port}),Promise.reject(e)});const Pl={uploadReport:e=>dt.post("/health/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>dt.get("/health/reports"),getReport:e=>dt.get(`/health/reports/${e}`),getDashboard:()=>dt.get("/health/dashboard"),getHistory:e=>dt.get("/health/history",{params:{reportType:e}}),compareReport:e=>dt.get(`/health/reports/${e}/compare`),chatAboutReport:(e,n,a)=>dt.post(`/health/reports/${e}/chat`,{message:n,chatHistory:a}),askAI:e=>dt.post("/health/ai-chat",e),getMetricInfo:e=>dt.post("/health/metric-info",e)},Ya={getAll:e=>dt.get("/doctors",{params:e}),getById:e=>dt.get(`/doctors/${e}`),getRecommended:e=>dt.get("/doctors/recommended",{params:{specializations:e}}),bookAppointment:e=>dt.post("/doctors/book",e),getAppointments:()=>dt.get("/doctors/appointments"),getAppointment:e=>dt.get(`/doctors/appointments/${e}`),startConsultation:e=>dt.post(`/doctors/appointments/${e}/start`),endConsultation:e=>dt.post(`/doctors/appointments/${e}/end`),getConsultationSummary:e=>dt.get(`/doctors/appointments/${e}/summary`),submitReview:(e,n)=>dt.post(`/doctors/appointments/${e}/review`,n),downloadPrescription:e=>dt.get(`/doctors/appointments/${e}/prescription`,{responseType:"blob"}),getDashboard:()=>dt.get("/doctors/me/dashboard"),getMyProfile:()=>dt.get("/doctors/me/profile"),updateMyProfile:e=>dt.put("/doctors/me/profile",e),getMyAppointments:e=>dt.get("/doctors/me/appointments",{params:e}),updateAppointmentStatus:(e,n)=>dt.patch(`/doctors/me/appointments/${e}`,n),getPatientProfile:(e,n)=>dt.get(`/doctors/patient/${e}`,{params:{appointmentId:n}}),getDoctorAppointments:(e,n)=>dt.get(`/doctors/${e}/appointments`,{params:{status:n}}),getMyAvailability:()=>dt.get("/doctors/me/availability"),updateMyAvailability:e=>dt.put("/doctors/me/availability",e),generateTimeSlots:()=>dt.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(e,n)=>dt.get(`/doctors/${e}/available-slots`,{params:{date:n}}),checkSlotAvailability:(e,n,a)=>dt.get(`/doctors/${e}/check-slot`,{params:{date:n,timeSlot:a}})},Cm={connectDevice:(e,n)=>dt.post("/wearables/connect",{deviceType:e,deviceName:n}),disconnectDevice:e=>dt.post(`/wearables/disconnect/${e}`),getDevices:()=>dt.get("/wearables/devices"),syncMetrics:(e,n)=>dt.post("/wearables/sync",{deviceType:e,metrics:n}),addHeartRate:(e,n,a)=>dt.post("/wearables/heart-rate",{deviceType:e,bpm:n,type:a}),addSleepData:(e,n)=>dt.post("/wearables/sleep",{deviceType:e,sleepData:n}),getDashboard:()=>dt.get("/wearables/dashboard"),generateDemoData:e=>dt.post("/wearables/demo-data",{deviceType:e})},ZE={getStats:()=>dt.get("/admin/stats"),getUsers:e=>dt.get("/admin/users",{params:e}),getUserDetails:e=>dt.get(`/admin/users/${e}`),updateUserStatus:(e,n)=>dt.patch(`/admin/users/${e}/status`,{isActive:n}),getReports:e=>dt.get("/admin/reports",{params:e}),getDeficiencyRules:()=>dt.get("/admin/deficiency-rules"),createDeficiencyRule:e=>dt.post("/admin/deficiency-rules",e),updateDeficiencyRule:(e,n)=>dt.put(`/admin/deficiency-rules/${e}`,n),deleteDeficiencyRule:e=>dt.delete(`/admin/deficiency-rules/${e}`),getSupplements:()=>dt.get("/admin/supplements"),createSupplement:e=>dt.post("/admin/supplements",e),updateSupplement:(e,n)=>dt.put(`/admin/supplements/${e}`,n),deleteSupplement:e=>dt.delete(`/admin/supplements/${e}`),getDietPlans:e=>dt.get("/admin/diet-plans",{params:e}),createDietPlan:e=>dt.post("/admin/diet-plans",e),updateDietPlan:(e,n)=>dt.put(`/admin/diet-plans/${e}`,n),approveDietPlan:(e,n)=>dt.patch(`/admin/diet-plans/${e}/approve`,{status:n}),deleteDietPlan:e=>dt.delete(`/admin/diet-plans/${e}`),getDoctors:e=>dt.get("/admin/doctors",{params:e}),createDoctor:e=>dt.post("/admin/doctors",e),updateDoctor:(e,n)=>dt.put(`/admin/doctors/${e}`,n),approveDoctor:e=>dt.patch(`/admin/doctors/${e}/approve`),rejectDoctor:(e,n)=>dt.patch(`/admin/doctors/${e}/reject`,{reason:n}),deleteDoctor:e=>dt.delete(`/admin/doctors/${e}`),toggleDoctorVisibility:e=>dt.patch(`/admin/doctors/${e}/visibility`),getDoctorScheduleOverview:e=>dt.get(`/admin/doctors/${e}/schedule-overview`)},dTe={getSubscription:()=>dt.get("/auth/subscription")},uTe={analyzeFood:e=>dt.post("/nutrition/analyze-food",{foodDescription:e}),logMeal:e=>dt.post("/nutrition/log-meal",e),getTodayLogs:()=>dt.get("/nutrition/logs/today"),getDailySummary:e=>dt.get("/nutrition/summary/daily",{params:{date:e}}),getGoals:()=>dt.get("/nutrition/goals"),updateGoals:e=>dt.put("/nutrition/goals",e)},VJ=Y.createContext(),ma=()=>Y.useContext(VJ),hTe=({children:e})=>{const[n,a]=Y.useState(null),[o,d]=Y.useState(!0);Y.useEffect(()=>{const I=localStorage.getItem("token"),P=localStorage.getItem("user");I&&P&&(a(JSON.parse(P)),dt.defaults.headers.common.Authorization=`Bearer ${I}`),d(!1)},[]);const h=async(I,P)=>{const F=I.includes("@")?{email:I,password:P}:{phone:I,password:P},{data:V}=await dt.post("/auth/login",F);return localStorage.setItem("token",V.token),localStorage.setItem("user",JSON.stringify(V)),dt.defaults.headers.common.Authorization=`Bearer ${V.token}`,a(V),V},f=async(I,P,L,F={},V=null)=>{const{data:G}=await dt.post("/auth/register",{name:I,email:P,password:L,profile:F,nutritionGoal:V});return localStorage.setItem("token",G.token),localStorage.setItem("user",JSON.stringify(G)),dt.defaults.headers.common.Authorization=`Bearer ${G.token}`,a(G),G},y=async I=>{const{data:P}=await dt.post("/auth/register/doctor",I);return localStorage.setItem("token",P.token),localStorage.setItem("user",JSON.stringify(P)),dt.defaults.headers.common.Authorization=`Bearer ${P.token}`,a(P),P},b=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete dt.defaults.headers.common.Authorization,a(null)},x=I=>{a(I),localStorage.setItem("user",JSON.stringify(I))},T=()=>(n==null?void 0:n.role)==="admin",S=()=>(n==null?void 0:n.role)==="doctor",N=()=>(n==null?void 0:n.role)==="patient"||(n==null?void 0:n.role)==="client",O=()=>{var I;return((I=n==null?void 0:n.doctorProfile)==null?void 0:I.approvalStatus)==="approved"},A=()=>{var I;return((I=n==null?void 0:n.subscription)==null?void 0:I.status)==="active"};return l.jsx(VJ.Provider,{value:{user:n,login:h,register:f,registerDoctor:y,logout:b,updateUser:x,loading:o,isAdmin:T,isDoctor:S,isPatient:N,isDoctorApproved:O,isSubscribed:A},children:e})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var pTe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mTe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ze=(e,n)=>{const a=Y.forwardRef(({color:o="currentColor",size:d=24,strokeWidth:h=2,absoluteStrokeWidth:f,className:y="",children:b,...x},T)=>Y.createElement("svg",{ref:T,...pTe,width:d,height:d,stroke:o,strokeWidth:f?Number(h)*24/Number(d):h,className:["lucide",`lucide-${mTe(e)}`,y].join(" "),...x},[...n.map(([S,N])=>Y.createElement(S,N)),...Array.isArray(b)?b:[b]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=Ze("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Ze("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=Ze("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=Ze("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fTe=Ze("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=Ze("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=Ze("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BJ=Ze("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=Ze("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GJ=Ze("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gTe=Ze("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vTe=Ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yTe=Ze("Bone",[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Te=Ze("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $O=Ze("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dy=Ze("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=Ze("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fk=Ze("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=Ze("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bTe=Ze("ChefHat",[["path",{d:"M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z",key:"z3ra2g"}],["line",{x1:"6",x2:"18",y1:"17",y2:"17",key:"12q60k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=Ze("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xTe=Ze("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dd=Ze("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ETe=Ze("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const STe=Ze("Cigarette",[["path",{d:"M18 12H2v4h16",key:"2rt1hm"}],["path",{d:"M22 12v4",key:"142cbu"}],["path",{d:"M7 12v4",key:"jqww69"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wTe=Ze("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ec=Ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TTe=Ze("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CTe=Ze("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WJ=Ze("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AP=Ze("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $J=Ze("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A7=Ze("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uf=Ze("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qy=Ze("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HJ=Ze("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=Ze("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=Ze("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=Ze("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zJ=Ze("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I7=Ze("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=Ze("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NTe=Ze("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RTe=Ze("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=Ze("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O7=Ze("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ey=Ze("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ATe=Ze("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xy=Ze("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P7=Ze("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IP=Ze("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gk=Ze("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=Ze("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OP=Ze("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KJ=Ze("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D7=Ze("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xd=Ze("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YJ=Ze("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qJ=Ze("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vk=Ze("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ITe=Ze("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zf=Ze("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OTe=Ze("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PTe=Ze("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yk=Ze("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=Ze("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DTe=Ze("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kTe=Ze("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jTe=Ze("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XJ=Ze("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k7=Ze("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RS=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=Ze("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kf=Ze("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LTe=Ze("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jy=Ze("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JJ=Ze("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sy=Ze("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=Ze("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QJ=Ze("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=Ze("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=Ze("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sT=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZJ=Ze("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Ze("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PP=Ze("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=Ze("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=Ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hf=Ze("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MTe=Ze("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=Ze("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DP=Ze("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jd=Ze("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UTe=Ze("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FTe=Ze("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=Ze("Watch",[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VTe=Ze("Wine",[["path",{d:"M8 22h8",key:"rmew8v"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M12 15v7",key:"t2xh3l"}],["path",{d:"M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",key:"10ffi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=Ze("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=Ze("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function BTe(){const[e,n]=Y.useState(""),[a,o]=Y.useState({x:0,y:0}),[d,h]=Y.useState(!1),f=ns();Y.useEffect(()=>{const b=()=>{const x=window.getSelection(),T=x.toString().trim();if(T.length>0){const N=x.getRangeAt(0).getBoundingClientRect();n(T),o({x:N.left+N.width/2,y:N.top-10}),h(!0)}else h(!1)};return document.addEventListener("mouseup",b),document.addEventListener("touchend",b),()=>{document.removeEventListener("mouseup",b),document.removeEventListener("touchend",b)}},[]);const y=()=>{f("/ai-chat",{state:{selectedText:e}}),h(!1)};return d?l.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%)"},children:l.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[l.jsx(Xd,{className:"w-4 h-4"}),"Ask AI"]})}):null}function GTe(){const e=Gl(),n=ns(),{user:a,logout:o}=ma(),[d,h]=Y.useState(!1),[f,y]=Y.useState(!1);Y.useEffect(()=>{const N=()=>{const I=document.querySelectorAll(".fixed");let P=!1;I.forEach(L=>{const F=L.className,V=F.includes("bg-black")||F.includes("inset-0"),G=F.includes("z-50")||F.includes("z-40");V&&G&&L.offsetHeight>0&&(P=!0)}),e.pathname==="/ai-chat"&&(P=!0),y(P||d)};N();const O=setTimeout(N,100),A=new MutationObserver(N);return A.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(O),A.disconnect()}},[e.pathname,d]);const b=[{path:"/dashboard",icon:aT,label:"Home"},{path:"/ai-chat",icon:Xd,label:"AI"},{path:"/nutrition",icon:kl,label:"Nutrition",isCenter:!0},{path:"/upload",icon:Vn,label:"Reports"}],x=[{path:"/profile",icon:Kf,label:"Profile"},{path:"/wearables",icon:gl,label:"Wearables",comingSoon:!0},{path:"/diet-plan",icon:fr,label:"Diet Plan"},{path:"#appointment",icon:qr,label:"Appointment",comingSoon:!0}],T=N=>e.pathname===N,S=()=>{o(),et.success("Logged out successfully"),n("/login"),h(!1)};return l.jsxs(l.Fragment,{children:[d&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>h(!1)}),d&&l.jsxs("div",{className:"fixed bottom-24 right-4 bg-white rounded-2xl shadow-2xl z-50 w-56 overflow-hidden animate-fade-in",children:[l.jsx("div",{className:"p-4 border-b border-[#E5DFD3]",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"font-semibold text-[#2C2416]",children:"Menu"}),l.jsx("button",{onClick:()=>h(!1),className:"text-[#5C4F3D] hover:text-[#2C2416]",children:l.jsx(bi,{className:"w-5 h-5"})})]})}),l.jsxs("div",{className:"space-y-1 p-2",children:[x.map(N=>{const O=N.icon,A=T(N.path);return N.comingSoon?l.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-3 text-[#5C4F3D] bg-[#F5F1EA] rounded-xl opacity-60 cursor-not-allowed text-sm",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(O,{className:"w-5 h-5"}),l.jsx("span",{children:N.label})]}),l.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-medium",children:"Soon"})]},N.label):N.path==="#appointment"?l.jsxs("button",{onClick:()=>{et.info("Appointment coming soon"),h(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-[#5C4F3D] hover:bg-[#F5F1EA] rounded-xl transition-colors text-sm",children:[l.jsx(O,{className:"w-5 h-5"}),l.jsx("span",{children:N.label})]},N.label):l.jsxs(Ut,{to:N.path,onClick:()=>h(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-colors text-sm ${A?"bg-[#F5F1EA] text-[#8B7355] font-medium":"text-[#5C4F3D] hover:bg-[#F5F1EA]"}`,children:[l.jsx(O,{className:"w-5 h-5"}),l.jsx("span",{children:N.label})]},N.path)}),l.jsx("div",{className:"border-t border-[#E5DFD3] my-2"}),l.jsx("div",{className:"px-4 py-2 text-xs text-[#5C4F3D] font-medium",children:a==null?void 0:a.name}),l.jsxs("button",{onClick:S,className:"w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[l.jsx(gk,{className:"w-5 h-5"}),l.jsx("span",{children:"Logout"})]})]})]}),l.jsx("nav",{className:`mobile-bottom-nav-container ${f?"hidden":""}`,children:l.jsxs("div",{className:"mobile-bottom-nav",children:[b.map(N=>{const O=N.icon,A=T(N.path);return N.isCenter?l.jsx(Ut,{to:N.path,className:"nav-center-fab","aria-label":N.label,title:N.label,children:l.jsx(O,{className:"w-7 h-7"})},N.path):l.jsx(Ut,{to:N.path,className:`nav-item-modern ${A?"active":""}`,"aria-label":N.label,title:N.label,children:l.jsx(O,{className:"w-5 h-5"})},N.path)}),l.jsx("button",{onClick:()=>h(!d),className:`nav-item-modern ${d?"active":""}`,"aria-label":"More options",title:"More options",children:l.jsx(OTe,{className:"w-5 h-5"})})]})})]})}const WTe=[{path:"/dashboard",icon:aT,label:"Dashboard"},{path:"/ai-chat",icon:Xd,label:"AI Assistant"},{path:"/upload",icon:Vn,label:"My Reports"},{path:"/nutrition",icon:kl,label:"Nutrition"},{path:"/diet-plan",icon:so,label:"Diet Plan"},{path:"/profile",icon:Kf,label:"Profile"},{path:"/doctors",icon:qr,label:"Appointments",comingSoon:!0},{path:"/wearables",icon:gl,label:"Devices",comingSoon:!0}],$Te=[{path:"/doctor/dashboard",icon:aT,label:"Dashboard"},{path:"/doctor/availability",icon:ec,label:"Manage Slots"},{path:"/profile",icon:Kf,label:"Profile"}],HTe=[{path:"/admin",icon:aT,label:"Dashboard"},{path:"/profile",icon:Kf,label:"Settings"}];function pi({children:e,isAdmin:n,isDoctor:a}){var P,L,F,V,G,B;const{user:o,logout:d,isAdmin:h,isDoctor:f}=ma(),y=Gl(),b=ns(),[x,T]=Y.useState(!1),S=()=>{d(),b("/")};let N=WTe,O="/dashboard",A="Patient Portal";return h()||n?(N=HTe,O="/admin",A="Admin Panel"):(f()||a)&&(N=$Te,O="/doctor/dashboard",A=((P=o==null?void 0:o.doctorProfile)==null?void 0:P.specialization)||"Doctor Portal"),l.jsxs("div",{className:"min-h-screen flex bg-gradient-to-br from-cyan-50 via-blue-50 to-cyan-100",style:{backgroundColor:"transparent"},children:[l.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 bg-white shadow-lg lg:shadow-sm transform transition-transform duration-300 hidden lg:flex lg:flex-col ${x?"translate-x-0":"translate-x-full lg:translate-x-0"}`,style:{borderRight:"2px solid #E5DFD3",borderLeft:"2px solid #E5DFD3"},children:l.jsxs("div",{className:"flex flex-col h-full",children:[l.jsx("div",{className:"p-6 shrink-0",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs(Ut,{to:O,className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(Hn,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold",style:{color:"#2C2416"},children:"HealthAI"}),l.jsx("p",{className:"text-xs",style:{color:"#5C4F3D"},children:A})]})]})}),l.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:N.map(({path:z,icon:q,label:Z,comingSoon:ie})=>ie?l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all cursor-not-allowed relative",style:{color:"#5C4F3D",opacity:.6},children:[l.jsx(q,{className:"w-5 h-5"}),l.jsx("span",{children:Z}),l.jsx("span",{className:"ml-auto text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:"#8B7355",color:"white"},children:"Soon"})]},z):l.jsxs(Ut,{to:z,onClick:()=>T(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${y.pathname===z?"border":""}`,style:y.pathname===z?{backgroundColor:"#F5F1EA",color:"#8B7355",borderColor:"#E5DFD3"}:{color:"#5C4F3D"},onMouseEnter:ue=>{y.pathname!==z&&(ue.currentTarget.style.backgroundColor="#F5F1EA",ue.currentTarget.style.color="#2C2416")},onMouseLeave:ue=>{y.pathname!==z&&(ue.currentTarget.style.backgroundColor="transparent",ue.currentTarget.style.color="#5C4F3D")},children:[l.jsx(q,{className:"w-5 h-5"}),l.jsx("span",{children:Z})]},z))}),l.jsx("div",{className:"p-4 shrink-0",style:{borderTop:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl",style:{backgroundColor:"#F5F1EA"},children:[l.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold",children:(F=(L=o==null?void 0:o.name)==null?void 0:L[0])==null?void 0:F.toUpperCase()})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium truncate",style:{color:"#2C2416"},children:f()?`Dr. ${o==null?void 0:o.name}`:o==null?void 0:o.name}),l.jsx("p",{className:"text-xs truncate",style:{color:"#5C4F3D"},children:o==null?void 0:o.email})]}),l.jsx("button",{onClick:S,className:"p-2 rounded-lg transition-all shrink-0",style:{color:"#5C4F3D"},onMouseEnter:z=>{z.currentTarget.style.color="#dc2626",z.currentTarget.style.backgroundColor="#fee2e2"},onMouseLeave:z=>{z.currentTarget.style.color="#5C4F3D",z.currentTarget.style.backgroundColor="transparent"},title:"Logout",children:l.jsx(gk,{className:"w-5 h-5"})})]})})]})}),x&&l.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 lg:hidden",onClick:()=>T(!1)}),l.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[l.jsx("header",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center justify-between px-3 md:px-4 lg:px-8 py-3 md:py-4",children:[l.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 md:flex-none",children:[l.jsxs(Ut,{to:O,className:"lg:hidden flex items-center gap-2 flex-shrink-0",children:[l.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(Hn,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"text-sm font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsx("h1",{className:"text-base md:text-lg font-semibold hidden sm:block",style:{color:"#2C2416"},children:((V=N.find(z=>z.path===y.pathname))==null?void 0:V.label)||"Dashboard"})]}),l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 overflow-hidden",children:[l.jsx("div",{className:"hidden md:flex items-center",children:l.jsxs("div",{className:"relative",children:[l.jsx(RS,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",placeholder:"Search...",className:"w-48 pl-10 pr-4 py-2 rounded-xl text-sm focus:outline-none",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"}})]})}),l.jsxs("button",{className:"relative p-2 rounded-xl transition-all flex-shrink-0",style:{color:"#5C4F3D"},children:[l.jsx(vTe,{className:"w-5 h-5"}),l.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]}),l.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold text-sm",children:(B=(G=o==null?void 0:o.name)==null?void 0:G[0])==null?void 0:B.toUpperCase()})})]})]})}),l.jsx("main",{className:"flex-1 main-content-mobile overflow-x-hidden w-full",style:y.pathname==="/nutrition"||y.pathname==="/ai-chat"?{padding:0,backgroundColor:"white"}:y.pathname==="/dashboard"?{padding:0}:{padding:"0.75rem"},children:e}),!h()&&!f()&&!n&&!a&&l.jsx(GTe,{})]}),y.pathname!=="/ai-chat"&&l.jsx(BTe,{})]})}function zTe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(!1),[d,h]=Y.useState(!1);Y.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){h(!0);return}const b=T=>{T.preventDefault(),n(T);const N=window.innerWidth<768?500:3e3,O=setTimeout(()=>{o(!0)},N);return()=>clearTimeout(O)},x=()=>{h(!0),o(!1),n(null),et.success("App installed successfully!")};return window.addEventListener("beforeinstallprompt",b),window.addEventListener("appinstalled",x),()=>{window.removeEventListener("beforeinstallprompt",b),window.removeEventListener("appinstalled",x)}},[]);const f=async()=>{if(!e)return;e.prompt();const{outcome:b}=await e.userChoice;b==="accepted"&&et.success("Installing HealthAI app..."),n(null),o(!1)},y=()=>{o(!1)};return d||!a||!e?null:l.jsx("div",{className:"fixed bottom-24 md:bottom-8 right-4 md:right-8 z-40 animate-slide-up",children:l.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-[#E5DFD3] p-4 md:p-6 max-w-sm",children:[l.jsxs("div",{className:"flex items-start justify-between mb-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center flex-shrink-0",children:l.jsx($J,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-[#2C2416] text-sm md:text-base",children:"Install HealthAI"}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Add to your home screen"})]})]}),l.jsx("button",{onClick:y,className:"text-[#5C4F3D] hover:text-[#2C2416] flex-shrink-0",children:l.jsx(bi,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D] mb-4",children:"Get quick access to your health data and features offline"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all text-sm md:text-base",children:"Install"}),l.jsx("button",{onClick:y,className:"flex-1 px-4 py-2 bg-[#F5F1EA] text-[#2C2416] rounded-xl font-medium hover:bg-[#E5DFD3] transition-all text-sm md:text-base",children:"Later"})]})]})})}const KTe=()=>{const[e,n]=Y.useState(!1),[a,o]=Y.useState(!1),d=Y.useRef(null);return Y.useEffect(()=>{const h=f=>{d.current&&!d.current.contains(f.target)&&o(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),l.jsx("header",{className:"fixed top-5 z-50 left-1/2 -translate-x-1/2 w-[calc(100%-200px)] max-w-5xl max-md:w-[calc(100%-40px)]",children:l.jsx("div",{className:"bg-white/50 backdrop-blur-3xl rounded-[28px] border border-white/60 shadow-2xl shadow-black/10",children:l.jsxs("div",{className:"px-6 lg:px-8",children:[l.jsxs("div",{className:"flex items-center justify-between h-16",children:[l.jsxs("nav",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Showcase"})]}),l.jsx(Ut,{to:"/",className:"absolute left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"text-xl lg:text-2xl font-serif text-[#2C2416]",children:"HealthAI"})}),l.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"FAQ"}),l.jsxs("div",{className:"relative",ref:d,children:[l.jsx("button",{onClick:()=>o(!a),className:"w-10 h-10 rounded-full bg-[#8B7355] flex items-center justify-center hover:bg-[#6F5A43] transition-colors ml-2",children:l.jsx(Bc,{className:"w-5 h-5 text-white"})}),a&&l.jsxs("div",{className:"absolute right-0 mt-3 w-48 bg-white/90 backdrop-blur-2xl rounded-2xl shadow-xl border border-white/40 py-2 animate-fade-in",children:[l.jsx(Ut,{to:"/login",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Sign In"}),l.jsx(Ut,{to:"/register",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Get Started"})]})]})]}),l.jsx("button",{className:"lg:hidden p-2 text-[#5C4F3D] ml-auto",onClick:()=>n(!e),children:e?l.jsx(bi,{className:"w-6 h-6"}):l.jsx(KJ,{className:"w-6 h-6"})})]}),e&&l.jsx("div",{className:"lg:hidden py-6 border-t border-white/20",children:l.jsxs("nav",{className:"flex flex-col gap-4",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Showcase"}),l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"FAQ"}),l.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-white/20",children:[l.jsx(Ut,{to:"/login",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Sign In"}),l.jsx(Ut,{to:"/register",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Get Started"})]})]})})]})})})},YTe=()=>l.jsxs("div",{className:"relative min-h-screen flex items-center overflow-hidden bg-[#F5F1EA]",children:[l.jsxs("div",{className:"absolute inset-0 z-0",children:[l.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",children:[l.jsx("source",{src:"https://cdn.shopify.com/videos/c/o/v/dcb48db72fdb4641a2af2df51c03aad5.mp4",type:"video/mp4"}),l.jsx("img",{src:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1920&h=1080&fit=crop",alt:"Healthcare",className:"w-full h-full object-cover"})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/70 via-white/30 to-transparent lg:from-white/60 lg:via-white/20 lg:to-transparent"})]}),l.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-32",children:l.jsxs("div",{className:"max-w-xl lg:max-w-2xl text-center lg:text-left",children:[l.jsx("p",{className:"text-xs sm:text-sm uppercase tracking-[0.2em] text-black mb-6 font-medium",children:"SMART NUTRITION TRACKING"}),l.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-serif text-black mb-6 leading-[1.1]",children:["Track calories.",l.jsx("br",{}),l.jsx("span",{className:"italic",children:"Naturally"})," healthy."]}),l.jsx("p",{className:"text-base sm:text-lg md:text-xl text-black mb-10 leading-relaxed max-w-lg",children:"Discover nutrition tracking that works with you. AI-powered insights, personalized meal plans, effortless calorie counting."}),l.jsxs(Ut,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-[#8B7355] text-white rounded-full font-medium hover:bg-[#6F5A43] transition-all group shadow-lg",children:["Start Tracking",l.jsx(wa,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})}),l.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-10",children:[l.jsx("span",{className:"text-xs uppercase tracking-wider text-black font-medium",children:"SCROLL"}),l.jsx("div",{className:"w-px h-12 bg-black/30"})]})]}),qTe=()=>{const e=[{icon:Hn,title:"Calorie Tracking",description:"Effortless daily tracking"},{icon:ua,title:"Progress Analytics",description:"Real-time health insights"},{icon:Dl,title:"Goal Setting",description:"Personalized targets"},{icon:fr,title:"Wellness Plans",description:"AI-powered recommendations"}];return l.jsx("section",{id:"features",className:"py-20 bg-[#F5F1EA]",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6",children:l.jsx(o,{className:"w-12 h-12 text-[#8B7355] stroke-[1.5]"})}),l.jsx("h3",{className:"text-lg font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})})})},XTe=()=>l.jsx("section",{className:"bg-[#8B7355] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsxs("div",{className:"relative rounded-3xl overflow-hidden group",children:[l.jsx("img",{src:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800&h=600&fit=crop",alt:"AI-Powered Nutrition",className:"w-full h-full object-cover min-h-[400px]"}),l.jsxs("div",{className:"absolute bottom-8 left-8 right-8 bg-white/95 backdrop-blur-sm rounded-2xl p-6",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"AI-Powered Nutrition"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Smart meal recognition and instant calorie calculation with advanced AI technology."})]})]}),l.jsxs("div",{className:"flex flex-col gap-8",children:[l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"Track Everything"}),l.jsx("h4",{className:"text-xl font-serif text-[#2C2416] mb-4",children:"Achieve Anything"}),l.jsxs("ul",{className:"space-y-2 text-sm text-[#5C4F3D]",children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Calorie & Macro Tracking"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Meal Planning & Recipes"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Progress Analytics"]})]})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=400&fit=crop",alt:"Healthy Food",className:"w-48 h-64 object-cover rounded-2xl"})})]})}),l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx("div",{className:"w-16 h-16 rounded-full bg-white flex items-center justify-center",children:l.jsx(JJ,{className:"w-8 h-8 text-[#8B7355]"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-xl font-serif text-[#2C2416] mb-2",children:"Mobile App"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Track on-the-go with our iOS & Android app"})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=200&h=200&fit=crop",alt:"Mobile App",className:"w-32 h-32 object-cover rounded-xl"})})]})})]})]})})}),JTe=()=>{const e=[{icon:Hn,title:"Smart Tracking",description:"AI-powered meal recognition and logging"},{icon:ua,title:"Progress Insights",description:"Real-time analytics and trends"},{icon:Dl,title:"Goal Achievement",description:"Personalized nutrition targets"},{icon:hf,title:"Expert Support",description:"Nutritionist-approved guidance"}];return l.jsx("section",{className:"bg-[#F5F1EA] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid lg:grid-cols-2 gap-16 items-center",children:[l.jsx("div",{className:"relative",children:l.jsx("div",{className:"rounded-3xl overflow-hidden",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=800&h=1000&fit=crop",alt:"Healthy Nutrition",className:"w-full h-full object-cover"})})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm uppercase tracking-[0.2em] text-[#8B7355] mb-4 font-medium",children:"WHY HEALTHAI"}),l.jsxs("h2",{className:"text-4xl md:text-5xl font-serif text-[#2C2416] mb-6 leading-tight",children:["Nutrition that",l.jsx("br",{}),"works for you."]}),l.jsx("p",{className:"text-lg text-[#5C4F3D] mb-8 leading-relaxed",children:"We believe nutrition tracking should be simple, not stressful. Every feature is designed with your health goals in mind, powered by AI for effortless tracking."}),l.jsx("div",{className:"grid grid-cols-2 gap-6",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"bg-white rounded-2xl p-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-full bg-[#F5F1EA] flex items-center justify-center mb-4",children:l.jsx(o,{className:"w-6 h-6 text-[#8B7355]"})}),l.jsx("h3",{className:"text-base font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})]})]})})})},QTe=()=>{const[e,n]=Y.useState(0),a=Y.useRef(null),o=[{title:"Track Your Health Metrics",description:"Monitor vital signs, lab results, and health trends all in one place with AI-powered insights.",phoneScreen:"dashboard",cards:[{icon:fr,title:"Heart Rate",value:"72 bpm",color:"rose",position:"left-top"},{icon:Hn,title:"Blood Pressure",value:"120/80",color:"blue",position:"left-bottom"},{icon:ua,title:"Health Score",value:"85/100",color:"emerald",position:"right-top"},{icon:tu,title:"Vitamin D",value:"45 ng/mL",color:"amber",position:"right-bottom"}]},{title:"Smart Nutrition Tracking",description:"Track your meals and get actionable feedback that helps you build a better relationship with food.",phoneScreen:"nutrition",cards:[{icon:kl,title:"Today's Meals",value:"3 logged",color:"emerald",position:"left-top"},{icon:Hn,title:"Calories",value:"1,850 kcal",color:"orange",position:"left-bottom"},{icon:ua,title:"Protein",value:"95g",color:"blue",position:"right-top"},{icon:fr,title:"Macro Balance",value:"Optimal",color:"purple",position:"right-bottom"}]},{title:"AI-Powered Health Insights",description:"Get personalized recommendations based on your medical reports and wearable data.",phoneScreen:"ai-chat",cards:[{icon:Xd,title:"AI Assistant",value:"24/7 Available",color:"cyan",position:"left-top"},{icon:ua,title:"Insights",value:"12 new",color:"indigo",position:"left-bottom"},{icon:qr,title:"Reminders",value:"5 today",color:"pink",position:"right-top"},{icon:fr,title:"Health Tips",value:"Updated",color:"red",position:"right-bottom"}]},{title:"Sleep & Recovery Tracking",description:"Improve your sleep by understanding patterns, identifying disruptions, and building habits.",phoneScreen:"sleep",cards:[{icon:zf,title:"Sleep Quality",value:"85%",color:"indigo",position:"left-top"},{icon:Hn,title:"Sleep Duration",value:"7h 45m",color:"blue",position:"left-bottom"},{icon:ua,title:"Deep Sleep",value:"2h 15m",color:"purple",position:"right-top"},{icon:fr,title:"REM Sleep",value:"1h 30m",color:"pink",position:"right-bottom"}]}];Y.useEffect(()=>{const y=()=>{if(!a.current)return;const b=a.current,{top:x,height:T}=b.getBoundingClientRect(),S=window.innerHeight,N=(S/2-x)/(T-S/2),O=Math.max(0,Math.min(1,N)),A=Math.floor(O*o.length),I=Math.min(A,o.length-1);n(I)};return window.addEventListener("scroll",y),y(),()=>window.removeEventListener("scroll",y)},[o.length]);const d=y=>({"left-top":"left-[1%] sm:left-[3%] md:left-[8%] top-[8%] sm:top-[10%] md:top-[12%]","left-bottom":"left-[1%] sm:left-[5%] md:left-[10%] bottom-[12%] sm:bottom-[15%] md:bottom-[18%]","right-top":"right-[1%] sm:right-[3%] md:right-[8%] top-[14%] sm:top-[16%] md:top-[18%]","right-bottom":"right-[1%] sm:right-[5%] md:right-[10%] bottom-[6%] sm:bottom-[9%] md:bottom-[12%]"})[y]||"left-[10%] top-[20%]",h=(y,b)=>({"left-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 translate-y-16 scale-75","left-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 -translate-y-16 scale-75","right-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 translate-y-16 scale-75","right-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 -translate-y-16 scale-75"})[y],f=y=>({dashboard:"from-blue-500 to-cyan-500",nutrition:"from-emerald-500 to-green-500","ai-chat":"from-purple-500 to-pink-500",sleep:"from-indigo-500 to-blue-500"})[y]||"from-cyan-500 to-blue-500";return l.jsx("div",{id:"showcase",ref:a,className:"relative bg-[#F5F1EA]",style:{height:`${o.length*100}vh`},children:l.jsx("div",{className:"sticky top-0 h-screen flex items-center justify-center overflow-hidden pt-20 sm:pt-24 px-2 sm:px-4",children:l.jsx("div",{className:"relative w-full max-w-7xl mx-auto",children:l.jsxs("div",{className:"relative flex flex-col items-center",children:[l.jsxs("div",{className:"text-center mb-8 sm:mb-12 max-w-2xl px-4 transition-all duration-700 transform relative z-30",children:[l.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-[#2C2416] mb-3 sm:mb-4 leading-tight",children:o[e].title}),l.jsx("p",{className:"text-[#5C4F3D] text-sm sm:text-base md:text-lg leading-relaxed",children:o[e].description})]}),l.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",children:o[e].cards.map((y,b)=>{const x=y.icon,T={rose:{bg:"bg-rose-50",icon:"text-rose-500",value:"text-rose-600",border:"border-rose-100"},blue:{bg:"bg-blue-50",icon:"text-blue-500",value:"text-blue-600",border:"border-blue-100"},emerald:{bg:"bg-emerald-50",icon:"text-emerald-500",value:"text-emerald-600",border:"border-emerald-100"},amber:{bg:"bg-amber-50",icon:"text-amber-500",value:"text-amber-600",border:"border-amber-100"},orange:{bg:"bg-orange-50",icon:"text-orange-500",value:"text-orange-600",border:"border-orange-100"},purple:{bg:"bg-purple-50",icon:"text-purple-500",value:"text-purple-600",border:"border-purple-100"},cyan:{bg:"bg-cyan-50",icon:"text-cyan-500",value:"text-cyan-600",border:"border-cyan-100"},indigo:{bg:"bg-indigo-50",icon:"text-indigo-500",value:"text-indigo-600",border:"border-indigo-100"},pink:{bg:"bg-pink-50",icon:"text-pink-500",value:"text-pink-600",border:"border-pink-100"},red:{bg:"bg-red-50",icon:"text-red-500",value:"text-red-600",border:"border-red-100"}},S=T[y.color]||T.blue;return l.jsx("div",{className:`absolute ${d(y.position)} ${h(y.position,!0)} 
                      transition-all duration-1000 ease-out`,style:{transitionDelay:`${b*150}ms`},children:l.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-4 md:p-6 border ${S.border} 
                      hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 w-32 sm:w-40 md:w-48`,children:[l.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-lg sm:rounded-xl ${S.bg} flex items-center justify-center mb-2 sm:mb-3`,children:l.jsx(x,{className:`w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 ${S.icon}`,strokeWidth:2})}),l.jsx("h4",{className:"text-[#2C2416] font-medium text-xs sm:text-sm md:text-base mb-1 leading-tight",children:y.title}),l.jsx("p",{className:`${S.value} font-bold text-base sm:text-lg md:text-xl`,children:y.value})]})},b)})}),l.jsxs("div",{className:"relative transform perspective-1000 z-20",children:[l.jsxs("div",{className:"relative w-[240px] sm:w-[280px] md:w-[320px] lg:w-[340px] h-[480px] sm:h-[560px] md:h-[640px] lg:h-[680px] bg-slate-900 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] p-2 sm:p-3 shadow-2xl",children:[l.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-28 sm:w-32 md:w-36 h-5 sm:h-6 md:h-7 bg-slate-900 rounded-b-2xl sm:rounded-b-3xl z-10"}),l.jsx("div",{className:"relative w-full h-full bg-white rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] overflow-hidden",children:l.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${f(o[e].phoneScreen)} 
                    transition-all duration-1000 ease-in-out`,children:[l.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 md:px-6 pt-2 sm:pt-3 text-white text-[10px] sm:text-xs",children:[l.jsx("span",{children:"9:41"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-3 h-2 sm:w-4 sm:h-3 border border-white rounded-sm"}),l.jsx("div",{className:"w-0.5 h-2 sm:w-1 sm:h-3 bg-white rounded-sm"})]})]}),l.jsxs("div",{className:"px-4 sm:px-5 md:px-6 pt-6 sm:pt-7 md:pt-8",children:[l.jsxs("h3",{className:"text-white text-lg sm:text-xl md:text-2xl font-bold",children:[o[e].phoneScreen==="dashboard"&&"Dashboard",o[e].phoneScreen==="nutrition"&&"Nutrition",o[e].phoneScreen==="ai-chat"&&"AI Assistant",o[e].phoneScreen==="sleep"&&"Sleep"]}),l.jsx("p",{className:"text-white/80 text-[10px] sm:text-xs md:text-sm mt-1",children:new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsx("div",{className:`absolute inset-x-4 sm:inset-x-5 md:inset-x-6 top-24 sm:top-28 md:top-32 bottom-4 sm:bottom-5 md:bottom-6 bg-white/10 backdrop-blur-md rounded-2xl sm:rounded-3xl border border-white/20 p-4 sm:p-5 md:p-6 \r
                      transition-all duration-1000 shadow-inner`,children:l.jsx("div",{className:"space-y-3 sm:space-y-4",children:[1,2,3].map(y=>l.jsx("div",{className:"bg-white/20 rounded-xl sm:rounded-2xl h-14 sm:h-16 md:h-20 animate-pulse shadow-lg",style:{animationDelay:`${y*200}ms`,animationDuration:"2s"}},y))})})]})})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/10 to-slate-900/30 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] -z-10 blur-2xl sm:blur-3xl transform scale-105"})]})]})})})})},ZTe=()=>l.jsx("section",{className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"mb-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] flex items-center justify-center",children:[l.jsxs("div",{className:"relative z-10 text-center px-8 py-16",children:[l.jsxs("h2",{className:"text-4xl md:text-5xl lg:text-6xl font-serif text-white mb-6 leading-tight",children:["Access personalized",l.jsx("br",{}),"nutrition tracking"]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 mt-8",children:[l.jsxs(Ut,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:["Get started",l.jsx(wa,{className:"w-5 h-5"})]}),l.jsx("button",{className:"inline-flex items-center gap-2 px-8 py-4 bg-white/20 backdrop-blur-md text-white rounded-full font-medium hover:bg-white/30 transition-all border border-white/30",children:"See if I'm eligible"})]})]}),l.jsx("svg",{className:"absolute bottom-0 left-0 w-full h-32 opacity-20",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:l.jsx("path",{d:"M0,50 Q300,10 600,50 T1200,50 L1200,120 L0,120 Z",fill:"currentColor",className:"text-[#6F5A43]"})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Track your health,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"stay on track"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Monitor your daily nutrition intake with AI-powered insights to help you maintain optimal health."}),l.jsxs(Ut,{to:"/register",className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:["Get started ",l.jsx(wa,{className:"w-5 h-5"})]})]}),l.jsx("div",{className:"mt-8 flex items-center justify-center",children:l.jsx("div",{className:"w-32 h-32 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/20",children:l.jsx(Hn,{className:"w-16 h-16 text-white"})})})]})}),l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Eat healthy,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"get strong"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Find nutritional, protein-packed meal plans to help you maintain muscle mass and achieve your goals."}),l.jsxs("button",{className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:[l.jsx("span",{className:"w-5 h-5 rounded-full border border-white flex items-center justify-center",children:l.jsx("span",{className:"text-xs",children:"i"})}),"Learn more about nutrition"]})]}),l.jsx("div",{className:"mt-8 grid grid-cols-4 gap-2",children:[...Array(8)].map((e,n)=>l.jsx("div",{className:"aspect-square rounded-lg bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/10",children:l.jsx(so,{className:"w-6 h-6 text-white/60"})},n))})]})})]}),l.jsx("div",{className:"mt-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[400px] p-8 md:p-12",children:l.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-12 border border-white/20 shadow-2xl",children:l.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[l.jsxs("h3",{className:"text-3xl md:text-5xl font-serif text-white mb-4 leading-tight",children:["It's more than a plan,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"it's personal"})]}),l.jsx("p",{className:"text-white/90 text-base mb-8 max-w-2xl mx-auto",children:"A healthcare provider will review your information, so that they can combine guidance on nutrition, activity, sleep, and more into a plan designed around your body's needs."}),l.jsx(Ut,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:"Get started"})]})})})]})});function eCe(){const[e,n]=Y.useState(0),a=[{stars:5,quote:"HealthAI identified my vitamin D deficiency that my doctor missed. The personalized nutrition plan has completely transformed my energy levels and overall health. I feel like I have a personal health advisor in my pocket.",author:"Sarah Johnson",role:"Marketing Manager",location:"San Francisco",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"As a busy professional, I never had time to properly analyze my health reports. HealthAI does it instantly and gives me actionable insights. The doctor recommendations were spot-on and saved me months of searching.",author:"Michael Chen",role:"Software Engineer",location:"Seattle",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"The AI analysis caught early signs of metabolic issues that could have become serious. The preventive care recommendations and supplement guidance have been life-changing. This is the future of healthcare.",author:"Emily Rodriguez",role:"Fitness Instructor",location:"Austin",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face"}],o=()=>n(h=>(h+1)%a.length),d=()=>n(h=>(h-1+a.length)%a.length);return l.jsx("section",{id:"testimonials",className:"py-20 md:py-32 bg-[#F5F1EA]",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"Testimonials"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Hear from our users"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"Join thousands who've transformed their health with AI-powered insights."})]}),l.jsxs("div",{className:"max-w-4xl mx-auto",children:[l.jsxs("div",{className:"relative bg-white/60 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl border border-[#E5DFD3]",children:[l.jsx(DTe,{className:"absolute top-8 right-8 w-16 h-16 text-[#8B7355]/20"}),l.jsx("div",{className:"flex gap-1 mb-6",children:[...Array(a[e].stars)].map((h,f)=>l.jsx(qa,{className:"w-5 h-5 fill-amber-400 text-amber-400"},f))}),l.jsxs("blockquote",{className:"text-xl md:text-2xl text-[#2C2416] leading-relaxed mb-8 font-serif",children:['"',a[e].quote,'"']}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("img",{src:a[e].image,alt:a[e].author,className:"w-14 h-14 rounded-full object-cover border-2 border-[#E5DFD3]"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-[#2C2416]",children:a[e].author}),l.jsxs("p",{className:"text-sm text-[#5C4F3D]",children:[a[e].role,"  ",a[e].location]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mt-8",children:[l.jsx("button",{onClick:d,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(Ta,{className:"w-5 h-5 text-[#2C2416]"})}),l.jsx("div",{className:"flex gap-2",children:a.map((h,f)=>l.jsx("button",{onClick:()=>n(f),className:`w-2.5 h-2.5 rounded-full transition-colors ${f===e?"bg-[#8B7355]":"bg-[#E5DFD3] hover:bg-[#8B7355]/50"}`},f))}),l.jsx("button",{onClick:o,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(wa,{className:"w-5 h-5 text-[#2C2416]"})})]})]})]})})}function tCe(){const[e,n]=Y.useState(0),a=[{question:"What types of health reports can I upload?",answer:"HealthAI supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return l.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"FAQ"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Got questions?"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),l.jsx("div",{className:"space-y-4",children:a.map((o,d)=>l.jsxs("div",{className:"border border-[#E5DFD3] rounded-xl overflow-hidden bg-white/60 backdrop-blur-sm",children:[l.jsxs("button",{onClick:()=>n(e===d?null:d),className:"w-full flex items-center justify-between p-6 text-left",children:[l.jsx("span",{className:"text-lg font-medium text-[#2C2416] pr-4",children:o.question}),l.jsx(iT,{className:`w-5 h-5 text-[#5C4F3D] shrink-0 transition-transform duration-200 ${e===d?"rotate-180":""}`})]}),l.jsx("div",{className:`overflow-hidden transition-all duration-200 ${e===d?"max-h-96":"max-h-0"}`,children:l.jsx("p",{className:"px-6 pb-6 text-[#5C4F3D] leading-relaxed",children:o.answer})})]},d))})]})})}function nCe(){return l.jsx("section",{className:"py-20 md:py-32 bg-[#8B7355]",children:l.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Ready to transform your health with AI?"}),l.jsx("p",{className:"text-lg text-white/90 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),l.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[l.jsxs(Ut,{to:"/register",className:"bg-white text-[#8B7355] hover:bg-[#F5F1EA] rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2 shadow-lg",children:["Start your free analysis",l.jsx(wa,{className:"w-5 h-5"})]}),l.jsx(Ut,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border-2 border-white/40 text-white hover:bg-white/10 bg-transparent transition-all backdrop-blur-sm",children:"Talk to our team"})]}),l.jsx("p",{className:"text-sm text-white/80 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function rCe(){return l.jsx("footer",{className:"bg-[#2C2416] text-white py-16",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[l.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("div",{className:"w-8 h-8 bg-[#8B7355] rounded-xl flex items-center justify-center",children:l.jsx(Hn,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"font-serif text-xl",children:"HealthAI"})]}),l.jsx("p",{className:"text-white/60 text-sm mb-4",children:"AI-powered health insights for better living."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Features"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Pricing"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Mobile App"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"API"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"About"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Blog"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Careers"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Press"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Help Center"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Health Guides"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Find a Doctor"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Privacy Policy"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Terms of Service"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),l.jsxs("div",{className:"pt-8 border-t border-white/10 flex flex-col md:flex-row items-center justify-between gap-4",children:[l.jsx("p",{className:"text-sm text-white/60",children:" 2024 HealthAI. All rights reserved."}),l.jsx("p",{className:"text-sm text-white/60",children:"Made with  for better health"})]})]})})}function iCe(){return l.jsxs("div",{className:"min-h-screen bg-[#F5F1EA]",children:[l.jsx(KTe,{}),l.jsx(YTe,{}),l.jsx(qTe,{}),l.jsx(XTe,{}),l.jsx(JTe,{}),l.jsx(ZTe,{}),l.jsx(QTe,{}),l.jsx(eCe,{}),l.jsx(tCe,{}),l.jsx(nCe,{}),l.jsx(rCe,{})]})}function aCe(){const[e,n]=Y.useState(""),[a,o]=Y.useState(""),[d,h]=Y.useState(!1),[f,y]=Y.useState(!1),{login:b}=ma(),x=ns(),T=async S=>{var N,O,A;S.preventDefault(),y(!0);try{const I=await b(e,a);et.success("Welcome back!"),x(I.role==="admin"?"/admin":I.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(I){const P=((O=(N=I.response)==null?void 0:N.data)==null?void 0:O.message)||I.message||"Login failed";I.response?et.error(P):(et.error("Network error - Check if server is running and accessible"),console.error("Connection details:",{apiUrl:(A=I.config)==null?void 0:A.baseURL,host:window.location.hostname,port:window.location.port}))}finally{y(!1)}};return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center w-full p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Hn,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Welcome to HealthAI"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(Hn,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Sign In"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Access your health dashboard"})]}),l.jsxs("form",{onSubmit:T,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address"}),l.jsxs("div",{className:"relative",children:[l.jsx(z0,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:e,onChange:S=>n(S.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password"}),l.jsxs("div",{className:"relative",children:[l.jsx(IP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:d?"text":"password",value:a,onChange:S=>o(S.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>h(!d),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:d?l.jsx(HJ,{className:"w-5 h-5"}):l.jsx(Lh,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded",style:{borderColor:"#E5DFD3"}}),l.jsx("span",{className:"text-sm",style:{color:"#5C4F3D"},children:"Remember me"})]}),l.jsx("a",{href:"#",className:"text-sm font-medium",style:{color:"#8B7355"},children:"Forgot password?"})]}),l.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:f?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Sign In ",l.jsx(wa,{className:"w-5 h-5"})]})})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Don't have an account?"," ",l.jsx(Ut,{to:"/register",className:"font-semibold",style:{color:"#8B7355"},children:"Create one"})]}),l.jsx("div",{className:"mt-6 text-center",children:l.jsx(Ut,{to:"/register/doctor",className:"text-sm",style:{color:"#5C4F3D"},children:"Register as a Doctor "})})]})})]})}function sCe(){const[e,n]=Y.useState(1),[a,o]=Y.useState(null),[d,h]=Y.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",height:"",weight:"",bloodGroup:"",dietaryPreference:"non-vegetarian",activityLevel:"sedentary",chronicConditions:[],allergies:[],currentMedications:[],smoker:!1,smokingFrequency:"",alcohol:!1,alcoholFrequency:"",sleepHours:"7",stressLevel:"moderate",waterIntake:"8",nutritionGoal:"general_health",targetWeight:"",weeklyGoal:"0.5"}),[f,y]=Y.useState(!1),[b,x]=Y.useState(!1),[T,S]=Y.useState(""),[N,O]=Y.useState(""),[A,I]=Y.useState(""),{register:P}=ma(),L=ns(),F=ie=>{o(ie),ie==="doctor"?L("/register/doctor"):n(2)},V=async ie=>{var ue,re;if(ie.preventDefault(),d.password!==d.confirmPassword){et.error("Passwords do not match");return}if(!d.age||!d.gender){et.error("Please provide your age and gender");return}x(!0);try{const pe={age:parseInt(d.age),gender:d.gender,height:d.height?parseFloat(d.height):void 0,weight:d.weight?parseFloat(d.weight):void 0,bloodGroup:d.bloodGroup||void 0,dietaryPreference:d.dietaryPreference,activityLevel:d.activityLevel,medicalHistory:{conditions:d.chronicConditions,currentMedications:d.currentMedications},lifestyle:{smoker:d.smoker,smokingFrequency:d.smokingFrequency,alcohol:d.alcohol,alcoholFrequency:d.alcoholFrequency,sleepHours:parseInt(d.sleepHours),stressLevel:d.stressLevel,waterIntake:parseInt(d.waterIntake)},allergies:d.allergies},Se={goal:d.nutritionGoal,targetWeight:d.targetWeight?parseFloat(d.targetWeight):null,weeklyGoal:parseFloat(d.weeklyGoal)};await P(d.name,d.email,d.password,pe,Se),et.success("Account created successfully! Your personalized nutrition plan is ready."),L("/dashboard")}catch(pe){et.error(((re=(ue=pe.response)==null?void 0:ue.data)==null?void 0:re.message)||"Registration failed")}finally{x(!1)}},G=()=>{if(e===2){if(!d.name||!d.email||!d.password||!d.age||!d.gender){et.error("Please fill in all required fields");return}if(d.password!==d.confirmPassword){et.error("Passwords do not match");return}}if(e===3&&(!d.height||!d.weight)){et.error("Please provide your height and weight for accurate nutrition calculations");return}n(e+1)},B=()=>n(e-1),z=(ie,ue)=>{h(re=>({...re,[ie]:re[ie].includes(ue)?re[ie].filter(pe=>pe!==ue):[...re[ie],ue]}))},q=(ie,ue)=>{ue&&!d[ie].includes(ue)&&h(re=>({...re,[ie]:[...re[ie],ue]}))},Z=(ie,ue)=>{h(re=>({...re,[ie]:re[ie].filter(pe=>pe!==ue)}))};if(e===1)return l.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(Hn,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Join HealthAI"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Choose how you want to use our platform"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("button",{onClick:()=>F("patient"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(fr,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Patient"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Upload health reports, get AI-powered insights, personalized diet plans, and connect with doctors."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"AI Health Report Analysis"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Personalized Diet Plans"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Get Started ",l.jsx(wa,{className:"w-4 h-4 ml-2"})]})]}),l.jsxs("button",{onClick:()=>F("doctor"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(QJ,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Doctor"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Join our platform to provide consultations, manage appointments, and help patients."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Manage Your Schedule"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"View Patient Reports"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Apply Now ",l.jsx(wa,{className:"w-4 h-4 ml-2"})]})]})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(Ut,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})});if(e===2)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(fr,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:()=>n(1),className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Basic Information"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 1 of 4 - Let's start with the basics"})]}),l.jsxs("form",{onSubmit:ie=>{ie.preventDefault(),G()},className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Full Name *"}),l.jsxs("div",{className:"relative",children:[l.jsx(Bc,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",value:d.name,onChange:ie=>h({...d,name:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"John Doe",required:!0})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Age *"}),l.jsx("input",{type:"number",value:d.age,onChange:ie=>h({...d,age:ie.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"25",min:"1",max:"120",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Gender *"}),l.jsxs("select",{value:d.gender,onChange:ie=>h({...d,gender:ie.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"",children:"Select"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address *"}),l.jsxs("div",{className:"relative",children:[l.jsx(z0,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:d.email,onChange:ie=>h({...d,email:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(IP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:f?"text":"password",value:d.password,onChange:ie=>h({...d,password:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>y(!f),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:f?l.jsx(HJ,{className:"w-5 h-5"}):l.jsx(Lh,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Confirm Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(IP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"password",value:d.confirmPassword,onChange:ie=>h({...d,confirmPassword:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(wa,{className:"w-5 h-5"})]})]}),l.jsxs("p",{className:"text-center mt-6",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(Ut,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})})]});if(e===3)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(k7,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Health Profile"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us calculate your personalized nutrition goals based on your body metrics."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Health Profile"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 2 of 4 - Your body metrics"})]}),l.jsxs("form",{onSubmit:ie=>{ie.preventDefault(),G()},className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Height (cm) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(jTe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.height,onChange:ie=>h({...d,height:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"170",min:"100",max:"250",step:"0.1",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weight (kg) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(k7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.weight,onChange:ie=>h({...d,weight:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"70",min:"30",max:"300",step:"0.1",required:!0})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Blood Group"}),l.jsxs("div",{className:"relative",children:[l.jsx(A7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsxs("select",{value:d.bloodGroup,onChange:ie=>h({...d,bloodGroup:ie.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select (Optional)"}),l.jsx("option",{value:"A+",children:"A+"}),l.jsx("option",{value:"A-",children:"A-"}),l.jsx("option",{value:"B+",children:"B+"}),l.jsx("option",{value:"B-",children:"B-"}),l.jsx("option",{value:"AB+",children:"AB+"}),l.jsx("option",{value:"AB-",children:"AB-"}),l.jsx("option",{value:"O+",children:"O+"}),l.jsx("option",{value:"O-",children:"O-"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Dietary Preference *"}),l.jsxs("select",{value:d.dietaryPreference,onChange:ie=>h({...d,dietaryPreference:ie.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"This helps us recommend suitable diet plans"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Activity Level *"}),l.jsxs("select",{value:d.activityLevel,onChange:ie=>h({...d,activityLevel:ie.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"lightly_active",children:"Lightly Active (1-3 days/week)"}),l.jsx("option",{value:"moderately_active",children:"Moderately Active (3-5 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (6-7 days/week)"}),l.jsx("option",{value:"extremely_active",children:"Extremely Active (Athlete)"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"Used to calculate your daily calorie needs"})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(wa,{className:"w-5 h-5"})]})]})]})})]});if(e===4){const ie=["Diabetes","Hypertension","Thyroid","Asthma","Heart Disease","Arthritis"],ue=["Peanuts","Dairy","Gluten","Shellfish","Eggs","Soy"];return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(fr,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Lifestyle & Health History"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us understand your lifestyle and medical background for better recommendations."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Lifestyle & Medical History"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 3 of 4 - Optional but recommended"})]}),l.jsxs("form",{onSubmit:re=>{re.preventDefault(),G()},className:"space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Lifestyle Habits"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(STe,{className:"w-4 h-4"}),"Do you smoke?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.smoker,onChange:()=>h({...d,smoker:!1,smokingFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.smoker,onChange:()=>h({...d,smoker:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.smoker&&l.jsxs("select",{value:d.smokingFrequency,onChange:re=>h({...d,smokingFrequency:re.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 times/week)"}),l.jsx("option",{value:"regular",children:"Regular (3-6 times/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (Daily)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(VTe,{className:"w-4 h-4"}),"Do you consume alcohol?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.alcohol,onChange:()=>h({...d,alcohol:!1,alcoholFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.alcohol,onChange:()=>h({...d,alcohol:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.alcohol&&l.jsxs("select",{value:d.alcoholFrequency,onChange:re=>h({...d,alcoholFrequency:re.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 drinks/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (3-7 drinks/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (8+ drinks/week)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(zf,{className:"w-4 h-4"}),"Average sleep hours per night: ",d.sleepHours,"h"]}),l.jsx("input",{type:"range",min:"4",max:"12",value:d.sleepHours,onChange:re=>h({...d,sleepHours:re.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"4h"}),l.jsx("span",{children:"12h"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(A7,{className:"w-4 h-4"}),"Water intake (glasses/day): ",d.waterIntake]}),l.jsx("input",{type:"range",min:"1",max:"15",value:d.waterIntake,onChange:re=>h({...d,waterIntake:re.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"1"}),l.jsx("span",{children:"15"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Stress Level"}),l.jsxs("select",{value:d.stressLevel,onChange:re=>h({...d,stressLevel:re.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"low",children:"Low"}),l.jsx("option",{value:"moderate",children:"Moderate"}),l.jsx("option",{value:"high",children:"High"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Medical History (Optional)"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ie.map(re=>l.jsx("button",{type:"button",onClick:()=>z("chronicConditions",re),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${d.chronicConditions.includes(re)?"text-white":""}`,style:{backgroundColor:d.chronicConditions.includes(re)?"#8B7355":"#F5F1EA",color:d.chronicConditions.includes(re)?"white":"#5C4F3D"},children:re},re))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:T,onChange:re=>S(re.target.value),placeholder:"Add custom condition",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:re=>{re.key==="Enter"&&(re.preventDefault(),q("chronicConditions",T),S(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("chronicConditions",T),S("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Uc,{className:"w-4 h-4"})})]}),d.chronicConditions.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.chronicConditions.map(re=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[re,l.jsx("button",{type:"button",onClick:()=>Z("chronicConditions",re),children:l.jsx(bi,{className:"w-3 h-3"})})]},re))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ue.map(re=>l.jsx("button",{type:"button",onClick:()=>z("allergies",re),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors",style:{backgroundColor:d.allergies.includes(re)?"#8B7355":"#F5F1EA",color:d.allergies.includes(re)?"white":"#5C4F3D"},children:re},re))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:A,onChange:re=>I(re.target.value),placeholder:"Add custom allergy",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:re=>{re.key==="Enter"&&(re.preventDefault(),q("allergies",A),I(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("allergies",A),I("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Uc,{className:"w-4 h-4"})})]}),d.allergies.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.allergies.map(re=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[re,l.jsx("button",{type:"button",onClick:()=>Z("allergies",re),children:l.jsx(bi,{className:"w-3 h-3"})})]},re))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Current Medications"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:re=>O(re.target.value),placeholder:"Add medication",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:re=>{re.key==="Enter"&&(re.preventDefault(),q("currentMedications",N),O(""))}}),l.jsx("button",{type:"button",onClick:()=>{q("currentMedications",N),O("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Uc,{className:"w-4 h-4"})})]}),d.currentMedications.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.currentMedications.map(re=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[re,l.jsx("button",{type:"button",onClick:()=>Z("currentMedications",re),children:l.jsx(bi,{className:"w-3 h-3"})})]},re))})]})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(wa,{className:"w-5 h-5"})]})]})]})})]})}if(e===5){const ue=(()=>{if(!d.targetWeight||!d.weight)return null;const re=Math.abs(parseFloat(d.targetWeight)-parseFloat(d.weight));return Math.ceil(re/parseFloat(d.weeklyGoal))})();return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Dl,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Set Your Goals"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"We'll calculate your personalized nutrition plan based on your goals."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Your Nutrition Goals"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 4 of 4 - Almost done!"})]}),l.jsxs("form",{onSubmit:V,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"#2C2416"},children:"What's your primary goal?"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("button",{type:"button",onClick:()=>h({...d,nutritionGoal:"weight_loss"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_loss"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_loss"?"#F5F1EA":"white"},children:[l.jsx(ZJ,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_loss"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Loss"})]}),l.jsxs("button",{type:"button",onClick:()=>h({...d,nutritionGoal:"weight_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_gain"?"#F5F1EA":"white"},children:[l.jsx(ua,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>h({...d,nutritionGoal:"muscle_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="muscle_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="muscle_gain"?"#F5F1EA":"white"},children:[l.jsx(qy,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="muscle_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Muscle Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>h({...d,nutritionGoal:"maintain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="maintain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="maintain"?"#F5F1EA":"white"},children:[l.jsx(vk,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="maintain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Maintain"})]}),l.jsxs("button",{type:"button",onClick:()=>h({...d,nutritionGoal:"general_health"}),className:"p-4 rounded-xl border-2 transition-all col-span-2",style:{borderColor:d.nutritionGoal==="general_health"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="general_health"?"#F5F1EA":"white"},children:[l.jsx(fr,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="general_health"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"General Health"})]})]})]}),(d.nutritionGoal==="weight_loss"||d.nutritionGoal==="weight_gain")&&l.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-4",style:{border:"1px solid #E5DFD3"},children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Target Weight (kg)"}),l.jsx("input",{type:"number",value:d.targetWeight,onChange:re=>h({...d,targetWeight:re.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:d.weight,min:"30",max:"300",step:"0.1"}),l.jsxs("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:["Current: ",d.weight," kg"]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weekly Goal"}),l.jsxs("select",{value:d.weeklyGoal,onChange:re=>h({...d,weeklyGoal:re.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"0.25",children:"0.25 kg/week (Slow & Steady)"}),l.jsx("option",{value:"0.5",children:"0.5 kg/week (Recommended)"}),l.jsx("option",{value:"1",children:"1 kg/week (Aggressive)"})]})]}),ue&&l.jsx("div",{className:"rounded-lg p-3",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("p",{className:"text-sm",style:{color:"#8B7355"},children:[l.jsx("strong",{children:"Estimated time:"})," ",ue," weeks (",Math.ceil(ue/4)," months)"]})})]}),l.jsx("div",{className:"rounded-xl p-4",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3"},children:l.jsxs("p",{className:"text-sm",style:{color:"#5C4F3D"},children:[l.jsx("strong",{style:{color:"#2C2416"},children:"What happens next?"})," We'll calculate your personalized daily calorie and macro goals based on your profile and goals. You can adjust these anytime from your nutrition dashboard."]})}),l.jsx("button",{type:"submit",disabled:b,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:b?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Create Account & Calculate Goals ",l.jsx(wa,{className:"w-5 h-5"})]})})]})]})})]})}return null}const oCe=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],j7=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function cCe(){const{registerDoctor:e}=ma(),n=ns(),[a,o]=Y.useState(!1),[d,h]=Y.useState(1),[f,y]=Y.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[b,x]=Y.useState({}),T=A=>{y({...f,[A.target.name]:A.target.value})},S=(A,I)=>{I&&x(P=>({...P,[A]:{file:I,name:I.name,size:(I.size/1024).toFixed(1)+" KB"}}))},N=A=>{x(I=>{const P={...I};return delete P[A],P})},O=async A=>{var P,L;if(A.preventDefault(),f.password!==f.confirmPassword){et.error("Passwords do not match");return}const I=j7.filter(F=>!b[F.id]);if(I.length>0){et.error(`Please upload: ${I.map(F=>F.name).join(", ")}`);return}o(!0);try{const F=Object.entries(b).map(([V,G])=>({name:G.name,type:V,url:`pending_upload_${V}`}));await e({...f,qualifications:f.qualifications.split(",").map(V=>V.trim()).filter(Boolean),experience:parseInt(f.experience),consultationFee:parseInt(f.consultationFee)||500,documents:F}),et.success("Registration successful! Your profile is pending approval."),n("/doctor/dashboard")}catch(F){et.error(((L=(P=F.response)==null?void 0:P.data)==null?void 0:L.message)||"Registration failed")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs(Ut,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center",children:l.jsx(Hn,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),l.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),l.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(A=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${d>=A?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:A}),l.jsx("span",{className:`text-sm hidden sm:block ${d>=A?"text-cyan-600 font-medium":"text-slate-400"}`,children:A===1?"Account":A===2?"Professional":"Documents"}),A<3&&l.jsx("div",{className:`w-8 h-1 rounded ${d>A?"bg-cyan-500":"bg-slate-200"}`})]},A))}),l.jsxs("form",{onSubmit:O,children:[d===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:f.name,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",name:"email",value:f.email,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),l.jsx("input",{type:"tel",name:"phone",value:f.phone,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),l.jsx("input",{type:"password",name:"password",value:f.password,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),l.jsx("input",{type:"password",name:"confirmPassword",value:f.confirmPassword,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),l.jsx("button",{type:"button",onClick:()=>h(2),className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),d===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),l.jsxs("select",{name:"specialization",value:f.specialization,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[l.jsx("option",{value:"",children:"Select specialization"}),oCe.map(A=>l.jsx("option",{value:A,children:A},A))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),l.jsx("input",{type:"number",name:"experience",value:f.experience,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),l.jsx("input",{type:"text",name:"licenseNumber",value:f.licenseNumber,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),l.jsx("input",{type:"text",name:"qualifications",value:f.qualifications,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",name:"hospital",value:f.hospital,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),l.jsx("input",{type:"number",name:"consultationFee",value:f.consultationFee,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4",children:[l.jsxs("button",{type:"button",onClick:()=>h(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"button",onClick:()=>h(3),className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),d===3&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:l.jsxs("p",{className:"text-sm text-amber-800",children:[l.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),j7.map(A=>l.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("h4",{className:"font-medium text-slate-800",children:[A.name," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:A.description})]}),b[A.id]?l.jsx(Xr,{className:"w-5 h-5 text-green-500"}):null]}),b[A.id]?l.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Vn,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-slate-700",children:b[A.id].name}),l.jsx("p",{className:"text-xs text-slate-500",children:b[A.id].size})]})]}),l.jsx("button",{type:"button",onClick:()=>N(A.id),className:"p-1 text-slate-400 hover:text-red-500",children:l.jsx(bi,{className:"w-4 h-4"})})]}):l.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[l.jsx(Ts,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),l.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:I=>S(A.id,I.target.files[0])})]})]},A.id)),l.jsxs("div",{className:"flex gap-3 mt-6",children:[l.jsxs("button",{type:"button",onClick:()=>h(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"submit",disabled:a,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:a?"Submitting...":"Submit Application"})]})]})]}),l.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",l.jsx(Ut,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),l.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[l.jsx(QJ,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}const Kv="healthai_cache_",lCe=5*60*1e3,Oc={set(e,n,a=lCe){try{const o={value:n,expiry:Date.now()+a};localStorage.setItem(Kv+e,JSON.stringify(o))}catch(o){console.error("Cache set error:",o)}},get(e){try{const n=localStorage.getItem(Kv+e);if(!n)return null;const a=JSON.parse(n);return Date.now()>a.expiry?(this.delete(e),null):a.value}catch(n){return console.error("Cache get error:",n),null}},delete(e){try{localStorage.removeItem(Kv+e)}catch(n){console.error("Cache delete error:",n)}},clear(){try{Object.keys(localStorage).forEach(n=>{n.startsWith(Kv)&&localStorage.removeItem(n)})}catch(e){console.error("Cache clear error:",e)}},cleanup(){try{Object.keys(localStorage).forEach(n=>{if(n.startsWith(Kv)){const a=localStorage.getItem(n);if(a){const o=JSON.parse(a);Date.now()>o.expiry&&localStorage.removeItem(n)}}})}catch(e){console.error("Cache cleanup error:",e)}}};Oc.cleanup();setInterval(()=>Oc.cleanup(),5*60*1e3);const nQ=Y.createContext(),rQ=()=>{const e=Y.useContext(nQ);if(!e)throw new Error("useData must be used within DataProvider");return e},dCe=({children:e})=>{const[n,a]=Y.useState(null),[o,d]=Y.useState(null),[h,f]=Y.useState(null),[y,b]=Y.useState({dashboard:!1,wearable:!1,nutrition:!1}),x=Y.useCallback(async(A=!1)=>{if(!A){const I=Oc.get("dashboard");if(I)return a(I),I}b(I=>({...I,dashboard:!0}));try{const P=(await Pl.getDashboard()).data;return a(P),Oc.set("dashboard",P,3*60*1e3),P}catch(I){throw console.error("Failed to fetch dashboard:",I),I}finally{b(I=>({...I,dashboard:!1}))}},[]),T=Y.useCallback(async(A=!1)=>{if(!A){const I=Oc.get("wearable");if(I)return d(I),I}b(I=>({...I,wearable:!0}));try{const P=(await Cm.getDashboard()).data;return d(P),Oc.set("wearable",P,2*60*1e3),P}catch(I){console.error("Failed to fetch wearable:",I);const P={connected:!1};return d(P),P}finally{b(I=>({...I,wearable:!1}))}},[]),S=Y.useCallback(async(A,I=!1)=>{var L;const P=`nutrition_${A}`;if(!I){const F=Oc.get(P);if(F)return f(F),F}b(F=>({...F,nutrition:!0}));try{const V=((L=(await uTe.getDailySummary(A)).data)==null?void 0:L.summary)||null;return f(V),V&&Oc.set(P,V,5*60*1e3),V}catch(F){return console.error("Failed to fetch nutrition:",F),f(null),null}finally{b(F=>({...F,nutrition:!1}))}},[]),N=Y.useCallback((A=[])=>{A.length===0?(Oc.clear(),a(null),d(null),f(null)):A.forEach(I=>{Oc.delete(I),I==="dashboard"&&a(null),I==="wearable"&&d(null),I.startsWith("nutrition_")&&f(null)})},[]),O={dashboardData:n,wearableData:o,nutritionData:h,loading:y,fetchDashboard:x,fetchWearable:T,fetchNutrition:S,invalidateCache:N};return l.jsx(nQ.Provider,{value:O,children:e})};function iQ(e){var n,a,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(n=0;n<d;n++)e[n]&&(a=iQ(e[n]))&&(o&&(o+=" "),o+=a)}else for(a in e)e[a]&&(o&&(o+=" "),o+=a);return o}function An(){for(var e,n,a=0,o="",d=arguments.length;a<d;a++)(e=arguments[a])&&(n=iQ(e))&&(o&&(o+=" "),o+=n);return o}var uCe=Array.isArray,rs=uCe,hCe=typeof jd=="object"&&jd&&jd.Object===Object&&jd,aQ=hCe,pCe=aQ,mCe=typeof self=="object"&&self&&self.Object===Object&&self,fCe=pCe||mCe||Function("return this")(),$c=fCe,gCe=$c,vCe=gCe.Symbol,Y0=vCe,L7=Y0,sQ=Object.prototype,yCe=sQ.hasOwnProperty,_Ce=sQ.toString,Yv=L7?L7.toStringTag:void 0;function bCe(e){var n=yCe.call(e,Yv),a=e[Yv];try{e[Yv]=void 0;var o=!0}catch{}var d=_Ce.call(e);return o&&(n?e[Yv]=a:delete e[Yv]),d}var xCe=bCe,ECe=Object.prototype,SCe=ECe.toString;function wCe(e){return SCe.call(e)}var TCe=wCe,M7=Y0,CCe=xCe,NCe=TCe,RCe="[object Null]",ACe="[object Undefined]",U7=M7?M7.toStringTag:void 0;function ICe(e){return e==null?e===void 0?ACe:RCe:U7&&U7 in Object(e)?CCe(e):NCe(e)}var Wl=ICe;function OCe(e){return e!=null&&typeof e=="object"}var $l=OCe,PCe=Wl,DCe=$l,kCe="[object Symbol]";function jCe(e){return typeof e=="symbol"||DCe(e)&&PCe(e)==kCe}var Yf=jCe,LCe=rs,MCe=Yf,UCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,FCe=/^\w*$/;function VCe(e,n){if(LCe(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||MCe(e)?!0:FCe.test(e)||!UCe.test(e)||n!=null&&e in Object(n)}var bk=VCe;function BCe(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var ou=BCe;const qf=ar(ou);var GCe=Wl,WCe=ou,$Ce="[object AsyncFunction]",HCe="[object Function]",zCe="[object GeneratorFunction]",KCe="[object Proxy]";function YCe(e){if(!WCe(e))return!1;var n=GCe(e);return n==HCe||n==zCe||n==$Ce||n==KCe}var xk=YCe;const un=ar(xk);var qCe=$c,XCe=qCe["__core-js_shared__"],JCe=XCe,HO=JCe,F7=function(){var e=/[^.]+$/.exec(HO&&HO.keys&&HO.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function QCe(e){return!!F7&&F7 in e}var ZCe=QCe,eNe=Function.prototype,tNe=eNe.toString;function nNe(e){if(e!=null){try{return tNe.call(e)}catch{}try{return e+""}catch{}}return""}var oQ=nNe,rNe=xk,iNe=ZCe,aNe=ou,sNe=oQ,oNe=/[\\^$.*+?()[\]{}|]/g,cNe=/^\[object .+?Constructor\]$/,lNe=Function.prototype,dNe=Object.prototype,uNe=lNe.toString,hNe=dNe.hasOwnProperty,pNe=RegExp("^"+uNe.call(hNe).replace(oNe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mNe(e){if(!aNe(e)||iNe(e))return!1;var n=rNe(e)?pNe:cNe;return n.test(sNe(e))}var fNe=mNe;function gNe(e,n){return e==null?void 0:e[n]}var vNe=gNe,yNe=fNe,_Ne=vNe;function bNe(e,n){var a=_Ne(e,n);return yNe(a)?a:void 0}var $h=bNe,xNe=$h,ENe=xNe(Object,"create"),oT=ENe,V7=oT;function SNe(){this.__data__=V7?V7(null):{},this.size=0}var wNe=SNe;function TNe(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}var CNe=TNe,NNe=oT,RNe="__lodash_hash_undefined__",ANe=Object.prototype,INe=ANe.hasOwnProperty;function ONe(e){var n=this.__data__;if(NNe){var a=n[e];return a===RNe?void 0:a}return INe.call(n,e)?n[e]:void 0}var PNe=ONe,DNe=oT,kNe=Object.prototype,jNe=kNe.hasOwnProperty;function LNe(e){var n=this.__data__;return DNe?n[e]!==void 0:jNe.call(n,e)}var MNe=LNe,UNe=oT,FNe="__lodash_hash_undefined__";function VNe(e,n){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=UNe&&n===void 0?FNe:n,this}var BNe=VNe,GNe=wNe,WNe=CNe,$Ne=PNe,HNe=MNe,zNe=BNe;function Xf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Xf.prototype.clear=GNe;Xf.prototype.delete=WNe;Xf.prototype.get=$Ne;Xf.prototype.has=HNe;Xf.prototype.set=zNe;var KNe=Xf;function YNe(){this.__data__=[],this.size=0}var qNe=YNe;function XNe(e,n){return e===n||e!==e&&n!==n}var Ek=XNe,JNe=Ek;function QNe(e,n){for(var a=e.length;a--;)if(JNe(e[a][0],n))return a;return-1}var cT=QNe,ZNe=cT,eRe=Array.prototype,tRe=eRe.splice;function nRe(e){var n=this.__data__,a=ZNe(n,e);if(a<0)return!1;var o=n.length-1;return a==o?n.pop():tRe.call(n,a,1),--this.size,!0}var rRe=nRe,iRe=cT;function aRe(e){var n=this.__data__,a=iRe(n,e);return a<0?void 0:n[a][1]}var sRe=aRe,oRe=cT;function cRe(e){return oRe(this.__data__,e)>-1}var lRe=cRe,dRe=cT;function uRe(e,n){var a=this.__data__,o=dRe(a,e);return o<0?(++this.size,a.push([e,n])):a[o][1]=n,this}var hRe=uRe,pRe=qNe,mRe=rRe,fRe=sRe,gRe=lRe,vRe=hRe;function Jf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Jf.prototype.clear=pRe;Jf.prototype.delete=mRe;Jf.prototype.get=fRe;Jf.prototype.has=gRe;Jf.prototype.set=vRe;var lT=Jf,yRe=$h,_Re=$c,bRe=yRe(_Re,"Map"),Sk=bRe,B7=KNe,xRe=lT,ERe=Sk;function SRe(){this.size=0,this.__data__={hash:new B7,map:new(ERe||xRe),string:new B7}}var wRe=SRe;function TRe(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}var CRe=TRe,NRe=CRe;function RRe(e,n){var a=e.__data__;return NRe(n)?a[typeof n=="string"?"string":"hash"]:a.map}var dT=RRe,ARe=dT;function IRe(e){var n=ARe(this,e).delete(e);return this.size-=n?1:0,n}var ORe=IRe,PRe=dT;function DRe(e){return PRe(this,e).get(e)}var kRe=DRe,jRe=dT;function LRe(e){return jRe(this,e).has(e)}var MRe=LRe,URe=dT;function FRe(e,n){var a=URe(this,e),o=a.size;return a.set(e,n),this.size+=a.size==o?0:1,this}var VRe=FRe,BRe=wRe,GRe=ORe,WRe=kRe,$Re=MRe,HRe=VRe;function Qf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Qf.prototype.clear=BRe;Qf.prototype.delete=GRe;Qf.prototype.get=WRe;Qf.prototype.has=$Re;Qf.prototype.set=HRe;var wk=Qf,cQ=wk,zRe="Expected a function";function Tk(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError(zRe);var a=function(){var o=arguments,d=n?n.apply(this,o):o[0],h=a.cache;if(h.has(d))return h.get(d);var f=e.apply(this,o);return a.cache=h.set(d,f)||h,f};return a.cache=new(Tk.Cache||cQ),a}Tk.Cache=cQ;var lQ=Tk;const KRe=ar(lQ);var YRe=lQ,qRe=500;function XRe(e){var n=YRe(e,function(o){return a.size===qRe&&a.clear(),o}),a=n.cache;return n}var JRe=XRe,QRe=JRe,ZRe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,eAe=/\\(\\)?/g,tAe=QRe(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(ZRe,function(a,o,d,h){n.push(d?h.replace(eAe,"$1"):o||a)}),n}),nAe=tAe;function rAe(e,n){for(var a=-1,o=e==null?0:e.length,d=Array(o);++a<o;)d[a]=n(e[a],a,e);return d}var Ck=rAe,G7=Y0,iAe=Ck,aAe=rs,sAe=Yf,W7=G7?G7.prototype:void 0,$7=W7?W7.toString:void 0;function dQ(e){if(typeof e=="string")return e;if(aAe(e))return iAe(e,dQ)+"";if(sAe(e))return $7?$7.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var oAe=dQ,cAe=oAe;function lAe(e){return e==null?"":cAe(e)}var uQ=lAe,dAe=rs,uAe=bk,hAe=nAe,pAe=uQ;function mAe(e,n){return dAe(e)?e:uAe(e,n)?[e]:hAe(pAe(e))}var hQ=mAe,fAe=Yf;function gAe(e){if(typeof e=="string"||fAe(e))return e;var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var uT=gAe,vAe=hQ,yAe=uT;function _Ae(e,n){n=vAe(n,e);for(var a=0,o=n.length;e!=null&&a<o;)e=e[yAe(n[a++])];return a&&a==o?e:void 0}var Nk=_Ae,bAe=Nk;function xAe(e,n,a){var o=e==null?void 0:bAe(e,n);return o===void 0?a:o}var pQ=xAe;const lo=ar(pQ);function EAe(e){return e==null}var SAe=EAe;const yn=ar(SAe);var wAe=Wl,TAe=rs,CAe=$l,NAe="[object String]";function RAe(e){return typeof e=="string"||!TAe(e)&&CAe(e)&&wAe(e)==NAe}var AAe=RAe;const Mh=ar(AAe);var mQ={exports:{}},Jn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rk=Symbol.for("react.element"),Ak=Symbol.for("react.portal"),hT=Symbol.for("react.fragment"),pT=Symbol.for("react.strict_mode"),mT=Symbol.for("react.profiler"),fT=Symbol.for("react.provider"),gT=Symbol.for("react.context"),IAe=Symbol.for("react.server_context"),vT=Symbol.for("react.forward_ref"),yT=Symbol.for("react.suspense"),_T=Symbol.for("react.suspense_list"),bT=Symbol.for("react.memo"),xT=Symbol.for("react.lazy"),OAe=Symbol.for("react.offscreen"),fQ;fQ=Symbol.for("react.module.reference");function fo(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case Rk:switch(e=e.type,e){case hT:case mT:case pT:case yT:case _T:return e;default:switch(e=e&&e.$$typeof,e){case IAe:case gT:case vT:case xT:case bT:case fT:return e;default:return n}}case Ak:return n}}}Jn.ContextConsumer=gT;Jn.ContextProvider=fT;Jn.Element=Rk;Jn.ForwardRef=vT;Jn.Fragment=hT;Jn.Lazy=xT;Jn.Memo=bT;Jn.Portal=Ak;Jn.Profiler=mT;Jn.StrictMode=pT;Jn.Suspense=yT;Jn.SuspenseList=_T;Jn.isAsyncMode=function(){return!1};Jn.isConcurrentMode=function(){return!1};Jn.isContextConsumer=function(e){return fo(e)===gT};Jn.isContextProvider=function(e){return fo(e)===fT};Jn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===Rk};Jn.isForwardRef=function(e){return fo(e)===vT};Jn.isFragment=function(e){return fo(e)===hT};Jn.isLazy=function(e){return fo(e)===xT};Jn.isMemo=function(e){return fo(e)===bT};Jn.isPortal=function(e){return fo(e)===Ak};Jn.isProfiler=function(e){return fo(e)===mT};Jn.isStrictMode=function(e){return fo(e)===pT};Jn.isSuspense=function(e){return fo(e)===yT};Jn.isSuspenseList=function(e){return fo(e)===_T};Jn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===hT||e===mT||e===pT||e===yT||e===_T||e===OAe||typeof e=="object"&&e!==null&&(e.$$typeof===xT||e.$$typeof===bT||e.$$typeof===fT||e.$$typeof===gT||e.$$typeof===vT||e.$$typeof===fQ||e.getModuleId!==void 0)};Jn.typeOf=fo;mQ.exports=Jn;var PAe=mQ.exports,DAe=Wl,kAe=$l,jAe="[object Number]";function LAe(e){return typeof e=="number"||kAe(e)&&DAe(e)==jAe}var gQ=LAe;const MAe=ar(gQ);var UAe=gQ;function FAe(e){return UAe(e)&&e!=+e}var VAe=FAe;const Zf=ar(VAe);var Xo=function(n){return n===0?0:n>0?1:-1},bh=function(n){return Mh(n)&&n.indexOf("%")===n.length-1},lt=function(n){return MAe(n)&&!Zf(n)},BAe=function(n){return yn(n)},_i=function(n){return lt(n)||Mh(n)},GAe=0,eg=function(n){var a=++GAe;return"".concat(n||"").concat(a)},Uh=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!lt(n)&&!Mh(n))return o;var h;if(bh(n)){var f=n.indexOf("%");h=a*parseFloat(n.slice(0,f))/100}else h=+n;return Zf(h)&&(h=o),d&&h>a&&(h=a),h},kd=function(n){if(!n)return null;var a=Object.keys(n);return a&&a.length?n[a[0]]:null},WAe=function(n){if(!Array.isArray(n))return!1;for(var a=n.length,o={},d=0;d<a;d++)if(!o[n[d]])o[n[d]]=!0;else return!0;return!1},Hi=function(n,a){return lt(n)&&lt(a)?function(o){return n+o*(a-n)}:function(){return a}};function AS(e,n,a){return!e||!e.length?null:e.find(function(o){return o&&(typeof n=="function"?n(o):lo(o,n))===a})}var $Ae=function(n,a){return lt(n)&&lt(a)?n-a:Mh(n)&&Mh(a)?n.localeCompare(a):n instanceof Date&&a instanceof Date?n.getTime()-a.getTime():String(n).localeCompare(String(a))};function Xm(e,n){for(var a in e)if({}.hasOwnProperty.call(e,a)&&(!{}.hasOwnProperty.call(n,a)||e[a]!==n[a]))return!1;for(var o in n)if({}.hasOwnProperty.call(n,o)&&!{}.hasOwnProperty.call(e,o))return!1;return!0}function kP(e){"@babel/helpers - typeof";return kP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kP(e)}var HAe=["viewBox","children"],zAe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],H7=["points","pathLength"],zO={svg:HAe,polygon:H7,polyline:H7},Ik=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],IS=function(n,a){if(!n||typeof n=="function"||typeof n=="boolean")return null;var o=n;if(Y.isValidElement(n)&&(o=n.props),!qf(o))return null;var d={};return Object.keys(o).forEach(function(h){Ik.includes(h)&&(d[h]=a||function(f){return o[h](o,f)})}),d},KAe=function(n,a,o){return function(d){return n(a,o,d),null}},OS=function(n,a,o){if(!qf(n)||kP(n)!=="object")return null;var d=null;return Object.keys(n).forEach(function(h){var f=n[h];Ik.includes(h)&&typeof f=="function"&&(d||(d={}),d[h]=KAe(f,a,o))}),d},YAe=["children"],qAe=["children"];function z7(e,n){if(e==null)return{};var a=XAe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function XAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function jP(e){"@babel/helpers - typeof";return jP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jP(e)}var K7={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Sl=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},Y7=null,KO=null,Ok=function e(n){if(n===Y7&&Array.isArray(KO))return KO;var a=[];return Y.Children.forEach(n,function(o){yn(o)||(PAe.isFragment(o)?a=a.concat(e(o.props.children)):a.push(o))}),KO=a,Y7=n,a};function uo(e,n){var a=[],o=[];return Array.isArray(n)?o=n.map(function(d){return Sl(d)}):o=[Sl(n)],Ok(e).forEach(function(d){var h=lo(d,"type.displayName")||lo(d,"type.name");o.indexOf(h)!==-1&&a.push(d)}),a}function xs(e,n){var a=uo(e,n);return a&&a[0]}var q7=function(n){if(!n||!n.props)return!1;var a=n.props,o=a.width,d=a.height;return!(!lt(o)||o<=0||!lt(d)||d<=0)},JAe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],QAe=function(n){return n&&n.type&&Mh(n.type)&&JAe.indexOf(n.type)>=0},vQ=function(n){return n&&jP(n)==="object"&&"clipDot"in n},ZAe=function(n,a,o,d){var h,f=(h=zO==null?void 0:zO[d])!==null&&h!==void 0?h:[];return a.startsWith("data-")||!un(n)&&(d&&f.includes(a)||zAe.includes(a))||o&&Ik.includes(a)},gn=function(n,a,o){if(!n||typeof n=="function"||typeof n=="boolean")return null;var d=n;if(Y.isValidElement(n)&&(d=n.props),!qf(d))return null;var h={};return Object.keys(d).forEach(function(f){var y;ZAe((y=d)===null||y===void 0?void 0:y[f],f,a,o)&&(h[f]=d[f])}),h},LP=function e(n,a){if(n===a)return!0;var o=Y.Children.count(n);if(o!==Y.Children.count(a))return!1;if(o===0)return!0;if(o===1)return X7(Array.isArray(n)?n[0]:n,Array.isArray(a)?a[0]:a);for(var d=0;d<o;d++){var h=n[d],f=a[d];if(Array.isArray(h)||Array.isArray(f)){if(!e(h,f))return!1}else if(!X7(h,f))return!1}return!0},X7=function(n,a){if(yn(n)&&yn(a))return!0;if(!yn(n)&&!yn(a)){var o=n.props||{},d=o.children,h=z7(o,YAe),f=a.props||{},y=f.children,b=z7(f,qAe);return d&&y?Xm(h,b)&&LP(d,y):!d&&!y?Xm(h,b):!1}return!1},J7=function(n,a){var o=[],d={};return Ok(n).forEach(function(h,f){if(QAe(h))o.push(h);else if(h){var y=Sl(h.type),b=a[y]||{},x=b.handler,T=b.once;if(x&&(!T||!d[y])){var S=x(h,y,f);o.push(S),d[y]=!0}}}),o},eIe=function(n){var a=n&&n.type;return a&&K7[a]?K7[a]:null},tIe=function(n,a){return Ok(a).indexOf(n)},nIe=["children","width","height","viewBox","className","style","title","desc"];function MP(){return MP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},MP.apply(this,arguments)}function rIe(e,n){if(e==null)return{};var a=iIe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function iIe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function UP(e){var n=e.children,a=e.width,o=e.height,d=e.viewBox,h=e.className,f=e.style,y=e.title,b=e.desc,x=rIe(e,nIe),T=d||{width:a,height:o,x:0,y:0},S=An("recharts-surface",h);return ge.createElement("svg",MP({},gn(x,!0,"svg"),{className:S,width:a,height:o,style:f,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),ge.createElement("title",null,y),ge.createElement("desc",null,b),n)}var aIe=["children","className"];function FP(){return FP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},FP.apply(this,arguments)}function sIe(e,n){if(e==null)return{};var a=oIe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function oIe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var mr=ge.forwardRef(function(e,n){var a=e.children,o=e.className,d=sIe(e,aIe),h=An("recharts-layer",o);return ge.createElement("g",FP({className:h},gn(d,!0),{ref:n}),a)}),wl=function(n,a){for(var o=arguments.length,d=new Array(o>2?o-2:0),h=2;h<o;h++)d[h-2]=arguments[h]};function cIe(e,n,a){var o=-1,d=e.length;n<0&&(n=-n>d?0:d+n),a=a>d?d:a,a<0&&(a+=d),d=n>a?0:a-n>>>0,n>>>=0;for(var h=Array(d);++o<d;)h[o]=e[o+n];return h}var lIe=cIe,dIe=lIe;function uIe(e,n,a){var o=e.length;return a=a===void 0?o:a,!n&&a>=o?e:dIe(e,n,a)}var hIe=uIe,pIe="\\ud800-\\udfff",mIe="\\u0300-\\u036f",fIe="\\ufe20-\\ufe2f",gIe="\\u20d0-\\u20ff",vIe=mIe+fIe+gIe,yIe="\\ufe0e\\ufe0f",_Ie="\\u200d",bIe=RegExp("["+_Ie+pIe+vIe+yIe+"]");function xIe(e){return bIe.test(e)}var yQ=xIe;function EIe(e){return e.split("")}var SIe=EIe,_Q="\\ud800-\\udfff",wIe="\\u0300-\\u036f",TIe="\\ufe20-\\ufe2f",CIe="\\u20d0-\\u20ff",NIe=wIe+TIe+CIe,RIe="\\ufe0e\\ufe0f",AIe="["+_Q+"]",VP="["+NIe+"]",BP="\\ud83c[\\udffb-\\udfff]",IIe="(?:"+VP+"|"+BP+")",bQ="[^"+_Q+"]",xQ="(?:\\ud83c[\\udde6-\\uddff]){2}",EQ="[\\ud800-\\udbff][\\udc00-\\udfff]",OIe="\\u200d",SQ=IIe+"?",wQ="["+RIe+"]?",PIe="(?:"+OIe+"(?:"+[bQ,xQ,EQ].join("|")+")"+wQ+SQ+")*",DIe=wQ+SQ+PIe,kIe="(?:"+[bQ+VP+"?",VP,xQ,EQ,AIe].join("|")+")",jIe=RegExp(BP+"(?="+BP+")|"+kIe+DIe,"g");function LIe(e){return e.match(jIe)||[]}var MIe=LIe,UIe=SIe,FIe=yQ,VIe=MIe;function BIe(e){return FIe(e)?VIe(e):UIe(e)}var GIe=BIe,WIe=hIe,$Ie=yQ,HIe=GIe,zIe=uQ;function KIe(e){return function(n){n=zIe(n);var a=$Ie(n)?HIe(n):void 0,o=a?a[0]:n.charAt(0),d=a?WIe(a,1).join(""):n.slice(1);return o[e]()+d}}var YIe=KIe,qIe=YIe,XIe=qIe("toUpperCase"),JIe=XIe;const ET=ar(JIe);function hr(e){return function(){return e}}const TQ=Math.cos,PS=Math.sin,nc=Math.sqrt,DS=Math.PI,ST=2*DS,GP=Math.PI,WP=2*GP,dh=1e-6,QIe=WP-dh;function CQ(e){this._+=e[0];for(let n=1,a=e.length;n<a;++n)this._+=arguments[n]+e[n]}function ZIe(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return CQ;const a=10**n;return function(o){this._+=o[0];for(let d=1,h=o.length;d<h;++d)this._+=Math.round(arguments[d]*a)/a+o[d]}}class eOe{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?CQ:ZIe(n)}moveTo(n,a){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,a){this._append`L${this._x1=+n},${this._y1=+a}`}quadraticCurveTo(n,a,o,d){this._append`Q${+n},${+a},${this._x1=+o},${this._y1=+d}`}bezierCurveTo(n,a,o,d,h,f){this._append`C${+n},${+a},${+o},${+d},${this._x1=+h},${this._y1=+f}`}arcTo(n,a,o,d,h){if(n=+n,a=+a,o=+o,d=+d,h=+h,h<0)throw new Error(`negative radius: ${h}`);let f=this._x1,y=this._y1,b=o-n,x=d-a,T=f-n,S=y-a,N=T*T+S*S;if(this._x1===null)this._append`M${this._x1=n},${this._y1=a}`;else if(N>dh)if(!(Math.abs(S*b-x*T)>dh)||!h)this._append`L${this._x1=n},${this._y1=a}`;else{let O=o-f,A=d-y,I=b*b+x*x,P=O*O+A*A,L=Math.sqrt(I),F=Math.sqrt(N),V=h*Math.tan((GP-Math.acos((I+N-P)/(2*L*F)))/2),G=V/F,B=V/L;Math.abs(G-1)>dh&&this._append`L${n+G*T},${a+G*S}`,this._append`A${h},${h},0,0,${+(S*O>T*A)},${this._x1=n+B*b},${this._y1=a+B*x}`}}arc(n,a,o,d,h,f){if(n=+n,a=+a,o=+o,f=!!f,o<0)throw new Error(`negative radius: ${o}`);let y=o*Math.cos(d),b=o*Math.sin(d),x=n+y,T=a+b,S=1^f,N=f?d-h:h-d;this._x1===null?this._append`M${x},${T}`:(Math.abs(this._x1-x)>dh||Math.abs(this._y1-T)>dh)&&this._append`L${x},${T}`,o&&(N<0&&(N=N%WP+WP),N>QIe?this._append`A${o},${o},0,1,${S},${n-y},${a-b}A${o},${o},0,1,${S},${this._x1=x},${this._y1=T}`:N>dh&&this._append`A${o},${o},0,${+(N>=GP)},${S},${this._x1=n+o*Math.cos(h)},${this._y1=a+o*Math.sin(h)}`)}rect(n,a,o,d){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}h${o=+o}v${+d}h${-o}Z`}toString(){return this._}}function Pk(e){let n=3;return e.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const o=Math.floor(a);if(!(o>=0))throw new RangeError(`invalid digits: ${a}`);n=o}return e},()=>new eOe(n)}function Dk(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function NQ(e){this._context=e}NQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n);break}}};function wT(e){return new NQ(e)}function RQ(e){return e[0]}function AQ(e){return e[1]}function IQ(e,n){var a=hr(!0),o=null,d=wT,h=null,f=Pk(y);e=typeof e=="function"?e:e===void 0?RQ:hr(e),n=typeof n=="function"?n:n===void 0?AQ:hr(n);function y(b){var x,T=(b=Dk(b)).length,S,N=!1,O;for(o==null&&(h=d(O=f())),x=0;x<=T;++x)!(x<T&&a(S=b[x],x,b))===N&&((N=!N)?h.lineStart():h.lineEnd()),N&&h.point(+e(S,x,b),+n(S,x,b));if(O)return h=null,O+""||null}return y.x=function(b){return arguments.length?(e=typeof b=="function"?b:hr(+b),y):e},y.y=function(b){return arguments.length?(n=typeof b=="function"?b:hr(+b),y):n},y.defined=function(b){return arguments.length?(a=typeof b=="function"?b:hr(!!b),y):a},y.curve=function(b){return arguments.length?(d=b,o!=null&&(h=d(o)),y):d},y.context=function(b){return arguments.length?(b==null?o=h=null:h=d(o=b),y):o},y}function xE(e,n,a){var o=null,d=hr(!0),h=null,f=wT,y=null,b=Pk(x);e=typeof e=="function"?e:e===void 0?RQ:hr(+e),n=typeof n=="function"?n:hr(n===void 0?0:+n),a=typeof a=="function"?a:a===void 0?AQ:hr(+a);function x(S){var N,O,A,I=(S=Dk(S)).length,P,L=!1,F,V=new Array(I),G=new Array(I);for(h==null&&(y=f(F=b())),N=0;N<=I;++N){if(!(N<I&&d(P=S[N],N,S))===L)if(L=!L)O=N,y.areaStart(),y.lineStart();else{for(y.lineEnd(),y.lineStart(),A=N-1;A>=O;--A)y.point(V[A],G[A]);y.lineEnd(),y.areaEnd()}L&&(V[N]=+e(P,N,S),G[N]=+n(P,N,S),y.point(o?+o(P,N,S):V[N],a?+a(P,N,S):G[N]))}if(F)return y=null,F+""||null}function T(){return IQ().defined(d).curve(f).context(h)}return x.x=function(S){return arguments.length?(e=typeof S=="function"?S:hr(+S),o=null,x):e},x.x0=function(S){return arguments.length?(e=typeof S=="function"?S:hr(+S),x):e},x.x1=function(S){return arguments.length?(o=S==null?null:typeof S=="function"?S:hr(+S),x):o},x.y=function(S){return arguments.length?(n=typeof S=="function"?S:hr(+S),a=null,x):n},x.y0=function(S){return arguments.length?(n=typeof S=="function"?S:hr(+S),x):n},x.y1=function(S){return arguments.length?(a=S==null?null:typeof S=="function"?S:hr(+S),x):a},x.lineX0=x.lineY0=function(){return T().x(e).y(n)},x.lineY1=function(){return T().x(e).y(a)},x.lineX1=function(){return T().x(o).y(n)},x.defined=function(S){return arguments.length?(d=typeof S=="function"?S:hr(!!S),x):d},x.curve=function(S){return arguments.length?(f=S,h!=null&&(y=f(h)),x):f},x.context=function(S){return arguments.length?(S==null?h=y=null:y=f(h=S),x):h},x}class OQ{constructor(n,a){this._context=n,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,a){switch(n=+n,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,a,n,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,n,this._y0,n,a);break}}this._x0=n,this._y0=a}}function tOe(e){return new OQ(e,!0)}function nOe(e){return new OQ(e,!1)}const kk={draw(e,n){const a=nc(n/DS);e.moveTo(a,0),e.arc(0,0,a,0,ST)}},rOe={draw(e,n){const a=nc(n/5)/2;e.moveTo(-3*a,-a),e.lineTo(-a,-a),e.lineTo(-a,-3*a),e.lineTo(a,-3*a),e.lineTo(a,-a),e.lineTo(3*a,-a),e.lineTo(3*a,a),e.lineTo(a,a),e.lineTo(a,3*a),e.lineTo(-a,3*a),e.lineTo(-a,a),e.lineTo(-3*a,a),e.closePath()}},PQ=nc(1/3),iOe=PQ*2,aOe={draw(e,n){const a=nc(n/iOe),o=a*PQ;e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath()}},sOe={draw(e,n){const a=nc(n),o=-a/2;e.rect(o,o,a,a)}},oOe=.8908130915292852,DQ=PS(DS/10)/PS(7*DS/10),cOe=PS(ST/10)*DQ,lOe=-TQ(ST/10)*DQ,dOe={draw(e,n){const a=nc(n*oOe),o=cOe*a,d=lOe*a;e.moveTo(0,-a),e.lineTo(o,d);for(let h=1;h<5;++h){const f=ST*h/5,y=TQ(f),b=PS(f);e.lineTo(b*a,-y*a),e.lineTo(y*o-b*d,b*o+y*d)}e.closePath()}},YO=nc(3),uOe={draw(e,n){const a=-nc(n/(YO*3));e.moveTo(0,a*2),e.lineTo(-YO*a,-a),e.lineTo(YO*a,-a),e.closePath()}},Zs=-.5,eo=nc(3)/2,$P=1/nc(12),hOe=($P/2+1)*3,pOe={draw(e,n){const a=nc(n/hOe),o=a/2,d=a*$P,h=o,f=a*$P+a,y=-h,b=f;e.moveTo(o,d),e.lineTo(h,f),e.lineTo(y,b),e.lineTo(Zs*o-eo*d,eo*o+Zs*d),e.lineTo(Zs*h-eo*f,eo*h+Zs*f),e.lineTo(Zs*y-eo*b,eo*y+Zs*b),e.lineTo(Zs*o+eo*d,Zs*d-eo*o),e.lineTo(Zs*h+eo*f,Zs*f-eo*h),e.lineTo(Zs*y+eo*b,Zs*b-eo*y),e.closePath()}};function mOe(e,n){let a=null,o=Pk(d);e=typeof e=="function"?e:hr(e||kk),n=typeof n=="function"?n:hr(n===void 0?64:+n);function d(){let h;if(a||(a=h=o()),e.apply(this,arguments).draw(a,+n.apply(this,arguments)),h)return a=null,h+""||null}return d.type=function(h){return arguments.length?(e=typeof h=="function"?h:hr(h),d):e},d.size=function(h){return arguments.length?(n=typeof h=="function"?h:hr(+h),d):n},d.context=function(h){return arguments.length?(a=h??null,d):a},d}function kS(){}function jS(e,n,a){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+n)/6,(e._y0+4*e._y1+a)/6)}function kQ(e){this._context=e}kQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:jS(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:jS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function fOe(e){return new kQ(e)}function jQ(e){this._context=e}jQ.prototype={areaStart:kS,areaEnd:kS,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._x2=e,this._y2=n;break;case 1:this._point=2,this._x3=e,this._y3=n;break;case 2:this._point=3,this._x4=e,this._y4=n,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+n)/6);break;default:jS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function gOe(e){return new jQ(e)}function LQ(e){this._context=e}LQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var a=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(a,o):this._context.moveTo(a,o);break;case 3:this._point=4;default:jS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function vOe(e){return new LQ(e)}function MQ(e){this._context=e}MQ.prototype={areaStart:kS,areaEnd:kS,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,n){e=+e,n=+n,this._point?this._context.lineTo(e,n):(this._point=1,this._context.moveTo(e,n))}};function yOe(e){return new MQ(e)}function Q7(e){return e<0?-1:1}function Z7(e,n,a){var o=e._x1-e._x0,d=n-e._x1,h=(e._y1-e._y0)/(o||d<0&&-0),f=(a-e._y1)/(d||o<0&&-0),y=(h*d+f*o)/(o+d);return(Q7(h)+Q7(f))*Math.min(Math.abs(h),Math.abs(f),.5*Math.abs(y))||0}function ez(e,n){var a=e._x1-e._x0;return a?(3*(e._y1-e._y0)/a-n)/2:n}function qO(e,n,a){var o=e._x0,d=e._y0,h=e._x1,f=e._y1,y=(h-o)/3;e._context.bezierCurveTo(o+y,d+y*n,h-y,f-y*a,h,f)}function LS(e){this._context=e}LS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:qO(this,this._t0,ez(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var a=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,qO(this,ez(this,a=Z7(this,e,n)),a);break;default:qO(this,this._t0,a=Z7(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=a}}};function UQ(e){this._context=new FQ(e)}(UQ.prototype=Object.create(LS.prototype)).point=function(e,n){LS.prototype.point.call(this,n,e)};function FQ(e){this._context=e}FQ.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,a,o,d,h){this._context.bezierCurveTo(n,e,o,a,h,d)}};function _Oe(e){return new LS(e)}function bOe(e){return new UQ(e)}function VQ(e){this._context=e}VQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,n=this._y,a=e.length;if(a)if(this._line?this._context.lineTo(e[0],n[0]):this._context.moveTo(e[0],n[0]),a===2)this._context.lineTo(e[1],n[1]);else for(var o=tz(e),d=tz(n),h=0,f=1;f<a;++h,++f)this._context.bezierCurveTo(o[0][h],d[0][h],o[1][h],d[1][h],e[f],n[f]);(this._line||this._line!==0&&a===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,n){this._x.push(+e),this._y.push(+n)}};function tz(e){var n,a=e.length-1,o,d=new Array(a),h=new Array(a),f=new Array(a);for(d[0]=0,h[0]=2,f[0]=e[0]+2*e[1],n=1;n<a-1;++n)d[n]=1,h[n]=4,f[n]=4*e[n]+2*e[n+1];for(d[a-1]=2,h[a-1]=7,f[a-1]=8*e[a-1]+e[a],n=1;n<a;++n)o=d[n]/h[n-1],h[n]-=o,f[n]-=o*f[n-1];for(d[a-1]=f[a-1]/h[a-1],n=a-2;n>=0;--n)d[n]=(f[n]-d[n+1])/h[n];for(h[a-1]=(e[a]+d[a-1])/2,n=0;n<a-1;++n)h[n]=2*e[n+1]-d[n+1];return[d,h]}function xOe(e){return new VQ(e)}function TT(e,n){this._context=e,this._t=n}TT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(e,n);else{var a=this._x*(1-this._t)+e*this._t;this._context.lineTo(a,this._y),this._context.lineTo(a,n)}break}}this._x=e,this._y=n}};function EOe(e){return new TT(e,.5)}function SOe(e){return new TT(e,0)}function wOe(e){return new TT(e,1)}function pf(e,n){if((f=e.length)>1)for(var a=1,o,d,h=e[n[0]],f,y=h.length;a<f;++a)for(d=h,h=e[n[a]],o=0;o<y;++o)h[o][1]+=h[o][0]=isNaN(d[o][1])?d[o][0]:d[o][1]}function HP(e){for(var n=e.length,a=new Array(n);--n>=0;)a[n]=n;return a}function TOe(e,n){return e[n]}function COe(e){const n=[];return n.key=e,n}function NOe(){var e=hr([]),n=HP,a=pf,o=TOe;function d(h){var f=Array.from(e.apply(this,arguments),COe),y,b=f.length,x=-1,T;for(const S of h)for(y=0,++x;y<b;++y)(f[y][x]=[0,+o(S,f[y].key,x,h)]).data=S;for(y=0,T=Dk(n(f));y<b;++y)f[T[y]].index=y;return a(f,T),f}return d.keys=function(h){return arguments.length?(e=typeof h=="function"?h:hr(Array.from(h)),d):e},d.value=function(h){return arguments.length?(o=typeof h=="function"?h:hr(+h),d):o},d.order=function(h){return arguments.length?(n=h==null?HP:typeof h=="function"?h:hr(Array.from(h)),d):n},d.offset=function(h){return arguments.length?(a=h??pf,d):a},d}function ROe(e,n){if((o=e.length)>0){for(var a,o,d=0,h=e[0].length,f;d<h;++d){for(f=a=0;a<o;++a)f+=e[a][d][1]||0;if(f)for(a=0;a<o;++a)e[a][d][1]/=f}pf(e,n)}}function AOe(e,n){if((d=e.length)>0){for(var a=0,o=e[n[0]],d,h=o.length;a<h;++a){for(var f=0,y=0;f<d;++f)y+=e[f][a][1]||0;o[a][1]+=o[a][0]=-y/2}pf(e,n)}}function IOe(e,n){if(!(!((f=e.length)>0)||!((h=(d=e[n[0]]).length)>0))){for(var a=0,o=1,d,h,f;o<h;++o){for(var y=0,b=0,x=0;y<f;++y){for(var T=e[n[y]],S=T[o][1]||0,N=T[o-1][1]||0,O=(S-N)/2,A=0;A<y;++A){var I=e[n[A]],P=I[o][1]||0,L=I[o-1][1]||0;O+=P-L}b+=S,x+=O*S}d[o-1][1]+=d[o-1][0]=a,b&&(a-=x/b)}d[o-1][1]+=d[o-1][0]=a,pf(e,n)}}function Qy(e){"@babel/helpers - typeof";return Qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qy(e)}var OOe=["type","size","sizeType"];function zP(){return zP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},zP.apply(this,arguments)}function nz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function rz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?nz(Object(a),!0).forEach(function(o){POe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function POe(e,n,a){return n=DOe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function DOe(e){var n=kOe(e,"string");return Qy(n)=="symbol"?n:n+""}function kOe(e,n){if(Qy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Qy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function jOe(e,n){if(e==null)return{};var a=LOe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function LOe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var BQ={symbolCircle:kk,symbolCross:rOe,symbolDiamond:aOe,symbolSquare:sOe,symbolStar:dOe,symbolTriangle:uOe,symbolWye:pOe},MOe=Math.PI/180,UOe=function(n){var a="symbol".concat(ET(n));return BQ[a]||kk},FOe=function(n,a,o){if(a==="area")return n;switch(o){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var d=18*MOe;return 1.25*n*n*(Math.tan(d)-Math.tan(d*2)*Math.pow(Math.tan(d),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},VOe=function(n,a){BQ["symbol".concat(ET(n))]=a},jk=function(n){var a=n.type,o=a===void 0?"circle":a,d=n.size,h=d===void 0?64:d,f=n.sizeType,y=f===void 0?"area":f,b=jOe(n,OOe),x=rz(rz({},b),{},{type:o,size:h,sizeType:y}),T=function(){var P=UOe(o),L=mOe().type(P).size(FOe(h,y,o));return L()},S=x.className,N=x.cx,O=x.cy,A=gn(x,!0);return N===+N&&O===+O&&h===+h?ge.createElement("path",zP({},A,{className:An("recharts-symbols",S),transform:"translate(".concat(N,", ").concat(O,")"),d:T()})):null};jk.registerSymbol=VOe;function mf(e){"@babel/helpers - typeof";return mf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mf(e)}function KP(){return KP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},KP.apply(this,arguments)}function iz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function BOe(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?iz(Object(a),!0).forEach(function(o){Zy(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):iz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function GOe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function WOe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,WQ(o.key),o)}}function $Oe(e,n,a){return n&&WOe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function HOe(e,n,a){return n=MS(n),zOe(e,GQ()?Reflect.construct(n,a||[],MS(e).constructor):n.apply(e,a))}function zOe(e,n){if(n&&(mf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KOe(e)}function KOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function GQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GQ=function(){return!!e})()}function MS(e){return MS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},MS(e)}function YOe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&YP(e,n)}function YP(e,n){return YP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},YP(e,n)}function Zy(e,n,a){return n=WQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function WQ(e){var n=qOe(e,"string");return mf(n)=="symbol"?n:n+""}function qOe(e,n){if(mf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(mf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var to=32,Lk=function(e){function n(){return GOe(this,n),HOe(this,n,arguments)}return YOe(n,e),$Oe(n,[{key:"renderIcon",value:function(o){var d=this.props.inactiveColor,h=to/2,f=to/6,y=to/3,b=o.inactive?d:o.color;if(o.type==="plainline")return ge.createElement("line",{strokeWidth:4,fill:"none",stroke:b,strokeDasharray:o.payload.strokeDasharray,x1:0,y1:h,x2:to,y2:h,className:"recharts-legend-icon"});if(o.type==="line")return ge.createElement("path",{strokeWidth:4,fill:"none",stroke:b,d:"M0,".concat(h,"h").concat(y,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*y,",").concat(h,`
            H`).concat(to,"M").concat(2*y,",").concat(h,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(y,",").concat(h),className:"recharts-legend-icon"});if(o.type==="rect")return ge.createElement("path",{stroke:"none",fill:b,d:"M0,".concat(to/8,"h").concat(to,"v").concat(to*3/4,"h").concat(-to,"z"),className:"recharts-legend-icon"});if(ge.isValidElement(o.legendIcon)){var x=BOe({},o);return delete x.legendIcon,ge.cloneElement(o.legendIcon,x)}return ge.createElement(jk,{fill:b,cx:h,cy:h,size:to,sizeType:"diameter",type:o.type})}},{key:"renderItems",value:function(){var o=this,d=this.props,h=d.payload,f=d.iconSize,y=d.layout,b=d.formatter,x=d.inactiveColor,T={x:0,y:0,width:to,height:to},S={display:y==="horizontal"?"inline-block":"block",marginRight:10},N={display:"inline-block",verticalAlign:"middle",marginRight:4};return h.map(function(O,A){var I=O.formatter||b,P=An(Zy(Zy({"recharts-legend-item":!0},"legend-item-".concat(A),!0),"inactive",O.inactive));if(O.type==="none")return null;var L=un(O.value)?null:O.value;wl(!un(O.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var F=O.inactive?x:O.color;return ge.createElement("li",KP({className:P,style:S,key:"legend-item-".concat(A)},OS(o.props,O,A)),ge.createElement(UP,{width:f,height:f,viewBox:T,style:N},o.renderIcon(O)),ge.createElement("span",{className:"recharts-legend-item-text",style:{color:F}},I?I(L,O,A):L))})}},{key:"render",value:function(){var o=this.props,d=o.payload,h=o.layout,f=o.align;if(!d||!d.length)return null;var y={padding:0,margin:0,textAlign:h==="horizontal"?f:"left"};return ge.createElement("ul",{className:"recharts-default-legend",style:y},this.renderItems())}}])}(Y.PureComponent);Zy(Lk,"displayName","Legend");Zy(Lk,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var XOe=lT;function JOe(){this.__data__=new XOe,this.size=0}var QOe=JOe;function ZOe(e){var n=this.__data__,a=n.delete(e);return this.size=n.size,a}var e1e=ZOe;function t1e(e){return this.__data__.get(e)}var n1e=t1e;function r1e(e){return this.__data__.has(e)}var i1e=r1e,a1e=lT,s1e=Sk,o1e=wk,c1e=200;function l1e(e,n){var a=this.__data__;if(a instanceof a1e){var o=a.__data__;if(!s1e||o.length<c1e-1)return o.push([e,n]),this.size=++a.size,this;a=this.__data__=new o1e(o)}return a.set(e,n),this.size=a.size,this}var d1e=l1e,u1e=lT,h1e=QOe,p1e=e1e,m1e=n1e,f1e=i1e,g1e=d1e;function tg(e){var n=this.__data__=new u1e(e);this.size=n.size}tg.prototype.clear=h1e;tg.prototype.delete=p1e;tg.prototype.get=m1e;tg.prototype.has=f1e;tg.prototype.set=g1e;var $Q=tg,v1e="__lodash_hash_undefined__";function y1e(e){return this.__data__.set(e,v1e),this}var _1e=y1e;function b1e(e){return this.__data__.has(e)}var x1e=b1e,E1e=wk,S1e=_1e,w1e=x1e;function US(e){var n=-1,a=e==null?0:e.length;for(this.__data__=new E1e;++n<a;)this.add(e[n])}US.prototype.add=US.prototype.push=S1e;US.prototype.has=w1e;var HQ=US;function T1e(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(n(e[a],a,e))return!0;return!1}var zQ=T1e;function C1e(e,n){return e.has(n)}var KQ=C1e,N1e=HQ,R1e=zQ,A1e=KQ,I1e=1,O1e=2;function P1e(e,n,a,o,d,h){var f=a&I1e,y=e.length,b=n.length;if(y!=b&&!(f&&b>y))return!1;var x=h.get(e),T=h.get(n);if(x&&T)return x==n&&T==e;var S=-1,N=!0,O=a&O1e?new N1e:void 0;for(h.set(e,n),h.set(n,e);++S<y;){var A=e[S],I=n[S];if(o)var P=f?o(I,A,S,n,e,h):o(A,I,S,e,n,h);if(P!==void 0){if(P)continue;N=!1;break}if(O){if(!R1e(n,function(L,F){if(!A1e(O,F)&&(A===L||d(A,L,a,o,h)))return O.push(F)})){N=!1;break}}else if(!(A===I||d(A,I,a,o,h))){N=!1;break}}return h.delete(e),h.delete(n),N}var YQ=P1e,D1e=$c,k1e=D1e.Uint8Array,j1e=k1e;function L1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o,d){a[++n]=[d,o]}),a}var M1e=L1e;function U1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o){a[++n]=o}),a}var Mk=U1e,az=Y0,sz=j1e,F1e=Ek,V1e=YQ,B1e=M1e,G1e=Mk,W1e=1,$1e=2,H1e="[object Boolean]",z1e="[object Date]",K1e="[object Error]",Y1e="[object Map]",q1e="[object Number]",X1e="[object RegExp]",J1e="[object Set]",Q1e="[object String]",Z1e="[object Symbol]",ePe="[object ArrayBuffer]",tPe="[object DataView]",oz=az?az.prototype:void 0,XO=oz?oz.valueOf:void 0;function nPe(e,n,a,o,d,h,f){switch(a){case tPe:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case ePe:return!(e.byteLength!=n.byteLength||!h(new sz(e),new sz(n)));case H1e:case z1e:case q1e:return F1e(+e,+n);case K1e:return e.name==n.name&&e.message==n.message;case X1e:case Q1e:return e==n+"";case Y1e:var y=B1e;case J1e:var b=o&W1e;if(y||(y=G1e),e.size!=n.size&&!b)return!1;var x=f.get(e);if(x)return x==n;o|=$1e,f.set(e,n);var T=V1e(y(e),y(n),o,d,h,f);return f.delete(e),T;case Z1e:if(XO)return XO.call(e)==XO.call(n)}return!1}var rPe=nPe;function iPe(e,n){for(var a=-1,o=n.length,d=e.length;++a<o;)e[d+a]=n[a];return e}var qQ=iPe,aPe=qQ,sPe=rs;function oPe(e,n,a){var o=n(e);return sPe(e)?o:aPe(o,a(e))}var cPe=oPe;function lPe(e,n){for(var a=-1,o=e==null?0:e.length,d=0,h=[];++a<o;){var f=e[a];n(f,a,e)&&(h[d++]=f)}return h}var dPe=lPe;function uPe(){return[]}var hPe=uPe,pPe=dPe,mPe=hPe,fPe=Object.prototype,gPe=fPe.propertyIsEnumerable,cz=Object.getOwnPropertySymbols,vPe=cz?function(e){return e==null?[]:(e=Object(e),pPe(cz(e),function(n){return gPe.call(e,n)}))}:mPe,yPe=vPe;function _Pe(e,n){for(var a=-1,o=Array(e);++a<e;)o[a]=n(a);return o}var bPe=_Pe,xPe=Wl,EPe=$l,SPe="[object Arguments]";function wPe(e){return EPe(e)&&xPe(e)==SPe}var TPe=wPe,lz=TPe,CPe=$l,XQ=Object.prototype,NPe=XQ.hasOwnProperty,RPe=XQ.propertyIsEnumerable,APe=lz(function(){return arguments}())?lz:function(e){return CPe(e)&&NPe.call(e,"callee")&&!RPe.call(e,"callee")},Uk=APe,FS={exports:{}};function IPe(){return!1}var OPe=IPe;FS.exports;(function(e,n){var a=$c,o=OPe,d=n&&!n.nodeType&&n,h=d&&!0&&e&&!e.nodeType&&e,f=h&&h.exports===d,y=f?a.Buffer:void 0,b=y?y.isBuffer:void 0,x=b||o;e.exports=x})(FS,FS.exports);var JQ=FS.exports,PPe=9007199254740991,DPe=/^(?:0|[1-9]\d*)$/;function kPe(e,n){var a=typeof e;return n=n??PPe,!!n&&(a=="number"||a!="symbol"&&DPe.test(e))&&e>-1&&e%1==0&&e<n}var Fk=kPe,jPe=9007199254740991;function LPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=jPe}var Vk=LPe,MPe=Wl,UPe=Vk,FPe=$l,VPe="[object Arguments]",BPe="[object Array]",GPe="[object Boolean]",WPe="[object Date]",$Pe="[object Error]",HPe="[object Function]",zPe="[object Map]",KPe="[object Number]",YPe="[object Object]",qPe="[object RegExp]",XPe="[object Set]",JPe="[object String]",QPe="[object WeakMap]",ZPe="[object ArrayBuffer]",eDe="[object DataView]",tDe="[object Float32Array]",nDe="[object Float64Array]",rDe="[object Int8Array]",iDe="[object Int16Array]",aDe="[object Int32Array]",sDe="[object Uint8Array]",oDe="[object Uint8ClampedArray]",cDe="[object Uint16Array]",lDe="[object Uint32Array]",Sr={};Sr[tDe]=Sr[nDe]=Sr[rDe]=Sr[iDe]=Sr[aDe]=Sr[sDe]=Sr[oDe]=Sr[cDe]=Sr[lDe]=!0;Sr[VPe]=Sr[BPe]=Sr[ZPe]=Sr[GPe]=Sr[eDe]=Sr[WPe]=Sr[$Pe]=Sr[HPe]=Sr[zPe]=Sr[KPe]=Sr[YPe]=Sr[qPe]=Sr[XPe]=Sr[JPe]=Sr[QPe]=!1;function dDe(e){return FPe(e)&&UPe(e.length)&&!!Sr[MPe(e)]}var uDe=dDe;function hDe(e){return function(n){return e(n)}}var QQ=hDe,VS={exports:{}};VS.exports;(function(e,n){var a=aQ,o=n&&!n.nodeType&&n,d=o&&!0&&e&&!e.nodeType&&e,h=d&&d.exports===o,f=h&&a.process,y=function(){try{var b=d&&d.require&&d.require("util").types;return b||f&&f.binding&&f.binding("util")}catch{}}();e.exports=y})(VS,VS.exports);var pDe=VS.exports,mDe=uDe,fDe=QQ,dz=pDe,uz=dz&&dz.isTypedArray,gDe=uz?fDe(uz):mDe,ZQ=gDe,vDe=bPe,yDe=Uk,_De=rs,bDe=JQ,xDe=Fk,EDe=ZQ,SDe=Object.prototype,wDe=SDe.hasOwnProperty;function TDe(e,n){var a=_De(e),o=!a&&yDe(e),d=!a&&!o&&bDe(e),h=!a&&!o&&!d&&EDe(e),f=a||o||d||h,y=f?vDe(e.length,String):[],b=y.length;for(var x in e)(n||wDe.call(e,x))&&!(f&&(x=="length"||d&&(x=="offset"||x=="parent")||h&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||xDe(x,b)))&&y.push(x);return y}var CDe=TDe,NDe=Object.prototype;function RDe(e){var n=e&&e.constructor,a=typeof n=="function"&&n.prototype||NDe;return e===a}var ADe=RDe;function IDe(e,n){return function(a){return e(n(a))}}var eZ=IDe,ODe=eZ,PDe=ODe(Object.keys,Object),DDe=PDe,kDe=ADe,jDe=DDe,LDe=Object.prototype,MDe=LDe.hasOwnProperty;function UDe(e){if(!kDe(e))return jDe(e);var n=[];for(var a in Object(e))MDe.call(e,a)&&a!="constructor"&&n.push(a);return n}var FDe=UDe,VDe=xk,BDe=Vk;function GDe(e){return e!=null&&BDe(e.length)&&!VDe(e)}var q0=GDe,WDe=CDe,$De=FDe,HDe=q0;function zDe(e){return HDe(e)?WDe(e):$De(e)}var CT=zDe,KDe=cPe,YDe=yPe,qDe=CT;function XDe(e){return KDe(e,qDe,YDe)}var JDe=XDe,hz=JDe,QDe=1,ZDe=Object.prototype,e2e=ZDe.hasOwnProperty;function t2e(e,n,a,o,d,h){var f=a&QDe,y=hz(e),b=y.length,x=hz(n),T=x.length;if(b!=T&&!f)return!1;for(var S=b;S--;){var N=y[S];if(!(f?N in n:e2e.call(n,N)))return!1}var O=h.get(e),A=h.get(n);if(O&&A)return O==n&&A==e;var I=!0;h.set(e,n),h.set(n,e);for(var P=f;++S<b;){N=y[S];var L=e[N],F=n[N];if(o)var V=f?o(F,L,N,n,e,h):o(L,F,N,e,n,h);if(!(V===void 0?L===F||d(L,F,a,o,h):V)){I=!1;break}P||(P=N=="constructor")}if(I&&!P){var G=e.constructor,B=n.constructor;G!=B&&"constructor"in e&&"constructor"in n&&!(typeof G=="function"&&G instanceof G&&typeof B=="function"&&B instanceof B)&&(I=!1)}return h.delete(e),h.delete(n),I}var n2e=t2e,r2e=$h,i2e=$c,a2e=r2e(i2e,"DataView"),s2e=a2e,o2e=$h,c2e=$c,l2e=o2e(c2e,"Promise"),d2e=l2e,u2e=$h,h2e=$c,p2e=u2e(h2e,"Set"),tZ=p2e,m2e=$h,f2e=$c,g2e=m2e(f2e,"WeakMap"),v2e=g2e,qP=s2e,XP=Sk,JP=d2e,QP=tZ,ZP=v2e,nZ=Wl,ng=oQ,pz="[object Map]",y2e="[object Object]",mz="[object Promise]",fz="[object Set]",gz="[object WeakMap]",vz="[object DataView]",_2e=ng(qP),b2e=ng(XP),x2e=ng(JP),E2e=ng(QP),S2e=ng(ZP),uh=nZ;(qP&&uh(new qP(new ArrayBuffer(1)))!=vz||XP&&uh(new XP)!=pz||JP&&uh(JP.resolve())!=mz||QP&&uh(new QP)!=fz||ZP&&uh(new ZP)!=gz)&&(uh=function(e){var n=nZ(e),a=n==y2e?e.constructor:void 0,o=a?ng(a):"";if(o)switch(o){case _2e:return vz;case b2e:return pz;case x2e:return mz;case E2e:return fz;case S2e:return gz}return n});var w2e=uh,JO=$Q,T2e=YQ,C2e=rPe,N2e=n2e,yz=w2e,_z=rs,bz=JQ,R2e=ZQ,A2e=1,xz="[object Arguments]",Ez="[object Array]",EE="[object Object]",I2e=Object.prototype,Sz=I2e.hasOwnProperty;function O2e(e,n,a,o,d,h){var f=_z(e),y=_z(n),b=f?Ez:yz(e),x=y?Ez:yz(n);b=b==xz?EE:b,x=x==xz?EE:x;var T=b==EE,S=x==EE,N=b==x;if(N&&bz(e)){if(!bz(n))return!1;f=!0,T=!1}if(N&&!T)return h||(h=new JO),f||R2e(e)?T2e(e,n,a,o,d,h):C2e(e,n,b,a,o,d,h);if(!(a&A2e)){var O=T&&Sz.call(e,"__wrapped__"),A=S&&Sz.call(n,"__wrapped__");if(O||A){var I=O?e.value():e,P=A?n.value():n;return h||(h=new JO),d(I,P,a,o,h)}}return N?(h||(h=new JO),N2e(e,n,a,o,d,h)):!1}var P2e=O2e,D2e=P2e,wz=$l;function rZ(e,n,a,o,d){return e===n?!0:e==null||n==null||!wz(e)&&!wz(n)?e!==e&&n!==n:D2e(e,n,a,o,rZ,d)}var Bk=rZ,k2e=$Q,j2e=Bk,L2e=1,M2e=2;function U2e(e,n,a,o){var d=a.length,h=d,f=!o;if(e==null)return!h;for(e=Object(e);d--;){var y=a[d];if(f&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++d<h;){y=a[d];var b=y[0],x=e[b],T=y[1];if(f&&y[2]){if(x===void 0&&!(b in e))return!1}else{var S=new k2e;if(o)var N=o(x,T,b,e,n,S);if(!(N===void 0?j2e(T,x,L2e|M2e,o,S):N))return!1}}return!0}var F2e=U2e,V2e=ou;function B2e(e){return e===e&&!V2e(e)}var iZ=B2e,G2e=iZ,W2e=CT;function $2e(e){for(var n=W2e(e),a=n.length;a--;){var o=n[a],d=e[o];n[a]=[o,d,G2e(d)]}return n}var H2e=$2e;function z2e(e,n){return function(a){return a==null?!1:a[e]===n&&(n!==void 0||e in Object(a))}}var aZ=z2e,K2e=F2e,Y2e=H2e,q2e=aZ;function X2e(e){var n=Y2e(e);return n.length==1&&n[0][2]?q2e(n[0][0],n[0][1]):function(a){return a===e||K2e(a,e,n)}}var J2e=X2e;function Q2e(e,n){return e!=null&&n in Object(e)}var Z2e=Q2e,eke=hQ,tke=Uk,nke=rs,rke=Fk,ike=Vk,ake=uT;function ske(e,n,a){n=eke(n,e);for(var o=-1,d=n.length,h=!1;++o<d;){var f=ake(n[o]);if(!(h=e!=null&&a(e,f)))break;e=e[f]}return h||++o!=d?h:(d=e==null?0:e.length,!!d&&ike(d)&&rke(f,d)&&(nke(e)||tke(e)))}var oke=ske,cke=Z2e,lke=oke;function dke(e,n){return e!=null&&lke(e,n,cke)}var uke=dke,hke=Bk,pke=pQ,mke=uke,fke=bk,gke=iZ,vke=aZ,yke=uT,_ke=1,bke=2;function xke(e,n){return fke(e)&&gke(n)?vke(yke(e),n):function(a){var o=pke(a,e);return o===void 0&&o===n?mke(a,e):hke(n,o,_ke|bke)}}var Eke=xke;function Ske(e){return e}var rg=Ske;function wke(e){return function(n){return n==null?void 0:n[e]}}var Tke=wke,Cke=Nk;function Nke(e){return function(n){return Cke(n,e)}}var Rke=Nke,Ake=Tke,Ike=Rke,Oke=bk,Pke=uT;function Dke(e){return Oke(e)?Ake(Pke(e)):Ike(e)}var kke=Dke,jke=J2e,Lke=Eke,Mke=rg,Uke=rs,Fke=kke;function Vke(e){return typeof e=="function"?e:e==null?Mke:typeof e=="object"?Uke(e)?Lke(e[0],e[1]):jke(e):Fke(e)}var cu=Vke;function Bke(e,n,a,o){for(var d=e.length,h=a+(o?1:-1);o?h--:++h<d;)if(n(e[h],h,e))return h;return-1}var sZ=Bke;function Gke(e){return e!==e}var Wke=Gke;function $ke(e,n,a){for(var o=a-1,d=e.length;++o<d;)if(e[o]===n)return o;return-1}var Hke=$ke,zke=sZ,Kke=Wke,Yke=Hke;function qke(e,n,a){return n===n?Yke(e,n,a):zke(e,Kke,a)}var Xke=qke,Jke=Xke;function Qke(e,n){var a=e==null?0:e.length;return!!a&&Jke(e,n,0)>-1}var Zke=Qke;function eje(e,n,a){for(var o=-1,d=e==null?0:e.length;++o<d;)if(a(n,e[o]))return!0;return!1}var tje=eje;function nje(){}var rje=nje,QO=tZ,ije=rje,aje=Mk,sje=1/0,oje=QO&&1/aje(new QO([,-0]))[1]==sje?function(e){return new QO(e)}:ije,cje=oje,lje=HQ,dje=Zke,uje=tje,hje=KQ,pje=cje,mje=Mk,fje=200;function gje(e,n,a){var o=-1,d=dje,h=e.length,f=!0,y=[],b=y;if(a)f=!1,d=uje;else if(h>=fje){var x=n?null:pje(e);if(x)return mje(x);f=!1,d=hje,b=new lje}else b=n?[]:y;e:for(;++o<h;){var T=e[o],S=n?n(T):T;if(T=a||T!==0?T:0,f&&S===S){for(var N=b.length;N--;)if(b[N]===S)continue e;n&&b.push(S),y.push(T)}else d(b,S,a)||(b!==y&&b.push(S),y.push(T))}return y}var vje=gje,yje=cu,_je=vje;function bje(e,n){return e&&e.length?_je(e,yje(n)):[]}var xje=bje;const Tz=ar(xje);function oZ(e,n,a){return n===!0?Tz(e,a):un(n)?Tz(e,n):e}function ff(e){"@babel/helpers - typeof";return ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ff(e)}var Eje=["ref"];function Cz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function dl(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Cz(Object(a),!0).forEach(function(o){NT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Sje(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Nz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,lZ(o.key),o)}}function wje(e,n,a){return n&&Nz(e.prototype,n),a&&Nz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tje(e,n,a){return n=BS(n),Cje(e,cZ()?Reflect.construct(n,a||[],BS(e).constructor):n.apply(e,a))}function Cje(e,n){if(n&&(ff(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nje(e)}function Nje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cZ=function(){return!!e})()}function BS(e){return BS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},BS(e)}function Rje(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&eD(e,n)}function eD(e,n){return eD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},eD(e,n)}function NT(e,n,a){return n=lZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function lZ(e){var n=Aje(e,"string");return ff(n)=="symbol"?n:n+""}function Aje(e,n){if(ff(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(ff(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Ije(e,n){if(e==null)return{};var a=Oje(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Oje(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Pje(e){return e.value}function Dje(e,n){if(ge.isValidElement(e))return ge.cloneElement(e,n);if(typeof e=="function")return ge.createElement(e,n);n.ref;var a=Ije(n,Eje);return ge.createElement(Lk,a)}var Rz=1,Jm=function(e){function n(){var a;Sje(this,n);for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];return a=Tje(this,n,[].concat(d)),NT(a,"lastBoundingBox",{width:-1,height:-1}),a}return Rje(n,e),wje(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();return o.height=this.wrapperNode.offsetHeight,o.width=this.wrapperNode.offsetWidth,o}return null}},{key:"updateBBox",value:function(){var o=this.props.onBBoxUpdate,d=this.getBBox();d?(Math.abs(d.width-this.lastBoundingBox.width)>Rz||Math.abs(d.height-this.lastBoundingBox.height)>Rz)&&(this.lastBoundingBox.width=d.width,this.lastBoundingBox.height=d.height,o&&o(d)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,o&&o(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?dl({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(o){var d=this.props,h=d.layout,f=d.align,y=d.verticalAlign,b=d.margin,x=d.chartWidth,T=d.chartHeight,S,N;if(!o||(o.left===void 0||o.left===null)&&(o.right===void 0||o.right===null))if(f==="center"&&h==="vertical"){var O=this.getBBoxSnapshot();S={left:((x||0)-O.width)/2}}else S=f==="right"?{right:b&&b.right||0}:{left:b&&b.left||0};if(!o||(o.top===void 0||o.top===null)&&(o.bottom===void 0||o.bottom===null))if(y==="middle"){var A=this.getBBoxSnapshot();N={top:((T||0)-A.height)/2}}else N=y==="bottom"?{bottom:b&&b.bottom||0}:{top:b&&b.top||0};return dl(dl({},S),N)}},{key:"render",value:function(){var o=this,d=this.props,h=d.content,f=d.width,y=d.height,b=d.wrapperStyle,x=d.payloadUniqBy,T=d.payload,S=dl(dl({position:"absolute",width:f||"auto",height:y||"auto"},this.getDefaultPosition(b)),b);return ge.createElement("div",{className:"recharts-legend-wrapper",style:S,ref:function(O){o.wrapperNode=O}},Dje(h,dl(dl({},this.props),{},{payload:oZ(T,x,Pje)})))}}],[{key:"getWithHeight",value:function(o,d){var h=dl(dl({},this.defaultProps),o.props),f=h.layout;return f==="vertical"&&lt(o.props.height)?{height:o.props.height}:f==="horizontal"?{width:o.props.width||d}:null}}])}(Y.PureComponent);NT(Jm,"displayName","Legend");NT(Jm,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var Az=Y0,kje=Uk,jje=rs,Iz=Az?Az.isConcatSpreadable:void 0;function Lje(e){return jje(e)||kje(e)||!!(Iz&&e&&e[Iz])}var Mje=Lje,Uje=qQ,Fje=Mje;function dZ(e,n,a,o,d){var h=-1,f=e.length;for(a||(a=Fje),d||(d=[]);++h<f;){var y=e[h];n>0&&a(y)?n>1?dZ(y,n-1,a,o,d):Uje(d,y):o||(d[d.length]=y)}return d}var uZ=dZ;function Vje(e){return function(n,a,o){for(var d=-1,h=Object(n),f=o(n),y=f.length;y--;){var b=f[e?y:++d];if(a(h[b],b,h)===!1)break}return n}}var Bje=Vje,Gje=Bje,Wje=Gje(),$je=Wje,Hje=$je,zje=CT;function Kje(e,n){return e&&Hje(e,n,zje)}var hZ=Kje,Yje=q0;function qje(e,n){return function(a,o){if(a==null)return a;if(!Yje(a))return e(a,o);for(var d=a.length,h=n?d:-1,f=Object(a);(n?h--:++h<d)&&o(f[h],h,f)!==!1;);return a}}var Xje=qje,Jje=hZ,Qje=Xje,Zje=Qje(Jje),Gk=Zje,eLe=Gk,tLe=q0;function nLe(e,n){var a=-1,o=tLe(e)?Array(e.length):[];return eLe(e,function(d,h,f){o[++a]=n(d,h,f)}),o}var pZ=nLe;function rLe(e,n){var a=e.length;for(e.sort(n);a--;)e[a]=e[a].value;return e}var iLe=rLe,Oz=Yf;function aLe(e,n){if(e!==n){var a=e!==void 0,o=e===null,d=e===e,h=Oz(e),f=n!==void 0,y=n===null,b=n===n,x=Oz(n);if(!y&&!x&&!h&&e>n||h&&f&&b&&!y&&!x||o&&f&&b||!a&&b||!d)return 1;if(!o&&!h&&!x&&e<n||x&&a&&d&&!o&&!h||y&&a&&d||!f&&d||!b)return-1}return 0}var sLe=aLe,oLe=sLe;function cLe(e,n,a){for(var o=-1,d=e.criteria,h=n.criteria,f=d.length,y=a.length;++o<f;){var b=oLe(d[o],h[o]);if(b){if(o>=y)return b;var x=a[o];return b*(x=="desc"?-1:1)}}return e.index-n.index}var lLe=cLe,ZO=Ck,dLe=Nk,uLe=cu,hLe=pZ,pLe=iLe,mLe=QQ,fLe=lLe,gLe=rg,vLe=rs;function yLe(e,n,a){n.length?n=ZO(n,function(h){return vLe(h)?function(f){return dLe(f,h.length===1?h[0]:h)}:h}):n=[gLe];var o=-1;n=ZO(n,mLe(uLe));var d=hLe(e,function(h,f,y){var b=ZO(n,function(x){return x(h)});return{criteria:b,index:++o,value:h}});return pLe(d,function(h,f){return fLe(h,f,a)})}var _Le=yLe;function bLe(e,n,a){switch(a.length){case 0:return e.call(n);case 1:return e.call(n,a[0]);case 2:return e.call(n,a[0],a[1]);case 3:return e.call(n,a[0],a[1],a[2])}return e.apply(n,a)}var xLe=bLe,ELe=xLe,Pz=Math.max;function SLe(e,n,a){return n=Pz(n===void 0?e.length-1:n,0),function(){for(var o=arguments,d=-1,h=Pz(o.length-n,0),f=Array(h);++d<h;)f[d]=o[n+d];d=-1;for(var y=Array(n+1);++d<n;)y[d]=o[d];return y[n]=a(f),ELe(e,this,y)}}var wLe=SLe;function TLe(e){return function(){return e}}var CLe=TLe,NLe=$h,RLe=function(){try{var e=NLe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),mZ=RLe,ALe=CLe,Dz=mZ,ILe=rg,OLe=Dz?function(e,n){return Dz(e,"toString",{configurable:!0,enumerable:!1,value:ALe(n),writable:!0})}:ILe,PLe=OLe,DLe=800,kLe=16,jLe=Date.now;function LLe(e){var n=0,a=0;return function(){var o=jLe(),d=kLe-(o-a);if(a=o,d>0){if(++n>=DLe)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}var MLe=LLe,ULe=PLe,FLe=MLe,VLe=FLe(ULe),BLe=VLe,GLe=rg,WLe=wLe,$Le=BLe;function HLe(e,n){return $Le(WLe(e,n,GLe),e+"")}var zLe=HLe,KLe=Ek,YLe=q0,qLe=Fk,XLe=ou;function JLe(e,n,a){if(!XLe(a))return!1;var o=typeof n;return(o=="number"?YLe(a)&&qLe(n,a.length):o=="string"&&n in a)?KLe(a[n],e):!1}var RT=JLe,QLe=uZ,ZLe=_Le,eMe=zLe,kz=RT,tMe=eMe(function(e,n){if(e==null)return[];var a=n.length;return a>1&&kz(e,n[0],n[1])?n=[]:a>2&&kz(n[0],n[1],n[2])&&(n=[n[0]]),ZLe(e,QLe(n,1),[])}),nMe=tMe;const Wk=ar(nMe);function e0(e){"@babel/helpers - typeof";return e0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e0(e)}function tD(){return tD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},tD.apply(this,arguments)}function rMe(e,n){return oMe(e)||sMe(e,n)||aMe(e,n)||iMe()}function iMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aMe(e,n){if(e){if(typeof e=="string")return jz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jz(e,n)}}function jz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function sMe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function oMe(e){if(Array.isArray(e))return e}function Lz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function e1(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Lz(Object(a),!0).forEach(function(o){cMe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function cMe(e,n,a){return n=lMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function lMe(e){var n=dMe(e,"string");return e0(n)=="symbol"?n:n+""}function dMe(e,n){if(e0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(e0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function uMe(e){return Array.isArray(e)&&_i(e[0])&&_i(e[1])?e.join(" ~ "):e}var hMe=function(n){var a=n.separator,o=a===void 0?" : ":a,d=n.contentStyle,h=d===void 0?{}:d,f=n.itemStyle,y=f===void 0?{}:f,b=n.labelStyle,x=b===void 0?{}:b,T=n.payload,S=n.formatter,N=n.itemSorter,O=n.wrapperClassName,A=n.labelClassName,I=n.label,P=n.labelFormatter,L=n.accessibilityLayer,F=L===void 0?!1:L,V=function(){if(T&&T.length){var pe={padding:0,margin:0},Se=(N?Wk(T,N):T).map(function(fe,be){if(fe.type==="none")return null;var se=e1({display:"block",paddingTop:4,paddingBottom:4,color:fe.color||"#000"},y),he=fe.formatter||S||uMe,Q=fe.value,le=fe.name,we=Q,Ue=le;if(he&&we!=null&&Ue!=null){var Le=he(Q,le,fe,be,T);if(Array.isArray(Le)){var tt=rMe(Le,2);we=tt[0],Ue=tt[1]}else we=Le}return ge.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(be),style:se},_i(Ue)?ge.createElement("span",{className:"recharts-tooltip-item-name"},Ue):null,_i(Ue)?ge.createElement("span",{className:"recharts-tooltip-item-separator"},o):null,ge.createElement("span",{className:"recharts-tooltip-item-value"},we),ge.createElement("span",{className:"recharts-tooltip-item-unit"},fe.unit||""))});return ge.createElement("ul",{className:"recharts-tooltip-item-list",style:pe},Se)}return null},G=e1({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},h),B=e1({margin:0},x),z=!yn(I),q=z?I:"",Z=An("recharts-default-tooltip",O),ie=An("recharts-tooltip-label",A);z&&P&&T!==void 0&&T!==null&&(q=P(I,T));var ue=F?{role:"status","aria-live":"assertive"}:{};return ge.createElement("div",tD({className:Z,style:G},ue),ge.createElement("p",{className:ie,style:B},ge.isValidElement(q)?q:"".concat(q)),V())};function t0(e){"@babel/helpers - typeof";return t0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t0(e)}function SE(e,n,a){return n=pMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function pMe(e){var n=mMe(e,"string");return t0(n)=="symbol"?n:n+""}function mMe(e,n){if(t0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(t0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var qv="recharts-tooltip-wrapper",fMe={visibility:"hidden"};function gMe(e){var n=e.coordinate,a=e.translateX,o=e.translateY;return An(qv,SE(SE(SE(SE({},"".concat(qv,"-right"),lt(a)&&n&&lt(n.x)&&a>=n.x),"".concat(qv,"-left"),lt(a)&&n&&lt(n.x)&&a<n.x),"".concat(qv,"-bottom"),lt(o)&&n&&lt(n.y)&&o>=n.y),"".concat(qv,"-top"),lt(o)&&n&&lt(n.y)&&o<n.y))}function Mz(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.key,d=e.offsetTopLeft,h=e.position,f=e.reverseDirection,y=e.tooltipDimension,b=e.viewBox,x=e.viewBoxDimension;if(h&&lt(h[o]))return h[o];var T=a[o]-y-d,S=a[o]+d;if(n[o])return f[o]?T:S;if(f[o]){var N=T,O=b[o];return N<O?Math.max(S,b[o]):Math.max(T,b[o])}var A=S+y,I=b[o]+x;return A>I?Math.max(T,b[o]):Math.max(S,b[o])}function vMe(e){var n=e.translateX,a=e.translateY,o=e.useTranslate3d;return{transform:o?"translate3d(".concat(n,"px, ").concat(a,"px, 0)"):"translate(".concat(n,"px, ").concat(a,"px)")}}function yMe(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.offsetTopLeft,d=e.position,h=e.reverseDirection,f=e.tooltipBox,y=e.useTranslate3d,b=e.viewBox,x,T,S;return f.height>0&&f.width>0&&a?(T=Mz({allowEscapeViewBox:n,coordinate:a,key:"x",offsetTopLeft:o,position:d,reverseDirection:h,tooltipDimension:f.width,viewBox:b,viewBoxDimension:b.width}),S=Mz({allowEscapeViewBox:n,coordinate:a,key:"y",offsetTopLeft:o,position:d,reverseDirection:h,tooltipDimension:f.height,viewBox:b,viewBoxDimension:b.height}),x=vMe({translateX:T,translateY:S,useTranslate3d:y})):x=fMe,{cssProperties:x,cssClasses:gMe({translateX:T,translateY:S,coordinate:a})}}function gf(e){"@babel/helpers - typeof";return gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gf(e)}function Uz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Fz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Uz(Object(a),!0).forEach(function(o){rD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Uz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function _Me(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function bMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,gZ(o.key),o)}}function xMe(e,n,a){return n&&bMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function EMe(e,n,a){return n=GS(n),SMe(e,fZ()?Reflect.construct(n,a||[],GS(e).constructor):n.apply(e,a))}function SMe(e,n){if(n&&(gf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wMe(e)}function wMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fZ=function(){return!!e})()}function GS(e){return GS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},GS(e)}function TMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&nD(e,n)}function nD(e,n){return nD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},nD(e,n)}function rD(e,n,a){return n=gZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function gZ(e){var n=CMe(e,"string");return gf(n)=="symbol"?n:n+""}function CMe(e,n){if(gf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(gf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Vz=1,NMe=function(e){function n(){var a;_Me(this,n);for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];return a=EMe(this,n,[].concat(d)),rD(a,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),rD(a,"handleKeyDown",function(f){if(f.key==="Escape"){var y,b,x,T;a.setState({dismissed:!0,dismissedAtCoordinate:{x:(y=(b=a.props.coordinate)===null||b===void 0?void 0:b.x)!==null&&y!==void 0?y:0,y:(x=(T=a.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&x!==void 0?x:0}})}}),a}return TMe(n,e),xMe(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();(Math.abs(o.width-this.state.lastBoundingBox.width)>Vz||Math.abs(o.height-this.state.lastBoundingBox.height)>Vz)&&this.setState({lastBoundingBox:{width:o.width,height:o.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var o,d;this.props.active&&this.updateBBox(),this.state.dismissed&&(((o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==this.state.dismissedAtCoordinate.x||((d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var o=this,d=this.props,h=d.active,f=d.allowEscapeViewBox,y=d.animationDuration,b=d.animationEasing,x=d.children,T=d.coordinate,S=d.hasPayload,N=d.isAnimationActive,O=d.offset,A=d.position,I=d.reverseDirection,P=d.useTranslate3d,L=d.viewBox,F=d.wrapperStyle,V=yMe({allowEscapeViewBox:f,coordinate:T,offsetTopLeft:O,position:A,reverseDirection:I,tooltipBox:this.state.lastBoundingBox,useTranslate3d:P,viewBox:L}),G=V.cssClasses,B=V.cssProperties,z=Fz(Fz({transition:N&&h?"transform ".concat(y,"ms ").concat(b):void 0},B),{},{pointerEvents:"none",visibility:!this.state.dismissed&&h&&S?"visible":"hidden",position:"absolute",top:0,left:0},F);return ge.createElement("div",{tabIndex:-1,className:G,style:z,ref:function(Z){o.wrapperNode=Z}},x)}}])}(Y.PureComponent),RMe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Hh={isSsr:RMe()};function vf(e){"@babel/helpers - typeof";return vf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vf(e)}function Bz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Gz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Bz(Object(a),!0).forEach(function(o){$k(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function AMe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function IMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,yZ(o.key),o)}}function OMe(e,n,a){return n&&IMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function PMe(e,n,a){return n=WS(n),DMe(e,vZ()?Reflect.construct(n,a||[],WS(e).constructor):n.apply(e,a))}function DMe(e,n){if(n&&(vf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kMe(e)}function kMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vZ=function(){return!!e})()}function WS(e){return WS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},WS(e)}function jMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&iD(e,n)}function iD(e,n){return iD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},iD(e,n)}function $k(e,n,a){return n=yZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function yZ(e){var n=LMe(e,"string");return vf(n)=="symbol"?n:n+""}function LMe(e,n){if(vf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(vf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function MMe(e){return e.dataKey}function UMe(e,n){return ge.isValidElement(e)?ge.cloneElement(e,n):typeof e=="function"?ge.createElement(e,n):ge.createElement(hMe,n)}var Ha=function(e){function n(){return AMe(this,n),PMe(this,n,arguments)}return jMe(n,e),OMe(n,[{key:"render",value:function(){var o=this,d=this.props,h=d.active,f=d.allowEscapeViewBox,y=d.animationDuration,b=d.animationEasing,x=d.content,T=d.coordinate,S=d.filterNull,N=d.isAnimationActive,O=d.offset,A=d.payload,I=d.payloadUniqBy,P=d.position,L=d.reverseDirection,F=d.useTranslate3d,V=d.viewBox,G=d.wrapperStyle,B=A??[];S&&B.length&&(B=oZ(A.filter(function(q){return q.value!=null&&(q.hide!==!0||o.props.includeHidden)}),I,MMe));var z=B.length>0;return ge.createElement(NMe,{allowEscapeViewBox:f,animationDuration:y,animationEasing:b,isAnimationActive:N,active:h,coordinate:T,hasPayload:z,offset:O,position:P,reverseDirection:L,useTranslate3d:F,viewBox:V,wrapperStyle:G},UMe(x,Gz(Gz({},this.props),{},{payload:B})))}}])}(Y.PureComponent);$k(Ha,"displayName","Tooltip");$k(Ha,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Hh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var FMe=$c,VMe=function(){return FMe.Date.now()},BMe=VMe,GMe=/\s/;function WMe(e){for(var n=e.length;n--&&GMe.test(e.charAt(n)););return n}var $Me=WMe,HMe=$Me,zMe=/^\s+/;function KMe(e){return e&&e.slice(0,HMe(e)+1).replace(zMe,"")}var YMe=KMe,qMe=YMe,Wz=ou,XMe=Yf,$z=NaN,JMe=/^[-+]0x[0-9a-f]+$/i,QMe=/^0b[01]+$/i,ZMe=/^0o[0-7]+$/i,eUe=parseInt;function tUe(e){if(typeof e=="number")return e;if(XMe(e))return $z;if(Wz(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Wz(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=qMe(e);var a=QMe.test(e);return a||ZMe.test(e)?eUe(e.slice(2),a?2:8):JMe.test(e)?$z:+e}var _Z=tUe,nUe=ou,t1=BMe,Hz=_Z,rUe="Expected a function",iUe=Math.max,aUe=Math.min;function sUe(e,n,a){var o,d,h,f,y,b,x=0,T=!1,S=!1,N=!0;if(typeof e!="function")throw new TypeError(rUe);n=Hz(n)||0,nUe(a)&&(T=!!a.leading,S="maxWait"in a,h=S?iUe(Hz(a.maxWait)||0,n):h,N="trailing"in a?!!a.trailing:N);function O(z){var q=o,Z=d;return o=d=void 0,x=z,f=e.apply(Z,q),f}function A(z){return x=z,y=setTimeout(L,n),T?O(z):f}function I(z){var q=z-b,Z=z-x,ie=n-q;return S?aUe(ie,h-Z):ie}function P(z){var q=z-b,Z=z-x;return b===void 0||q>=n||q<0||S&&Z>=h}function L(){var z=t1();if(P(z))return F(z);y=setTimeout(L,I(z))}function F(z){return y=void 0,N&&o?O(z):(o=d=void 0,f)}function V(){y!==void 0&&clearTimeout(y),x=0,o=b=d=y=void 0}function G(){return y===void 0?f:F(t1())}function B(){var z=t1(),q=P(z);if(o=arguments,d=this,b=z,q){if(y===void 0)return A(b);if(S)return clearTimeout(y),y=setTimeout(L,n),O(b)}return y===void 0&&(y=setTimeout(L,n)),f}return B.cancel=V,B.flush=G,B}var oUe=sUe,cUe=oUe,lUe=ou,dUe="Expected a function";function uUe(e,n,a){var o=!0,d=!0;if(typeof e!="function")throw new TypeError(dUe);return lUe(a)&&(o="leading"in a?!!a.leading:o,d="trailing"in a?!!a.trailing:d),cUe(e,n,{leading:o,maxWait:n,trailing:d})}var hUe=uUe;const bZ=ar(hUe);function n0(e){"@babel/helpers - typeof";return n0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n0(e)}function zz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function wE(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?zz(Object(a),!0).forEach(function(o){pUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function pUe(e,n,a){return n=mUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function mUe(e){var n=fUe(e,"string");return n0(n)=="symbol"?n:n+""}function fUe(e,n){if(n0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(n0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function gUe(e,n){return bUe(e)||_Ue(e,n)||yUe(e,n)||vUe()}function vUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yUe(e,n){if(e){if(typeof e=="string")return Kz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Kz(e,n)}}function Kz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function _Ue(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function bUe(e){if(Array.isArray(e))return e}var r0=Y.forwardRef(function(e,n){var a=e.aspect,o=e.initialDimension,d=o===void 0?{width:-1,height:-1}:o,h=e.width,f=h===void 0?"100%":h,y=e.height,b=y===void 0?"100%":y,x=e.minWidth,T=x===void 0?0:x,S=e.minHeight,N=e.maxHeight,O=e.children,A=e.debounce,I=A===void 0?0:A,P=e.id,L=e.className,F=e.onResize,V=e.style,G=V===void 0?{}:V,B=Y.useRef(null),z=Y.useRef();z.current=F,Y.useImperativeHandle(n,function(){return Object.defineProperty(B.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),B.current},configurable:!0})});var q=Y.useState({containerWidth:d.width,containerHeight:d.height}),Z=gUe(q,2),ie=Z[0],ue=Z[1],re=Y.useCallback(function(Se,fe){ue(function(be){var se=Math.round(Se),he=Math.round(fe);return be.containerWidth===se&&be.containerHeight===he?be:{containerWidth:se,containerHeight:he}})},[]);Y.useEffect(function(){var Se=function(le){var we,Ue=le[0].contentRect,Le=Ue.width,tt=Ue.height;re(Le,tt),(we=z.current)===null||we===void 0||we.call(z,Le,tt)};I>0&&(Se=bZ(Se,I,{trailing:!0,leading:!1}));var fe=new ResizeObserver(Se),be=B.current.getBoundingClientRect(),se=be.width,he=be.height;return re(se,he),fe.observe(B.current),function(){fe.disconnect()}},[re,I]);var pe=Y.useMemo(function(){var Se=ie.containerWidth,fe=ie.containerHeight;if(Se<0||fe<0)return null;wl(bh(f)||bh(b),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,b),wl(!a||a>0,"The aspect(%s) must be greater than zero.",a);var be=bh(f)?Se:f,se=bh(b)?fe:b;a&&a>0&&(be?se=be/a:se&&(be=se*a),N&&se>N&&(se=N)),wl(be>0||se>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,be,se,f,b,T,S,a);var he=!Array.isArray(O)&&Sl(O.type).endsWith("Chart");return ge.Children.map(O,function(Q){return ge.isValidElement(Q)?Y.cloneElement(Q,wE({width:be,height:se},he?{style:wE({height:"100%",width:"100%",maxHeight:se,maxWidth:be},Q.props.style)}:{})):Q})},[a,O,b,N,S,T,ie,f]);return ge.createElement("div",{id:P?"".concat(P):void 0,className:An("recharts-responsive-container",L),style:wE(wE({},G),{},{width:f,height:b,minWidth:T,minHeight:S,maxHeight:N}),ref:B},pe)}),xZ=function(n){return null};xZ.displayName="Cell";function i0(e){"@babel/helpers - typeof";return i0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i0(e)}function Yz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function aD(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Yz(Object(a),!0).forEach(function(o){xUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function xUe(e,n,a){return n=EUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function EUe(e){var n=SUe(e,"string");return i0(n)=="symbol"?n:n+""}function SUe(e,n){if(i0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(i0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Em={widthCache:{},cacheCount:0},wUe=2e3,TUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},qz="recharts_measurement_span";function CUe(e){var n=aD({},e);return Object.keys(n).forEach(function(a){n[a]||delete n[a]}),n}var wy=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Hh.isSsr)return{width:0,height:0};var o=CUe(a),d=JSON.stringify({text:n,copyStyle:o});if(Em.widthCache[d])return Em.widthCache[d];try{var h=document.getElementById(qz);h||(h=document.createElement("span"),h.setAttribute("id",qz),h.setAttribute("aria-hidden","true"),document.body.appendChild(h));var f=aD(aD({},TUe),o);Object.assign(h.style,f),h.textContent="".concat(n);var y=h.getBoundingClientRect(),b={width:y.width,height:y.height};return Em.widthCache[d]=b,++Em.cacheCount>wUe&&(Em.cacheCount=0,Em.widthCache={}),b}catch{return{width:0,height:0}}},NUe=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function a0(e){"@babel/helpers - typeof";return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a0(e)}function $S(e,n){return OUe(e)||IUe(e,n)||AUe(e,n)||RUe()}function RUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AUe(e,n){if(e){if(typeof e=="string")return Xz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xz(e,n)}}function Xz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function IUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function OUe(e){if(Array.isArray(e))return e}function PUe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Jz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,kUe(o.key),o)}}function DUe(e,n,a){return n&&Jz(e.prototype,n),a&&Jz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function kUe(e){var n=jUe(e,"string");return a0(n)=="symbol"?n:n+""}function jUe(e,n){if(a0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(a0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Qz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Zz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,LUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,MUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,EZ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},UUe=Object.keys(EZ),Bm="NaN";function FUe(e,n){return e*EZ[n]}var TE=function(){function e(n,a){PUe(this,e),this.num=n,this.unit=a,this.num=n,this.unit=a,Number.isNaN(n)&&(this.unit=""),a!==""&&!LUe.test(a)&&(this.num=NaN,this.unit=""),UUe.includes(a)&&(this.num=FUe(n,a),this.unit="px")}return DUe(e,[{key:"add",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num+a.num,this.unit)}},{key:"subtract",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num-a.num,this.unit)}},{key:"multiply",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num*a.num,this.unit||a.unit)}},{key:"divide",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num/a.num,this.unit||a.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(a){var o,d=(o=MUe.exec(a))!==null&&o!==void 0?o:[],h=$S(d,3),f=h[1],y=h[2];return new e(parseFloat(f),y??"")}}])}();function SZ(e){if(e.includes(Bm))return Bm;for(var n=e;n.includes("*")||n.includes("/");){var a,o=(a=Qz.exec(n))!==null&&a!==void 0?a:[],d=$S(o,4),h=d[1],f=d[2],y=d[3],b=TE.parse(h??""),x=TE.parse(y??""),T=f==="*"?b.multiply(x):b.divide(x);if(T.isNaN())return Bm;n=n.replace(Qz,T.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var S,N=(S=Zz.exec(n))!==null&&S!==void 0?S:[],O=$S(N,4),A=O[1],I=O[2],P=O[3],L=TE.parse(A??""),F=TE.parse(P??""),V=I==="+"?L.add(F):L.subtract(F);if(V.isNaN())return Bm;n=n.replace(Zz,V.toString())}return n}var eK=/\(([^()]*)\)/;function VUe(e){for(var n=e;n.includes("(");){var a=eK.exec(n),o=$S(a,2),d=o[1];n=n.replace(eK,SZ(d))}return n}function BUe(e){var n=e.replace(/\s+/g,"");return n=VUe(n),n=SZ(n),n}function GUe(e){try{return BUe(e)}catch{return Bm}}function n1(e){var n=GUe(e.slice(5,-1));return n===Bm?"":n}var WUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],$Ue=["dx","dy","angle","className","breakAll"];function sD(){return sD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},sD.apply(this,arguments)}function tK(e,n){if(e==null)return{};var a=HUe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function HUe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function nK(e,n){return qUe(e)||YUe(e,n)||KUe(e,n)||zUe()}function zUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KUe(e,n){if(e){if(typeof e=="string")return rK(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rK(e,n)}}function rK(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function YUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function qUe(e){if(Array.isArray(e))return e}var wZ=/[ \f\n\r\t\v\u2028\u2029]+/,TZ=function(n){var a=n.children,o=n.breakAll,d=n.style;try{var h=[];yn(a)||(o?h=a.toString().split(""):h=a.toString().split(wZ));var f=h.map(function(b){return{word:b,width:wy(b,d).width}}),y=o?0:wy("",d).width;return{wordsWithComputedWidth:f,spaceWidth:y}}catch{return null}},XUe=function(n,a,o,d,h){var f=n.maxLines,y=n.children,b=n.style,x=n.breakAll,T=lt(f),S=y,N=function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return be.reduce(function(se,he){var Q=he.word,le=he.width,we=se[se.length-1];if(we&&(d==null||h||we.width+le+o<Number(d)))we.words.push(Q),we.width+=le+o;else{var Ue={words:[Q],width:le};se.push(Ue)}return se},[])},O=N(a),A=function(be){return be.reduce(function(se,he){return se.width>he.width?se:he})};if(!T)return O;for(var I="",P=function(be){var se=S.slice(0,be),he=TZ({breakAll:x,style:b,children:se+I}).wordsWithComputedWidth,Q=N(he),le=Q.length>f||A(Q).width>Number(d);return[le,Q]},L=0,F=S.length-1,V=0,G;L<=F&&V<=S.length-1;){var B=Math.floor((L+F)/2),z=B-1,q=P(z),Z=nK(q,2),ie=Z[0],ue=Z[1],re=P(B),pe=nK(re,1),Se=pe[0];if(!ie&&!Se&&(L=B+1),ie&&Se&&(F=B-1),!ie&&Se){G=ue;break}V++}return G||O},iK=function(n){var a=yn(n)?[]:n.toString().split(wZ);return[{words:a}]},JUe=function(n){var a=n.width,o=n.scaleToFit,d=n.children,h=n.style,f=n.breakAll,y=n.maxLines;if((a||o)&&!Hh.isSsr){var b,x,T=TZ({breakAll:f,children:d,style:h});if(T){var S=T.wordsWithComputedWidth,N=T.spaceWidth;b=S,x=N}else return iK(d);return XUe({breakAll:f,children:d,maxLines:y,style:h},b,x,a,o)}return iK(d)},aK="#808080",HS=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,h=d===void 0?0:d,f=n.lineHeight,y=f===void 0?"1em":f,b=n.capHeight,x=b===void 0?"0.71em":b,T=n.scaleToFit,S=T===void 0?!1:T,N=n.textAnchor,O=N===void 0?"start":N,A=n.verticalAnchor,I=A===void 0?"end":A,P=n.fill,L=P===void 0?aK:P,F=tK(n,WUe),V=Y.useMemo(function(){return JUe({breakAll:F.breakAll,children:F.children,maxLines:F.maxLines,scaleToFit:S,style:F.style,width:F.width})},[F.breakAll,F.children,F.maxLines,S,F.style,F.width]),G=F.dx,B=F.dy,z=F.angle,q=F.className,Z=F.breakAll,ie=tK(F,$Ue);if(!_i(o)||!_i(h))return null;var ue=o+(lt(G)?G:0),re=h+(lt(B)?B:0),pe;switch(I){case"start":pe=n1("calc(".concat(x,")"));break;case"middle":pe=n1("calc(".concat((V.length-1)/2," * -").concat(y," + (").concat(x," / 2))"));break;default:pe=n1("calc(".concat(V.length-1," * -").concat(y,")"));break}var Se=[];if(S){var fe=V[0].width,be=F.width;Se.push("scale(".concat((lt(be)?be/fe:1)/fe,")"))}return z&&Se.push("rotate(".concat(z,", ").concat(ue,", ").concat(re,")")),Se.length&&(ie.transform=Se.join(" ")),ge.createElement("text",sD({},gn(ie,!0),{x:ue,y:re,className:An("recharts-text",q),textAnchor:O,fill:L.includes("url")?aK:L}),V.map(function(se,he){var Q=se.words.join(Z?"":" ");return ge.createElement("tspan",{x:ue,dy:he===0?pe:y,key:"".concat(Q,"-").concat(he)},Q)}))};function Qd(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function QUe(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Hk(e){let n,a,o;e.length!==2?(n=Qd,a=(y,b)=>Qd(e(y),b),o=(y,b)=>e(y)-b):(n=e===Qd||e===QUe?e:ZUe,a=e,o=e);function d(y,b,x=0,T=y.length){if(x<T){if(n(b,b)!==0)return T;do{const S=x+T>>>1;a(y[S],b)<0?x=S+1:T=S}while(x<T)}return x}function h(y,b,x=0,T=y.length){if(x<T){if(n(b,b)!==0)return T;do{const S=x+T>>>1;a(y[S],b)<=0?x=S+1:T=S}while(x<T)}return x}function f(y,b,x=0,T=y.length){const S=d(y,b,x,T-1);return S>x&&o(y[S-1],b)>-o(y[S],b)?S-1:S}return{left:d,center:f,right:h}}function ZUe(){return 0}function CZ(e){return e===null?NaN:+e}function*e5e(e,n){for(let a of e)a!=null&&(a=+a)>=a&&(yield a)}const t5e=Hk(Qd),X0=t5e.right;Hk(CZ).center;class sK extends Map{constructor(n,a=i5e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),n!=null)for(const[o,d]of n)this.set(o,d)}get(n){return super.get(oK(this,n))}has(n){return super.has(oK(this,n))}set(n,a){return super.set(n5e(this,n),a)}delete(n){return super.delete(r5e(this,n))}}function oK({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):a}function n5e({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):(e.set(o,a),a)}function r5e({_intern:e,_key:n},a){const o=n(a);return e.has(o)&&(a=e.get(o),e.delete(o)),a}function i5e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function a5e(e=Qd){if(e===Qd)return NZ;if(typeof e!="function")throw new TypeError("compare is not a function");return(n,a)=>{const o=e(n,a);return o||o===0?o:(e(a,a)===0)-(e(n,n)===0)}}function NZ(e,n){return(e==null||!(e>=e))-(n==null||!(n>=n))||(e<n?-1:e>n?1:0)}const s5e=Math.sqrt(50),o5e=Math.sqrt(10),c5e=Math.sqrt(2);function zS(e,n,a){const o=(n-e)/Math.max(0,a),d=Math.floor(Math.log10(o)),h=o/Math.pow(10,d),f=h>=s5e?10:h>=o5e?5:h>=c5e?2:1;let y,b,x;return d<0?(x=Math.pow(10,-d)/f,y=Math.round(e*x),b=Math.round(n*x),y/x<e&&++y,b/x>n&&--b,x=-x):(x=Math.pow(10,d)*f,y=Math.round(e/x),b=Math.round(n/x),y*x<e&&++y,b*x>n&&--b),b<y&&.5<=a&&a<2?zS(e,n,a*2):[y,b,x]}function oD(e,n,a){if(n=+n,e=+e,a=+a,!(a>0))return[];if(e===n)return[e];const o=n<e,[d,h,f]=o?zS(n,e,a):zS(e,n,a);if(!(h>=d))return[];const y=h-d+1,b=new Array(y);if(o)if(f<0)for(let x=0;x<y;++x)b[x]=(h-x)/-f;else for(let x=0;x<y;++x)b[x]=(h-x)*f;else if(f<0)for(let x=0;x<y;++x)b[x]=(d+x)/-f;else for(let x=0;x<y;++x)b[x]=(d+x)*f;return b}function cD(e,n,a){return n=+n,e=+e,a=+a,zS(e,n,a)[2]}function lD(e,n,a){n=+n,e=+e,a=+a;const o=n<e,d=o?cD(n,e,a):cD(e,n,a);return(o?-1:1)*(d<0?1/-d:d)}function cK(e,n){let a;for(const o of e)o!=null&&(a<o||a===void 0&&o>=o)&&(a=o);return a}function lK(e,n){let a;for(const o of e)o!=null&&(a>o||a===void 0&&o>=o)&&(a=o);return a}function RZ(e,n,a=0,o=1/0,d){if(n=Math.floor(n),a=Math.floor(Math.max(0,a)),o=Math.floor(Math.min(e.length-1,o)),!(a<=n&&n<=o))return e;for(d=d===void 0?NZ:a5e(d);o>a;){if(o-a>600){const b=o-a+1,x=n-a+1,T=Math.log(b),S=.5*Math.exp(2*T/3),N=.5*Math.sqrt(T*S*(b-S)/b)*(x-b/2<0?-1:1),O=Math.max(a,Math.floor(n-x*S/b+N)),A=Math.min(o,Math.floor(n+(b-x)*S/b+N));RZ(e,n,O,A,d)}const h=e[n];let f=a,y=o;for(Xv(e,a,n),d(e[o],h)>0&&Xv(e,a,o);f<y;){for(Xv(e,f,y),++f,--y;d(e[f],h)<0;)++f;for(;d(e[y],h)>0;)--y}d(e[a],h)===0?Xv(e,a,y):(++y,Xv(e,y,o)),y<=n&&(a=y+1),n<=y&&(o=y-1)}return e}function Xv(e,n,a){const o=e[n];e[n]=e[a],e[a]=o}function l5e(e,n,a){if(e=Float64Array.from(e5e(e)),!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return lK(e);if(n>=1)return cK(e);var o,d=(o-1)*n,h=Math.floor(d),f=cK(RZ(e,h).subarray(0,h+1)),y=lK(e.subarray(h+1));return f+(y-f)*(d-h)}}function d5e(e,n,a=CZ){if(!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return+a(e[0],0,e);if(n>=1)return+a(e[o-1],o-1,e);var o,d=(o-1)*n,h=Math.floor(d),f=+a(e[h],h,e),y=+a(e[h+1],h+1,e);return f+(y-f)*(d-h)}}function u5e(e,n,a){e=+e,n=+n,a=(d=arguments.length)<2?(n=e,e=0,1):d<3?1:+a;for(var o=-1,d=Math.max(0,Math.ceil((n-e)/a))|0,h=new Array(d);++o<d;)h[o]=e+o*a;return h}function go(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function Hl(e,n){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const dD=Symbol("implicit");function zk(){var e=new sK,n=[],a=[],o=dD;function d(h){let f=e.get(h);if(f===void 0){if(o!==dD)return o;e.set(h,f=n.push(h)-1)}return a[f%a.length]}return d.domain=function(h){if(!arguments.length)return n.slice();n=[],e=new sK;for(const f of h)e.has(f)||e.set(f,n.push(f)-1);return d},d.range=function(h){return arguments.length?(a=Array.from(h),d):a.slice()},d.unknown=function(h){return arguments.length?(o=h,d):o},d.copy=function(){return zk(n,a).unknown(o)},go.apply(d,arguments),d}function s0(){var e=zk().unknown(void 0),n=e.domain,a=e.range,o=0,d=1,h,f,y=!1,b=0,x=0,T=.5;delete e.unknown;function S(){var N=n().length,O=d<o,A=O?d:o,I=O?o:d;h=(I-A)/Math.max(1,N-b+x*2),y&&(h=Math.floor(h)),A+=(I-A-h*(N-b))*T,f=h*(1-b),y&&(A=Math.round(A),f=Math.round(f));var P=u5e(N).map(function(L){return A+h*L});return a(O?P.reverse():P)}return e.domain=function(N){return arguments.length?(n(N),S()):n()},e.range=function(N){return arguments.length?([o,d]=N,o=+o,d=+d,S()):[o,d]},e.rangeRound=function(N){return[o,d]=N,o=+o,d=+d,y=!0,S()},e.bandwidth=function(){return f},e.step=function(){return h},e.round=function(N){return arguments.length?(y=!!N,S()):y},e.padding=function(N){return arguments.length?(b=Math.min(1,x=+N),S()):b},e.paddingInner=function(N){return arguments.length?(b=Math.min(1,N),S()):b},e.paddingOuter=function(N){return arguments.length?(x=+N,S()):x},e.align=function(N){return arguments.length?(T=Math.max(0,Math.min(1,N)),S()):T},e.copy=function(){return s0(n(),[o,d]).round(y).paddingInner(b).paddingOuter(x).align(T)},go.apply(S(),arguments)}function AZ(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return AZ(n())},e}function Ty(){return AZ(s0.apply(null,arguments).paddingInner(1))}function Kk(e,n,a){e.prototype=n.prototype=a,a.constructor=e}function IZ(e,n){var a=Object.create(e.prototype);for(var o in n)a[o]=n[o];return a}function J0(){}var o0=.7,KS=1/o0,Qm="\\s*([+-]?\\d+)\\s*",c0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",h5e=/^#([0-9a-f]{3,8})$/,p5e=new RegExp(`^rgb\\(${Qm},${Qm},${Qm}\\)$`),m5e=new RegExp(`^rgb\\(${Fc},${Fc},${Fc}\\)$`),f5e=new RegExp(`^rgba\\(${Qm},${Qm},${Qm},${c0}\\)$`),g5e=new RegExp(`^rgba\\(${Fc},${Fc},${Fc},${c0}\\)$`),v5e=new RegExp(`^hsl\\(${c0},${Fc},${Fc}\\)$`),y5e=new RegExp(`^hsla\\(${c0},${Fc},${Fc},${c0}\\)$`),dK={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Kk(J0,l0,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:uK,formatHex:uK,formatHex8:_5e,formatHsl:b5e,formatRgb:hK,toString:hK});function uK(){return this.rgb().formatHex()}function _5e(){return this.rgb().formatHex8()}function b5e(){return OZ(this).formatHsl()}function hK(){return this.rgb().formatRgb()}function l0(e){var n,a;return e=(e+"").trim().toLowerCase(),(n=h5e.exec(e))?(a=n[1].length,n=parseInt(n[1],16),a===6?pK(n):a===3?new Xa(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):a===8?CE(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):a===4?CE(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=p5e.exec(e))?new Xa(n[1],n[2],n[3],1):(n=m5e.exec(e))?new Xa(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=f5e.exec(e))?CE(n[1],n[2],n[3],n[4]):(n=g5e.exec(e))?CE(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=v5e.exec(e))?gK(n[1],n[2]/100,n[3]/100,1):(n=y5e.exec(e))?gK(n[1],n[2]/100,n[3]/100,n[4]):dK.hasOwnProperty(e)?pK(dK[e]):e==="transparent"?new Xa(NaN,NaN,NaN,0):null}function pK(e){return new Xa(e>>16&255,e>>8&255,e&255,1)}function CE(e,n,a,o){return o<=0&&(e=n=a=NaN),new Xa(e,n,a,o)}function x5e(e){return e instanceof J0||(e=l0(e)),e?(e=e.rgb(),new Xa(e.r,e.g,e.b,e.opacity)):new Xa}function uD(e,n,a,o){return arguments.length===1?x5e(e):new Xa(e,n,a,o??1)}function Xa(e,n,a,o){this.r=+e,this.g=+n,this.b=+a,this.opacity=+o}Kk(Xa,uD,IZ(J0,{brighter(e){return e=e==null?KS:Math.pow(KS,e),new Xa(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?o0:Math.pow(o0,e),new Xa(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Xa(Rh(this.r),Rh(this.g),Rh(this.b),YS(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mK,formatHex:mK,formatHex8:E5e,formatRgb:fK,toString:fK}));function mK(){return`#${xh(this.r)}${xh(this.g)}${xh(this.b)}`}function E5e(){return`#${xh(this.r)}${xh(this.g)}${xh(this.b)}${xh((isNaN(this.opacity)?1:this.opacity)*255)}`}function fK(){const e=YS(this.opacity);return`${e===1?"rgb(":"rgba("}${Rh(this.r)}, ${Rh(this.g)}, ${Rh(this.b)}${e===1?")":`, ${e})`}`}function YS(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Rh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function xh(e){return e=Rh(e),(e<16?"0":"")+e.toString(16)}function gK(e,n,a,o){return o<=0?e=n=a=NaN:a<=0||a>=1?e=n=NaN:n<=0&&(e=NaN),new qo(e,n,a,o)}function OZ(e){if(e instanceof qo)return new qo(e.h,e.s,e.l,e.opacity);if(e instanceof J0||(e=l0(e)),!e)return new qo;if(e instanceof qo)return e;e=e.rgb();var n=e.r/255,a=e.g/255,o=e.b/255,d=Math.min(n,a,o),h=Math.max(n,a,o),f=NaN,y=h-d,b=(h+d)/2;return y?(n===h?f=(a-o)/y+(a<o)*6:a===h?f=(o-n)/y+2:f=(n-a)/y+4,y/=b<.5?h+d:2-h-d,f*=60):y=b>0&&b<1?0:f,new qo(f,y,b,e.opacity)}function S5e(e,n,a,o){return arguments.length===1?OZ(e):new qo(e,n,a,o??1)}function qo(e,n,a,o){this.h=+e,this.s=+n,this.l=+a,this.opacity=+o}Kk(qo,S5e,IZ(J0,{brighter(e){return e=e==null?KS:Math.pow(KS,e),new qo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?o0:Math.pow(o0,e),new qo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,o=a+(a<.5?a:1-a)*n,d=2*a-o;return new Xa(r1(e>=240?e-240:e+120,d,o),r1(e,d,o),r1(e<120?e+240:e-120,d,o),this.opacity)},clamp(){return new qo(vK(this.h),NE(this.s),NE(this.l),YS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=YS(this.opacity);return`${e===1?"hsl(":"hsla("}${vK(this.h)}, ${NE(this.s)*100}%, ${NE(this.l)*100}%${e===1?")":`, ${e})`}`}}));function vK(e){return e=(e||0)%360,e<0?e+360:e}function NE(e){return Math.max(0,Math.min(1,e||0))}function r1(e,n,a){return(e<60?n+(a-n)*e/60:e<180?a:e<240?n+(a-n)*(240-e)/60:n)*255}const Yk=e=>()=>e;function w5e(e,n){return function(a){return e+a*n}}function T5e(e,n,a){return e=Math.pow(e,a),n=Math.pow(n,a)-e,a=1/a,function(o){return Math.pow(e+o*n,a)}}function C5e(e){return(e=+e)==1?PZ:function(n,a){return a-n?T5e(n,a,e):Yk(isNaN(n)?a:n)}}function PZ(e,n){var a=n-e;return a?w5e(e,a):Yk(isNaN(e)?n:e)}const yK=function e(n){var a=C5e(n);function o(d,h){var f=a((d=uD(d)).r,(h=uD(h)).r),y=a(d.g,h.g),b=a(d.b,h.b),x=PZ(d.opacity,h.opacity);return function(T){return d.r=f(T),d.g=y(T),d.b=b(T),d.opacity=x(T),d+""}}return o.gamma=e,o}(1);function N5e(e,n){n||(n=[]);var a=e?Math.min(n.length,e.length):0,o=n.slice(),d;return function(h){for(d=0;d<a;++d)o[d]=e[d]*(1-h)+n[d]*h;return o}}function R5e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function A5e(e,n){var a=n?n.length:0,o=e?Math.min(a,e.length):0,d=new Array(o),h=new Array(a),f;for(f=0;f<o;++f)d[f]=ig(e[f],n[f]);for(;f<a;++f)h[f]=n[f];return function(y){for(f=0;f<o;++f)h[f]=d[f](y);return h}}function I5e(e,n){var a=new Date;return e=+e,n=+n,function(o){return a.setTime(e*(1-o)+n*o),a}}function qS(e,n){return e=+e,n=+n,function(a){return e*(1-a)+n*a}}function O5e(e,n){var a={},o={},d;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(d in n)d in e?a[d]=ig(e[d],n[d]):o[d]=n[d];return function(h){for(d in a)o[d]=a[d](h);return o}}var hD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,i1=new RegExp(hD.source,"g");function P5e(e){return function(){return e}}function D5e(e){return function(n){return e(n)+""}}function k5e(e,n){var a=hD.lastIndex=i1.lastIndex=0,o,d,h,f=-1,y=[],b=[];for(e=e+"",n=n+"";(o=hD.exec(e))&&(d=i1.exec(n));)(h=d.index)>a&&(h=n.slice(a,h),y[f]?y[f]+=h:y[++f]=h),(o=o[0])===(d=d[0])?y[f]?y[f]+=d:y[++f]=d:(y[++f]=null,b.push({i:f,x:qS(o,d)})),a=i1.lastIndex;return a<n.length&&(h=n.slice(a),y[f]?y[f]+=h:y[++f]=h),y.length<2?b[0]?D5e(b[0].x):P5e(n):(n=b.length,function(x){for(var T=0,S;T<n;++T)y[(S=b[T]).i]=S.x(x);return y.join("")})}function ig(e,n){var a=typeof n,o;return n==null||a==="boolean"?Yk(n):(a==="number"?qS:a==="string"?(o=l0(n))?(n=o,yK):k5e:n instanceof l0?yK:n instanceof Date?I5e:R5e(n)?N5e:Array.isArray(n)?A5e:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?O5e:qS)(e,n)}function qk(e,n){return e=+e,n=+n,function(a){return Math.round(e*(1-a)+n*a)}}function j5e(e,n){n===void 0&&(n=e,e=ig);for(var a=0,o=n.length-1,d=n[0],h=new Array(o<0?0:o);a<o;)h[a]=e(d,d=n[++a]);return function(f){var y=Math.max(0,Math.min(o-1,Math.floor(f*=o)));return h[y](f-y)}}function L5e(e){return function(){return e}}function XS(e){return+e}var _K=[0,1];function Ca(e){return e}function pD(e,n){return(n-=e=+e)?function(a){return(a-e)/n}:L5e(isNaN(n)?NaN:.5)}function M5e(e,n){var a;return e>n&&(a=e,e=n,n=a),function(o){return Math.max(e,Math.min(n,o))}}function U5e(e,n,a){var o=e[0],d=e[1],h=n[0],f=n[1];return d<o?(o=pD(d,o),h=a(f,h)):(o=pD(o,d),h=a(h,f)),function(y){return h(o(y))}}function F5e(e,n,a){var o=Math.min(e.length,n.length)-1,d=new Array(o),h=new Array(o),f=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++f<o;)d[f]=pD(e[f],e[f+1]),h[f]=a(n[f],n[f+1]);return function(y){var b=X0(e,y,1,o)-1;return h[b](d[b](y))}}function Q0(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function AT(){var e=_K,n=_K,a=ig,o,d,h,f=Ca,y,b,x;function T(){var N=Math.min(e.length,n.length);return f!==Ca&&(f=M5e(e[0],e[N-1])),y=N>2?F5e:U5e,b=x=null,S}function S(N){return N==null||isNaN(N=+N)?h:(b||(b=y(e.map(o),n,a)))(o(f(N)))}return S.invert=function(N){return f(d((x||(x=y(n,e.map(o),qS)))(N)))},S.domain=function(N){return arguments.length?(e=Array.from(N,XS),T()):e.slice()},S.range=function(N){return arguments.length?(n=Array.from(N),T()):n.slice()},S.rangeRound=function(N){return n=Array.from(N),a=qk,T()},S.clamp=function(N){return arguments.length?(f=N?!0:Ca,T()):f!==Ca},S.interpolate=function(N){return arguments.length?(a=N,T()):a},S.unknown=function(N){return arguments.length?(h=N,S):h},function(N,O){return o=N,d=O,T()}}function Xk(){return AT()(Ca,Ca)}function V5e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function JS(e,n){if((a=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var a,o=e.slice(0,a);return[o.length>1?o[0]+o.slice(2):o,+e.slice(a+1)]}function yf(e){return e=JS(Math.abs(e)),e?e[1]:NaN}function B5e(e,n){return function(a,o){for(var d=a.length,h=[],f=0,y=e[0],b=0;d>0&&y>0&&(b+y+1>o&&(y=Math.max(1,o-b)),h.push(a.substring(d-=y,d+y)),!((b+=y+1)>o));)y=e[f=(f+1)%e.length];return h.reverse().join(n)}}function G5e(e){return function(n){return n.replace(/[0-9]/g,function(a){return e[+a]})}}var W5e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function d0(e){if(!(n=W5e.exec(e)))throw new Error("invalid format: "+e);var n;return new Jk({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}d0.prototype=Jk.prototype;function Jk(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Jk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $5e(e){e:for(var n=e.length,a=1,o=-1,d;a<n;++a)switch(e[a]){case".":o=d=a;break;case"0":o===0&&(o=a),d=a;break;default:if(!+e[a])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(d+1):e}var DZ;function H5e(e,n){var a=JS(e,n);if(!a)return e+"";var o=a[0],d=a[1],h=d-(DZ=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,f=o.length;return h===f?o:h>f?o+new Array(h-f+1).join("0"):h>0?o.slice(0,h)+"."+o.slice(h):"0."+new Array(1-h).join("0")+JS(e,Math.max(0,n+h-1))[0]}function bK(e,n){var a=JS(e,n);if(!a)return e+"";var o=a[0],d=a[1];return d<0?"0."+new Array(-d).join("0")+o:o.length>d+1?o.slice(0,d+1)+"."+o.slice(d+1):o+new Array(d-o.length+2).join("0")}const xK={"%":(e,n)=>(e*100).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:V5e,e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>bK(e*100,n),r:bK,s:H5e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function EK(e){return e}var SK=Array.prototype.map,wK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function z5e(e){var n=e.grouping===void 0||e.thousands===void 0?EK:B5e(SK.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",h=e.numerals===void 0?EK:G5e(SK.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"":e.minus+"",b=e.nan===void 0?"NaN":e.nan+"";function x(S){S=d0(S);var N=S.fill,O=S.align,A=S.sign,I=S.symbol,P=S.zero,L=S.width,F=S.comma,V=S.precision,G=S.trim,B=S.type;B==="n"?(F=!0,B="g"):xK[B]||(V===void 0&&(V=12),G=!0,B="g"),(P||N==="0"&&O==="=")&&(P=!0,N="0",O="=");var z=I==="$"?a:I==="#"&&/[boxX]/.test(B)?"0"+B.toLowerCase():"",q=I==="$"?o:/[%p]/.test(B)?f:"",Z=xK[B],ie=/[defgprs%]/.test(B);V=V===void 0?6:/[gprs]/.test(B)?Math.max(1,Math.min(21,V)):Math.max(0,Math.min(20,V));function ue(re){var pe=z,Se=q,fe,be,se;if(B==="c")Se=Z(re)+Se,re="";else{re=+re;var he=re<0||1/re<0;if(re=isNaN(re)?b:Z(Math.abs(re),V),G&&(re=$5e(re)),he&&+re==0&&A!=="+"&&(he=!1),pe=(he?A==="("?A:y:A==="-"||A==="("?"":A)+pe,Se=(B==="s"?wK[8+DZ/3]:"")+Se+(he&&A==="("?")":""),ie){for(fe=-1,be=re.length;++fe<be;)if(se=re.charCodeAt(fe),48>se||se>57){Se=(se===46?d+re.slice(fe+1):re.slice(fe))+Se,re=re.slice(0,fe);break}}}F&&!P&&(re=n(re,1/0));var Q=pe.length+re.length+Se.length,le=Q<L?new Array(L-Q+1).join(N):"";switch(F&&P&&(re=n(le+re,le.length?L-Se.length:1/0),le=""),O){case"<":re=pe+re+Se+le;break;case"=":re=pe+le+re+Se;break;case"^":re=le.slice(0,Q=le.length>>1)+pe+re+Se+le.slice(Q);break;default:re=le+pe+re+Se;break}return h(re)}return ue.toString=function(){return S+""},ue}function T(S,N){var O=x((S=d0(S),S.type="f",S)),A=Math.max(-8,Math.min(8,Math.floor(yf(N)/3)))*3,I=Math.pow(10,-A),P=wK[8+A/3];return function(L){return O(I*L)+P}}return{format:x,formatPrefix:T}}var RE,Qk,kZ;K5e({thousands:",",grouping:[3],currency:["$",""]});function K5e(e){return RE=z5e(e),Qk=RE.format,kZ=RE.formatPrefix,RE}function Y5e(e){return Math.max(0,-yf(Math.abs(e)))}function q5e(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yf(n)/3)))*3-yf(Math.abs(e)))}function X5e(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,yf(n)-yf(e))+1}function jZ(e,n,a,o){var d=lD(e,n,a),h;switch(o=d0(o??",f"),o.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(n));return o.precision==null&&!isNaN(h=q5e(d,f))&&(o.precision=h),kZ(o,f)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(h=X5e(d,Math.max(Math.abs(e),Math.abs(n))))&&(o.precision=h-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(h=Y5e(d))&&(o.precision=h-(o.type==="%")*2);break}}return Qk(o)}function lu(e){var n=e.domain;return e.ticks=function(a){var o=n();return oD(o[0],o[o.length-1],a??10)},e.tickFormat=function(a,o){var d=n();return jZ(d[0],d[d.length-1],a??10,o)},e.nice=function(a){a==null&&(a=10);var o=n(),d=0,h=o.length-1,f=o[d],y=o[h],b,x,T=10;for(y<f&&(x=f,f=y,y=x,x=d,d=h,h=x);T-- >0;){if(x=cD(f,y,a),x===b)return o[d]=f,o[h]=y,n(o);if(x>0)f=Math.floor(f/x)*x,y=Math.ceil(y/x)*x;else if(x<0)f=Math.ceil(f*x)/x,y=Math.floor(y*x)/x;else break;b=x}return e},e}function QS(){var e=Xk();return e.copy=function(){return Q0(e,QS())},go.apply(e,arguments),lu(e)}function LZ(e){var n;function a(o){return o==null||isNaN(o=+o)?n:o}return a.invert=a,a.domain=a.range=function(o){return arguments.length?(e=Array.from(o,XS),a):e.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return LZ(e).unknown(n)},e=arguments.length?Array.from(e,XS):[0,1],lu(a)}function MZ(e,n){e=e.slice();var a=0,o=e.length-1,d=e[a],h=e[o],f;return h<d&&(f=a,a=o,o=f,f=d,d=h,h=f),e[a]=n.floor(d),e[o]=n.ceil(h),e}function TK(e){return Math.log(e)}function CK(e){return Math.exp(e)}function J5e(e){return-Math.log(-e)}function Q5e(e){return-Math.exp(-e)}function Z5e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function e4e(e){return e===10?Z5e:e===Math.E?Math.exp:n=>Math.pow(e,n)}function t4e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),n=>Math.log(n)/e)}function NK(e){return(n,a)=>-e(-n,a)}function Zk(e){const n=e(TK,CK),a=n.domain;let o=10,d,h;function f(){return d=t4e(o),h=e4e(o),a()[0]<0?(d=NK(d),h=NK(h),e(J5e,Q5e)):e(TK,CK),n}return n.base=function(y){return arguments.length?(o=+y,f()):o},n.domain=function(y){return arguments.length?(a(y),f()):a()},n.ticks=y=>{const b=a();let x=b[0],T=b[b.length-1];const S=T<x;S&&([x,T]=[T,x]);let N=d(x),O=d(T),A,I;const P=y==null?10:+y;let L=[];if(!(o%1)&&O-N<P){if(N=Math.floor(N),O=Math.ceil(O),x>0){for(;N<=O;++N)for(A=1;A<o;++A)if(I=N<0?A/h(-N):A*h(N),!(I<x)){if(I>T)break;L.push(I)}}else for(;N<=O;++N)for(A=o-1;A>=1;--A)if(I=N>0?A/h(-N):A*h(N),!(I<x)){if(I>T)break;L.push(I)}L.length*2<P&&(L=oD(x,T,P))}else L=oD(N,O,Math.min(O-N,P)).map(h);return S?L.reverse():L},n.tickFormat=(y,b)=>{if(y==null&&(y=10),b==null&&(b=o===10?"s":","),typeof b!="function"&&(!(o%1)&&(b=d0(b)).precision==null&&(b.trim=!0),b=Qk(b)),y===1/0)return b;const x=Math.max(1,o*y/n.ticks().length);return T=>{let S=T/h(Math.round(d(T)));return S*o<o-.5&&(S*=o),S<=x?b(T):""}},n.nice=()=>a(MZ(a(),{floor:y=>h(Math.floor(d(y))),ceil:y=>h(Math.ceil(d(y)))})),n}function UZ(){const e=Zk(AT()).domain([1,10]);return e.copy=()=>Q0(e,UZ()).base(e.base()),go.apply(e,arguments),e}function RK(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function AK(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function ej(e){var n=1,a=e(RK(n),AK(n));return a.constant=function(o){return arguments.length?e(RK(n=+o),AK(n)):n},lu(a)}function FZ(){var e=ej(AT());return e.copy=function(){return Q0(e,FZ()).constant(e.constant())},go.apply(e,arguments)}function IK(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function n4e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function r4e(e){return e<0?-e*e:e*e}function tj(e){var n=e(Ca,Ca),a=1;function o(){return a===1?e(Ca,Ca):a===.5?e(n4e,r4e):e(IK(a),IK(1/a))}return n.exponent=function(d){return arguments.length?(a=+d,o()):a},lu(n)}function nj(){var e=tj(AT());return e.copy=function(){return Q0(e,nj()).exponent(e.exponent())},go.apply(e,arguments),e}function i4e(){return nj.apply(null,arguments).exponent(.5)}function OK(e){return Math.sign(e)*e*e}function a4e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function VZ(){var e=Xk(),n=[0,1],a=!1,o;function d(h){var f=a4e(e(h));return isNaN(f)?o:a?Math.round(f):f}return d.invert=function(h){return e.invert(OK(h))},d.domain=function(h){return arguments.length?(e.domain(h),d):e.domain()},d.range=function(h){return arguments.length?(e.range((n=Array.from(h,XS)).map(OK)),d):n.slice()},d.rangeRound=function(h){return d.range(h).round(!0)},d.round=function(h){return arguments.length?(a=!!h,d):a},d.clamp=function(h){return arguments.length?(e.clamp(h),d):e.clamp()},d.unknown=function(h){return arguments.length?(o=h,d):o},d.copy=function(){return VZ(e.domain(),n).round(a).clamp(e.clamp()).unknown(o)},go.apply(d,arguments),lu(d)}function BZ(){var e=[],n=[],a=[],o;function d(){var f=0,y=Math.max(1,n.length);for(a=new Array(y-1);++f<y;)a[f-1]=d5e(e,f/y);return h}function h(f){return f==null||isNaN(f=+f)?o:n[X0(a,f)]}return h.invertExtent=function(f){var y=n.indexOf(f);return y<0?[NaN,NaN]:[y>0?a[y-1]:e[0],y<a.length?a[y]:e[e.length-1]]},h.domain=function(f){if(!arguments.length)return e.slice();e=[];for(let y of f)y!=null&&!isNaN(y=+y)&&e.push(y);return e.sort(Qd),d()},h.range=function(f){return arguments.length?(n=Array.from(f),d()):n.slice()},h.unknown=function(f){return arguments.length?(o=f,h):o},h.quantiles=function(){return a.slice()},h.copy=function(){return BZ().domain(e).range(n).unknown(o)},go.apply(h,arguments)}function GZ(){var e=0,n=1,a=1,o=[.5],d=[0,1],h;function f(b){return b!=null&&b<=b?d[X0(o,b,0,a)]:h}function y(){var b=-1;for(o=new Array(a);++b<a;)o[b]=((b+1)*n-(b-a)*e)/(a+1);return f}return f.domain=function(b){return arguments.length?([e,n]=b,e=+e,n=+n,y()):[e,n]},f.range=function(b){return arguments.length?(a=(d=Array.from(b)).length-1,y()):d.slice()},f.invertExtent=function(b){var x=d.indexOf(b);return x<0?[NaN,NaN]:x<1?[e,o[0]]:x>=a?[o[a-1],n]:[o[x-1],o[x]]},f.unknown=function(b){return arguments.length&&(h=b),f},f.thresholds=function(){return o.slice()},f.copy=function(){return GZ().domain([e,n]).range(d).unknown(h)},go.apply(lu(f),arguments)}function WZ(){var e=[.5],n=[0,1],a,o=1;function d(h){return h!=null&&h<=h?n[X0(e,h,0,o)]:a}return d.domain=function(h){return arguments.length?(e=Array.from(h),o=Math.min(e.length,n.length-1),d):e.slice()},d.range=function(h){return arguments.length?(n=Array.from(h),o=Math.min(e.length,n.length-1),d):n.slice()},d.invertExtent=function(h){var f=n.indexOf(h);return[e[f-1],e[f]]},d.unknown=function(h){return arguments.length?(a=h,d):a},d.copy=function(){return WZ().domain(e).range(n).unknown(a)},go.apply(d,arguments)}const a1=new Date,s1=new Date;function xi(e,n,a,o){function d(h){return e(h=arguments.length===0?new Date:new Date(+h)),h}return d.floor=h=>(e(h=new Date(+h)),h),d.ceil=h=>(e(h=new Date(h-1)),n(h,1),e(h),h),d.round=h=>{const f=d(h),y=d.ceil(h);return h-f<y-h?f:y},d.offset=(h,f)=>(n(h=new Date(+h),f==null?1:Math.floor(f)),h),d.range=(h,f,y)=>{const b=[];if(h=d.ceil(h),y=y==null?1:Math.floor(y),!(h<f)||!(y>0))return b;let x;do b.push(x=new Date(+h)),n(h,y),e(h);while(x<h&&h<f);return b},d.filter=h=>xi(f=>{if(f>=f)for(;e(f),!h(f);)f.setTime(f-1)},(f,y)=>{if(f>=f)if(y<0)for(;++y<=0;)for(;n(f,-1),!h(f););else for(;--y>=0;)for(;n(f,1),!h(f););}),a&&(d.count=(h,f)=>(a1.setTime(+h),s1.setTime(+f),e(a1),e(s1),Math.floor(a(a1,s1))),d.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?d.filter(o?f=>o(f)%h===0:f=>d.count(0,f)%h===0):d)),d}const ZS=xi(()=>{},(e,n)=>{e.setTime(+e+n)},(e,n)=>n-e);ZS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?xi(n=>{n.setTime(Math.floor(n/e)*e)},(n,a)=>{n.setTime(+n+a*e)},(n,a)=>(a-n)/e):ZS);ZS.range;const vl=1e3,oo=vl*60,yl=oo*60,jl=yl*24,rj=jl*7,PK=jl*30,o1=jl*365,Eh=xi(e=>{e.setTime(e-e.getMilliseconds())},(e,n)=>{e.setTime(+e+n*vl)},(e,n)=>(n-e)/vl,e=>e.getUTCSeconds());Eh.range;const ij=xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vl)},(e,n)=>{e.setTime(+e+n*oo)},(e,n)=>(n-e)/oo,e=>e.getMinutes());ij.range;const aj=xi(e=>{e.setUTCSeconds(0,0)},(e,n)=>{e.setTime(+e+n*oo)},(e,n)=>(n-e)/oo,e=>e.getUTCMinutes());aj.range;const sj=xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vl-e.getMinutes()*oo)},(e,n)=>{e.setTime(+e+n*yl)},(e,n)=>(n-e)/yl,e=>e.getHours());sj.range;const oj=xi(e=>{e.setUTCMinutes(0,0,0)},(e,n)=>{e.setTime(+e+n*yl)},(e,n)=>(n-e)/yl,e=>e.getUTCHours());oj.range;const Z0=xi(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*oo)/jl,e=>e.getDate()-1);Z0.range;const IT=xi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/jl,e=>e.getUTCDate()-1);IT.range;const $Z=xi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/jl,e=>Math.floor(e/jl));$Z.range;function zh(e){return xi(n=>{n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},(n,a)=>{n.setDate(n.getDate()+a*7)},(n,a)=>(a-n-(a.getTimezoneOffset()-n.getTimezoneOffset())*oo)/rj)}const OT=zh(0),ew=zh(1),s4e=zh(2),o4e=zh(3),_f=zh(4),c4e=zh(5),l4e=zh(6);OT.range;ew.range;s4e.range;o4e.range;_f.range;c4e.range;l4e.range;function Kh(e){return xi(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCDate(n.getUTCDate()+a*7)},(n,a)=>(a-n)/rj)}const PT=Kh(0),tw=Kh(1),d4e=Kh(2),u4e=Kh(3),bf=Kh(4),h4e=Kh(5),p4e=Kh(6);PT.range;tw.range;d4e.range;u4e.range;bf.range;h4e.range;p4e.range;const cj=xi(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,n)=>{e.setMonth(e.getMonth()+n)},(e,n)=>n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12,e=>e.getMonth());cj.range;const lj=xi(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCMonth(e.getUTCMonth()+n)},(e,n)=>n.getUTCMonth()-e.getUTCMonth()+(n.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());lj.range;const Ll=xi(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n)},(e,n)=>n.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ll.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xi(n=>{n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,a)=>{n.setFullYear(n.getFullYear()+a*e)});Ll.range;const Ml=xi(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n)},(e,n)=>n.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Ml.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xi(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCFullYear(n.getUTCFullYear()+a*e)});Ml.range;function HZ(e,n,a,o,d,h){const f=[[Eh,1,vl],[Eh,5,5*vl],[Eh,15,15*vl],[Eh,30,30*vl],[h,1,oo],[h,5,5*oo],[h,15,15*oo],[h,30,30*oo],[d,1,yl],[d,3,3*yl],[d,6,6*yl],[d,12,12*yl],[o,1,jl],[o,2,2*jl],[a,1,rj],[n,1,PK],[n,3,3*PK],[e,1,o1]];function y(x,T,S){const N=T<x;N&&([x,T]=[T,x]);const O=S&&typeof S.range=="function"?S:b(x,T,S),A=O?O.range(x,+T+1):[];return N?A.reverse():A}function b(x,T,S){const N=Math.abs(T-x)/S,O=Hk(([,,P])=>P).right(f,N);if(O===f.length)return e.every(lD(x/o1,T/o1,S));if(O===0)return ZS.every(Math.max(lD(x,T,S),1));const[A,I]=f[N/f[O-1][2]<f[O][2]/N?O-1:O];return A.every(I)}return[y,b]}const[m4e,f4e]=HZ(Ml,lj,PT,$Z,oj,aj),[g4e,v4e]=HZ(Ll,cj,OT,Z0,sj,ij);function c1(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function l1(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Jv(e,n,a){return{y:e,m:n,d:a,H:0,M:0,S:0,L:0}}function y4e(e){var n=e.dateTime,a=e.date,o=e.time,d=e.periods,h=e.days,f=e.shortDays,y=e.months,b=e.shortMonths,x=Qv(d),T=Zv(d),S=Qv(h),N=Zv(h),O=Qv(f),A=Zv(f),I=Qv(y),P=Zv(y),L=Qv(b),F=Zv(b),V={a:he,A:Q,b:le,B:we,c:null,d:UK,e:UK,f:B4e,g:J4e,G:Z4e,H:U4e,I:F4e,j:V4e,L:zZ,m:G4e,M:W4e,p:Ue,q:Le,Q:BK,s:GK,S:$4e,u:H4e,U:z4e,V:K4e,w:Y4e,W:q4e,x:null,X:null,y:X4e,Y:Q4e,Z:e3e,"%":VK},G={a:tt,A:Te,b:De,B:qe,c:null,d:FK,e:FK,f:i3e,g:m3e,G:g3e,H:t3e,I:n3e,j:r3e,L:YZ,m:a3e,M:s3e,p:It,q:rt,Q:BK,s:GK,S:o3e,u:c3e,U:l3e,V:d3e,w:u3e,W:h3e,x:null,X:null,y:p3e,Y:f3e,Z:v3e,"%":VK},B={a:ue,A:re,b:pe,B:Se,c:fe,d:LK,e:LK,f:k4e,g:jK,G:kK,H:MK,I:MK,j:I4e,L:D4e,m:A4e,M:O4e,p:ie,q:R4e,Q:L4e,s:M4e,S:P4e,u:S4e,U:w4e,V:T4e,w:E4e,W:C4e,x:be,X:se,y:jK,Y:kK,Z:N4e,"%":j4e};V.x=z(a,V),V.X=z(o,V),V.c=z(n,V),G.x=z(a,G),G.X=z(o,G),G.c=z(n,G);function z(Fe,ut){return function(vt){var Ce=[],xt=-1,Nt=0,pt=Fe.length,Xe,ye,Ve;for(vt instanceof Date||(vt=new Date(+vt));++xt<pt;)Fe.charCodeAt(xt)===37&&(Ce.push(Fe.slice(Nt,xt)),(ye=DK[Xe=Fe.charAt(++xt)])!=null?Xe=Fe.charAt(++xt):ye=Xe==="e"?" ":"0",(Ve=ut[Xe])&&(Xe=Ve(vt,ye)),Ce.push(Xe),Nt=xt+1);return Ce.push(Fe.slice(Nt,xt)),Ce.join("")}}function q(Fe,ut){return function(vt){var Ce=Jv(1900,void 0,1),xt=Z(Ce,Fe,vt+="",0),Nt,pt;if(xt!=vt.length)return null;if("Q"in Ce)return new Date(Ce.Q);if("s"in Ce)return new Date(Ce.s*1e3+("L"in Ce?Ce.L:0));if(ut&&!("Z"in Ce)&&(Ce.Z=0),"p"in Ce&&(Ce.H=Ce.H%12+Ce.p*12),Ce.m===void 0&&(Ce.m="q"in Ce?Ce.q:0),"V"in Ce){if(Ce.V<1||Ce.V>53)return null;"w"in Ce||(Ce.w=1),"Z"in Ce?(Nt=l1(Jv(Ce.y,0,1)),pt=Nt.getUTCDay(),Nt=pt>4||pt===0?tw.ceil(Nt):tw(Nt),Nt=IT.offset(Nt,(Ce.V-1)*7),Ce.y=Nt.getUTCFullYear(),Ce.m=Nt.getUTCMonth(),Ce.d=Nt.getUTCDate()+(Ce.w+6)%7):(Nt=c1(Jv(Ce.y,0,1)),pt=Nt.getDay(),Nt=pt>4||pt===0?ew.ceil(Nt):ew(Nt),Nt=Z0.offset(Nt,(Ce.V-1)*7),Ce.y=Nt.getFullYear(),Ce.m=Nt.getMonth(),Ce.d=Nt.getDate()+(Ce.w+6)%7)}else("W"in Ce||"U"in Ce)&&("w"in Ce||(Ce.w="u"in Ce?Ce.u%7:"W"in Ce?1:0),pt="Z"in Ce?l1(Jv(Ce.y,0,1)).getUTCDay():c1(Jv(Ce.y,0,1)).getDay(),Ce.m=0,Ce.d="W"in Ce?(Ce.w+6)%7+Ce.W*7-(pt+5)%7:Ce.w+Ce.U*7-(pt+6)%7);return"Z"in Ce?(Ce.H+=Ce.Z/100|0,Ce.M+=Ce.Z%100,l1(Ce)):c1(Ce)}}function Z(Fe,ut,vt,Ce){for(var xt=0,Nt=ut.length,pt=vt.length,Xe,ye;xt<Nt;){if(Ce>=pt)return-1;if(Xe=ut.charCodeAt(xt++),Xe===37){if(Xe=ut.charAt(xt++),ye=B[Xe in DK?ut.charAt(xt++):Xe],!ye||(Ce=ye(Fe,vt,Ce))<0)return-1}else if(Xe!=vt.charCodeAt(Ce++))return-1}return Ce}function ie(Fe,ut,vt){var Ce=x.exec(ut.slice(vt));return Ce?(Fe.p=T.get(Ce[0].toLowerCase()),vt+Ce[0].length):-1}function ue(Fe,ut,vt){var Ce=O.exec(ut.slice(vt));return Ce?(Fe.w=A.get(Ce[0].toLowerCase()),vt+Ce[0].length):-1}function re(Fe,ut,vt){var Ce=S.exec(ut.slice(vt));return Ce?(Fe.w=N.get(Ce[0].toLowerCase()),vt+Ce[0].length):-1}function pe(Fe,ut,vt){var Ce=L.exec(ut.slice(vt));return Ce?(Fe.m=F.get(Ce[0].toLowerCase()),vt+Ce[0].length):-1}function Se(Fe,ut,vt){var Ce=I.exec(ut.slice(vt));return Ce?(Fe.m=P.get(Ce[0].toLowerCase()),vt+Ce[0].length):-1}function fe(Fe,ut,vt){return Z(Fe,n,ut,vt)}function be(Fe,ut,vt){return Z(Fe,a,ut,vt)}function se(Fe,ut,vt){return Z(Fe,o,ut,vt)}function he(Fe){return f[Fe.getDay()]}function Q(Fe){return h[Fe.getDay()]}function le(Fe){return b[Fe.getMonth()]}function we(Fe){return y[Fe.getMonth()]}function Ue(Fe){return d[+(Fe.getHours()>=12)]}function Le(Fe){return 1+~~(Fe.getMonth()/3)}function tt(Fe){return f[Fe.getUTCDay()]}function Te(Fe){return h[Fe.getUTCDay()]}function De(Fe){return b[Fe.getUTCMonth()]}function qe(Fe){return y[Fe.getUTCMonth()]}function It(Fe){return d[+(Fe.getUTCHours()>=12)]}function rt(Fe){return 1+~~(Fe.getUTCMonth()/3)}return{format:function(Fe){var ut=z(Fe+="",V);return ut.toString=function(){return Fe},ut},parse:function(Fe){var ut=q(Fe+="",!1);return ut.toString=function(){return Fe},ut},utcFormat:function(Fe){var ut=z(Fe+="",G);return ut.toString=function(){return Fe},ut},utcParse:function(Fe){var ut=q(Fe+="",!0);return ut.toString=function(){return Fe},ut}}}var DK={"-":"",_:" ",0:"0"},Di=/^\s*\d+/,_4e=/^%/,b4e=/[\\^$*+?|[\]().{}]/g;function Un(e,n,a){var o=e<0?"-":"",d=(o?-e:e)+"",h=d.length;return o+(h<a?new Array(a-h+1).join(n)+d:d)}function x4e(e){return e.replace(b4e,"\\$&")}function Qv(e){return new RegExp("^(?:"+e.map(x4e).join("|")+")","i")}function Zv(e){return new Map(e.map((n,a)=>[n.toLowerCase(),a]))}function E4e(e,n,a){var o=Di.exec(n.slice(a,a+1));return o?(e.w=+o[0],a+o[0].length):-1}function S4e(e,n,a){var o=Di.exec(n.slice(a,a+1));return o?(e.u=+o[0],a+o[0].length):-1}function w4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.U=+o[0],a+o[0].length):-1}function T4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.V=+o[0],a+o[0].length):-1}function C4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.W=+o[0],a+o[0].length):-1}function kK(e,n,a){var o=Di.exec(n.slice(a,a+4));return o?(e.y=+o[0],a+o[0].length):-1}function jK(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),a+o[0].length):-1}function N4e(e,n,a){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(a,a+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),a+o[0].length):-1}function R4e(e,n,a){var o=Di.exec(n.slice(a,a+1));return o?(e.q=o[0]*3-3,a+o[0].length):-1}function A4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.m=o[0]-1,a+o[0].length):-1}function LK(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.d=+o[0],a+o[0].length):-1}function I4e(e,n,a){var o=Di.exec(n.slice(a,a+3));return o?(e.m=0,e.d=+o[0],a+o[0].length):-1}function MK(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.H=+o[0],a+o[0].length):-1}function O4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.M=+o[0],a+o[0].length):-1}function P4e(e,n,a){var o=Di.exec(n.slice(a,a+2));return o?(e.S=+o[0],a+o[0].length):-1}function D4e(e,n,a){var o=Di.exec(n.slice(a,a+3));return o?(e.L=+o[0],a+o[0].length):-1}function k4e(e,n,a){var o=Di.exec(n.slice(a,a+6));return o?(e.L=Math.floor(o[0]/1e3),a+o[0].length):-1}function j4e(e,n,a){var o=_4e.exec(n.slice(a,a+1));return o?a+o[0].length:-1}function L4e(e,n,a){var o=Di.exec(n.slice(a));return o?(e.Q=+o[0],a+o[0].length):-1}function M4e(e,n,a){var o=Di.exec(n.slice(a));return o?(e.s=+o[0],a+o[0].length):-1}function UK(e,n){return Un(e.getDate(),n,2)}function U4e(e,n){return Un(e.getHours(),n,2)}function F4e(e,n){return Un(e.getHours()%12||12,n,2)}function V4e(e,n){return Un(1+Z0.count(Ll(e),e),n,3)}function zZ(e,n){return Un(e.getMilliseconds(),n,3)}function B4e(e,n){return zZ(e,n)+"000"}function G4e(e,n){return Un(e.getMonth()+1,n,2)}function W4e(e,n){return Un(e.getMinutes(),n,2)}function $4e(e,n){return Un(e.getSeconds(),n,2)}function H4e(e){var n=e.getDay();return n===0?7:n}function z4e(e,n){return Un(OT.count(Ll(e)-1,e),n,2)}function KZ(e){var n=e.getDay();return n>=4||n===0?_f(e):_f.ceil(e)}function K4e(e,n){return e=KZ(e),Un(_f.count(Ll(e),e)+(Ll(e).getDay()===4),n,2)}function Y4e(e){return e.getDay()}function q4e(e,n){return Un(ew.count(Ll(e)-1,e),n,2)}function X4e(e,n){return Un(e.getFullYear()%100,n,2)}function J4e(e,n){return e=KZ(e),Un(e.getFullYear()%100,n,2)}function Q4e(e,n){return Un(e.getFullYear()%1e4,n,4)}function Z4e(e,n){var a=e.getDay();return e=a>=4||a===0?_f(e):_f.ceil(e),Un(e.getFullYear()%1e4,n,4)}function e3e(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Un(n/60|0,"0",2)+Un(n%60,"0",2)}function FK(e,n){return Un(e.getUTCDate(),n,2)}function t3e(e,n){return Un(e.getUTCHours(),n,2)}function n3e(e,n){return Un(e.getUTCHours()%12||12,n,2)}function r3e(e,n){return Un(1+IT.count(Ml(e),e),n,3)}function YZ(e,n){return Un(e.getUTCMilliseconds(),n,3)}function i3e(e,n){return YZ(e,n)+"000"}function a3e(e,n){return Un(e.getUTCMonth()+1,n,2)}function s3e(e,n){return Un(e.getUTCMinutes(),n,2)}function o3e(e,n){return Un(e.getUTCSeconds(),n,2)}function c3e(e){var n=e.getUTCDay();return n===0?7:n}function l3e(e,n){return Un(PT.count(Ml(e)-1,e),n,2)}function qZ(e){var n=e.getUTCDay();return n>=4||n===0?bf(e):bf.ceil(e)}function d3e(e,n){return e=qZ(e),Un(bf.count(Ml(e),e)+(Ml(e).getUTCDay()===4),n,2)}function u3e(e){return e.getUTCDay()}function h3e(e,n){return Un(tw.count(Ml(e)-1,e),n,2)}function p3e(e,n){return Un(e.getUTCFullYear()%100,n,2)}function m3e(e,n){return e=qZ(e),Un(e.getUTCFullYear()%100,n,2)}function f3e(e,n){return Un(e.getUTCFullYear()%1e4,n,4)}function g3e(e,n){var a=e.getUTCDay();return e=a>=4||a===0?bf(e):bf.ceil(e),Un(e.getUTCFullYear()%1e4,n,4)}function v3e(){return"+0000"}function VK(){return"%"}function BK(e){return+e}function GK(e){return Math.floor(+e/1e3)}var Sm,XZ,JZ;y3e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function y3e(e){return Sm=y4e(e),XZ=Sm.format,Sm.parse,JZ=Sm.utcFormat,Sm.utcParse,Sm}function _3e(e){return new Date(e)}function b3e(e){return e instanceof Date?+e:+new Date(+e)}function dj(e,n,a,o,d,h,f,y,b,x){var T=Xk(),S=T.invert,N=T.domain,O=x(".%L"),A=x(":%S"),I=x("%I:%M"),P=x("%I %p"),L=x("%a %d"),F=x("%b %d"),V=x("%B"),G=x("%Y");function B(z){return(b(z)<z?O:y(z)<z?A:f(z)<z?I:h(z)<z?P:o(z)<z?d(z)<z?L:F:a(z)<z?V:G)(z)}return T.invert=function(z){return new Date(S(z))},T.domain=function(z){return arguments.length?N(Array.from(z,b3e)):N().map(_3e)},T.ticks=function(z){var q=N();return e(q[0],q[q.length-1],z??10)},T.tickFormat=function(z,q){return q==null?B:x(q)},T.nice=function(z){var q=N();return(!z||typeof z.range!="function")&&(z=n(q[0],q[q.length-1],z??10)),z?N(MZ(q,z)):T},T.copy=function(){return Q0(T,dj(e,n,a,o,d,h,f,y,b,x))},T}function x3e(){return go.apply(dj(g4e,v4e,Ll,cj,OT,Z0,sj,ij,Eh,XZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function E3e(){return go.apply(dj(m4e,f4e,Ml,lj,PT,IT,oj,aj,Eh,JZ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function DT(){var e=0,n=1,a,o,d,h,f=Ca,y=!1,b;function x(S){return S==null||isNaN(S=+S)?b:f(d===0?.5:(S=(h(S)-a)*d,y?Math.max(0,Math.min(1,S)):S))}x.domain=function(S){return arguments.length?([e,n]=S,a=h(e=+e),o=h(n=+n),d=a===o?0:1/(o-a),x):[e,n]},x.clamp=function(S){return arguments.length?(y=!!S,x):y},x.interpolator=function(S){return arguments.length?(f=S,x):f};function T(S){return function(N){var O,A;return arguments.length?([O,A]=N,f=S(O,A),x):[f(0),f(1)]}}return x.range=T(ig),x.rangeRound=T(qk),x.unknown=function(S){return arguments.length?(b=S,x):b},function(S){return h=S,a=S(e),o=S(n),d=a===o?0:1/(o-a),x}}function du(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function QZ(){var e=lu(DT()(Ca));return e.copy=function(){return du(e,QZ())},Hl.apply(e,arguments)}function ZZ(){var e=Zk(DT()).domain([1,10]);return e.copy=function(){return du(e,ZZ()).base(e.base())},Hl.apply(e,arguments)}function eee(){var e=ej(DT());return e.copy=function(){return du(e,eee()).constant(e.constant())},Hl.apply(e,arguments)}function uj(){var e=tj(DT());return e.copy=function(){return du(e,uj()).exponent(e.exponent())},Hl.apply(e,arguments)}function S3e(){return uj.apply(null,arguments).exponent(.5)}function tee(){var e=[],n=Ca;function a(o){if(o!=null&&!isNaN(o=+o))return n((X0(e,o,1)-1)/(e.length-1))}return a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let d of o)d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(Qd),a},a.interpolator=function(o){return arguments.length?(n=o,a):n},a.range=function(){return e.map((o,d)=>n(d/(e.length-1)))},a.quantiles=function(o){return Array.from({length:o+1},(d,h)=>l5e(e,h/o))},a.copy=function(){return tee(n).domain(e)},Hl.apply(a,arguments)}function kT(){var e=0,n=.5,a=1,o=1,d,h,f,y,b,x=Ca,T,S=!1,N;function O(I){return isNaN(I=+I)?N:(I=.5+((I=+T(I))-h)*(o*I<o*h?y:b),x(S?Math.max(0,Math.min(1,I)):I))}O.domain=function(I){return arguments.length?([e,n,a]=I,d=T(e=+e),h=T(n=+n),f=T(a=+a),y=d===h?0:.5/(h-d),b=h===f?0:.5/(f-h),o=h<d?-1:1,O):[e,n,a]},O.clamp=function(I){return arguments.length?(S=!!I,O):S},O.interpolator=function(I){return arguments.length?(x=I,O):x};function A(I){return function(P){var L,F,V;return arguments.length?([L,F,V]=P,x=j5e(I,[L,F,V]),O):[x(0),x(.5),x(1)]}}return O.range=A(ig),O.rangeRound=A(qk),O.unknown=function(I){return arguments.length?(N=I,O):N},function(I){return T=I,d=I(e),h=I(n),f=I(a),y=d===h?0:.5/(h-d),b=h===f?0:.5/(f-h),o=h<d?-1:1,O}}function nee(){var e=lu(kT()(Ca));return e.copy=function(){return du(e,nee())},Hl.apply(e,arguments)}function ree(){var e=Zk(kT()).domain([.1,1,10]);return e.copy=function(){return du(e,ree()).base(e.base())},Hl.apply(e,arguments)}function iee(){var e=ej(kT());return e.copy=function(){return du(e,iee()).constant(e.constant())},Hl.apply(e,arguments)}function hj(){var e=tj(kT());return e.copy=function(){return du(e,hj()).exponent(e.exponent())},Hl.apply(e,arguments)}function w3e(){return hj.apply(null,arguments).exponent(.5)}const WK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:s0,scaleDiverging:nee,scaleDivergingLog:ree,scaleDivergingPow:hj,scaleDivergingSqrt:w3e,scaleDivergingSymlog:iee,scaleIdentity:LZ,scaleImplicit:dD,scaleLinear:QS,scaleLog:UZ,scaleOrdinal:zk,scalePoint:Ty,scalePow:nj,scaleQuantile:BZ,scaleQuantize:GZ,scaleRadial:VZ,scaleSequential:QZ,scaleSequentialLog:ZZ,scaleSequentialPow:uj,scaleSequentialQuantile:tee,scaleSequentialSqrt:S3e,scaleSequentialSymlog:eee,scaleSqrt:i4e,scaleSymlog:FZ,scaleThreshold:WZ,scaleTime:x3e,scaleUtc:E3e,tickFormat:jZ},Symbol.toStringTag,{value:"Module"}));var T3e=Yf;function C3e(e,n,a){for(var o=-1,d=e.length;++o<d;){var h=e[o],f=n(h);if(f!=null&&(y===void 0?f===f&&!T3e(f):a(f,y)))var y=f,b=h}return b}var aee=C3e;function N3e(e,n){return e>n}var R3e=N3e,A3e=aee,I3e=R3e,O3e=rg;function P3e(e){return e&&e.length?A3e(e,O3e,I3e):void 0}var D3e=P3e;const Fd=ar(D3e);function k3e(e,n){return e<n}var j3e=k3e,L3e=aee,M3e=j3e,U3e=rg;function F3e(e){return e&&e.length?L3e(e,U3e,M3e):void 0}var V3e=F3e;const jT=ar(V3e);var B3e=Ck,G3e=cu,W3e=pZ,$3e=rs;function H3e(e,n){var a=$3e(e)?B3e:W3e;return a(e,G3e(n))}var z3e=H3e,K3e=uZ,Y3e=z3e;function q3e(e,n){return K3e(Y3e(e,n),1)}var X3e=q3e;const J3e=ar(X3e);var Q3e=Bk;function Z3e(e,n){return Q3e(e,n)}var eFe=Z3e;const xf=ar(eFe);var ag=1e9,tFe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},mj,Dr=!0,mo="[DecimalError] ",Ah=mo+"Invalid argument: ",pj=mo+"Exponent out of range: ",sg=Math.floor,hh=Math.pow,nFe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ss,Ii=1e7,wr=7,see=9007199254740991,nw=sg(see/wr),At={};At.absoluteValue=At.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};At.comparedTo=At.cmp=function(e){var n,a,o,d,h=this;if(e=new h.constructor(e),h.s!==e.s)return h.s||-e.s;if(h.e!==e.e)return h.e>e.e^h.s<0?1:-1;for(o=h.d.length,d=e.d.length,n=0,a=o<d?o:d;n<a;++n)if(h.d[n]!==e.d[n])return h.d[n]>e.d[n]^h.s<0?1:-1;return o===d?0:o>d^h.s<0?1:-1};At.decimalPlaces=At.dp=function(){var e=this,n=e.d.length-1,a=(n-e.e)*wr;if(n=e.d[n],n)for(;n%10==0;n/=10)a--;return a<0?0:a};At.dividedBy=At.div=function(e){return Tl(this,new this.constructor(e))};At.dividedToIntegerBy=At.idiv=function(e){var n=this,a=n.constructor;return ur(Tl(n,new a(e),0,1),a.precision)};At.equals=At.eq=function(e){return!this.cmp(e)};At.exponent=function(){return ci(this)};At.greaterThan=At.gt=function(e){return this.cmp(e)>0};At.greaterThanOrEqualTo=At.gte=function(e){return this.cmp(e)>=0};At.isInteger=At.isint=function(){return this.e>this.d.length-2};At.isNegative=At.isneg=function(){return this.s<0};At.isPositive=At.ispos=function(){return this.s>0};At.isZero=function(){return this.s===0};At.lessThan=At.lt=function(e){return this.cmp(e)<0};At.lessThanOrEqualTo=At.lte=function(e){return this.cmp(e)<1};At.logarithm=At.log=function(e){var n,a=this,o=a.constructor,d=o.precision,h=d+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(Ss))throw Error(mo+"NaN");if(a.s<1)throw Error(mo+(a.s?"NaN":"-Infinity"));return a.eq(Ss)?new o(0):(Dr=!1,n=Tl(u0(a,h),u0(e,h),h),Dr=!0,ur(n,d))};At.minus=At.sub=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?lee(n,e):oee(n,(e.s=-e.s,e))};At.modulo=At.mod=function(e){var n,a=this,o=a.constructor,d=o.precision;if(e=new o(e),!e.s)throw Error(mo+"NaN");return a.s?(Dr=!1,n=Tl(a,e,0,1).times(e),Dr=!0,a.minus(n)):ur(new o(a),d)};At.naturalExponential=At.exp=function(){return cee(this)};At.naturalLogarithm=At.ln=function(){return u0(this)};At.negated=At.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};At.plus=At.add=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?oee(n,e):lee(n,(e.s=-e.s,e))};At.precision=At.sd=function(e){var n,a,o,d=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ah+e);if(n=ci(d)+1,o=d.d.length-1,a=o*wr+1,o=d.d[o],o){for(;o%10==0;o/=10)a--;for(o=d.d[0];o>=10;o/=10)a++}return e&&n>a?n:a};At.squareRoot=At.sqrt=function(){var e,n,a,o,d,h,f,y=this,b=y.constructor;if(y.s<1){if(!y.s)return new b(0);throw Error(mo+"NaN")}for(e=ci(y),Dr=!1,d=Math.sqrt(+y),d==0||d==1/0?(n=kc(y.d),(n.length+e)%2==0&&(n+="0"),d=Math.sqrt(n),e=sg((e+1)/2)-(e<0||e%2),d==1/0?n="5e"+e:(n=d.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),o=new b(n)):o=new b(d.toString()),a=b.precision,d=f=a+3;;)if(h=o,o=h.plus(Tl(y,h,f+2)).times(.5),kc(h.d).slice(0,f)===(n=kc(o.d)).slice(0,f)){if(n=n.slice(f-3,f+1),d==f&&n=="4999"){if(ur(h,a+1,0),h.times(h).eq(y)){o=h;break}}else if(n!="9999")break;f+=4}return Dr=!0,ur(o,a)};At.times=At.mul=function(e){var n,a,o,d,h,f,y,b,x,T=this,S=T.constructor,N=T.d,O=(e=new S(e)).d;if(!T.s||!e.s)return new S(0);for(e.s*=T.s,a=T.e+e.e,b=N.length,x=O.length,b<x&&(h=N,N=O,O=h,f=b,b=x,x=f),h=[],f=b+x,o=f;o--;)h.push(0);for(o=x;--o>=0;){for(n=0,d=b+o;d>o;)y=h[d]+O[o]*N[d-o-1]+n,h[d--]=y%Ii|0,n=y/Ii|0;h[d]=(h[d]+n)%Ii|0}for(;!h[--f];)h.pop();return n?++a:h.shift(),e.d=h,e.e=a,Dr?ur(e,S.precision):e};At.toDecimalPlaces=At.todp=function(e,n){var a=this,o=a.constructor;return a=new o(a),e===void 0?a:(Gc(e,0,ag),n===void 0?n=o.rounding:Gc(n,0,8),ur(a,e+ci(a)+1,n))};At.toExponential=function(e,n){var a,o=this,d=o.constructor;return e===void 0?a=Fh(o,!0):(Gc(e,0,ag),n===void 0?n=d.rounding:Gc(n,0,8),o=ur(new d(o),e+1,n),a=Fh(o,!0,e+1)),a};At.toFixed=function(e,n){var a,o,d=this,h=d.constructor;return e===void 0?Fh(d):(Gc(e,0,ag),n===void 0?n=h.rounding:Gc(n,0,8),o=ur(new h(d),e+ci(d)+1,n),a=Fh(o.abs(),!1,e+ci(o)+1),d.isneg()&&!d.isZero()?"-"+a:a)};At.toInteger=At.toint=function(){var e=this,n=e.constructor;return ur(new n(e),ci(e)+1,n.rounding)};At.toNumber=function(){return+this};At.toPower=At.pow=function(e){var n,a,o,d,h,f,y=this,b=y.constructor,x=12,T=+(e=new b(e));if(!e.s)return new b(Ss);if(y=new b(y),!y.s){if(e.s<1)throw Error(mo+"Infinity");return y}if(y.eq(Ss))return y;if(o=b.precision,e.eq(Ss))return ur(y,o);if(n=e.e,a=e.d.length-1,f=n>=a,h=y.s,f){if((a=T<0?-T:T)<=see){for(d=new b(Ss),n=Math.ceil(o/wr+4),Dr=!1;a%2&&(d=d.times(y),HK(d.d,n)),a=sg(a/2),a!==0;)y=y.times(y),HK(y.d,n);return Dr=!0,e.s<0?new b(Ss).div(d):ur(d,o)}}else if(h<0)throw Error(mo+"NaN");return h=h<0&&e.d[Math.max(n,a)]&1?-1:1,y.s=1,Dr=!1,d=e.times(u0(y,o+x)),Dr=!0,d=cee(d),d.s=h,d};At.toPrecision=function(e,n){var a,o,d=this,h=d.constructor;return e===void 0?(a=ci(d),o=Fh(d,a<=h.toExpNeg||a>=h.toExpPos)):(Gc(e,1,ag),n===void 0?n=h.rounding:Gc(n,0,8),d=ur(new h(d),e,n),a=ci(d),o=Fh(d,e<=a||a<=h.toExpNeg,e)),o};At.toSignificantDigits=At.tosd=function(e,n){var a=this,o=a.constructor;return e===void 0?(e=o.precision,n=o.rounding):(Gc(e,1,ag),n===void 0?n=o.rounding:Gc(n,0,8)),ur(new o(a),e,n)};At.toString=At.valueOf=At.val=At.toJSON=At[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,n=ci(e),a=e.constructor;return Fh(e,n<=a.toExpNeg||n>=a.toExpPos)};function oee(e,n){var a,o,d,h,f,y,b,x,T=e.constructor,S=T.precision;if(!e.s||!n.s)return n.s||(n=new T(e)),Dr?ur(n,S):n;if(b=e.d,x=n.d,f=e.e,d=n.e,b=b.slice(),h=f-d,h){for(h<0?(o=b,h=-h,y=x.length):(o=x,d=f,y=b.length),f=Math.ceil(S/wr),y=f>y?f+1:y+1,h>y&&(h=y,o.length=1),o.reverse();h--;)o.push(0);o.reverse()}for(y=b.length,h=x.length,y-h<0&&(h=y,o=x,x=b,b=o),a=0;h;)a=(b[--h]=b[h]+x[h]+a)/Ii|0,b[h]%=Ii;for(a&&(b.unshift(a),++d),y=b.length;b[--y]==0;)b.pop();return n.d=b,n.e=d,Dr?ur(n,S):n}function Gc(e,n,a){if(e!==~~e||e<n||e>a)throw Error(Ah+e)}function kc(e){var n,a,o,d=e.length-1,h="",f=e[0];if(d>0){for(h+=f,n=1;n<d;n++)o=e[n]+"",a=wr-o.length,a&&(h+=Ad(a)),h+=o;f=e[n],o=f+"",a=wr-o.length,a&&(h+=Ad(a))}else if(f===0)return"0";for(;f%10===0;)f/=10;return h+f}var Tl=function(){function e(o,d){var h,f=0,y=o.length;for(o=o.slice();y--;)h=o[y]*d+f,o[y]=h%Ii|0,f=h/Ii|0;return f&&o.unshift(f),o}function n(o,d,h,f){var y,b;if(h!=f)b=h>f?1:-1;else for(y=b=0;y<h;y++)if(o[y]!=d[y]){b=o[y]>d[y]?1:-1;break}return b}function a(o,d,h){for(var f=0;h--;)o[h]-=f,f=o[h]<d[h]?1:0,o[h]=f*Ii+o[h]-d[h];for(;!o[0]&&o.length>1;)o.shift()}return function(o,d,h,f){var y,b,x,T,S,N,O,A,I,P,L,F,V,G,B,z,q,Z,ie=o.constructor,ue=o.s==d.s?1:-1,re=o.d,pe=d.d;if(!o.s)return new ie(o);if(!d.s)throw Error(mo+"Division by zero");for(b=o.e-d.e,q=pe.length,B=re.length,O=new ie(ue),A=O.d=[],x=0;pe[x]==(re[x]||0);)++x;if(pe[x]>(re[x]||0)&&--b,h==null?F=h=ie.precision:f?F=h+(ci(o)-ci(d))+1:F=h,F<0)return new ie(0);if(F=F/wr+2|0,x=0,q==1)for(T=0,pe=pe[0],F++;(x<B||T)&&F--;x++)V=T*Ii+(re[x]||0),A[x]=V/pe|0,T=V%pe|0;else{for(T=Ii/(pe[0]+1)|0,T>1&&(pe=e(pe,T),re=e(re,T),q=pe.length,B=re.length),G=q,I=re.slice(0,q),P=I.length;P<q;)I[P++]=0;Z=pe.slice(),Z.unshift(0),z=pe[0],pe[1]>=Ii/2&&++z;do T=0,y=n(pe,I,q,P),y<0?(L=I[0],q!=P&&(L=L*Ii+(I[1]||0)),T=L/z|0,T>1?(T>=Ii&&(T=Ii-1),S=e(pe,T),N=S.length,P=I.length,y=n(S,I,N,P),y==1&&(T--,a(S,q<N?Z:pe,N))):(T==0&&(y=T=1),S=pe.slice()),N=S.length,N<P&&S.unshift(0),a(I,S,P),y==-1&&(P=I.length,y=n(pe,I,q,P),y<1&&(T++,a(I,q<P?Z:pe,P))),P=I.length):y===0&&(T++,I=[0]),A[x++]=T,y&&I[0]?I[P++]=re[G]||0:(I=[re[G]],P=1);while((G++<B||I[0]!==void 0)&&F--)}return A[0]||A.shift(),O.e=b,ur(O,f?h+ci(O)+1:h)}}();function cee(e,n){var a,o,d,h,f,y,b=0,x=0,T=e.constructor,S=T.precision;if(ci(e)>16)throw Error(pj+ci(e));if(!e.s)return new T(Ss);for(Dr=!1,y=S,f=new T(.03125);e.abs().gte(.1);)e=e.times(f),x+=5;for(o=Math.log(hh(2,x))/Math.LN10*2+5|0,y+=o,a=d=h=new T(Ss),T.precision=y;;){if(d=ur(d.times(e),y),a=a.times(++b),f=h.plus(Tl(d,a,y)),kc(f.d).slice(0,y)===kc(h.d).slice(0,y)){for(;x--;)h=ur(h.times(h),y);return T.precision=S,n==null?(Dr=!0,ur(h,S)):h}h=f}}function ci(e){for(var n=e.e*wr,a=e.d[0];a>=10;a/=10)n++;return n}function d1(e,n,a){if(n>e.LN10.sd())throw Dr=!0,a&&(e.precision=a),Error(mo+"LN10 precision limit exceeded");return ur(new e(e.LN10),n)}function Ad(e){for(var n="";e--;)n+="0";return n}function u0(e,n){var a,o,d,h,f,y,b,x,T,S=1,N=10,O=e,A=O.d,I=O.constructor,P=I.precision;if(O.s<1)throw Error(mo+(O.s?"NaN":"-Infinity"));if(O.eq(Ss))return new I(0);if(n==null?(Dr=!1,x=P):x=n,O.eq(10))return n==null&&(Dr=!0),d1(I,x);if(x+=N,I.precision=x,a=kc(A),o=a.charAt(0),h=ci(O),Math.abs(h)<15e14){for(;o<7&&o!=1||o==1&&a.charAt(1)>3;)O=O.times(e),a=kc(O.d),o=a.charAt(0),S++;h=ci(O),o>1?(O=new I("0."+a),h++):O=new I(o+"."+a.slice(1))}else return b=d1(I,x+2,P).times(h+""),O=u0(new I(o+"."+a.slice(1)),x-N).plus(b),I.precision=P,n==null?(Dr=!0,ur(O,P)):O;for(y=f=O=Tl(O.minus(Ss),O.plus(Ss),x),T=ur(O.times(O),x),d=3;;){if(f=ur(f.times(T),x),b=y.plus(Tl(f,new I(d),x)),kc(b.d).slice(0,x)===kc(y.d).slice(0,x))return y=y.times(2),h!==0&&(y=y.plus(d1(I,x+2,P).times(h+""))),y=Tl(y,new I(S),x),I.precision=P,n==null?(Dr=!0,ur(y,P)):y;y=b,d+=2}}function $K(e,n){var a,o,d;for((a=n.indexOf("."))>-1&&(n=n.replace(".","")),(o=n.search(/e/i))>0?(a<0&&(a=o),a+=+n.slice(o+1),n=n.substring(0,o)):a<0&&(a=n.length),o=0;n.charCodeAt(o)===48;)++o;for(d=n.length;n.charCodeAt(d-1)===48;)--d;if(n=n.slice(o,d),n){if(d-=o,a=a-o-1,e.e=sg(a/wr),e.d=[],o=(a+1)%wr,a<0&&(o+=wr),o<d){for(o&&e.d.push(+n.slice(0,o)),d-=wr;o<d;)e.d.push(+n.slice(o,o+=wr));n=n.slice(o),o=wr-n.length}else o-=d;for(;o--;)n+="0";if(e.d.push(+n),Dr&&(e.e>nw||e.e<-nw))throw Error(pj+a)}else e.s=0,e.e=0,e.d=[0];return e}function ur(e,n,a){var o,d,h,f,y,b,x,T,S=e.d;for(f=1,h=S[0];h>=10;h/=10)f++;if(o=n-f,o<0)o+=wr,d=n,x=S[T=0];else{if(T=Math.ceil((o+1)/wr),h=S.length,T>=h)return e;for(x=h=S[T],f=1;h>=10;h/=10)f++;o%=wr,d=o-wr+f}if(a!==void 0&&(h=hh(10,f-d-1),y=x/h%10|0,b=n<0||S[T+1]!==void 0||x%h,b=a<4?(y||b)&&(a==0||a==(e.s<0?3:2)):y>5||y==5&&(a==4||b||a==6&&(o>0?d>0?x/hh(10,f-d):0:S[T-1])%10&1||a==(e.s<0?8:7))),n<1||!S[0])return b?(h=ci(e),S.length=1,n=n-h-1,S[0]=hh(10,(wr-n%wr)%wr),e.e=sg(-n/wr)||0):(S.length=1,S[0]=e.e=e.s=0),e;if(o==0?(S.length=T,h=1,T--):(S.length=T+1,h=hh(10,wr-o),S[T]=d>0?(x/hh(10,f-d)%hh(10,d)|0)*h:0),b)for(;;)if(T==0){(S[0]+=h)==Ii&&(S[0]=1,++e.e);break}else{if(S[T]+=h,S[T]!=Ii)break;S[T--]=0,h=1}for(o=S.length;S[--o]===0;)S.pop();if(Dr&&(e.e>nw||e.e<-nw))throw Error(pj+ci(e));return e}function lee(e,n){var a,o,d,h,f,y,b,x,T,S,N=e.constructor,O=N.precision;if(!e.s||!n.s)return n.s?n.s=-n.s:n=new N(e),Dr?ur(n,O):n;if(b=e.d,S=n.d,o=n.e,x=e.e,b=b.slice(),f=x-o,f){for(T=f<0,T?(a=b,f=-f,y=S.length):(a=S,o=x,y=b.length),d=Math.max(Math.ceil(O/wr),y)+2,f>d&&(f=d,a.length=1),a.reverse(),d=f;d--;)a.push(0);a.reverse()}else{for(d=b.length,y=S.length,T=d<y,T&&(y=d),d=0;d<y;d++)if(b[d]!=S[d]){T=b[d]<S[d];break}f=0}for(T&&(a=b,b=S,S=a,n.s=-n.s),y=b.length,d=S.length-y;d>0;--d)b[y++]=0;for(d=S.length;d>f;){if(b[--d]<S[d]){for(h=d;h&&b[--h]===0;)b[h]=Ii-1;--b[h],b[d]+=Ii}b[d]-=S[d]}for(;b[--y]===0;)b.pop();for(;b[0]===0;b.shift())--o;return b[0]?(n.d=b,n.e=o,Dr?ur(n,O):n):new N(0)}function Fh(e,n,a){var o,d=ci(e),h=kc(e.d),f=h.length;return n?(a&&(o=a-f)>0?h=h.charAt(0)+"."+h.slice(1)+Ad(o):f>1&&(h=h.charAt(0)+"."+h.slice(1)),h=h+(d<0?"e":"e+")+d):d<0?(h="0."+Ad(-d-1)+h,a&&(o=a-f)>0&&(h+=Ad(o))):d>=f?(h+=Ad(d+1-f),a&&(o=a-d-1)>0&&(h=h+"."+Ad(o))):((o=d+1)<f&&(h=h.slice(0,o)+"."+h.slice(o)),a&&(o=a-f)>0&&(d+1===f&&(h+="."),h+=Ad(o))),e.s<0?"-"+h:h}function HK(e,n){if(e.length>n)return e.length=n,!0}function dee(e){var n,a,o;function d(h){var f=this;if(!(f instanceof d))return new d(h);if(f.constructor=d,h instanceof d){f.s=h.s,f.e=h.e,f.d=(h=h.d)?h.slice():h;return}if(typeof h=="number"){if(h*0!==0)throw Error(Ah+h);if(h>0)f.s=1;else if(h<0)h=-h,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(h===~~h&&h<1e7){f.e=0,f.d=[h];return}return $K(f,h.toString())}else if(typeof h!="string")throw Error(Ah+h);if(h.charCodeAt(0)===45?(h=h.slice(1),f.s=-1):f.s=1,nFe.test(h))$K(f,h);else throw Error(Ah+h)}if(d.prototype=At,d.ROUND_UP=0,d.ROUND_DOWN=1,d.ROUND_CEIL=2,d.ROUND_FLOOR=3,d.ROUND_HALF_UP=4,d.ROUND_HALF_DOWN=5,d.ROUND_HALF_EVEN=6,d.ROUND_HALF_CEIL=7,d.ROUND_HALF_FLOOR=8,d.clone=dee,d.config=d.set=rFe,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<o.length;)e.hasOwnProperty(a=o[n++])||(e[a]=this[a]);return d.config(e),d}function rFe(e){if(!e||typeof e!="object")throw Error(mo+"Object expected");var n,a,o,d=["precision",1,ag,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<d.length;n+=3)if((o=e[a=d[n]])!==void 0)if(sg(o)===o&&o>=d[n+1]&&o<=d[n+2])this[a]=o;else throw Error(Ah+a+": "+o);if((o=e[a="LN10"])!==void 0)if(o==Math.LN10)this[a]=new this(o);else throw Error(Ah+a+": "+o);return this}var mj=dee(tFe);Ss=new mj(1);const ir=mj;function iFe(e){return cFe(e)||oFe(e)||sFe(e)||aFe()}function aFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sFe(e,n){if(e){if(typeof e=="string")return mD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mD(e,n)}}function oFe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function cFe(e){if(Array.isArray(e))return mD(e)}function mD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var lFe=function(n){return n},uee={},hee=function(n){return n===uee},zK=function(n){return function a(){return arguments.length===0||arguments.length===1&&hee(arguments.length<=0?void 0:arguments[0])?a:n.apply(void 0,arguments)}},dFe=function e(n,a){return n===1?a:zK(function(){for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];var f=d.filter(function(y){return y!==uee}).length;return f>=n?a.apply(void 0,d):e(n-f,zK(function(){for(var y=arguments.length,b=new Array(y),x=0;x<y;x++)b[x]=arguments[x];var T=d.map(function(S){return hee(S)?b.shift():S});return a.apply(void 0,iFe(T).concat(b))}))})},LT=function(n){return dFe(n.length,n)},fD=function(n,a){for(var o=[],d=n;d<a;++d)o[d-n]=d;return o},uFe=LT(function(e,n){return Array.isArray(n)?n.map(e):Object.keys(n).map(function(a){return n[a]}).map(e)}),hFe=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];if(!a.length)return lFe;var d=a.reverse(),h=d[0],f=d.slice(1);return function(){return f.reduce(function(y,b){return b(y)},h.apply(void 0,arguments))}},gD=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},pee=function(n){var a=null,o=null;return function(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return a&&h.every(function(y,b){return y===a[b]})||(a=h,o=n.apply(void 0,h)),o}};function pFe(e){var n;return e===0?n=1:n=Math.floor(new ir(e).abs().log(10).toNumber())+1,n}function mFe(e,n,a){for(var o=new ir(e),d=0,h=[];o.lt(n)&&d<1e5;)h.push(o.toNumber()),o=o.add(a),d++;return h}var fFe=LT(function(e,n,a){var o=+e,d=+n;return o+a*(d-o)}),gFe=LT(function(e,n,a){var o=n-+e;return o=o||1/0,(a-e)/o}),vFe=LT(function(e,n,a){var o=n-+e;return o=o||1/0,Math.max(0,Math.min(1,(a-e)/o))});const MT={rangeStep:mFe,getDigitCount:pFe,interpolateNumber:fFe,uninterpolateNumber:gFe,uninterpolateTruncation:vFe};function vD(e){return bFe(e)||_Fe(e)||mee(e)||yFe()}function yFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Fe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function bFe(e){if(Array.isArray(e))return yD(e)}function h0(e,n){return SFe(e)||EFe(e,n)||mee(e,n)||xFe()}function xFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mee(e,n){if(e){if(typeof e=="string")return yD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yD(e,n)}}function yD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function EFe(e,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var a=[],o=!0,d=!1,h=void 0;try{for(var f=e[Symbol.iterator](),y;!(o=(y=f.next()).done)&&(a.push(y.value),!(n&&a.length===n));o=!0);}catch(b){d=!0,h=b}finally{try{!o&&f.return!=null&&f.return()}finally{if(d)throw h}}return a}}function SFe(e){if(Array.isArray(e))return e}function fee(e){var n=h0(e,2),a=n[0],o=n[1],d=a,h=o;return a>o&&(d=o,h=a),[d,h]}function gee(e,n,a){if(e.lte(0))return new ir(0);var o=MT.getDigitCount(e.toNumber()),d=new ir(10).pow(o),h=e.div(d),f=o!==1?.05:.1,y=new ir(Math.ceil(h.div(f).toNumber())).add(a).mul(f),b=y.mul(d);return n?b:new ir(Math.ceil(b))}function wFe(e,n,a){var o=1,d=new ir(e);if(!d.isint()&&a){var h=Math.abs(e);h<1?(o=new ir(10).pow(MT.getDigitCount(e)-1),d=new ir(Math.floor(d.div(o).toNumber())).mul(o)):h>1&&(d=new ir(Math.floor(e)))}else e===0?d=new ir(Math.floor((n-1)/2)):a||(d=new ir(Math.floor(e)));var f=Math.floor((n-1)/2),y=hFe(uFe(function(b){return d.add(new ir(b-f).mul(o)).toNumber()}),fD);return y(0,n)}function vee(e,n,a,o){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(a-1)))return{step:new ir(0),tickMin:new ir(0),tickMax:new ir(0)};var h=gee(new ir(n).sub(e).div(a-1),o,d),f;e<=0&&n>=0?f=new ir(0):(f=new ir(e).add(n).div(2),f=f.sub(new ir(f).mod(h)));var y=Math.ceil(f.sub(e).div(h).toNumber()),b=Math.ceil(new ir(n).sub(f).div(h).toNumber()),x=y+b+1;return x>a?vee(e,n,a,o,d+1):(x<a&&(b=n>0?b+(a-x):b,y=n>0?y:y+(a-x)),{step:h,tickMin:f.sub(new ir(y).mul(h)),tickMax:f.add(new ir(b).mul(h))})}function TFe(e){var n=h0(e,2),a=n[0],o=n[1],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(d,2),y=fee([a,o]),b=h0(y,2),x=b[0],T=b[1];if(x===-1/0||T===1/0){var S=T===1/0?[x].concat(vD(fD(0,d-1).map(function(){return 1/0}))):[].concat(vD(fD(0,d-1).map(function(){return-1/0})),[T]);return a>o?gD(S):S}if(x===T)return wFe(x,d,h);var N=vee(x,T,f,h),O=N.step,A=N.tickMin,I=N.tickMax,P=MT.rangeStep(A,I.add(new ir(.1).mul(O)),O);return a>o?gD(P):P}function CFe(e,n){var a=h0(e,2),o=a[0],d=a[1],h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=fee([o,d]),y=h0(f,2),b=y[0],x=y[1];if(b===-1/0||x===1/0)return[o,d];if(b===x)return[b];var T=Math.max(n,2),S=gee(new ir(x).sub(b).div(T-1),h,0),N=[].concat(vD(MT.rangeStep(new ir(b),new ir(x).sub(new ir(.99).mul(S)),S)),[x]);return o>d?gD(N):N}var NFe=pee(TFe),RFe=pee(CFe),AFe="Invariant failed";function Vh(e,n){throw new Error(AFe)}var IFe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Ef(e){"@babel/helpers - typeof";return Ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ef(e)}function rw(){return rw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},rw.apply(this,arguments)}function OFe(e,n){return jFe(e)||kFe(e,n)||DFe(e,n)||PFe()}function PFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DFe(e,n){if(e){if(typeof e=="string")return KK(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KK(e,n)}}function KK(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function kFe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function jFe(e){if(Array.isArray(e))return e}function LFe(e,n){if(e==null)return{};var a=MFe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function MFe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function UFe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function FFe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,bee(o.key),o)}}function VFe(e,n,a){return n&&FFe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function BFe(e,n,a){return n=iw(n),GFe(e,yee()?Reflect.construct(n,a||[],iw(e).constructor):n.apply(e,a))}function GFe(e,n){if(n&&(Ef(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WFe(e)}function WFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yee=function(){return!!e})()}function iw(e){return iw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},iw(e)}function $Fe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&_D(e,n)}function _D(e,n){return _D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},_D(e,n)}function _ee(e,n,a){return n=bee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function bee(e){var n=HFe(e,"string");return Ef(n)=="symbol"?n:n+""}function HFe(e,n){if(Ef(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Ef(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var e_=function(e){function n(){return UFe(this,n),BFe(this,n,arguments)}return $Fe(n,e),VFe(n,[{key:"render",value:function(){var o=this.props,d=o.offset,h=o.layout,f=o.width,y=o.dataKey,b=o.data,x=o.dataPointFormatter,T=o.xAxis,S=o.yAxis,N=LFe(o,IFe),O=gn(N,!1);this.props.direction==="x"&&T.type!=="number"&&Vh();var A=b.map(function(I){var P=x(I,y),L=P.x,F=P.y,V=P.value,G=P.errorVal;if(!G)return null;var B=[],z,q;if(Array.isArray(G)){var Z=OFe(G,2);z=Z[0],q=Z[1]}else z=q=G;if(h==="vertical"){var ie=T.scale,ue=F+d,re=ue+f,pe=ue-f,Se=ie(V-z),fe=ie(V+q);B.push({x1:fe,y1:re,x2:fe,y2:pe}),B.push({x1:Se,y1:ue,x2:fe,y2:ue}),B.push({x1:Se,y1:re,x2:Se,y2:pe})}else if(h==="horizontal"){var be=S.scale,se=L+d,he=se-f,Q=se+f,le=be(V-z),we=be(V+q);B.push({x1:he,y1:we,x2:Q,y2:we}),B.push({x1:se,y1:le,x2:se,y2:we}),B.push({x1:he,y1:le,x2:Q,y2:le})}return ge.createElement(mr,rw({className:"recharts-errorBar",key:"bar-".concat(B.map(function(Ue){return"".concat(Ue.x1,"-").concat(Ue.x2,"-").concat(Ue.y1,"-").concat(Ue.y2)}))},O),B.map(function(Ue){return ge.createElement("line",rw({},Ue,{key:"line-".concat(Ue.x1,"-").concat(Ue.x2,"-").concat(Ue.y1,"-").concat(Ue.y2)}))}))});return ge.createElement(mr,{className:"recharts-errorBars"},A)}}])}(ge.Component);_ee(e_,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});_ee(e_,"displayName","ErrorBar");function p0(e){"@babel/helpers - typeof";return p0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},p0(e)}function YK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function oh(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?YK(Object(a),!0).forEach(function(o){zFe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):YK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function zFe(e,n,a){return n=KFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function KFe(e){var n=YFe(e,"string");return p0(n)=="symbol"?n:n+""}function YFe(e,n){if(p0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(p0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var xee=function(n){var a=n.children,o=n.formattedGraphicalItems,d=n.legendWidth,h=n.legendContent,f=xs(a,Jm);if(!f)return null;var y=Jm.defaultProps,b=y!==void 0?oh(oh({},y),f.props):{},x;return f.props&&f.props.payload?x=f.props&&f.props.payload:h==="children"?x=(o||[]).reduce(function(T,S){var N=S.item,O=S.props,A=O.sectors||O.data||[];return T.concat(A.map(function(I){return{type:f.props.iconType||N.props.legendType,value:I.name,color:I.fill,payload:I}}))},[]):x=(o||[]).map(function(T){var S=T.item,N=S.type.defaultProps,O=N!==void 0?oh(oh({},N),S.props):{},A=O.dataKey,I=O.name,P=O.legendType,L=O.hide;return{inactive:L,dataKey:A,type:b.iconType||P||"square",color:fj(S),value:I||A,payload:O}}),oh(oh(oh({},b),Jm.getWithHeight(f,d)),{},{payload:x,item:f})};function m0(e){"@babel/helpers - typeof";return m0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},m0(e)}function qK(e){return QFe(e)||JFe(e)||XFe(e)||qFe()}function qFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XFe(e,n){if(e){if(typeof e=="string")return bD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bD(e,n)}}function JFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function QFe(e){if(Array.isArray(e))return bD(e)}function bD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function XK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Yr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?XK(Object(a),!0).forEach(function(o){Zm(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):XK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Zm(e,n,a){return n=ZFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ZFe(e){var n=eVe(e,"string");return m0(n)=="symbol"?n:n+""}function eVe(e,n){if(m0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(m0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Ra(e,n,a){return yn(e)||yn(n)?a:_i(n)?lo(e,n,a):un(n)?n(e):a}function Cy(e,n,a,o){var d=J3e(e,function(y){return Ra(y,n)});if(a==="number"){var h=d.filter(function(y){return lt(y)||parseFloat(y)});return h.length?[jT(h),Fd(h)]:[1/0,-1/0]}var f=o?d.filter(function(y){return!yn(y)}):d;return f.map(function(y){return _i(y)||y instanceof Date?y:""})}var tVe=function(n){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],d=arguments.length>2?arguments[2]:void 0,h=arguments.length>3?arguments[3]:void 0,f=-1,y=(a=o==null?void 0:o.length)!==null&&a!==void 0?a:0;if(y<=1)return 0;if(h&&h.axisType==="angleAxis"&&Math.abs(Math.abs(h.range[1]-h.range[0])-360)<=1e-6)for(var b=h.range,x=0;x<y;x++){var T=x>0?d[x-1].coordinate:d[y-1].coordinate,S=d[x].coordinate,N=x>=y-1?d[0].coordinate:d[x+1].coordinate,O=void 0;if(Xo(S-T)!==Xo(N-S)){var A=[];if(Xo(N-S)===Xo(b[1]-b[0])){O=N;var I=S+b[1]-b[0];A[0]=Math.min(I,(I+T)/2),A[1]=Math.max(I,(I+T)/2)}else{O=T;var P=N+b[1]-b[0];A[0]=Math.min(S,(P+S)/2),A[1]=Math.max(S,(P+S)/2)}var L=[Math.min(S,(O+S)/2),Math.max(S,(O+S)/2)];if(n>L[0]&&n<=L[1]||n>=A[0]&&n<=A[1]){f=d[x].index;break}}else{var F=Math.min(T,N),V=Math.max(T,N);if(n>(F+S)/2&&n<=(V+S)/2){f=d[x].index;break}}}else for(var G=0;G<y;G++)if(G===0&&n<=(o[G].coordinate+o[G+1].coordinate)/2||G>0&&G<y-1&&n>(o[G].coordinate+o[G-1].coordinate)/2&&n<=(o[G].coordinate+o[G+1].coordinate)/2||G===y-1&&n>(o[G].coordinate+o[G-1].coordinate)/2){f=o[G].index;break}return f},fj=function(n){var a,o=n,d=o.type.displayName,h=(a=n.type)!==null&&a!==void 0&&a.defaultProps?Yr(Yr({},n.type.defaultProps),n.props):n.props,f=h.stroke,y=h.fill,b;switch(d){case"Line":b=f;break;case"Area":case"Radar":b=f&&f!=="none"?f:y;break;default:b=y;break}return b},nVe=function(n){var a=n.barSize,o=n.totalSize,d=n.stackGroups,h=d===void 0?{}:d;if(!h)return{};for(var f={},y=Object.keys(h),b=0,x=y.length;b<x;b++)for(var T=h[y[b]].stackGroups,S=Object.keys(T),N=0,O=S.length;N<O;N++){var A=T[S[N]],I=A.items,P=A.cateAxisId,L=I.filter(function(q){return Sl(q.type).indexOf("Bar")>=0});if(L&&L.length){var F=L[0].type.defaultProps,V=F!==void 0?Yr(Yr({},F),L[0].props):L[0].props,G=V.barSize,B=V[P];f[B]||(f[B]=[]);var z=yn(G)?a:G;f[B].push({item:L[0],stackList:L.slice(1),barSize:yn(z)?void 0:Uh(z,o,0)})}}return f},rVe=function(n){var a=n.barGap,o=n.barCategoryGap,d=n.bandSize,h=n.sizeList,f=h===void 0?[]:h,y=n.maxBarSize,b=f.length;if(b<1)return null;var x=Uh(a,d,0,!0),T,S=[];if(f[0].barSize===+f[0].barSize){var N=!1,O=d/b,A=f.reduce(function(G,B){return G+B.barSize||0},0);A+=(b-1)*x,A>=d&&(A-=(b-1)*x,x=0),A>=d&&O>0&&(N=!0,O*=.9,A=b*O);var I=(d-A)/2>>0,P={offset:I-x,size:0};T=f.reduce(function(G,B){var z={item:B.item,position:{offset:P.offset+P.size+x,size:N?O:B.barSize}},q=[].concat(qK(G),[z]);return P=q[q.length-1].position,B.stackList&&B.stackList.length&&B.stackList.forEach(function(Z){q.push({item:Z,position:P})}),q},S)}else{var L=Uh(o,d,0,!0);d-2*L-(b-1)*x<=0&&(x=0);var F=(d-2*L-(b-1)*x)/b;F>1&&(F>>=0);var V=y===+y?Math.min(F,y):F;T=f.reduce(function(G,B,z){var q=[].concat(qK(G),[{item:B.item,position:{offset:L+(F+x)*z+(F-V)/2,size:V}}]);return B.stackList&&B.stackList.length&&B.stackList.forEach(function(Z){q.push({item:Z,position:q[q.length-1].position})}),q},S)}return T},iVe=function(n,a,o,d){var h=o.children,f=o.width,y=o.margin,b=f-(y.left||0)-(y.right||0),x=xee({children:h,legendWidth:b});if(x){var T=d||{},S=T.width,N=T.height,O=x.align,A=x.verticalAlign,I=x.layout;if((I==="vertical"||I==="horizontal"&&A==="middle")&&O!=="center"&&lt(n[O]))return Yr(Yr({},n),{},Zm({},O,n[O]+(S||0)));if((I==="horizontal"||I==="vertical"&&O==="center")&&A!=="middle"&&lt(n[A]))return Yr(Yr({},n),{},Zm({},A,n[A]+(N||0)))}return n},aVe=function(n,a,o){return yn(a)?!0:n==="horizontal"?a==="yAxis":n==="vertical"||o==="x"?a==="xAxis":o==="y"?a==="yAxis":!0},Eee=function(n,a,o,d,h){var f=a.props.children,y=uo(f,e_).filter(function(x){return aVe(d,h,x.props.direction)});if(y&&y.length){var b=y.map(function(x){return x.props.dataKey});return n.reduce(function(x,T){var S=Ra(T,o);if(yn(S))return x;var N=Array.isArray(S)?[jT(S),Fd(S)]:[S,S],O=b.reduce(function(A,I){var P=Ra(T,I,0),L=N[0]-Math.abs(Array.isArray(P)?P[0]:P),F=N[1]+Math.abs(Array.isArray(P)?P[1]:P);return[Math.min(L,A[0]),Math.max(F,A[1])]},[1/0,-1/0]);return[Math.min(O[0],x[0]),Math.max(O[1],x[1])]},[1/0,-1/0])}return null},sVe=function(n,a,o,d,h){var f=a.map(function(y){return Eee(n,y,o,h,d)}).filter(function(y){return!yn(y)});return f&&f.length?f.reduce(function(y,b){return[Math.min(y[0],b[0]),Math.max(y[1],b[1])]},[1/0,-1/0]):null},See=function(n,a,o,d,h){var f=a.map(function(b){var x=b.props.dataKey;return o==="number"&&x&&Eee(n,b,x,d)||Cy(n,x,o,h)});if(o==="number")return f.reduce(function(b,x){return[Math.min(b[0],x[0]),Math.max(b[1],x[1])]},[1/0,-1/0]);var y={};return f.reduce(function(b,x){for(var T=0,S=x.length;T<S;T++)y[x[T]]||(y[x[T]]=!0,b.push(x[T]));return b},[])},wee=function(n,a){return n==="horizontal"&&a==="xAxis"||n==="vertical"&&a==="yAxis"||n==="centric"&&a==="angleAxis"||n==="radial"&&a==="radiusAxis"},Tee=function(n,a,o,d){if(d)return n.map(function(b){return b.coordinate});var h,f,y=n.map(function(b){return b.coordinate===a&&(h=!0),b.coordinate===o&&(f=!0),b.coordinate});return h||y.push(a),f||y.push(o),y},_l=function(n,a,o){if(!n)return null;var d=n.scale,h=n.duplicateDomain,f=n.type,y=n.range,b=n.realScaleType==="scaleBand"?d.bandwidth()/2:2,x=(a||o)&&f==="category"&&d.bandwidth?d.bandwidth()/b:0;if(x=n.axisType==="angleAxis"&&(y==null?void 0:y.length)>=2?Xo(y[0]-y[1])*2*x:x,a&&(n.ticks||n.niceTicks)){var T=(n.ticks||n.niceTicks).map(function(S){var N=h?h.indexOf(S):S;return{coordinate:d(N)+x,value:S,offset:x}});return T.filter(function(S){return!Zf(S.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(S,N){return{coordinate:d(S)+x,value:S,index:N,offset:x}}):d.ticks&&!o?d.ticks(n.tickCount).map(function(S){return{coordinate:d(S)+x,value:S,offset:x}}):d.domain().map(function(S,N){return{coordinate:d(S)+x,value:h?h[S]:S,index:N,offset:x}})},u1=new WeakMap,AE=function(n,a){if(typeof a!="function")return n;u1.has(n)||u1.set(n,new WeakMap);var o=u1.get(n);if(o.has(a))return o.get(a);var d=function(){n.apply(void 0,arguments),a.apply(void 0,arguments)};return o.set(a,d),d},oVe=function(n,a,o){var d=n.scale,h=n.type,f=n.layout,y=n.axisType;if(d==="auto")return f==="radial"&&y==="radiusAxis"?{scale:s0(),realScaleType:"band"}:f==="radial"&&y==="angleAxis"?{scale:QS(),realScaleType:"linear"}:h==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!o)?{scale:Ty(),realScaleType:"point"}:h==="category"?{scale:s0(),realScaleType:"band"}:{scale:QS(),realScaleType:"linear"};if(Mh(d)){var b="scale".concat(ET(d));return{scale:(WK[b]||Ty)(),realScaleType:WK[b]?b:"point"}}return un(d)?{scale:d}:{scale:Ty(),realScaleType:"point"}},JK=1e-4,cVe=function(n){var a=n.domain();if(!(!a||a.length<=2)){var o=a.length,d=n.range(),h=Math.min(d[0],d[1])-JK,f=Math.max(d[0],d[1])+JK,y=n(a[0]),b=n(a[o-1]);(y<h||y>f||b<h||b>f)&&n.domain([a[0],a[o-1]])}},lVe=function(n,a){if(!n)return null;for(var o=0,d=n.length;o<d;o++)if(n[o].item===a)return n[o].position;return null},dVe=function(n,a){if(!a||a.length!==2||!lt(a[0])||!lt(a[1]))return n;var o=Math.min(a[0],a[1]),d=Math.max(a[0],a[1]),h=[n[0],n[1]];return(!lt(n[0])||n[0]<o)&&(h[0]=o),(!lt(n[1])||n[1]>d)&&(h[1]=d),h[0]>d&&(h[0]=d),h[1]<o&&(h[1]=o),h},uVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var h=0,f=0,y=0;y<a;++y){var b=Zf(n[y][o][1])?n[y][o][0]:n[y][o][1];b>=0?(n[y][o][0]=h,n[y][o][1]=h+b,h=n[y][o][1]):(n[y][o][0]=f,n[y][o][1]=f+b,f=n[y][o][1])}},hVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var h=0,f=0;f<a;++f){var y=Zf(n[f][o][1])?n[f][o][0]:n[f][o][1];y>=0?(n[f][o][0]=h,n[f][o][1]=h+y,h=n[f][o][1]):(n[f][o][0]=0,n[f][o][1]=0)}},pVe={sign:uVe,expand:ROe,none:pf,silhouette:AOe,wiggle:IOe,positive:hVe},mVe=function(n,a,o){var d=a.map(function(y){return y.props.dataKey}),h=pVe[o],f=NOe().keys(d).value(function(y,b){return+Ra(y,b,0)}).order(HP).offset(h);return f(n)},fVe=function(n,a,o,d,h,f){if(!n)return null;var y=f?a.reverse():a,b={},x=y.reduce(function(S,N){var O,A=(O=N.type)!==null&&O!==void 0&&O.defaultProps?Yr(Yr({},N.type.defaultProps),N.props):N.props,I=A.stackId,P=A.hide;if(P)return S;var L=A[o],F=S[L]||{hasStack:!1,stackGroups:{}};if(_i(I)){var V=F.stackGroups[I]||{numericAxisId:o,cateAxisId:d,items:[]};V.items.push(N),F.hasStack=!0,F.stackGroups[I]=V}else F.stackGroups[eg("_stackId_")]={numericAxisId:o,cateAxisId:d,items:[N]};return Yr(Yr({},S),{},Zm({},L,F))},b),T={};return Object.keys(x).reduce(function(S,N){var O=x[N];if(O.hasStack){var A={};O.stackGroups=Object.keys(O.stackGroups).reduce(function(I,P){var L=O.stackGroups[P];return Yr(Yr({},I),{},Zm({},P,{numericAxisId:o,cateAxisId:d,items:L.items,stackedData:mVe(n,L.items,h)}))},A)}return Yr(Yr({},S),{},Zm({},N,O))},T)},gVe=function(n,a){var o=a.realScaleType,d=a.type,h=a.tickCount,f=a.originalDomain,y=a.allowDecimals,b=o||a.scale;if(b!=="auto"&&b!=="linear")return null;if(h&&d==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var x=n.domain();if(!x.length)return null;var T=NFe(x,h,y);return n.domain([jT(T),Fd(T)]),{niceTicks:T}}if(h&&d==="number"){var S=n.domain(),N=RFe(S,h,y);return{niceTicks:N}}return null};function aw(e){var n=e.axis,a=e.ticks,o=e.bandSize,d=e.entry,h=e.index,f=e.dataKey;if(n.type==="category"){if(!n.allowDuplicatedCategory&&n.dataKey&&!yn(d[n.dataKey])){var y=AS(a,"value",d[n.dataKey]);if(y)return y.coordinate+o/2}return a[h]?a[h].coordinate+o/2:null}var b=Ra(d,yn(f)?n.dataKey:f);return yn(b)?null:n.scale(b)}var QK=function(n){var a=n.axis,o=n.ticks,d=n.offset,h=n.bandSize,f=n.entry,y=n.index;if(a.type==="category")return o[y]?o[y].coordinate+d:null;var b=Ra(f,a.dataKey,a.domain[y]);return yn(b)?null:a.scale(b)-h/2+d},vVe=function(n){var a=n.numericAxis,o=a.scale.domain();if(a.type==="number"){var d=Math.min(o[0],o[1]),h=Math.max(o[0],o[1]);return d<=0&&h>=0?0:h<0?h:d}return o[0]},yVe=function(n,a){var o,d=(o=n.type)!==null&&o!==void 0&&o.defaultProps?Yr(Yr({},n.type.defaultProps),n.props):n.props,h=d.stackId;if(_i(h)){var f=a[h];if(f){var y=f.items.indexOf(n);return y>=0?f.stackedData[y]:null}}return null},_Ve=function(n){return n.reduce(function(a,o){return[jT(o.concat([a[0]]).filter(lt)),Fd(o.concat([a[1]]).filter(lt))]},[1/0,-1/0])},Cee=function(n,a,o){return Object.keys(n).reduce(function(d,h){var f=n[h],y=f.stackedData,b=y.reduce(function(x,T){var S=_Ve(T.slice(a,o+1));return[Math.min(x[0],S[0]),Math.max(x[1],S[1])]},[1/0,-1/0]);return[Math.min(b[0],d[0]),Math.max(b[1],d[1])]},[1/0,-1/0]).map(function(d){return d===1/0||d===-1/0?0:d})},ZK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,e9=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,xD=function(n,a,o){if(un(n))return n(a,o);if(!Array.isArray(n))return a;var d=[];if(lt(n[0]))d[0]=o?n[0]:Math.min(n[0],a[0]);else if(ZK.test(n[0])){var h=+ZK.exec(n[0])[1];d[0]=a[0]-h}else un(n[0])?d[0]=n[0](a[0]):d[0]=a[0];if(lt(n[1]))d[1]=o?n[1]:Math.max(n[1],a[1]);else if(e9.test(n[1])){var f=+e9.exec(n[1])[1];d[1]=a[1]+f}else un(n[1])?d[1]=n[1](a[1]):d[1]=a[1];return d},sw=function(n,a,o){if(n&&n.scale&&n.scale.bandwidth){var d=n.scale.bandwidth();if(!o||d>0)return d}if(n&&a&&a.length>=2){for(var h=Wk(a,function(S){return S.coordinate}),f=1/0,y=1,b=h.length;y<b;y++){var x=h[y],T=h[y-1];f=Math.min((x.coordinate||0)-(T.coordinate||0),f)}return f===1/0?0:f}return o?void 0:0},t9=function(n,a,o){return!n||!n.length||xf(n,lo(o,"type.defaultProps.domain"))?a:n},Nee=function(n,a){var o=n.type.defaultProps?Yr(Yr({},n.type.defaultProps),n.props):n.props,d=o.dataKey,h=o.name,f=o.unit,y=o.formatter,b=o.tooltipType,x=o.chartType,T=o.hide;return Yr(Yr({},gn(n,!1)),{},{dataKey:d,unit:f,formatter:y,name:h||d,color:fj(n),value:Ra(a,d),type:b,payload:a,chartType:x,hide:T})};function f0(e){"@babel/helpers - typeof";return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},f0(e)}function n9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function r9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?n9(Object(a),!0).forEach(function(o){bVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function bVe(e,n,a){return n=xVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function xVe(e){var n=EVe(e,"string");return f0(n)=="symbol"?n:n+""}function EVe(e,n){if(f0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(f0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var ow=Math.PI/180,SVe=function(n){return n*180/Math.PI},zi=function(n,a,o,d){return{x:n+Math.cos(-ow*d)*o,y:a+Math.sin(-ow*d)*o}},wVe=function(n,a){var o=n.x,d=n.y,h=a.x,f=a.y;return Math.sqrt(Math.pow(o-h,2)+Math.pow(d-f,2))},TVe=function(n,a){var o=n.x,d=n.y,h=a.cx,f=a.cy,y=wVe({x:o,y:d},{x:h,y:f});if(y<=0)return{radius:y};var b=(o-h)/y,x=Math.acos(b);return d>f&&(x=2*Math.PI-x),{radius:y,angle:SVe(x),angleInRadian:x}},CVe=function(n){var a=n.startAngle,o=n.endAngle,d=Math.floor(a/360),h=Math.floor(o/360),f=Math.min(d,h);return{startAngle:a-f*360,endAngle:o-f*360}},NVe=function(n,a){var o=a.startAngle,d=a.endAngle,h=Math.floor(o/360),f=Math.floor(d/360),y=Math.min(h,f);return n+y*360},i9=function(n,a){var o=n.x,d=n.y,h=TVe({x:o,y:d},a),f=h.radius,y=h.angle,b=a.innerRadius,x=a.outerRadius;if(f<b||f>x)return!1;if(f===0)return!0;var T=CVe(a),S=T.startAngle,N=T.endAngle,O=y,A;if(S<=N){for(;O>N;)O-=360;for(;O<S;)O+=360;A=O>=S&&O<=N}else{for(;O>S;)O-=360;for(;O<N;)O+=360;A=O>=N&&O<=S}return A?r9(r9({},a),{},{radius:f,angle:NVe(O,a)}):null};function g0(e){"@babel/helpers - typeof";return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},g0(e)}var RVe=["offset"];function AVe(e){return DVe(e)||PVe(e)||OVe(e)||IVe()}function IVe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OVe(e,n){if(e){if(typeof e=="string")return ED(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ED(e,n)}}function PVe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function DVe(e){if(Array.isArray(e))return ED(e)}function ED(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function kVe(e,n){if(e==null)return{};var a=jVe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function jVe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function a9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function fi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?a9(Object(a),!0).forEach(function(o){LVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):a9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function LVe(e,n,a){return n=MVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function MVe(e){var n=UVe(e,"string");return g0(n)=="symbol"?n:n+""}function UVe(e,n){if(g0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(g0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function v0(){return v0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},v0.apply(this,arguments)}var FVe=function(n){var a=n.value,o=n.formatter,d=yn(n.children)?a:n.children;return un(o)?o(d):d},VVe=function(n,a){var o=Xo(a-n),d=Math.min(Math.abs(a-n),360);return o*d},BVe=function(n,a,o){var d=n.position,h=n.viewBox,f=n.offset,y=n.className,b=h,x=b.cx,T=b.cy,S=b.innerRadius,N=b.outerRadius,O=b.startAngle,A=b.endAngle,I=b.clockWise,P=(S+N)/2,L=VVe(O,A),F=L>=0?1:-1,V,G;d==="insideStart"?(V=O+F*f,G=I):d==="insideEnd"?(V=A-F*f,G=!I):d==="end"&&(V=A+F*f,G=I),G=L<=0?G:!G;var B=zi(x,T,P,V),z=zi(x,T,P,V+(G?1:-1)*359),q="M".concat(B.x,",").concat(B.y,`
    A`).concat(P,",").concat(P,",0,1,").concat(G?0:1,`,
    `).concat(z.x,",").concat(z.y),Z=yn(n.id)?eg("recharts-radial-line-"):n.id;return ge.createElement("text",v0({},o,{dominantBaseline:"central",className:An("recharts-radial-bar-label",y)}),ge.createElement("defs",null,ge.createElement("path",{id:Z,d:q})),ge.createElement("textPath",{xlinkHref:"#".concat(Z)},a))},GVe=function(n){var a=n.viewBox,o=n.offset,d=n.position,h=a,f=h.cx,y=h.cy,b=h.innerRadius,x=h.outerRadius,T=h.startAngle,S=h.endAngle,N=(T+S)/2;if(d==="outside"){var O=zi(f,y,x+o,N),A=O.x,I=O.y;return{x:A,y:I,textAnchor:A>=f?"start":"end",verticalAnchor:"middle"}}if(d==="center")return{x:f,y,textAnchor:"middle",verticalAnchor:"middle"};if(d==="centerTop")return{x:f,y,textAnchor:"middle",verticalAnchor:"start"};if(d==="centerBottom")return{x:f,y,textAnchor:"middle",verticalAnchor:"end"};var P=(b+x)/2,L=zi(f,y,P,N),F=L.x,V=L.y;return{x:F,y:V,textAnchor:"middle",verticalAnchor:"middle"}},WVe=function(n){var a=n.viewBox,o=n.parentViewBox,d=n.offset,h=n.position,f=a,y=f.x,b=f.y,x=f.width,T=f.height,S=T>=0?1:-1,N=S*d,O=S>0?"end":"start",A=S>0?"start":"end",I=x>=0?1:-1,P=I*d,L=I>0?"end":"start",F=I>0?"start":"end";if(h==="top"){var V={x:y+x/2,y:b-S*d,textAnchor:"middle",verticalAnchor:O};return fi(fi({},V),o?{height:Math.max(b-o.y,0),width:x}:{})}if(h==="bottom"){var G={x:y+x/2,y:b+T+N,textAnchor:"middle",verticalAnchor:A};return fi(fi({},G),o?{height:Math.max(o.y+o.height-(b+T),0),width:x}:{})}if(h==="left"){var B={x:y-P,y:b+T/2,textAnchor:L,verticalAnchor:"middle"};return fi(fi({},B),o?{width:Math.max(B.x-o.x,0),height:T}:{})}if(h==="right"){var z={x:y+x+P,y:b+T/2,textAnchor:F,verticalAnchor:"middle"};return fi(fi({},z),o?{width:Math.max(o.x+o.width-z.x,0),height:T}:{})}var q=o?{width:x,height:T}:{};return h==="insideLeft"?fi({x:y+P,y:b+T/2,textAnchor:F,verticalAnchor:"middle"},q):h==="insideRight"?fi({x:y+x-P,y:b+T/2,textAnchor:L,verticalAnchor:"middle"},q):h==="insideTop"?fi({x:y+x/2,y:b+N,textAnchor:"middle",verticalAnchor:A},q):h==="insideBottom"?fi({x:y+x/2,y:b+T-N,textAnchor:"middle",verticalAnchor:O},q):h==="insideTopLeft"?fi({x:y+P,y:b+N,textAnchor:F,verticalAnchor:A},q):h==="insideTopRight"?fi({x:y+x-P,y:b+N,textAnchor:L,verticalAnchor:A},q):h==="insideBottomLeft"?fi({x:y+P,y:b+T-N,textAnchor:F,verticalAnchor:O},q):h==="insideBottomRight"?fi({x:y+x-P,y:b+T-N,textAnchor:L,verticalAnchor:O},q):qf(h)&&(lt(h.x)||bh(h.x))&&(lt(h.y)||bh(h.y))?fi({x:y+Uh(h.x,x),y:b+Uh(h.y,T),textAnchor:"end",verticalAnchor:"end"},q):fi({x:y+x/2,y:b+T/2,textAnchor:"middle",verticalAnchor:"middle"},q)},$Ve=function(n){return"cx"in n&&lt(n.cx)};function ca(e){var n=e.offset,a=n===void 0?5:n,o=kVe(e,RVe),d=fi({offset:a},o),h=d.viewBox,f=d.position,y=d.value,b=d.children,x=d.content,T=d.className,S=T===void 0?"":T,N=d.textBreakAll;if(!h||yn(y)&&yn(b)&&!Y.isValidElement(x)&&!un(x))return null;if(Y.isValidElement(x))return Y.cloneElement(x,d);var O;if(un(x)){if(O=Y.createElement(x,d),Y.isValidElement(O))return O}else O=FVe(d);var A=$Ve(h),I=gn(d,!0);if(A&&(f==="insideStart"||f==="insideEnd"||f==="end"))return BVe(d,O,I);var P=A?GVe(d):WVe(d);return ge.createElement(HS,v0({className:An("recharts-label",S)},I,P,{breakAll:N}),O)}ca.displayName="Label";var Ree=function(n){var a=n.cx,o=n.cy,d=n.angle,h=n.startAngle,f=n.endAngle,y=n.r,b=n.radius,x=n.innerRadius,T=n.outerRadius,S=n.x,N=n.y,O=n.top,A=n.left,I=n.width,P=n.height,L=n.clockWise,F=n.labelViewBox;if(F)return F;if(lt(I)&&lt(P)){if(lt(S)&&lt(N))return{x:S,y:N,width:I,height:P};if(lt(O)&&lt(A))return{x:O,y:A,width:I,height:P}}return lt(S)&&lt(N)?{x:S,y:N,width:0,height:0}:lt(a)&&lt(o)?{cx:a,cy:o,startAngle:h||d||0,endAngle:f||d||0,innerRadius:x||0,outerRadius:T||b||y||0,clockWise:L}:n.viewBox?n.viewBox:{}},HVe=function(n,a){return n?n===!0?ge.createElement(ca,{key:"label-implicit",viewBox:a}):_i(n)?ge.createElement(ca,{key:"label-implicit",viewBox:a,value:n}):Y.isValidElement(n)?n.type===ca?Y.cloneElement(n,{key:"label-implicit",viewBox:a}):ge.createElement(ca,{key:"label-implicit",content:n,viewBox:a}):un(n)?ge.createElement(ca,{key:"label-implicit",content:n,viewBox:a}):qf(n)?ge.createElement(ca,v0({viewBox:a},n,{key:"label-implicit"})):null:null},zVe=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&o&&!n.label)return null;var d=n.children,h=Ree(n),f=uo(d,ca).map(function(b,x){return Y.cloneElement(b,{viewBox:a||h,key:"label-".concat(x)})});if(!o)return f;var y=HVe(n.label,a||h);return[y].concat(AVe(f))};ca.parseViewBox=Ree;ca.renderCallByParent=zVe;function KVe(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}var YVe=KVe;const qVe=ar(YVe);function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},y0(e)}var XVe=["valueAccessor"],JVe=["data","dataKey","clockWise","id","textBreakAll"];function QVe(e){return nBe(e)||tBe(e)||eBe(e)||ZVe()}function ZVe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eBe(e,n){if(e){if(typeof e=="string")return SD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return SD(e,n)}}function tBe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nBe(e){if(Array.isArray(e))return SD(e)}function SD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},cw.apply(this,arguments)}function s9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function o9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?s9(Object(a),!0).forEach(function(o){rBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function rBe(e,n,a){return n=iBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function iBe(e){var n=aBe(e,"string");return y0(n)=="symbol"?n:n+""}function aBe(e,n){if(y0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(y0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function c9(e,n){if(e==null)return{};var a=sBe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function sBe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var oBe=function(n){return Array.isArray(n.value)?qVe(n.value):n.value};function Cl(e){var n=e.valueAccessor,a=n===void 0?oBe:n,o=c9(e,XVe),d=o.data,h=o.dataKey,f=o.clockWise,y=o.id,b=o.textBreakAll,x=c9(o,JVe);return!d||!d.length?null:ge.createElement(mr,{className:"recharts-label-list"},d.map(function(T,S){var N=yn(h)?a(T,S):Ra(T&&T.payload,h),O=yn(y)?{}:{id:"".concat(y,"-").concat(S)};return ge.createElement(ca,cw({},gn(T,!0),x,O,{parentViewBox:T.parentViewBox,value:N,textBreakAll:b,viewBox:ca.parseViewBox(yn(f)?T:o9(o9({},T),{},{clockWise:f})),key:"label-".concat(S),index:S}))}))}Cl.displayName="LabelList";function cBe(e,n){return e?e===!0?ge.createElement(Cl,{key:"labelList-implicit",data:n}):ge.isValidElement(e)||un(e)?ge.createElement(Cl,{key:"labelList-implicit",data:n,content:e}):qf(e)?ge.createElement(Cl,cw({data:n},e,{key:"labelList-implicit"})):null:null}function lBe(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&a&&!e.label)return null;var o=e.children,d=uo(o,Cl).map(function(f,y){return Y.cloneElement(f,{data:n,key:"labelList-".concat(y)})});if(!a)return d;var h=cBe(e.label,n);return[h].concat(QVe(d))}Cl.renderCallByParent=lBe;function _0(e){"@babel/helpers - typeof";return _0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_0(e)}function wD(){return wD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},wD.apply(this,arguments)}function l9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function d9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?l9(Object(a),!0).forEach(function(o){dBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function dBe(e,n,a){return n=uBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function uBe(e){var n=hBe(e,"string");return _0(n)=="symbol"?n:n+""}function hBe(e,n){if(_0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(_0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var pBe=function(n,a){var o=Xo(a-n),d=Math.min(Math.abs(a-n),359.999);return o*d},IE=function(n){var a=n.cx,o=n.cy,d=n.radius,h=n.angle,f=n.sign,y=n.isExternal,b=n.cornerRadius,x=n.cornerIsExternal,T=b*(y?1:-1)+d,S=Math.asin(b/T)/ow,N=x?h:h+f*S,O=zi(a,o,T,N),A=zi(a,o,d,N),I=x?h-f*S:h,P=zi(a,o,T*Math.cos(S*ow),I);return{center:O,circleTangency:A,lineTangency:P,theta:S}},Aee=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,h=n.outerRadius,f=n.startAngle,y=n.endAngle,b=pBe(f,y),x=f+b,T=zi(a,o,h,f),S=zi(a,o,h,x),N="M ".concat(T.x,",").concat(T.y,`
    A `).concat(h,",").concat(h,`,0,
    `).concat(+(Math.abs(b)>180),",").concat(+(f>x),`,
    `).concat(S.x,",").concat(S.y,`
  `);if(d>0){var O=zi(a,o,d,f),A=zi(a,o,d,x);N+="L ".concat(A.x,",").concat(A.y,`
            A `).concat(d,",").concat(d,`,0,
            `).concat(+(Math.abs(b)>180),",").concat(+(f<=x),`,
            `).concat(O.x,",").concat(O.y," Z")}else N+="L ".concat(a,",").concat(o," Z");return N},mBe=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,h=n.outerRadius,f=n.cornerRadius,y=n.forceCornerRadius,b=n.cornerIsExternal,x=n.startAngle,T=n.endAngle,S=Xo(T-x),N=IE({cx:a,cy:o,radius:h,angle:x,sign:S,cornerRadius:f,cornerIsExternal:b}),O=N.circleTangency,A=N.lineTangency,I=N.theta,P=IE({cx:a,cy:o,radius:h,angle:T,sign:-S,cornerRadius:f,cornerIsExternal:b}),L=P.circleTangency,F=P.lineTangency,V=P.theta,G=b?Math.abs(x-T):Math.abs(x-T)-I-V;if(G<0)return y?"M ".concat(A.x,",").concat(A.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):Aee({cx:a,cy:o,innerRadius:d,outerRadius:h,startAngle:x,endAngle:T});var B="M ".concat(A.x,",").concat(A.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(S<0),",").concat(O.x,",").concat(O.y,`
    A`).concat(h,",").concat(h,",0,").concat(+(G>180),",").concat(+(S<0),",").concat(L.x,",").concat(L.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(S<0),",").concat(F.x,",").concat(F.y,`
  `);if(d>0){var z=IE({cx:a,cy:o,radius:d,angle:x,sign:S,isExternal:!0,cornerRadius:f,cornerIsExternal:b}),q=z.circleTangency,Z=z.lineTangency,ie=z.theta,ue=IE({cx:a,cy:o,radius:d,angle:T,sign:-S,isExternal:!0,cornerRadius:f,cornerIsExternal:b}),re=ue.circleTangency,pe=ue.lineTangency,Se=ue.theta,fe=b?Math.abs(x-T):Math.abs(x-T)-ie-Se;if(fe<0&&f===0)return"".concat(B,"L").concat(a,",").concat(o,"Z");B+="L".concat(pe.x,",").concat(pe.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(S<0),",").concat(re.x,",").concat(re.y,`
      A`).concat(d,",").concat(d,",0,").concat(+(fe>180),",").concat(+(S>0),",").concat(q.x,",").concat(q.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(S<0),",").concat(Z.x,",").concat(Z.y,"Z")}else B+="L".concat(a,",").concat(o,"Z");return B},fBe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Iee=function(n){var a=d9(d9({},fBe),n),o=a.cx,d=a.cy,h=a.innerRadius,f=a.outerRadius,y=a.cornerRadius,b=a.forceCornerRadius,x=a.cornerIsExternal,T=a.startAngle,S=a.endAngle,N=a.className;if(f<h||T===S)return null;var O=An("recharts-sector",N),A=f-h,I=Uh(y,A,0,!0),P;return I>0&&Math.abs(T-S)<360?P=mBe({cx:o,cy:d,innerRadius:h,outerRadius:f,cornerRadius:Math.min(I,A/2),forceCornerRadius:b,cornerIsExternal:x,startAngle:T,endAngle:S}):P=Aee({cx:o,cy:d,innerRadius:h,outerRadius:f,startAngle:T,endAngle:S}),ge.createElement("path",wD({},gn(a,!0),{className:O,d:P,role:"img"}))};function b0(e){"@babel/helpers - typeof";return b0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},b0(e)}function TD(){return TD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},TD.apply(this,arguments)}function u9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function h9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?u9(Object(a),!0).forEach(function(o){gBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function gBe(e,n,a){return n=vBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function vBe(e){var n=yBe(e,"string");return b0(n)=="symbol"?n:n+""}function yBe(e,n){if(b0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(b0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var p9={curveBasisClosed:gOe,curveBasisOpen:vOe,curveBasis:fOe,curveBumpX:tOe,curveBumpY:nOe,curveLinearClosed:yOe,curveLinear:wT,curveMonotoneX:_Oe,curveMonotoneY:bOe,curveNatural:xOe,curveStep:EOe,curveStepAfter:wOe,curveStepBefore:SOe},OE=function(n){return n.x===+n.x&&n.y===+n.y},ey=function(n){return n.x},ty=function(n){return n.y},_Be=function(n,a){if(un(n))return n;var o="curve".concat(ET(n));return(o==="curveMonotone"||o==="curveBump")&&a?p9["".concat(o).concat(a==="vertical"?"Y":"X")]:p9[o]||wT},bBe=function(n){var a=n.type,o=a===void 0?"linear":a,d=n.points,h=d===void 0?[]:d,f=n.baseLine,y=n.layout,b=n.connectNulls,x=b===void 0?!1:b,T=_Be(o,y),S=x?h.filter(function(I){return OE(I)}):h,N;if(Array.isArray(f)){var O=x?f.filter(function(I){return OE(I)}):f,A=S.map(function(I,P){return h9(h9({},I),{},{base:O[P]})});return y==="vertical"?N=xE().y(ty).x1(ey).x0(function(I){return I.base.x}):N=xE().x(ey).y1(ty).y0(function(I){return I.base.y}),N.defined(OE).curve(T),N(A)}return y==="vertical"&&lt(f)?N=xE().y(ty).x1(ey).x0(f):lt(f)?N=xE().x(ey).y1(ty).y0(f):N=IQ().x(ey).y(ty),N.defined(OE).curve(T),N(S)},ef=function(n){var a=n.className,o=n.points,d=n.path,h=n.pathRef;if((!o||!o.length)&&!d)return null;var f=o&&o.length?bBe(n):d;return Y.createElement("path",TD({},gn(n,!1),IS(n),{className:An("recharts-curve",a),d:f,ref:h}))},Oee={exports:{}},xBe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",EBe=xBe,SBe=EBe;function Pee(){}function Dee(){}Dee.resetWarningCache=Pee;var wBe=function(){function e(o,d,h,f,y,b){if(b!==SBe){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}e.isRequired=e;function n(){return e}var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:Dee,resetWarningCache:Pee};return a.PropTypes=a,a};Oee.exports=wBe();var TBe=Oee.exports;const Mt=ar(TBe);var CBe=Object.getOwnPropertyNames,NBe=Object.getOwnPropertySymbols,RBe=Object.prototype.hasOwnProperty;function m9(e,n){return function(o,d,h){return e(o,d,h)&&n(o,d,h)}}function PE(e){return function(a,o,d){if(!a||!o||typeof a!="object"||typeof o!="object")return e(a,o,d);var h=d.cache,f=h.get(a),y=h.get(o);if(f&&y)return f===o&&y===a;h.set(a,o),h.set(o,a);var b=e(a,o,d);return h.delete(a),h.delete(o),b}}function ABe(e){return e!=null?e[Symbol.toStringTag]:void 0}function f9(e){return CBe(e).concat(NBe(e))}var IBe=Object.hasOwn||function(e,n){return RBe.call(e,n)};function Yh(e,n){return e===n||!e&&!n&&e!==e&&n!==n}var OBe="__v",PBe="__o",DBe="_owner",g9=Object.getOwnPropertyDescriptor,v9=Object.keys;function kBe(e,n,a){var o=e.length;if(n.length!==o)return!1;for(;o-- >0;)if(!a.equals(e[o],n[o],o,o,e,n,a))return!1;return!0}function jBe(e,n){return Yh(e.getTime(),n.getTime())}function LBe(e,n){return e.name===n.name&&e.message===n.message&&e.cause===n.cause&&e.stack===n.stack}function MBe(e,n){return e===n}function y9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),h=e.entries(),f,y,b=0;(f=h.next())&&!f.done;){for(var x=n.entries(),T=!1,S=0;(y=x.next())&&!y.done;){if(d[S]){S++;continue}var N=f.value,O=y.value;if(a.equals(N[0],O[0],b,S,e,n,a)&&a.equals(N[1],O[1],N[0],O[0],e,n,a)){T=d[S]=!0;break}S++}if(!T)return!1;b++}return!0}var UBe=Yh;function FBe(e,n,a){var o=v9(e),d=o.length;if(v9(n).length!==d)return!1;for(;d-- >0;)if(!kee(e,n,a,o[d]))return!1;return!0}function ny(e,n,a){var o=f9(e),d=o.length;if(f9(n).length!==d)return!1;for(var h,f,y;d-- >0;)if(h=o[d],!kee(e,n,a,h)||(f=g9(e,h),y=g9(n,h),(f||y)&&(!f||!y||f.configurable!==y.configurable||f.enumerable!==y.enumerable||f.writable!==y.writable)))return!1;return!0}function VBe(e,n){return Yh(e.valueOf(),n.valueOf())}function BBe(e,n){return e.source===n.source&&e.flags===n.flags}function _9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),h=e.values(),f,y;(f=h.next())&&!f.done;){for(var b=n.values(),x=!1,T=0;(y=b.next())&&!y.done;){if(!d[T]&&a.equals(f.value,y.value,f.value,y.value,e,n,a)){x=d[T]=!0;break}T++}if(!x)return!1}return!0}function GBe(e,n){var a=e.length;if(n.length!==a)return!1;for(;a-- >0;)if(e[a]!==n[a])return!1;return!0}function WBe(e,n){return e.hostname===n.hostname&&e.pathname===n.pathname&&e.protocol===n.protocol&&e.port===n.port&&e.hash===n.hash&&e.username===n.username&&e.password===n.password}function kee(e,n,a,o){return(o===DBe||o===PBe||o===OBe)&&(e.$$typeof||n.$$typeof)?!0:IBe(n,o)&&a.equals(e[o],n[o],o,o,e,n,a)}var $Be="[object Arguments]",HBe="[object Boolean]",zBe="[object Date]",KBe="[object Error]",YBe="[object Map]",qBe="[object Number]",XBe="[object Object]",JBe="[object RegExp]",QBe="[object Set]",ZBe="[object String]",e6e="[object URL]",t6e=Array.isArray,b9=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,x9=Object.assign,n6e=Object.prototype.toString.call.bind(Object.prototype.toString);function r6e(e){var n=e.areArraysEqual,a=e.areDatesEqual,o=e.areErrorsEqual,d=e.areFunctionsEqual,h=e.areMapsEqual,f=e.areNumbersEqual,y=e.areObjectsEqual,b=e.arePrimitiveWrappersEqual,x=e.areRegExpsEqual,T=e.areSetsEqual,S=e.areTypedArraysEqual,N=e.areUrlsEqual,O=e.unknownTagComparators;return function(I,P,L){if(I===P)return!0;if(I==null||P==null)return!1;var F=typeof I;if(F!==typeof P)return!1;if(F!=="object")return F==="number"?f(I,P,L):F==="function"?d(I,P,L):!1;var V=I.constructor;if(V!==P.constructor)return!1;if(V===Object)return y(I,P,L);if(t6e(I))return n(I,P,L);if(b9!=null&&b9(I))return S(I,P,L);if(V===Date)return a(I,P,L);if(V===RegExp)return x(I,P,L);if(V===Map)return h(I,P,L);if(V===Set)return T(I,P,L);var G=n6e(I);if(G===zBe)return a(I,P,L);if(G===JBe)return x(I,P,L);if(G===YBe)return h(I,P,L);if(G===QBe)return T(I,P,L);if(G===XBe)return typeof I.then!="function"&&typeof P.then!="function"&&y(I,P,L);if(G===e6e)return N(I,P,L);if(G===KBe)return o(I,P,L);if(G===$Be)return y(I,P,L);if(G===HBe||G===qBe||G===ZBe)return b(I,P,L);if(O){var B=O[G];if(!B){var z=ABe(I);z&&(B=O[z])}if(B)return B(I,P,L)}return!1}}function i6e(e){var n=e.circular,a=e.createCustomConfig,o=e.strict,d={areArraysEqual:o?ny:kBe,areDatesEqual:jBe,areErrorsEqual:LBe,areFunctionsEqual:MBe,areMapsEqual:o?m9(y9,ny):y9,areNumbersEqual:UBe,areObjectsEqual:o?ny:FBe,arePrimitiveWrappersEqual:VBe,areRegExpsEqual:BBe,areSetsEqual:o?m9(_9,ny):_9,areTypedArraysEqual:o?ny:GBe,areUrlsEqual:WBe,unknownTagComparators:void 0};if(a&&(d=x9({},d,a(d))),n){var h=PE(d.areArraysEqual),f=PE(d.areMapsEqual),y=PE(d.areObjectsEqual),b=PE(d.areSetsEqual);d=x9({},d,{areArraysEqual:h,areMapsEqual:f,areObjectsEqual:y,areSetsEqual:b})}return d}function a6e(e){return function(n,a,o,d,h,f,y){return e(n,a,y)}}function s6e(e){var n=e.circular,a=e.comparator,o=e.createState,d=e.equals,h=e.strict;if(o)return function(b,x){var T=o(),S=T.cache,N=S===void 0?n?new WeakMap:void 0:S,O=T.meta;return a(b,x,{cache:N,equals:d,meta:O,strict:h})};if(n)return function(b,x){return a(b,x,{cache:new WeakMap,equals:d,meta:void 0,strict:h})};var f={cache:void 0,equals:d,meta:void 0,strict:h};return function(b,x){return a(b,x,f)}}var o6e=uu();uu({strict:!0});uu({circular:!0});uu({circular:!0,strict:!0});uu({createInternalComparator:function(){return Yh}});uu({strict:!0,createInternalComparator:function(){return Yh}});uu({circular:!0,createInternalComparator:function(){return Yh}});uu({circular:!0,createInternalComparator:function(){return Yh},strict:!0});function uu(e){e===void 0&&(e={});var n=e.circular,a=n===void 0?!1:n,o=e.createInternalComparator,d=e.createState,h=e.strict,f=h===void 0?!1:h,y=i6e(e),b=r6e(y),x=o?o(b):a6e(b);return s6e({circular:a,comparator:b,createState:d,equals:x,strict:f})}function c6e(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function E9(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=-1,o=function d(h){a<0&&(a=h),h-a>n?(e(h),a=-1):c6e(d)};requestAnimationFrame(o)}function CD(e){"@babel/helpers - typeof";return CD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},CD(e)}function l6e(e){return p6e(e)||h6e(e)||u6e(e)||d6e()}function d6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u6e(e,n){if(e){if(typeof e=="string")return S9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return S9(e,n)}}function S9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function h6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function p6e(e){if(Array.isArray(e))return e}function m6e(){var e={},n=function(){return null},a=!1,o=function d(h){if(!a){if(Array.isArray(h)){if(!h.length)return;var f=h,y=l6e(f),b=y[0],x=y.slice(1);if(typeof b=="number"){E9(d.bind(null,x),b);return}d(b),E9(d.bind(null,x));return}CD(h)==="object"&&(e=h,n(e)),typeof h=="function"&&h()}};return{stop:function(){a=!0},start:function(h){a=!1,o(h)},subscribe:function(h){return n=h,function(){n=function(){return null}}}}}function x0(e){"@babel/helpers - typeof";return x0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},x0(e)}function w9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function T9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?w9(Object(a),!0).forEach(function(o){jee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function jee(e,n,a){return n=f6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function f6e(e){var n=g6e(e,"string");return x0(n)==="symbol"?n:String(n)}function g6e(e,n){if(x0(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(x0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var v6e=function(n,a){return[Object.keys(n),Object.keys(a)].reduce(function(o,d){return o.filter(function(h){return d.includes(h)})})},y6e=function(n){return n},_6e=function(n){return n.replace(/([A-Z])/g,function(a){return"-".concat(a.toLowerCase())})},Ny=function(n,a){return Object.keys(a).reduce(function(o,d){return T9(T9({},o),{},jee({},d,n(d,a[d])))},{})},C9=function(n,a,o){return n.map(function(d){return"".concat(_6e(d)," ").concat(a,"ms ").concat(o)}).join(",")};function b6e(e,n){return S6e(e)||E6e(e,n)||Lee(e,n)||x6e()}function x6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function S6e(e){if(Array.isArray(e))return e}function w6e(e){return N6e(e)||C6e(e)||Lee(e)||T6e()}function T6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lee(e,n){if(e){if(typeof e=="string")return ND(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ND(e,n)}}function C6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function N6e(e){if(Array.isArray(e))return ND(e)}function ND(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var lw=1e-4,Mee=function(n,a){return[0,3*n,3*a-6*n,3*n-3*a+1]},Uee=function(n,a){return n.map(function(o,d){return o*Math.pow(a,d)}).reduce(function(o,d){return o+d})},N9=function(n,a){return function(o){var d=Mee(n,a);return Uee(d,o)}},R6e=function(n,a){return function(o){var d=Mee(n,a),h=[].concat(w6e(d.map(function(f,y){return f*y}).slice(1)),[0]);return Uee(h,o)}},R9=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0],h=a[1],f=a[2],y=a[3];if(a.length===1)switch(a[0]){case"linear":d=0,h=0,f=1,y=1;break;case"ease":d=.25,h=.1,f=.25,y=1;break;case"ease-in":d=.42,h=0,f=1,y=1;break;case"ease-out":d=.42,h=0,f=.58,y=1;break;case"ease-in-out":d=0,h=0,f=.58,y=1;break;default:{var b=a[0].split("(");if(b[0]==="cubic-bezier"&&b[1].split(")")[0].split(",").length===4){var x=b[1].split(")")[0].split(",").map(function(P){return parseFloat(P)}),T=b6e(x,4);d=T[0],h=T[1],f=T[2],y=T[3]}}}var S=N9(d,f),N=N9(h,y),O=R6e(d,f),A=function(L){return L>1?1:L<0?0:L},I=function(L){for(var F=L>1?1:L,V=F,G=0;G<8;++G){var B=S(V)-F,z=O(V);if(Math.abs(B-F)<lw||z<lw)return N(V);V=A(V-B/z)}return N(V)};return I.isStepper=!1,I},A6e=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.stiff,o=a===void 0?100:a,d=n.damping,h=d===void 0?8:d,f=n.dt,y=f===void 0?17:f,b=function(T,S,N){var O=-(T-S)*o,A=N*h,I=N+(O-A)*y/1e3,P=N*y/1e3+T;return Math.abs(P-S)<lw&&Math.abs(I)<lw?[S,0]:[P,I]};return b.isStepper=!0,b.dt=y,b},I6e=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0];if(typeof d=="string")switch(d){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return R9(d);case"spring":return A6e();default:if(d.split("(")[0]==="cubic-bezier")return R9(d)}return typeof d=="function"?d:null};function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},E0(e)}function A9(e){return D6e(e)||P6e(e)||Fee(e)||O6e()}function O6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function D6e(e){if(Array.isArray(e))return AD(e)}function I9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Wi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?I9(Object(a),!0).forEach(function(o){RD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):I9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function RD(e,n,a){return n=k6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function k6e(e){var n=j6e(e,"string");return E0(n)==="symbol"?n:String(n)}function j6e(e,n){if(E0(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(E0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function L6e(e,n){return F6e(e)||U6e(e,n)||Fee(e,n)||M6e()}function M6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fee(e,n){if(e){if(typeof e=="string")return AD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AD(e,n)}}function AD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function U6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function F6e(e){if(Array.isArray(e))return e}var dw=function(n,a,o){return n+(a-n)*o},ID=function(n){var a=n.from,o=n.to;return a!==o},V6e=function e(n,a,o){var d=Ny(function(h,f){if(ID(f)){var y=n(f.from,f.to,f.velocity),b=L6e(y,2),x=b[0],T=b[1];return Wi(Wi({},f),{},{from:x,velocity:T})}return f},a);return o<1?Ny(function(h,f){return ID(f)?Wi(Wi({},f),{},{velocity:dw(f.velocity,d[h].velocity,o),from:dw(f.from,d[h].from,o)}):f},a):e(n,d,o-1)};const B6e=function(e,n,a,o,d){var h=v6e(e,n),f=h.reduce(function(P,L){return Wi(Wi({},P),{},RD({},L,[e[L],n[L]]))},{}),y=h.reduce(function(P,L){return Wi(Wi({},P),{},RD({},L,{from:e[L],velocity:0,to:n[L]}))},{}),b=-1,x,T,S=function(){return null},N=function(){return Ny(function(L,F){return F.from},y)},O=function(){return!Object.values(y).filter(ID).length},A=function(L){x||(x=L);var F=L-x,V=F/a.dt;y=V6e(a,y,V),d(Wi(Wi(Wi({},e),n),N())),x=L,O()||(b=requestAnimationFrame(S))},I=function(L){T||(T=L);var F=(L-T)/o,V=Ny(function(B,z){return dw.apply(void 0,A9(z).concat([a(F)]))},f);if(d(Wi(Wi(Wi({},e),n),V)),F<1)b=requestAnimationFrame(S);else{var G=Ny(function(B,z){return dw.apply(void 0,A9(z).concat([a(1)]))},f);d(Wi(Wi(Wi({},e),n),G))}};return S=a.isStepper?A:I,function(){return requestAnimationFrame(S),function(){cancelAnimationFrame(b)}}};function Sf(e){"@babel/helpers - typeof";return Sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Sf(e)}var G6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function W6e(e,n){if(e==null)return{};var a=$6e(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function $6e(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,h;for(h=0;h<o.length;h++)d=o[h],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function h1(e){return Y6e(e)||K6e(e)||z6e(e)||H6e()}function H6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z6e(e,n){if(e){if(typeof e=="string")return OD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return OD(e,n)}}function K6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Y6e(e){if(Array.isArray(e))return OD(e)}function OD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function O9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Go(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?O9(Object(a),!0).forEach(function(o){uy(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function uy(e,n,a){return n=Vee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function q6e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function X6e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Vee(o.key),o)}}function J6e(e,n,a){return n&&X6e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Vee(e){var n=Q6e(e,"string");return Sf(n)==="symbol"?n:String(n)}function Q6e(e,n){if(Sf(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Sf(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Z6e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&PD(e,n)}function PD(e,n){return PD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},PD(e,n)}function e8e(e){var n=t8e();return function(){var o=uw(e),d;if(n){var h=uw(this).constructor;d=Reflect.construct(o,arguments,h)}else d=o.apply(this,arguments);return DD(this,d)}}function DD(e,n){if(n&&(Sf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kD(e)}function kD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function t8e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function uw(e){return uw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},uw(e)}var Wc=function(e){Z6e(a,e);var n=e8e(a);function a(o,d){var h;q6e(this,a),h=n.call(this,o,d);var f=h.props,y=f.isActive,b=f.attributeName,x=f.from,T=f.to,S=f.steps,N=f.children,O=f.duration;if(h.handleStyleChange=h.handleStyleChange.bind(kD(h)),h.changeStyle=h.changeStyle.bind(kD(h)),!y||O<=0)return h.state={style:{}},typeof N=="function"&&(h.state={style:T}),DD(h);if(S&&S.length)h.state={style:S[0].style};else if(x){if(typeof N=="function")return h.state={style:x},DD(h);h.state={style:b?uy({},b,x):x}}else h.state={style:{}};return h}return J6e(a,[{key:"componentDidMount",value:function(){var d=this.props,h=d.isActive,f=d.canBegin;this.mounted=!0,!(!h||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(d){var h=this.props,f=h.isActive,y=h.canBegin,b=h.attributeName,x=h.shouldReAnimate,T=h.to,S=h.from,N=this.state.style;if(y){if(!f){var O={style:b?uy({},b,T):T};this.state&&N&&(b&&N[b]!==T||!b&&N!==T)&&this.setState(O);return}if(!(o6e(d.to,T)&&d.canBegin&&d.isActive)){var A=!d.canBegin||!d.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var I=A||x?S:d.to;if(this.state&&N){var P={style:b?uy({},b,I):I};(b&&N[b]!==I||!b&&N!==I)&&this.setState(P)}this.runAnimation(Go(Go({},this.props),{},{from:I,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var d=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),d&&d()}},{key:"handleStyleChange",value:function(d){this.changeStyle(d)}},{key:"changeStyle",value:function(d){this.mounted&&this.setState({style:d})}},{key:"runJSAnimation",value:function(d){var h=this,f=d.from,y=d.to,b=d.duration,x=d.easing,T=d.begin,S=d.onAnimationEnd,N=d.onAnimationStart,O=B6e(f,y,I6e(x),b,this.changeStyle),A=function(){h.stopJSAnimation=O()};this.manager.start([N,T,A,b,S])}},{key:"runStepAnimation",value:function(d){var h=this,f=d.steps,y=d.begin,b=d.onAnimationStart,x=f[0],T=x.style,S=x.duration,N=S===void 0?0:S,O=function(I,P,L){if(L===0)return I;var F=P.duration,V=P.easing,G=V===void 0?"ease":V,B=P.style,z=P.properties,q=P.onAnimationEnd,Z=L>0?f[L-1]:P,ie=z||Object.keys(B);if(typeof G=="function"||G==="spring")return[].concat(h1(I),[h.runJSAnimation.bind(h,{from:Z.style,to:B,duration:F,easing:G}),F]);var ue=C9(ie,F,G),re=Go(Go(Go({},Z.style),B),{},{transition:ue});return[].concat(h1(I),[re,F,q]).filter(y6e)};return this.manager.start([b].concat(h1(f.reduce(O,[T,Math.max(N,y)])),[d.onAnimationEnd]))}},{key:"runAnimation",value:function(d){this.manager||(this.manager=m6e());var h=d.begin,f=d.duration,y=d.attributeName,b=d.to,x=d.easing,T=d.onAnimationStart,S=d.onAnimationEnd,N=d.steps,O=d.children,A=this.manager;if(this.unSubscribe=A.subscribe(this.handleStyleChange),typeof x=="function"||typeof O=="function"||x==="spring"){this.runJSAnimation(d);return}if(N.length>1){this.runStepAnimation(d);return}var I=y?uy({},y,b):b,P=C9(Object.keys(I),f,x);A.start([T,h,Go(Go({},I),{},{transition:P}),f,S])}},{key:"render",value:function(){var d=this.props,h=d.children;d.begin;var f=d.duration;d.attributeName,d.easing;var y=d.isActive;d.steps,d.from,d.to,d.canBegin,d.onAnimationEnd,d.shouldReAnimate,d.onAnimationReStart;var b=W6e(d,G6e),x=Y.Children.count(h),T=this.state.style;if(typeof h=="function")return h(T);if(!y||x===0||f<=0)return h;var S=function(O){var A=O.props,I=A.style,P=I===void 0?{}:I,L=A.className,F=Y.cloneElement(O,Go(Go({},b),{},{style:Go(Go({},P),T),className:L}));return F};return x===1?S(Y.Children.only(h)):ge.createElement("div",null,Y.Children.map(h,function(N){return S(N)}))}}]),a}(Y.PureComponent);Wc.displayName="Animate";Wc.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Wc.propTypes={from:Mt.oneOfType([Mt.object,Mt.string]),to:Mt.oneOfType([Mt.object,Mt.string]),attributeName:Mt.string,duration:Mt.number,begin:Mt.number,easing:Mt.oneOfType([Mt.string,Mt.func]),steps:Mt.arrayOf(Mt.shape({duration:Mt.number.isRequired,style:Mt.object.isRequired,easing:Mt.oneOfType([Mt.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Mt.func]),properties:Mt.arrayOf("string"),onAnimationEnd:Mt.func})),children:Mt.oneOfType([Mt.node,Mt.func]),isActive:Mt.bool,canBegin:Mt.bool,onAnimationEnd:Mt.func,shouldReAnimate:Mt.bool,onAnimationStart:Mt.func,onAnimationReStart:Mt.func};function S0(e){"@babel/helpers - typeof";return S0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},S0(e)}function hw(){return hw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},hw.apply(this,arguments)}function n8e(e,n){return s8e(e)||a8e(e,n)||i8e(e,n)||r8e()}function r8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i8e(e,n){if(e){if(typeof e=="string")return P9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P9(e,n)}}function P9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function a8e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function s8e(e){if(Array.isArray(e))return e}function D9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function k9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?D9(Object(a),!0).forEach(function(o){o8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function o8e(e,n,a){return n=c8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function c8e(e){var n=l8e(e,"string");return S0(n)=="symbol"?n:n+""}function l8e(e,n){if(S0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(S0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var j9=function(n,a,o,d,h){var f=Math.min(Math.abs(o)/2,Math.abs(d)/2),y=d>=0?1:-1,b=o>=0?1:-1,x=d>=0&&o>=0||d<0&&o<0?1:0,T;if(f>0&&h instanceof Array){for(var S=[0,0,0,0],N=0,O=4;N<O;N++)S[N]=h[N]>f?f:h[N];T="M".concat(n,",").concat(a+y*S[0]),S[0]>0&&(T+="A ".concat(S[0],",").concat(S[0],",0,0,").concat(x,",").concat(n+b*S[0],",").concat(a)),T+="L ".concat(n+o-b*S[1],",").concat(a),S[1]>0&&(T+="A ".concat(S[1],",").concat(S[1],",0,0,").concat(x,`,
        `).concat(n+o,",").concat(a+y*S[1])),T+="L ".concat(n+o,",").concat(a+d-y*S[2]),S[2]>0&&(T+="A ".concat(S[2],",").concat(S[2],",0,0,").concat(x,`,
        `).concat(n+o-b*S[2],",").concat(a+d)),T+="L ".concat(n+b*S[3],",").concat(a+d),S[3]>0&&(T+="A ".concat(S[3],",").concat(S[3],",0,0,").concat(x,`,
        `).concat(n,",").concat(a+d-y*S[3])),T+="Z"}else if(f>0&&h===+h&&h>0){var A=Math.min(f,h);T="M ".concat(n,",").concat(a+y*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(x,",").concat(n+b*A,",").concat(a,`
            L `).concat(n+o-b*A,",").concat(a,`
            A `).concat(A,",").concat(A,",0,0,").concat(x,",").concat(n+o,",").concat(a+y*A,`
            L `).concat(n+o,",").concat(a+d-y*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(x,",").concat(n+o-b*A,",").concat(a+d,`
            L `).concat(n+b*A,",").concat(a+d,`
            A `).concat(A,",").concat(A,",0,0,").concat(x,",").concat(n,",").concat(a+d-y*A," Z")}else T="M ".concat(n,",").concat(a," h ").concat(o," v ").concat(d," h ").concat(-o," Z");return T},d8e=function(n,a){if(!n||!a)return!1;var o=n.x,d=n.y,h=a.x,f=a.y,y=a.width,b=a.height;if(Math.abs(y)>0&&Math.abs(b)>0){var x=Math.min(h,h+y),T=Math.max(h,h+y),S=Math.min(f,f+b),N=Math.max(f,f+b);return o>=x&&o<=T&&d>=S&&d<=N}return!1},u8e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},gj=function(n){var a=k9(k9({},u8e),n),o=Y.useRef(),d=Y.useState(-1),h=n8e(d,2),f=h[0],y=h[1];Y.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var G=o.current.getTotalLength();G&&y(G)}catch{}},[]);var b=a.x,x=a.y,T=a.width,S=a.height,N=a.radius,O=a.className,A=a.animationEasing,I=a.animationDuration,P=a.animationBegin,L=a.isAnimationActive,F=a.isUpdateAnimationActive;if(b!==+b||x!==+x||T!==+T||S!==+S||T===0||S===0)return null;var V=An("recharts-rectangle",O);return F?ge.createElement(Wc,{canBegin:f>0,from:{width:T,height:S,x:b,y:x},to:{width:T,height:S,x:b,y:x},duration:I,animationEasing:A,isActive:F},function(G){var B=G.width,z=G.height,q=G.x,Z=G.y;return ge.createElement(Wc,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:P,duration:I,isActive:L,easing:A},ge.createElement("path",hw({},gn(a,!0),{className:V,d:j9(q,Z,B,z,N),ref:o})))}):ge.createElement("path",hw({},gn(a,!0),{className:V,d:j9(b,x,T,S,N)}))};function jD(){return jD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},jD.apply(this,arguments)}var UT=function(n){var a=n.cx,o=n.cy,d=n.r,h=n.className,f=An("recharts-dot",h);return a===+a&&o===+o&&d===+d?Y.createElement("circle",jD({},gn(n,!1),IS(n),{className:f,cx:a,cy:o,r:d})):null};function w0(e){"@babel/helpers - typeof";return w0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},w0(e)}var h8e=["x","y","top","left","width","height","className"];function LD(){return LD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},LD.apply(this,arguments)}function L9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function p8e(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?L9(Object(a),!0).forEach(function(o){m8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):L9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function m8e(e,n,a){return n=f8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function f8e(e){var n=g8e(e,"string");return w0(n)=="symbol"?n:n+""}function g8e(e,n){if(w0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(w0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function v8e(e,n){if(e==null)return{};var a=y8e(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function y8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var _8e=function(n,a,o,d,h,f){return"M".concat(n,",").concat(h,"v").concat(d,"M").concat(f,",").concat(a,"h").concat(o)},b8e=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,h=d===void 0?0:d,f=n.top,y=f===void 0?0:f,b=n.left,x=b===void 0?0:b,T=n.width,S=T===void 0?0:T,N=n.height,O=N===void 0?0:N,A=n.className,I=v8e(n,h8e),P=p8e({x:o,y:h,top:y,left:x,width:S,height:O},I);return!lt(o)||!lt(h)||!lt(S)||!lt(O)||!lt(y)||!lt(x)?null:ge.createElement("path",LD({},gn(P,!0),{className:An("recharts-cross",A),d:_8e(o,h,S,O,y,x)}))},x8e=eZ,E8e=x8e(Object.getPrototypeOf,Object),S8e=E8e,w8e=Wl,T8e=S8e,C8e=$l,N8e="[object Object]",R8e=Function.prototype,A8e=Object.prototype,Bee=R8e.toString,I8e=A8e.hasOwnProperty,O8e=Bee.call(Object);function P8e(e){if(!C8e(e)||w8e(e)!=N8e)return!1;var n=T8e(e);if(n===null)return!0;var a=I8e.call(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&Bee.call(a)==O8e}var D8e=P8e;const k8e=ar(D8e);var j8e=Wl,L8e=$l,M8e="[object Boolean]";function U8e(e){return e===!0||e===!1||L8e(e)&&j8e(e)==M8e}var F8e=U8e;const V8e=ar(F8e);function T0(e){"@babel/helpers - typeof";return T0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},T0(e)}function pw(){return pw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},pw.apply(this,arguments)}function B8e(e,n){return H8e(e)||$8e(e,n)||W8e(e,n)||G8e()}function G8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W8e(e,n){if(e){if(typeof e=="string")return M9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return M9(e,n)}}function M9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function $8e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function H8e(e){if(Array.isArray(e))return e}function U9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function F9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?U9(Object(a),!0).forEach(function(o){z8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function z8e(e,n,a){return n=K8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function K8e(e){var n=Y8e(e,"string");return T0(n)=="symbol"?n:n+""}function Y8e(e,n){if(T0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(T0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var V9=function(n,a,o,d,h){var f=o-d,y;return y="M ".concat(n,",").concat(a),y+="L ".concat(n+o,",").concat(a),y+="L ".concat(n+o-f/2,",").concat(a+h),y+="L ".concat(n+o-f/2-d,",").concat(a+h),y+="L ".concat(n,",").concat(a," Z"),y},q8e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},X8e=function(n){var a=F9(F9({},q8e),n),o=Y.useRef(),d=Y.useState(-1),h=B8e(d,2),f=h[0],y=h[1];Y.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var V=o.current.getTotalLength();V&&y(V)}catch{}},[]);var b=a.x,x=a.y,T=a.upperWidth,S=a.lowerWidth,N=a.height,O=a.className,A=a.animationEasing,I=a.animationDuration,P=a.animationBegin,L=a.isUpdateAnimationActive;if(b!==+b||x!==+x||T!==+T||S!==+S||N!==+N||T===0&&S===0||N===0)return null;var F=An("recharts-trapezoid",O);return L?ge.createElement(Wc,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:N,x:b,y:x},to:{upperWidth:T,lowerWidth:S,height:N,x:b,y:x},duration:I,animationEasing:A,isActive:L},function(V){var G=V.upperWidth,B=V.lowerWidth,z=V.height,q=V.x,Z=V.y;return ge.createElement(Wc,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:P,duration:I,easing:A},ge.createElement("path",pw({},gn(a,!0),{className:F,d:V9(q,Z,G,B,z),ref:o})))}):ge.createElement("g",null,ge.createElement("path",pw({},gn(a,!0),{className:F,d:V9(b,x,T,S,N)})))},J8e=["option","shapeType","propTransformer","activeClassName","isActive"];function C0(e){"@babel/helpers - typeof";return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},C0(e)}function Q8e(e,n){if(e==null)return{};var a=Z8e(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Z8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function B9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function mw(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?B9(Object(a),!0).forEach(function(o){eGe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):B9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function eGe(e,n,a){return n=tGe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function tGe(e){var n=nGe(e,"string");return C0(n)=="symbol"?n:n+""}function nGe(e,n){if(C0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(C0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function rGe(e,n){return mw(mw({},n),e)}function iGe(e,n){return e==="symbols"}function G9(e){var n=e.shapeType,a=e.elementProps;switch(n){case"rectangle":return ge.createElement(gj,a);case"trapezoid":return ge.createElement(X8e,a);case"sector":return ge.createElement(Iee,a);case"symbols":if(iGe(n))return ge.createElement(jk,a);break;default:return null}}function aGe(e){return Y.isValidElement(e)?e.props:e}function sGe(e){var n=e.option,a=e.shapeType,o=e.propTransformer,d=o===void 0?rGe:o,h=e.activeClassName,f=h===void 0?"recharts-active-shape":h,y=e.isActive,b=Q8e(e,J8e),x;if(Y.isValidElement(n))x=Y.cloneElement(n,mw(mw({},b),aGe(n)));else if(un(n))x=n(b);else if(k8e(n)&&!V8e(n)){var T=d(n,b);x=ge.createElement(G9,{shapeType:a,elementProps:T})}else{var S=b;x=ge.createElement(G9,{shapeType:a,elementProps:S})}return y?ge.createElement(mr,{className:f},x):x}function FT(e,n){return n!=null&&"trapezoids"in e.props}function VT(e,n){return n!=null&&"sectors"in e.props}function N0(e,n){return n!=null&&"points"in e.props}function oGe(e,n){var a,o,d=e.x===(n==null||(a=n.labelViewBox)===null||a===void 0?void 0:a.x)||e.x===n.x,h=e.y===(n==null||(o=n.labelViewBox)===null||o===void 0?void 0:o.y)||e.y===n.y;return d&&h}function cGe(e,n){var a=e.endAngle===n.endAngle,o=e.startAngle===n.startAngle;return a&&o}function lGe(e,n){var a=e.x===n.x,o=e.y===n.y,d=e.z===n.z;return a&&o&&d}function dGe(e,n){var a;return FT(e,n)?a=oGe:VT(e,n)?a=cGe:N0(e,n)&&(a=lGe),a}function uGe(e,n){var a;return FT(e,n)?a="trapezoids":VT(e,n)?a="sectors":N0(e,n)&&(a="points"),a}function hGe(e,n){if(FT(e,n)){var a;return(a=n.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}if(VT(e,n)){var o;return(o=n.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}return N0(e,n)?n.payload:{}}function pGe(e){var n=e.activeTooltipItem,a=e.graphicalItem,o=e.itemData,d=uGe(a,n),h=hGe(a,n),f=o.filter(function(b,x){var T=xf(h,b),S=a.props[d].filter(function(A){var I=dGe(a,n);return I(A,n)}),N=a.props[d].indexOf(S[S.length-1]),O=x===N;return T&&O}),y=o.indexOf(f[f.length-1]);return y}var mGe=Math.ceil,fGe=Math.max;function gGe(e,n,a,o){for(var d=-1,h=fGe(mGe((n-e)/(a||1)),0),f=Array(h);h--;)f[o?h:++d]=e,e+=a;return f}var vGe=gGe,yGe=_Z,W9=1/0,_Ge=17976931348623157e292;function bGe(e){if(!e)return e===0?e:0;if(e=yGe(e),e===W9||e===-W9){var n=e<0?-1:1;return n*_Ge}return e===e?e:0}var Gee=bGe,xGe=vGe,EGe=RT,p1=Gee;function SGe(e){return function(n,a,o){return o&&typeof o!="number"&&EGe(n,a,o)&&(a=o=void 0),n=p1(n),a===void 0?(a=n,n=0):a=p1(a),o=o===void 0?n<a?1:-1:p1(o),xGe(n,a,o,e)}}var wGe=SGe,TGe=wGe,CGe=TGe(),NGe=CGe;const fw=ar(NGe);function R0(e){"@babel/helpers - typeof";return R0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},R0(e)}function $9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function H9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$9(Object(a),!0).forEach(function(o){Wee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Wee(e,n,a){return n=RGe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function RGe(e){var n=AGe(e,"string");return R0(n)=="symbol"?n:n+""}function AGe(e,n){if(R0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(R0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var IGe=["Webkit","Moz","O","ms"],OGe=function(n,a){var o=n.replace(/(\w)/,function(h){return h.toUpperCase()}),d=IGe.reduce(function(h,f){return H9(H9({},h),{},Wee({},f+o,a))},{});return d[n]=a,d};function wf(e){"@babel/helpers - typeof";return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wf(e)}function gw(){return gw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},gw.apply(this,arguments)}function z9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function m1(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?z9(Object(a),!0).forEach(function(o){_s(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function PGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function K9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Hee(o.key),o)}}function DGe(e,n,a){return n&&K9(e.prototype,n),a&&K9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function kGe(e,n,a){return n=vw(n),jGe(e,$ee()?Reflect.construct(n,a||[],vw(e).constructor):n.apply(e,a))}function jGe(e,n){if(n&&(wf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LGe(e)}function LGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($ee=function(){return!!e})()}function vw(e){return vw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},vw(e)}function MGe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&MD(e,n)}function MD(e,n){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},MD(e,n)}function _s(e,n,a){return n=Hee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Hee(e){var n=UGe(e,"string");return wf(n)=="symbol"?n:n+""}function UGe(e,n){if(wf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(wf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var FGe=function(n){var a=n.data,o=n.startIndex,d=n.endIndex,h=n.x,f=n.width,y=n.travellerWidth;if(!a||!a.length)return{};var b=a.length,x=Ty().domain(fw(0,b)).range([h,h+f-y]),T=x.domain().map(function(S){return x(S)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:x(o),endX:x(d),scale:x,scaleValues:T}},Y9=function(n){return n.changedTouches&&!!n.changedTouches.length},Tf=function(e){function n(a){var o;return PGe(this,n),o=kGe(this,n,[a]),_s(o,"handleDrag",function(d){o.leaveTimer&&(clearTimeout(o.leaveTimer),o.leaveTimer=null),o.state.isTravellerMoving?o.handleTravellerMove(d):o.state.isSlideMoving&&o.handleSlideDrag(d)}),_s(o,"handleTouchMove",function(d){d.changedTouches!=null&&d.changedTouches.length>0&&o.handleDrag(d.changedTouches[0])}),_s(o,"handleDragEnd",function(){o.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var d=o.props,h=d.endIndex,f=d.onDragEnd,y=d.startIndex;f==null||f({endIndex:h,startIndex:y})}),o.detachDragEndListener()}),_s(o,"handleLeaveWrapper",function(){(o.state.isTravellerMoving||o.state.isSlideMoving)&&(o.leaveTimer=window.setTimeout(o.handleDragEnd,o.props.leaveTimeOut))}),_s(o,"handleEnterSlideOrTraveller",function(){o.setState({isTextActive:!0})}),_s(o,"handleLeaveSlideOrTraveller",function(){o.setState({isTextActive:!1})}),_s(o,"handleSlideDragStart",function(d){var h=Y9(d)?d.changedTouches[0]:d;o.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:h.pageX}),o.attachDragEndListener()}),o.travellerDragStartHandlers={startX:o.handleTravellerDragStart.bind(o,"startX"),endX:o.handleTravellerDragStart.bind(o,"endX")},o.state={},o}return MGe(n,e),DGe(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(o){var d=o.startX,h=o.endX,f=this.state.scaleValues,y=this.props,b=y.gap,x=y.data,T=x.length-1,S=Math.min(d,h),N=Math.max(d,h),O=n.getIndexInRange(f,S),A=n.getIndexInRange(f,N);return{startIndex:O-O%b,endIndex:A===T?T:A-A%b}}},{key:"getTextOfTick",value:function(o){var d=this.props,h=d.data,f=d.tickFormatter,y=d.dataKey,b=Ra(h[o],y,o);return un(f)?f(b,o):b}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(o){var d=this.state,h=d.slideMoveStartX,f=d.startX,y=d.endX,b=this.props,x=b.x,T=b.width,S=b.travellerWidth,N=b.startIndex,O=b.endIndex,A=b.onChange,I=o.pageX-h;I>0?I=Math.min(I,x+T-S-y,x+T-S-f):I<0&&(I=Math.max(I,x-f,x-y));var P=this.getIndex({startX:f+I,endX:y+I});(P.startIndex!==N||P.endIndex!==O)&&A&&A(P),this.setState({startX:f+I,endX:y+I,slideMoveStartX:o.pageX})}},{key:"handleTravellerDragStart",value:function(o,d){var h=Y9(d)?d.changedTouches[0]:d;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:o,brushMoveStartX:h.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(o){var d=this.state,h=d.brushMoveStartX,f=d.movingTravellerId,y=d.endX,b=d.startX,x=this.state[f],T=this.props,S=T.x,N=T.width,O=T.travellerWidth,A=T.onChange,I=T.gap,P=T.data,L={startX:this.state.startX,endX:this.state.endX},F=o.pageX-h;F>0?F=Math.min(F,S+N-O-x):F<0&&(F=Math.max(F,S-x)),L[f]=x+F;var V=this.getIndex(L),G=V.startIndex,B=V.endIndex,z=function(){var Z=P.length-1;return f==="startX"&&(y>b?G%I===0:B%I===0)||y<b&&B===Z||f==="endX"&&(y>b?B%I===0:G%I===0)||y>b&&B===Z};this.setState(_s(_s({},f,x+F),"brushMoveStartX",o.pageX),function(){A&&z()&&A(V)})}},{key:"handleTravellerMoveKeyboard",value:function(o,d){var h=this,f=this.state,y=f.scaleValues,b=f.startX,x=f.endX,T=this.state[d],S=y.indexOf(T);if(S!==-1){var N=S+o;if(!(N===-1||N>=y.length)){var O=y[N];d==="startX"&&O>=x||d==="endX"&&O<=b||this.setState(_s({},d,O),function(){h.props.onChange(h.getIndex({startX:h.state.startX,endX:h.state.endX}))})}}}},{key:"renderBackground",value:function(){var o=this.props,d=o.x,h=o.y,f=o.width,y=o.height,b=o.fill,x=o.stroke;return ge.createElement("rect",{stroke:x,fill:b,x:d,y:h,width:f,height:y})}},{key:"renderPanorama",value:function(){var o=this.props,d=o.x,h=o.y,f=o.width,y=o.height,b=o.data,x=o.children,T=o.padding,S=Y.Children.only(x);return S?ge.cloneElement(S,{x:d,y:h,width:f,height:y,margin:T,compact:!0,data:b}):null}},{key:"renderTravellerLayer",value:function(o,d){var h,f,y=this,b=this.props,x=b.y,T=b.travellerWidth,S=b.height,N=b.traveller,O=b.ariaLabel,A=b.data,I=b.startIndex,P=b.endIndex,L=Math.max(o,this.props.x),F=m1(m1({},gn(this.props,!1)),{},{x:L,y:x,width:T,height:S}),V=O||"Min value: ".concat((h=A[I])===null||h===void 0?void 0:h.name,", Max value: ").concat((f=A[P])===null||f===void 0?void 0:f.name);return ge.createElement(mr,{tabIndex:0,role:"slider","aria-label":V,"aria-valuenow":o,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[d],onTouchStart:this.travellerDragStartHandlers[d],onKeyDown:function(B){["ArrowLeft","ArrowRight"].includes(B.key)&&(B.preventDefault(),B.stopPropagation(),y.handleTravellerMoveKeyboard(B.key==="ArrowRight"?1:-1,d))},onFocus:function(){y.setState({isTravellerFocused:!0})},onBlur:function(){y.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(N,F))}},{key:"renderSlide",value:function(o,d){var h=this.props,f=h.y,y=h.height,b=h.stroke,x=h.travellerWidth,T=Math.min(o,d)+x,S=Math.max(Math.abs(d-o)-x,0);return ge.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:b,fillOpacity:.2,x:T,y:f,width:S,height:y})}},{key:"renderText",value:function(){var o=this.props,d=o.startIndex,h=o.endIndex,f=o.y,y=o.height,b=o.travellerWidth,x=o.stroke,T=this.state,S=T.startX,N=T.endX,O=5,A={pointerEvents:"none",fill:x};return ge.createElement(mr,{className:"recharts-brush-texts"},ge.createElement(HS,gw({textAnchor:"end",verticalAnchor:"middle",x:Math.min(S,N)-O,y:f+y/2},A),this.getTextOfTick(d)),ge.createElement(HS,gw({textAnchor:"start",verticalAnchor:"middle",x:Math.max(S,N)+b+O,y:f+y/2},A),this.getTextOfTick(h)))}},{key:"render",value:function(){var o=this.props,d=o.data,h=o.className,f=o.children,y=o.x,b=o.y,x=o.width,T=o.height,S=o.alwaysShowText,N=this.state,O=N.startX,A=N.endX,I=N.isTextActive,P=N.isSlideMoving,L=N.isTravellerMoving,F=N.isTravellerFocused;if(!d||!d.length||!lt(y)||!lt(b)||!lt(x)||!lt(T)||x<=0||T<=0)return null;var V=An("recharts-brush",h),G=ge.Children.count(f)===1,B=OGe("userSelect","none");return ge.createElement(mr,{className:V,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:B},this.renderBackground(),G&&this.renderPanorama(),this.renderSlide(O,A),this.renderTravellerLayer(O,"startX"),this.renderTravellerLayer(A,"endX"),(I||P||L||F||S)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(o){var d=o.x,h=o.y,f=o.width,y=o.height,b=o.stroke,x=Math.floor(h+y/2)-1;return ge.createElement(ge.Fragment,null,ge.createElement("rect",{x:d,y:h,width:f,height:y,fill:b,stroke:"none"}),ge.createElement("line",{x1:d+1,y1:x,x2:d+f-1,y2:x,fill:"none",stroke:"#fff"}),ge.createElement("line",{x1:d+1,y1:x+2,x2:d+f-1,y2:x+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(o,d){var h;return ge.isValidElement(o)?h=ge.cloneElement(o,d):un(o)?h=o(d):h=n.renderDefaultTraveller(d),h}},{key:"getDerivedStateFromProps",value:function(o,d){var h=o.data,f=o.width,y=o.x,b=o.travellerWidth,x=o.updateId,T=o.startIndex,S=o.endIndex;if(h!==d.prevData||x!==d.prevUpdateId)return m1({prevData:h,prevTravellerWidth:b,prevUpdateId:x,prevX:y,prevWidth:f},h&&h.length?FGe({data:h,width:f,x:y,travellerWidth:b,startIndex:T,endIndex:S}):{scale:null,scaleValues:null});if(d.scale&&(f!==d.prevWidth||y!==d.prevX||b!==d.prevTravellerWidth)){d.scale.range([y,y+f-b]);var N=d.scale.domain().map(function(O){return d.scale(O)});return{prevData:h,prevTravellerWidth:b,prevUpdateId:x,prevX:y,prevWidth:f,startX:d.scale(o.startIndex),endX:d.scale(o.endIndex),scaleValues:N}}return null}},{key:"getIndexInRange",value:function(o,d){for(var h=o.length,f=0,y=h-1;y-f>1;){var b=Math.floor((f+y)/2);o[b]>d?y=b:f=b}return d>=o[y]?y:f}}])}(Y.PureComponent);_s(Tf,"displayName","Brush");_s(Tf,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var VGe=Gk;function BGe(e,n){var a;return VGe(e,function(o,d,h){return a=n(o,d,h),!a}),!!a}var GGe=BGe,WGe=zQ,$Ge=cu,HGe=GGe,zGe=rs,KGe=RT;function YGe(e,n,a){var o=zGe(e)?WGe:HGe;return a&&KGe(e,n,a)&&(n=void 0),o(e,$Ge(n))}var qGe=YGe;const XGe=ar(qGe);var Vc=function(n,a){var o=n.alwaysShow,d=n.ifOverflow;return o&&(d="extendDomain"),d===a},q9=mZ;function JGe(e,n,a){n=="__proto__"&&q9?q9(e,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[n]=a}var QGe=JGe,ZGe=QGe,eWe=hZ,tWe=cu;function nWe(e,n){var a={};return n=tWe(n),eWe(e,function(o,d,h){ZGe(a,d,n(o,d,h))}),a}var rWe=nWe;const iWe=ar(rWe);function aWe(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(!n(e[a],a,e))return!1;return!0}var sWe=aWe,oWe=Gk;function cWe(e,n){var a=!0;return oWe(e,function(o,d,h){return a=!!n(o,d,h),a}),a}var lWe=cWe,dWe=sWe,uWe=lWe,hWe=cu,pWe=rs,mWe=RT;function fWe(e,n,a){var o=pWe(e)?dWe:uWe;return a&&mWe(e,n,a)&&(n=void 0),o(e,hWe(n))}var gWe=fWe;const zee=ar(gWe);var vWe=["x","y"];function A0(e){"@babel/helpers - typeof";return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},A0(e)}function UD(){return UD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},UD.apply(this,arguments)}function X9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ry(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?X9(Object(a),!0).forEach(function(o){yWe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function yWe(e,n,a){return n=_We(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function _We(e){var n=bWe(e,"string");return A0(n)=="symbol"?n:n+""}function bWe(e,n){if(A0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(A0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function xWe(e,n){if(e==null)return{};var a=EWe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function EWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function SWe(e,n){var a=e.x,o=e.y,d=xWe(e,vWe),h="".concat(a),f=parseInt(h,10),y="".concat(o),b=parseInt(y,10),x="".concat(n.height||d.height),T=parseInt(x,10),S="".concat(n.width||d.width),N=parseInt(S,10);return ry(ry(ry(ry(ry({},n),d),f?{x:f}:{}),b?{y:b}:{}),{},{height:T,width:N,name:n.name,radius:n.radius})}function J9(e){return ge.createElement(sGe,UD({shapeType:"rectangle",propTransformer:SWe,activeClassName:"recharts-active-bar"},e))}var wWe=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(o,d){if(typeof n=="number")return n;var h=lt(o)||BAe(o);return h?n(o,d):(h||Vh(),a)}},TWe=["value","background"],Kee;function Cf(e){"@babel/helpers - typeof";return Cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cf(e)}function CWe(e,n){if(e==null)return{};var a=NWe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function NWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function yw(){return yw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},yw.apply(this,arguments)}function Q9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function si(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Q9(Object(a),!0).forEach(function(o){Vd(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function RWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Z9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,qee(o.key),o)}}function AWe(e,n,a){return n&&Z9(e.prototype,n),a&&Z9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function IWe(e,n,a){return n=_w(n),OWe(e,Yee()?Reflect.construct(n,a||[],_w(e).constructor):n.apply(e,a))}function OWe(e,n){if(n&&(Cf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PWe(e)}function PWe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yee=function(){return!!e})()}function _w(e){return _w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_w(e)}function DWe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&FD(e,n)}function FD(e,n){return FD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},FD(e,n)}function Vd(e,n,a){return n=qee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function qee(e){var n=kWe(e,"string");return Cf(n)=="symbol"?n:n+""}function kWe(e,n){if(Cf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Cf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var t_=function(e){function n(){var a;RWe(this,n);for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];return a=IWe(this,n,[].concat(d)),Vd(a,"state",{isAnimationFinished:!1}),Vd(a,"id",eg("recharts-bar-")),Vd(a,"handleAnimationEnd",function(){var f=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),f&&f()}),Vd(a,"handleAnimationStart",function(){var f=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),f&&f()}),a}return DWe(n,e),AWe(n,[{key:"renderRectanglesStatically",value:function(o){var d=this,h=this.props,f=h.shape,y=h.dataKey,b=h.activeIndex,x=h.activeBar,T=gn(this.props,!1);return o&&o.map(function(S,N){var O=N===b,A=O?x:f,I=si(si(si({},T),S),{},{isActive:O,option:A,index:N,dataKey:y,onAnimationStart:d.handleAnimationStart,onAnimationEnd:d.handleAnimationEnd});return ge.createElement(mr,yw({className:"recharts-bar-rectangle"},OS(d.props,S,N),{key:"rectangle-".concat(S==null?void 0:S.x,"-").concat(S==null?void 0:S.y,"-").concat(S==null?void 0:S.value,"-").concat(N)}),ge.createElement(J9,I))})}},{key:"renderRectanglesWithAnimation",value:function(){var o=this,d=this.props,h=d.data,f=d.layout,y=d.isAnimationActive,b=d.animationBegin,x=d.animationDuration,T=d.animationEasing,S=d.animationId,N=this.state.prevData;return ge.createElement(Wc,{begin:b,duration:x,isActive:y,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(S),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(O){var A=O.t,I=h.map(function(P,L){var F=N&&N[L];if(F){var V=Hi(F.x,P.x),G=Hi(F.y,P.y),B=Hi(F.width,P.width),z=Hi(F.height,P.height);return si(si({},P),{},{x:V(A),y:G(A),width:B(A),height:z(A)})}if(f==="horizontal"){var q=Hi(0,P.height),Z=q(A);return si(si({},P),{},{y:P.y+P.height-Z,height:Z})}var ie=Hi(0,P.width),ue=ie(A);return si(si({},P),{},{width:ue})});return ge.createElement(mr,null,o.renderRectanglesStatically(I))})}},{key:"renderRectangles",value:function(){var o=this.props,d=o.data,h=o.isAnimationActive,f=this.state.prevData;return h&&d&&d.length&&(!f||!xf(f,d))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(d)}},{key:"renderBackground",value:function(){var o=this,d=this.props,h=d.data,f=d.dataKey,y=d.activeIndex,b=gn(this.props.background,!1);return h.map(function(x,T){x.value;var S=x.background,N=CWe(x,TWe);if(!S)return null;var O=si(si(si(si(si({},N),{},{fill:"#eee"},S),b),OS(o.props,x,T)),{},{onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd,dataKey:f,index:T,className:"recharts-bar-background-rectangle"});return ge.createElement(J9,yw({key:"background-bar-".concat(T),option:o.props.background,isActive:T===y},O))})}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var h=this.props,f=h.data,y=h.xAxis,b=h.yAxis,x=h.layout,T=h.children,S=uo(T,e_);if(!S)return null;var N=x==="vertical"?f[0].height/2:f[0].width/2,O=function(P,L){var F=Array.isArray(P.value)?P.value[1]:P.value;return{x:P.x,y:P.y,value:F,errorVal:Ra(P,L)}},A={clipPath:o?"url(#clipPath-".concat(d,")"):null};return ge.createElement(mr,A,S.map(function(I){return ge.cloneElement(I,{key:"error-bar-".concat(d,"-").concat(I.props.dataKey),data:f,xAxis:y,yAxis:b,layout:x,offset:N,dataPointFormatter:O})}))}},{key:"render",value:function(){var o=this.props,d=o.hide,h=o.data,f=o.className,y=o.xAxis,b=o.yAxis,x=o.left,T=o.top,S=o.width,N=o.height,O=o.isAnimationActive,A=o.background,I=o.id;if(d||!h||!h.length)return null;var P=this.state.isAnimationFinished,L=An("recharts-bar",f),F=y&&y.allowDataOverflow,V=b&&b.allowDataOverflow,G=F||V,B=yn(I)?this.id:I;return ge.createElement(mr,{className:L},F||V?ge.createElement("defs",null,ge.createElement("clipPath",{id:"clipPath-".concat(B)},ge.createElement("rect",{x:F?x:x-S/2,y:V?T:T-N/2,width:F?S:S*2,height:V?N:N*2}))):null,ge.createElement(mr,{className:"recharts-bar-rectangles",clipPath:G?"url(#clipPath-".concat(B,")"):null},A?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(G,B),(!O||P)&&Cl.renderCallByParent(this.props,h))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curData:o.data,prevData:d.curData}:o.data!==d.curData?{curData:o.data}:null}}])}(Y.PureComponent);Kee=t_;Vd(t_,"displayName","Bar");Vd(t_,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Vd(t_,"getComposedData",function(e){var n=e.props,a=e.item,o=e.barPosition,d=e.bandSize,h=e.xAxis,f=e.yAxis,y=e.xAxisTicks,b=e.yAxisTicks,x=e.stackedData,T=e.dataStartIndex,S=e.displayedData,N=e.offset,O=lVe(o,a);if(!O)return null;var A=n.layout,I=a.type.defaultProps,P=I!==void 0?si(si({},I),a.props):a.props,L=P.dataKey,F=P.children,V=P.minPointSize,G=A==="horizontal"?f:h,B=x?G.scale.domain():null,z=vVe({numericAxis:G}),q=uo(F,xZ),Z=S.map(function(ie,ue){var re,pe,Se,fe,be,se;x?re=dVe(x[T+ue],B):(re=Ra(ie,L),Array.isArray(re)||(re=[z,re]));var he=wWe(V,Kee.defaultProps.minPointSize)(re[1],ue);if(A==="horizontal"){var Q,le=[f.scale(re[0]),f.scale(re[1])],we=le[0],Ue=le[1];pe=QK({axis:h,ticks:y,bandSize:d,offset:O.offset,entry:ie,index:ue}),Se=(Q=Ue??we)!==null&&Q!==void 0?Q:void 0,fe=O.size;var Le=we-Ue;if(be=Number.isNaN(Le)?0:Le,se={x:pe,y:f.y,width:fe,height:f.height},Math.abs(he)>0&&Math.abs(be)<Math.abs(he)){var tt=Xo(be||he)*(Math.abs(he)-Math.abs(be));Se-=tt,be+=tt}}else{var Te=[h.scale(re[0]),h.scale(re[1])],De=Te[0],qe=Te[1];if(pe=De,Se=QK({axis:f,ticks:b,bandSize:d,offset:O.offset,entry:ie,index:ue}),fe=qe-De,be=O.size,se={x:h.x,y:Se,width:h.width,height:be},Math.abs(he)>0&&Math.abs(fe)<Math.abs(he)){var It=Xo(fe||he)*(Math.abs(he)-Math.abs(fe));fe+=It}}return si(si(si({},ie),{},{x:pe,y:Se,width:fe,height:be,value:x?re:re[1],payload:ie,background:se},q&&q[ue]&&q[ue].props),{},{tooltipPayload:[Nee(a,ie)],tooltipPosition:{x:pe+fe/2,y:Se+be/2}})});return si({data:Z,layout:A},N)});function I0(e){"@babel/helpers - typeof";return I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},I0(e)}function jWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function eY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Xee(o.key),o)}}function LWe(e,n,a){return n&&eY(e.prototype,n),a&&eY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function tY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function zo(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?tY(Object(a),!0).forEach(function(o){BT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function BT(e,n,a){return n=Xee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Xee(e){var n=MWe(e,"string");return I0(n)=="symbol"?n:n+""}function MWe(e,n){if(I0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(I0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Jee=function(n,a,o,d,h){var f=n.width,y=n.height,b=n.layout,x=n.children,T=Object.keys(a),S={left:o.left,leftMirror:o.left,right:f-o.right,rightMirror:f-o.right,top:o.top,topMirror:o.top,bottom:y-o.bottom,bottomMirror:y-o.bottom},N=!!xs(x,t_);return T.reduce(function(O,A){var I=a[A],P=I.orientation,L=I.domain,F=I.padding,V=F===void 0?{}:F,G=I.mirror,B=I.reversed,z="".concat(P).concat(G?"Mirror":""),q,Z,ie,ue,re;if(I.type==="number"&&(I.padding==="gap"||I.padding==="no-gap")){var pe=L[1]-L[0],Se=1/0,fe=I.categoricalDomain.sort($Ae);if(fe.forEach(function(Te,De){De>0&&(Se=Math.min((Te||0)-(fe[De-1]||0),Se))}),Number.isFinite(Se)){var be=Se/pe,se=I.layout==="vertical"?o.height:o.width;if(I.padding==="gap"&&(q=be*se/2),I.padding==="no-gap"){var he=Uh(n.barCategoryGap,be*se),Q=be*se/2;q=Q-he-(Q-he)/se*he}}}d==="xAxis"?Z=[o.left+(V.left||0)+(q||0),o.left+o.width-(V.right||0)-(q||0)]:d==="yAxis"?Z=b==="horizontal"?[o.top+o.height-(V.bottom||0),o.top+(V.top||0)]:[o.top+(V.top||0)+(q||0),o.top+o.height-(V.bottom||0)-(q||0)]:Z=I.range,B&&(Z=[Z[1],Z[0]]);var le=oVe(I,h,N),we=le.scale,Ue=le.realScaleType;we.domain(L).range(Z),cVe(we);var Le=gVe(we,zo(zo({},I),{},{realScaleType:Ue}));d==="xAxis"?(re=P==="top"&&!G||P==="bottom"&&G,ie=o.left,ue=S[z]-re*I.height):d==="yAxis"&&(re=P==="left"&&!G||P==="right"&&G,ie=S[z]-re*I.width,ue=o.top);var tt=zo(zo(zo({},I),Le),{},{realScaleType:Ue,x:ie,y:ue,scale:we,width:d==="xAxis"?o.width:I.width,height:d==="yAxis"?o.height:I.height});return tt.bandSize=sw(tt,Le),!I.hide&&d==="xAxis"?S[z]+=(re?-1:1)*tt.height:I.hide||(S[z]+=(re?-1:1)*tt.width),zo(zo({},O),{},BT({},A,tt))},{})},Qee=function(n,a){var o=n.x,d=n.y,h=a.x,f=a.y;return{x:Math.min(o,h),y:Math.min(d,f),width:Math.abs(h-o),height:Math.abs(f-d)}},UWe=function(n){var a=n.x1,o=n.y1,d=n.x2,h=n.y2;return Qee({x:a,y:o},{x:d,y:h})},Zee=function(){function e(n){jWe(this,e),this.scale=n}return LWe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.bandAware,h=o.position;if(a!==void 0){if(h)switch(h){case"start":return this.scale(a);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+f}case"end":{var y=this.bandwidth?this.bandwidth():0;return this.scale(a)+y}default:return this.scale(a)}if(d){var b=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+b}return this.scale(a)}}},{key:"isInRange",value:function(a){var o=this.range(),d=o[0],h=o[o.length-1];return d<=h?a>=d&&a<=h:a>=h&&a<=d}}],[{key:"create",value:function(a){return new e(a)}}])}();BT(Zee,"EPS",1e-4);var vj=function(n){var a=Object.keys(n).reduce(function(o,d){return zo(zo({},o),{},BT({},d,Zee.create(n[d])))},{});return zo(zo({},a),{},{apply:function(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=h.bandAware,y=h.position;return iWe(d,function(b,x){return a[x].apply(b,{bandAware:f,position:y})})},isInRange:function(d){return zee(d,function(h,f){return a[f].isInRange(h)})}})};function FWe(e){return(e%180+180)%180}var VWe=function(n){var a=n.width,o=n.height,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=FWe(d),f=h*Math.PI/180,y=Math.atan(o/a),b=f>y&&f<Math.PI-y?o/Math.sin(f):a/Math.cos(f);return Math.abs(b)},BWe=cu,GWe=q0,WWe=CT;function $We(e){return function(n,a,o){var d=Object(n);if(!GWe(n)){var h=BWe(a);n=WWe(n),a=function(y){return h(d[y],y,d)}}var f=e(n,a,o);return f>-1?d[h?n[f]:f]:void 0}}var HWe=$We,zWe=Gee;function KWe(e){var n=zWe(e),a=n%1;return n===n?a?n-a:n:0}var YWe=KWe,qWe=sZ,XWe=cu,JWe=YWe,QWe=Math.max;function ZWe(e,n,a){var o=e==null?0:e.length;if(!o)return-1;var d=a==null?0:JWe(a);return d<0&&(d=QWe(o+d,0)),qWe(e,XWe(n),d)}var e$e=ZWe,t$e=HWe,n$e=e$e,r$e=t$e(n$e),i$e=r$e;const a$e=ar(i$e);var s$e=KRe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),yj=Y.createContext(void 0),_j=Y.createContext(void 0),ete=Y.createContext(void 0),tte=Y.createContext({}),nte=Y.createContext(void 0),rte=Y.createContext(0),ite=Y.createContext(0),nY=function(n){var a=n.state,o=a.xAxisMap,d=a.yAxisMap,h=a.offset,f=n.clipPathId,y=n.children,b=n.width,x=n.height,T=s$e(h);return ge.createElement(yj.Provider,{value:o},ge.createElement(_j.Provider,{value:d},ge.createElement(tte.Provider,{value:h},ge.createElement(ete.Provider,{value:T},ge.createElement(nte.Provider,{value:f},ge.createElement(rte.Provider,{value:x},ge.createElement(ite.Provider,{value:b},y)))))))},o$e=function(){return Y.useContext(nte)},ate=function(n){var a=Y.useContext(yj);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},c$e=function(){var n=Y.useContext(yj);return kd(n)},l$e=function(){var n=Y.useContext(_j),a=a$e(n,function(o){return zee(o.domain,Number.isFinite)});return a||kd(n)},ste=function(n){var a=Y.useContext(_j);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},d$e=function(){var n=Y.useContext(ete);return n},u$e=function(){return Y.useContext(tte)},bj=function(){return Y.useContext(ite)},xj=function(){return Y.useContext(rte)};function Nf(e){"@babel/helpers - typeof";return Nf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Nf(e)}function h$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function p$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,cte(o.key),o)}}function m$e(e,n,a){return n&&p$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f$e(e,n,a){return n=bw(n),g$e(e,ote()?Reflect.construct(n,a||[],bw(e).constructor):n.apply(e,a))}function g$e(e,n){if(n&&(Nf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v$e(e)}function v$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ote(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ote=function(){return!!e})()}function bw(e){return bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},bw(e)}function y$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&VD(e,n)}function VD(e,n){return VD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},VD(e,n)}function rY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function iY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?rY(Object(a),!0).forEach(function(o){Ej(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Ej(e,n,a){return n=cte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function cte(e){var n=_$e(e,"string");return Nf(n)=="symbol"?n:n+""}function _$e(e,n){if(Nf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Nf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function b$e(e,n){return w$e(e)||S$e(e,n)||E$e(e,n)||x$e()}function x$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E$e(e,n){if(e){if(typeof e=="string")return aY(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aY(e,n)}}function aY(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function S$e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function w$e(e){if(Array.isArray(e))return e}function BD(){return BD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},BD.apply(this,arguments)}var T$e=function(n,a){var o;return ge.isValidElement(n)?o=ge.cloneElement(n,a):un(n)?o=n(a):o=ge.createElement("line",BD({},a,{className:"recharts-reference-line-line"})),o},C$e=function(n,a,o,d,h,f,y,b,x){var T=h.x,S=h.y,N=h.width,O=h.height;if(o){var A=x.y,I=n.y.apply(A,{position:f});if(Vc(x,"discard")&&!n.y.isInRange(I))return null;var P=[{x:T+N,y:I},{x:T,y:I}];return b==="left"?P.reverse():P}if(a){var L=x.x,F=n.x.apply(L,{position:f});if(Vc(x,"discard")&&!n.x.isInRange(F))return null;var V=[{x:F,y:S+O},{x:F,y:S}];return y==="top"?V.reverse():V}if(d){var G=x.segment,B=G.map(function(z){return n.apply(z,{position:f})});return Vc(x,"discard")&&XGe(B,function(z){return!n.isInRange(z)})?null:B}return null};function N$e(e){var n=e.x,a=e.y,o=e.segment,d=e.xAxisId,h=e.yAxisId,f=e.shape,y=e.className,b=e.alwaysShow,x=o$e(),T=ate(d),S=ste(h),N=d$e();if(!x||!N)return null;wl(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var O=vj({x:T.scale,y:S.scale}),A=_i(n),I=_i(a),P=o&&o.length===2,L=C$e(O,A,I,P,N,e.position,T.orientation,S.orientation,e);if(!L)return null;var F=b$e(L,2),V=F[0],G=V.x,B=V.y,z=F[1],q=z.x,Z=z.y,ie=Vc(e,"hidden")?"url(#".concat(x,")"):void 0,ue=iY(iY({clipPath:ie},gn(e,!0)),{},{x1:G,y1:B,x2:q,y2:Z});return ge.createElement(mr,{className:An("recharts-reference-line",y)},T$e(f,ue),ca.renderCallByParent(e,UWe({x1:G,y1:B,x2:q,y2:Z})))}var Sj=function(e){function n(){return h$e(this,n),f$e(this,n,arguments)}return y$e(n,e),m$e(n,[{key:"render",value:function(){return ge.createElement(N$e,this.props)}}])}(ge.Component);Ej(Sj,"displayName","ReferenceLine");Ej(Sj,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function GD(){return GD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},GD.apply(this,arguments)}function Rf(e){"@babel/helpers - typeof";return Rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Rf(e)}function sY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function oY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?sY(Object(a),!0).forEach(function(o){GT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function R$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function A$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,dte(o.key),o)}}function I$e(e,n,a){return n&&A$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function O$e(e,n,a){return n=xw(n),P$e(e,lte()?Reflect.construct(n,a||[],xw(e).constructor):n.apply(e,a))}function P$e(e,n){if(n&&(Rf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D$e(e)}function D$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lte=function(){return!!e})()}function xw(e){return xw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},xw(e)}function k$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&WD(e,n)}function WD(e,n){return WD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},WD(e,n)}function GT(e,n,a){return n=dte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function dte(e){var n=j$e(e,"string");return Rf(n)=="symbol"?n:n+""}function j$e(e,n){if(Rf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Rf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var L$e=function(n){var a=n.x,o=n.y,d=n.xAxis,h=n.yAxis,f=vj({x:d.scale,y:h.scale}),y=f.apply({x:a,y:o},{bandAware:!0});return Vc(n,"discard")&&!f.isInRange(y)?null:y},WT=function(e){function n(){return R$e(this,n),O$e(this,n,arguments)}return k$e(n,e),I$e(n,[{key:"render",value:function(){var o=this.props,d=o.x,h=o.y,f=o.r,y=o.alwaysShow,b=o.clipPathId,x=_i(d),T=_i(h);if(wl(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!x||!T)return null;var S=L$e(this.props);if(!S)return null;var N=S.x,O=S.y,A=this.props,I=A.shape,P=A.className,L=Vc(this.props,"hidden")?"url(#".concat(b,")"):void 0,F=oY(oY({clipPath:L},gn(this.props,!0)),{},{cx:N,cy:O});return ge.createElement(mr,{className:An("recharts-reference-dot",P)},n.renderDot(I,F),ca.renderCallByParent(this.props,{x:N-f,y:O-f,width:2*f,height:2*f}))}}])}(ge.Component);GT(WT,"displayName","ReferenceDot");GT(WT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});GT(WT,"renderDot",function(e,n){var a;return ge.isValidElement(e)?a=ge.cloneElement(e,n):un(e)?a=e(n):a=ge.createElement(UT,GD({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),a});function $D(){return $D=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},$D.apply(this,arguments)}function Af(e){"@babel/helpers - typeof";return Af=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Af(e)}function cY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function lY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?cY(Object(a),!0).forEach(function(o){$T(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function M$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function U$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,hte(o.key),o)}}function F$e(e,n,a){return n&&U$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function V$e(e,n,a){return n=Ew(n),B$e(e,ute()?Reflect.construct(n,a||[],Ew(e).constructor):n.apply(e,a))}function B$e(e,n){if(n&&(Af(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G$e(e)}function G$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ute(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ute=function(){return!!e})()}function Ew(e){return Ew=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Ew(e)}function W$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&HD(e,n)}function HD(e,n){return HD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},HD(e,n)}function $T(e,n,a){return n=hte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function hte(e){var n=$$e(e,"string");return Af(n)=="symbol"?n:n+""}function $$e(e,n){if(Af(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Af(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var H$e=function(n,a,o,d,h){var f=h.x1,y=h.x2,b=h.y1,x=h.y2,T=h.xAxis,S=h.yAxis;if(!T||!S)return null;var N=vj({x:T.scale,y:S.scale}),O={x:n?N.x.apply(f,{position:"start"}):N.x.rangeMin,y:o?N.y.apply(b,{position:"start"}):N.y.rangeMin},A={x:a?N.x.apply(y,{position:"end"}):N.x.rangeMax,y:d?N.y.apply(x,{position:"end"}):N.y.rangeMax};return Vc(h,"discard")&&(!N.isInRange(O)||!N.isInRange(A))?null:Qee(O,A)},HT=function(e){function n(){return M$e(this,n),V$e(this,n,arguments)}return W$e(n,e),F$e(n,[{key:"render",value:function(){var o=this.props,d=o.x1,h=o.x2,f=o.y1,y=o.y2,b=o.className,x=o.alwaysShow,T=o.clipPathId;wl(x===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var S=_i(d),N=_i(h),O=_i(f),A=_i(y),I=this.props.shape;if(!S&&!N&&!O&&!A&&!I)return null;var P=H$e(S,N,O,A,this.props);if(!P&&!I)return null;var L=Vc(this.props,"hidden")?"url(#".concat(T,")"):void 0;return ge.createElement(mr,{className:An("recharts-reference-area",b)},n.renderRect(I,lY(lY({clipPath:L},gn(this.props,!0)),P)),ca.renderCallByParent(this.props,P))}}])}(ge.Component);$T(HT,"displayName","ReferenceArea");$T(HT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});$T(HT,"renderRect",function(e,n){var a;return ge.isValidElement(e)?a=ge.cloneElement(e,n):un(e)?a=e(n):a=ge.createElement(gj,$D({},n,{className:"recharts-reference-area-rect"})),a});function pte(e,n,a){if(n<1)return[];if(n===1&&a===void 0)return e;for(var o=[],d=0;d<e.length;d+=n)o.push(e[d]);return o}function z$e(e,n,a){var o={width:e.width+n.width,height:e.height+n.height};return VWe(o,a)}function K$e(e,n,a){var o=a==="width",d=e.x,h=e.y,f=e.width,y=e.height;return n===1?{start:o?d:h,end:o?d+f:h+y}:{start:o?d+f:h+y,end:o?d:h}}function Sw(e,n,a,o,d){if(e*n<e*o||e*n>e*d)return!1;var h=a();return e*(n-e*h/2-o)>=0&&e*(n+e*h/2-d)<=0}function Y$e(e,n){return pte(e,n+1)}function q$e(e,n,a,o,d){for(var h=(o||[]).slice(),f=n.start,y=n.end,b=0,x=1,T=f,S=function(){var A=o==null?void 0:o[b];if(A===void 0)return{v:pte(o,x)};var I=b,P,L=function(){return P===void 0&&(P=a(A,I)),P},F=A.coordinate,V=b===0||Sw(e,F,L,T,y);V||(b=0,T=f,x+=1),V&&(T=F+e*(L()/2+d),b+=x)},N;x<=h.length;)if(N=S(),N)return N.v;return[]}function O0(e){"@babel/helpers - typeof";return O0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},O0(e)}function dY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function sa(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?dY(Object(a),!0).forEach(function(o){X$e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):dY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function X$e(e,n,a){return n=J$e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function J$e(e){var n=Q$e(e,"string");return O0(n)=="symbol"?n:n+""}function Q$e(e,n){if(O0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(O0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Z$e(e,n,a,o,d){for(var h=(o||[]).slice(),f=h.length,y=n.start,b=n.end,x=function(N){var O=h[N],A,I=function(){return A===void 0&&(A=a(O,N)),A};if(N===f-1){var P=e*(O.coordinate+e*I()/2-b);h[N]=O=sa(sa({},O),{},{tickCoord:P>0?O.coordinate-P*e:O.coordinate})}else h[N]=O=sa(sa({},O),{},{tickCoord:O.coordinate});var L=Sw(e,O.tickCoord,I,y,b);L&&(b=O.tickCoord-e*(I()/2+d),h[N]=sa(sa({},O),{},{isShow:!0}))},T=f-1;T>=0;T--)x(T);return h}function eHe(e,n,a,o,d,h){var f=(o||[]).slice(),y=f.length,b=n.start,x=n.end;if(h){var T=o[y-1],S=a(T,y-1),N=e*(T.coordinate+e*S/2-x);f[y-1]=T=sa(sa({},T),{},{tickCoord:N>0?T.coordinate-N*e:T.coordinate});var O=Sw(e,T.tickCoord,function(){return S},b,x);O&&(x=T.tickCoord-e*(S/2+d),f[y-1]=sa(sa({},T),{},{isShow:!0}))}for(var A=h?y-1:y,I=function(F){var V=f[F],G,B=function(){return G===void 0&&(G=a(V,F)),G};if(F===0){var z=e*(V.coordinate-e*B()/2-b);f[F]=V=sa(sa({},V),{},{tickCoord:z<0?V.coordinate-z*e:V.coordinate})}else f[F]=V=sa(sa({},V),{},{tickCoord:V.coordinate});var q=Sw(e,V.tickCoord,B,b,x);q&&(b=V.tickCoord+e*(B()/2+d),f[F]=sa(sa({},V),{},{isShow:!0}))},P=0;P<A;P++)I(P);return f}function wj(e,n,a){var o=e.tick,d=e.ticks,h=e.viewBox,f=e.minTickGap,y=e.orientation,b=e.interval,x=e.tickFormatter,T=e.unit,S=e.angle;if(!d||!d.length||!o)return[];if(lt(b)||Hh.isSsr)return Y$e(d,typeof b=="number"&&lt(b)?b:0);var N=[],O=y==="top"||y==="bottom"?"width":"height",A=T&&O==="width"?wy(T,{fontSize:n,letterSpacing:a}):{width:0,height:0},I=function(V,G){var B=un(x)?x(V.value,G):V.value;return O==="width"?z$e(wy(B,{fontSize:n,letterSpacing:a}),A,S):wy(B,{fontSize:n,letterSpacing:a})[O]},P=d.length>=2?Xo(d[1].coordinate-d[0].coordinate):1,L=K$e(h,P,O);return b==="equidistantPreserveStart"?q$e(P,L,I,d,f):(b==="preserveStart"||b==="preserveStartEnd"?N=eHe(P,L,I,d,f,b==="preserveStartEnd"):N=Z$e(P,L,I,d,f),N.filter(function(F){return F.isShow}))}var tHe=["viewBox"],nHe=["viewBox"],rHe=["ticks"];function If(e){"@babel/helpers - typeof";return If=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},If(e)}function Gm(){return Gm=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Gm.apply(this,arguments)}function uY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function mi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?uY(Object(a),!0).forEach(function(o){Tj(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):uY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function f1(e,n){if(e==null)return{};var a=iHe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function iHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function aHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function hY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fte(o.key),o)}}function sHe(e,n,a){return n&&hY(e.prototype,n),a&&hY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function oHe(e,n,a){return n=ww(n),cHe(e,mte()?Reflect.construct(n,a||[],ww(e).constructor):n.apply(e,a))}function cHe(e,n){if(n&&(If(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lHe(e)}function lHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mte=function(){return!!e})()}function ww(e){return ww=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ww(e)}function dHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&zD(e,n)}function zD(e,n){return zD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},zD(e,n)}function Tj(e,n,a){return n=fte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function fte(e){var n=uHe(e,"string");return If(n)=="symbol"?n:n+""}function uHe(e,n){if(If(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(If(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var og=function(e){function n(a){var o;return aHe(this,n),o=oHe(this,n,[a]),o.state={fontSize:"",letterSpacing:""},o}return dHe(n,e),sHe(n,[{key:"shouldComponentUpdate",value:function(o,d){var h=o.viewBox,f=f1(o,tHe),y=this.props,b=y.viewBox,x=f1(y,nHe);return!Xm(h,b)||!Xm(f,x)||!Xm(d,this.state)}},{key:"componentDidMount",value:function(){var o=this.layerReference;if(o){var d=o.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];d&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}},{key:"getTickLineCoord",value:function(o){var d=this.props,h=d.x,f=d.y,y=d.width,b=d.height,x=d.orientation,T=d.tickSize,S=d.mirror,N=d.tickMargin,O,A,I,P,L,F,V=S?-1:1,G=o.tickSize||T,B=lt(o.tickCoord)?o.tickCoord:o.coordinate;switch(x){case"top":O=A=o.coordinate,P=f+ +!S*b,I=P-V*G,F=I-V*N,L=B;break;case"left":I=P=o.coordinate,A=h+ +!S*y,O=A-V*G,L=O-V*N,F=B;break;case"right":I=P=o.coordinate,A=h+ +S*y,O=A+V*G,L=O+V*N,F=B;break;default:O=A=o.coordinate,P=f+ +S*b,I=P+V*G,F=I+V*N,L=B;break}return{line:{x1:O,y1:I,x2:A,y2:P},tick:{x:L,y:F}}}},{key:"getTickTextAnchor",value:function(){var o=this.props,d=o.orientation,h=o.mirror,f;switch(d){case"left":f=h?"start":"end";break;case"right":f=h?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var o=this.props,d=o.orientation,h=o.mirror,f="end";switch(d){case"left":case"right":f="middle";break;case"top":f=h?"start":"end";break;default:f=h?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.x,h=o.y,f=o.width,y=o.height,b=o.orientation,x=o.mirror,T=o.axisLine,S=mi(mi(mi({},gn(this.props,!1)),gn(T,!1)),{},{fill:"none"});if(b==="top"||b==="bottom"){var N=+(b==="top"&&!x||b==="bottom"&&x);S=mi(mi({},S),{},{x1:d,y1:h+N*y,x2:d+f,y2:h+N*y})}else{var O=+(b==="left"&&!x||b==="right"&&x);S=mi(mi({},S),{},{x1:d+O*f,y1:h,x2:d+O*f,y2:h+y})}return ge.createElement("line",Gm({},S,{className:An("recharts-cartesian-axis-line",lo(T,"className"))}))}},{key:"renderTicks",value:function(o,d,h){var f=this,y=this.props,b=y.tickLine,x=y.stroke,T=y.tick,S=y.tickFormatter,N=y.unit,O=wj(mi(mi({},this.props),{},{ticks:o}),d,h),A=this.getTickTextAnchor(),I=this.getTickVerticalAnchor(),P=gn(this.props,!1),L=gn(T,!1),F=mi(mi({},P),{},{fill:"none"},gn(b,!1)),V=O.map(function(G,B){var z=f.getTickLineCoord(G),q=z.line,Z=z.tick,ie=mi(mi(mi(mi({textAnchor:A,verticalAnchor:I},P),{},{stroke:"none",fill:x},L),Z),{},{index:B,payload:G,visibleTicksCount:O.length,tickFormatter:S});return ge.createElement(mr,Gm({className:"recharts-cartesian-axis-tick",key:"tick-".concat(G.value,"-").concat(G.coordinate,"-").concat(G.tickCoord)},OS(f.props,G,B)),b&&ge.createElement("line",Gm({},F,q,{className:An("recharts-cartesian-axis-tick-line",lo(b,"className"))})),T&&n.renderTickItem(T,ie,"".concat(un(S)?S(G.value,B):G.value).concat(N||"")))});return ge.createElement("g",{className:"recharts-cartesian-axis-ticks"},V)}},{key:"render",value:function(){var o=this,d=this.props,h=d.axisLine,f=d.width,y=d.height,b=d.ticksGenerator,x=d.className,T=d.hide;if(T)return null;var S=this.props,N=S.ticks,O=f1(S,rHe),A=N;return un(b)&&(A=N&&N.length>0?b(this.props):b(O)),f<=0||y<=0||!A||!A.length?null:ge.createElement(mr,{className:An("recharts-cartesian-axis",x),ref:function(P){o.layerReference=P}},h&&this.renderAxisLine(),this.renderTicks(A,this.state.fontSize,this.state.letterSpacing),ca.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(o,d,h){var f,y=An(d.className,"recharts-cartesian-axis-tick-value");return ge.isValidElement(o)?f=ge.cloneElement(o,mi(mi({},d),{},{className:y})):un(o)?f=o(mi(mi({},d),{},{className:y})):f=ge.createElement(HS,Gm({},d,{className:"recharts-cartesian-axis-tick-value"}),h),f}}])}(Y.Component);Tj(og,"displayName","CartesianAxis");Tj(og,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var hHe=["x1","y1","x2","y2","key"],pHe=["offset"];function Bh(e){"@babel/helpers - typeof";return Bh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bh(e)}function pY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function la(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?pY(Object(a),!0).forEach(function(o){mHe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function mHe(e,n,a){return n=fHe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function fHe(e){var n=gHe(e,"string");return Bh(n)=="symbol"?n:n+""}function gHe(e,n){if(Bh(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Bh(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Sh(){return Sh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Sh.apply(this,arguments)}function mY(e,n){if(e==null)return{};var a=vHe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function vHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var yHe=function(n){var a=n.fill;if(!a||a==="none")return null;var o=n.fillOpacity,d=n.x,h=n.y,f=n.width,y=n.height,b=n.ry;return ge.createElement("rect",{x:d,y:h,ry:b,width:f,height:y,stroke:"none",fill:a,fillOpacity:o,className:"recharts-cartesian-grid-bg"})};function gte(e,n){var a;if(ge.isValidElement(e))a=ge.cloneElement(e,n);else if(un(e))a=e(n);else{var o=n.x1,d=n.y1,h=n.x2,f=n.y2,y=n.key,b=mY(n,hHe),x=gn(b,!1);x.offset;var T=mY(x,pHe);a=ge.createElement("line",Sh({},T,{x1:o,y1:d,x2:h,y2:f,fill:"none",key:y}))}return a}function _He(e){var n=e.x,a=e.width,o=e.horizontal,d=o===void 0?!0:o,h=e.horizontalPoints;if(!d||!h||!h.length)return null;var f=h.map(function(y,b){var x=la(la({},e),{},{x1:n,y1:y,x2:n+a,y2:y,key:"line-".concat(b),index:b});return gte(d,x)});return ge.createElement("g",{className:"recharts-cartesian-grid-horizontal"},f)}function bHe(e){var n=e.y,a=e.height,o=e.vertical,d=o===void 0?!0:o,h=e.verticalPoints;if(!d||!h||!h.length)return null;var f=h.map(function(y,b){var x=la(la({},e),{},{x1:y,y1:n,x2:y,y2:n+a,key:"line-".concat(b),index:b});return gte(d,x)});return ge.createElement("g",{className:"recharts-cartesian-grid-vertical"},f)}function xHe(e){var n=e.horizontalFill,a=e.fillOpacity,o=e.x,d=e.y,h=e.width,f=e.height,y=e.horizontalPoints,b=e.horizontal,x=b===void 0?!0:b;if(!x||!n||!n.length)return null;var T=y.map(function(N){return Math.round(N+d-d)}).sort(function(N,O){return N-O});d!==T[0]&&T.unshift(0);var S=T.map(function(N,O){var A=!T[O+1],I=A?d+f-N:T[O+1]-N;if(I<=0)return null;var P=O%n.length;return ge.createElement("rect",{key:"react-".concat(O),y:N,x:o,height:I,width:h,stroke:"none",fill:n[P],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return ge.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},S)}function EHe(e){var n=e.vertical,a=n===void 0?!0:n,o=e.verticalFill,d=e.fillOpacity,h=e.x,f=e.y,y=e.width,b=e.height,x=e.verticalPoints;if(!a||!o||!o.length)return null;var T=x.map(function(N){return Math.round(N+h-h)}).sort(function(N,O){return N-O});h!==T[0]&&T.unshift(0);var S=T.map(function(N,O){var A=!T[O+1],I=A?h+y-N:T[O+1]-N;if(I<=0)return null;var P=O%o.length;return ge.createElement("rect",{key:"react-".concat(O),x:N,y:f,width:I,height:b,stroke:"none",fill:o[P],fillOpacity:d,className:"recharts-cartesian-grid-bg"})});return ge.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},S)}var SHe=function(n,a){var o=n.xAxis,d=n.width,h=n.height,f=n.offset;return Tee(wj(la(la(la({},og.defaultProps),o),{},{ticks:_l(o,!0),viewBox:{x:0,y:0,width:d,height:h}})),f.left,f.left+f.width,a)},wHe=function(n,a){var o=n.yAxis,d=n.width,h=n.height,f=n.offset;return Tee(wj(la(la(la({},og.defaultProps),o),{},{ticks:_l(o,!0),viewBox:{x:0,y:0,width:d,height:h}})),f.top,f.top+f.height,a)},wm={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function Of(e){var n,a,o,d,h,f,y=bj(),b=xj(),x=u$e(),T=la(la({},e),{},{stroke:(n=e.stroke)!==null&&n!==void 0?n:wm.stroke,fill:(a=e.fill)!==null&&a!==void 0?a:wm.fill,horizontal:(o=e.horizontal)!==null&&o!==void 0?o:wm.horizontal,horizontalFill:(d=e.horizontalFill)!==null&&d!==void 0?d:wm.horizontalFill,vertical:(h=e.vertical)!==null&&h!==void 0?h:wm.vertical,verticalFill:(f=e.verticalFill)!==null&&f!==void 0?f:wm.verticalFill,x:lt(e.x)?e.x:x.left,y:lt(e.y)?e.y:x.top,width:lt(e.width)?e.width:x.width,height:lt(e.height)?e.height:x.height}),S=T.x,N=T.y,O=T.width,A=T.height,I=T.syncWithTicks,P=T.horizontalValues,L=T.verticalValues,F=c$e(),V=l$e();if(!lt(O)||O<=0||!lt(A)||A<=0||!lt(S)||S!==+S||!lt(N)||N!==+N)return null;var G=T.verticalCoordinatesGenerator||SHe,B=T.horizontalCoordinatesGenerator||wHe,z=T.horizontalPoints,q=T.verticalPoints;if((!z||!z.length)&&un(B)){var Z=P&&P.length,ie=B({yAxis:V?la(la({},V),{},{ticks:Z?P:V.ticks}):void 0,width:y,height:b,offset:x},Z?!0:I);wl(Array.isArray(ie),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(ie),"]")),Array.isArray(ie)&&(z=ie)}if((!q||!q.length)&&un(G)){var ue=L&&L.length,re=G({xAxis:F?la(la({},F),{},{ticks:ue?L:F.ticks}):void 0,width:y,height:b,offset:x},ue?!0:I);wl(Array.isArray(re),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(re),"]")),Array.isArray(re)&&(q=re)}return ge.createElement("g",{className:"recharts-cartesian-grid"},ge.createElement(yHe,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),ge.createElement(_He,Sh({},T,{offset:x,horizontalPoints:z,xAxis:F,yAxis:V})),ge.createElement(bHe,Sh({},T,{offset:x,verticalPoints:q,xAxis:F,yAxis:V})),ge.createElement(xHe,Sh({},T,{horizontalPoints:z})),ge.createElement(EHe,Sh({},T,{verticalPoints:q})))}Of.displayName="CartesianGrid";var THe=["type","layout","connectNulls","ref"],CHe=["key"];function Pf(e){"@babel/helpers - typeof";return Pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Pf(e)}function fY(e,n){if(e==null)return{};var a=NHe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function NHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Ry(){return Ry=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Ry.apply(this,arguments)}function gY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ys(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?gY(Object(a),!0).forEach(function(o){Ko(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Tm(e){return OHe(e)||IHe(e)||AHe(e)||RHe()}function RHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AHe(e,n){if(e){if(typeof e=="string")return KD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KD(e,n)}}function IHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function OHe(e){if(Array.isArray(e))return KD(e)}function KD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function PHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function vY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,yte(o.key),o)}}function DHe(e,n,a){return n&&vY(e.prototype,n),a&&vY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function kHe(e,n,a){return n=Tw(n),jHe(e,vte()?Reflect.construct(n,a||[],Tw(e).constructor):n.apply(e,a))}function jHe(e,n){if(n&&(Pf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LHe(e)}function LHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vte=function(){return!!e})()}function Tw(e){return Tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Tw(e)}function MHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&YD(e,n)}function YD(e,n){return YD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},YD(e,n)}function Ko(e,n,a){return n=yte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function yte(e){var n=UHe(e,"string");return Pf(n)=="symbol"?n:n+""}function UHe(e,n){if(Pf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Pf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var cg=function(e){function n(){var a;PHe(this,n);for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];return a=kHe(this,n,[].concat(d)),Ko(a,"state",{isAnimationFinished:!0,totalLength:0}),Ko(a,"generateSimpleStrokeDasharray",function(f,y){return"".concat(y,"px ").concat(f-y,"px")}),Ko(a,"getStrokeDasharray",function(f,y,b){var x=b.reduce(function(L,F){return L+F});if(!x)return a.generateSimpleStrokeDasharray(y,f);for(var T=Math.floor(f/x),S=f%x,N=y-f,O=[],A=0,I=0;A<b.length;I+=b[A],++A)if(I+b[A]>S){O=[].concat(Tm(b.slice(0,A)),[S-I]);break}var P=O.length%2===0?[0,N]:[N];return[].concat(Tm(n.repeat(b,T)),Tm(O),P).map(function(L){return"".concat(L,"px")}).join(", ")}),Ko(a,"id",eg("recharts-line-")),Ko(a,"pathRef",function(f){a.mainCurve=f}),Ko(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),Ko(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return MHe(n,e),DHe(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();this.setState({totalLength:o})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();o!==this.state.totalLength&&this.setState({totalLength:o})}}},{key:"getTotalLength",value:function(){var o=this.mainCurve;try{return o&&o.getTotalLength&&o.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var h=this.props,f=h.points,y=h.xAxis,b=h.yAxis,x=h.layout,T=h.children,S=uo(T,e_);if(!S)return null;var N=function(I,P){return{x:I.x,y:I.y,value:I.value,errorVal:Ra(I.payload,P)}},O={clipPath:o?"url(#clipPath-".concat(d,")"):null};return ge.createElement(mr,O,S.map(function(A){return ge.cloneElement(A,{key:"bar-".concat(A.props.dataKey),data:f,xAxis:y,yAxis:b,layout:x,dataPointFormatter:N})}))}},{key:"renderDots",value:function(o,d,h){var f=this.props.isAnimationActive;if(f&&!this.state.isAnimationFinished)return null;var y=this.props,b=y.dot,x=y.points,T=y.dataKey,S=gn(this.props,!1),N=gn(b,!0),O=x.map(function(I,P){var L=ys(ys(ys({key:"dot-".concat(P),r:3},S),N),{},{index:P,cx:I.x,cy:I.y,value:I.value,dataKey:T,payload:I.payload,points:x});return n.renderDotItem(b,L)}),A={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(h,")"):null};return ge.createElement(mr,Ry({className:"recharts-line-dots",key:"dots"},A),O)}},{key:"renderCurveStatically",value:function(o,d,h,f){var y=this.props,b=y.type,x=y.layout,T=y.connectNulls;y.ref;var S=fY(y,THe),N=ys(ys(ys({},gn(S,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:d?"url(#clipPath-".concat(h,")"):null,points:o},f),{},{type:b,layout:x,connectNulls:T});return ge.createElement(ef,Ry({},N,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(o,d){var h=this,f=this.props,y=f.points,b=f.strokeDasharray,x=f.isAnimationActive,T=f.animationBegin,S=f.animationDuration,N=f.animationEasing,O=f.animationId,A=f.animateNewValues,I=f.width,P=f.height,L=this.state,F=L.prevPoints,V=L.totalLength;return ge.createElement(Wc,{begin:T,duration:S,isActive:x,easing:N,from:{t:0},to:{t:1},key:"line-".concat(O),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(G){var B=G.t;if(F){var z=F.length/y.length,q=y.map(function(pe,Se){var fe=Math.floor(Se*z);if(F[fe]){var be=F[fe],se=Hi(be.x,pe.x),he=Hi(be.y,pe.y);return ys(ys({},pe),{},{x:se(B),y:he(B)})}if(A){var Q=Hi(I*2,pe.x),le=Hi(P/2,pe.y);return ys(ys({},pe),{},{x:Q(B),y:le(B)})}return ys(ys({},pe),{},{x:pe.x,y:pe.y})});return h.renderCurveStatically(q,o,d)}var Z=Hi(0,V),ie=Z(B),ue;if(b){var re="".concat(b).split(/[,\s]+/gim).map(function(pe){return parseFloat(pe)});ue=h.getStrokeDasharray(ie,V,re)}else ue=h.generateSimpleStrokeDasharray(V,ie);return h.renderCurveStatically(y,o,d,{strokeDasharray:ue})})}},{key:"renderCurve",value:function(o,d){var h=this.props,f=h.points,y=h.isAnimationActive,b=this.state,x=b.prevPoints,T=b.totalLength;return y&&f&&f.length&&(!x&&T>0||!xf(x,f))?this.renderCurveWithAnimation(o,d):this.renderCurveStatically(f,o,d)}},{key:"render",value:function(){var o,d=this.props,h=d.hide,f=d.dot,y=d.points,b=d.className,x=d.xAxis,T=d.yAxis,S=d.top,N=d.left,O=d.width,A=d.height,I=d.isAnimationActive,P=d.id;if(h||!y||!y.length)return null;var L=this.state.isAnimationFinished,F=y.length===1,V=An("recharts-line",b),G=x&&x.allowDataOverflow,B=T&&T.allowDataOverflow,z=G||B,q=yn(P)?this.id:P,Z=(o=gn(f,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},ie=Z.r,ue=ie===void 0?3:ie,re=Z.strokeWidth,pe=re===void 0?2:re,Se=vQ(f)?f:{},fe=Se.clipDot,be=fe===void 0?!0:fe,se=ue*2+pe;return ge.createElement(mr,{className:V},G||B?ge.createElement("defs",null,ge.createElement("clipPath",{id:"clipPath-".concat(q)},ge.createElement("rect",{x:G?N:N-O/2,y:B?S:S-A/2,width:G?O:O*2,height:B?A:A*2})),!be&&ge.createElement("clipPath",{id:"clipPath-dots-".concat(q)},ge.createElement("rect",{x:N-se/2,y:S-se/2,width:O+se,height:A+se}))):null,!F&&this.renderCurve(z,q),this.renderErrorBar(z,q),(F||f)&&this.renderDots(z,be,q),(!I||L)&&Cl.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:d.curPoints}:o.points!==d.curPoints?{curPoints:o.points}:null}},{key:"repeat",value:function(o,d){for(var h=o.length%2!==0?[].concat(Tm(o),[0]):o,f=[],y=0;y<d;++y)f=[].concat(Tm(f),Tm(h));return f}},{key:"renderDotItem",value:function(o,d){var h;if(ge.isValidElement(o))h=ge.cloneElement(o,d);else if(un(o))h=o(d);else{var f=d.key,y=fY(d,CHe),b=An("recharts-line-dot",typeof o!="boolean"?o.className:"");h=ge.createElement(UT,Ry({key:f},y,{className:b}))}return h}}])}(Y.PureComponent);Ko(cg,"displayName","Line");Ko(cg,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Hh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Ko(cg,"getComposedData",function(e){var n=e.props,a=e.xAxis,o=e.yAxis,d=e.xAxisTicks,h=e.yAxisTicks,f=e.dataKey,y=e.bandSize,b=e.displayedData,x=e.offset,T=n.layout,S=b.map(function(N,O){var A=Ra(N,f);return T==="horizontal"?{x:aw({axis:a,ticks:d,bandSize:y,entry:N,index:O}),y:yn(A)?null:o.scale(A),value:A,payload:N}:{x:yn(A)?null:a.scale(A),y:aw({axis:o,ticks:h,bandSize:y,entry:N,index:O}),value:A,payload:N}});return ys({points:S,layout:T},x)});var FHe=["layout","type","stroke","connectNulls","isRange","ref"],VHe=["key"],_te;function Df(e){"@babel/helpers - typeof";return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Df(e)}function bte(e,n){if(e==null)return{};var a=BHe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function BHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function wh(){return wh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},wh.apply(this,arguments)}function yY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Cd(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?yY(Object(a),!0).forEach(function(o){jc(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function GHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _Y(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ete(o.key),o)}}function WHe(e,n,a){return n&&_Y(e.prototype,n),a&&_Y(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function $He(e,n,a){return n=Cw(n),HHe(e,xte()?Reflect.construct(n,a||[],Cw(e).constructor):n.apply(e,a))}function HHe(e,n){if(n&&(Df(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zHe(e)}function zHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xte=function(){return!!e})()}function Cw(e){return Cw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Cw(e)}function KHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&qD(e,n)}function qD(e,n){return qD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},qD(e,n)}function jc(e,n,a){return n=Ete(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Ete(e){var n=YHe(e,"string");return Df(n)=="symbol"?n:n+""}function YHe(e,n){if(Df(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Df(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Hc=function(e){function n(){var a;GHe(this,n);for(var o=arguments.length,d=new Array(o),h=0;h<o;h++)d[h]=arguments[h];return a=$He(this,n,[].concat(d)),jc(a,"state",{isAnimationFinished:!0}),jc(a,"id",eg("recharts-area-")),jc(a,"handleAnimationEnd",function(){var f=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),un(f)&&f()}),jc(a,"handleAnimationStart",function(){var f=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),un(f)&&f()}),a}return KHe(n,e),WHe(n,[{key:"renderDots",value:function(o,d,h){var f=this.props.isAnimationActive,y=this.state.isAnimationFinished;if(f&&!y)return null;var b=this.props,x=b.dot,T=b.points,S=b.dataKey,N=gn(this.props,!1),O=gn(x,!0),A=T.map(function(P,L){var F=Cd(Cd(Cd({key:"dot-".concat(L),r:3},N),O),{},{index:L,cx:P.x,cy:P.y,dataKey:S,value:P.value,payload:P.payload,points:T});return n.renderDotItem(x,F)}),I={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(h,")"):null};return ge.createElement(mr,wh({className:"recharts-area-dots"},I),A)}},{key:"renderHorizontalRect",value:function(o){var d=this.props,h=d.baseLine,f=d.points,y=d.strokeWidth,b=f[0].x,x=f[f.length-1].x,T=o*Math.abs(b-x),S=Fd(f.map(function(N){return N.y||0}));return lt(h)&&typeof h=="number"?S=Math.max(h,S):h&&Array.isArray(h)&&h.length&&(S=Math.max(Fd(h.map(function(N){return N.y||0})),S)),lt(S)?ge.createElement("rect",{x:b<x?b:b-T,y:0,width:T,height:Math.floor(S+(y?parseInt("".concat(y),10):1))}):null}},{key:"renderVerticalRect",value:function(o){var d=this.props,h=d.baseLine,f=d.points,y=d.strokeWidth,b=f[0].y,x=f[f.length-1].y,T=o*Math.abs(b-x),S=Fd(f.map(function(N){return N.x||0}));return lt(h)&&typeof h=="number"?S=Math.max(h,S):h&&Array.isArray(h)&&h.length&&(S=Math.max(Fd(h.map(function(N){return N.x||0})),S)),lt(S)?ge.createElement("rect",{x:0,y:b<x?b:b-T,width:S+(y?parseInt("".concat(y),10):1),height:Math.floor(T)}):null}},{key:"renderClipRect",value:function(o){var d=this.props.layout;return d==="vertical"?this.renderVerticalRect(o):this.renderHorizontalRect(o)}},{key:"renderAreaStatically",value:function(o,d,h,f){var y=this.props,b=y.layout,x=y.type,T=y.stroke,S=y.connectNulls,N=y.isRange;y.ref;var O=bte(y,FHe);return ge.createElement(mr,{clipPath:h?"url(#clipPath-".concat(f,")"):null},ge.createElement(ef,wh({},gn(O,!0),{points:o,connectNulls:S,type:x,baseLine:d,layout:b,stroke:"none",className:"recharts-area-area"})),T!=="none"&&ge.createElement(ef,wh({},gn(this.props,!1),{className:"recharts-area-curve",layout:b,type:x,connectNulls:S,fill:"none",points:o})),T!=="none"&&N&&ge.createElement(ef,wh({},gn(this.props,!1),{className:"recharts-area-curve",layout:b,type:x,connectNulls:S,fill:"none",points:d})))}},{key:"renderAreaWithAnimation",value:function(o,d){var h=this,f=this.props,y=f.points,b=f.baseLine,x=f.isAnimationActive,T=f.animationBegin,S=f.animationDuration,N=f.animationEasing,O=f.animationId,A=this.state,I=A.prevPoints,P=A.prevBaseLine;return ge.createElement(Wc,{begin:T,duration:S,isActive:x,easing:N,from:{t:0},to:{t:1},key:"area-".concat(O),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(L){var F=L.t;if(I){var V=I.length/y.length,G=y.map(function(Z,ie){var ue=Math.floor(ie*V);if(I[ue]){var re=I[ue],pe=Hi(re.x,Z.x),Se=Hi(re.y,Z.y);return Cd(Cd({},Z),{},{x:pe(F),y:Se(F)})}return Z}),B;if(lt(b)&&typeof b=="number"){var z=Hi(P,b);B=z(F)}else if(yn(b)||Zf(b)){var q=Hi(P,0);B=q(F)}else B=b.map(function(Z,ie){var ue=Math.floor(ie*V);if(P[ue]){var re=P[ue],pe=Hi(re.x,Z.x),Se=Hi(re.y,Z.y);return Cd(Cd({},Z),{},{x:pe(F),y:Se(F)})}return Z});return h.renderAreaStatically(G,B,o,d)}return ge.createElement(mr,null,ge.createElement("defs",null,ge.createElement("clipPath",{id:"animationClipPath-".concat(d)},h.renderClipRect(F))),ge.createElement(mr,{clipPath:"url(#animationClipPath-".concat(d,")")},h.renderAreaStatically(y,b,o,d)))})}},{key:"renderArea",value:function(o,d){var h=this.props,f=h.points,y=h.baseLine,b=h.isAnimationActive,x=this.state,T=x.prevPoints,S=x.prevBaseLine,N=x.totalLength;return b&&f&&f.length&&(!T&&N>0||!xf(T,f)||!xf(S,y))?this.renderAreaWithAnimation(o,d):this.renderAreaStatically(f,y,o,d)}},{key:"render",value:function(){var o,d=this.props,h=d.hide,f=d.dot,y=d.points,b=d.className,x=d.top,T=d.left,S=d.xAxis,N=d.yAxis,O=d.width,A=d.height,I=d.isAnimationActive,P=d.id;if(h||!y||!y.length)return null;var L=this.state.isAnimationFinished,F=y.length===1,V=An("recharts-area",b),G=S&&S.allowDataOverflow,B=N&&N.allowDataOverflow,z=G||B,q=yn(P)?this.id:P,Z=(o=gn(f,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},ie=Z.r,ue=ie===void 0?3:ie,re=Z.strokeWidth,pe=re===void 0?2:re,Se=vQ(f)?f:{},fe=Se.clipDot,be=fe===void 0?!0:fe,se=ue*2+pe;return ge.createElement(mr,{className:V},G||B?ge.createElement("defs",null,ge.createElement("clipPath",{id:"clipPath-".concat(q)},ge.createElement("rect",{x:G?T:T-O/2,y:B?x:x-A/2,width:G?O:O*2,height:B?A:A*2})),!be&&ge.createElement("clipPath",{id:"clipPath-dots-".concat(q)},ge.createElement("rect",{x:T-se/2,y:x-se/2,width:O+se,height:A+se}))):null,F?null:this.renderArea(z,q),(f||F)&&this.renderDots(z,be,q),(!I||L)&&Cl.renderCallByParent(this.props,y))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,curBaseLine:o.baseLine,prevPoints:d.curPoints,prevBaseLine:d.curBaseLine}:o.points!==d.curPoints||o.baseLine!==d.curBaseLine?{curPoints:o.points,curBaseLine:o.baseLine}:null}}])}(Y.PureComponent);_te=Hc;jc(Hc,"displayName","Area");jc(Hc,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});jc(Hc,"getBaseValue",function(e,n,a,o){var d=e.layout,h=e.baseValue,f=n.props.baseValue,y=f??h;if(lt(y)&&typeof y=="number")return y;var b=d==="horizontal"?o:a,x=b.scale.domain();if(b.type==="number"){var T=Math.max(x[0],x[1]),S=Math.min(x[0],x[1]);return y==="dataMin"?S:y==="dataMax"||T<0?T:Math.max(Math.min(x[0],x[1]),0)}return y==="dataMin"?x[0]:y==="dataMax"?x[1]:x[0]});jc(Hc,"getComposedData",function(e){var n=e.props,a=e.item,o=e.xAxis,d=e.yAxis,h=e.xAxisTicks,f=e.yAxisTicks,y=e.bandSize,b=e.dataKey,x=e.stackedData,T=e.dataStartIndex,S=e.displayedData,N=e.offset,O=n.layout,A=x&&x.length,I=_te.getBaseValue(n,a,o,d),P=O==="horizontal",L=!1,F=S.map(function(G,B){var z;A?z=x[T+B]:(z=Ra(G,b),Array.isArray(z)?L=!0:z=[I,z]);var q=z[1]==null||A&&Ra(G,b)==null;return P?{x:aw({axis:o,ticks:h,bandSize:y,entry:G,index:B}),y:q?null:d.scale(z[1]),value:z,payload:G}:{x:q?null:o.scale(z[1]),y:aw({axis:d,ticks:f,bandSize:y,entry:G,index:B}),value:z,payload:G}}),V;return A||L?V=F.map(function(G){var B=Array.isArray(G.value)?G.value[0]:null;return P?{x:G.x,y:B!=null&&G.y!=null?d.scale(B):null}:{x:B!=null?o.scale(B):null,y:G.y}}):V=P?d.scale(I):o.scale(I),Cd({points:F,baseLine:V,layout:O,isRange:L},N)});jc(Hc,"renderDotItem",function(e,n){var a;if(ge.isValidElement(e))a=ge.cloneElement(e,n);else if(un(e))a=e(n);else{var o=An("recharts-area-dot",typeof e!="boolean"?e.className:""),d=n.key,h=bte(n,VHe);a=ge.createElement(UT,wh({},h,{key:d,className:o}))}return a});function kf(e){"@babel/helpers - typeof";return kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kf(e)}function qHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function XHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Tte(o.key),o)}}function JHe(e,n,a){return n&&XHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function QHe(e,n,a){return n=Nw(n),ZHe(e,Ste()?Reflect.construct(n,a||[],Nw(e).constructor):n.apply(e,a))}function ZHe(e,n){if(n&&(kf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return e7e(e)}function e7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ste(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ste=function(){return!!e})()}function Nw(e){return Nw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Nw(e)}function t7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&XD(e,n)}function XD(e,n){return XD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},XD(e,n)}function wte(e,n,a){return n=Tte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Tte(e){var n=n7e(e,"string");return kf(n)=="symbol"?n:n+""}function n7e(e,n){if(kf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(kf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function JD(){return JD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},JD.apply(this,arguments)}function r7e(e){var n=e.xAxisId,a=bj(),o=xj(),d=ate(n);return d==null?null:Y.createElement(og,JD({},d,{className:An("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:a,height:o},ticksGenerator:function(f){return _l(f,!0)}}))}var Ul=function(e){function n(){return qHe(this,n),QHe(this,n,arguments)}return t7e(n,e),JHe(n,[{key:"render",value:function(){return Y.createElement(r7e,this.props)}}])}(Y.Component);wte(Ul,"displayName","XAxis");wte(Ul,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function jf(e){"@babel/helpers - typeof";return jf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jf(e)}function i7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Rte(o.key),o)}}function s7e(e,n,a){return n&&a7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o7e(e,n,a){return n=Rw(n),c7e(e,Cte()?Reflect.construct(n,a||[],Rw(e).constructor):n.apply(e,a))}function c7e(e,n){if(n&&(jf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l7e(e)}function l7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cte=function(){return!!e})()}function Rw(e){return Rw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Rw(e)}function d7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&QD(e,n)}function QD(e,n){return QD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},QD(e,n)}function Nte(e,n,a){return n=Rte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Rte(e){var n=u7e(e,"string");return jf(n)=="symbol"?n:n+""}function u7e(e,n){if(jf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(jf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function ZD(){return ZD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},ZD.apply(this,arguments)}var h7e=function(n){var a=n.yAxisId,o=bj(),d=xj(),h=ste(a);return h==null?null:Y.createElement(og,ZD({},h,{className:An("recharts-".concat(h.axisType," ").concat(h.axisType),h.className),viewBox:{x:0,y:0,width:o,height:d},ticksGenerator:function(y){return _l(y,!0)}}))},Fl=function(e){function n(){return i7e(this,n),o7e(this,n,arguments)}return d7e(n,e),s7e(n,[{key:"render",value:function(){return Y.createElement(h7e,this.props)}}])}(Y.Component);Nte(Fl,"displayName","YAxis");Nte(Fl,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function bY(e){return g7e(e)||f7e(e)||m7e(e)||p7e()}function p7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m7e(e,n){if(e){if(typeof e=="string")return e2(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e2(e,n)}}function f7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function g7e(e){if(Array.isArray(e))return e2(e)}function e2(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var t2=function(n,a,o,d,h){var f=uo(n,Sj),y=uo(n,WT),b=[].concat(bY(f),bY(y)),x=uo(n,HT),T="".concat(d,"Id"),S=d[0],N=a;if(b.length&&(N=b.reduce(function(I,P){if(P.props[T]===o&&Vc(P.props,"extendDomain")&&lt(P.props[S])){var L=P.props[S];return[Math.min(I[0],L),Math.max(I[1],L)]}return I},N)),x.length){var O="".concat(S,"1"),A="".concat(S,"2");N=x.reduce(function(I,P){if(P.props[T]===o&&Vc(P.props,"extendDomain")&&lt(P.props[O])&&lt(P.props[A])){var L=P.props[O],F=P.props[A];return[Math.min(I[0],L,F),Math.max(I[1],L,F)]}return I},N)}return h&&h.length&&(N=h.reduce(function(I,P){return lt(P)?[Math.min(I[0],P),Math.max(I[1],P)]:I},N)),N},Ate={exports:{}};(function(e){var n=Object.prototype.hasOwnProperty,a="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(a=!1));function d(b,x,T){this.fn=b,this.context=x,this.once=T||!1}function h(b,x,T,S,N){if(typeof T!="function")throw new TypeError("The listener must be a function");var O=new d(T,S||b,N),A=a?a+x:x;return b._events[A]?b._events[A].fn?b._events[A]=[b._events[A],O]:b._events[A].push(O):(b._events[A]=O,b._eventsCount++),b}function f(b,x){--b._eventsCount===0?b._events=new o:delete b._events[x]}function y(){this._events=new o,this._eventsCount=0}y.prototype.eventNames=function(){var x=[],T,S;if(this._eventsCount===0)return x;for(S in T=this._events)n.call(T,S)&&x.push(a?S.slice(1):S);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(T)):x},y.prototype.listeners=function(x){var T=a?a+x:x,S=this._events[T];if(!S)return[];if(S.fn)return[S.fn];for(var N=0,O=S.length,A=new Array(O);N<O;N++)A[N]=S[N].fn;return A},y.prototype.listenerCount=function(x){var T=a?a+x:x,S=this._events[T];return S?S.fn?1:S.length:0},y.prototype.emit=function(x,T,S,N,O,A){var I=a?a+x:x;if(!this._events[I])return!1;var P=this._events[I],L=arguments.length,F,V;if(P.fn){switch(P.once&&this.removeListener(x,P.fn,void 0,!0),L){case 1:return P.fn.call(P.context),!0;case 2:return P.fn.call(P.context,T),!0;case 3:return P.fn.call(P.context,T,S),!0;case 4:return P.fn.call(P.context,T,S,N),!0;case 5:return P.fn.call(P.context,T,S,N,O),!0;case 6:return P.fn.call(P.context,T,S,N,O,A),!0}for(V=1,F=new Array(L-1);V<L;V++)F[V-1]=arguments[V];P.fn.apply(P.context,F)}else{var G=P.length,B;for(V=0;V<G;V++)switch(P[V].once&&this.removeListener(x,P[V].fn,void 0,!0),L){case 1:P[V].fn.call(P[V].context);break;case 2:P[V].fn.call(P[V].context,T);break;case 3:P[V].fn.call(P[V].context,T,S);break;case 4:P[V].fn.call(P[V].context,T,S,N);break;default:if(!F)for(B=1,F=new Array(L-1);B<L;B++)F[B-1]=arguments[B];P[V].fn.apply(P[V].context,F)}}return!0},y.prototype.on=function(x,T,S){return h(this,x,T,S,!1)},y.prototype.once=function(x,T,S){return h(this,x,T,S,!0)},y.prototype.removeListener=function(x,T,S,N){var O=a?a+x:x;if(!this._events[O])return this;if(!T)return f(this,O),this;var A=this._events[O];if(A.fn)A.fn===T&&(!N||A.once)&&(!S||A.context===S)&&f(this,O);else{for(var I=0,P=[],L=A.length;I<L;I++)(A[I].fn!==T||N&&!A[I].once||S&&A[I].context!==S)&&P.push(A[I]);P.length?this._events[O]=P.length===1?P[0]:P:f(this,O)}return this},y.prototype.removeAllListeners=function(x){var T;return x?(T=a?a+x:x,this._events[T]&&f(this,T)):(this._events=new o,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=a,y.EventEmitter=y,e.exports=y})(Ate);var v7e=Ate.exports;const y7e=ar(v7e);var g1=new y7e,v1="recharts.syncMouseEvents";function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},P0(e)}function _7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function b7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ite(o.key),o)}}function x7e(e,n,a){return n&&b7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y1(e,n,a){return n=Ite(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Ite(e){var n=E7e(e,"string");return P0(n)=="symbol"?n:n+""}function E7e(e,n){if(P0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(P0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var S7e=function(){function e(){_7e(this,e),y1(this,"activeIndex",0),y1(this,"coordinateList",[]),y1(this,"layout","horizontal")}return x7e(e,[{key:"setDetails",value:function(a){var o,d=a.coordinateList,h=d===void 0?null:d,f=a.container,y=f===void 0?null:f,b=a.layout,x=b===void 0?null:b,T=a.offset,S=T===void 0?null:T,N=a.mouseHandlerCallback,O=N===void 0?null:N;this.coordinateList=(o=h??this.coordinateList)!==null&&o!==void 0?o:[],this.container=y??this.container,this.layout=x??this.layout,this.offset=S??this.offset,this.mouseHandlerCallback=O??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(a){if(this.coordinateList.length!==0)switch(a.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(a){this.activeIndex=a}},{key:"spoofMouse",value:function(){var a,o;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var d=this.container.getBoundingClientRect(),h=d.x,f=d.y,y=d.height,b=this.coordinateList[this.activeIndex].coordinate,x=((a=window)===null||a===void 0?void 0:a.scrollX)||0,T=((o=window)===null||o===void 0?void 0:o.scrollY)||0,S=h+b+x,N=f+this.offset.top+y/2+T;this.mouseHandlerCallback({pageX:S,pageY:N})}}}])}();function w7e(e,n,a){if(a==="number"&&n===!0&&Array.isArray(e)){var o=e==null?void 0:e[0],d=e==null?void 0:e[1];if(o&&d&&lt(o)&&lt(d))return!0}return!1}function T7e(e,n,a,o){var d=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?n.x-d:a.left+.5,y:e==="horizontal"?a.top+.5:n.y-d,width:e==="horizontal"?o:a.width-1,height:e==="horizontal"?a.height-1:o}}function Ote(e){var n=e.cx,a=e.cy,o=e.radius,d=e.startAngle,h=e.endAngle,f=zi(n,a,o,d),y=zi(n,a,o,h);return{points:[f,y],cx:n,cy:a,radius:o,startAngle:d,endAngle:h}}function C7e(e,n,a){var o,d,h,f;if(e==="horizontal")o=n.x,h=o,d=a.top,f=a.top+a.height;else if(e==="vertical")d=n.y,f=d,o=a.left,h=a.left+a.width;else if(n.cx!=null&&n.cy!=null)if(e==="centric"){var y=n.cx,b=n.cy,x=n.innerRadius,T=n.outerRadius,S=n.angle,N=zi(y,b,x,S),O=zi(y,b,T,S);o=N.x,d=N.y,h=O.x,f=O.y}else return Ote(n);return[{x:o,y:d},{x:h,y:f}]}function D0(e){"@babel/helpers - typeof";return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},D0(e)}function xY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function DE(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?xY(Object(a),!0).forEach(function(o){N7e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function N7e(e,n,a){return n=R7e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function R7e(e){var n=A7e(e,"string");return D0(n)=="symbol"?n:n+""}function A7e(e,n){if(D0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(D0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function I7e(e){var n,a,o=e.element,d=e.tooltipEventType,h=e.isActive,f=e.activeCoordinate,y=e.activePayload,b=e.offset,x=e.activeTooltipIndex,T=e.tooltipAxisBandSize,S=e.layout,N=e.chartName,O=(n=o.props.cursor)!==null&&n!==void 0?n:(a=o.type.defaultProps)===null||a===void 0?void 0:a.cursor;if(!o||!O||!h||!f||N!=="ScatterChart"&&d!=="axis")return null;var A,I=ef;if(N==="ScatterChart")A=f,I=b8e;else if(N==="BarChart")A=T7e(S,f,b,T),I=gj;else if(S==="radial"){var P=Ote(f),L=P.cx,F=P.cy,V=P.radius,G=P.startAngle,B=P.endAngle;A={cx:L,cy:F,startAngle:G,endAngle:B,innerRadius:V,outerRadius:V},I=Iee}else A={points:C7e(S,f,b)},I=ef;var z=DE(DE(DE(DE({stroke:"#ccc",pointerEvents:"none"},b),A),gn(O,!1)),{},{payload:y,payloadIndex:x,className:An("recharts-tooltip-cursor",O.className)});return Y.isValidElement(O)?Y.cloneElement(O,z):Y.createElement(I,z)}var O7e=["item"],P7e=["children","className","width","height","style","compact","title","desc"];function Lf(e){"@babel/helpers - typeof";return Lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Lf(e)}function Wm(){return Wm=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Wm.apply(this,arguments)}function EY(e,n){return j7e(e)||k7e(e,n)||Dte(e,n)||D7e()}function D7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k7e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,h,f,y=[],b=!0,x=!1;try{if(h=(a=a.call(e)).next,n!==0)for(;!(b=(o=h.call(a)).done)&&(y.push(o.value),y.length!==n);b=!0);}catch(T){x=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(x)throw d}}return y}}function j7e(e){if(Array.isArray(e))return e}function SY(e,n){if(e==null)return{};var a=L7e(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function L7e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function M7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function U7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,kte(o.key),o)}}function F7e(e,n,a){return n&&U7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function V7e(e,n,a){return n=Aw(n),B7e(e,Pte()?Reflect.construct(n,a||[],Aw(e).constructor):n.apply(e,a))}function B7e(e,n){if(n&&(Lf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return G7e(e)}function G7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Pte=function(){return!!e})()}function Aw(e){return Aw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Aw(e)}function W7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&n2(e,n)}function n2(e,n){return n2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},n2(e,n)}function Mf(e){return z7e(e)||H7e(e)||Dte(e)||$7e()}function $7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dte(e,n){if(e){if(typeof e=="string")return r2(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r2(e,n)}}function H7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function z7e(e){if(Array.isArray(e))return r2(e)}function r2(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function wY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function We(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?wY(Object(a),!0).forEach(function(o){Kt(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Kt(e,n,a){return n=kte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function kte(e){var n=K7e(e,"string");return Lf(n)=="symbol"?n:n+""}function K7e(e,n){if(Lf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Lf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Y7e={xAxis:["bottom","top"],yAxis:["left","right"]},q7e={width:"100%",height:"100%"},jte={x:0,y:0};function kE(e){return e}var X7e=function(n,a){return a==="horizontal"?n.x:a==="vertical"?n.y:a==="centric"?n.angle:n.radius},J7e=function(n,a,o,d){var h=a.find(function(T){return T&&T.index===o});if(h){if(n==="horizontal")return{x:h.coordinate,y:d.y};if(n==="vertical")return{x:d.x,y:h.coordinate};if(n==="centric"){var f=h.coordinate,y=d.radius;return We(We(We({},d),zi(d.cx,d.cy,y,f)),{},{angle:f,radius:y})}var b=h.coordinate,x=d.angle;return We(We(We({},d),zi(d.cx,d.cy,b,x)),{},{angle:x,radius:b})}return jte},zT=function(n,a){var o=a.graphicalItems,d=a.dataStartIndex,h=a.dataEndIndex,f=(o??[]).reduce(function(y,b){var x=b.props.data;return x&&x.length?[].concat(Mf(y),Mf(x)):y},[]);return f.length>0?f:n&&n.length&&lt(d)&&lt(h)?n.slice(d,h+1):[]};function Lte(e){return e==="number"?[0,"auto"]:void 0}var i2=function(n,a,o,d){var h=n.graphicalItems,f=n.tooltipAxis,y=zT(a,n);return o<0||!h||!h.length||o>=y.length?null:h.reduce(function(b,x){var T,S=(T=x.props.data)!==null&&T!==void 0?T:a;S&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=o&&(S=S.slice(n.dataStartIndex,n.dataEndIndex+1));var N;if(f.dataKey&&!f.allowDuplicatedCategory){var O=S===void 0?y:S;N=AS(O,f.dataKey,d)}else N=S&&S[o]||y[o];return N?[].concat(Mf(b),[Nee(x,N)]):b},[])},TY=function(n,a,o,d){var h=d||{x:n.chartX,y:n.chartY},f=X7e(h,o),y=n.orderedTooltipTicks,b=n.tooltipAxis,x=n.tooltipTicks,T=tVe(f,y,x,b);if(T>=0&&x){var S=x[T]&&x[T].value,N=i2(n,a,T,S),O=J7e(o,y,T,h);return{activeTooltipIndex:T,activeLabel:S,activePayload:N,activeCoordinate:O}}return null},Q7e=function(n,a){var o=a.axes,d=a.graphicalItems,h=a.axisType,f=a.axisIdKey,y=a.stackGroups,b=a.dataStartIndex,x=a.dataEndIndex,T=n.layout,S=n.children,N=n.stackOffset,O=wee(T,h);return o.reduce(function(A,I){var P,L=I.type.defaultProps!==void 0?We(We({},I.type.defaultProps),I.props):I.props,F=L.type,V=L.dataKey,G=L.allowDataOverflow,B=L.allowDuplicatedCategory,z=L.scale,q=L.ticks,Z=L.includeHidden,ie=L[f];if(A[ie])return A;var ue=zT(n.data,{graphicalItems:d.filter(function(Le){var tt,Te=f in Le.props?Le.props[f]:(tt=Le.type.defaultProps)===null||tt===void 0?void 0:tt[f];return Te===ie}),dataStartIndex:b,dataEndIndex:x}),re=ue.length,pe,Se,fe;w7e(L.domain,G,F)&&(pe=xD(L.domain,null,G),O&&(F==="number"||z!=="auto")&&(fe=Cy(ue,V,"category")));var be=Lte(F);if(!pe||pe.length===0){var se,he=(se=L.domain)!==null&&se!==void 0?se:be;if(V){if(pe=Cy(ue,V,F),F==="category"&&O){var Q=WAe(pe);B&&Q?(Se=pe,pe=fw(0,re)):B||(pe=t9(he,pe,I).reduce(function(Le,tt){return Le.indexOf(tt)>=0?Le:[].concat(Mf(Le),[tt])},[]))}else if(F==="category")B?pe=pe.filter(function(Le){return Le!==""&&!yn(Le)}):pe=t9(he,pe,I).reduce(function(Le,tt){return Le.indexOf(tt)>=0||tt===""||yn(tt)?Le:[].concat(Mf(Le),[tt])},[]);else if(F==="number"){var le=sVe(ue,d.filter(function(Le){var tt,Te,De=f in Le.props?Le.props[f]:(tt=Le.type.defaultProps)===null||tt===void 0?void 0:tt[f],qe="hide"in Le.props?Le.props.hide:(Te=Le.type.defaultProps)===null||Te===void 0?void 0:Te.hide;return De===ie&&(Z||!qe)}),V,h,T);le&&(pe=le)}O&&(F==="number"||z!=="auto")&&(fe=Cy(ue,V,"category"))}else O?pe=fw(0,re):y&&y[ie]&&y[ie].hasStack&&F==="number"?pe=N==="expand"?[0,1]:Cee(y[ie].stackGroups,b,x):pe=See(ue,d.filter(function(Le){var tt=f in Le.props?Le.props[f]:Le.type.defaultProps[f],Te="hide"in Le.props?Le.props.hide:Le.type.defaultProps.hide;return tt===ie&&(Z||!Te)}),F,T,!0);if(F==="number")pe=t2(S,pe,ie,h,q),he&&(pe=xD(he,pe,G));else if(F==="category"&&he){var we=he,Ue=pe.every(function(Le){return we.indexOf(Le)>=0});Ue&&(pe=we)}}return We(We({},A),{},Kt({},ie,We(We({},L),{},{axisType:h,domain:pe,categoricalDomain:fe,duplicateDomain:Se,originalDomain:(P=L.domain)!==null&&P!==void 0?P:be,isCategorical:O,layout:T})))},{})},Z7e=function(n,a){var o=a.graphicalItems,d=a.Axis,h=a.axisType,f=a.axisIdKey,y=a.stackGroups,b=a.dataStartIndex,x=a.dataEndIndex,T=n.layout,S=n.children,N=zT(n.data,{graphicalItems:o,dataStartIndex:b,dataEndIndex:x}),O=N.length,A=wee(T,h),I=-1;return o.reduce(function(P,L){var F=L.type.defaultProps!==void 0?We(We({},L.type.defaultProps),L.props):L.props,V=F[f],G=Lte("number");if(!P[V]){I++;var B;return A?B=fw(0,O):y&&y[V]&&y[V].hasStack?(B=Cee(y[V].stackGroups,b,x),B=t2(S,B,V,h)):(B=xD(G,See(N,o.filter(function(z){var q,Z,ie=f in z.props?z.props[f]:(q=z.type.defaultProps)===null||q===void 0?void 0:q[f],ue="hide"in z.props?z.props.hide:(Z=z.type.defaultProps)===null||Z===void 0?void 0:Z.hide;return ie===V&&!ue}),"number",T),d.defaultProps.allowDataOverflow),B=t2(S,B,V,h)),We(We({},P),{},Kt({},V,We(We({axisType:h},d.defaultProps),{},{hide:!0,orientation:lo(Y7e,"".concat(h,".").concat(I%2),null),domain:B,originalDomain:G,isCategorical:A,layout:T})))}return P},{})},eze=function(n,a){var o=a.axisType,d=o===void 0?"xAxis":o,h=a.AxisComp,f=a.graphicalItems,y=a.stackGroups,b=a.dataStartIndex,x=a.dataEndIndex,T=n.children,S="".concat(d,"Id"),N=uo(T,h),O={};return N&&N.length?O=Q7e(n,{axes:N,graphicalItems:f,axisType:d,axisIdKey:S,stackGroups:y,dataStartIndex:b,dataEndIndex:x}):f&&f.length&&(O=Z7e(n,{Axis:h,graphicalItems:f,axisType:d,axisIdKey:S,stackGroups:y,dataStartIndex:b,dataEndIndex:x})),O},tze=function(n){var a=kd(n),o=_l(a,!1,!0);return{tooltipTicks:o,orderedTooltipTicks:Wk(o,function(d){return d.coordinate}),tooltipAxis:a,tooltipAxisBandSize:sw(a,o)}},CY=function(n){var a=n.children,o=n.defaultShowTooltip,d=xs(a,Tf),h=0,f=0;return n.data&&n.data.length!==0&&(f=n.data.length-1),d&&d.props&&(d.props.startIndex>=0&&(h=d.props.startIndex),d.props.endIndex>=0&&(f=d.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:h,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!o}},nze=function(n){return!n||!n.length?!1:n.some(function(a){var o=Sl(a&&a.type);return o&&o.indexOf("Bar")>=0})},NY=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},rze=function(n,a){var o=n.props,d=n.graphicalItems,h=n.xAxisMap,f=h===void 0?{}:h,y=n.yAxisMap,b=y===void 0?{}:y,x=o.width,T=o.height,S=o.children,N=o.margin||{},O=xs(S,Tf),A=xs(S,Jm),I=Object.keys(b).reduce(function(B,z){var q=b[z],Z=q.orientation;return!q.mirror&&!q.hide?We(We({},B),{},Kt({},Z,B[Z]+q.width)):B},{left:N.left||0,right:N.right||0}),P=Object.keys(f).reduce(function(B,z){var q=f[z],Z=q.orientation;return!q.mirror&&!q.hide?We(We({},B),{},Kt({},Z,lo(B,"".concat(Z))+q.height)):B},{top:N.top||0,bottom:N.bottom||0}),L=We(We({},P),I),F=L.bottom;O&&(L.bottom+=O.props.height||Tf.defaultProps.height),A&&a&&(L=iVe(L,d,o,a));var V=x-L.left-L.right,G=T-L.top-L.bottom;return We(We({brushBottom:F},L),{},{width:Math.max(V,0),height:Math.max(G,0)})},ize=function(n,a){if(a==="xAxis")return n[a].width;if(a==="yAxis")return n[a].height},Mte=function(n){var a=n.chartName,o=n.GraphicalChild,d=n.defaultTooltipEventType,h=d===void 0?"axis":d,f=n.validateTooltipEventTypes,y=f===void 0?["axis"]:f,b=n.axisComponents,x=n.legendContent,T=n.formatAxisMap,S=n.defaultProps,N=function(L,F){var V=F.graphicalItems,G=F.stackGroups,B=F.offset,z=F.updateId,q=F.dataStartIndex,Z=F.dataEndIndex,ie=L.barSize,ue=L.layout,re=L.barGap,pe=L.barCategoryGap,Se=L.maxBarSize,fe=NY(ue),be=fe.numericAxisName,se=fe.cateAxisName,he=nze(V),Q=[];return V.forEach(function(le,we){var Ue=zT(L.data,{graphicalItems:[le],dataStartIndex:q,dataEndIndex:Z}),Le=le.type.defaultProps!==void 0?We(We({},le.type.defaultProps),le.props):le.props,tt=Le.dataKey,Te=Le.maxBarSize,De=Le["".concat(be,"Id")],qe=Le["".concat(se,"Id")],It={},rt=b.reduce(function(li,is){var zl=F["".concat(is.axisType,"Map")],at=Le["".concat(is.axisType,"Id")];zl&&zl[at]||is.axisType==="zAxis"||Vh();var Vt=zl[at];return We(We({},li),{},Kt(Kt({},is.axisType,Vt),"".concat(is.axisType,"Ticks"),_l(Vt)))},It),Fe=rt[se],ut=rt["".concat(se,"Ticks")],vt=G&&G[De]&&G[De].hasStack&&yVe(le,G[De].stackGroups),Ce=Sl(le.type).indexOf("Bar")>=0,xt=sw(Fe,ut),Nt=[],pt=he&&nVe({barSize:ie,stackGroups:G,totalSize:ize(rt,se)});if(Ce){var Xe,ye,Ve=yn(Te)?Se:Te,ht=(Xe=(ye=sw(Fe,ut,!0))!==null&&ye!==void 0?ye:Ve)!==null&&Xe!==void 0?Xe:0;Nt=rVe({barGap:re,barCategoryGap:pe,bandSize:ht!==xt?ht:xt,sizeList:pt[qe],maxBarSize:Ve}),ht!==xt&&(Nt=Nt.map(function(li){return We(We({},li),{},{position:We(We({},li.position),{},{offset:li.position.offset-ht/2})})}))}var Bn=le&&le.type&&le.type.getComposedData;Bn&&Q.push({props:We(We({},Bn(We(We({},rt),{},{displayedData:Ue,props:L,dataKey:tt,item:le,bandSize:xt,barPosition:Nt,offset:B,stackedData:vt,layout:ue,dataStartIndex:q,dataEndIndex:Z}))),{},Kt(Kt(Kt({key:le.key||"item-".concat(we)},be,rt[be]),se,rt[se]),"animationId",z)),childIndex:tIe(le,L.children),item:le})}),Q},O=function(L,F){var V=L.props,G=L.dataStartIndex,B=L.dataEndIndex,z=L.updateId;if(!q7({props:V}))return null;var q=V.children,Z=V.layout,ie=V.stackOffset,ue=V.data,re=V.reverseStackOrder,pe=NY(Z),Se=pe.numericAxisName,fe=pe.cateAxisName,be=uo(q,o),se=fVe(ue,be,"".concat(Se,"Id"),"".concat(fe,"Id"),ie,re),he=b.reduce(function(Le,tt){var Te="".concat(tt.axisType,"Map");return We(We({},Le),{},Kt({},Te,eze(V,We(We({},tt),{},{graphicalItems:be,stackGroups:tt.axisType===Se&&se,dataStartIndex:G,dataEndIndex:B}))))},{}),Q=rze(We(We({},he),{},{props:V,graphicalItems:be}),F==null?void 0:F.legendBBox);Object.keys(he).forEach(function(Le){he[Le]=T(V,he[Le],Q,Le.replace("Map",""),a)});var le=he["".concat(fe,"Map")],we=tze(le),Ue=N(V,We(We({},he),{},{dataStartIndex:G,dataEndIndex:B,updateId:z,graphicalItems:be,stackGroups:se,offset:Q}));return We(We({formattedGraphicalItems:Ue,graphicalItems:be,offset:Q,stackGroups:se},we),he)},A=function(P){function L(F){var V,G,B;return M7e(this,L),B=V7e(this,L,[F]),Kt(B,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Kt(B,"accessibilityManager",new S7e),Kt(B,"handleLegendBBoxUpdate",function(z){if(z){var q=B.state,Z=q.dataStartIndex,ie=q.dataEndIndex,ue=q.updateId;B.setState(We({legendBBox:z},O({props:B.props,dataStartIndex:Z,dataEndIndex:ie,updateId:ue},We(We({},B.state),{},{legendBBox:z}))))}}),Kt(B,"handleReceiveSyncEvent",function(z,q,Z){if(B.props.syncId===z){if(Z===B.eventEmitterSymbol&&typeof B.props.syncMethod!="function")return;B.applySyncEvent(q)}}),Kt(B,"handleBrushChange",function(z){var q=z.startIndex,Z=z.endIndex;if(q!==B.state.dataStartIndex||Z!==B.state.dataEndIndex){var ie=B.state.updateId;B.setState(function(){return We({dataStartIndex:q,dataEndIndex:Z},O({props:B.props,dataStartIndex:q,dataEndIndex:Z,updateId:ie},B.state))}),B.triggerSyncEvent({dataStartIndex:q,dataEndIndex:Z})}}),Kt(B,"handleMouseEnter",function(z){var q=B.getMouseInfo(z);if(q){var Z=We(We({},q),{},{isTooltipActive:!0});B.setState(Z),B.triggerSyncEvent(Z);var ie=B.props.onMouseEnter;un(ie)&&ie(Z,z)}}),Kt(B,"triggeredAfterMouseMove",function(z){var q=B.getMouseInfo(z),Z=q?We(We({},q),{},{isTooltipActive:!0}):{isTooltipActive:!1};B.setState(Z),B.triggerSyncEvent(Z);var ie=B.props.onMouseMove;un(ie)&&ie(Z,z)}),Kt(B,"handleItemMouseEnter",function(z){B.setState(function(){return{isTooltipActive:!0,activeItem:z,activePayload:z.tooltipPayload,activeCoordinate:z.tooltipPosition||{x:z.cx,y:z.cy}}})}),Kt(B,"handleItemMouseLeave",function(){B.setState(function(){return{isTooltipActive:!1}})}),Kt(B,"handleMouseMove",function(z){z.persist(),B.throttleTriggeredAfterMouseMove(z)}),Kt(B,"handleMouseLeave",function(z){B.throttleTriggeredAfterMouseMove.cancel();var q={isTooltipActive:!1};B.setState(q),B.triggerSyncEvent(q);var Z=B.props.onMouseLeave;un(Z)&&Z(q,z)}),Kt(B,"handleOuterEvent",function(z){var q=eIe(z),Z=lo(B.props,"".concat(q));if(q&&un(Z)){var ie,ue;/.*touch.*/i.test(q)?ue=B.getMouseInfo(z.changedTouches[0]):ue=B.getMouseInfo(z),Z((ie=ue)!==null&&ie!==void 0?ie:{},z)}}),Kt(B,"handleClick",function(z){var q=B.getMouseInfo(z);if(q){var Z=We(We({},q),{},{isTooltipActive:!0});B.setState(Z),B.triggerSyncEvent(Z);var ie=B.props.onClick;un(ie)&&ie(Z,z)}}),Kt(B,"handleMouseDown",function(z){var q=B.props.onMouseDown;if(un(q)){var Z=B.getMouseInfo(z);q(Z,z)}}),Kt(B,"handleMouseUp",function(z){var q=B.props.onMouseUp;if(un(q)){var Z=B.getMouseInfo(z);q(Z,z)}}),Kt(B,"handleTouchMove",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.throttleTriggeredAfterMouseMove(z.changedTouches[0])}),Kt(B,"handleTouchStart",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseDown(z.changedTouches[0])}),Kt(B,"handleTouchEnd",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseUp(z.changedTouches[0])}),Kt(B,"handleDoubleClick",function(z){var q=B.props.onDoubleClick;if(un(q)){var Z=B.getMouseInfo(z);q(Z,z)}}),Kt(B,"handleContextMenu",function(z){var q=B.props.onContextMenu;if(un(q)){var Z=B.getMouseInfo(z);q(Z,z)}}),Kt(B,"triggerSyncEvent",function(z){B.props.syncId!==void 0&&g1.emit(v1,B.props.syncId,z,B.eventEmitterSymbol)}),Kt(B,"applySyncEvent",function(z){var q=B.props,Z=q.layout,ie=q.syncMethod,ue=B.state.updateId,re=z.dataStartIndex,pe=z.dataEndIndex;if(z.dataStartIndex!==void 0||z.dataEndIndex!==void 0)B.setState(We({dataStartIndex:re,dataEndIndex:pe},O({props:B.props,dataStartIndex:re,dataEndIndex:pe,updateId:ue},B.state)));else if(z.activeTooltipIndex!==void 0){var Se=z.chartX,fe=z.chartY,be=z.activeTooltipIndex,se=B.state,he=se.offset,Q=se.tooltipTicks;if(!he)return;if(typeof ie=="function")be=ie(Q,z);else if(ie==="value"){be=-1;for(var le=0;le<Q.length;le++)if(Q[le].value===z.activeLabel){be=le;break}}var we=We(We({},he),{},{x:he.left,y:he.top}),Ue=Math.min(Se,we.x+we.width),Le=Math.min(fe,we.y+we.height),tt=Q[be]&&Q[be].value,Te=i2(B.state,B.props.data,be),De=Q[be]?{x:Z==="horizontal"?Q[be].coordinate:Ue,y:Z==="horizontal"?Le:Q[be].coordinate}:jte;B.setState(We(We({},z),{},{activeLabel:tt,activeCoordinate:De,activePayload:Te,activeTooltipIndex:be}))}else B.setState(z)}),Kt(B,"renderCursor",function(z){var q,Z=B.state,ie=Z.isTooltipActive,ue=Z.activeCoordinate,re=Z.activePayload,pe=Z.offset,Se=Z.activeTooltipIndex,fe=Z.tooltipAxisBandSize,be=B.getTooltipEventType(),se=(q=z.props.active)!==null&&q!==void 0?q:ie,he=B.props.layout,Q=z.key||"_recharts-cursor";return ge.createElement(I7e,{key:Q,activeCoordinate:ue,activePayload:re,activeTooltipIndex:Se,chartName:a,element:z,isActive:se,layout:he,offset:pe,tooltipAxisBandSize:fe,tooltipEventType:be})}),Kt(B,"renderPolarAxis",function(z,q,Z){var ie=lo(z,"type.axisType"),ue=lo(B.state,"".concat(ie,"Map")),re=z.type.defaultProps,pe=re!==void 0?We(We({},re),z.props):z.props,Se=ue&&ue[pe["".concat(ie,"Id")]];return Y.cloneElement(z,We(We({},Se),{},{className:An(ie,Se.className),key:z.key||"".concat(q,"-").concat(Z),ticks:_l(Se,!0)}))}),Kt(B,"renderPolarGrid",function(z){var q=z.props,Z=q.radialLines,ie=q.polarAngles,ue=q.polarRadius,re=B.state,pe=re.radiusAxisMap,Se=re.angleAxisMap,fe=kd(pe),be=kd(Se),se=be.cx,he=be.cy,Q=be.innerRadius,le=be.outerRadius;return Y.cloneElement(z,{polarAngles:Array.isArray(ie)?ie:_l(be,!0).map(function(we){return we.coordinate}),polarRadius:Array.isArray(ue)?ue:_l(fe,!0).map(function(we){return we.coordinate}),cx:se,cy:he,innerRadius:Q,outerRadius:le,key:z.key||"polar-grid",radialLines:Z})}),Kt(B,"renderLegend",function(){var z=B.state.formattedGraphicalItems,q=B.props,Z=q.children,ie=q.width,ue=q.height,re=B.props.margin||{},pe=ie-(re.left||0)-(re.right||0),Se=xee({children:Z,formattedGraphicalItems:z,legendWidth:pe,legendContent:x});if(!Se)return null;var fe=Se.item,be=SY(Se,O7e);return Y.cloneElement(fe,We(We({},be),{},{chartWidth:ie,chartHeight:ue,margin:re,onBBoxUpdate:B.handleLegendBBoxUpdate}))}),Kt(B,"renderTooltip",function(){var z,q=B.props,Z=q.children,ie=q.accessibilityLayer,ue=xs(Z,Ha);if(!ue)return null;var re=B.state,pe=re.isTooltipActive,Se=re.activeCoordinate,fe=re.activePayload,be=re.activeLabel,se=re.offset,he=(z=ue.props.active)!==null&&z!==void 0?z:pe;return Y.cloneElement(ue,{viewBox:We(We({},se),{},{x:se.left,y:se.top}),active:he,label:be,payload:he?fe:[],coordinate:Se,accessibilityLayer:ie})}),Kt(B,"renderBrush",function(z){var q=B.props,Z=q.margin,ie=q.data,ue=B.state,re=ue.offset,pe=ue.dataStartIndex,Se=ue.dataEndIndex,fe=ue.updateId;return Y.cloneElement(z,{key:z.key||"_recharts-brush",onChange:AE(B.handleBrushChange,z.props.onChange),data:ie,x:lt(z.props.x)?z.props.x:re.left,y:lt(z.props.y)?z.props.y:re.top+re.height+re.brushBottom-(Z.bottom||0),width:lt(z.props.width)?z.props.width:re.width,startIndex:pe,endIndex:Se,updateId:"brush-".concat(fe)})}),Kt(B,"renderReferenceElement",function(z,q,Z){if(!z)return null;var ie=B,ue=ie.clipPathId,re=B.state,pe=re.xAxisMap,Se=re.yAxisMap,fe=re.offset,be=z.type.defaultProps||{},se=z.props,he=se.xAxisId,Q=he===void 0?be.xAxisId:he,le=se.yAxisId,we=le===void 0?be.yAxisId:le;return Y.cloneElement(z,{key:z.key||"".concat(q,"-").concat(Z),xAxis:pe[Q],yAxis:Se[we],viewBox:{x:fe.left,y:fe.top,width:fe.width,height:fe.height},clipPathId:ue})}),Kt(B,"renderActivePoints",function(z){var q=z.item,Z=z.activePoint,ie=z.basePoint,ue=z.childIndex,re=z.isRange,pe=[],Se=q.props.key,fe=q.item.type.defaultProps!==void 0?We(We({},q.item.type.defaultProps),q.item.props):q.item.props,be=fe.activeDot,se=fe.dataKey,he=We(We({index:ue,dataKey:se,cx:Z.x,cy:Z.y,r:4,fill:fj(q.item),strokeWidth:2,stroke:"#fff",payload:Z.payload,value:Z.value},gn(be,!1)),IS(be));return pe.push(L.renderActiveDot(be,he,"".concat(Se,"-activePoint-").concat(ue))),ie?pe.push(L.renderActiveDot(be,We(We({},he),{},{cx:ie.x,cy:ie.y}),"".concat(Se,"-basePoint-").concat(ue))):re&&pe.push(null),pe}),Kt(B,"renderGraphicChild",function(z,q,Z){var ie=B.filterFormatItem(z,q,Z);if(!ie)return null;var ue=B.getTooltipEventType(),re=B.state,pe=re.isTooltipActive,Se=re.tooltipAxis,fe=re.activeTooltipIndex,be=re.activeLabel,se=B.props.children,he=xs(se,Ha),Q=ie.props,le=Q.points,we=Q.isRange,Ue=Q.baseLine,Le=ie.item.type.defaultProps!==void 0?We(We({},ie.item.type.defaultProps),ie.item.props):ie.item.props,tt=Le.activeDot,Te=Le.hide,De=Le.activeBar,qe=Le.activeShape,It=!!(!Te&&pe&&he&&(tt||De||qe)),rt={};ue!=="axis"&&he&&he.props.trigger==="click"?rt={onClick:AE(B.handleItemMouseEnter,z.props.onClick)}:ue!=="axis"&&(rt={onMouseLeave:AE(B.handleItemMouseLeave,z.props.onMouseLeave),onMouseEnter:AE(B.handleItemMouseEnter,z.props.onMouseEnter)});var Fe=Y.cloneElement(z,We(We({},ie.props),rt));function ut(is){return typeof Se.dataKey=="function"?Se.dataKey(is.payload):null}if(It)if(fe>=0){var vt,Ce;if(Se.dataKey&&!Se.allowDuplicatedCategory){var xt=typeof Se.dataKey=="function"?ut:"payload.".concat(Se.dataKey.toString());vt=AS(le,xt,be),Ce=we&&Ue&&AS(Ue,xt,be)}else vt=le==null?void 0:le[fe],Ce=we&&Ue&&Ue[fe];if(qe||De){var Nt=z.props.activeIndex!==void 0?z.props.activeIndex:fe;return[Y.cloneElement(z,We(We(We({},ie.props),rt),{},{activeIndex:Nt})),null,null]}if(!yn(vt))return[Fe].concat(Mf(B.renderActivePoints({item:ie,activePoint:vt,basePoint:Ce,childIndex:fe,isRange:we})))}else{var pt,Xe=(pt=B.getItemByXY(B.state.activeCoordinate))!==null&&pt!==void 0?pt:{graphicalItem:Fe},ye=Xe.graphicalItem,Ve=ye.item,ht=Ve===void 0?z:Ve,Bn=ye.childIndex,li=We(We(We({},ie.props),rt),{},{activeIndex:Bn});return[Y.cloneElement(ht,li),null,null]}return we?[Fe,null,null]:[Fe,null]}),Kt(B,"renderCustomized",function(z,q,Z){return Y.cloneElement(z,We(We({key:"recharts-customized-".concat(Z)},B.props),B.state))}),Kt(B,"renderMap",{CartesianGrid:{handler:kE,once:!0},ReferenceArea:{handler:B.renderReferenceElement},ReferenceLine:{handler:kE},ReferenceDot:{handler:B.renderReferenceElement},XAxis:{handler:kE},YAxis:{handler:kE},Brush:{handler:B.renderBrush,once:!0},Bar:{handler:B.renderGraphicChild},Line:{handler:B.renderGraphicChild},Area:{handler:B.renderGraphicChild},Radar:{handler:B.renderGraphicChild},RadialBar:{handler:B.renderGraphicChild},Scatter:{handler:B.renderGraphicChild},Pie:{handler:B.renderGraphicChild},Funnel:{handler:B.renderGraphicChild},Tooltip:{handler:B.renderCursor,once:!0},PolarGrid:{handler:B.renderPolarGrid,once:!0},PolarAngleAxis:{handler:B.renderPolarAxis},PolarRadiusAxis:{handler:B.renderPolarAxis},Customized:{handler:B.renderCustomized}}),B.clipPathId="".concat((V=F.id)!==null&&V!==void 0?V:eg("recharts"),"-clip"),B.throttleTriggeredAfterMouseMove=bZ(B.triggeredAfterMouseMove,(G=F.throttleDelay)!==null&&G!==void 0?G:1e3/60),B.state={},B}return W7e(L,P),F7e(L,[{key:"componentDidMount",value:function(){var V,G;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(V=this.props.margin.left)!==null&&V!==void 0?V:0,top:(G=this.props.margin.top)!==null&&G!==void 0?G:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var V=this.props,G=V.children,B=V.data,z=V.height,q=V.layout,Z=xs(G,Ha);if(Z){var ie=Z.props.defaultIndex;if(!(typeof ie!="number"||ie<0||ie>this.state.tooltipTicks.length-1)){var ue=this.state.tooltipTicks[ie]&&this.state.tooltipTicks[ie].value,re=i2(this.state,B,ie,ue),pe=this.state.tooltipTicks[ie].coordinate,Se=(this.state.offset.top+z)/2,fe=q==="horizontal",be=fe?{x:pe,y:Se}:{y:pe,x:Se},se=this.state.formattedGraphicalItems.find(function(Q){var le=Q.item;return le.type.name==="Scatter"});se&&(be=We(We({},be),se.props.points[ie].tooltipPosition),re=se.props.points[ie].tooltipPayload);var he={activeTooltipIndex:ie,isTooltipActive:!0,activeLabel:ue,activePayload:re,activeCoordinate:be};this.setState(he),this.renderCursor(Z),this.accessibilityManager.setIndex(ie)}}}},{key:"getSnapshotBeforeUpdate",value:function(V,G){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==G.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==V.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==V.margin){var B,z;this.accessibilityManager.setDetails({offset:{left:(B=this.props.margin.left)!==null&&B!==void 0?B:0,top:(z=this.props.margin.top)!==null&&z!==void 0?z:0}})}return null}},{key:"componentDidUpdate",value:function(V){LP([xs(V.children,Ha)],[xs(this.props.children,Ha)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var V=xs(this.props.children,Ha);if(V&&typeof V.props.shared=="boolean"){var G=V.props.shared?"axis":"item";return y.indexOf(G)>=0?G:h}return h}},{key:"getMouseInfo",value:function(V){if(!this.container)return null;var G=this.container,B=G.getBoundingClientRect(),z=NUe(B),q={chartX:Math.round(V.pageX-z.left),chartY:Math.round(V.pageY-z.top)},Z=B.width/G.offsetWidth||1,ie=this.inRange(q.chartX,q.chartY,Z);if(!ie)return null;var ue=this.state,re=ue.xAxisMap,pe=ue.yAxisMap,Se=this.getTooltipEventType(),fe=TY(this.state,this.props.data,this.props.layout,ie);if(Se!=="axis"&&re&&pe){var be=kd(re).scale,se=kd(pe).scale,he=be&&be.invert?be.invert(q.chartX):null,Q=se&&se.invert?se.invert(q.chartY):null;return We(We({},q),{},{xValue:he,yValue:Q},fe)}return fe?We(We({},q),fe):null}},{key:"inRange",value:function(V,G){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,z=this.props.layout,q=V/B,Z=G/B;if(z==="horizontal"||z==="vertical"){var ie=this.state.offset,ue=q>=ie.left&&q<=ie.left+ie.width&&Z>=ie.top&&Z<=ie.top+ie.height;return ue?{x:q,y:Z}:null}var re=this.state,pe=re.angleAxisMap,Se=re.radiusAxisMap;if(pe&&Se){var fe=kd(pe);return i9({x:q,y:Z},fe)}return null}},{key:"parseEventsOfWrapper",value:function(){var V=this.props.children,G=this.getTooltipEventType(),B=xs(V,Ha),z={};B&&G==="axis"&&(B.props.trigger==="click"?z={onClick:this.handleClick}:z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var q=IS(this.props,this.handleOuterEvent);return We(We({},q),z)}},{key:"addListener",value:function(){g1.on(v1,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){g1.removeListener(v1,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(V,G,B){for(var z=this.state.formattedGraphicalItems,q=0,Z=z.length;q<Z;q++){var ie=z[q];if(ie.item===V||ie.props.key===V.key||G===Sl(ie.item.type)&&B===ie.childIndex)return ie}return null}},{key:"renderClipPath",value:function(){var V=this.clipPathId,G=this.state.offset,B=G.left,z=G.top,q=G.height,Z=G.width;return ge.createElement("defs",null,ge.createElement("clipPath",{id:V},ge.createElement("rect",{x:B,y:z,height:q,width:Z})))}},{key:"getXScales",value:function(){var V=this.state.xAxisMap;return V?Object.entries(V).reduce(function(G,B){var z=EY(B,2),q=z[0],Z=z[1];return We(We({},G),{},Kt({},q,Z.scale))},{}):null}},{key:"getYScales",value:function(){var V=this.state.yAxisMap;return V?Object.entries(V).reduce(function(G,B){var z=EY(B,2),q=z[0],Z=z[1];return We(We({},G),{},Kt({},q,Z.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(V){var G;return(G=this.state.xAxisMap)===null||G===void 0||(G=G[V])===null||G===void 0?void 0:G.scale}},{key:"getYScaleByAxisId",value:function(V){var G;return(G=this.state.yAxisMap)===null||G===void 0||(G=G[V])===null||G===void 0?void 0:G.scale}},{key:"getItemByXY",value:function(V){var G=this.state,B=G.formattedGraphicalItems,z=G.activeItem;if(B&&B.length)for(var q=0,Z=B.length;q<Z;q++){var ie=B[q],ue=ie.props,re=ie.item,pe=re.type.defaultProps!==void 0?We(We({},re.type.defaultProps),re.props):re.props,Se=Sl(re.type);if(Se==="Bar"){var fe=(ue.data||[]).find(function(Q){return d8e(V,Q)});if(fe)return{graphicalItem:ie,payload:fe}}else if(Se==="RadialBar"){var be=(ue.data||[]).find(function(Q){return i9(V,Q)});if(be)return{graphicalItem:ie,payload:be}}else if(FT(ie,z)||VT(ie,z)||N0(ie,z)){var se=pGe({graphicalItem:ie,activeTooltipItem:z,itemData:pe.data}),he=pe.activeIndex===void 0?se:pe.activeIndex;return{graphicalItem:We(We({},ie),{},{childIndex:he}),payload:N0(ie,z)?pe.data[se]:ie.props.data[se]}}}return null}},{key:"render",value:function(){var V=this;if(!q7(this))return null;var G=this.props,B=G.children,z=G.className,q=G.width,Z=G.height,ie=G.style,ue=G.compact,re=G.title,pe=G.desc,Se=SY(G,P7e),fe=gn(Se,!1);if(ue)return ge.createElement(nY,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ge.createElement(UP,Wm({},fe,{width:q,height:Z,title:re,desc:pe}),this.renderClipPath(),J7(B,this.renderMap)));if(this.props.accessibilityLayer){var be,se;fe.tabIndex=(be=this.props.tabIndex)!==null&&be!==void 0?be:0,fe.role=(se=this.props.role)!==null&&se!==void 0?se:"application",fe.onKeyDown=function(Q){V.accessibilityManager.keyboardEvent(Q)},fe.onFocus=function(){V.accessibilityManager.focus()}}var he=this.parseEventsOfWrapper();return ge.createElement(nY,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ge.createElement("div",Wm({className:An("recharts-wrapper",z),style:We({position:"relative",cursor:"default",width:q,height:Z},ie)},he,{ref:function(le){V.container=le}}),ge.createElement(UP,Wm({},fe,{width:q,height:Z,title:re,desc:pe,style:q7e}),this.renderClipPath(),J7(B,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Y.Component);Kt(A,"displayName",a),Kt(A,"defaultProps",We({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},S)),Kt(A,"getDerivedStateFromProps",function(P,L){var F=P.dataKey,V=P.data,G=P.children,B=P.width,z=P.height,q=P.layout,Z=P.stackOffset,ie=P.margin,ue=L.dataStartIndex,re=L.dataEndIndex;if(L.updateId===void 0){var pe=CY(P);return We(We(We({},pe),{},{updateId:0},O(We(We({props:P},pe),{},{updateId:0}),L)),{},{prevDataKey:F,prevData:V,prevWidth:B,prevHeight:z,prevLayout:q,prevStackOffset:Z,prevMargin:ie,prevChildren:G})}if(F!==L.prevDataKey||V!==L.prevData||B!==L.prevWidth||z!==L.prevHeight||q!==L.prevLayout||Z!==L.prevStackOffset||!Xm(ie,L.prevMargin)){var Se=CY(P),fe={chartX:L.chartX,chartY:L.chartY,isTooltipActive:L.isTooltipActive},be=We(We({},TY(L,V,q)),{},{updateId:L.updateId+1}),se=We(We(We({},Se),fe),be);return We(We(We({},se),O(We({props:P},se),L)),{},{prevDataKey:F,prevData:V,prevWidth:B,prevHeight:z,prevLayout:q,prevStackOffset:Z,prevMargin:ie,prevChildren:G})}if(!LP(G,L.prevChildren)){var he,Q,le,we,Ue=xs(G,Tf),Le=Ue&&(he=(Q=Ue.props)===null||Q===void 0?void 0:Q.startIndex)!==null&&he!==void 0?he:ue,tt=Ue&&(le=(we=Ue.props)===null||we===void 0?void 0:we.endIndex)!==null&&le!==void 0?le:re,Te=Le!==ue||tt!==re,De=!yn(V),qe=De&&!Te?L.updateId:L.updateId+1;return We(We({updateId:qe},O(We(We({props:P},L),{},{updateId:qe,dataStartIndex:Le,dataEndIndex:tt}),L)),{},{prevChildren:G,dataStartIndex:Le,dataEndIndex:tt})}return null}),Kt(A,"renderActiveDot",function(P,L,F){var V;return Y.isValidElement(P)?V=Y.cloneElement(P,L):un(P)?V=P(L):V=ge.createElement(UT,L),ge.createElement(mr,{className:"recharts-active-dot",key:F},V)});var I=Y.forwardRef(function(L,F){return ge.createElement(A,Wm({},L,{ref:F}))});return I.displayName=A.displayName,I},Ute=Mte({chartName:"LineChart",GraphicalChild:cg,axisComponents:[{axisType:"xAxis",AxisComp:Ul},{axisType:"yAxis",AxisComp:Fl}],formatAxisMap:Jee}),Cj=Mte({chartName:"AreaChart",GraphicalChild:Hc,axisComponents:[{axisType:"xAxis",AxisComp:Ul},{axisType:"yAxis",AxisComp:Fl}],formatAxisMap:Jee});const aze=({reports:e,selectedReport:n,onSelect:a})=>{const[o,d]=Y.useState(!1),h=Y.useRef(null);Y.useEffect(()=>{const x=T=>{h.current&&!h.current.contains(T.target)&&d(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const f=e==null?void 0:e.find(x=>x._id===n),y=x=>{const T=x.reportDate||x.createdAt;return new Date(T).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})},b=f?`${f.reportType} - ${y(f)}`:"Select Report";return l.jsxs("div",{className:"relative inline-block z-10",ref:h,children:[l.jsxs("button",{onClick:()=>d(!o),className:"px-3 sm:px-4 py-2 bg-white rounded-lg text-xs sm:text-sm font-medium cursor-pointer transition-all shadow-sm hover:shadow-md flex items-center gap-2",style:{borderColor:"#8B7355",border:"2px solid #8B7355",color:"#8B7355"},children:[l.jsx(Vn,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:b}),l.jsx("span",{className:"sm:hidden",children:f?f.reportType:"Report"}),l.jsx(iT,{className:`w-4 h-4 transition-transform ${o?"rotate-180":""}`,style:{color:"#8B7355"}})]}),o&&l.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border-2 overflow-hidden",style:{borderColor:"#8B7355"},children:[l.jsx("button",{onClick:()=>{a(null),d(!1)},className:"w-full px-4 py-2.5 text-left text-xs sm:text-sm font-medium transition-colors hover:bg-slate-50",style:{color:n===null?"#8B7355":"#64748b",backgroundColor:n===null?"#F5F1EA":"transparent",borderBottom:"1px solid #e2e8f0"},children:"Select Report"}),e&&e.length>0?e.map(x=>l.jsx("button",{onClick:()=>{a(x._id),d(!1)},className:"w-full px-4 py-2.5 text-left text-xs sm:text-sm transition-colors hover:bg-slate-50 border-b border-slate-100 last:border-b-0",style:{color:n===x._id?"#8B7355":"#64748b",backgroundColor:n===x._id?"#F5F1EA":"transparent",fontWeight:n===x._id?"600":"500"},children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:x.reportType}),l.jsx("span",{className:"text-slate-400 text-xs",children:y(x)})]})},x._id)):l.jsx("div",{className:"px-4 py-3 text-center text-slate-500 text-xs sm:text-sm",children:"No reports available"})]})]})},Fte={vitaminD:{name:"Vitamin D",icon:_k,color:"amber",unit:"ng/mL",normalRange:"30-100",lowExplanation:"When Vitamin D is low, you may feel tired all the time, have weak bones that break easily, feel sad or depressed, get sick often, and have muscle pain. Your body needs sunlight and certain foods to make Vitamin D.",tips:["Get 15-20 minutes of sunlight daily","Eat eggs, fish, and fortified milk","Consider supplements if advised by doctor"]},vitaminB12:{name:"Vitamin B12",icon:El,color:"red",unit:"pg/mL",normalRange:"300-900",lowExplanation:"Low Vitamin B12 makes you feel very tired and weak. You might feel dizzy, have trouble thinking clearly, feel numbness in hands or feet, and look pale. Your body needs B12 to make healthy blood cells.",tips:["Eat meat, fish, eggs, and dairy","Vegetarians may need supplements","Get tested if you feel constantly tired"]},iron:{name:"Iron",icon:uf,color:"rose",unit:"mcg/dL",normalRange:"60-170",lowExplanation:"Low iron means your blood cannot carry enough oxygen. You will feel very tired, look pale, feel short of breath, have cold hands and feet, and may have headaches. Women often have low iron.",tips:["Eat red meat, spinach, and beans","Take iron with Vitamin C for better absorption","Avoid tea/coffee with iron-rich meals"]},hemoglobin:{name:"Hemoglobin",icon:fr,color:"red",unit:"g/dL",normalRange:"12-17",lowExplanation:"Low hemoglobin means anemia - your blood cannot carry enough oxygen to your body. You will feel extremely tired, weak, dizzy, and may have pale skin. Your heart has to work harder.",tips:["Eat iron-rich foods","Include Vitamin C in your diet","See a doctor if symptoms persist"]},calcium:{name:"Calcium",icon:yTe,color:"slate",unit:"mg/dL",normalRange:"8.5-10.5",lowExplanation:"Low calcium weakens your bones and teeth. You may have muscle cramps, numbness in fingers, brittle nails, and bones that break easily. Long-term low calcium can cause osteoporosis.",tips:["Drink milk and eat dairy products","Eat leafy green vegetables","Get enough Vitamin D for calcium absorption"]},vitaminC:{name:"Vitamin C",icon:Jy,color:"orange",unit:"mg/dL",normalRange:"0.6-2.0",lowExplanation:"Low Vitamin C means your body cannot heal wounds properly. You may have bleeding gums, bruise easily, feel tired, have dry skin, and get sick often. Your immune system becomes weak.",tips:["Eat citrus fruits like oranges and lemons","Include tomatoes and bell peppers","Eat fresh fruits and vegetables daily"]},cholesterol:{name:"Cholesterol",icon:Hn,color:"yellow",unit:"mg/dL",normalRange:"<200",lowExplanation:"While high cholesterol is usually the concern, very low cholesterol can affect hormone production and brain function. However, most people need to focus on keeping cholesterol in healthy range.",tips:["Limit fried and fatty foods","Exercise regularly","Eat more fiber and vegetables"]},bloodSugar:{name:"Blood Sugar",icon:tu,color:"purple",unit:"mg/dL",normalRange:"70-100",lowExplanation:"Low blood sugar (hypoglycemia) makes you feel shaky, sweaty, confused, and very hungry. You may feel dizzy or faint. High blood sugar over time can lead to diabetes and damage organs.",tips:["Eat regular meals","Limit sugary foods and drinks","Exercise helps control blood sugar"]},thyroid:{name:"Thyroid (TSH)",icon:dy,color:"indigo",unit:"mIU/L",normalRange:"0.4-4.0",lowExplanation:"Thyroid problems affect your energy and weight. Low thyroid makes you tired, gain weight, feel cold, and have dry skin. High thyroid makes you anxious, lose weight, and feel hot.",tips:["Get thyroid checked if you have unexplained weight changes","Iodine in salt helps thyroid function","Take thyroid medicine as prescribed"]},heartRate:{name:"Heart Rate",icon:fr,color:"red",unit:"bpm",normalRange:"60-100",lowExplanation:"Very low heart rate can mean your heart is not pumping enough blood. You may feel dizzy, tired, or faint. Athletes often have lower heart rates which is normal for them.",tips:["Regular exercise strengthens your heart","Reduce stress and anxiety","Limit caffeine and alcohol"]},sleep:{name:"Sleep",icon:zf,color:"indigo",unit:"hours",normalRange:"7-9",lowExplanation:"Not enough sleep makes you tired, irritable, and unable to think clearly. Long-term poor sleep increases risk of heart disease, diabetes, and weight gain. Your body heals during sleep.",tips:["Sleep 7-9 hours every night","Keep a regular sleep schedule","Avoid screens before bedtime"]},steps:{name:"Daily Steps",icon:zJ,color:"cyan",unit:"steps",normalRange:"8,000-10,000",lowExplanation:"Not walking enough means less exercise for your body. This can lead to weight gain, weak muscles, poor heart health, and low energy. Walking is the easiest exercise for everyone.",tips:["Aim for 8,000-10,000 steps daily","Take stairs instead of elevator","Walk after meals for better digestion"]}},sze=({metric:e,onClose:n})=>{if(!e)return null;const a=Fte[e];if(!a)return null;const o=a.icon;return l.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",onClick:n,children:l.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-[85vh] overflow-y-auto p-5 sm:p-6 relative animate-slide-up sm:animate-fade-in shadow-xl",onClick:d=>d.stopPropagation(),children:[l.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4 sm:hidden"}),l.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1",children:l.jsx(bi,{className:"w-5 h-5"})}),l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:l.jsx(o,{className:`w-5 h-5 sm:w-6 sm:h-6 text-${a.color}-500`})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-800",children:a.name}),l.jsxs("p",{className:"text-slate-500 text-xs sm:text-sm",children:["Normal: ",a.normalRange," ",a.unit]})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-cyan-600 font-medium mb-2 text-sm sm:text-base",children:"What happens when it's low?"}),l.jsx("p",{className:"text-slate-600 text-xs sm:text-sm leading-relaxed",children:a.lowExplanation})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-emerald-600 font-medium mb-2 text-sm sm:text-base",children:"Simple Tips to Improve"}),l.jsx("ul",{className:"space-y-2",children:a.tips.map((d,h)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-600 text-xs sm:text-sm",children:[l.jsx("span",{className:"text-emerald-500 mt-0.5",children:""}),d]},h))})]}),l.jsx("button",{onClick:n,className:"w-full mt-5 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors sm:hidden",children:"Got it"})]})})},no=({metricKey:e,value:n,unit:a,status:o,subtitle:d,onInfoClick:h,previousValue:f,allReports:y,isSamePatient:b})=>{const x=Fte[e];if(!x)return null;const T=x.icon,N={normal:"emerald",low:"amber",high:"red",critical:"red"}[o]||"slate",O=n!=null&&n!=="";let A=null;if(O&&f!==null&&f!==void 0&&y&&y.length>1&&b){const I=parseFloat(n),P=parseFloat(f);if(!isNaN(I)&&!isNaN(P)&&P!==0){const L=I-P,F=(L/P*100).toFixed(1);let V=!1,G="slate";["vitaminD","vitaminB12","iron","calcium","hemoglobin","vitaminC"].includes(e)?(V=L>0,L>0?G="emerald":L<0&&(G="red")):["cholesterol","bloodSugar","tsh"].includes(e)&&(V=L<0,L<0?G="emerald":L>0&&(G="red")),Math.abs(F)<5&&(G="amber"),A={change:L,percentChange:F,isImprovement:V,color:G}}}return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm group relative p-3 sm:p-5 hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[l.jsx("span",{className:"text-slate-500 text-xs sm:text-sm truncate pr-2",children:x.name}),l.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[l.jsx("button",{onClick:()=>h(e),className:"w-5 h-5 sm:w-6 sm:h-6 rounded-lg bg-slate-100 flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity hover:bg-slate-200",title:"Learn more",children:l.jsx(Lh,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-cyan-500"})}),l.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-lg bg-${x.color}-100 flex items-center justify-center`,children:l.jsx(T,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${x.color}-500`})})]})]}),l.jsx("div",{className:"flex items-baseline gap-1 sm:gap-2 flex-wrap",children:O?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:n}),l.jsx("span",{className:"text-slate-400 text-xs sm:text-sm",children:a||x.unit}),o&&l.jsx("span",{className:`text-${N}-600 text-[10px] sm:text-xs ml-auto px-1.5 sm:px-2 py-0.5 bg-${N}-100 rounded-full`,children:o.toUpperCase()})]}):l.jsx("span",{className:"text-slate-400 text-sm",children:"No data"})}),A&&l.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs sm:text-sm font-medium",children:[l.jsxs("div",{className:`flex items-center gap-0.5 px-2 py-1 rounded-lg bg-${A.color}-100`,children:[A.change>0?l.jsx(BJ,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${A.color}-600`}):l.jsx(fTe,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${A.color}-600`}),l.jsxs("span",{className:`text-${A.color}-600`,children:[A.change>0?"+":"",A.percentChange,"%"]})]}),l.jsx("span",{className:"text-slate-400 text-[10px] sm:text-xs",children:"vs prev"})]}),d&&l.jsx("p",{className:"text-slate-400 text-[10px] sm:text-xs mt-1 sm:mt-2 truncate",children:d})]})};function oze(){var qe,It,rt,Fe,ut,vt,Ce,xt,Nt,pt;const{user:e}=ma(),{dashboardData:n,wearableData:a,nutritionData:o,loading:d,fetchDashboard:h,fetchWearable:f,fetchNutrition:y}=rQ(),[b,x]=Y.useState(null),[T,S]=Y.useState(new Date().toISOString().split("T")[0]),[N,O]=Y.useState(null),[A,I]=Y.useState(null),[P,L]=Y.useState(null);Y.useEffect(()=>{(async()=>{var ye,Ve;try{I(null),await Promise.all([h(),f()])}catch(ht){console.error("Failed to fetch dashboard:",ht),I(((Ve=(ye=ht.response)==null?void 0:ye.data)==null?void 0:Ve.message)||"Failed to load dashboard data")}})()},[h,f]),Y.useEffect(()=>{n!=null&&n.recentReports&&n.recentReports.length>0&&P===null&&L(n.recentReports[0]._id)},[n==null?void 0:n.recentReports,P]),Y.useEffect(()=>{(async()=>{const ye=await y(T);O(ye)})()},[T,y]);const F=d.dashboard||d.wearable,V=n,G=N||o;if(F)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your health data..."})]})});if(A)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-red-500 mb-4",children:A}),l.jsx("button",{onClick:()=>h(),className:"px-6 py-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600",children:"Try Again"})]})});const{user:B,healthScores:z,latestAnalysis:q,recentReports:Z}=V||{},ie=Z&&Z.length>0,ue=P&&Z?Z.find(Xe=>Xe._id===P):Z==null?void 0:Z[0],re=(ue==null?void 0:ue.aiAnalysis)||q,pe=((qe=B==null?void 0:B.healthMetrics)==null?void 0:qe.healthScore)||(re==null?void 0:re.healthScore)||null,Se=(re==null?void 0:re.metrics)||{},fe=Xe=>Xe==null?null:typeof Xe=="object"&&Xe.value!==void 0?Xe.value:Xe,be={vitaminD:fe(Se.vitaminD),vitaminB12:fe(Se.vitaminB12),iron:fe(Se.iron),calcium:fe(Se.calcium),hemoglobin:fe(Se.hemoglobin),bloodSugar:fe(Se.bloodSugar)||fe(Se.glucose),tsh:fe(Se.tsh)||fe(Se.thyroid),vitaminC:fe(Se.vitaminC),cholesterol:fe(Se.cholesterol)||fe(Se.totalCholesterol)},se={};let he=!0;if(Z&&Z.length>1){const Xe=Z[1],ye=(ue==null?void 0:ue.patientName)||(e==null?void 0:e.name)||"",Ve=(Xe==null?void 0:Xe.patientName)||"";if(ye&&Ve){const ht=ye.toLowerCase().trim(),Bn=Ve.toLowerCase().trim();he=ht===Bn,he||console.log(`Patient mismatch: "${ye}" vs "${Ve}"`)}if(he){const ht=((It=Xe==null?void 0:Xe.aiAnalysis)==null?void 0:It.metrics)||{};se.vitaminD=fe(ht.vitaminD),se.vitaminB12=fe(ht.vitaminB12),se.iron=fe(ht.iron),se.calcium=fe(ht.calcium),se.hemoglobin=fe(ht.hemoglobin),se.bloodSugar=fe(ht.bloodSugar)||fe(ht.glucose),se.tsh=fe(ht.tsh)||fe(ht.thyroid),se.vitaminC=fe(ht.vitaminC),se.cholesterol=fe(ht.cholesterol)||fe(ht.totalCholesterol)}}const Q=(a==null?void 0:a.connected)&&(a==null?void 0:a.todayMetrics),le=(a==null?void 0:a.todayMetrics)||{steps:0,caloriesBurned:0},we=(a==null?void 0:a.recentHeartRate)||[],Ue=(a==null?void 0:a.recentSleep)||[],Le=we.length>0?Math.round(we.reduce((Xe,ye)=>Xe+ye.bpm,0)/we.length):null,tt=Ue.length>0?(Ue.reduce((Xe,ye)=>Xe+ye.totalSleepMinutes,0)/Ue.length/60).toFixed(1):null,Te=(z==null?void 0:z.length)>0?z.map(Xe=>({date:new Date(Xe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Xe.score,type:Xe.type})):[],De=(Xe,ye,Ve)=>{if(!Xe)return null;const ht=parseFloat(Xe);return ht<ye*.7?"critical":ht<ye?"low":ht>Ve*1.3||ht>Ve?"high":"normal"};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[b&&l.jsx(sze,{metric:b,onClose:()=>x(null)}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:["Welcome back, ",l.jsx("span",{className:"text-cyan-600",children:(rt=e==null?void 0:e.name)==null?void 0:rt.split(" ")[0]})]}),l.jsx("p",{className:"text-slate-500 mt-1 text-sm sm:text-base",children:"Your complete health overview. Tap the eye icon to learn more."})]}),l.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[l.jsxs(Ut,{to:"/upload",className:"px-3 sm:px-6 py-2 sm:py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50 flex items-center gap-1 sm:gap-2 text-xs sm:text-base",children:[l.jsx(Ts,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Upload Records"}),l.jsx("span",{className:"sm:hidden",children:"Upload"})]}),l.jsxs("button",{className:"px-3 sm:px-6 py-2 sm:py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-1 sm:gap-2 text-xs sm:text-base",style:{backgroundColor:"#8B7355"},children:[l.jsx(Uc,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Log Symptoms"}),l.jsx("span",{className:"sm:hidden",children:"Log"})]})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[ie&&pe?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Your overall health progress"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl sm:text-4xl font-bold text-slate-800",children:pe}),l.jsx("span",{className:"text-slate-400 text-sm",children:"/100"}),Te.length>1&&l.jsxs("span",{className:"text-emerald-500 text-xs sm:text-sm ml-2",children:[Te[Te.length-1].score>Te[Te.length-2].score?"+":"",Te[Te.length-1].score-Te[Te.length-2].score,"%"]})]})]}),Te.length>0&&l.jsx(r0,{width:"100%",height:140,children:l.jsxs(Cj,{data:Te,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),l.jsx(Of,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),l.jsx(Ul,{dataKey:"date",stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1}),l.jsx(Fl,{stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1,domain:[50,100],hide:!0}),l.jsx(Ha,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"12px"},labelStyle:{color:"#64748b"},formatter:Xe=>[`${Xe}/100`,"Score"]}),l.jsx(Hc,{type:"monotone",dataKey:"score",stroke:"#10b981",strokeWidth:2,fill:"url(#scoreGradient)"})]})})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-8 text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(ua,{className:"w-8 h-8 text-slate-400"})}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No Health Data Yet"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload your first health report to see your personalized health score and track your progress over time."}),l.jsxs(Ut,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Ts,{className:"w-4 h-4"}),"Upload Your First Report"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{children:[l.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(kl,{className:"w-5 h-5 text-emerald-500"}),"Nutrition Tracker"]}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Daily calorie and macro tracking"})]})}),l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("input",{type:"text",value:T?new Date(T+"T00:00:00").toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"2-digit"}):"",onChange:Xe=>{const Ve=Xe.target.value.split("/");if(Ve.length===3){const ht=Ve[0],Bn=Ve[1];let li=Ve[2];li.length===2&&(li=(parseInt(li)>30?"19":"20")+li);const is=`${li}-${Bn}-${ht}`;S(is)}},placeholder:"DD/MM/YY",className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500",maxLength:"8"}),l.jsx("button",{onClick:()=>S(new Date().toISOString().split("T")[0]),className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-sm font-medium transition-colors",children:"Today"})]}),G?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Calories"}),l.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[G.totalCalories||0," / ",G.calorieGoal||1800]})]}),l.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:l.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.min((G.totalCalories||0)/(G.calorieGoal||1800)*100,100)}%`,backgroundColor:"#8B7355"}})}),!G.calorieGoal&&l.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[l.jsx(Ut,{to:"/profile",className:"underline",children:"Set your fitness goal"})," for personalized targets"]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[l.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(xl,{className:"w-3 h-3 text-blue-500"}),l.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Protein"})]}),l.jsxs("p",{className:"text-lg font-bold text-blue-700",children:[(G.totalProtein||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-blue-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${Math.min((G.totalProtein||0)/(G.proteinGoal||80)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-amber-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(xl,{className:"w-3 h-3 text-amber-500"}),l.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Carbs"})]}),l.jsxs("p",{className:"text-lg font-bold text-amber-700",children:[(G.totalCarbs||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-amber-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-amber-500 h-1 rounded-full",style:{width:`${Math.min((G.totalCarbs||0)/(G.carbsGoal||200)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-rose-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(xl,{className:"w-3 h-3 text-rose-500"}),l.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"Fats"})]}),l.jsxs("p",{className:"text-lg font-bold text-rose-700",children:[(G.totalFats||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-rose-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-rose-500 h-1 rounded-full",style:{width:`${Math.min((G.totalFats||0)/(G.fatsGoal||50)*100,100)}%`}})})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Meals logged today"}),l.jsx("span",{className:"text-sm font-semibold text-slate-800",children:((Fe=G.mealsLogged)!=null&&Fe.breakfast?1:0)+((ut=G.mealsLogged)!=null&&ut.lunch?1:0)+((vt=G.mealsLogged)!=null&&vt.dinner?1:0)+(((Ce=G.mealsLogged)==null?void 0:Ce.snacks)||0)})]}),l.jsxs(Ut,{to:"/nutrition",className:"w-full py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center justify-center gap-2 text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Uc,{className:"w-4 h-4"}),"Log Meal"]})]}):l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3",children:l.jsx(kl,{className:"w-6 h-6 text-slate-400"})}),l.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"No meals logged for this day"}),l.jsxs(Ut,{to:"/nutrition",className:"inline-flex items-center gap-2 px-4 py-2 text-white rounded-xl font-medium hover:shadow-lg text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Uc,{className:"w-4 h-4"}),"Log Your First Meal"]})]})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-500"}),"Vital Signs & Activity"]}),l.jsx(aze,{reports:Z,selectedReport:P,onSelect:L})]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"heartRate",value:Le,status:De(Le,60,100),subtitle:Q?"From wearable":"Connect device",onInfoClick:x}),l.jsx(no,{metricKey:"sleep",value:tt,status:tt?De(parseFloat(tt),7,9):null,subtitle:Ue.length>0?`${Ue.length} nights avg`:"Track sleep",onInfoClick:x}),l.jsx(no,{metricKey:"steps",value:le.steps>0?le.steps.toLocaleString():null,unit:"steps",status:le.steps>=8e3?"normal":le.steps>=5e3?"low":le.steps>0?"critical":null,subtitle:Q?`${le.caloriesBurned} cal`:"Today",onInfoClick:x}),l.jsx(no,{metricKey:"cholesterol",value:be.cholesterol,previousValue:se.cholesterol,allReports:Z,isSamePatient:he,status:De(be.cholesterol,0,200),subtitle:"From blood work",onInfoClick:x})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(tu,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-500"}),"Vitamins & Minerals"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"vitaminD",value:be.vitaminD,previousValue:se.vitaminD,allReports:Z,isSamePatient:he,status:De(be.vitaminD,30,100),subtitle:"Bone & immune health",onInfoClick:x}),l.jsx(no,{metricKey:"vitaminB12",value:be.vitaminB12,previousValue:se.vitaminB12,allReports:Z,isSamePatient:he,status:De(be.vitaminB12,300,900),subtitle:"Energy & nerves",onInfoClick:x}),l.jsx(no,{metricKey:"iron",value:be.iron,previousValue:se.iron,allReports:Z,isSamePatient:he,status:De(be.iron,60,170),subtitle:"Blood oxygen",onInfoClick:x}),l.jsx(no,{metricKey:"calcium",value:be.calcium,previousValue:se.calcium,allReports:Z,isSamePatient:he,status:De(be.calcium,8.5,10.5),subtitle:"Bones & teeth",onInfoClick:x})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(uf,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-500"}),"Blood & Hormones"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"hemoglobin",value:be.hemoglobin,previousValue:se.hemoglobin,allReports:Z,isSamePatient:he,status:De(be.hemoglobin,12,17),subtitle:"Oxygen carrier",onInfoClick:x}),l.jsx(no,{metricKey:"bloodSugar",value:be.bloodSugar,previousValue:se.bloodSugar,allReports:Z,isSamePatient:he,status:De(be.bloodSugar,70,100),subtitle:"Fasting glucose",onInfoClick:x}),l.jsx(no,{metricKey:"thyroid",value:be.tsh,previousValue:se.tsh,allReports:Z,isSamePatient:he,status:De(be.tsh,.4,4),subtitle:"Metabolism control",onInfoClick:x}),l.jsx(no,{metricKey:"vitaminC",value:be.vitaminC,previousValue:se.vitaminC,allReports:Z,isSamePatient:he,status:De(be.vitaminC,.6,2),subtitle:"Immune & healing",onInfoClick:x})]})]}),ie&&Te.length>1&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(ua,{className:"w-5 h-5 text-cyan-500"}),"Health Improvement Tracking"]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[l.jsx(ec,{className:"w-4 h-4"}),"Last updated: ",new Date().toLocaleDateString()]})]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Overall Trend"}),l.jsx(BJ,{className:"w-4 h-4 text-green-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-green-500",children:"Improved"}),l.jsx("span",{className:"text-xs text-slate-400",children:"vs last month"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Based on lab values and wearable data"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Stable Metrics"}),l.jsx(vk,{className:"w-4 h-4 text-blue-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"6"}),l.jsx("span",{className:"text-xs text-slate-400",children:"out of 12"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Maintaining healthy ranges"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Needs Attention"}),l.jsx(rT,{className:"w-4 h-4 text-yellow-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:"2"}),l.jsx("span",{className:"text-xs text-slate-400",children:"metrics"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Vitamin D, Iron levels"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h4",{className:"text-slate-800 font-medium",children:"Lab Values Trend"}),l.jsxs("select",{className:"bg-slate-50 border border-slate-200 rounded-lg px-3 py-1 text-slate-700 text-sm",children:[l.jsx("option",{children:"Vitamin D"}),l.jsx("option",{children:"Iron"}),l.jsx("option",{children:"B12"}),l.jsx("option",{children:"Hemoglobin"})]})]}),l.jsx(r0,{width:"100%",height:200,children:l.jsxs(Ute,{data:Te.map((Xe,ye)=>({date:Xe.date,score:Xe.score})),children:[l.jsx(Of,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(Ul,{dataKey:"date",stroke:"#94a3b8",fontSize:12}),l.jsx(Fl,{stroke:"#94a3b8",fontSize:12}),l.jsx(Ha,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px"},labelStyle:{color:"#64748b"}}),l.jsx(cg,{type:"monotone",dataKey:"score",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",strokeWidth:2}})]})}),l.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),l.jsx("span",{className:"text-slate-600",children:"Health Score Trend"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Dl,{className:"w-4 h-4 text-green-500"}),l.jsx("span",{className:"text-slate-500",children:"Target: 80+ score"})]})]})]}),(re==null?void 0:re.recommendations)&&l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("h4",{className:"text-slate-800 font-medium mb-4 flex items-center gap-2",children:[l.jsx(Yy,{className:"w-5 h-5 text-cyan-500"}),"Personalized Recommendations"]}),l.jsx("div",{className:"space-y-3",children:(xt=re.recommendations.lifestyle)==null?void 0:xt.slice(0,3).map((Xe,ye)=>l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg",children:[l.jsx(Xr,{className:"w-5 h-5 text-green-500 mt-0.5 shrink-0"}),l.jsx("div",{children:l.jsx("p",{className:"text-slate-800 font-medium text-sm",children:Xe})})]},ye))})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsxs("div",{className:"rounded-2xl p-6",style:{backgroundColor:"#F5F1EA",border:"2px solid #E5DFD3"},children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("div",{className:"px-3 py-1 rounded-full flex items-center gap-2",style:{backgroundColor:"#E5DFD3"},children:[l.jsx(Sy,{className:"w-4 h-4 text-cyan-600"}),l.jsx("span",{className:"text-cyan-700 text-sm font-medium",children:"AI ANALYSIS"})]})}),l.jsx("span",{className:"text-slate-500 text-sm",children:q?"Based on your reports":"No reports yet"})]}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-3",children:((Nt=re==null?void 0:re.summary)==null?void 0:Nt.split(".")[0])||"Upload a health report to get AI insights"}),l.jsx("p",{className:"text-slate-600 mb-6",children:re?re.summary:"Our AI will analyze your health reports and provide personalized insights, recommendations, and track your health trends over time."}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[!ie&&l.jsxs(Ut,{to:"/upload",className:"px-6 py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2",style:{backgroundColor:"#8B7355"},children:[l.jsx(Ts,{className:"w-4 h-4"}),"Upload Your First Report"]}),Q&&l.jsx(Ut,{to:"/wearables",className:"px-6 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50",children:"View Wearable Data"})]})]}),((pt=re==null?void 0:re.keyFindings)==null?void 0:pt.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Key Findings from Your Reports"}),l.jsx("div",{className:"space-y-3",children:re.keyFindings.slice(0,4).map((Xe,ye)=>{const Ve=typeof Xe=="string"?Xe:Xe.title||Xe.finding||JSON.stringify(Xe),ht=typeof Xe=="object"?Xe.description:null,Bn=typeof Xe=="object"?Xe.severity:"low";return l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[l.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${Bn==="high"?"bg-red-500":Bn==="medium"?"bg-amber-500":"bg-emerald-500"}`}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-medium",children:Ve}),ht&&l.jsx("p",{className:"text-slate-500 text-sm mt-1",children:ht})]})]},ye)})})]})]}),l.jsx("div",{className:"space-y-6",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"font-semibold text-slate-800",children:"Recent Reports"}),l.jsx(Ut,{to:"/profile",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"View All"})]}),l.jsx("div",{className:"space-y-3",children:(Z==null?void 0:Z.length)>0?Z.slice(0,3).map(Xe=>l.jsxs(Ut,{to:`/reports/${Xe._id}`,className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:l.jsx(Vn,{className:"w-5 h-5 text-red-500"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-slate-800 font-medium truncate",children:Xe.reportType}),l.jsx("p",{className:"text-slate-400 text-sm",children:new Date(Xe.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Xe.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:Xe.status==="completed"?"ANALYZED":"PENDING"})]},Xe._id)):l.jsxs("div",{className:"text-center py-4",children:[l.jsx(Vn,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No reports uploaded yet"}),l.jsx(Ut,{to:"/upload",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"+ Upload Report"})]})})]})})]})]})}const _1=({title:e,description:n,link:a,status:o,icon:d,gradient:h})=>l.jsxs(Ut,{to:a,className:"group relative overflow-hidden rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1",children:[l.jsxs("div",{className:`h-48 bg-gradient-to-br ${h} relative rounded-t-3xl`,children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.8),transparent_50%)] animate-pulse"})}),l.jsx("div",{className:"absolute top-4 left-4",children:l.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center",children:l.jsx(d,{className:"w-8 h-8 text-white"})})}),o&&l.jsx("div",{className:"absolute top-4 right-4",children:l.jsx("span",{className:"px-3 py-1 bg-white/90 backdrop-blur-sm rounded-full text-xs font-semibold text-slate-700",children:o})}),l.jsx("div",{className:"absolute bottom-0 right-0 w-32 h-32 bg-white/10 rounded-tl-full"})]}),l.jsxs("div",{className:"bg-white p-5 rounded-b-3xl",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-1 group-hover:text-cyan-600 transition-colors",children:e}),l.jsx("p",{className:"text-sm text-slate-600 line-clamp-2",children:n}),l.jsxs("div",{className:"mt-3 flex items-center text-cyan-600 text-sm font-medium",children:[l.jsx("span",{children:"Get Started"}),l.jsx(Dd,{className:"w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform"})]})]})]}),ia=({icon:e,title:n,subtitle:a,link:o,color:d,comingSoon:h})=>{const f=l.jsxs("div",{className:`relative bg-white rounded-2xl p-4 border-2 border-slate-100 hover:border-${d}-200 hover:shadow-lg transition-all duration-300 group ${h?"opacity-60":"cursor-pointer"}`,children:[l.jsx("div",{className:`w-14 h-14 rounded-xl bg-${d}-50 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform`,children:l.jsx(e,{className:`w-7 h-7 text-${d}-500`})}),l.jsx("h4",{className:"font-semibold text-slate-800 text-sm mb-1",children:n}),l.jsx("p",{className:"text-xs text-slate-500",children:a}),h&&l.jsx("div",{className:"absolute top-2 right-2",children:l.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-700 text-[10px] font-semibold rounded-full",children:"SOON"})})]});return h?f:l.jsx(Ut,{to:o,children:f})};function cze(){var x,T,S,N,O,A,I,P,L,F,V;const{user:e}=ma(),{dashboardData:n,loading:a,fetchDashboard:o}=rQ(),[d,h]=Y.useState(0);if(Y.useEffect(()=>{o()},[o]),Y.useEffect(()=>{var G,B,z;if(n){let q=0;const Z=4;(G=e==null?void 0:e.profile)!=null&&G.age&&((B=e==null?void 0:e.profile)!=null&&B.gender)&&q++,((z=n.recentReports)==null?void 0:z.length)>0&&q++,n.nutritionTracked&&q++,n.wearableConnected&&q++;const ie=Math.round(q/Z*100);setTimeout(()=>h(ie),300)}},[n,e]),a.dashboard)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-600",children:"Loading your health dashboard..."})]})});const f=((x=n==null?void 0:n.recentReports)==null?void 0:x.length)>0;(T=e==null?void 0:e.profile)!=null&&T.age&&((S=e==null?void 0:e.profile)==null||S.gender);const y=n==null?void 0:n.nutritionTracked;n==null||n.wearableConnected;const b=((O=(N=n==null?void 0:n.user)==null?void 0:N.healthMetrics)==null?void 0:O.healthScore)||((A=n==null?void 0:n.latestAnalysis)==null?void 0:A.healthScore);return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 via-blue-50 to-cyan-100",children:l.jsxs("div",{className:"max-w-7xl mx-auto space-y-8 animate-fade-in pb-20 px-4",children:[l.jsxs("div",{className:"pt-6",children:[l.jsxs("h1",{className:"text-3xl font-bold text-slate-800 mb-1",children:["Hi, ",l.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 to-emerald-600",children:((I=e==null?void 0:e.name)==null?void 0:I.split(" ")[0])||"there"}),"! "]}),l.jsx("p",{className:"text-slate-600",children:"Welcome to your health journey"})]}),f&&l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-md hover:shadow-lg transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center",children:l.jsx(fr,{className:"w-6 h-6 text-white"})}),l.jsx(ua,{className:"w-5 h-5 text-emerald-500"})]}),l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Health Score"}),l.jsx("p",{className:"text-3xl font-bold text-slate-800",children:((L=(P=n==null?void 0:n.user)==null?void 0:P.healthMetrics)==null?void 0:L.healthScore)||"N/A"})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-md hover:shadow-lg transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-400 to-cyan-500 flex items-center justify-center",children:l.jsx(Vn,{className:"w-6 h-6 text-white"})}),l.jsx(wa,{className:"w-5 h-5 text-slate-400"})]}),l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Total Reports"}),l.jsx("p",{className:"text-3xl font-bold text-slate-800",children:((F=n==null?void 0:n.recentReports)==null?void 0:F.length)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-md hover:shadow-lg transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-400 to-green-500 flex items-center justify-center",children:l.jsx(kl,{className:"w-6 h-6 text-white"})}),l.jsx(xl,{className:"w-5 h-5 text-orange-500"})]}),l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Meals Logged"}),l.jsx("p",{className:"text-3xl font-bold text-slate-800",children:(n==null?void 0:n.mealsLogged)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-md hover:shadow-lg transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-400 to-indigo-500 flex items-center justify-center",children:l.jsx(Yy,{className:"w-6 h-6 text-white"})}),l.jsx(qa,{className:"w-5 h-5 text-amber-400"})]}),l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Streak Days"}),l.jsx("p",{className:"text-3xl font-bold text-slate-800",children:(n==null?void 0:n.streakDays)||0})]})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between mb-6",children:l.jsxs("div",{children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(fr,{className:"w-7 h-7 text-red-500"}),"Health Journey"]}),l.jsx("p",{className:"text-slate-600 text-sm mt-1",children:"Your personalized health management tools"})]})}),l.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-6 flex md:flex-none overflow-x-auto gap-4 pb-4 md:pb-0 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0",children:[l.jsx("div",{className:"min-w-[280px] md:min-w-0 snap-center",children:l.jsx(_1,{title:"Upload Report",description:"Get AI-powered analysis of your health reports with personalized insights",icon:Ts,gradient:"from-blue-400 via-blue-500 to-blue-600",link:"/upload",status:f?`${n.recentReports.length} Reports`:"Get Started"})}),l.jsx("div",{className:"min-w-[280px] md:min-w-0 snap-center",children:l.jsx(_1,{title:"Nutrition Tracker",description:"Track your daily meals, calories, and macros with smart recommendations",icon:kl,gradient:"from-emerald-400 via-emerald-500 to-emerald-600",link:"/nutrition",status:y?"Active":"Start Tracking"})}),l.jsx("div",{className:"min-w-[280px] md:min-w-0 snap-center",children:l.jsx(_1,{title:"Diet Plan",description:"Get personalized meal plans based on your health reports and goals",icon:so,gradient:"from-orange-400 via-orange-500 to-orange-600",link:"/diet-plan",status:"Personalized"})})]})]}),f&&b&&((V=n==null?void 0:n.healthScores)==null?void 0:V.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-xl font-semibold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"Your overall health progress over time"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-4xl font-bold text-slate-800",children:b}),l.jsx("span",{className:"text-slate-400 text-sm",children:"/100"})]})]}),l.jsx(r0,{width:"100%",height:200,children:l.jsxs(Cj,{data:n.healthScores.map(G=>({date:new Date(G.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:G.score})),children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),l.jsx(Of,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),l.jsx(Ul,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:!1}),l.jsx(Fl,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:!1,domain:[50,100],hide:!0}),l.jsx(Ha,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px",fontSize:"12px"},labelStyle:{color:"#64748b"},formatter:G=>[`${G}/100`,"Score"]}),l.jsx(Hc,{type:"monotone",dataKey:"score",stroke:"#10b981",strokeWidth:2,fill:"url(#scoreGradient)"})]})})]}),l.jsxs("div",{children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(GJ,{className:"w-7 h-7 text-cyan-600"}),"More Offerings"]}),l.jsxs("div",{className:"hidden md:grid md:grid-cols-4 gap-4",children:[l.jsx(ia,{icon:Vn,title:"My Reports",subtitle:"View all reports",link:"/reports",color:"blue"}),l.jsx(ia,{icon:so,title:"Quick Food Check",subtitle:"Instant nutrition",link:"/nutrition",color:"emerald"}),l.jsx(ia,{icon:Hn,title:"Vital Signs",subtitle:"Track metrics",link:"/dashboard/classic",color:"red"}),l.jsx(ia,{icon:tu,title:"Supplements",subtitle:"Recommendations",link:"/diet-plan",color:"purple"}),l.jsx(ia,{icon:Xd,title:"AI Chat",subtitle:"Ask health questions",link:"/ai-chat",color:"cyan"}),l.jsx(ia,{icon:qr,title:"Appointments",subtitle:"Book doctors",link:"/doctors",color:"indigo",comingSoon:!0}),l.jsx(ia,{icon:qy,title:"Fitness Plan",subtitle:"Exercise routines",link:"/dashboard",color:"orange",comingSoon:!0}),l.jsx(ia,{icon:dy,title:"Mental Health",subtitle:"Mood tracking",link:"/dashboard",color:"pink",comingSoon:!0})]}),l.jsxs("div",{className:"md:hidden",children:[l.jsxs("div",{className:"flex overflow-x-auto gap-3 pb-4 snap-x snap-mandatory scrollbar-hide -mx-4 px-4",children:[l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:Vn,title:"My Reports",subtitle:"View all reports",link:"/reports",color:"blue"})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:so,title:"Quick Food Check",subtitle:"Instant nutrition",link:"/nutrition",color:"emerald"})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:Hn,title:"Vital Signs",subtitle:"Track metrics",link:"/dashboard/classic",color:"red"})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:tu,title:"Supplements",subtitle:"Recommendations",link:"/diet-plan",color:"purple"})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:Xd,title:"AI Chat",subtitle:"Ask health questions",link:"/ai-chat",color:"cyan"})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:qr,title:"Appointments",subtitle:"Book doctors",link:"/doctors",color:"indigo",comingSoon:!0})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:qy,title:"Fitness Plan",subtitle:"Exercise routines",link:"/dashboard",color:"orange",comingSoon:!0})}),l.jsx("div",{className:"min-w-[calc(50%-6px)] snap-start flex-shrink-0",children:l.jsx(ia,{icon:dy,title:"Mental Health",subtitle:"Mood tracking",link:"/dashboard",color:"pink",comingSoon:!0})})]}),l.jsx("div",{className:"flex items-center justify-center gap-2 mt-2",children:l.jsxs("div",{className:"flex items-center gap-1 text-slate-400 text-xs",children:[l.jsx(Dd,{className:"w-4 h-4 animate-pulse"}),l.jsx("span",{children:"Scroll for more"}),l.jsx(Dd,{className:"w-4 h-4 animate-pulse"})]})})]})]}),f&&l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(Vn,{className:"w-7 h-7 text-blue-600"}),"Recent Reports"]}),l.jsx("p",{className:"text-slate-600 text-sm mt-1",children:"Your latest uploaded health reports"})]}),l.jsxs(Ut,{to:"/reports",className:"text-cyan-600 hover:text-cyan-700 font-medium text-sm flex items-center gap-1",children:["View All",l.jsx(Dd,{className:"w-4 h-4"})]})]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:n.recentReports.slice(0,2).map(G=>{var B,z;return l.jsxs(Ut,{to:`/reports/${G._id}`,className:"bg-white rounded-2xl border-2 border-orange-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1 group",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-400 to-cyan-500 flex items-center justify-center",children:l.jsx(Vn,{className:"w-6 h-6 text-white"})}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${G.status==="completed"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:G.status==="completed"?"ANALYZED":"PENDING"})]}),l.jsx("h3",{className:"font-bold text-slate-800 text-lg mb-2 group-hover:text-cyan-600 transition-colors",children:G.reportType}),l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[l.jsx(qr,{className:"w-4 h-4"}),l.jsx("span",{children:new Date(G.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),((B=G.aiAnalysis)==null?void 0:B.healthScore)&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(fr,{className:"w-4 h-4 text-red-500"}),l.jsx("span",{className:"font-bold text-slate-800",children:G.aiAnalysis.healthScore})]})]}),((z=G.aiAnalysis)==null?void 0:z.summary)&&l.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 mb-3",children:G.aiAnalysis.summary}),l.jsxs("div",{className:"flex items-center text-cyan-600 text-sm font-medium group-hover:gap-2 transition-all",children:[l.jsx("span",{children:"View Details"}),l.jsx(Dd,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]},G._id)})})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center",children:l.jsx(PP,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"30 Days Challenge"}),l.jsx("p",{className:"text-slate-600 text-sm",children:"Build healthy habits, one day at a time"})]})]}),l.jsxs(Ut,{to:"/challenge",className:"block bg-gradient-to-br from-amber-400 via-orange-500 to-red-500 rounded-3xl p-5 sm:p-8 text-white hover:shadow-2xl transition-all hover:-translate-y-1 group",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-1",children:[l.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center flex-shrink-0",children:l.jsx(PP,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h3",{className:"text-base sm:text-2xl font-bold mb-0.5 sm:mb-1 leading-tight",children:"30 Days Health Challenge"}),l.jsx("p",{className:"text-xs sm:text-base text-amber-100 leading-tight",children:"Complete daily tasks to build lasting habits"})]})]}),l.jsx(Dd,{className:"w-6 h-6 sm:w-8 sm:h-8 group-hover:translate-x-2 transition-transform flex-shrink-0"})]}),l.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4 sm:mb-6",children:[l.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[l.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),l.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Drink Water"})]}),l.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[l.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),l.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Workout/Yoga"})]}),l.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[l.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),l.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Eat Fruits"})]}),l.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-3 sm:p-4 text-center",children:[l.jsx("div",{className:"text-2xl sm:text-3xl mb-1 sm:mb-2",children:""}),l.jsx("p",{className:"text-xs sm:text-sm font-medium",children:"Sleep Well"})]})]}),l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx(xl,{className:"w-4 h-4 sm:w-5 sm:h-5"}),l.jsx("span",{className:"text-xs sm:text-base font-bold",children:"Start Streak"})]}),l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx(Yy,{className:"w-4 h-4 sm:w-5 sm:h-5"}),l.jsx("span",{className:"text-xs sm:text-base font-bold",children:"Earn Badges"})]})]}),l.jsxs("div",{className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-white/20 backdrop-blur-sm rounded-full text-xs sm:text-base font-bold whitespace-nowrap flex items-center gap-1",children:["Start Challenge",l.jsx(wa,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:l.jsx(Sy,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Did You Know?"}),l.jsx("p",{className:"text-slate-600 text-sm",children:"Surprising nutrition facts about everyday foods"})]})]}),l.jsxs("div",{className:"md:grid md:grid-cols-2 lg:grid-cols-4 md:gap-4 flex md:flex-none overflow-x-auto gap-4 pb-4 md:pb-0 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0",children:[l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-orange-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"text-4xl",children:""}),l.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:l.jsx(so,{className:"w-5 h-5 text-green-600"})})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Guava Power"}),l.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["One guava contains ",l.jsx("span",{className:"font-bold text-green-600",children:"3g of protein"})," - more than most fruits!"]}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[l.jsx(Dl,{className:"w-3 h-3"}),l.jsx("span",{children:"Great for muscle recovery"})]})]}),l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-blue-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"text-4xl",children:""}),l.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:l.jsx(uf,{className:"w-5 h-5 text-blue-600"})})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Spinach Iron"}),l.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Spinach has ",l.jsx("span",{className:"font-bold text-blue-600",children:"2.7mg iron"})," per 100g - boosts blood health naturally"]}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[l.jsx(fr,{className:"w-3 h-3"}),l.jsx("span",{children:"Prevents anemia"})]})]}),l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-purple-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"text-4xl",children:""}),l.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:l.jsx(El,{className:"w-5 h-5 text-purple-600"})})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Almond Energy"}),l.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Just ",l.jsx("span",{className:"font-bold text-purple-600",children:"23 almonds"})," provide 6g protein and healthy fats for brain power"]}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[l.jsx(dy,{className:"w-3 h-3"}),l.jsx("span",{children:"Boosts brain function"})]})]}),l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white rounded-2xl border-2 border-amber-200 p-5 hover:shadow-lg transition-all hover:-translate-y-1",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"text-4xl",children:""}),l.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:l.jsx(_k,{className:"w-5 h-5 text-amber-600"})})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Egg Vitamin D"}),l.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["One egg yolk has ",l.jsx("span",{className:"font-bold text-amber-600",children:"40 IU Vitamin D"})," - supports bone health"]}),l.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[l.jsx(Jy,{className:"w-3 h-3"}),l.jsx("span",{children:"Strengthens immunity"})]})]})]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 rounded-3xl border-2 border-purple-200 p-6 md:p-8",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:l.jsx(El,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Coming Soon"}),l.jsx("p",{className:"text-slate-600 text-sm",children:"Exciting new features we're working on"})]})]}),l.jsxs("div",{className:"md:grid md:grid-cols-3 md:gap-4 flex md:flex-none overflow-x-auto gap-4 pb-4 md:pb-0 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0",children:[l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white/80 backdrop-blur-sm rounded-2xl p-5 border-2 border-purple-200",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:l.jsx(dy,{className:"w-5 h-5 text-purple-600"})}),l.jsx(qa,{className:"w-5 h-5 text-amber-400"})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Mental Wellness"}),l.jsx("p",{className:"text-sm text-slate-600",children:"Mood tracking, meditation guides, and stress management tools"})]}),l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white/80 backdrop-blur-sm rounded-2xl p-5 border-2 border-pink-200",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center",children:l.jsx(Dl,{className:"w-5 h-5 text-pink-600"})}),l.jsx(qa,{className:"w-5 h-5 text-amber-400"})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Fitness Coaching"}),l.jsx("p",{className:"text-sm text-slate-600",children:"Personalized workout plans and virtual fitness trainer"})]}),l.jsxs("div",{className:"min-w-[280px] md:min-w-0 snap-center bg-white/80 backdrop-blur-sm rounded-2xl p-5 border-2 border-orange-200",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center",children:l.jsx(Jy,{className:"w-5 h-5 text-orange-600"})}),l.jsx(qa,{className:"w-5 h-5 text-amber-400"})]}),l.jsx("h3",{className:"font-bold text-slate-800 mb-2",children:"Health Insurance"}),l.jsx("p",{className:"text-sm text-slate-600",children:"Compare plans and manage your health coverage"})]})]})]}),l.jsx("div",{className:"bg-gradient-to-r from-cyan-500 to-emerald-500 rounded-3xl p-8 text-white",children:l.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Need Help Getting Started?"}),l.jsx("p",{className:"text-cyan-50",children:"Our AI assistant is here to guide you through your health journey"})]}),l.jsxs(Ut,{to:"/ai-chat",className:"px-8 py-4 bg-white text-cyan-600 rounded-xl font-bold hover:shadow-2xl transition-all flex items-center gap-2 group",children:[l.jsx(Xd,{className:"w-5 h-5"}),"Chat with AI",l.jsx(wa,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})})]})})}function lze(){var x,T;const{user:e}=ma(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0);if(Y.useEffect(()=>{(async()=>{try{const{data:N}=await Ya.getDashboard();a(N)}catch(N){console.error("Failed to fetch dashboard:",N)}finally{d(!1)}})()},[]),o)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:h,stats:f,todaySchedule:y,upcomingSchedule:b}=n||{};return(h==null?void 0:h.approvalStatus)==="pending"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(ec,{className:"w-8 h-8 text-amber-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),l.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[l.jsx(pa,{className:"w-4 h-4"})," Pending Review"]})]})}):(h==null?void 0:h.approvalStatus)==="rejected"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(tQ,{className:"w-8 h-8 text-red-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),l.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(x=h==null?void 0:h.name)==null?void 0:x.split(" ")[0],"! "]}),l.jsx("p",{className:"text-slate-500 mt-1",children:h==null?void 0:h.specialization})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs(Ut,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[l.jsx(Kf,{className:"w-4 h-4"})," Manage Slots"]}),h!=null&&h.isListed?l.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(Xr,{className:"w-4 h-4"})," Listed"]}):l.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(pa,{className:"w-4 h-4"})," Not Listed"]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(qr,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.todayAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(ua,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.upcomingAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(hf,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.totalPatients)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(qa,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((T=h==null?void 0:h.rating)==null?void 0:T.toFixed(1))||"0.0"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(y==null?void 0:y.length)>0?l.jsx("div",{className:"space-y-3",children:y.map(S=>{var N,O,A,I,P;return l.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((A=(O=(N=S.patient)==null?void 0:N.name)==null?void 0:O[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(I=S.patient)==null?void 0:I.name}),l.jsx("p",{className:"text-sm text-slate-500",children:S.timeSlot})]})]}),l.jsxs(Ut,{to:`/patient/${(P=S.patient)==null?void 0:P._id}?appointmentId=${S._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[l.jsx(Lh,{className:"w-4 h-4"})," View"]})]},S._id)})}):l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(qr,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No appointments today"})]})]}),(b==null?void 0:b.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ec,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),l.jsx("div",{className:"space-y-3",children:b.slice(0,5).map(S=>{var N,O,A,I;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((A=(O=(N=S.patient)==null?void 0:N.name)==null?void 0:O[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(I=S.patient)==null?void 0:I.name}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(S.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",S.timeSlot]})]})]})},S._id)})})]})]})}function qh(e,n,a,o){function d(h){return h instanceof a?h:new a(function(f){f(h)})}return new(a||(a=Promise))(function(h,f){function y(T){try{x(o.next(T))}catch(S){f(S)}}function b(T){try{x(o.throw(T))}catch(S){f(S)}}function x(T){T.done?h(T.value):d(T.value).then(y,b)}x((o=o.apply(e,n||[])).next())})}const dze=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Uf(e,n,a){const o=uze(e),{webkitRelativePath:d}=e,h=typeof n=="string"?n:typeof d=="string"&&d.length>0?d:`./${e.name}`;return typeof o.path!="string"&&RY(o,"path",h),RY(o,"relativePath",h),o}function uze(e){const{name:n}=e;if(n&&n.lastIndexOf(".")!==-1&&!e.type){const o=n.split(".").pop().toLowerCase(),d=dze.get(o);d&&Object.defineProperty(e,"type",{value:d,writable:!1,configurable:!1,enumerable:!0})}return e}function RY(e,n,a){Object.defineProperty(e,n,{value:a,writable:!1,configurable:!1,enumerable:!0})}const hze=[".DS_Store","Thumbs.db"];function pze(e){return qh(this,void 0,void 0,function*(){return Iw(e)&&mze(e.dataTransfer)?yze(e.dataTransfer,e.type):fze(e)?gze(e):Array.isArray(e)&&e.every(n=>"getFile"in n&&typeof n.getFile=="function")?vze(e):[]})}function mze(e){return Iw(e)}function fze(e){return Iw(e)&&Iw(e.target)}function Iw(e){return typeof e=="object"&&e!==null}function gze(e){return a2(e.target.files).map(n=>Uf(n))}function vze(e){return qh(this,void 0,void 0,function*(){return(yield Promise.all(e.map(a=>a.getFile()))).map(a=>Uf(a))})}function yze(e,n){return qh(this,void 0,void 0,function*(){if(e.items){const a=a2(e.items).filter(d=>d.kind==="file");if(n!=="drop")return a;const o=yield Promise.all(a.map(_ze));return AY(Vte(o))}return AY(a2(e.files).map(a=>Uf(a)))})}function AY(e){return e.filter(n=>hze.indexOf(n.name)===-1)}function a2(e){if(e===null)return[];const n=[];for(let a=0;a<e.length;a++){const o=e[a];n.push(o)}return n}function _ze(e){if(typeof e.webkitGetAsEntry!="function")return IY(e);const n=e.webkitGetAsEntry();return n&&n.isDirectory?Bte(n):IY(e,n)}function Vte(e){return e.reduce((n,a)=>[...n,...Array.isArray(a)?Vte(a):[a]],[])}function IY(e,n){return qh(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const h=yield e.getAsFileSystemHandle();if(h===null)throw new Error(`${e} is not a File`);if(h!==void 0){const f=yield h.getFile();return f.handle=h,Uf(f)}}const o=e.getAsFile();if(!o)throw new Error(`${e} is not a File`);return Uf(o,(a=n==null?void 0:n.fullPath)!==null&&a!==void 0?a:void 0)})}function bze(e){return qh(this,void 0,void 0,function*(){return e.isDirectory?Bte(e):xze(e)})}function Bte(e){const n=e.createReader();return new Promise((a,o)=>{const d=[];function h(){n.readEntries(f=>qh(this,void 0,void 0,function*(){if(f.length){const y=Promise.all(f.map(bze));d.push(y),h()}else try{const y=yield Promise.all(d);a(y)}catch(y){o(y)}}),f=>{o(f)})}h()})}function xze(e){return qh(this,void 0,void 0,function*(){return new Promise((n,a)=>{e.file(o=>{const d=Uf(o,e.fullPath);n(d)},o=>{a(o)})})})}var b1=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(",");if(a.length===0)return!0;var o=e.name||"",d=(e.type||"").toLowerCase(),h=d.replace(/\/.*$/,"");return a.some(function(f){var y=f.trim().toLowerCase();return y.charAt(0)==="."?o.toLowerCase().endsWith(y):y.endsWith("/*")?h===y.replace(/\/.*$/,""):d===y})}return!0};function OY(e){return wze(e)||Sze(e)||Wte(e)||Eze()}function Eze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wze(e){if(Array.isArray(e))return s2(e)}function PY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function DY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?PY(Object(a),!0).forEach(function(o){Gte(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):PY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Gte(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function k0(e,n){return Nze(e)||Cze(e,n)||Wte(e,n)||Tze()}function Tze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wte(e,n){if(e){if(typeof e=="string")return s2(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s2(e,n)}}function s2(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Cze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,h=!1,f,y;try{for(a=a.call(e);!(d=(f=a.next()).done)&&(o.push(f.value),!(n&&o.length===n));d=!0);}catch(b){h=!0,y=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(h)throw y}}return o}}function Nze(e){if(Array.isArray(e))return e}var Rze=typeof b1=="function"?b1:b1.default,Aze="file-invalid-type",Ize="file-too-large",Oze="file-too-small",Pze="too-many-files",Dze=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=n.split(","),o=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:Aze,message:"File type must be ".concat(o)}},kY=function(n){return{code:Ize,message:"File is larger than ".concat(n," ").concat(n===1?"byte":"bytes")}},jY=function(n){return{code:Oze,message:"File is smaller than ".concat(n," ").concat(n===1?"byte":"bytes")}},kze={code:Pze,message:"Too many files"};function $te(e,n){var a=e.type==="application/x-moz-file"||Rze(e,n);return[a,a?null:Dze(n)]}function Hte(e,n,a){if(mh(e.size))if(mh(n)&&mh(a)){if(e.size>a)return[!1,kY(a)];if(e.size<n)return[!1,jY(n)]}else{if(mh(n)&&e.size<n)return[!1,jY(n)];if(mh(a)&&e.size>a)return[!1,kY(a)]}return[!0,null]}function mh(e){return e!=null}function jze(e){var n=e.files,a=e.accept,o=e.minSize,d=e.maxSize,h=e.multiple,f=e.maxFiles,y=e.validator;return!h&&n.length>1||h&&f>=1&&n.length>f?!1:n.every(function(b){var x=$te(b,a),T=k0(x,1),S=T[0],N=Hte(b,o,d),O=k0(N,1),A=O[0],I=y?y(b):null;return S&&A&&!I})}function Ow(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function jE(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(n){return n==="Files"||n==="application/x-moz-file"}):!!e.target&&!!e.target.files}function LY(e){e.preventDefault()}function Lze(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function Mze(e){return e.indexOf("Edge/")!==-1}function Uze(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Lze(e)||Mze(e)}function Ac(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(o){for(var d=arguments.length,h=new Array(d>1?d-1:0),f=1;f<d;f++)h[f-1]=arguments[f];return n.some(function(y){return!Ow(o)&&y&&y.apply(void 0,[o].concat(h)),Ow(o)})}}function Fze(){return"showOpenFilePicker"in window}function Vze(e){if(mh(e)){var n=Object.entries(e).filter(function(a){var o=k0(a,2),d=o[0],h=o[1],f=!0;return zte(d)||(console.warn('Skipped "'.concat(d,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),f=!1),(!Array.isArray(h)||!h.every(Kte))&&(console.warn('Skipped "'.concat(d,'" because an invalid file extension was provided.')),f=!1),f}).reduce(function(a,o){var d=k0(o,2),h=d[0],f=d[1];return DY(DY({},a),{},Gte({},h,f))},{});return[{description:"Files",accept:n}]}return e}function Bze(e){if(mh(e))return Object.entries(e).reduce(function(n,a){var o=k0(a,2),d=o[0],h=o[1];return[].concat(OY(n),[d],OY(h))},[]).filter(function(n){return zte(n)||Kte(n)}).join(",")}function Gze(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Wze(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function zte(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function Kte(e){return/^.*\.[\w]+$/.test(e)}var $ze=["children"],Hze=["open"],zze=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Kze=["refKey","onChange","onClick"];function Yze(e){return Jze(e)||Xze(e)||Yte(e)||qze()}function qze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Jze(e){if(Array.isArray(e))return o2(e)}function x1(e,n){return eKe(e)||Zze(e,n)||Yte(e,n)||Qze()}function Qze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yte(e,n){if(e){if(typeof e=="string")return o2(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o2(e,n)}}function o2(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Zze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,h=!1,f,y;try{for(a=a.call(e);!(d=(f=a.next()).done)&&(o.push(f.value),!(n&&o.length===n));d=!0);}catch(b){h=!0,y=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(h)throw y}}return o}}function eKe(e){if(Array.isArray(e))return e}function MY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Fr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?MY(Object(a),!0).forEach(function(o){c2(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):MY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function c2(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Pw(e,n){if(e==null)return{};var a=tKe(e,n),o,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++)o=h[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function tKe(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,h;for(h=0;h<o.length;h++)d=o[h],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}var Nj=Y.forwardRef(function(e,n){var a=e.children,o=Pw(e,$ze),d=Xte(o),h=d.open,f=Pw(d,Hze);return Y.useImperativeHandle(n,function(){return{open:h}},[h]),ge.createElement(Y.Fragment,null,a(Fr(Fr({},f),{},{open:h})))});Nj.displayName="Dropzone";var qte={disabled:!1,getFilesFromEvent:pze,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Nj.defaultProps=qte;Nj.propTypes={children:Mt.func,accept:Mt.objectOf(Mt.arrayOf(Mt.string)),multiple:Mt.bool,preventDropOnDocument:Mt.bool,noClick:Mt.bool,noKeyboard:Mt.bool,noDrag:Mt.bool,noDragEventsBubbling:Mt.bool,minSize:Mt.number,maxSize:Mt.number,maxFiles:Mt.number,disabled:Mt.bool,getFilesFromEvent:Mt.func,onFileDialogCancel:Mt.func,onFileDialogOpen:Mt.func,useFsAccessApi:Mt.bool,autoFocus:Mt.bool,onDragEnter:Mt.func,onDragLeave:Mt.func,onDragOver:Mt.func,onDrop:Mt.func,onDropAccepted:Mt.func,onDropRejected:Mt.func,onError:Mt.func,validator:Mt.func};var l2={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Xte(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Fr(Fr({},qte),e),a=n.accept,o=n.disabled,d=n.getFilesFromEvent,h=n.maxSize,f=n.minSize,y=n.multiple,b=n.maxFiles,x=n.onDragEnter,T=n.onDragLeave,S=n.onDragOver,N=n.onDrop,O=n.onDropAccepted,A=n.onDropRejected,I=n.onFileDialogCancel,P=n.onFileDialogOpen,L=n.useFsAccessApi,F=n.autoFocus,V=n.preventDropOnDocument,G=n.noClick,B=n.noKeyboard,z=n.noDrag,q=n.noDragEventsBubbling,Z=n.onError,ie=n.validator,ue=Y.useMemo(function(){return Bze(a)},[a]),re=Y.useMemo(function(){return Vze(a)},[a]),pe=Y.useMemo(function(){return typeof P=="function"?P:UY},[P]),Se=Y.useMemo(function(){return typeof I=="function"?I:UY},[I]),fe=Y.useRef(null),be=Y.useRef(null),se=Y.useReducer(nKe,l2),he=x1(se,2),Q=he[0],le=he[1],we=Q.isFocused,Ue=Q.isFileDialogActive,Le=Y.useRef(typeof window<"u"&&window.isSecureContext&&L&&Fze()),tt=function(){!Le.current&&Ue&&setTimeout(function(){if(be.current){var Vt=be.current.files;Vt.length||(le({type:"closeDialog"}),Se())}},300)};Y.useEffect(function(){return window.addEventListener("focus",tt,!1),function(){window.removeEventListener("focus",tt,!1)}},[be,Ue,Se,Le]);var Te=Y.useRef([]),De=function(Vt){fe.current&&fe.current.contains(Vt.target)||(Vt.preventDefault(),Te.current=[])};Y.useEffect(function(){return V&&(document.addEventListener("dragover",LY,!1),document.addEventListener("drop",De,!1)),function(){V&&(document.removeEventListener("dragover",LY),document.removeEventListener("drop",De))}},[fe,V]),Y.useEffect(function(){return!o&&F&&fe.current&&fe.current.focus(),function(){}},[fe,F,o]);var qe=Y.useCallback(function(at){Z?Z(at):console.error(at)},[Z]),It=Y.useCallback(function(at){at.preventDefault(),at.persist(),Bn(at),Te.current=[].concat(Yze(Te.current),[at.target]),jE(at)&&Promise.resolve(d(at)).then(function(Vt){if(!(Ow(at)&&!q)){var kr=Vt.length,Qn=kr>0&&jze({files:Vt,accept:ue,minSize:f,maxSize:h,multiple:y,maxFiles:b,validator:ie}),qi=kr>0&&!Qn;le({isDragAccept:Qn,isDragReject:qi,isDragActive:!0,type:"setDraggedFiles"}),x&&x(at)}}).catch(function(Vt){return qe(Vt)})},[d,x,qe,q,ue,f,h,y,b,ie]),rt=Y.useCallback(function(at){at.preventDefault(),at.persist(),Bn(at);var Vt=jE(at);if(Vt&&at.dataTransfer)try{at.dataTransfer.dropEffect="copy"}catch{}return Vt&&S&&S(at),!1},[S,q]),Fe=Y.useCallback(function(at){at.preventDefault(),at.persist(),Bn(at);var Vt=Te.current.filter(function(Qn){return fe.current&&fe.current.contains(Qn)}),kr=Vt.indexOf(at.target);kr!==-1&&Vt.splice(kr,1),Te.current=Vt,!(Vt.length>0)&&(le({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),jE(at)&&T&&T(at))},[fe,T,q]),ut=Y.useCallback(function(at,Vt){var kr=[],Qn=[];at.forEach(function(qi){var zc=$te(qi,ue),Kc=x1(zc,2),Xh=Kc[0],Jh=Kc[1],Qh=Hte(qi,f,h),Is=x1(Qh,2),Zh=Is[0],lg=Is[1],dg=ie?ie(qi):null;if(Xh&&Zh&&!dg)kr.push(qi);else{var rc=[Jh,lg];dg&&(rc=rc.concat(dg)),Qn.push({file:qi,errors:rc.filter(function(n_){return n_})})}}),(!y&&kr.length>1||y&&b>=1&&kr.length>b)&&(kr.forEach(function(qi){Qn.push({file:qi,errors:[kze]})}),kr.splice(0)),le({acceptedFiles:kr,fileRejections:Qn,isDragReject:Qn.length>0,type:"setFiles"}),N&&N(kr,Qn,Vt),Qn.length>0&&A&&A(Qn,Vt),kr.length>0&&O&&O(kr,Vt)},[le,y,ue,f,h,b,N,O,A,ie]),vt=Y.useCallback(function(at){at.preventDefault(),at.persist(),Bn(at),Te.current=[],jE(at)&&Promise.resolve(d(at)).then(function(Vt){Ow(at)&&!q||ut(Vt,at)}).catch(function(Vt){return qe(Vt)}),le({type:"reset"})},[d,ut,qe,q]),Ce=Y.useCallback(function(){if(Le.current){le({type:"openDialog"}),pe();var at={multiple:y,types:re};window.showOpenFilePicker(at).then(function(Vt){return d(Vt)}).then(function(Vt){ut(Vt,null),le({type:"closeDialog"})}).catch(function(Vt){Gze(Vt)?(Se(Vt),le({type:"closeDialog"})):Wze(Vt)?(Le.current=!1,be.current?(be.current.value=null,be.current.click()):qe(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):qe(Vt)});return}be.current&&(le({type:"openDialog"}),pe(),be.current.value=null,be.current.click())},[le,pe,Se,L,ut,qe,re,y]),xt=Y.useCallback(function(at){!fe.current||!fe.current.isEqualNode(at.target)||(at.key===" "||at.key==="Enter"||at.keyCode===32||at.keyCode===13)&&(at.preventDefault(),Ce())},[fe,Ce]),Nt=Y.useCallback(function(){le({type:"focus"})},[]),pt=Y.useCallback(function(){le({type:"blur"})},[]),Xe=Y.useCallback(function(){G||(Uze()?setTimeout(Ce,0):Ce())},[G,Ce]),ye=function(Vt){return o?null:Vt},Ve=function(Vt){return B?null:ye(Vt)},ht=function(Vt){return z?null:ye(Vt)},Bn=function(Vt){q&&Vt.stopPropagation()},li=Y.useMemo(function(){return function(){var at=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Vt=at.refKey,kr=Vt===void 0?"ref":Vt,Qn=at.role,qi=at.onKeyDown,zc=at.onFocus,Kc=at.onBlur,Xh=at.onClick,Jh=at.onDragEnter,Qh=at.onDragOver,Is=at.onDragLeave,Zh=at.onDrop,lg=Pw(at,zze);return Fr(Fr(c2({onKeyDown:Ve(Ac(qi,xt)),onFocus:Ve(Ac(zc,Nt)),onBlur:Ve(Ac(Kc,pt)),onClick:ye(Ac(Xh,Xe)),onDragEnter:ht(Ac(Jh,It)),onDragOver:ht(Ac(Qh,rt)),onDragLeave:ht(Ac(Is,Fe)),onDrop:ht(Ac(Zh,vt)),role:typeof Qn=="string"&&Qn!==""?Qn:"presentation"},kr,fe),!o&&!B?{tabIndex:0}:{}),lg)}},[fe,xt,Nt,pt,Xe,It,rt,Fe,vt,B,z,o]),is=Y.useCallback(function(at){at.stopPropagation()},[]),zl=Y.useMemo(function(){return function(){var at=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Vt=at.refKey,kr=Vt===void 0?"ref":Vt,Qn=at.onChange,qi=at.onClick,zc=Pw(at,Kze),Kc=c2({accept:ue,multiple:y,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:ye(Ac(Qn,vt)),onClick:ye(Ac(qi,is)),tabIndex:-1},kr,be);return Fr(Fr({},Kc),zc)}},[be,a,y,vt,o]);return Fr(Fr({},Q),{},{isFocused:we&&!o,getRootProps:li,getInputProps:zl,rootRef:fe,inputRef:be,open:ye(Ce)})}function nKe(e,n){switch(n.type){case"focus":return Fr(Fr({},e),{},{isFocused:!0});case"blur":return Fr(Fr({},e),{},{isFocused:!1});case"openDialog":return Fr(Fr({},l2),{},{isFileDialogActive:!0});case"closeDialog":return Fr(Fr({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return Fr(Fr({},e),{},{isDragActive:n.isDragActive,isDragAccept:n.isDragAccept,isDragReject:n.isDragReject});case"setFiles":return Fr(Fr({},e),{},{acceptedFiles:n.acceptedFiles,fileRejections:n.fileRejections,isDragReject:n.isDragReject});case"reset":return Fr({},l2);default:return e}}function UY(){}const rKe=[{value:"Blood Test",label:"Blood Test"},{value:"X-Ray",label:"X-Ray"},{value:"MRI",label:"MRI"},{value:"CT Scan",label:"CT Scan"},{value:"ECG",label:"ECG"},{value:"Ultrasound",label:"Ultrasound"},{value:"General Checkup",label:"General Checkup"},{value:"Other",label:"Other"}];function iKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!1),[d,h]=Y.useState(0),f=ns();Y.useState(()=>{window.scrollTo(0,0)},[]);const y=Y.useCallback(A=>{const I=A.map(P=>({file:P,id:Math.random().toString(36).substr(2,9),reportType:"Blood Test",name:P.name,size:P.size}));n(P=>[...P,...I])},[]),{getRootProps:b,getInputProps:x,isDragActive:T}=Xte({onDrop:y,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),S=(A,I)=>{n(P=>P.map(L=>L.id===A?{...L,reportType:I}:L))},N=A=>{n(I=>I.filter(P=>P.id!==A))},O=async A=>{var P,L;if(A.preventDefault(),e.length===0){et.error("Please select at least one file");return}o(!0),h(0);const I=setInterval(()=>{h(F=>F>=90?(clearInterval(I),90):F+10)},500);try{const F=new FormData;F.append("report",e[0].file),F.append("reportType",e[0].reportType);const{data:V}=await Pl.uploadReport(F);clearInterval(I),h(100),et.success("Report analyzed successfully!"),setTimeout(()=>f(`/reports/${V.report._id}`),500)}catch(F){clearInterval(I),et.error(((L=(P=F.response)==null?void 0:P.data)==null?void 0:L.message)||"Failed to analyze report"),h(0)}finally{o(!1)}};return l.jsxs("div",{className:"space-y-3 sm:space-y-6 animate-fade-in p-4 max-w-4xl mx-auto",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-slate-800",children:"Upload Medical Reports"}),l.jsx("p",{className:"text-slate-500 mt-1 text-xs sm:text-sm",children:"Upload your medical documents for AI-powered analysis"})]}),l.jsxs("div",{...b(),className:`relative border-2 border-dashed rounded-2xl p-6 sm:p-12 text-center cursor-pointer transition-all ${T?"border-cyan-500 bg-cyan-50":"border-slate-300 hover:border-cyan-400 bg-white"}`,children:[l.jsx("input",{...x()}),l.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-cyan-100 flex items-center justify-center mx-auto mb-3 sm:mb-4",children:l.jsx(Ts,{className:"w-6 h-6 sm:w-8 sm:h-8 text-cyan-600"})}),l.jsx("p",{className:"text-base sm:text-lg font-semibold text-slate-800 mb-1 sm:mb-2",children:T?"Drop files here":"Tap to upload"}),l.jsx("p",{className:"text-slate-500 mb-3 sm:mb-4 text-xs sm:text-sm",children:"PDF, PNG, JPG  Max 10MB"}),l.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-4 text-xs sm:text-sm text-slate-600",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Xr,{className:"w-3 h-3 sm:w-4 sm:h-4 text-emerald-500"})," PDF"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Xr,{className:"w-3 h-3 sm:w-4 sm:h-4 text-emerald-500"})," PNG"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Xr,{className:"w-3 h-3 sm:w-4 sm:h-4 text-emerald-500"})," JPG"]})]})]}),e.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm",children:[l.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-200",children:l.jsxs("h3",{className:"font-semibold text-slate-800 text-sm sm:text-base",children:["Files (",e.length,")"]})}),l.jsx("div",{className:"divide-y divide-slate-200 max-h-[200px] overflow-y-auto",children:e.map(A=>l.jsxs("div",{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-4",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-cyan-100 flex items-center justify-center flex-shrink-0",children:l.jsx(Vn,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-600"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"font-medium text-slate-800 truncate text-xs sm:text-sm",children:A.name}),l.jsxs("p",{className:"text-xs text-slate-500",children:[(A.size/1024/1024).toFixed(2)," MB"]})]}),l.jsxs("div",{className:"relative flex-shrink-0",children:[l.jsx("select",{value:A.reportType,onChange:I=>S(A.id,I.target.value),className:"appearance-none bg-white text-slate-800 text-xs sm:text-sm px-2 py-1 sm:px-4 sm:py-2 pr-6 sm:pr-8 rounded-xl border border-slate-300 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none cursor-pointer",children:rKe.map(I=>l.jsx("option",{value:I.value,children:I.label},I.value))}),l.jsx(iT,{className:"absolute right-1 sm:right-2 top-1/2 -translate-y-1/2 w-3 h-3 sm:w-4 sm:h-4 text-slate-400 pointer-events-none"})]}),l.jsx("button",{onClick:()=>N(A.id),className:"p-1.5 sm:p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all flex-shrink-0",children:l.jsx(sT,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]},A.id))})]}),a&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 sm:p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-3 sm:mb-4",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(P7,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-600 animate-spin"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800 text-sm sm:text-base",children:"Analyzing..."}),l.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"AI is extracting insights"})]})]}),l.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500",style:{width:`${d}%`}})}),l.jsxs("p",{className:"text-xs sm:text-sm text-slate-500 mt-2 text-right",children:[d,"%"]})]}),l.jsx("button",{onClick:O,disabled:a||e.length===0,className:"w-full py-3 sm:py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm sm:text-base",children:a?l.jsxs(l.Fragment,{children:[l.jsx(P7,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin"}),"Analyzing..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Ts,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Upload & Analyze"]})}),l.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs sm:text-sm text-slate-500 pt-2",children:[l.jsx(Jy,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{children:"Encrypted & HIPAA Compliant"})]})]})}const aKe={en:{whatIsIt:"What is",whenHigh:"When High",whenLow:"When Low",howToImprove:"How to Improve",gotIt:"Got it"},hi:{whatIsIt:"  ",whenHigh:"  ",whenLow:"  ",howToImprove:"  ",gotIt:" "}},E1={},sKe=({metric:e,onClose:n})=>{var O,A,I;const[a,o]=Y.useState("en"),[d,h]=Y.useState(null),[f,y]=Y.useState(!1),[b,x]=Y.useState(!1),T=()=>({en:{name:e.name,whatIsIt:`${e.name} is a health metric. Your current value is ${e.value} ${e.unit||""}.`,whenHighTitle:"When High",whenHighEffects:["Please consult with a healthcare professional"],whenLowTitle:"When Low",whenLowEffects:["Please consult with a healthcare professional"],solutions:["Consult with your doctor for personalized advice"]},hi:{name:e.name,whatIsIt:`${e.name}    `,whenHighTitle:"  ",whenHighEffects:["    "],whenLowTitle:"  ",whenLowEffects:["    "],solutions:["        "]}});if(Y.useEffect(()=>{h(T()),y(!1),x(!1),e&&(async()=>{try{const L=`${e.name}-${e.value}`;if(E1[L]){console.log(" Using cached metric info for:",e.name),h(E1[L]),x(!0);return}console.log(" Fetching AI-generated metric info for:",e.name),y(!0);const F=await Pl.getMetricInfo({metricName:e.name,metricValue:e.value,normalRange:e.normalRange,unit:e.unit});console.log(" Received AI metric info:",F.data),E1[L]=F.data.metricInfo,h(F.data.metricInfo),x(!0),y(!1)}catch(L){console.error("Error fetching metric info:",L),y(!1)}})()},[e]),!e||!d)return null;const S=d[a],N=aKe[a];return l.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center z-[9999] p-0 sm:p-4",onClick:n,children:l.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto p-5 sm:p-6 relative animate-slide-up sm:animate-fade-in shadow-xl",onClick:P=>P.stopPropagation(),children:[l.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4 sm:hidden"}),l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-800 mb-2",children:S.name}),l.jsxs("p",{className:"text-slate-600",children:[a==="hi"?" ":"Normal Range",": ",l.jsxs("span",{className:"font-semibold text-cyan-600",children:[e.normalRange," ",e.unit]})]})]}),l.jsx("div",{className:"flex flex-col items-end gap-2",children:l.jsxs("select",{value:a,onChange:P=>o(P.target.value),className:"px-3 py-2 bg-white border-2 border-slate-200 rounded-lg text-sm font-medium text-slate-700 cursor-pointer hover:border-cyan-400 focus:outline-none focus:border-cyan-500 transition-colors",children:[l.jsx("option",{value:"en",children:"English"}),l.jsx("option",{value:"hi",children:""})]})})]}),l.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1",children:l.jsx(bi,{className:"w-5 h-5"})}),f?l.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mb-4"}),l.jsx("p",{className:"text-slate-600 font-medium",children:"Generating AI insights..."}),l.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"This usually takes 2-3 seconds"})]}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"mb-6 p-4 bg-cyan-50 rounded-xl border-2 border-cyan-200",children:[l.jsxs("h3",{className:"text-lg font-bold text-cyan-700 mb-2",children:[N.whatIsIt," ",S.name,"?"]}),l.jsx("p",{className:"text-slate-700 leading-relaxed",children:S.whatIsIt})]}),l.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"text-lg font-bold text-red-700 mb-3",children:S.whenHighTitle}),l.jsx("ul",{className:"space-y-2",children:(O=S.whenHighEffects)==null?void 0:O.map((P,L)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-red-500 font-bold mt-0.5",children:""}),P]},L))})]}),l.jsxs("div",{className:"mb-6 p-4 bg-amber-50 rounded-xl border-2 border-amber-200",children:[l.jsx("h3",{className:"text-lg font-bold text-amber-700 mb-3",children:S.whenLowTitle}),l.jsx("ul",{className:"space-y-2",children:(A=S.whenLowEffects)==null?void 0:A.map((P,L)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-amber-500 font-bold mt-0.5",children:""}),P]},L))})]}),l.jsxs("div",{className:"mb-6 p-4 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsxs("h3",{className:"text-lg font-bold text-emerald-700 mb-3",children:[" ",N.howToImprove]}),l.jsx("ul",{className:"space-y-2",children:(I=S.solutions)==null?void 0:I.map((P,L)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-emerald-500 font-bold mt-0.5",children:""}),P]},L))})]}),b&&l.jsx("div",{className:"mb-4 p-2 bg-green-50 rounded-lg border border-green-200 flex items-center gap-2",children:l.jsx("span",{className:"text-green-600 text-sm",children:" AI-Generated Information"})}),l.jsx("button",{onClick:n,className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors sm:hidden",children:N.gotIt})]})]})})};function oKe(){var P,L,F,V,G,B,z,q,Z,ie,ue,re,pe,Se,fe,be,se,he;const{id:e}=V0(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0),[h,f]=Y.useState(null),[y,b]=Y.useState(!1),[x,T]=Y.useState(null),[S,N]=Y.useState(null);Y.useEffect(()=>{(async()=>{try{const{data:le}=await Pl.getReport(e);a(le.report)}catch{et.error("Failed to load report")}finally{d(!1)}})()},[e]);const O=async()=>{try{const{data:Q}=await Pl.compareReport(e);Q.comparison?(N(Q),T(Q.previousReport),b(!0)):et.info("No previous report found for comparison")}catch{et.error("Failed to load comparison data")}};if(o)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading report..."})]})});if(!n)return l.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:A}=n,I=(A==null?void 0:A.healthScore)||0;return l.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[h&&l.jsx(sKe,{metric:h,onClose:()=>f(null)}),l.jsxs(Ut,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-6",children:[l.jsxs("div",{className:"flex items-center gap-5",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(Vn,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold",children:[n.reportType," Report"]}),l.jsxs("p",{className:"text-white/70",children:["Analyzed on ",new Date(n.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),((P=n.aiAnalysis)==null?void 0:P.patientName)&&n.aiAnalysis.patientName!=="Patient"&&l.jsxs("p",{className:"text-white/90 text-sm mt-2 font-semibold",children:[" ",n.aiAnalysis.patientName,((L=n.aiAnalysis)==null?void 0:L.patientAge)&&n.aiAnalysis.patientAge!=="N/A"&&`  Age: ${n.aiAnalysis.patientAge}`,((F=n.aiAnalysis)==null?void 0:F.patientGender)&&n.aiAnalysis.patientGender!=="N/A"&&`  ${n.aiAnalysis.patientGender}`]}),((V=n.aiAnalysis)==null?void 0:V.reportDate)&&n.aiAnalysis.reportDate!=="N/A"&&l.jsxs("p",{className:"text-white/70 text-sm",children:[" Report Date: ",n.aiAnalysis.reportDate]})]})]}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[l.jsx("p",{className:"text-4xl font-bold",children:I}),l.jsx("p",{className:"text-sm text-white/70",children:"Health Score"})]}),l.jsxs("button",{onClick:O,className:"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all flex items-center gap-2 text-sm font-medium",children:[l.jsx(GJ,{className:"w-4 h-4"}),"Compare with Previous"]})]})]})]}),(A==null?void 0:A.summary)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-3 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-5 h-5 text-cyan-500"})," Summary"]}),l.jsx("p",{className:"text-slate-700 leading-relaxed mb-4",children:A.summary}),(A==null?void 0:A.keyFindings)&&A.keyFindings.length>0&&l.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:[l.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:" Key Findings"}),l.jsx("ul",{className:"space-y-2",children:A.keyFindings.map((Q,le)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-blue-500 font-bold mt-0.5",children:""}),Q]},le))})]})]}),(A==null?void 0:A.metrics)&&Object.keys(A.metrics).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-bold text-slate-800 mb-6",children:"All Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(A.metrics).map(([Q,le])=>l.jsxs("button",{onClick:()=>f({key:Q,name:Q.replace(/([A-Z])/g," $1"),...le}),className:`p-4 rounded-xl border-2 cursor-pointer transition-all hover:shadow-md hover:scale-105 text-left ${le.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":le.status==="borderline"?"bg-amber-50 border-amber-200 hover:border-amber-300":"bg-red-50 border-red-200 hover:border-red-300"}`,children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("p",{className:"text-sm text-slate-600 capitalize font-medium",children:Q.replace(/([A-Z])/g," $1")}),l.jsx(Lh,{className:"w-4 h-4 text-slate-400"})]}),l.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[le.value," ",l.jsx("span",{className:"text-sm font-normal text-slate-500",children:le.unit})]}),l.jsxs("div",{className:"flex items-center justify-between mt-2",children:[l.jsxs("span",{className:"text-xs text-slate-600",children:["Normal: ",le.normalRange]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${le.status==="normal"?"bg-emerald-100 text-emerald-700":le.status==="borderline"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:le.status})]})]},Q))})]}),((G=A==null?void 0:A.deficiencies)==null?void 0:G.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(uf,{className:"w-5 h-5 text-amber-500"})," Detected Deficiencies"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:A.deficiencies.map((Q,le)=>{var we;return l.jsxs("button",{onClick:()=>Q.name&&f({key:Q.name.toLowerCase().replace(/\s+/g,""),name:Q.name,value:Q.currentValue,normalRange:Q.normalRange,unit:""}),className:`p-4 rounded-xl border-2 cursor-pointer transition-all hover:shadow-md hover:scale-105 text-left ${Q.severity==="severe"?"bg-red-50 border-red-200 hover:border-red-300":Q.severity==="moderate"?"bg-amber-50 border-amber-200 hover:border-amber-300":"bg-yellow-50 border-yellow-200 hover:border-yellow-300"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"font-bold text-slate-800",children:Q.name||"Unknown Deficiency"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Q.severity==="severe"?"bg-red-100 text-red-700":Q.severity==="moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:Q.severity||"unknown"}),l.jsx(Lh,{className:"w-4 h-4 text-slate-400"})]})]}),l.jsxs("p",{className:"text-sm text-slate-700 font-medium",children:["Current: ",Q.currentValue||"N/A"]}),l.jsxs("p",{className:"text-sm text-slate-600",children:["Normal: ",Q.normalRange||"N/A"]}),((we=Q.symptoms)==null?void 0:we.length)>0&&l.jsxs("p",{className:"text-xs text-slate-600 mt-2",children:["Symptoms: ",Q.symptoms.join(", ")]})]},le)})})]}),((B=A==null?void 0:A.supplements)==null?void 0:B.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-purple-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(tu,{className:"w-5 h-5 text-purple-500"})," Recommended Supplements & Natural Sources"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:A.supplements.map((Q,le)=>l.jsxs("div",{className:"p-4 bg-purple-50 rounded-xl border-2 border-purple-200",children:[l.jsx("div",{className:"flex items-start justify-between mb-2",children:l.jsx("h3",{className:"font-bold text-slate-800",children:Q.category})}),l.jsxs("p",{className:"text-sm text-slate-700 mb-2",children:[l.jsx("strong",{children:"Why:"})," ",Q.reason]}),l.jsxs("p",{className:"text-sm text-slate-700 mb-2",children:[l.jsx("strong",{children:"Natural Sources:"})," ",Q.naturalSources]}),l.jsxs("p",{className:"text-xs text-slate-600 italic",children:[" ",Q.note]})]},le))})]}),(A==null?void 0:A.dietPlan)&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-green-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(MTe,{className:"w-5 h-5 text-green-500"})," Personalized Diet Plan"]}),l.jsx("p",{className:"text-slate-700 mb-6 font-medium",children:A.dietPlan.overview}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[((z=A.dietPlan.breakfast)==null?void 0:z.length)>0&&l.jsxs("div",{className:"p-4 bg-orange-50 rounded-xl border-2 border-orange-200",children:[l.jsx("h3",{className:"font-bold text-orange-700 mb-3",children:" Breakfast"}),A.dietPlan.breakfast.map((Q,le)=>{var we;return l.jsxs("div",{className:"mb-3 pb-3 border-b border-orange-200 last:border-0",children:[l.jsx("p",{className:"font-medium text-slate-800",children:Q.meal}),l.jsxs("p",{className:"text-xs text-slate-600",children:["Nutrients: ",(we=Q.nutrients)==null?void 0:we.join(", ")]}),l.jsxs("p",{className:"text-xs text-orange-600 italic",children:[" ",Q.tip]})]},le)})]}),((q=A.dietPlan.lunch)==null?void 0:q.length)>0&&l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:[l.jsx("h3",{className:"font-bold text-blue-700 mb-3",children:" Lunch"}),A.dietPlan.lunch.map((Q,le)=>{var we;return l.jsxs("div",{className:"mb-3 pb-3 border-b border-blue-200 last:border-0",children:[l.jsx("p",{className:"font-medium text-slate-800",children:Q.meal}),l.jsxs("p",{className:"text-xs text-slate-600",children:["Nutrients: ",(we=Q.nutrients)==null?void 0:we.join(", ")]}),l.jsxs("p",{className:"text-xs text-blue-600 italic",children:[" ",Q.tip]})]},le)})]}),((Z=A.dietPlan.dinner)==null?void 0:Z.length)>0&&l.jsxs("div",{className:"p-4 bg-indigo-50 rounded-xl border-2 border-indigo-200",children:[l.jsx("h3",{className:"font-bold text-indigo-700 mb-3",children:" Dinner"}),A.dietPlan.dinner.map((Q,le)=>{var we;return l.jsxs("div",{className:"mb-3 pb-3 border-b border-indigo-200 last:border-0",children:[l.jsx("p",{className:"font-medium text-slate-800",children:Q.meal}),l.jsxs("p",{className:"text-xs text-slate-600",children:["Nutrients: ",(we=Q.nutrients)==null?void 0:we.join(", ")]}),l.jsxs("p",{className:"text-xs text-indigo-600 italic",children:[" ",Q.tip]})]},le)})]}),((ie=A.dietPlan.snacks)==null?void 0:ie.length)>0&&l.jsxs("div",{className:"p-4 bg-pink-50 rounded-xl border-2 border-pink-200",children:[l.jsx("h3",{className:"font-bold text-pink-700 mb-3",children:" Snacks"}),A.dietPlan.snacks.map((Q,le)=>{var we;return l.jsxs("div",{className:"mb-3 pb-3 border-b border-pink-200 last:border-0",children:[l.jsx("p",{className:"font-medium text-slate-800",children:Q.meal}),l.jsxs("p",{className:"text-xs text-slate-600",children:["Nutrients: ",(we=Q.nutrients)==null?void 0:we.join(", ")]}),l.jsxs("p",{className:"text-xs text-pink-600 italic",children:[" ",Q.tip]})]},le)})]})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[((ue=A.dietPlan.foodsToIncrease)==null?void 0:ue.length)>0&&l.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsx("h3",{className:"font-bold text-emerald-700 mb-2",children:" Foods to Increase"}),l.jsx("ul",{className:"space-y-1",children:A.dietPlan.foodsToIncrease.map((Q,le)=>l.jsxs("li",{className:"text-sm text-slate-700",children:[" ",Q]},le))})]}),((re=A.dietPlan.foodsToLimit)==null?void 0:re.length)>0&&l.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"font-bold text-red-700 mb-2",children:" Foods to Limit"}),l.jsx("ul",{className:"space-y-1",children:A.dietPlan.foodsToLimit.map((Q,le)=>l.jsxs("li",{className:"text-sm text-slate-700",children:[" ",Q]},le))})]})]}),A.dietPlan.hydration&&l.jsxs("div",{className:"p-4 bg-cyan-50 rounded-xl border-2 border-cyan-200 mb-4",children:[l.jsx("h3",{className:"font-bold text-cyan-700 mb-2",children:" Hydration"}),l.jsx("p",{className:"text-sm text-slate-700",children:A.dietPlan.hydration})]}),((pe=A.dietPlan.tips)==null?void 0:pe.length)>0&&l.jsxs("div",{className:"p-4 bg-yellow-50 rounded-xl border-2 border-yellow-200",children:[l.jsx("h3",{className:"font-bold text-yellow-700 mb-2",children:" Tips"}),l.jsx("ul",{className:"space-y-1",children:A.dietPlan.tips.map((Q,le)=>l.jsxs("li",{className:"text-sm text-slate-700",children:[" ",Q]},le))})]})]}),(A==null?void 0:A.recommendations)&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-red-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(fr,{className:"w-5 h-5 text-red-500"})," Health Recommendations"]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((Se=A.recommendations.lifestyle)==null?void 0:Se.length)>0&&l.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"font-bold text-red-700 mb-3",children:" Lifestyle Changes"}),l.jsx("ul",{className:"space-y-2",children:A.recommendations.lifestyle.map((Q,le)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-red-500 font-bold mt-0.5",children:""}),Q]},le))})]}),((fe=A.recommendations.tests)==null?void 0:fe.length)>0&&l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:[l.jsx("h3",{className:"font-bold text-blue-700 mb-3",children:" Follow-up Tests"}),l.jsx("ul",{className:"space-y-2",children:A.recommendations.tests.map((Q,le)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx("span",{className:"text-blue-500 font-bold mt-0.5",children:""}),Q]},le))})]})]})]}),y&&S&&l.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl border-2 border-blue-200 p-6 shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("h2",{className:"text-xl font-bold text-blue-900 flex items-center gap-2",children:[l.jsx(ua,{className:"w-6 h-6 text-blue-600"}),"Report Comparison"]}),l.jsx("button",{onClick:()=>b(!1),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Close"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-blue-200",children:[l.jsx("p",{className:"text-sm text-blue-600 font-semibold mb-2",children:"Current Report"}),l.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((be=S.currentReport)==null?void 0:be.healthScore)||0}),l.jsx("p",{className:"text-xs text-blue-600 mt-1",children:new Date((se=S.currentReport)==null?void 0:se.createdAt).toLocaleDateString()})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-amber-200",children:[l.jsx("p",{className:"text-sm text-amber-600 font-semibold mb-2",children:"Previous Report"}),l.jsx("p",{className:"text-2xl font-bold text-amber-900",children:(x==null?void 0:x.healthScore)||0}),l.jsx("p",{className:"text-xs text-amber-600 mt-1",children:new Date(x==null?void 0:x.createdAt).toLocaleDateString()})]})]}),((he=S.currentReport)==null?void 0:he.metrics)&&l.jsxs("div",{className:"bg-white rounded-xl p-4 border-2 border-blue-200",children:[l.jsx("h3",{className:"font-bold text-blue-900 mb-4",children:"Metrics Comparison"}),l.jsx("div",{className:"space-y-3",children:Object.entries(S.currentReport.metrics||{}).map(([Q,le])=>{var tt;const we=(tt=x==null?void 0:x.metrics)==null?void 0:tt[Q];if(!we)return null;const Ue=le.value-we.value,Le=le.status==="normal"&&we.status!=="normal"||Ue>0&&Q.includes("HDL")||Ue<0&&!Q.includes("HDL")&&!Q.includes("Glucose")&&!Q.includes("Cholesterol");return l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"font-medium text-slate-800",children:Q}),l.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[l.jsxs("div",{className:"text-sm",children:[l.jsx("span",{className:"text-slate-600",children:"Previous: "}),l.jsxs("span",{className:"font-semibold text-amber-700",children:[we.value," ",we.unit]})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("span",{className:"text-slate-600",children:"Current: "}),l.jsxs("span",{className:"font-semibold text-blue-700",children:[le.value," ",le.unit]})]})]})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("div",{className:`text-sm font-bold ${Le?"text-green-600":"text-red-600"}`,children:[Le?"":""," ",Math.abs(Ue).toFixed(1)]}),l.jsx("p",{className:`text-xs font-medium ${Le?"text-green-600":"text-red-600"}`,children:Le?"Improved":"Changed"})]})]},Q)})})]})]}),l.jsx("div",{className:"p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:l.jsxs("p",{className:"text-sm text-blue-700",children:[l.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})})]})}const cKe=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function lKe(){var pe,Se,fe,be;const e=ns(),[n,a]=Y.useState([]),[o,d]=Y.useState([]),[h,f]=Y.useState(!0),[y,b]=Y.useState("All"),[x,T]=Y.useState(""),[S,N]=Y.useState(null),[O,A]=Y.useState({date:"",timeSlot:"",symptoms:""}),[I,P]=Y.useState(!1),[L,F]=Y.useState("doctors"),[V,G]=Y.useState([]),[B,z]=Y.useState(!1);Y.useEffect(()=>{q()},[y]);const q=async()=>{try{const se={};y!=="All"&&(se.specialization=y);const[he,Q]=await Promise.all([Ya.getAll(se),Ya.getAppointments()]);a(he.data),d(Q.data)}catch(se){console.error("Failed to fetch data:",se)}finally{f(!1)}};Y.useEffect(()=>{S&&O.date&&Z()},[S,O.date]);const Z=async()=>{var se;if(!(!S||!O.date)){z(!0);try{const{data:he}=await Ya.getDoctorAvailableSlots(S._id);console.log("Slots response:",he);const Q=new Date(O.date).toDateString();console.log("Looking for dateKey:",Q),console.log("Available keys:",Object.keys(he.slotsByDate||{})),G(((se=he.slotsByDate)==null?void 0:se[Q])||[])}catch(he){console.error("Failed to fetch slots:",he),G([])}finally{z(!1)}}},ie=n.filter(se=>{var he,Q,le;return((Q=se.name||((he=se.user)==null?void 0:he.name))==null?void 0:Q.toLowerCase().includes(x.toLowerCase()))||((le=se.specialization)==null?void 0:le.toLowerCase().includes(x.toLowerCase()))}),ue=async se=>{var he,Q;if(se.preventDefault(),!O.date||!O.timeSlot){et.error("Please select date and time");return}P(!0);try{await Ya.bookAppointment({doctorId:S._id,...O,type:"video"}),et.success("Appointment booked successfully!"),N(null),A({date:"",timeSlot:"",symptoms:""}),G([]),q()}catch(le){et.error(((Q=(he=le.response)==null?void 0:he.data)==null?void 0:Q.message)||"Failed to book appointment")}finally{P(!1)}},re=()=>{const se=[];for(let he=0;he<7;he++){const Q=new Date;Q.setDate(Q.getDate()+he),se.push({value:Q.toISOString().split("T")[0],label:Q.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:he===0})}return se};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[l.jsxs("button",{onClick:()=>F("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${L==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(Bc,{className:"w-4 h-4"})," Find Doctors"]}),l.jsxs("button",{onClick:()=>F("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${L==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(qr,{className:"w-4 h-4"})," My Appointments",o.length>0&&l.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:o.length})]})]}),L==="doctors"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(RS,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:x,onChange:se=>T(se.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),l.jsx("select",{value:y,onChange:se=>b(se.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:cKe.map(se=>l.jsx("option",{value:se,children:se},se))})]})}),h?l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),l.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):ie.length>0?l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:ie.map(se=>{var Q,le,we;const he=se.name||((Q=se.user)==null?void 0:Q.name)||"Doctor";return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[l.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:(le=he[0])==null?void 0:le.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",he]}),l.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:se.specialization}),l.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l.jsx(qa,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),l.jsx("span",{className:"text-sm text-slate-600",children:((we=se.rating)==null?void 0:we.toFixed(1))||"4.5"}),l.jsx("span",{className:"text-slate-300",children:""}),l.jsxs("span",{className:"text-sm text-slate-500",children:[se.experience||5,"+ yrs"]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",se.consultationFee||500]}),l.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),l.jsx("button",{onClick:()=>N(se),className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},se._id)})}):l.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[l.jsx(RS,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),L==="appointments"&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),o.length>0?l.jsx("div",{className:"space-y-3",children:o.map(se=>{var he,Q,le,we,Ue,Le,tt,Te;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:((Ue=(we=((he=se.doctor)==null?void 0:he.name)||((le=(Q=se.doctor)==null?void 0:Q.user)==null?void 0:le.name))==null?void 0:we[0])==null?void 0:Ue.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((Le=se.doctor)==null?void 0:Le.name)||((Te=(tt=se.doctor)==null?void 0:tt.user)==null?void 0:Te.name)]}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(se.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",se.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${se.status==="completed"?"bg-green-100 text-green-600":se.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:se.status}),se.status==="scheduled"&&l.jsx("button",{onClick:()=>e(`/consultation/${se._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},se._id)})}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx(qr,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),l.jsx("button",{onClick:()=>F("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),S&&l.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),l.jsx("button",{onClick:()=>{N(null),G([]),A({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:l.jsx(bi,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(fe=(Se=S.name||((pe=S.user)==null?void 0:pe.name))==null?void 0:Se[0])==null?void 0:fe.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",S.name||((be=S.user)==null?void 0:be.name)]}),l.jsx("p",{className:"text-sm text-cyan-600",children:S.specialization})]})]}),l.jsxs("form",{onSubmit:ue,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:re().map(se=>l.jsxs("button",{type:"button",onClick:()=>A({...O,date:se.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${O.date===se.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[l.jsx("div",{className:"text-xs font-medium",children:se.label.split(" ")[0]}),l.jsx("div",{className:"text-sm font-bold",children:se.label.split(" ")[2]})]},se.value))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),B?l.jsxs("div",{className:"flex items-center justify-center py-6",children:[l.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),l.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):V.length>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:V.map(se=>{const he=O.timeSlot===se.timeSlot,Q=se.status==="passed",le=se.status==="booked",we=se.status==="blocked",Ue=se.status==="available";return l.jsxs("button",{type:"button",onClick:()=>Ue&&A({...O,timeSlot:se.timeSlot}),disabled:!Ue,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${he?"bg-cyan-500 text-white ring-2 ring-cyan-300":Q?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":le?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":we?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:Q?"Time passed":le?"Already booked":we?"Not available":"Available",children:[se.timeSlot,le&&l.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},se.timeSlot)})}),l.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):O.date?l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(ec,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(qr,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),l.jsx("textarea",{value:O.symptoms,onChange:se=>A({...O,symptoms:se.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),l.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Jd,{className:"w-5 h-5 text-cyan-600"}),l.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),l.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),l.jsxs("div",{className:"flex gap-3 pt-2",children:[l.jsx("button",{type:"button",onClick:()=>{N(null),G([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),l.jsx("button",{type:"submit",disabled:I||!O.date||!O.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:I?"Booking...":`Confirm  ${S.consultationFee||500}`})]})]})]})})]})}function dKe(){var pe,Se,fe,be,se,he,Q,le,we,Ue,Le,tt,Te,De,qe,It,rt,Fe,ut,vt,Ce,xt,Nt;const{user:e,updateUser:n}=ma(),[a]=cJ(),[o,d]=Y.useState(!1),[h,f]=Y.useState(null),[y,b]=Y.useState(""),[x,T]=Y.useState(a.get("tab")||"profile"),[S,N]=Y.useState(null),[O,A]=Y.useState(!1),[I,P]=Y.useState({goalType:"maintenance",currentWeight:((pe=e==null?void 0:e.profile)==null?void 0:pe.weight)||"",targetWeight:"",height:((Se=e==null?void 0:e.profile)==null?void 0:Se.height)||"",age:((fe=e==null?void 0:e.profile)==null?void 0:fe.age)||"",gender:((be=e==null?void 0:e.profile)==null?void 0:be.gender)||"male",activityLevel:"moderate",dietaryPreference:((se=e==null?void 0:e.profile)==null?void 0:se.dietaryPreference)||"non-vegetarian"}),[L,F]=Y.useState({name:(e==null?void 0:e.name)||"",profile:{age:((he=e==null?void 0:e.profile)==null?void 0:he.age)||"",gender:((Q=e==null?void 0:e.profile)==null?void 0:Q.gender)||"",dietaryPreference:((le=e==null?void 0:e.profile)==null?void 0:le.dietaryPreference)||"non-vegetarian",height:((we=e==null?void 0:e.profile)==null?void 0:we.height)||"",weight:((Ue=e==null?void 0:e.profile)==null?void 0:Ue.weight)||"",bloodGroup:((Le=e==null?void 0:e.profile)==null?void 0:Le.bloodGroup)||"",allergies:((Te=(tt=e==null?void 0:e.profile)==null?void 0:tt.allergies)==null?void 0:Te.join(", "))||"",chronicConditions:((qe=(De=e==null?void 0:e.profile)==null?void 0:De.chronicConditions)==null?void 0:qe.join(", "))||""}});Y.useEffect(()=>{const pt=async()=>{try{const{data:ye}=await Pl.getHistory();f(ye);const Ve=Object.keys(ye.history||{});Ve.length>0&&b(Ve[0])}catch(ye){console.error("Failed to fetch health history:",ye)}},Xe=async()=>{try{const ye=localStorage.getItem("token"),Ve=await kn.get("/api/nutrition/goals",{headers:{Authorization:`Bearer ${ye}`}});Ve.data.healthGoal&&(N(Ve.data.healthGoal),P({goalType:Ve.data.healthGoal.goalType,currentWeight:Ve.data.healthGoal.currentWeight,targetWeight:Ve.data.healthGoal.targetWeight,height:Ve.data.healthGoal.height,age:Ve.data.healthGoal.age,gender:Ve.data.healthGoal.gender,activityLevel:Ve.data.healthGoal.activityLevel,dietaryPreference:Ve.data.healthGoal.dietaryPreference}))}catch{console.log("No health goal set yet")}};pt(),Xe()},[]);const V=pt=>{const{name:Xe,value:ye}=pt.target;if(Xe.startsWith("profile.")){const Ve=Xe.split(".")[1];F(ht=>({...ht,profile:{...ht.profile,[Ve]:ye}}))}else F(Ve=>({...Ve,[Xe]:ye}))},G=async pt=>{var Xe,ye;pt.preventDefault(),d(!0);try{const Ve={name:L.name,profile:{...L.profile,age:L.profile.age?Number(L.profile.age):void 0,height:L.profile.height?Number(L.profile.height):void 0,weight:L.profile.weight?Number(L.profile.weight):void 0,allergies:L.profile.allergies?L.profile.allergies.split(",").map(Bn=>Bn.trim()).filter(Boolean):[],chronicConditions:L.profile.chronicConditions?L.profile.chronicConditions.split(",").map(Bn=>Bn.trim()).filter(Boolean):[]}},{data:ht}=await dt.put("/auth/profile",Ve);n(ht),et.success("Profile updated successfully!")}catch(Ve){et.error(((ye=(Xe=Ve.response)==null?void 0:Xe.data)==null?void 0:ye.message)||"Failed to update profile")}finally{d(!1)}},B=async pt=>{var Xe,ye;pt.preventDefault(),A(!0);try{const Ve=localStorage.getItem("token"),ht={...I,currentWeight:Number(I.currentWeight),targetWeight:Number(I.targetWeight),height:Number(I.height),age:Number(I.age)},Bn=await kn.post("/api/nutrition/goals",ht,{headers:{Authorization:`Bearer ${Ve}`}});N(Bn.data.healthGoal),et.success("Fitness goal set successfully! Your daily targets have been calculated.")}catch(Ve){et.error(((ye=(Xe=Ve.response)==null?void 0:Xe.data)==null?void 0:ye.message)||"Failed to set fitness goal")}finally{A(!1)}},z=pt=>{const{name:Xe,value:ye}=pt.target;P(Ve=>({...Ve,[Xe]:ye}))},q=L.profile.height&&L.profile.weight?(L.profile.weight/Math.pow(L.profile.height/100,2)).toFixed(1):null,ie=(pt=>pt?pt<18.5?{label:"Underweight",color:"blue"}:pt<25?{label:"Normal",color:"emerald"}:pt<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat(q)),ue=((rt=(It=h==null?void 0:h.history)==null?void 0:It[y])==null?void 0:rt.map(pt=>({date:new Date(pt.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:pt.healthScore||0})).reverse())||[],re=Object.keys((h==null?void 0:h.history)||{});return l.jsxs("div",{className:"w-full overflow-x-hidden space-y-6 animate-fade-in px-3 md:px-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl p-3 md:p-6 text-white relative overflow-hidden shadow-lg",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col gap-4 md:gap-6",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-2xl md:text-3xl font-bold",children:(ut=(Fe=e==null?void 0:e.name)==null?void 0:Fe[0])==null?void 0:ut.toUpperCase()}),l.jsx("button",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-cyan-600 shadow-lg hover:scale-110 transition-transform",children:l.jsx(fk,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:e==null?void 0:e.name}),l.jsxs("div",{className:"flex flex-col gap-2 mt-2 text-white/90 text-sm md:text-base",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(z0,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.email]}),(e==null?void 0:e.phone)&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(yk,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.phone]})]})]})]}),l.jsxs("div",{className:"flex gap-3 md:gap-4",children:[l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:((vt=e==null?void 0:e.healthMetrics)==null?void 0:vt.healthScore)||"--"}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"Health Score"})]}),q&&l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:q}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"BMI"})]})]})]})]}),l.jsx("div",{className:"flex gap-1 md:gap-2 p-1 bg-slate-100 rounded-xl w-full md:w-fit overflow-x-auto",children:[{id:"profile",label:"Edit Profile",icon:Bc},{id:"goals",label:"Fitness Goals",icon:Dl},{id:"history",label:"Health History",icon:Hn}].map(pt=>l.jsxs("button",{onClick:()=>T(pt.id),className:`flex items-center gap-1 md:gap-2 px-3 md:px-5 py-2 md:py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${x===pt.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[l.jsx(pt.icon,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden md:inline",children:pt.label}),l.jsx("span",{className:"md:hidden",children:pt.label.split(" ")[0]})]},pt.id))}),x==="profile"&&l.jsxs("form",{onSubmit:G,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-800 mb-4 md:mb-6 flex items-center gap-2",children:[l.jsx(Bc,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:L.name,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:e==null?void 0:e.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"profile.age",value:L.profile.age,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"profile.gender",value:L.profile.gender,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select gender"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{className:"md:col-span-2",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"profile.dietaryPreference",value:L.profile.dietaryPreference,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(fr,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"profile.height",value:L.profile.height,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",name:"profile.weight",value:L.profile.weight,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),l.jsxs("select",{name:"profile.bloodGroup",value:L.profile.bloodGroup,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(pt=>l.jsx("option",{value:pt,children:pt},pt))]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(pa,{className:"w-5 h-5 text-amber-500"}),"Medical History"]}),l.jsxs("div",{className:"space-y-5",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Allergies ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.allergies",value:L.profile.allergies,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Chronic Conditions ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.chronicConditions",value:L.profile.chronicConditions,onChange:V,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsx("button",{type:"submit",disabled:o,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:o?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:[l.jsx(XJ,{className:"w-5 h-5"}),"Save Changes"]})})]}),l.jsxs("div",{className:"space-y-6",children:[q&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-24 h-24 rounded-full bg-${ie.color}-100 flex items-center justify-center mx-auto mb-4`,children:l.jsx("span",{className:`text-3xl font-bold text-${ie.color}-600`,children:q})}),l.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${ie.color}-100 text-${ie.color}-700`,children:ie.label})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Total Reports"}),l.jsx("span",{className:"font-bold text-slate-800",children:(h==null?void 0:h.totalReports)||0})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Report Types"}),l.jsx("span",{className:"font-bold text-slate-800",children:re.length})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Subscription"}),l.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((Ce=e==null?void 0:e.subscription)==null?void 0:Ce.plan)||"Free"})]})]})]})]})]}),x==="goals"&&l.jsxs("form",{onSubmit:B,className:"max-w-4xl space-y-6",children:[S&&l.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl border-2 border-blue-200 p-3 md:p-6 shadow-sm w-full overflow-hidden",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-4",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-lg md:text-xl font-bold text-blue-900 mb-1",children:"Your Current Goal"}),l.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:"Daily targets calculated based on your goal"})]}),l.jsx("div",{className:"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold capitalize text-sm md:text-base whitespace-nowrap",children:S.goalType.replace("_"," ")})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mt-4",children:[l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Daily Calories"}),l.jsx("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:S.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Protein"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[S.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Carbs"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[S.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Fats"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[S.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:S?"Update Your Fitness Goal":"Set Your Fitness Goal"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Goal Type"}),l.jsxs("select",{name:"goalType",value:I.goalType,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"weight_loss",children:"Weight Loss (Fat Loss)"}),l.jsx("option",{value:"muscle_gain",children:"Muscle Gain (Bulking)"}),l.jsx("option",{value:"weight_gain",children:"Weight Gain"}),l.jsx("option",{value:"maintenance",children:"Maintenance"}),l.jsx("option",{value:"health_improvement",children:"Health Improvement"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Activity Level"}),l.jsxs("select",{name:"activityLevel",value:I.activityLevel,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"light",children:"Light (Exercise 1-3 days/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (Exercise 3-5 days/week)"}),l.jsx("option",{value:"active",children:"Active (Exercise 6-7 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (Hard exercise daily)"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Weight (kg)"}),l.jsx("input",{type:"number",name:"currentWeight",value:I.currentWeight,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Target Weight (kg)"}),l.jsx("input",{type:"number",name:"targetWeight",value:I.targetWeight,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"height",value:I.height,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"100",max:"250"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"age",value:I.age,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"10",max:"120"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"gender",value:I.gender,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"dietaryPreference",value:I.dietaryPreference,onChange:z,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]}),l.jsxs("button",{type:"submit",disabled:O,className:"mt-6 w-full md:w-auto px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg font-medium hover:shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[l.jsx(Dl,{className:"w-5 h-5"}),O?"Calculating...":S?"Update Goal":"Set Goal & Calculate Targets"]})]}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:l.jsxs("div",{className:"flex gap-3",children:[l.jsx(pa,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"How it works (Scientifically Backed)"}),l.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["We use the ",l.jsx("strong",{children:"Mifflin-St Jeor equation"})," (industry standard used by WHO, fitness apps, and hospitals) to calculate your BMR:"]}),l.jsxs("p",{className:"text-xs text-blue-600 font-mono mb-2",children:["Male: BMR = (10  weight) + (6.25  height)  (5  age) + 5",l.jsx("br",{}),"Female: BMR = (10  weight) + (6.25  height)  (5  age)  161"]}),l.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Then we calculate TDEE (Total Daily Energy Expenditure) by multiplying BMR with your activity level, and adjust calories based on your goal:"}),l.jsxs("ul",{className:"text-xs text-blue-600 space-y-1 ml-4",children:[l.jsx("li",{children:" Muscle Gain: +350 calories"}),l.jsx("li",{children:" Fat Loss: -400 calories"}),l.jsx("li",{children:" Maintenance: No adjustment"})]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[l.jsx("strong",{children:"Macros:"})," Protein = 1.6g per kg body weight (realistic & sustainable), Fats = 0.8g per kg, Carbs = remaining calories. These targets will be used throughout the platform to track your nutrition and provide personalized recommendations."]})]})]})})]}),x==="history"&&l.jsx("div",{className:"space-y-6",children:re.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Track your progress over time"})]}),l.jsx("select",{value:y,onChange:pt=>b(pt.target.value),className:"bg-white border border-slate-300 rounded-xl py-2 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:re.map(pt=>l.jsx("option",{value:pt,children:pt},pt))})]}),ue.length>1?l.jsx(r0,{width:"100%",height:300,children:l.jsxs(Cj,{data:ue,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"historyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),l.jsx(Of,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(Ul,{dataKey:"date",stroke:"#64748b",fontSize:12}),l.jsx(Fl,{domain:[0,100],stroke:"#64748b",fontSize:12}),l.jsx(Ha,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px"},labelStyle:{color:"#475569"}}),l.jsx(Hc,{type:"monotone",dataKey:"score",stroke:"#06b6d4",strokeWidth:3,fill:"url(#historyGradient)"})]})}):l.jsxs("div",{className:"text-center py-12 text-slate-500",children:[l.jsx(Vn,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),l.jsx("p",{children:"Upload more reports to see your health trend"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6",children:["Recent ",y," Reports"]}),l.jsx("div",{className:"space-y-3",children:(Nt=(xt=h==null?void 0:h.history)==null?void 0:xt[y])==null?void 0:Nt.slice(0,5).map((pt,Xe)=>{var ht;const ye=h.history[y][Xe+1],Ve=ye?pt.healthScore-ye.healthScore:null;return l.jsxs(Ut,{to:`/reports/${pt._id}`,className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-all group border border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(Vn,{className:"w-6 h-6 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:new Date(pt.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),l.jsx("p",{className:"text-sm text-slate-500",children:((ht=pt.keyFindings)==null?void 0:ht.slice(0,2).join(", "))||"View details"})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[Ve!==null&&l.jsxs("span",{className:`text-sm font-semibold ${Ve>0?"text-emerald-600":Ve<0?"text-red-600":"text-slate-500"}`,children:[Ve>0?"+":"",Ve]}),l.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:pt.healthScore||"--"}),l.jsx(Dd,{className:"w-5 h-5 text-slate-400 group-hover:text-cyan-500 transition-colors"})]})]},pt._id)})})]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 text-center py-16 shadow-sm",children:[l.jsx(Vn,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"No Health History Yet"}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Upload health reports to track your progress over time"}),l.jsxs(Ut,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[l.jsx(Ts,{className:"w-5 h-5"}),"Upload Your First Report"]})]})})]})}const S1={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},uKe=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],Wo={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},d2=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],hKe=[{_id:"apt1",doctor:d2[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],FY={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},w1={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},VY=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],pKe=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function mKe(){const[e,n]=Y.useState("dashboard"),[a,o]=Y.useState(!1),[d,h]=Y.useState([]),[f,y]=Y.useState(""),[b,x]=Y.useState(!1),[T,S]=Y.useState(!1),[N,O]=Y.useState(null),[A,I]=Y.useState(0),[P,L]=Y.useState({date:"",slot:"",type:"online"}),[F,V]=Y.useState(d2),[G,B]=Y.useState(hKe),[z,q]=Y.useState("All"),[Z,ie]=Y.useState(""),[ue,re]=Y.useState(0),[pe,Se]=Y.useState(null),[fe,be]=Y.useState(!1),[se,he]=Y.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[Q,le]=Y.useState(!1),[we,Ue]=Y.useState(S1.profile),Le=Y.useRef(null);Y.useEffect(()=>{var ye;(ye=Le.current)==null||ye.scrollIntoView({behavior:"smooth"})},[d]);const tt=ye=>{if(ye.preventDefault(),!f.trim())return;const Ve=f.toLowerCase();h(ht=>[...ht,{role:"user",content:f}]),y(""),setTimeout(()=>{const ht=Object.keys(w1).find(Bn=>Ve.includes(Bn));h(Bn=>[...Bn,{role:"assistant",content:w1[ht]||w1.default}])},800)},Te=()=>{if(A===0)I(1);else if(A===1&&P.date&&P.slot)I(2);else if(A===2){const ye={_id:`apt${Date.now()}`,doctor:N,date:P.date,timeSlot:P.slot,status:"confirmed",type:P.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:N.fee/2};B(Ve=>[ye,...Ve]),I(3)}},De=()=>{O(null),I(0),L({date:"",slot:"",type:"online"})},qe=()=>{ue===0&&pe&&(re(1),be(!0),setTimeout(()=>{be(!1),re(2)},2500))},It=()=>{se.name&&se.specialization&&se.fee&&(V(ye=>[...ye,{...se,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),he({name:"",specialization:"",experience:"",fee:"",hospital:""}),le(!1))},rt=F.filter(ye=>(z==="All"||ye.specialization===z)&&ye.name.toLowerCase().includes(Z.toLowerCase())),Fe=({trend:ye})=>ye==="improved"?l.jsx(ua,{className:"w-4 h-4 text-green-600"}):ye==="declined"?l.jsx(ZJ,{className:"w-4 h-4 text-red-600"}):l.jsx(vk,{className:"w-4 h-4 text-gray-400"}),ut=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),l.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),l.jsxs("button",{onClick:()=>n("upload"),className:"btn-primary flex items-center gap-2",children:[l.jsx(Ts,{className:"w-4 h-4"})," Upload Report"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:Hn,color:"primary",label:"Health Score",value:"78/100"},{icon:Vn,color:"blue",label:"Total Reports",value:"6"},{icon:ua,color:"green",label:"BMI",value:"23.5"},{icon:qr,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((ye,Ve)=>l.jsx("div",{className:"card",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:`w-12 h-12 bg-${ye.color}-100 rounded-xl flex items-center justify-center`,children:l.jsx(ye.icon,{className:`w-6 h-6 text-${ye.color}-600`})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-500",children:ye.label}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ye.value})]})]})},Ve))}),G.length>0&&l.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(qr,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),G.filter(ye=>ye.status==="confirmed").map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.doctor.name[4]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.doctor.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[ye.doctor.specialization,"  ",ye.date," at ",ye.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[ye.type==="online"&&ye.meetLink&&l.jsxs("a",{href:ye.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[l.jsx(Jd,{className:"w-4 h-4"})," Join Call"]}),l.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},ye._id))]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),l.jsx(r0,{width:"100%",height:200,children:l.jsxs(Ute,{data:uKe,children:[l.jsx(Of,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),l.jsx(Ul,{dataKey:"date"}),l.jsx(Fl,{domain:[0,100]}),l.jsx(Ha,{}),l.jsx(cg,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(so,{className:"w-5 h-5 text-green-600"}),l.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),l.jsx("ul",{className:"space-y-2",children:Wo.recommendations.diet.map((ye,Ve)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.item})," - ",ye.reason]})]},Ve))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(qy,{className:"w-5 h-5 text-blue-600"}),l.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),l.jsx("ul",{className:"space-y-2",children:Wo.recommendations.exercise.map((ye,Ve)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.activity})," - ",ye.duration,", ",ye.frequency]})]},Ve))})]})]}),l.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(pa,{className:"w-5 h-5 text-orange-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Wo.doctorConsultation.reason}),l.jsxs("p",{className:"text-sm mt-2",children:[l.jsx("strong",{children:"Specialists:"})," ",Wo.doctorConsultation.specializations.join(", ")]}),l.jsx("button",{onClick:()=>n("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),vt=()=>l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),l.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),ue===0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),l.jsx("select",{className:"input",children:pKe.map(ye=>l.jsx("option",{children:ye},ye))})]}),l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),pe?l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Vn,{className:"w-10 h-10 text-primary-600"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:pe.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[pe.size," MB"]})]})]}),l.jsx("button",{onClick:()=>Se(null),className:"p-2 text-gray-400 hover:text-red-500",children:l.jsx(bi,{className:"w-5 h-5"})})]}):l.jsxs("div",{onClick:()=>Se({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[l.jsx(Ts,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),l.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),l.jsxs("button",{onClick:qe,disabled:!pe,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(Ts,{className:"w-5 h-5"})," Analyze Report"]})]}),ue===1&&l.jsxs("div",{className:"card text-center py-12",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),l.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),l.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((ye,Ve)=>l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx(_h,{className:"w-4 h-4 text-green-600"}),l.jsx("span",{children:ye})]},Ve))})]}),ue===2&&l.jsxs("div",{className:"space-y-6",children:[l.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(_h,{className:"w-8 h-8 text-green-600"}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),l.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),l.jsx("button",{onClick:()=>n("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[l.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Ce=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?"Manage Doctors":"Find Doctors"}),l.jsx("p",{className:"text-gray-600",children:a?"Add and manage platform doctors":"Book consultations with specialists"})]}),a&&l.jsxs("button",{onClick:()=>le(!0),className:"btn-primary flex items-center gap-2",children:[l.jsx(Uc,{className:"w-4 h-4"})," Add Doctor"]})]}),l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(RS,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:Z,onChange:ye=>ie(ye.target.value),className:"input pl-12"})]}),l.jsx("div",{className:"flex gap-2 flex-wrap",children:VY.slice(0,5).map(ye=>l.jsx("button",{onClick:()=>q(ye),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${z===ye?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:ye},ye))})]}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:rt.map(ye=>{var Ve;return l.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((Ve=ye.name.split(" ")[1])==null?void 0:Ve[0])||ye.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-semibold text-gray-900",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization}),l.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[l.jsx(qa,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),l.jsx("span",{className:"text-sm font-medium",children:ye.rating}),l.jsxs("span",{className:"text-sm text-gray-500",children:["(",ye.reviews,")"]})]})]})]}),l.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ec,{className:"w-4 h-4"}),l.jsxs("span",{children:[ye.experience," years experience"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(OP,{className:"w-4 h-4"}),l.jsx("span",{children:ye.hospital})]})]}),l.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",ye.fee]}),l.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),ye.available?l.jsx("button",{onClick:()=>{O(ye),I(0)},className:"btn-primary text-sm",children:"Book Now"}):l.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},ye._id)})}),Q&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),l.jsx("button",{onClick:()=>le(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(bi,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),l.jsx("input",{type:"text",value:se.name,onChange:ye=>he({...se,name:ye.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),l.jsxs("select",{value:se.specialization,onChange:ye=>he({...se,specialization:ye.target.value}),className:"input",children:[l.jsx("option",{value:"",children:"Select"}),VY.slice(1).map(ye=>l.jsx("option",{children:ye},ye))]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),l.jsx("input",{type:"number",value:se.experience,onChange:ye=>he({...se,experience:ye.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),l.jsx("input",{type:"number",value:se.fee,onChange:ye=>he({...se,fee:ye.target.value}),className:"input"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",value:se.hospital,onChange:ye=>he({...se,hospital:ye.target.value}),className:"input"})]}),l.jsx("button",{onClick:It,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),xt=()=>{var ye;return N&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[A<3&&l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:A===0?"Book Appointment":A===1?"Select Slot":"Payment"}),l.jsx("button",{onClick:De,className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(bi,{className:"w-5 h-5"})})]}),A===0&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(ye=N.name.split(" ")[1])==null?void 0:ye[0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold",children:N.name}),l.jsx("p",{className:"text-sm text-primary-600",children:N.specialization}),l.jsx("p",{className:"text-sm text-gray-500",children:N.hospital})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),l.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(Ve=>l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",name:"type",checked:P.type===Ve,onChange:()=>L({...P,type:Ve}),className:"text-primary-600"}),Ve==="online"?l.jsxs(l.Fragment,{children:[l.jsx(Jd,{className:"w-4 h-4"})," Online"]}):l.jsxs(l.Fragment,{children:[l.jsx(OP,{className:"w-4 h-4"})," In-Person"]})]},Ve))})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[l.jsxs("p",{className:"text-sm text-blue-800",children:[l.jsx("strong",{children:"Consultation Fee:"})," ",N.fee]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",N.fee/2," now to confirm (50% advance)"]})]}),l.jsx("button",{onClick:Te,className:"btn-primary w-full",children:"Select Date & Time"})]}),A===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),l.jsx("input",{type:"date",value:P.date,onChange:Ve=>L({...P,date:Ve.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.slots.map(Ve=>l.jsx("button",{onClick:()=>L({...P,slot:Ve}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${P.slot===Ve?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:Ve},Ve))})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>I(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),l.jsx("button",{onClick:Te,disabled:!P.date||!P.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),A===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Doctor"}),l.jsx("span",{className:"font-medium",children:N.name})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Date"}),l.jsx("span",{className:"font-medium",children:P.date})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Time"}),l.jsx("span",{className:"font-medium",children:P.slot})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Type"}),l.jsx("span",{className:"font-medium capitalize",children:P.type})]}),l.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[l.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),l.jsxs("span",{className:"font-bold text-primary-600",children:["",N.fee/2]})]})]}),l.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(WJ,{className:"w-5 h-5 text-gray-600"}),l.jsx("span",{className:"font-medium",children:"Payment Method"})]}),l.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(Ve=>l.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[l.jsx("input",{type:"radio",name:"payment",defaultChecked:Ve==="UPI"}),l.jsx("span",{children:Ve})]},Ve))})]}),l.jsxs("button",{onClick:Te,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(Jy,{className:"w-4 h-4"})," Pay ",N.fee/2," Securely"]})]}),A===3&&l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(_h,{className:"w-8 h-8 text-green-600"})}),l.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),l.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Doctor:"})," ",N.name]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Date:"})," ",P.date," at ",P.slot]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Type:"})," ",P.type==="online"?"Video Consultation":"In-Person"]}),P.type==="online"&&l.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[l.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[l.jsx(Jd,{className:"w-4 h-4"})," Video Call Link"]}),l.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),l.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),l.jsx("button",{onClick:()=>{De(),n("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},Nt=()=>{var ye,Ve;return l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),l.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),l.jsx("div",{className:"card gradient-bg text-white",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:l.jsx(Hn,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),l.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),l.jsxs("div",{className:"ml-auto text-right",children:[l.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),l.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(Bc,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",value:S1.name,className:"input",readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:S1.email,className:"input bg-gray-50",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",value:we.age,onChange:ht=>Ue({...we,age:ht.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),l.jsxs("select",{value:we.gender,onChange:ht=>Ue({...we,gender:ht.target.value}),className:"input",children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",value:we.height,onChange:ht=>Ue({...we,height:ht.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",value:we.weight,onChange:ht=>Ue({...we,weight:ht.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),l.jsx("select",{value:we.bloodGroup,onChange:ht=>Ue({...we,bloodGroup:ht.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(ht=>l.jsx("option",{children:ht},ht))})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),l.jsx("input",{type:"text",value:(ye=we.allergies)==null?void 0:ye.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),l.jsx("input",{type:"text",value:(Ve=we.chronicConditions)==null?void 0:Ve.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[l.jsx(_h,{className:"w-5 h-5"})," Save Changes"]})]})},pt=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("button",{onClick:()=>n("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:l.jsx(Vn,{className:"w-7 h-7 text-primary-600"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),l.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),l.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[l.jsxs("button",{onClick:()=>x(!b),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[l.jsx(I7,{className:"w-4 h-4"}),b?"Hide":"Compare"]}),l.jsxs("button",{onClick:()=>S(!T),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[l.jsx(D7,{className:"w-4 h-4"}),"Ask AI"]})]})]}),b&&l.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[l.jsx(I7,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),l.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),l.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),l.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),l.jsx("p",{className:"text-gray-700 mb-4",children:FY.summary}),l.jsx("div",{className:"space-y-2 mb-4",children:FY.metricChanges.map((ye,Ve)=>l.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Fe,{trend:ye.change}),l.jsx("span",{className:"font-medium",children:ye.metric})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("span",{className:"text-gray-500",children:ye.previous}),"  ",l.jsx("span",{className:"font-medium",children:ye.current})]})]},Ve))})]}),T&&l.jsxs("div",{className:"card border-2 border-purple-200",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(D7,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),l.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[d.length===0&&l.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),d.map((ye,Ve)=>l.jsx("div",{className:`flex ${ye.role==="user"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${ye.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:ye.content})},Ve)),l.jsx("div",{ref:Le})]}),l.jsxs("form",{onSubmit:tt,className:"flex gap-2",children:[l.jsx("input",{type:"text",value:f,onChange:ye=>y(ye.target.value),placeholder:"Ask a question...",className:"input flex-1"}),l.jsx("button",{type:"submit",className:"btn-primary px-4",children:l.jsx(K0,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-5 h-5 text-primary-600"})," Summary"]}),l.jsx("p",{className:"text-gray-700",children:Wo.summary})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(Wo.metrics).map(([ye,Ve])=>l.jsxs("div",{className:`p-4 rounded-xl ${Ve.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[l.jsx("p",{className:"text-sm text-gray-600 capitalize",children:ye.replace(/([A-Z])/g," $1")}),l.jsxs("p",{className:"text-xl font-bold",children:[Ve.value," ",Ve.unit]}),l.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",Ve.normalRange]}),l.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${Ve.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:Ve.status})]},ye))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(fr,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),l.jsx("ul",{className:"space-y-2",children:Wo.keyFindings.map((ye,Ve)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),ye]},Ve))})]}),l.jsxs("div",{className:"card border-l-4 border-orange-400",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(rT,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),l.jsx("ul",{className:"space-y-2",children:Wo.riskFactors.map((ye,Ve)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),ye]},Ve))})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(so,{className:"w-5 h-5 text-green-600"})," Diet"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Wo.recommendations.diet.map((ye,Ve)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-green-800",children:ye.item}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${ye.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:ye.priority})]}),l.jsx("p",{className:"text-sm text-green-700",children:ye.reason})]},Ve))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(qy,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),Wo.recommendations.exercise.map((ye,Ve)=>l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-blue-800",children:ye.activity}),l.jsxs("span",{className:"text-sm text-blue-600",children:[ye.duration,"  ",ye.frequency]})]}),l.jsx("p",{className:"text-sm text-blue-700",children:ye.reason})]},Ve))]}),l.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(hf,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:d2.filter(ye=>Wo.doctorConsultation.specializations.includes(ye.specialization)).map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.name.split(" ")[1][0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization})]})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[l.jsx(qa,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),ye.rating,"  ",l.jsx(ec,{className:"w-4 h-4"}),ye.experience," yrs"]}),l.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[l.jsxs("span",{className:"font-semibold",children:["",ye.fee]}),l.jsx("button",{onClick:()=>{O(ye),n("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},ye._id))})]})]}),Xe=()=>l.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:l.jsx(Hn,{className:"w-6 h-6 text-white"})}),l.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),l.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),l.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:RTe,label:"Dashboard"},{id:"upload",icon:Ts,label:"Upload Report"},{id:"report",icon:Vn,label:"Report & Chat"},{id:"doctors",icon:hf,label:"Doctors"},{id:"profile",icon:Bc,label:"Profile"}].map(ye=>l.jsxs("button",{onClick:()=>n(ye.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${e===ye.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[l.jsx(ye.icon,{className:"w-5 h-5"}),l.jsx("span",{className:"font-medium",children:ye.label})]},ye.id))}),l.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:l.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a,onChange:ye=>o(ye.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),l.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),l.jsx(Kf,{className:"w-4 h-4 text-gray-400"})]})}),l.jsx("div",{className:"p-4 border-t border-gray-100",children:l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[l.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:l.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a?"Admin User":"John Doe"}),l.jsx("p",{className:"text-xs text-gray-500 truncate",children:a?"admin@healthai.com":"john@example.com"})]}),l.jsx(gk,{className:"w-5 h-5 text-gray-400"})]})})]});return l.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[l.jsx(Xe,{}),l.jsxs("main",{className:"flex-1 ml-64 p-8",children:[e==="dashboard"&&l.jsx(ut,{}),e==="upload"&&l.jsx(vt,{}),e==="report"&&l.jsx(pt,{}),e==="doctors"&&l.jsx(Ce,{}),e==="profile"&&l.jsx(Nt,{})]}),l.jsx(xt,{})]})}function fKe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(!0),[d,h]=Y.useState("overview");Y.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:b}=await ZE.getStats();n(b)}catch{et.error("Failed to load stats")}finally{o(!1)}};if(a)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const y=[{id:"overview",label:"Overview",icon:Hn},{id:"doctors",label:"Doctors",icon:eQ}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),l.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:y.map(({id:b,label:x,icon:T})=>l.jsxs("button",{onClick:()=>h(b),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${d===b?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(T,{className:"w-4 h-4"}),l.jsx("span",{children:x})]},b))}),d==="overview"&&l.jsx(gKe,{stats:e}),d==="doctors"&&l.jsx(vKe,{})]})}function gKe({stats:e}){var n,a,o,d;return e?l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(hf,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((n=e.stats)==null?void 0:n.totalUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(Xr,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((a=e.stats)==null?void 0:a.activeUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(Vn,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=e.stats)==null?void 0:o.totalReports)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(pa,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((d=e.stats)==null?void 0:d.pendingDoctors)||0})]})]}):null}function vKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!0),[d,h]=Y.useState("all");Y.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:S}=await ZE.getDoctors();n(S.doctors||[])}catch{et.error("Failed to load doctors")}finally{o(!1)}},y=async S=>{try{await ZE.approveDoctor(S),n(e.map(N=>N._id===S?{...N,approvalStatus:"approved",isListed:!0}:N)),et.success("Doctor approved!")}catch{et.error("Failed to approve")}},b=async S=>{try{await ZE.rejectDoctor(S),n(e.map(N=>N._id===S?{...N,approvalStatus:"rejected",isListed:!1}:N)),et.success("Doctor rejected")}catch{et.error("Failed to reject")}},x=e.filter(S=>d==="all"?!0:S.approvalStatus===d),T=e.filter(S=>S.approvalStatus==="pending").length;return a?l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 animate-pulse h-64"}):l.jsxs("div",{className:"space-y-4",children:[T>0&&l.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[l.jsx(pa,{className:"w-6 h-6 text-amber-500"}),l.jsx("div",{className:"flex-1",children:l.jsxs("p",{className:"font-medium text-amber-800",children:[T," Doctor(s) Pending Approval"]})}),l.jsx("button",{onClick:()=>h("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),l.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(S=>l.jsx("button",{onClick:()=>h(S),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${d===S?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:S},S))})]}),l.jsxs("div",{className:"space-y-3",children:[x.map(S=>{var N,O;return l.jsx("div",{className:`p-4 rounded-xl border ${S.approvalStatus==="pending"?"bg-amber-50 border-amber-200":S.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(O=(N=S.name)==null?void 0:N[0])==null?void 0:O.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",S.name]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${S.approvalStatus==="approved"?"bg-green-100 text-green-700":S.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:S.approvalStatus})]}),l.jsx("p",{className:"text-sm text-cyan-600",children:S.specialization}),l.jsxs("p",{className:"text-xs text-slate-500",children:[S.experience," yrs  ",S.consultationFee||0]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:S.approvalStatus==="pending"&&l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:()=>y(S._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[l.jsx(Xr,{className:"w-4 h-4"})," Approve"]}),l.jsxs("button",{onClick:()=>b(S._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[l.jsx(tQ,{className:"w-4 h-4"})," Reject"]})]})})]})},S._id)}),x.length===0&&l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(eQ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No doctors found"})]})]})]})]})}const yKe=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:qa},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:El,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:AP}];function _Ke(){var x;const{user:e}=ma(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0),[h,f]=Y.useState("monthly");Y.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:T}=await dTe.getSubscription();a(T)}catch{console.error("Failed to fetch subscription")}finally{d(!1)}},b=(n==null?void 0:n.plan)||((x=e==null?void 0:e.subscription)==null?void 0:x.plan)||"free";return o?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"})}):l.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in",children:[l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[l.jsx(AP,{className:"w-4 h-4"}),"Subscription Plans"]}),l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),l.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(AP,{className:"w-7 h-7"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),l.jsx("h2",{className:"text-2xl font-bold capitalize",children:b})]})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[(n==null?void 0:n.endDate)&&l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),l.jsx("p",{className:"font-semibold",children:new Date(n.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[l.jsx(qr,{className:"w-4 h-4"}),l.jsx("span",{className:"font-medium capitalize",children:(n==null?void 0:n.status)||"Active"})]})]})]})]}),l.jsx("div",{className:"flex justify-center",children:l.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[l.jsx("button",{onClick:()=>f("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${h==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),l.jsxs("button",{onClick:()=>f("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${h==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",l.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),l.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:yKe.map(T=>{const S=T.icon,N=b===T.id,O=h==="yearly"?Math.round(T.price*12*.8):T.price;return l.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${T.popular?"border-cyan-500":"border-slate-700"} ${N?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[T.popular&&l.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),l.jsxs("div",{className:"text-center mb-6 pt-2",children:[l.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${T.color}-500/20`,children:l.jsx(S,{className:`w-7 h-7 text-${T.color}-400`})}),l.jsx("h3",{className:"text-xl font-bold text-white",children:T.name}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("span",{className:"text-4xl font-bold text-white",children:["",O]}),l.jsxs("span",{className:"text-slate-400",children:["/",h==="yearly"?"year":T.period]})]})]}),l.jsx("ul",{className:"space-y-3 mb-8",children:T.features.map((A,I)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[l.jsx("div",{className:`w-5 h-5 rounded-full bg-${T.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:l.jsx(_h,{className:`w-3 h-3 text-${T.color}-400`})}),l.jsx("span",{className:"text-slate-400",children:A})]},I))}),l.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${N?"bg-slate-800 text-slate-500 cursor-default":T.popular?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:N,children:N?"Current Plan":T.price===0?"Downgrade":"Upgrade Now"})]},T.id)})}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:l.jsx(WJ,{className:"w-6 h-6 text-blue-400"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const iy=[{id:"apple_watch",name:"Apple Watch",icon:gl,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:Hn,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:El,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:ua,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:JJ,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:zf,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function bKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!0),[d,h]=Y.useState(!1),[f,y]=Y.useState(!1),[b,x]=Y.useState(null);Y.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:P}=await Cm.getDashboard();P.devices&&n(P.devices)}catch(P){console.error("Failed to fetch devices:",P)}finally{o(!1)}},S=async()=>{h(!0);try{e.length>0?(await Cm.generateDemoData(e[0].type),await T(),et.success("All devices synced successfully!")):et.error("No devices connected")}catch(P){console.error("Sync failed:",P),et.error("Failed to sync devices")}finally{h(!1)}},N=async P=>{try{const L=iy.find(F=>F.id===P);await Cm.connectDevice(P,L==null?void 0:L.name),await Cm.generateDemoData(P),await T(),y(!1),et.success(`${L==null?void 0:L.name} connected successfully!`)}catch(L){console.error("Failed to connect:",L),et.error("Failed to connect device")}},O=async P=>{try{await Cm.disconnectDevice(P),await T(),et.success("Device disconnected")}catch(L){console.error("Failed to disconnect:",L),et.error("Failed to disconnect device")}},A=P=>{const L=iy.find(F=>F.id===P);return(L==null?void 0:L.icon)||gl},I=P=>{const L=iy.find(F=>F.id===P);return(L==null?void 0:L.color)||"bg-slate-600"};return a?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),l.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[l.jsx(ec,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("button",{onClick:S,disabled:d||e.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[l.jsx(kTe,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Sync All"]}),l.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:shadow-lg transition-all",children:[l.jsx(Uc,{className:"w-4 h-4"}),"Add Device"]})]})]}),e.length===0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[l.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:l.jsx(pa,{className:"w-4 h-4 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),l.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),e.length>0&&l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(ATe,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),l.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[e.length," connected"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((P,L)=>{const F=A(P.type),V=I(P.type),G=Math.floor(Math.random()*50)+50;return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${V} flex items-center justify-center`,children:l.jsx(F,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),l.jsx("p",{className:"text-slate-500 text-sm",children:P.type})]})]}),l.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[l.jsx(Xr,{className:"w-3 h-3"}),"Active"]})]}),l.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((B,z)=>{const q=30+Math.random()*70;return l.jsx("div",{className:"flex-1 bg-gradient-to-t from-cyan-500 to-blue-500 rounded-sm",style:{height:`${q}%`,marginTop:"auto"}},z)})}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(fr,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Heart"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(zJ,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Steps"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(zf,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[l.jsx(gTe,{className:"w-4 h-4"}),G,"%"]})]}),l.jsxs("div",{className:"mt-4 flex gap-2",children:[l.jsx("button",{onClick:()=>S(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),l.jsx("button",{onClick:()=>O(P.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},L)})})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(gl,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:iy.map(P=>{const L=P.icon,F=e.some(V=>V.type===P.id);return l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:l.jsx(L,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:P.name}),F&&l.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),l.jsx("p",{className:"text-slate-500 text-sm mb-3",children:P.description}),l.jsx("div",{className:"flex flex-wrap gap-2",children:P.tags.map(V=>l.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:V},V))})]})]}),l.jsx("button",{onClick:()=>F?O(P.id):N(P.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${F?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:shadow-lg"}`,children:F?"Disconnect":"Connect"})]})},P.id)})})]}),f&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),l.jsx("button",{onClick:()=>y(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:l.jsx(bi,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),l.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:iy.map(P=>{const L=P.icon,F=e.some(V=>V.type===P.id);return l.jsxs("button",{onClick:()=>!F&&N(P.id),disabled:F,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${F?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${P.color} flex items-center justify-center shrink-0`,children:l.jsx(L,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"text-slate-800 font-medium",children:P.name}),F&&l.jsx(Xr,{className:"w-4 h-4 text-emerald-500"})]}),l.jsx("p",{className:"text-slate-500 text-sm",children:P.description})]})]},P.id)})})]})})]})}function xKe(){var I,P,L,F,V,G,B,z,q,Z,ie,ue,re,pe,Se,fe,be,se,he;const{patientId:e}=V0(),[n]=cJ(),a=n.get("appointmentId"),[o,d]=Y.useState(null),[h,f]=Y.useState(!0),[y,b]=Y.useState("overview");if(Y.useEffect(()=>{(async()=>{try{const{data:le}=await Ya.getPatientProfile(e,a);d(le)}catch(le){console.error("Failed to fetch patient profile:",le)}finally{f(!1)}})()},[e,a]),h)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading patient profile..."})]})});if(!o)return l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[l.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),l.jsx(Ut,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:x,healthSummary:T,healthReports:S,wearableSummary:N,appointmentHistory:O}=o,A=[{id:"overview",label:"Overview",icon:Bc},{id:"reports",label:"Health Reports",icon:Vn},{id:"wearables",label:"Wearable Data",icon:gl},{id:"history",label:"Appointment History",icon:qr}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs(Ut,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[l.jsx(Ta,{className:"w-4 h-4"}),"Back to Dashboard"]}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[l.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white text-3xl font-bold",children:(P=(I=x.name)==null?void 0:I.charAt(0))==null?void 0:P.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:x.name}),l.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[x.email&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(z0,{className:"w-4 h-4"})," ",x.email]}),x.phone&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(yk,{className:"w-4 h-4"})," ",x.phone]}),((L=x.profile)==null?void 0:L.age)&&l.jsxs("span",{children:[x.profile.age," years old"]}),((F=x.profile)==null?void 0:F.gender)&&l.jsx("span",{className:"capitalize",children:x.profile.gender})]})]}),(T==null?void 0:T.healthScore)&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`text-4xl font-bold ${T.healthScore>=80?"text-emerald-400":T.healthScore>=60?"text-amber-400":"text-red-400"}`,children:T.healthScore}),l.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:A.map(Q=>l.jsxs("button",{onClick:()=>b(Q.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${y===Q.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[l.jsx(Q.icon,{className:"w-4 h-4"}),Q.label]},Q.id))}),y==="overview"&&l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(Bc,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((V=x.profile)==null?void 0:V.height)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),l.jsxs("p",{className:"font-semibold text-white",children:[x.profile.height," cm"]})]}),((G=x.profile)==null?void 0:G.weight)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),l.jsxs("p",{className:"font-semibold text-white",children:[x.profile.weight," kg"]})]}),((B=x.profile)==null?void 0:B.bloodGroup)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),l.jsx("p",{className:"font-semibold text-white",children:x.profile.bloodGroup})]}),((z=x.healthMetrics)==null?void 0:z.bmi)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),l.jsx("p",{className:"font-semibold text-white",children:x.healthMetrics.bmi.toFixed(1)})]})]}),((Z=(q=x.profile)==null?void 0:q.allergies)==null?void 0:Z.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:x.profile.allergies.map((Q,le)=>l.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:Q},le))})]}),((ue=(ie=x.profile)==null?void 0:ie.chronicConditions)==null?void 0:ue.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:x.profile.chronicConditions.map((Q,le)=>l.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:Q},le))})]})]}),T&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(fr,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((re=T.deficiencies)==null?void 0:re.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",T.deficiencies.length,")"]}),l.jsx("div",{className:"space-y-2",children:T.deficiencies.slice(0,3).map((Q,le)=>{var Le,tt,Te;const we=typeof Q.currentValue=="object"?((Le=Q.currentValue)==null?void 0:Le.value)||JSON.stringify(Q.currentValue):Q.currentValue,Ue=typeof Q.normalRange=="object"?((tt=Q.normalRange)==null?void 0:tt.value)||JSON.stringify(Q.normalRange):Q.normalRange;return l.jsxs("div",{className:`p-3 rounded-xl ${Q.severity==="severe"?"bg-red-500/10 border border-red-500/30":Q.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"font-medium text-white",children:typeof Q.name=="object"?((Te=Q.name)==null?void 0:Te.value)||"Unknown":Q.name}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Q.severity==="severe"?"bg-red-500/20 text-red-400":Q.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:Q.severity})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",we," | Normal: ",Ue]})]},le)})})]}),((pe=T.riskFactors)==null?void 0:pe.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:T.riskFactors.map((Q,le)=>l.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof Q=="object"?(Q==null?void 0:Q.name)||(Q==null?void 0:Q.value)||JSON.stringify(Q):Q},le))})]}),((Se=T.keyFindings)==null?void 0:Se.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),l.jsx("ul",{className:"space-y-1",children:T.keyFindings.slice(0,4).map((Q,le)=>{const we=typeof Q=="object"?(Q==null?void 0:Q.title)||(Q==null?void 0:Q.finding)||(Q==null?void 0:Q.value)||JSON.stringify(Q):Q;return l.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-400 mt-1",children:""}),we]},le)})})]})]}),N&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(gl,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[l.jsx(Hn,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((fe=N.avgSteps)==null?void 0:fe.toLocaleString())||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),l.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[l.jsx(fr,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgHeartRate||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),l.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[l.jsx(ec,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgSleepHours||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),l.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[l.jsx(gl,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((be=N.devices)==null?void 0:be.length)||0}),l.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),y==="reports"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(S==null?void 0:S.length)>0?l.jsx("div",{className:"space-y-3",children:S.map(Q=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:l.jsx(Vn,{className:"w-6 h-6 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-white",children:Q.reportType}),l.jsx("p",{className:"text-sm text-slate-400",children:new Date(Q.createdAt).toLocaleDateString()})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[Q.healthScore&&l.jsxs("span",{className:`font-bold ${Q.healthScore>=80?"text-emerald-400":Q.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",Q.healthScore]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${Q.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:Q.status})]})]},Q._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),y==="wearables"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),N?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),l.jsx("div",{className:"flex flex-wrap gap-3",children:(se=N.devices)==null?void 0:se.map((Q,le)=>l.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[l.jsx(gl,{className:"w-4 h-4 text-cyan-400"}),l.jsx("span",{className:"font-medium text-cyan-300",children:Q.name||Q.type})]},le))})]}),((he=N.recentMetrics)==null?void 0:he.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b border-slate-700",children:[l.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),l.jsx("tbody",{children:N.recentMetrics.map((Q,le)=>{var we,Ue;return l.jsxs("tr",{className:"border-b border-slate-700/50",children:[l.jsx("td",{className:"py-2 text-white",children:new Date(Q.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:(we=Q.steps)==null?void 0:we.toLocaleString()}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:Q.caloriesBurned}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:Q.activeMinutes}),l.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(Ue=Q.distance)==null?void 0:Ue.toFixed(1)," km"]})]},le)})})]})})]})]}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),y==="history"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(O==null?void 0:O.length)>0?l.jsx("div",{className:"space-y-3",children:O.map(Q=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(qr,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"font-semibold text-white",children:new Date(Q.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${Q.status==="completed"?"bg-emerald-500/20 text-emerald-400":Q.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:Q.status})]}),Q.doctor&&l.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",Q.doctor.name," - ",Q.doctor.specialization]}),Q.symptoms&&l.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",Q.symptoms]}),Q.notes&&l.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",Q.notes]})]},Q._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var Jte={exports:{}};(function(e,n){(function(a,o){e.exports=o()})(jd,function(){function a(t,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if(s!=="default"&&!(s in t)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof jd<"u"?jd:typeof self<"u"?self:{};function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var h=function(t){try{return!!t()}catch{return!0}},f=!h(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=f,b=Function.prototype,x=b.call,T=y&&b.bind.bind(x,x),S=y?T:function(t){return function(){return x.apply(t,arguments)}},N=S({}.isPrototypeOf),O=function(t){return t&&t.Math===Math&&t},A=O(typeof globalThis=="object"&&globalThis)||O(typeof window=="object"&&window)||O(typeof self=="object"&&self)||O(typeof o=="object"&&o)||O(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),I=f,P=Function.prototype,L=P.apply,F=P.call,V=typeof Reflect=="object"&&Reflect.apply||(I?F.bind(L):function(){return F.apply(L,arguments)}),G=S,B=G({}.toString),z=G("".slice),q=function(t){return z(B(t),8,-1)},Z=q,ie=S,ue=function(t){if(Z(t)==="Function")return ie(t)},re=typeof document=="object"&&document.all,pe=re===void 0&&re!==void 0?function(t){return typeof t=="function"||t===re}:function(t){return typeof t=="function"},Se={},fe=!h(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),be=f,se=Function.prototype.call,he=be?se.bind(se):function(){return se.apply(se,arguments)},Q={},le={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,Ue=we&&!le.call({1:2},1);Q.f=Ue?function(t){var r=we(this,t);return!!r&&r.enumerable}:le;var Le,tt,Te=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},De=h,qe=q,It=Object,rt=S("".split),Fe=De(function(){return!It("z").propertyIsEnumerable(0)})?function(t){return qe(t)==="String"?rt(t,""):It(t)}:It,ut=function(t){return t==null},vt=ut,Ce=TypeError,xt=function(t){if(vt(t))throw new Ce("Can't call method on "+t);return t},Nt=Fe,pt=xt,Xe=function(t){return Nt(pt(t))},ye=pe,Ve=function(t){return typeof t=="object"?t!==null:ye(t)},ht={},Bn=ht,li=A,is=pe,zl=function(t){return is(t)?t:void 0},at=function(t,r){return arguments.length<2?zl(Bn[t])||zl(li[t]):Bn[t]&&Bn[t][r]||li[t]&&li[t][r]},Vt=A.navigator,kr=Vt&&Vt.userAgent,Qn=kr?String(kr):"",qi=A,zc=Qn,Kc=qi.process,Xh=qi.Deno,Jh=Kc&&Kc.versions||Xh&&Xh.version,Qh=Jh&&Jh.v8;Qh&&(tt=(Le=Qh.split("."))[0]>0&&Le[0]<4?1:+(Le[0]+Le[1])),!tt&&zc&&(!(Le=zc.match(/Edge\/(\d+)/))||Le[1]>=74)&&(Le=zc.match(/Chrome\/(\d+)/))&&(tt=+Le[1]);var Is=tt,Zh=Is,lg=h,dg=A.String,rc=!!Object.getOwnPropertySymbols&&!lg(function(){var t=Symbol("symbol detection");return!dg(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Zh&&Zh<41}),n_=rc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ene=at,tne=pe,nne=N,rne=Object,ug=n_?function(t){return typeof t=="symbol"}:function(t){var r=ene("Symbol");return tne(r)&&nne(r.prototype,rne(t))},ine=String,ep=function(t){try{return ine(t)}catch{return"Object"}},ane=pe,sne=ep,one=TypeError,Oa=function(t){if(ane(t))return t;throw new one(sne(t)+" is not a function")},cne=Oa,lne=ut,hg=function(t,r){var i=t[r];return lne(i)?void 0:cne(i)},Rj=he,Aj=pe,Ij=Ve,dne=TypeError,Oj={exports:{}},Pj=A,une=Object.defineProperty,hne=A,pne=function(t,r){try{une(Pj,t,{value:r,configurable:!0,writable:!0})}catch{Pj[t]=r}return r},Dj="__core-js_shared__",kj=Oj.exports=hne[Dj]||pne(Dj,{});(kj.versions||(kj.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var KT=Oj.exports,jj=KT,tp=function(t,r){return jj[t]||(jj[t]=r||{})},mne=xt,fne=Object,ic=function(t){return fne(mne(t))},gne=ic,vne=S({}.hasOwnProperty),ni=Object.hasOwn||function(t,r){return vne(gne(t),r)},yne=S,_ne=0,bne=Math.random(),xne=yne(1.1.toString),YT=function(t){return"Symbol("+(t===void 0?"":t)+")_"+xne(++_ne+bne,36)},Ene=tp,Lj=ni,Sne=YT,wne=rc,Tne=n_,np=A.Symbol,qT=Ene("wks"),Cne=Tne?np.for||np:np&&np.withoutSetter||Sne,Zn=function(t){return Lj(qT,t)||(qT[t]=wne&&Lj(np,t)?np[t]:Cne("Symbol."+t)),qT[t]},Nne=he,Mj=Ve,Uj=ug,Rne=hg,Ane=function(t,r){var i,s;if(Aj(i=t.toString)&&!Ij(s=Rj(i,t))||Aj(i=t.valueOf)&&!Ij(s=Rj(i,t)))return s;throw new dne("Can't convert object to primitive value")},Ine=TypeError,One=Zn("toPrimitive"),Pne=function(t,r){if(!Mj(t)||Uj(t))return t;var i,s=Rne(t,One);if(s){if(i=Nne(s,t,r),!Mj(i)||Uj(i))return i;throw new Ine("Can't convert object to primitive value")}return Ane(t)},Dne=ug,XT=function(t){var r=Pne(t,"string");return Dne(r)?r:r+""},Fj=Ve,JT=A.document,kne=Fj(JT)&&Fj(JT.createElement),QT=function(t){return kne?JT.createElement(t):{}},jne=QT,Vj=!fe&&!h(function(){return Object.defineProperty(jne("div"),"a",{get:function(){return 7}}).a!==7}),Lne=fe,Mne=he,Une=Q,Fne=Te,Vne=Xe,Bne=XT,Gne=ni,Wne=Vj,Bj=Object.getOwnPropertyDescriptor;Se.f=Lne?Bj:function(t,r){if(t=Vne(t),r=Bne(r),Wne)try{return Bj(t,r)}catch{}if(Gne(t,r))return Fne(!Mne(Une.f,t,r),t[r])};var $ne=h,Hne=pe,zne=/#|\.prototype\./,pg=function(t,r){var i=Yne[Kne(t)];return i===Xne||i!==qne&&(Hne(r)?$ne(r):!!r)},Kne=pg.normalize=function(t){return String(t).replace(zne,".").toLowerCase()},Yne=pg.data={},qne=pg.NATIVE="N",Xne=pg.POLYFILL="P",Gj=pg,Jne=Oa,Qne=f,Zne=ue(ue.bind),Kl=function(t,r){return Jne(t),r===void 0?t:Qne?Zne(t,r):function(){return t.apply(r,arguments)}},Os={},Wj=fe&&h(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),ere=Ve,tre=String,nre=TypeError,fa=function(t){if(ere(t))return t;throw new nre(tre(t)+" is not an object")},rre=fe,ire=Vj,are=Wj,r_=fa,$j=XT,sre=TypeError,ZT=Object.defineProperty,ore=Object.getOwnPropertyDescriptor,eC="enumerable",tC="configurable",nC="writable";Os.f=rre?are?function(t,r,i){if(r_(t),r=$j(r),r_(i),typeof t=="function"&&r==="prototype"&&"value"in i&&nC in i&&!i[nC]){var s=ore(t,r);s&&s[nC]&&(t[r]=i.value,i={configurable:tC in i?i[tC]:s[tC],enumerable:eC in i?i[eC]:s[eC],writable:!1})}return ZT(t,r,i)}:ZT:function(t,r,i){if(r_(t),r=$j(r),r_(i),ire)try{return ZT(t,r,i)}catch{}if("get"in i||"set"in i)throw new sre("Accessors not supported");return"value"in i&&(t[r]=i.value),t};var cre=Os,lre=Te,hu=fe?function(t,r,i){return cre.f(t,r,lre(1,i))}:function(t,r,i){return t[r]=i,t},mg=A,dre=V,ure=ue,hre=pe,pre=Se.f,mre=Gj,rp=ht,fre=Kl,ip=hu,Hj=ni,gre=function(t){var r=function(i,s,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(i);case 2:return new t(i,s)}return new t(i,s,c)}return dre(t,this,arguments)};return r.prototype=t.prototype,r},Qt=function(t,r){var i,s,c,u,p,m,g,v,_,E=t.target,w=t.global,C=t.stat,U=t.proto,k=w?mg:C?mg[E]:mg[E]&&mg[E].prototype,j=w?rp:rp[E]||ip(rp,E,{})[E],$=j.prototype;for(u in r)s=!(i=mre(w?u:E+(C?".":"#")+u,t.forced))&&k&&Hj(k,u),m=j[u],s&&(g=t.dontCallGetSet?(_=pre(k,u))&&_.value:k[u]),p=s&&g?g:r[u],(i||U||typeof m!=typeof p)&&(v=t.bind&&s?fre(p,mg):t.wrap&&s?gre(p):U&&hre(p)?ure(p):p,(t.sham||p&&p.sham||m&&m.sham)&&ip(v,"sham",!0),ip(j,u,v),U&&(Hj(rp,c=E+"Prototype")||ip(rp,c,{}),ip(rp[c],u,p),t.real&&$&&(i||!$[u])&&ip($,u,p)))},vre=Math.ceil,yre=Math.floor,_re=Math.trunc||function(t){var r=+t;return(r>0?yre:vre)(r)},bre=_re,rC=function(t){var r=+t;return r!=r||r===0?0:bre(r)},xre=rC,Ere=Math.max,Sre=Math.min,iC=function(t,r){var i=xre(t);return i<0?Ere(i+r,0):Sre(i,r)},wre=rC,Tre=Math.min,zj=function(t){var r=wre(t);return r>0?Tre(r,9007199254740991):0},Cre=zj,Yl=function(t){return Cre(t.length)},Nre=Xe,Rre=iC,Are=Yl,Kj=function(t){return function(r,i,s){var c=Nre(r),u=Are(c);if(u===0)return!t&&-1;var p,m=Rre(s,u);if(t&&i!=i){for(;u>m;)if((p=c[m++])!=p)return!0}else for(;u>m;m++)if((t||m in c)&&c[m]===i)return t||m||0;return!t&&-1}},aC={includes:Kj(!0),indexOf:Kj(!1)},Ire=aC.includes;Qt({target:"Array",proto:!0,forced:h(function(){return!Array(1).includes()})},{includes:function(t){return Ire(this,t,arguments.length>1?arguments[1]:void 0)}});var Ore=A,Pre=ht,as=function(t,r){var i=Pre[t+"Prototype"],s=i&&i[r];if(s)return s;var c=Ore[t],u=c&&c.prototype;return u&&u[r]},Dre=as("Array","includes"),kre=Ve,jre=q,Lre=Zn("match"),sC=function(t){var r;return kre(t)&&((r=t[Lre])!==void 0?!!r:jre(t)==="RegExp")},Mre=sC,Ure=TypeError,Yj={};Yj[Zn("toStringTag")]="z";var oC=String(Yj)==="[object z]",Fre=oC,Vre=pe,i_=q,Bre=Zn("toStringTag"),Gre=Object,Wre=i_(function(){return arguments}())==="Arguments",ql=Fre?i_:function(t){var r,i,s;return t===void 0?"Undefined":t===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=Gre(t),Bre))=="string"?i:Wre?i_(r):(s=i_(r))==="Object"&&Vre(r.callee)?"Arguments":s},$re=ql,Hre=String,ga=function(t){if($re(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Hre(t)},zre=Zn("match"),Kre=Qt,Yre=function(t){if(Mre(t))throw new Ure("The method doesn't accept regular expressions");return t},qre=xt,qj=ga,Xre=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[zre]=!1,"/./"[t](r)}catch{}}return!1},Jre=S("".indexOf);Kre({target:"String",proto:!0,forced:!Xre("includes")},{includes:function(t){return!!~Jre(qj(qre(this)),qj(Yre(t)),arguments.length>1?arguments[1]:void 0)}});var Qre=as("String","includes"),Xj=N,Zre=Dre,eie=Qre,cC=Array.prototype,lC=String.prototype,tie=function(t){var r=t.includes;return t===cC||Xj(cC,t)&&r===cC.includes?Zre:typeof t=="string"||t===lC||Xj(lC,t)&&r===lC.includes?eie:r},Ne=d(tie),nie=Oa,rie=ic,iie=Fe,aie=Yl,Jj=TypeError,Qj="Reduce of empty array with no initial value",sie=function(t){return function(r,i,s,c){var u=rie(r),p=iie(u),m=aie(u);if(nie(i),m===0&&s<2)throw new Jj(Qj);var g=t?m-1:0,v=t?-1:1;if(s<2)for(;;){if(g in p){c=p[g],g+=v;break}if(g+=v,t?g<0:m<=g)throw new Jj(Qj)}for(;t?g>=0:m>g;g+=v)g in p&&(c=i(c,p[g],g,u));return c}},oie={left:sie(!1)},cie=h,a_=function(t,r){var i=[][t];return!!i&&cie(function(){i.call(null,r||function(){return 1},1)})},fg=A,lie=Qn,die=q,s_=function(t){return lie.slice(0,t.length)===t},dC=s_("Bun/")?"BUN":s_("Cloudflare-Workers")?"CLOUDFLARE":s_("Deno/")?"DENO":s_("Node.js/")?"NODE":fg.Bun&&typeof Bun.version=="string"?"BUN":fg.Deno&&typeof Deno.version=="object"?"DENO":die(fg.process)==="process"?"NODE":fg.window&&fg.document?"BROWSER":"REST",o_=dC==="NODE",uie=oie.left;Qt({target:"Array",proto:!0,forced:!o_&&Is>79&&Is<83||!a_("reduce")},{reduce:function(t){var r=arguments.length;return uie(this,t,r,r>1?arguments[1]:void 0)}});var hie=as("Array","reduce"),pie=N,mie=hie,uC=Array.prototype,fie=function(t){var r=t.reduce;return t===uC||pie(uC,t)&&r===uC.reduce?mie:r},Zj=fie,ss=d(Zj),gie=q,gg=Array.isArray||function(t){return gie(t)==="Array"},vie=Qt,yie=gg,_ie=S([].reverse),eL=[1,2];vie({target:"Array",proto:!0,forced:String(eL)===String(eL.reverse())},{reverse:function(){return yie(this)&&(this.length=this.length),_ie(this)}});var bie=as("Array","reverse"),xie=N,Eie=bie,hC=Array.prototype,Sie=function(t){var r=t.reverse;return t===hC||xie(hC,t)&&r===hC.reverse?Eie:r},tL=Sie,nL=d(tL),wie=YT,rL=tp("keys"),c_=function(t){return rL[t]||(rL[t]=wie(t))},Tie=!h(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Cie=ni,Nie=pe,Rie=ic,Aie=Tie,iL=c_("IE_PROTO"),pC=Object,Iie=pC.prototype,mC=Aie?pC.getPrototypeOf:function(t){var r=Rie(t);if(Cie(r,iL))return r[iL];var i=r.constructor;return Nie(i)&&r instanceof i?i.prototype:r instanceof pC?Iie:null},Oie=S,Pie=Oa,Die=Ve,kie=function(t){return Die(t)||t===null},jie=String,Lie=TypeError,Mie=function(t,r,i){try{return Oie(Pie(Object.getOwnPropertyDescriptor(t,r)[i]))}catch{}},Uie=Ve,Fie=xt,Vie=function(t){if(kie(t))return t;throw new Lie("Can't set "+jie(t)+" as a prototype")},Bie=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,i={};try{(t=Mie(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(s,c){return Fie(s),Vie(c),Uie(s)&&(r?t(s,c):s.__proto__=c),s}}():void 0),l_={},d_={},fC=ni,Gie=Xe,Wie=aC.indexOf,$ie=d_,aL=S([].push),sL=function(t,r){var i,s=Gie(t),c=0,u=[];for(i in s)!fC($ie,i)&&fC(s,i)&&aL(u,i);for(;r.length>c;)fC(s,i=r[c++])&&(~Wie(u,i)||aL(u,i));return u},gC=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Hie=sL,zie=gC.concat("length","prototype");l_.f=Object.getOwnPropertyNames||function(t){return Hie(t,zie)};var vg={};vg.f=Object.getOwnPropertySymbols;var Kie=at,Yie=l_,qie=vg,Xie=fa,Jie=S([].concat),Qie=Kie("Reflect","ownKeys")||function(t){var r=Yie.f(Xie(t)),i=qie.f;return i?Jie(r,i(t)):r},oL=ni,Zie=Qie,eae=Se,tae=Os,vC={},nae=sL,rae=gC,u_=Object.keys||function(t){return nae(t,rae)},iae=fe,aae=Wj,sae=Os,oae=fa,cae=Xe,lae=u_;vC.f=iae&&!aae?Object.defineProperties:function(t,r){oae(t);for(var i,s=cae(r),c=lae(r),u=c.length,p=0;u>p;)sae.f(t,i=c[p++],s[i]);return t};var h_,cL=at("document","documentElement"),dae=fa,uae=vC,lL=gC,hae=d_,pae=cL,mae=QT,yC="prototype",_C="script",dL=c_("IE_PROTO"),bC=function(){},uL=function(t){return"<"+_C+">"+t+"</"+_C+">"},hL=function(t){t.write(uL("")),t.close();var r=t.parentWindow.Object;return t=null,r},p_=function(){try{h_=new ActiveXObject("htmlfile")}catch{}var t,r,i;p_=typeof document<"u"?document.domain&&h_?hL(h_):(r=mae("iframe"),i="java"+_C+":",r.style.display="none",pae.appendChild(r),r.src=String(i),(t=r.contentWindow.document).open(),t.write(uL("document.F=Object")),t.close(),t.F):hL(h_);for(var s=lL.length;s--;)delete p_[yC][lL[s]];return p_()};hae[dL]=!0;var yg=Object.create||function(t,r){var i;return t!==null?(bC[yC]=dae(t),i=new bC,bC[yC]=null,i[dL]=t):i=p_(),r===void 0?i:uae.f(i,r)},fae=Ve,gae=hu,pL=Error,vae=S("".replace),yae=String(new pL("zxcasd").stack),mL=/\n\s*at [^:]*:[^\n]*/,_ae=mL.test(yae),bae=Te,xae=!h(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",bae(1,7)),t.stack!==7)}),Eae=hu,Sae=function(t,r){if(_ae&&typeof t=="string"&&!pL.prepareStackTrace)for(;r--;)t=vae(t,mL,"");return t},wae=xae,fL=Error.captureStackTrace,ap={},Tae=ap,Cae=Zn("iterator"),Nae=Array.prototype,gL=function(t){return t!==void 0&&(Tae.Array===t||Nae[Cae]===t)},Rae=ql,vL=hg,Aae=ut,Iae=ap,Oae=Zn("iterator"),m_=function(t){if(!Aae(t))return vL(t,Oae)||vL(t,"@@iterator")||Iae[Rae(t)]},Pae=he,Dae=Oa,kae=fa,jae=ep,Lae=m_,Mae=TypeError,xC=function(t,r){var i=arguments.length<2?Lae(t):r;if(Dae(i))return kae(Pae(i,t));throw new Mae(jae(t)+" is not iterable")},Uae=he,yL=fa,Fae=hg,_L=function(t,r,i){var s,c;yL(t);try{if(!(s=Fae(t,"return"))){if(r==="throw")throw i;return i}s=Uae(s,t)}catch(u){c=!0,s=u}if(r==="throw")throw i;if(c)throw s;return yL(s),i},Vae=Kl,Bae=he,Gae=fa,Wae=ep,$ae=gL,Hae=Yl,bL=N,zae=xC,Kae=m_,xL=_L,Yae=TypeError,f_=function(t,r){this.stopped=t,this.result=r},EL=f_.prototype,_g=function(t,r,i){var s,c,u,p,m,g,v,_=i&&i.that,E=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),U=!(!i||!i.INTERRUPTED),k=Vae(r,_),j=function(K){return s&&xL(s,"normal"),new f_(!0,K)},$=function(K){return E?(Gae(K),U?k(K[0],K[1],j):k(K[0],K[1])):U?k(K,j):k(K)};if(w)s=t.iterator;else if(C)s=t;else{if(!(c=Kae(t)))throw new Yae(Wae(t)+" is not iterable");if($ae(c)){for(u=0,p=Hae(t);p>u;u++)if((m=$(t[u]))&&bL(EL,m))return m;return new f_(!1)}s=zae(t,c)}for(g=w?t.next:s.next;!(v=Bae(g,s)).done;){try{m=$(v.value)}catch(K){xL(s,"throw",K)}if(typeof m=="object"&&m&&bL(EL,m))return m}return new f_(!1)},qae=ga,Xae=Qt,Jae=N,Qae=mC,g_=Bie,Zae=function(t,r,i){for(var s=Zie(r),c=tae.f,u=eae.f,p=0;p<s.length;p++){var m=s[p];oL(t,m)||i&&oL(i,m)||c(t,m,u(r,m))}},SL=yg,EC=hu,SC=Te,ese=function(t,r){fae(r)&&"cause"in r&&gae(t,"cause",r.cause)},tse=function(t,r,i,s){wae&&(fL?fL(t,r):Eae(t,"stack",Sae(i,s)))},nse=_g,rse=function(t,r){return t===void 0?arguments.length<2?"":r:qae(t)},ise=Zn("toStringTag"),v_=Error,ase=[].push,sp=function(t,r){var i,s=Jae(wC,this);g_?i=g_(new v_,s?Qae(this):wC):(i=s?this:SL(wC),EC(i,ise,"Error")),r!==void 0&&EC(i,"message",rse(r)),tse(i,sp,i.stack,1),arguments.length>2&&ese(i,arguments[2]);var c=[];return nse(t,ase,{that:c}),EC(i,"errors",c),i};g_?g_(sp,v_):Zae(sp,v_,{name:!0});var wC=sp.prototype=SL(v_.prototype,{constructor:SC(1,sp),message:SC(1,""),name:SC(1,"AggregateError")});Xae({global:!0},{AggregateError:sp});var y_,bg,__,sse=pe,wL=A.WeakMap,ose=sse(wL)&&/native code/.test(String(wL)),TL=A,cse=Ve,lse=hu,TC=ni,CC=KT,dse=c_,use=d_,CL="Object already initialized",NC=TL.TypeError,hse=TL.WeakMap;if(ose||CC.state){var ac=CC.state||(CC.state=new hse);ac.get=ac.get,ac.has=ac.has,ac.set=ac.set,y_=function(t,r){if(ac.has(t))throw new NC(CL);return r.facade=t,ac.set(t,r),r},bg=function(t){return ac.get(t)||{}},__=function(t){return ac.has(t)}}else{var op=dse("state");use[op]=!0,y_=function(t,r){if(TC(t,op))throw new NC(CL);return r.facade=t,lse(t,op,r),r},bg=function(t){return TC(t,op)?t[op]:{}},__=function(t){return TC(t,op)}}var pu,NL,RL,mu={set:y_,get:bg,has:__,enforce:function(t){return __(t)?bg(t):y_(t,{})},getterFor:function(t){return function(r){var i;if(!cse(r)||(i=bg(r)).type!==t)throw new NC("Incompatible receiver, "+t+" required");return i}}},RC=fe,pse=ni,AL=Function.prototype,mse=RC&&Object.getOwnPropertyDescriptor,IL=pse(AL,"name"),OL={PROPER:IL&&(function(){}).name==="something",CONFIGURABLE:IL&&(!RC||RC&&mse(AL,"name").configurable)},fse=hu,Xl=function(t,r,i,s){return s&&s.enumerable?t[r]=i:fse(t,r,i),t},gse=h,vse=pe,yse=Ve,_se=yg,PL=mC,bse=Xl,AC=Zn("iterator"),DL=!1;[].keys&&("next"in(RL=[].keys())?(NL=PL(PL(RL)))!==Object.prototype&&(pu=NL):DL=!0);var xse=!yse(pu)||gse(function(){var t={};return pu[AC].call(t)!==t});vse((pu=xse?{}:_se(pu))[AC])||bse(pu,AC,function(){return this});var kL={IteratorPrototype:pu,BUGGY_SAFARI_ITERATORS:DL},Ese=ql,Sse=oC?{}.toString:function(){return"[object "+Ese(this)+"]"},wse=oC,Tse=Os.f,Cse=hu,Nse=ni,Rse=Sse,jL=Zn("toStringTag"),Yc=function(t,r,i,s){var c=i?t:t&&t.prototype;c&&(Nse(c,jL)||Tse(c,jL,{configurable:!0,value:r}),s&&!wse&&Cse(c,"toString",Rse))},Ase=kL.IteratorPrototype,Ise=yg,Ose=Te,Pse=Yc,Dse=ap,kse=function(){return this},IC=function(t,r,i,s){var c=r+" Iterator";return t.prototype=Ise(Ase,{next:Ose(+!s,i)}),Pse(t,c,!1,!0),Dse[c]=kse,t},jse=Qt,Lse=he,Mse=OL,Use=IC,Fse=mC,Vse=Yc,LL=Xl,ML=ap,Bse=kL,Gse=Mse.PROPER,b_=Bse.BUGGY_SAFARI_ITERATORS,OC=Zn("iterator"),UL="keys",x_="values",FL="entries",Wse=function(){return this},VL=function(t,r,i,s,c,u,p){Use(i,r,s);var m,g,v,_=function($){if($===c&&k)return k;if(!b_&&$&&$ in C)return C[$];switch($){case UL:case x_:case FL:return function(){return new i(this,$)}}return function(){return new i(this)}},E=r+" Iterator",w=!1,C=t.prototype,U=C[OC]||C["@@iterator"]||c&&C[c],k=!b_&&U||_(c),j=r==="Array"&&C.entries||U;if(j&&(m=Fse(j.call(new t)))!==Object.prototype&&m.next&&(Vse(m,E,!0,!0),ML[E]=Wse),Gse&&c===x_&&U&&U.name!==x_&&(w=!0,k=function(){return Lse(U,this)}),c)if(g={values:_(x_),keys:u?k:_(UL),entries:_(FL)},p)for(v in g)(b_||w||!(v in C))&&LL(C,v,g[v]);else jse({target:r,proto:!0,forced:b_||w},g);return p&&C[OC]!==k&&LL(C,OC,k,{}),ML[r]=k,g},E_=function(t,r){return{value:t,done:r}},$se=Xe,BL=ap,GL=mu;Os.f;var Hse=VL,S_=E_,WL="Array Iterator",zse=GL.set,Kse=GL.getterFor(WL);Hse(Array,"Array",function(t,r){zse(this,{type:WL,target:$se(t),index:0,kind:r})},function(){var t=Kse(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,S_(void 0,!0);switch(t.kind){case"keys":return S_(i,!1);case"values":return S_(r[i],!1)}return S_([i,r[i]],!1)},"values"),BL.Arguments=BL.Array;var Yse=Os,w_=function(t,r,i){return Yse.f(t,r,i)},qse=at,Xse=w_,Jse=fe,$L=Zn("species"),Qse=N,Zse=TypeError,PC=function(t,r){if(Qse(r,t))return t;throw new Zse("Incorrect invocation")},eoe=pe,DC=KT,toe=S(Function.toString);eoe(DC.inspectSource)||(DC.inspectSource=function(t){return toe(t)});var HL=DC.inspectSource,noe=S,roe=h,zL=pe,ioe=ql,aoe=HL,KL=function(){},YL=at("Reflect","construct"),kC=/^\s*(?:class|function)\b/,soe=noe(kC.exec),ooe=!kC.test(KL),xg=function(t){if(!zL(t))return!1;try{return YL(KL,[],t),!0}catch{return!1}},qL=function(t){if(!zL(t))return!1;switch(ioe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ooe||!!soe(kC,aoe(t))}catch{return!0}};qL.sham=!0;var Eg,cp,XL,jC,T_=!YL||roe(function(){var t;return xg(xg.call)||!xg(Object)||!xg(function(){t=!0})||t})?qL:xg,coe=T_,loe=ep,doe=TypeError,JL=fa,uoe=function(t){if(coe(t))return t;throw new doe(loe(t)+" is not a constructor")},hoe=ut,poe=Zn("species"),LC=function(t,r){var i,s=JL(t).constructor;return s===void 0||hoe(i=JL(s)[poe])?r:uoe(i)},Jl=S([].slice),moe=TypeError,fu=function(t,r){if(t<r)throw new moe("Not enough arguments");return t},QL=/(?:ipad|iphone|ipod).*applewebkit/i.test(Qn),os=A,foe=V,goe=Kl,ZL=pe,voe=ni,eM=h,tM=cL,yoe=Jl,nM=QT,_oe=fu,boe=QL,xoe=o_,MC=os.setImmediate,UC=os.clearImmediate,Eoe=os.process,FC=os.Dispatch,Soe=os.Function,rM=os.MessageChannel,woe=os.String,VC=0,Sg={},iM="onreadystatechange";eM(function(){Eg=os.location});var BC=function(t){if(voe(Sg,t)){var r=Sg[t];delete Sg[t],r()}},GC=function(t){return function(){BC(t)}},aM=function(t){BC(t.data)},sM=function(t){os.postMessage(woe(t),Eg.protocol+"//"+Eg.host)};MC&&UC||(MC=function(t){_oe(arguments.length,1);var r=ZL(t)?t:Soe(t),i=yoe(arguments,1);return Sg[++VC]=function(){foe(r,void 0,i)},cp(VC),VC},UC=function(t){delete Sg[t]},xoe?cp=function(t){Eoe.nextTick(GC(t))}:FC&&FC.now?cp=function(t){FC.now(GC(t))}:rM&&!boe?(jC=(XL=new rM).port2,XL.port1.onmessage=aM,cp=goe(jC.postMessage,jC)):os.addEventListener&&ZL(os.postMessage)&&!os.importScripts&&Eg&&Eg.protocol!=="file:"&&!eM(sM)?(cp=sM,os.addEventListener("message",aM,!1)):cp=iM in nM("script")?function(t){tM.appendChild(nM("script"))[iM]=function(){tM.removeChild(this),BC(t)}}:function(t){setTimeout(GC(t),0)});var C_={set:MC,clear:UC},oM=A,Toe=fe,Coe=Object.getOwnPropertyDescriptor,cM=function(t){if(!Toe)return oM[t];var r=Coe(oM,t);return r&&r.value},lM=function(){this.head=null,this.tail=null};lM.prototype={add:function(t){var r={item:t,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var lp,WC,$C,HC,dM,uM=lM,Noe=/ipad|iphone|ipod/i.test(Qn)&&typeof Pebble<"u",Roe=/web0s(?!.*chrome)/i.test(Qn),dp=A,Aoe=cM,hM=Kl,zC=C_.set,Ioe=uM,Ooe=QL,Poe=Noe,Doe=Roe,KC=o_,pM=dp.MutationObserver||dp.WebKitMutationObserver,mM=dp.document,fM=dp.process,N_=dp.Promise,YC=Aoe("queueMicrotask");if(!YC){var R_=new Ioe,A_=function(){var t,r;for(KC&&(t=fM.domain)&&t.exit();r=R_.get();)try{r()}catch(i){throw R_.head&&lp(),i}t&&t.enter()};Ooe||KC||Doe||!pM||!mM?!Poe&&N_&&N_.resolve?((HC=N_.resolve(void 0)).constructor=N_,dM=hM(HC.then,HC),lp=function(){dM(A_)}):KC?lp=function(){fM.nextTick(A_)}:(zC=hM(zC,dp),lp=function(){zC(A_)}):(WC=!0,$C=mM.createTextNode(""),new pM(A_).observe($C,{characterData:!0}),lp=function(){$C.data=WC=!WC}),YC=function(t){R_.head||lp(),R_.add(t)}}var gM=YC,up=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},gu=A.Promise,koe=A,wg=gu,joe=pe,Loe=Gj,Moe=HL,Uoe=Zn,vM=dC,qC=Is,yM=wg&&wg.prototype,Foe=Uoe("species"),_M=joe(koe.PromiseRejectionEvent),Voe=Loe("Promise",function(){var t=Moe(wg),r=t!==String(wg);if(!r&&qC===66||!yM.catch||!yM.finally)return!0;if(!qC||qC<51||!/native code/.test(t)){var i=new wg(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[Foe]=s,!(i.then(function(){})instanceof s))return!0}return!(r||vM!=="BROWSER"&&vM!=="DENO"||_M)}),Tg={CONSTRUCTOR:Voe,REJECTION_EVENT:_M},sc={},bM=Oa,Boe=TypeError,Goe=function(t){var r,i;this.promise=new t(function(s,c){if(r!==void 0||i!==void 0)throw new Boe("Bad Promise constructor");r=s,i=c}),this.resolve=bM(r),this.reject=bM(i)};sc.f=function(t){return new Goe(t)};var XC,xM,EM,Woe=Qt,I_=o_,Ql=A,$oe=ht,Cg=he,Hoe=Xl,zoe=Yc,Koe=function(t){var r=qse(t);Jse&&r&&!r[$L]&&Xse(r,$L,{configurable:!0,get:function(){return this}})},Yoe=Oa,JC=pe,qoe=Ve,Xoe=PC,Joe=LC,SM=C_.set,QC=gM,Qoe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Zoe=up,ece=uM,wM=mu,ZC=gu,TM=Tg,CM=sc,O_="Promise",NM=TM.CONSTRUCTOR,tce=TM.REJECTION_EVENT,eN=wM.getterFor(O_),nce=wM.set,rce=ZC&&ZC.prototype,Ng=ZC,tN=rce,RM=Ql.TypeError,nN=Ql.document,rN=Ql.process,iN=CM.f,ice=iN,ace=!!(nN&&nN.createEvent&&Ql.dispatchEvent),AM="unhandledrejection",IM=function(t){var r;return!(!qoe(t)||!JC(r=t.then))&&r},OM=function(t,r){var i,s,c,u=r.value,p=r.state===1,m=p?t.ok:t.fail,g=t.resolve,v=t.reject,_=t.domain;try{m?(p||(r.rejection===2&&oce(r),r.rejection=1),m===!0?i=u:(_&&_.enter(),i=m(u),_&&(_.exit(),c=!0)),i===t.promise?v(new RM("Promise-chain cycle")):(s=IM(i))?Cg(s,i,g,v):g(i)):v(u)}catch(E){_&&!c&&_.exit(),v(E)}},PM=function(t,r){t.notified||(t.notified=!0,QC(function(){for(var i,s=t.reactions;i=s.get();)OM(i,t);t.notified=!1,r&&!t.rejection&&sce(t)}))},DM=function(t,r,i){var s,c;ace?((s=nN.createEvent("Event")).promise=r,s.reason=i,s.initEvent(t,!1,!0),Ql.dispatchEvent(s)):s={promise:r,reason:i},!tce&&(c=Ql["on"+t])?c(s):t===AM&&Qoe("Unhandled promise rejection",i)},sce=function(t){Cg(SM,Ql,function(){var r,i=t.facade,s=t.value;if(kM(t)&&(r=Zoe(function(){I_?rN.emit("unhandledRejection",s,i):DM(AM,i,s)}),t.rejection=I_||kM(t)?2:1,r.error))throw r.value})},kM=function(t){return t.rejection!==1&&!t.parent},oce=function(t){Cg(SM,Ql,function(){var r=t.facade;I_?rN.emit("rejectionHandled",r):DM("rejectionhandled",r,t.value)})},hp=function(t,r,i){return function(s){t(r,s,i)}},pp=function(t,r,i){t.done||(t.done=!0,i&&(t=i),t.value=r,t.state=2,PM(t,!0))},aN=function(t,r,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===r)throw new RM("Promise can't be resolved itself");var s=IM(r);s?QC(function(){var c={done:!1};try{Cg(s,r,hp(aN,c,t),hp(pp,c,t))}catch(u){pp(c,u,t)}}):(t.value=r,t.state=1,PM(t,!1))}catch(c){pp({done:!1},c,t)}}};NM&&(tN=(Ng=function(t){Xoe(this,tN),Yoe(t),Cg(XC,this);var r=eN(this);try{t(hp(aN,r),hp(pp,r))}catch(i){pp(r,i)}}).prototype,(XC=function(t){nce(this,{type:O_,done:!1,notified:!1,parent:!1,reactions:new ece,rejection:!1,state:0,value:null})}).prototype=Hoe(tN,"then",function(t,r){var i=eN(this),s=iN(Joe(this,Ng));return i.parent=!0,s.ok=!JC(t)||t,s.fail=JC(r)&&r,s.domain=I_?rN.domain:void 0,i.state===0?i.reactions.add(s):QC(function(){OM(s,i)}),s.promise}),xM=function(){var t=new XC,r=eN(t);this.promise=t,this.resolve=hp(aN,r),this.reject=hp(pp,r)},CM.f=iN=function(t){return t===Ng||t===EM?new xM(t):ice(t)}),Woe({global:!0,wrap:!0,forced:NM},{Promise:Ng}),EM=$oe.Promise,zoe(Ng,O_,!1,!0),Koe(O_);var jM=Zn("iterator"),LM=!1;try{var cce=0,MM={next:function(){return{done:!!cce++}},return:function(){LM=!0}};MM[jM]=function(){return this},Array.from(MM,function(){throw 2})}catch{}var lce=gu,dce=function(t,r){try{if(!r&&!LM)return!1}catch{return!1}var i=!1;try{var s={};s[jM]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch{}return i},P_=Tg.CONSTRUCTOR||!dce(function(t){lce.all(t).then(void 0,function(){})}),uce=he,hce=Oa,pce=sc,mce=up,fce=_g;Qt({target:"Promise",stat:!0,forced:P_},{all:function(t){var r=this,i=pce.f(r),s=i.resolve,c=i.reject,u=mce(function(){var p=hce(r.resolve),m=[],g=0,v=1;fce(t,function(_){var E=g++,w=!1;v++,uce(p,r,_).then(function(C){w||(w=!0,m[E]=C,--v||s(m))},c)}),--v||s(m)});return u.error&&c(u.value),i.promise}});var gce=Qt,vce=Tg.CONSTRUCTOR;gu&&gu.prototype,gce({target:"Promise",proto:!0,forced:vce,real:!0},{catch:function(t){return this.then(void 0,t)}});var yce=he,_ce=Oa,bce=sc,xce=up,Ece=_g;Qt({target:"Promise",stat:!0,forced:P_},{race:function(t){var r=this,i=bce.f(r),s=i.reject,c=xce(function(){var u=_ce(r.resolve);Ece(t,function(p){yce(u,r,p).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var Sce=sc;Qt({target:"Promise",stat:!0,forced:Tg.CONSTRUCTOR},{reject:function(t){var r=Sce.f(this);return(0,r.reject)(t),r.promise}});var wce=fa,Tce=Ve,Cce=sc,UM=function(t,r){if(wce(t),Tce(r)&&r.constructor===t)return r;var i=Cce.f(t);return(0,i.resolve)(r),i.promise},Nce=Qt,Rce=gu,Ace=Tg.CONSTRUCTOR,Ice=UM,Oce=at("Promise"),Pce=!Ace;Nce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Ice(Pce&&this===Oce?Rce:this,t)}});var Dce=he,kce=Oa,jce=sc,Lce=up,Mce=_g;Qt({target:"Promise",stat:!0,forced:P_},{allSettled:function(t){var r=this,i=jce.f(r),s=i.resolve,c=i.reject,u=Lce(function(){var p=kce(r.resolve),m=[],g=0,v=1;Mce(t,function(_){var E=g++,w=!1;v++,Dce(p,r,_).then(function(C){w||(w=!0,m[E]={status:"fulfilled",value:C},--v||s(m))},function(C){w||(w=!0,m[E]={status:"rejected",reason:C},--v||s(m))})}),--v||s(m)});return u.error&&c(u.value),i.promise}});var Uce=he,Fce=Oa,Vce=at,Bce=sc,Gce=up,Wce=_g,FM="No one promise resolved";Qt({target:"Promise",stat:!0,forced:P_},{any:function(t){var r=this,i=Vce("AggregateError"),s=Bce.f(r),c=s.resolve,u=s.reject,p=Gce(function(){var m=Fce(r.resolve),g=[],v=0,_=1,E=!1;Wce(t,function(w){var C=v++,U=!1;_++,Uce(m,r,w).then(function(k){U||E||(E=!0,c(k))},function(k){U||E||(U=!0,g[C]=k,--_||u(new i(g,FM)))})}),--_||u(new i(g,FM))});return p.error&&u(p.value),s.promise}});var $ce=Qt,Hce=V,zce=Jl,Kce=sc,Yce=Oa,VM=up,sN=A.Promise,BM=!1;$ce({target:"Promise",stat:!0,forced:!sN||!sN.try||VM(function(){sN.try(function(t){BM=t===8},8)}).error||!BM},{try:function(t){var r=arguments.length>1?zce(arguments,1):[],i=Kce.f(this),s=VM(function(){return Hce(Yce(t),void 0,r)});return(s.error?i.reject:i.resolve)(s.value),i.promise}});var qce=sc;Qt({target:"Promise",stat:!0},{withResolvers:function(){var t=qce.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Xce=Qt,oN=gu,Jce=h,Qce=at,Zce=pe,ele=LC,GM=UM,tle=oN&&oN.prototype;Xce({target:"Promise",proto:!0,real:!0,forced:!!oN&&Jce(function(){tle.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=ele(this,Qce("Promise")),i=Zce(t);return this.then(i?function(s){return GM(r,t()).then(function(){return s})}:t,i?function(s){return GM(r,t()).then(function(){throw s})}:t)}});var cN=S,nle=rC,rle=ga,ile=xt,ale=cN("".charAt),WM=cN("".charCodeAt),sle=cN("".slice),$M=function(t){return function(r,i){var s,c,u=rle(ile(r)),p=nle(i),m=u.length;return p<0||p>=m?t?"":void 0:(s=WM(u,p))<55296||s>56319||p+1===m||(c=WM(u,p+1))<56320||c>57343?t?ale(u,p):s:t?sle(u,p,p+2):c-56320+(s-55296<<10)+65536}},lN={codeAt:$M(!1),charAt:$M(!0)},ole=lN.charAt,cle=ga,HM=mu,lle=VL,zM=E_,KM="String Iterator",dle=HM.set,ule=HM.getterFor(KM);lle(String,"String",function(t){dle(this,{type:KM,string:cle(t),index:0})},function(){var t,r=ule(this),i=r.string,s=r.index;return s>=i.length?zM(void 0,!0):(t=ole(i,s),r.index+=t.length,zM(t,!1))});var hle=ht.Promise,ple={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},mle=A,fle=Yc,YM=ap;for(var dN in ple)fle(mle[dN],dN),YM[dN]=YM.Array;var qM=hle,Pe=d(qM),gle=as("Array","values"),vle=ql,yle=ni,_le=N,ble=gle,uN=Array.prototype,xle={DOMTokenList:!0,NodeList:!0},Ele=function(t){var r=t.values;return t===uN||_le(uN,t)&&r===uN.values||yle(xle,vle(t))?ble:r},va=d(Ele),XM=ep,Sle=TypeError,JM=Jl,wle=Math.floor,hN=function(t,r){var i=t.length;if(i<8)for(var s,c,u=1;u<i;){for(c=u,s=t[u];c&&r(t[c-1],s)>0;)t[c]=t[--c];c!==u++&&(t[c]=s)}else for(var p=wle(i/2),m=hN(JM(t,0,p),r),g=hN(JM(t,p),r),v=m.length,_=g.length,E=0,w=0;E<v||w<_;)t[E+w]=E<v&&w<_?r(m[E],g[w])<=0?m[E++]:g[w++]:E<v?m[E++]:g[w++];return t},QM=hN,ZM=Qn.match(/firefox\/(\d+)/i),Tle=!!ZM&&+ZM[1],Cle=/MSIE|Trident/.test(Qn),eU=Qn.match(/AppleWebKit\/(\d+)\./),Nle=!!eU&&+eU[1],Rle=Qt,tU=S,Ale=Oa,Ile=ic,nU=Yl,Ole=function(t,r){if(!delete t[r])throw new Sle("Cannot delete property "+XM(r)+" of "+XM(t))},rU=ga,pN=h,Ple=QM,Dle=a_,iU=Tle,kle=Cle,aU=Is,sU=Nle,Zl=[],oU=tU(Zl.sort),jle=tU(Zl.push),Lle=pN(function(){Zl.sort(void 0)}),Mle=pN(function(){Zl.sort(null)}),Ule=Dle("sort"),cU=!pN(function(){if(aU)return aU<70;if(!(iU&&iU>3)){if(kle)return!0;if(sU)return sU<603;var t,r,i,s,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)Zl.push({k:r+s,v:i})}for(Zl.sort(function(u,p){return p.v-u.v}),s=0;s<Zl.length;s++)r=Zl[s].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Rle({target:"Array",proto:!0,forced:Lle||!Mle||!Ule||!cU},{sort:function(t){t!==void 0&&Ale(t);var r=Ile(this);if(cU)return t===void 0?oU(r):oU(r,t);var i,s,c=[],u=nU(r);for(s=0;s<u;s++)s in r&&jle(c,r[s]);for(Ple(c,function(p){return function(m,g){return g===void 0?-1:m===void 0?1:p!==void 0?+p(m,g)||0:rU(m)>rU(g)?1:-1}}(t)),i=nU(c),s=0;s<i;)r[s]=c[s++];for(;s<u;)Ole(r,s++);return r}});var Fle=as("Array","sort"),Vle=N,Ble=Fle,mN=Array.prototype,Gle=function(t){var r=t.sort;return t===mN||Vle(mN,t)&&r===mN.sort?Ble:r},vu=d(Gle),Wle=Qt,$le=S,Hle=iC,zle=RangeError,lU=String.fromCharCode,dU=String.fromCodePoint,Kle=$le([].join);Wle({target:"String",stat:!0,forced:!!dU&&dU.length!==1},{fromCodePoint:function(t){for(var r,i=[],s=arguments.length,c=0;s>c;){if(r=+arguments[c++],Hle(r,1114111)!==r)throw new zle(r+" is not a valid code point");i[c]=r<65536?lU(r):lU(55296+((r-=65536)>>10),r%1024+56320)}return Kle(i,"")}});var Yle=h,qle=Zn("iterator"),D_=!Yle(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),s="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),s+=u+c}),i.delete("a",2),i.delete("b",void 0),!t.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[qle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Xle=Xl,fN=Qt,uU=A,gN=cM,Jle=at,k_=he,vo=S,Rg=fe,hU=D_,pU=Xl,Qle=w_,Zle=function(t,r,i){for(var s in r)i&&i.unsafe&&t[s]?t[s]=r[s]:Xle(t,s,r[s],i);return t},ede=Yc,tde=IC,vN=mu,mU=PC,yN=pe,nde=ni,rde=Kl,ide=ql,ade=fa,fU=Ve,ya=ga,sde=yg,gU=Te,vU=xC,ode=m_,j_=E_,mp=fu,cde=QM,lde=Zn("iterator"),fp="URLSearchParams",yU=fp+"Iterator",_U=vN.set,Ps=vN.getterFor(fp),dde=vN.getterFor(yU),bU=gN("fetch"),L_=gN("Request"),Ag=gN("Headers"),_N=L_&&L_.prototype,xU=Ag&&Ag.prototype,ude=uU.TypeError,hde=uU.encodeURIComponent,pde=String.fromCharCode,mde=Jle("String","fromCodePoint"),fde=parseInt,M_=vo("".charAt),EU=vo([].join),ed=vo([].push),SU=vo("".replace),gde=vo([].shift),wU=vo([].splice),TU=vo("".split),CU=vo("".slice),vde=vo(/./.exec),yde=/\+/g,_de=/^[0-9a-f]+$/i,NU=function(t,r){var i=CU(t,r,r+2);return vde(_de,i)?fde(i,16):NaN},bde=function(t){for(var r=0,i=128;i>0&&t&i;i>>=1)r++;return r},xde=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},RU=function(t){for(var r=(t=SU(t,yde," ")).length,i="",s=0;s<r;){var c=M_(t,s);if(c==="%"){if(M_(t,s+1)==="%"||s+3>r){i+="%",s++;continue}var u=NU(t,s+1);if(u!=u){i+=c,s++;continue}s+=2;var p=bde(u);if(p===0)c=pde(u);else{if(p===1||p>4){i+="",s++;continue}for(var m=[u],g=1;g<p&&!(++s+3>r||M_(t,s)!=="%");){var v=NU(t,s+1);if(v!=v){s+=3;break}if(v>191||v<128)break;ed(m,v),s+=2,g++}if(m.length!==p){i+="";continue}var _=xde(m);_===null?i+="":c=mde(_)}}i+=c,s++}return i},Ede=/[!'()~]|%20/g,Sde={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},wde=function(t){return Sde[t]},AU=function(t){return SU(hde(t),Ede,wde)},bN=tde(function(t,r){_U(this,{type:yU,target:Ps(t).entries,index:0,kind:r})},fp,function(){var t=dde(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,j_(void 0,!0);var s=r[i];switch(t.kind){case"keys":return j_(s.key,!1);case"values":return j_(s.value,!1)}return j_([s.key,s.value],!1)},!0),IU=function(t){this.entries=[],this.url=null,t!==void 0&&(fU(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?M_(t,0)==="?"?CU(t,1):t:ya(t)))};IU.prototype={type:fp,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,i,s,c,u,p,m,g=this.entries,v=ode(t);if(v)for(i=(r=vU(t,v)).next;!(s=k_(i,r)).done;){if(u=(c=vU(ade(s.value))).next,(p=k_(u,c)).done||(m=k_(u,c)).done||!k_(u,c).done)throw new ude("Expected sequence with length 2");ed(g,{key:ya(p.value),value:ya(m.value)})}else for(var _ in t)nde(t,_)&&ed(g,{key:_,value:ya(t[_])})},parseQuery:function(t){if(t)for(var r,i,s=this.entries,c=TU(t,"&"),u=0;u<c.length;)(r=c[u++]).length&&(i=TU(r,"="),ed(s,{key:RU(gde(i)),value:RU(EU(i,"="))}))},serialize:function(){for(var t,r=this.entries,i=[],s=0;s<r.length;)t=r[s++],ed(i,AU(t.key)+"="+AU(t.value));return EU(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var U_=function(){mU(this,gp);var t=_U(this,new IU(arguments.length>0?arguments[0]:void 0));Rg||(this.size=t.entries.length)},gp=U_.prototype;if(Zle(gp,{append:function(t,r){var i=Ps(this);mp(arguments.length,2),ed(i.entries,{key:ya(t),value:ya(r)}),Rg||this.length++,i.updateURL()},delete:function(t){for(var r=Ps(this),i=mp(arguments.length,1),s=r.entries,c=ya(t),u=i<2?void 0:arguments[1],p=u===void 0?u:ya(u),m=0;m<s.length;){var g=s[m];if(g.key!==c||p!==void 0&&g.value!==p)m++;else if(wU(s,m,1),p!==void 0)break}Rg||(this.size=s.length),r.updateURL()},get:function(t){var r=Ps(this).entries;mp(arguments.length,1);for(var i=ya(t),s=0;s<r.length;s++)if(r[s].key===i)return r[s].value;return null},getAll:function(t){var r=Ps(this).entries;mp(arguments.length,1);for(var i=ya(t),s=[],c=0;c<r.length;c++)r[c].key===i&&ed(s,r[c].value);return s},has:function(t){for(var r=Ps(this).entries,i=mp(arguments.length,1),s=ya(t),c=i<2?void 0:arguments[1],u=c===void 0?c:ya(c),p=0;p<r.length;){var m=r[p++];if(m.key===s&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var i=Ps(this);mp(arguments.length,1);for(var s,c=i.entries,u=!1,p=ya(t),m=ya(r),g=0;g<c.length;g++)(s=c[g]).key===p&&(u?wU(c,g--,1):(u=!0,s.value=m));u||ed(c,{key:p,value:m}),Rg||(this.size=c.length),i.updateURL()},sort:function(){var t=Ps(this);cde(t.entries,function(r,i){return r.key>i.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,i=Ps(this).entries,s=rde(t,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)s((r=i[c++]).value,r.key,this)},keys:function(){return new bN(this,"keys")},values:function(){return new bN(this,"values")},entries:function(){return new bN(this,"entries")}},{enumerable:!0}),pU(gp,lde,gp.entries,{}),pU(gp,"toString",function(){return Ps(this).serialize()},{enumerable:!0}),Rg&&Qle(gp,"size",{get:function(){return Ps(this).entries.length},configurable:!0,enumerable:!0}),ede(U_,fp),fN({global:!0,forced:!hU},{URLSearchParams:U_}),!hU&&yN(Ag)){var Tde=vo(xU.has),Cde=vo(xU.set),OU=function(t){if(fU(t)){var r,i=t.body;if(ide(i)===fp)return r=t.headers?new Ag(t.headers):new Ag,Tde(r,"content-type")||Cde(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),sde(t,{body:gU(0,ya(i)),headers:gU(0,r)})}return t};if(yN(bU)&&fN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return bU(t,arguments.length>1?OU(arguments[1]):{})}}),yN(L_)){var xN=function(t){return mU(this,_N),new L_(t,arguments.length>1?OU(arguments[1]):{})};_N.constructor=xN,xN.prototype=_N,fN({global:!0,dontCallGetSet:!0,forced:!0},{Request:xN})}}var Ds,Nde={URLSearchParams:U_,getState:Ps},Rde=ht.URLSearchParams,PU=fe,Ade=S,Ide=he,Ode=h,EN=u_,Pde=vg,Dde=Q,kde=ic,jde=Fe,vp=Object.assign,DU=Object.defineProperty,Lde=Ade([].concat),Mde=!vp||Ode(function(){if(PU&&vp({b:1},vp(DU({},"a",{enumerable:!0,get:function(){DU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},i=Symbol("assign detection"),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach(function(c){r[c]=c}),vp({},t)[i]!==7||EN(vp({},r)).join("")!==s})?function(t,r){for(var i=kde(t),s=arguments.length,c=1,u=Pde.f,p=Dde.f;s>c;)for(var m,g=jde(arguments[c++]),v=u?Lde(EN(g),u(g)):EN(g),_=v.length,E=0;_>E;)m=v[E++],PU&&!Ide(p,g,m)||(i[m]=g[m]);return i}:vp,Ude=fa,Fde=_L,Vde=fe,Bde=Os,Gde=Te,SN=function(t,r,i){Vde?Bde.f(t,r,Gde(0,i)):t[r]=i},Wde=Kl,$de=he,Hde=ic,zde=function(t,r,i,s){try{return s?r(Ude(i)[0],i[1]):r(i)}catch(c){Fde(t,"throw",c)}},Kde=gL,Yde=T_,qde=Yl,kU=SN,Xde=xC,Jde=m_,jU=Array,yu=S,wN=2147483647,Qde=/[^\0-\u007E]/,LU=/[.\u3002\uFF0E\uFF61]/g,MU="Overflow: input needs wider integers to process",UU=RangeError,Zde=yu(LU.exec),yp=Math.floor,TN=String.fromCharCode,FU=yu("".charCodeAt),VU=yu([].join),td=yu([].push),eue=yu("".replace),tue=yu("".split),nue=yu("".toLowerCase),BU=function(t){return t+22+75*(t<26)},rue=function(t,r,i){var s=0;for(t=i?yp(t/700):t>>1,t+=yp(t/r);t>455;)t=yp(t/35),s+=36;return yp(s+36*t/(t+38))},iue=function(t){var r=[];t=function($){for(var K=[],J=0,ne=$.length;J<ne;){var ae=FU($,J++);if(ae>=55296&&ae<=56319&&J<ne){var ee=FU($,J++);(64512&ee)==56320?td(K,((1023&ae)<<10)+(1023&ee)+65536):(td(K,ae),J--)}else td(K,ae)}return K}(t);var i,s,c=t.length,u=128,p=0,m=72;for(i=0;i<t.length;i++)(s=t[i])<128&&td(r,TN(s));var g=r.length,v=g;for(g&&td(r,"-");v<c;){var _=wN;for(i=0;i<t.length;i++)(s=t[i])>=u&&s<_&&(_=s);var E=v+1;if(_-u>yp((wN-p)/E))throw new UU(MU);for(p+=(_-u)*E,u=_,i=0;i<t.length;i++){if((s=t[i])<u&&++p>wN)throw new UU(MU);if(s===u){for(var w=p,C=36;;){var U=C<=m?1:C>=m+26?26:C-m;if(w<U)break;var k=w-U,j=36-U;td(r,TN(BU(U+k%j))),w=yp(k/j),C+=36}td(r,TN(BU(w))),m=rue(p,E,v===g),p=0,v++}}p++,u++}return VU(r,"")},aue=Qt,CN=fe,sue=D_,NN=A,GU=Kl,ks=S,F_=Xl,js=w_,oue=PC,RN=ni,AN=Mde,_p=function(t){var r=Hde(t),i=Yde(this),s=arguments.length,c=s>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Wde(c,s>2?arguments[2]:void 0));var p,m,g,v,_,E,w=Jde(r),C=0;if(!w||this===jU&&Kde(w))for(p=qde(r),m=i?new this(p):jU(p);p>C;C++)E=u?c(r[C],C):r[C],kU(m,C,E);else for(m=i?new this:[],_=(v=Xde(r,w)).next;!(g=$de(_,v)).done;C++)E=u?zde(v,c,[g.value,C],!0):g.value,kU(m,C,E);return m.length=C,m},yo=Jl,cue=lN.codeAt,lue=function(t){var r,i,s=[],c=tue(eue(nue(t),LU,"."),".");for(r=0;r<c.length;r++)i=c[r],td(s,Zde(Qde,i)?"xn--"+iue(i):i);return VU(s,".")},qc=ga,due=Yc,uue=fu,WU=Nde,$U=mu,hue=$U.set,V_=$U.getterFor("URL"),pue=WU.URLSearchParams,mue=WU.getState,Ig=NN.URL,IN=NN.TypeError,B_=NN.parseInt,fue=Math.floor,HU=Math.pow,Ls=ks("".charAt),_o=ks(/./.exec),Og=ks([].join),gue=ks(1.1.toString),vue=ks([].pop),bp=ks([].push),ON=ks("".replace),yue=ks([].shift),_ue=ks("".split),Pg=ks("".slice),G_=ks("".toLowerCase),bue=ks([].unshift),PN="Invalid scheme",_u="Invalid host",zU="Invalid port",KU=/[a-z]/i,xue=/[\d+-.a-z]/i,DN=/\d/,Eue=/^0x/i,Sue=/^[0-7]+$/,wue=/^\d+$/,YU=/^[\da-f]+$/i,Tue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Cue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Nue=/^[\u0000-\u0020]+/,Rue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Aue=/[\t\n\r]/g,Dg=function(t){var r,i,s,c;if(typeof t=="number"){for(r=[],i=0;i<4;i++)bue(r,t%256),t=fue(t/256);return Og(r,".")}if(typeof t=="object"){for(r="",s=function(u){for(var p=null,m=1,g=null,v=0,_=0;_<8;_++)u[_]!==0?(v>m&&(p=g,m=v),g=null,v=0):(g===null&&(g=_),++v);return v>m?g:p}(t),i=0;i<8;i++)c&&t[i]===0||(c&&(c=!1),s===i?(r+=i?":":"::",c=!0):(r+=gue(t[i],16),i<7&&(r+=":")));return"["+r+"]"}return t},W_={},qU=AN({},W_,{" ":1,'"':1,"<":1,">":1,"`":1}),XU=AN({},qU,{"#":1,"?":1,"{":1,"}":1}),kN=AN({},XU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),nd=function(t,r){var i=cue(t,0);return i>32&&i<127&&!RN(r,t)?t:encodeURIComponent(t)},$_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},kg=function(t,r){var i;return t.length===2&&_o(KU,Ls(t,0))&&((i=Ls(t,1))===":"||!r&&i==="|")},JU=function(t){var r;return t.length>1&&kg(Pg(t,0,2))&&(t.length===2||(r=Ls(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Iue=function(t){return t==="."||G_(t)==="%2e"},jN={},QU={},LN={},ZU={},e5={},MN={},t5={},n5={},H_={},z_={},UN={},FN={},VN={},BN={},r5={},GN={},xp={},oc={},i5={},bu={},Xc={},WN=function(t,r,i){var s,c,u,p=qc(t);if(r){if(c=this.parse(p))throw new IN(c);this.searchParams=null}else{if(i!==void 0&&(s=new WN(i,!0)),c=this.parse(p,null,s))throw new IN(c);(u=mue(new pue)).bindURL(this),this.searchParams=u}};WN.prototype={type:"URL",parse:function(t,r,i){var s,c,u,p,m,g=this,v=r||jN,_=0,E="",w=!1,C=!1,U=!1;for(t=qc(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=ON(t,Nue,""),t=ON(t,Rue,"$1")),t=ON(t,Aue,""),s=_p(t);_<=s.length;){switch(c=s[_],v){case jN:if(!c||!_o(KU,c)){if(r)return PN;v=LN;continue}E+=G_(c),v=QU;break;case QU:if(c&&(_o(xue,c)||c==="+"||c==="-"||c==="."))E+=G_(c);else{if(c!==":"){if(r)return PN;E="",v=LN,_=0;continue}if(r&&(g.isSpecial()!==RN($_,E)||E==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=E,r)return void(g.isSpecial()&&$_[g.scheme]===g.port&&(g.port=null));E="",g.scheme==="file"?v=BN:g.isSpecial()&&i&&i.scheme===g.scheme?v=ZU:g.isSpecial()?v=n5:s[_+1]==="/"?(v=e5,_++):(g.cannotBeABaseURL=!0,bp(g.path,""),v=i5)}break;case LN:if(!i||i.cannotBeABaseURL&&c!=="#")return PN;if(i.cannotBeABaseURL&&c==="#"){g.scheme=i.scheme,g.path=yo(i.path),g.query=i.query,g.fragment="",g.cannotBeABaseURL=!0,v=Xc;break}v=i.scheme==="file"?BN:MN;continue;case ZU:if(c!=="/"||s[_+1]!=="/"){v=MN;continue}v=H_,_++;break;case e5:if(c==="/"){v=z_;break}v=oc;continue;case MN:if(g.scheme=i.scheme,c===Ds)g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=yo(i.path),g.query=i.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=t5;else if(c==="?")g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=yo(i.path),g.query="",v=bu;else{if(c!=="#"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=yo(i.path),g.path.length--,v=oc;continue}g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=yo(i.path),g.query=i.query,g.fragment="",v=Xc}break;case t5:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,v=oc;continue}v=z_}else v=H_;break;case n5:if(v=H_,c!=="/"||Ls(E,_+1)!=="/")continue;_++;break;case H_:if(c!=="/"&&c!=="\\"){v=z_;continue}break;case z_:if(c==="@"){w&&(E="%40"+E),w=!0,u=_p(E);for(var k=0;k<u.length;k++){var j=u[k];if(j!==":"||U){var $=nd(j,kN);U?g.password+=$:g.username+=$}else U=!0}E=""}else if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(w&&E==="")return"Invalid authority";_-=_p(E).length+1,E="",v=UN}else E+=c;break;case UN:case FN:if(r&&g.scheme==="file"){v=GN;continue}if(c!==":"||C){if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&E==="")return _u;if(r&&E===""&&(g.includesCredentials()||g.port!==null))return;if(p=g.parseHost(E))return p;if(E="",v=xp,r)return;continue}c==="["?C=!0:c==="]"&&(C=!1),E+=c}else{if(E==="")return _u;if(p=g.parseHost(E))return p;if(E="",v=VN,r===FN)return}break;case VN:if(!_o(DN,c)){if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(E!==""){var K=B_(E,10);if(K>65535)return zU;g.port=g.isSpecial()&&K===$_[g.scheme]?null:K,E=""}if(r)return;v=xp;continue}return zU}E+=c;break;case BN:if(g.scheme="file",c==="/"||c==="\\")v=r5;else{if(!i||i.scheme!=="file"){v=oc;continue}switch(c){case Ds:g.host=i.host,g.path=yo(i.path),g.query=i.query;break;case"?":g.host=i.host,g.path=yo(i.path),g.query="",v=bu;break;case"#":g.host=i.host,g.path=yo(i.path),g.query=i.query,g.fragment="",v=Xc;break;default:JU(Og(yo(s,_),""))||(g.host=i.host,g.path=yo(i.path),g.shortenPath()),v=oc;continue}}break;case r5:if(c==="/"||c==="\\"){v=GN;break}i&&i.scheme==="file"&&!JU(Og(yo(s,_),""))&&(kg(i.path[0],!0)?bp(g.path,i.path[0]):g.host=i.host),v=oc;continue;case GN:if(c===Ds||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&kg(E))v=oc;else if(E===""){if(g.host="",r)return;v=xp}else{if(p=g.parseHost(E))return p;if(g.host==="localhost"&&(g.host=""),r)return;E="",v=xp}continue}E+=c;break;case xp:if(g.isSpecial()){if(v=oc,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Ds&&(v=oc,c!=="/"))continue}else g.fragment="",v=Xc;else g.query="",v=bu;break;case oc:if(c===Ds||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=G_(m=E))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||bp(g.path,"")):Iue(E)?c==="/"||c==="\\"&&g.isSpecial()||bp(g.path,""):(g.scheme==="file"&&!g.path.length&&kg(E)&&(g.host&&(g.host=""),E=Ls(E,0)+":"),bp(g.path,E)),E="",g.scheme==="file"&&(c===Ds||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)yue(g.path);c==="?"?(g.query="",v=bu):c==="#"&&(g.fragment="",v=Xc)}else E+=nd(c,XU);break;case i5:c==="?"?(g.query="",v=bu):c==="#"?(g.fragment="",v=Xc):c!==Ds&&(g.path[0]+=nd(c,W_));break;case bu:r||c!=="#"?c!==Ds&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":nd(c,W_)):(g.fragment="",v=Xc);break;case Xc:c!==Ds&&(g.fragment+=nd(c,qU))}_++}},parseHost:function(t){var r,i,s;if(Ls(t,0)==="["){if(Ls(t,t.length-1)!=="]"||(r=function(c){var u,p,m,g,v,_,E,w=[0,0,0,0,0,0,0,0],C=0,U=null,k=0,j=function(){return Ls(c,k)};if(j()===":"){if(Ls(c,1)!==":")return;k+=2,U=++C}for(;j();){if(C===8)return;if(j()!==":"){for(u=p=0;p<4&&_o(YU,j());)u=16*u+B_(j(),16),k++,p++;if(j()==="."){if(p===0||(k-=p,C>6))return;for(m=0;j();){if(g=null,m>0){if(!(j()==="."&&m<4))return;k++}if(!_o(DN,j()))return;for(;_o(DN,j());){if(v=B_(j(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;k++}w[C]=256*w[C]+g,++m!=2&&m!==4||C++}if(m!==4)return;break}if(j()===":"){if(k++,!j())return}else if(j())return;w[C++]=u}else{if(U!==null)return;k++,U=++C}}if(U!==null)for(_=C-U,C=7;C!==0&&_>0;)E=w[C],w[C--]=w[U+_-1],w[U+--_]=E;else if(C!==8)return;return w}(Pg(t,1,-1)),!r))return _u;this.host=r}else if(this.isSpecial()){if(t=lue(t),_o(Tue,t)||(r=function(c){var u,p,m,g,v,_,E,w=_ue(c,".");if(w.length&&w[w.length-1]===""&&w.length--,(u=w.length)>4)return c;for(p=[],m=0;m<u;m++){if((g=w[m])==="")return c;if(v=10,g.length>1&&Ls(g,0)==="0"&&(v=_o(Eue,g)?16:8,g=Pg(g,v===8?1:2)),g==="")_=0;else{if(!_o(v===10?wue:v===8?Sue:YU,g))return c;_=B_(g,v)}bp(p,_)}for(m=0;m<u;m++)if(_=p[m],m===u-1){if(_>=HU(256,5-u))return null}else if(_>255)return null;for(E=vue(p),m=0;m<p.length;m++)E+=p[m]*HU(256,3-m);return E}(t),r===null))return _u;this.host=r}else{if(_o(Cue,t))return _u;for(r="",i=_p(t),s=0;s<i.length;s++)r+=nd(i[s],W_);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return RN($_,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&kg(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,i=t.username,s=t.password,c=t.host,u=t.port,p=t.path,m=t.query,g=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=i+(s?":"+s:"")+"@"),v+=Dg(c),u!==null&&(v+=":"+u)):r==="file"&&(v+="//"),v+=t.cannotBeABaseURL?p[0]:p.length?"/"+Og(p,"/"):"",m!==null&&(v+="?"+m),g!==null&&(v+="#"+g),v},setHref:function(t){var r=this.parse(t);if(r)throw new IN(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new Ep(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Dg(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(qc(t)+":",jN)},getUsername:function(){return this.username},setUsername:function(t){var r=_p(qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=nd(r[i],kN)}},getPassword:function(){return this.password},setPassword:function(t){var r=_p(qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=nd(r[i],kN)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Dg(t):Dg(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,UN)},getHostname:function(){var t=this.host;return t===null?"":Dg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,FN)},getPort:function(){var t=this.port;return t===null?"":qc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=qc(t))===""?this.port=null:this.parse(t,VN))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Og(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,xp))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=qc(t))===""?this.query=null:(Ls(t,0)==="?"&&(t=Pg(t,1)),this.query="",this.parse(t,bu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=qc(t))!==""?(Ls(t,0)==="#"&&(t=Pg(t,1)),this.fragment="",this.parse(t,Xc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ep=function(t){var r=oue(this,_a),i=uue(arguments.length,1)>1?arguments[1]:void 0,s=hue(r,new WN(t,!1,i));CN||(r.href=s.serialize(),r.origin=s.getOrigin(),r.protocol=s.getProtocol(),r.username=s.getUsername(),r.password=s.getPassword(),r.host=s.getHost(),r.hostname=s.getHostname(),r.port=s.getPort(),r.pathname=s.getPathname(),r.search=s.getSearch(),r.searchParams=s.getSearchParams(),r.hash=s.getHash())},_a=Ep.prototype,Ms=function(t,r){return{get:function(){return V_(this)[t]()},set:r&&function(i){return V_(this)[r](i)},configurable:!0,enumerable:!0}};if(CN&&(js(_a,"href",Ms("serialize","setHref")),js(_a,"origin",Ms("getOrigin")),js(_a,"protocol",Ms("getProtocol","setProtocol")),js(_a,"username",Ms("getUsername","setUsername")),js(_a,"password",Ms("getPassword","setPassword")),js(_a,"host",Ms("getHost","setHost")),js(_a,"hostname",Ms("getHostname","setHostname")),js(_a,"port",Ms("getPort","setPort")),js(_a,"pathname",Ms("getPathname","setPathname")),js(_a,"search",Ms("getSearch","setSearch")),js(_a,"searchParams",Ms("getSearchParams")),js(_a,"hash",Ms("getHash","setHash"))),F_(_a,"toJSON",function(){return V_(this).serialize()},{enumerable:!0}),F_(_a,"toString",function(){return V_(this).serialize()},{enumerable:!0}),Ig){var a5=Ig.createObjectURL,s5=Ig.revokeObjectURL;a5&&F_(Ep,"createObjectURL",GU(a5,Ig)),s5&&F_(Ep,"revokeObjectURL",GU(s5,Ig))}due(Ep,"URL"),aue({global:!0,forced:!sue,sham:!CN},{URL:Ep});var Oue=Qt,o5=h,Pue=fu,c5=ga,Due=D_,$N=at("URL"),kue=Due&&o5(function(){$N.canParse()}),jue=o5(function(){return $N.canParse.length!==1});Oue({target:"URL",stat:!0,forced:!kue||jue},{canParse:function(t){var r=Pue(arguments.length,1),i=c5(t),s=r<2||arguments[1]===void 0?void 0:c5(arguments[1]);try{return!!new $N(i,s)}catch{return!1}}});var Lue=Qt,Mue=fu,l5=ga,Uue=D_,Fue=at("URL");Lue({target:"URL",stat:!0,forced:!Uue},{parse:function(t){var r=Mue(arguments.length,1),i=l5(t),s=r<2||arguments[1]===void 0?void 0:l5(arguments[1]);try{return new Fue(i,s)}catch{return null}}});var K_=d(ht.URL);let d5=!0,u5=!0;function Y_(t,r,i){const s=t.match(r);return s&&s.length>=i&&parseInt(s[i],10)}function xu(t,r,i){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(p,m){if(p!==r)return c.apply(this,arguments);const g=v=>{const _=i(v);_&&(m.handleEvent?m.handleEvent(_):m(_))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[p,g])};const u=s.removeEventListener;s.removeEventListener=function(p,m){if(p!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[p,g])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(p){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),p&&this.addEventListener(r,this["_on"+r]=p)},enumerable:!0,configurable:!0})}function Vue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(d5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Bue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(u5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function h5(){if(typeof window=="object"){if(d5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function HN(t,r){u5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function p5(t){return Object.prototype.toString.call(t)==="[object Object]"}function m5(t){var r;return p5(t)?ss(r=Object.keys(t)).call(r,function(i,s){const c=p5(t[s]),u=c?m5(t[s]):t[s],p=c&&!Object.keys(u).length;return u===void 0||p?i:Object.assign(i,{[s]:u})},{}):t}function zN(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?zN(t,t.get(r[s]),i):s.endsWith("Ids")&&r[s].forEach(c=>{zN(t,t.get(c),i)})}))}function f5(t,r,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(p=>{p.type==="track"&&p.trackIdentifier===r.id&&u.push(p)}),u.forEach(p=>{t.forEach(m=>{m.type===s&&m.trackId===p.id&&zN(t,m,c)})}),c}const g5=h5;function v5(t,r){const i=t&&t.navigator;if(!i.mediaDevices)return;const s=function(p){if(typeof p!="object"||p.mandatory||p.optional)return p;const m={};return Object.keys(p).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof p[g]=="object"?p[g]:{ideal:p[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const _=function(E,w){return E?E+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(v.ideal!==void 0){m.optional=m.optional||[];let E={};typeof v.ideal=="number"?(E[_("min",g)]=v.ideal,m.optional.push(E),E={},E[_("max",g)]=v.ideal,m.optional.push(E)):(E[_("",g)]=v.ideal,m.optional.push(E))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[_("",g)]=v.exact):["min","max"].forEach(E=>{v[E]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[_(E,g)]=v[E])})}),p.advanced&&(m.optional=(m.optional||[]).concat(p.advanced)),m},c=function(p,m){if(r.version>=61)return m(p);if((p=JSON.parse(JSON.stringify(p)))&&typeof p.audio=="object"){const g=function(v,_,E){_ in v&&!(E in v)&&(v[E]=v[_],delete v[_])};g((p=JSON.parse(JSON.stringify(p))).audio,"autoGainControl","googAutoGainControl"),g(p.audio,"noiseSuppression","googNoiseSuppression"),p.audio=s(p.audio)}if(p&&typeof p.video=="object"){let g=p.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||v)){let _;if(delete p.video.facingMode,g.exact==="environment"||g.ideal==="environment"?_=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(_=["front"]),_)return i.mediaDevices.enumerateDevices().then(E=>{E=E.filter(C=>C.kind==="videoinput");let w=E.find(C=>_.some(U=>{var k;return Ne(k=C.label.toLowerCase()).call(k,U)}));return!w&&E.length&&Ne(_).call(_,"back")&&(w=E[E.length-1]),w&&(p.video.deviceId=g.exact?{exact:w.deviceId}:{ideal:w.deviceId}),p.video=s(p.video),g5("chrome: "+JSON.stringify(p)),m(p)})}p.video=s(p.video)}return g5("chrome: "+JSON.stringify(p)),m(p)},u=function(p){return r.version>=64?p:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[p.name]||p.name,message:p.message,constraint:p.constraint||p.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(p,m,g){c(p,v=>{i.webkitGetUserMedia(v,m,_=>{g&&g(u(_))})})}).bind(i),i.mediaDevices.getUserMedia){const p=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,g=>p(g).then(v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return v},v=>Pe.reject(u(v))))}}}function y5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function _5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(p=>p.track&&p.track.id===s.track.id):{track:s.track};const u=new Event("track");u.track=s.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(p=>p.track&&p.track.id===s.id):{track:s};const u=new Event("track");u.track=s,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else xu(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function b5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(p,m){let g=c.apply(this,arguments);return g||(g=r(this,p),this._senders.push(g)),g};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(p){u.apply(this,arguments);const m=this._senders.indexOf(p);m!==-1&&this._senders.splice(m,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const p=this._senders.find(m=>m.track===u);p&&this._senders.splice(this._senders.indexOf(p),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function x5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const g={};return m.result().forEach(v=>{const _={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(E=>{_[E]=v.stat(E)}),g[_.id]=_}),g},p=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){s(p(u(g)))};return r.apply(this,[m,i])}return new Pe((m,g)=>{r.apply(this,[function(v){m(p(u(v)))},g])}).then(s,c)}}function E5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>f5(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),xu(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>f5(c,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let s,c,u;return this.getSenders().forEach(p=>{p.track===i&&(s?u=!0:s=p)}),this.getReceivers().forEach(p=>(p.track===i&&(c?u=!0:c=p),p.track===i)),u||s&&c?Pe.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Pe.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function S5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,p){if(!p)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[p.id]?this._shimmedLocalStreams[p.id].indexOf(m)===-1&&this._shimmedLocalStreams[p.id].push(m):this._shimmedLocalStreams[p.id]=[p,m],m};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const p=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(g=>p.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(p=>{const m=this._shimmedLocalStreams[p].indexOf(u);m!==-1&&this._shimmedLocalStreams[p].splice(m,1),this._shimmedLocalStreams[p].length===1&&delete this._shimmedLocalStreams[p]}),c.apply(this,arguments)}}function w5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return S5(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(v=>this._reverseStreams[v.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(v=>{if(this.getSenders().find(E=>E.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const v=new t.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}s.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function u(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(E=>{const w=g._reverseStreams[E],C=g._streams[w.id];_=_.replace(new RegExp(C.id,"g"),w.id)}),new RTCSessionDescription({type:v.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const w=this._streams[v.id];if(w)w.addTrack(g),Pe.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new t.MediaStream([g]);this._streams[v.id]=C,this._reverseStreams[C.id]=v,this.addStream(C)}return this.getSenders().find(C=>C.track===g)},["createOffer","createAnswer"].forEach(function(g){const v=t.RTCPeerConnection.prototype[g],_={[g](){const E=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[w=>{const C=u(this,w);E[0].apply(null,[C])},w=>{E[1]&&E[1].apply(null,w)},arguments[2]]):v.apply(this,arguments).then(w=>u(this,w))}};t.RTCPeerConnection.prototype[g]=_[g]});const p=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,v){let _=v.sdp;return Object.keys(g._reverseStreams||[]).forEach(E=>{const w=g._reverseStreams[E],C=g._streams[w.id];_=_.replace(new RegExp(w.id,"g"),C.id)}),new RTCSessionDescription({type:v.type,sdp:_})}(this,arguments[0]),p.apply(this,arguments)):p.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:u(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(E=>g.track===E)&&(v=this._streams[_])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function KN(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]})}function T5(t,r){xu(t,"negotiationneeded",i=>{const s=i.target;if(!(r.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i})}var C5=Object.freeze({__proto__:null,fixNegotiationNeeded:T5,shimAddTrackRemoveTrack:w5,shimAddTrackRemoveTrackWithNative:S5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(s=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,p=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:p||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:b5,shimGetStats:x5,shimGetUserMedia:v5,shimMediaStream:y5,shimOnTrack:_5,shimPeerConnection:KN,shimSenderReceiverGetStats:E5});function N5(t,r){const i=t&&t.navigator,s=t&&t.MediaStreamTrack;if(i.getUserMedia=function(c,u,p){HN("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,p)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(p,m,g){m in p&&!(g in p)&&(p[g]=p[m],delete p[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(JSON.stringify(p)),c(p.audio,"autoGainControl","mozAutoGainControl"),c(p.audio,"noiseSuppression","mozNoiseSuppression")),u(p)},s&&s.prototype.getSettings){const p=s.prototype.getSettings;s.prototype.getSettings=function(){const m=p.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(s&&s.prototype.applyConstraints){const p=s.prototype.applyConstraints;s.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[m])}}}}function R5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function YN(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],p={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=p[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,p]=arguments;return s.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(g=>{g.type=i[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((v,_)=>{m.set(_,Object.assign({},v,{type:i[v.type]||v.type}))})}return m}).then(u,p)}}function A5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Pe.resolve(new Map)}}function I5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),xu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function O5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){HN("removeStream","removeTrack"),this.getSenders().forEach(i=>{var s;i.track&&Ne(s=r.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function P5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function D5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(s){const{sender:u}=c,p=u.getParameters();(!("encodings"in p)||p.encodings.length===1&&Object.keys(p.encodings[0]).length===0)&&(p.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(p).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function k5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function j5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Pe.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function L5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Pe.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var M5=Object.freeze({__proto__:null,shimAddTransceiver:D5,shimCreateAnswer:L5,shimCreateOffer:j5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Pe.reject(s)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:k5,shimGetUserMedia:N5,shimOnTrack:R5,shimPeerConnection:YN,shimRTCDataChannel:P5,shimReceiverGetStats:I5,shimRemoveStream:O5,shimSenderGetStats:A5});function U5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){var s;this._localStreams||(this._localStreams=[]),Ne(s=this._localStreams).call(s,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c&&c.forEach(p=>{var m;this._localStreams?Ne(m=this._localStreams).call(m,p)||this._localStreams.push(p):this._localStreams=[p]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const s=r.getTracks();this.getSenders().forEach(c=>{Ne(s).call(s,c.track)&&this.removeTrack(c)})})}}function F5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Ne(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const p=new Event("addstream");p.stream=c,this.dispatchEvent(p)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function V5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.createOffer,s=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,p=r.addIceCandidate;r.createOffer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[_]);return v?(E.then(g,v),Pe.resolve()):E},r.createAnswer=function(g,v){const _=arguments.length>=2?arguments[2]:arguments[0],E=s.apply(this,[_]);return v?(E.then(g,v),Pe.resolve()):E};let m=function(g,v,_){const E=c.apply(this,[g]);return _?(E.then(v,_),Pe.resolve()):E};r.setLocalDescription=m,m=function(g,v,_){const E=u.apply(this,[g]);return _?(E.then(v,_),Pe.resolve()):E},r.setRemoteDescription=m,m=function(g,v,_){const E=p.apply(this,[g]);return _?(E.then(v,_),Pe.resolve()):E},r.addIceCandidate=m}function B5(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,s=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>s(G5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,s,c){r.mediaDevices.getUserMedia(i).then(s,c)}).bind(r))}function G5(t){return t&&t.video!==void 0?Object.assign({},t,{video:m5(t.video)}):t}function W5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let p=i.iceServers[u];!p.hasOwnProperty("urls")&&p.hasOwnProperty("url")?(HN("RTCIceServer.url","RTCIceServer.urls"),p=JSON.parse(JSON.stringify(p)),p.urls=p.url,delete p.url,c.push(p)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,s)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function $5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H5(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function z5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var K5=Object.freeze({__proto__:null,shimAudioContext:z5,shimCallbacksAPI:V5,shimConstraints:G5,shimCreateOfferLegacy:H5,shimGetUserMedia:B5,shimLocalStreamsAPI:U5,shimRTCIceServerUrls:W5,shimRemoteStreamsAPI:F5,shimTrackEventTransceiver:$5}),Y5=`	
\v\f\r \u2028\u2029\uFEFF`,Gue=xt,Wue=ga,qN=Y5,q5=S("".replace),$ue=RegExp("^["+qN+"]+"),Hue=RegExp("(^|[^"+qN+"])["+qN+"]+$"),zue=function(t){return function(r){var i=Wue(Gue(r));return 1&t&&(i=q5(i,$ue,"")),2&t&&(i=q5(i,Hue,"$1")),i}},Kue={trim:zue(3)},Yue=OL.PROPER,que=h,X5=Y5,Xue=Kue.trim;Qt({target:"String",proto:!0,forced:function(t){return que(function(){return!!X5[t]()||""[t]()!==""||Yue&&X5[t].name!==t})}("trim")},{trim:function(){return Xue(this)}});var Jue=as("String","trim"),Que=N,Zue=Jue,XN=String.prototype,ehe=function(t){var r=t.trim;return typeof t=="string"||t===XN||Que(XN,t)&&r===XN.trim?Zue:r},Ei=d(ehe),J5={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(s=>s.trim())},r.splitSections=function(i){return i.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},r.getDescription=function(i){const s=r.splitSections(i);return s&&s[0]},r.getMediaSections=function(i){const s=r.splitSections(i);return s.shift(),s},r.matchPrefix=function(i,s){return r.splitLines(i).filter(c=>c.indexOf(s)===0)},r.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":c.relatedAddress=s[u+1];break;case"rport":c.relatedPort=parseInt(s[u+1],10);break;case"tcptype":c.tcpType=s[u+1];break;case"ufrag":c.ufrag=s[u+1],c.usernameFragment=s[u+1];break;default:c[s[u]]===void 0&&(c[s[u]]=s[u+1])}return c},r.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const u=i.type;return s.push("typ"),s.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const s={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let p=0;p<u.length;p++)c=u[p].trim().split("="),s[c[0].trim()]=c[1];return s},r.writeFmtp=function(i){let s="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(p=>{i.parameters[p]!==void 0?u.push(p+"="+i.parameters[p]):u.push(p)}),s+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return s},r.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(i){let s="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},r.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},u=i.indexOf(":",s);return u>-1?(c.attribute=i.substring(s+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(s+1),c},r.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},r.getMid=function(i){const s=r.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},r.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:r.matchPrefix(i+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,s){let c="a=setup:"+s+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,s){return r.matchPrefix(i+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,s){const c=r.matchPrefix(i+s,"a=ice-ufrag:")[0],u=r.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},r.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");s.profile=c[2];for(let p=3;p<c.length;p++){const m=c[p],g=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(g){const v=r.parseRtpMap(g),_=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(v.parameters=_.length?r.parseFmtp(_[0]):{},v.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),s.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(p=>{s.headerExtensions.push(r.parseExtmap(p))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return s.codecs.forEach(p=>{u.forEach(m=>{p.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||p.rtcpFeedback.push(m)})}),s},r.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(p=>p.preferredPayloadType!==void 0?p.preferredPayloadType:p.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(p=>{c+=r.writeRtpMap(p),c+=r.writeFmtp(p),c+=r.writeRtcpFb(p)});let u=0;return s.codecs.forEach(p=>{p.maxptime>u&&(u=p.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(p=>{c+=r.writeExtmap(p)}),c},r.parseRtpEncodingParameters=function(i){const s=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,p=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(w=>r.parseSsrcMedia(w)).filter(w=>w.attribute==="cname"),g=m.length>0&&m[0].ssrc;let v;const _=r.matchPrefix(i,"a=ssrc-group:FID").map(w=>w.substring(17).split(" ").map(C=>parseInt(C,10)));_.length>0&&_[0].length>1&&_[0][0]===g&&(v=_[0][1]),c.codecs.forEach(w=>{if(w.name.toUpperCase()==="RTX"&&w.parameters.apt){let C={ssrc:g,codecPayloadType:parseInt(w.parameters.apt,10)};g&&v&&(C.rtx={ssrc:v}),s.push(C),u&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:g,mechanism:p?"red+ulpfec":"red"},s.push(C))}}),s.length===0&&g&&s.push({ssrc:g});let E=r.matchPrefix(i,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,s.forEach(w=>{w.maxBitrate=E})),s},r.parseRtcpParameters=function(i){const s={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;const p=r.matchPrefix(i,"a=rtcp-mux");return s.mux=p.length>0,s},r.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},r.parseMsid=function(i){let s;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const u=r.matchPrefix(i,"a=ssrc:").map(p=>r.parseSsrcMedia(p)).filter(p=>p.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(i){const s=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const p=r.matchPrefix(i,"a=sctp-port:");if(p.length>0)return{port:parseInt(p[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,s){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,s,c){let u;const p=s!==void 0?s:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+p+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,s){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const s=r.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(i){const s=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=r.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(J5);var Q5=J5.exports,Sp=d(Q5),the=a({__proto__:null,default:Sp},[Q5]);function q_(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new r(i),c=Sp.parseCandidate(i.candidate),u=Object.assign(s,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},t.RTCIceCandidate.prototype=r.prototype,xu(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function JN(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||xu(t,"icecandidate",r=>{if(r.candidate){const i=Sp.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function X_(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const g=Sp.splitSections(m.sdp);return g.shift(),g.some(v=>{const _=Sp.parseMLine(v);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},s=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},u=function(m,g){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const _=Sp.matchPrefix(m.sdp,"a=max-message-size:");return _.length>0?v=parseInt(_[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(v=2147483637),v},p=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=s(arguments[0]),g=c(m),v=u(arguments[0],m);let _;_=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>_}),this._sctp=E}return p.apply(this,arguments)}}function J_(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(s,c){const u=s.send;s.send=function(){const p=arguments[0],m=p.length||p.size||p.byteLength;if(s.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return r(s,this),s},xu(t,"datachannel",s=>(r(s.channel,s.target),s))}function QN(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const p=new Event("connectionstatechange",c);u.dispatchEvent(p)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function ZN(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(u=>Ei(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function Q_(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Pe.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Pe.resolve())})}function Z_(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var nhe=Object.freeze({__proto__:null,removeExtmapAllowMixed:ZN,shimAddIceCandidateNullOrEmpty:Q_,shimConnectionState:QN,shimMaxMessageSize:X_,shimParameterlessSetLocalDescription:Z_,shimRTCIceCandidate:q_,shimRTCIceCandidateRelayProtocol:JN,shimSendThrowTypeError:J_});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=h5,s=function(u){const p={browser:null,version:null};if(u===void 0||!u.navigator)return p.browser="Not a browser.",p;const{navigator:m}=u;if(m.mozGetUserMedia)p.browser="firefox",p.version=Y_(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)p.browser="chrome",p.version=Y_(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return p.browser="Not a supported browser.",p;p.browser="safari",p.version=Y_(m.userAgent,/AppleWebKit\/(\d+)\./,1),p.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return p}(t),c={browserDetails:s,commonShim:nhe,extractVersion:Y_,disableLog:Vue,disableWarnings:Bue,sdp:the};switch(s.browser){case"chrome":if(!C5||!KN||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=C5,Q_(t,s),Z_(t),v5(t,s),y5(t),KN(t,s),_5(t),w5(t,s),b5(t),x5(t),E5(t),T5(t,s),q_(t),JN(t),QN(t),X_(t,s),J_(t),ZN(t,s);break;case"firefox":if(!M5||!YN||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=M5,Q_(t,s),Z_(t),N5(t,s),YN(t,s),R5(t),O5(t),A5(t),I5(t),P5(t),D5(t),k5(t),j5(t),L5(t),q_(t),QN(t),X_(t,s),J_(t);break;case"safari":if(!K5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=K5,Q_(t,s),Z_(t),W5(t),H5(t),V5(t),U5(t),F5(t),$5(t),B5(t),z5(t),q_(t),JN(t),X_(t,s),J_(t),ZN(t,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var rhe=h,Z5=A.RegExp,ihe=!rhe(function(){var t=!0;try{Z5(".","d")}catch{t=!1}var r={},i="",s=t?"dgimsy":"gimsy",c=function(m,g){Object.defineProperty(r,m,{get:function(){return i+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var p in t&&(u.hasIndices="d"),u)c(p,u[p]);return Object.getOwnPropertyDescriptor(Z5.prototype,"flags").get.call(r)!==s||i!==s}),ahe=fa,she=he,ohe=ni,che=N,e4={correct:ihe},lhe=function(){var t=ahe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},dhe=RegExp.prototype,eR=e4.correct?function(t){return t.flags}:function(t){return e4.correct||!che(dhe,t)||ohe(t,"flags")?t.flags:she(lhe,t)},tR=S,uhe=Math.floor,nR=tR("".charAt),hhe=tR("".replace),rR=tR("".slice),phe=/\$([$&'`]|\d{1,2})/g,mhe=Qt,fhe=he,iR=S,t4=xt,ghe=pe,vhe=Ve,yhe=sC,wp=ga,_he=hg,bhe=eR,xhe=function(t,r,i,s,c,u){var p=i+t.length,m=s.length,g=phe;return hhe(u,g,function(v,_){var E;switch(nR(_,0)){case"$":return"$";case"&":return t;case"`":return rR(r,0,i);case"'":return rR(r,p);case"<":E=c[rR(_,1,-1)];break;default:var w=+_;if(w===0)return v;if(w>m){var C=uhe(w/10);return C===0?v:C<=m?s[C-1]===void 0?nR(_,1):s[C-1]+nR(_,1):v}E=s[w-1]}return E===void 0?"":E})},Ehe=Zn("replace"),She=TypeError,aR=iR("".indexOf),whe=iR("".replace),n4=iR("".slice),The=Math.max;mhe({target:"String",proto:!0},{replaceAll:function(t,r){var i,s,c,u,p,m,g,v,_,E,w=t4(this),C=0,U="";if(vhe(t)){if((i=yhe(t))&&(s=wp(t4(bhe(t))),!~aR(s,"g")))throw new She("`.replaceAll` does not allow non-global regexes");if(c=_he(t,Ehe))return fhe(c,t,w,r);if(i)return whe(wp(w),t,r)}for(u=wp(w),p=wp(t),(m=ghe(r))||(r=wp(r)),g=p.length,v=The(1,g),_=aR(u,p);_!==-1;)E=m?wp(r(p,_,u)):xhe(p,u,_,[],void 0,r),U+=n4(u,C,_)+E,C=_+g,_=_+v>u.length?-1:aR(u,p,_+v);return C<u.length&&(U+=n4(u,C)),U}});var Che=as("String","replaceAll"),Nhe=N,Rhe=Che,sR=String.prototype,Ahe=function(t){var r=t.replaceAll;return typeof t=="string"||t===sR||Nhe(sR,t)&&r===sR.replaceAll?Rhe:r},Ihe=d(Ahe),oR=A;Qt({global:!0,forced:oR.globalThis!==oR},{globalThis:oR});var r4=d(A),cR={exports:{}};(function(t,r){(function(i,s){var c="function",u="undefined",p="object",m="string",g="major",v="model",_="name",E="type",w="vendor",C="version",U="architecture",k="console",j="mobile",$="tablet",K="smarttv",J="wearable",ne="embedded",ae="Amazon",ee="Apple",oe="ASUS",ve="BlackBerry",Ee="Browser",Be="Chrome",mt="Firefox",ct="Google",Tt="Honor",Et="Huawei",Yt="LG",Tn="Microsoft",_e="Motorola",Oe="Nvidia",He="OnePlus",xe="Opera",D="OPPO",X="Samsung",te="Sharp",Ae="Sony",yt="Xiaomi",fn="Zebra",xr="Facebook",vs="Chromium OS",Sd="Mac OS",Zx=" Browser",_m=function(nr){for(var dr={},En=0;En<nr.length;En++)dr[nr[En].toUpperCase()]=nr[En];return dr},eE=function(nr,dr){return typeof nr===m&&ih(dr).indexOf(ih(nr))!==-1},ih=function(nr){return nr.toLowerCase()},Mv=function(nr,dr){if(typeof nr===m)return nr=nr.replace(/^\s\s*/,""),typeof dr===u?nr:nr.substring(0,500)},ah=function(nr,dr){for(var En,ta,Fo,$n,cl,Wt,Vo=0;Vo<dr.length&&!cl;){var sh=dr[Vo],Cc=dr[Vo+1];for(En=ta=0;En<sh.length&&!cl&&sh[En];)if(cl=sh[En++].exec(nr))for(Fo=0;Fo<Cc.length;Fo++)Wt=cl[++ta],typeof($n=Cc[Fo])===p&&$n.length>0?$n.length===2?typeof $n[1]==c?this[$n[0]]=$n[1].call(this,Wt):this[$n[0]]=$n[1]:$n.length===3?typeof $n[1]!==c||$n[1].exec&&$n[1].test?this[$n[0]]=Wt?Wt.replace($n[1],$n[2]):s:this[$n[0]]=Wt?$n[1].call(this,Wt,$n[2]):s:$n.length===4&&(this[$n[0]]=Wt?$n[3].call(this,Wt.replace($n[1],$n[2])):s):this[$n]=Wt||s;Vo+=2}},wd=function(nr,dr){for(var En in dr)if(typeof dr[En]===p&&dr[En].length>0){for(var ta=0;ta<dr[En].length;ta++)if(eE(dr[En][ta],nr))return En==="?"?s:En}else if(eE(dr[En],nr))return En==="?"?s:En;return dr.hasOwnProperty("*")?dr["*"]:nr},z$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,C],[/opios[\/ ]+([\w\.]+)/i],[C,[_,xe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[_,xe+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[_,xe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[_,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[_,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+Ee],C],[/\bfocus\/([\w\.]+)/i],[C,[_,mt+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[_,xe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[_,xe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[_,"MIUI"+Zx]],[/fxios\/([\w\.-]+)/i],[C,[_,mt]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+Zx],C],[/samsungbrowser\/([\w\.]+)/i],[C,[_,X+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,xr],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[_,Be+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Be+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[_,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[C,wd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[_,mt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[C,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[U,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[U,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[U,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[U,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[U,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[U,/ower/,"",ih]],[/ sun4\w[;\)]/i],[[U,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[U,ih]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[w,X],[E,$]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[w,X],[E,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[w,ee],[E,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[w,ee],[E,$]],[/(macintosh);/i],[v,[w,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[w,te],[E,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[v,[w,Tt],[E,$]],[/honor([-\w ]+)[;\)]/i],[v,[w,Tt],[E,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[v,[w,Et],[E,$]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[w,Et],[E,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[v,/_/g," "],[w,yt],[E,$]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[v,/_/g," "],[w,yt],[E,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[w,D],[E,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[v,[w,wd,{OnePlus:["304","403","203"],"*":D}],[E,$]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[w,"Vivo"],[E,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[w,"Realme"],[E,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[w,_e],[E,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[w,_e],[E,$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[w,Yt],[E,$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[w,Yt],[E,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[v,[w,"Lenovo"],[E,$]],[/(nokia) (t[12][01])/i],[w,v,[E,$]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[v,/_/g," "],[E,j],[w,"Nokia"]],[/(pixel (c|tablet))\b/i],[v,[w,ct],[E,$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[w,ct],[E,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[w,Ae],[E,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[w,Ae],[E,$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[w,He],[E,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[w,ae],[E,$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[w,ae],[E,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,w,[E,$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[w,ve],[E,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[w,oe],[E,$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[w,oe],[E,j]],[/(nexus 9)/i],[v,[w,"HTC"],[E,$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[v,/_/g," "],[E,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[w,"TCL"],[E,$]],[/(itel) ((\w+))/i],[[w,ih],v,[E,wd,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[w,"Acer"],[E,$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[w,"Meizu"],[E,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[w,"Ulefone"],[E,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[w,"Energizer"],[E,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[w,"Cat"],[E,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[w,"Smartfren"],[E,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[w,"Nothing"],[E,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[v,[w,"Archos"],[E,$]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[v,[w,"Archos"],[E,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[w,v,[E,$]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[w,v,[E,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[w,v,[E,$]],[/(surface duo)/i],[v,[w,Tn],[E,$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[w,"Fairphone"],[E,j]],[/(u304aa)/i],[v,[w,"AT&T"],[E,j]],[/\bsie-(\w*)/i],[v,[w,"Siemens"],[E,j]],[/\b(rct\w+) b/i],[v,[w,"RCA"],[E,$]],[/\b(venue[\d ]{2,7}) b/i],[v,[w,"Dell"],[E,$]],[/\b(q(?:mv|ta)\w+) b/i],[v,[w,"Verizon"],[E,$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[w,"Barnes & Noble"],[E,$]],[/\b(tm\d{3}\w+) b/i],[v,[w,"NuVision"],[E,$]],[/\b(k88) b/i],[v,[w,"ZTE"],[E,$]],[/\b(nx\d{3}j) b/i],[v,[w,"ZTE"],[E,j]],[/\b(gen\d{3}) b.+49h/i],[v,[w,"Swiss"],[E,j]],[/\b(zur\d{3}) b/i],[v,[w,"Swiss"],[E,$]],[/\b((zeki)?tb.*\b) b/i],[v,[w,"Zeki"],[E,$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[w,"Dragon Touch"],v,[E,$]],[/\b(ns-?\w{0,9}) b/i],[v,[w,"Insignia"],[E,$]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[w,"NextBook"],[E,$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[w,"Voice"],v,[E,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[w,"LvTel"],v,[E,j]],[/\b(ph-1) /i],[v,[w,"Essential"],[E,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[w,"Envizen"],[E,$]],[/\b(trio[-\w\. ]+) b/i],[v,[w,"MachSpeed"],[E,$]],[/\btu_(1491) b/i],[v,[w,"Rotor"],[E,$]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[v,[w,Oe],[E,$]],[/(sprint) (\w+)/i],[w,v,[E,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[w,Tn],[E,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[w,fn],[E,$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[w,fn],[E,j]],[/smart-tv.+(samsung)/i],[w,[E,K]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[w,X],[E,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,Yt],[E,K]],[/(apple) ?tv/i],[w,[v,ee+" TV"],[E,K]],[/crkey/i],[[v,Be+"cast"],[w,ct],[E,K]],[/droid.+aft(\w+)( bui|\))/i],[v,[w,ae],[E,K]],[/(shield \w+ tv)/i],[v,[w,Oe],[E,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[w,te],[E,K]],[/(bravia[\w ]+)( bui|\))/i],[v,[w,Ae],[E,K]],[/(mi(tv|box)-?\w+) bui/i],[v,[w,yt],[E,K]],[/Hbbtv.*(technisat) (.*);/i],[w,v,[E,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,Mv],[v,Mv],[E,K]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[v,[E,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,K]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[w,v,[E,k]],[/droid.+; (shield)( bui|\))/i],[v,[w,Oe],[E,k]],[/(playstation \w+)/i],[v,[w,Ae],[E,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[w,Tn],[E,k]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[v,[w,X],[E,J]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[w,v,[E,J]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[v,[w,D],[E,J]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[w,ee],[E,J]],[/(opwwe\d{3})/i],[v,[w,He],[E,J]],[/(moto 360)/i],[v,[w,_e],[E,J]],[/(smartwatch 3)/i],[v,[w,Ae],[E,J]],[/(g watch r)/i],[v,[w,Yt],[E,J]],[/droid.+; (wt63?0{2,3})\)/i],[v,[w,fn],[E,J]],[/droid.+; (glass) \d/i],[v,[w,ct],[E,J]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,v,[E,J]],[/; (quest( \d| pro)?)/i],[v,[w,xr],[E,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[E,ne]],[/(aeobc)\b/i],[v,[w,ae],[E,ne]],[/(homepod).+mac os/i],[v,[w,ee],[E,ne]],[/windows iot/i],[[E,ne]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[E,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[E,$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[v,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,C],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,C],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[C,wd,z$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,wd,z$],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,Sd],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],C],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,C],[/\(bb(10);/i],[C,[_,ve]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[C,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[_,mt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[_,Be+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,vs],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,C],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,C]]},Uo=function(nr,dr){if(typeof nr===p&&(dr=nr,nr=s),!(this instanceof Uo))return new Uo(nr,dr).getResult();var En=typeof i!==u&&i.navigator?i.navigator:s,ta=nr||(En&&En.userAgent?En.userAgent:""),Fo=En&&En.userAgentData?En.userAgentData:s,$n=dr?function(Wt,Vo){var sh={};for(var Cc in Wt)Vo[Cc]&&Vo[Cc].length%2==0?sh[Cc]=Vo[Cc].concat(Wt[Cc]):sh[Cc]=Wt[Cc];return sh}(K$,dr):K$,cl=En&&En.userAgent==ta;return this.getBrowser=function(){var Wt={};return Wt[_]=s,Wt[C]=s,ah.call(Wt,ta,$n.browser),Wt[g]=function(Vo){return typeof Vo===m?Vo.replace(/[^\d\.]/g,"").split(".")[0]:s}(Wt[C]),cl&&En&&En.brave&&typeof En.brave.isBrave==c&&(Wt[_]="Brave"),Wt},this.getCPU=function(){var Wt={};return Wt[U]=s,ah.call(Wt,ta,$n.cpu),Wt},this.getDevice=function(){var Wt={};return Wt[w]=s,Wt[v]=s,Wt[E]=s,ah.call(Wt,ta,$n.device),cl&&!Wt[E]&&Fo&&Fo.mobile&&(Wt[E]=j),cl&&Wt[v]=="Macintosh"&&En&&typeof En.standalone!==u&&En.maxTouchPoints&&En.maxTouchPoints>2&&(Wt[v]="iPad",Wt[E]=$),Wt},this.getEngine=function(){var Wt={};return Wt[_]=s,Wt[C]=s,ah.call(Wt,ta,$n.engine),Wt},this.getOS=function(){var Wt={};return Wt[_]=s,Wt[C]=s,ah.call(Wt,ta,$n.os),cl&&!Wt[_]&&Fo&&Fo.platform&&Fo.platform!="Unknown"&&(Wt[_]=Fo.platform.replace(/chrome os/i,vs).replace(/macos/i,Sd)),Wt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ta},this.setUA=function(Wt){return ta=typeof Wt===m&&Wt.length>500?Mv(Wt,500):Wt,this},this.setUA(ta),this};Uo.VERSION="0.7.41",Uo.BROWSER=_m([_,C,g]),Uo.CPU=_m([U]),Uo.DEVICE=_m([v,w,E,k,j,K,$,J,ne]),Uo.ENGINE=Uo.OS=_m([_,C]),t.exports&&(r=t.exports=Uo),r.UAParser=Uo;var bm=typeof i!==u&&(i.jQuery||i.Zepto);if(bm&&!bm.ua){var tE=new Uo;bm.ua=tE.getResult(),bm.ua.get=function(){return tE.getUA()},bm.ua.set=function(nr){tE.setUA(nr);var dr=tE.getResult();for(var En in dr)bm.ua[En]=dr[En]}}})(typeof window=="object"?window:o)})(cR,cR.exports);var Ohe=d(cR.exports),i4=C_.clear;Qt({global:!0,bind:!0,forced:A.clearImmediate!==i4},{clearImmediate:i4});var a4=A,Phe=V,Dhe=pe,khe=dC,jhe=Qn,Lhe=Jl,Mhe=fu,Uhe=a4.Function,Fhe=/MSIE .\./.test(jhe)||khe==="BUN"&&function(){var t=a4.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),Vhe=Qt,s4=A,o4=C_.set,Bhe=function(t,r){var i=1;return Fhe?function(s,c){var u=Mhe(arguments.length,1)>i,p=Dhe(s)?s:Uhe(s),m=u?Lhe(arguments,i):[],g=u?function(){Phe(p,this,m)}:p;return t(g)}:t},c4=s4.setImmediate?Bhe(o4):o4;Vhe({global:!0,bind:!0,forced:s4.setImmediate!==c4},{setImmediate:c4});var l4=d(ht.setImmediate),Ghe=A,Whe=gM,$he=Oa,Hhe=fu,zhe=fe;Qt({global:!0,dontCallGetSet:!0,forced:h(function(){return zhe&&Object.getOwnPropertyDescriptor(Ghe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){Hhe(arguments.length,1),Whe($he(t))}});var d4=d(ht.queueMicrotask);function u4(t,r){return function(){return t.apply(r,arguments)}}const{toString:Khe}=Object.prototype,{getPrototypeOf:lR}=Object,{iterator:eb,toStringTag:h4}=Symbol,tb=(dR=Object.create(null),t=>{const r=Khe.call(t);return dR[r]||(dR[r]=r.slice(8,-1).toLowerCase())});var dR;const bo=t=>(t=t.toLowerCase(),r=>tb(r)===t),nb=t=>r=>typeof r===t,{isArray:Tp}=Array,Cp=nb("undefined");function jg(t){return t!==null&&!Cp(t)&&t.constructor!==null&&!Cp(t.constructor)&&Pa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const p4=bo("ArrayBuffer"),Yhe=nb("string"),Pa=nb("function"),m4=nb("number"),Lg=t=>t!==null&&typeof t=="object",rb=t=>{if(tb(t)!=="object")return!1;const r=lR(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||h4 in t||eb in t)},qhe=bo("Date"),Xhe=bo("File"),Jhe=bo("Blob"),Qhe=bo("FileList"),Zhe=bo("URLSearchParams"),[epe,tpe,npe,rpe]=["ReadableStream","Request","Response","Headers"].map(bo);function Mg(t,r){let i,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Tp(t))for(i=0,s=t.length;i<s;i++)r.call(null,t[i],i,t);else{if(jg(t))return;const u=c?Object.getOwnPropertyNames(t):Object.keys(t),p=u.length;let m;for(i=0;i<p;i++)m=u[i],r.call(null,t[m],m,t)}}function f4(t,r){if(jg(t))return null;r=r.toLowerCase();const i=Object.keys(t);let s,c=i.length;for(;c-- >0;)if(s=i[c],r===s.toLowerCase())return s;return null}const Eu=r4!==void 0?r4:typeof self<"u"?self:typeof window<"u"?window:jd,g4=t=>!Cp(t)&&t!==Eu,ipe=(uR=typeof Uint8Array<"u"&&lR(Uint8Array),t=>uR&&t instanceof uR);var uR;const ape=bo("HTMLFormElement"),v4=(t=>{let{hasOwnProperty:r}=t;return(i,s)=>r.call(i,s)})(Object.prototype),spe=bo("RegExp"),y4=(t,r)=>{const i=Object.getOwnPropertyDescriptors(t),s={};Mg(i,(c,u)=>{let p;(p=r(c,u,t))!==!1&&(s[u]=p||c)}),Object.defineProperties(t,s)},ope=bo("AsyncFunction"),_4=(b4=typeof l4=="function",x4=Pa(Eu.postMessage),b4?l4:x4?(hR="axios@".concat(Math.random()),ib=[],Eu.addEventListener("message",t=>{let{source:r,data:i}=t;r===Eu&&i===hR&&ib.length&&ib.shift()()},!1),t=>{ib.push(t),Eu.postMessage(hR,"*")}):t=>setTimeout(t));var b4,x4,hR,ib;const cpe=d4!==void 0?d4.bind(Eu):typeof process<"u"&&process.nextTick||_4;var je={isArray:Tp,isArrayBuffer:p4,isBuffer:jg,isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Pa(t.append)&&((r=tb(t))==="formdata"||r==="object"&&Pa(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&p4(t.buffer),r},isString:Yhe,isNumber:m4,isBoolean:t=>t===!0||t===!1,isObject:Lg,isPlainObject:rb,isEmptyObject:t=>{if(!Lg(t)||jg(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},isReadableStream:epe,isRequest:tpe,isResponse:npe,isHeaders:rpe,isUndefined:Cp,isDate:qhe,isFile:Xhe,isBlob:Jhe,isRegExp:spe,isFunction:Pa,isStream:t=>Lg(t)&&Pa(t.pipe),isURLSearchParams:Zhe,isTypedArray:ipe,isFileList:Qhe,forEach:Mg,merge:function t(){const{caseless:r,skipUndefined:i}=g4(this)&&this||{},s={},c=(u,p)=>{const m=r&&f4(s,p)||p;rb(s[m])&&rb(u)?s[m]=t(s[m],u):rb(u)?s[m]=t({},u):Tp(u)?s[m]=u.slice():i&&Cp(u)||(s[m]=u)};for(let u=0,p=arguments.length;u<p;u++)arguments[u]&&Mg(arguments[u],c);return s},extend:function(t,r,i){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Mg(r,(c,u)=>{i&&Pa(c)?t[u]=u4(c,i):t[u]=c},{allOwnKeys:s}),t},trim:t=>Ei(t)?Ei(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,i,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,r,i,s)=>{let c,u,p;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)p=c[u],s&&!s(p,t,r)||m[p]||(r[p]=t[p],m[p]=!0);t=i!==!1&&lR(t)}while(t&&(!i||i(t,r))&&t!==Object.prototype);return r},kindOf:tb,kindOfTest:bo,endsWith:(t,r,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=r.length;const s=t.indexOf(r,i);return s!==-1&&s===i},toArray:t=>{if(!t)return null;if(Tp(t))return t;let r=t.length;if(!m4(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=t[r];return i},forEachEntry:(t,r)=>{const i=(t&&t[eb]).call(t);let s;for(;(s=i.next())&&!s.done;){const c=s.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let i;const s=[];for(;(i=t.exec(r))!==null;)s.push(i);return s},isHTMLForm:ape,hasOwnProperty:v4,hasOwnProp:v4,reduceDescriptors:y4,freezeMethods:t=>{y4(t,(r,i)=>{if(Pa(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=t[i];Pa(s)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(t,r)=>{const i={},s=c=>{c.forEach(u=>{i[u]=!0})};return Tp(t)?s(t):s(String(t).split(r)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,s){return i.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:f4,global:Eu,isContextDefined:g4,isSpecCompliantForm:function(t){return!!(t&&Pa(t.append)&&t[h4]==="FormData"&&t[eb])},toJSONObject:t=>{const r=new Array(10),i=(s,c)=>{if(Lg(s)){if(r.indexOf(s)>=0)return;if(jg(s))return s;if(!("toJSON"in s)){r[c]=s;const u=Tp(s)?[]:{};return Mg(s,(p,m)=>{const g=i(p,c+1);!Cp(g)&&(u[m]=g)}),r[c]=void 0,u}}return s};return i(t,0)},isAsyncFn:ope,isThenable:t=>t&&(Lg(t)||Pa(t))&&Pa(t.then)&&Pa(t.catch),setImmediate:_4,asap:cpe,isIterable:t=>t!=null&&Pa(t[eb])};function on(t,r,i,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}je.inherits(on,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.status}}});const E4=on.prototype,S4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{S4[t]={value:t}}),Object.defineProperties(on,S4),Object.defineProperty(E4,"isAxiosError",{value:!0}),on.from=(t,r,i,s,c,u)=>{const p=Object.create(E4);je.toFlatObject(t,p,function(v){return v!==Error.prototype},v=>v!=="isAxiosError");const m=t&&t.message?t.message:"Error",g=r==null&&t?t.code:r;return on.call(p,m,g,i,s,c),t&&p.cause==null&&Object.defineProperty(p,"cause",{value:t,configurable:!0}),p.name=t&&t.name||"Error",u&&Object.assign(p,u),p};function pR(t){return je.isPlainObject(t)||je.isArray(t)}function w4(t){return je.endsWith(t,"[]")?t.slice(0,-2):t}function T4(t,r,i){return t?t.concat(r).map(function(s,c){return s=w4(s),!i&&c?"["+s+"]":s}).join(i?".":""):r}const lpe=je.toFlatObject(je,{},null,function(t){return/^is[A-Z]/.test(t)});function ab(t,r,i){if(!je.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const s=(i=je.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,C){return!je.isUndefined(C[w])})).metaTokens,c=i.visitor||v,u=i.dots,p=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&je.isSpecCompliantForm(r);if(!je.isFunction(c))throw new TypeError("visitor must be a function");function g(w){if(w===null)return"";if(je.isDate(w))return w.toISOString();if(je.isBoolean(w))return w.toString();if(!m&&je.isBlob(w))throw new on("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(w)||je.isTypedArray(w)?m&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function v(w,C,U){let k=w;if(w&&!U&&typeof w=="object"){if(je.endsWith(C,"{}"))C=s?C:C.slice(0,-2),w=JSON.stringify(w);else if(je.isArray(w)&&function(j){return je.isArray(j)&&!j.some(pR)}(w)||(je.isFileList(w)||je.endsWith(C,"[]"))&&(k=je.toArray(w)))return C=w4(C),k.forEach(function(j,$){!je.isUndefined(j)&&j!==null&&r.append(p===!0?T4([C],$,u):p===null?C:C+"[]",g(j))}),!1}return!!pR(w)||(r.append(T4(U,C,u),g(w)),!1)}const _=[],E=Object.assign(lpe,{defaultVisitor:v,convertValue:g,isVisitable:pR});if(!je.isObject(t))throw new TypeError("data must be an object");return function w(C,U){if(!je.isUndefined(C)){if(_.indexOf(C)!==-1)throw Error("Circular reference detected in "+U.join("."));_.push(C),je.forEach(C,function(k,j){(!(je.isUndefined(k)||k===null)&&c.call(r,k,je.isString(j)?Ei(j).call(j):j,U,E))===!0&&w(k,U?U.concat(j):[j])}),_.pop()}}(t),r}function C4(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function mR(t,r){this._pairs=[],t&&ab(t,this,r)}const N4=mR.prototype;function dpe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function R4(t,r,i){if(!r)return t;const s=i&&i.encode||dpe;je.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):je.isURLSearchParams(r)?r.toString():new mR(r,i).toString(s),u){const p=t.indexOf("#");p!==-1&&(t=t.slice(0,p)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}N4.append=function(t,r){this._pairs.push([t,r])},N4.toString=function(t){const r=t?function(i){return t.call(this,i,C4)}:C4;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var A4=class{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){je.forEach(this.handlers,function(r){r!==null&&t(r)})}},I4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},O4={exports:{}},upe=Qt,hpe=fe,P4=Os.f;upe({target:"Object",stat:!0,forced:Object.defineProperty!==P4,sham:!hpe},{defineProperty:P4});var D4=ht.Object,ppe=O4.exports=function(t,r,i){return D4.defineProperty(t,r,i)};D4.defineProperty.sham&&(ppe.sham=!0);var k4=d(O4.exports),mpe=TypeError,j4=gg,fpe=T_,gpe=Ve,vpe=Zn("species"),L4=Array,ype=function(t){var r;return j4(t)&&(r=t.constructor,(fpe(r)&&(r===L4||j4(r.prototype))||gpe(r)&&(r=r[vpe])===null)&&(r=void 0)),r===void 0?L4:r},M4=function(t,r){return new(ype(t))(r===0?0:r)},_pe=h,bpe=Is,xpe=Zn("species"),U4=function(t){return bpe>=51||!_pe(function(){var r=[];return(r.constructor={})[xpe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Epe=Qt,Spe=h,wpe=gg,Tpe=Ve,Cpe=ic,Npe=Yl,F4=function(t){if(t>9007199254740991)throw mpe("Maximum allowed index exceeded");return t},V4=SN,Rpe=M4,Ape=U4,Ipe=Is,B4=Zn("isConcatSpreadable"),Ope=Ipe>=51||!Spe(function(){var t=[];return t[B4]=!1,t.concat()[0]!==t}),Ppe=function(t){if(!Tpe(t))return!1;var r=t[B4];return r!==void 0?!!r:wpe(t)};Epe({target:"Array",proto:!0,forced:!Ope||!Ape("concat")},{concat:function(t){var r,i,s,c,u,p=Cpe(this),m=Rpe(p,0),g=0;for(r=-1,s=arguments.length;r<s;r++)if(Ppe(u=r===-1?p:arguments[r]))for(c=Npe(u),F4(g+c),i=0;i<c;i++,g++)i in u&&V4(m,g,u[i]);else F4(g+1),V4(m,g++,u);return m.length=g,m}});var G4={},Dpe=q,kpe=Xe,W4=l_.f,jpe=Jl,$4=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];G4.f=function(t){return $4&&Dpe(t)==="Window"?function(r){try{return W4(r)}catch{return jpe($4)}}(t):W4(kpe(t))};var Np={},Lpe=Zn;Np.f=Lpe;var H4=ht,Mpe=ni,Upe=Np,Fpe=Os.f,jr=function(t){var r=H4.Symbol||(H4.Symbol={});Mpe(r,t)||Fpe(r,t,{value:Upe.f(t)})},Vpe=he,Bpe=at,Gpe=Zn,Wpe=Xl,z4=function(){var t=Bpe("Symbol"),r=t&&t.prototype,i=r&&r.valueOf,s=Gpe("toPrimitive");r&&!r[s]&&Wpe(r,s,function(c){return Vpe(i,this)},{})},$pe=Kl,Hpe=Fe,zpe=ic,Kpe=Yl,Ype=M4,K4=S([].push),qpe=function(t){var r=t===1,i=t===2,s=t===3,c=t===4,u=t===6,p=t===7,m=t===5||u;return function(g,v,_,E){for(var w,C,U=zpe(g),k=Hpe(U),j=Kpe(k),$=$pe(v,_),K=0,J=E||Ype,ne=r?J(g,j):i||p?J(g,0):void 0;j>K;K++)if((m||K in k)&&(C=$(w=k[K],K,U),t))if(r)ne[K]=C;else if(C)switch(t){case 3:return!0;case 5:return w;case 6:return K;case 2:K4(ne,w)}else switch(t){case 4:return!1;case 7:K4(ne,w)}return u?-1:s||c?c:ne}},Y4={forEach:qpe(0)},sb=Qt,Ug=A,fR=he,Xpe=S,Rp=fe,Ap=rc,Jpe=h,Si=ni,Qpe=N,gR=fa,ob=Xe,vR=XT,Zpe=ga,yR=Te,Ip=yg,q4=u_,eme=l_,X4=G4,tme=vg,J4=Se,Q4=Os,nme=vC,Z4=Q,e3=Xl,rme=w_,_R=tp,t3=d_,n3=YT,ime=Zn,ame=Np,sme=jr,ome=z4,cme=Yc,r3=mu,cb=Y4.forEach,Da=c_("hidden"),lb="Symbol",Fg="prototype",lme=r3.set,i3=r3.getterFor(lb),xo=Object[Fg],Su=Ug.Symbol,db=Su&&Su[Fg],dme=Ug.RangeError,ume=Ug.TypeError,bR=Ug.QObject,a3=J4.f,wu=Q4.f,s3=X4.f,hme=Z4.f,o3=Xpe([].push),Jc=_R("symbols"),Vg=_R("op-symbols"),pme=_R("wks"),xR=!bR||!bR[Fg]||!bR[Fg].findChild,c3=function(t,r,i){var s=a3(xo,r);s&&delete xo[r],wu(t,r,i),s&&t!==xo&&wu(xo,r,s)},ER=Rp&&Jpe(function(){return Ip(wu({},"a",{get:function(){return wu(this,"a",{value:7}).a}})).a!==7})?c3:wu,SR=function(t,r){var i=Jc[t]=Ip(db);return lme(i,{type:lb,tag:t,description:r}),Rp||(i.description=r),i},ub=function(t,r,i){t===xo&&ub(Vg,r,i),gR(t);var s=vR(r);return gR(i),Si(Jc,s)?(i.enumerable?(Si(t,Da)&&t[Da][s]&&(t[Da][s]=!1),i=Ip(i,{enumerable:yR(0,!1)})):(Si(t,Da)||wu(t,Da,yR(1,Ip(null))),t[Da][s]=!0),ER(t,s,i)):wu(t,s,i)},wR=function(t,r){gR(t);var i=ob(r),s=q4(i).concat(h3(i));return cb(s,function(c){Rp&&!fR(l3,i,c)||ub(t,c,i[c])}),t},l3=function(t){var r=vR(t),i=fR(hme,this,r);return!(this===xo&&Si(Jc,r)&&!Si(Vg,r))&&(!(i||!Si(this,r)||!Si(Jc,r)||Si(this,Da)&&this[Da][r])||i)},d3=function(t,r){var i=ob(t),s=vR(r);if(i!==xo||!Si(Jc,s)||Si(Vg,s)){var c=a3(i,s);return!c||!Si(Jc,s)||Si(i,Da)&&i[Da][s]||(c.enumerable=!0),c}},u3=function(t){var r=s3(ob(t)),i=[];return cb(r,function(s){Si(Jc,s)||Si(t3,s)||o3(i,s)}),i},h3=function(t){var r=t===xo,i=s3(r?Vg:ob(t)),s=[];return cb(i,function(c){!Si(Jc,c)||r&&!Si(xo,c)||o3(s,Jc[c])}),s};Ap||(Su=function(){if(Qpe(db,this))throw new ume("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Zpe(arguments[0]):void 0,r=n3(t),i=function(s){var c=this===void 0?Ug:this;c===xo&&fR(i,Vg,s),Si(c,Da)&&Si(c[Da],r)&&(c[Da][r]=!1);var u=yR(1,s);try{ER(c,r,u)}catch(p){if(!(p instanceof dme))throw p;c3(c,r,u)}};return Rp&&xR&&ER(xo,r,{configurable:!0,set:i}),SR(r,t)},e3(db=Su[Fg],"toString",function(){return i3(this).tag}),e3(Su,"withoutSetter",function(t){return SR(n3(t),t)}),Z4.f=l3,Q4.f=ub,nme.f=wR,J4.f=d3,eme.f=X4.f=u3,tme.f=h3,ame.f=function(t){return SR(ime(t),t)},Rp&&rme(db,"description",{configurable:!0,get:function(){return i3(this).description}})),sb({global:!0,wrap:!0,forced:!Ap,sham:!Ap},{Symbol:Su}),cb(q4(pme),function(t){sme(t)}),sb({target:lb,stat:!0,forced:!Ap},{useSetter:function(){xR=!0},useSimple:function(){xR=!1}}),sb({target:"Object",stat:!0,forced:!Ap,sham:!Rp},{create:function(t,r){return r===void 0?Ip(t):wR(Ip(t),r)},defineProperty:ub,defineProperties:wR,getOwnPropertyDescriptor:d3}),sb({target:"Object",stat:!0,forced:!Ap},{getOwnPropertyNames:u3}),ome(),cme(Su,lb),t3[Da]=!0;var p3=rc&&!!Symbol.for&&!!Symbol.keyFor,mme=Qt,fme=at,gme=ni,vme=ga,m3=tp,yme=p3,TR=m3("string-to-symbol-registry"),_me=m3("symbol-to-string-registry");mme({target:"Symbol",stat:!0,forced:!yme},{for:function(t){var r=vme(t);if(gme(TR,r))return TR[r];var i=fme("Symbol")(r);return TR[r]=i,_me[i]=r,i}});var bme=Qt,xme=ni,Eme=ug,Sme=ep,wme=p3,f3=tp("symbol-to-string-registry");bme({target:"Symbol",stat:!0,forced:!wme},{keyFor:function(t){if(!Eme(t))throw new TypeError(Sme(t)+" is not a symbol");if(xme(f3,t))return f3[t]}});var g3=gg,Tme=pe,v3=q,Cme=ga,y3=S([].push),Nme=Qt,_3=at,b3=V,Rme=he,Bg=S,x3=h,E3=pe,S3=ug,w3=Jl,Ame=function(t){if(Tme(t))return t;if(g3(t)){for(var r=t.length,i=[],s=0;s<r;s++){var c=t[s];typeof c=="string"?y3(i,c):typeof c!="number"&&v3(c)!=="Number"&&v3(c)!=="String"||y3(i,Cme(c))}var u=i.length,p=!0;return function(m,g){if(p)return p=!1,g;if(g3(this))return g;for(var v=0;v<u;v++)if(i[v]===m)return g}}},Ime=rc,Ome=String,rd=_3("JSON","stringify"),hb=Bg(/./.exec),T3=Bg("".charAt),Pme=Bg("".charCodeAt),Dme=Bg("".replace),kme=Bg(1.1.toString),jme=/[\uD800-\uDFFF]/g,C3=/^[\uD800-\uDBFF]$/,N3=/^[\uDC00-\uDFFF]$/,R3=!Ime||x3(function(){var t=_3("Symbol")("stringify detection");return rd([t])!=="[null]"||rd({a:t})!=="{}"||rd(Object(t))!=="{}"}),A3=x3(function(){return rd("\uDF06\uD834")!=='"\\udf06\\ud834"'||rd("\uDEAD")!=='"\\udead"'}),Lme=function(t,r){var i=w3(arguments),s=Ame(r);if(E3(s)||t!==void 0&&!S3(t))return i[1]=function(c,u){if(E3(s)&&(u=Rme(s,this,Ome(c),u)),!S3(u))return u},b3(rd,null,i)},Mme=function(t,r,i){var s=T3(i,r-1),c=T3(i,r+1);return hb(C3,t)&&!hb(N3,c)||hb(N3,t)&&!hb(C3,s)?"\\u"+kme(Pme(t,0),16):t};rd&&Nme({target:"JSON",stat:!0,forced:R3||A3},{stringify:function(t,r,i){var s=w3(arguments),c=b3(R3?Lme:rd,null,s);return A3&&typeof c=="string"?Dme(c,jme,Mme):c}});var I3=vg,Ume=ic;Qt({target:"Object",stat:!0,forced:!rc||h(function(){I3.f(1)})},{getOwnPropertySymbols:function(t){var r=I3.f;return r?r(Ume(t)):[]}}),jr("asyncDispose"),jr("asyncIterator"),jr("dispose"),jr("hasInstance"),jr("isConcatSpreadable"),jr("iterator"),jr("match"),jr("matchAll"),jr("replace"),jr("search"),jr("species"),jr("split");var Fme=z4;jr("toPrimitive"),Fme();var Vme=at,Bme=Yc;jr("toStringTag"),Bme(Vme("Symbol"),"Symbol"),jr("unscopables"),Yc(A.JSON,"JSON",!0);var Gme=ht.Symbol,Wme=Zn,$me=Os.f,O3=Wme("metadata"),P3=Function.prototype;P3[O3]===void 0&&$me(P3,O3,{value:null}),jr("metadata");var Hme=Gme,zme=S,CR=at("Symbol"),Kme=CR.keyFor,Yme=zme(CR.prototype.valueOf),D3=CR.isRegisteredSymbol||function(t){try{return Kme(Yme(t))!==void 0}catch{return!1}};Qt({target:"Symbol",stat:!0},{isRegisteredSymbol:D3});for(var qme=tp,k3=at,Xme=S,Jme=ug,Qme=Zn,pb=k3("Symbol"),j3=pb.isWellKnownSymbol,L3=k3("Object","getOwnPropertyNames"),Zme=Xme(pb.prototype.valueOf),M3=qme("wks"),NR=0,U3=L3(pb),efe=U3.length;NR<efe;NR++)try{var F3=U3[NR];Jme(pb[F3])&&Qme(F3)}catch{}var V3=function(t){if(j3&&j3(t))return!0;try{for(var r=Zme(t),i=0,s=L3(M3),c=s.length;i<c;i++)if(M3[s[i]]==r)return!0}catch{}return!1};Qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:V3}),jr("customMatcher"),jr("observable"),Qt({target:"Symbol",stat:!0},{isRegistered:D3}),Qt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:V3}),jr("matcher"),jr("metadataKey"),jr("patternMatch"),jr("replaceAll");var Op=d(Hme),B3=d(Np.f("iterator"));function Gg(t){return Gg=typeof Op=="function"&&typeof B3=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Op=="function"&&r.constructor===Op&&r!==Op.prototype?"symbol":typeof r},Gg(t)}var tfe=d(Np.f("toPrimitive"));function nfe(t){var r=function(i,s){if(Gg(i)!="object"||!i)return i;var c=i[tfe];if(c!==void 0){var u=c.call(i,s);if(Gg(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}(t,"string");return Gg(r)=="symbol"?r:r+""}function M(t,r,i){return(r=nfe(r))in t?k4(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}var G3=d(Rde),rfe={isBrowser:!0,classes:{URLSearchParams:G3!==void 0?G3:mR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const RR=typeof window<"u"&&typeof document<"u",AR=typeof navigator=="object"&&navigator||void 0,ife=RR&&(!AR||["ReactNative","NativeScript","NS"].indexOf(AR.product)<0),afe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",sfe=RR&&window.location.href||"http://localhost";function W3(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function $3(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?W3(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):W3(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var Xi=$3($3({},Object.freeze({__proto__:null,hasBrowserEnv:RR,hasStandardBrowserEnv:ife,hasStandardBrowserWebWorkerEnv:afe,navigator:AR,origin:sfe})),rfe);function H3(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ofe(t,r){return ab(t,new Xi.classes.URLSearchParams,function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?H3(Object(c),!0).forEach(function(u){M(i,u,c[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):H3(Object(c)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(c,u))})}return i}({visitor:function(i,s,c,u){return Xi.isNode&&je.isBuffer(i)?(this.append(s,i.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},r))}var cfe=lN.charAt,z3=he,lfe=fa,dfe=pe,ufe=q,hfe=/./.exec,pfe=TypeError,mfe=Qt,K3=he,Y3=ue,ffe=IC,mb=E_,q3=xt,X3=zj,Wg=ga,gfe=fa,vfe=Ve,yfe=q,_fe=sC,J3=eR,bfe=hg,xfe=h,Efe=LC,Sfe=function(t,r,i){return r+(i?cfe(t,r).length:1)},wfe=function(t,r){var i=t.exec;if(dfe(i)){var s=z3(i,t,r);return s!==null&&lfe(s),s}if(ufe(t)==="RegExp")return z3(hfe,t,r);throw new pfe("RegExp#exec called on incompatible receiver")},Q3=mu,Tfe=Zn("matchAll"),Z3="RegExp String",eF=Z3+" Iterator",Cfe=Q3.set,Nfe=Q3.getterFor(eF),Rfe=TypeError,IR=Y3("".indexOf),fb=Y3("".matchAll),OR=!!fb&&!xfe(function(){fb("a",/./)}),Afe=ffe(function(t,r,i,s){Cfe(this,{type:eF,regexp:t,string:r,global:i,unicode:s,done:!1})},Z3,function(){var t=Nfe(this);if(t.done)return mb(void 0,!0);var r=t.regexp,i=t.string,s=wfe(r,i);return s===null?(t.done=!0,mb(void 0,!0)):t.global?(Wg(s[0])===""&&(r.lastIndex=Sfe(i,X3(r.lastIndex),t.unicode)),mb(s,!1)):(t.done=!0,mb(s,!1))}),tF=function(t){var r,i,s,c=gfe(this),u=Wg(t),p=Efe(c,RegExp),m=Wg(J3(c));return r=new p(p===RegExp?c.source:c,m),i=!!~IR(m,"g"),s=!!~IR(m,"u"),r.lastIndex=X3(c.lastIndex),new Afe(r,u,i,s)};mfe({target:"String",proto:!0,forced:OR},{matchAll:function(t){var r,i,s,c,u=q3(this);if(vfe(t)){if(_fe(t)&&(r=Wg(q3(J3(t))),!~IR(r,"g")))throw new Rfe("`.matchAll` does not allow non-global regexes");if(OR)return fb(u,t);if((s=bfe(t,Tfe))===void 0&&yfe(t)==="RegExp"&&(s=tF),s)return K3(s,t,u)}else if(OR)return fb(u,t);return i=Wg(u),c=new RegExp(t,"g"),K3(tF,c,i)}});var Ife=as("String","matchAll"),Ofe=N,Pfe=Ife,PR=String.prototype,Dfe=function(t){var r=t.matchAll;return typeof t=="string"||t===PR||Ofe(PR,t)&&r===PR.matchAll?Pfe:r},kfe=d(Dfe);function nF(t){function r(i,s,c,u){let p=i[u++];if(p==="__proto__")return!0;const m=Number.isFinite(+p),g=u>=i.length;return p=!p&&je.isArray(c)?c.length:p,g?(je.hasOwnProp(c,p)?c[p]=[c[p],s]:c[p]=s,!m):(c[p]&&je.isObject(c[p])||(c[p]=[]),r(i,s,c[p],u)&&je.isArray(c[p])&&(c[p]=function(v){const _={},E=Object.keys(v);let w;const C=E.length;let U;for(w=0;w<C;w++)U=E[w],_[U]=v[U];return _}(c[p])),!m)}if(je.isFormData(t)&&je.isFunction(t.entries)){const i={};return je.forEachEntry(t,(s,c)=>{r(function(u){return kfe(je).call(je,/\w+|\[(\w*)]/g,u).map(p=>p[0]==="[]"?"":p[1]||p[0])}(s),c,i,0)}),i}return null}const DR={transitional:I4,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",s=i.indexOf("application/json")>-1,c=je.isObject(t);if(c&&je.isHTMLForm(t)&&(t=new FormData(t)),je.isFormData(t))return s?JSON.stringify(nF(t)):t;if(je.isArrayBuffer(t)||je.isBuffer(t)||je.isStream(t)||je.isFile(t)||je.isBlob(t)||je.isReadableStream(t))return t;if(je.isArrayBufferView(t))return t.buffer;if(je.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return ofe(t,this.formSerializer).toString();if((u=je.isFileList(t))||i.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return ab(u?{"files[]":t}:t,p&&new p,this.formSerializer)}}return c||s?(r.setContentType("application/json",!1),function(p,m,g){if(je.isString(p))try{return(m||JSON.parse)(p),Ei(je).call(je,p)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(p)}(t)):t}],transformResponse:[function(t){const r=this.transitional||DR.transitional,i=r&&r.forcedJSONParsing,s=this.responseType==="json";if(je.isResponse(t)||je.isReadableStream(t))return t;if(t&&je.isString(t)&&(i&&!this.responseType||s)){const c=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?on.from(u,on.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xi.classes.FormData,Blob:Xi.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};je.forEach(["delete","get","head","post","put","patch"],t=>{DR.headers[t]={}});var kR=DR;const jfe=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rF=Symbol("internals");function $g(t){var r;return t&&Ei(r=String(t)).call(r).toLowerCase()}function gb(t){return t===!1||t==null?t:je.isArray(t)?t.map(gb):String(t)}function jR(t,r,i,s,c){return je.isFunction(s)?s.call(this,r,i):(c&&(r=i),je.isString(r)?je.isString(s)?r.indexOf(s)!==-1:je.isRegExp(s)?s.test(r):void 0:void 0)}class vb{constructor(r){r&&this.set(r)}set(r,i,s){const c=this;function u(g,v,_){const E=$g(v);if(!E)throw new Error("header name must be a non-empty string");const w=je.findKey(c,E);(!w||c[w]===void 0||_===!0||_===void 0&&c[w]!==!1)&&(c[w||v]=gb(g))}const p=(g,v)=>je.forEach(g,(_,E)=>u(_,E,v));if(je.isPlainObject(r)||r instanceof this.constructor)p(r,i);else if(je.isString(r)&&(r=Ei(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ei(m=r).call(m)))p((g=>{const v={};let _,E,w;return g&&g.split(`
`).forEach(function(C){var U,k;w=C.indexOf(":"),_=Ei(U=C.substring(0,w)).call(U).toLowerCase(),E=Ei(k=C.substring(w+1)).call(k),!_||v[_]&&jfe[_]||(_==="set-cookie"?v[_]?v[_].push(E):v[_]=[E]:v[_]=v[_]?v[_]+", "+E:E)}),v})(r),i);else if(je.isObject(r)&&je.isIterable(r)){let g,v,_={};for(const E of r){if(!je.isArray(E))throw TypeError("Object iterator must return a key-value pair");_[v=E[0]]=(g=_[v])?je.isArray(g)?[...g,E[1]]:[g,E[1]]:E[1]}p(_,i)}else r!=null&&u(i,r,s);var m;return this}get(r,i){if(r=$g(r)){const s=je.findKey(this,r);if(s){const c=this[s];if(!i)return c;if(i===!0)return function(u){const p=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(u);)p[g[1]]=g[2];return p}(c);if(je.isFunction(i))return i.call(this,c,s);if(je.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=$g(r)){const s=je.findKey(this,r);return!(!s||this[s]===void 0||i&&!jR(0,this[s],s,i))}return!1}delete(r,i){const s=this;let c=!1;function u(p){if(p=$g(p)){const m=je.findKey(s,p);!m||i&&!jR(0,s[m],m,i)||(delete s[m],c=!0)}}return je.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let s=i.length,c=!1;for(;s--;){const u=i[s];r&&!jR(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,s={};return je.forEach(this,(c,u)=>{var p;const m=je.findKey(s,u);if(m)return i[m]=gb(c),void delete i[u];const g=r?function(v){return Ei(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,E,w)=>E.toUpperCase()+w)}(u):Ei(p=String(u)).call(p);g!==u&&delete i[u],i[g]=gb(c),s[g]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return je.forEach(this,(s,c)=>{s!=null&&s!==!1&&(i[c]=r&&je.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,s]=r;return i+": "+s}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c.forEach(p=>i.set(p)),i}static accessor(r){const i=(this[rF]=this[rF]={accessors:{}}).accessors,s=this.prototype;function c(u){const p=$g(u);i[p]||(function(m,g){const v=je.toCamelCase(" "+g);["get","set","has"].forEach(_=>{Object.defineProperty(m,_+v,{value:function(E,w,C){return this[_].call(this,g,E,w,C)},configurable:!0})})}(s,u),i[p]=!0)}return je.isArray(r)?r.forEach(c):c(r),this}}vb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),je.reduceDescriptors(vb.prototype,(t,r)=>{let{value:i}=t,s=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[s]=c}}}),je.freezeMethods(vb);var Eo=vb;function LR(t,r){const i=this||kR,s=r||i,c=Eo.from(s.headers);let u=s.data;return je.forEach(t,function(p){u=p.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function iF(t){return!(!t||!t.__CANCEL__)}function Pp(t,r,i){on.call(this,t??"canceled",on.ERR_CANCELED,r,i),this.name="CanceledError"}function aF(t,r,i){const s=i.config.validateStatus;i.status&&s&&!s(i.status)?r(new on("Request failed with status code "+i.status,[on.ERR_BAD_REQUEST,on.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}je.inherits(Pp,on,{__CANCEL__:!0});const yb=function(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(u,p){u=u||10;const m=new Array(u),g=new Array(u);let v,_=0,E=0;return p=p!==void 0?p:1e3,function(w){const C=Date.now(),U=g[E];v||(v=C),m[_]=w,g[_]=C;let k=E,j=0;for(;k!==_;)j+=m[k++],k%=u;if(_=(_+1)%u,_===E&&(E=(E+1)%u),C-v<p)return;const $=U&&C-U;return $?Math.round(1e3*j/$):void 0}}(50,250);return function(u,p){let m,g,v=0,_=1e3/p;const E=function(w){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),u(...w)};return[function(){const w=Date.now(),C=w-v;for(var U=arguments.length,k=new Array(U),j=0;j<U;j++)k[j]=arguments[j];C>=_?E(k,w):(m=k,g||(g=setTimeout(()=>{g=null,E(m)},_-C)))},()=>m&&E(m)]}(u=>{const p=u.loaded,m=u.lengthComputable?u.total:void 0,g=p-s,v=c(g);s=p,t({loaded:p,total:m,progress:m?p/m:void 0,bytes:g,rate:v||void 0,estimated:v&&m&&p<=m?(m-p)/v:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},sF=(t,r)=>{const i=t!=null;return[s=>r[0]({lengthComputable:i,total:t,loaded:s}),r[1]]},oF=t=>function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return je.asap(()=>t(...i))};var Lfe=Xi.hasStandardBrowserEnv?((t,r)=>i=>(i=new K_(i,Xi.origin),t.protocol===i.protocol&&t.host===i.host&&(r||t.port===i.port)))(new K_(Xi.origin),Xi.navigator&&/(msie|trident)/i.test(Xi.navigator.userAgent)):()=>!0,Mfe=Xi.hasStandardBrowserEnv?{write(t,r,i,s,c,u,p){if(typeof document>"u")return;const m=["".concat(t,"=").concat(encodeURIComponent(r))];je.isNumber(i)&&m.push("expires=".concat(new Date(i).toUTCString())),je.isString(s)&&m.push("path=".concat(s)),je.isString(c)&&m.push("domain=".concat(c)),u===!0&&m.push("secure"),je.isString(p)&&m.push("SameSite=".concat(p)),document.cookie=m.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function cF(t,r,i){let s=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(s||i==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(t,r):r}function lF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function MR(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?lF(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):lF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const dF=t=>t instanceof Eo?MR({},t):t;function Tu(t,r){r=r||{};const i={};function s(v,_,E,w){return je.isPlainObject(v)&&je.isPlainObject(_)?je.merge.call({caseless:w},v,_):je.isPlainObject(_)?je.merge({},_):je.isArray(_)?_.slice():_}function c(v,_,E,w){return je.isUndefined(_)?je.isUndefined(v)?void 0:s(void 0,v,0,w):s(v,_,0,w)}function u(v,_){if(!je.isUndefined(_))return s(void 0,_)}function p(v,_){return je.isUndefined(_)?je.isUndefined(v)?void 0:s(void 0,v):s(void 0,_)}function m(v,_,E){return E in r?s(v,_):E in t?s(void 0,v):void 0}const g={url:u,method:u,data:u,baseURL:p,transformRequest:p,transformResponse:p,paramsSerializer:p,timeout:p,timeoutMessage:p,withCredentials:p,withXSRFToken:p,adapter:p,responseType:p,xsrfCookieName:p,xsrfHeaderName:p,onUploadProgress:p,onDownloadProgress:p,decompress:p,maxContentLength:p,maxBodyLength:p,beforeRedirect:p,transport:p,httpAgent:p,httpsAgent:p,cancelToken:p,socketPath:p,responseEncoding:p,validateStatus:m,headers:(v,_,E)=>c(dF(v),dF(_),0,!0)};return je.forEach(Object.keys(MR(MR({},t),r)),function(v){const _=g[v]||c,E=_(t[v],r[v],v);je.isUndefined(E)&&_!==m||(i[v]=E)}),i}var uF=t=>{const r=Tu({},t);let{data:i,withXSRFToken:s,xsrfHeaderName:c,xsrfCookieName:u,headers:p,auth:m}=r;if(r.headers=p=Eo.from(p),r.url=R4(cF(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),m&&p.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),je.isFormData(i)){if(Xi.hasStandardBrowserEnv||Xi.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if(je.isFunction(i.getHeaders)){const g=i.getHeaders(),v=["content-type","content-length"];Object.entries(g).forEach(_=>{let[E,w]=_;Ne(v).call(v,E.toLowerCase())&&p.set(E,w)})}}if(Xi.hasStandardBrowserEnv&&(s&&je.isFunction(s)&&(s=s(r)),s||s!==!1&&Lfe(r.url))){const g=c&&u&&Mfe.read(u);g&&p.set(c,g)}return r},Ufe=typeof XMLHttpRequest<"u"&&function(t){return new Pe(function(r,i){const s=uF(t);let c=s.data;const u=Eo.from(s.headers).normalize();let p,m,g,v,_,{responseType:E,onUploadProgress:w,onDownloadProgress:C}=s;function U(){v&&v(),_&&_(),s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let k=new XMLHttpRequest;function j(){if(!k)return;const K=Eo.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders());aF(function(J){r(J),U()},function(J){i(J),U()},{data:E&&E!=="text"&&E!=="json"?k.response:k.responseText,status:k.status,statusText:k.statusText,headers:K,config:t,request:k}),k=null}k.open(s.method.toUpperCase(),s.url,!0),k.timeout=s.timeout,"onloadend"in k?k.onloadend=j:k.onreadystatechange=function(){k&&k.readyState===4&&(k.status!==0||k.responseURL&&k.responseURL.indexOf("file:")===0)&&setTimeout(j)},k.onabort=function(){k&&(i(new on("Request aborted",on.ECONNABORTED,t,k)),k=null)},k.onerror=function(K){const J=new on(K&&K.message?K.message:"Network Error",on.ERR_NETWORK,t,k);J.event=K||null,i(J),k=null},k.ontimeout=function(){let K=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const J=s.transitional||I4;s.timeoutErrorMessage&&(K=s.timeoutErrorMessage),i(new on(K,J.clarifyTimeoutError?on.ETIMEDOUT:on.ECONNABORTED,t,k)),k=null},c===void 0&&u.setContentType(null),"setRequestHeader"in k&&je.forEach(u.toJSON(),function(K,J){k.setRequestHeader(J,K)}),je.isUndefined(s.withCredentials)||(k.withCredentials=!!s.withCredentials),E&&E!=="json"&&(k.responseType=s.responseType),C&&([g,_]=yb(C,!0),k.addEventListener("progress",g)),w&&k.upload&&([m,v]=yb(w),k.upload.addEventListener("progress",m),k.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(p=K=>{k&&(i(!K||K.type?new Pp(null,t,k):K),k.abort(),k=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const $=function(K){const J=/^([-+\w]{1,25})(:?\/\/|:)/.exec(K);return J&&J[1]||""}(s.url);$&&Xi.protocols.indexOf($)===-1?i(new on("Unsupported protocol "+$+":",on.ERR_BAD_REQUEST,t)):k.send(c||null)})},Ffe=(t,r)=>{const{length:i}=t=t?t.filter(Boolean):[];if(r||i){let s,c=new AbortController;const u=function(v){if(!s){s=!0,m();const _=v instanceof Error?v:this.reason;c.abort(_ instanceof on?_:new Pp(_ instanceof Error?_.message:_))}};let p=r&&setTimeout(()=>{p=null,u(new on("timeout ".concat(r," of ms exceeded"),on.ETIMEDOUT))},r);const m=()=>{t&&(p&&clearTimeout(p),p=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),t=null)};t.forEach(v=>v.addEventListener("abort",u));const{signal:g}=c;return g.unsubscribe=()=>je.asap(m),g}},UR=d(qM),hF=Np.f("asyncIterator"),Vfe=d(hF);function FR(t,r){this.v=t,this.k=r}function ki(t){return function(){return new Hg(t.apply(this,arguments))}}function Hg(t){var r,i;function s(u,p){try{var m=t[u](p),g=m.value,v=g instanceof FR;UR.resolve(v?g.v:g).then(function(_){if(v){var E=u==="return"?"return":"next";if(!g.k||_.done)return s(E,_);_=t[E](_).value}c(m.done?"return":"normal",_)},function(_){s("throw",_)})}catch(_){c("throw",_)}}function c(u,p){switch(u){case"return":r.resolve({value:p,done:!0});break;case"throw":r.reject(p);break;default:r.resolve({value:p,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(u,p){return new UR(function(m,g){var v={key:u,arg:p,resolve:m,reject:g,next:null};i?i=i.next=v:(r=i=v,s(u,p))})},typeof t.return!="function"&&(this.return=void 0)}function Ct(t){return new FR(t,0)}function Dp(t){var r={},i=!1;function s(c,u){return i=!0,u=new UR(function(p){p(t[c](u))}),{done:!1,value:new FR(u,1)}}return r[Op!==void 0&&B3||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):s("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return i?(i=!1,c):s("return",c)}),r}Hg.prototype[typeof Op=="function"&&Vfe||"@@asyncIterator"]=function(){return this},Hg.prototype.next=function(t){return this._invoke("next",t)},Hg.prototype.throw=function(t){return this._invoke("throw",t)},Hg.prototype.return=function(t){return this._invoke("return",t)};var _b=d(hF);function VR(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=_b,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new bb(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function bb(t){function r(i){if(Object(i)!==i)return Pe.reject(new TypeError(i+" is not an object."));var s=i.done;return Pe.resolve(i.value).then(function(c){return{value:c,done:s}})}return bb=function(i){this.s=i,this.n=i.next},bb.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Pe.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Pe.reject(i):r(s.apply(this.s,arguments))}},new bb(t)}const Bfe=function*(t,r){let i=t.byteLength;if(!r||i<r)return void(yield t);let s,c=0;for(;c<i;)s=c+r,yield t.slice(c,s),c=s},Gfe=function(){var t=ki(function*(r,i){var s,c=!1,u=!1;try{for(var p,m=VR(Wfe(r));c=!(p=yield Ct(m.next())).done;c=!1){const g=p.value;yield*Dp(VR(Bfe(g,i)))}}catch(g){u=!0,s=g}finally{try{c&&m.return!=null&&(yield Ct(m.return()))}finally{if(u)throw s}}});return function(r,i){return t.apply(this,arguments)}}(),Wfe=function(){var t=ki(function*(r){if(r[_b])return void(yield*Dp(VR(r)));const i=r.getReader();try{for(;;){const{done:s,value:c}=yield Ct(i.read());if(s)break;yield c}}finally{yield Ct(i.cancel())}});return function(r){return t.apply(this,arguments)}}(),pF=(t,r,i,s)=>{const c=Gfe(t,r);let u,p=0,m=g=>{u||(u=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:v,value:_}=await c.next();if(v)return m(),void g.close();let E=_.byteLength;if(i){let w=p+=E;i(w)}g.enqueue(new Uint8Array(_))}catch(v){throw m(v),v}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function mF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function fF(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?mF(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):mF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const{isFunction:xb}=je,$fe=(t=>{let{Request:r,Response:i}=t;return{Request:r,Response:i}})(je.global),{ReadableStream:gF,TextEncoder:vF}=je.global,yF=function(t){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return!!t(...i)}catch{return!1}},Hfe=t=>{t=je.merge.call({skipUndefined:!0},$fe,t);const{fetch:r,Request:i,Response:s}=t,c=r?xb(r):typeof fetch=="function",u=xb(i),p=xb(s);if(!c)return!1;const m=c&&xb(gF),g=c&&(typeof vF=="function"?(v=new vF,U=>v.encode(U)):async U=>new Uint8Array(await new i(U).arrayBuffer()));var v;const _=u&&m&&yF(()=>{let U=!1;const k=new i(Xi.origin,{body:new gF,method:"POST",get duplex(){return U=!0,"half"}}).headers.has("Content-Type");return U&&!k}),E=p&&m&&yF(()=>je.isReadableStream(new s("").body)),w={stream:E&&(U=>U.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(U=>{!w[U]&&(w[U]=(k,j)=>{let $=k&&k[U];if($)return $.call(k);throw new on("Response type '".concat(U,"' is not supported"),on.ERR_NOT_SUPPORT,j)})});const C=async(U,k)=>{const j=je.toFiniteNumber(U.getContentLength());return j??(async $=>$==null?0:je.isBlob($)?$.size:je.isSpecCompliantForm($)?(await new i(Xi.origin,{method:"POST",body:$}).arrayBuffer()).byteLength:je.isArrayBufferView($)||je.isArrayBuffer($)?$.byteLength:(je.isURLSearchParams($)&&($+=""),je.isString($)?(await g($)).byteLength:void 0))(k)};return async U=>{let{url:k,method:j,data:$,signal:K,cancelToken:J,timeout:ne,onDownloadProgress:ae,onUploadProgress:ee,responseType:oe,headers:ve,withCredentials:Ee="same-origin",fetchOptions:Be}=uF(U),mt=r||fetch;oe=oe?(oe+"").toLowerCase():"text";let ct=Ffe([K,J&&J.toAbortSignal()],ne),Tt=null;const Et=ct&&ct.unsubscribe&&(()=>{ct.unsubscribe()});let Yt;try{if(ee&&_&&j!=="get"&&j!=="head"&&(Yt=await C(ve,$))!==0){let D,X=new i(k,{method:"POST",body:$,duplex:"half"});if(je.isFormData($)&&(D=X.headers.get("content-type"))&&ve.setContentType(D),X.body){const[te,Ae]=sF(Yt,yb(oF(ee)));$=pF(X.body,65536,te,Ae)}}je.isString(Ee)||(Ee=Ee?"include":"omit");const Tn=u&&"credentials"in i.prototype,_e=fF(fF({},Be),{},{signal:ct,method:j.toUpperCase(),headers:ve.normalize().toJSON(),body:$,duplex:"half",credentials:Tn?Ee:void 0});Tt=u&&new i(k,_e);let Oe=await(u?mt(Tt,Be):mt(k,_e));const He=E&&(oe==="stream"||oe==="response");if(E&&(ae||He&&Et)){const D={};["status","statusText","headers"].forEach(yt=>{D[yt]=Oe[yt]});const X=je.toFiniteNumber(Oe.headers.get("content-length")),[te,Ae]=ae&&sF(X,yb(oF(ae),!0))||[];Oe=new s(pF(Oe.body,65536,te,()=>{Ae&&Ae(),Et&&Et()}),D)}oe=oe||"text";let xe=await w[je.findKey(w,oe)||"text"](Oe,U);return!He&&Et&&Et(),await new Pe((D,X)=>{aF(D,X,{data:xe,headers:Eo.from(Oe.headers),status:Oe.status,statusText:Oe.statusText,config:U,request:Tt})})}catch(Tn){throw Et&&Et(),Tn&&Tn.name==="TypeError"&&/Load failed|fetch/i.test(Tn.message)?Object.assign(new on("Network Error",on.ERR_NETWORK,U,Tt),{cause:Tn.cause||Tn}):on.from(Tn,Tn&&Tn.code,U,Tt)}}},zfe=new Map,_F=t=>{let r=t&&t.env||{};const{fetch:i,Request:s,Response:c}=r,u=[s,c,i];let p,m,g=u.length,v=zfe;for(;g--;)p=u[g],m=v.get(p),m===void 0&&v.set(p,m=g?new Map:Hfe(r)),v=m;return m};_F();const BR={http:null,xhr:Ufe,fetch:{get:_F}};je.forEach(BR,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const bF=t=>"- ".concat(t),Kfe=t=>je.isFunction(t)||t===null||t===!1;var xF={getAdapter:function(t,r){t=je.isArray(t)?t:[t];const{length:i}=t;let s,c;const u={};for(let p=0;p<i;p++){let m;if(s=t[p],c=s,!Kfe(s)&&(c=BR[(m=String(s)).toLowerCase()],c===void 0))throw new on("Unknown adapter '".concat(m,"'"));if(c&&(je.isFunction(c)||(c=c.get(r))))break;u[m||"#"+p]=c}if(!c){const p=Object.entries(u).map(m=>{let[g,v]=m;return"adapter ".concat(g," ")+(v===!1?"is not supported by the environment":"is not available in the build")});throw new on("There is no suitable adapter to dispatch the request "+(i?p.length>1?`since :
`+p.map(bF).join(`
`):" "+bF(p[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:BR};function GR(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Pp(null,t)}function EF(t){return GR(t),t.headers=Eo.from(t.headers),t.data=LR.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),xF.getAdapter(t.adapter||kR.adapter,t)(t).then(function(r){return GR(t),r.data=LR.call(t,t.transformResponse,r),r.headers=Eo.from(r.headers),r},function(r){return iF(r)||(GR(t),r&&r.response&&(r.response.data=LR.call(t,t.transformResponse,r.response),r.response.headers=Eo.from(r.response.headers))),Pe.reject(r)})}const SF="1.13.2",Eb={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{Eb[t]=function(i){return typeof i===t||"a"+(r<1?"n ":" ")+t}});const wF={};Eb.transitional=function(t,r,i){function s(c,u){return"[Axios v"+SF+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,p)=>{if(t===!1)throw new on(s(u," has been removed"+(r?" in "+r:"")),on.ERR_DEPRECATED);return r&&!wF[u]&&(wF[u]=!0,console.warn(s(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,p)}},Eb.spelling=function(t){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(t)),!0)};var Sb={assertOptions:function(t,r,i){if(typeof t!="object")throw new on("options must be an object",on.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let c=s.length;for(;c-- >0;){const u=s[c],p=r[u];if(p){const m=t[u],g=m===void 0||p(m,u,t);if(g!==!0)throw new on("option "+u+" must be "+g,on.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new on("Unknown option "+u,on.ERR_BAD_OPTION)}},validators:Eb};const cc=Sb.validators;let wb=class{constructor(t){this.defaults=t||{},this.interceptors={request:new A4,response:new A4}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=Tu(this.defaults,r);const{transitional:i,paramsSerializer:s,headers:c}=r;i!==void 0&&Sb.assertOptions(i,{silentJSONParsing:cc.transitional(cc.boolean),forcedJSONParsing:cc.transitional(cc.boolean),clarifyTimeoutError:cc.transitional(cc.boolean)},!1),s!=null&&(je.isFunction(s)?r.paramsSerializer={serialize:s}:Sb.assertOptions(s,{encode:cc.function,serialize:cc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Sb.assertOptions(r,{baseUrl:cc.spelling("baseURL"),withXsrfToken:cc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&je.merge(c.common,c[r.method]);c&&je.forEach(["delete","get","head","post","put","patch","common"],C=>{delete c[C]}),r.headers=Eo.concat(u,c);const p=[];let m=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(r)===!1||(m=m&&C.synchronous,p.unshift(C.fulfilled,C.rejected))});const g=[];let v;this.interceptors.response.forEach(function(C){g.push(C.fulfilled,C.rejected)});let _,E=0;if(!m){const C=[EF.bind(this),void 0];for(C.unshift(...p),C.push(...g),_=C.length,v=Pe.resolve(r);E<_;)v=v.then(C[E++],C[E++]);return v}_=p.length;let w=r;for(;E<_;){const C=p[E++],U=p[E++];try{w=C(w)}catch(k){U.call(this,k);break}}try{v=EF.call(this,w)}catch(C){return Pe.reject(C)}for(E=0,_=g.length;E<_;)v=v.then(g[E++],g[E++]);return v}getUri(t){return R4(cF((t=Tu(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};je.forEach(["delete","get","head","options"],function(t){wb.prototype[t]=function(r,i){return this.request(Tu(i||{},{method:t,url:r,data:(i||{}).data}))}}),je.forEach(["post","put","patch"],function(t){function r(i){return function(s,c,u){return this.request(Tu(u||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}wb.prototype[t]=r(),wb.prototype[t+"Form"]=r(!0)});var Tb=wb;class WR{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Pe(function(c){i=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](c);s._listeners=null}),this.promise.then=c=>{let u;const p=new Pe(m=>{s.subscribe(m),u=m}).then(c);return p.cancel=function(){s.unsubscribe(u)},p},r(function(c,u,p){s.reason||(s.reason=new Pp(c,u,p),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=s=>{r.abort(s)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new WR(function(s){r=s}),cancel:r}}}var Yfe=WR;const $R={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries($R).forEach(t=>{let[r,i]=t;$R[i]=r});var qfe=$R;const ri=function t(r){const i=new Tb(r),s=u4(Tb.prototype.request,i);return je.extend(s,Tb.prototype,i,{allOwnKeys:!0}),je.extend(s,i,null,{allOwnKeys:!0}),s.create=function(c){return t(Tu(r,c))},s}(kR);ri.Axios=Tb,ri.CanceledError=Pp,ri.CancelToken=Yfe,ri.isCancel=iF,ri.VERSION=SF,ri.toFormData=ab,ri.AxiosError=on,ri.Cancel=ri.CanceledError,ri.all=function(t){return Pe.all(t)},ri.spread=function(t){return function(r){return t.apply(null,r)}},ri.isAxiosError=function(t){return je.isObject(t)&&t.isAxiosError===!0},ri.mergeConfig=Tu,ri.AxiosHeaders=Eo,ri.formToJSON=t=>nF(je.isHTMLForm(t)?new FormData(t):t),ri.getAdapter=xF.getAdapter,ri.HttpStatusCode=qfe,ri.default=ri;var ji=ri;const Xfe=()=>{};function zg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Xfe};return t.promise=new Pe((r,i)=>{t.resolve=s=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(s),t.value=s)},t.reject=s=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,i(s))}}),t}const Cb=new Map,Nb=new Map,lc=new Map;let gr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),zt=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const TF=new Ohe;let So=TF.getResult(),HR=null;function $t(t){if(!HR){So=TF.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return zt.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return zt.CHROME;case"Safari":case"Mobile Safari":return zt.SAFARI;case"Edge":return zt.EDGE;case"Firefox":return zt.FIREFOX;case"QQ":case"QQBrowser":return zt.QQ;case"Opera":return zt.OPERA;case"WeChat":return zt.WECHAT;default:return m.browser.name||""}}(So),i=CF(So),s=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(So),c=So.os.version,u=CF(So,!1),p=So.device.type;if(!(r&&i&&s&&c))return{name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:p};HR={name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:p}}return HR}function CF(t){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",i?r.split(".")[0]:r}function Rb(){return $t().os}function NF(){const t=$t();return"".concat(t.os," ").concat(t.osVersion)}function Ab(){const t=$t();return!!(So.engine.name==="WebKit"&&t.os===gr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==zt.SAFARI||ii()&&t.name!==zt.SAFARI)}function Qc(){return $t().name===zt.CHROME}function Cr(){return $t().name===zt.SAFARI}function RF(){const t=$t();if(t.name!==zt.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function AF(){return $t().name===zt.EDGE}function _n(){return $t().name===zt.FIREFOX}function ii(){return $t().os===gr.IOS}function wo(t){const r=$t();return!(r.name!==zt.CHROME||!r.osVersion)&&Number(r.version)>=t}function IF(t){const r=$t();return!(r.name!==zt.CHROME||!r.osVersion)&&Number(r.version)<t}function zR(t,r,i){const s=$t();return!(s.name!==t||!s.osVersion)&&(i?Number(s.version)>=r&&Number(s.version)<=i:Number(s.version)===r)}function id(t){const r=$t();return!(r.name!==zt.EDGE||!r.osVersion)&&Number(r.version)>=t}function KR(t){const r=$t();return!(r.name!==zt.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function OF(t){const r=$t();return!(r.name!==zt.SAFARI||!r.osVersion)&&Number(r.version)>=t}function PF(t,r,i){const s=$t();if(s.os!==gr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function DF(t,r,i){const s=$t();if(s.os!==gr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function YR(t,r,i){const s=$t();if(s.name!==zt.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function Cu(t){const r=$t();return!(r.name!==zt.OPERA||!r.osVersion)&&Number(r.version)>=t}function kF(){const t=$t();if(t.os!==gr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function kp(){const t=$t();if(t.os!==gr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function qR(){const t=$t();if(t.os!==gr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function jF(){const t=$t();if(t.os!==gr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Us(){return Cr()&&navigator.maxTouchPoints>0}function LF(){return $t().name===zt.WECHAT}function MF(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function UF(){const t=Rb();return function(){const{deviceType:r}=$t();return r==="mobile"||r==="tablet"}()||t===gr.ANDROID||t===gr.IOS||t===gr.HARMONY_OS}function dc(){const t=$t();return t.name!==zt.EDGE&&t.name!==zt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Kg(){return Rb()===gr.ANDROID}function Yg(){const t=$t();return Kg()&&(t.name===zt.CHROME||t.name===zt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function _t(t,r,i){return(r=function(s){var c=function(u,p){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function FF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ie(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?FF(Object(i),!0).forEach(function(s){_t(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):FF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let H=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),me=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),_t(this,"code",void 0),_t(this,"message",void 0),_t(this,"data",void 0),_t(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Fs(t,r){if(typeof t!="boolean")throw new me(H.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function zn(t,r,i){if(!Ne(i).call(i,t))throw new me(H.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function cn(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<i||t>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new me(H.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function XR(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new me(H.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&cn(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&cn(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&cn(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&cn(t.ideal,"".concat(r,".ideal"),1,1/0)}else cn(t,r,1,1/0)}function Lr(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new me(H.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!VF(t,i,s,c))throw new me(H.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function Zc(t,r){if(!Array.isArray(t))throw new me(H.INVALID_PARAMS,"".concat(r," should be an array"))}function On(t){return t==null}function VF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=i&&t.length>=r&&(!s||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const p=c.charCodeAt(u);if(p<0||p>255)return!1}return!0}(t))}function BF(t,r,i){if("getBigUint64"in DataView.prototype)return t.getBigUint64(r,i);const s=t.getUint32(r,i),c=t.getUint32(r+4,i),u=0,p=+!i;return BigInt(s*p+c*u)<<BigInt(32)|BigInt(s*u+c*p)}function GF(t,r,i,s){if("setBigUint64"in DataView.prototype)return t.setBigUint64(r,i,s);const c=Number(i>>BigInt(32)),u=Number(i&BigInt(4294967295));t.setUint32(r,c,s),t.setUint32(r+4,u,s)}var qg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(qg||{}),JR=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(JR||{});const WF=new class{constructor(){_t(this,"_clientSize",null),_t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_t(this,"getStyle",t=>window.getComputedStyle(t,null)),_t(this,"checkCssVisibleProperty",t=>{var r;let i=!0;const s=this.getStyle(t),{display:c,visibility:u,opacity:p,filter:m}=s;return(c==="none"||Ne(r=["hidden","collapse"]).call(r,u)||Number(p)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(g=>{var v;const _=g.split("(")[0];return Ne(v=["brightness","blur","opacity"]).call(v,_)}).map(g=>{const[v,_]=g.split(/\(|\)/);return[v,Number(_.match(/^[0-9\.]+/))]}).forEach(g=>{const[v,_]=g;switch(v){case"brightness":(_<.1||_>3)&&(i=!1);break;case"blur":_>3&&(i=!1);break;case"opacity":_<.1&&(i=!1)}}),i)}),_t(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let i=!0,s=!0;const c=p=>r(p);let u=t;for(;u&&s;)c(u)||(i=!1,s=!1),u=u.parentElement,u||(s=!1);return i}),_t(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),_t(this,"getSizeAboutClient",t=>{const{width:r,height:i,left:s,right:c,top:u,bottom:p}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:i,left:s,right:c,top:u,bottom:p,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),_t(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(t,r,i)}),_t(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),_t(this,"checkCoverForAPoint",(t,r,i)=>{const s=this.elementFromPoint(t,r);return s!==null&&s!==i}),_t(this,"getPointPositionList",()=>{const{width:t,height:r,left:i,top:s}=this._clientSize,c=t/6,u=r/6,p=[],m=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const _=(i*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,E=(s*m+(v===0?.1:v===4?(u*v*m-1e5)/m:u*v)*m)/m;p.push({x:_,y:E})}return[...p]}),_t(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),_t(this,"checkSizeIsVisible",(t,r,i)=>(t>50||i/t<=10)&&(r>50||i/r<=10)),_t(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:i,bottom:s,clientHeight:c,clientWidth:u,clientMin:p}=this._clientSize;let m,g,v,_;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(g=r<u?r:u,i<0)v=0;else{if(!(i<c))return!1;v=i}if(s<0)return!1;_=s<c?s:c;const E=g-m,w=_-v;return this.checkSizeIsVisible(E,w,p)}),_t(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),_t(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(qg.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(qg.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(qg.SIZE)}}return this.returnHiddenResult(qg.STYLE)}return this.returnHiddenResult(JR.UNMOUNTED)}return this.returnHiddenResult(JR.INVALID_HTML_ELEMENT)}),_t(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function QR(t){return new TextEncoder().encode(t)}const $F=function(t,r){const i=new Uint8Array(t.byteLength+r.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(r),t.byteLength),i},ZR=async t=>function(r,i){let s="";return new Uint8Array(r).forEach(c=>{s+=c.toString(i).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",QR(t)),16);let Nn=class{constructor(){_t(this,"_events",{}),_t(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,r);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const p=r[u];p.once&&this.off(t,p.listener),p.listener.apply(this,s||[])}}safeEmit(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}},Xg=null;function HF(){if(Xg)return Xg;if(window.electron)return Xg=window.electron;if(!window.require)return null;try{return Xg=window.require("electron"),Xg}catch{return null}}let Sn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t.VOS_FALLBACK_CN="vosFallbackCN",t.DATACHANNEL_FAILBACK="datachannelFailback",t}({}),ln=function(t){return t.TRACER="tracer",t}({});function zF(t){return cn(t.timeout,"config.timeout",0,1e5),cn(t.timeoutFactor,"config.timeoutFactor",0,100,!1),cn(t.maxRetryCount,"config.maxRetryConfig",0,1/0),cn(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Jfe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),jt=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.FALLBACK_TO_HLS="FALLBACK_TO_HLS",t.UID_CONFLICT="UID_CONFLICT",t}({});function Nu(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function KF(t){return Lr(t.turnServerURL,"turnServerURL"),Lr(t.username,"username"),Lr(t.password,"password"),t.udpport&&cn(t.udpport,"udpport",1,99999,!0),t.forceturn&&Fs(t.forceturn,"forceturn"),t.security&&Fs(t.security,"security"),t.tcpport&&cn(t.tcpport,"tcpport",1,99999,!0),!0}let jp=function(t){return t[t.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",t[t.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",t[t.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",t}({});function eA(t){return t.level!==void 0&&zn(t.level,"level",[1,2,3]),t.delay!==void 0&&cn(t.delay,"delay",0,3e3,!0),!0}let Ot=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t.FALLBACK_TO_HLS="fallback-to-hls",t.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",t.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",t.AV1_DECODABLE_RESULT="av1-decodable-result",t}({}),tA=function(t){return t.CONFIG="config",t.VOSERROR="vos_error",t.AP_ERROR="ap_error",t}({}),Wr=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),wi=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Ru=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function er(t,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return t.getListeners(r).length===0?Pe.reject(new me(H.UNEXPECTED_ERROR,"can not emit promise")):new Pe((u,p)=>{t.emit(r,...s,u,p)})}function pn(t,r){if(t.getListeners(r).length===0)return Pe.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return er(t,r,...s)}function ba(t,r){if(t.getListeners(r).length===0)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return Au(t,r,...s)}function Au(t,r){let i=null,s=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),p=2;p<c;p++)u[p-2]=arguments[p];if(t.emit(r,...u,m=>{i=m},m=>{s=m}),s!==null)throw s;if(i===null)throw new me(H.UNEXPECTED_ERROR,"handler is not sync");return i}const Pn=new class extends Nn{set networkState(t){this.emit(Ru.NETWORK_STATE_CHANGE,t,this._networkState),t===wi.ONLINE?this.emit(Ru.ONLINE):t===wi.OFFLINE&&(this.onlineWaiter=new Pe(r=>{this.once(Ru.ONLINE,()=>{this.onlineWaiter=void 0,r(wi.ONLINE)})}),this.emit(Ru.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===wi.ONLINE}constructor(){super(),_t(this,"_moduleName","network-indicator"),_t(this,"_networkState",wi.ONLINE),_t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wi.OFFLINE})}},Li=[];for(let t=0;t<256;++t)Li.push((t+256).toString(16).slice(1));const YF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let nA;const Qfe=new Uint8Array(16);function Zfe(){return YF?YF():function(i,s,c){var u,p,m,g;const v=(u=(p=(i=i||{}).random)!==null&&p!==void 0?p:(m=(g=i).rng)===null||m===void 0?void 0:m.call(g))!==null&&u!==void 0?u:function(){if(!nA){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");nA=crypto.getRandomValues.bind(crypto)}return nA(Qfe)}();if(v.length<16)throw new Error("Random bytes length must be >= 16");if(v[6]=15&v[6]|64,v[8]=63&v[8]|128,s){if((c=c||0)<0||c+16>s.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let _=0;_<16;++_)s[c+_]=v[_];return s}return function(_){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Li[_[E+0]]+Li[_[E+1]]+Li[_[E+2]]+Li[_[E+3]]+"-"+Li[_[E+4]]+Li[_[E+5]]+"-"+Li[_[E+6]]+Li[_[E+7]]+"-"+Li[_[E+8]]+Li[_[E+9]]+"-"+Li[_[E+10]]+Li[_[E+11]]+Li[_[E+12]]+Li[_[E+13]]+Li[_[E+14]]+Li[_[E+15]]).toLowerCase()}(v)}(t,r,void 0);var t,r}function Ib(t,r){const i=t.indexOf(r);i!==-1&&t.splice(i,1)}function Lp(t){const r=[];return t.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function Ob(t){Pe!==void 0?Pe.resolve().then(t):setTimeout(t,0)}function bn(t){return JSON.parse(JSON.stringify(t))}function Iu(t){try{return bn(t)}catch{return t}}const qF={};function ad(t,r){qF[r]||(qF[r]=!0,t())}function Ou(t){const r=window.atob(t),i=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)i[s]=r.charCodeAt(s);return i}function sd(t){let r="";for(let i=0;i<t.length;i+=1)r+=String.fromCharCode(t[i]);return window.btoa(r)}function XF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(t);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const s=new Uint8Array(r);s.set(i),i=s}return i}function JF(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=ss(r).call(r,(p,m)=>p+m.length,0),c=new Uint8Array(new ArrayBuffer(s));let u=0;return r.forEach(p=>{c.set(p,u),u+=p.length}),c}function uc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function QF(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(i=>{r+=typeof i=="string"?uc(i):i.size}),r+138}function ege(t){const r=new me(H.TIMEOUT,"timeout");return new Pe((i,s)=>{window.setTimeout(()=>s(r),t)})}function vr(t){return new Pe(r=>{window.setTimeout(r,t)})}function Zt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+Zt(t-i.length,"")}function Pu(){let t,r=!1;try{var i;t=Ihe(i=Zfe()).call(i,"-","")}catch{r=!0}return!r&&t&&t.length===32||(t=Zt(32,"")),t.toUpperCase()}const Jg=()=>{},ZF=new class{constructor(){_t(this,"fnMap",new Map)}throttleByKey(t,r,i,s){for(var c=arguments.length,u=new Array(c>4?c-4:0),p=4;p<c;p++)u[p-4]=arguments[p];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:g,args:u,skipFn:s})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,Ie(Ie({},m),{},{fn:t,args:u,skipFn:s}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:m,args:u,skipFn:s})}}},eV=ZF.throttleByKey.bind(ZF);function tV(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function rA(t,r){if(!tV(t)||!tV(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const i=[...t];for(let s=0;s<r.length;s++)i[s]=rA(t[s],r[s]);return i}{const i=Ie({},t);for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(Object.prototype.hasOwnProperty.call(t,s)?i[s]=rA(t[s],r[s]):i[s]=r[s]);return i}}function nV(t,r){let i=[0];if(i=new Array(r).fill(0),t===0)return i;let s=0;for(;t>0&&(i[s]=255&t,t>>=8,s++,s!==r););return i}function Mp(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function iA(t,r){try{return typeof t=="object"&&typeof r=="object"&&JSON.stringify(t)===JSON.stringify(r)}catch{return!1}}function aA(t){return ss(t).call(t,(r,i)=>r+i,0)}function rV(t){const r="0123456789abcdef";function i(J){let ne,ae="";for(ne=0;ne<=3;ne++)ae+=r.charAt(J>>8*ne+4&15)+r.charAt(J>>8*ne&15);return ae}function s(J,ne){const ae=(65535&J)+(65535&ne);return(J>>16)+(ne>>16)+(ae>>16)<<16|65535&ae}function c(J,ne,ae,ee,oe,ve){return s(function(Ee,Be){return Ee<<Be|Ee>>>32-Be}(s(s(ne,J),s(ee,ve)),oe),ae)}function u(J,ne,ae,ee,oe,ve,Ee){return c(ne&ae|~ne&ee,J,ne,oe,ve,Ee)}function p(J,ne,ae,ee,oe,ve,Ee){return c(ne&ee|ae&~ee,J,ne,oe,ve,Ee)}function m(J,ne,ae,ee,oe,ve,Ee){return c(ne^ae^ee,J,ne,oe,ve,Ee)}function g(J,ne,ae,ee,oe,ve,Ee){return c(ae^(ne|~ee),J,ne,oe,ve,Ee)}const v=function(J){let ne;const ae=1+(J.length+8>>6),ee=new Array(16*ae);for(ne=0;ne<16*ae;ne++)ee[ne]=0;for(ne=0;ne<J.length;ne++)ee[ne>>2]|=J.charCodeAt(ne)<<ne%4*8;return ee[ne>>2]|=128<<ne%4*8,ee[16*ae-2]=8*J.length,ee}(t);let _,E,w,C,U,k=1732584193,j=-271733879,$=-1732584194,K=271733878;for(_=0;_<v.length;_+=16)E=k,w=j,C=$,U=K,k=u(k,j,$,K,v[_+0],7,-680876936),K=u(K,k,j,$,v[_+1],12,-389564586),$=u($,K,k,j,v[_+2],17,606105819),j=u(j,$,K,k,v[_+3],22,-1044525330),k=u(k,j,$,K,v[_+4],7,-176418897),K=u(K,k,j,$,v[_+5],12,1200080426),$=u($,K,k,j,v[_+6],17,-1473231341),j=u(j,$,K,k,v[_+7],22,-45705983),k=u(k,j,$,K,v[_+8],7,1770035416),K=u(K,k,j,$,v[_+9],12,-1958414417),$=u($,K,k,j,v[_+10],17,-42063),j=u(j,$,K,k,v[_+11],22,-1990404162),k=u(k,j,$,K,v[_+12],7,1804603682),K=u(K,k,j,$,v[_+13],12,-40341101),$=u($,K,k,j,v[_+14],17,-1502002290),j=u(j,$,K,k,v[_+15],22,1236535329),k=p(k,j,$,K,v[_+1],5,-165796510),K=p(K,k,j,$,v[_+6],9,-1069501632),$=p($,K,k,j,v[_+11],14,643717713),j=p(j,$,K,k,v[_+0],20,-373897302),k=p(k,j,$,K,v[_+5],5,-701558691),K=p(K,k,j,$,v[_+10],9,38016083),$=p($,K,k,j,v[_+15],14,-660478335),j=p(j,$,K,k,v[_+4],20,-405537848),k=p(k,j,$,K,v[_+9],5,568446438),K=p(K,k,j,$,v[_+14],9,-1019803690),$=p($,K,k,j,v[_+3],14,-187363961),j=p(j,$,K,k,v[_+8],20,1163531501),k=p(k,j,$,K,v[_+13],5,-1444681467),K=p(K,k,j,$,v[_+2],9,-51403784),$=p($,K,k,j,v[_+7],14,1735328473),j=p(j,$,K,k,v[_+12],20,-1926607734),k=m(k,j,$,K,v[_+5],4,-378558),K=m(K,k,j,$,v[_+8],11,-2022574463),$=m($,K,k,j,v[_+11],16,1839030562),j=m(j,$,K,k,v[_+14],23,-35309556),k=m(k,j,$,K,v[_+1],4,-1530992060),K=m(K,k,j,$,v[_+4],11,1272893353),$=m($,K,k,j,v[_+7],16,-155497632),j=m(j,$,K,k,v[_+10],23,-1094730640),k=m(k,j,$,K,v[_+13],4,681279174),K=m(K,k,j,$,v[_+0],11,-358537222),$=m($,K,k,j,v[_+3],16,-722521979),j=m(j,$,K,k,v[_+6],23,76029189),k=m(k,j,$,K,v[_+9],4,-640364487),K=m(K,k,j,$,v[_+12],11,-421815835),$=m($,K,k,j,v[_+15],16,530742520),j=m(j,$,K,k,v[_+2],23,-995338651),k=g(k,j,$,K,v[_+0],6,-198630844),K=g(K,k,j,$,v[_+7],10,1126891415),$=g($,K,k,j,v[_+14],15,-1416354905),j=g(j,$,K,k,v[_+5],21,-57434055),k=g(k,j,$,K,v[_+12],6,1700485571),K=g(K,k,j,$,v[_+3],10,-1894986606),$=g($,K,k,j,v[_+10],15,-1051523),j=g(j,$,K,k,v[_+1],21,-2054922799),k=g(k,j,$,K,v[_+8],6,1873313359),K=g(K,k,j,$,v[_+15],10,-30611744),$=g($,K,k,j,v[_+6],15,-1560198380),j=g(j,$,K,k,v[_+13],21,1309151649),k=g(k,j,$,K,v[_+4],6,-145523070),K=g(K,k,j,$,v[_+11],10,-1120210379),$=g($,K,k,j,v[_+2],15,718787259),j=g(j,$,K,k,v[_+9],21,-343485551),k=s(k,E),j=s(j,w),$=s($,C),K=s(K,U);return i(k)+i(j)+i($)+i(K)}let tge=1,iV=console,Nr=class{static setLogger(t){iV=t}constructor(t,r){_t(this,"id",void 0),_t(this,"lockingPromise",Pe.resolve()),_t(this,"locks",0),_t(this,"name",""),_t(this,"lockId",void 0),this.lockId=tge++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");iV.debug("".concat(i," ").concat(s))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const i=new Pe(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),s=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),s}};function Up(t,r){return function(i,s,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const p=this[r];if(!p)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await p.lock("From ".concat(t,".").concat(s));try{for(var g=arguments.length,v=new Array(g),_=0;_<g;_++)v[_]=arguments[_];return await u.apply(this,v)}finally{m()}},c}}const Kn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Pb(t,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,i)}function To(t,r,i,s){const c=Object.assign({},Kn,s);let u=c.timeout;const p=async()=>{await function(v){return new Pe(_=>{window.setTimeout(_,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const g=new Pe(async(v,_)=>{r=r||(()=>!1),i=i||(()=>!0);for(let E=0;E<c.maxRetryCount;E+=1){if(m)return _(new me(H.OPERATION_ABORTED));try{const w=await t();if(!r(w,E)||E+1===c.maxRetryCount)return v(w);await p()}catch(w){if(!i(w,E)||E+1===c.maxRetryCount)return _(w);await p()}}});return g.cancel=()=>m=!0,g}let Db,sA=class{constructor(t){_t(this,"input",[]),_t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ss(t=this.input).call(t,(r,i)=>r+i)/this.input.length}},kb=0,oA=0;function cA(t,r,i,s){return new Pe((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),kb+=uc(r.data)):i&&(r.data.size?kb+=r.data.size:r.data instanceof FormData?kb+=QF(r.data):kb+=uc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ji.request(r).then(p=>{typeof p.data=="string"?oA+=uc(p.data):p.data instanceof ArrayBuffer||p.data instanceof Uint8Array?oA+=p.data.byteLength:oA+=uc(JSON.stringify(p.data)),c(p.data)}).catch(p=>{ji.isCancel(p)?u(new me(H.OPERATION_ABORTED,"cancel token canceled")):p.code==="ECONNABORTED"?u(new me(H.NETWORK_TIMEOUT,p.message)):p.response?u(new me(H.NETWORK_RESPONSE_ERROR,p.response.status)):u(new me(H.NETWORK_ERROR,p.message))})})}async function nge(t,r){const i=new Blob([r.data],{type:"buffer"});return await cA(t,Ie(Ie({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const aV=()=>window.isSecureContext!==void 0;function Vs(t){if(Array.isArray(t))return t.map(i=>i);if(!sV(t))return t;const r={};for(const i in t){const s=t[i];sV(s)||Array.isArray(s)?r[i]=Vs(s):r[i]=s}return r}function sV(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let lA=class{constructor(t){_t(this,"input",[]),_t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Bs={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Qg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Bs,remoteCandidate:Bs},updateInterval:0},oV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},cV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},lV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},dV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let dA=class{constructor(t,r){_t(this,"onFirstVideoReceived",void 0),_t(this,"onFirstVideoDecoded",void 0),_t(this,"onFirstAudioReceived",void 0),_t(this,"onFirstVideoDecodedTimeout",void 0),_t(this,"onFirstAudioDecoded",void 0),_t(this,"onSelectedLocalCandidateChanged",void 0),_t(this,"onSelectedRemoteCandidateChanged",void 0),_t(this,"videoIsReady",!1),_t(this,"videoIsReady2",{}),_t(this,"pc",void 0),_t(this,"options",void 0),_t(this,"intervalTimer",void 0),_t(this,"stats",Vs(Qg)),_t(this,"isFirstVideoReceived",{}),_t(this,"isFirstVideoDecoded",{}),_t(this,"isFirstAudioReceived",{}),_t(this,"isFirstAudioDecoded",{}),_t(this,"isFirstVideoDecodedTimeout",{}),_t(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Pe(t=>{t({local:Ie({},Bs),remote:Ie({},Bs)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,u=0,p=0;for(const m of i)t[m].forEach((g,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const _=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,E=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(s+=_,u+=E):(c+=_,p+=E),Number.isNaN(_)||Number.isNaN(_)?g.packetLostRate=0:g.packetLostRate=_<=0||E<=0?0:E/(_+E)});t.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),t.recvPacketLossRate=c<=0||p<=0?0:p/(c+p)}},rge=class extends dA{constructor(){super(...arguments),_t(this,"_stats",Qg),_t(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Vs(Qg);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var i;const s=Ne(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=Vs(cV);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Vs(oV),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const p=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=p.framesDecodeFreezeTime,c.framesDecodeInterval=p.framesDecodeInterval,c.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ie({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Vs(dV);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Vs(lV);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new Pe((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),r.push(s)}),r}},Fp=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),jb=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),uA=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),ka=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Vp=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Vp||{});function Zg(t,r,i,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Vp.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const p=Number(r[s]);if(typeof p!="number")return;if(!t)return p?u/p*c:void 0;const m=Number(t[i]);if(typeof m!="number")return;const g=Number(t[s]);if(typeof g!="number")return;const v=p-g;return v?(u-m)/v*c:void 0}let uV=class extends dA{constructor(){super(...arguments),_t(this,"_stats",Qg),_t(this,"report",void 0),_t(this,"lastDecodeVideoReceiverStats",new Map),_t(this,"lastVideoFramesRecv",new Map),_t(this,"lastVideoFramesSent",new Map),_t(this,"lastVideoFramesDecode",new Map),_t(this,"lastVideoFramesOutput",new Map),_t(this,"lastVideoJBDelay",new Map),_t(this,"lastAudioJBDelay",new Map),_t(this,"mediaBytesSent",new Map),_t(this,"mediaBytesRetransmit",new Map),_t(this,"mediaBytesTargetEncode",new Map),_t(this,"lastDecodeAudioReceiverStats",new Map),_t(this,"lastAudioConcealment",new Map),_t(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Vs(Qg),this.report.forEach(t=>{switch(t.type){case ka.OUTBOUND:case ka.INBOUND:{const r=t.mediaType||t.kind,i=!r&&"frameWidth"in t,s=!r&&!("frameWidth"in t);t.type===ka.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(t):(r==="video"||i)&&this.processVideoOutboundStats(t):t.type===ka.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(t):(r==="video"||i)&&this.processVideoInboundStats(t));break}case ka.TRANSPORT:{this.processTransportStats(t);const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case ka.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Ie({},Bs),remote:Ie({},Bs)};return t.forEach(i=>{let s;if(i.type===ka.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===ka.CANDIDATE_PAIR&&i.selected&&(s=i),s){const c=(u,p)=>{u.type=p.type,u.id=p.id,p.address&&(u.address=p.address),p.candidateType&&(u.candidateType=p.candidateType),p.port&&(u.port=p.port),p.priority&&(u.priority=p.priority),p.protocol&&(u.protocol=p.protocol),p.relayProtocol&&(u.relayProtocol=p.relayProtocol)};if(s.localCandidateId){const u=t.get(s.localCandidateId);u&&c(r.local,u)}if(s.remoteCandidateId){const u=t.get(s.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===ka.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===ka.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===ka.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ie({},r),Ie({},this.stats.selectedCandidatePair.localCandidate)),t.type===ka.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ie({},r),Ie({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(s=>s.ssrc===t.ssrc);r||(r=Vs(dV),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=Zg(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Vp.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,i,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Ie({},r))}calculateAudioFreeze(t,r,i){const s=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&s!=null){const c=s.lts,u=i.timestamp,p=u-c;if(p<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=s.nonSilent+m,v=t.totalSamplesReceived-r.totalSamplesReceived;if(v<=0)return;const _=80*v/p,E=200*v/p,w=p/v;let C=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>_&&(s.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*w)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*w)),C=s.plc80+1);let U=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>E&&(s.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*w)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*w)),U=s.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:u,plc80:C,plc200:U})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(p=>p.ssrc===t.ssrc);r||(r=Vs(oV),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const p=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,p,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const p=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=p.framesDecodeFreezeTime,r.framesDecodeInterval=p.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<p.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=Zg(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=Zg(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Vp.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=Zg(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Vp.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=Zg(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Vp.kMillisecondsFromSeconds),s&&u-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ie({},r),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);r||(r=Vs(cV),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new lA(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const c=new lA(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const c=new lA(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-s.lastFrameCount,u=t.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,ka.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(r||(r=Vs(lV),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const i=this.findRemoteStatsId(t.ssrc,ka.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}processTransportStats(t){this._stats.transport.bytesReceived=t.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=t.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=t.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=t.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(t,r){var i;const s=Array.from(va(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===t);return s?s.id:null}processVideoMediaSource(t,r){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,r){const i=this.report.get(t);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,r,i){var s,c,u,p;const m=r?this.report.get(r):void 0,g=(s=m==null?void 0:m.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof g!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,_=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,E=(p=m==null?void 0:m.framesPerSecond)!==null&&p!==void 0?p:t.framesPerSecond;if(typeof v=="number"&&typeof _=="number"||(v=0,_=0),E==null){const w=Date.now(),C=this.lastVideoFramesSent.get(i.ssrc);C&&w-C.lts>=800?(E=Math.round((g-C.count)/((w-C.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:w,rate:E})):C?E=C.rate:this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:w,rate:0})}i.sentFrame={width:v,height:_,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,r,i){var s,c,u,p,m;const g=r?this.report.get(r):void 0,v=(s=g==null?void 0:g.framesReceived)!==null&&s!==void 0?s:t.framesReceived,_=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,E=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:t.frameHeight,w=(p=g==null?void 0:g.jitterBufferDelay)!==null&&p!==void 0?p:t.jitterBufferDelay,C=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const U=this.lastVideoFramesRecv.get(i.ssrc),k=Date.now();i.framesReceivedCount=v;let j=0;U&&k-U.lts>=800?(j=Math.round((v-U.count)/((k-U.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:k,rate:j})):U?j=U.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:v,lts:k,rate:0}),i.receivedFrame={width:_||0,height:E||0,frameRate:j||0},i.decodedFrame={width:_||0,height:E||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:E||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(w&&C){const U=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let k=U.jitterBufferMs;const j=C-U.jitterBufferEmittedCount;j>0&&(k=1e3*(w-U.jitterBufferDelay)/j),i.jitterBufferMs=k,i.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:C,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,r,i){var s,c,u,p;const m=r?this.report.get(r):void 0,g=(s=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&s!==void 0?s:0,v=(u=(p=m==null?void 0:m.echoReturnLossEnhancement)!==null&&p!==void 0?p:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=g,i.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,i){var s,c,u,p,m,g,v,_,E;const w=r?this.report.get(r):void 0,C=(s=w==null?void 0:w.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,U=(c=w==null?void 0:w.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,k=(u=w==null?void 0:w.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,j=(p=w==null?void 0:w.jitterBufferEmittedCount)!==null&&p!==void 0?p:t.jitterBufferEmittedCount,$=(m=w==null?void 0:w.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,K=(g=w==null?void 0:w.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,J=(v=w==null?void 0:w.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples,ne=(_=w==null?void 0:w.silentConcealedSamples)!==null&&_!==void 0?_:t.silentConcealedSamples,ae=(E=w==null?void 0:w.concealmentEvents)!==null&&E!==void 0?E:t.concealmentEvents;if(typeof U=="number"&&(i.totalSamplesReceived=U),typeof ne=="number"&&(i.silentConcealedSamples=ne),typeof ae=="number"&&(i.concealmentEvents=ae),typeof J=="number"&&(i.concealedSamples=J),C&&U&&(i.accelerateRate=C/U),k&&j){const oe=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ve=oe.jitterBufferMs;const Ee=j-oe.jitterBufferEmittedCount;Ee>0&&(ve=1e3*(k-oe.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(ve),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:j,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=$;let ee=1920;K&&U&&(ee=U/K/50,i.receivedFrames=Math.round(U/ee)),J&&(i.droppedFrames=Math.round(J/ee))}processRemoteInboundStats(t,r){const i=this.report.get(t);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const s=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},ige=class extends dA{updateStats(){return Pe.resolve()}};function Lb(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const p=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return p&&p[0]?Number(p[0].split("/")[1]):null}();return u?u<76?new rge(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new uV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(p){if(!window.RTCStatsReport)return!1;const m=p.getStats();return!!(m instanceof Pe||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(m))}(t)?new uV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new ige(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const hV="websdk_ng_install_id";function hA(){try{if(W("INSTALL_ID"))return W("INSTALL_ID");let t=window.localStorage.getItem(hV);return t||(t=Pu(),window.localStorage.setItem(hV,t)),an("INSTALL_ID",t),t}catch{return}}const cs=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],s=r[2];return"".concat(i,".").concat(s)}return"4.0.0.999"}("4.24.2"),pA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Du=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const $r=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),p={};return p[t]=s,p[r]=u,Object.assign(p,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=$r;const Mb={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},mA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},fA="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",gA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},en=Ie(Ie(Ie(Ie({},gA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:mA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Mb),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function an(t,r,i){var s,c,u;Ne(s=Object.keys(en)).call(s,t)&&(!i&&Ne(c=Object.keys(ja)).call(c,t)||(en[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,en.USE_NEW_NETWORK_CONFIG=u,u&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(en.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function W(t){if(t==="TURN_DOMAINS"){const r=en.TURN_DOMAINS;return Ne(r).call(r,W("TURN_DOMAIN"))?r:[W("TURN_DOMAIN")].concat(r)}return en[t]}pA||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let pV=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const ja={};var ft=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_RTE_URL="SET_RTE_URL",t.SET_RTE_SID="SET_RTE_SID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(ft||{});let ku=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const mV=128,age=96,fV=1e3,Bp=10;let sge=0;var gV=(()=>{var t={8:(s,c,u)=>{u.r(c),u.d(c,{Parser:()=>Ee,Printer:()=>Et,parse:()=>Oe,print:()=>He});const p=`
`,m="".concat("\r").concat(p),g=" ";let v;function _(xe){return xe>="0"&&xe<="9"}function E(xe){return xe>="!"&&xe<="~"}function w(xe){return E(xe)||xe>=""&&xe<=""}function C(xe){return xe==="!"||xe>="#"&&xe<="'"||xe>="*"&&xe<="+"||xe>="-"&&xe<="."||xe>="0"&&xe<="9"||xe>="A"&&xe<="Z"||xe>="^"&&xe<="~"}function U(xe){return xe>="1"&&xe<="9"}function k(xe){return xe>="A"&&xe<="Z"||xe>="a"&&xe<="z"}function j(xe){return xe==="d"||xe==="h"||xe==="m"||xe==="s"}function $(xe){return xe>""&&xe<"	"||xe>"\v"&&xe<"\f"||xe>""&&xe<""}function K(xe){return k(xe)||_(xe)||xe==="+"||xe==="/"}function J(xe){return _(xe)||k(xe)||xe==="+"||xe==="/"||xe==="-"||xe==="_"}function ne(xe){return k(xe)||_(xe)||xe==="+"||xe==="/"}function ae(xe,D){var X=Object.keys(xe);if(Object.getOwnPropertySymbols){var te=Object.getOwnPropertySymbols(xe);D&&(te=te.filter(function(Ae){return Object.getOwnPropertyDescriptor(xe,Ae).enumerable})),X.push.apply(X,te)}return X}function ee(xe){for(var D=1;D<arguments.length;D++){var X=arguments[D]!=null?arguments[D]:{};D%2?ae(Object(X),!0).forEach(function(te){oe(xe,te,X[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(xe,Object.getOwnPropertyDescriptors(X)):ae(Object(X)).forEach(function(te){Object.defineProperty(xe,te,Object.getOwnPropertyDescriptor(X,te))})}return xe}function oe(xe,D,X){return D in xe?Object.defineProperty(xe,D,{value:X,enumerable:!0,configurable:!0,writable:!0}):xe[D]=X,xe}(function(xe){xe.VERSION="v",xe.ORIGIN="o",xe.SESSION_NAME="s",xe.INFORMATION="i",xe.URI="u",xe.EMAIL="e",xe.PHONE="p",xe.CONNECTION="c",xe.BANDWIDTH="b",xe.TIME="t",xe.REPEAT="r",xe.ZONE_ADJUSTMENTS="z",xe.KEY="k",xe.ATTRIBUTE="a",xe.MEDIA="m"})(v||(v={}));class ve{consumeText(D,X){let te=X;for(;te<D.length;){const Ae=D[te];if(Ae==="\0"||Ae==="\r"||Ae===p)break;te+=1}if(te-X==0)throw new Error("Invalid text, at ".concat(D));return te}consumeUnicastAddress(D,X,te){return this.consumeTill(D,X,g)}consumeOneOrMore(D,X,te){let Ae=X;for(;te(D[Ae]);)Ae++;if(Ae-X==0)throw new Error("Invalid rule at ".concat(X,"."));return Ae}consumeSpace(D,X){if(D[X]===g)return X+1;throw new Error("Invalid space at ".concat(X,"."))}consumeIP4Address(D,X){let te=X;for(let Ae=0;Ae<4;Ae++)if(te=this.consumeDecimalUChar(D,te),Ae!==3){if(D[te]!==".")throw new Error("Invalid IP4 address.");te++}return te}consumeDecimalUChar(D,X){let te=X;for(let yt=0;yt<3&&_(D[te]);yt++,te++);if(te-X==0)throw new Error("Invalid decimal uchar.");const Ae=parseInt(D.slice(X,te));if(Ae>=0&&Ae<=255)return te;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,X){let te=this.consumeHexpart(D,X);return D[te]===":"&&(te+=1,te=this.consumeIP4Address(D,te)),te}consumeHexpart(D,X){let te=X;if(D[te]===":"&&D[te+1]===":"){te+=2;try{te=this.consumeHexseq(D,te)}catch{}return te}if(te=this.consumeHexseq(D,te),D[te]===":"&&D[te+1]===":"){te+=2;try{te=this.consumeHexseq(D,te)}catch{}return te}return te}consumeHexseq(D,X){let te=X;for(;te=this.consumeHex4(D,te),D[te]===":"&&D[te+1]!==":";)te+=1;return te}consumeHex4(D,X){let te=0;for(;te<4;te++)if(!((Ae=D[X+te])>="0"&&Ae<="9"||Ae>="a"&&Ae<="f"||Ae>="A"&&Ae<="F")){if(te===0)throw new Error("Invalid hex 4");break}var Ae;return X+te}consumeFQDN(D,X){let te=X;for(;_(D[te])||k(D[te])||D[te]==="-"||D[te]===".";)te+=1;if(te-X<4)throw new Error("Invalid FQDN");return te}consumeExtnAddr(D,X){return this.consumeOneOrMore(D,X,w)}consumeMulticastAddress(D,X,te){switch(te){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,X);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,X);default:try{return this.consumeFQDN(D,X)}catch{return this.consumeExtnAddr(D,X)}}}consumeIP6MulticastAddress(D,X){const te=this.consumeHexpart(D,X);return D[te]==="/"?this.consumeInteger(D,te+1):te}consumeIP4MulticastAddress(D,X){let te=X+3;const Ae=D.slice(X,te),yt=parseInt(Ae);if(yt<224||yt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let fn=0;fn<3;fn++){if(D[te]!==".")throw new Error("Invalid IP4 multicast address.");te+=1,te=this.consumeDecimalUChar(D,te)}return D[te]==="/"&&(te+=1),te=this.consumeTTL(D,te),D[te]==="/"&&(te=this.consumeInteger(D,te)),te}consumeInteger(D,X){if(!U(D[X]))throw new Error("Invalid integer.");for(X+=1;_(D[X]);)X+=1;return X}consumeTTL(D,X){if(D[X]==="0")return X+1;if(!U(D[X]))throw new Error("Invalid TTL.");X+=1;for(let te=0;te<2&&_(D[X]);te++)X+=1;return X}consumeToken(D,X){return this.consumeOneOrMore(D,X,C)}consumeTime(D,X){let te=X;if(D[te]==="0")return te+1;for(U(D[te])&&(te+=1);_(D[te]);)te++;if(te-X<10)throw new Error("Invalid time");return te}consumeAddress(D,X){return this.consumeTill(D,X,g)}consumeTypedTime(D,X){let te=X;return te=this.consumeOneOrMore(D,te,_),j(D[te])?te+1:te}consumeRepeatInterval(D,X){if(!U(D[X]))throw new Error("Invalid repeat interval");for(X+=1;_(D[X]);)X+=1;return j(D[X])&&(X+=1),X}consumePort(D,X){return this.consumeOneOrMore(D,X,_)}consume(D,X,te){for(let Ae=0;Ae<te.length;Ae++){if(X+Ae>=D.length)throw new Error("consume exceeding value length");if(D[X+Ae]!==te[Ae])throw new Error("consume ".concat(te," failed at ").concat(Ae))}return X+te.length}consumeTill(D,X,te){let Ae=X;for(;Ae<D.length&&(typeof te!="string"||D[Ae]!==te)&&(typeof te!="function"||!te(D[Ae]));)Ae++;return Ae}}class Ee extends ve{constructor(){super(),oe(this,"records",[]),oe(this,"currentLine",0)}parse(D){const X=this.probeEOL(D);this.records=D.split(X).filter(wd=>!!Ei(wd).call(wd)).map(this.parseLine),this.currentLine=0;const te=this.parseVersion(),Ae=this.parseOrigin(),yt=this.parseSessionName(),fn=this.parseInformation(),xr=this.parseUri(),vs=this.parseEmail(),Sd=this.parsePhone(),Zx=this.parseConnection(),_m=this.parseBandWidth(),eE=this.parseTimeFields(),ih=this.parseKey(),Mv=this.parseSessionAttribute(),ah=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:te,origin:Ae,sessionName:yt,information:fn,uri:xr,emails:vs,phones:Sd,connection:Zx,bandwidths:_m,timeFields:eE,key:ih,attributes:Mv,mediaDescriptions:ah}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let X=0;X<D.length;X++)if(D[X]===p)return D[X-1]==="\r"?m:p;throw new Error("Invalid newline character.")}parseLine(D,X){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const te=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:te,value:D.slice(2),line:X,cur:0}}parseSessionAttribute(){const D=new mt;for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==v.ATTRIBUTE)break;const te={attField:this.extractOneOrMore(X,Ae=>C(Ae)&&Ae!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,te.attValue=this.extractOneOrMore(X,$)),D.parse(te),this.currentLine++}return D.digest()}parseMediaAttributes(D){const X=new ct(D);for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==v.ATTRIBUTE)break;const Ae={attField:this.extractOneOrMore(te,yt=>C(yt)&&yt!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,Ae.attValue=this.extractOneOrMore(te,$)),X.parse(Ae),this.currentLine++}return X.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===v.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===v.ZONE_ADJUSTMENTS){const X=[];for(;;)try{const te=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let Ae=!1;D.value[D.cur]==="-"&&(Ae=!0,D.cur+=1);const yt=this.extract(D,this.consumeTypedTime);X.push({time:te,typedTime:yt,back:Ae})}catch{break}if(X.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,X}return[]}parseRepeat(){const D=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.REPEAT)break;{const te=this.extract(X,this.consumeRepeatInterval),Ae=this.parseTypedTime(X);D.push({repeatInterval:te,typedTimes:Ae}),this.currentLine++}}return D}parseTypedTime(D){const X=[];for(;;)try{this.consumeSpaceForRecord(D),X.push(this.extract(D,this.consumeTypedTime))}catch{break}if(X.length===0)throw new Error("Invalid typed time.");return X}parseTime(){const D=this.getCurrentRecord(),X=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const te=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:X,stopTime:te}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==v.BANDWIDTH)break;{const te=this.extractOneOrMore(X,C);if(X.value[X.cur]!==":")throw new Error("Invalid bandwidth field.");X.cur++;const Ae=this.extractOneOrMore(X,_);D.push({bwtype:te,bandwidth:Ae}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==v.VERSION)throw new Error("first sdp record must be version");const X=D.value.slice(0,this.consumeOneOrMore(D.value,0,_));if(X.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,X}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const X=this.extractOneOrMore(D,w);this.consumeSpaceForRecord(D);const te=this.extractOneOrMore(D,_);this.consumeSpaceForRecord(D);const Ae=this.extractOneOrMore(D,_);this.consumeSpaceForRecord(D);const yt=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const fn=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const xr=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:X,sessId:te,sessVersion:Ae,nettype:yt,addrtype:fn,unicastAddress:xr}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===v.SESSION_NAME){const X=this.extract(D,this.consumeText);return this.currentLine++,X}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==v.INFORMATION)return;const X=this.extract(D,this.consumeText);return this.currentLine++,X}parseUri(){const D=this.getCurrentRecord();if(D.type===v.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.EMAIL)break;D.push(X.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const X=this.getCurrentRecord();if(X.type!==v.PHONE)break;D.push(X.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===v.CONNECTION){const X=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const te=this.extractOneOrMore(D,C);this.consumeSpaceForRecord(D);const Ae=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:X,addrtype:te,address:Ae}}}parseMedia(){const D=this.getCurrentRecord(),X=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let te=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,te+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const Ae=[];for(Ae.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,Ae.push(this.extract(D,this.consumeToken));if(Ae.length===0)throw new Error("Invalid proto");const yt=this.parseFmt(D);return this.currentLine++,{mediaType:X,port:te,protos:Ae,fmts:yt}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===v.TIME;){const X=this.parseTime(),te=this.parseRepeat(),Ae=this.parseZone();D.push({time:X,repeats:te,zones:Ae})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const X=this.parseMedia(),te=this.parseInformation(),Ae=this.parseConnections(),yt=this.parseBandWidth(),fn=this.parseKey(),xr=this.parseMediaAttributes(X);D.push({media:X,information:te,connections:Ae,bandwidths:yt,key:fn,attributes:xr})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const X=[];for(;;)try{this.consumeSpaceForRecord(D),X.push(this.extract(D,this.consumeToken))}catch{break}if(X.length===0)throw new Error("Invalid fmts");return X}extract(D,X){for(var te=arguments.length,Ae=new Array(te>2?te-2:0),yt=2;yt<te;yt++)Ae[yt-2]=arguments[yt];const fn=X.call(this,D.value,D.cur,...Ae),xr=D.value.slice(D.cur,fn);return D.cur=fn,xr}extractOneOrMore(D,X){const te=this.consumeOneOrMore(D.value,D.cur,X),Ae=D.value.slice(D.cur,te);return D.cur=te,Ae}consumeSpaceForRecord(D){if(D.value[D.cur]!==g)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class Be extends ve{constructor(){super(...arguments),oe(this,"attributes",void 0),oe(this,"digested",!1)}extractOneOrMore(D,X,te){const Ae=this.consumeOneOrMore(D.attValue,D._cur,X),yt=D.attValue.slice(D._cur,Ae),[fn,xr]=te||[];if(typeof fn=="number"&&yt.length<fn)throw new Error("error in length, should be more or equal than ".concat(fn," characters."));if(typeof xr=="number"&&yt.length>xr)throw new Error("error in length, should be less or equal than ".concat(xr," characters."));return D._cur=Ae,yt}consumeAttributeSpace(D){if(D.attValue[D._cur]!==g)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,X){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var te=arguments.length,Ae=new Array(te>2?te-2:0),yt=2;yt<te;yt++)Ae[yt-2]=arguments[yt];const fn=X.call(this,D.attValue,D._cur,...Ae),xr=D.attValue.slice(D._cur,fn);return D._cur=fn,xr}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,X){if(!D.attValue)throw new Error;for(let te=0;te<X.length;te++)if(X[te]!==D.attValue[D._cur+te])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,K,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,K,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const X=[];for(;!this.atEnd(D);){X.push(this.extractOneOrMore(D,K));try{this.consumeAttributeSpace(D)}catch(te){if(this.atEnd(D))break;throw te}}this.attributes.iceOptions=X}parseFingerprint(D){const X=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:X,fingerprint:te})}parseExtmap(D){const X=this.extractOneOrMore(D,_);let te;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),te=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const Ae=this.extract(D,this.consumeTill,g),yt=ee(ee({entry:parseInt(X,10)},te&&{direction:te}),{},{extensionName:Ae});this.peekChar(D)===g&&(this.consumeAttributeSpace(D),yt.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(yt)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const X=this.extract(D,this.consumeTill);if(X!=="active"&&X!=="passive"&&X!=="actpass"&&X!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=X}}class mt extends Be{constructor(){super(...arguments),oe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(X){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),X}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const X=this.extract(D,this.consumeToken),te=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;)this.consumeAttributeSpace(D),te.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:X,identificationTag:te})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,J)}parseIdentity(D){const X=this.extractOneOrMore(D,ne),te=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;){this.consumeAttributeSpace(D);const Ae=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const yt=this.extractOneOrMore(D,fn=>fn!==g&&$(fn));te.push({name:Ae,value:yt})}this.attributes.identities.push({assertionValue:X,extensions:te})}parseMsidSemantic(D){this.peekChar(D)===g&&this.consumeAttributeSpace(D);const X={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),X.applyForAll=!0;break}{const te=this.extract(D,this.consumeTill,g);X.identifierList.push(te)}}this.attributes.msidSemantic=X}}class ct extends Be{constructor(D){super(),oe(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(X){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),X}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const X=this.extractOneOrMore(D,K,[1,32]);this.consumeAttributeSpace(D);const te=this.extractOneOrMore(D,_,[1,5]);this.consumeAttributeSpace(D);const Ae=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const yt=this.extractOneOrMore(D,_,[1,10]);this.consumeAttributeSpace(D);const fn=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const xr=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const vs={foundation:X,componentId:te,transport:Ae,priority:yt,connectionAddress:fn,port:xr,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),vs.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),vs.relPort=this.extract(D,this.consumePort));this.peekChar(D)===g;){this.consumeAttributeSpace(D);const Sd=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),vs.extension[Sd]=this.extractOneOrMore(D,E)}this.attributes.candidates.push(vs)}parseRemoteCandidate(D){const X=[];for(;;){const te=this.extractOneOrMore(D,_,[1,5]);this.consumeAttributeSpace(D);const Ae=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const yt=this.extract(D,this.consumePort);X.push({componentId:te,connectionAddress:Ae,port:yt});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(X)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const X=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const Ae={encodingName:te,clockRate:this.extractOneOrMore(D,_)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),Ae.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const yt=this.attributes.payloads.find(fn=>fn.payloadType===parseInt(X,10));yt?yt.rtpMap=Ae:this.attributes.payloads.push({payloadType:parseInt(X,10),rtpMap:Ae,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const X=this.extractOneOrMore(D,_);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,":");let Ae;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),Ae=this.extract(D,this.consumeTill));const yt=this.attributes.ssrcs.find(fn=>fn.ssrcId===parseInt(X,10));yt?yt.attributes[te]=Ae:this.attributes.ssrcs.push({ssrcId:parseInt(X,10),attributes:{[te]:Ae}})}parseFmtp(D){const X=this.extract(D,this.consumeTill,g);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill),Ae={};te.split(";").forEach(fn=>{let[xr,vs]=fn.split("=");xr=Ei(xr).call(xr);const Sd=typeof vs=="string"?Ei(vs).call(vs):null;typeof xr=="string"&&xr.length>0&&(Ae[xr]=Sd)});const yt=this.attributes.payloads.find(fn=>fn.payloadType===parseInt(X,10));yt?yt.fmtp={parameters:Ae}:this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[],fmtp:{parameters:Ae}})}parseFmtParameters(D){const X={},te=this.extract(D,this.consumeTill,"=");D._cur++;const Ae=this.extract(D,this.consumeTill,";");for(X[te]=Ae;D.attValue[D._cur]===";";){const yt=this.extract(D,this.consumeTill,"=");D._cur++;const fn=this.extract(D,this.consumeTill,";");X[yt]=fn}return X}parseRtcpFb(D){let X="";X=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,g),this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,g);let Ae;if(te==="trr-int")Ae={type:te,interval:this.extract(D,this.consumeTill)};else{const yt={type:te};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),yt.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===g&&(yt.additional=this.extract(D,this.consumeTill))),Ae=yt}if(X==="*")this.attributes.rtcpFeedbackWildcards.push(Ae);else{const yt=this.attributes.payloads.find(fn=>fn.payloadType===parseInt(X,10));yt?yt.rtcpFeedbacks.push(Ae):this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[Ae]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const X={port:this.extract(D,this.consumePort)};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),X.netType=this.extractOneOrMore(D,C),this.consumeAttributeSpace(D),X.addressType=this.extractOneOrMore(D,C),this.consumeAttributeSpace(D),X.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=X}parseMsid(D){const X={id:this.extractOneOrMore(D,C,[1,64])};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),X.appdata=this.extractOneOrMore(D,C,[1,64])),this.attributes.msids.push(X)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const X=this.extractOneOrMore(D,Ae=>k(Ae)||_(Ae)||Ae==="_"||Ae==="-");this.consumeAttributeSpace(D);const te={id:X,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===g){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const Ae=[];for(;;){const yt=this.extract(D,this.consumeToken);Ae.push(yt);try{this.extract(D,this.consume,",")}catch{break}}te.payloads=Ae,this.peekChar(D)===g&&this.extract(D,this.consume,g)}for(;;){const Ae=this.extract(D,this.consumeToken);switch(Ae){case"depend":{const yt={type:Ae,rids:this.extract(D,this.consume,"=").split(",")};te.params.push(yt);break}default:{const yt={type:Ae};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),yt.val=this.extract(D,this.consumeTill,";")),te.params.push(yt)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(te)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,_,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const X=this.extract(D,this.consumeToken),te=[];for(;;)try{this.consumeAttributeSpace(D);const Ae=this.extract(D,this.consumeInteger);te.push(parseInt(Ae,10))}catch{break}this.attributes.ssrcGroups.push({semantic:X,ssrcIds:te})}}function Tt(xe,D,X){return D in xe?Object.defineProperty(xe,D,{value:X,enumerable:!0,configurable:!0,writable:!0}):xe[D]=X,xe}class Et{constructor(){Tt(this,"eol",m)}print(D,X){let te="";return X&&(this.eol=X),te+=this.printVersion(D.version),te+=this.printOrigin(D.origin),te+=this.printSessionName(D.sessionName),te+=this.printInformation(D.information),te+=this.printUri(D.uri),te+=this.printEmail(D.emails),te+=this.printPhone(D.phones),te+=this.printConnection(D.connection),te+=this.printBandwidth(D.bandwidths),te+=this.printTimeFields(D.timeFields),te+=this.printKey(D.key),te+=this.printSessionAttributes(D.attributes),te+=this.printMediaDescription(D.mediaDescriptions),te}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let X="";for(const te of D)X+="e=".concat(te).concat(this.eol);return X}printPhone(D){let X="";for(const te of D)X+="e=".concat(te).concat(this.eol);return X}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let X="";for(const te of D)X+="b=".concat(te.bwtype,":").concat(te.bandwidth).concat(this.eol);return X}printTimeFields(D){let X="";for(const te of D){X+="t=".concat(te.time.startTime," ").concat(te.time.startTime).concat(this.eol);for(const Ae of te.repeats)X+="r=".concat(Ae.repeatInterval," ").concat(Ae.typedTimes.join(" ")).concat(this.eol);te.zoneAdjustments&&(X+="z=",X+="z=".concat(te.zoneAdjustments.map(Ae=>"".concat(Ae.time," ").concat(Ae.back?"-":""," ").concat(Ae.typedTime)).join(" ")).concat(this.eol),X+=this.eol)}return X}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let X="";for(const te of D)X+="a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol);return X}printMediaDescription(D){let X="";for(const te of D)X+=this.printMedia(te.media),X+=this.printInformation(te.information),X+=this.printConnections(te.connections),X+=this.printBandwidth(te.bandwidths),X+=this.printKey(te.key),X+=this.printMediaAttributes(te);return X}printConnections(D){let X="";for(const te of D)X+=this.printConnection(te);return X}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new Tn(this.eol).print(D)}printMediaAttributes(D){return new _e(this.eol).print(D)}}class Yt{constructor(D){Tt(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(g)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(X=>"a=fingerprint:".concat(X.hashFunction).concat(g).concat(X.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(X=>"a=extmap:".concat(X.entry).concat(X.direction?"/".concat(X.direction):"").concat(g).concat(X.extensionName).concat(X.extensionAttributes?"".concat(g).concat(X.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(X=>"a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol)).join("")}}class Tn extends Yt{print(D){let X="";return X+=this.printGroups(D.groups),X+=this.printMsidSemantic(D.msidSemantic),X+=this.printIceLite(D.iceLite),X+=this.printIceUfrag(D.iceUfrag),X+=this.printIcePwd(D.icePwd),X+=this.printIceOptions(D.iceOptions),X+=this.printFingerprints(D.fingerprints),X+=this.printSetup(D.setup),X+=this.printTlsId(D.tlsId),X+=this.printIdentity(D.identities),X+=this.printExtmap(D.extmaps),X+=this.printUnrecognized(D.unrecognized),X}printGroups(D){let X="";return D.length>0&&(X+=D.map(te=>"a=group:".concat(te.semantic).concat(te.identificationTag.map(Ae=>"".concat(g).concat(Ae)).join("")).concat(this.eol)).join("")),X}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(X=>"a=identity:".concat(X.assertionValue).concat(X.extensions.map(te=>"".concat(g).concat(te.name).concat(te.value?"=".concat(te.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let X="a=msid-semantic:".concat(D.semantic);return D.applyForAll?X+="".concat(g,"*"):D.identifierList.length>0&&(X+=D.identifierList.map(te=>"".concat(g).concat(te))),X+this.eol}}class _e extends Yt{print(D){const X=D.attributes;let te="";return te+=this.printRTCP(X.rtcp),te+=this.printIceUfrag(X.iceUfrag),te+=this.printIcePwd(X.icePwd),te+=this.printIceOptions(X.iceOptions),te+=this.printCandidates(X.candidates),te+=this.printRemoteCandidatesList(X.remoteCandidatesList),te+=this.printEndOfCandidates(X.endOfCandidates),te+=this.printFingerprints(X.fingerprints),te+=this.printSetup(X.setup),te+=this.printMid(X.mid),te+=this.printExtmap(X.extmaps),te+=this.printRTPRelated(X),te+=this.printPtime(X.ptime),te+=this.printMaxPtime(X.maxPtime),te+=this.printDirection(X.direction),te+=this.printSSRCGroups(X.ssrcGroups),te+=this.printSSRC(X.ssrcs),te+=this.printRTCPMux(X.rtcpMux),te+=this.printRTCPMuxOnly(X.rtcpMuxOnly),te+=this.printRTCPRsize(X.rtcpRsize),te+=this.printMSId(X.msids),te+=this.printImageattr(X.imageattr),te+=this.printRid(X.rids),te+=this.printSimulcast(X.simulcast),te+=this.printSCTPPort(X.sctpPort),te+=this.printMaxMessageSize(X.maxMessageSize),te+=this.printUnrecognized(X.unrecognized),te}printCandidates(D){return D.map(X=>"a=candidate:".concat(X.foundation).concat(g).concat(X.componentId).concat(g).concat(X.transport).concat(g).concat(X.priority).concat(g).concat(X.connectionAddress).concat(g).concat(X.port).concat(g,"typ").concat(g).concat(X.type).concat(X.relAddr?"".concat(g,"raddr").concat(g).concat(X.relAddr):"").concat(X.relPort?"".concat(g,"rport").concat(g).concat(X.relPort):"").concat(Object.keys(X.extension).map(te=>"".concat(g).concat(te).concat(g).concat(X.extension[te])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(X=>"a=remote-candidates:".concat(X.join(g)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const X=D.payloads;let te="";te+=D.rtcpFeedbackWildcards.map(Ae=>this.printRTCPFeedback("*",Ae)).join("");for(const Ae of X)te+=this.printRtpMap(Ae.payloadType,Ae.rtpMap),te+=this.printFmtp(Ae.payloadType,Ae.fmtp),te+=Ae.rtcpFeedbacks.map(yt=>this.printRTCPFeedback(Ae.payloadType,yt)).join("");return te}printFmtp(D,X){if(!X)return"";const te=Object.keys(X.parameters);return te.length===1&&X.parameters[te[0]]===null?"a=fmtp:".concat(D).concat(g).concat(te[0]).concat(this.eol):"a=fmtp:".concat(D).concat(g).concat(Object.keys(X.parameters).map(Ae=>"".concat(Ae,"=").concat(X.parameters[Ae])).join(";")).concat(this.eol)}printRtpMap(D,X){return X?"a=rtpmap:".concat(D).concat(g).concat(X.encodingName,"/").concat(X.clockRate).concat(X.encodingParameters?"/".concat(X.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,X){let te="a=rtcp-fb:".concat(D).concat(g),Ae=X;return Ae.type==="trr-int"?te+="ttr-int".concat(g).concat(Ae.interval):(te+="".concat(Ae.type),Ae.parameter&&(te+="".concat(g).concat(Ae.parameter),Ae.additional&&(te+="".concat(g).concat(Ae.additional)))),te+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(X=>Object.keys(X.attributes).map(te=>"a=ssrc:".concat(X.ssrcId.toString(10)).concat(g).concat(te).concat(X.attributes[te]?":".concat(X.attributes[te]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let X="a=rtcp:".concat(D.port);return D.netType&&(X+="".concat(g).concat(D.netType)),D.addressType&&(X+="".concat(g).concat(D.addressType)),D.address&&(X+="".concat(g).concat(D.address)),X+this.eol}printMSId(D){return D.map(X=>"a=msid:".concat(X.id).concat(X.appdata?"".concat(g).concat(X.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(X=>"a=imageattr:".concat(X).concat(this.eol)).join("")}printRid(D){return D.map(X=>{let te="a=rid:".concat(X.id).concat(g).concat(X.direction);return X.payloads&&(te+="".concat(g,"pt=").concat(X.payloads.join(","))),X.params.length>0&&(te+="".concat(g).concat(X.params.map(Ae=>Ae.type==="depend"?"depend=".concat(Ae.rids.join(",")):"".concat(Ae.type,"=").concat(Ae.val)).join(";"))),te+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(X=>"a=ssrc-group:".concat(X.semantic).concat(X.ssrcIds.map(te=>"".concat(g).concat(te.toString(10))).join("")).concat(this.eol)).join("")}}function Oe(xe){return new Ee().parse(xe)}function He(xe,D){return new Et().print(xe,D)}}},r={};function i(s){if(r[s])return r[s].exports;var c=r[s]={exports:{}};return t[s](c,c.exports,i),c.exports}return i.d=(s,c)=>{for(var u in c)i.o(c,u)&&!i.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:c[u]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i(8)})();function Ti(t){return gV.parse(t)}function el(t,r){return gV.print(t,r)}var oge=as("Array","keys"),cge=ql,lge=ni,dge=N,uge=oge,vA=Array.prototype,hge={DOMTokenList:!0,NodeList:!0},pge=function(t){var r=t.keys;return t===vA||dge(vA,t)&&r===vA.keys||lge(hge,cge(t))?uge:r},ai=d(pge);function Dn(t,r,i){return(r=function(s){var c=function(u,p){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function vV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function wt(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?vV(Object(i),!0).forEach(function(s){Dn(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):vV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function Ub(t,r){return Ub=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},Ub(t,r)}function yA(){yA=function(c,u){return new i(c,void 0,u)};var t=RegExp.prototype,r=new WeakMap;function i(c,u,p){var m=RegExp(c,u);return r.set(m,p||r.get(c)),Ub(m,i.prototype)}function s(c,u){var p,m=r.get(u);return ss(p=Object.keys(m)).call(p,function(g,v){var _=m[v];if(typeof _=="number")g[v]=c[_];else{for(var E=0;c[_[E]]===void 0&&E+1<_.length;)E++;g[v]=c[_[E]]}return g},Object.create(null))}return function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),u&&Ub(c,u)}(i,RegExp),i.prototype.exec=function(c){var u=t.exec.call(this,c);if(u){u.groups=s(u,this);var p=u.indices;p&&(p.groups=s(p,this))}return u},i.prototype[Symbol.replace]=function(c,u){if(typeof u=="string"){var p=r.get(this);return t[Symbol.replace].call(this,c,u.replace(/\$<([^>]+)(>|$)/g,function(g,v,_){if(_==="")return g;var E=p[v];return Array.isArray(E)?"$"+E.join("$"):typeof E=="number"?"$"+E:""}))}if(typeof u=="function"){var m=this;return t[Symbol.replace].call(this,c,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(s(g,m)),u.apply(this,g)})}return t[Symbol.replace].call(this,c,u)},yA.apply(this,arguments)}const yV=new class extends Nn{constructor(){super(...arguments),Dn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class mge{constructor(r){Dn(this,"logger",void 0),Dn(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function _A(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function _V(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const ls={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Fb=Date.now(),ev=t=>{for(const r in ls)if(Object.prototype.hasOwnProperty.call(ls,r)&&ls[r]===t)return r;return"DEFAULT"},R=new class{constructor(){Dn(this,"proxyServerURL",void 0),Dn(this,"logLevel",ls.DEBUG),Dn(this,"uploadState","collecting"),Dn(this,"uploadLogWaitingList",[]),Dn(this,"uploadLogUploadingList",[]),Dn(this,"uploadErrorCount",0),Dn(this,"currentLogID",0),Dn(this,"url",void 0),Dn(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.INFO].concat(r);this.log.apply(this,s)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.WARNING].concat(r);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){an("UPLOAD_LOG",!0)}disableLogUpload(){an("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new mge(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Fb<100)return void setTimeout(()=>{this.log(...r)},Date.now()-Fb);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=_A()+" Agora-SDK [".concat(ev(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const c=_A()+" %cAgora-SDK [".concat(ev(s),"]:");let u=[];if(!W("USE_NEW_LOG"))switch(s){case ls.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case ls.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case ls.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case ls.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Fb<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-Fb);const s=Math.max(0,Math.min(4,r[0]));r[0]=_A()+" Agora-SDK [".concat(ev(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(t){if(!W("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=_V()+" Agora-SDK [".concat(ev(t),"]:"):i[0]=_V()+" Agora-SDK [".concat(ev(t),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:cs,process_id:W("PROCESS_ID"),payload:JSON.stringify(t)};return To(async()=>{const i=await ji.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(W("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(W("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=i,s}},()=>(this.uploadLogUploadingList=[],!1),i=>{const s={status:-1,message:i.message,errorRange:t.map(c=>c.log_item_id)};return i.response?(s.status=i.response.status,s.data=i.response.data,s.headers=i.response.headers):i.request&&(s.status=i.request.status),yV.reportLogUploadError(s),!0},{timeout:W("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:W("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,W("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),W("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var bV;function fge(t){return Lr(t.reportId,"params.reportId",0,100,!1),Lr(t.category,"params.category",0,100,!1),Lr(t.event,"params.event",0,100,!1),Lr(t.label,"params.label",0,100,!1),cn(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(bV={}).FREE="free",bV.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const gge={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.RTE_DETAIL="rte_detail_stats",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),wn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let vge=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function st(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,s){const c=s.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);s.value=function(){for(var p,m=arguments.length,g=new Array(m),v=0;v<m;v++)g[v]=arguments[v];let _=g;if(t.argsMap)try{_=t.argsMap(this,...g)}catch(w){R.warning(w),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const E=(t.report||ze).reportApiInvoke(this._sessionId||null,{id:this._clientId||((p=this.store)===null||p===void 0?void 0:p.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:_,tag:ln.TRACER,reportResult:t.reportResult},t.throttleTime);try{const w=c.apply(this,g);return w instanceof Pe?w.then(C=>(E.onSuccess(t.reportResult&&C),C)).catch(C=>{throw E.onError(C),C}):(E.onSuccess(t.reportResult&&w),w)}catch(w){throw E.onError(w),w}}}return s}}const ze=new class{constructor(){Dn(this,"baseInfoMap",new Map),Dn(this,"proxyServer",void 0),Dn(this,"eventUploadTimer",void 0),Dn(this,"setSessionIdTimer",void 0),Dn(this,"url",void 0),Dn(this,"sids",new Set),Dn(this,"backupUrl",void 0),Dn(this,"_appId",void 0),Dn(this,"_aid",0),Dn(this,"keyEventUploadPendingItems",[]),Dn(this,"normalEventUploadPendingItems",[]),Dn(this,"apiInvokeUploadPendingItems",[]),Dn(this,"apiInvokeCount",0),Dn(this,"apiInvokeLoggedCount",0),Dn(this,"ltsList",[]),Dn(this,"lastSendNormalEventTime",Date.now()),Dn(this,"customReportCounterTimer",void 0),Dn(this,"customReportCount",0),Dn(this,"extApiInvoke",async t=>{for(const r of t){const i=wt(wt({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:ln.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),W("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),W("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,s]=r;return i+s}),16)||0}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!W("SHOW_REPORT_INVOKER_LOG"),p=!!W("SHOW_REPORT_USER_INVOKER_LOG"),m=u||p&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(C,U){if(m){let k="[apiInvoke-".concat(g,"]");if(r.id&&(k+="[".concat(r.id,"]")),r.name&&(k+="[".concat(r.name,"]"),r.name===Sn.JOIN))return R.info("".concat(k," ").concat(C));R.info("".concat(k," ").concat(C),C==="start"?r.options:U||"")}}const _=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null});v("start");let E=!1;vr(r.timeout).then(()=>{E||(this.sendApiInvoke(wt(wt({},_()),{},{error:H.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const w=new me(H.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:C=>{const U=()=>{if(E)throw w;return E=!0,this.sendApiInvoke(wt(wt({},_()),{},{success:!0},r.reportResult&&{result:C})),v("onSuccess"),C};return i?eV(U,r.name+"Success",i,()=>E=!0):U()},onError:C=>{const U=()=>{if(E)throw C;E=!0,this.sendApiInvoke(wt(wt({},_()),{},{success:!1,error:C})),v("onFailure",C.toString())};return i?eV(U,r.name+"Error",i,()=>E=!0):U()}}}_send(t,r,i){this.send({type:t,data:r},i)}_sendApiInvoke(t){return this.sendApiInvoke(t)}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=r.cname,s.rteUrl=r.rteUrl;const c=Object.assign({},{willUploadConsoleLog:W("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:pA?"global":"oversea",areas:W("AREAS")&&W("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:p,channelMode:m,isABTestSuccess:g,lsid:v,clientRole:_}=r,E=Date.now(),w=wt(wt({},s),{},{eventType:sr.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:fA,lts:E,elapse:E-i,extend:JSON.stringify(c),mode:r.mode,process:W("PROCESS_ID"),appType:W("APP_TYPE"),success:!0,version:cs,stringUid:u,channelProfile:p,channelMode:m,isABTestSuccess:g,lsid:v,clientType:Ne(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:W("PROCESS_ID"),extensionID:W("PLUGIN_INFO").join(",")||"",rteUrl:r.rteUrl,rteSid:r.rteSid});var C;this.send({type:wn.SESSION,data:w},!0)}reportRteDetail(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,s=Date.now(),c=wt(wt({},i),{},{eventType:sr.RTE_DETAIL,lts:s,success:!0,elapse:s-r.startTime,vid:i.vid===void 0?0:Number(i.vid),ua:navigator.userAgent});this.send({type:wn.RTE_DETAIL,data:c},!0)}joinChooseServer(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid);const c=Date.now(),u=wt(wt({},s),{},{role:r.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:wn.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{eventType:sr.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:wn.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const c=Date.now(),{firstSuccess:u,addr:p,isProxy:m}=r,g=c-i.startTime,v=wt(wt({},s),{},{eventType:sr.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:hA(),isABTestSuccess:r.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:m?1:0}),_=v.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),p)if(v.signalChannel==="1"){const E=yA(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),w=p.match(E);v.gatewayIp=w&&w.groups?w.groups.ip:"",v.gatewayPort=w&&w.groups?w.groups.port:""}else if(m){const E=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=p.match(/p=[0-9]{1,6}/g);v.gatewayIp=E&&E.length?E[0].split("=")[1].replace(/-/g,"."):"",v.gatewayPort=w&&w.length?w[0].split("=")[1]:""}else{const E=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=p.match(/(:|p=)[0-9]{1,6}/g);v.gatewayIp=E&&E.length?E[0].split("//")[1].replace(/-/g,"."):"",v.gatewayPort=w&&w.length?w[0].split(/:|p=/g)[1]:""}if(u)this.send({type:wn.JOIN_GATEWAY,data:v},!0);else{let E={isSuccess:_,port:v.gatewayPort};delete v.success,delete v.eventType,delete v.firstSuccess,delete v.gatewayPort,v.vid=Number(v.vid);const w=Object.assign({},v,E,{eventType:sr.REJOIN_GATEWAY});this.send({type:wn.RE_JOIN_GATEWAY,data:w},!0)}}joinChannelTimeout(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),c=wt(wt({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:wn.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{eventType:sr.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:wn.PUBLISH,data:u},!0)}subscribe(t,r,i){const s=this.baseInfoMap.get(t);if(!s)return;const c=s.info,u=Date.now(),p=wt(wt({},c),{},{eventType:sr.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?p.peerSuid=r.peerid:p.peer=r.peerid,this.send({type:wn.SUBSCRIBE,data:p},!0)}wsCompressorInit(t){var r;const i=[...ai(r=this.baseInfoMap).call(r)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const u=c.info,p=Date.now(),m=wt(wt({},u),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:p,eventElapse:t.eventElapse,elapse:p-c.startTime,status:t.status?1:2});this.send({type:wn.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=r.peerPubStatusMs-(i.lastJoinSuccessTime||c),p=wt(wt({},s),{},{elapse:c-i.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>u?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0,firstReceivedEncodedFrame:r.firstReceivedEncodedFrame?Math.max(r.firstReceivedEncodedFrame-r.joinChannelStart,0):void 0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""});this.send({type:wn.XLA_PEER_FIRST_VIDEO_FRAME,data:p},!0)}firstRemoteVideoDecode(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,p=Date.now(),m=wt(wt(wt({},u),s),{},{elapse:p-c.startTime,eventType:r,lts:p,firstDecodeFrame:Math.max((s.firstFrame||p)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,p=Date.now(),m=wt(wt(wt({},u),s),{},{elapse:p-c.startTime,eventType:r,lts:p});this.send({type:i,data:m},!0)}abTest(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.AB_TEST,lts:c});this.send({type:wn.AB_TEST,data:u},!0)}pcStats(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:wn.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:wn.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,p=Date.now(),m=wt(wt(wt({},u),s),{},{eventType:r,lts:p});this.send({type:i,data:m},!0)}streamSwitch(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{eventType:sr.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:wn.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wn.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:wn.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:wn.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now();(function(u,p,m){const g=u[p];if(!g||typeof g!="string")return[u];u[p]="";const v=uc(JSON.stringify(u));let _=0;const E=[];let w=0;for(let C=0;C<g.length;C++)w+=g.charCodeAt(C)<=127?1:3,w<=m-v||(E[E.length]=Ie(Ie({},u),{},{[p]:g.substring(_,C)}),_=C,w=g.charCodeAt(C)<=127?1:3);return _!==g.length-1&&(E[E.length]=Ie(Ie({},u),{},{[p]:g.substring(_)})),E})(wt(wt(wt({},s),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:wn.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:wn.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:wn.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=wt(wt(wt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:wn.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>W("CUSTOM_REPORT_LIMIT"))throw new me(H.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=r.map(c=>({type:wn.USER_ANALYTICS,data:wt(wt({sid:t},c),{},{lts:i})}));try{W("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw R.error("send custom report message failed",c.toString()),new me(H.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=W("NOT_REPORT_EVENT");if(t.tag&&Ne(r)&&Ne(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:c,cid:u}=i.info;let p;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof me){const{code:g,message:v}=t.error;p=g||v||t.error.toString()}else p=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:s,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?p:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:wn.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&t.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const i=[],s=[];for(;t.length;){const u=t.shift();i.length<20?i.push(u):s.push(u)}t.push(...s);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),vu(c=this.ltsList).call(c,(p,m)=>p-m))}return r||(this.lastSendNormalEventTime=Date.now()),W("ENABLE_EVENT_REPORT")&&i.length&&(W("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>p=>{W("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>W("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-W("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){Pn.networkState===wi.OFFLINE&&await Pe.race([Pn.onlineWaiter,vr(2*Kn.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(p=>{const m=QR(JSON.stringify(p.data)),g=new ArrayBuffer(5),v=(E=>{let w=0;return Object.entries(wn).forEach(C=>{let[U,k]=C;k===E.type&&(w=vge[U])}),w})(p),_=new DataView(g);_.setUint16(0,m.byteLength,!0),_.setUint8(2,255&v),_.setUint8(3,v>>>8&255),_.setUint8(4,v>>>16&255),u=$F(u,new Uint8Array(g)),u=$F(u,m)}),u},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(W("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await cA(s,{timeout:1e4,data:r(t),headers:wt(wt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),s=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:i,aid:s};Pn.networkState===wi.OFFLINE&&await Pe.race([Pn.onlineWaiter,vr(2*Kn.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let p=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(W("EVENT_REPORT_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(p=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(W("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(W("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(W("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(W("STATS_COLLECTOR_PORT")).concat(u)));try{r?await nge(p,{timeout:1e4,data:c}):await cA(p,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const i=Object.assign({},gge);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:ln.TRACER}).onSuccess()}};yV.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Pn.networkState,ze.reportApiInvoke(null,{name:"logUploadError",options:t,tag:ln.TRACER}).onSuccess("logUploadError")});let ce=class extends me{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Dn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}};const yr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Pt(){return yr}function xV(){return"setSinkId"in HTMLAudioElement.prototype&&(!W("RESTRICTION_SET_PLAYBACK_DEVICE")||(Qc()||AF())&&!UF())}function Vb(){return!yr.supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dc()}function tv(t){return!(_n()||IF(87)||Vb()||!W("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}function EV(t){return W("ENABLE_INSTANT_VIDEO")?W("ENABLE_INSTANT_VIDEO"):!(t==null||!t.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB"))}function SV(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function wV(){if(SV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in t)||!t.suppressLocalAudioPlayback)}return wo(141)||id(141)||Cu(141)}function TV(){if(SV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in t)||!t.restrictOwnAudio)}return wo(141)||id(141)||Cu(125)}let Mr=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Gp(t,r,i){return{sampleRate:t,stereo:r,bitrate:i}}function Ht(t,r,i,s,c){return{width:t,height:r,frameRate:i,bitrateMin:s,bitrateMax:c}}function Gs(t,r,i,s,c){return{width:{max:t},height:{max:r},frameRate:i,bitrateMin:s,bitrateMax:c}}function bA(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const yge={"90p":Ht(160,90),"90p_1":Ht(160,90),"120p":Ht(160,120,15,30,65),"120p_1":Ht(160,120,15,30,65),"120p_3":Ht(120,120,15,30,50),"120p_4":Ht(212,120),"180p":Ht(320,180,15,30,140),"180p_1":Ht(320,180,15,30,140),"180p_3":Ht(180,180,15,30,100),"180p_4":Ht(240,180,15,30,120),"240p":Ht(320,240,15,40,200),"240p_1":Ht(320,240,15,40,200),"240p_3":Ht(240,240,15,40,140),"240p_4":Ht(424,240,15,40,220),"360p":Ht(640,360,15,80,400),"360p_1":Ht(640,360,15,80,400),"360p_3":Ht(360,360,15,80,260),"360p_4":Ht(640,360,30,80,600),"360p_6":Ht(360,360,30,80,400),"360p_7":Ht(480,360,15,80,320),"360p_8":Ht(480,360,30,80,490),"360p_9":Ht(640,360,15,80,800),"360p_10":Ht(640,360,24,80,800),"360p_11":Ht(640,360,24,80,1e3),"480p":Ht(640,480,15,100,500),"480p_1":Ht(640,480,15,100,500),"480p_2":Ht(640,480,30,100,1e3),"480p_3":Ht(480,480,15,100,400),"480p_4":Ht(640,480,30,100,750),"480p_6":Ht(480,480,30,100,600),"480p_8":Ht(848,480,15,100,610),"480p_9":Ht(848,480,30,100,930),"480p_10":Ht(640,480,10,100,400),"720p":Ht(1280,720,15,120,1130),"720p_auto":Ht(1280,720,30,900,3e3),"720p_1":Ht(1280,720,15,120,1130),"720p_2":Ht(1280,720,30,120,2e3),"720p_3":Ht(1280,720,30,120,1710),"720p_5":Ht(960,720,15,120,910),"720p_6":Ht(960,720,30,120,1380),"1080p":Ht(1920,1080,15,120,2080),"1080p_1":Ht(1920,1080,15,120,2080),"1080p_2":Ht(1920,1080,30,120,3e3),"1080p_3":Ht(1920,1080,30,120,3150),"1080p_5":Ht(1920,1080,60,120,4780),"1440p":Ht(2560,1440,30,120,4850),"1440p_1":Ht(2560,1440,30,120,4850),"1440p_2":Ht(2560,1440,60,120,7350),"4k":Ht(3840,2160,30,120,8910),"4k_1":Ht(3840,2160,30,120,8910),"4k_3":Ht(3840,2160,60,120,13500)},_ge={"480p":Gs(640,480,5),"480p_1":Gs(640,480,5),"480p_2":Gs(640,480,30),"480p_3":Gs(640,480,15),"720p":Gs(1280,720,5),"720p_auto":Ht(1280,720,30,900,3e3),"720p_1":Gs(1280,720,5),"720p_2":Gs(1280,720,30),"720p_3":Gs(1280,720,15),"1080p":Gs(1920,1080,5),"1080p_1":Gs(1920,1080,5),"1080p_2":Gs(1920,1080,30),"1080p_3":Gs(1920,1080,15)},bge={"1SL1TL":bA(1,1),"3SL3TL":bA(3,3),"2SL3TL":bA(2,3)};function Ws(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},yge[t]):t}function xA(t){return typeof t=="string"?Object.assign({},_ge[t]):t}function Bb(t){return typeof t=="string"?Object.assign({},bge[t]):t}const xge={speech_low_quality:Gp(16e3,!1),speech_standard:Gp(32e3,!1,18),music_standard:Gp(48e3,!1),standard_stereo:Gp(48e3,!0,56),high_quality:Gp(48e3,!1,128),high_quality_stereo:Gp(48e3,!0,192)};function Gb(t){return typeof t=="string"?Object.assign({},xge[t]):t}const ju=[];function CV(t){return zn(t,"mediaSource",["screen","window","application"]),!0}let Ke=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Jt=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Wp=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Ege=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Sge=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Lu=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),$p=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),ds=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Hp=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),La=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const EA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},SA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},NV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},RV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ci=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ma=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),nv=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Mu=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Jr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),hc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const wA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Wb=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Ft(t,r,i,s,c){var u,p,m={};return Object.keys(s).forEach(function(g){m[g]=s[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=ss(u=nL(p=i.slice()).call(p)).call(u,function(g,v){return v(t,r,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function de(t,r,i){return(r=function(s){var c=function(u,p){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function AV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function vn(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?AV(Object(i),!0).forEach(function(s){de(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):AV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class IV extends Nn{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(Lu.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),de(this,"trackMediaType",void 0),de(this,"_ID",void 0),de(this,"_rtpTransceiver",void 0),de(this,"_lowRtpTransceiver",void 0),de(this,"_hints",[]),de(this,"_isClosed",!1),de(this,"_originMediaStreamTrack",void 0),de(this,"mediaStreamTrack",void 0),de(this,"_external",{}),this._ID=i||Zt(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(s){Ne(ju).call(ju,s)||ju.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||ad(()=>{var i;ze.reportApiInvoke(null,{name:Sn.GET_MEDIA_STREAM_TRACK,options:[],tag:ln.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Wp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=ju.indexOf(r);i!==-1&&ju.splice(i,1)}(this),this.emit($p.CLOSED),this.removeAllListeners(Lu.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Wp.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(Lu.TRANSCEIVER_UPDATED,r,i)}}class zp extends IV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),de(this,"_enabled",!0),de(this,"_muted",!1),de(this,"_isExternalTrack",!1),de(this,"_isClosed",!1),de(this,"_enabledMutex",void 0),de(this,"processor",void 0),de(this,"_processorContext",void 0),de(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Nr("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ke.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pn(this,Ke.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($p.TRACK_ENDED)}stateCheck(r,i){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),Fs(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new me(H.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new me(H.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Pe.resolve([])}}const OV=window.AudioContext||window.webkitAudioContext;let TA,Ua=null;const sn=new class extends Nn{constructor(){super(...arguments),de(this,"prevState",void 0),de(this,"curState",void 0),de(this,"currentTime",void 0),de(this,"currentTimeStuckAt",void 0),de(this,"interruptDetectorTrack",void 0),de(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Mr.IOS_15_16_INTERRUPTION_START)}),de(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Ua&&await Ua.suspend(),this.emit(Mr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){R.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){R.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Kp(){if(!Ua){if(function(){if(!OV)return void R.error("your browser is not support web audio");R.info("create audio context");const t=vn({},W("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(t)),Ua=new OV(t),sn.curState=Ua.state,Ua.onstatechange=()=>{sn.prevState=sn.curState,sn.curState=Ua?Ua.state:void 0;const{prevState:r,curState:i}=sn,s=i==="running",c=i==="interrupted",u=r==="running",p=r==="suspended",m=r==="interrupted",g=$t().osVersion;(ii()||Us())&&u&&c&&(R.info("ios".concat(g,"-interruption-start")),sn.emit(Mr.IOS_INTERRUPTION_START)),(ii()||Us())&&(p||m)&&s&&(R.info("ios".concat(g,"-interruption-end")),sn.emit(Mr.IOS_INTERRUPTION_END)),r!==i&&sn.emit(Mr.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Ua)===null||r===void 0?void 0:r.currentTime;sn.currentTime!==i?(sn.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),sn.currentTimeStuckAt=void 0),sn.currentTime=i):(i!==sn.currentTimeStuckAt&&(ze.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:ln.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),sn.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c,u=!1,p=!1,m=!1;function g($){r.state==="running"?v(!1):ii()||Us()?r.state==="suspended"&&(v(!0),$&&r.resume().then(_,_)):r.state!=="closed"&&(v(!0),$&&r.resume().then(_,_))}function v($){if(u!==$){u=$;for(let K=0,J=i;K<J.length;K+=1){const ne=J[K];$?window.addEventListener(ne,E,{capture:!0,passive:!0}):window.removeEventListener(ne,E,{capture:!0,passive:!0})}}}function _(){g(!1)}function E(){g(!0)}function w(){let $;try{$=s.play(),$?$.then(k,k):(s.addEventListener("playing",k),s.addEventListener("abort",k),s.addEventListener("error",k))}catch{k()}}function C($){m||(s.paused?$?(U(!1),m=!0,w()):U(!0):U(!1))}function U($){if(p!==$){p=$;for(let K=0,J=i;K<J.length;K++){const ne=J[K];$?window.addEventListener(ne,j,{capture:!0,passive:!0}):window.removeEventListener(ne,j,{capture:!0,passive:!0})}}}function k(){s.removeEventListener("playing",k),s.removeEventListener("abort",k),s.removeEventListener("error",k),m=!1,C(!1)}function j(){C(!0)}if(ii()&&W("IOS_BG_TAG")){const $=r.createMediaStreamDestination(),K=document.createElement("div");K.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=K.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=$.stream,c=()=>{if(W("IOS_AUTO_RESTART_BG_TAG")&&s&&s.srcObject&&!m&&(!s.paused||p!==!0)){s.paused||s.pause();try{m=!0,w()}catch{m=!1}return!0}},C(!0)}return sn.on(Mr.STATE_CHANGE,function(){g(!0)}),g(!1),c}(Ua).then(r=>{TA=r})}(),!Ua)throw new me(H.NOT_SUPPORTED,"can not create audio context");return Ua}return Ua}function Uu(t){if(function(){if(CA!==null)return CA;const s=Kp(),c=s.createBufferSource(),u=s.createGain(),p=s.createGain();c.connect(u),c.connect(p),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),CA=m,m}())return;const r=t.connect,i=t.disconnect;t.connect=(s,c,u)=>{var p;return t._inputNodes||(t._inputNodes=[]),Ne(p=t._inputNodes).call(p,s)||(s instanceof AudioNode?(t._inputNodes.push(s),r.call(t,s,c,u)):r.call(t,s,c)),t},t.disconnect=(s,c,u)=>{i.call(t),s?Ib(t._inputNodes,s):t._inputNodes=[];for(const p of t._inputNodes)r.call(t,p)}}let CA=null;function NA(t,r){let i=!1;const s=1/r;if(W("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):t(performance.now()/1e3)},1e3*s)}else{const c=Kp();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const p=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=p,m.connect(u),m.start(0),m.stop(c.currentTime+s),t(c.currentTime)};p()}return()=>{i=!0}}class PV{constructor(){de(this,"context",void 0),de(this,"analyserNode",void 0),de(this,"sourceNode",void 0),this.context=Kp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ii()||Us()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<r.length;++c)r[c]=s[c]/128-1}const i=ss(r).call(r,(s,c)=>s+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class DV extends Nn{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),de(this,"outputNode",void 0),de(this,"outputTrack",void 0),de(this,"isPlayed",!1),de(this,"sourceNode",void 0),de(this,"context",void 0),de(this,"audioBufferNode",void 0),de(this,"destNode",void 0),de(this,"audioOutputLevel",0),de(this,"volumeLevelAnalyser",void 0),de(this,"_processedNode",void 0),de(this,"playNode",void 0),de(this,"isDestroyed",!1),de(this,"onNoAudioInput",void 0),de(this,"isNoAudioInput",!1),de(this,"_noAudioInputCount",0),this.context=Kp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Uu(this.outputNode),this.volumeLevelAnalyser=new PV}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(La.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const u=s.outputBuffer.getChannelData(c);for(let p=0;p<u.length;p+=1)u[p]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Pt().webAudioMediaStreamDest)throw new me(H.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&Ob(()=>{sn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ii()||Us()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let s;i.getFloatTimeDomainData?(s=new Float32Array(i.fftSize),i.getFloatTimeDomainData(s)):(s=new Uint8Array(i.fftSize),i.getByteTimeDomainData(s));let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await vr(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class RA extends DV{get isFreeze(){return!1}constructor(r,i,s){var c;if(super(),de(this,"sourceNode",void 0),de(this,"track",void 0),de(this,"clonedTrack",void 0),de(this,"audioElement",void 0),de(this,"isCurrentTrackCloned",!1),de(this,"isRemoteTrack",!1),de(this,"originVolumeLevelAnalyser",void 0),de(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Uu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Uu(this.outputNode),this.emit(La.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new me(H.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),Uu(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,R.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Uu(g),this.originVolumeLevelAnalyser=new PV,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const p=$t();i&&p.os===gr.IOS&&Number((c=p.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(sn.on(Mr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),Uu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(La.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),sn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),R.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));Uu(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function kV(t,r,i){const s=(u,p)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||p:u:p,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Tge(t,r){const i=await jV(t.mediaSource),{sourceId:s,audio:c}=await function(u){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Pe((m,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");const w=document.createElement("div");w.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const U=document.createElement("button");U.innerHTML="cancel",U.setAttribute("style","width: 85px;"),U.onclick=()=>{document.body.removeChild($);const K=new Error("NotAllowedError");K.name="NotAllowedError",g(K)};let k=p;const j=document.createElement("div");if(p){const K=document.createElement("input");K.setAttribute("type","checkbox");const J=document.createElement("span");K.setAttribute("style","margin-right: 6px;"),J.innerText="Share audio",K.checked=k,K.onchange=()=>{k=K.checked},j.appendChild(K),j.appendChild(J)}C.appendChild(j),C.appendChild(U),_.appendChild(E),_.appendChild(w),_.appendChild(C);const $=document.createElement("div");$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),$.appendChild(v),$.appendChild(_),document.body.appendChild($),u.map(K=>{if(K.id){const J=document.createElement("div");J.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ne=K.thumbnail;try{const{width:ae}=ne.getSize();ae>1920&&(ne=ne.resize({width:1920}))}catch(ae){throw ae&&ae.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ae}J.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ne.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+K.name.replace(/[\u00A0-\u9999<>\&]/g,function(ae){return"&#"+ae.charCodeAt(0)+";"})+"</span>",J.onclick=()=>{document.body.removeChild($),m({sourceId:K.id,audio:k})},w.appendChild(J)}})})}(i,r);return await kV(s,t,c)}async function jV(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const i=HF();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new me(H.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new Pe((u,p)=>{i.desktopCapturer.getSources({types:r},(m,g)=>{m?p(m):u(g)})}));try{return await s}catch(u){throw new me(H.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const AA=new Nr("safari");let LV=!1,MV=!1;async function Fa(t,r){let i=0,s=null;for(;i<2;)try{s=await Cge(t,r,i>0);break}catch(c){if(c instanceof me)throw R.error("[".concat(r,"] ").concat(c.toString())),c;const u=$b(c.name||c.code||c,c.message);if(u.code===H.MEDIA_OPTION_INVALID){R.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await vr(500);continue}throw R.error("[".concat(r,"] ").concat(u.toString())),u}if(!s)throw new me(H.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function Cge(t,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new me(H.NOT_SUPPORTED,"can not find getUserMedia");i&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const s=Pt(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return R.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(HF())t.screen.sourceId?Yp(c,await kV(t.screen.sourceId,t.screen,!!t.screenAudio)):Yp(c,await Tge(t.screen,!!t.screenAudio));else if(Qc()&&t.screen.extensionId&&t.screen.mandatory){if(!s.getStreamFromExtension)throw new me(H.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const w=await(p=t.screen.extensionId,m=r,new Pe((C,U)=>{try{chrome.runtime.sendMessage(p,{getStream:!0},k=>{if(!k||!k.streamId)return R.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),k),void U(new me(H.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(k.streamId)})}catch(k){R.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(p,")"),k.toString()),U(new me(H.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=w,Yp(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(s.getDisplayMedia){var u;t.screen.mediaSource&&CV(t.screen.mediaSource);const w={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:U,systemAudio:k,preferCurrentTab:j,windowAudio:$,monitorTypeSurfaces:K}=t.screen,J={selfBrowserSurface:C,surfaceSwitching:U,systemAudio:k,preferCurrentTab:j,windowAudio:$,monitorTypeSurfaces:K};!C&&delete J.selfBrowserSurface,!U&&delete J.surfaceSwitching,!k&&delete J.systemAudio,!j&&delete J.preferCurrentTab,!$&&delete J.windowAudio,!K&&delete J.monitorTypeSurfaces,R.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:w,audio:t.screenAudio,controls:J})),Yp(c,await navigator.mediaDevices.getDisplayMedia(vn({video:w,audio:t.screenAudio},J)))}else{if(!_n())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new me(H.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&CV(t.screen.mediaSource);const w={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};R.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(w))),Yp(c,await navigator.mediaDevices.getUserMedia(w))}}var p,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},v=W("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=rA(g,v)}catch{}R.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),$t();let _,E=null;(Cr()||ii()||Ab())&&(E=await AA.lock());try{_=await navigator.mediaDevices.getUserMedia(g)}catch(w){throw E&&E(),w}return g.audio&&(LV=!0),g.video&&(MV=!0),Yp(c,_),E&&E(),c}function $b(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new me(H.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new me(H.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new me(H.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new me(H.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new me(H.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new me(H.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return R.error("getUserMedia unexpected error",t),new me(H.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Yp(t,r){const i=t.getVideoTracks()[0],s=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(s&&t.removeTrack(s),t.addTrack(u)),c&&(i&&t.removeTrack(i),t.addTrack(c))}const Va=new class extends Nn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Mu.STATE_CHANGE,t),this._state=t)}constructor(){super(),de(this,"_state",nv.IDLE),de(this,"isAccessMicrophonePermission",!1),de(this,"isAccessCameraPermission",!1),de(this,"lastAccessMicrophonePermission",!1),de(this,"lastAccessCameraPermission",!1),de(this,"checkdeviceMatched",!1),de(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(W("ENUMERATE_DEVICES_INTERVAL")||(Kg()||Rb()===gr.HARMONY_OS)&&dc())&&this.updateDevicesInfo()},W("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>R.error(t.toString()))}async enumerateDevices(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new me(H.NOT_SUPPORTED,"enumerateDevices() not supported.");const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let u=!this.isAccessMicrophonePermission&&t,p=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(p=!1);let m=null,g=null,v=null;if(!i&&(u||p)){if(AA.isLocked&&(R.debug("[device manager] wait GUM lock"),(await AA.lock())(),R.debug("[device manager] GUM unlock")),LV&&(u=!1,this.isAccessMicrophonePermission=!0),MV&&(p=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",t,r,u,p),u&&p){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const E=$b(_.name||_.code||_,_.message);if(E.code===H.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(_){const E=$b(_.name||_.code||_,_.message);if(E.code===H.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(p){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(_){const E=$b(_.name||_.code||_,_.message);if(E.code===H.PERMISSION_DENIED)throw E;R.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",t,"cam permission",r)}try{const _=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(E=>E.stop()),g&&g.getTracks().forEach(E=>E.stop()),v&&v.getTracks().forEach(E=>E.stop()),m=null,g=null,v=null,_}catch(_){return m&&m.getTracks().forEach(E=>E.stop()),g&&g.getTracks().forEach(E=>E.stop()),v&&v.getTracks().forEach(E=>E.stop()),m=null,g=null,v=null,new me(H.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===t&&(r=i.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===t);if(!r)throw new me(H.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=nv.INITING;try{await this.updateDevicesInfo(),this.state=nv.INITEND}catch(t){throw this.state=nv.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(R.warning("Device Detection functionality cannot start properly.",t.toString()),t):new me(H.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(p=>p.kind==="audioinput"&&p.deviceId==="default"),u=t.find(p=>p.kind==="audiooutput"&&p.deviceId==="default");c&&u?u.groupId===c.groupId?R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):R.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const p={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),p),i.push(p)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==nv.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Mu.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Mu.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Mu.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),i=t.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let IA=!1;const Mi=new class extends Nn{constructor(){super(...arguments),de(this,"onAutoplayFailed",void 0),de(this,"onAudioAutoplayFailed",void 0)}};function UV(){if(IA)return W("FLS_AUTOPLAY_EMITS")?(Mi.onAutoplayFailed&&Mi.onAutoplayFailed(),Mi.emit("autoplay-failed")):void 0;{const t=r=>{r.preventDefault(),IA=!1,Yg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};IA=!0,Yg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Mi.onAutoplayFailed?Mi.onAutoplayFailed():Mi.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Mi.emit("autoplay-failed")}}function FV(t,r,i,s){if(!t)return;const c=ze.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,p=Date.now(),m=vn(vn({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:p,elapse:p-c.startTime,cbRegistered:Mi.onAutoplayFailed||Mi.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:s,extend:void 0});ze.send({type:wn.AUTOPLAY_FAILED,data:m},!0)}const Nge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],di=new class{constructor(){de(this,"onAutoplayFailed",void 0),de(this,"elementMap",new Map),de(this,"elementStateMap",new Map),de(this,"elementsNeedToResume",[]),de(this,"sinkIdMap",new Map),de(this,"autoResumeAfterInterruption",t=>Pe.all(Array.from(this.elementMap.entries()).map(async r=>{let[i,s]=r;const c=this.elementStateMap.get(i),u=s.srcObject.getAudioTracks()[0],p=u&&u.readyState;if(R.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(p," ").concat(t)),p==="live"){if(t)return s.pause(),s.play();if(sn.curState==="running")return kp()?(s.pause(),s.play()):c&&c==="paused"?s.play():void 0}}))),de(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t;const s=i.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),sn.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),sn.on(Mr.STATE_CHANGE,()=>{ii()&&sn.prevState==="suspended"&&sn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const i=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),i)try{await i.setSinkId(r)}catch(s){throw new me(H.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(t,r,i,s){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Jr.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{R.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){R.warning("[".concat(r,"] set sink id failed"),m.toString())}const p=c.play();p&&p.then&&p.catch(m=>{s&&FV(s,"audio",m.message,r),R.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),Ob(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),UV()}))})}updateTrack(t,r){const i=this.elementMap.get(t);i&&(i.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const i=this.elementMap.get(t);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}getVolume(t){const r=this.elementMap.get(t);return r?r.volume:0}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Nge.forEach(i=>{r.addEventListener(i,s=>{const c=this.elementStateMap.get(t),u=s.type==="pause"?"paused":s.type;if(R.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),s.type==="error"){const p=r==null?void 0:r.error;p&&R.error("[".concat(t,"] media error, code: ").concat(p.code,", message: ").concat(p.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new Pe(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Yg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Ln(){return function(t,r,i){const s=i.value;return typeof s=="function"&&(i.value=function(){this._isClosed&&new me(H.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var c=arguments.length,u=new Array(c),p=0;p<c;p++)u[p]=arguments[p];const m=s.apply(this,u);return m instanceof Pe?new Pe((g,v)=>{m.then(g).catch(v)}):m}),i}}class VV extends Nn{constructor(r){super(),de(this,"name","VideoProcessorDestination"),de(this,"ID","0"),de(this,"_source",void 0),de(this,"videoContext",void 0),de(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new me(H.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new me(H.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Ci.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ci.ON_TRACK,void 0)}}class BV extends Nn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),de(this,"constraintsMap",new Map),de(this,"statsRegistry",[]),de(this,"usageRegistry",[]),de(this,"trackId",void 0),de(this,"direction",void 0),de(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await er(this,Ma.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),pn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(va(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return R.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),pn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(va(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const p=u();r.push({processorID:i,processorName:s,type:c,stats:p})}catch(p){R.error(new me(H.UNEXPECTED_ERROR,p.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Pe&&(s=await s),r.push(vn(vn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class GV extends Nn{constructor(r){super(),de(this,"name","AudioProcessorDestination"),de(this,"ID","0"),de(this,"inputTrack",void 0),de(this,"inputNode",void 0),de(this,"audioProcessorContext",void 0),de(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new me(H.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new me(H.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ci.ON_TRACK,void 0),this.emit(Ci.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Ci.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Ci.ON_NODE,this.inputNode))}}class WV extends Nn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,s){super(),de(this,"constraintsMap",new Map),de(this,"statsRegistry",[]),de(this,"audioContext",void 0),de(this,"trackId",void 0),de(this,"direction",void 0),de(this,"usageRegistry",[]),de(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=s}async getConstraints(){return er(this,Ma.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),pn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(va(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),pn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(va(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const p=u();r.push({processorID:i,processorName:s,type:c,stats:p})}catch(p){R.error(new me(H.UNEXPECTED_ERROR,p.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof Pe&&(s=await s),r.push(vn(vn({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class OA extends Nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),de(this,"context",void 0),de(this,"processSourceNode",void 0),de(this,"outputTrack",void 0),de(this,"processedNode",void 0),de(this,"clonedTrack",void 0),de(this,"outputNode",void 0),this.outputNode=new Rge}setVolume(){}createOutputTrack(){throw new me(H.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Rge{disconnect(){}connect(){}}function $V(t){return new Pe((r,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=ii()?"canplay":"playing";c.addEventListener(u,()=>{const p=c.videoWidth,m=c.videoHeight;!p&&_n()||(s=!0,c.srcObject=null,c.remove(),r([p,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(Jg),setTimeout(()=>{s||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function Hb(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const i=Ws(t.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!MF()&&i.frameRate&&(r.frameRate=i.frameRate),AF()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),_n()&&(r.frameRate={ideal:30,max:30}),r}function HV(t){const r={};return MF()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,Qc()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function zV(t){const r=HV(t);if(t.encoderConfig){const i=Gb(t.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),Kg()&&(r.sampleRate=void 0),r}const KV=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:i,width:s,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=i,width:p=s,height:m=c}=r;if(!u||!p||!m)return;p=Mp(p),m=Mp(m),u=Mp(u);const{max:g,min:v}=function(C,U,k){const j=200*Math.pow(k/15,.6)*Math.pow(C*U/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(p,m,u),{bitrateMax:_,bitrateMin:E}=r||{};_||R.debug("calculate bitrate: [w: ".concat(p,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(_,", brMin: ").concat(E,"]"));const{maxFramerate:w}=W("ENCODER_CONFIG_LIMIT");return w&&typeof w=="number"&&(u=Math.min(u,w)),{frameRate:u,bitrateMax:_||g,bitrateMin:E||v,scaleResolutionDownBy:1,scale:0}},YV=async(t,r,i)=>await(async(s,c,u)=>{const p=function(v){const _=[];for(let E=0;E<v.length;E+=2)_.push(parseInt(v.slice(E,E+2),16));return Uint8Array.from(_)}(rV(""+c+u)).slice(0,16),m=p.slice(0,12),g=await window.crypto.subtle.importKey("raw",p,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,s))})(t.buffer,r,i),PA=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new Pe((i,s)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await qV(c);i({buffer:u,width:r.width,height:r.height})}else s(new me(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},qV=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var XV,JV,QV,ZV,eB,tB,nB,rB,iB,aB,sB,oB,cB,lB,dB,uB,hB,pB,In,mB,fB,gB,vB,yB,_B,pc,bB,xB,EB,SB,wB,TB,CB,NB,RB,AB,IB,OB,PB,Hr;let Mn=(XV=st({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),JV=st({argsMap:(t,r)=>[t.getTrackId(),r]}),QV=Ln(),ZV=Up("LocalAudioTrack","_enabledMutex"),eB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),tB=Ln(),nB=Up("LocalAudioTrack","_enabledMutex"),rB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),iB=Ln(),aB=Ln(),sB=Ln(),oB=st({argsMap:t=>[t.getTrackId()]}),cB=Ln(),lB=st({argsMap:t=>[t.getTrackId()]}),dB=Ln(),uB=st({argsMap:t=>[t.getTrackId()]}),hB=st({argsMap:(t,r)=>[t.getTrackId(),r.name]}),pB=st({argsMap:t=>[t.getTrackId()]}),Ft((In=class extends zp{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?di.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,i,s){super(t,i),de(this,"trackMediaType",Hp.AUDIO),de(this,"_encoderConfig",void 0),de(this,"_trackSource",void 0),de(this,"metadata",[]),de(this,"_enabled",!0),de(this,"_volume",100),de(this,"_useAudioElement",!0),de(this,"_bypassWebAudio",!1),de(this,"processor",void 0),de(this,"_processorContext",void 0),de(this,"_processorDestination",void 0),de(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s,this._trackSource=new OA,W("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),W("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Cr()&&!Ua?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){cn(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&di.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,pn(this,Ke.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!xV())throw new me(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await di.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,i){return this._setEnabled(t,r,i)}async _setEnabled(t,r,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await pn(this,Ke.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await pn(this,Ke.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await pn(this,Ke.NEED_MUTE_TRACK,this):await pn(this,Ke.NEED_UNMUTE_TRACK,this))}getStats(){return ad(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ba(this,Ke.GET_STATS)||vn({},EA)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(La.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(La.ON_AUDIO_BUFFER),this._source.on(La.ON_AUDIO_BUFFER,i=>t(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),di.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?di.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&di.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pn(this,Ke.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Pe.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new me(H.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new me(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Ci.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await pn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pn(this,Ke.NEED_REPLACE_TRACK,this))}),t.on(Ci.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Ci.ON_TRACK),t.removeAllListeners(Ci.ON_NODE)}bindProcessorContextEvents(t){t.on(Ma.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ma.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof OA&&(this._trackSource=new RA(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new WV(this._source.context,this.getTrackId(),"local"),r=new GV(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(La.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(di.stop(this.getTrackId()),this._source.play()),pn(this,Ke.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[XV],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),Ft(In.prototype,"setPlaybackDevice",[JV,QV],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),Ft(In.prototype,"setEnabled",[ZV,eB,tB],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),Ft(In.prototype,"setMuted",[nB,rB,iB],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),Ft(In.prototype,"getStats",[aB],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),Ft(In.prototype,"setAudioFrameCallback",[sB],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),Ft(In.prototype,"play",[oB,cB],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),Ft(In.prototype,"stop",[lB,dB],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),Ft(In.prototype,"close",[uB],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),Ft(In.prototype,"pipe",[hB],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),Ft(In.prototype,"unpipe",[pB],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),rv=(mB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),fB=Ln(),gB=Up("MicrophoneAudioTrack","_enabledMutex"),vB=st({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),yB=Ln(),_B=st({argsMap:t=>[t.getTrackId()]}),Ft((pc=class extends Mn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,i,s){super(t,r.encoderConfig?Gb(r.encoderConfig):{},s,W("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),de(this,"_config",void 0),de(this,"_deviceName","default"),de(this,"_constraints",void 0),de(this,"_originalConstraints",void 0),de(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(kp()||qR())&&sn.bindInterruptDetectorTrack(this)}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Va.getDeviceById(t),i={};i.audio=vn({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Fa(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Fa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Va.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,i){if(r)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),W("AUTO_RESET_AUDIO_ROUTE")&&(ii()||Us())){const p=navigator.audioSession;p&&(t||(p.type="playback"),p.type="auto")}if(!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await pn(this,Ke.NEED_DISABLE_TRACK,this)}catch(p){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),p.toString()),p}return}const c=vn({},this._constraints),u=Va.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const p=await Fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),await pn(this,Ke.NEED_ENABLE_TRACK,this)}catch(p){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),p.toString()),p}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(kp()||qR())&&sn.unbindInterruptDetectorTrack(this),ju.some(t=>function(r){return"__className__"in r&&r.__className__==="MicrophoneAudioTrack"}(t))||TA&&TA()&&(ze.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:ln.TRACER}).onSuccess(),R.debug("restart background audio tag success"))}onTrackEnded(){if((ii()||Us())&&this._enabled&&!this._isClosed&&sn.duringInterruption){const t=async()=>{sn.off(Mr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sn.on(Mr.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($p.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,i=Va.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const s=await Fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ma.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ma.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[mB,fB],Object.getOwnPropertyDescriptor(pc.prototype,"setDevice"),pc.prototype),Ft(pc.prototype,"setEnabled",[gB,vB,yB],Object.getOwnPropertyDescriptor(pc.prototype,"setEnabled"),pc.prototype),Ft(pc.prototype,"close",[_B],Object.getOwnPropertyDescriptor(pc.prototype,"close"),pc.prototype),pc),Age=(bB=st({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),xB=Ln(),EB=st({argsMap:t=>[t.getTrackId()]}),SB=Ln(),wB=st({argsMap:t=>[t.getTrackId()]}),TB=Ln(),CB=st({argsMap:t=>[t.getTrackId()]}),NB=Ln(),RB=st({argsMap:t=>[t.getTrackId()]}),AB=Ln(),IB=st({argsMap:t=>[t.getTrackId()]}),OB=st({argsMap:t=>[t.getTrackId()]}),PB=Ln(),Ft((Hr=class extends Mn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,i,s){super(r.createOutputTrack(),i,s),de(this,"source",void 0),de(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(La.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit($p.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){cn(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[bB,xB],Object.getOwnPropertyDescriptor(Hr.prototype,"startProcessAudioBuffer"),Hr.prototype),Ft(Hr.prototype,"pauseProcessAudioBuffer",[EB,SB],Object.getOwnPropertyDescriptor(Hr.prototype,"pauseProcessAudioBuffer"),Hr.prototype),Ft(Hr.prototype,"seekAudioBuffer",[wB,TB],Object.getOwnPropertyDescriptor(Hr.prototype,"seekAudioBuffer"),Hr.prototype),Ft(Hr.prototype,"resumeProcessAudioBuffer",[CB,NB],Object.getOwnPropertyDescriptor(Hr.prototype,"resumeProcessAudioBuffer"),Hr.prototype),Ft(Hr.prototype,"stopProcessAudioBuffer",[RB,AB],Object.getOwnPropertyDescriptor(Hr.prototype,"stopProcessAudioBuffer"),Hr.prototype),Ft(Hr.prototype,"close",[IB],Object.getOwnPropertyDescriptor(Hr.prototype,"close"),Hr.prototype),Ft(Hr.prototype,"setAudioBufferPlaybackSpeed",[OB,PB],Object.getOwnPropertyDescriptor(Hr.prototype,"setAudioBufferPlaybackSpeed"),Hr.prototype),Hr);class or extends Mn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Kp().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Zt(8,"track-mix-")),de(this,"trackList",void 0),de(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}Ib(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof or?i.emit(Lu.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class Ige extends DV{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(La.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),de(this,"audioBuffer",void 0),de(this,"sourceNode",void 0),de(this,"startPlayTime",0),de(this,"startPlayOffset",0),de(this,"pausePlayTime",0),de(this,"options",void 0),de(this,"currentLoopCount",0),de(this,"currentPlaybackSpeed",100),de(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const DB=new Map;function kB(t,r){if(t.length===0||r.length===0)return 1/0;const i=aA(t),s=aA(r);return Math.floor(s/i)}class DA{get rendFrameRate(){const r=Math.max(1,kB(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Jr.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){de(this,"trackId",void 0),de(this,"config",void 0),de(this,"onFirstVideoFrameDecoded",void 0),de(this,"onFirstVideoFrameRender",void 0),de(this,"onVideoBufferReady",void 0),de(this,"onVideoStateChanged",void 0),de(this,"freezeTimeCounterList",[]),de(this,"renderFreezeAccTime",0),de(this,"renderFreezeAccTime2",0),de(this,"isKeepLastFrame",!1),de(this,"isDestroyed",!1),de(this,"timeUpdatedCount",0),de(this,"freezeTime",0),de(this,"playbackTime",0),de(this,"lastTimeUpdatedTime",0),de(this,"autoplayFailed",!1),de(this,"videoTrack",void 0),de(this,"videoElement",void 0),de(this,"cacheVideoElement",void 0),de(this,"cancelRVFId",void 0),de(this,"internal",!1),de(this,"_render_interframe_delays",[]),de(this,"_render_interframe_delays_sizes",[]),de(this,"_videoState",hc.VideoStateStopped),de(this,"videoElementCheckInterval",void 0),de(this,"videoElementFreezeTimeout",void 0),de(this,"_videoElementStatus",Jr.NONE),de(this,"_isInPage",!0),de(this,"isGettingVideoDimensions",!1),de(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),de(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&sn.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NF())),jF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),de(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Jr.PLAYING;break;case"loadeddata":if(this.videoState=hc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Jr.CANPLAY;break;case"stalled":this.videoElementStatus=Jr.STALLED;break;case"suspend":this.videoElementStatus=Jr.SUSPEND;break;case"pause":this.videoElementStatus=Jr.PAUSED,ii()||Us()||Cr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Jr.WAITING;break;case"abort":this.videoElementStatus=Jr.ABORT;break;case"ended":this.videoElementStatus=Jr.ENDED;break;case"emptied":this.videoElementStatus=Jr.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=Jr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>W("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,xa.lastVisibleTime<xa.lastHiddenTime||u<xa.lastHiddenTime||u<xa.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>W("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const p=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(p),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),de(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(NF())),jF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),sn.on(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.on(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&FV(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});const s=$t();if((s.name==="Safari"&&Number(s.version)===15||kp())&&i&&i.then){const c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return R.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const s=i.getImageData(0,0,r.width,r.height);return r.remove(),s}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new Pe((u,p)=>{s.toBlob(async m=>{if(s.remove(),m){const g=await qV(m);u({buffer:g,width:s.width,height:s.height})}else p(new me(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await PA(r)}destroy(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,sn.off(Mr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sn.off(Mr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),r?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=hc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Jr.INIT,!this.videoElementCheckInterval&&(jB.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(u){return u!==document.body&&document.body.contains(u)}(this.videoElement)},1e3),W("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const p=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",p),this.videoElementFreezeTimeout=window.setTimeout(m,W("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===hc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=hc.VideoStateFrozen:document.addEventListener("visibilitychange",p))},g=(v,_)=>{if(this.videoElementStatus===Jr.PLAYING){if(u){const C=_.presentationTime-u.presentationTime,U=_.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(U),this._render_interframe_delays.push(C);const k=aA(this._render_interframe_delays_sizes),j=k-this._render_interframe_delays_sizes[0];if(k>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===hc.VideoStateStarting&&(this.videoState=hc.VideoStateDecoding),this.videoState===hc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,W("VIDEO_FREEZE_DURATION"))),C<W("VIDEO_FREEZE_DURATION")&&this.videoState===hc.VideoStateFrozen&&(this.videoState=hc.VideoStateDecoding),C>W("VIDEO_FREEZE_DURATION")&&xa.lastVisibleTime>=xa.lastHiddenTime&&u.timestamp>xa.lastVisibleTime&&u.timestamp>xa.lastHiddenTime){const $=Math.min(66,kB(this._render_interframe_delays_sizes,this._render_interframe_delays)),K=Math.max(0,C-(U-1)*$);this.renderFreezeAccTime2+=K>$?K:0,this.renderFreezeAccTime+=C}}u=vn(vn({},_),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(u=vn(vn({},_),{},{timestamp:v}));var E,w;W("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(E=(w=this.videoElement).requestVideoFrameCallback)===null||E===void 0?void 0:E.call(w,g))};this.cancelRVFId=(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0?void 0:r.call(i,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Kg()&&!W("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=$t();this.config.noStyle||(s.name==="Safari"&&Number(s.version)===15||kp()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_n()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,_n()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{R.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){var r,i;jB.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((r=(i=this.videoElement).cancelVideoFrameCallback)===null||r===void 0||r.call(i,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Jr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Jr.DESTROYED||this.internal}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{R.error(s)}),this.autoplayFailed=!1,Yg()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Yg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),UV()}}const jB=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class zb extends DA{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),de(this,"container",void 0),de(this,"slot",void 0),this.slot=r.element,this.internal=i,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;var s;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,s):await PA(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",W("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var LB,MB,UB,FB,VB,BB,GB,WB,$B,HB,zB,KB,YB,qB,XB,JB,QB,ZB,e6,t6,n6,r6,i6,a6,s6,o6,c6,l6,Dt,d6,u6,h6,p6,m6,f6,g6,v6,Ba;let dn=(LB=st({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),MB=Ln(),UB=st({argsMap:t=>[t.getTrackId()]}),FB=Up("LocalVideoTrack","_enabledMutex"),VB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),BB=Ln(),GB=Up("LocalVideoTrack","_enabledMutex"),WB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),$B=Ln(),HB=st({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),zB=Ln(),KB=st({argsMap:(t,r)=>[t.getTrackId(),r]}),YB=Ln(),qB=Ln(),XB=st({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),JB=Ln(),QB=Ln(),ZB=Ln(),e6=st({argsMap:t=>[t.getTrackId()]}),t6=Ln(),n6=Ln(),r6=Ln(),i6=Ln(),a6=Ln(),s6=st({argsMap:(t,r)=>[t.getTrackId(),r.name]}),o6=st({argsMap:t=>[t.getTrackId()]}),c6=st({argsMap:t=>[t.getTrackId()]}),l6=st({argsMap:(t,r,i)=>[t.getTrackId(),r.label,i]}),Dt=class Qte extends zp{get videoHeight(){if(Cr()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Cr()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,s,c,u,p){if(super(r,u),de(this,"trackMediaType",Hp.VIDEO),de(this,"_player",void 0),de(this,"isUseScaleResolutionDownBy",!1),de(this,"_videoVisibleTimer",null),de(this,"_previousVideoVisibleStatus",void 0),de(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),de(this,"_encoderConfig",void 0),de(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),de(this,"_optimizationMode",void 0),de(this,"_saveEncodeBitrateRatio",1),de(this,"_videoHeight",void 0),de(this,"_videoWidth",void 0),de(this,"_forceBitrateLimit",void 0),de(this,"_enabled",!0),de(this,"_processorDestination",void 0),de(this,"_processorContext",void 0),Cr()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=c,this._hints=p||[],i&&this._hints.indexOf(Jt.CUSTOM_TRACK)!==-1?this._encoderConfig=bn(i):this._encoderConfig=i,this._hints.indexOf(Jt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(zR(zt.CHROME,115)&&Rb().indexOf("Windows")!==-1){const m=function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&Pt().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(g),E=new MediaStreamTrackGenerator({kind:"video"});let w,C,U=Date.now();const k=()=>{j&&(clearInterval(j),j=void 0),w&&(w.close(),w=void 0),g.stop(),C=void 0,E.removeEventListener("ended",k)};let j=window.setInterval(()=>{if(C&&w&&Date.now()-U>1e3)try{E.readyState==="live"?C.enqueue(w.clone()):k()}catch{k()}},1e3);const $=new TransformStream({transform:(K,J)=>{E.readyState==="live"?(C=J,U=Date.now(),w===void 0?(w=K,J.enqueue(K.clone())):(J.enqueue(w),w=K)):K.close()}});return E.addEventListener("ended",k),_.readable.pipeThrough($).pipeTo(E.writable),E}}(r);m&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(Jt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new BV(this.getTrackId(),"local"),this._processorDestination=new VV(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=vn(vn(vn({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new DA(s):this._player=new zb(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit($p.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await pn(this,Ke.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return i||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await pn(this,Ke.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await pn(this,Ke.NEED_MUTE_TRACK,this):await pn(this,Ke.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await pn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new me(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Ws(r),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const s=Hb({encoderConfig:r});(Cr()||ii()||Us())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const u=new me(H.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}getStats(){return ad(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ba(this,Ke.GET_STATS)||vn({},SA)}async setBeautyEffect(r){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await PA(r)}async findClosestProfile(){const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings(),{width:c,height:u,frameRate:p}=this._encoderConfig||{},m=Mp(this._videoWidth||r||c||0),g=Mp(this._videoHeight||i||u||0),v=function(_,E,w){if(!Array.isArray(W("VIDEO_ENCODER_CONFIG_LIST"))||W("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const C=Math.min(_,E);return!(C>=480)&&vn(vn({},W("VIDEO_ENCODER_CONFIG_LIST").find(U=>U.height>C)),{},{frameRate:w})}(m,g,Mp(s||p||15));if(v)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(r){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void R.error(H.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await pn(this,Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=i,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return R.error(H.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){$V(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch(Jg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new me(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Ws(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!i||!s)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:p,min:m}=function(g,v,_,E,w){const C=W("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:E,max:w};if(w===void 0){const U=Math.floor(200*Math.pow(_/15,.6)*Math.pow(g*v/640/360,.75));w=C==="STANDARD_BITRATE"?4*U:2*U,E=E??U}else E=E??Math.floor(w/10);return{min:E,max:w}}(r,i,s,u,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=p,W("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[g,v]=function(_,E,w){const C=4*Math.floor(2e5*Math.pow(w/15,.6)*Math.pow(_*E/230400,.75)),U=_*E,k=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let $=va(k).call(k).next().value,K=1;if(k.has(U))$=k.get(U);else{var J;const Be=vu(J=Array.from(k.entries())).call(J,(ct,Tt)=>{let[Et]=ct,[Yt]=Tt;return Et-Yt}),mt=Be.find(ct=>{let[Tt]=ct;return Tt>U});if(mt){const ct=Be.indexOf(mt);if(ct>0){const Tt=Be[ct-1],Et=(U-Tt[0])/(mt[0]-Tt[0]);$=Tt[1]+Et*(mt[1]-Tt[1])}else $=mt[1]}else $=Be[Be.length-1][1]}if(j.has(U))K=j.get(U);else{var ne;const Be=vu(ne=Array.from(j.entries())).call(ne,(ct,Tt)=>{let[Et]=ct,[Yt]=Tt;return Et-Yt}),mt=Be.find(ct=>{let[Tt]=ct;return Tt>U});if(mt){const ct=Be.indexOf(mt);if(ct>0){const Tt=Be[ct-1],Et=(U-Tt[0])/(mt[0]-Tt[0]);K=Tt[1]+Et*(mt[1]-Tt[1])}else K=mt[1]}else K=Be[Be.length-1][1]}const ae=W("VIDEO_NEW_BITRATE_RATIO");ae&&ae>0&&($=ae/100);const ee=Math.floor(C*$),oe=Math.floor(65e4*Math.pow(_*E/230400,.5)*Math.pow(w/15,.69));let ve=ee;const Ee=W("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?ve=C:Ee===2?ve=ee:Ee===3&&(ve=oe)),[Math.floor(ve/1e3),K]}(r,i,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=v,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:p}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&p instanceof HTMLElement){const m=WF.checkOneElementVisible(u),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=ze.reportApiInvoke(null,{tag:ln.TRACER,name:Sn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new me(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new me(H.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=vn(vn({},s),Ws(r))),s=Iu(s);const c=Zt(8,"track-video-cloned-"),u=new Qte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Iu(this._scalabilityMode),this._optimizationMode,c,Iu(this._hints));return r&&s&&u.setEncoderConfiguration(s),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new me(H.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new me(H.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(ad(()=>{ze.reportApiInvoke(null,{name:Sn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:ln.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!W("ENABLE_VIDEO_SEI")||!W("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new me(H.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void R.warning("Video track is not published, SEI can not be send");const s=i.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):R.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await pn(this,Ke.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await pn(this,Ke.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ma.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ma.REQUEST_CONSTRAINTS)}},Ft(Dt.prototype,"play",[LB,MB],Object.getOwnPropertyDescriptor(Dt.prototype,"play"),Dt.prototype),Ft(Dt.prototype,"stop",[UB],Object.getOwnPropertyDescriptor(Dt.prototype,"stop"),Dt.prototype),Ft(Dt.prototype,"setEnabled",[FB,VB,BB],Object.getOwnPropertyDescriptor(Dt.prototype,"setEnabled"),Dt.prototype),Ft(Dt.prototype,"setMuted",[GB,WB,$B],Object.getOwnPropertyDescriptor(Dt.prototype,"setMuted"),Dt.prototype),Ft(Dt.prototype,"setSaveEncodeBitrateRatio",[HB,zB],Object.getOwnPropertyDescriptor(Dt.prototype,"setSaveEncodeBitrateRatio"),Dt.prototype),Ft(Dt.prototype,"setEncoderConfiguration",[KB,YB],Object.getOwnPropertyDescriptor(Dt.prototype,"setEncoderConfiguration"),Dt.prototype),Ft(Dt.prototype,"getStats",[qB],Object.getOwnPropertyDescriptor(Dt.prototype,"getStats"),Dt.prototype),Ft(Dt.prototype,"setBeautyEffect",[XB,JB],Object.getOwnPropertyDescriptor(Dt.prototype,"setBeautyEffect"),Dt.prototype),Ft(Dt.prototype,"getCurrentFrameData",[QB],Object.getOwnPropertyDescriptor(Dt.prototype,"getCurrentFrameData"),Dt.prototype),Ft(Dt.prototype,"getCurrentFrameImage",[ZB],Object.getOwnPropertyDescriptor(Dt.prototype,"getCurrentFrameImage"),Dt.prototype),Ft(Dt.prototype,"findClosestProfile",[e6,t6],Object.getOwnPropertyDescriptor(Dt.prototype,"findClosestProfile"),Dt.prototype),Ft(Dt.prototype,"setBitrateLimit",[n6],Object.getOwnPropertyDescriptor(Dt.prototype,"setBitrateLimit"),Dt.prototype),Ft(Dt.prototype,"setOptimizationMode",[r6],Object.getOwnPropertyDescriptor(Dt.prototype,"setOptimizationMode"),Dt.prototype),Ft(Dt.prototype,"setScalabiltyMode",[i6],Object.getOwnPropertyDescriptor(Dt.prototype,"setScalabiltyMode"),Dt.prototype),Ft(Dt.prototype,"updateMediaStreamTrackResolution",[a6],Object.getOwnPropertyDescriptor(Dt.prototype,"updateMediaStreamTrackResolution"),Dt.prototype),Ft(Dt.prototype,"pipe",[s6],Object.getOwnPropertyDescriptor(Dt.prototype,"pipe"),Dt.prototype),Ft(Dt.prototype,"unpipe",[o6],Object.getOwnPropertyDescriptor(Dt.prototype,"unpipe"),Dt.prototype),Ft(Dt.prototype,"close",[c6],Object.getOwnPropertyDescriptor(Dt.prototype,"close"),Dt.prototype),Ft(Dt.prototype,"replaceTrack",[l6],Object.getOwnPropertyDescriptor(Dt.prototype,"replaceTrack"),Dt.prototype),Dt),Kb=(d6=st({argsMap:(t,r)=>[t.getTrackId(),r]}),u6=Ln(),h6=Up("CameraVideoTrack","_enabledMutex"),p6=st({argsMap:(t,r)=>[t.getTrackId(),r]}),m6=Ln(),f6=st({argsMap:(t,r)=>[t.getTrackId(),r]}),g6=Ln(),v6=st({argsMap:t=>[t.getTrackId()]}),Ba=class Zte extends dn{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,c,u,p){super(r,Ws(i.encoderConfig),c,u,p),de(this,"_config",void 0),de(this,"_originalConstraints",void 0),de(this,"_constraints",void 0),de(this,"_enabled",!0),de(this,"_deviceName","default"),de(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(kp()||qR())&&!function(){const m=$t();if(m.os!==gr.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&LF()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=Ws(this._config.encoderConfig),sn.on(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sn.on(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Va.getDeviceById(r),s={};s.video=vn({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Fa(s,this.getTrackId())}catch(u){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Va.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:vn(vn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Fa(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=vn({},i.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Fa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await pn(this,Ke.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await pn(this,Ke.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new me(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Ws(r),W("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const s=bn(this._config);s.encoderConfig=r;const c=Hb(s);(Cr()||ii()||Us())&&(c.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const p=new me(H.UNEXPECTED_ERROR,u.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),p}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Jt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await pn(this,Ke.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ii()||Us())&&this._enabled&&!this._isClosed&&sn.duringInterruption){const r=async()=>{sn.off(Mr.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sn.on(Mr.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($p.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=Va.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const c=await Fa({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),sn.off(Mr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sn.off(Mr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=vn(vn({},s),Ws(r))),s=Iu(s);const c=Zt(8,"track-cam-cloned-"),u=new Zte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Iu(vn(vn({},this._config),{},{encoderConfig:s})),Iu(this._constraints),Iu(this._scalabilityMode),this._optimizationMode,c);return r&&s&&u.setEncoderConfiguration(s),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Ma.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}}),this.processorContext.on(Ma.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Ft(Ba.prototype,"setDevice",[d6,u6],Object.getOwnPropertyDescriptor(Ba.prototype,"setDevice"),Ba.prototype),Ft(Ba.prototype,"setEnabled",[h6,p6,m6],Object.getOwnPropertyDescriptor(Ba.prototype,"setEnabled"),Ba.prototype),Ft(Ba.prototype,"setEncoderConfiguration",[f6,g6],Object.getOwnPropertyDescriptor(Ba.prototype,"setEncoderConfiguration"),Ba.prototype),Ft(Ba.prototype,"close",[v6],Object.getOwnPropertyDescriptor(Ba.prototype,"close"),Ba.prototype),Ba);function y6(t){const r=Zt(8,"track-cus-"),i=ze.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:Sn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),s=new Mn(t.mediaStreamTrack,t.encoderConfig?Gb(t.encoderConfig):{},r,!1);return R.info("create custom audio track success with config",t,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s}function kA(t,r,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=vn(vn({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?R.debug("[".concat(t,"] set content hint to"),i.optimizationMode):R.debug("[".concat(t,"] set content hint failed")))):R.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var _6,b6,x6,E6,us,S6,w6,T6,C6,N6,R6,A6,zr;class I6 extends IV{getUserId(){return this._userId}constructor(r,i,s,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Zt(5,""))),de(this,"_userId",void 0),de(this,"_uintId",void 0),de(this,"_isDestroyed",!1),de(this,"store",void 0),de(this,"processor",void 0),de(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let qp=(_6=st({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),b6=st({argsMap:t=>[t.getTrackId()]}),x6=st({argsMap:(t,r)=>[t.getTrackId(),r.name]}),E6=st({argsMap:t=>[t.getTrackId()]}),Ft((us=class extends I6{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,i,s,c){super(t,r,i,s),de(this,"_videoVisibleTimer",null),de(this,"_previousVideoVisibleStatus",void 0),de(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),de(this,"trackMediaType",Hp.VIDEO),de(this,"_videoWidth",void 0),de(this,"_videoHeight",void 0),de(this,"_player",void 0),de(this,"_prePlayer",void 0),de(this,"processorDestination",void 0),de(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new BV(this.getTrackId(),"remote"),this.processorDestination=new VV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ad(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ba(this,Ke.GET_STATS)||vn({},RV)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ds.PLAY_START),typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=vn(vn({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(i);else{let s=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new DA(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(i)):this._player=new zb(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ds.FIRST_FRAME_DECODED),c&&this.safeEmit(ds.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(ds.VIDEO_STATE_CHANGED,u)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ds.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},W("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ds.PLAY_END)}stop(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(t),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){$V(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Jg)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const p=WF.checkOneElementVisible(c),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=ze.reportApiInvoke(null,{tag:ln.TRACER,name:Sn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new me(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new me(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Lu.SEI_RECEIVED,t)}}).prototype,"play",[_6],Object.getOwnPropertyDescriptor(us.prototype,"play"),us.prototype),Ft(us.prototype,"stop",[b6],Object.getOwnPropertyDescriptor(us.prototype,"stop"),us.prototype),Ft(us.prototype,"pipe",[x6],Object.getOwnPropertyDescriptor(us.prototype,"pipe"),us.prototype),Ft(us.prototype,"unpipe",[E6],Object.getOwnPropertyDescriptor(us.prototype,"unpipe"),us.prototype),us),Xp=(S6=st({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),w6=st({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),T6=st({argsMap:(t,r)=>[t.getTrackId(),r]}),C6=st({argsMap:t=>[t.getTrackId()]}),N6=st({argsMap:t=>[t.getTrackId()]}),R6=st({argsMap:(t,r)=>[t.getTrackId(),r.name]}),A6=st({argsMap:t=>[t.getTrackId()]}),Ft((zr=class extends I6{get isPlaying(){return this._useAudioElement?di.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,i,s){super(t,r,i,s),de(this,"trackMediaType",Hp.AUDIO),de(this,"_source",void 0),de(this,"_useAudioElement",!0),de(this,"_volume",100),de(this,"processorContext",void 0),de(this,"processorDestination",void 0),de(this,"_played",!1),de(this,"_bypassWebAudio",!1),W("DISABLE_WEBAUDIO")?(this._source=new OA,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new RA(t,!0),W("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(La.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ds.FIRST_FRAME_DECODED)}),this.processorContext=new WV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new GV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(La.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(La.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(La.ON_AUDIO_BUFFER),this._source.on(La.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?di.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}setAmplifiedVolume(t){this._useAudioElement&&this._played&&(di.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,t=Math.min(t,W("MAX_WEBAUDIO_VOLUME")),this._volume=t,this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!xV())throw new me(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await di.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?di.getVolume(this.getTrackId()):this._source instanceof RA?this._source.getAudioVolume():0}getStats(){return ad(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ba(this,Ke.GET_STATS)||vn({},NV)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),di.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(R.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?di.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&di.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new me(H.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new me(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new me(H.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ci.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ci.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ci.ON_TRACK),this.processorDestination.removeAllListeners(Ci.ON_NODE)}}).prototype,"setVolume",[S6],Object.getOwnPropertyDescriptor(zr.prototype,"setVolume"),zr.prototype),Ft(zr.prototype,"setAmplifiedVolume",[w6],Object.getOwnPropertyDescriptor(zr.prototype,"setAmplifiedVolume"),zr.prototype),Ft(zr.prototype,"setPlaybackDevice",[T6],Object.getOwnPropertyDescriptor(zr.prototype,"setPlaybackDevice"),zr.prototype),Ft(zr.prototype,"play",[C6],Object.getOwnPropertyDescriptor(zr.prototype,"play"),zr.prototype),Ft(zr.prototype,"stop",[N6],Object.getOwnPropertyDescriptor(zr.prototype,"stop"),zr.prototype),Ft(zr.prototype,"pipe",[R6],Object.getOwnPropertyDescriptor(zr.prototype,"pipe"),zr.prototype),Ft(zr.prototype,"unpipe",[A6],Object.getOwnPropertyDescriptor(zr.prototype,"unpipe"),zr.prototype),zr);const xa=new class extends Nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),de(this,"_lastHiddenTime",0),de(this,"_lastVisibleTime",0),de(this,"needUploadStats",[]),de(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class O6 extends Nn{constructor(r,i){super(),de(this,"trackMediaType",Hp.DATA),de(this,"_version",1),de(this,"_type",3),de(this,"_config",void 0),de(this,"_originDataChannel",void 0),de(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),de(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),de(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return W("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Pe((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const s=setTimeout(()=>{var c;i(new me(H.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new me(H.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new me(H.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[Wb.OPEN,Wb.CLOSE,Wb.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),r.addEventListener(i,s)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;r.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class Oge extends O6{constructor(r){super(r),de(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(W("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(Wb.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Pge extends O6{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function Yb(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>K_.revokeObjectURL(t),0),new Worker(K_.createObjectURL(t))}const P6=71,jA=1,LA=2,MA=1,D6=2;var od=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(od||{});function UA(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=t.getUint8(0);if(i!==P6)return;const s=t.getUint16(1),c=jA+LA+s,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const p={m:i,tlvLen:s,tlv:[],frame:u};let m=jA+LA;for(;m<c;){const g=t.getUint8(m),v=t.getUint16(m+MA),_=MA+D6;if(g===od.AUDIO_LEVEL){let E=t.getUint8(m+_);for(let w=1;w<v;w++)E=E<<8|t.getUint8(m+_+w);p.tlv.push({tag:g,length:v,value:r?127^E>>1:127&E})}else if(g===od.METADATA||g===od.AUDIO_64_BIT_PTS){const E=new Uint8Array(v);for(let w=0;w<v;w++)E[w]=t.getUint8(m+_+w);p.tlv.push({tag:g,length:v,value:E})}m+=_+v}return p}const qb=new Map,Xb=127,Fu=1e-10,FA=139/13,Jb=new Map;function VA(t,r,i){const s="".concat(t,"-").concat(r,"-").concat(i);let c=0;return Jb.has(s)?c=Jb.get(s):(c=Math.log(function(p,m){const g=p-m;m<g&&(m=g);let v=1;for(let _=p,E=1;_>m;_--,E++)v=v*_/E;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(i)+i*t,Jb.set(s,c)),c<Fu&&(c=Fu),c}function k6(t,r,i){const s=r.length,c=t.length/s;let u=!1;for(let p=0,m=0;p<s;p++){let g=0;for(let v=m+c;m<v;m++)t[m]>i&&g++;r[p]!==g&&(r[p]=g,u=!0)}return u}window.cache=Jb;let Dge=0;class j6{constructor(r){de(this,"id",void 0),de(this,"immediates",[]),de(this,"lastNonSilence",-1),de(this,"immediateSpeechActivityScore",Fu),de(this,"lastLevelChangedTime",Date.now()),de(this,"levels",[]),de(this,"longs",[]),de(this,"longSpeechActivityScore",Fu),de(this,"mediums",[]),de(this,"mediumSpeechActivityScore",Fu),de(this,"minLevel",0),de(this,"nextMinLevel",0),de(this,"nextMinLevelWindowLength",0),de(this,"energyScore",0),this.id=r||"".concat(Dge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,s=this.minLevel+FA;let c=!1;for(let u=0;u<r.length;++u){let p=i[u];p<s&&(p=0);const m=Math.floor(p/FA);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return k6(this.mediums,this.longs,4)}computeMediums(){return k6(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=VA(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=VA(this.longs[0],10,47),this.longSpeechActivityScore>Fu&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=VA(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(nL(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let s=r;return r<0&&(s=0),r>Xb&&(s=Xb),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+FA?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>Xb&&(i=Xb),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class kge{constructor(r){de(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class BA{constructor(r,i,s){de(this,"isDominant",void 0),de(this,"energyRanking",void 0),de(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=s}}class jge extends Nn{constructor(r){super(),de(this,"dominantId",null),de(this,"lastDecisionTime",0),de(this,"lastLevelChangedTime",0),de(this,"lastLevelIdleTime",0),de(this,"relativeSpeechActivities",[]),de(this,"speakers",new Map),de(this,"enableSilence",!1),de(this,"timeoutToSilenceInterval",0),de(this,"decisionMaker",null),de(this,"loudest",[]),de(this,"numLoudestToTrack",3),de(this,"energyExpireTimeMs",250),de(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),s!=null&&(this.energyAlphaPct=s),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const s=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const u=c.levelChanged(i,s);return this.updateLoudestList(c,u,s)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new j6(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,s){const c=r.id===this.dominantId;if(i<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new BA(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new BA(c,0,r.energyScore);const u=s-this.energyExpireTimeMs;let p=0;for(;p<this.loudest.length;){const g=this.loudest[p];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(p,1);else if(g.id!==r.id)++p;else if(this.loudest.splice(p,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new BA(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new kge(this),this.decisionMaker.execute())}makeDecision(r){let i=null,s=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var p;const m=va(p=this.speakers).call(p).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const _=this.speakers.entries().next();_.value&&(u=_.value[0],m=_.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let v=2;for(const _ of this.speakers.entries()){const[E,w]=_;if(w===m)continue;w.evaluateSpeechActivityScores(r);for(let j=0;j<g.length;++j){const $=m==null?Fu:m.getSpeechActivityScore(j);g[j]=Math.log(w.getSpeechActivityScore(j)/$)}const C=g[0],U=g[1],k=g[2];C>3&&U>2&&k>0&&U>v&&(v=U,u=E)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===i||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let s=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):s=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(r){const i=[];for(const c of va(s=this.speakers).call(s)){var s;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Jp=new Map;let Co=null,Qb=null;const L6=3;let Vu=[];const No=new Map,Zb=new Map;class Lge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){de(this,"id",void 0),de(this,"track",void 0),de(this,"score",0),de(this,"active",!0),de(this,"muted",!1),de(this,"timer",0),de(this,"actives",0),de(this,"inactives",0),this.id=r,this.track=i,this.setActive(No.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:s}=function(){const c=[],u=[];return Array.from(va(No).call(No)).forEach(p=>{p.active?c.push(p):u.push(p)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&s.length>0){let c;s.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let s;return Array.from(va(No).call(No)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let s;return Array.from(va(No).call(No)).forEach(c=>{c.active||c.id===i||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ex;function M6(t){const r=No.get(t);r&&(No.delete(t),r.clearTimer())}const tx=new Map,Mge=new Map,GA="video/h264",WA="video/h265";function U6(t,r,i){let s=new Uint8Array(t,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(c.push(s[u],s[u+1],s[u+3]),u+=4):(c.push(s[u]),u++);return new Uint8Array(c)}function F6(t){const r=t.length;let i=[],s=0;for(;s<r;)s+2<r&&t[s]===0&&t[s+1]===0&&(t[s+2]===0||t[s+2]===1||t[s+2]===2||t[s+2]===3)?(i.push(t[s],t[s+1],3,t[s+2]),s+=3):(i.push(t[s]),s++);return new Uint8Array(i)}function V6(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const i=r+(t[r+2]===0?4:3);if(i>=t.length)return"";const s=t[i];return 128&s?"":(s>>1&63)>=32||i+1<t.length&&!(248&t[i+1])?WA:(31&s)<=31?GA:""}const nx=new Map,iv=new Map;(function(){const t=$t();yr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),yr.getStreamFromExtension=t.name===zt.CHROME&&Number(t.version)>34,yr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),yr.supportMinBitrate=t.name===zt.CHROME||t.name===zt.EDGE,yr.supportSetRtpSenderParameters=function(){const r=$t();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!dc()||!(!Cr()&&!Ab())||r.name===zt.FIREFOX&&Number(r.version)>=64)}(),t.name===zt.SAFARI&&(Number(t.version)>=14?yr.supportDualStream=!0:yr.supportDualStream=!1),yr.webAudioMediaStreamDest=function(){const r=$t();return!(r.name===zt.SAFARI&&Number(r.version)<12)}(),yr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",yr.supportWebGL=typeof WebGLRenderingContext<"u",yr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,dc()||(yr.webAudioWithAEC=!0),yr.supportShareAudio=function(){const r=$t();return(r.os===gr.WIN_10||r.os===gr.WIN_81||r.os===gr.WIN_7||r.os===gr.LINUX||r.os===gr.MAC_OS||r.os===gr.CHROMIUM_OS)&&r.name===zt.CHROME&&Number(r.version)>=74}(),yr.supportDataChannel=!!(wo(76)||KR(68)||OF(14)),yr.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!_n()&&!!r&&r.prototype.setConfiguration instanceof Function}(),yr.supportWebRTCEncodedTransform=wo(87)||RF()||KR(117),yr.supportWebRTCInsertableStream=function(){const r=$t();return(r.name===zt.CHROME||r.name===zt.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),yr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,yr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,yr.supportSuppressLocalAudioPlayback=wV(),yr.supportRestrictOwnAudio=TV(),Ob(()=>{yr.supportDualStreamEncoding=function(){const r=$t();return!!W("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&W("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",t),R.info("browser compatibility: ",yr)})})();const Uge=["CHINA","GLOBAL"],B6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Bu=[],Qp=[];function Gu(t,r){return!!r&&Bu.some(i=>i.uid===t&&i.channelName===r)}function $A(){return Qp.length>0}var Fge=Y4.forEach,G6=a_("forEach")?[].forEach:function(t){return Fge(this,t,arguments.length>1?arguments[1]:void 0)};Qt({target:"Array",proto:!0,forced:[].forEach!==G6},{forEach:G6});var Vge=as("Array","forEach"),Bge=ql,Gge=ni,Wge=N,$ge=Vge,HA=Array.prototype,Hge={DOMTokenList:!0,NodeList:!0},zge=function(t){var r=t.forEach;return t===HA||Wge(HA,t)&&r===HA.forEach||Gge(Hge,Bge(t))?$ge:r},Kge=d(zge),Yge=ic,W6=u_;Qt({target:"Object",stat:!0,forced:h(function(){W6(1)})},{keys:function(t){return W6(Yge(t))}});var qge=d(ht.Object.keys),Xge=d(Zj),Jge=d(tL),Qge=Qt,$6=gg,Zge=T_,eve=Ve,H6=iC,tve=Yl,nve=Xe,rve=SN,ive=Zn,ave=Jl,sve=U4("slice"),ove=ive("species"),zA=Array,cve=Math.max;Qge({target:"Array",proto:!0,forced:!sve},{slice:function(t,r){var i,s,c,u=nve(this),p=tve(u),m=H6(t,p),g=H6(r===void 0?p:r,p);if($6(u)&&(i=u.constructor,(Zge(i)&&(i===zA||$6(i.prototype))||eve(i)&&(i=i[ove])===null)&&(i=void 0),i===zA||i===void 0))return ave(u,m,g);for(s=new(i===void 0?zA:i)(cve(g-m,0)),c=0;m<g;m++,c++)m in u&&rve(s,c,u[m]);return s.length=c,s}});var lve=as("Array","slice"),dve=N,uve=lve,KA=Array.prototype,hve=function(t){var r=t.slice;return t===KA||dve(KA,t)&&r===KA.slice?uve:r},pve=d(hve);function ke(t,r,i,s,c){var u,p,m,g={};return Kge(u=qge(s)).call(u,function(v){g[v]=s[v]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Xge(p=Jge(m=pve(i).call(i)).call(m)).call(p,function(v,_){return _(t,r,v)||v},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(k4(t,r,g),null):g}let rx=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),YA=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),hs=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t[t.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",t}({}),Ni=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),nt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Lt=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Ye=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t.VOS_FALLBACK="vos_fallback",t.VOS_FALLBACK_PROMISE="vos_fallback_promise",t}({}),Je=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SET_DUAL_STREAM_MODE="set_dual_stream_mode",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.CONFIGURE="configure",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Wu=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),gt=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t.ENABLE_MULTI_STREAM="enable_multi_stream",t}({}),Ri=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),St=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t.ON_FALLBACK="websocket:on_fallback",t}({});function ix(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw R.error("Invalid Channel Name ".concat(t)),new ce(H.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ax(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||VF(t,1,255)))throw new ce(H.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let tl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const mve={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},qA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XA(t,r){Lr(t.url,"".concat(r,".url"),1,1e3,!1),On(t.x)||cn(t.x,"".concat(r,".x"),0,1e4),On(t.y)||cn(t.y,"".concat(r,".y"),0,1e4),On(t.width)||cn(t.width,"".concat(r,".width"),0,1e4),On(t.height)||cn(t.height,"".concat(r,".height"),0,1e4),On(t.zOrder)||cn(t.zOrder,"".concat(r,".zOrder"),0,255),On(t.alpha)||cn(t.alpha,"".concat(r,".alpha"),0,1,!1)}const fve={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let cd=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),JA=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),cr=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function z6(t){if(!t.channelName)throw new ce(H.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new ce(H.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Lr(t.token,"info.token",1,2047),ax(t.uid),ix(t.channelName),!0}let Ui=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),nl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ji=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Zp=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),tn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Gn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t.VOS_FALLBACK="vos-fallback",t.VOS_FALLBACK_PROMISE="vos-fallback-promise",t.RESET_SIGNAL="reset-signal",t.DATACHANNEL_FAILBACK="datachannel-failback",t}({}),sx=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),_r=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),qt=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const K6=[qt.AFRICA,qt.ASIA,qt.CHINA,qt.EUROPE,qt.GLOBAL,qt.INDIA,qt.JAPAN,qt.NORTH_AMERICA,qt.OCEANIA,qt.OVERSEA,qt.SOUTH_AMERICA];let Qr=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const ox={CHINA:{},ASIA:{CODE:Qr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Qr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Qr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Qr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Qr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Qr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Qr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Qr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Qr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Qr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Qr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Qr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Qr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};pA&&(ox.CHINA={CODE:Qr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Ro=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",t.FALLBACK_TO_HLS="fallback_to_hls",t.UPDATE_VOS_CONFIGURE="update_vos_configure",t}({});function Y6(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class q6 extends Nn{constructor(r,i){super(),M(this,"onICEConnectionStateChange",void 0),M(this,"onConnectionStateChange",void 0),M(this,"onDTLSTransportStateChange",void 0),M(this,"onDTLSTransportError",void 0),M(this,"onICETransportStateChange",void 0),M(this,"onFirstAudioReceived",void 0),M(this,"onFirstVideoReceived",void 0),M(this,"onFirstAudioDecoded",void 0),M(this,"onFirstVideoDecoded",void 0),M(this,"onFirstVideoRender",void 0),M(this,"onFirstVideoBufferReady",void 0),M(this,"onFirstVideoDecodedTimeout",void 0),M(this,"onSelectedLocalCandidateChanged",void 0),M(this,"onSelectedRemoteCandidateChanged",void 0),M(this,"onICECandidateError",void 0),M(this,"getLocalVideoStats",void 0)}}class cx extends q6{constructor(r,i){super(r,i),M(this,"establishPromise",void 0)}}let $e=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Rr=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),rl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const X6=["disconnected","failed"];let Re=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Xt=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Qe=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t.FirstVideoPreRender="FirstVideoPreRender",t.FirstVideoBufferReady="FirstVideoBufferReady",t}({}),$s=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Hs=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ar=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),ld=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),lr=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),mc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),ps=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ao=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),em=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Wn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),tm=function(t){return t.ABORT="abort",t}({}),dd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),gve=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const vve={[rx.ACCESS_POINT]:{[Ni.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ni.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ni.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ni.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ni.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ni.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ni.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[rx.UNILBS]:{[hs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[hs.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[rx.STRING_UID_ALLOCATOR]:{[YA.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[YA.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[YA.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function nm(t){const r=vve[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[t%1e4];if(!i){if(Math.floor(t/1e4)===rx.ACCESS_POINT){const s=t%1e4;if(s.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const yve={[nt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[nt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[nt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[nt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[nt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[nt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[nt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[nt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[nt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[nt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[nt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[nt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[nt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[nt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[nt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[nt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[nt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[nt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[nt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[nt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[nt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[nt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[nt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[nt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[nt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[nt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[nt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[nt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[nt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[nt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[nt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[nt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[nt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[nt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[nt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[nt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[nt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[nt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[nt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[nt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[nt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[nt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[nt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[nt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[nt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[nt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[nt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[nt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[nt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[nt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[nt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[nt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[nt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[nt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[nt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[nt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[nt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[nt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[nt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[nt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[nt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function $u(t){return yve[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function J6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function QA(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?J6(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function ZA(t,r){if(typeof t=="string")return t;const{proxy:i,host:s,port:c}=t;if(r){const u=W("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const _ve=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,bve=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xve=/wss:\/\/(.+):([0-9]+)\/?/,Eve=/wss:\/\/(.[^\/]+)\/?/;let Sve=0;class wve{constructor(r,i){M(this,"id",0),M(this,"store",void 0),M(this,"recordIndex",void 0),M(this,"websockets",[]),M(this,"try443PortDuration",2e3),M(this,"forceCloseWSDuration",5e3),M(this,"try443PortTimeout",null),M(this,"forceCloseTimeout",null),M(this,"isTry443PortFailed",!1),M(this,"isNormalPortFailed",!1),M(this,"useDoubleDomain",!1),M(this,"useProxy",!1),M(this,"startTime",Date.now()),this.id=++Sve,this.try443PortDuration=W("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];R.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,s){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:s});const c=W("GATEWAY_DOMAINS"),u=Date.now(),p=[],m=c.find(w=>{var C;return Ne(C=r.host).call(C,w)});m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(w=>{g.push(ZA(QA(QA({},r),{},{host:r.host.replace(m,w)}),i))});else{const w=QA({},r);if(i&&m){const C=c.find(U=>U!==m);C&&(w.host=w.host.replace(m,C))}g.push(ZA(w,i))}try{g.forEach(w=>{const C=new WebSocket(w);C.binaryType="arraybuffer",p.push(C),this.logger("ws is connecting:",C.url)})}catch(w){if(this.logger("ws create failed"),p.forEach(C=>C.close()),p.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,s);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,s);throw new ce(H.WS_ERR,"init websocket failed! Error: ".concat(w.toString()))}const v=zg();this.store&&this.store.recordJoinChannelService({urls:p.map(w=>w.url),service:"gateway"},this.recordIndex),p.forEach(w=>{w.onopen=()=>{this.logger("onopen: ws ".concat(w.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(C=>{C!==w&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,v.resolve(w)},w.onclose=C=>{this.logger("onclose: ws ".concat(w.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(w.readyState));const U=p.every(k=>k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(U)),U&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),v.reject({code:C.code,reason:sx.A_ROUND_WS_FAILED})):!i&&U&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),i?this.isTry443PortFailed=U:this.isNormalPortFailed=U},w.onmessage=C=>this.logger("".concat(w.url," onmessage: ").concat(C.data))}),this.websockets.push(...p);const _=()=>{this.websockets.forEach(w=>w.readyState!==WebSocket.OPEN&&w.close())},E=()=>{if(v.isResolved)return _();$t().os===gr.MAC_OS&&_n()&&_(),this.createWebSocket(r,!0,!0).then(w=>{v.resolve(w)}).catch(w=>{this.isNormalPortFailed&&v.reject(w),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return s||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,i,s,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let p,m,g;return[,p,m,g]=u.match(_ve)||[],p||([,m,g]=u.match(bve)||[]),m&&g||([,m,g]=u.match(xve)||[]),m&&g||([,m]=u.match(Eve)||[]),m||R.warning("un-destructible url: ",u),{proxy:p,host:m,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,s&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(r,!!s,!1).finally(()=>this.clearTimeout())}}function Q6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class Z6 extends Nn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Ne(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(St.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(St.CONNECTED):this._state==="closed"?this.emit(St.CLOSED):this._state==="failed"&&this.emit(St.FAILED))}resetReconnectCount(r){R.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],p=arguments.length>5?arguments[5]:void 0;super(),M(this,"_websocketUrl",null),M(this,"connectionID",0),M(this,"currentURLIndex",0),M(this,"urls",[]),M(this,"_reconnectMode","tryNext"),M(this,"reconnectReason",void 0),M(this,"_initMutex",void 0),M(this,"name",void 0),M(this,"_state","closed"),M(this,"reconnectInterrupter",void 0),M(this,"websocket",void 0),M(this,"retryConfig",void 0),M(this,"reconnectCount",0),M(this,"forceCloseTimeout",5e3),M(this,"onlineReconnectListener",void 0),M(this,"useCompress",void 0),M(this,"tryDoubleDomain",!1),M(this,"use443PortOnly",!1),M(this,"wsInflateLength",0),M(this,"wsDeflateLength",0),M(this,"closeEstablishingWs",()=>{}),M(this,"store",void 0),M(this,"joinGatewayRecordIndex",void 0),this.store=p,this.name=r,this.retryConfig=function(E){for(var w=1;w<arguments.length;w++){var C=arguments[w]!=null?arguments[w]:{};w%2?Q6(Object(C),!0).forEach(function(U){M(E,U,C[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(C)):Q6(Object(C)).forEach(function(U){Object.defineProperty(E,U,Object.getOwnPropertyDescriptor(C,U))})}return E}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Nr("websocket",p?p.clientId:void 0);const{timeout:m,timeoutFactor:g}=i,v=Math.max(300,Math.floor(3*m/5)),_=Math.max(1.2,Math.floor(8*g)/10);wi.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_),Pn.on(Ru.NETWORK_STATE_CHANGE,(E,w)=>{E!==w&&(this.resetReconnectCount("network state change: ".concat(w," -> ").concat(E)),E===wi.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{var c;const u=zg(),p=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(m){return!(Vb()||W("USE_NEW_TOKEN")||!W("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||W("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(lr.PRE_CONNECT_PC),this.createWebSocketConnection(p).then(u.resolve).catch(u.reject),this.once(St.CLOSED,()=>{u.reject(new me(H.WS_DISCONNECT))}),this.once(St.CONNECTED,u.resolve),await u.promise}catch{}finally{s()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new me(H.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new me(H.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const s=zg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=_=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async _=>{var E;if(R.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new me(H.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const w=ba(this,St.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,C=await this.reconnectWithAction(w);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return s.reject(new me(H.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);s.resolve()}},p=_=>{this.emit(St.ON_MESSAGE,_)},m=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),W("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=W("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),r);const g=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=ZA(r);const _=await this.chooseBestWebsocketConnection(r);this.websocket=_,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=p,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(_){const E=this.state==="closed",w=_ instanceof me,C=w&&_.code===H.WS_ABORT,U=w&&_.code===H.WS_ERR,k=w?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(k)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[_]},g),E||U?(s.reject(E?new me(H.WS_DISCONNECT,"websocket is closed: ".concat(k)):new me(H.WS_ERR,"init websocket failed: ".concat(k))),U&&R.error("[".concat(this.name,"] init websocket failed: ").concat(k))):u&&u(_)}return s.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Pn.isOnline||!Pn.onlineWaiter||(this.onlineReconnectListener=Pn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,i){const p=Pb(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(p,"ms to reconnect websocket, mode: ").concat(r)),await Pe.race([vr(p),this.onlineReconnectListener||new Pe(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(p,m)=>{this.emit(St.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(p)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await er(this,St.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(p){var u;R.error("[".concat(this.name,"] reconnect failed ").concat(p&&p.toString()));const m=p==null||(u=p.data)===null||u===void 0?void 0:u.desc;if(Array.isArray(m)){if(Ne(m).call(m,"dynamic key expired"))return this.emit(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(Ne(m).call(m,"request downgrade fallback"))return this.emit(St.ON_FALLBACK),!1}return this.reconnectWithAction(r,i)}return!0}}class eI extends Z6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const s=zg(),c=function(p,m){return new wve(p,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new me(H.WS_ABORT,"choose best websocket aborted"))};const u=W("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class av extends Z6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new Pe((s,c)=>{let u=!1;const p=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),p.forEach(U=>{U.onclose=null,U.onopen=null,U.onmessage=null,U.close()}),c(new me(H.WS_ABORT,"choose best websocket aborted"))};const m=W("GATEWAY_DOMAINS");let g;const v=r.indexOf("?h="),_=m.find(U=>v!==-1?Ne(r).call(r,U,v):Ne(r).call(r,U));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",m);let E=!this.tryDoubleDomain||!_;if(!E&&_){var w;const U=Date.now();try{m.forEach(k=>{const j=v===-1?r.replace(_,k):r.substr(0,v)+r.substr(v).replace(_,k),$=new WebSocket(j);$.binaryType="arraybuffer",p.push($),R.debug("[choose-best-ws] ws is connecting:",$.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(j=>j.close());p.length;)p.pop();E=!0}(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:p.map(k=>k.url),service:"gateway"},i),p.forEach(k=>{k.onopen=()=>{if(u)return;const j=Date.now()-U;R.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),p.filter($=>$!==k).forEach($=>{R.debug("[choose-best-ws]close backup websocket: ".concat($.url)),$.close()}),u=!0,s(k)},k.onclose=j=>{g=j,!u&&(p.find($=>!($.readyState===WebSocket.CLOSED||$.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),u=!0,c(g)))},k.onmessage=j=>{R.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(j.data))}}),vr(this.forceCloseTimeout).then(()=>{p.forEach(k=>{k.readyState!==WebSocket.OPEN&&k.close()})})}if(E){var C;let U;R.debug("[choose-best-ws] use single url: ",r),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[r],service:"gateway"},i);try{U=new WebSocket(r),p.push(U),U.binaryType="arraybuffer"}catch(k){const j=new me(H.WS_ERR,"init websocket failed! Error: ".concat(k.toString()));return R.error("[".concat(this.name,"]").concat(j)),void c(j)}U.onopen=()=>{s(U)},U.onclose=k=>{c(k)},U.onmessage=k=>{R.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(k.data))},vr(this.forceCloseTimeout).then(()=>{U&&U.readyState!==WebSocket.OPEN&&U.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class e8 extends Nn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Lt.CONNECTED?this.emit(Ye.WS_CONNECTED):r===Lt.RECONNECTING?this.emit(Ye.WS_RECONNECTING,this._websocketReconnectReason):r===Lt.CLOSED&&this.emit(Ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),M(this,"__name__","AgoraRTCSignal"),M(this,"_disconnectedReason",void 0),M(this,"_websocketReconnectReason",void 0),M(this,"_connectionState",Lt.CLOSED),M(this,"reconnectToken",void 0),M(this,"websocket",void 0),M(this,"openConnectionTime",void 0),M(this,"clientId",void 0),M(this,"lastMsgTime",Date.now()),M(this,"uploadCache",[]),M(this,"uploadCacheInterval",void 0),M(this,"rttRolling",new sA(5)),M(this,"pingpongTimer",void 0),M(this,"wsInflateDataTimer",void 0),M(this,"pingpongTimeoutCount",0),M(this,"ortc",void 0),M(this,"joinResponse",void 0),M(this,"multiIpOption",void 0),M(this,"initError",void 0),M(this,"spec",void 0),M(this,"store",void 0),M(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Ye.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===gt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jt.UID_BANNED);break;case 15:this.close(jt.IP_BANNED);break;case 16:this.close(jt.CHANNEL_BANNED)}if(c._type===gt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(jt.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(jt.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jt.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(jt.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jt.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(jt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new eI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)})}async request(r,i,s,c){const u=Zt(6,""),p={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new Pe((U,k)=>{if(this.connectionState===Lt.CONNECTED)return U();const j=()=>{this.off(Ye.WS_CLOSED,$),U()},$=()=>{this.off(Ye.WS_CONNECTED,j),k(new ce(H.WS_ABORT))};this.once(Ye.WS_CONNECTED,j),this.once(Ye.WS_CLOSED,$),r!==Je.PUBLISH&&r!==Je.PUBLISH_DATASTREAM&&r!==Je.SUBSCRIBE&&r!==Je.SUBSCRIBE_DATASTREAM&&r!==Je.UNSUBSCRIBE&&r!==Je.UNSUBSCRIBE_DATASTREAM&&r!==Je.UNPUBLISH&&r!==Je.UNPUBLISH_DATASTREAM&&r!==Je.CONTROL&&r!==Je.RESTART_ICE||this.once(Ye.DISCONNECT_P2P,()=>{k(new ce(H.DISCONNECT_P2P))}),r!==Je.PUBLISH&&r!==Je.RESTART_ICE||this.once(Ye.ABORT_P2P_EXECUTION,()=>{k(new ce(H.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||r===Je.JOIN||r===Je.REJOIN||await g(),this.websocket.sendMessage(p,!0),c)return;const v=new Pe((U,k)=>{let j=!1;const $=(J,ne)=>{j=!0,U({isSuccess:J==="success",message:ne||{}}),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.emit(Ye.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{k(new ce(H.WS_ABORT,"type: ".concat(r))),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(Ye.WS_CLOSED,K),this.once(Ye.WS_RECONNECTING,K),vr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ye.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===Lt.CLOSED||r===Je.LEAVE)throw new ce(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Je.JOIN||r===Je.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),w=$u(E),C=new ce(H.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:E,data:_.message,desc:w.desc});return w.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(E,", message: ").concat(w.desc,", action: ").concat(w.action)),E===nt.ERR_TOO_MANY_BROADCASTERS?((r===Je.JOIN||r===Je.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(E===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(w.action,Wr.SERVER_ERROR),r===Je.JOIN||r===Je.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Pe(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Wu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const p=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Pe((i,s)=>{this.once(Ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ye.WS_CLOSED,c=>s(this.initError||new ce(H.WS_ABORT,c))),this.connectionState=Lt.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||jt.LEAVE,this.connectionState=Lt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ye.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,Ye.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(Je.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!i)return this.emit(Ye.REPORT_JOIN_GATEWAY,sx.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ce(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Au(this,Ye.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Je.REJOIN,r);return!!i&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(s=>{this.emit(gt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(gt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(gt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(gt.MUTE_AUDIO,{uid:s.uid}):this.emit(gt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(gt.MUTE_VIDEO,{uid:s.uid}):this.emit(gt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(gt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(gt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(gt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(gt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(gt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Je.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=$u(r.code);if(r.code===28&&"detail"in r&&(R.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Ye.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===nt.ERR_REPEAT_JOIN_CHANNEL&&W("IGNORE_UID_CHECK")?void this.close(jt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jt.UID_BANNED),void this.close()):r.code===nt.K_VOS_FALLBACK&&"detail"in r?(R.info("[".concat(this.clientId,"] receive vos fallback notification: "),r.detail),r.detail==="FALLBACKCN"&&W("ENABLE_QUALITY_FALLBACK")?void er(this,Ye.VOS_FALLBACK_PROMISE,r.detail).then(()=>{this.reconnect("recover",i.desc)}).catch(s=>{R.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),s)}):r.detail==="fallback_hls"&&W("ENABLE_FALLBACK_TO_HLS")?(this.emit(Ye.VOS_FALLBACK,r.detail),void this.close(jt.FALLBACK_TO_HLS)):this.reconnect(i.action,i.desc)):void this.reconnect(i.action,Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(Je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(Je.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(Wu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(St.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ye.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(St.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(St.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(St.FAILED,()=>{this._disconnectedReason=jt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(St.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(St.WILL_RECONNECT,(r,i,s)=>{const c=Au(this,Ye.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=sx.P2P_DISCONNECTED),u&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Ye.REPORT_JOIN_GATEWAY,i||sx.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ye.DISCONNECT_P2P)),s(r)}),this.websocket.on(St.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Wr.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Ye.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ce){if(r.code===H.UNEXPECTED_RESPONSE&&r.data.code===nt.ERR_NO_AUTHORIZED)return this.initError=new ce(H.TOKEN_EXPIRE,"dynamic key expired"),void this.close(jt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(St.REQUEST_NEW_URLS,(r,i)=>{er(this,Ye.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.PRE_CONNECT_PC,()=>{this.emit(Ye.PRE_CONNECT_PC)}),this.websocket.on(St.ON_FALLBACK,()=>{W("ENABLE_FALLBACK_TO_HLS")&&this.emit(Ye.VOS_FALLBACK,"fallback_hls")})}}let Tve=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Yn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function t8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function lx(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):t8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let tI=0;function zs(t){const r=W("TURN_DOMAINS");tI=(tI+1)%r.length;const i=r[tI]||"edge.agora.io";return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(i):(R.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function dx(t){try{const r=W("TURN_DOMAINS"),i=W("GATEWAY_DOMAINS").concat(r).find(s=>Ne(t).call(t,s));return i?t.split(".".concat(i))[0].replace(/-/g,"."):t}catch{return R.debug("serverUrlToIp error, fallback to url",t),t}}function nI(t,r){t.addresses||(t.addresses=[]);const i=function(m,g){if(W("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(E=>{let{ip:w,port:C}=E;return{address:"".concat(w,":").concat(C)}});const v=W("GATEWAY_DOMAINS");let _=v[1]&&Ne(g).call(g,v[1])?1:0;return m.map(E=>{let{domain_prefix:w,port:C,ip:U}=E;if(w)return{address:"".concat(w,".").concat(v[_++%v.length],":").concat(C)};const k=/^[\.\:\d]+$/.test(U),j=k?"".concat(U.replace(/[^\d]/g,"-"),".").concat(v[_++%v.length],":").concat(C):"".concat(U,":").concat(C);return k||R.debug("Cannot recognized as ip address: ".concat(U,", use as host3")),{ip:U,port:C,address:j}})}(t.addresses,r),s=Array.isArray(t.detail)&&t.detail[18];if(s&&typeof s=="string"){const m=s.split(";");for(let g=0;g<m.length;g++){var c;const v=Ei(c=m[g]).call(c);i[g]&&v&&(i[g].ip6=v)}}const u=t.detail&&t.detail.candidate;let p;if(u){const[m,g]=u.split(":");m&&g&&(p={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:i,apGatewayAddress:p,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Fi(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function n8(t){const r=t._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Fi(r.width),"x").concat(Fi(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function ux(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function sv(t,r){let i,s,c;switch(r){case Yn.CHOOSE_SERVER:s=4096,c="choose server";break;case Yn.CLOUD_PROXY:s=1048576,c="proxy";break;case Yn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case Yn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new ce(H.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(p=>lx(lx({},p),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:lx(lx({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!i)throw new ce(H.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return i}async function r8(t,r){return await Pe.all(t.addresses.map(async i=>({address:zs(i.ip),tcpport:i.port,udpport:i.port,username:r&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():$r.username,password:r&&W("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await ZR(r.toString()):$r.password})))}function rI(t,r){const i=r.getMediaStreamTrack(!0).getSettings(),s=r.videoHeight||i.height,c=r.videoWidth||i.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Fi(t.height),Fi(t.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ud(t){let{candidateType:r,relayProtocol:i,type:s,address:c,port:u,protocol:p}=t;const m={candidateType:r,relayProtocol:i,protocol:p};if(s!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=u}return m}function fc(t){const r=t.split(":"),i=t.split(/[-.]/),s=Ne(t).call(t,"-")?"-":".";let c=t;return r.length>1?i.length>1?(i[1]="**",c=i[0]+s+"**:"+r[r.length-1]):c=r.length>2?r[0]+s+"**:"+r[r.length-1]:"**:"+r[r.length-1]:i.length>1&&(c=i[0]+s+"**"),c}function i8(t,r){return t.getTransceivers().find(i=>i.sender.track===r||i.receiver.track===r)}function ov(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W("SVC_MODE");if(W("ENABLE_SVC"))return function(r){return r in jb}(t)?t:jb.L1T3}const a8={[$e.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[$e.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function s8(t){t.send&&(rm($e.VIDEO,t.send.videoExtensions),rm($e.AUDIO,t.send.audioExtensions)),t.recv&&(rm($e.VIDEO,t.recv.videoExtensions),rm($e.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(rm($e.VIDEO,t.sendrecv.videoExtensions),rm($e.AUDIO,t.sendrecv.audioExtensions))}function o8(t,r){t.send&&(hx($e.VIDEO,t.send.videoExtensions,r.send.videoExtensions),hx($e.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(hx($e.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),hx($e.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))}function hx(t,r,i){r.forEach(s=>{var c;const u=a8[t].find(m=>{var g;let{key:v}=m;return Ne(g=s.extensionName).call(g,v)});if(!u)return;const p=i.find(m=>{let{extensionName:g}=m;return Ne(g).call(g,u.key)});p&&Ne(c=p.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=p.extensionName)})}function rm(t,r){r.forEach(i=>{var s;const c=a8[t].find(u=>{var p;let{key:m}=u;return Ne(p=i.extensionName).call(p,m)});Ne(s=i.extensionName).call(s,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function c8(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ne(t).call(t,"abs-send-time")}function px(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ne(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function l8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function d8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?l8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function cv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:p,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:_}=r,{useXR:E}=i;let w=[],C=[],U=[],k=[],j=!1,$=!1;if(Ti(t).mediaDescriptions.forEach(J=>{s&&s!==J.attributes.direction||(J.media.mediaType!=="video"||j||(C=J.attributes.payloads,k=J.attributes.extmaps,j=!0),J.media.mediaType!=="audio"||$||(w=J.attributes.payloads,U=J.attributes.extmaps,$=!0))}),!k||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!U||w.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(J=>{var ne;(ne=J.rtpMap)!==null&&ne!==void 0&&ne.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),E&&J.rtcpFeedbacks.push({type:"rrtr"})}),w.forEach(J=>{var ne;(ne=J.rtpMap)!==null&&ne!==void 0&&ne.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),E&&J.rtcpFeedbacks.push({type:"rrtr"})}),c&&(w=w.filter(J=>{var ne;return((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())!=="rtx"}),C=C.filter(J=>{var ne;return((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())!=="rtx"})),u){const J=C.filter(ee=>{var oe;return/(red)|(ulpfec)|(flexfec)/i.test(((oe=ee.rtpMap)===null||oe===void 0?void 0:oe.encodingName)||"")}),ne=hd(J,C).map(ee=>ee.payloadType),ae=[...J.map(ee=>ee.payloadType),...ne];C=C.filter(ee=>!Ne(ae).call(ae,ee.payloadType))}if(p&&(w=w.filter(J=>{var ne;return!/(red)|(ulpfec)|(flexfec)/i.test(((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(w=w.filter(J=>{var ne;return Ne(m).call(m,((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const J=C.filter(ne=>{var ae;return Ne(g).call(g,((ae=ne.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())||"")});C=J.concat(c?[]:hd(J,C))}const K=W("UNSUPPORTED_VIDEO_CODEC");if(K&&K.length>0){const J=C.filter(ee=>ee.rtpMap&&Ne(K).call(K,ee.rtpMap.encodingName.toLowerCase())),ne=hd(J,C),ae=J.concat(ne).map(ee=>ee.payloadType);C=C.filter(ee=>!Ne(ae).call(ae,ee.payloadType)),R.debug("unsupportedVideoCodec: ".concat(K,", toBeRemoved: ").concat(ae))}if(v&&v.length>0&&s==="sendonly"){const J=C.filter(ee=>ee.rtpMap&&Ne(v).call(v,ee.rtpMap.encodingName.toLowerCase())),ne=hd(J,C),ae=J.concat(ne).map(ee=>ee.payloadType);C=C.filter(ee=>!Ne(ae).call(ae,ee.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(ae))}if(_&&_.length>0&&s==="recvonly"){const J=C.filter(ee=>ee.rtpMap&&Ne(_).call(_,ee.rtpMap.encodingName.toLowerCase())),ne=hd(J,C),ae=J.concat(ne).map(ee=>ee.payloadType);C=C.filter(ee=>!Ne(ae).call(ae,ee.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(ae))}return{audioCodecs:w,videoCodecs:C,audioExtensions:U,videoExtensions:k}}function gc(t){const r=Ti(t);let i,s;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,p=c.attributes.icePwd;if(!u||!p)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:p}}if(!s){const u=c.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function iI(t,r){const i=[],s=t.attributes.ssrcGroups.filter(p=>p.semantic==="FID"),c=t.attributes.ssrcGroups.find(p=>p.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(p=>{var m;const g=(m=s.find(v=>v.ssrcIds[0]===p))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:p,rtx:r?g:void 0})});else if(s.length>0){const p=s[0].ssrcIds[0],m=s[0].ssrcIds[1];i.push({ssrcId:p,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function u8(t,r,i){const{cname:s}=t;let c=[];r&&(c=h8(r)),c.length===0&&(c=t.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},p={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=dv(t.rtpCapabilities),v=[];return Array.isArray(i)&&i.length>0&&i.forEach(_=>{v.push({kind:$e.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:$e.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:u,iceParameters:p,candidates:c,rtpCapabilities:g,setup:m,cname:s,preSSRCs:v}}function h8(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(fc(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(fc(t.ip6),":").concat(t.port)))),r}function lv(t,r,i){const s=[],c=[];return t.forEach(u=>{let{ssrcId:p,rtx:m}=u;const g=Zt(8,"track-"),v={ssrcId:p,attributes:d8({label:g,mslabel:i=i||Zt(10,""),msid:"".concat(i," ").concat(g)},r&&{cname:r})};if(s.push(v),m!==void 0){const _={ssrcId:m,attributes:d8({label:g,mslabel:i,msid:"".concat(i," ").concat(g)},r&&{cname:r})};s.push(_),c.push({semantic:"FID",ssrcIds:[p,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:p}=u;return p})}),{ssrcs:s,ssrcGroups:c}}function Hu(t,r){r instanceof Mn&&t.attributes.payloads.forEach(i=>{var s;const c=(s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),c==="opus"&&typeof W("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=W("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!_n()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),r instanceof rv&&c==="opus"&&r._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function aI(t){const r=t.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function sI(t,r){var i;if(t.attributes.payloads.forEach(c=>{var u;((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&W("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(r instanceof dn&&r._encoderConfig&&r._hints.indexOf(Jt.SCREEN_TRACK)===-1))return;const s=r._encoderConfig;Pt().supportMinBitrate&&s.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,p;Ne(u=["h264","h265","vp8","vp9","av1"]).call(u,((p=c.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Pt().supportMinBitrate&&!Ne(i=r._hints).call(i,Jt.LOW_STREAM)&&s.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,p;Ne(u=["h264","h265","vp8","vp9","av1"]).call(u,((p=c.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(W("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function p8(t){if(t.media.mediaType!=="video")return;const r=$t();if(r.name!==zt.SAFARI&&r.os!==gr.IOS)return;const i=t.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));i!==-1&&t.attributes.extmaps.splice(i,1)}function mx(t,r,i){if(!r)return;let s,c;if(t.media.mediaType==="video"?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=s.find(p=>px(p.extensionName));if(u){const p=u.extensionName;t.attributes.extmaps.find(g=>px(g.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:p}),function(g,v){return v.filter(_=>!!g.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(w=>w.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(p=>px(p.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(p=>{const m=p.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&p.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=s.find(p=>c8(p.extensionName));if(u){const p=u.extensionName;t.attributes.extmaps.find(g=>g.extensionName===p)||t.attributes.extmaps.push({entry:u.entry,extensionName:p}),function(g,v){return v.filter(_=>!!g.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(w=>w.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(v=>v.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(p=>c8(p.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(p=>{const m=p.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&p.rtcpFeedbacks.splice(m,1)})}}function oI(t,r,i){if(_n()||t.media.mediaType!=="video"||!(r instanceof dn)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!W("SIMULCAST")||i==="vp9"&&W("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const s=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),p={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<s;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:bn(c.attributes)}),p.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:bn(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(p)}async function m8(){try{const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:jb.L1T3}]});const r=await t.createOffer();if(!r.sdp)return void t.close();const i=Ti(r.sdp).mediaDescriptions[0];if(!i)return;const s=i.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return t.close(),s}catch{return}}async function cI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:p}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const _=cv(v,m,g,"sendonly"),E=cv(v,m,g,"recvonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(_,E,"videoExtensions",w,C,U),Ks(_,E,"videoCodecs",w,C,U),Ks(_,E,"audioExtensions",w,C,U),Ks(_,E,"audioCodecs",w,C,U),W("RAISE_H264_BASELINE_PRIORITY")){const k=[],j=[];if(U.videoCodecs.forEach(($,K)=>{var J;if(((J=$.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){var ne,ae;const ee=U.videoCodecs[K+1],oe=ee&&y8($,ee),ve=(ne=$.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"],Ee=(ae=$.fmtp)===null||ae===void 0?void 0:ae.parameters["packetization-mode"];!ve||ve!==W("FIRST_H264_PROFILE_LEVEL_ID")||W("FIRST_PACKETIZATION_MODE")&&Ee!==W("FIRST_PACKETIZATION_MODE")?oe?j.push([$,ee]):j.push([$]):oe?k.push([$,ee]):k.push([$])}}),k.length>0&&j.length>0){R.debug("raising H264 baseline profile priority"),U.videoCodecs.forEach((K,J)=>{var ne;if(((ne=K.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLocaleLowerCase())==="h264"){const ae=y8(K,U.videoCodecs[J+1]),ee=k.shift()||j.shift()||[];ee.length>0&&(ae?U.videoCodecs.splice(J,2,...ee):U.videoCodecs.splice(J,1,...ee))}});const $=C.videoCodecs.filter(K=>{var J,ne;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ne=K.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID")});if($.length>0){const K=hd($,C.videoCodecs).map(ne=>ne.payloadType),J=[...$.map(ne=>ne.payloadType),...K];C.videoCodecs=C.videoCodecs.filter(ne=>!Ne(J).call(J,ne.payloadType))}W("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter(K=>{var J,ne;return!(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ne=K.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"])!==W("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:w,recv:C,sendrecv:U}}return{send:w,recv:C,sendrecv:U}}(t,r,s);try{i.close()}catch{}return{send:c,recv:u,sendrecv:p}}function f8(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=cv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(t,r,"videoExtensions",i,s,c),Ks(t,r,"videoCodecs",i,s,c),Ks(t,r,"audioExtensions",i,s,c),Ks(t,r,"audioCodecs",i,s,c),W("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(p=>p.rtpMap&&p.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&p.fmtp&&p.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const p=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(p<u){R.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(p,0,m)}p!==-1&&(s.videoCodecs=s.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:s,sendrecv:c}}function Ks(t,r,i,s,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const p=[];return t[i].forEach(m=>{r[i].some((g,v)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return p.push(v),!0})?u[i].push(m):s[i].push(m)}),void r[i].forEach((m,g)=>{p.indexOf(g)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const p=[];return t[i].forEach(m=>{r[i].some((g,v)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return p.push(v),!0})?u[i].push(m):s[i].push(m)}),void r[i].forEach((m,g)=>{p.indexOf(g)===-1&&c[i].push(m)})}}function dv(t){const{send:r,recv:i,sendrecv:s}=t;if(!s){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...s.audioCodecs],c.videoCodecs=[...r.videoCodecs,...s.videoCodecs],c.audioExtensions=[...r.audioExtensions,...s.audioExtensions],c.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):c=bn(s),i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...s.audioCodecs],u.videoCodecs=[...i.videoCodecs,...s.videoCodecs],u.audioExtensions=[...i.audioExtensions,...s.audioExtensions],u.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):u=bn(s),{send:c,recv:u}}function im(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function uv(t,r,i,s){let c=[];if(t===$e.VIDEO){if(W("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=r.videoCodecs.filter(u=>{var p;return Ne(p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(p,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===W("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const p=[],m=[],g=[];if(i.videoCodecs.forEach(v=>{const _=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";Ne(_).call(_,s)?u.push(v):Ne(_).call(_,"vp9")?p.push(v):Ne(_).call(_,"vp8")?m.push(v):Ne(_).call(_,"h264")&&g.push(v)}),u.length===0){let v="";p.length!==0?(u=p,v="vp9"):m.length!==0?(u=m,v="vp8"):g.length!==0&&(u=g,v="h264"),R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=r.videoCodecs.filter(v=>u.some(_=>_.payloadType===v.payloadType)))}if(c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),W("USE_PUB_RTX")||W("USE_SUB_RTX")){const u=hd(c,r.videoCodecs);c=[...c,...u]}}else{c=r.audioCodecs.filter(p=>{var m;return Ne(m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(m,s)});const u=r.audioCodecs.filter(p=>{var m;return Ne(m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(p=>{var m;return Ne(m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),W("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function hd(t,r){const i=t.map(s=>s.payloadType.toString());return r.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&Ne(i).call(i,s.fmtp&&s.fmtp.parameters.apt))}async function Qi(t,r,i){const s=r.toString(),c=g8(s,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:s});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let p=u.sdp;p=lI(p,i||{}),c==null||c(p||""),await t.setLocalDescription({type:"answer",sdp:p})}function lI(t,r,i){if(W("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const s=Ti(t),{useXR:c}=r;return s.mediaDescriptions.forEach(u=>{var p;u.attributes.mid&&(Array.isArray(i)&&!Ne(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&im(u),u.media.mediaType==="video"&&function(m){m.media.mediaType==="video"&&W("ENABLE_DOWN_SPS_PPS")&&m.attributes.payloads.filter(g=>{var v;return((v=g.rtpMap)===null||v===void 0?void 0:v.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(u),c&&Ne(p=["audio","video"]).call(p,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),el(s)}function g8(t,r,i,s){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{g8(c,"answer",i==="local"?"remote":"local",s)}:void 0}async function v8(t,r,i){try{var s;if(!Pt().supportSetRtpSenderParameters||!function(g){return g==="vp9"||g==="av1"}(t)||!W("ENABLE_SVC"))return;const c={},u={},p=r.getParameters(),m=(s=p.encodings)===null||s===void 0?void 0:s[0];u.scalabilityMode=ov(i),m&&Object.assign(m,u),Object.assign(p,c),await r.setParameters(p),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(p.encodings)))}catch(c){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function fx(t){const r=W("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>Ne(t).call(t,i))}function y8(t,r){try{var i;return((i=t.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function _8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ea(t,r){return typeof W(t)===r?W(t):void 0}function Cve(){try{const t=W("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?_8(Object(s),!0).forEach(function(c){M(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):_8(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},t)}catch(t){return R.debug("handle gateway attributes failed: ",t),{}}}const b8={};function vc(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(t.name)),b8[t.name]=t}function Io(t){const r=b8[t];if(!r)throw new me(H.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function x8(t,r){return Io("DataStream").create(t,r)}function gx(){return Io("InterceptFrame").create()}function E8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ir(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?E8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):E8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const dI=new Map;class Nve extends Nn{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(Gn.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(Gn.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var s,c,u;super(),M(this,"store",void 0),M(this,"joinInfo",void 0),M(this,"key",void 0),M(this,"ntpOffset",0),M(this,"usingProxy",!1),M(this,"signal",void 0),M(this,"role",void 0),M(this,"isPreallocation",void 0),M(this,"isPreSub",void 0),M(this,"inChannelInfo",{joinAt:null,duration:0}),M(this,"spec",void 0),M(this,"_state","DISCONNECTED"),M(this,"_statsCollector",void 0),M(this,"_disconnectedReason",void 0),M(this,"isSignalRecover",!1),M(this,"hasChangeBGPAddress",!1),M(this,"trafficStatsInterval",void 0),M(this,"networkQualityInterval",void 0),M(this,"_joinGatewayStartTime",0),M(this,"_signalTimeout",!1),M(this,"_clientRoleOptions",void 0),M(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(s={spec:Ir(Ir({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Io("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,s)):this.store.useDcSignal?function(p){return Io("DataChannelSignal").create(p)}({spec:Ir(Ir({},i),{},{retryConfig:i.websocketRetryConfig}),store:r}):new e8(Ir(Ir({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(r){this.usingProxy=r}async join(r,i,s){if(this.store.useDcSignal){let _=!1;r.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(r.cloudProxyServer,")")),_=!0):"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length>255||"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):r.apResponse.addresses.some(E=>E.fingerprint)||W("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=dI.get(r.cname);if(u||(u=new Map,dI.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const _=new ce(H.UID_CONFLICT);throw ze.joinGateway(r.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:r.preload}),_}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let p=0;this.joinGatewayStartTime=c;const m=r.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{R.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(p));const _=r.gatewayAddrs.map(w=>{let{address:C}=w;const[U,k]=C.split(":"),j={host:U,port:k};return r.proxyServer&&(j.proxy=r.proxyServer),j});let E;E=this.store.useDcSignal?await this.signal.init(r.apResponse.addresses):await this.signal.init(_),p=E.uid,R.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(p," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var v;throw _.code===H.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||ze.joinGateway(r.sid,{lts:c,succ:!1,ec:((v=_.data)===null||v===void 0?void 0:v.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:r.preload}),_&&_.code===H.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(R.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),u.delete(r.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Gn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:ux(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:ux(this._statsCollector.trafficStats.B_dnq)}):this.emit(Gn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),p}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==jt.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Lt.CONNECTED||await function(s,c){return c===1/0?s:Pe.race([s,ege(c)])}(this.signal.request(Je.LEAVE,void 0,!0),3e3)}catch(s){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(i),i!==jt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:W("PUB_EXTEND"),twcc:!!W("PUBLISH_TWCC"),rtx:!!W("USE_PUB_RTX")};try{return(await this.signal.request(Je.PUBLISH,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Je.PUBLISH_DATASTREAM,u,!0)}catch(p){if(s&&p.data&&p.data.code===nt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw p}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Je.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Pe.all(r.map(i=>this.signal.request(Je.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){R.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX")||void 0,extend:W("SUB_EXTEND"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(Je.PRE_SUBSCRIBE,c,!0)}catch(u){if(s&&u.data&&u.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!W("SUBSCRIBE_TWCC"),rtx:!!W("USE_SUB_RTX"),extend:W("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return(await this.signal.request(Je.SUBSCRIBE,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Je.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(s&&u.data&&u.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!W("USE_SUB_RTX"),twcc:!!W("SUBSCRIBE_TWCC"),svc:Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0};try{return await this.signal.request(Je.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(i&&c.data&&c.data.code===nt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,u=s.width,p=s.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof p!="number"&&(p=p.exact||p.ideal||p.max||p.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:p,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(r);if(i)return this.signal.request(Je.SET_VIDEO_PROFILE,i);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(Je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Pe.all(r.map(s=>this.signal.request(Je.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:i},!0)))}catch(s){R.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(r){try{await this.signal.request(Je.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Je.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Je.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Je.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),W("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),W("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},W("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(W("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let s,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const u=Object.assign({},i);delete u.delay,delete u.level,await this.signal.request(Je.SET_CLIENT_ROLE,Ir(Ir({role:r,level:c,delay:s},u),{},{client_ts:Date.now()})),this.role=r}async setDualStreamMode(r,i,s){await this.signal.request(Je.SET_DUAL_STREAM_MODE,{mode:r},s,i)}async setRemoteVideoStreamType(r,i){await this.signal.request(Je.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Je.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(Je.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(Je.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Je.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ir({},this.inChannelInfo)}async setConfigure(r){if(r&&Array.isArray(r)&&r.length!==0)return this.signal.request(Je.CONFIGURE,r)}async getGatewayVersion(){return(await this.signal.request(Je.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=dI.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:$r.username,password:$r.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ir(Ir({},$r),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Je.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);s&&s.B_st!==i.B_st&&Ob(()=>{this.emit(Gn.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var i,s,c,u;if(!this.joinInfo||!this.key)throw new ce(H.UNEXPECTED_ERROR,"can not generate join message, no join info");const p=Object.assign({},this.joinInfo.apResponse);let m=W("REPORT_APP_SCENARIO");if(typeof m!="string")try{m=JSON.stringify(m)}catch{m=void 0}var g;m&&m.length>128&&(m=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Gn.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,Ne(Qp).call(Qp,g)||Qp.push(g);const v=tv(this.store),_=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),E=EV(this.store),w=Cve(),C=wo(87)||RF()||KR(117),U=(function(){const K=$t();if(K.name!==zt.SAFARI||!K.browserVersion)return!1;const J=K.browserVersion.split(".");return Number(J[0])>18||Number(J[0])===18&&Number(J[1])>=4}()||PF(18,4,!1))&&YR(18,6,!0)&&this.spec.codec==="h264"&&W("ENABLE_ABSSENDTIME_AS_SENTTS"),k=!(((s=p.detail)===null||s===void 0?void 0:s[3])!=="CN"||!W("ENABLE_QUALITY_FALLBACK"))&&W("ENABLE_QUALITY_FALLBACK"),j=!!W("ENABLE_AP_MULTI_IP")&&((c=p.detail)===null||c===void 0?void 0:c[5])==="multi-ip",$=Ir({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:cs,browser:navigator.userAgent,process_id:W("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:p,extend:W("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:m,attributes:{userAttributes:Ir(Ir({enableEncodedTransform:(!!W("ENABLE_AUDIO_METADATA")||!!W("ENABLE_AUDIO_PTS"))&&C||!!W("ENABLE_AUDIO_TOPN")&&zR(zt.CHROME,87,116)||void 0,enableAudioMetadata:!!W("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!W("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:W("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:W("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:W("TOPN_SWITCH_HOLD_MS"),topnAudioGain:W("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:W("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:W("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ea("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ea("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ea("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:W("USE_PUB_RTX")===!0||W("USE_SUB_RTX")===!0||void 0,disableFEC:W("DISABLE_FEC"),enableNTPReport:!!W("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!W("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ea("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!W("FORCE_ENABLE_AUT_CC")||!Vb()&&(!!W("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!W("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ea("USE_XR","boolean"),enableLossbasedBwe:Ea("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!W("FORCE_ENABLE_AUT_CC")||!Vb()&&(!!W("ENABLE_AUT_CC")||void 0),enableCCFallback:Ea("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:v?Ea("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ea("PUBLISH_TWCC","boolean"),enableSubTWCC:Ea("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ea("USE_PUB_RTX","boolean"),enableSubRTX:Ea("USE_SUB_RTX","boolean"),enableSubSVC:W("ENABLE_SVC")?W("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(W("SVC"))&&W("SVC").length!==0?W("SVC"):void 0,enableSvcExtended:W("ENABLE_SVC")&&Array.isArray(W("SVC_EXTENDED"))&&W("SVC_EXTENDED").length!==0?W("SVC_EXTENDED"):void 0,enableVosFallback:W("ENABLE_VOS_FALLBACK"),enableQualityFallback:k},w),{},{audioDuplicate:Ea("ENABLE_AUDIO_RED","boolean")?(u=Ea("AUDIO_DUPLICATE_NUM","number"))!==null&&u!==void 0?u:2:void 0,senttsUsesAbsSendTime:!!U||void 0,enableDualStreamFlag:Ea("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&($.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&($.aes_mode=this.joinInfo.aesmode,W("ENCRYPT_AES")?($.aes_secret=this.joinInfo.aespassword,$.aes_encrypt=!0):$.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&($.aes_salt=this.joinInfo.aessalt)),p.addresses[this.signal.websocket.currentURLIndex]&&($.ap_response.ticket=p.addresses[this.signal.websocket.currentURLIndex].ticket,delete p.addresses),this.joinInfo.defaultVideoStream!==void 0&&($.default_video_stream=this.joinInfo.defaultVideoStream),$}getRejoinMessage(){if(!this.joinInfo)throw new ce(H.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ye.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ye.WS_RECONNECTING,r=>{this.joinInfo&&ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Wr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ze.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ye.WS_CLOSED,r=>{let i;switch(r){case jt.LEAVE:i=Wr.LEAVE;break;case jt.UID_BANNED:case jt.IP_BANNED:case jt.CHANNEL_BANNED:case jt.SERVER_ERROR:i=Wr.SERVER_ERROR;break;case jt.FALLBACK:i=Wr.FALLBACK;break;case jt.LICENSE_MISSING:case jt.LICENSE_EXPIRED:case jt.LICENSE_MINUTES_EXCEEDED:case jt.LICENSE_PERIOD_INVALID:case jt.LICENSE_MULTIPLE_SDK_SERVICE:case jt.LICENSE_ILLEGAL:case jt.TOKEN_EXPIRE:i=r;break;default:i=Wr.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+Wr.NETWORK_ERROR)),this.joinInfo&&ze.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===jt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==jt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=W("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));an("EVENT_REPORT_DOMAIN",r[1]),an("EVENT_REPORT_BACKUP_DOMAIN",r[1]),an("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(gt.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Ye.REQUEST_RECOVER,(r,i,s)=>{if(!this.joinInfo)return s(new ce(H.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,er(this,Gn.REQUEST_NEW_GATEWAY_LIST).then(i).catch(s)}),this.signal.on(Ye.REQUEST_JOIN_INFO,async(r,i,s)=>{var c,u,p;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=bn((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(W("NEW_TURN_MODE")&&m&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let w=m.servers.map(k=>"turnServerURL"in k&&W("USE_TURN_IP")?Ir(Ir({},k),{},{turnServerURL:dx(k.turnServerURL)}):k),C=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(k=>W("USE_TURN_IP")?Ir(Ir({},k),{},{turnServerURL:dx(k.turnServerURL)}):k);const U=this.signal.currentURLIndex;w.length>0&&(w=[w[U%w.length]],m.servers=w),Array.isArray(C)&&C.length>0&&(C=[C[0]],m.serversFromGateway=C),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(U))}const{iceParameters:v,dtlsParameters:_,rtpCapabilities:E}=await er(this,Gn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(p=this.joinInfo)===null||p===void 0?void 0:p.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:_,rtpCapabilities:E,version:"2"}}))}catch(w){i(w)}}),this.signal.on(Ye.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Ye.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let s,c="";var u;r instanceof ce?(s=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):s=r,ze.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(Ye.IS_P2P_DISCONNECTED,r=>{r(Au(this,Gn.IS_P2P_DISCONNECTED))}),this.signal.on(Ye.DISCONNECT_P2P,()=>{this.emit(Gn.DISCONNECT_P2P)}),this.signal.on(Ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ye.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(Gn.JOIN_RESPONSE,r,i)}),this.signal.on(Ye.PRE_CONNECT_PC,async(r,i)=>{if(this.joinInfo){var s,c;this.updateTurnConfigFromSignal();const p=this.getCurrentGatewayAddress(),m=bn((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(W("NEW_TURN_MODE")&&m&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var u;let v=m.servers.map(w=>"turnServerURL"in w&&W("USE_TURN_IP")?Ir(Ir({},w),{},{turnServerURL:dx(w.turnServerURL)}):w),_=(u=m.serversFromGateway)===null||u===void 0?void 0:u.map(w=>W("USE_TURN_IP")?Ir(Ir({},w),{},{turnServerURL:dx(w.turnServerURL)}):w);const E=this.signal.currentURLIndex;v.length>0&&(v=[v[E%v.length]],m.servers=v),Array.isArray(_)&&_.length>0&&(_=[_[0]],m.serversFromGateway=_),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}const g=W("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(p&&g){const v=h8(p);er(this,Gn.PRE_CONNECT_PC,{candidates:v,fingerprint:g,turnServer:m}).then(_=>{r==null||r(_)}).catch(i||(()=>{}))}}}),this.signal.on(Ye.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof W("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(W("AP_REQUEST_DETAIL"),";").concat(r))}),this.signal.on(Ye.VOS_FALLBACK,r=>{this.emit(Gn.VOS_FALLBACK,r)}),this.signal.on(Ye.DATACHANNEL_FAILBACK,r=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Gn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(Je.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(Je.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(s){throw R.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(Je.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(Je.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(s){throw R.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(r){const i={users:r.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(Je.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(r,i){const s={action:r.find(c=>c.stream_type===tn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Je.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const s={action:r.find(c=>c.stream_type===tn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Je.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const s={action:r===$e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Je.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const s={action:r===$e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Je.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Je.RESTART_ICE,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||Wr.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!W("GATEWAY_WSS_ADDRESS"))return W("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Je.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(jt.FALLBACK)),this.store.useDcSignal=!1,this.signal=new e8(Ir(Ir({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Gn.RESET_SIGNAL)}}let vx=0,uI=0;function Oo(t,r,i,s){return new Pe((c,u)=>{r.timeout=r.timeout||W("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),vx+=uc(r.data)):i&&(r.data.size?vx+=r.data.size:r.data instanceof FormData?vx+=QF(r.data):vx+=uc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ji.request(r).then(p=>{typeof p.data=="string"?uI+=uc(p.data):p.data instanceof ArrayBuffer||p.data instanceof Uint8Array?uI+=p.data.byteLength:uI+=uc(JSON.stringify(p.data)),s&&c({data:p.data,headers:p.headers}),c(p.data)}).catch(p=>{ji.isCancel(p)?u(new ce(H.OPERATION_ABORTED,"cancel token canceled")):p.code==="ECONNABORTED"?u(new ce(H.NETWORK_TIMEOUT,p.message)):p.response?u(new ce(H.NETWORK_RESPONSE_ERROR,p.response.status)):u(new ce(H.NETWORK_ERROR,p.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(_e){var Oe=0;return function(){return Oe<_e.length?{done:!1,value:_e[Oe++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(_e,Oe,He){return _e==Array.prototype||_e==Object.prototype||(_e[Oe]=He.value),_e},s,c=function(_e){_e=[typeof globalThis=="object"&&globalThis,_e,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var Oe=0;Oe<_e.length;++Oe){var He=_e[Oe];if(He&&He.Math==Math)return He}throw Error("Cannot find global object")}(this);function u(_e,Oe){if(Oe)e:{var He=c;_e=_e.split(".");for(var xe=0;xe<_e.length-1;xe++){var D=_e[xe];if(!(D in He))break e;He=He[D]}(Oe=Oe(xe=He[_e=_e[_e.length-1]]))!=xe&&Oe!=null&&i(He,_e,{configurable:!0,writable:!0,value:Oe})}}function p(_e){return(_e={next:_e})[Symbol.iterator]=function(){return this},_e}function m(_e){var Oe=typeof Symbol<"u"&&Symbol.iterator&&_e[Symbol.iterator];return Oe?Oe.call(_e):{next:r(_e)}}if(u("Symbol",function(_e){function Oe(D,X){this.A=D,i(this,"description",{configurable:!0,writable:!0,value:X})}if(_e)return _e;Oe.prototype.toString=function(){return this.A};var He="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function D(X){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new Oe(He+(X||"")+"_"+xe++,X)}}),u("Symbol.iterator",function(_e){if(_e)return _e;_e=Symbol("Symbol.iterator");for(var Oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),He=0;He<Oe.length;He++){var xe=c[Oe[He]];typeof xe=="function"&&typeof xe.prototype[_e]!="function"&&i(xe.prototype,_e,{configurable:!0,writable:!0,value:function(){return p(r(this))}})}return _e}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}s=g?function(_e,Oe){if(_e.__proto__=Oe,_e.__proto__!==Oe)throw new TypeError(_e+" is not extensible");return _e}:null}var _=s;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function w(_e){if(_e.m)throw new TypeError("Generator is already running");_e.m=!0}function C(_e,Oe){return _e.h=3,{value:Oe}}function U(_e){this.g=new E,this.G=_e}function k(_e,Oe,He,xe){try{var D=Oe.call(_e.g.j,He);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return _e.g.m=!1,D;var X=D.value}catch(te){return _e.g.j=null,_e.g.s(te),j(_e)}return _e.g.j=null,xe.call(_e.g,X),j(_e)}function j(_e){for(;_e.g.h;)try{var Oe=_e.G(_e.g);if(Oe)return _e.g.m=!1,{value:Oe.value,done:!1}}catch(He){_e.g.v=void 0,_e.g.s(He)}if(_e.g.m=!1,_e.g.l){if(Oe=_e.g.l,_e.g.l=null,Oe.F)throw Oe.D;return{value:Oe.return,done:!0}}return{value:void 0,done:!0}}function $(_e){this.next=function(Oe){return _e.o(Oe)},this.throw=function(Oe){return _e.s(Oe)},this.return=function(Oe){return function(He,xe){w(He.g);var D=He.g.j;return D?k(He,"return"in D?D.return:function(X){return{value:X,done:!0}},xe,He.g.return):(He.g.return(xe),j(He))}(_e,Oe)},this[Symbol.iterator]=function(){return this}}function K(_e,Oe){return Oe=new $(new U(Oe)),_&&_e.prototype&&_(Oe,_e.prototype),Oe}if(E.prototype.o=function(_e){this.v=_e},E.prototype.s=function(_e){this.l={D:_e,F:!0},this.h=this.C||this.u},E.prototype.return=function(_e){this.l={return:_e},this.h=this.u},U.prototype.o=function(_e){return w(this.g),this.g.j?k(this,this.g.j.next,_e,this.g.o):(this.g.o(_e),j(this))},U.prototype.s=function(_e){return w(this.g),this.g.j?k(this,this.g.j.throw,_e,this.g.o):(this.g.s(_e),j(this))},u("Array.prototype.entries",function(_e){return _e||function(){return function(Oe,He){Oe instanceof String&&(Oe+="");var xe=0,D=!1,X={next:function(){if(!D&&xe<Oe.length){var te=xe++;return{value:He(te,Oe[te]),done:!1}}return D=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(Oe,He){return[Oe,He]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var J=function(_e,Oe){for(var He=0;He<_e.length;He++)Oe(_e[He])},ne=function(_e){return _e.replace(/\r?\n|\r/g,`\r
`)},ae=function(_e,Oe,He){return Oe instanceof Blob?(He=He!==void 0?He+"":typeof Oe.name=="string"?Oe.name:"blob",Oe.name===He&&Object.prototype.toString.call(Oe)!=="[object Blob]"||(Oe=new File([Oe],He)),[String(_e),Oe]):[String(_e),String(Oe)]},ee=function(_e,Oe){if(_e.length<Oe)throw new TypeError(Oe+" argument required, but only "+_e.length+" present.")},oe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ve=oe.FormData,Ee=oe.XMLHttpRequest&&oe.XMLHttpRequest.prototype.send,Be=oe.Request&&oe.fetch,mt=oe.navigator&&oe.navigator.sendBeacon,ct=oe.Element&&oe.Element.prototype,Tt=oe.Symbol&&Symbol.toStringTag;Tt&&(Blob.prototype[Tt]||(Blob.prototype[Tt]="Blob"),"File"in oe&&!File.prototype[Tt]&&(File.prototype[Tt]="File"));try{new File([],"")}catch{oe.File=function(Oe,He,xe){return Oe=new Blob(Oe,xe||{}),Object.defineProperties(Oe,{name:{value:He},lastModified:{value:+(xe&&xe.lastModified!==void 0?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Tt&&Object.defineProperty(Oe,Tt,{value:"File"}),Oe}}var Et=function(_e){return _e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yt=function(_e){this.i=[];var Oe=this;_e&&J(_e.elements,function(He){if(He.name&&!He.disabled&&He.type!=="submit"&&He.type!=="button"&&!He.matches("form fieldset[disabled] *"))if(He.type==="file"){var xe=He.files&&He.files.length?He.files:[new File([],"",{type:"application/octet-stream"})];J(xe,function(D){Oe.append(He.name,D)})}else He.type==="select-multiple"||He.type==="select-one"?J(He.options,function(D){!D.disabled&&D.selected&&Oe.append(He.name,D.value)}):He.type==="checkbox"||He.type==="radio"?He.checked&&Oe.append(He.name,He.value):(xe=He.type==="textarea"?ne(He.value):He.value,Oe.append(He.name,xe))})};if((t=Yt.prototype).append=function(_e,Oe,He){ee(arguments,2),this.i.push(ae(_e,Oe,He))},t.delete=function(_e){ee(arguments,1);var Oe=[];_e=String(_e),J(this.i,function(He){He[0]!==_e&&Oe.push(He)}),this.i=Oe},t.entries=function _e(){var Oe,He=this;return K(_e,function(xe){if(xe.h==1&&(Oe=0),xe.h!=3)return Oe<He.i.length?xe=C(xe,He.i[Oe]):(xe.h=0,xe=void 0),xe;Oe++,xe.h=2})},t.forEach=function(_e,Oe){ee(arguments,1);for(var He=m(this),xe=He.next();!xe.done;xe=He.next()){var D=m(xe.value);xe=D.next().value,D=D.next().value,_e.call(Oe,D,xe,this)}},t.get=function(_e){ee(arguments,1);var Oe=this.i;_e=String(_e);for(var He=0;He<Oe.length;He++)if(Oe[He][0]===_e)return Oe[He][1];return null},t.getAll=function(_e){ee(arguments,1);var Oe=[];return _e=String(_e),J(this.i,function(He){He[0]===_e&&Oe.push(He[1])}),Oe},t.has=function(_e){ee(arguments,1),_e=String(_e);for(var Oe=0;Oe<this.i.length;Oe++)if(this.i[Oe][0]===_e)return!0;return!1},t.keys=function _e(){var Oe,He,xe,D,X=this;return K(_e,function(te){if(te.h==1&&(Oe=m(X),He=Oe.next()),te.h!=3)return He.done?void(te.h=0):(xe=He.value,D=m(xe),C(te,D.next().value));He=Oe.next(),te.h=2})},t.set=function(_e,Oe,He){ee(arguments,2),_e=String(_e);var xe=[],D=ae(_e,Oe,He),X=!0;J(this.i,function(te){te[0]===_e?X&&(X=!xe.push(D)):xe.push(te)}),X&&xe.push(D),this.i=xe},t.values=function _e(){var Oe,He,xe,D,X=this;return K(_e,function(te){if(te.h==1&&(Oe=m(X),He=Oe.next()),te.h!=3)return He.done?void(te.h=0):(xe=He.value,(D=m(xe)).next(),C(te,D.next().value));He=Oe.next(),te.h=2})},Yt.prototype._asNative=function(){for(var _e=new ve,Oe=m(this),He=Oe.next();!He.done;He=Oe.next()){var xe=m(He.value);He=xe.next().value,xe=xe.next().value,_e.append(He,xe)}return _e},Yt.prototype._blob=function(){var _e="----formdata-polyfill-"+Math.random(),Oe=[],He="--"+_e+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(xe,D){return typeof xe=="string"?Oe.push(He+Et(ne(D))+`"\r
\r
`+ne(xe)+`\r
`):Oe.push(He+Et(ne(D))+'"; filename="'+Et(xe.name)+`"\r
Content-Type: `+(xe.type||"application/octet-stream")+`\r
\r
`,xe,`\r
`)}),Oe.push("--"+_e+"--"),new Blob(Oe,{type:"multipart/form-data; boundary="+_e})},Yt.prototype[Symbol.iterator]=function(){return this.entries()},Yt.prototype.toString=function(){return"[object FormData]"},ct&&!ct.matches&&(ct.matches=ct.matchesSelector||ct.mozMatchesSelector||ct.msMatchesSelector||ct.oMatchesSelector||ct.webkitMatchesSelector||function(_e){for(var Oe=(_e=(this.document||this.ownerDocument).querySelectorAll(_e)).length;0<=--Oe&&_e.item(Oe)!==this;);return-1<Oe}),Tt&&(Yt.prototype[Tt]="FormData"),Ee){var Tn=oe.XMLHttpRequest.prototype.setRequestHeader;oe.XMLHttpRequest.prototype.setRequestHeader=function(_e,Oe){Tn.call(this,_e,Oe),_e.toLowerCase()==="content-type"&&(this.B=!0)},oe.XMLHttpRequest.prototype.send=function(_e){_e instanceof Yt?(_e=_e._blob(),this.B||this.setRequestHeader("Content-Type",_e.type),Ee.call(this,_e)):Ee.call(this,_e)}}Be&&(oe.fetch=function(_e,Oe){return Oe&&Oe.body&&Oe.body instanceof Yt&&(Oe.body=Oe.body._blob()),Be.call(this,_e,Oe)}),mt&&(oe.navigator.sendBeacon=function(_e,Oe){return Oe instanceof Yt&&(Oe=Oe._asNative()),mt.call(this,_e,Oe)}),oe.FormData=Yt}})();const hv=()=>{const t=W("AREAS");return t.length===0&&t.push(qt.GLOBAL),ss(t).call(t,(r,i,s)=>{const c=S8(i);return c?s===0?c:"".concat(r,",").concat(c):r},"")},S8=t=>t===qt.OVERSEA?"".concat(Qr.ASIA,",").concat(Qr.EUROPE,",").concat(Qr.AFRICA,",").concat(Qr.NORTH_AMERICA,",").concat(Qr.SOUTH_AMERICA,",").concat(Qr.OCEANIA):Qr[t],Rve=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(i=>{const s=ox[i],c=Object.keys(s);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(s[u]))})}),r},yx={GLOBAL:{ASIA:[qt.CHINA,qt.JAPAN,qt.INDIA,qt.KOREA,qt.HKMC],EUROPE:[],NORTH_AMERICA:[qt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},_x=Object.keys(yx[qt.GLOBAL]),hI=[qt.CHINA,qt.NORTH_AMERICA,qt.EUROPE,qt.ASIA,qt.JAPAN,qt.INDIA,qt.OCEANIA,qt.SOUTH_AMERICA,qt.AFRICA,qt.KOREA,qt.HKMC,qt.US],Ave=function(t,r){let i=[];if(Ne(t).call(t,qt.GLOBAL)){const u=[qt.GLOBAL,qt.OVERSEA],p=Object.keys(ox);if(r===qt.GLOBAL)throw new ce(H.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===qt.CHINA)i=[qt.OVERSEA];else if(c=r,Ne(_x).call(_x,c)){const m=(s=r,yx[qt.GLOBAL][s]||[]),g=[...u,r,...m];i=p.filter(v=>!Ne(g).call(g,v))}else if(function(m){let g=!1;return _x.forEach(v=>{var _;Ne(_=yx[qt.GLOBAL][v]).call(_,m)&&(g=!0)}),g}(r)){const m=function(v){let _;return _x.forEach(E=>{var w;Ne(w=yx[qt.GLOBAL][E]).call(w,v)&&(_=E)}),_}(r),g=[...u,m,r];i=p.filter(v=>!Ne(g).call(g,v))}else i=t;i=function(m){const g=[];return hI.forEach(v=>{Ne(m).call(m,v)&&g.push(v)}),g.concat(m.filter(v=>!Ne(hI).call(hI,v)))}(i)}else i=t;var s,c;return i};function w8(t){var r,i;if(!t&&Ne(r=W("AREAS")).call(r,qt.EXTENSIONS))return R.debug("update area from ap : reset"),void pI(Uge,!0);if(!Ne(i=W("AREAS")).call(i,qt.GLOBAL)||!t)return;let s=ox.EXTENSIONS;s&&(s={CODE:S8(qt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},R.debug("update area from ap success: ".concat(t,",config is "),s),an("AREAS",[qt.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?an(c,s[c][0]):an(c,s[c])}))}function pI(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=ze.reportApiInvoke(null,{name:Sn.SET_AREA,options:t,tag:ln.TRACER});try{let s=[];if(typeof t=="string"&&(s=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!Ne(K6).call(K6,u))throw new ce(H.INVALID_PARAMS,"invalid area code")}),s=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:p}=t;if(!u)throw new ce(H.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),s=p?Ave(m,p):m}if(!r){if(ja.AREAS){const u=new ce(H.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void R.warning("setArea is prohibited because of config-distribute")}if(Ne(s).call(s,qt.GLOBAL)&&W("AREAS")===qt.EXTENSIONS){const u=new ce(H.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void R.warning("setArea is prohibited because of ap extensions")}}an("AREAS",s,r);const c=Rve(s);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?an(u,c[u][0]):an(u,c[u])}),R.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function T8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?T8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let mI=1;function Ive(t,r,i,s,c){mI+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:mI,requestId:mI,version:cs,cname:i.cname},p={service_name:r,json_body:JSON.stringify(u)};let m,g,v=t[0];return To(async()=>{m=Date.now();const _=await Oo(v,{data:p,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,_.code!==0){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:g});throw R.error(C.toString()),C}const E=JSON.parse(_.json_body);if(E.code!==200){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:g});throw R.error(C.toString()),C}if(!E.servers||E.servers.length===0){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:g});throw R.error(C.toString()),C}const w=function(C,U){return{addressList:C.servers.map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(k.wss,"?serviceName=").concat(encodeURIComponent(U))),workerToken:C.workerToken,vid:C.vid}}(E,r);return W("LIVE_STREAMING_ADDRESS")&&(w.addressList=W("LIVE_STREAMING_ADDRESS")instanceof Array?W("LIVE_STREAMING_ADDRESS"):[W("LIVE_STREAMING_ADDRESS")]),yc(yc({},w),{},{responseTime:g})},(_,E)=>(ze.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_.addressList),firstSuccess:E===0,responseTime:g,serverIp:t[E%t.length]}),!1),(_,E)=>(ze.apworkerEvent(i.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:r,responseTime:g,serverIp:t[E%t.length]}),!!(_.code!==H.OPERATION_ABORTED&&_.code!==H.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(v=t[(E+1)%t.length],!0)),c)}let fI=1;function C8(t,r,i,s){let{url:c,areaCode:u}=t;const{clientId:p,sid:m}=r,g=Date.now();let v;const _=r.role,[E,w]=vI(r,u,[Yn.CHOOSE_SERVER]);let C=Pn.networkState;return To(async()=>{C&&Pn.networkState===wi.OFFLINE&&Pn.onlineWaiter&&await Pe.race([Pn.onlineWaiter,vr(s&&s.maxRetryTimeout||Kn.maxRetryTimeout)]),C=Pn.networkState;const{data:U,headers:k}=await Oo(c,{data:E,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=k.http3==="1"?1:-1,ze.reportResourceTiming(c,m),R8(U,c,r,g,[Yn.CHOOSE_SERVER],v);const j=sv(U,Yn.CHOOSE_SERVER);return gI(j),nI(j,c)},U=>(U&&ze.joinChooseServer(m,{role:_,lts:g,succ:!0,csAddr:c,opid:w,serverList:U.gatewayAddrs.map(k=>k.address),ec:null,cid:U.cid.toString(),uid:U.uid.toString(),csIp:U.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:U.res.detail&&U.res.detail[38],vid:U.vid}),!1),U=>U.code!==H.OPERATION_ABORTED&&(U.code===H.CAN_NOT_GET_GATEWAY_SERVER?U.data.retry:(ze.joinChooseServer(m,{role:_,lts:g,succ:!1,csAddr:c,serverList:null,opid:w,ec:U.code,csIp:U.data&&U.data.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),R.warning("[".concat(p||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),U),!0)),s)}function N8(t,r,i,s){let c,{url:u,areaCode:p,serviceIds:m}=t;const g=Date.now(),v=r.role,[_,E]=vI(r,p,m);let w;return To(async()=>{w&&Pn.networkState===wi.OFFLINE&&Pn.onlineWaiter&&await Pe.race([Pn.onlineWaiter,vr(s&&s.maxRetryTimeout||Kn.maxRetryTimeout)]),w=Pn.networkState;const{data:C,headers:U}=await Oo(u,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=U.http3==="1"?1:-1,ze.reportResourceTiming(u,r.sid),R8(C,u,r,g,m,c);const k=sv(C,Yn.CHOOSE_SERVER),j=sv(C,r.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK),$=performance.getEntriesByName(u),K=$[$.length-1];let J;return K&&(J={name:K.name,protocol:"nextHopProtocol"in K?K.nextHopProtocol:"",dnscost:"domainLookupEnd"in K&&"domainLookupStart"in K&&typeof K.domainLookupEnd=="number"&&typeof K.domainLookupStart=="number"?K.domainLookupEnd-K.domainLookupStart:-1,tcpTlsCost:"connectEnd"in K&&"connectStart"in K&&typeof K.connectEnd=="number"&&typeof K.connectStart=="number"?K.connectEnd-K.connectStart:-1,reqCost:"requestStart"in K&&typeof K.requestStart=="number"&&"responseEnd"in K&&typeof K.responseEnd=="number"?K.responseEnd-K.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),gI(k),{gatewayInfo:nI(k,u),proxyInfo:j,url:u,resourceTimingInfo:J}},C=>{var U;return C.gatewayInfo&&ze.joinChooseServer(r.sid,{role:v,lts:g,succ:!0,csAddr:u,serverList:C.gatewayInfo.gatewayAddrs.map(k=>k.address),ec:null,opid:E,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],vid:(U=C.gatewayInfo)===null||U===void 0?void 0:U.vid,resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&ze.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:C.proxyInfo.addresses.map(k=>k.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1},C=>C.code!==H.OPERATION_ABORTED&&(C.code===H.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(ze.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:C.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:w})}),R.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),C),!0)),s)}const R8=(t,r,i,s,c,u)=>{const{sid:p,clientId:m,cloudProxyServer:g}=i,v=[],_=E=>{E.flag===4096?ze.joinChooseServer(p,{role:i.role,lts:s,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||ze.joinWebProxyAP(p,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:E.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(E=>{const w=E.buffer.code;if(E.uri===23&&w===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const C={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:W("NO_EDGES_RETRY"),csIp:t.detail[502]}),flag:E.buffer.flag};v.push(C),_(C)}if(w!==0){const C=nm(w),U={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:t.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?R.warning(U.error.toString()):v.push(U),_(U)}}),v.length)throw R.warning("[".concat(m||"sid-".concat(p.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new ce(H.CAN_NOT_GET_GATEWAY_SERVER,v.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!v.find(E=>E.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(E=>{var w;return E==null||(w=E.error)===null||w===void 0||(w=w.data)===null||w===void 0?void 0:w.desc}).filter(E=>!!E))]})},gI=t=>{var r,i,s,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(W("AP_AREA")&&((s=t.detail)!==null&&s!==void 0&&s[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?w8(t.detail[23].toLowerCase()):w8()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((i=t.detail)===null||i===void 0?void 0:i[19])=="string"){const p=t.detail[19],m=p==null?void 0:p.split(";");for(let g=0;g<m.length;g++){var u;const v=Ei(u=m[g]).call(u);t.addresses[g]&&m&&(t.addresses[g].fingerprint=v)}}if(W("GATEWAY_ADDRESS")&&W("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",W("GATEWAY_ADDRESS"));const p=W("GATEWAY_ADDRESS").map(m=>{var g,v;const _=(g=(v=t.addresses.find(E=>E.ip===m.ip&&E.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:m.fingerprint||_}});t.addresses=p}},Ove=(t,r)=>{if(t.response_body&&t.response_body.length){const i=t.response_body[0];if(i.buffer.code!==0){const s=nm(i.buffer.code);throw new ce(H.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",r),new ce(H.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},vI=(t,r,i)=>{const s=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:yc(yc(yc({6:t.stringUid,11:r,12:W("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:i,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const p=new FormData;return p.append("request",JSON.stringify(u)),[p,s]},Pve=(t,r)=>{const i=Math.floor(Math.random()*1e12),s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let am=0;function sm(t){return Pe.all(t.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const pv=async t=>{let{fragementLength:r,referenceList:i,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u}=t,p=0;const m=r;let g,v=0;const _=async()=>{const E=(()=>{const w=p*m,C=w+m;return i.slice(w,C).map(s)})();u&&u.push(...E);try{g=await sm(E)}catch(w){if(v+=m,p++,!(v>=i.length))return void await _();c(w)}E.forEach(w=>w.cancel())};return await _(),g},A8=async t=>{let{referenceList:r,asyncMapHandler:i,closeFn:s}=t;const c=r.length;let u=0;const p=async()=>{const m=i(r.shift());try{return await m}catch(g){if(u++,u>=c||s!=null&&s(g))throw g;return p()}};return p()};async function Dve(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],p=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Pe((g,v)=>{let _;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:w=>{w.close(),clearTimeout(_),g(!0)},error:w=>{clearTimeout(_),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const E=[r,i,s,c,u,p];for(let w=0;w<E.length;w++){const C=new EncodedVideoChunk({type:w==0?"key":"delta",timestamp:33333*w,duration:33333,data:new Uint8Array(E[w])});try{await t.decode(C)}catch{return void g(!1)}}})(),_=setTimeout(()=>{g(!1)},5e3)})}async function bx(t,r,i,s){return{gatewayInfo:await async function(u,p,m,g){let v=null;const _=[],E=async()=>{const C=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:hv()})),U=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),k=await pv({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),C8(j,u,p,m)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},w=async()=>{if(await vr(1e3),v!==null)return v;const C=W("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:hv()})),U=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),k=await pv({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),C8(j,u,p,m)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k};try{return v=await sm([E(),w()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),v}catch(C){throw C[0]}}(t,r,i,s)}}async function I8(t,r,i,s,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await bx(t,r,i,c);if(W("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:w,proxyInfo:C}=await D8(t,r,i,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:w};const U=C.map(k=>({turnServerURL:k.address,tcpport:k.tcpport||$r.tcpport,udpport:k.udpport||$r.udpport,username:k.username||$r.username,password:k.password||$r.password,forceturn:!1,security:!0}));if(c.useP2P){var p;const k=(p=t.uid)!==null&&p!==void 0?p:w.uid,j="glb:".concat(k.toString()),$=await ZR(j),K=C.map(J=>({turnServerURL:J.address,tcpport:J.tcpport||$r.tcpport,udpport:J.udpport||$r.udpport,username:j,password:$,forceturn:!1,security:!0}));U.push(...K)}return t.turnServer={mode:"manual",servers:U},{gatewayInfo:w}}return await bx(t,r,i,c)}const{proxyInfo:m,gatewayInfo:g}=await D8(t,r,i,c),v={gatewayInfo:g},_=m.map(w=>({turnServerURL:w.address,tcpport:u==="proxy3"?void 0:w.tcpport?w.tcpport:$r.tcpport,udpport:u==="proxy4"?void 0:w.udpport?w.udpport:$r.udpport,username:w.username||$r.username,password:w.password||$r.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var E;const w=(E=t.uid)!==null&&E!==void 0?E:g.uid,C="glb:".concat(w.toString()),U=await ZR(C),k=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||$r.tcpport,udpport:u==="proxy4"?void 0:j.udpport||$r.udpport,username:C,password:U,forceturn:u!=="proxy4",security:u==="proxy5"}));_.push(...k)}return t.turnServer={mode:"manual",servers:_},R.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),v}async function O8(t,r,i,s,c){const u=W("ACCOUNT_REGISTER").slice(0,W("AJAX_REQUEST_CONCURRENT"));let p=[];p=r.proxyServer?u.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:p});try{const g=await async function(v,_,E,w,C){const U=Date.now(),k={sid:E.sid,opid:10,appid:E.appId,string_uid:_};let j=v[0];const $=await To(()=>Oo(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:k,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(K,J)=>{if(K.code===0){if(K.uid<=0||K.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(K.uid),K),ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:j,stringUid:k.string_uid,uid:K.uid,errorCode:H.INVALID_UINT_UID_FROM_STRING_UID,extend:k}),new ce(H.INVALID_UINT_UID_FROM_STRING_UID);return ze.reqUserAccount(k.sid,{lts:U,success:!0,serverAddr:j,stringUid:k.string_uid,uid:K.uid,errorCode:null,extend:k}),!1}const ne=nm(K.code);return ne.retry&&(j=v[(J+1)%v.length]),ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:j,stringUid:k.string_uid,uid:K.uid,errorCode:ne.desc,extend:k}),ne.retry},(K,J)=>K.code!==H.OPERATION_ABORTED&&(ze.reqUserAccount(k.sid,{lts:U,success:!1,serverAddr:j,stringUid:k.string_uid,uid:null,errorCode:K.code,extend:k}),j=v[(J+1)%v.length],!0),C);if($.code!==0){const K=nm($.code);throw new ce(H.UNEXPECTED_RESPONSE,K.desc)}return $}(p,t,r,i,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function kve(t,r,i){const s=W("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?s.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await A8({referenceList:c,asyncMapHandler:p=>async function(m,g,v,_){const E=Date.now(),w={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const C=await Oo(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){const U=nm(C.code);throw new ce(H.UNEXPECTED_RESPONSE,"preload sua error:".concat(U.desc),U)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new ce(H.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:m,req:w,uid:C.uid,elapse:Date.now()-E}}catch(C){throw C}}(p,t,r,i),closeFn:p=>p.code===H.OPERATION_ABORTED||p.code===H.UNEXPECTED_RESPONSE&&!p.data.retry})}catch(u){throw u}}async function jve(t,r,i){const s=W("CDS_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=s.map(g=>function(v,_,E,w){const C=$t(),U={flag:64,cipher_method:0,features:yc(yc(yc(yc(yc({install_id:hA(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:_.appId,version:cs,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:Tve.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return To(()=>Oo(v,{data:U,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==H.OPERATION_ABORTED,w)}(g,t,r,i));let u=null,p=null,m={};try{u=await sm(c)}catch(g){if(g.code===H.OPERATION_ABORTED)throw g;p=g}if(c.forEach(g=>g.cancel()),ze.reportApiInvoke(t.sid,{name:Sn.REQUEST_CONFIG_DISTRIBUTE,options:{error:p,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(g){if(!g.test_tags)return{};const v=g.test_tags,_=Object.keys(v),E={};return _.forEach(w=>{var C;const U=Ei(C=w.slice(4)).call(C),k=JSON.parse(v[w]),j=k[1];E[U]={tag:k[0]||"",value:j}}),E}(u)}catch{}return m}async function P8(t,r){const i=W("WEBCS_DOMAIN").concat(W("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:hv(),serviceIds:[Yn.CHOOSE_SERVER,Yn.CLOUD_PROXY_FALLBACK]}));try{return await A8({referenceList:i,asyncMapHandler:c=>async function(u,p,m){let g,{url:v,areaCode:_,serviceIds:E}=u;const w=Date.now(),[C,U]=vI(p,_,E);let k=Pn.networkState;try{k&&Pn.networkState===wi.OFFLINE&&Pn.onlineWaiter&&await Pe.race([Pn.onlineWaiter,vr(Kn.maxRetryTimeout)]),k=Pn.networkState;const{data:j,headers:$}=await Oo(v,{data:C,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=$.http3==="1"?1:-1,(ae=>{const ee=[];if(ae.response_body.forEach(oe=>{const ve=oe.buffer.code;if(oe.uri===23&&ve===0&&!oe.buffer.edges_services)if(oe.buffer.flag===4194310)oe.buffer.edges_services=[];else{const Ee={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:W("NO_EDGES_RETRY"),csIp:ae.detail[502]}),flag:oe.buffer.flag};ee.push(Ee)}if(ve!==0){const Ee=nm(ve),Be={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:ae.detail[502]}),flag:oe.buffer.flag};oe.buffer.flag===4194310?R.warning(Be.error.toString()):ee.push(Be)}}),ee.length)throw new ce(H.CAN_NOT_GET_GATEWAY_SERVER,ee.map(oe=>"flag: ".concat(oe.flag,", message: ").concat(oe.error.message)).join(" | "),{retry:!!ee.find(oe=>oe.error.data.retry),csIp:ae.detail[502],desc:[...new Set(ee.map(oe=>{var ve;return oe==null||(ve=oe.error)===null||ve===void 0||(ve=ve.data)===null||ve===void 0?void 0:ve.desc}).filter(oe=>!!oe))]})})(j);const J=sv(j,Yn.CHOOSE_SERVER),ne=sv(j,Yn.CLOUD_PROXY_FALLBACK);return gI(J),{gatewayInfo:nI(J,v),proxyInfo:ne,opid:U,requestTime:w,url:v,isHttp3:g,elapse:Date.now()-w}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===H.OPERATION_ABORTED||c.code===H.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function D8(t,r,i,s){const c=W("PROXY_SERVER_TYPE3"),u=(C,U,k)=>{let j=k||c;return Array.isArray(j)&&(j=U%2==0&&c[1]||c[0]),"https://".concat(j,"/ap/?url=").concat(C)};let p=null;const m=[],g=async()=>{const C=W("WEBCS_DOMAIN").slice(0,W("AJAX_REQUEST_CONCURRENT")).map((j,$)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$),{url:K,areaCode:hv(),serviceIds:[Yn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),U=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),k=await pv({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),N8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k},v=async()=>{if(await vr(1e3),p!==null)return p;const C=W("WEBCS_DOMAIN_BACKUP_LIST").map((j,$)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$),{url:K,areaCode:hv(),serviceIds:[Yn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Yn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Yn.CLOUD_PROXY:Yn.CLOUD_PROXY_FALLBACK]}}),U=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),k=await pv({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),N8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},U),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},U),k};let _,E,w;try{({gatewayInfo:_,proxyInfo:E,url:w}=await sm([g(),v()]))}catch(C){throw C[0]}if(m.length&&m.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!_||!E)throw new ce(H.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=w,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&w){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(w)[1];Ne(c).call(c,C)&&(t.proxyServer=C,R.setProxyServer(C),ze.setProxyServer(C))}return p={gatewayInfo:_,proxyInfo:await r8(E,_.uid)},p}async function Lve(t,r,i){const s=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=s.map(u=>function(p,m,g,v){const _={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:cs,cname:m.cname,uid:m.uid.toString(),requestId:fI,seq:fI};fI+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return To(async()=>{const w=await Oo(p,{data:E,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){const U=new ce(H.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw R.error(U.toString()),U}const C=JSON.parse(w.json_body);if(C.code!==200){const U=new ce(H.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw R.error(U.toString()),U}if(!C.servers||C.servers.length===0){const U=new ce(H.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(U.toString()),U}return{vid:C.vid,workerToken:C.workerToken,addressList:(W("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(W("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,w=>!!(w.code!==H.OPERATION_ABORTED&&w.code!==H.UNEXPECTED_RESPONSE||w.data&&w.data.retry),v)}(u,t,r,i));try{const u=await sm(c);return c.forEach(p=>p.cancel()),u}catch(u){throw u[0]}}async function Mve(t,r,i){let s=null;const c=[],u=async p=>{const m=W(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return p&&(await vr(1e3),s!==null)?s:await pv({fragementLength:W("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(R.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),g),function(v,_,E,w){const[C]=Pve(_,[Yn.CHOOSE_SERVER]);let U=Pn.networkState;return To(async()=>{U&&Pn.networkState===wi.OFFLINE&&Pn.onlineWaiter&&await Pe.race([Pn.onlineWaiter,vr(w&&w.maxRetryTimeout||Kn.maxRetryTimeout)]),U=Pn.networkState;const k=await Oo(v,{data:C,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Ove(k,v)},()=>!1,k=>k.code!==H.OPERATION_ABORTED&&(k.code===H.UPDATE_TICKET_FAILED?k.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),k),!0)),w)}(g,t,r,i)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return s=await sm([u(!1),u(!0)]),c.length&&c.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),s}catch(p){throw p[0]}}function k8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?k8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class Uve extends Nn{get isSuccess(){return!!this.configs}constructor(r,i){super(),M(this,"configs",void 0),M(this,"store",void 0),M(this,"joinInfo",void 0),M(this,"cancelToken",void 0),M(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),M(this,"interval",void 0),M(this,"mutex",void 0),M(this,"mutableParamsRead",!1),M(this,"configCache",{}),M(this,"limit_bitrate",void 0),this.mutex=new Nr("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),W("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},W("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ze.reportApiInvoke(null,{options:void 0,name:Sn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:ln.TRACER}).onSuccess(JSON.stringify(ja))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await jve(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(r));const s=function(c){var u;const p=vu(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<p.length;v++)for(let _=p.length-1;_>v;_--){const E=p[_],w=c[E].value;if(typeof w.__priority=="number"){const C=w.__priority,U=p[_-1],k=c[U].value;if(typeof k.__priority=="number"){if(!(C>k.__priority))continue;{const j=E;p[_]=p[_-1],p[_-1]=j}}else{const j=E;p[_]=p[_-1],p[_-1]=j}}}const m=Date.now(),g={};return p.forEach(v=>{const _=c[v].value.__expires;_&&_<=m||(g[v]=c[v])}),g}(r);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new ce(H.NETWORK_RESPONSE_ERROR,s);R.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){Y6(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(Ro.UPDATE_BITRATE_LIMIT,r):this.emit(Ro.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&yI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},s=Object.keys(r),c=[];s.forEach(u=>{const p=r[u].value;i[u]=p;const m=p.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const g=p.__type,v=r[u].value,_=r[u].tag;let E=0;g?g===pV.REALTIME&&(E=1):Object.keys(v).some(w=>Object.prototype.hasOwnProperty.call(gA,w)||!$A()&&Object.prototype.hasOwnProperty.call(Mb,w)?(E=1,!0):void 0),c.push({tag:_,isApplied:E,feature:u,params:JSON.stringify(p)})}),c.forEach(u=>{let{tag:p,feature:m,params:g,isApplied:v}=u;this.store.sessionId&&ze.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:p,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){R.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(p=>{const m=c[p].value,g=m.__expires,v=m.__type;Object.keys(m).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(u,_)||(u[_]=yI(yI({value:m[_]},g&&{expires:g}),v&&{type:v}))})}),u}(r);try{var s;const c=(s=i.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete i.LIMIT_BITRATE,c&&Y6(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const g=Date.now();Object.keys(m).forEach(v=>{const{value:_,type:E,expires:w}=m[v];w&&w<=g||((E===pV.REALTIME||Object.prototype.hasOwnProperty.call(gA,v))&&(ja[v]=_,en[v]=_,R.debug("Update realtime parameters from config distribute",v,_)),E||$A()||!Object.prototype.hasOwnProperty.call(Mb,v)||(ja[v]=_,en[v]=_,R.debug("Update gateway parameters from config distribute",v,_)))})}catch(g){R.error("Error update config immediately: ".concat(m),g.message)}}(i);const u=JSON.stringify(i),p=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",p),R.debug("Caching global parameters ".concat(u))}catch(c){R.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(s=>{switch(s){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:p}=r[s];if(p&&p<=i)return;iA(en[s],u)||(ja[s]=u,en[s]=u,this.emit(Ro.UPDATE_CLIENT_ROLE_OPTIONS,u),R.debug("Updating client role options: ".concat(JSON.stringify(u))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(en,s)){var c;const{value:u,expires:p}=r[s];if(p&&p<=i)return;typeof u=="number"&&Ne(c=[0,1,4,5,6,7,8,9]).call(c,u)&&(ja[s]={value:u},en[s]=u,this.emit(Ro.UPDATE_REMOTE_VIDEO_STREAM_TYPE,u),R.debug("Updating client remote stream type: ".concat(JSON.stringify(u))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:p}=r[s];if(p&&p<=i)return;iA(en[s],u)||(ja[s]=u,en[s]=u,this.emit(Ro.FALLBACK_TO_HLS,u),R.debug("Updating enable force hls: ".concat(JSON.stringify(u))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(en,s)){const{value:u,expires:p}=r[s];if(p&&p<=i)return;iA(en[s],u)||(ja[s]=u,en[s]=u,this.emit(Ro.UPDATE_VOS_CONFIGURE,u),R.debug("Updating vos configure: ".concat(JSON.stringify(u))))}}})}catch(i){R.error("Error handling global parameter config:",i.message)}}}class Fve extends Nn{constructor(){super(...arguments),M(this,"resultStorage",new Map)}setLocalAudioStats(r,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(r,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(s))}setRemoteAudioStats(r,i){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(r,i,s){if(W("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(s);const u=r==="VIDEO_ENCODE_FAILED"?W("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=u){var p;const m=Ne(p=c.result).call(p,!0);c.isPrevNormal&&!m&&this.emit("exception",_I[r],r,i),!c.isPrevNormal&&m&&this.emit("exception",_I[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Fi(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var i;return!(!r.codecType||Ne(i=W("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const _I={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Zr=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function j8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function zu(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class mv{constructor(r){M(this,"store",void 0),M(this,"onStatsException",void 0),M(this,"onUploadPublishDuration",void 0),M(this,"onStatsChanged",void 0),M(this,"onVideoCodecChanged",void 0),M(this,"localStats",new Map),M(this,"remoteStats",new Map),M(this,"updateStatsInterval",void 0),M(this,"trafficStats",void 0),M(this,"trafficStatsPeerList",[]),M(this,"uplinkStats",void 0),M(this,"exceptionMonitor",void 0),M(this,"p2pChannel",void 0),M(this,"scalabilityMode",jb.L1T1),M(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Fve,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Re.LocalAudioTrack)||zu({},EA)}getLocalVideoTrackStats(){return this.localStats.get(Re.LocalVideoTrack)||zu({},SA)}getRemoteAudioTrackStats(r){const i=(u,p)=>{if(!this.trafficStats)return p;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(p.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),p},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[p,{audioStats:m}]=u;m&&(s[p]=i(p,m))});return s}getRemoteNetworkQualityStats(r){const i={};if(r){var s;const c=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:p}]=c;p&&(i[u]=p)});return i}getNetworkQuality(){let r=0,i=0;return this.trafficStats&&(r=ux(this.trafficStats.B_unq),i=ux(this.trafficStats.B_dnq)),{uplinkNetworkQuality:r,downlinkNetworkQuality:i}}getRemoteVideoTrackStats(r){const i=(u,p)=>{if(!this.trafficStats)return p;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(p.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),p},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[p,{videoStats:m}]=u;m&&(s[p]=i(p,m))});return s}getRTCStats(){let r=0,i=0,s=0,c=0;const u=this.localStats.get(Re.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const p=this.localStats.get(Re.LocalVideoTrack);p&&(r+=p.sendBytes,i+=p.sendBitrate);const m=this.localStats.get(Re.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:_,videoStats:E}=v;_&&(s+=_.receiveBytes,c+=_.receiveBitrate),E&&(s+=E.receiveBytes,c+=E.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,p=c!=null&&c.audioSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>p?u:p),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,s){if(!r)return!1;const c=!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||i.framesDecodeCount>s.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case Re.LocalVideoTrack:case Re.LocalVideoLowTrack:{const m=c,g=zu({},SA),v=r.getStats(),_=r.getLocalMedia(s);if(v){const E=v.videoSend.find(w=>w.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(E){const w=r.getLocalVideoSize(),C=r.getEncoderConfig(Re.LocalVideoTrack);var u;(E.codec==="H264"||E.codec==="H265"||E.codec==="VP8"||E.codec==="VP9"||E.codec==="AV1X"||E.codec==="AV1")&&(g.codecType=E.codec,(m==null?void 0:m.codecType)!==E.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,E.codec.toLocaleLowerCase()))),g.sendBytes=E.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,E.inputFrame?(g.captureFrameRate=E.inputFrame.frameRate,g.captureResolutionHeight=E.inputFrame.height,g.captureResolutionWidth=E.inputFrame.width):w&&(g.captureResolutionWidth=w.width,g.captureResolutionHeight=w.height),E.sentFrame?(g.sendFrameRate=E.sentFrame.frameRate,g.sendResolutionHeight=E.sentFrame.height,g.sendResolutionWidth=E.sentFrame.width):w&&(g.sendResolutionWidth=w.width,g.sendResolutionHeight=w.height),E.avgEncodeMs&&(g.encodeDelay=E.avgEncodeMs),C&&C.bitrateMax?g.targetSendBitrate=1e3*C.bitrateMax:E.targetBitrate&&(g.targetSendBitrate=E.targetBitrate),g.sendPackets=E.packets,g.sendPacketsLost=E.packetsLost,g.sendJitterMs=E.jitterMs,g.sendRttMs=E.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(g.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var p;this.localStats.set(s,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((p=this.onStatsChanged)===null||p===void 0||p.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,g);break}case Re.LocalAudioTrack:{const m=c,g=zu({},EA),v=r.getStats(),_=r.getLocalMedia(s);if(v){const E=v.audioSend.find(w=>w.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(g.codecType=E.codec),E.inputLevel)g.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const w=r.getLocalAudioVolume();w&&(g.sendVolumeLevel=Math.round(32767*w))}g.sendBytes=E.bytes,g.sendPackets=E.packets,g.sendPacketsLost=E.packetsLost,g.sendJitterMs=E.jitterMs,g.sendRttMs=E.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Re.LocalAudioTrack,g),g&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var s,c;let[u,{videoStats:p,audioStats:m,videoPcStats:g}]=i;const v=m,_=p,E=g,w=zu({},NV),C=zu({},RV),U=zu({},wge),{audioTrack:k,videoTrack:j,audioSSRC:$,videoSSRC:K}=r.getRemoteMedia(u);let J;J=this.store.useP2P?r.getStats(!0):r.getStats();const ne=(s=J)===null||s===void 0?void 0:s.audioRecv.find(ve=>ve.ssrc===$),ae=(c=J)===null||c===void 0?void 0:c.videoRecv.find(ve=>ve.ssrc===K),ee=this.trafficStats&&this.trafficStats.peer_delay.find(ve=>ve.peer_uid===u);if(ne&&(ne.codec!=="opus"&&ne.codec!=="aac"&&ne.codec!=="PCMU"&&ne.codec!=="PCMA"&&ne.codec!=="G722"||(w.codecType=ne.codec),ne.outputLevel?w.receiveLevel=Math.round(32767*ne.outputLevel):k&&(w.receiveLevel=Math.round(32767*k.getVolumeLevel())),w.receiveBytes=ne.bytes,w.receivePackets=ne.packets,w.receivePacketsLost=ne.packetsLost,w.receivePacketsDiscarded=ne.packetsDiscarded,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=v?8*Math.max(0,w.receiveBytes-v.receiveBytes):0,w.totalDuration=v?v.totalDuration+1:1,w.totalFreezeTime=v?v.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=ne.jitterBufferMs,w.totalDuration>10&&mv.isRemoteAudioFreeze(k)&&(w.totalFreezeTime+=1)),ae){var oe;ae.codec!=="H264"&&ae.codec!=="H265"&&ae.codec!=="VP8"&&ae.codec!=="VP9"&&ae.codec!=="AV1X"&&ae.codec!=="AV1"||(C.codecType=ae.codec),C.receiveBytes=ae.bytes,C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.decodeFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,C.renderFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,ae.outputFrame&&(C.renderFrameRate=ae.outputFrame.frameRate),ae.receivedFrame?(C.receiveFrameRate=ae.receivedFrame.frameRate,C.receiveResolutionHeight=ae.receivedFrame.height,C.receiveResolutionWidth=ae.receivedFrame.width):j&&(C.receiveResolutionHeight=j._videoHeight||0,C.receiveResolutionWidth=j._videoWidth||0),ae.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ae.framesRateFirefox)),C.receivePackets=ae.packets,C.receivePacketsLost=ae.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);const ve=_?_.totalFreezeTime:0,Ee=_?_.totalDuration:0;C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=(oe=ae.totalFreezesDuration)!==null&&oe!==void 0?oe:ve||0,C.receiveDelay=ae.jitterBufferMs||0;const Be=!!K&&r.getRemoteVideoIsReady(K);ae.totalFreezesDuration===void 0&&j&&Be&&mv.isRemoteVideoFreeze(j,ae,E)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-ve)/(C.totalDuration-Ee),1))}ee&&(w.end2EndDelay=ee.B_ad,C.end2EndDelay=ee.B_vd,w.transportDelay=ee.B_ed,C.transportDelay=ee.B_ed,w.currentPacketLossRate=ee.B_ealr4/100,C.currentPacketLossRate=ee.B_evlr4/100,U.uplinkNetworkQuality=ee.B_punq?ee.B_punq:0,U.downlinkNetworkQuality=ee.B_pdnq?ee.B_pdnq:0),this.remoteStats.set(u,{audioStats:w,videoStats:C,videoPcStats:ae,networkStats:U}),k&&this.exceptionMonitor.setRemoteAudioStats(k,w),j&&this.exceptionMonitor.setRemoteVideoStats(j,C)})}}class L8{constructor(){M(this,"destChannelMediaInfos",new Map),M(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){z6(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){z6(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){ix(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function M8(t){if(!(t instanceof L8))return new ce(H.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),i=t.getDestChannelMediaInfo();if(!r)return new ce(H.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new ce(H.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class pd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){M(this,"uid",void 0),M(this,"_uintid",void 0),M(this,"_trust_in_room_",!0),M(this,"_trust_audio_enabled_state_",!0),M(this,"_trust_video_enabled_state_",!0),M(this,"_trust_audio_mute_state_",!0),M(this,"_trust_video_mute_state_",!0),M(this,"_audio_muted_",!1),M(this,"_video_muted_",!1),M(this,"_audio_enabled_",!0),M(this,"_video_enabled_",!0),M(this,"_audio_added_",!1),M(this,"_video_added_",!1),M(this,"_is_pre_created",!1),M(this,"_video_pre_subscribed",!1),M(this,"_audio_pre_subscribed",!1),M(this,"_trust_video_stream_added_state_",!0),M(this,"_trust_audio_stream_added_state_",!0),M(this,"_audioTrack",void 0),M(this,"_videoTrack",void 0),M(this,"_dataChannels",[]),M(this,"_audioSSRC",void 0),M(this,"_videoSSRC",void 0),M(this,"_audioOrtc",void 0),M(this,"_videoOrtc",void 0),M(this,"_cname",void 0),M(this,"_rtxSsrcId",void 0),M(this,"_videoMid",void 0),M(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function U8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function bI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Vve=t=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(t?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),xx="9",xI=2e4,Ex=4e4;let F8=class{get localCapabilities(){return bn(this._localCapabilities)}get rtpCapabilities(){return bn(this._rtpCapabilities)}get candidates(){return bn(this._candidates)}get iceParameters(){return bn(this._iceParameters)}get dtlsParameters(){return bn(this._dtlsParameters)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];M(this,"sessionDesc",void 0),M(this,"_localCapabilities",void 0),M(this,"_rtpCapabilities",void 0),M(this,"_candidates",void 0),M(this,"_originCandidates",void 0),M(this,"_iceParameters",void 0),M(this,"_isUseExtmapAllowMixed",void 0),M(this,"_isUseLocalCodecs",void 0),M(this,"_isUseDataChannel",void 0),M(this,"_dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname",void 0),M(this,"useLocalCodecsMids",[]),M(this,"preloadSsrcs",[]),M(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=r,this._isUseLocalCodecs=i,this._isUseDataChannel=s,t=bn(t);const{iceParameters:c,dtlsParameters:u,candidates:p,rtpCapabilities:m,setup:g,localCapabilities:v,cname:_}=t;this._rtpCapabilities=m,this._candidates=p,this._originCandidates=bn(p),this._iceParameters=c,this._dtlsParameters=u,this._localCapabilities=v,this.setup=g,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(m),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(t){return t.length===this.preloadSsrcs.length&&t.every(r=>{var i;return Ne(i=this.preloadSsrcs).call(i,r)})}preloadRemoteMedia(t){let r=0;const i=[],s=[];for(;t>0;){const c=[bI({ssrcId:Ex+r},W("USE_SUB_RTX")?{rtx:Ex+r+1}:{})],u="".concat(Ex+r,"_").concat(xI+r),{ssrcs:p,ssrcGroups:m}=lv(c,this.cname,W("SYNC_GROUP")?u:void 0),g=this.preCreateOrRecycleSendMedia("video",p,m,void 0),v=[{ssrcId:xI+r}],_="".concat(Ex+r,"_").concat(xI+r),{ssrcs:E,ssrcGroups:w}=lv(v,this.cname,W("SYNC_GROUP")?_:void 0),C=this.preCreateOrRecycleSendMedia("audio",E,w,void 0);t--,r+=2,i.push(g,C),s.push(p[0].ssrcId,E[0].ssrcId)}return this.useLocalCodecsMids.push(...i),this.preloadSsrcs=s,{mids:i,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(t,r,i,s){const c=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",r[0].ssrcId);const p=t===$e.VIDEO?u.videoCodecs:u.audioCodecs,m=t===$e.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:t,port:xx,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return v=this.mungSendMediaDesc(v,s),this.sessionDesc.mediaDescriptions.push(v),this.updateBundleMids(),g}toString(){return el(this.sessionDesc)}send(t,r,i,s){const{ssrcs:c,ssrcGroups:u}=lv(r,this.cname,W("SYNC_GROUP")?i:void 0),p=this.findPreloadMediaDesc(c);if(p){if(_n()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,p.attributes.mid),s&&(s.twcc||s.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,s),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(t,c);let g;return m===-1||m===1&&(Cr()||function(){const v=$t();return!(v.name!==zt.CHROME||!v.osVersion)&&Number(v.version)<=90}()||wo(143)||id(143)||W("RESERVE_MID_1_MLINE")||W("ENABLE_ENCODED_TRANSFORM")&&Qc())||m===0&&!function(v){const _=$t();return!(_.name!==zt.FIREFOX||!_.osVersion)&&Number(_.version)===v}(138)&&W("USE_SUB_RTX")||kF()?(g=this.createOrRecycleSendMedia(t,c,u,"sendonly",s),this.updateBundleMids()):(g=bn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,s)),_n()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:r}}batchSend(t){const r=t.map(c=>{let{kind:u,ssrcMsg:p,mslabel:m}=c;return this.send(u,p,m)}),i=[];let s=!1;return r.forEach(c=>{let{mid:u,needExchangeSDP:p}=c;p&&(s=!0),i.push(u)}),{mids:i,needExchangeSDP:s}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||_n()||kF()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Ne(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Ne(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,r,i,s){t.forEach((c,u)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",r,i,s[u])}),this.updateBundleMids()}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const r=this.sessionDesc||Ti((i=this._isUseExtmapAllowMixed,this._isUseDataChannel?Vve(i):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(i?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var i;this._rtpCapabilities=t;let s=!1;const c=this.rtpCapabilities.send,u=this.localCapabilities.send,p=this.localCapabilities.recv,m=p.videoCodecs,g=p.audioCodecs,v=p.videoExtensions,_=p.audioExtensions;for(const U of r.mediaDescriptions){var E;if(U.attributes.direction!=="sendonly"||typeof U.attributes.mid!="string"||!Ne(E=this.useLocalCodecsMids).call(E,U.attributes.mid)){if(s=!0,U.attributes.iceUfrag=this._iceParameters.iceUfrag,U.attributes.icePwd=this._iceParameters.icePwd,U.attributes.fingerprints=this._dtlsParameters.fingerprints,U.attributes.candidates=this._candidates,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var w;U.media.fmts=m.map(j=>j.payloadType.toString(10)),U.attributes.payloads=m,U.attributes.extmaps=v;const k=U.attributes.mid;typeof k!="string"||Ne(w=this.useLocalCodecsMids).call(w,k)||this.useLocalCodecsMids.push(k)}else if(c.videoCodecs.length===0){const k=u.videoCodecs.filter(j=>{var $,K;return($=j.rtpMap)===null||$===void 0?void 0:Ne(K=$.encodingName.toLowerCase()).call(K,"vp8")});k.length===0&&k.push(u.videoCodecs[0]),U.media.fmts=k.map(j=>j.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=[]}else U.media.fmts=c.videoCodecs.map(k=>k.payloadType.toString(10)),U.attributes.payloads=c.videoCodecs,U.attributes.extmaps=c.videoExtensions;if(U.media.mediaType==="audio")if(this._isUseLocalCodecs&&U.attributes.direction==="sendonly"){var C;U.media.fmts=g.map(j=>j.payloadType.toString(10)),U.attributes.payloads=g,U.attributes.extmaps=_;const k=U.attributes.mid;typeof k!="string"||Ne(C=this.useLocalCodecsMids).call(C,k)||this.useLocalCodecsMids.push(k)}else if(c.audioCodecs.length===0){const k=u.audioCodecs.filter(j=>{var $,K;return($=j.rtpMap)===null||$===void 0?void 0:Ne(K=$.encodingName.toLowerCase()).call(K,"opus")})||[u.audioCodecs[0]];U.media.fmts=k.map(j=>j.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=[]}else U.media.fmts=c.audioCodecs.map(k=>k.payloadType.toString(10)),U.attributes.payloads=c.audioCodecs,U.attributes.extmaps=c.audioExtensions,im(U)}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(t){const r=this._originCandidates.filter(s=>s.transport==="udp"),i=[];if(r.forEach(s=>{i.push(bI(bI({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),r.length!==0){switch(t){case Rr.TCP_RELAY:this._candidates=i;break;case Rr.UDP_TCP_RELAY:case Rr.RELAY:this._candidates=[...r,...i];break;default:this._candidates=r}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=bn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(_n()){if(s){const c=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:xx,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,r,i,s,c,u){const p=t._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=uv(p,m,this.localCapabilities.send,p===$e.VIDEO?s:c),v=p===$e.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:p,port:xx,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungRecvMediaDsec(E,t,u);const w=this.findFirstClosedMedia(p);if(w){const C=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[C]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateRemoteDtlsParameters(t){const r=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),i=new Set(t.map(c=>c.fingerprint));let s=!1;r.size!==i.size&&(s=!0);for(const c of r)i.has(c)||(s=!0);return s}updateRemoteCodec(t,r,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").filter(E=>{var w;return Ne(w=Object.keys(ku)).call(w,E)}))],c=new Set(r);if(s.every(E=>c.has(E)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const u=this._rtpCapabilities.recv.videoCodecs.filter(E=>r.some(w=>{var C;return Ne(C=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").call(C,w)}));if(u.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(r)),!1;const p=[...new Set(u.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||""))];let m;if(R.debug("updateRemoteCodec, from ".concat(s," to ").concat(p)),t.length===0)m=this.sessionDesc.mediaDescriptions.filter(E=>E.media.mediaType==="video"&&E.attributes.direction==="recvonly");else if(m=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&E.media.mediaType==="video"&&Ne(t).call(t,E.attributes.mid)&&E.attributes.direction==="recvonly"),m.length!==t.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;if(W("USE_PUB_RTX")||W("USE_SUB_RTX")){const E=hd(u,this.rtpCapabilities.recv.videoCodecs);u.push(...E)}this._rtpCapabilities.recv.videoCodecs=u;const g=this.localCapabilities.send,v=this.rtpCapabilities.recv,_=uv($e.VIDEO,v,g,i);return m.forEach(E=>{const w=_.map(C=>C.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(E.attributes.mid,", from"),E.attributes.payloads,"to",_),E.attributes.payloads=_,E.media.fmts=w}),R.debug("updateRemoteCodec success, mids: ".concat(t,", codecs: ").concat(r,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(t,r,i,s,c){const u=this.rtpCapabilities.send.videoCodecs,p=this._isUseLocalCodecs||u.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,m=t===$e.VIDEO?p.videoCodecs:p.audioCodecs,g=t===$e.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;const v="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:xx,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungSendMediaDesc(_,c);const E=this.findFirstClosedMedia(t);if(E){const w=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[w]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,i){const s=bn(t);return aI(s),Hu(s,r),sI(s,r),p8(s),mx(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=bn(t);return i.attributes&&i.attributes.payloads&&Array.isArray(i.attributes.payloads)&&i.attributes.payloads.length>0&&i.attributes.payloads.forEach(s=>{s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W("ENABLE_DOWN_SPS_PPS")&&(s.fmtp&&s.fmtp.parameters||(s.fmtp={parameters:{}}),s.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),mx(i,r,this.localCapabilities.recv),im(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>_n()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}};function V8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function il(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?V8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):V8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var om=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(om||{});const Sx=new Map;function B8(t,r,i,s){let{scale:c}=t;if(c===0&&s===om.UP||c>=r.length-1&&s===om.DOWN)return t;let u=il(il({},t),{},{scale:s===om.DOWN?++c:--c});switch(i){case"maintain-framerate":u=il(il({},u),r[c].motion);break;case"maintain-resolution":u=il(il({},u),r[c].detail);break;case"balanced":u=il(il({},u),r[c].balanced)}return u}function G8(t,r){if(r){const i={overUse:0,underUse:0,adaptationList:W8(r)};Sx.set(t,i)}else Sx.delete(t)}function W8(t){const r=il({},t),{bitrateMax:i,frameRate:s,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:p,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:w,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:U,BALANCE_BITRATE_FACTOR:k,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:$,MOTION_RESOLUTION_FACTOR:K,MOTION_BITRATE_FACTOR:J,DETAIL_FRAMERATE_FACTOR:ne,DETAIL_BITRATE_FACTOR:ae}=mA,ee=Math.min(r.frameRate,m),oe=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(w,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(C,1)*ee),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u}}];for(let ve=1;ve<=g;ve++){const Ee={bwe_up:Math.round(Math.pow(E,ve)*i),bwe_down:Math.round(Math.pow(w,ve+1)*i),fps_up:Math.round(Math.pow(U,ve)*ee),fps_down:Math.round(Math.pow(C,ve+1)*ee)},Be={scaleResolutionDownBy:c/Math.pow($,ve),frameRate:Math.max(Math.round(Math.pow(j,ve)*s),p),bitrateMax:Math.max(Math.round(Math.pow(k,ve)*i),_),bitrateMin:Math.max(Math.round(Math.pow(k,ve)*u),v)},mt={scaleResolutionDownBy:c/Math.pow(K,ve),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(J,ve)*i),_),bitrateMin:Math.max(Math.round(Math.pow(J,ve)*u),v)},ct={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ne,ve)*s),p),bitrateMax:Math.max(Math.round(Math.pow(ae,ve)*i),_),bitrateMin:Math.max(Math.round(Math.pow(ae,ve)*u),v)};oe.push({scale:ve,threshold:Ee,balanced:Be,motion:mt,detail:ct})}return oe}function Bve(t,r,i,s,c,u){const p=Sx.get(t)||{overUse:0,underUse:0,adaptationList:W8(c)},{adaptationList:m}=p;Sx.set(t,p);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=mA,{scale:_}=s;let E,w;return typeof r=="number"&&r>0&&function(C,U,k,j){if(U>=k.length)return!1;let{threshold:{fps_down:$}}=k[U];return W("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&($=k[0].threshold.fps_down),C<$}(r,_,m,u)&&(p.overUse++,w=Fp.CPU,p.overUse>g)||typeof i=="number"&&i>0&&function(C,U,k){if(U>=k.length)return!1;const{threshold:{bwe_down:j}}=k[U];return C<j}(i,_,m)&&(p.overUse++,w=Fp.BANDWIDTH,p.overUse>g)?(p.overUse=0,p.underUse=0,E=B8(s,m,u,om.DOWN),[E,w]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(C,U,k,j){if(U===0)return;let{threshold:{fps_up:$}}=k[U];return W("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&($=k[1].threshold.fps_up),C>$}(r,_,m,u)&&function(C,U,k){if(U===0)return;const{threshold:{bwe_up:j}}=k[U];return C>j}(i,_,m)&&(p.underUse++,p.underUse>v&&(p.overUse=0,p.underUse=0,E=B8(s,m,u,om.UP),E.scale===0&&(w=Fp.NONE))),[E,w])}function $8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function EI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?$8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function H8(t){var r;return!!W("ENABLE_AG_ADAPTATION")&&!!(t instanceof Kb||Ne(r=t._hints).call(r,Jt.CUSTOM_TRACK))&&(!!W("FORCE_SUPPORT_AG_ADAPTATION")||!!(PF(14,0,!1)&&DF(17,4,!0)||OF(14)&&YR(17,4,!0)))}const wx=new Map;function z8(t,r,i,s,c,u){if(cm(t,i),c(r),s!=="balanced"&&s!=="maintain-framerate"&&s!=="maintain-resolution")return;let p=-1;G8(t,r);const m=window.setInterval(()=>{const v=wx.get(t);if(!W("ENABLE_AG_ADAPTATION")||!v)return cm(t,i),void c(r);const _=u();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(p===-1)return void(p=Date.now());if(Date.now()-p<1e3)return;const E=_.sendFrameRate,w=_.OutgoingAvailableBandwidth,[C,U]=Bve(t,E,w,v.adaptationConfig,r,s);U&&(i.qualityLimitationReason=U),C&&v.adaptationConfig.scale!==C.scale&&(R.debug("[".concat(t,"] applyAdaptation: ").concat(i.qualityLimitationReason,`
           sendFps `).concat(E,", bwe ").concat(w,", switch from ").concat(v.adaptationConfig.scale," to ").concat(C.scale," ")),v.adaptationConfig=EI(EI({},v.adaptationConfig),C),c(C))}},W("CHECK_LOCAL_STATS_INTERVAL")),g=EI({},r);wx.set(t,{timer:m,adaptationConfig:g,originConfig:r,adaptationFunc:c}),R.debug("[".concat(t,"] start adaptation, originConfig: ").concat(JSON.stringify(r),", degradationPreference: ").concat(s))}function cm(t,r){const i=wx.get(t);if(i){const{timer:s}=i;window.clearTimeout(s),wx.delete(t)}r.qualityLimitationReason=Fp.NONE,G8(t)}function Gve(t,r){var i;let s;switch(r){case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoTrack:s=Ne(i=t._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:s=tn.Low}return s}function SI(t){const r=Pt();if(t.some(i=>i._bypassWebAudio))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wI(t,r){SI(t);const i=new or;return t.forEach(s=>i.addAudioTrack(s)),i}const Wve=!Pt().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dc();function fv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.useDcSignal)return i={spec:r,store:t},Io("DataChannelConnection").create(i);var i;return Wve?function(c){return Io("PlanBConnection").create(c)}({spec:r,store:t}):new Ga(r,t)}function TI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function CI(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Nu(t.turnServer.servers))return!1;if(W("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Bt;function K8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Po(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K8(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):K8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let Ga=(Bt=class ph extends cx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Ne(i=Object.keys(ku)).call(i,r)}))]}constructor(r,i){super(r,i),M(this,"id",Zt(5,"connection-")),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"forceTurn",!1),M(this,"remoteSDP",void 0),M(this,"initialOffer",void 0),M(this,"transportEventReceiver",void 0),M(this,"statsFilter",void 0),M(this,"extension",{useXR:W("USE_XR")}),M(this,"localCapabilities",void 0),M(this,"remoteCodecs",void 0),M(this,"localCandidateCount",0),M(this,"allCandidatesReceived",!1),M(this,"isPreallocation",!1),M(this,"isPreRender",!1),M(this,"preMediaMap",new Map),M(this,"dataStreamChannelMap",new Map),M(this,"establishPromise",void 0),M(this,"recoveredDataChannelIds",[]),M(this,"currentDataChannelId",1),M(this,"supportAV1RtpSpec",!1),M(this,"mutex",void 0),M(this,"qualityLimitationReason",Fp.NONE),M(this,"isFirstConnected",!1),this.store=i,this.forceTurn=CI(r),this.mutex=new Nr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ph.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Lb(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gc(i.sdp),c=await cI({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=dv(c),this.initialOffer=i,W("ENABLE_SVC")&&this.store.codec=="av1"){const p=await m8();var r;p&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(p))}let u;return i.sdp&&fx(i.sdp)&&(u=bn(c),s8(u)),Po(Po({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new me(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&fx(this.initialOffer.sdp)&&o8(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new F8(Po(Po({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&tv(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=lI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),tv(this.store))if(r.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const p=W("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(p);await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{const{preSSRCs:p=[]}=r,m=p.map(v=>v.ssrcMsg[0].ssrcId);if(p.length===0)return;const{mids:g}=this.remoteSDP.batchSend(p.map(v=>Object.assign({},v)));await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const p=u.receiver.track;let m;p.kind==="video"&&W("ENABLE_PRE_RENDER")&&(m=new zb({trackId:"track-".concat(p.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),m.updateVideoTrack(p),m.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},m.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(i[c],{mid:s,track:p,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const p=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||p}const{preSSRCs:c=[]}=r,u=c.map(p=>p.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const p=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:E,track:w}]=g;return p.push(_),m.push(v),this.preMediaMap.delete(v),E&&E.destroy(),!0}),p.length>0&&(this.remoteSDP.stopSending(p),await Qi(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),ze.reportApiInvoke(this.store.sessionId,{name:Sn.PRELOAD_MEDIA_FAILED,options:[c,m],tag:ln.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return ki(function*(){const u=yield Ct(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const p=[],m=ov();r.forEach(j=>{const $=c.peerConnection.addTransceiver(j._mediaStreamTrack,Po({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));p.push($),j._updateRtpTransceiver($)}),_n()&&W("SIMULCAST")===!0&&(yield Ct(c.applySimulcastForFirefox(p,r)));const g=yield Ct(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),E=Ti(_),w=v.map(j=>{const $=E.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return iI($,W("USE_PUB_RTX"))});let C;try{C=yield w}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const $=c.remoteSDP.toString();throw yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Ct(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,i,s,C);const U=c.remoteSDP.toString(),k=c.logSDPExchange(_,"offer","local","send");return yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(c.applySimulcastEncodings(p,r)),yield Ct(c.applySendEncodings(p,r)),k==null||k(U),yield Ct(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),p.map((j,$)=>{const K=v[$];return{localSSRC:w[$],id:K,transceiver:j}})}catch(p){throw p instanceof me?p:new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(p.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof me?s:new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof me?i:new me(H.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var v;cm(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),p=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();p==null||p(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:p}=this.remoteSDP.send(r,i,s,c);p&&(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(p=>{let[m,{mid:g,player:v}]=p;if(g===u)return this.preMediaMap.delete(m),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(p=>{p.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(p,m)=>{p.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return ki(function*(){const s=yield Ct(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Pt().supportPCSetConfiguration,u=W("FORCE_TURN_TCP")||i.forceTurn;if(r===Rr.RELAY&&!c)return;if(c&&!u){const E=r===Rr.RELAY?"relay":"all",w=i.peerConnection.getConfiguration();w.iceTransportPolicy!==E&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(E,"]")),w.iceTransportPolicy=E,i.peerConnection.setConfiguration(w))}i.remoteSDP.updateCandidates(r);const p=yield Ct(i.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=gc(p.sdp),{remoteIceParameters:g}=yield m.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(p.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Ct(i.peerConnection.setLocalDescription(p)),_==null||_(v),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Rr.TCP_RELAY),await Qi(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{cm(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Po(Po({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),p=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),p==null||p(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new me(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?_n()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Po(Po({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Po(Po({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=fc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(Nu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:W("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...ph.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...ph.newTurnServerConfigToIceServers(r.turnServer.servers)),W("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...ph.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ph.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Pt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=W("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const p=c.address+":"+c.port,m=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fc(p)),", remote ").concat(JSON.stringify(fc(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Pt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},p={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=i8(this.peerConnection,r._mediaStreamTrack),g=KV(r);if(H8(r)&&m&&i&&g&&this.getLocalVideoStats&&Ne(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const k=u.degradationPreference||(Ne(v=r._hints).call(v,Jt.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");z8(this.id+m.mid,g,this,k,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:k,frameRate:j,scaleResolutionDownBy:$}=r._encoderConfig;k&&(p.maxBitrate=1e3*k),(Ne(_=r._hints).call(_,Jt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(p.maxFramerate=Fi(j)),$&&$>=1&&(p.scaleResolutionDownBy=$))}const{maxFramerate:E}=W("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(p.maxFramerate=p.maxFramerate?Math.min(p.maxFramerate,E):E),W("DSCP_TYPE")&&dc()){var w;const k=W("DSCP_TYPE");Ne(w=["very-low","low","medium","high"]).call(w,k)&&(p.networkPriority=k)}const C=i.getParameters(),U=(c=C.encodings)===null||c===void 0?void 0:c[0];_n()&&!U&&(u.encodings=[p]),U&&Object.assign(U,p),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await v8(this.store.codec,i,W("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!Pt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:p,frameRate:m,scaleResolutionDownBy:g}=i;p&&(u.maxBitrate=1e3*p),m&&(u.maxFramerate=Fi(m)),g&&g>=1&&Ne(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(E){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!Pt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){if(W("FORBID_MODIFY_LOCAL_OFFER_SDP"))return r;const c=Ti(r);return i.forEach((u,p)=>{const m=s[p],g=c.mediaDescriptions.find(v=>v.attributes.mid===m);g&&(Hu(g,u),oI(g,u,this.store.codec))}),el(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,p,m;const v=r[g],_=i[g];if(_ instanceof dn&&!Ne(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(p=_._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,E))}}}async applySimulcastEncodings(r,i){if(!_n()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],p={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,p))}}}isVP8Simulcast(r){var i,s,c,u,p;return!!(r instanceof dn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ne(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=r._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(Pt().supportPCSetConfiguration){const i=ph.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},ke(Bt.prototype,"updateRemoteRTPCapabilities",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteRTPCapabilities"),Bt.prototype),ke(Bt.prototype,"connect",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"connect"),Bt.prototype),ke(Bt.prototype,"updateRemoteConnect",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteConnect"),Bt.prototype),ke(Bt.prototype,"createDataChannels",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"createDataChannels"),Bt.prototype),ke(Bt.prototype,"receive",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"receive"),Bt.prototype),ke(Bt.prototype,"batchReceive",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"batchReceive"),Bt.prototype),ke(Bt.prototype,"stopReceiving",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"stopReceiving"),Bt.prototype),ke(Bt.prototype,"muteRemote",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"muteRemote"),Bt.prototype),ke(Bt.prototype,"unmuteRemote",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteRemote"),Bt.prototype),ke(Bt.prototype,"muteLocal",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"muteLocal"),Bt.prototype),ke(Bt.prototype,"unmuteLocal",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteLocal"),Bt.prototype),ke(Bt.prototype,"close",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"close"),Bt.prototype),ke(Bt.prototype,"updateEncoderConfig",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateEncoderConfig"),Bt.prototype),ke(Bt.prototype,"updateSendParameters",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateSendParameters"),Bt.prototype),ke(Bt.prototype,"replaceTrack",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"replaceTrack"),Bt.prototype),ke(Bt.prototype,"updateAdaptation",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateAdaptation"),Bt.prototype),ke(Bt.prototype,"getRemoteSSRC",[Vi],Object.getOwnPropertyDescriptor(Bt.prototype,"getRemoteSSRC"),Bt.prototype),Bt);function Vi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function NI(t,r){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Fi(r.width),s.height=Fi(r.height);const c=Fi(r.framerate||15);document.body.append(i),document.body.append(s);let u=t._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play().catch(Jg);const p=s.getContext("2d");if(!p)throw new ce(H.UNEXPECTED_ERROR,"can not get canvas context");const m=Pt(),g=s.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const _=i.videoWidth,E=i.videoHeight/_,w=s.width*E;Math.abs(w-s.height)>=2&&(R.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(w)),s.height=w)}p.drawImage(i,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,i.srcObject=new MediaStream([u]))},s.stopCapture=NA(()=>s.startCapture&&s.startCapture(),c);const v=g.stop;return g.stop=()=>{v.call(g),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),R.debug("clean low stream renderer")},g}var Y8=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(Y8||{}),Do=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(Do||{}),bt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(bt||{}),br=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t[t.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",t}(br||{}),Ur=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ur||{}),lm=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t[t.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",t}(lm||{}),RI=function(t){return t[t.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",t[t.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",t}(RI||{});const Ku=1e3,Tx=6,gv=3,$ve=Math.max(Tx,gv,60);function ot(t,r,i){i!=null&&Number.isFinite(i)&&(t[r]=Math.round(Math.max(0,i)))}function q8(t){const r={[Ur.CONN_TYPE]:0,[Ur.RTT]:t.rtt,[Ur.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=t.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[Ur.CONN_TYPE]=1),i==="tcp"&&(r[Ur.CONN_TYPE]=3),i==="tls"&&(r[Ur.CONN_TYPE]=4);break}case"srflx":r[Ur.CONN_TYPE]=2;break;case"unknown":r[Ur.CONN_TYPE]=5;break;default:r[Ur.CONN_TYPE]=0}return r}function X8(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class J8 extends Nn{constructor(r){super(),M(this,"store",void 0),M(this,"uploadWRTCStatsTimer",void 0),M(this,"uploadOutboundDenoiserStatsTimer",void 0),M(this,"uploadExtStatsTimer",void 0),M(this,"uploadExtUsageStatsTimer",void 0),M(this,"uploadInboundExtStatsTimer",void 0),M(this,"requestStats",void 0),M(this,"requestTransportStats",void 0),M(this,"requestLocalMedia",void 0),M(this,"requestRemoteMedia",void 0),M(this,"requestAllTracks",void 0),M(this,"requestVideoIsReady",void 0),M(this,"requestUploadStats",void 0),M(this,"requestUpload",void 0),M(this,"uploadOutboundStarted",!1),M(this,"uploadInboundStarted",!1),M(this,"uploadTransportStarted",!1),M(this,"uploadBaseStatsStarted",!1),M(this,"uploadExtensionUsageStarted",!1),M(this,"lastRecvStats",void 0),M(this,"lastSendStats",void 0),M(this,"lastRefRecvStats",void 0),M(this,"lastRefSendStats",void 0),M(this,"lastNormalRecvStats",void 0),M(this,"lastNormalSendStats",void 0),M(this,"lastExtendStats",{}),M(this,"needUploadStats",{}),M(this,"needUploadRenderFreezeTime",!0),M(this,"lastUploadCompensateTime",-1),M(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%gv==0,s=r%Tx==0,c=r%60==0;let u,p;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(p=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!p&&this.uploadInboundStarted&&(p=this.requestStats(!0)),u||p){var m;const g={};if(this.uploadTransportStarted&&u){const _=this.getTransportStats(u,i?this.lastRefSendStats:void 0,p,i);_&&(g.misc=[_])}if(this.uploadOutboundStarted&&u){const _=this.getOutboundStats(u,s?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,c);_&&(g.outbound=[_])}if(this.uploadInboundStarted&&p){this.uploadCompensateStats(r);const _=this.getInboundStats(p,s?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(g.inbound=_)}const v=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;if(v&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[lm.RTC_PEER_CONNECTION_STATE]=uA[v]):g.misc=[{addition:{[lm.RTC_PEER_CONNECTION_STATE]:uA[v]}}]),xa.needUploadStats.length>0||s){const _=xa.needUploadStats.shift()||(xa.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[lm.PAGE_VISIBILITY]=_):g.misc=[{addition:{[lm.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[Y8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=p,this.lastSendStats=u,s&&(this.lastNormalRecvStats=p,this.lastNormalSendStats=u),i&&(this.lastRefRecvStats=p,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,xa.startCollectStats();let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,s;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[lm.RTC_PEER_CONNECTION_STATE]:uA[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===$ve+1&&(r=1)},Ku)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=r%gv==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const p={};if(this.uploadInboundStarted&&u){const m=this.requestRemoteMedia()||[],g=[];m.forEach(v=>{let[_,E]=v;const w={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&E.has($e.VIDEO)&&_.videoTrack){const C=function(U,k,j){if(!k.videoRecv.find(K=>K.ssrc===U))return;const $={};if(j&&j._player){const K=j._player,{renderFreezeAccTime2:J,videoElementStatus:ne}=K;if(xa.visibility==="visible"&&ne===Jr.PLAYING&&Pt().supportRequestVideoFrameCallback){const ae=Math.min(6e3,J);K.renderFreezeAccTime2=Math.max(0,J-ae),ot($,Do.Video_Render_Freeze_Time_Render2,ae),W("USE_NEW_RENDER_FREEZE_TIME")&&ot($,Do.Video_Render_Freeze_Time_Render,ae)}}return $}(_._videoSSRC,u,_.videoTrack);C&&(w.video=C)}w.video&&g.push(w)}),g.length>0&&(p.inbound=g,this.requestUploadStats(p))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,i,s,c){if(!this.requestStats)return;if(!c)return r.rtt==null?void 0:{addition:{[Ur.RTT]:r.rtt,[Ur.CONN_TYPE]:void 0,[Ur.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const u=q8(r);if(this.store.useP2P){if(s){const p=q8(s);u[Ur.CONN_TYPE]&&p[Ur.CONN_TYPE]&&(u[Ur.CONN_TYPE]+=p[Ur.CONN_TYPE]<<3)}u[Ur.CONN_TYPE]?u[Ur.CONN_TYPE]+=110:u[Ur.CONN_TYPE]=110}else{u[Ur.CONN_TYPE]?u[Ur.CONN_TYPE]+=100:u[Ur.CONN_TYPE]=100;const p=function(m,g){return g?[Math.ceil(8*(m.transport.bytesSent-g.transport.bytesSent)/(m.timestamp-g.timestamp)),Math.ceil(8*(m.transport.bytesReceived-g.transport.bytesReceived)/(m.timestamp-g.timestamp))]:[0,0]}(r,i);u[RI.Transport_Send_Bitrate]=p[0],u[RI.Transport_Recv_Bitrate]=p[1]}return{addition:u}}getOutboundStats(r,i,s,c,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;const p=this.requestLocalMedia();if(!p||p.length===0)return;let m,g,v;return p.forEach(_=>{let[E,{track:w,ssrcs:C}]=_;switch(E){case Re.LocalVideoLowTrack:case Re.LocalVideoTrack:if(E===Re.LocalVideoTrack){var U;const k=function(J,ne,ae,ee,oe,ve){const Ee=ne.videoSend.find(Tt=>Tt.ssrc===J);if(!Ee)return;const Be={},{sentFrame:mt,inputFrame:ct}=Ee;if(ee&&(ot(Be,Do.Video_Send_Qp_Sum,Ee.qpSumPerFrame),ct&&mt)){const Tt=ct.frameRate,Et=mt.frameRate;Be[Do.Video_Send_Freeze]=function(Yt,Tn){let _e=!0;return _e=!(Yt<=5)&&(Yt<=10?Tn<3:Yt<=20?Tn<4:Tn<5),_e}(Tt,Et)?1:0}if(oe){switch(mt&&(ot(Be,bt.Video_Send_Height,mt.height),ot(Be,bt.Video_Send_Width,mt.width),ot(Be,bt.Video_Send_Frame_Rate,mt.frameRate)),Be[bt.Video_Send_Disabled]=ae._originMediaStreamTrack&&!ae._originMediaStreamTrack.enabled||ae._mediaStreamTrack&&!ae._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Be[bt.Video_Send_Adaptation]=0;break;case"cpu":Be[bt.Video_Send_Adaptation]=1;break;case"bandwidth":Be[bt.Video_Send_Adaptation]=2;break;case"other":Be[bt.Video_Send_Adaptation]=3}let Tt=0;Ee.adaptionChangeReason&&(Tt+=X8(Ee.adaptionChangeReason)),ne.qualityLimitationReason&&(Tt+=X8(ne.qualityLimitationReason)<<3),Be[bt.Video_Send_Adaptation]=Tt,Be[bt.Video_Send_Player_Status]=wA[ae._player?ae._player.videoElementStatus:"uninit"],ot(Be,bt.Video_Send_Nacks,Ee.nacksCount),ot(Be,bt.Video_Send_Plis,Ee.plisCount),ot(Be,bt.Video_Send_Firs,Ee.firsCount),ot(Be,bt.Video_Send_Avg_Encode,Ee.avgEncodeMs),ot(Be,bt.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),ot(Be,bt.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),ot(Be,bt.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),ot(Be,bt.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const Et=oe.videoSend.find(Yt=>Yt.ssrc===J);if(Et){let Yt=Ku*gv;Et.timestamp&&Ee.timestamp&&(Yt=Ee.timestamp-Et.timestamp),Et.packets!=null&&Ee.packets!=null&&ot(Be,bt.Video_Send_Package_Rate,1e3*(Ee.packets-Et.packets)/Yt),Ee.packetsLost!=null&&Et.packetsLost!=null&&ot(Be,bt.Video_Send_Package_Lost,Ee.packetsLost-Et.packetsLost),Et.bytes!=null&&Ee.bytes!=null&&ot(Be,bt.Video_Send_Bitrate,8*(Ee.bytes-Et.bytes)/Yt)}}return Be}(C[0].ssrcId,r,w,i,s),j=w.__className__==="CameraVideoTrack"?3:Ne(U=w._hints).call(U,Jt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||u)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);const $=w&&function(J,ne,ae,ee){const oe=ne.videoSend.find(Ee=>Ee.ssrc===J);if(!oe)return null;const ve={};if(ee){const Ee=oe.inputFrame,Be=Ee&&Ee.height||ae.videoHeight||0,mt=Ee&&Ee.width||ae.videoWidth||0,ct=Ee&&Ee.frameRate||0;ot(ve,bt.Video_Capture_Height,Be),ot(ve,bt.Video_Capture_Width,mt),ot(ve,bt.Video_Capture_Frame_Rate,ct)}return ve}(C[0].ssrcId,r,w,!!s),K=function(J,ne){const ae={};return ne&&(ot(ae,bt.Video_Send_Retransmit,J.bitrate.retransmit),ot(ae,bt.Video_Send_Target_Encoded,J.bitrate.targetEncoded),ot(ae,bt.Video_Send_Actual_Encoded,J.bitrate.actualEncoded),ot(ae,bt.Video_Send_Transmit,J.bitrate.transmit),ot(ae,bt.Video_Send_Bandwidth,J.sendBandwidth)),ae}(r,!!s);g=Object.assign({},k,$,K)}else v=function(k,j,$,K,J){const ne=j.videoSend.find(ee=>ee.ssrc===k);if(!ne)return;const ae={};if(K){const ee=ne.sentFrame;ee&&(ot(ae,bt.Video_Send_Low_Height,ee.height),ot(ae,bt.Video_Send_Low_Width,ee.width),ot(ae,bt.Video_Send_Low_Frame_Rate,ee.frameRate));const oe=K.videoSend.find(ve=>ve.ssrc===k);if(oe){let ve=Ku*Tx;oe.timestamp&&ne.timestamp&&(ve=ne.timestamp-oe.timestamp),oe.packets!=null&&ne.packets!=null&&ot(ae,bt.Video_Send_Low_Package_Rate,1e3*(ne.packets-oe.packets)/ve),ne.packetsLost!=null&&oe.packetsLost!=null&&ot(ae,bt.Video_Send_Low_Package_Lost,ne.packetsLost-oe.packetsLost),oe.bytes!=null&&ne.bytes!=null&&ot(ae,bt.Video_Send_Low_Bitrate,8*(ne.bytes-oe.bytes)/ve)}}return ae}(C[0].ssrcId,r,0,s);break;case Re.LocalAudioTrack:m=w&&function(k,j,$,K,J,ne){const ae=j.audioSend.find(oe=>oe.ssrc===k);if(!ae)return;const ee={};if(J){ee[bt.Audio_Send_Disabled]=$._originMediaStreamTrack&&!$._originMediaStreamTrack.enabled||$._mediaStreamTrack&&!$._mediaStreamTrack.enabled?1:0;const oe=100*$._source.getAccurateVolumeLevel(),ve=ae.inputLevel;if(ve!=null){const Be=Math.ceil(50*Math.log10(100*ve+1));ot(ee,bt.Audio_Send_Level,Be)}ot(ee,bt.Audio_Capture_PCM_Level,oe),ot(ee,bt.Audio_Send_AEC_Return_Loss,ae.aecReturnLoss),ot(ee,bt.Audio_Send_AEC_Return_Loss_Enhancement,ae.aecReturnLossEnhancement),ot(ee,bt.Audio_Send_Bytes_Retransmit,ae.retransmittedBytesSent),ot(ee,bt.Audio_Send_Packages_Retransmit,ae.retransmittedPacketsSent),ee[bt.Audio_Send_Freeze]=0;const Ee=J.audioSend.find(Be=>Be.ssrc===k);if(Ee){let Be=Ku*Tx;Ee.timestamp&&ae.timestamp&&(Be=ae.timestamp-Ee.timestamp),Ee.bytes!=null&&ae.bytes!=null&&ot(ee,bt.Audio_Send_Bitrate,8*(ae.bytes-Ee.bytes)/Be),Ee.packets!=null&&ae.packets!=null&&ot(ee,bt.Audio_Send_Package_Rate,1e3*(ae.packets-Ee.packets)/Be)}}return ee}(C[0].ssrcId,r,w,0,s)}}),{high:g,low:v,audio:m}}getInboundStats(r,i,s,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],p=[];return u.forEach(m=>{let[g,v]=m;const _={peer:g.uid};let E;if(v.has($e.VIDEO)&&g.videoTrack){const w=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,C=g.videoTrack?function(U,k,j,$,K,J,ne,ae){const ee=k.videoRecv.find(Et=>Et.ssrc===U);if(!ee)return;const oe={},{receivedFrame:ve,outputFrame:Ee,decodeFrameRate:Be}=ee;ot(oe,br.Video_Render_Frame_Rate_Decode,Be),ee.framesRateFirefox&&ot(oe,br.Video_Recv_Frame_Rate,ee.framesRateFirefox),ve&&ot(oe,br.Video_Recv_Frame_Rate,ve.frameRate),ot(oe,br.Video_Recv_Frame_Dropped,ee.framesDroppedCount),ot(oe,br.Video_Recv_Bytes_Retransmit,ee.retransmittedBytesReceived),ot(oe,br.Video_Recv_Packages_Retransmit,ee.retransmittedPacketsReceived),ot(oe,br.Video_Recv_Packages_Discarded,ee.packetsDiscarded),ot(oe,br.Video_Recv_Avg_Decode,ee.avgDecodeMs),ot(oe,br.Video_Recv_Avg_Processing_Delay,ee.avgProcessingDelayMs),ot(oe,br.Video_Recv_Avg_Assembly_Time,ee.avgFramesAssembledFromMultiplePacketsMs),ot(oe,br.Video_Recv_Avg_Inter_Frame_Delay,ee.avgInterFrameDelayMs),ot(oe,br.Video_Recv_Key_Frames_Decoded,ee.keyFramesDecoded);const mt=ae&&ae.videoRecv.find(Et=>Et.ssrc===U);if(mt){const Et=k.timestamp-ae.timestamp||Ku;ee.packetsLost!=null&&mt.packetsLost!=null&&ot(oe,br.Video_Recv_Package_Lost,ee.packetsLost-mt.packetsLost),mt.bytes!=null&&ee.bytes!=null&&ot(oe,br.Video_Recv_Bitrate,8*(ee.bytes-mt.bytes)/Et),mt.packets!=null&&ee.packets!=null&&ot(oe,br.Video_Recv_Package_Rate,1e3*(ee.packets-mt.packets)/Et)}const ct=J&&J.videoRecv.find(Et=>Et.ssrc===U);if(ct&&(ot(oe,Do.Video_Recv_Qp_Sum,ee.qpSumPerFrame),oe[Do.Video_Recv_Freeze]=$&&mv.isRemoteVideoFreeze(j,ee,ct)?1:0),ne){var Tt;const Et=ne.videoRecv.find(Tn=>Tn.ssrc===U);ve?(ot(oe,bt.Video_Recv_Height,ve.height),ot(oe,bt.Video_Recv_Width,ve.width)):j&&(ot(oe,bt.Video_Recv_Height,j._videoHeight||0),ot(oe,bt.Video_Recv_Width,j._videoWidth||0)),Ee&&ot(oe,bt.Video_Recv_Frame_Rate_Output,Ee.frameRate);const Yt=(Tt=j._player)===null||Tt===void 0?void 0:Tt.rendFrameRate.toFixed(0);if(Yt&&ot(oe,bt.Video_Render_Frame_Rate_Render,+Yt),ot(oe,bt.Video_Recv_Jitter_Buffer,ee.jitterBufferMs),ot(oe,bt.Video_Recv_Current_Delay,ee.currentDelayMs),ot(oe,bt.Video_Recv_Firs,ee.firsCount),ot(oe,bt.Video_Recv_Nacks,ee.nacksCount),ot(oe,bt.Video_Recv_Plis,ee.plisCount),j){oe[bt.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Tn=j._player;if(Tn){const{freezeTimeCounterList:_e,renderFreezeAccTime:Oe,renderFreezeAccTime2:He,videoElementStatus:xe}=Tn;if(_e&&_e.length>0&&ot(oe,Do.Video_Render_Freeze_Time,_e.splice(0,1)[0]),K&&xa.visibility==="visible"&&xe===Jr.PLAYING&&Pt().supportRequestVideoFrameCallback){const D=Math.min(6e3,He);Tn.renderFreezeAccTime2=Math.max(0,He-D),ot(oe,Do.Video_Render_Freeze_Time_Render2,D);const X=Math.min(6e3,Oe);Tn.renderFreezeAccTime=Math.max(0,Oe-X),ot(oe,Do.Video_Render_Freeze_Time_Render,W("USE_NEW_RENDER_FREEZE_TIME")?D:X)}if(typeof ee.totalFreezesDuration=="number"){const D=Et&&Et.totalFreezesDuration?ee.totalFreezesDuration-Et.totalFreezesDuration:ee.totalFreezesDuration;ot(oe,bt.Video_Render_Freeze_Duration,1e3*D)}}}if(oe[bt.Video_Recv_Player_Status]=wA[j._player?j._player.videoElementStatus:"uninit"],Et&&ee.totalInterFrameDelay!==void 0&&ee.totalSquaredInterFrameDelay!==void 0&&Et.totalInterFrameDelay!==void 0&&Et.totalSquaredInterFrameDelay!==void 0){const Tn=ee.totalInterFrameDelay-Et.totalInterFrameDelay,_e=ee.totalSquaredInterFrameDelay-Et.totalSquaredInterFrameDelay,Oe=ee.framesDecodeCount-Et.framesDecodeCount,He=Tn/Oe*1e3,xe=Math.round(1e3*Math.sqrt((_e-Math.pow(Tn,2)/Oe)/Oe));!isNaN(xe)&&He+xe>Math.max(3*He,He+150)&&(oe[bt.Video_Recv_I_Frame_Delay]=xe)}}return oe}(g._videoSSRC,r,g.videoTrack,w===!0,this.needUploadRenderFreezeTime,i,s,c):void 0;if(C&&(_.video=C),g.videoTrack){const U=r.videoRecv.find(k=>k.ssrc===g._videoSSRC);U&&U.estimatedPlayoutTimestamp&&(E=U.estimatedPlayoutTimestamp)}}if(v.has($e.AUDIO)&&g.audioTrack){const w=g.audioTrack?function(C,U,k,j,$,K){const J=U.audioRecv.find(oe=>oe.ssrc===C);if(!J)return;const ne={};ot(ne,br.Audio_Recv_Jitter,J.jitterMs),ot(ne,br.Audio_Recv_Bytes_Retransmit,J.retransmittedBytesReceived),ot(ne,br.Audio_Recv_Packages_Retransmit,J.retransmittedPacketsReceived),ot(ne,br.Audio_Recv_Packages_Discarded,J.packetsDiscarded),ot(ne,br.Audio_Recv_Avg_Processing_Delay,J.avgProcessingDelayMs);const ae=K&&K.audioRecv.find(oe=>oe.ssrc===C);if(ae){const oe=Ku;J.packets!=null&&ae.packets!=null&&ot(ne,br.Audio_Recv_Package_Rate,1e3*(J.packets-ae.packets)/oe),J.packetsLost!=null&&ae.packetsLost!=null&&ot(ne,br.Audio_Recv_Package_Lost,J.packetsLost-ae.packetsLost)}if(j){const{receivedFrames:oe,droppedFrames:ve}=J;oe!=null&&ve!=null&&(ne[Do.Audio_Recv_Freeze]=(ee=oe)===0||100*ve/ee>20?1:0)}var ee;if($){const oe=100*k._source.getAccurateVolumeLevel(),ve=J.outputLevel;if(ve!=null){const Be=Math.ceil(50*Math.log10(100*ve+1));ot(ne,bt.Audio_Render_Level,Be)}ot(ne,bt.Audio_Recv_PCM_Level,oe),k&&(ne[bt.Audio_Recv_Disabled]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1),ot(ne,bt.Audio_Recv_Jitter_Buffer,J.jitterBufferMs),ot(ne,bt.Audio_Recv_Current_Delay,J.jitterBufferMs),ne[bt.Audio_Recv_Player_Status]=wA[di.getPlayerState(k.getTrackId())];const Ee=$.audioRecv.find(Be=>Be.ssrc===C);if(Ee){Ee.bytes!=null&&J.bytes!=null&&ot(ne,bt.Audio_Recv_Bitrate,8*(J.bytes-Ee.bytes)/(Ku*gv));const Be=J.concealedSamples-Ee.concealedSamples;Be>0&&ot(ne,bt.Audio_Recv_Concealed_Samples,Be);const mt=J.totalSamplesReceived-Ee.totalSamplesReceived;mt>0&&ot(ne,bt.Audio_Recv_Total_Samples_Received,mt);const ct=J.freezeSamples80-Ee.freezeSamples80;ct>0&&ot(ne,bt.Audio_Render_Freeze_Samples_80ms,ct);const Tt=J.freezeSamples200-Ee.freezeSamples200;Tt>0&&ot(ne,bt.Audio_Render_Freeze_Samples_200ms,Tt);const Et=J.freezeMs80-Ee.freezeMs80;ot(ne,bt.Audio_Render_Freeze_Time_80ms,Et<0?0:Et);const Yt=J.freezeMs200-Ee.freezeMs200;ot(ne,bt.Audio_Render_Freeze_Time_200ms,Yt<0?0:Yt)}}return ne}(g._audioSSRC,r,g.audioTrack,i,s,c):void 0;if(w&&(_.audio=w),g.audioTrack&&E){const C=r.audioRecv.find(U=>U.ssrc===g._audioSSRC);if(C&&C.estimatedPlayoutTimestamp){const U=C.estimatedPlayoutTimestamp-E;_.audio?_.audio[br.Audio_Recv_AV_Sync_TIME]=U:_.audio={[br.Audio_Recv_AV_Sync_TIME]:U}}}}(_.video||_.audio)&&p.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,p}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof rv);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(Wu.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,s]=r;s.has($e.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has($e.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),s={connectionInterval:W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const p=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,_]of p)_.has($e.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),_.has($e.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(v,_){const E={};for(const{id:k,value:j,level:$,direction:K}of v){var w;const J=(w=_.get(k))!==null&&w!==void 0?w:0,ne=j===2?J+W("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:J;var C,U;_.set(k,ne),E[k]?(j===2&&(E[k].value=j),$>E[k].level&&(E[k].level=$),K==="remote"&&(E[k].remoteUidCount+=1),E[k].totalTs=(C=_.get(k))!==null&&C!==void 0?C:0):E[k]={value:j,level:$,remoteUidCount:K==="local"?0:1,totalTs:(U=_.get(k))!==null&&U!==void 0?U:0}}return Object.keys(E).map(k=>{const{level:j,value:$,totalTs:K}=E[k];return{id:k,level:j,value:$,totalTs:K}})}(c,r);const m=Date.now(),g=m>i?m:i+1;this.requestUpload&&this.requestUpload(Wu.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})},W("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,xa.stopCollectStats()}}const Hve=W("ICE_RESTART_INTERVAL");let Cx=new Map,dm=new Map,md=[Rr.UDP_TCP_RELAY,Rr.TCP_RELAY,Rr.RELAY],AI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Pt().supportPCSetConfiguration;function Q8(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=Cx.get(t.id);i&&(window.clearTimeout(i),Cx.delete(t.id));const s=dm.get(t.id);r&&s&&s.index===md.length-1&&(R.debug("[".concat(t.id,"] reset ICE restart policy")),dm.delete(t.id))}function Z8(t,r,i){if(Cx.size===0&&dm.size===0&&(Array.isArray(W("RESTART_SEQUENCE"))&&W("RESTART_SEQUENCE").length>0&&!function(m,g){if(m.length!==g.length)return!1;for(let v=0;v<m.length;v+=1){const _=m[v];if(m.filter(E=>E===_).length!==g.filter(E=>E===_).length)return!1}return!0}(md,W("RESTART_SEQUENCE"))&&(md=W("RESTART_SEQUENCE").filter(m=>{var g;if(Ne(g=Object.values(Rr)).call(g,m))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(md.join(" => ")))),AI=W("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Pt().supportPCSetConfiguration),md.length===0)return void i();let s,{index:c=0,type:u}=dm.get(t.id)||{};if(AI&&u===Rr.RELAY)return void i();let p=u&&c>=md.length-1;if(AI)u=Rr.RELAY;else{if(p)return void i();u?(c++,u=md[c]):(u=md[0],c=0)}R.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),dm.set(t.id,{index:c,type:u}),s=window.setTimeout(()=>Z8(t,r,i),Hve),Cx.set(t.id,s)}var kt;function eG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function _c(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?eG(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):eG(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function tG(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=_b,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new Nx(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Nx(t){function r(i){if(Object(i)!==i)return Pe.reject(new TypeError(i+" is not an object."));var s=i.done;return Pe.resolve(i.value).then(function(c){return{value:c,done:s}})}return Nx=function(i){this.s=i,this.n=i.next},Nx.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Pe.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Pe.reject(i):r(s.apply(this.s,arguments))}},new Nx(t)}let Yu=(kt=class extends Nn{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Qe.StateChange,r,this._state)}constructor(t,r){super(),M(this,"isPlanB",void 0),M(this,"store",void 0),M(this,"statsUploader",void 0),M(this,"connection",void 0),M(this,"localTrackMap",new Map),M(this,"remoteUserMap",new Map),M(this,"localDataChannels",[]),M(this,"remoteDataChannelMap",new Map),M(this,"pendingLocalTracks",[]),M(this,"pendingRemoteTracks",[]),M(this,"pendingLocalDataChannels",[]),M(this,"pendingRemoteDataChannels",[]),M(this,"statsCollector",void 0),M(this,"shouldForwardP2PCreation",void 0),M(this,"iceFailedCount",0),M(this,"dtlsFailedCount",0),M(this,"mutex",void 0),M(this,"_state",Xt.Disconnected),M(this,"_pcStatsUploadType",W("NEW_ICE_RESTART")?rl.FIRST_CONNECTION:rl.OLD_FIRST_CONNECTION),M(this,"_isStartRestartIce",!1),M(this,"_restartTimer",void 0),M(this,"_isTryConnecting",!1),M(this,"_iceError",null),M(this,"_forceTurn",!1),M(this,"_isWaitPcToRePub",!1),M(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new me(H.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const p=this.filterTobeMutedTracks(i);if(p.length===0)return void s();const m=p.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(p.map(v=>{let[,{id:_}]=v;return _}));const g=this.createMuteMessage(p);await pn(this,Qe.RequestMuteLocal,g),s()}catch(p){c(p)}finally{u()}}),M(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Xt.Connected)return void c(new me(H.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const p=this.filterTobeUnmutedTracks(i);if(p.length===0)return void s();const m=p.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding){const _=i._mediaStreamTrack.clone();v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}else{const _=NI(i,Au(this,Qe.RequestLowStreamParameter));v.track._mediaStreamTrack=_,v.track._originMediaStreamTrack=_}await new Pe((_,E)=>{this.handleReplaceTrack(v.track,_,E,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(p.map(v=>{let[,{id:_}]=v;return _}));const g=this.createUnmuteMessage(p);await pn(this,Qe.RequestUnmuteLocal,g),s()}catch(p){c(p)}finally{u()}}),M(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let p;u||(p=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Re.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==Xt.Connected)return void s();const{id:v,track:_}=g;await this.connection.updateSendParameters(v,_),await this.connection.updateEncoderConfig(v,_),this.emit(Qe.UpdateVideoEncoder,_),s()}catch(g){c(g)}finally{var m;(m=p)===null||m===void 0||m()}}),M(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const p=this.localTrackMap.get(Re.LocalVideoTrack);if(!this.connection||!p||p.track!==i||this.state!==Xt.Connected)return void s();const{id:m,track:g}=p;await this.connection.updateSendParameters(m,g),s()}catch(p){c(p)}finally{u()}}),M(this,"handleReplaceMixingTrack",async(i,s,c,u)=>{if(!this.connection||this.state!==Xt.Connected)return void s();const p=wI([i]);let m;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,p),s()}catch(v){c(v)}finally{var g;(g=m)===null||g===void 0||g()}}),M(this,"handleReplaceTrack",async(i,s,c,u)=>{let p;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(p=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:E}]=_;return i===E});if(!this.connection||!v||this.state!==Xt.Connected)return void s();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,v[1].id)),this.isPlanB){const _=v[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(v[0],_)}if(v[0]===Re.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding){const _=this.localTrackMap.get(Re.LocalVideoLowTrack);if(_){const E=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E,await new Pe((w,C)=>{this.handleReplaceTrack(_.track,w,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=p)===null||g===void 0||g()}}),M(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),M(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),M(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),M(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),M(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new J8(this.store),this.bindStatsUploaderEvents(),this.mutex=new Nr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Pt().supportUnifiedPlan||W("CHROME_FORCE_PLAN_B")&&dc(),this.shouldForwardP2PCreation=W("FORWARD_P2P_CREATION")&&Pt().supportPCSetConfiguration&&UF(),this.shouldForwardP2PCreation&&(this.connection=fv(this.store),this.emit(Qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var i;this.state=Xt.New,this._forceTurn=CI(t),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||r)&&((s||r)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=fv(this.store,t),this.emit(Qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new me(H.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=W("NEW_ICE_RESTART")?rl.FIRST_CONNECTION:rl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new me(H.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Xt.Connected){this.store.peerConnectionStart();const r=await this.connection.connect(t);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected,r}if(this.connection instanceof Ga&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),ze.reportApiInvoke(this.store.sessionId,{name:Sn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:ln.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Qe.RequestReconnect)});await this.connection.updateRemoteConnect(t)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[p]=c;return Ne(u=[Re.LocalVideoLowTrack,Re.LocalVideoTrack]).call(u,p)}),i=r.map(c=>{let[,{id:u}]=c;return u}),s=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Ga||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(ze.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Ne(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Ne(t).call(t,u));c&&(this.store.codec=c,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,t)}}async getEstablishParams(){var t;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ga&&this.connection.peerConnectionState!=="closed"&&Ne(t=[Xt.New,Xt.Connected]).call(t,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(t){if(!this.connection||this.state!==Xt.Connected){if(this.state===Xt.Disconnected)throw new me(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(i=>{var s;Ne(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}),t.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(t,r,i){var s=this;return ki(function*(){const c=yield Ct(s.mutex.lock("From P2PChannel.publish"));try{var u;const p=s.connection&&Ne(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Xt.Connected||p){if(s.state===Xt.Disconnected)throw new me(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const g=t.filter(v=>s.pendingLocalTracks.indexOf(v)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(p&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const m=s.filterTobePublishedTracks(t,r,i);if(m.length===0)return void(yield Ct(s.tryToUnmuteAudio(t)));yield*Dp(tG(s.doPublish(s.connection,m)))}finally{c()}})()}doPublish(t,r){var i=this;return ki(function*(){r.forEach(w=>{let{track:C,type:U}=w;const k=Date.now();i.store.publish(C.getTrackId(),U===Re.LocalAudioTrack?"audio":"video",k)}),i.bindLocalTrackEvents(r);const s=r.map(w=>{let{track:C}=w;return C}),c=yield Ct(t.send(s,i.store.codec,i.store.audioCodec)),u=(yield Ct(c.next())).value,p=i.createGatewayPublishMessage(r,u);let m;try{m=yield p}catch(w){throw c.throw(w),(w==null?void 0:w.code)===H.WS_ABORT&&r.forEach(C=>{let{track:U}=C;i.pendingLocalTracks.indexOf(U)===-1&&i.pendingLocalTracks.push(U)}),i.unbindLocalTrackEvents(r),w}const g=i.mapPubResToRemoteConfig(p,m,s),v=(yield Ct(c.next(g))).value;if(i.state===Xt.Disconnected)throw new me(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");W("ENABLE_VIDEO_SEI");const _=W("ENABLE_ENCODED_TRANSFORM"),E=W("ENABLE_AUDIO_METADATA");s.forEach(async w=>{const C=w.getRTCRtpTransceiver();if(!C||!_)return;const{interceptLocalVideoFrame:U,interceptLocalAudioFrame:k}=gx();w.trackMediaType===$e.VIDEO?await U(C.sender,w):w.trackMediaType===$e.AUDIO&&await k(C.sender,{metadata:E?()=>{const j=w.metadata.shift();return j&&j.value}:void 0})}),r.forEach(w=>{let{type:C}=w;i.statsCollector.addLocalStats(C)}),i.assignLocalTracks(r,v),i.statsUploader.startUploadOutboundStats(),r.forEach(w=>{let{track:C,type:U}=w;const k=Date.now();i.store.publish(C.getTrackId(),U===Re.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(t,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof dn))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=i,c=function(u,p){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=rI(u,p)),m.maxFramerate=u.framerate?Fi(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,s);if(s._encoderConfig||(s._encoderConfig={}),r!==Re.LocalVideoLowTrack||!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=s._originMediaStreamTrack;if(!u.canvas)return R.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(p,m){const g=p.canvas;m.width&&(g.width=Fi(m.width)),m.height&&(g.height=Fi(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=NA(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Fi(m.framerate)))})(u,t)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),R.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var r=this;return ki(function*(){if(!r.connection||r.state!==Xt.Connected)return;const i=yield Ct(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Re.LocalVideoTrack);if(!c)throw new me(H.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Re.LocalVideoLowTrack))throw new me(H.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Re.LocalVideoLowTrack}];if(yield*Dp(tG(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var s;const p=(s=r.localTrackMap.get(Re.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;p!==void 0&&(yield Ct(r.connection.muteLocal([p])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,Qe.RequestRePublish,this.pendingLocalTracks),this.emit(Qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await er(this,Qe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:s}=this.pendingRemoteTracks[r];(s!==$e.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==$e.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await er(this,Qe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===$e.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(Qe.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Xt.Connected)return void t.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Xt.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Xt.Connected)return;const t=this.localTrackMap.get(Re.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Re.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const i=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[c,{track:u}]=s;return{type:c,track:u}})),r.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Xt.Connected)throw new me(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const u=this.pendingRemoteDataChannels.findIndex(p=>{let{user:m,id:g}=p;return m.uid===t.uid&&g===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(s=>s.id)}async subscribe(t,r,i,s,c){var u;if(!this.connection||this.state!==Xt.Connected)throw new me(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let p,m,g,v;const _=this.connection.getPreMedia(i);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),g=_.transceiver,p=_.track,m=_.mid,v=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:_.firstVideoRender});else if(c){const C=c.find(k=>{let{stream_type:j}=k;return j===r});if(!C)throw new me(H.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const U=await this.connection.receive(r,C.ssrcs,String(t._uintid),C.attributes);(this.connection instanceof Ga||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=U.transceiver),p=U.track,m=U.id}else{const C=await this.connection.receive(r,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);(this.connection instanceof Ga||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=C.transceiver),p=C.track,m=C.id}if(r===$e.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(p):(t._audioTrack=new Xp(p,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(p):(t._videoTrack=new qp(p,t.uid,t._uintid,this.store,v),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(ds.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(ds.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),v?t._videoTrack.once(ds.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(ds.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:U}=gx();r==$e.VIDEO?await C(g.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(k=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(k)}),onFirstFrame:k=>{var j;const $=Array.from(ai(j=this.remoteUserMap).call(j)).find(K=>K._videoSSRC===k.ssrc);$&&this.store.firstVideoFrameDecoded($.uid,{firstReceivedEncodedFrame:Date.now(),frameType:k.type,rtpTimestamp:k.rtpTimestamp,framePayloadType:k.payloadType,frameDataLength:k.length,mimeType:k.mimeType})}}):r==$e.AUDIO&&await U(g.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:k=>{this.safeEmit(Qe.AudioMetadata,k)},onPts:k=>{this.safeEmit(Qe.AudioPts,k)}})}const E=this.remoteUserMap.get(t);E?E.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(C=>{let{user:U,kind:k}=C;return U.uid===t.uid&&r===k});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Qe.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Xt.Connected)throw new me(H.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:p,mediaType:m}=c;return!((u=this.remoteUserMap.get(p))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);if(u){const{track:p,mid:m,transceiver:g,player:v}=u;i.set(c.ssrcId,{track:p,id:m,transceiver:g,player:v})}else r.push(c)});const s=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:p,ssrcId:m,rtxSsrcId:g}=c;return{kind:p,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,s[u])});for(const{user:c,mediaType:u,ssrcId:p}of t){const m=i.get(p);if(!m)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(p));const{track:g,id:v,transceiver:_,player:E}=m;if(_&&W("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=gx();u==$e.VIDEO?await U(_.receiver,{onSei:W("ENABLE_VIDEO_SEI")&&(j=>{var $;return($=c._videoTrack)===null||$===void 0?void 0:$._onSei(j)}),onFirstFrame:j=>{var $;const K=Array.from(ai($=this.remoteUserMap).call($)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==$e.AUDIO&&await k(_.receiver,{enableTopn:!!W("ENABLE_AUDIO_TOPN"),enableMetadata:!!W("ENABLE_AUDIO_METADATA"),enablePts:!!W("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Qe.AudioMetadata,j)},onPts:j=>{this.safeEmit(Qe.AudioPts,j)}})}if(u===$e.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new Xp(g,c.uid,c._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),_&&c._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new qp(g,c.uid,c._uintid,this.store,E),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),_&&c._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._videoTrack)),W("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:U,interceptRemoteAudioFrame:k}=gx();u==$e.VIDEO?await U(_.receiver,{onSei:j=>{var $;($=c._videoTrack)===null||$===void 0||$._onSei(j)},onFirstFrame:j=>{var $;const K=Array.from(ai($=this.remoteUserMap).call($)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==$e.AUDIO&&await k(_.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(U=>{let{user:k,kind:j}=U;return k.uid===c.uid&&u===j});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Qe.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(p=>{let{user:m,kind:g}=p;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid});if(s.forEach(p=>{const m=this.pendingRemoteTracks.indexOf(p);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Xt.Connected||i||s.forEach(p=>{let{kind:m}=p;var g;if(m===$e.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===$e.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Xt.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(p=>{let[,{id:m}]=p;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(p=>{let[m,{kind:g}]=p;var v,_;if(g===$e.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===$e.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((_=m._videoTrack)===null||_===void 0||_._destroy(),m._videoTrack=void 0);else if(g===$e.AUDIO){var E;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((E=m._audioTrack)===null||E===void 0||E._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(p=>p.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,r);if(i.length===0)return;r.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const p=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:v}=m;return u!==void 0?g.uid===c.uid&&u===v:g.uid===c.uid});p.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(p)}if(!this.connection||this.state!==Xt.Connected)return void r.forEach(c=>{let{user:u,kind:p}=c;var m;if(p===$e.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(p===$e.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});const i=ss(t).call(t,(c,u)=>{let{user:p,mediaType:m}=u;const g=this.filterTobeUnSubscribedTracks(p,m);return c.concat(g)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:p}]=c;var m,g;if(p===$e.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),p===$e.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(p===$e.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(t){return!this.connection||this.state!==Xt.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===$e.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Re.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Re.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Re.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Re.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Re.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,i,s,c){if(t){const p=this.localTrackMap.get(Re.LocalAudioTrack),m=s?this.localTrackMap.get(Re.LocalVideoLowTrack):this.localTrackMap.get(Re.LocalVideoTrack);ze.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:p==null?void 0:p.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const p=i.find(g=>g instanceof Mn),m=s?(u=this.localTrackMap.get(Re.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof dn);ze.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:p==null?void 0:p.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===$e.VIDEO?i._videoSSRC:i._audioSSRC;c&&ze.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===$e.VIDEO,audio:s===$e.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Nr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=fv(this.store),this.emit(Qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Re.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Xt.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Re.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Re.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof dn||r&&r.track instanceof Mn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(ai(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Re.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=vu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=fv(this.store),this.emit(Qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Re.LocalVideoTrack:Ne(r=s._hints).call(r,Jt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Re.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Re.LocalVideoLowTrack:}}),this.emit(Qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(ai(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Qe.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,i]=t;Array.from(ai(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(r,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const i of this.pendingRemoteDataChannels){const{user:s,id:c}=i;if((t instanceof pd?t.uid:t)===s.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof pd?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return ki(function*(){if(!r.connection||r.state!==Xt.Connected)return;const i=yield Ct(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Ct(r.connection.restartICE(t));const u=yield Ct(s.next());if(u.done)return;const p=u.value,m=yield p;switch(TI(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Rr.UDP_TCP_RELAY:r._pcStatsUploadType=rl.UDP_TCP_RESTART;break;case Rr.TCP_RELAY:r._pcStatsUploadType=rl.TCP_RESTART;break;case Rr.RELAY:r._pcStatsUploadType=rl.RELAY_RESTART;break;default:r._pcStatsUploadType=rl.OLD_RESTART}r._isTryConnecting=!0,s.next(m)}catch(u){var c;(c=s)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Re.LocalVideoTrack),i=this.localTrackMap.get(Re.LocalAudioTrack),s=t.videoSend.find(C=>C.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(C=>C.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!c)return 1;const u=ba(this,Qe.NeedSignalRTT),p=s?s.rttMs:void 0,m=c?c.rttMs:void 0,g=p&&m?(p+m)/2:p||m,v=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,E=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,w=r==null?void 0:r.track;if(w&&w._encoderConfig&&w._hints.indexOf(Jt.SCREEN_TRACK)===-1){const C=w._encoderConfig.bitrateMax,U=t.bitrate.actualEncoded;if(C&&U){const k=(1e3*C-U)/(1e3*C);return B6[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,p=t.audioRecv.find(U=>U.ssrc===c),m=t.videoRecv.find(U=>U.ssrc===u);if(!p&&!m)return void(r+=1);const g=ba(this,Qe.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,E=p?p.jitterMs:void 0,w=t.recvPacketLossRate;let C=.7*w*100/50+.3*_/1500;E&&(C=.6*w*100/50+.2*_/1500+.2*E/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new Pe((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}async replaceTrack(t,r){var i;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Xt.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:p}]=u;return t===p});if(!s)return;const c=s[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),s[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,s[1].id)),this.isPlanB){const u=s[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Re.LocalVideoTrack&&!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding){const u=this.localTrackMap.get(Re.LocalVideoLowTrack);if(u){const p=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p,await new Pe((m,g)=>{this.handleReplaceTrack(u.track,m,g,!0)})}}}filterTobePublishedTracks(t,r,i){const s=[],c=this.getAllTracks();t=Lp(t=t.filter(g=>c.indexOf(g)===-1));let u,p=!1;const m=this.localTrackMap.get(Re.LocalAudioTrack);for(const g of t){if(g instanceof dn&&(this.localTrackMap.has(Re.LocalVideoTrack)||p?new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Re.LocalVideoTrack}),p=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Re.LocalVideoLowTrack})}if(g instanceof Mn)if(m){const v=m.track;if(v instanceof or)SI([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const _=wI([v,g]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(v,_)}}else u instanceof or?(SI([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&Pt().webAudioMediaStreamDest&&!g._bypassWebAudio?u=wI(u?[g,u]:[g]):u=g}return u&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:Re.LocalAudioTrack})),s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Lp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Mn){const c=this.localTrackMap.get(Re.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Re.LocalAudioTrack,c]),c.track.close())):r.push([Re.LocalAudioTrack,c])}if(s instanceof dn){const c=this.localTrackMap.get(Re.LocalVideoTrack);if(!c)continue;r.push([Re.LocalVideoTrack,c]);const u=this.localTrackMap.get(Re.LocalVideoLowTrack);u&&r.push([Re.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=Lp(t)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Lp(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Re.LocalVideoTrack:i.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ke.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Re.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Re.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Re.LocalVideoTrack:i.off(Ke.GET_STATS,this.handleGetLocalVideoStats),i.off(Ke.GET_RTC_STATS,this.handleGetRTCStats),i.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Re.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ke.GET_STATS,this.handleGetLocalAudioStats),r.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ke.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof qp&&r.addListener(Ke.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof Xp&&r.addListener(Ke.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has($e.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has($e.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,p,{track:m,type:g}=i;switch(g){case Re.LocalAudioTrack:u=tn.Audio,p={dtx:m instanceof rv&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Re.LocalVideoTrack:u=Ne(c=m._hints).call(c,Jt.SCREEN_TRACK)?tn.Screen:tn.High,p=_c(_c({},n8(m)),{},{codec:this.store.codec,svc_mode:ov()});break;case Re.LocalVideoLowTrack:u=tn.Low,p=_c(_c({},n8(m)),{},{codec:this.store.codec,svc_mode:ov()})}return{stream_type:u,attributes:p,ssrcs:r[s]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Qe.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Ga&&!_n()&&W("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},W("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Ga&&Q8(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=rl.DISCONNECTED_OR_FAILED,ba(this,Qe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));ze.reportApiInvoke(this.store.sessionId,{name:Sn.REPUB_AFTER_PC_CONNECTED,options:i.concat(s),tag:ln.TRACER}).onSuccess(),this.republish()}if(W("NEW_ICE_RESTART")&&t instanceof Ga&&!_n()&&!this._forceTurn&&!this.store.useDcSignal){if(Ne(X6).call(X6,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{TI(t)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),ba(this,Qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Qe.RequestRestartICE,c))},s=()=>{TI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Z8(t,i,s)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&W("ICE_RESTART")&&ba(this,Qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Qe.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:ln.TRACER}).onSuccess(),this.emit(Qe.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ds.FIRST_FRAME_DECODED),ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,wn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,wn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{var c;const u=Array.from(ai(c=this.remoteUserMap).call(c)).find(p=>p._videoSSRC===r);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoRender=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s),this.emit(Qe.FirstVideoPreRender,s.uid,r))},t.onFirstVideoReceived=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,wn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstVideoBufferReady=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&this.emit(Qe.FirstVideoBufferReady,s.uid,r)},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Qe.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ud(i))," -> ").concat(JSON.stringify(ud(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ud(i))," -> ").concat(JSON.stringify(ud(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return _c(_c({},r),i)},t.onICECandidateError=r=>{this._iceError=r}}fallbackConnection(){R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Xt.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=fv(this.store),this.emit(Qe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(t){t instanceof Ga&&function(r){dm.delete(r.id),Q8(r)}(t),t.close(),this.emit(Qe.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Re.LocalAudioTrack);if(t instanceof Mn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Re.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Re.LocalVideoTrack)){const c=this.localTrackMap.get(Re.LocalVideoLowTrack);c&&r.push([Re.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Re.LocalAudioTrack);if(t instanceof Mn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Re.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Re.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Re.LocalVideoLowTrack);c&&r.push([Re.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,p]=c;i.push([t,{kind:u,id:p}])});return i}filterTobeUnSubscribedDataChannels(t,r){const i=[];return r.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case $e.VIDEO:return void(s._videoSSRC&&r.push({stream_type:$e.VIDEO,ssrcId:s._videoSSRC}));case $e.AUDIO:return void(s._audioSSRC&&r.push({stream_type:$e.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(i=>{let[s,{kind:c}]=i;if(r.has(s)){let u=r.get(s);c===$e.VIDEO?u|=_r.Video:u|=_r.Audio,r.set(s,u)}else c===$e.VIDEO?r.set(s,_r.Video):r.set(s,_r.Audio)}),{users:Array.from(r.entries()).map(i=>{let[s,c]=i;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Re.LocalVideoTrack),i=this.localTrackMap.get(Re.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new Pe((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Pe((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Ga&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ga)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Ga&&this.connection.isPreRender}mapPubResToRemoteConfig(t,r,i){return t.map((s,c)=>{var u;let{stream_type:p}=s;const m=(u=r.find(g=>{let{stream_type:v}=g;return p===v}))===null||u===void 0?void 0:u.attributes;if(m&&W("DISABLE_SCREEN_SHARE_REMB")){const g=i[c]._hints;(Ne(g).call(g,Jt.SCREEN_TRACK)||Ne(g).call(g,Jt.SCREEN_LOW_TRACK))&&(m.remb=!1,R.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Mn){var r;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(s.map(u=>{let[,{id:p}]=u;return p})));const c=this.createUnmuteMessage(s);return void await pn(this,Qe.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Qe.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vr(Pb(this.dtlsFailedCount,Kn)),this.emit(Qe.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await er(this,Qe.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Qe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Re.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof dn).length>1)throw new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Mn).length>1&&(t.some(r=>r instanceof Mn&&r._bypassWebAudio)||!Pt().webAudioMediaStreamDest))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof dn&&this.pendingLocalTracks.some(i=>i instanceof dn))throw new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Mn&&this.pendingLocalTracks.some(i=>i instanceof Mn)&&(!Pt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Mn&&i._bypassWebAudio)))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var i;const s=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding,c=_c(_c({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=s?t._mediaStreamTrack.clone():NI(t,c);const p=Zt(8,"track-low-"),m=new dn(u,_c(_c({},s&&{scaleResolutionDownBy:rI(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,p);return m.on(Lu.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,Wp.LOW_STREAM)}),m._hints.push(Jt.LOW_STREAM),Ne(i=t._hints).call(i,Jt.SCREEN_TRACK)&&m._hints.push(Jt.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),t.addListener(Ke.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ga){var c,u,p,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:_,peerConnectionState:E}=this.connection,{local:w,remote:C}=await this.connection.getSelectedCandidatePair();ze.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:v,dtlsstate:_,connectionstate:E,intSucc:r?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=w==null?void 0:w.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=w.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(w.address,":").concat(w.port),selectedRemoteCandidateProtocol:(p=C.protocol)!==null&&p!==void 0?p:"",selectedRemoteCandidateType:(m=C.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,i=r.firstVideoFrameDecoded.find(_=>_.userId===t.uid);if(!i)return;const{isInternalUpload:s,isExternalUpload:c}=i;if(s&&c)return;const{subscribeEnd:u,firstPreRender:p,peerPublishDuration:m,peerPubStatusMs:g}=i;let{firstRender:v=0}=i;if(u&&(v||p)&&m&&g){i.isInternalUpload=!0;const{playEnd:_}=i;_&&(i.isExternalUpload=!0);const{firstPreRender:E=0}=i;v=E||v;const w=t.videoTrack,C={peer:t._uintid,width:(w==null?void 0:w._videoWidth)||0,height:(w==null?void 0:w._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:E||0,firstRender:_?Math.max(v,_):Math.max(v,u),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:EV(this.store),firstReceivedEncodedFrame:i.firstReceivedEncodedFrame||0,frameType:i.frameType||"",rtpTimestamp:i.rtpTimestamp||0,framePayloadType:i.framePayloadType||0,frameDataLength:i.frameDataLength||0,mimeType:i.mimeType||""};ze.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(ai(c=this.remoteUserMap).call(c)).find(p=>p._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(g=>g.userId===u.uid&&g.type==="video");ze.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,wn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Re.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Wp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ke(kt.prototype,"startP2PConnection",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"startP2PConnection"),kt.prototype),ke(kt.prototype,"connect",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"connect"),kt.prototype),ke(kt.prototype,"updateRemoteRTPCapabilities",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"updateRemoteRTPCapabilities"),kt.prototype),ke(kt.prototype,"publishDataChannel",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"publishDataChannel"),kt.prototype),ke(kt.prototype,"unpublish",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unpublish"),kt.prototype),ke(kt.prototype,"unpublishDataChannel",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unpublishDataChannel"),kt.prototype),ke(kt.prototype,"unpublishLowStream",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unpublishLowStream"),kt.prototype),ke(kt.prototype,"subscribeDataChannel",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"subscribeDataChannel"),kt.prototype),ke(kt.prototype,"subscribe",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"subscribe"),kt.prototype),ke(kt.prototype,"massSubscribe",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"massSubscribe"),kt.prototype),ke(kt.prototype,"unsubscribe",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unsubscribe"),kt.prototype),ke(kt.prototype,"unsubscribeDataChannel",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unsubscribeDataChannel"),kt.prototype),ke(kt.prototype,"massUnsubscribe",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"massUnsubscribe"),kt.prototype),ke(kt.prototype,"muteRemote",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"muteRemote"),kt.prototype),ke(kt.prototype,"unmuteRemote",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"unmuteRemote"),kt.prototype),ke(kt.prototype,"hasRemoteMediaWithLock",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"hasRemoteMediaWithLock"),kt.prototype),ke(kt.prototype,"disconnectForReconnect",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"disconnectForReconnect"),kt.prototype),ke(kt.prototype,"updateBitrateLimit",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"updateBitrateLimit"),kt.prototype),ke(kt.prototype,"remoteMediaSsrcChanged",[ui],Object.getOwnPropertyDescriptor(kt.prototype,"remoteMediaSsrcChanged"),kt.prototype),kt);function ui(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function nG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function rG(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?nG(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):nG(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const zve=Date.now(),Kve=20,II=new Map,Rx=new Map;async function iG(t){const r=II.get(t),i=Array.isArray(r)&&r[r.length-1],s=Rx.get(t);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:i.payload};s.firstRecvTs===0&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const u=i.sendTs-s.firstSendTs,p=u-(Date.now()-s.firstRecvTs);p>0&&(s.firstRecvTs=Date.now()-u);let m=i.mediaDelay+p;m<=0?(r.pop(),aG(i.context,c),m=0):m=Math.min(m,Kve),setTimeout(()=>r.length&&iG(t),m)}function aG(t,r){t.safeEmit(Ot.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Yve(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return aG(i,{uid:t.uid,payload:t.payload});const s="".concat(i.id,"-").concat(t.uid),c=II.get(s)||[],u=c.findIndex(v=>t.sendTs>=v.sendTs),p=rG(rG({},t),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(p):c.splice(u,0,p),II.set(s,c);let m=!1;var g;Rx.has(s)?m=!((g=Rx.get(s))===null||g===void 0||!g.isSyncing):Rx.set(s,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||iG(s)}const qve=$t().name;function sG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function oG(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?sG(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):sG(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const um="websdk_ng_cache_parameter",Xve=W("MAX_PRELOAD_ASYNC_LENGTH"),Jve=1e4,qu=new Map,Xu=[];let OI=null,PI=0,DI=0;const Ax=new Map,cG=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Qve=function(t,r){const i=[];let s=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&s<r?c():s--};return async function(){for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return new Pe(async(g,v)=>{i.push(async()=>{try{const _=await t(...p);g(_)}catch(_){v(_)}}),s<r&&(s++,c())})}}(jI,Xve),kI=ji.CancelToken.source();class Zve{constructor(){M(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const r=this._audioContext.sampleRate,i=10*r,s=this._audioContext.createBuffer(2,i,r),c=this._audioContext.createBufferSource();c.buffer=s;const u=this._audioContext.createMediaStreamDestination();return c.connect(u),c.start(),u.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function jI(t,r,i,s,c,u,p){try{if(!W("ENABLE_PRELOAD"))return;if(!Pt().supportWebCrypto)return void ad(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new me(H.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Lr(i,"token",1,2047),Lr(t,"appid",1,2047),ix(r),s&&ax(s);const m=Pu();R.debug("preload channel ".concat(r,", uid is ").concat(s));const g={appId:t,cname:r,token:i||t,uid:typeof s!="string"?s:null,sid:m,proxyServer:c,role:p};let v,_;typeof s=="string"?(g.stringUid=s,[_,v]=await Pe.all([kve(s,{sid:m,appId:t},kI.token),P8(oG(oG({},g),{},{token:i||t,uid:0}),kI.token)]),g.uid=_.uid,v.gatewayInfo.uid=g.uid,v.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),v=await P8(g,kI.token));const E={sid:m,appId:t,cname:r,token:i||t,uid:g.stringUid||s,intUid:g.uid||v.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:_,ap:v};await MI(E),PI++}catch(m){throw DI++,function(g){OI||(OI=window.setTimeout(()=>{let _="";Ax.forEach((E,w)=>{_+="".concat(w,": ").concat(E," ;")}),ze.reportApiInvoke(null,{name:Sn.PRELOAD,options:{success:PI,failed:DI,err:_}}).onError(g),PI=0,DI=0,Ax.clear(),OI=null},Jve));const v=Ax.get(g.code)||0;Ax.set(g.code,v+1)}(m),m}}async function LI(t){try{if(W("AP_REQUEST_DETAIL")||W("ENABLE_ROLE_SELECT_EDGE"))return;const r=lG(t);if(!r||t.cloudProxyServer!=="disabled")return;const i=await async function(s,c){try{const u=await window.crypto.subtle.importKey("raw",XF(c),"AES-GCM",!1,["decrypt"]),p=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:cG},u,Ou(s));return JSON.parse(window.atob(sd(new Uint8Array(p))))}catch{return}}(r,t.token||t.appId);if(!i||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(i,t))return;if(i&&Date.now()-i.ts<W("AP_CACHE_LIFETIME"))return i}catch(r){R.warn("Error get preloadInfo",r.message)}}function lG(t){let r;try{if(r=hG(um),!r)return;const i=JSON.parse(r),s=pG(t),c=function(p,m){for(let g=p.length-1;g>=0;g--)if(m(p[g]))return g;return-1}(i,p=>s in p);if(c===-1)return;const u=i.splice(c,1)[0];return Ix(um,JSON.stringify(i)),u[s]}catch(i){R.warn("Error delete preload info: ".concat(r),i.message),Ix(um,"")}}async function MI(t){let r;try{t.uid&&lG({appId:t.appId,cname:t.cname,token:t.token,uid:t.uid,stringUid:t.stringUid});const i=pG(t),s=await async function(u,p){try{const m=await window.crypto.subtle.importKey("raw",XF(p),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:cG},m,Ou(window.btoa(JSON.stringify(u))));return sd(new Uint8Array(g))}catch{return}}(t,t.token||t.appId);if(!s)return;r=hG(um);const c=r?JSON.parse(r):[];c.push({[i]:s}),c.length>W("AP_CACHE_NUM")&&c.shift(),Ix(um,JSON.stringify(c))}catch(i){R.warn("Error caching server parameters:",i.message),Ix(um,"")}}function UI(t){if(t){let r=qu.get(t);r&&(window.clearTimeout(r),r=null,qu.delete(t)),Ne(Xu).call(Xu,t)||t.cloudProxyServer!=="disabled"||Xu.push(t)}if(qu.size<W("AP_CACHE_NUM")&&Xu.length>0){const r=Xu.shift();qu.set(r,window.setTimeout(async()=>{const{appId:i,cname:s,token:c,stringUid:u,uid:p,proxyServer:m,role:g}=r;try{await Qve(i,s,c,p,m,u,g),qu.has(r)&&UI(r)}catch(v){R.warn("update preload failed",v.message),dG(r)}},W("AP_UPDATE_INTERVAL")))}}function dG(t){const r=Xu.indexOf(t);r!==-1&&Xu.splice(r,1);let i=qu.get(t);i&&(window.clearTimeout(i),i=null,qu.delete(t),UI())}function uG(t,r){const i=t.sua,s=t.ap;r&&i&&ze.reqUserAccount(t.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:t.intUid,errorCode:null,extend:i.req}),ze.reportResourceTiming(t.ap.url,t.sid),ze.joinWebProxyAP(t.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Yn.CHOOSE_SERVER,Yn.CLOUD_PROXY_FALLBACK].toString()}),ze.joinChooseServer(t.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[Yn.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function hG(t){return window.atob(window.localStorage.getItem(t)||"")}function Ix(t,r){window.localStorage.setItem(t,window.btoa(r))}function pG(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),rV(r)}function eye(t){let r=function(){const i=rye.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;c!==void 0&&(qn(s,10),fd(s,c));let u=i.cid;u!==void 0&&(qn(s,16),qn(s,u));let p=i.cname;p!==void 0&&(qn(s,26),fd(s,p));let m=i.deviceId;m!==void 0&&(qn(s,34),fd(s,m));let g=i.elapse;g!==void 0&&(qn(s,40),gd(s,g));let v=i.fileSize;v!==void 0&&(qn(s,48),gd(s,hm(v)));let _=i.height;_!==void 0&&(qn(s,56),gd(s,hm(_)));let E=i.jpg;E!==void 0&&(qn(s,66),qn(s,E.length),fG(s,E));let w=i.networkType;w!==void 0&&(qn(s,72),gd(s,hm(w)));let C=i.osType;C!==void 0&&(qn(s,80),gd(s,hm(C)));let U=i.requestId;U!==void 0&&(qn(s,90),fd(s,U));let k=i.sdkVersion;k!==void 0&&(qn(s,98),fd(s,k));let j=i.sequence;j!==void 0&&(qn(s,104),gd(s,hm(j)));let $=i.sid;$!==void 0&&(qn(s,114),fd(s,$));let K=i.timestamp;K!==void 0&&(qn(s,120),gd(s,K));let J=i.uid;J!==void 0&&(qn(s,128),qn(s,J));let ne=i.vid;ne!==void 0&&(qn(s,136),qn(s,ne));let ae=i.width;ae!==void 0&&(qn(s,144),gd(s,hm(ae)));let ee=i.service;ee!==void 0&&(qn(s,152),qn(s,ee));let oe=i.callbackData;oe!==void 0&&(qn(s,162),qn(s,oe.length),fG(s,oe));let ve=i.ticket;ve!==void 0&&(qn(s,170),fd(s,ve));let Ee=i.vendorConfigs;Ee!==void 0&&(qn(s,178),fd(s,Ee))}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function tye(t){return function(i){let s={};e:for(;!iye(i);){let c=vv(i);switch(c>>>3){case 0:break e;case 1:s.code=vv(i);break;case 2:s.msg=gG(i,vv(i));break;case 3:s.requestId=gG(i,vv(i));break;case 4:s.timestamp=aye(i,!1);break;default:nye(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function nye(t,r){switch(r){case 0:for(;128&Ys(t););break;case 2:FI(t,vv(t));break;case 5:FI(t,4);break;case 1:FI(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function hm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let rye=[];function FI(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function iye(t){return t.offset>=t.limit}function Ox(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let p=new Uint8Array(2*u);p.set(i),t.bytes=p}return t.offset=u,u>c&&(t.limit=u),s}function mG(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function fG(t,r){let i=Ox(t,r.length);t.bytes.set(r,i)}function gG(t,r){let i=mG(t,r),s=String.fromCharCode,c=t.bytes,u="",p="";for(let m=0;m<r;m++){let g,v,_,E,w=c[m+i];128&w?(224&w)==192?m+1>=r?p+=u:(g=c[m+i+1],(192&g)!=128?p+=u:(E=(31&w)<<6|63&g,E<128?p+=u:(p+=s(E),m++))):(240&w)==224?m+2>=r?p+=u:(g=c[m+i+1],v=c[m+i+2],(49344&(g|v<<8))!=32896?p+=u:(E=(15&w)<<12|(63&g)<<6|63&v,E<2048||E>=55296&&E<=57343?p+=u:(p+=s(E),m+=2))):(248&w)==240?m+3>=r?p+=u:(g=c[m+i+1],v=c[m+i+2],_=c[m+i+3],(12632256&(g|v<<8|_<<16))!=8421504?p+=u:(E=(7&w)<<18|(63&g)<<12|(63&v)<<6|63&_,E<65536||E>1114111?p+=u:(E-=65536,p+=s(55296+(E>>10),56320+(1023&E)),m+=3))):p+=u:p+=s(w)}return p}function fd(t,r){let i=r.length,s=0;for(let p=0;p<i;p++){let m=r.charCodeAt(p);m>=55296&&m<=56319&&p+1<i&&(m=(m<<10)+r.charCodeAt(++p)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}qn(t,s);let c=Ox(t,s),u=t.bytes;for(let p=0;p<i;p++){let m=r.charCodeAt(p);m>=55296&&m<=56319&&p+1<i&&(m=(m<<10)+r.charCodeAt(++p)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Ys(t){return t.bytes[mG(t,1)]}function vG(t,r){let i=Ox(t,1);t.bytes[i]=r}function vv(t){let r,i=0,s=0;do r=Ys(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function qn(t,r){for(r>>>=0;r>=128;)vG(t,127&r|128),r>>>=7;vG(t,r)}function aye(t,r){let i,s=0,c=0,u=0;return i=Ys(t),s=127&i,128&i&&(i=Ys(t),s|=(127&i)<<7,128&i&&(i=Ys(t),s|=(127&i)<<14,128&i&&(i=Ys(t),s|=(127&i)<<21,128&i&&(i=Ys(t),c=127&i,128&i&&(i=Ys(t),c|=(127&i)<<7,128&i&&(i=Ys(t),c|=(127&i)<<14,128&i&&(i=Ys(t),c|=(127&i)<<21,128&i&&(i=Ys(t),u=127&i,128&i&&(i=Ys(t),u|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|u<<24,unsigned:r}}function gd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,p=Ox(t,u),m=t.bytes;switch(u){case 10:m[p+9]=c>>>7&1;case 9:m[p+8]=u!==9?128|c:127&c;case 8:m[p+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[p+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[p+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[p+4]=u!==5?128|s:127&s;case 4:m[p+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[p+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[p+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[p]=u!==1?128|i:127&i}}const yG={},_G={},Px=4294967296,sye=Px*Px,bG=sye/2;EG(0,!0);const xG=EG(0),oye=yv(0,-2147483648,!1),cye=yv(-1,2147483647,!1);function EG(t,r){let i,s,c;return r?(c=0<=(t>>>=0)&&t<256)&&(s=_G[t],s)?s:(i=yv(t,0,!0),c&&(_G[t]=i),i):(c=-128<=(t|=0)&&t<128)&&(s=yG[t],s)?s:(i=yv(t,t<0?-1:0,!1),c&&(yG[t]=i),i)}function yv(t,r,i){return{low:0|t,high:0|r,unsigned:!!i}}function SG(t,r){if(isNaN(t))return xG;{if(t<=-bG)return oye;if(t+1>=bG)return cye}return t<0?xG:yv(t%Px|0,t/Px|0,r)}function wG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class VI extends Nn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Ao.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),M(this,"name","AgoraRTCImageModeration"),M(this,"_connectionState",ps.CONNECTING),M(this,"_sequence",0),M(this,"_moderationStartTime",void 0),M(this,"_workerConnection",void 0),M(this,"_workerMessageLengthLimit",void 0),M(this,"_qualityRatio",void 0),M(this,"_connectInfo",void 0),M(this,"_cancelTokenSource",ji.CancelToken.source()),M(this,"_retryConfig",void 0),M(this,"_moderationInterval",void 0),M(this,"_moderationTimer",null),M(this,"_moderationMode",1),M(this,"_quality",1),M(this,"_qualityTimer",null),M(this,"_ticket",void 0),M(this,"_moderationIntervalMinimum",void 0),M(this,"_uploadFailedNum",0),M(this,"_uploadNum",0),M(this,"_uploadTimer",null),M(this,"_extraInfo",void 0),M(this,"_vendor",""),M(this,"_encoder",new TextEncoder),M(this,"_moderationId",void 0),M(this,"inspectImage",()=>{if(this.connectionState!==ps.CONNECTED)throw new ce(H.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ps.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Zt(5,"image-moderation-"),this._workerMessageLengthLimit=W("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=W("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=W("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new av("worker-"+this._moderationId,Kn),this.on(Ao.STATE_CHANGE,(s,c)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(em[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(Ao.STATE_CHANGE,em.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Pe((c,u)=>{this.on(Ao.CONNECTION_STATE_CHANGE,(p,m)=>{p===ps.CONNECTED&&c()}),this.requestAP(r,s,i).then(p=>{this.connectWorker(p)}).catch(p=>{u(p)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===ps.CONNECTED&&this.inspectImage()}async requestAP(r,i,s){const c=W("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,v,_,E){let{appId:w,areaCode:C,cname:U,sid:k,token:j,uid:$}=v;am++;const K="moderation_plugin",J={service_name:K,json_body:JSON.stringify({appId:w,areaCode:C,cname:U,command:"allocateEdge",requestId:am,seq:am,sid:k,appToken:j,ts:Date.now(),uid:$+""})};let ne,ae,ee=g[0];return To(async()=>{ne=Date.now();const oe=await Oo(ee,{data:J,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-ne,oe.code!==0){const ct=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+oe.code,{retry:!0,responseTime:ae});throw R.error(ct.toString()),ct}const ve=JSON.parse(oe.json_body);if(ve.code!==200){const ct=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ve.code,", reason: ").concat(ve.reason),{code:ve.code,responseTime:ae});throw R.error(ct.toString()),ct}if(!ve.servers||!Array.isArray(ve.servers)||ve.servers.length===0){const ct=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ve.code,responseTime:ae});throw R.error(ct.toString()),ct}if(!ve.servers.some(ct=>!!ct.wss)){const ct=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ve.code,responseTime:ae});throw R.error(ct.toString()),ct}const Ee=W("IMAGE_MODERATION_WORKER_WSS");if(Ee)return{addressList:[Ee],workerToken:ve.workerToken,vid:ve.vid,responseTime:ae};const Be=W("IMAGE_MODERATION_WORKER_HOST");return{addressList:ve.servers.map(ct=>{let{address:Tt,wss:Et}=ct;if(Tt&&Et)return"wss://".concat(Tt.replace(/\./g,"-"),".").concat(Be,":").concat(Et,"/moderation")}).filter(ct=>!!ct),workerToken:ve.workerToken,vid:ve.vid,ticket:ve.appTicket,responseTime:ae}},(oe,ve)=>(ze.apworkerEvent(k,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(oe.addressList),firstSuccess:ve===0,responseTime:ae,serverIp:g[ve%g.length]}),!1),(oe,ve)=>(ze.apworkerEvent(k,{success:!1,sc:oe.data&&oe.data.code||200,serviceName:K,responseTime:ae,serverIp:g[ve%g.length]}),!!(oe.code!==H.OPERATION_ABORTED&&oe.code!==H.UNEXPECTED_RESPONSE||oe.data&&oe.data.retry)&&(ee=g[(ve+1)%g.length],!0)),E)}(c,r,i,s);this.emit(Ao.STATE_CHANGE,em.AP_CONNECTED);const{addressList:p,ticket:m}=u;return this._ticket=m,p}async connectWorker(r){this.emit(Ao.STATE_CHANGE,em.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(St.CONNECTED,async()=>{this.emit(Ao.STATE_CHANGE,em.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ps.CONNECTED}),this._workerConnection.on(St.CLOSED,()=>{this.connectionState=ps.CLOSED}),this._workerConnection.on(St.FAILED,()=>{this.connectionState=ps.CLOSED}),this._workerConnection.on(St.RECONNECTING,()=>{this.connectionState=this.connectionState===ps.CONNECTED?ps.RECONNECTING:ps.CONNECTING}),this._workerConnection.on(St.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=tye(new Uint8Array(r.data));W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{ze.reportApiInvoke(this._connectInfo.sid||null,{name:Sn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:ln.TRACER}).onError(new ce(H.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},W("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(St.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this._workerConnection.on(St.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=ba(this,Ao.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(r,i);this._workerConnection.sendMessage(s,!0,!0)}else W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:p,sid:m,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),E=await YV(_,s,c),w=this._sequence+"-"+u+"-"+g+"-"+v+"-"+Zt(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:VI.intToLong(Number(v-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:E,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.2",sequence:this._sequence,sid:m,timestamp:SG(v),uid:g,vid:p,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;const U=eye(C);if(U.byteLength<this._workerMessageLengthLimit){if(W("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const k=function(j){for(var $=1;$<arguments.length;$++){var K=arguments[$]!=null?arguments[$]:{};$%2?wG(Object(K),!0).forEach(function(J){M(j,J,K[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(K)):wG(Object(K)).forEach(function(J){Object.defineProperty(j,J,Object.getOwnPropertyDescriptor(K,J))})}return j}({},C);delete k.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(k))}return U}{const k=this.quality*this._qualityRatio;return this.quality=k,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:p,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ji.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ps.CLOSED,this.emit(Ao.STATE_CHANGE,em.CLOSED)}}function TG(t){if(cn(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new ce(H.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new ce(H.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const lye={name:"ImageModeration",create:function(t){let{config:r}=t;return TG(r),new VI(r)}};var CG,NG,RG,AG,IG,OG,PG,DG,kG,jG,LG,MG,UG,FG,VG,BG,GG,WG,$G,HG,zG,KG,YG,qG,XG,JG,QG,ZG,eW,tW,nW,rW,iW,aW,sW,oW,cW,lW,dW,uW,hW,pW,Ge;function mW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function qs(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?mW(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):mW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}Nr.setLogger(R);let dye=(CG=st(),NG=st({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof zp))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),RG=st({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Hp.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),AG=st({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),IG=st({argsMap:(t,r,i)=>[r,i]}),OG=st({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return[s==null?void 0:s.uid,c]})}),PG=st({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),DG=st({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return{uid:s==null?void 0:s.uid,mediaType:c}})}),kG=st(),jG=st(),LG=st(),MG=st(),UG=st(),FG=st(),VG=st(),BG=st(),GG=st(),WG=st(),$G=st(),HG=st(),zG=st(),KG=st(),YG=st(),qG=st(),XG=st({argsMap:(t,r)=>[r]}),JG=st(),QG=st(),ZG=st(),eW=st(),tW=st(),nW=st(),rW=st(),iW=st(),aW=st({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),sW=st(),oW=st(),cW=st(),lW=st(),dW=st(),uW=st(),hW=st({reportResult:!0}),pW=st(),Ge=class extends Nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let i;if(super(),M(this,"store",void 0),M(this,"_uid",void 0),M(this,"_channelName",void 0),M(this,"_uintUid",void 0),M(this,"_users",[]),M(this,"_config",void 0),M(this,"_clientId",void 0),M(this,"_appId",void 0),M(this,"_sessionId",null),M(this,"_key",void 0),M(this,"_rtmConfig",{}),M(this,"_joinInfo",void 0),M(this,"_gateway",void 0),M(this,"_statsCollector",void 0),M(this,"_configDistribute",void 0),M(this,"_leaveMutex",void 0),M(this,"_publishMutex",void 0),M(this,"_renewTokenMutex",void 0),M(this,"_subscribeMutex",void 0),M(this,"_encryptionMode","none"),M(this,"_encryptionSecret",null),M(this,"_encryptionSalt",null),M(this,"_encryptDataStream",!1),M(this,"_encryptDataStreamKey",null),M(this,"_encryptDataStreamIv",null),M(this,"_proxyServer",void 0),M(this,"_turnServer",{servers:[],mode:"auto"}),M(this,"_cloudProxyServerMode","disabled"),M(this,"_isDualStreamEnabled",!1),M(this,"_defaultStreamFallbackType",void 0),M(this,"_lowStreamParameter",void 0),M(this,"_streamFallbackTypeCacheMap",new Map),M(this,"_remoteStreamTypeCacheMap",new Map),M(this,"_axiosCancelSource",ji.CancelToken.source()),M(this,"_audioVolumeIndicationInterval",void 0),M(this,"_networkQualityInterval",void 0),M(this,"_userOfflineTimeout",void 0),M(this,"_streamRemovedTimeout",void 0),M(this,"_rteDetailInterval",void 0),M(this,"_liveTranscodeStreamingClient",void 0),M(this,"_liveRawStreamingClient",void 0),M(this,"_channelMediaRelayClient",void 0),M(this,"_networkQualitySensitivity","normal"),M(this,"_p2pChannel",void 0),M(this,"_useLocalAccessPoint",!1),M(this,"_setLocalAPVersion",void 0),M(this,"_joinAndNotLeaveYet",!1),M(this,"_numberOfJoinCount",0),M(this,"_joinResponse",null),M(this,"_remoteDefaultVideoStreamType",void 0),M(this,"_inspect",void 0),M(this,"_moderation",void 0),M(this,"_license",void 0),M(this,"_pendingPublishedUsers",[]),M(this,"ntpAlignErrorCount",0),M(this,"remoteInboundOffset",0),M(this,"_peerConnectionState",void 0),M(this,"_pendingRtpCapabilityChange",void 0),M(this,"_fallbackServerInfo",void 0),M(this,"_dualStreamMode",void 0),M(this,"_handleLocalTrackEnable",(c,u,p)=>{this.publish(c,!1).then(u).catch(p)}),M(this,"_handleLocalTrackDisable",(c,u,p)=>{this.unpublish(c).then(u).catch(p)}),M(this,"_handleUserOnline",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(c.uid,this.channelName))return void R.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(p=>p.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Ot.USER_JOINED,u));else{const p=new pd(c.uid,c.uint_id||c.uid);this._users.push(p),R.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(p.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ot.USER_JOINED,p)}}),M(this,"_handleUserOffline",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(c.uid,this.channelName))return;const u=this._users.find(p=>p.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:Ib(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),R.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Ot.USER_LEAVED,u,c.reason))}),M(this,"_handleAddAudioOrVideoStream",(c,u,p,m,g,v,_,E)=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(u,this.channelName))return;const w=this._users.find(k=>k.uid===u);if(!w)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(w.uid,{videoAddNotify:Date.now()});const C=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=v||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,p!==void 0&&(w._audioSSRC=p),m!==void 0&&(w._cname=m),_&&(w._audioOrtc=_)):(w._video_added_=!0,p!==void 0&&(w._videoSSRC=p),m!==void 0&&(w._cname=m),E!==void 0&&(w._rtxSsrcId=E),_&&(w._videoOrtc=_)),(c==="audio"?w.hasAudio:w.hasVideo)&&!C&&(R.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(Ot.USER_PUBLISHED,w,c)),c==="video"?ze.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,wn.ON_ADD_VIDEO_STREAM,{peer:v||u,ssrc:w._videoSSRC}):ze.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,wn.ON_ADD_AUDIO_STREAM,{peer:v||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,p).then(k=>{if(k&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Yu))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(j=>{R.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(k=>{R.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}));const U=this._getEncodingName(g);c==="video"&&(U==="unknown"?this.safeEmit(Ot.AV1_DECODABLE_RESULT,!1):Cr()||ii()||(U==null?void 0:U.toLocaleLowerCase())!==ku.av1||Dve().then(k=>{W("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Ot.AV1_DECODABLE_RESULT,k),k||this._gateway.downgradeCodec(U)}))}),M(this,"_handleRemoveStream",c=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let p=()=>{};u.hasAudio&&u.hasVideo?p=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Ot.USER_UNPUBLISHED,u,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Ot.USER_UNPUBLISHED,u,"video")}:u.hasVideo?p=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Ot.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(p=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Ot.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Yu&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),ze.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,wn.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),p()}),M(this,"_handleSetStreamLocalEnable",(c,u,p)=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(u,this.channelName))return;const m=this._users.find(_=>_.uid===u);if(!m)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(p?"enabled":"disabled"," with uid ").concat(u));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const _=m._audio_enabled_;if(m._audio_enabled_=p,m._audio_enabled_===_)return;{const E=m._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(E)),this.safeEmit(Ot.USER_INFO_UPDATED,u,E)}}else{m._trust_video_enabled_state_=!0;const _=m._video_enabled_;if(m._video_enabled_=p,m._video_enabled_===_)return;{const E=m._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(E)),this.safeEmit(Ot.USER_INFO_UPDATED,u,E)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return g!==v?!g&&v?(R.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(Ot.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(Ot.USER_UNPUBLISHED,m,c)):void 0}),M(this,"_handleMuteStream",(c,u,p)=>{if(W("BLOCK_LOCAL_CLIENT")&&Gu(c,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),c,u,p);const m=this._users.find(_=>_.uid===c);if(!m)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const _=m._audio_muted_;if(m._audio_muted_=p,m._audio_muted_===_)return;{const E=m._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Ot.USER_INFO_UPDATED,c,E)}}else{m._trust_video_mute_state_=!0;const _=m._video_muted_;if(m._video_muted_=p,m._video_muted_===_)return;{const E=m._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Ot.USER_INFO_UPDATED,c,E)}}const v=u==="audio"?m.hasAudio:m.hasVideo;if(g!==v){if(!g&&v)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(Ot.USER_PUBLISHED,m,u)):void R.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(Ot.USER_UNPUBLISHED,m,u)}}),M(this,"_handleP2PLost",async c=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),M(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ot.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),M(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),M(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ot.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ot.NETWORK_QUALITY,c)}),M(this,"_handleP2PAddAudioOrVideoStream",(c,u,p,m)=>{const g=this._users.find(_=>_.uid===u);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,p!==void 0&&(g._audioSSRC=p),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,p!==void 0&&(g._videoSSRC=p),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(R.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Ot.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=t,this._clientId=r||Zt(5,"client-"),this.store=new class{constructor(c,u,p,m,g){_t(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:p,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Du.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(c){this.state=function(u,p){switch(p.type){case ft.SET_SESSION_ID:return Ie(Ie({},u),{},{sessionId:p.sessionId});case ft.SET_P2P_ID:return Ie(Ie({},u),{},{p2pId:p.p2pId});case ft.SET_UID:return Ie(Ie({},u),{},{uid:p.uid});case ft.SET_INT_UID:return Ie(Ie({},u),{},{intUid:p.intUid});case ft.SET_PUB_ID:return Ie(Ie({},u),{},{pubId:p.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{clientCreated:p.metric})});case ft.KEY_METRIC_JOIN_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinStart:p.metric})});case ft.KEY_METRIC_PRELOAD_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{preloadStart:p.metric})});case ft.KEY_METRIC_PRELOAD_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{preloadEnd:p.metric})});case ft.KEY_METRIC_JOIN_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinEnd:p.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestAPStart:p.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestAPEnd:p.metric})});case ft.KEY_METRIC_REQUEST_SUA_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{requestSUAEnd:p.metric})});case ft.KEY_METRIC_BEFORE_CONNECT:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{beforeConnect:p.metric})});case ft.KEY_METRIC_PEER_RECEIVER:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerReceiver:p.metric})});case ft.KEY_METRIC_SIGNAL_CONNECTED:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{signalConnected:p.metric})});case ft.KEY_METRIC_JOIN_REQ:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinReq:p.metric})});case ft.KEY_METRIC_JOIN_REP:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinRep:p.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinGatewayStart:p.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{joinGatewayEnd:p.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerConnectionStart:p.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{peerConnectionEnd:p.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{descriptionStart:p.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{signalChannelOpen:p.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{iceConnectionEnd:p.metric})});case ft.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,g=m.findIndex(v=>v.trackId===p.metric.trackId);return g!==-1?(m[g]=Ie(Ie({},m[g]),p.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{publish:[...m]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,p.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,g=m.findIndex(v=>v.userId===p.metric.userId&&v.type===p.metric.type);return g!==-1?(m[g]=Ie(Ie({},m[g]),p.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{subscribe:[...m]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,p.metric]})})}case ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=u.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(v=>v.userId===p.metric.userId);return g!==-1?(m[g]=Ie(Ie({},m[g]),p.metric),Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Ie(Ie({},u),{},{keyMetrics:Ie(Ie({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,p.metric]})})}case ft.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case ft.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=p.mode,u;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof p.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,p.record]:(u.joinChannelServiceRecords[p.index]=Ie(Ie({},u.joinChannelServiceRecords[p.index]),p.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case ft.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case ft.SET_USE_P2P:return Ie(Ie({},u),{},{useP2P:p.val});case ft.SET_TRANSPORT_TYPE:return Ie(Ie({},u),{},{p2pTransport:p.val});case ft.SET_RTE_URL:return Ie(Ie({},u),{},{rteUrl:p.rteUrl});case ft.SET_RTE_SID:return Ie(Ie({},u),{},{rteSid:p.rteSid});default:return u}}(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:ft.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:ft.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:ft.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:ft.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:ft.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:ft.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:ft.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:ft.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:ft.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,u){this.dispatch({type:ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ie({userId:c},u)})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,p,m){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:Ie(Ie({trackId:c,type:u},p&&{publishStart:p}),m&&{publishEnd:m})})}subscribe(c,u,p,m,g,v,_){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie(Ie(Ie({userId:c,type:u},p&&{subscribeStart:p}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),v&&{streamAdded:v}),_&&{firstDecoded:_})})}massSubscribe(c,u,p,m){c.forEach(g=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Ie(Ie(Ie({userId:g.userId,type:g.type},u&&{subscribeStart:u}),p&&{subscribeEnd:p}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(p=>p.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:Ie(Ie({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId,W("SIGNAL_CHANNEL")===1),this._leaveMutex=new Nr("client-leave",this._clientId),this._publishMutex=new Nr("client-publish",this._clientId),this._renewTokenMutex=new Nr("client-renewtoken",this._clientId),this._subscribeMutex=new Nr("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(cs," build: ").concat(fA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{eA(t.clientRoleOptions),i=Object.assign({},t.clientRoleOptions)}catch(c){R.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new mv(this.store),this._statsCollector.onStatsException=(c,u,p)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(p)),c===_I.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof Kb&&W("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(Ot.EXCEPTION,{code:c,msg:u,uid:p})},this._statsCollector.onUploadPublishDuration=(c,u,p,m)=>{const g=this._users.find(v=>v.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:p,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),ze.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:p,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(W("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(p=>p instanceof dn);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?W("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new Nve(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Kn,httpRetryConfig:t.httpRetryConfig||Kn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:i}),this._configDistribute=new Uve(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Io("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Yu(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,i,s,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],p=arguments.length>6&&arguments[6]!==void 0&&arguments[6];an("JOIN_GATEWAY_USE_443PORT_ONLY",u),an("JOIN_GATEWAY_USE_DUAL_DOMAIN",p);const m=this._gateway.signal.websocket;return m instanceof eI&&(m.use443PortOnly=u,m.tryDoubleDomain=p),async function(g,v,_){Cb.get(g)||Cb.set(g,[]),Nb.get(g)||Nb.set(g,v),lc.get(g)||lc.set(g,0);const E=Cb.get(g),w=Nb.get(g);if(!E||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(lc.get(g)===w){const $=zg();E.push($),await $.promise}lc.set(g,lc.get(g)+1);for(var C=arguments.length,U=new Array(C>3?C-3:0),k=3;k<C;k++)U[k-3]=arguments[k];const j=await _(...U);return lc.set(g,lc.get(g)-1),lc.get(g)===w-1&&E.length>0&&(E[0].resolve(),E.shift()),lc.get(g)===0&&(Cb.set(g,[]),Nb.set(g,0),lc.set(g,0)),j}("client.join",W("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,i,s,c)}async join(t,r,i,s,c){const u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const p=(Db||Db||(Db=(window.location.protocol.split(":")[0]||"").toUpperCase(),Db))==="HTTPS",m=aV()?window.isSecureContext:"Browser Not Support";(!aV()&&!p||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;ze.setAppId(t);try{if(!i&&i!==null)throw new ce(H.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&Lr(i,"token",1,2047),Lr(t,"appid",1,2047),ix(r),s&&ax(s),c)if(typeof c=="string")Lr(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ce(H.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:j,enableInstantMuteRestore:$,networkQualityProbe:K}=c;j&&(Fs(j,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),$&&(Fs($,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat($)),this.store.enableInstantMuteRestore=$),K&&(Fs(K,"networkQualityProbe"),R.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(K)),this.store.networkQualityProbe=K)}}}catch(j){throw ze.reportApiInvoke(Pu(),{name:Sn.JOIN,options:[t,r,i,s],states:{isHttps:p,isSecureContext:m},tag:ln.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ze.reportApiInvoke(Pu(),{name:Sn.JOIN,options:[t,r,i,s],states:{isHttps:p,isSecureContext:m},tag:ln.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await LI({appId:t,cname:r,uid:s,stringUid:typeof s=="string"?s:void 0,token:i||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(v==null?void 0:v.sid)||Pu();R.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const E=ze.reportApiInvoke(this._sessionId,{id:this._clientId,name:Sn.JOIN,options:[t,r,i,s],states:{isHttps:p,isSecureContext:m},tag:ln.TRACER}),w=qs(qs(qs({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:W("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(w.stringUid=s,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async j=>{const $=function(ae){const ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),oe=new Uint8Array(new ArrayBuffer(ee.length));for(let ve=0;ve<ee.length;ve+=1)oe[ve]=ee.charCodeAt(ve);return oe}(),K=await window.crypto.subtle.importKey("spki",$,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=QR(j),ne=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,J);return function(ae){let ee="";for(let oe=0;oe<ae.length;oe+=1)ee+=String.fromCharCode(ae[oe]);return window.btoa(ee)}(new Uint8Array(ne))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,$=W("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(w.appId+this._encryptionSecret+this._encryptionSecret):j.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,J,ne){const ae=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),ee=K==="aes-128-gcm2"?128:256,oe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:fV,hash:"SHA-256",salt:ne},ae,ee+age);return new Uint8Array(oe).subarray(ee/8)}(this._encryptionMode,$,Ou(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,J,ne){const ae=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),ee=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:fV,hash:"SHA-256",salt:ne},ae,{name:"AES-GCM",length:ee},!0,["encrypt","decrypt"])}(this._encryptionMode,$,Ou(this._encryptionSalt))}else m?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:w.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&ze.joinChannelTimeout(this._sessionId,5)},5e3);try{var U;let j;const $=w.cloudProxyServer;if(Ne(U=["proxy3","proxy4","proxy5"]).call(U,$)){const ee=W("PROXY_SERVER_TYPE3");Array.isArray(ee)?w.proxyServer=ee[0]:w.proxyServer=ee}if(ze.setProxyServer(w.proxyServer),R.setProxyServer(w.proxyServer),this.store.requestAPStart(),v){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(v.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=v.intUid),j={gatewayInfo:v.ap.gatewayInfo},W("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ee=(await r8(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||$r.tcpport,udpport:oe.udpport||$r.udpport,username:oe.username||$r.username,password:oe.password||$r.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:ee}}uG(v,w.stringUid)}else{if(w.stringUid&&!w.uid){let ee;[ee,j]=await Pe.all([O8(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store).finally(()=>{this.store.requestSUAEnd()}),I8(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(ee)),w.uid=ee,j.gatewayInfo.uid=ee,j.gatewayInfo.res.uid=ee}else j=await I8(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(Ro.UPDATE_BITRATE_LIMIT,ee=>{this._p2pChannel.updateBitrateLimit(ee)}),this._configDistribute.on(Ro.UPDATE_CLIENT_ROLE_OPTIONS,ee=>{this._setClientRoleOptions(ee)}),this._configDistribute.on(Ro.UPDATE_REMOTE_VIDEO_STREAM_TYPE,ee=>{var oe;Ne(oe=[0,1,4,5,6,7,8,9]).call(oe,ee)&&(this.remoteUsers.forEach(ve=>{this._remoteStreamTypeCacheMap.get(ve.uid)!==ee&&this.setRemoteVideoStreamType(ve.uid,ee)}),this.setRemoteDefaultVideoStreamType(ee))}),this._configDistribute.on(Ro.FALLBACK_TO_HLS,ee=>{ee&&this.safeEmit(Ot.FALLBACK_TO_HLS,tA.CONFIG)}),this._configDistribute.on(Ro.UPDATE_VOS_CONFIGURE,ee=>{this._gateway.setConfigure(ee).catch(oe=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),oe)})})},0),this._key=i||t;const K=j.gatewayInfo,J=w.uid?w.uid:K.uid;this._joinInfo=qs(qs({},w),{},{cid:K.cid,uid:J,vid:K.vid,apResponse:K.res,apGatewayAddress:K.apGatewayAddress,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=J,this.store.cid=K.cid;const ne=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(ne),this._appId=t,this._channelName=w.cname,this._uid=ne,this.store.uid=ne,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Cr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Cr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ae=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ae)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),k=this,Ne(Bu).call(Bu,k)||Bu.push(k),this._cloudProxyServerMode==="disabled"&&Pt().supportWebCrypto&&W("ENABLE_PRELOAD")&&UI(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&ze.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&ze.reportRteDetail(this._sessionId)},W("RTE_DETAIL_REPORT_INTERVAL")||6e4),ne}catch(j){const $=Array.isArray(j)?j[0]:j;throw $&&$.code===H.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),$):R.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),$),$.code!==H.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError($),$}var k}async _joinGateway(){if(!this._joinInfo||!this._key)throw new ce(H.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!W("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(t){if(t.code===H.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,jt.FALLBACK),R.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ce(H.INVALID_OPERATION);return ze.reportApiInvoke(this._sessionId,{name:Sn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:ln.TRACER}).onSuccess(),await this._joinGateway()}throw t}}async leave(){R.info("[".concat(this._clientId,"] Leaving channel"));const t=()=>{!Cr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Cr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=Bu.indexOf(i);s!==-1&&Bu.splice(s,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||t();const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED",jt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r(),this.store.useDcSignal&&t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof zp))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new ce(H.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new ce(H.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof zp))throw new ce(H.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ce(H.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof dn&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw R.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(t){if(t==null)throw new ce(H.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));cn(t.id,"id",0,65535,!0),Fs(t.ordered,"ordered"),Lr(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new ce(H.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ce(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return x8(c,!1)}(t),s=await this._p2pChannel.publishDataChannel([i]);if(s.length>0){if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ce(H.CREATE_DATACHANNEL_ERROR);try{await Pe.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==H.DISCONNECT_P2P)throw c}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof zp))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.sendExtensionMessage(Wn.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw R.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(t,r,i){if(!(t instanceof pd)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new ce(H.INVALID_REMOTE_USER,"user is not in the channel");t=s}return r==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,r)}async presubscribe(t,r){if(zn(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ce(H.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===$e.AUDIO,s=r===$e.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:p,rtxSsrcId:m,cname:g,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new ce(H.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(w=>w.uid===t);_||(_=new pd(t,v||t),_._is_pre_created=!0,this._users.push(_)),g&&(_._cname=g),_._uintid||(_._uintid=v||t),i&&(_._audioSSRC=u,_._audio_pre_subscribed=!0,p&&(_._audioOrtc=p)),s&&(_._videoSSRC=u,_._video_pre_subscribed=!0,p&&(_._videoOrtc=p),m!=null&&(_._rtxSsrcId=m)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(_,r,u,m,p);const E=i?_._audioTrack:_._videoTrack;if(!E)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),s&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),E}catch(u){throw R.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var i;if(cn(r,"channelId",0,65535,!0),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ce(H.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ce(H.INVALID_REMOTE_USER,"user is not published");const c=(i=t._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&Ne(m).call(m,c.id))try{var p;if(typeof c._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ce(H.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(p=c.metadata)!==null&&p!==void 0?p:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,i){if(zn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new ce(H.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!i&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const p=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,p,m)}catch(p){throw p}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,i){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(zn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new ce(H.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(i||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,p=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?$e.AUDIO:$e.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const _=r==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==c&&(c=_,u=r==="audio"?t._audioOrtc:t._videoOrtc,p=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?$e.AUDIO:$e.VIDEO,ssrcId:c}),Zr.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,p,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(E){if((E==null?void 0:E.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),E;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,r),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),v}catch(v){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{g()}}async massSubscribe(t){if(Zc(t,"subscribeList"),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:g,mediaType:v}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:g,mediaType:v}=m;return{user:g,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var p;for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:E}=v;if(zn(E,"mediaType",["audio","video"]),!_){const k=new ce(H.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),k}if(!this._users.find(k=>k===_)){const k=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),c[g].error=k,t.splice(g,1);continue}if(E==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||E==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const k=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(E,", remote user is not published")),c[g].error=k,t.splice(g,1);continue}const C=_r.Video|_r.LwoVideo,U=i.get(_);if(U){if(E==="video"?U&C:U&_r.Audio){t.splice(g,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(E," twice"));continue}i.set(_,U|(E==="video"?C:_r.Audio))}else i.set(_,E==="video"?C:_r.Audio)}for(let g=t.length-1;g>=0;g--){const v=t[g],{user:_,mediaType:E}=v,w=_r.Video|_r.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,E)){await this._p2pChannel.unmuteRemoteNoLock(_,E);const C=i.get(_);i.set(_,E==="video"?C^w:C^_r.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let m=ss(p=Array.from(i.entries())).call(p,(g,v)=>{let[_,E]=v;if(E===0)return g;const w={stream_id:_.uid,stream_type:E};return E&_r.Audio&&(w.audio_ssrc=_._audioSSRC),E&_r.Video&&(w.video_ssrc=_._videoSSRC),g.push(w),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:_,mediaType:E}=v;return{user:_,mediaType:E,ssrcId:E===$e.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:E===$e.VIDEO?_._rtxSsrcId:void 0}}));const g=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(_=>{let{stream_id:E,video_error_code:w,audio_error_code:C,error_code:U}=_;(w||C||U)&&g.set(E,{video_error_code:w,audio_error_code:C,error_code:U})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(_=>{let[E,w]=_;const C=this.remoteUsers.find(U=>U.uid===E);if(C){let U;w.error_code||w.video_error_code&&w.audio_error_code?U=void 0:w.video_error_code?U=$e.VIDEO:w.audio_error_code&&(U=$e.AUDIO),v.push({user:C,mediaType:U})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const _=g.get(v.user.uid);if(_){const E=_.error_code||v.mediaType==="audio"&&_.audio_error_code||v.mediaType==="video"&&_.video_error_code;if(E){const w=$u(E);R.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(w.desc)),v.error=new ce(H.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(w.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var _;ze.subscribe(this.store.sessionId,{succ:!!v.error,ec:((_=v.error)===null||_===void 0?void 0:_.code)||null,video:v.mediaType===$e.VIDEO,audio:v.mediaType===$e.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===$e.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:_,mediaType:E}=v;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{u(),s()}}async unsubscribe(t,r,i){if(!(t instanceof pd)){const u=this.remoteUsers.find(p=>p.uid===t);if(!u)throw new ce(H.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(r&&zn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Ib(this._users,t),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===H.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&cn(r,"id",0,65535,!0),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let s;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(s=[c])}else s=t._dataChannels;if(s===void 0){const c=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,s);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===H.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(Zc(t,"unsubscribeList"),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:c}=t[i];if(!s){const m=new ce(H.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(zn(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===s)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const p=_r.Video|_r.LwoVideo;if(r.has(s)){const m=r.get(s);let g;switch(c){case"video":g=m&p;break;case"audio":g=m&_r.Audio;break;default:g=m&(_r.Audio|p)}if(g){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),t.splice(i,1);continue}c?c==="audio"?r.set(s,m|_r.Audio):c==="video"&&r.set(s,m|p):r.set(s,m|_r.Audio|p)}else c?c==="audio"?r.set(s,_r.Audio):c==="video"&&r.set(s,p):r.set(s,_r.Audio|p)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:c,mediaType:u}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===H.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new me(H.INVALID_PARAMS);On(i.width)||XR(i.width,"streamParameter.width"),On(i.height)||XR(i.height,"streamParameter.height"),On(i.framerate)||XR(i.framerate,"streamParameter.framerate"),On(i.bitrate)||cn(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Re.LocalVideoLowTrack)}async setDualStreamMode(t,r){zn(t,"mode",[0,1,-1]);try{switch(r&&await this.setLowStreamParameter(r),this._dualStreamMode=t,this._joinInfo?this._gateway.setDualStreamMode(t).catch(i=>{R.warning("[".concat(this._clientId,"] set dual stream mode failed"),i.toString())}):R.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(t)),t){case jp.AUTO_SIMULCAST_STREAM:R.info("[".concat(this._clientId,"] set dual stream mode to ").concat(t));break;case jp.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case jp.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(i){throw R.error("[".concat(this._clientId,"] set dual stream mode error"),i.toString()),i}}async enableDualStream(){if(!Pt().supportDualStream)throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ce(H.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ce(H.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,this._dualStreamMode=jp.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void R.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(Re.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,this._dualStreamMode=jp.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),ze.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(s){zn(s,"role",["audience","host"])}(t),r&&eA(r),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ce(H.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new ce(H.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new ce(H.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;if(this._joinInfo&&(this._joinInfo.role=t),t!==i&&W("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Wr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level)),i==="audience"&&t!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Yu){const{video_codec:s}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(s.map(c=>c.toLowerCase()).filter(c=>{var u;return Ne(u=Object.keys(ku)).call(u,c)}))}}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&eA(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Lr(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,ze.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy")}if(Nu(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>KF(i)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"you should set license before join channel");if(Lr(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new ce(H.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new ce(H.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new ce(H.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Stop proxy server after leave channel");ze.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new ce(H.INVALID_PARAMS,"accessPoints is required.");Zc(t.accessPoints.serverList,"accessPoints.serverList"),Lr(t.accessPoints.domain,"accessPoints.domain");const r=(w,C)=>{cn(w,C,0,65535,!0)};let i=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");W("CLOSE_AFB_FOR_LOCAL_AP")&&(an("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),an("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(w=>s.test(w)?"".concat(w.replace(/\./g,"-"),".").concat(c):w),p=u.map(w=>"".concat(w,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,an("WEBCS_DOMAIN",p),an("WEBCS_DOMAIN_BACKUP_LIST",p),an("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Zc(t.report.hostname,"report.hostname"),an("EVENT_REPORT_DOMAIN",t.report.hostname[0]),an("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(an("EVENT_REPORT_DOMAIN",u[0]),an("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),an("STATS_COLLECTOR_PORT",m),t.report?an("ENABLE_EVENT_REPORT",!0):an("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Zc(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=u[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),an("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let _=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Zc(t.cds.hostname,"cds.hostname"),_=t.cds.hostname):_=u;let E=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),E=t.cds.port),an("CDS_AP",_.map(w=>"".concat(w,":").concat(E))),t.cds?an("ENABLE_CONFIG_DISTRIBUTE",!0):an("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(Zc(t,"serverList"),Lr(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,an("WEBCS_DOMAIN",t),an("WEBCS_DOMAIN_BACKUP_LIST",t),an("GATEWAY_DOMAINS",[r]),an("EVENT_REPORT_DOMAIN",t[0]),an("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),an("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(zn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){zn(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){zn(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,i,s){(function(u){zn(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Lr(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Ne(c).call(c,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new ce(H.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new ce(H.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Fs(s,"encryptDataStream"),!Ne(c).call(c,t))throw new ce(H.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=sd(i))}async renewToken(t){if(Lr(t,"token",1,2047),!this._key||!this._joinInfo)throw new ce(H.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(W("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await Mve(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=r,this._joinInfo.token=r,R.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Ot.VOLUME_INDICATOR,t)},W("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new ce(H.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ce(H.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new ce(H.LIVE_STREAMING_TASK_CONFLICT);const i=r?tl.TRANSCODE:tl.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(tl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!r.length)throw new ce(H.INVALID_PARAMS,"can not find live streaming url to stop");await Pe.all(r.map(i=>i&&i.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){M8(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){M8(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Yu&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ne(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(s=!0,t.payload=await async function(c,u,p){var m;const g=ss(m=Array.from(p)).call(m,(k,j)=>k+j,0),v={serverTs:0,seq:sge++,length:p.length,checkSum:g},_=new Uint8Array(nV(g,2)),E=new ArrayBuffer(Bp),w=new DataView(E);w.setUint32(0,v.serverTs),w.setUint16(4,v.seq),w.setUint16(6,v.length),w.setUint16(8,v.checkSum);const C=16-p.length%16;p=JF(p,new Uint8Array(C));const U=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:mV,additionalData:_},u,p);return JF(new Uint8Array(E),new Uint8Array(U))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new ce(H.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Je.DATA_STREAM,{payload:sd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-zve},!i)}sendMetadata(t){if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new ce(H.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Je.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:sd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(fge),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send custom report, not joined");await ze.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(W("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(i=>i.uid+"");Object.keys(t).forEach(i=>{Ne(r).call(r,i)||delete t[i]})}return t}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(t,r){zn(r.spatialLayer,"spatialLayer",[0,1,2,3]),zn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:i}=t;if(Fs(r,"apRTM"),cn(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Qp.indexOf(t);r!==-1&&Qp.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=ji.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&dG(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&ze.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ze.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Nr("client-publish",this._clientId),this._subscribeMutex=new Nr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var i;const s=t||Pu();t?R.debug("[".concat(this._clientId,"] new Session ").concat(s)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=t?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,ze.addSid(s);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};ze.sessionInit(this._sessionId,qs({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&W("FORCE_TURN")&&!W("TURN_ENABLE_TCP")&&!W("TURN_ENABLE_UDP"))throw new ce(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Wn.PUBLISH,s,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==H.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof dn&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===H.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==H.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===H.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new ce(H.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Io("LiveStreaming").create(s));var s;return i.onLiveStreamError=(c,u)=>{ze.reportApiInvoke(this._sessionId,{name:Sn.ON_LIVE_STREAM_ERROR,options:[c,u],tag:ln.TRACER}).onSuccess(),this.safeEmit(Ot.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{ze.reportApiInvoke(this._sessionId,{name:Sn.ON_LIVE_STREAM_WARNING,options:[c,u],tag:ln.TRACER}).onSuccess(),this.safeEmit(Ot.LIVE_STREAMING_WARNING,c,u)},i.on(JA.REQUEST_WORKER_MANAGER_LIST,(c,u,p)=>{if(!this._joinInfo)return p(new ce(H.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,v,_){const E=W("UAP_AP").slice(0,W("AJAX_REQUEST_CONCURRENT")).map(w=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(w+"/api/v1?action=uap"):"https://".concat(w,"/api/v1?action=uap"));return await Ive(E,m,g,v,_)})(c,this._joinInfo,this._axiosCancelSource.token,Kn).then(u).catch(p)}),i};return t===tl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ce(H.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),s=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Io("ChannelMediaRelay").create(t));s.on("state",c=>{c===Ji.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Ot.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(Ot.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,u)=>{var p;c==="resolution"&&((p=this._channelMediaRelayClient)===null||p===void 0||p.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:i,deleted:s}=t,c=[];if(r){const u=[];this._users.forEach(p=>{p._dataChannels.forEach(m=>{i.every(g=>g.uid!==p._uintid||g.stream_id!==m.id)&&u.push({uid:p._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:p,stream_id:m,ordered:g,max_retrans_times:v,metadata:_}=u,E=this._users.find(w=>w._uintid===p);if(!E)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),Ne(c).call(c,E)||c.push(E),E._uintid||(E._uintid=p),E._dataChannels.findIndex(w=>w.id===u.stream_id)===-1){const w={id:m,ordered:!!g,maxRetransmits:v,metadata:_},C=function(U){return x8(U,!0)}(w);E._dataChannels.push(C),R.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),r||this.safeEmit(Ot.USER_PUBLISHED,E,"datachannel",w)}this._p2pChannel.hasPendingRemoteDataChannel(E,u.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,u.stream_id).catch(w=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),w.toString())}))}),r&&(this.safeEmit(Ot.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:p,stream_id:m}=u,g=this._users.find(_=>_._uintid===p);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find(_=>_.id===u.stream_id);v&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then(_=>{if(g._dataChannels=g._dataChannels.filter(E=>E!==v),_)return this._gateway.unsubscribeDataChannel(_,g.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Ot.USER_UNPUBLISHED,g,"datachannel",v._config))})}_getEncodingName(t){var r,i;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(!s)return;for(const m of s){var c;if(m.payloadType===t)return m==null||(c=m.rtpMap)===null||c===void 0?void 0:c.encodingName}const u=(i=this._joinResponse.ortc.rtpCapabilities.recv)===null||i===void 0?void 0:i.videoCodecs;if(u)for(const m of u){var p;if(m.payloadType===t)return m==null||(p=m.rtpMap)===null||p===void 0?void 0:p.encodingName}return t===0?"unknown":void 0}_handleRemoveDataChannels(t){const r=this._users.find(i=>i.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(s=>{this.safeEmit(Ot.USER_UNPUBLISHED,r,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,r.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Gn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();Object.keys(r).forEach(s=>{const{value:c,type:u,expires:p}=r[s];p&&p<=i||u||$A()||!Object.prototype.hasOwnProperty.call(Mb,s)||(ja[s]=c,en[s]=c,R.debug("Update gateway parameters from config distribute",s,c))})}catch(r){R.error("Error update config from local cache",r.message)}})()}),this._gateway.on(Gn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Gn.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s;if(i===jt.FALLBACK)return;const c=()=>{this.safeEmit(Ot.CONNECTION_STATE_CHANGE,t,r,i)};if(ze.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:Sn.CONNECTION_STATE_CHANGE,options:[t,r,i],tag:ln.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:i})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(p=>{p._trust_in_room_=!1,p._trust_audio_enabled_state_=!1,p._trust_video_enabled_state_=!1,p._trust_audio_mute_state_=!1,p._trust_video_mute_state_=!1,p._trust_audio_stream_added_state_=!1,p._trust_video_stream_added_state_=!1,p._is_pre_created||(p._audio_pre_subscribed||(p._audioSSRC=void 0,p._audioOrtc=void 0),p._video_pre_subscribed||(p._videoSSRC=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0),p._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((p,m)=>{this._gateway.setStreamFallbackOption(m,p).catch(g=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((p,m)=>{this._gateway.setRemoteVideoStreamType(m,p).catch(g=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),W("VOS_CONFIGURE")&&Array.isArray(W("VOS_CONFIGURE"))&&W("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(W("VOS_CONFIGURE")).catch(p=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),p)}),R.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(p=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(p))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(p=>{R.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),p)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(p=>!p._trust_in_room_).forEach(p=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(p.uid)),this._handleUserOffline({uid:p.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(p=>{p._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,$e.AUDIO,!1)),p._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,$e.VIDEO,!1)),p._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(p.uid)),this._handleSetStreamLocalEnable("audio",p.uid,!0)),p._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(p.uid)),this._handleSetStreamLocalEnable("video",p.uid,!0)),p._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(p.uid)),this._handleResetAddStream(p,"video")),p._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(p.uid)),this._handleResetAddStream(p,"audio")),p._video_added_||p._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(p.uid)),this._handleRemoveStream({uid:p.uid,uint_id:p._uintid}))}))},1e3))}c()}),this._gateway.on(Gn.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new ce(H.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;if(this._fallbackServerInfo)i=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,ze.reportApiInvoke(this._sessionId,{name:Sn.VOS_FALLBACK_CN,options:{cur:i.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:ln.TRACER}).onSuccess(),R.info("[".concat(this._clientId,"] use fallback cn server info"));else{const c=await LI(qs(qs({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(i=c.ap,uG(c),this._joinInfo.preload=!0):(i=await bx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:u}=c;const[p,m]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:p,port:m}):s.push({host:p,port:m})}),t(s)}catch(i){r(i)}}),this._gateway.on(Gn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ot.NETWORK_QUALITY,t)}),this._gateway.on(Gn.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Ot.STREAM_TYPE_CHANGED,t,r),ze.reportApiInvoke(this._sessionId,{name:Sn.STREAM_TYPE_CHANGE,options:[t,r],tag:ln.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Gn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Gn.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,i)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(t)),r(s)}catch(s){i(s)}}),this._gateway.on(Gn.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let i;this._joinResponse=t,t.attributes?i=t.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const s=u8(t.ortc,r,i);this._p2pChannel.connect(s)}),this._gateway.on(Gn.PRE_CONNECT_PC,async(t,r,i)=>{const{candidates:s,fingerprint:c,turnServer:u}=t;if(this._joinInfo&&s.length>0&&!this._p2pChannel.isPlanB){const{cert:m,cid:g}=this._joinInfo.apResponse,v="".concat(g,"_").concat(m);if(v.length<4||v.length>256)return void R.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(v.length));await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var p;r(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(m),icePwd:"".concat(g,"_").concat(m)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(p=W("FINGERPRINT"))!==null&&p!==void 0?p:c}]},candidates:s,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===H.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),i(_)}}}),this._gateway.on(Gn.VOS_FALLBACK,t=>{t==="fallback_hls"&&this.safeEmit(Ot.FALLBACK_TO_HLS,tA.VOSERROR)}),this._gateway.on(Gn.RESET_SIGNAL,()=>{this._p2pChannel instanceof Yu&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Gn.DATACHANNEL_FAILBACK,()=>{ze.reportApiInvoke(this._sessionId,{name:Sn.DATACHANNEL_FAILBACK,options:{},tag:ln.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(gt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(gt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(gt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(gt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(gt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(gt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(gt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(gt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(gt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,$e.AUDIO,!0)),this._gateway.signal.on(gt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,$e.AUDIO,!1)),this._gateway.signal.on(gt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,$e.VIDEO,!0)),this._gateway.signal.on(gt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,$e.VIDEO,!1)),this._gateway.signal.on(gt.RECEIVE_METADATA,t=>{const r=Ou(t.metadata);this.safeEmit(Ot.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(gt.ON_DATA_STREAM,async t=>{var r;if(!t)return;let i=Ou(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ne(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Bp)throw new ce(H.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Bp));i=await async function(u,p,m){const g=m.subarray(0,Bp),v=g.slice(8,Bp),_=(v[0]<<8)+v[1],E=(g[6]<<8)+g[7],w=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:mV,additionalData:new Uint8Array(nV(_,2))},p,m.subarray(Bp));return new Uint8Array(w).subarray(0,E)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),p=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));s=p==null?void 0:p.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),Yve(qs(qs({},t),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(gt.ON_CRYPT_ERROR,()=>{ad(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ot.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(gt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,jt.TOKEN_EXPIRE),this.safeEmit(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(gt.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Ot.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(gt.ENABLE_MULTI_STREAM,t=>{this._dualStreamMode===jp.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(r=>{R.debug("[".concat(this._clientId,"] set dual stream mode error"),r.toString())})}),this._gateway.signal.on(gt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(gt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(gt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Ye.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Je.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,s;const u=c.some(g=>{let{stream_type:v}=g;return v===tn.Audio}),p=c.some(g=>{let{stream_type:v}=g;return v!==tn.Audio}),m=c.some(g=>{let{stream_type:v}=g;return v===tn.Screen||v===tn.ScreenLow});r.state==="offer"&&ze.publish(this._joinInfo.sid,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:H.TIMEOUT,audio:u,video:p,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(g=>{let{stream_type:v}=g;return v===tn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:p?(s=c.find(g=>{let{stream_type:v}=g;return v!==tn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Je.SUBSCRIBE:r&&ze.subscribe(this._joinInfo.sid,{succ:!1,ec:H.TIMEOUT,audio:r.stream_type===$e.AUDIO,video:r.stream_type===$e.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(gt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(gt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;W("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Gu(s.string_id||s.stream_id,this.channelName)));const r=[],i=[];for(const s of t.users){let c=this._users.find(_=>_._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new pd(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Ot.USER_JOINED,c)));const u=_r.Audio&s.stream_type,p=(_r.Video|_r.LwoVideo)&s.stream_type,m=(65280&s.stream_type)!=0,g=u&&c.hasAudio,v=p&&c.hasVideo;p&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),u&&!g&&this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Ot.USER_PUBLISHED,c,"audio")),p&&!v&&this.getListeners(Ot.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Ot.USER_PUBLISHED,c,"video")),(u&&!g||p&&!v||m)&&r.push(c),p&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Ot.PUBLISHED_USER_LIST).length>0?W("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.safeEmit(Ot.PUBLISHED_USER_LIST,r)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(gt.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;if(this._p2pChannel instanceof Yu){if(this.role==="audience"&&W("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=t,void R.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(t)));this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var s;return Ne(s=Object.keys(ku)).call(s,i)}))}}),this._gateway.signal.on(Ye.VOS_FALLBACK_PROMISE,async(t,r,i)=>{if(t==="FALLBACKCN"&&W("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return i(new ce(H.UNEXPECTED_ERROR,"can not recover, no join info"));R.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=t;const u=await bx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store);if(W("QUALITY_FALLBACK_REHEARSAL"))return ze.reportApiInvoke(this._sessionId,{name:Sn.VOS_FALLBACK_CN,options:{cur:u.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:ln.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void i();this._fallbackServerInfo=u,r()}catch(u){var s;const p=u==null||(s=u.data)===null||s===void 0?void 0:s.desc;W("QUALITY_FALLBACK_REHEARSAL")?(ze.reportApiInvoke(this._sessionId,{name:Sn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+p||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:ln.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(p)&&Ne(p).call(p,"request downgrade fallback")&&this.safeEmit(Ot.FALLBACK_TO_HLS,tA.AP_ERROR),i(u)}}else i()})}_handleP2PEvents(){this._gateway.signal.on(gt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Wn.PUBLISH,(t,r,i)=>{const{uid:s}=t;t.forEach(c=>{const{kind:u,ssrcs:p,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(u,s,p[0].ssrcId,m);const v=this._users.find(_=>_.uid===s);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,p[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(s,u,!!g)})}),this._gateway.signal.on(Wn.CALL,async(t,r,i)=>{if(this.store.useP2P)try{var s;r(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},t))}catch(c){i(c)}}),this._gateway.signal.on(Ye.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Wn.UNPUBLISH,async(t,r,i)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=t,u=this._users.find(p=>p.uid===c);if(!u)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{s.forEach(async p=>{let{stream_type:m}=p;const g=m===tn.Audio?$e.AUDIO:$e.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(c,g,!0)}),r()}catch(p){i(p)}}}),this._gateway.signal.on(Wn.CONTROL,async(t,r)=>{const{action:i}=t;switch(i){case dd.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,$e.VIDEO,!0);break;case dd.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,$e.AUDIO,!0);break;case dd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,$e.VIDEO,!1);break;case dd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,$e.AUDIO,!1)}}),this._gateway.signal.on(Wn.RESTART_ICE,async(t,r,i)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=t;s!==Ri.SEND_ONLY||c?r(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),r())}catch(s){i(s)}}),this._gateway.signal.on(Wn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:i}=t;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(Qe.RequestP2PRestartICE,async(t,r,i)=>{try{const{direction:s}=t;r(await this._gateway.sendExtensionMessage(Wn.RESTART_ICE,t,s===Ri.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(Qe.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Wn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Qe.RequestP2PMuteLocal,async(t,r,i)=>{try{await this._gateway.sendExtensionMessage(Wn.CONTROL,t,!0),r()}catch(s){i(s)}}),this._p2pChannel.on(Qe.RequestP2PUnmuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Qe.RequestP2PMuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Qe.StateChange,(t,r)=>{r===Xt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Qe.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Ot.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Qe.RequestMuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Qe.RequestUnmuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Qe.RequestRePublish,(t,r,i)=>{this.publish(t,!1).then(r).catch(i)}),this._p2pChannel.on(Qe.RequestRePublishDataChannel,(t,r,i)=>{Pe.all(t.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==H.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(Qe.RequestReSubscribe,async(t,r,i)=>{try{for(const{user:s,kind:c}of t)c===$e.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){i(s)}}),this._p2pChannel.on(Qe.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Qe.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Qe.MediaReconnectStart,t=>{this.safeEmit(Ot.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Qe.MediaReconnectEnd,t=>{this.safeEmit(Ot.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Qe.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Qe.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),i=await r.next();if(i.done)return;const s=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(p){return void r.throw(p)}const{iceParameters:u}=function(p){const m=p.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(Qe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Qe.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:s}),p=u8(c,u);await this._p2pChannel.connect(p),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Qe.RequestUnpublishForReconnectPC,async(t,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):i()}),this._p2pChannel.on(Qe.P2PLost,()=>{this.safeEmit(Ot.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Qe.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Qe.ConnectionTypeChange,t=>{this.safeEmit(Ot.IS_USING_CLOUD_PROXY,t),this._gateway.setUsingProxy(t)}),this._p2pChannel.on(Qe.FirstVideoBufferReady,(t,r)=>{this.safeEmit(Ot.FIRST_VIDEO_BUFFER_READY,t,r)}),this._p2pChannel.on(Qe.FirstVideoPreRender,(t,r)=>{this.safeEmit(Ot.FIRST_VIDEO_PRE_RENDER,t,r)}),this._p2pChannel.on(Qe.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Qe.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Qe.AudioMetadata,t=>{this.safeEmit(Ot.AUDIO_METADATA,t)}),this._p2pChannel.on(Qe.AudioPts,t=>{this.safeEmit(Ot.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:t},Io("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:s,cname:c,sid:u,token:p,uid:m,cid:g,vid:v}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:c,sid:u,token:p,uid:m,cid:g,vid:v?Number(v):0},Kn)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(t){t.on(Ar.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Ot.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===$s.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ot.CONTENT_INSPECT_ERROR,new ce(H.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Ar.INSPECT_RESULT,(r,i)=>{var s;if((i==null?void 0:i.code)===H.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Ot.CONTENT_INSPECT_RESULT,r,i)}),t.on(Ar.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Fs(t,"enabled"),t){if(!r)throw new ce(H.INVALID_PARAMS,"config is required");if(TG(r),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const s=(i={config:r},Io("ImageModeration").create(i));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:u,sid:p,token:m,uid:g,cid:v,vid:_}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:u,sid:p,token:m,uid:g,cid:v,vid:_?Number(_):0},Kn)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var i;if(!this._moderation)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(t){t.on(Ao.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Ot.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===ps.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ce(H.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Ao.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){zn(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new ce(H.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Fs(t,"enabled"),an("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_setRteInfo(t,r){this.store.rteUrl=t,this.store.rteSid=r}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},ke(Ge.prototype,"leave",[CG],Object.getOwnPropertyDescriptor(Ge.prototype,"leave"),Ge.prototype),ke(Ge.prototype,"publish",[NG],Object.getOwnPropertyDescriptor(Ge.prototype,"publish"),Ge.prototype),ke(Ge.prototype,"unpublish",[RG],Object.getOwnPropertyDescriptor(Ge.prototype,"unpublish"),Ge.prototype),ke(Ge.prototype,"subscribe",[AG],Object.getOwnPropertyDescriptor(Ge.prototype,"subscribe"),Ge.prototype),ke(Ge.prototype,"presubscribe",[IG],Object.getOwnPropertyDescriptor(Ge.prototype,"presubscribe"),Ge.prototype),ke(Ge.prototype,"massSubscribe",[OG],Object.getOwnPropertyDescriptor(Ge.prototype,"massSubscribe"),Ge.prototype),ke(Ge.prototype,"unsubscribe",[PG],Object.getOwnPropertyDescriptor(Ge.prototype,"unsubscribe"),Ge.prototype),ke(Ge.prototype,"massUnsubscribe",[DG],Object.getOwnPropertyDescriptor(Ge.prototype,"massUnsubscribe"),Ge.prototype),ke(Ge.prototype,"setLowStreamParameter",[kG],Object.getOwnPropertyDescriptor(Ge.prototype,"setLowStreamParameter"),Ge.prototype),ke(Ge.prototype,"setDualStreamMode",[jG],Object.getOwnPropertyDescriptor(Ge.prototype,"setDualStreamMode"),Ge.prototype),ke(Ge.prototype,"enableDualStream",[LG],Object.getOwnPropertyDescriptor(Ge.prototype,"enableDualStream"),Ge.prototype),ke(Ge.prototype,"disableDualStream",[MG],Object.getOwnPropertyDescriptor(Ge.prototype,"disableDualStream"),Ge.prototype),ke(Ge.prototype,"setClientRole",[UG],Object.getOwnPropertyDescriptor(Ge.prototype,"setClientRole"),Ge.prototype),ke(Ge.prototype,"_setClientRoleOptions",[FG],Object.getOwnPropertyDescriptor(Ge.prototype,"_setClientRoleOptions"),Ge.prototype),ke(Ge.prototype,"setProxyServer",[VG],Object.getOwnPropertyDescriptor(Ge.prototype,"setProxyServer"),Ge.prototype),ke(Ge.prototype,"setTurnServer",[BG],Object.getOwnPropertyDescriptor(Ge.prototype,"setTurnServer"),Ge.prototype),ke(Ge.prototype,"setLicense",[GG],Object.getOwnPropertyDescriptor(Ge.prototype,"setLicense"),Ge.prototype),ke(Ge.prototype,"startProxyServer",[WG],Object.getOwnPropertyDescriptor(Ge.prototype,"startProxyServer"),Ge.prototype),ke(Ge.prototype,"stopProxyServer",[$G],Object.getOwnPropertyDescriptor(Ge.prototype,"stopProxyServer"),Ge.prototype),ke(Ge.prototype,"setLocalAccessPointsV2",[HG],Object.getOwnPropertyDescriptor(Ge.prototype,"setLocalAccessPointsV2"),Ge.prototype),ke(Ge.prototype,"setLocalAccessPoints",[zG],Object.getOwnPropertyDescriptor(Ge.prototype,"setLocalAccessPoints"),Ge.prototype),ke(Ge.prototype,"setRemoteDefaultVideoStreamType",[KG],Object.getOwnPropertyDescriptor(Ge.prototype,"setRemoteDefaultVideoStreamType"),Ge.prototype),ke(Ge.prototype,"setRemoteVideoStreamType",[YG],Object.getOwnPropertyDescriptor(Ge.prototype,"setRemoteVideoStreamType"),Ge.prototype),ke(Ge.prototype,"setStreamFallbackOption",[qG],Object.getOwnPropertyDescriptor(Ge.prototype,"setStreamFallbackOption"),Ge.prototype),ke(Ge.prototype,"setEncryptionConfig",[XG],Object.getOwnPropertyDescriptor(Ge.prototype,"setEncryptionConfig"),Ge.prototype),ke(Ge.prototype,"renewToken",[JG],Object.getOwnPropertyDescriptor(Ge.prototype,"renewToken"),Ge.prototype),ke(Ge.prototype,"enableAudioVolumeIndicator",[QG],Object.getOwnPropertyDescriptor(Ge.prototype,"enableAudioVolumeIndicator"),Ge.prototype),ke(Ge.prototype,"startLiveStreaming",[ZG],Object.getOwnPropertyDescriptor(Ge.prototype,"startLiveStreaming"),Ge.prototype),ke(Ge.prototype,"setLiveTranscoding",[eW],Object.getOwnPropertyDescriptor(Ge.prototype,"setLiveTranscoding"),Ge.prototype),ke(Ge.prototype,"stopLiveStreaming",[tW],Object.getOwnPropertyDescriptor(Ge.prototype,"stopLiveStreaming"),Ge.prototype),ke(Ge.prototype,"startChannelMediaRelay",[nW],Object.getOwnPropertyDescriptor(Ge.prototype,"startChannelMediaRelay"),Ge.prototype),ke(Ge.prototype,"updateChannelMediaRelay",[rW],Object.getOwnPropertyDescriptor(Ge.prototype,"updateChannelMediaRelay"),Ge.prototype),ke(Ge.prototype,"stopChannelMediaRelay",[iW],Object.getOwnPropertyDescriptor(Ge.prototype,"stopChannelMediaRelay"),Ge.prototype),ke(Ge.prototype,"sendCustomReportMessage",[aW],Object.getOwnPropertyDescriptor(Ge.prototype,"sendCustomReportMessage"),Ge.prototype),ke(Ge.prototype,"pickSVCLayer",[sW],Object.getOwnPropertyDescriptor(Ge.prototype,"pickSVCLayer"),Ge.prototype),ke(Ge.prototype,"setRTMConfig",[oW],Object.getOwnPropertyDescriptor(Ge.prototype,"setRTMConfig"),Ge.prototype),ke(Ge.prototype,"enableContentInspect",[cW],Object.getOwnPropertyDescriptor(Ge.prototype,"enableContentInspect"),Ge.prototype),ke(Ge.prototype,"disableContentInspect",[lW],Object.getOwnPropertyDescriptor(Ge.prototype,"disableContentInspect"),Ge.prototype),ke(Ge.prototype,"setImageModeration",[dW],Object.getOwnPropertyDescriptor(Ge.prototype,"setImageModeration"),Ge.prototype),ke(Ge.prototype,"setP2PTransport",[uW],Object.getOwnPropertyDescriptor(Ge.prototype,"setP2PTransport"),Ge.prototype),ke(Ge.prototype,"getJoinChannelServiceRecords",[hW],Object.getOwnPropertyDescriptor(Ge.prototype,"getJoinChannelServiceRecords"),Ge.prototype),ke(Ge.prototype,"setPublishAudioFilterEnabled",[pW],Object.getOwnPropertyDescriptor(Ge.prototype,"setPublishAudioFilterEnabled"),Ge.prototype),Ge);function fW(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Zt(5,"client-"),s=ze.reportApiInvoke(null,{id:i,name:Sn.CREATE_CLIENT,options:[r],tag:ln.TRACER});try{(function(c){zn(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zn(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&zn(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Lr(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&KF(c.turnServer),c.httpRetryConfig!==void 0&&zF(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&zF(c.websocketRetryConfig)})(r)}catch(c){throw s.onError(c),c}return(DF(16,0,!0)||YR(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",R.debug("browser not support vp9, force use vp8")),an("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),s.onSuccess(),new dye(qs(qs({forceWaitGatewayResponse:!0},r),{},{role:Ne(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),i)}function uye(){let t=!1;const r=$t();return(r.name===zt.CHROME&&Number(r.version)>=58&&(So.engine.name!=="WebKit"||function(){const i=$t();if(Ab()){if(i.os===gr.MAC_OS)return!0;if(i.os===gr.IOS){const s=So.os.version&&So.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())||r.name===zt.FIREFOX&&Number(r.version)>=56||r.name===zt.OPERA&&Number(r.version)>=45||r.name===zt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ii()||Us())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||LF()||$t().name===zt.QQ)&&(t=!0),t}class _v{constructor(r,i){M(this,"id",0),M(this,"element",void 0),M(this,"peerPair",void 0),M(this,"context",void 0),M(this,"audioPlayerElement",void 0),M(this,"audioTrack",void 0),_v.count+=1,this.id=_v.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(s,c)=>{const u=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new Pe(p=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&p(s.localDescription)}})},i=async(s,c)=>await s.setRemoteDescription(c);try{const s=await r(this.peerPair[0],"offer");await i(this.peerPair[1],s);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(s){throw new ce(H.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new ce(H.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new ce(H.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=i.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var gW,Dx;M(_v,"count",0);const hye=window.AudioContext||window.webkitAudioContext,pye=new(gW=st({report:ze}),ke((Dx=class{constructor(){M(this,"units",[]),M(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new hye);let r=this.units.find(i=>i&&i.getElement()===t);return r||(r=new _v(t,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return $t().name!==zt.SAFARI}}).prototype,"processExternalMediaAEC",[gW],Object.getOwnPropertyDescriptor(Dx.prototype,"processExternalMediaAEC"),Dx.prototype),Dx);function vW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yW(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?vW(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):vW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const BI=window||document;function _W(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!BI)return;const i=tr._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const s=c=>{if(!(c&&c.blockedURI&&(tr.onSecurityPolicyViolation||tr.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;W("CSP_DETECTED_HOSTNAME_LIST").some(p=>Ne(u).call(u,p))&&(tr.onSecurityPolicyViolation&&typeof tr.onSecurityPolicyViolation=="function"&&tr.onSecurityPolicyViolation(c),tr.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0&&tr.safeEmit(mc.SECURITY_POLICY_VIOLATION,c))};i&&BI.removeEventListener("securitypolicyviolation",i),(r||t&&typeof t=="function"||tr.getListeners(mc.SECURITY_POLICY_VIOLATION).length>0)&&BI.addEventListener("securitypolicyviolation",s),tr._cspEventHandlerPointer=s}var mye=N,fye=eR,bW=RegExp.prototype,gye=function(t){return t===bW||mye(bW,t)?fye(t):t.flags},hi=d(gye);function pm(t){let r=t.length;for(;--r>=0;)t[r]=0}const GI=256,xW=286,bv=30,xv=15,WI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),kx=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vye=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),EW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),al=new Array(576);pm(al);const Ev=new Array(60);pm(Ev);const Sv=new Array(512);pm(Sv);const wv=new Array(256);pm(wv);const $I=new Array(29);pm($I);const jx=new Array(bv);function HI(t,r,i,s,c){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=t&&t.length}let SW,wW,TW;function zI(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}pm(jx);const CW=t=>t<256?Sv[t]:Sv[256+(t>>>7)],Tv=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Wa=(t,r,i)=>{t.bi_valid>16-i?(t.bi_buf|=r<<t.bi_valid&65535,Tv(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)},bc=(t,r,i)=>{Wa(t,i[2*r],i[2*r+1])},NW=(t,r)=>{let i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0);return i>>>1},RW=(t,r,i)=>{const s=new Array(16);let c,u,p=0;for(c=1;c<=xv;c++)p=p+i[c-1]<<1,s[c]=p;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=NW(s[m]++,m))}},AW=t=>{let r;for(r=0;r<xW;r++)t.dyn_ltree[2*r]=0;for(r=0;r<bv;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},IW=t=>{t.bi_valid>8?Tv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},OW=(t,r,i,s)=>{const c=2*r,u=2*i;return t[c]<t[u]||t[c]===t[u]&&s[r]<=s[i]},KI=(t,r,i)=>{const s=t.heap[i];let c=i<<1;for(;c<=t.heap_len&&(c<t.heap_len&&OW(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!OW(r,s,t.heap[c],t.depth));)t.heap[i]=t.heap[c],i=c,c<<=1;t.heap[i]=s},PW=(t,r,i)=>{let s,c,u,p,m=0;if(t.sym_next!==0)do s=255&t.pending_buf[t.sym_buf+m++],s+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],s===0?bc(t,c,r):(u=wv[c],bc(t,u+GI+1,r),p=WI[u],p!==0&&(c-=$I[u],Wa(t,c,p)),s--,u=CW(s),bc(t,u,i),p=kx[u],p!==0&&(s-=jx[u],Wa(t,s,p)));while(m<t.sym_next);bc(t,256,r)},YI=(t,r)=>{const i=r.dyn_tree,s=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let p,m,g,v=-1;for(t.heap_len=0,t.heap_max=573,p=0;p<u;p++)i[2*p]!==0?(t.heap[++t.heap_len]=v=p,t.depth[p]=0):i[2*p+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=v<2?++v:0,i[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=s[2*g+1]);for(r.max_code=v,p=t.heap_len>>1;p>=1;p--)KI(t,i,p);g=u;do p=t.heap[1],t.heap[1]=t.heap[t.heap_len--],KI(t,i,1),m=t.heap[1],t.heap[--t.heap_max]=p,t.heap[--t.heap_max]=m,i[2*g]=i[2*p]+i[2*m],t.depth[g]=(t.depth[p]>=t.depth[m]?t.depth[p]:t.depth[m])+1,i[2*p+1]=i[2*m+1]=g,t.heap[1]=g++,KI(t,i,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((_,E)=>{const w=E.dyn_tree,C=E.max_code,U=E.stat_desc.static_tree,k=E.stat_desc.has_stree,j=E.stat_desc.extra_bits,$=E.stat_desc.extra_base,K=E.stat_desc.max_length;let J,ne,ae,ee,oe,ve,Ee=0;for(ee=0;ee<=xv;ee++)_.bl_count[ee]=0;for(w[2*_.heap[_.heap_max]+1]=0,J=_.heap_max+1;J<573;J++)ne=_.heap[J],ee=w[2*w[2*ne+1]+1]+1,ee>K&&(ee=K,Ee++),w[2*ne+1]=ee,ne>C||(_.bl_count[ee]++,oe=0,ne>=$&&(oe=j[ne-$]),ve=w[2*ne],_.opt_len+=ve*(ee+oe),k&&(_.static_len+=ve*(U[2*ne+1]+oe)));if(Ee!==0){do{for(ee=K-1;_.bl_count[ee]===0;)ee--;_.bl_count[ee]--,_.bl_count[ee+1]+=2,_.bl_count[K]--,Ee-=2}while(Ee>0);for(ee=K;ee!==0;ee--)for(ne=_.bl_count[ee];ne!==0;)ae=_.heap[--J],ae>C||(w[2*ae+1]!==ee&&(_.opt_len+=(ee-w[2*ae+1])*w[2*ae],w[2*ae+1]=ee),ne--)}})(t,r),RW(i,v,t.bl_count)},DW=(t,r,i)=>{let s,c,u=-1,p=r[1],m=0,g=7,v=4;for(p===0&&(g=138,v=3),r[2*(i+1)+1]=65535,s=0;s<=i;s++)c=p,p=r[2*(s+1)+1],++m<g&&c===p||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,p===0?(g=138,v=3):c===p?(g=6,v=3):(g=7,v=4))},kW=(t,r,i)=>{let s,c,u=-1,p=r[1],m=0,g=7,v=4;for(p===0&&(g=138,v=3),s=0;s<=i;s++)if(c=p,p=r[2*(s+1)+1],!(++m<g&&c===p)){if(m<v)do bc(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(bc(t,c,t.bl_tree),m--),bc(t,16,t.bl_tree),Wa(t,m-3,2)):m<=10?(bc(t,17,t.bl_tree),Wa(t,m-3,3)):(bc(t,18,t.bl_tree),Wa(t,m-11,7));m=0,u=c,p===0?(g=138,v=3):c===p?(g=6,v=3):(g=7,v=4)}};let jW=!1;const LW=(t,r,i,s)=>{Wa(t,0+(s?1:0),3),IW(t),Tv(t,i),Tv(t,~i),i&&t.pending_buf.set(t.window.subarray(r,r+i),t.pending),t.pending+=i};var yye=t=>{jW||((()=>{let r,i,s,c,u;const p=new Array(16);for(s=0,c=0;c<28;c++)for($I[c]=s,r=0;r<1<<WI[c];r++)wv[s++]=c;for(wv[s-1]=c,u=0,c=0;c<16;c++)for(jx[c]=u,r=0;r<1<<kx[c];r++)Sv[u++]=c;for(u>>=7;c<bv;c++)for(jx[c]=u<<7,r=0;r<1<<kx[c]-7;r++)Sv[256+u++]=c;for(i=0;i<=xv;i++)p[i]=0;for(r=0;r<=143;)al[2*r+1]=8,r++,p[8]++;for(;r<=255;)al[2*r+1]=9,r++,p[9]++;for(;r<=279;)al[2*r+1]=7,r++,p[7]++;for(;r<=287;)al[2*r+1]=8,r++,p[8]++;for(RW(al,287,p),r=0;r<bv;r++)Ev[2*r+1]=5,Ev[2*r]=NW(r,5);SW=new HI(al,WI,257,xW,xv),wW=new HI(Ev,kx,0,bv,xv),TW=new HI(new Array(0),vye,0,19,7)})(),jW=!0),t.l_desc=new zI(t.dyn_ltree,SW),t.d_desc=new zI(t.dyn_dtree,wW),t.bl_desc=new zI(t.bl_tree,TW),t.bi_buf=0,t.bi_valid=0,AW(t)},_ye=(t,r,i,s)=>{let c,u,p=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<GI;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),YI(t,t.l_desc),YI(t,t.d_desc),p=(m=>{let g;for(DW(m,m.dyn_ltree,m.l_desc.max_code),DW(m,m.dyn_dtree,m.d_desc.max_code),YI(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*EW[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?LW(t,r,i,s):t.strategy===4||u===c?(Wa(t,2+(s?1:0),3),PW(t,al,Ev)):(Wa(t,4+(s?1:0),3),((m,g,v,_)=>{let E;for(Wa(m,g-257,5),Wa(m,v-1,5),Wa(m,_-4,4),E=0;E<_;E++)Wa(m,m.bl_tree[2*EW[E]+1],3);kW(m,m.dyn_ltree,g-1),kW(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,p+1),PW(t,t.dyn_ltree,t.dyn_dtree)),AW(t),s&&IW(t)},bye=(t,r,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,r===0?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*(wv[i]+GI+1)]++,t.dyn_dtree[2*CW(r)]++),t.sym_next===t.sym_end),xye=t=>{Wa(t,2,3),bc(t,256,al),(r=>{r.bi_valid===16?(Tv(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},Eye={_tr_init:yye,_tr_stored_block:LW,_tr_flush_block:_ye,_tr_tally:bye,_tr_align:xye},Cv=(t,r,i,s)=>{let c=65535&t|0,u=t>>>16&65535|0,p=0;for(;i!==0;){p=i>2e3?2e3:i,i-=p;do c=c+r[s++]|0,u=u+c|0;while(--p);c%=65521,u%=65521}return c|u<<16|0};const Sye=new Uint32Array((()=>{let t,r=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;r[i]=t}return r})());var Ai=(t,r,i,s)=>{const c=Sye,u=s+i;t^=-1;for(let p=s;p<u;p++)t=t>>>8^c[255&(t^r[p])];return-1^t},Ju={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Lx={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:wye,_tr_stored_block:qI,_tr_flush_block:Tye,_tr_tally:vd,_tr_align:Cye}=Eye,{Z_NO_FLUSH:yd,Z_PARTIAL_FLUSH:Nye,Z_FULL_FLUSH:Rye,Z_FINISH:Xs,Z_BLOCK:MW,Z_OK:Bi,Z_STREAM_END:UW,Z_STREAM_ERROR:xc,Z_DATA_ERROR:Aye,Z_BUF_ERROR:XI,Z_DEFAULT_COMPRESSION:Iye,Z_FILTERED:Oye,Z_HUFFMAN_ONLY:Mx,Z_RLE:Pye,Z_FIXED:Dye,Z_DEFAULT_STRATEGY:kye,Z_UNKNOWN:jye,Z_DEFLATED:Ux}=Lx,JI=286,Lye=30,Mye=19,Uye=2*JI+1,Fye=15,Qu=258,Ec=262,mm=42,Zu=113,Nv=666,eh=(t,r)=>(t.msg=Ju[r],r),FW=t=>2*t-(t>4?9:0),_d=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Vye=t=>{let r,i,s,c=t.w_size;r=t.hash_size,s=r;do i=t.head[--s],t.head[s]=i>=c?i-c:0;while(--r);r=c,s=r;do i=t.prev[--s],t.prev[s]=i>=c?i-c:0;while(--r)};let bd=(t,r,i)=>(r<<t.hash_shift^i)&t.hash_mask;const ms=t=>{const r=t.state;let i=r.pending;i>t.avail_out&&(i=t.avail_out),i!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),t.next_out),t.next_out+=i,r.pending_out+=i,t.total_out+=i,t.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},fs=(t,r)=>{Tye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,ms(t.strm)},Fn=(t,r)=>{t.pending_buf[t.pending++]=r},Rv=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},QI=(t,r,i,s)=>{let c=t.avail_in;return c>s&&(c=s),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),i),t.state.wrap===1?t.adler=Cv(t.adler,r,c,i):t.state.wrap===2&&(t.adler=Ai(t.adler,r,c,i)),t.next_in+=c,t.total_in+=c,c)},VW=(t,r)=>{let i,s,c=t.max_chain_length,u=t.strstart,p=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-Ec?t.strstart-(t.w_size-Ec):0,v=t.window,_=t.w_mask,E=t.prev,w=t.strstart+Qu;let C=v[u+p-1],U=v[u+p];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(i=r,v[i+p]===U&&v[i+p-1]===C&&v[i]===v[u]&&v[++i]===v[u+1]){u+=2,i++;do;while(v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&v[++u]===v[++i]&&u<w);if(s=Qu-(w-u),u=w-Qu,s>p){if(t.match_start=r,p=s,s>=m)break;C=v[u+p-1],U=v[u+p]}}while((r=E[r&_])>g&&--c!=0);return p<=t.lookahead?p:t.lookahead},fm=t=>{const r=t.w_size;let i,s,c;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Ec)&&(t.window.set(t.window.subarray(r,r+r-s),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Vye(t),s+=r),t.strm.avail_in===0)break;if(i=QI(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=bd(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=bd(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ec&&t.strm.avail_in!==0)},BW=(t,r)=>{let i,s,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,p=0,m=t.strm.avail_in;do{if(i=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==Xs||r===yd||i!==s+t.strm.avail_in)))break;p=r===Xs&&i===s+t.strm.avail_in?1:0,qI(t,0,0,p),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,ms(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&(QI(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(p===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),p?4:r!==yd&&r!==Xs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(QI(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,s=t.strstart-t.block_start,(s>=u||(s||r===Xs)&&r!==yd&&t.strm.avail_in===0&&s<=c)&&(i=s>c?c:s,p=r===Xs&&t.strm.avail_in===0&&i===s?1:0,qI(t,t.block_start,i,p),t.block_start+=i,ms(t.strm)),p?3:1)},ZI=(t,r)=>{let i,s;for(;;){if(t.lookahead<Ec){if(fm(t),t.lookahead<Ec&&r===yd)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=bd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),i!==0&&t.strstart-i<=t.w_size-Ec&&(t.match_length=VW(t,i)),t.match_length>=3)if(s=vd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=bd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=bd(t,t.ins_h,t.window[t.strstart+1]);else s=vd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(fs(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Xs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2},gm=(t,r)=>{let i,s,c;for(;;){if(t.lookahead<Ec){if(fm(t),t.lookahead<Ec&&r===yd)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=bd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,i!==0&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Ec&&(t.match_length=VW(t,i),t.match_length<=5&&(t.strategy===Oye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,s=vd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=bd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(fs(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(s=vd(t,0,t.window[t.strstart-1]),s&&fs(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=vd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Xs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2};function Sc(t,r,i,s,c){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=s,this.func=c}const Av=[new Sc(0,0,0,0,BW),new Sc(4,4,8,4,ZI),new Sc(4,5,16,8,ZI),new Sc(4,6,32,32,ZI),new Sc(4,4,16,16,gm),new Sc(8,16,32,32,gm),new Sc(8,16,128,128,gm),new Sc(8,32,128,256,gm),new Sc(32,128,258,1024,gm),new Sc(32,258,258,4096,gm)];function Bye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ux,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Uye),this.dyn_dtree=new Uint16Array(2*(2*Lye+1)),this.bl_tree=new Uint16Array(2*(2*Mye+1)),_d(this.dyn_ltree),_d(this.dyn_dtree),_d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Fye+1),this.heap=new Uint16Array(2*JI+1),_d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*JI+1),_d(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Iv=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==mm&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Zu&&r.status!==Nv?1:0},GW=t=>{if(Iv(t))return eh(t,xc);t.total_in=t.total_out=0,t.data_type=jye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?mm:Zu,t.adler=r.wrap===2?0:1,r.last_flush=-2,wye(r),Bi},WW=t=>{const r=GW(t);return r===Bi&&(i=>{i.window_size=2*i.w_size,_d(i.head),i.max_lazy_match=Av[i.level].max_lazy,i.good_match=Av[i.level].good_length,i.nice_match=Av[i.level].nice_length,i.max_chain_length=Av[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(t.state),r},$W=(t,r,i,s,c,u)=>{if(!t)return xc;let p=1;if(r===Iye&&(r=6),s<0?(p=0,s=-s):s>15&&(p=2,s-=16),c<1||c>9||i!==Ux||s<8||s>15||r<0||r>9||u<0||u>Dye||s===8&&p!==1)return eh(t,xc);s===8&&(s=9);const m=new Bye;return t.state=m,m.strm=t,m.status=mm,m.wrap=p,m.gzhead=null,m.w_bits=s,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,WW(t)};var Gye=(t,r)=>{if(Iv(t)||r>MW||r<0)return t?eh(t,xc):xc;const i=t.state;if(!t.output||t.avail_in!==0&&!t.input||i.status===Nv&&r!==Xs)return eh(t,t.avail_out===0?XI:xc);const s=i.last_flush;if(i.last_flush=r,i.pending!==0){if(ms(t),t.avail_out===0)return i.last_flush=-1,Bi}else if(t.avail_in===0&&FW(r)<=FW(s)&&r!==Xs)return eh(t,XI);if(i.status===Nv&&t.avail_in!==0)return eh(t,XI);if(i.status===mm&&i.wrap===0&&(i.status=Zu),i.status===mm){let c=Ux+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=Mx||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Rv(i,c),i.strstart!==0&&(Rv(i,t.adler>>>16),Rv(i,65535&t.adler)),t.adler=1,i.status=Zu,ms(t),i.pending!==0)return i.last_flush=-1,Bi}if(i.status===57){if(t.adler=0,Fn(i,31),Fn(i,139),Fn(i,8),i.gzhead)Fn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Fn(i,255&i.gzhead.time),Fn(i,i.gzhead.time>>8&255),Fn(i,i.gzhead.time>>16&255),Fn(i,i.gzhead.time>>24&255),Fn(i,i.level===9?2:i.strategy>=Mx||i.level<2?4:0),Fn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Fn(i,255&i.gzhead.extra.length),Fn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Ai(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Fn(i,0),Fn(i,0),Fn(i,0),Fn(i,0),Fn(i,0),Fn(i,i.level===9?2:i.strategy>=Mx||i.level<2?4:0),Fn(i,3),i.status=Zu,ms(t),i.pending!==0)return i.last_flush=-1,Bi}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,ms(t),i.pending!==0)return i.last_flush=-1,Bi;c=0,u-=m}let p=new Uint8Array(i.gzhead.extra);i.pending_buf.set(p.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),ms(t),i.pending!==0)return i.last_flush=-1,Bi;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Fn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u)),ms(t),i.pending!==0)return i.last_flush=-1,Bi;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Fn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ai(t.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ms(t),i.pending!==0))return i.last_flush=-1,Bi;Fn(i,255&t.adler),Fn(i,t.adler>>8&255),t.adler=0}if(i.status=Zu,ms(t),i.pending!==0)return i.last_flush=-1,Bi}if(t.avail_in!==0||i.lookahead!==0||r!==yd&&i.status!==Nv){let c=i.level===0?BW(i,r):i.strategy===Mx?((u,p)=>{let m;for(;;){if(u.lookahead===0&&(fm(u),u.lookahead===0)){if(p===yd)return 1;break}if(u.match_length=0,m=vd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,p===Xs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Pye?((u,p)=>{let m,g,v,_;const E=u.window;for(;;){if(u.lookahead<=Qu){if(fm(u),u.lookahead<=Qu&&p===yd)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,g=E[v],g===E[++v]&&g===E[++v]&&g===E[++v])){_=u.strstart+Qu;do;while(g===E[++v]&&g===E[++v]&&g===E[++v]&&g===E[++v]&&g===E[++v]&&g===E[++v]&&g===E[++v]&&g===E[++v]&&v<_);u.match_length=Qu-(_-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=vd(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=vd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,p===Xs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):Av[i.level].func(i,r);if(c!==3&&c!==4||(i.status=Nv),c===1||c===3)return t.avail_out===0&&(i.last_flush=-1),Bi;if(c===2&&(r===Nye?Cye(i):r!==MW&&(qI(i,0,0,!1),r===Rye&&(_d(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ms(t),t.avail_out===0))return i.last_flush=-1,Bi}return r!==Xs?Bi:i.wrap<=0?UW:(i.wrap===2?(Fn(i,255&t.adler),Fn(i,t.adler>>8&255),Fn(i,t.adler>>16&255),Fn(i,t.adler>>24&255),Fn(i,255&t.total_in),Fn(i,t.total_in>>8&255),Fn(i,t.total_in>>16&255),Fn(i,t.total_in>>24&255)):(Rv(i,t.adler>>>16),Rv(i,65535&t.adler)),ms(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Bi:UW)},Wye=(t,r)=>{let i=r.length;if(Iv(t))return xc;const s=t.state,c=s.wrap;if(c===2||c===1&&s.status!==mm||s.lookahead)return xc;if(c===1&&(t.adler=Cv(t.adler,r,i,0)),s.wrap=0,i>=s.w_size){c===0&&(_d(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(r.subarray(i-s.w_size,i),0),r=g,i=s.w_size}const u=t.avail_in,p=t.next_in,m=t.input;for(t.avail_in=i,t.next_in=0,t.input=r,fm(s);s.lookahead>=3;){let g=s.strstart,v=s.lookahead-2;do s.ins_h=bd(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--v);s.strstart=g,s.lookahead=2,fm(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=p,t.input=m,t.avail_in=u,s.wrap=c,Bi},Ov={deflateInit:(t,r)=>$W(t,r,Ux,15,8,kye),deflateInit2:$W,deflateReset:WW,deflateResetKeep:GW,deflateSetHeader:(t,r)=>Iv(t)||t.state.wrap!==2?xc:(t.state.gzhead=r,Bi),deflate:Gye,deflateEnd:t=>{if(Iv(t))return xc;const r=t.state.status;return t.state=null,r===Zu?eh(t,Aye):Bi},deflateSetDictionary:Wye,deflateInfo:"pako deflate (from Nodeca project)"};const $ye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var Fx={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const s in i)$ye(i,s)&&(t[s]=i[s])}}return t},flattenChunks:t=>{let r=0;for(let s=0,c=t.length;s<c;s++)r+=t[s].length;const i=new Uint8Array(r);for(let s=0,c=0,u=t.length;s<u;s++){let p=t[s];i.set(p,c),c+=p.length}return i}};let HW=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{HW=!1}const Pv=new Uint8Array(256);for(let t=0;t<256;t++)Pv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Pv[254]=Pv[254]=1;var Dv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,i,s,c,u,p=t.length,m=0;for(c=0;c<p;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<p&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<p&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(t,r)=>{const i=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let s,c;const u=new Array(2*i);for(c=0,s=0;s<i;){let p=t[s++];if(p<128){u[c++]=p;continue}let m=Pv[p];if(m>4)u[c++]=65533,s+=m-1;else{for(p&=m===2?31:m===3?15:7;m>1&&s<i;)p=p<<6|63&t[s++],m--;m>1?u[c++]=65533:p<65536?u[c++]=p:(p-=65536,u[c++]=55296|p>>10&1023,u[c++]=56320|1023&p)}}return((p,m)=>{if(m<65534&&p.subarray&&HW)return String.fromCharCode.apply(null,p.length===m?p:p.subarray(0,m));let g="";for(let v=0;v<m;v++)g+=String.fromCharCode(p[v]);return g})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let i=r-1;for(;i>=0&&(192&t[i])==128;)i--;return i<0||i===0?r:i+Pv[t[i]]>r?i:r}},zW=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const KW=Object.prototype.toString,{Z_NO_FLUSH:Hye,Z_SYNC_FLUSH:zye,Z_FULL_FLUSH:Kye,Z_FINISH:Yye,Z_OK:Vx,Z_STREAM_END:qye,Z_DEFAULT_COMPRESSION:Xye,Z_DEFAULT_STRATEGY:Jye,Z_DEFLATED:Qye}=Lx;function Bx(t){this.options=Fx.assign({level:Xye,method:Qye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zW,this.strm.avail_out=0;let i=Ov.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==Vx)throw new Error(Ju[i]);if(r.header&&Ov.deflateSetHeader(this.strm,r.header),r.dictionary){let s;if(s=typeof r.dictionary=="string"?Dv.string2buf(r.dictionary):KW.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=Ov.deflateSetDictionary(this.strm,s),i!==Vx)throw new Error(Ju[i]);this._dict_set=!0}}function YW(t,r){const i=new Bx(r);if(i.push(t,!0),i.err)throw i.msg||Ju[i.err];return i.result}Bx.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Yye:Hye,typeof t=="string"?i.input=Dv.string2buf(t):KW.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(u===zye||u===Kye)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=Ov.deflate(i,u),c===qye)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=Ov.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===Vx;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},Bx.prototype.onData=function(t){this.chunks.push(t)},Bx.prototype.onEnd=function(t){t===Vx&&(this.result=Fx.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Zye={deflate:YW,deflateRaw:function(t,r){return(r=r||{}).raw=!0,YW(t,r)}};const Gx=16209;var e0e=function(t,r){let i,s,c,u,p,m,g,v,_,E,w,C,U,k,j,$,K,J,ne,ae,ee,oe,ve,Ee;const Be=t.state;i=t.next_in,ve=t.input,s=i+(t.avail_in-5),c=t.next_out,Ee=t.output,u=c-(r-t.avail_out),p=c+(t.avail_out-257),m=Be.dmax,g=Be.wsize,v=Be.whave,_=Be.wnext,E=Be.window,w=Be.hold,C=Be.bits,U=Be.lencode,k=Be.distcode,j=(1<<Be.lenbits)-1,$=(1<<Be.distbits)-1;e:do{C<15&&(w+=ve[i++]<<C,C+=8,w+=ve[i++]<<C,C+=8),K=U[w&j];t:for(;;){if(J=K>>>24,w>>>=J,C-=J,J=K>>>16&255,J===0)Ee[c++]=65535&K;else{if(!(16&J)){if(!(64&J)){K=U[(65535&K)+(w&(1<<J)-1)];continue t}if(32&J){Be.mode=16191;break e}t.msg="invalid literal/length code",Be.mode=Gx;break e}ne=65535&K,J&=15,J&&(C<J&&(w+=ve[i++]<<C,C+=8),ne+=w&(1<<J)-1,w>>>=J,C-=J),C<15&&(w+=ve[i++]<<C,C+=8,w+=ve[i++]<<C,C+=8),K=k[w&$];n:for(;;){if(J=K>>>24,w>>>=J,C-=J,J=K>>>16&255,!(16&J)){if(!(64&J)){K=k[(65535&K)+(w&(1<<J)-1)];continue n}t.msg="invalid distance code",Be.mode=Gx;break e}if(ae=65535&K,J&=15,C<J&&(w+=ve[i++]<<C,C+=8,C<J&&(w+=ve[i++]<<C,C+=8)),ae+=w&(1<<J)-1,ae>m){t.msg="invalid distance too far back",Be.mode=Gx;break e}if(w>>>=J,C-=J,J=c-u,ae>J){if(J=ae-J,J>v&&Be.sane){t.msg="invalid distance too far back",Be.mode=Gx;break e}if(ee=0,oe=E,_===0){if(ee+=g-J,J<ne){ne-=J;do Ee[c++]=E[ee++];while(--J);ee=c-ae,oe=Ee}}else if(_<J){if(ee+=g+_-J,J-=_,J<ne){ne-=J;do Ee[c++]=E[ee++];while(--J);if(ee=0,_<ne){J=_,ne-=J;do Ee[c++]=E[ee++];while(--J);ee=c-ae,oe=Ee}}}else if(ee+=_-J,J<ne){ne-=J;do Ee[c++]=E[ee++];while(--J);ee=c-ae,oe=Ee}for(;ne>2;)Ee[c++]=oe[ee++],Ee[c++]=oe[ee++],Ee[c++]=oe[ee++],ne-=3;ne&&(Ee[c++]=oe[ee++],ne>1&&(Ee[c++]=oe[ee++]))}else{ee=c-ae;do Ee[c++]=Ee[ee++],Ee[c++]=Ee[ee++],Ee[c++]=Ee[ee++],ne-=3;while(ne>2);ne&&(Ee[c++]=Ee[ee++],ne>1&&(Ee[c++]=Ee[ee++]))}break}}break}}while(i<s&&c<p);ne=C>>3,i-=ne,C-=ne<<3,w&=(1<<C)-1,t.next_in=i,t.next_out=c,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=c<p?p-c+257:257-(c-p),Be.hold=w,Be.bits=C};const Wx=15,t0e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n0e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r0e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i0e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var kv=(t,r,i,s,c,u,p,m)=>{const g=m.bits;let v,_,E,w,C,U,k=0,j=0,$=0,K=0,J=0,ne=0,ae=0,ee=0,oe=0,ve=0,Ee=null;const Be=new Uint16Array(16),mt=new Uint16Array(16);let ct,Tt,Et,Yt=null;for(k=0;k<=Wx;k++)Be[k]=0;for(j=0;j<s;j++)Be[r[i+j]]++;for(J=g,K=Wx;K>=1&&Be[K]===0;K--);if(J>K&&(J=K),K===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for($=1;$<K&&Be[$]===0;$++);for(J<$&&(J=$),ee=1,k=1;k<=Wx;k++)if(ee<<=1,ee-=Be[k],ee<0)return-1;if(ee>0&&(t===0||K!==1))return-1;for(mt[1]=0,k=1;k<Wx;k++)mt[k+1]=mt[k]+Be[k];for(j=0;j<s;j++)r[i+j]!==0&&(p[mt[r[i+j]]++]=j);if(t===0?(Ee=Yt=p,U=20):t===1?(Ee=t0e,Yt=n0e,U=257):(Ee=r0e,Yt=i0e,U=0),ve=0,j=0,k=$,C=u,ne=J,ae=0,E=-1,oe=1<<J,w=oe-1,t===1&&oe>852||t===2&&oe>592)return 1;for(;;){ct=k-ae,p[j]+1<U?(Tt=0,Et=p[j]):p[j]>=U?(Tt=Yt[p[j]-U],Et=Ee[p[j]-U]):(Tt=96,Et=0),v=1<<k-ae,_=1<<ne,$=_;do _-=v,c[C+(ve>>ae)+_]=ct<<24|Tt<<16|Et|0;while(_!==0);for(v=1<<k-1;ve&v;)v>>=1;if(v!==0?(ve&=v-1,ve+=v):ve=0,j++,--Be[k]==0){if(k===K)break;k=r[i+p[j]]}if(k>J&&(ve&w)!==E){for(ae===0&&(ae=J),C+=$,ne=k-ae,ee=1<<ne;ne+ae<K&&(ee-=Be[ne+ae],!(ee<=0));)ne++,ee<<=1;if(oe+=1<<ne,t===1&&oe>852||t===2&&oe>592)return 1;E=ve&w,c[E]=J<<24|ne<<16|C-u|0}}return ve!==0&&(c[C+ve]=k-ae<<24|64<<16|0),m.bits=J,0};const{Z_FINISH:qW,Z_BLOCK:a0e,Z_TREES:$x,Z_OK:th,Z_STREAM_END:s0e,Z_NEED_DICT:o0e,Z_STREAM_ERROR:Js,Z_DATA_ERROR:XW,Z_MEM_ERROR:JW,Z_BUF_ERROR:c0e,Z_DEFLATED:QW}=Lx,Hx=16180,zx=16190,sl=16191,eO=16192,tO=16194,Kx=16199,Yx=16200,nO=16206,Or=16209,ZW=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function l0e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const nh=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<Hx||r.mode>16211?1:0},e$=t=>{if(nh(t))return Js;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=Hx,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,th},t$=t=>{if(nh(t))return Js;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,e$(t)},n$=(t,r)=>{let i;if(nh(t))return Js;const s=t.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Js:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=i,s.wbits=r,t$(t))},r$=(t,r)=>{if(!t)return Js;const i=new l0e;t.state=i,i.strm=t,i.window=null,i.mode=Hx;const s=n$(t,r);return s!==th&&(t.state=null),s};let rO,iO,i$=!0;const d0e=t=>{if(i$){rO=new Int32Array(512),iO=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(kv(1,t.lens,0,288,rO,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;kv(2,t.lens,0,32,iO,0,t.work,{bits:5}),i$=!1}t.lencode=rO,t.lenbits=9,t.distcode=iO,t.distbits=5},a$=(t,r,i,s)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>s&&(c=s),u.window.set(r.subarray(i-s,i-s+c),u.wnext),(s-=c)?(u.window.set(r.subarray(i-s,i),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var u0e=(t,r)=>{let i,s,c,u,p,m,g,v,_,E,w,C,U,k,j,$,K,J,ne,ae,ee,oe,ve=0;const Ee=new Uint8Array(4);let Be,mt;const ct=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(nh(t)||!t.output||!t.input&&t.avail_in!==0)return Js;i=t.state,i.mode===sl&&(i.mode=eO),p=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,m=t.avail_in,v=i.hold,_=i.bits,E=m,w=g,oe=th;e:for(;;)switch(i.mode){case Hx:if(i.wrap===0){i.mode=eO;break}for(;_<16;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(2&i.wrap&&v===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0),v=0,_=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",i.mode=Or;break}if((15&v)!==QW){t.msg="unknown compression method",i.mode=Or;break}if(v>>>=4,_-=4,ee=8+(15&v),i.wbits===0&&(i.wbits=ee),ee>15||ee>i.wbits){t.msg="invalid window size",i.mode=Or;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&v?16189:sl,v=0,_=0;break;case 16181:for(;_<16;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(i.flags=v,(255&hi(i))!==QW){t.msg="unknown compression method",i.mode=Or;break}if(57344&hi(i)){t.msg="unknown header flags set",i.mode=Or;break}i.head&&(i.head.text=v>>8&1),512&hi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0,i.mode=16182;case 16182:for(;_<32;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.head&&(i.head.time=v),512&hi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,Ee[2]=v>>>16&255,Ee[3]=v>>>24&255,i.check=Ai(i.check,Ee,4,0)),v=0,_=0,i.mode=16183;case 16183:for(;_<16;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.head&&(i.head.xflags=255&v,i.head.os=v>>8),512&hi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0,i.mode=16184;case 16184:if(1024&hi(i)){for(;_<16;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.length=v,i.head&&(i.head.extra_len=v),512&hi(i)&&4&i.wrap&&(Ee[0]=255&v,Ee[1]=v>>>8&255,i.check=Ai(i.check,Ee,2,0)),v=0,_=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&hi(i)&&(C=i.length,C>m&&(C=m),C&&(i.head&&(ee=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(u,u+C),ee)),512&hi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),m-=C,u+=C,i.length-=C),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&hi(i)){if(m===0)break e;C=0;do ee=s[u+C++],i.head&&ee&&i.length<65536&&(i.head.name+=String.fromCharCode(ee));while(ee&&C<m);if(512&hi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),m-=C,u+=C,ee)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&hi(i)){if(m===0)break e;C=0;do ee=s[u+C++],i.head&&ee&&i.length<65536&&(i.head.comment+=String.fromCharCode(ee));while(ee&&C<m);if(512&hi(i)&&4&i.wrap&&(i.check=Ai(i.check,s,C,u)),m-=C,u+=C,ee)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&hi(i)){for(;_<16;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(4&i.wrap&&v!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Or;break}v=0,_=0}i.head&&(i.head.hcrc=hi(i)>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=sl;break;case 16189:for(;_<32;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}t.adler=i.check=ZW(v),v=0,_=0,i.mode=zx;case zx:if(i.havedict===0)return t.next_out=p,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=v,i.bits=_,o0e;t.adler=i.check=1,i.mode=sl;case sl:if(r===a0e||r===$x)break e;case eO:if(i.last){v>>>=7&_,_-=7&_,i.mode=nO;break}for(;_<3;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}switch(i.last=1&v,v>>>=1,_-=1,3&v){case 0:i.mode=16193;break;case 1:if(d0e(i),i.mode=Kx,r===$x){v>>>=2,_-=2;break e}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Or}v>>>=2,_-=2;break;case 16193:for(v>>>=7&_,_-=7&_;_<32;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Or;break}if(i.length=65535&v,v=0,_=0,i.mode=tO,r===$x)break e;case tO:i.mode=16195;case 16195:if(C=i.length,C){if(C>m&&(C=m),C>g&&(C=g),C===0)break e;c.set(s.subarray(u,u+C),p),m-=C,u+=C,g-=C,p+=C,i.length-=C;break}i.mode=sl;break;case 16196:for(;_<14;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(i.nlen=257+(31&v),v>>>=5,_-=5,i.ndist=1+(31&v),v>>>=5,_-=5,i.ncode=4+(15&v),v>>>=4,_-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Or;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_<3;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.lens[ct[i.have++]]=7&v,v>>>=3,_-=3}for(;i.have<19;)i.lens[ct[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Be={bits:i.lenbits},oe=kv(0,i.lens,0,19,i.lencode,0,i.work,Be),i.lenbits=Be.bits,oe){t.msg="invalid code lengths set",i.mode=Or;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ve=i.lencode[v&(1<<i.lenbits)-1],j=ve>>>24,$=ve>>>16&255,K=65535&ve,!(j<=_);){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(K<16)v>>>=j,_-=j,i.lens[i.have++]=K;else{if(K===16){for(mt=j+2;_<mt;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(v>>>=j,_-=j,i.have===0){t.msg="invalid bit length repeat",i.mode=Or;break}ee=i.lens[i.have-1],C=3+(3&v),v>>>=2,_-=2}else if(K===17){for(mt=j+3;_<mt;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}v>>>=j,_-=j,ee=0,C=3+(7&v),v>>>=3,_-=3}else{for(mt=j+7;_<mt;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}v>>>=j,_-=j,ee=0,C=11+(127&v),v>>>=7,_-=7}if(i.have+C>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Or;break}for(;C--;)i.lens[i.have++]=ee}}if(i.mode===Or)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=Or;break}if(i.lenbits=9,Be={bits:i.lenbits},oe=kv(1,i.lens,0,i.nlen,i.lencode,0,i.work,Be),i.lenbits=Be.bits,oe){t.msg="invalid literal/lengths set",i.mode=Or;break}if(i.distbits=6,i.distcode=i.distdyn,Be={bits:i.distbits},oe=kv(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Be),i.distbits=Be.bits,oe){t.msg="invalid distances set",i.mode=Or;break}if(i.mode=Kx,r===$x)break e;case Kx:i.mode=Yx;case Yx:if(m>=6&&g>=258){t.next_out=p,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=v,i.bits=_,e0e(t,w),p=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,m=t.avail_in,v=i.hold,_=i.bits,i.mode===sl&&(i.back=-1);break}for(i.back=0;ve=i.lencode[v&(1<<i.lenbits)-1],j=ve>>>24,$=ve>>>16&255,K=65535&ve,!(j<=_);){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if($&&!(240&$)){for(J=j,ne=$,ae=K;ve=i.lencode[ae+((v&(1<<J+ne)-1)>>J)],j=ve>>>24,$=ve>>>16&255,K=65535&ve,!(J+j<=_);){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}v>>>=J,_-=J,i.back+=J}if(v>>>=j,_-=j,i.back+=j,i.length=K,$===0){i.mode=16205;break}if(32&$){i.back=-1,i.mode=sl;break}if(64&$){t.msg="invalid literal/length code",i.mode=Or;break}i.extra=15&$,i.mode=16201;case 16201:if(i.extra){for(mt=i.extra;_<mt;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.length+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ve=i.distcode[v&(1<<i.distbits)-1],j=ve>>>24,$=ve>>>16&255,K=65535&ve,!(j<=_);){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(!(240&$)){for(J=j,ne=$,ae=K;ve=i.distcode[ae+((v&(1<<J+ne)-1)>>J)],j=ve>>>24,$=ve>>>16&255,K=65535&ve,!(J+j<=_);){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}v>>>=J,_-=J,i.back+=J}if(v>>>=j,_-=j,i.back+=j,64&$){t.msg="invalid distance code",i.mode=Or;break}i.offset=K,i.extra=15&$,i.mode=16203;case 16203:if(i.extra){for(mt=i.extra;_<mt;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}i.offset+=v&(1<<i.extra)-1,v>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Or;break}i.mode=16204;case 16204:if(g===0)break e;if(C=w-g,i.offset>C){if(C=i.offset-C,C>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Or;break}C>i.wnext?(C-=i.wnext,U=i.wsize-C):U=i.wnext-C,C>i.length&&(C=i.length),k=i.window}else k=c,U=p-i.offset,C=i.length;C>g&&(C=g),g-=C,i.length-=C;do c[p++]=k[U++];while(--C);i.length===0&&(i.mode=Yx);break;case 16205:if(g===0)break e;c[p++]=i.length,g--,i.mode=Yx;break;case nO:if(i.wrap){for(;_<32;){if(m===0)break e;m--,v|=s[u++]<<_,_+=8}if(w-=g,t.total_out+=w,i.total+=w,4&i.wrap&&w&&(t.adler=i.check=hi(i)?Ai(i.check,c,w,p-w):Cv(i.check,c,w,p-w)),w=g,4&i.wrap&&(hi(i)?v:ZW(v))!==i.check){t.msg="incorrect data check",i.mode=Or;break}v=0,_=0}i.mode=16207;case 16207:if(i.wrap&&hi(i)){for(;_<32;){if(m===0)break e;m--,v+=s[u++]<<_,_+=8}if(4&i.wrap&&v!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Or;break}v=0,_=0}i.mode=16208;case 16208:oe=s0e;break e;case Or:oe=XW;break e;case 16210:return JW;default:return Js}return t.next_out=p,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=v,i.bits=_,(i.wsize||w!==t.avail_out&&i.mode<Or&&(i.mode<nO||r!==qW))&&a$(t,t.output,t.next_out,w-t.avail_out),E-=t.avail_in,w-=t.avail_out,t.total_in+=E,t.total_out+=w,i.total+=w,4&i.wrap&&w&&(t.adler=i.check=hi(i)?Ai(i.check,c,w,t.next_out-w):Cv(i.check,c,w,t.next_out-w)),t.data_type=i.bits+(i.last?64:0)+(i.mode===sl?128:0)+(i.mode===Kx||i.mode===tO?256:0),(E===0&&w===0||r===qW)&&oe===th&&(oe=c0e),oe},ol={inflateReset:t$,inflateReset2:n$,inflateResetKeep:e$,inflateInit:t=>r$(t,15),inflateInit2:r$,inflate:u0e,inflateEnd:t=>{if(nh(t))return Js;let r=t.state;return r.window&&(r.window=null),t.state=null,th},inflateGetHeader:(t,r)=>{if(nh(t))return Js;const i=t.state;return 2&i.wrap?(i.head=r,r.done=!1,th):Js},inflateSetDictionary:(t,r)=>{const i=r.length;let s,c,u;return nh(t)?Js:(s=t.state,s.wrap!==0&&s.mode!==zx?Js:s.mode===zx&&(c=1,c=Cv(c,r,i,0),c!==s.check)?XW:(u=a$(t,r,i,i),u?(s.mode=16210,JW):(s.havedict=1,th)))},inflateInfo:"pako inflate (from Nodeca project)"},h0e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const s$=Object.prototype.toString,{Z_NO_FLUSH:p0e,Z_FINISH:m0e,Z_OK:jv,Z_STREAM_END:aO,Z_NEED_DICT:sO,Z_STREAM_ERROR:f0e,Z_DATA_ERROR:o$,Z_MEM_ERROR:g0e}=Lx;function qx(t){this.options=Fx.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zW,this.strm.avail_out=0;let i=ol.inflateInit2(this.strm,r.windowBits);if(i!==jv)throw new Error(Ju[i]);if(this.header=new h0e,ol.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Dv.string2buf(r.dictionary):s$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=ol.inflateSetDictionary(this.strm,r.dictionary),i!==jv)))throw new Error(Ju[i])}function c$(t,r){const i=new qx(r);if(i.push(t),i.err)throw i.msg||Ju[i.err];return i.result}qx.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let u,p,m;if(this.ended)return!1;for(p=r===~~r?r:r===!0?m0e:p0e,s$.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),u=ol.inflate(i,p),u===sO&&c&&(u=ol.inflateSetDictionary(i,c),u===jv?u=ol.inflate(i,p):u===o$&&(u=sO));i.avail_in>0&&u===aO&&i.state.wrap>0&&t[i.next_in]!==0;)ol.inflateReset(i),u=ol.inflate(i,p);switch(u){case f0e:case o$:case sO:case g0e:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===aO))if(this.options.to==="string"){let g=Dv.utf8border(i.output,i.next_out),v=i.next_out-g,_=Dv.buf2string(i.output,g);i.next_out=v,i.avail_out=s-v,v&&i.output.set(i.output.subarray(g,g+v),0),this.onData(_)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==jv||m!==0){if(u===aO)return u=ol.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},qx.prototype.onData=function(t){this.chunks.push(t)},qx.prototype.onEnd=function(t){t===jv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Fx.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var v0e={inflate:c$,inflateRaw:function(t,r){return(r=r||{}).raw=!0,c$(t,r)}};const{deflate:y0e,deflateRaw:_0e}=Zye,{inflate:b0e,inflateRaw:x0e}=v0e;var E0e=y0e,S0e=_0e,w0e=b0e,T0e=x0e,l$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(l$||{});class C0e{constructor(){M(this,"_sequence",0),M(this,"_startTime",Date.now()),M(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};i.commonPacketHeader.extension=1,i.extension=v,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;W("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),u=new DataView(s);let p=0;if(u.setUint16(p,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),p+=2,u.setUint32(p,i.commonPacketHeader.sequence,!0),p+=4,u.setUint16(p,i.commonStreamHeader,!0),p+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),p),p+=m.byteLength}if(c.set(new Uint8Array(i.payload),p),p+=i.payload.byteLength,p!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let s=0;const c=i.getUint16(s,!0);s+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(s+2,!0)<<16|i.getUint16(s,!0)};let p,m;if(s+=4,W("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(s,!0),s+=2,u.extension){m=this.deserializeExtension(r.slice(s)),s+=2+m.length,p=r.slice(s);let g=!1;if(m.datas.length>0){const v=m.datas.find(_=>_.id===0);v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}p=g?this.decompress(p):p}else p=r.slice(8);return p}serializeExtension(r){const{profile:i,length:s,datas:c}=r,u=new ArrayBuffer(s+2),p=new Uint8Array(u),m=new DataView(u);let g=0;if(m.setUint8(g++,i),m.setUint8(g++,s),c.forEach(v=>{i?(m.setUint8(g++,v.id),m.setUint8(g++,v.length),p.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(m.setUint8(g++,v.id|v.length<<4),p.set(new Uint8Array(v.data),g),g+=v.data.byteLength)}),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return u}deserializeExtension(r){const i=new DataView(r);let s=0;const c=i.getUint8(s);s++;const u=i.getUint8(s);s++;const p=c===l$.TWO_BYTE,m=[],g=new DataView(r,2);let v=0;for(;v<u;){let _=0,E=0,w=new ArrayBuffer(0);p?(_=g.getUint8(v),v++,E=g.getUint8(v),v++):(_=15&g.getUint8(v),E=g.getUint8(v)>>4,v++),E>0&&(w=g.buffer.slice(v+2,v+2+E),v+=w.byteLength),m.push({id:_,length:E,data:w})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return w0e(new Uint8Array(r))}compress(r){return E0e(new Uint8Array(r))}}const N0e={name:"DataStream",create:(t,r)=>{const i=r?new Oge(t):new Pge(t);return i.useDataStream(new C0e),i}};class R0e extends Nn{constructor(r,i,s){super(),M(this,"ws",void 0),M(this,"requestId",1),M(this,"heartBeatTimer",void 0),M(this,"joinInfo",void 0),M(this,"clientId",void 0),M(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),M(this,"onClose",c=>{this.emit("close"),this.dispose()}),M(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new av("cross-channel-".concat(this.clientId),s),this.ws.on(St.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(St.CONNECTED,this.onOpen),this.ws.on(St.ON_MESSAGE,this.onMessage),this.ws.on(St.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new Pe((i,s)=>{const c=window.setTimeout(()=>{s(new ce(H.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?s(new ce(H.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new ce(H.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new ce(H.WS_DISCONNECT);const i=()=>new Pe((p,m)=>{this.ws.once(St.CLOSED,()=>m(new ce(H.WS_ABORT))),this.ws.once(St.CONNECTED,p)});this.ws.state!=="connected"&&await i();const s=this.sendMessage(r),c=new Pe((p,m)=>{const g=()=>{m(new ce(H.WS_ABORT))};this.ws.once(St.RECONNECTING,g),this.ws.once(St.CLOSED,g),this.once("req_".concat(s),p),vr(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(St.RECONNECTING,g),this.ws.off(St.CLOSED,g),m(new ce(H.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new ce(H.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(St.REQUEST_NEW_URLS),this.ws.on(St.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class A0e extends Nn{set state(r){r!==this._state&&(r!==Ji.RELAY_STATE_FAILURE&&(this.errorCode=Zp.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,s,c,u){super(),M(this,"joinInfo",void 0),M(this,"sid",void 0),M(this,"clientId",void 0),M(this,"cancelToken",ji.CancelToken.source()),M(this,"workerToken",void 0),M(this,"requestId",0),M(this,"signal",void 0),M(this,"prevChannelMediaConfig",void 0),M(this,"httpRetryConfig",void 0),M(this,"_resolution",void 0),M(this,"_state",Ji.RELAY_STATE_IDLE),M(this,"errorCode",Zp.RELAY_OK),M(this,"onStatus",p=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&(p.command==="onAudioPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_AUDIO_FROM_SRC),p.command==="onVideoPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_VIDEO_FROM_SRC),p.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Zp.SRC_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE),p.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Zp.DEST_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE))}),M(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",nl.NETWORK_DISCONNECTED),this.state=Ji.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(p=>{this.state!==Ji.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",p.toString()),this.errorCode=Zp.SERVER_CONNECTION_LOST,this.state=Ji.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=Pu(),this.signal=new R0e(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ji.RELAY_STATE_IDLE)throw new ce(H.INVALID_OPERATION);this.state=Ji.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new ce(H.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new ce(H.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new ce(H.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ji.RELAY_STATE_RUNNING)throw new ce(H.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ji.RELAY_STATE_RUNNING)throw new ce(H.INVALID_OPERATION);const i=this.genMessage(Ui.SetVideoProfile);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ji.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ji.CancelToken.source(),this.state=Ji.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Lve(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",nl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Ui.SetSdkProfile,r);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Ui.SetSourceChannel,r);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",nl.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Ui.SetSourceUserId,r);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const u=this.genMessage(Ui.SetDestChannel,r);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",nl.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(Ui.StartPacketTransfer,r);await this.signal.request(p),this.emit("event",nl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ji.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Ui.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",nl.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Ui.StopPacketTransfer);await this.signal.request(r),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const s=[],c=[],u=[];this.requestId+=1;const p={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:cs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};p.sdkVersion==="4.24.2"&&(p.sdkVersion="0.0.1");let m=null,g=null;switch(r){case Ui.SetSdkProfile:return p.clientRequest={command:"SetSdkProfile",type:"multi_channel"},p;case Ui.SetSourceChannel:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce(H.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},p;case Ui.SetSourceUserId:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce(H.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceUserId",uid:g.uid+""},p;case Ui.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new ce(H.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),p.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:u},p;case Ui.StartPacketTransfer:return p.clientRequest={command:"StartPacketTransfer"},p;case Ui.Reconnect:return p.clientRequest={command:"Reconnect"},p;case Ui.StopPacketTransfer:return p.clientRequest={command:"StopPacketTransfer"},p;case Ui.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new ce(H.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{s.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),p.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:u},p;case Ui.SetVideoProfile:p.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return p}}const I0e={name:"ChannelMediaRelay",create:function(t){return new A0e(t.joinInfo,t.clientId,t.websocketRetryConfig||Kn,t.httpRetryConfig||Kn,t.resolution)}};function d$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Lv(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?d$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class O0e extends Nn{constructor(r,i,s,c){super(),M(this,"spec",void 0),M(this,"token",void 0),M(this,"websocket",void 0),M(this,"pingpongTimer",void 0),M(this,"reconnectMode","retry"),M(this,"serviceMode",void 0),M(this,"reqId",0),M(this,"commandReqId",0),M(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),M(this,"handleWebSocketMessage",u=>{if(!u.data)return;const p=JSON.parse(u.data);p.requestId?this.emit("@".concat(p.requestId,"-").concat(p.sid),p):(ze.workerEvent(this.spec.sid,{actionType:"status",serverCode:p.code,workerType:this.serviceMode===tl.TRANSCODE?1:2}),this.emit(cd.PUBLISH_STREAM_STATUS,p))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new av("live-streaming",s),this.websocket.on(St.CONNECTED,this.handleWebSocketOpen),this.websocket.on(St.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(St.REQUEST_NEW_URLS,(u,p)=>{er(this,cd.REQUEST_NEW_ADDRESS).then(u).catch(p)}),this.websocket.on(St.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,s,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,p=this.reqId;if(!p||!this.websocket)throw new ce(H.UNEXPECTED_ERROR);const m=Lv({command:r,sdkVersion:cs==="4.24.2"?"0.0.1":cs,seq:p,requestId:p,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new ce(H.WS_DISCONNECT);const g=()=>new Pe((w,C)=>{this.websocket.once(St.CLOSED,()=>C(new ce(H.WS_ABORT))),this.websocket.once(St.CONNECTED,w)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new Pe((w,C)=>{const U=()=>{C(new ce(H.WS_ABORT))};this.websocket.once(St.RECONNECTING,U),this.websocket.once(St.CLOSED,U),this.once("@".concat(p,"-").concat(this.spec.sid),k=>{w(k)})});c&&ze.workerEvent(this.spec.sid,Lv(Lv({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(m);let E=null;try{E=await v}catch(w){if(this.websocket.state==="closed")throw w;return await g(),await this.request(r,i,s)}return c&&ze.workerEvent(this.spec.sid,Lv(Lv({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-_})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=cs==="4.24.2"?"0.0.1":cs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case cr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case cr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case cr.LIVE_STREAM_RESPONSE_BAD_STREAM:case cr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ce(H.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ce(H.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new ce(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(cd.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new ce(H.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(cd.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ce(H.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new ce(H.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(cd.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ce(H.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Jg)},6e3)}}function u$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Zi(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?u$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class P0e extends Nn{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kn;super(),M(this,"onLiveStreamWarning",void 0),M(this,"onLiveStreamError",void 0),M(this,"spec",void 0),M(this,"retryTimeout",1e4),M(this,"connection",void 0),M(this,"httpRetryConfig",void 0),M(this,"wsRetryConfig",void 0),M(this,"streamingTasks",new Map),M(this,"isStartingStreamingTask",!1),M(this,"taskMutex",new Nr("live-streaming")),M(this,"cancelToken",ji.CancelToken.source()),M(this,"transcodingConfig",void 0),M(this,"uapResponse",void 0),M(this,"lastTaskId",1),M(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Zi(Zi({},fve),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(p=>Zi(Zi(Zi({},mve),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),function(p){On(p.width)||cn(p.width,"config.width",0,1e4),On(p.height)||cn(p.height,"config.height",0,1e4),On(p.videoBitrate)||cn(p.videoBitrate,"config.videoBitrate",1,1e6),On(p.videoFrameRate)||cn(p.videoFrameRate,"config.videoFrameRate"),On(p.lowLatency)||Fs(p.lowLatency,"config.lowLatency"),On(p.audioSampleRate)||zn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),On(p.audioBitrate)||cn(p.audioBitrate,"config.audioBitrate",1,128),On(p.audioChannels)||zn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),On(p.videoGop)||cn(p.videoGop,"config.videoGop"),On(p.videoCodecProfile)||zn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),On(p.userCount)||cn(p.userCount,"config.userCount",0,17),On(p.backgroundColor)||cn(p.backgroundColor,"config.backgroundColor",0,16777215),On(p.userConfigExtraInfo)||Lr(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!On(p.transcodingUsers)&&(Zc(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,g)=>{ax(m.uid),On(m.x)||cn(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),On(m.y)||cn(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),On(m.width)||cn(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),On(m.height)||cn(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),On(m.zOrder)||cn(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),On(m.alpha)||cn(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),On(p.watermark)||XA(p.watermark,"watermark"),On(p.backgroundImage)||XA(p.backgroundImage,"backgroundImage"),p.images&&!On(p.images)&&(Zc(p.images,"config.images"),p.images.forEach((m,g)=>{XA(m,"images[".concat(g,"]"))}))}(i);const s=[];i.images&&s.push(...i.images.map(p=>Zi(Zi(Zi({},qA),p),{},{zOrder:255}))),i.backgroundImage&&(s.push(Zi(Zi(Zi({},qA),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(s.push(Zi(Zi(Zi({},qA),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=s,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(p=>Zi({},p)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(p=>typeof p.uid=="number"?Pe.resolve(p.uid):O8(p.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Pe.all(c)).forEach((p,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=p)}),this.transcodingConfig=i,this.connection)try{var u;const p=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(va(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,p).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(r,i,s){if(!this.transcodingConfig&&i===tl.TRANSCODE)throw new ce(H.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(r)&&!s)return u(),new ce(H.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case tl.TRANSCODE:c.transcodingConfig=Zi({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const p=this.lastTaskId++;try{const m=new Pe((v,_)=>{vr(this.retryTimeout).then(()=>{if(s)return _(s);const E=this.statusError.get(r);return E?(this.statusError.delete(r),_(E)):void 0})}),g=await Pe.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===tl.TRANSCODE?1:2,requestByUser:!s,tid:p.toString()}),m]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:p}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||s)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new Pe((i,s)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ce(H.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===tl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(p=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(p.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(s)})}resetAllTask(){var r;const i=Array.from(va(r=this.streamingTasks).call(r));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ji.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ce(H.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await er(this,JA.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new O0e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(cd.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(cd.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(cd.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new ce(H.UNEXPECTED_ERROR,"can not get new live streaming address list"));er(this,JA.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=r.reason;switch(r.code){case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const p=new ce(H.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return R.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,p);if(!this.isStartingStreamingTask)return;this.statusError.set(i,p)}case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const p=new ce(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,p)}case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const p=Array.from(va(u=this.streamingTasks).call(u));for(const m of p)m.abortTask?m.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{R.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const D0e={name:"LiveStreaming",create:function(t){return new P0e(t.joinInfo,t.websocketRetryConfig||Kn,t.httpRetryConfig||Kn)}};function k0e(t){let r=m$();return function(i,s){let c=i.appId;c!==void 0&&(nn(s,10),wc(s,c));let u=i.cid;u!==void 0&&(nn(s,16),nn(s,u));let p=i.cname;p!==void 0&&(nn(s,26),wc(s,p));let m=i.deviceId;m!==void 0&&(nn(s,34),wc(s,m));let g=i.elapse;g!==void 0&&(nn(s,40),xd(s,g));let v=i.fileSize;v!==void 0&&(nn(s,48),xd(s,vm(v)));let _=i.height;_!==void 0&&(nn(s,56),xd(s,vm(_)));let E=i.jpg;E!==void 0&&(nn(s,66),nn(s,E.length),function(Tn,_e){let Oe=ym(Tn,_e.length);Tn.bytes.set(_e,Oe)}(s,E));let w=i.networkType;w!==void 0&&(nn(s,72),xd(s,vm(w)));let C=i.osType;C!==void 0&&(nn(s,80),xd(s,vm(C)));let U=i.requestId;U!==void 0&&(nn(s,90),wc(s,U));let k=i.sdkVersion;k!==void 0&&(nn(s,98),wc(s,k));let j=i.sequence;j!==void 0&&(nn(s,104),xd(s,vm(j)));let $=i.sid;$!==void 0&&(nn(s,114),wc(s,$));let K=i.timestamp;K!==void 0&&(nn(s,120),xd(s,K));let J=i.uid;J!==void 0&&(nn(s,128),nn(s,J));let ne=i.vid;ne!==void 0&&(nn(s,136),nn(s,ne));let ae=i.width;ae!==void 0&&(nn(s,144),xd(s,vm(ae)));let ee=i.service;ee!==void 0&&(nn(s,152),nn(s,ee));let oe=i.callbackData;oe!==void 0&&(nn(s,162),wc(s,oe));let ve=i.jpgEncryption;ve!==void 0&&(nn(s,168),nn(s,ve));let Ee=i.requestType;Ee!==void 0&&(nn(s,176),nn(s,Ee));let Be=i.scorePorn;Be!==void 0&&(nn(s,185),uO(s,Be));let mt=i.scoreSexy;mt!==void 0&&(nn(s,193),uO(s,mt));let ct=i.scoreNeutral;ct!==void 0&&(nn(s,201),uO(s,ct));let Tt=i.scene;Tt!==void 0&&(nn(s,208),nn(s,Tt));let Et=i.ossFilePrefix;Et!==void 0&&(nn(s,218),wc(s,Et));let Yt=i.serviceVendor;if(Yt!==void 0)for(let Tn of Yt){nn(s,226);let _e=m$();M0e(Tn,_e),nn(s,_e.limit),B0e(s,_e),V0e(_e)}}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function j0e(t){return function(i){let s={};e:for(;!f$(i);){let c=Tc(i);switch(c>>>3){case 0:break e;case 1:s.code=Tc(i);break;case 2:s.msg=g$(i,Tc(i));break;case 3:{let u=U0e(i);s.data=L0e(i),i.limit=u;break}default:h$(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function L0e(t){let r={};e:for(;!f$(t);){let i=Tc(t);switch(i>>>3){case 0:break e;case 1:r.requestId=g$(t,Tc(t));break;case 2:r.requestType=Tc(t)>>>0;break;case 3:r.scorePorn=dO(t);break;case 4:r.scoreSexy=dO(t);break;case 5:r.scoreNeutral=dO(t);break;case 6:r.requestScene=Tc(t)>>>0;break;case 7:r.scene=Tc(t)>>>0;break;default:h$(t,7&i)}}return r}function M0e(t,r){let i=t.service;i!==void 0&&(nn(r,8),nn(r,i));let s=t.vendor;s!==void 0&&(nn(r,16),nn(r,s));let c=t.token;c!==void 0&&(nn(r,26),wc(r,c));let u=t.callbackUrl;u!==void 0&&(nn(r,34),wc(r,u))}function U0e(t){let r=Tc(t),i=t.limit;return t.limit=t.offset+r,i}function h$(t,r){switch(r){case 0:for(;128&v$(t););break;case 2:cO(t,Tc(t));break;case 5:cO(t,4);break;case 1:cO(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let F0e=new Float32Array(1);new Uint8Array(F0e.buffer);let oO=new Float64Array(1),ea=new Uint8Array(oO.buffer);function vm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let p$=[];function m$(){const t=p$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function V0e(t){p$.push(t)}function cO(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function f$(t){return t.offset>=t.limit}function ym(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let p=new Uint8Array(2*u);p.set(i),t.bytes=p}return t.offset=u,u>c&&(t.limit=u),s}function lO(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function g$(t,r){let i=lO(t,r),s=String.fromCharCode,c=t.bytes,u="",p="";for(let m=0;m<r;m++){let g,v,_,E,w=c[m+i];128&w?(224&w)==192?m+1>=r?p+=u:(g=c[m+i+1],(192&g)!=128?p+=u:(E=(31&w)<<6|63&g,E<128?p+=u:(p+=s(E),m++))):(240&w)==224?m+2>=r?p+=u:(g=c[m+i+1],v=c[m+i+2],(49344&(g|v<<8))!=32896?p+=u:(E=(15&w)<<12|(63&g)<<6|63&v,E<2048||E>=55296&&E<=57343?p+=u:(p+=s(E),m+=2))):(248&w)==240?m+3>=r?p+=u:(g=c[m+i+1],v=c[m+i+2],_=c[m+i+3],(12632256&(g|v<<8|_<<16))!=8421504?p+=u:(E=(7&w)<<18|(63&g)<<12|(63&v)<<6|63&_,E<65536||E>1114111?p+=u:(E-=65536,p+=s(55296+(E>>10),56320+(1023&E)),m+=3))):p+=u:p+=s(w)}return p}function wc(t,r){let i=r.length,s=0;for(let p=0;p<i;p++){let m=r.charCodeAt(p);m>=55296&&m<=56319&&p+1<i&&(m=(m<<10)+r.charCodeAt(++p)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}nn(t,s);let c=ym(t,s),u=t.bytes;for(let p=0;p<i;p++){let m=r.charCodeAt(p);m>=55296&&m<=56319&&p+1<i&&(m=(m<<10)+r.charCodeAt(++p)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function B0e(t,r){let i=ym(t,r.limit),s=t.bytes,c=r.bytes;for(let u=0,p=r.limit;u<p;u++)s[u+i]=c[u]}function v$(t){return t.bytes[lO(t,1)]}function y$(t,r){let i=ym(t,1);t.bytes[i]=r}function dO(t){let r=lO(t,8),i=t.bytes;return ea[0]=i[r++],ea[1]=i[r++],ea[2]=i[r++],ea[3]=i[r++],ea[4]=i[r++],ea[5]=i[r++],ea[6]=i[r++],ea[7]=i[r++],oO[0]}function uO(t,r){let i=ym(t,8),s=t.bytes;oO[0]=r,s[i++]=ea[0],s[i++]=ea[1],s[i++]=ea[2],s[i++]=ea[3],s[i++]=ea[4],s[i++]=ea[5],s[i++]=ea[6],s[i++]=ea[7]}function Tc(t){let r,i=0,s=0;do r=v$(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function nn(t,r){for(r>>>=0;r>=128;)y$(t,127&r|128),r>>>=7;y$(t,r)}function xd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,p=ym(t,u),m=t.bytes;switch(u){case 10:m[p+9]=c>>>7&1;case 9:m[p+8]=u!==9?128|c:127&c;case 8:m[p+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[p+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[p+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[p+4]=u!==5?128|s:127&s;case 4:m[p+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[p+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[p+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[p]=u!==1?128|i:127&i}}function _$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}const G0e=new Map([["moderation",1],["supervise",2]]);class W0e extends Nn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Ar.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=ss(i=r.map(s=>G0e.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),M(this,"name","AgoraRTCVideoContentInspect"),M(this,"_connectionState",$s.CONNECTING),M(this,"_innerConnectionState",void 0),M(this,"sequence",0),M(this,"inspectStartTime",void 0),M(this,"workerManagerConnection",void 0),M(this,"workerConnection",void 0),M(this,"workerMessageLengthLimit",void 0),M(this,"inspectIntervalMinimum",void 0),M(this,"qualityRatio",void 0),M(this,"_connectInfo",void 0),M(this,"_cancelTokenSource",ji.CancelToken.source()),M(this,"_retryConfig",void 0),M(this,"wmSequence",0),M(this,"inspectInterval",void 0),M(this,"inspectTimer",null),M(this,"ossFilePrefix",void 0),M(this,"extraInfo",void 0),M(this,"_inspectType",void 0),M(this,"_inspectMode",void 0),M(this,"_quality",1),M(this,"qualityTimer",null),M(this,"_inspectId",void 0),M(this,"_needWorkUrlOnly",!1),M(this,"inspectImage",()=>{if(this.connectionState!==$s.CONNECTED)throw new ce(H.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===$s.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Zt(5,"inspect-"),this.workerMessageLengthLimit=W("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=W("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=W("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new av("worker-manager-"+this._inspectId,Kn),this.on(Ar.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Hs[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new av("worker-"+this._inspectId,Kn),this.handleWorkerEvents()}async init(r,i){this.emit(Ar.STATE_CHANGE,Hs.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new Pe((c,u)=>{this.on(Ar.CONNECTION_STATE_CHANGE,(p,m)=>{m===$s.CONNECTED&&c()}),this.requestAP(r,s,i).then(p=>{this.connectWorkerManager(p)}).catch(p=>{u(p)})})}async requestAP(r,i,s){const c=W("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,g,v,_){let{appId:E,areaCode:w,cname:C,sid:U,token:k,uid:j}=g;am++;const $="image_moderation_api",K={service_name:$,json_body:JSON.stringify({appId:E,areaCode:w,cname:C,command:"allocateEdge",requestId:am,seq:am,sid:U,token:k,ts:Date.now(),uid:j+""})};let J,ne,ae=m[0];return To(async()=>{J=Date.now();const ee=await Oo(ae,{data:K,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ne=Date.now()-J,ee.code!==0){const ct=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:ne});throw R.error(ct.toString()),ct}const oe=JSON.parse(ee.json_body);if(oe.code!==200){const ct=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(oe.code,", reason: ").concat(oe.reason),{code:oe.code,responseTime:ne});throw R.error(ct.toString()),ct}if(!oe.servers||!Array.isArray(oe.servers)||oe.servers.length===0){const ct=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:oe.code,responseTime:ne});throw R.error(ct.toString()),ct}const ve=W("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ve)return{addressList:[ve],workerToken:oe.workerToken,vid:oe.vid,responseTime:ne};const Ee=W("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Be=W("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:oe.servers.map(ct=>{let{address:Tt,wss:Et}=ct;if(Tt&&Et)return"wss://".concat(Tt.replace(/\./g,"-"),".").concat(Ee,":").concat(Be||Et)}).filter(ct=>!!ct),workerToken:oe.workerToken,vid:oe.vid,responseTime:ne}},(ee,oe)=>(ze.apworkerEvent(U,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(ee.addressList),firstSuccess:oe===0,responseTime:ne,serverIp:m[oe%m.length]}),!1),(ee,oe)=>(ze.apworkerEvent(U,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:$,responseTime:ne,serverIp:m[oe%m.length]}),!!(ee.code!==H.OPERATION_ABORTED&&ee.code!==H.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(ae=m[(oe+1)%m.length],!0)),_)}(c,r,i,s);this.emit(Ar.STATE_CHANGE,Hs.AP_CONNECTED);const{addressList:p}=u;return this.wmSequence++,p}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Ar.STATE_CHANGE,Hs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(St.CONNECTED,async()=>{this.emit(Ar.STATE_CHANGE,Hs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(St.CLOSED,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(St.FAILED,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(St.RECONNECTING,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(St.ON_MESSAGE,async r=>{this.emit(Ar.STATE_CHANGE,Hs.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(r.data);if(s.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new ce(H.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&i))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new ce(H.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=W("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Ar.STATE_CHANGE,Hs.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Ar.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(St.WILL_RECONNECT,(r,i,s)=>{s(r)}),this.workerManagerConnection.on(St.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(St.CONNECTED,async()=>{this.emit(Ar.STATE_CHANGE,Hs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=$s.CONNECTED}),this.workerConnection.on(St.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=j0e(new Uint8Array(r.data));if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ar.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var i;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=ss(i=Object.keys(c)).call(i,(m,g)=>c[m]>c[g]?m:g,"porn"),p=Object.keys(c).find(m=>m===u);this.emit(Ar.INSPECT_RESULT,p)}else this.emit(Ar.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(Ar.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ar.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(St.CLOSED,()=>{this.connectionState=$s.CLOSED}),this.workerConnection.on(St.FAILED,()=>{this.connectionState=$s.CLOSED}),this.workerConnection.on(St.RECONNECTING,()=>{this.connectionState=this.connectionState===$s.CONNECTED?$s.RECONNECTING:$s.CONNECTING}),this.workerConnection.on(St.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this.workerConnection.on(St.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(Ar.REQUEST_NEW_WORKER_URL,s=>{r([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{i(s)})})}async requestToInspectImage(){this.sequence++;const r=ba(this,Ar.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Ar.INSPECT_RESULT,void 0,new ce(H.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(r,i);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(Ar.INSPECT_RESULT,void 0,new ce(H.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:p,sid:m,uid:g}=i;const v=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),E=await YV(_,s,c),w=this.sequence+"-"+u+"-"+g+"-"+v+"-"+Zt(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:(U=Number(v-this.inspectStartTime),{low:U|=0,high:U>>31,unsigned:U>=0}),fileSize:E.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:E,networkType:6,osType:7,requestId:w,sdkVersion:"4.24.2",sequence:this.sequence,sid:m,timestamp:SG(v),uid:g,vid:p,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var U;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;const k=k0e(C);if(k.byteLength<this.workerMessageLengthLimit){if(W("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function($){for(var K=1;K<arguments.length;K++){var J=arguments[K]!=null?arguments[K]:{};K%2?_$(Object(J),!0).forEach(function(ne){M($,ne,J[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(J)):_$(Object(J)).forEach(function(ne){Object.defineProperty($,ne,Object.getOwnPropertyDescriptor(J,ne))})}return $}({},C);delete j.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return k}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:p,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ji.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$s.CLOSED,this.emit(Ar.STATE_CHANGE,Hs.CLOSED)}}const $0e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(i){if(!i)throw new ce(H.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new ce(H.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(i.inspectType)];s.forEach(c=>{var u;if(!Ne(u=["supervise","moderation"]).call(u,c))throw new ce(H.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=s}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new ce(H.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new W0e(r)}};var b$=d(ht.Object.getOwnPropertySymbols),H0e=Qt,z0e=aC.indexOf,K0e=a_,hO=ue([].indexOf),x$=!!hO&&1/hO([1],1,-0)<0;H0e({target:"Array",proto:!0,forced:x$||!K0e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return x$?hO(this,t,r)||0:z0e(this,t,r)}});var Y0e=as("Array","indexOf"),q0e=N,X0e=Y0e,pO=Array.prototype,J0e=function(t){var r=t.indexOf;return t===pO||q0e(pO,t)&&r===pO.indexOf?X0e:r},E$=d(J0e);function Q0e(t,r){if(t==null)return{};var i,s,c=function(p,m){if(p==null)return{};var g={};for(var v in p)if({}.hasOwnProperty.call(p,v)){if(E$(m).call(m,v)!==-1)continue;g[v]=p[v]}return g}(t,r);if(b$){var u=b$(t);for(s=0;s<u.length;s++)i=u[s],E$(r).call(r,i)===-1&&{}.propertyIsEnumerable.call(t,i)&&(c[i]=t[i])}return c}let S$=class{get localCapabilities(){return bn(this._localCapabilities)}get rtpCapabilities(){return bn(this._rtpCapabilities)}get candidates(){return bn(this._candidates)}get iceParameters(){return bn(this._iceParameters)}get dtlsParameters(){return bn(this._dtlsParameters)}constructor(t){M(this,"sessionDesc",void 0),M(this,"_localCapabilities",void 0),M(this,"_rtpCapabilities",void 0),M(this,"_candidates",void 0),M(this,"_iceParameters",void 0),M(this,"_dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname","o/i14u9pJrxRKAsu"),M(this,"firefoxSsrcMidMap",new Map),t=bn(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,localCapabilities:u,direction:p,setup:m,videoCodec:g,audioCodec:v}=t;let _;this.setup=m,_=p===Ri.RECEIVE_ONLY?Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const E=p===Ri.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,w=p===Ri.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=p===Ri.RECEIVE_ONLY?c.send.videoCodecs:uv($e.VIDEO,E,w,g),U=p===Ri.RECEIVE_ONLY?c.send.audioCodecs:uv($e.AUDIO,E,w,v);for(const k of _.mediaDescriptions)k.attributes.iceUfrag=r.iceUfrag,k.attributes.icePwd=r.icePwd,k.attributes.fingerprints=i.fingerprints,k.attributes.candidates=s,k.attributes.setup=this.setup,k.media.mediaType==="application"&&(k.attributes.sctpPort="5000"),k.media.mediaType==="video"&&(k.media.fmts=C.map(j=>j.payloadType.toString(10)),k.attributes.payloads=C,k.attributes.extmaps=E.videoExtensions),k.media.mediaType==="audio"&&(k.media.fmts=U.map(j=>j.payloadType.toString(10)),k.attributes.payloads=U,k.attributes.extmaps=E.audioExtensions,im(k));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return el(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,i,s,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:p}=lv(r,this.cname,W("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(_n()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,u,s);let v;return g===-1?(v=this.createOrRecycleSendMedia(t,u,p,"sendonly",s,c),this.updateBundleMids()):(v=bn(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=p,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),_n()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,i){const s=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,p=this.findAvailableRecvMediaIndex(u);let m,g=!1;p===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=bn(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="recvonly"),s.push({mid:m.attributes.mid,needCreateTransceiver:g})}),s}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:i,address:s,port:c,type:u,relatedAddress:p,relatedPort:m,priority:g}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:i??"",priority:g?g+"":"",connectionAddress:s??"",port:c?c+"":"",type:u?u+"":"",relAddr:p??"",relPort:m?m+"":"",extension:{}};this.candidates.some(_=>_.priority===v.priority&&_.connectionAddress===v.connectionAddress&&_.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,i,s,c){const u=t._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,m=uv(u,p,this.localCapabilities.send,u===$e.AUDIO?c:s),g=u===$e.VIDEO?p.videoExtensions:p.audioExtensions,v="".concat(++this.currentMidIndex);let _={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};_=this.mungRecvMediaDsec(_,t);const E=this.findFirstClosedMedia(u);if(E){const w=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[w]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Ne(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Ne(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===t&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(_n()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return c&&s.attributes.mid===i})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(t){t=bn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,i,s,c,u){const p=this.rtpCapabilities.send,m=t===$e.VIDEO?p.videoCodecs:p.audioCodecs,g=t===$e.VIDEO?p.videoExtensions:p.audioExtensions;_n()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const _=this.findFirstClosedMedia(t);if(_){const E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,i){const s=bn(t);return aI(s),Hu(s,r),sI(s,r),p8(s),mx(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=bn(t);return mx(i,r,this.localCapabilities.recv),im(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>_n()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const Z0e=["sdp"];var xn;function w$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Ed(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?w$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let T$=(xn=class Nm extends q6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,s){super(r,i),M(this,"direction",void 0),M(this,"name",void 0),M(this,"store",void 0),M(this,"spec",void 0),M(this,"peerConnection",void 0),M(this,"initialOffer",void 0),M(this,"transport",void 0),M(this,"statsFilter",void 0),M(this,"localCandidateCount",0),M(this,"_isInRestartIce",!1),M(this,"mutex",void 0),M(this,"onLocalCandidate",void 0),M(this,"remoteSDP",void 0),M(this,"pendingCandidates",[]),M(this,"localCapabilities",void 0),M(this,"isReady",!1),M(this,"restartCnt",0),M(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Nr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Nm.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Ri.SEND_ONLY,this.name=this.direction===Ri.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Lb(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await cI();if(this.localCapabilities=dv(i),r){const{sdp:s}=r,c=Q0e(r,Z0e),u=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=cv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},U={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(E,_,"videoExtensions",w,C,U),Ks(E,_,"videoCodecs",w,C,U),Ks(E,_,"audioExtensions",w,C,U),Ks(E,_,"audioCodecs",w,C,U),W("RAISE_H264_BASELINE_PRIORITY")){const k=U.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(k!==-1){const j=U.videoCodecs.findIndex($=>$.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<k){R.debug("raising H264 baseline profile priority");const $=U.videoCodecs[k];U.videoCodecs.splice(k,1),U.videoCodecs.splice(j,0,$)}j!==-1&&W("FILTER_SEND_H264_BASELINE")&&(w.videoCodecs=w.videoCodecs.filter($=>!($.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$.fmtp&&$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:w,recv:C,sendrecv:U}}({},{},s);this.remoteSDP=new S$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const p=await this.peerConnection.createAnswer();if(!p.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=gc(p.sdp);await this.peerConnection.setLocalDescription(p);const g=await f8({},{},p.sdp);this.localCapabilities=dv(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Ed(Ed({},m),{},{sdp:p.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=gc(s.sdp);return this.initialOffer=s,Ed(Ed({},c),{},{sdp:s.sdp})}}catch(i){throw new me(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:s,dtlsParameters:c}=r,u=await f8({},{},i);this.remoteSDP=new S$({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const p=this.peerConnection.getTransceivers()[0];p!=null&&p.sender&&p.sender.transport&&this.tryBindTransportEvents(p.sender.transport)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new me(H.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return ki(function*(){const u=yield Ct(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const p=[],m=c.remoteSDP.receive(r,i,s);r.forEach((j,$)=>{if(m[$].needCreateTransceiver){const K=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});p.push(K),j._updateRtpTransceiver(K)}else{const K=c.peerConnection.getTransceivers().find(J=>J.mid===m[$].mid);if(!K)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[$].mid));p.push(K),j._updateRtpTransceiver(K)}}),_n()&&W("SIMULCAST")===!0&&(yield Ct(c.applySimulcastForFirefox(p,r)));const g=m.map(j=>j.mid),v=yield Ct(c.peerConnection.createOffer()),_=c.mungSendOfferSDP(v.sdp,r,g),E=Ti(_),w=g.map(j=>{const $=E.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return iI($,W("USE_PUB_RTX"))}),C=p.map((j,$)=>{const K=g[$];return{localSSRC:w[$],id:K}});yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield C}catch(j){const $=c.remoteSDP.toString();throw yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Ct(c.stopSending(g,!0)),j}yield Ct(c.applySimulcastEncodings(p,r)),yield Ct(c.applySendEncodings(p,r));const U=c.remoteSDP.toString(),k=c.logSDPExchange(_,"offer","local","send");return k==null||k(U),yield Ct(c.setRemoteDescription({type:"answer",sdp:U})),p.map((j,$)=>{const K=g[$];return{localSSRC:w[$],id:K}})}catch(p){throw p instanceof me?p:new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(p.toString()))}finally{u()}})()}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),p=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();p==null||p(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:p}=this.remoteSDP.send(r,i,s,c);if(p){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const _=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(_.sdp,u,r);v==null||v(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:p}=this.remoteSDP.send(r,i,s,c);if(p){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(v.sdp,u,r);g==null||g(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Du.Auto&&(this.store.p2pTransport=Du.SdRtn,Pt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Pt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=gc(i.sdp);return this.store.descriptionStart(),this.direction===Ri.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Ri.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=gc(i.sdp);return await this.peerConnection.setLocalDescription(i),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),p=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),p==null||p(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new me(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?_n()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Ed(Ed({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Ed(Ed({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;Ne(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Nu(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...Nm.turnServerConfigToIceServers(r.turnServer.servers,i,s)),W("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...Nm.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,s)),Ne(u=[Du.Relay,Du.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),W("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(c.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Pt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);R.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));const p=u.length>s?u[s]:u[0];switch(i){case Du.SdRtn:const m=r.filter(v=>{var _;return Ne(_=v.username).call(_,"glb:")&&v.turnServerURL==v.turnServerURL}),g=m.length>s?m[s]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(zs(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(zs(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Du.Relay:p&&(c.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=udp")}),c.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(zs(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;default:p&&(c.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=udp")}),c.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(zs(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}),c.push({username:p.username,credential:p.password,credentialType:"password",urls:"stun:".concat(p.turnServerURL,":").concat(p.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:c}=i.getSelectedCandidatePair()||{};if(s&&c){const u=s.address+":"+s.port,p=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fc(u)),", remote ").concat(JSON.stringify(fc(p))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(_=>_.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Pt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var p;const{bitrateMax:_,frameRate:E,scaleResolutionDownBy:w}=r._encoderConfig;_&&(u.maxBitrate=1e3*_),Ne(p=r._hints).call(p,Jt.LOW_STREAM)&&(E&&(u.maxFramerate=Fi(E)),w&&w>=1&&(u.scaleResolutionDownBy=w))}if(W("DSCP_TYPE")&&dc()){var m;const _=W("DSCP_TYPE");Ne(m=["very-low","low","medium","high"]).call(m,_)&&(u.networkPriority=_)}const g=i.getParameters(),v=(s=g.encodings)===null||s===void 0?void 0:s[0];_n()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(g,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await i.setParameters(g)}async applySendEncodings(r,i){try{if(!Pt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ti(r);return i.forEach((u,p)=>{const m=s[p],g=c.mediaDescriptions.find(v=>v.attributes.mid===m);g&&(Hu(g,u),oI(g,u,this.store.codec))}),el(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,p,m;const v=r[g],_=i[g];if(_ instanceof dn&&!Ne(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(p=_._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,E))}}}async applySimulcastEncodings(r,i){if(!_n()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],p={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,p))}}}isVP8Simulcast(r){var i,s,c,u,p;return!!(r instanceof dn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ne(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=r._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(p=>{p.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async p=>{p.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var s;if(i=i??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var c;const u=(c=Ti(i).mediaDescriptions.find(p=>p.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),Ne(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,s){const c=Ti(r),u=c.mediaDescriptions.find(p=>p.attributes.mid===i);return u&&s===$e.AUDIO&&u.media.mediaType==="audio"&&im(u),el(c)}},ke(xn.prototype,"establish",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"establish"),xn.prototype),ke(xn.prototype,"connect",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"connect"),xn.prototype),ke(xn.prototype,"receive",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"receive"),xn.prototype),ke(xn.prototype,"mockReceive",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"mockReceive"),xn.prototype),ke(xn.prototype,"stopReceiving",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"stopReceiving"),xn.prototype),ke(xn.prototype,"restartICE",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"restartICE"),xn.prototype),ke(xn.prototype,"close",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"close"),xn.prototype),ke(xn.prototype,"updateEncoderConfig",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"updateEncoderConfig"),xn.prototype),ke(xn.prototype,"updateSendParameters",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"updateSendParameters"),xn.prototype),ke(xn.prototype,"replaceTrack",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"replaceTrack"),xn.prototype),ke(xn.prototype,"muteLocal",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"muteLocal"),xn.prototype),ke(xn.prototype,"unmuteLocal",[Qs],Object.getOwnPropertyDescriptor(xn.prototype,"unmuteLocal"),xn.prototype),xn);function Qs(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}let ko=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var C$,N$,R$,A$,I$,O$,P$,D$,k$,j$,L$,Rn;function M$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Xx(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?M$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):M$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let e_e=(C$=jo(ko.SEND_ONLY),N$=jo(ko.SEND_ONLY),R$=jo(),A$=jo(ko.RECEIVE_ONLY),I$=jo(ko.RECEIVE_ONLY),O$=jo(ko.RECEIVE_ONLY),P$=jo(ko.RECEIVE_ONLY),D$=jo(ko.RECEIVE_ONLY),k$=jo(ko.RECEIVE_ONLY),j$=jo(),L$=jo(ko.RECEIVE_ONLY),Rn=class extends Nn{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Qe.StateChange,r,this._state)}constructor(t,r){super(),M(this,"isPlanB",!1),M(this,"store",void 0),M(this,"statsUploader",void 0),M(this,"sendConnection",void 0),M(this,"recvConnection",void 0),M(this,"localTrackMap",new Map),M(this,"remoteUserMap",new Map),M(this,"localDataChannels",[]),M(this,"pendingLocalTracks",[]),M(this,"pendingRemoteTracks",[]),M(this,"statsCollector",void 0),M(this,"dtlsFailedCount",0),M(this,"sendMutex",void 0),M(this,"recvMutex",void 0),M(this,"_state",Xt.Disconnected),M(this,"_restartStates",["disconnected","failed"]),M(this,"reconnectInterval",void 0),M(this,"uploadUnplinkStarted",!1),M(this,"uploadDownlinkStarted",!1),M(this,"uplinkStateUploadInterval",void 0),M(this,"downlinkStatsUploadInterval",void 0),M(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new me(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(i);if(g.length===0)return void s();const v=g.find(C=>C[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(C=>{let[,{id:U}]=C;return U}));let _=!1;var p,m;i.trackMediaType==="video"?_=!((p=this.localTrackMap.get(Re.LocalAudioTrack))===null||p===void 0||!p.track._muted):_=((m=this.localTrackMap.get(Re.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const E=this.createMuteMessage(g);await pn(this,Qe.RequestMuteLocal,E);const w=i.trackMediaType==="video"?dd.MUTE_LOCAL_VIDEO:dd.MUTE_LOCAL_AUDIO;await pn(this,Qe.RequestP2PMuteLocal,{action:w,message:E,isMuteAll:_}),s()}catch(g){c(g)}finally{u()}}),M(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Xt.Connected)return void c(new me(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const p=this.filterTobeUnmutedTracks(i);if(p.length===0)return void s();await this.sendConnection.unmuteLocal(p.map(v=>{let[,{id:_}]=v;return _}));const m=this.createUnmuteMessage(p),g=i.trackMediaType==="video"?dd.UNMUTE_LOCAL_VIDEO:dd.UNMUTE_LOCAL_AUDIO;await pn(this,Qe.RequestP2PMuteLocal,{action:g,message:m}),s()}catch(p){c(p)}finally{u()}}),M(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let p;typeof u=="boolean"&&u||(p=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Re.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==Xt.Connected)return void s();const{id:v,track:_}=g;v&&(await this.sendConnection.updateSendParameters(v,_),await this.sendConnection.updateEncoderConfig(v,_),this.emit(Qe.UpdateVideoEncoder,_)),s()}catch(g){c(g)}finally{var m;(m=p)===null||m===void 0||m()}}),M(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const p=this.localTrackMap.get(Re.LocalVideoTrack);if(!this.sendConnection||!p||p.track!==i||this.state!==Xt.Connected)return void s();const{id:m,track:g}=p;m&&await this.sendConnection.updateSendParameters(m,g),s()}catch(p){c(p)}finally{u()}}),M(this,"handleReplaceTrack",async(i,s,c,u)=>{let p;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(p=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:E}]=_;return i===E});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Xt.Connected)return void s();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,v[1].id)),v[0]===Re.LocalVideoTrack&&Pt().supportDualStreamEncoding){const _=this.localTrackMap.get(Re.LocalVideoLowTrack);if(_){const E=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E,await new Pe((w,C)=>{this.handleReplaceTrack(_.track,w,C,!0)})}}s()}catch(v){c(v)}finally{var g;(g=p)===null||g===void 0||g()}}),M(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),M(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),M(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),M(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new J8(t),this.bindStatsUploaderEvents(),this.sendMutex=new Nr("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Nr("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},W("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new me(H.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new me(H.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let i;try{if(r){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new T$(t,this.store,Ri.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(r);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Xt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new T$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(t){if(!this.sendConnection)throw new me(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xt.Connected}async addRemoteCandidate(t,r){if(r===Ri.RECEIVE_ONLY){if(!this.sendConnection)throw new me(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new me(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,i){var s=this;return ki(function*(){const c=yield Ct(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Xt.Connected){s.throwIfTrackTypeNotMatch(t);const v=t.filter(_=>s.pendingLocalTracks.indexOf(_)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(v))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const u=s.filterTobePublishedTracks(t,r,i);if(u.length===0)return void(yield Ct(s.tryToUnmuteAudio(t)));u.forEach(v=>{let{track:_,type:E}=v;const w=Date.now();s.store.publish(_.getTrackId(),E===Re.LocalAudioTrack?"audio":"video",w)}),s.bindLocalTrackEvents(u);const p=yield Ct(s.sendConnection.send(u.map(v=>{let{track:_}=v;return _}),s.store.codec,s.store.audioCodec)),m=(yield Ct(p.next())).value,g=s.createGatewayPublishMessage(u,m);try{yield g}catch(v){throw p.throw(v),(v==null?void 0:v.code)===H.WS_ABORT&&u.forEach(_=>{let{track:E}=_;s.pendingLocalTracks.indexOf(E)===-1&&s.pendingLocalTracks.push(E)}),s.unbindLocalTrackEvents(u),v}yield Ct(p.next()),u.forEach(v=>{let{type:_}=v;s.statsCollector.addLocalStats(_)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,m),u.forEach(v=>{let{track:_,type:E}=v;const w=Date.now();s.store.publish(_.getTrackId(),E===Re.LocalAudioTrack?"audio":"video",void 0,w)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Xt.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Ne(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:p}]=c;return{type:u,track:p}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Xt.Connected)return i&&i[1].track.close(),s;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:u,ssrcs:p}]=s;const m={stream_type:Gve(u,c),ssrcs:p};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(s=>{pn(this,Qe.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{pn(this,Qe.RequestUnmuteLocal,[s])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return ki(function*(){throw new me(H.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,Qe.RequestRePublish,this.pendingLocalTracks),this.emit(Qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new me(H.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,i,s){var c;if(!this.recvConnection)throw new me(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:p,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(t.uid),s);r===$e.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new Xp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new qp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,p):this.remoteUserMap.set(t,new Map([[r,p]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(_=>{let{user:E,kind:w}=_;return E.uid===t.uid&&r===w});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Qe.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,i,s){if(!this.recvConnection)throw new me(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(t.uid),s)}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:p,kind:m}=u;return r!==void 0?p.uid===t.uid&&r===m:p.uid===t.uid});if(s.forEach(u=>{const p=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(p,1)}),this.recvConnection||i||s.forEach(u=>{let{kind:p}=u;var m;if(p===$e.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(p===$e.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:p}]=u;return p})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[p,{kind:m}]=u;var g,v;if(m===$e.VIDEO&&p._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===$e.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),i||((v=p._videoTrack)===null||v===void 0||v._destroy(),p._videoTrack=void 0);else if(m===$e.AUDIO){var _;this.unbindRemoteTrackEvents(p._audioTrack),!i&&((_=p._audioTrack)===null||_===void 0||_._destroy(),p._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:p}]=u;pn(this,Qe.RequestP2PMuteRemote,p)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[$e.VIDEO,$e.AUDIO].forEach(s=>{i.has(s)?pn(this,Qe.RequestP2PUnmuteRemote,s):pn(this,Qe.RequestP2PMuteRemote,s)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new me(H.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new me(H.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new me(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new me(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===$e.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Re.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Re.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Re.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Re.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,r,i,s,c){if(t){const p=this.localTrackMap.get(Re.LocalAudioTrack),m=s?this.localTrackMap.get(Re.LocalVideoLowTrack):this.localTrackMap.get(Re.LocalVideoTrack);ze.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:p==null?void 0:p.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const p=i.find(g=>g instanceof Mn),m=s?(u=this.localTrackMap.get(Re.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof dn);ze.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:p==null?void 0:p.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Jt.SCREEN_TRACK))!==-1,audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===$e.VIDEO?i._videoSSRC:i._audioSSRC;c&&ze.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===$e.VIDEO,audio:s===$e.AUDIO,peerid:i.uid,subscribeRequestid:s===$e.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Nr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Nr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Re.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Xt.Disconnected}getStats(t){var r,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Re.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Re.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof dn||r&&r.track instanceof Mn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(ai(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Re.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=vu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Xt.Reconnecting,W("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Re.LocalVideoTrack:Ne(r=s._hints).call(r,Jt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Re.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Re.LocalVideoLowTrack:}}),this.emit(Qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(ai(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Qe.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof pd?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let i,s;if(t===Ri.SEND_ONLY){if(!this.sendConnection)throw new me(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new me(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(r){const c=await s.restartICE(r);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const u=await er(this,Qe.RequestP2PRestartICE,{direction:Ri.RECEIVE_ONLY,iceParameter:c});await s.restartICE(u),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Re.LocalVideoTrack),i=this.localTrackMap.get(Re.LocalAudioTrack),s=t.videoSend.find(C=>{var U;return C.ssrc===(r==null||(U=r.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)}),c=t.audioSend.find(C=>{var U;return C.ssrc===(i==null||(U=i.ssrcs)===null||U===void 0?void 0:U[0].ssrcId)});if(!s||!c)return 1;const u=ba(this,Qe.NeedSignalRTT),p=s?s.rttMs:void 0,m=c?c.rttMs:void 0,g=p&&m?(p+m)/2:p||m,v=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*v/1500,E=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,w=r==null?void 0:r.track;if(w&&w._encoderConfig&&w._hints.indexOf(Jt.SCREEN_TRACK)===-1){const C=w._encoderConfig.bitrateMax,U=t.bitrate.actualEncoded;if(C&&U){const k=(1e3*C-U)/(1e3*C);return B6[k<.15?0:k<.3?1:k<.45?2:k<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,p=t.audioRecv.find(U=>U.ssrc===c),m=t.videoRecv.find(U=>U.ssrc===u);if(!p&&!m)return void(r+=1);const g=ba(this,Qe.NeedSignalRTT),v=t.rtt,_=(v&&g?(v+g)/2:v||g)||0,E=p?p.jitterMs:void 0,w=t.recvPacketLossRate;let C=.7*w*100/50+.3*_/1500;E&&(C=.6*w*100/50+.2*_/1500+.2*E/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new Pe((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}filterTobePublishedTracks(t,r,i){const s=[],c=Pt(),u=this.getAllTracks();t=Lp(t=t.filter(g=>u.indexOf(g)===-1));let p=!1,m=!1;for(const g of t){if(g instanceof dn&&(this.localTrackMap.has(Re.LocalVideoTrack)||p?new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Re.LocalVideoTrack}),p=!0),r)){const v=this.getLowVideoTrack(g,i);s.push({track:v,type:Re.LocalVideoLowTrack})}if(g instanceof Mn){const v=this.localTrackMap.get(Re.LocalAudioTrack);if(v){if(!(v.track instanceof or))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const _=s.find(E=>{let{type:w}=E;return w===Re.LocalAudioTrack});if(!(_.track instanceof or))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof or||g._bypassWebAudio)s.push({track:g,type:Re.LocalAudioTrack});else{const _=new or;_.addAudioTrack(g),s.push({track:_,type:Re.LocalAudioTrack})}m=!0}}}return s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Lp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Mn){const c=this.localTrackMap.get(Re.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Re.LocalAudioTrack,c]),c.track.close())):r.push([Re.LocalAudioTrack,c])}if(s instanceof dn){const c=this.localTrackMap.get(Re.LocalVideoTrack);if(!c)continue;r.push([Re.LocalVideoTrack,c]);const u=this.localTrackMap.get(Re.LocalVideoLowTrack);u&&r.push([Re.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Re.LocalVideoTrack:i.addListener(Ke.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Re.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Re.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ke.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Re.LocalVideoTrack:i.off(Ke.GET_STATS,this.handleGetLocalVideoStats),i.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ke.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ke.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Re.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ke.GET_STATS,this.handleGetLocalAudioStats),r.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ke.GET_STATS,this.handleGetLocalAudioStats),t.off(Ke.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ke.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ke.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ke.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof qp&&r.addListener(Ke.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof Xp&&r.addListener(Ke.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ke.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has($e.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has($e.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,{track:p,type:m}=i;switch(m){case Re.LocalAudioTrack:u=tn.Audio;break;case Re.LocalVideoTrack:u=Ne(c=p._hints).call(c,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:u=tn.Low}return{kind:m===Re.LocalAudioTrack?$e.AUDIO:$e.VIDEO,stream_type:u,mid:r[s].id,ssrcs:r[s].localSSRC,isMuted:p.muted||!p.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var i;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Qe.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),Ne(i=this._restartStates).call(i,r)&&!t.isInRestartIce&&(r==="disconnected"&&await vr(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),ze.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:ln.TRACER}).onSuccess(),this.emit(Qe.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ds.FIRST_FRAME_DECODED),ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,wn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,wn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoReceived=r=>{var i;const s=Array.from(ai(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&ze.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,wn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Qe.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ud(i))," -> ").concat(JSON.stringify(ud(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ud(i))," -> ").concat(JSON.stringify(ud(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Qe.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Ri.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Ri.SEND_ONLY?this.restartICE(t):er(this,Qe.RequestP2PRestartICE,{direction:Ri.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Re.LocalAudioTrack);if(t instanceof Mn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Re.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Re.LocalVideoTrack)){const c=this.localTrackMap.get(Re.LocalVideoLowTrack);c&&r.push([Re.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Re.LocalAudioTrack);if(t instanceof Mn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Re.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Re.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Re.LocalVideoLowTrack);c&&r.push([Re.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:p,id:m}]=r;switch(c){case Re.LocalAudioTrack:s=tn.Audio;break;case Re.LocalVideoTrack:s=Ne(i=u._hints).call(i,Jt.SCREEN_TRACK)?tn.Screen:tn.High;break;case Re.LocalVideoLowTrack:s=tn.Low}return{stream_type:s,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,p]=c;i.push([t,{kind:u,id:p}])});return i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case $e.VIDEO:return void(s._videoSSRC&&r.push({stream_type:$e.VIDEO,ssrcId:s._videoSSRC}));case $e.AUDIO:return void(s._audioSSRC&&r.push({stream_type:$e.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Re.LocalVideoTrack),i=this.localTrackMap.get(Re.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new Pe((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Pe((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Mn){const i=this.filterTobeUnmutedTracks(t[r]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await pn(this,Qe.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Qe.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vr(Pb(this.dtlsFailedCount,Kn)),this.emit(Qe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Re.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof dn).length>1)throw new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Mn).length>1&&(t.some(r=>r instanceof Mn&&r._bypassWebAudio)||!Pt().webAudioMediaStreamDest))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof dn&&this.pendingLocalTracks.some(i=>i instanceof dn))throw new me(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Mn&&this.pendingLocalTracks.some(i=>i instanceof Mn)&&(!Pt().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Mn&&i._bypassWebAudio)))throw new me(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const i=!W("DISABLE_DUAL_STREAM_USE_ENCODING")&&Pt().supportDualStreamEncoding,s=Xx(Xx({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?t._mediaStreamTrack.clone():NI(t,s);const u=Zt(8,"track-low-"),p=new dn(c,Xx(Xx({},i&&{scaleResolutionDownBy:rI(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return p.on(Lu.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Wp.LOW_STREAM)}),p._hints.push(Jt.LOW_STREAM),t.addListener(Ke.NEED_CLOSE,()=>{p.close()}),p}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(ai(c=this.remoteUserMap).call(c)).find(p=>p._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(g=>g.userId===u.uid&&g.type==="video");ze.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,wn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new me(H.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new me(H.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new me(H.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new me(H.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new me(H.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new me(H.NOT_SUPPORTED)}async preConnect(t){throw new me(H.NOT_SUPPORTED)}getEstablishParams(){throw new me(H.NOT_SUPPORTED)}async reSubscribe(t){throw new me(H.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new me(H.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Re.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Wp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},ke(Rn.prototype,"p2pConnect",[C$],Object.getOwnPropertyDescriptor(Rn.prototype,"p2pConnect"),Rn.prototype),ke(Rn.prototype,"unpublish",[N$],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublish"),Rn.prototype),ke(Rn.prototype,"unpublishLowStream",[R$],Object.getOwnPropertyDescriptor(Rn.prototype,"unpublishLowStream"),Rn.prototype),ke(Rn.prototype,"subscribe",[A$],Object.getOwnPropertyDescriptor(Rn.prototype,"subscribe"),Rn.prototype),ke(Rn.prototype,"mockSubscribe",[I$],Object.getOwnPropertyDescriptor(Rn.prototype,"mockSubscribe"),Rn.prototype),ke(Rn.prototype,"unsubscribe",[O$],Object.getOwnPropertyDescriptor(Rn.prototype,"unsubscribe"),Rn.prototype),ke(Rn.prototype,"muteRemote",[P$],Object.getOwnPropertyDescriptor(Rn.prototype,"muteRemote"),Rn.prototype),ke(Rn.prototype,"unmuteRemote",[D$],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteRemote"),Rn.prototype),ke(Rn.prototype,"hasRemoteMediaWithLock",[k$],Object.getOwnPropertyDescriptor(Rn.prototype,"hasRemoteMediaWithLock"),Rn.prototype),ke(Rn.prototype,"disconnectForReconnect",[j$],Object.getOwnPropertyDescriptor(Rn.prototype,"disconnectForReconnect"),Rn.prototype),ke(Rn.prototype,"remoteMediaSsrcChanged",[L$],Object.getOwnPropertyDescriptor(Rn.prototype,"remoteMediaSsrcChanged"),Rn.prototype),Rn);function jo(t){return function(r,i,s){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];switch(t){case ko.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,p)}finally{g()}}case ko.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,p)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i)),v=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,p)}finally{g(),v()}}}},s}}class rh extends Nn{constructor(r,i){super(),M(this,"signal",void 0),M(this,"token",void 0),M(this,"tokenTimeout",void 0),M(this,"tokenInterval",void 0),M(this,"_sequence",0),M(this,"userMap",new Map),M(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const s=()=>{this.signal.connectionState===Lt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*W("P2P_TOKEN_INTERVAL"))};s()}async send(r,i,s,c,u){var p;if(this.userMap.size===0)return;const m=Array.from(va(p=this.userMap).call(p))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=c??Zt(6,""),u=u??this._sequence++;const g={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(m)};W("SHOW_P2P_LOG")&&R.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach(_=>{this.signal.request(Je.DATA_STREAM,{payload:sd(this.encoder.encode(_))})});const v=new Pe((_,E)=>{const w=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),k),this.off(tm.ABORT,U),R.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?E(new me(H.INVALID_REMOTE_USER)):E(new me(H.TIMEOUT))},W("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{w&&window.clearTimeout(w),this.off(tm.ABORT,U),s&&_()},U=()=>{w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),k),E(new me(H.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(tm.ABORT,U),this.once("res-@".concat(c,"_ack"),C);const k=($,K)=>{j=!0,w&&window.clearTimeout(w),this.off("res-@".concat(c,"_ack"),C),this.off(tm.ABORT,U),$==="success"?_(K):E(new me(H.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let j=!1;s||(this.once("res-@".concat(c),k),vr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||R.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await v}catch(_){if(_.code===H.TIMEOUT)return await this.send(r,i,s,c,u);throw _}}onMessage(r){var i;const{_uid:s}=r;let c,u=this.userMap.get(s);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Wn.CHECK)return;const{token:v}=r;c=new Map,u={uid:s,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(gt.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in r&&"total"in r){var p;const{id:v,total:_}=r,E=(p=c.get(v))!==null&&p!==void 0?p:[];if(E.push(r),c.has(v)||c.set(v,E),E.length!==_)return;{const w=vu(E).call(E,(C,U)=>C.index-U.index).map(C=>C.payload).join("");c.delete(v),(r=JSON.parse(w))._uid=s}}const{_type:m,token:g}=r;if(Ne(i=[Wn.ACK,Wn.CHECK]).call(i,m))return m===Wn.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(r);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):R.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:Zt(6,""),token:this.token,_type:Wn.CHECK};W("SHOW_P2P_LOG")&&R.debug("send message",r),this.signal.request(Je.DATA_STREAM,{payload:sd(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Wn.ACK,token:this.token};W("SHOW_P2P_LOG")&&R.debug("send message",i),this.signal.request(Je.DATA_STREAM,{payload:sd(this.encoder.encode(JSON.stringify(i)))})}response(r,i,s){this.send(Wn.RESPONSE,JSON.stringify({success:!s,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:E}=v;for(;_.has(E);){const w=_.get(E);_.delete(E),this.receiveMessage(w),v.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:s,_seq:c}=r,u=this.userMap.get(s),{receivedMessagesMap:p,isStart:m,nextExpectedSequenceNumber:g}=u;if(c<g)return this.ack(r._id),void R.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));p.set(c,r),m&&c===g&&(this.receiveMessage(r),p.delete(g),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:s,_message:c,_uid:u}=r;if(W("SHOW_P2P_LOG")&&R.debug("receive message",r),i){let p;switch(r._type!==Wn.ACK&&(c&&(p=JSON.parse(c)),this.ack(r._id)),r._type){case Wn.CANDIDATE:case Wn.CONTROL:this.signal.emit(s,p,u);break;case Wn.PUBLISH:case Wn.UNPUBLISH:case Wn.RESTART_ICE:case Wn.CALL:p.uid=u,er(this.signal,s,p).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Wn.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Wn.RESPONSE:{const{success:m,message:g}=p;this.emit("res-@".concat(i),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<rh.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:s}=JSON.parse(r),c=Zt(6,"");let u=0,p=800;const m=Math.ceil(r.length/p);for(;r.length>0;){u++;const g={id:c,index:u,total:m,payload:r.slice(0,p),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>rh.MAX_MESSAGE_SIZE?p-=50:(i.push(g),r=r.slice(p))}return i.map(g=>JSON.stringify(g))}handleCheckToken(r,i){return r.token!==i?(R.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(i)),this.reset(r.uid)},W("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await er(this.signal,Wn.CALL,void 0),i=await this.send(Wn.CALL,r);this.signal.emit(Ye.P2P_CONNECTION,i,!0)}async reset(r,i){const s=this.userMap.get(r);s&&(this.emit(tm.ABORT),this.signal.emit(gt.ON_USER_OFFLINE,{uid:s.uid,reason:gve.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(R.debug("change local token from ".concat(i," to ").concat(i)),this.token=Zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(tm.ABORT)}}M(rh,"MAX_SIZE",1),M(rh,"MAX_MESSAGE_SIZE",1024);class t_e extends Nn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Lt.CONNECTED?this.emit(Ye.WS_CONNECTED):r===Lt.RECONNECTING?this.emit(Ye.WS_RECONNECTING,this._websocketReconnectReason):r===Lt.CLOSED&&this.emit(Ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),M(this,"__name__","P2PSignal"),M(this,"_disconnectedReason",void 0),M(this,"_websocketReconnectReason",void 0),M(this,"_connectionState",Lt.CLOSED),M(this,"reconnectToken",void 0),M(this,"p2pToken",void 0),M(this,"websocket",void 0),M(this,"openConnectionTime",void 0),M(this,"clientId",void 0),M(this,"lastMsgTime",Date.now()),M(this,"uploadCache",[]),M(this,"uploadCacheInterval",void 0),M(this,"rttRolling",new sA(5)),M(this,"pingpongTimer",void 0),M(this,"pingpongTimeoutCount",0),M(this,"joinResponse",void 0),M(this,"multiIpOption",void 0),M(this,"initError",void 0),M(this,"spec",void 0),M(this,"store",void 0),M(this,"_external_signal",void 0),M(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Ye.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case gt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case gt.MUTE_AUDIO:case gt.MUTE_VIDEO:case gt.ON_P2P_LOST:case gt.ON_USER_ONLINE:return;case gt.ON_USER_OFFLINE:const{uid:u}=c._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===gt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jt.UID_BANNED);break;case 15:this.close(jt.IP_BANNED);break;case 16:this.close(jt.CHANNEL_BANNED)}if(c._type===gt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case nt.ERR_LICENSE_MISSING:this.close(jt.LICENSE_MISSING);break;case nt.ERR_LICENSE_EXPIRED:this.close(jt.LICENSE_EXPIRED);break;case nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jt.LICENSE_MINUTES_EXCEEDED);break;case nt.ERR_LICENSE_PERIOD_INVALID:this.close(jt.LICENSE_PERIOD_INVALID);break;case nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jt.LICENSE_MULTIPLE_SDK_SERVICE);break;case nt.ERR_LICENSE_ILLEGAL:this.close(jt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new eI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,W("JOIN_GATEWAY_USE_DUAL_DOMAIN"),W("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Wr.OFFLINE)}),this.p2pToken=Zt(6,""),this._external_signal=new rh(this,this.p2pToken)}async request(r,i,s,c){const u=Zt(6,""),p={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new Pe((U,k)=>{if(this.connectionState===Lt.CONNECTED)return U();const j=()=>{this.off(Ye.WS_CLOSED,$),U()},$=()=>{this.off(Ye.WS_CONNECTED,j),k(new me(H.WS_ABORT))};this.once(Ye.WS_CONNECTED,j),this.once(Ye.WS_CLOSED,$)});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||r===Je.JOIN||r===Je.REJOIN||await g(),this.websocket.sendMessage(p,!0),c)return;const v=new Pe((U,k)=>{let j=!1;const $=(J,ne)=>{j=!0,U({isSuccess:J==="success",message:ne||{}}),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.emit(Ye.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{k(new me(H.WS_ABORT,"type: ".concat(r))),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(Ye.WS_CLOSED,K),this.once(Ye.WS_RECONNECTING,K),vr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ye.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===Lt.CLOSED||r===Je.LEAVE)throw new me(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Je.JOIN||r===Je.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),w=$u(E),C=new me(H.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:E,data:_.message,desc:w.desc});return w.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(E,", message: ").concat(w.desc,", action: ").concat(w.action)),E===nt.ERR_TOO_MANY_BROADCASTERS?((r===Je.JOIN||r===Je.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(E===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Wr.MULTI_IP)):this.reconnect(w.action,Wr.SERVER_ERROR),r===Je.JOIN||r===Je.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Pe(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Wu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const p=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}async sendExtensionMessage(r,i,s){return await this._external_signal.send(r,i,s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Pe((i,s)=>{this.once(Ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ye.WS_CLOSED,()=>s(this.initError||new me(H.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(r).catch(s)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||jt.LEAVE,this.connectionState=Lt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Zt(6,""),this._external_signal.clear(),this._external_signal=new rh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ye.ABORT_P2P_EXECUTION);const r=await er(this,Ye.REQUEST_JOIN_INFO),i=await this.request(Je.JOIN,r);if(!i)return this.emit(Ye.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){return!1}handleDataStream(r){try{var i;const s=Ou(r.payload),c=new TextDecoder().decode(s),u=JSON.parse(c);"total"in u&&"id"in u||Ne(i=Object.values(Wn)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(gt.ON_DATA_STREAM,r)}catch{this.emit(gt.ON_DATA_STREAM,r)}}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=$u(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===nt.ERR_REPEAT_JOIN_CHANNEL&&W("IGNORE_UID_CHECK")?void this.close(jt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jt.UID_BANNED),void this.close()):void this.reconnect(i.action,Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Wr.TIMEOUT):this.request(Je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(Je.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(St.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ye.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(St.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(St.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(St.FAILED,()=>{this._disconnectedReason=jt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(St.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(St.WILL_RECONNECT,(r,i,s)=>{r!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(r)}),this.websocket.on(St.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Ye.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof me&&r.code===H.UNEXPECTED_RESPONSE&&r.data.code===nt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Wr.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Wr.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(St.REQUEST_NEW_URLS,(r,i)=>{er(this,Ye.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const n_e={name:"P2PChannel",create:function(t){let{store:r,statsCollector:i}=t;return new e_e(r,i)},createSubmodule:function(t){let{store:r,spec:i}=t;return new t_e(i,r)}};function U$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function F$(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class r_e{constructor(r){M(this,"sessionDesc",void 0),M(this,"localCapabilities",void 0),M(this,"rtpCapabilities",void 0),M(this,"candidates",void 0),M(this,"_originCandidates",void 0),M(this,"iceParameters",void 0),M(this,"dtlsParameters",void 0),M(this,"setup",void 0),M(this,"currentMidIndex",void 0),M(this,"cname",void 0),r=bn(r);const{iceParameters:i,dtlsParameters:s,candidates:c,rtpCapabilities:u,setup:p,localCapabilities:m,sdkCodec:g,cname:v}=r,_=Ti(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=bn(c),this.iceParameters=i,this.dtlsParameters=s,this.setup=p,this.localCapabilities=m,this.cname=v;for(let E=0;E<_.mediaDescriptions.length;E++){const w=_.mediaDescriptions[E];if(w.attributes.iceUfrag=i.iceUfrag,w.attributes.icePwd=i.icePwd,w.attributes.fingerprints=s.fingerprints,w.attributes.candidates=c,w.attributes.setup=p,w.media.mediaType==="video"){w.media.fmts=u.videoCodecs.map(k=>k.payloadType.toString(10));const C=u.videoCodecs.filter(k=>{var j,$;return(j=k.rtpMap)===null||j===void 0?void 0:Ne($=j.encodingName.toLowerCase()).call($,g)}),U=u.videoCodecs.filter(k=>!Ne(C).call(C,k));w.attributes.payloads=[...C,...U],w.attributes.extmaps=u.videoExtensions}w.media.mediaType==="audio"&&(w.media.fmts=u.audioCodecs.map(C=>C.payloadType.toString(10)),w.attributes.payloads=u.audioCodecs,w.attributes.extmaps=u.audioExtensions),_.mediaDescriptions[E]=this.mungMediaDesc(w)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return el(this.sessionDesc)}send(r,i,s){const{ssrcs:c,ssrcGroups:u}=lv(i,this.cname),p=this.sessionDesc.mediaDescriptions.find(v=>r===$e.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return p.attributes.ssrcs=p.attributes.ssrcs.concat(c),p.attributes.ssrcGroups=p.attributes.ssrcGroups.concat(u),{id:m,mslabel:g}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:c}=i;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],c=[],u=[];i.attributes.ssrcs.forEach(p=>{Ne(r).call(r,p.attributes.label||"")?u.push(p):s.push(p)}),i.attributes.ssrcGroups.forEach(p=>{var m;Ne(m=u.map(g=>g.ssrcId)).call(m,p.ssrcIds[0])||c.push(p)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((c,u)=>{const p=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===p.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(i.forEach(c=>{s.push(F$(F$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Rr.TCP_RELAY:this.candidates=s;break;case Rr.UDP_TCP_RELAY:case Rr.RELAY:this.candidates=[...i,...s];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=bn(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=bn(r);return Hu(s,i),sI(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const c=this.sessionDesc.mediaDescriptions.find(p=>r===$e.VIDEO?p.attributes.mid==="video":p.attributes.mid==="audio");if(c){const p=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;p&&(p.attributes.label=s,(u=p.attributes.msid)===null||u===void 0||u.replace(i,s))}}mungMediaDesc(r){const i=bn(r);return aI(i),function(s){const c=s.attributes.extmaps.find(u=>px(u.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(u=>{const p=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");p!==-1&&u.rtcpFeedbacks.splice(p,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}var mn;function V$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Jx(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?V$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):V$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let i_e=(mn=class hy extends cx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Ne(i=Object.keys(ku)).call(i,r)}))]}constructor(r,i){super(r,i),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"remoteSDP",void 0),M(this,"initialOffer",void 0),M(this,"statsFilter",void 0),M(this,"useRTX",!1),M(this,"localCapabilities",void 0),M(this,"localCandidateCount",0),M(this,"allCandidatesReceived",!1),M(this,"establishPromise",void 0),M(this,"mutex",void 0),this.store=i,this.mutex=new Nr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(hy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=Lb(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=gc(r.sdp),s=cv(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=r,Jx(Jx({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:r.sdp})}catch(r){throw new me(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new r_e(Jx(Jx({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new me(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var s=this;return ki(function*(){const c=yield Ct(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(w=>s.peerConnection.addTrack(w._mediaStreamTrack)),p=yield Ct(s.peerConnection.createOffer()),m=Ti(p.sdp),g=r.map(w=>{const C=w._mediaStreamTrack,U=m.mediaDescriptions.find(k=>k.attributes.mid===C.kind);if(!U)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,j,$){const K=k.attributes.ssrcs.filter(ne=>ne.attributes.label===j),J=k.attributes.ssrcGroups;if(K.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(J&&K.length>1){const ne=J.find(ae=>ae.ssrcIds.indexOf(K[0].ssrcId)!==-1);return ne?[{ssrcId:ne.ssrcIds[0],rtx:$?ne.ssrcIds[1]:void 0}]:[{ssrcId:K[0].ssrcId}]}return[{ssrcId:K[0].ssrcId}]}(U,C.id,s.useRTX)});let v;try{v=yield g}catch(w){throw u.forEach(C=>{Cr()&&C.replaceTrack(null),s.peerConnection.removeTrack(C)}),w}const _=s.mungSendOfferSDP(p.sdp,r);s.remoteSDP.receive(r,i,v);const E=s.remoteSDP.toString();return yield Ct(s.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(s.applySendEncodings(u,r)),yield Ct(s.peerConnection.setRemoteDescription({type:"answer",sdp:E})),r.map((w,C)=>{const U=w._mediaStreamTrack.id;return{localSSRC:g[C],id:U}})}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var p;return r.indexOf(((p=u.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Cr()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:p}=this.remoteSDP.send(r,i,c),m=new Pe((_,E)=>{const w=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),C=U=>{const k=$t();if((k.name==="Safari"&&Number(k.version)===11||ii())&&U.track.id!==u&&U.streams[0].id===p){var j;const $=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _($)}if(U.track.id===u)return this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _(U.track)};this.peerConnection.addEventListener("track",C)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:u}}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(s=>{var c;return r.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(s=>{if(Cr()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(u=>u.active=!1),s.setParameters(c)}})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var p;return r.indexOf(((p=u.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Cr()&&u.track)u.track.enabled=!0;else{const p=u.getParameters();p.encodings.forEach(m=>m.active=!0),await u.setParameters(p)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return ki(function*(){const s=yield Ct(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Pt().supportPCSetConfiguration;if(r===Rr.RELAY&&!c)return;if(c){const v=i.peerConnection.getConfiguration(),_=r===Rr.RELAY?"relay":"all";v.iceTransportPolicy!==_&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(_,"]")),v.iceTransportPolicy=_,i.peerConnection.setConfiguration(v))}r!==Rr.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Ct(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const p=gc(u.sdp),{remoteIceParameters:m}=yield p.iceParameters;i.remoteSDP.restartICE(m);const g=i.remoteSDP.toString();yield Ct(i.peerConnection.setLocalDescription(u)),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new me(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});s.length===1&&await this.applySendEncodings(s,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});s&&await s.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new me(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new me(H.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Nu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...hy.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...hy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(v=>{var _;return((_=v.track)===null||_===void 0?void 0:_.id)===r._mediaStreamTrack.id})),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Pt().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof dn)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(W("DSCP_TYPE")&&dc()){var p;const v=W("DSCP_TYPE");Ne(p=["very-low","low","medium","high"]).call(p,v)&&(u.networkPriority=v)}const m=i.getParameters(),g=(s=m.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,u),Object.assign(m,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!Pt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const s=Ti(r);return i.forEach((c,u)=>{const p=c._mediaStreamTrack,m=s.mediaDescriptions.find(g=>g.attributes.mid===p.kind);m&&Hu(m,c)}),el(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,p)=>{let{id:m,mslabel:g}=u;const{kind:v}=r[p];return new Pe((_,E)=>{const w=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(m)))},1e4),C=U=>{const k=$t();if(k.name==="Safari"&&Number(k.version)===11&&U.track.id!==m&&U.streams[0].id===g){var j;const $=U.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,m,U.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _({track:$,id:m})}if(U.track.id===m)return this.peerConnection.removeEventListener("track",C),clearTimeout(w),void _({track:U.track,id:m})};this.peerConnection.addEventListener("track",C)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await Pe.all(i)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(Pt().supportPCSetConfiguration){const i=hy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},ke(mn.prototype,"connect",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"connect"),mn.prototype),ke(mn.prototype,"stopSending",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"stopSending"),mn.prototype),ke(mn.prototype,"receive",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"receive"),mn.prototype),ke(mn.prototype,"stopReceiving",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"stopReceiving"),mn.prototype),ke(mn.prototype,"muteRemote",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"muteRemote"),mn.prototype),ke(mn.prototype,"unmuteRemote",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteRemote"),mn.prototype),ke(mn.prototype,"muteLocal",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"muteLocal"),mn.prototype),ke(mn.prototype,"unmuteLocal",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteLocal"),mn.prototype),ke(mn.prototype,"close",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),ke(mn.prototype,"updateEncoderConfig",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"updateEncoderConfig"),mn.prototype),ke(mn.prototype,"updateSendParameters",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"updateSendParameters"),mn.prototype),ke(mn.prototype,"replaceTrack",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"replaceTrack"),mn.prototype),ke(mn.prototype,"getRemoteSSRC",[gs],Object.getOwnPropertyDescriptor(mn.prototype,"getRemoteSSRC"),mn.prototype),mn);function gs(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}const a_e={name:"PlanBConnection",create:function(t){let{store:r,spec:i}=t;return new i_e(i,r)}},s_e={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Pt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(qb.has(t)||!t.track)return;const i={track:t.track};if(Qc()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(p){return void R.error("create audio-encoded-streams error",p&&p.message)}const u=new TransformStream({transform(p,m){i.controller||(i.controller=m),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const g=r.metadata&&r.metadata();g?function(v,_){const{chunk:E,controller:w}=_,C=od.METADATA;E.data=function(U,k,j){const $=j.byteLength,K=$+MA+D6,J=jA+LA+K,ne=new ArrayBuffer(U.byteLength+J),ae=new DataView(ne);ae.setUint8(0,P6),ae.setUint16(1,K),ae.setUint8(3,k),ae.setUint16(4,$);for(let oe=0;oe<$;oe++)ae.setUint8(6+oe,j[oe]);const ee=new Uint8Array(ae.buffer);return ee.set(new Uint8Array(U),J),ee.buffer}(E.data,C,v),w.enqueue(E)}(g,{chunk:p,controller:m}):m.enqueue(p)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Cr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=Yb(),u=new MessageChannel;await new Pe(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const p=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=p,await new Pe(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&u.port1.postMessage({metadata:v})}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=qb.get(t);if(c){qb.delete(t);try{var u,p;(u=c.controller)===null||u===void 0||u.terminate(),(p=c.worker)===null||p===void 0||p.terminate()}catch(m){R.warning(m&&m.message)}}}qb.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Pt().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(tx.has(t))return;const i={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(Qc()&&!ii()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");zR(zt.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(p){return void R.error("create audio-encoded-streams error",p&&p.message)}const u=new TransformStream({transform(p,m){i.controller||(i.controller=m),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)),r.enableTopn?function(g,v,_){var E;const w=UA(new DataView(v.data));if(!w)return _.enqueue(v);const C=g.track.id;Mge.set(C,g.track);const U=(E=w.tlv.find(ne=>ne.tag===od.AUDIO_LEVEL))===null||E===void 0?void 0:E.value;let k=0;typeof U=="number"&&(k=127-U);const j=Math.round(Math.pow(10,k/60)-1),{selected:$,speaker:K}=function(ne,ae){let ee=Jp.get(ne);if(ee||(ee=function(oe){const ve=new j6;return Jp.set(oe,ve),Co||(Co=new jge(W("TOPN_SILENCE_THRESHOLD")||500),Co.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(Qb=Ee)})),Co.addSpeakers([ve]),ve}(ne)),Jp.size<=L6)return{selected:!0,speaker:ee};if(!Co)throw new Error("no active speaker detector");return Co.levelChanged(ee.id,ae),Vu=Co.loudest.map(oe=>oe.id),Qb&&!Ne(Vu).call(Vu,Qb)&&Vu.length>=L6&&Vu.pop(),{selected:Ne(Vu).call(Vu,ee.id)||ee.id===Qb,speaker:ee}}(g,j),J=function(ne,ae,ee){const oe=No.get(ne)||new Lge(ne,ae);return oe.score=ee,No.set(ne,oe),function(ve){if(Zb.set(ve,!0),!ex)return void(ex=Date.now());const Ee=Date.now();Ee-ex>1e3&&(Zb.get(ve)?Zb.set(ve,!1):(M6(ve),Zb.delete(ve)),ex=Ee)}(ne),oe}(C,g.track,K.energyScore);J.addSample($),J.active&&(v.data=w.frame.buffer,_.enqueue(v))}(t,p,m):r.enableMetadata||r.enablePts?function(g,v,_,E){const w=new DataView(g.data),C=w.getUint8(0);let U;if(128&C&&C!==71){const $=function(K){if(K.byteLength<=0)return[];const J=[];let ne=0;for(;ne<K.byteLength;){const ee=(128&K.getUint8(ne))>>7,oe=127&K.getUint8(ne);if(!(ee&&ne+4<=K.byteLength)){ne++;break}{const ve=K.getUint32(ne,!1),Ee=(16776192&ve)>>10,Be=1023&ve;J.push({pt:oe,ts_offset:Ee,length:Be,data:new Uint8Array}),ne+=4}}let ae=K.byteLength-ne;for(const ee of J){if(ee.length>ae)return console.warn("Broken red payload"),[];ee.length>0&&(ee.data=new Uint8Array(K.buffer,K.byteOffset+ne,ee.length),ne+=ee.length,ae-=ee.length)}if(ae>0){const ee={pt:J.length>0?J[J.length-1].pt:0,ts_offset:0,length:ae,data:new Uint8Array(K.buffer,K.byteOffset+ne,ae)};J.push(ee)}return J}(w);if($.length>0){const K=function(J){let ne=0;for(let oe=0;oe<J.length;oe++)ne+=oe<J.length-1?4:1,ne+=J[oe].length;const ae=new Uint8Array(ne);let ee=0;for(let oe=0;oe<J.length;oe++)if(oe<J.length-1){const ve=(2147483648|(127&J[oe].pt)<<24|(262143&J[oe].ts_offset)<<10|1023&J[oe].length)>>>0;ae[ee++]=ve>>24&255,ae[ee++]=ve>>16&255,ae[ee++]=ve>>8&255,ae[ee++]=255&ve}else ae[ee++]=127&J[oe].pt;for(const oe of J)ae.set(oe.data,ee),ee+=oe.length;return ae}($.map(J=>{const ne=new Uint8Array(J.length);ne.set(J.data);const ae=UA(new DataView(ne.buffer));return ae!=null&&ae.frame&&(J.data=ae==null?void 0:ae.frame),U=ae,J}));g.data=K.buffer}}else U=UA(w),U&&(g.data=U.frame.buffer);if(v.enqueue(g),!U)return;const k=U.tlv.find($=>$.tag===od.METADATA);k&&_&&k.value instanceof Uint8Array&&_(k.value);const j=U.tlv.find($=>$.tag===od.AUDIO_64_BIT_PTS);j&&E&&j.value instanceof Uint8Array&&j.value.length==8&&E(new DataView(j.value.buffer).getBigUint64(0,!0))}(p,m,r.onMetadata,r.onPts):m.enqueue(p)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=Yb(),u=new MessageChannel;await new Pe(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const p=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=p,await new Pe(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id?(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)):m.data.metadata&&i.onMetadata?i.onMetadata(m.data.metadata):m.data.pts&&i.onPts&&i.onPts(m.data.pts)},i.worker=c}function s(){t.track.removeEventListener("ended",s),function(c){const u=tx.get(c);if(u){(function(g){const v=Jp.get(g);v&&(Jp.delete(g),Co&&(Co.removeSpeakers([v]),Jp.size===0&&(Co.destroy(),Co=null)))})(c),M6(c.track.id),tx.delete(c);try{var p,m;(p=u.controller)===null||p===void 0||p.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){R.warning(g&&g.message)}}}(t)}tx.set(t,i),t.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(t,r){if(!Pt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(nx.has(t)||!t.track)return;const i={track:t.track};if(Qc()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void R.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const p=new TransformStream({transform(m,g){i.controller||(i.controller=g),t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=V6(new Uint8Array(m.data)),_=u.shift();if(_){const E=function(w,C,U){switch(U){case GA:return function(k,j){const $=F6(j),K=$.length,J=Math.floor(K/255),ne=K%255,ae=new Uint8Array(6+J+1+K+k.byteLength);ae[0]=0,ae[1]=0,ae[2]=0,ae[3]=1,ae[4]=6,ae[5]=101;let ee=0;for(;ee<J;)ae[6+ee]=255,ee++;return ae[6+ee]=ne,ee++,ae.set($,6+ee),ae.set(new Uint8Array(k),6+ee+K),ae.buffer}(w,C);case WA:return function(k,j){const $=F6(j),K=$.length,J=Math.floor(K/255),ne=K%255,ae=new Uint8Array(7+J+1+K+1+k.byteLength);ae[0]=0,ae[1]=0,ae[2]=0,ae[3]=1,ae[4]=78,ae[5]=1,ae[6]=101;let ee=0;for(;ee<J;)ae[7+ee]=255,ee++;return ae[7+ee]=ne,ee++,ae.set($,7+ee),ee+=K,ae[7+ee]=128,ee++,ae.set(new Uint8Array(k),7+ee),ae.buffer}(w,C);default:return null}}(m.data,_,v);E&&(m.data=E)}g.enqueue(m)}});c.readable.pipeThrough(p).pipeTo(c.writable)}else{if(!Cr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=Yb(),u=new MessageChannel;await new Pe(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const p=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=p,await new Pe(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s))},i.worker=c}}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=nx.get(t);if(c){nx.delete(t);try{var u,p;(u=c.controller)===null||u===void 0||u.terminate(),(p=c.worker)===null||p===void 0||p.terminate()}catch(m){R.warning(m&&m.message)}}}nx.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Pt().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!t.track)return;if(iv.has(t)){const c=iv.get(t);return void(c&&(c.onSei=r.onSei))}const i={track:t.track,onSei:r.onSei};if(Qc()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(p){return void R.error("create video-encoded-streams error",p&&p.message)}const u=new TransformStream({transform(p,m){if(i.controller||(i.controller=m),!i.firstFrameInfo){var g;const _=p.getMetadata()||{};i.firstFrameInfo=vn({type:p.type,rtpTimestamp:p.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:p.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(g=r.onFirstFrame)===null||g===void 0||g.call(r,i.firstFrameInfo)}t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const v=function(_,E){switch(E){case GA:return function(w){const C=new DataView(w.data);let U=0;for(;U+4<w.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===6){let k=U+6,j=0,$=0;for(;($=C.getUint8(k++))===255;)j+=255;j+=$;const K=U6(w.data,k,j);return new Uint8Array(K)}U++}return null}(_);case WA:return function(w){const C=new DataView(w.data);let U=0;for(;U+5<w.data.byteLength;){if(C.getUint8(U+0)===0&&C.getUint8(U+1)===0&&C.getUint8(U+2)===0&&C.getUint8(U+3)===1&&C.getUint8(U+4)===78&&C.getUint8(U+5)===1&&C.getUint8(U+6)===101){let k=U+7,j=0,$=0;for(;($=C.getUint8(k++))===255;)j+=255;j+=$;const K=U6(w.data,k,j);return new Uint8Array(K)}U++}return null}(_);default:return null}}(p,V6(new Uint8Array(p.data)));v&&i.onSei&&i.onSei(v),m.enqueue(p)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Cr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=Yb(),u=new MessageChannel;await new Pe(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const p=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=p,await new Pe(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(m.data.sei&&i.onSei)i.onSei(m.data.sei);else if(m.data.firstFrameInfo&&r.onFirstFrame){var v;(v=r.onFirstFrame)===null||v===void 0||v.call(r,m.data.firstFrameInfo)}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}(function(c){const u=iv.get(c);if(u){iv.delete(c);try{var p,m;(p=u.controller)===null||p===void 0||p.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){R.warning(g&&g.message)}}})(t)}iv.set(t,i),t.track.addEventListener("ended",s)}},o_e={name:"InterceptFrame",create:()=>s_e};var Gt;function B$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Lo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?B$(Object(i),!0).forEach(function(s){M(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):B$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let c_e=(Gt=class Rm extends cx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Ne(i=Object.keys(ku)).call(i,r)}))]}constructor(r,i,s){super(r,i),M(this,"id",Zt(5,"connection-")),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"forceTurn",!1),M(this,"remoteSDP",void 0),M(this,"initialOffer",void 0),M(this,"transportEventReceiver",void 0),M(this,"statsFilter",void 0),M(this,"extension",{useXR:W("USE_XR")}),M(this,"localCapabilities",void 0),M(this,"remoteCodecs",void 0),M(this,"localCandidateCount",0),M(this,"allCandidatesReceived",!1),M(this,"isPreallocation",!1),M(this,"preMediaMap",new Map),M(this,"dataStreamChannelMap",new Map),M(this,"establishPromise",void 0),M(this,"recoveredDataChannelIds",[]),M(this,"currentDataChannelId",1),M(this,"supportAV1RtpSpec",!1),M(this,"mutex",void 0),M(this,"qualityLimitationReason",Fp.NONE),M(this,"isFirstConnected",!1),this.store=i,this.forceTurn=CI(r),this.mutex=new Nr("NVConnectionExtension-mutex",i.clientId),this.peerConnection=s,this.isFirstConnected=!1,this.statsFilter=Lb(this.peerConnection,W("STATS_UPDATE_INTERVAL"),void 0,_n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gc(i.sdp),c=await cI({filterRTX:!W("USE_PUB_RTX")&&!W("USE_SUB_RTX"),filterVideoFec:W("FILTER_VIDEO_FEC"),filterAudioFec:W("FILTER_AUDIO_FEC"),filterVideoCodec:W("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:W("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:W("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=dv(c),this.initialOffer=i,W("ENABLE_SVC")&&this.store.codec=="av1"){const p=await m8();var r;p&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(p))}let u;return i.sdp&&fx(i.sdp)&&(u=bn(c),s8(u)),Lo(Lo({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new me(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&fx(this.initialOffer.sdp)&&o8(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new F8(Lo(Lo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!W("ENABLE_PRE_SUB_WITH_PRE_PC")||!W("PRE_USE_LOCAL_CODECS"))&&tv(this.store),!0),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=lI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),tv(this.store))if(r.preallocation&&W("ENABLE_PRE_SUB_WITH_PRE_PC")){const p=W("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(p);await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{const{preSSRCs:p=[]}=r,m=p.map(v=>v.ssrcMsg[0].ssrcId);if(p.length===0)return;const{mids:g}=this.remoteSDP.batchSend(p.map(v=>Object.assign({},v)));await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const p=u.receiver.track;let m;p.kind==="video"&&W("ENABLE_PRE_RENDER")&&(m=new zb({trackId:"track-".concat(p.kind,"-unknown-").concat(this.store.clientId,"_").concat(Zt(5,""))},!0),m.updateVideoTrack(p),m.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(i[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[c],{mid:s,track:p,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const p=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||p}const{preSSRCs:c=[]}=r,u=c.map(p=>p.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const p=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[v,{mid:_,player:E,track:w}]=g;return p.push(_),m.push(v),this.preMediaMap.delete(v),E&&E.destroy(),!0}),p.length>0&&(this.remoteSDP.stopSending(p),await Qi(this.peerConnection,this.remoteSDP,this.extension),R.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),ze.reportApiInvoke(this.store.sessionId,{name:Sn.PRELOAD_MEDIA_FAILED,options:[c,m],tag:ln.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(v=>Object.assign({},v)));await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):R.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return ki(function*(){const u=yield Ct(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const p=[],m=ov();r.forEach(j=>{const $=c.peerConnection.addTransceiver(j._mediaStreamTrack,Lo({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));p.push($),j._updateRtpTransceiver($)}),_n()&&W("SIMULCAST")===!0&&(yield Ct(c.applySimulcastForFirefox(p,r)));const g=yield Ct(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,v),E=Ti(_),w=v.map(j=>{const $=E.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return iI($,W("USE_PUB_RTX"))});let C;try{C=yield w}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const $=c.remoteSDP.toString();throw yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Ct(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,i,s,C);const U=c.remoteSDP.toString(),k=c.logSDPExchange(_,"offer","local","send");return yield Ct(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Ct(c.applySimulcastEncodings(p,r)),yield Ct(c.applySendEncodings(p,r)),k==null||k(U),yield Ct(c.peerConnection.setRemoteDescription({type:"answer",sdp:U})),p.map((j,$)=>{const K=v[$];return{localSSRC:w[$],id:K,transceiver:j}})}catch(p){throw p instanceof me?p:new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(p.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:W("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p),R.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else R.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof me?s:new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof me?i:new me(H.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(g=>{var v;cm(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)});const u=await this.peerConnection.createOffer(),p=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();p==null||p(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:p}=this.remoteSDP.send(r,i,s,c);p&&(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await Qi(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(p=>p.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(p=>{let[m,{mid:g,player:v}]=p;if(g===u)return this.preMediaMap.delete(m),v&&v.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(p=>{p.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(p=>p.mid&&r.indexOf(p.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(p,m)=>{p.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new me(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return ki(function*(){const s=yield Ct(i.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Pt().supportPCSetConfiguration,u=W("FORCE_TURN_TCP")||i.forceTurn;if(r===Rr.RELAY&&!c)return;if(c&&!u){const E=r===Rr.RELAY?"relay":"all",w=i.peerConnection.getConfiguration();w.iceTransportPolicy!==E&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(w.iceTransportPolicy,"] to [").concat(E,"]")),w.iceTransportPolicy=E,i.peerConnection.setConfiguration(w))}i.remoteSDP.updateCandidates(r);const p=yield Ct(i.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=gc(p.sdp),{remoteIceParameters:g}=yield m.iceParameters;i.remoteSDP.restartICE(g);const v=i.remoteSDP.toString(),_=i.logSDPExchange(p.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Ct(i.peerConnection.setLocalDescription(p)),_==null||_(v),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Rr.TCP_RELAY),await Qi(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{cm(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Lo(Lo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),p=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),p==null||p(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new me(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?_n()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Lo(Lo({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Lo(Lo({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=fc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},W("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(Nu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:W("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(W("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...Rm.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...Rm.newTurnServerConfigToIceServers(r.turnServer.servers)),W("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...Rm.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Rm.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Pt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=W("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const p=c.address+":"+c.port,m=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fc(p)),", remote ").concat(JSON.stringify(fc(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Pt().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},p={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=i8(this.peerConnection,r._mediaStreamTrack),g=KV(r);if(H8(r)&&m&&i&&g&&this.getLocalVideoStats&&Ne(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const k=u.degradationPreference||(Ne(v=r._hints).call(v,Jt.CUSTOM_TRACK)?W("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");z8(this.id+m.mid,g,this,k,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:k,frameRate:j,scaleResolutionDownBy:$}=r._encoderConfig;k&&(p.maxBitrate=1e3*k),(Ne(_=r._hints).call(_,Jt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(p.maxFramerate=Fi(j)),$&&$>=1&&(p.scaleResolutionDownBy=$))}const{maxFramerate:E}=W("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(p.maxFramerate=p.maxFramerate?Math.min(p.maxFramerate,E):E),W("DSCP_TYPE")&&dc()){var w;const k=W("DSCP_TYPE");Ne(w=["very-low","low","medium","high"]).call(w,k)&&(p.networkPriority=k)}const C=i.getParameters(),U=(c=C.encodings)===null||c===void 0?void 0:c[0];_n()&&!U&&(u.encodings=[p]),U&&Object.assign(U,p),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await v8(this.store.codec,i,W("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!Pt().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:p,frameRate:m,scaleResolutionDownBy:g}=i;p&&(u.maxBitrate=1e3*p),m&&(u.maxFramerate=Fi(m)),g&&g>=1&&Ne(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const v=r.getParameters(),_=(c=v.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(v,{});try{await r.setParameters(v),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(E){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!Pt().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof dn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ti(r);return i.forEach((u,p)=>{const m=s[p],g=c.mediaDescriptions.find(v=>v.attributes.mid===m);g&&(Hu(g,u),oI(g,u,this.store.codec))}),el(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,p,m;const v=r[g],_=i[g];if(_ instanceof dn&&!Ne(s=_._hints).call(s,Jt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(p=_._scalabilityMode)!==null&&p!==void 0&&p.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},w={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:w.high}];const C=v.sender.getParameters();await v.sender.setParameters(Object.assign(C,E))}}}async applySimulcastEncodings(r,i){if(!_n()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof dn&&this.isVP8Simulcast(c)){const u=r[s],p={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,p))}}}isVP8Simulcast(r){var i,s,c,u,p;return!!(r instanceof dn&&W("SIMULCAST")&&this.store.codec==="vp8"&&!Ne(i=r._hints).call(i,Jt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((p=r._scalabilityMode)===null||p===void 0?void 0:p.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during NVConnectionExtension.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(Pt().supportPCSetConfiguration){const i=Rm.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},ke(Gt.prototype,"updateRemoteRTPCapabilities",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateRemoteRTPCapabilities"),Gt.prototype),ke(Gt.prototype,"connect",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"connect"),Gt.prototype),ke(Gt.prototype,"updateRemoteConnect",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateRemoteConnect"),Gt.prototype),ke(Gt.prototype,"createDataChannels",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"createDataChannels"),Gt.prototype),ke(Gt.prototype,"receive",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"receive"),Gt.prototype),ke(Gt.prototype,"batchReceive",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"batchReceive"),Gt.prototype),ke(Gt.prototype,"stopReceiving",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"stopReceiving"),Gt.prototype),ke(Gt.prototype,"muteRemote",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"muteRemote"),Gt.prototype),ke(Gt.prototype,"unmuteRemote",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteRemote"),Gt.prototype),ke(Gt.prototype,"muteLocal",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"muteLocal"),Gt.prototype),ke(Gt.prototype,"unmuteLocal",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteLocal"),Gt.prototype),ke(Gt.prototype,"close",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),ke(Gt.prototype,"updateEncoderConfig",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateEncoderConfig"),Gt.prototype),ke(Gt.prototype,"updateSendParameters",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateSendParameters"),Gt.prototype),ke(Gt.prototype,"replaceTrack",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"replaceTrack"),Gt.prototype),ke(Gt.prototype,"updateAdaptation",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateAdaptation"),Gt.prototype),ke(Gt.prototype,"getRemoteSSRC",[Gi],Object.getOwnPropertyDescriptor(Gt.prototype,"getRemoteSSRC"),Gt.prototype),Gt);function Gi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From NVConnectionExtension.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}var rn;function G$(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=_b,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new Qx(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Qx(t){function r(i){if(Object(i)!==i)return Pe.reject(new TypeError(i+" is not an object."));var s=i.done;return Pe.resolve(i.value).then(function(c){return{value:c,done:s}})}return Qx=function(i){this.s=i,this.n=i.next},Qx.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?Pe.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?Pe.reject(i):r(s.apply(this.s,arguments))}},new Qx(t)}let l_e=(rn=class eS extends cx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(r,i){super(r,i),M(this,"name","DataChannelConnection"),M(this,"store",void 0),M(this,"peerConnection",void 0),M(this,"cname",void 0),M(this,"mutex",new Nr("DataChannelConnection-mutex")),M(this,"dataChannel",void 0),M(this,"_p2pConnection",void 0),M(this,"establishPromise",void 0),M(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(eS.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new c_e(r,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(r){var i;return(i=this._p2pConnection)===null||i===void 0?void 0:i.getPreMedia(r)}isPreSub(){var r,i;return(r=(i=this._p2pConnection)===null||i===void 0?void 0:i.isPreSub())!==null&&r!==void 0&&r}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(r){return this._p2pConnection.updateRtpSenderEncodings(r)}async connect(r){return this.cname=r.cname,await this._p2pConnection.connect(r),await new Pe((i,s)=>{const c=setTimeout(()=>{this.closeSignal(),s(new ce(H.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r.candidates))))},W("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void i()},this.dataChannel.onerror=u=>{this.closeSignal(),s(u)},this.dataChannel.addEventListener("close",()=>{s(new ce(H.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(r,i){return this._p2pConnection.updateRemoteRTPCapabilities(r,i)}send(r,i,s){var c=this;return ki(function*(){const u=yield Ct(c.mutex.lock("From DataChannelConnection.send"));try{return yield*Dp(G$(c._p2pConnection.send(r,i,s)))}finally{u()}})()}async stopSending(r,i){return this._p2pConnection.stopSending(r,i)}async createDataChannels(r,i){return this._p2pConnection.createDataChannels(r,i)}async stopDataChannels(r){return this._p2pConnection.stopDataChannels(r)}async receive(r,i,s,c){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(r," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(r,i,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(r," by WebRTC.")),await this._p2pConnection.receive(r,i,s,c))}async batchReceive(r){return[...await this._p2pConnection.batchReceive(r)]}async stopReceiving(r){return await this._p2pConnection.stopReceiving(r)}async muteRemote(r){return await this._p2pConnection.muteRemote(r)}async unmuteRemote(r){return await this._p2pConnection.unmuteRemote(r)}async muteLocal(r){return await this._p2pConnection.muteLocal(r)}async unmuteLocal(r){return await this._p2pConnection.unmuteLocal(r)}restartICE(r){var i=this;return ki(function*(){return yield*Dp(G$(i._p2pConnection.restartICE(r)))})()}close(){var r;(r=this._nvMedia)===null||r===void 0||r.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(r){return this._p2pConnection.getRemoteVideoIsReady(r)}updateRemoteConnect(r){var i;return(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(r),this._p2pConnection.updateRemoteConnect(r)}async updateEncoderConfig(r,i){return await this._p2pConnection.updateEncoderConfig(r,i)}async updateSendParameters(r,i){return await this._p2pConnection.updateSendParameters(r,i)}setStatsRemoteVideoIsReady(r,i){this._p2pConnection.setStatsRemoteVideoIsReady(r,i)}async replaceTrack(r,i){return await this._p2pConnection.replaceTrack(r,i)}async getRemoteSSRC(r){return this._p2pConnection.getRemoteSSRC(r)}logSDPExchange(r,i,s,c){if(W("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Nu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...eS.turnServerConfigToIceServers(r.turnServer.servers)),W("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...eS.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),W("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),W("ENABLE_ENCODED_TRANSFORM")&&Pt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!W("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=r=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onConnectionStateChange=r=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportStateChange=r=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportError=r=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onICETransportStateChange=r=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioReceived=r=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoReceived=r=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioDecoded=r=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoRender=r=>{var i;return(i=this.onFirstVideoRender)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoBufferReady=r=>{var i;return(i=this.onFirstVideoBufferReady)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoDecoded=(r,i,s)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,r,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=r=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onSelectedLocalCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedLocalCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}setConfiguration(r){this._p2pConnection.setConfiguration(r)}},ke(rn.prototype,"connect",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),ke(rn.prototype,"updateRemoteRTPCapabilities",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"updateRemoteRTPCapabilities"),rn.prototype),ke(rn.prototype,"createDataChannels",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"createDataChannels"),rn.prototype),ke(rn.prototype,"receive",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),ke(rn.prototype,"stopReceiving",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),ke(rn.prototype,"muteRemote",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"muteRemote"),rn.prototype),ke(rn.prototype,"unmuteRemote",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteRemote"),rn.prototype),ke(rn.prototype,"muteLocal",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),ke(rn.prototype,"unmuteLocal",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),ke(rn.prototype,"close",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),ke(rn.prototype,"updateEncoderConfig",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),ke(rn.prototype,"updateSendParameters",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),ke(rn.prototype,"replaceTrack",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),ke(rn.prototype,"getRemoteSSRC",[$a],Object.getOwnPropertyDescriptor(rn.prototype,"getRemoteSSRC"),rn.prototype),rn);function $a(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From DataChannelConnection.".concat(r));try{for(var p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function W$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class d_e extends Nn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Ne(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(lr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(lr.CONNECTED):this._state==="closed"?this.emit(lr.CLOSED):this._state==="failed"&&this.emit(lr.FAILED))}constructor(r,i,s,c){super(),M(this,"connectionID",0),M(this,"currentURLIndex",0),M(this,"reconnectReason",void 0),M(this,"_reconnectMode","tryNext"),M(this,"_initMutex",void 0),M(this,"_name",void 0),M(this,"_state","closed"),M(this,"_reconnectInterrupter",void 0),M(this,"_url",void 0),M(this,"_retryConfig",void 0),M(this,"_reconnectCount",0),M(this,"_forceCloseTimeout",5e3),M(this,"_onlineReconnectListener",void 0),M(this,"_closeEstablishingTransmitter",()=>{}),M(this,"_store",void 0),M(this,"_joinChannelServiceRecordIndex",void 0),M(this,"_transmitter",void 0),M(this,"_useCompress",void 0),M(this,"_inflateLength",0),M(this,"_deflateLength",0),this._store=c,this._name=r,this._retryConfig=function(u){for(var p=1;p<arguments.length;p++){var m=arguments[p]!=null?arguments[p]:{};p%2?W$(Object(m),!0).forEach(function(g){M(u,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(m)):W$(Object(m)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(m,g))})}return u}({},i),this._useCompress=s}resetReconnectCount(r){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(r)),this._reconnectCount=0}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=r?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(r,i){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((s=this._store)===null||s===void 0||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const r=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:r,deflateLength:i}}setInflateData(r){this._deflateLength=this._deflateLength+r.originLength,this._inflateLength=this._inflateLength+r.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Mo=function(t){return t[t.Default=0]="Default",t[t.Ack=1]="Ack",t}({});class u_e{constructor(r,i,s){M(this,"version",1),M(this,"initialRTO",void 0),M(this,"maxBatchAckCount",void 0),M(this,"maxRTO",void 0),M(this,"initialRTT",void 0),M(this,"ID",void 0),M(this,"rtt",void 0),M(this,"packetNumber",1),M(this,"rtoRatioMap",new Map),M(this,"timeoutMap",new Map),M(this,"unorderedPacketQueue",[]),M(this,"batchAckPacketQueue",[]),M(this,"lastOrderedPacketNumber",0),M(this,"batchAckTimer",void 0),M(this,"sendImpl",void 0),M(this,"receiveImpl",void 0),this.sendImpl=r,this.receiveImpl=i,this.ID=Zt(7,"transmitter-"),this.initialRTO=(s==null?void 0:s.initialRTO)!==void 0?s.initialRTO:W("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:W("TRANSMITTER_INITIAL_RTT"),this.rtt=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:W("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(s==null?void 0:s.maxBatchAckCount)!==void 0?s.maxBatchAckCount:W("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(s==null?void 0:s.maxRTO)!==void 0?s.maxRTO:W("TRANSMITTER_MAX_RTO")}packetize(r,i){return{type:Mo.Default,version:this.version,packetNumber:i,payload:r}}serialize(r){switch(r.type){case Mo.Default:{let i;typeof r.payload=="string"?i=new TextEncoder().encode(r.payload):i=r.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,r.version),c.setUint8(2,r.type),c.setUint32(3,r.packetNumber),GF(c,7,BigInt(r.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case Mo.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,r.version),s.setUint8(2,r.type),s.setUint32(3,r.maxAckPacketNumber),s.setUint8(7,r.shift),GF(s,8,BigInt(r.ackSendTs)),i}}}deserialize(r){const i=new DataView(r),s=i.getUint16(0),c=i.getUint8(2);switch(c){case Mo.Default:{const u=i.getUint32(3),p=BF(i,7),m=r.slice(15),g=new Uint8Array(m);return{version:s,type:c,packetNumber:u,sendTs:Number(p),payload:g}}case Mo.Ack:{const u=i.getUint32(3),p=i.getUint8(7),m=BF(i,8);return{version:s,type:c,maxAckPacketNumber:u,shift:p,ackSendTs:Number(m)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(r){W("DC_DEBUG_LOG")&&typeof r=="string"&&R.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(r));const i=this.packetize(r,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(r){const i=this.deserialize(r);i.type===Mo.Default?this.ack(i):i.type===Mo.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(r=>{let[i,s]=r;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(r){const i=this.calculateRTO(r),s=window.setTimeout(()=>{W("DC_DEBUG_LOG")&&typeof r.payload=="string"&&R.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(r.payload),"timeout: ".concat(i)),this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}calculateRTO(r){const i=this.rtoRatioMap.get(r.packetNumber);if(i===void 0)return this.rtoRatioMap.set(r.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(r.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(r,i){const s=r.ackSendTs;this.rtt=this.rtt*(7/8)+(i-s-this.rtt)/8}ack(r){if(r.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(r):(this.batchAckPacketQueue.push(r),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(r.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(r.packetNumber<=this.lastOrderedPacketNumber){const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Mo.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}else if(r.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[r.packetNumber-this.lastOrderedPacketNumber-2]=r;const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Mo.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const r={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Mo.Ack,version:this.version};W("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending batch ack packet"),r,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(r),this.batchAckPacketQueue=[]}sendPacket(r){r.type===Mo.Default&&(r.sendTs=Math.round(performance.now()));const i=this.serialize(r);this.sendImpl(i)}clearRTO(r){for(let i=r.maxAckPacketNumber-r.shift;i<=r.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);s!==void 0&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class $$ extends d_e{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),M(this,"_initMutex",void 0),M(this,"_reconnectInterrupter",void 0),M(this,"_url",void 0),M(this,"_transmitter",void 0),M(this,"_addresses",void 0),M(this,"_reliableTransmission",void 0),M(this,"_textEncoder",void 0),M(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Nr("datachannel");const{timeout:s,timeoutFactor:c}=i,u=Math.max(300,Math.floor(3*s/5)),p=Math.max(1.2,Math.floor(8*c)/10);wi.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=p),Pn.on(Ru.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===wi.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=p):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;const s=(c,u)=>{this._addresses=r,this.currentURLIndex=this._addresses.findIndex(m=>m.fingerprint||W("FINGERPRINT"));const p=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(p).then(c).catch(u),this.once(lr.CLOSED,()=>u(new ce(H.WS_DISCONNECT))),this.once(lr.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new Pe((u,p)=>{s(u,p)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ce(H.WS_ABORT,"datachannel is not ready");try{i||(r=JSON.stringify(r));const s=this._textEncoder.encode(r),c=S0e(s,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(s){throw new ce(H.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(r){const i=JSON.stringify(r);return{compressed:i,compressedLength:i.length,origin:r}}sendMessageWithUint8Array(r){return{compressed:r,compressedLength:r.byteLength,origin:r}}createTransmitterConnection(r){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(r.ip,":").concat(r.port),new Pe((i,s)=>{var c;const u=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),i()},p=async _=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const w=ba(this,lr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,C=await this.reconnectWithAction(w);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!C)return s(new ce(H.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);i()}else s(new ce(H.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},m=async _=>{try{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(_.data)}catch(w){console.log(w)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(r)));const g=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();er(this,lr.TO_CONNECT_DATACHANNEL).then(_=>{var E,w;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:C,close:U}=_;this._transmitter=C,(E=this._store)===null||E===void 0||E.signalChannelOpen();const k=Date.now()-v;R.debug("[choose dc] dc open cost ".concat(k,"ms")),this._reliableTransmission=new u_e(j=>{var $;this._transmitter&&this._transmitter.readyState==="open"&&(($=this._transmitter)===null||$===void 0||$.send(j))},j=>{if(typeof j=="string")this.emit(lr.ON_MESSAGE,j);else{const $=T0e(j,{raw:!0}).buffer,K=this._textDecoder.decode($);this.emit(lr.ON_MESSAGE,K)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,U()},u&&u(),C.onclose=p,C.onmessage=m,(w=this._store)===null||w===void 0||w.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(_=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:_ instanceof ce&&_.code===H.WS_ABORT?"aborted":"error",errors:[_]},g),this.state!=="closed"){if(_ instanceof ce&&_.code===H.WS_ERR){const w=new ce(H.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(w)),void s(w)}p&&p(_)}else s(new ce(H.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Pn.networkState!==wi.OFFLINE||(this._onlineReconnectListener=Pn.onlineWaiter&&Pn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let s=!0;if(this._reconnectInterrupter=()=>{s=!1},i){const m=Pb(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(m,"ms to reconnect datachannel, mode: ").concat(r)),await Pe.race([vr(m),this._onlineReconnectListener||new Pe(()=>{})])}if(this.state==="closed"||!s)return!1;this._reconnectCount+=1;const c=async(m,g)=>{this.emit(lr.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(m)};try{if(r==="retry"){const m=this._addresses[this.currentURLIndex];await c(m,r)}else if(r==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||W("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const m=this._addresses[this.currentURLIndex];await c(m,r)}else r==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(lr.FAILBACK));return!0}catch(m){var u,p;return R.error("[".concat(this._name,"] reconnect failed"),m.toString()),m!=null&&(u=m.data)!==null&&u!==void 0&&u.desc&&Array.isArray(m.data.desc)&&m.data.desc.length&&Ne(p=m.data.desc).call(p,"dynamic key expired")?(this.emit(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(r,i)}}}class h_e extends Nn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Lt.CONNECTED?this.emit(Ye.WS_CONNECTED):r===Lt.RECONNECTING?this.emit(Ye.WS_RECONNECTING,this._websocketReconnectReason):r===Lt.CLOSED&&this.emit(Ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(R.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(r=>{let{type:i,message:s}=r;this.emit(i,s),i===gt.ON_NOTIFICATION&&this.handleNotification(s),i===gt.ON_USER_BANNED&&this.handleUserBanned(s)}),this.pendingNotifications=[])}handleUserBanned(r){switch(r.error_code){case 14:this.close(jt.UID_BANNED);break;case 15:this.close(jt.IP_BANNED);break;case 16:this.close(jt.CHANNEL_BANNED)}}constructor(r,i){super(),M(this,"__name__","DataChannelSignal"),M(this,"_disconnectedReason",void 0),M(this,"_websocketReconnectReason",void 0),M(this,"_connectionState",Lt.CLOSED),M(this,"reconnectToken",void 0),M(this,"websocket",void 0),M(this,"openConnectionTime",void 0),M(this,"clientId",void 0),M(this,"lastMsgTime",Date.now()),M(this,"uploadCache",[]),M(this,"uploadCacheInterval",void 0),M(this,"rttRolling",new sA(5)),M(this,"pingpongTimer",void 0),M(this,"inflateDataTimer",void 0),M(this,"pingpongTimeoutCount",0),M(this,"ortc",void 0),M(this,"joinResponse",void 0),M(this,"multiIpOption",void 0),M(this,"initError",void 0),M(this,"spec",void 0),M(this,"store",void 0),M(this,"isJoining",!1),M(this,"pendingNotifications",[]),M(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(Ye.ON_BINARY_DATA,s);const c=JSON.parse(s);if(W("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===gt.ON_NOTIFICATION||c._type===gt.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===gt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gt.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),R.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===gt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gt.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new $$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",ld.OFFLINE)})}async request(r,i,s,c){const u=Zt(6,""),p={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new Pe((U,k)=>{if(this.connectionState===Lt.CONNECTED)return U();const j=()=>{this.off(Ye.WS_CLOSED,$),U()},$=()=>{this.off(Ye.WS_CONNECTED,j),k(new ce(H.WS_ABORT))};this.once(Ye.WS_CONNECTED,j),this.once(Ye.WS_CLOSED,$),r!==Je.PUBLISH&&r!==Je.SUBSCRIBE&&r!==Je.UNSUBSCRIBE&&r!==Je.UNPUBLISH&&r!==Je.CONTROL&&r!==Je.RESTART_ICE||this.once(Ye.DISCONNECT_P2P,()=>{k(new ce(H.DISCONNECT_P2P))}),r!==Je.PUBLISH&&r!==Je.RESTART_ICE||this.once(Ye.ABORT_P2P_EXECUTION,()=>{k(new ce(H.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||r===Je.JOIN||r===Je.REJOIN||await g(),r===Je.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),W("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] sendMessage",p),await this.websocket.sendMessage(p,!0,!1),c)return;const v=new Pe((U,k)=>{let j=!1;const $=(J,ne)=>{j=!0,U({isSuccess:J==="success",message:ne||{}}),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.emit(Ye.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{k(new ce(H.WS_ABORT,"type: ".concat(r))),this.off(Ye.WS_CLOSED,K),this.off(Ye.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(Ye.WS_CLOSED,K),this.once(Ye.WS_RECONNECTING,K),vr(W("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("dc request timeout, type: ".concat(r)),this.emit(Ye.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await v}catch(U){if(this.connectionState===Lt.CLOSED||r===Je.LEAVE)throw new ce(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?U.throw():r===Je.JOIN||r===Je.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),w=$u(E),C=new ce(H.UNEXPECTED_RESPONSE,"".concat(w.desc,": ").concat(_.message.error_str),{code:E,data:_.message});return w.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(E,", message: ").concat(w.desc,", action: ").concat(w.action)),E===nt.ERR_TOO_MANY_BROADCASTERS?((r===Je.JOIN||r===Je.REJOIN)&&(this.initError=C,this.close()),C.throw()):w.action==="failed"?C.throw():w.action==="quit"?(this.initError=C,this.close(),C.throw()):(E===nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ld.MULTI_IP)):this.reconnect(w.action,ld.SERVER_ERROR),r===Je.JOIN||r===Je.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new Pe(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Wu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=W("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;const p=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},W("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(r,i){const s={_type:r,_message:i};await this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Pe((i,s)=>{this.once(Ye.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ye.WS_CLOSED,()=>s(this.initError||new ce(H.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(r).catch(s),this.websocket.once(lr.FAILBACK,()=>{s(new ce(H.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new ce(H.INIT_DATACHANNEL_TIMEOUT)))},W("DC_JOIN_WITH_FAILBACK"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=r||jt.LEAVE,this.connectionState=Lt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),r===jt.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new $$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),W("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(Ye.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,Ye.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const i=await this.request(Je.JOIN,r);if(this.store.joinRep(),this.ortc=r==null?void 0:r.ortc,!i)return this.emit(Ye.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new ce(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Au(this,Ye.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Je.REJOIN,r);return!!i&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),W("DC_PINGPONG_INTERVAL")),i.peers&&i.peers.forEach(s=>{this.emit(gt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(gt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(gt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(gt.MUTE_AUDIO,{uid:s.uid}):this.emit(gt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(gt.MUTE_VIDEO,{uid:s.uid}):this.emit(gt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(gt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(gt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(gt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(gt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(gt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Je.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=$u(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jt.UID_BANNED),void this.close()):void this.reconnect(i.action,ld.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,W("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const r=W("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>W("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",ld.FALLBACK):this.request(Je.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),W("REPORT_STATS")&&this.send(Je.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:r,deflateLength:i}=this.websocket.getInflateData();r!==0&&i!==0&&this.upload(Wu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(lr.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ye.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(lr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lr.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(lr.FAILED,()=>{this._disconnectedReason=jt.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(lr.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(lr.WILL_RECONNECT,(r,i)=>{if(Au(this,Ye.IS_P2P_DISCONNECTED)&&r==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ye.NEED_RENEW_SESSION),this.emit(Ye.DISCONNECT_P2P),i("tryNext");r!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(Ye.NEED_RENEW_SESSION),this.emit(Ye.DISCONNECT_P2P)),i(r)}),this.websocket.on(lr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ld.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Ye.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof ce&&r.code===H.UNEXPECTED_RESPONSE&&r.data.code===nt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ld.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ld.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(lr.REQUEST_NEW_URLS,(r,i)=>{er(this,Ye.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.TO_CONNECT_DATACHANNEL,(r,i)=>{er(this,Ye.PRE_CONNECT_PC).then(r).catch(i)}),this.websocket.on(lr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ye.DATACHANNEL_FAILBACK)})}}const p_e={name:"DataChannelConnection",create:function(t){let{store:r,spec:i}=t;return new l_e(i,r)}},m_e={name:"DataChannelSignal",create:function(t){let{store:r,spec:i}=t;return new h_e(i,r)}};hA(),an("PROCESS_ID","process-".concat(Zt(8,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(4,""),"-").concat(Zt(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();R.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(en,s)){const{value:c,expires:u}=r[s];if(u&&u<=i)return;ja[s]=c,en[s]=c}})}catch(r){R.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(ja.AREAS)&&ja.AREAS.length>0&&pI(ja.AREAS,!0);const H$=(t,r,i)=>{R.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),an(t,r,i)};vc(I0e,!1),vc(D0e,!1),vc(lye,!1),vc($0e,!1),vc(N0e,!1),vc(n_e,!1),vc(a_e,!1),vc(o_e,!1),vc(p_e,!1),vc(m_e,!1);const tr=function(t){const r=new Nn,i=t,s={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(p,m){p===mc.SECURITY_POLICY_VIOLATION&&_W(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return yW(yW({},i),s)}({__TRACK_LIST__:ju,VERSION:cs,BUILD:fA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:H$,getParameter:W,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(s){let c;return Pt().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return t;r.close(),r=null,t=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new ce(H.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const r=ze.reportApiInvoke(null,{name:Sn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:ln.TRACER}),i=function(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],p=!1;try{const m=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,v=window.WebSocket;p=!(!m||!v),u&&!g&&(p=!1),p&&Kg()&&IF(75)&&new m().close()}catch(m){R.error("check system requirement failed: ",m),p=!1}return p}(t),s=uye();R.debug("checkSystemRequirements, api:",i,"browser",s);const c=i&&s;return r.onSuccess(c),W("IGNORE_RTC_DEVICE_CHECK")?i:c},getDevices:function(t){return Va.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Va.getRecordingDevices(t)},getCameras:function(t){return Va.getCamerasDevices(t)},getElectronScreenSources:jV,getPlaybackDevices:function(t){return Va.getSpeakers(t)},createClient:fW,createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=W("CAMERA_CAPTURE_CONFIG"),i=Zt(8,"track-cam-"),s=ze.reportApiInvoke(null,{id:i,tag:ln.TRACER,name:Sn.CREATE_CAM_VIDEO_TRACK,options:[vn({},t),r]});r&&(t.encoderConfig=r);const c=Hb(t);let u=null;R.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{u=(await Fa({video:c},i)).getVideoTracks()[0]||null}catch(m){throw s.onError(m),m}if(!u){const m=new me(H.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(m),m.throw(R)}if(t.optimizationMode&&kA(i,u,t,Ws(t.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const m=Ws(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const p=new Kb(u,t,c,t.scalabiltyMode?Bb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess(p.getTrackId()),R.info("create camera video success, trackId:",i),p},createCustomVideoTrack:function(t){const r=Zt(8,"track-cus-"),i=ze.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:Sn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});W("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const s=new dn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Bb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Jt.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),R.info("create custom video track success with config",t,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(w){const C=HV(w);return wV()&&w.suppressLocalAudioPlayback&&(C.suppressLocalAudioPlayback=w.suppressLocalAudioPlayback),TV()&&w.restrictOwnAudio&&(C.restrictOwnAudio=!0),C}(r):void 0;i&&(r="auto");const s=Zt(8,"track-scr-v-"),c=ze.reportApiInvoke(null,{id:s,tag:ln.TRACER,name:Sn.CREATE_SCREEN_VIDEO_TRACK,options:[vn({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(w){const C={};w.screenSourceType&&(C.mediaSource=w.screenSourceType),w.extensionId&&Qc()&&(C.extensionId=w.extensionId);const{displaySurface:U,selfBrowserSurface:k,surfaceSwitching:j,systemAudio:$,preferCurrentTab:K,windowAudio:J,monitorTypeSurfaces:ne}=w;(wo(107)||id(107)||Cu(93))&&(U&&(zn(U,"displaySurface",["browser","window","monitor"]),C.displaySurface=U),k?(zn(k,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=k):C.selfBrowserSurface="include",j&&(zn(j,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=j)),(wo(105)||id(105)||Cu(91))&&$&&(zn($,"systemAudio",["exclude","include"]),C.systemAudio=$),(wo(94)||id(94)||Cu(80))&&K&&(C.preferCurrentTab=!0),(wo(141)||id(141)||Cu(125))&&J&&(zn(J,"windowAudio",["exclude","system"]),C.windowAudio=J),(wo(119)||id(119)||Cu(105))&&ne&&(zn(ne,"monitorTypeSurfaces",["exclude","include"]),C.monitorTypeSurfaces=ne),w.electronScreenSourceId&&(C.sourceId=w.electronScreenSourceId);const ae=w.encoderConfig?xA(w.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(C.mandatory.maxFrameRate=ae.frameRate,C.mandatory.minFrameRate=ae.frameRate):(C.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,C.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),C.frameRate=ae.frameRate),ae.width&&(C.width=ae.width),ae.height&&(C.height=ae.height)),C}(t);let p=null,m=null;const g=Pt();if(!g.supportShareAudio&&r==="enable"){const w=new me(H.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(w),w.throw(R)}R.info("start create screen video track with config",t,"withAudio",r,"trackId",s);const v=g.supportShareAudio&&r!=="disable";try{const w=await Fa({screen:u,screenAudio:v?i||!0:void 0},s);p=w.getVideoTracks()[0]||null,m=w.getAudioTracks()[0]||null}catch(w){throw c.onError(w),w}if(!p){const w=new me(H.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(w),w.throw(R)}if(!m&&r==="enable"){p&&p.stop();const w=new me(H.SHARE_AUDIO_NOT_ALLOWED);return c.onError(w),w.throw(R)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(kA(s,p,t,t.encoderConfig&&xA(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new dn(p,t.encoderConfig?xA(t.encoderConfig):{},t.scalabiltyMode?Bb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s,[Jt.SCREEN_TRACK]);if(!m)return c.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const E=new Mn(m,void 0,Zt(8,"track-scr-a-"),!1);return c.onSuccess([_.getTrackId(),E.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",E.getTrackId()),[_,E]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=W("CAMERA_CAPTURE_CONFIG"),s=Zt(8,"track-mic-"),c=Zt(8,"track-cam-"),u=ze.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:ln.TRACER,name:Sn.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,i]});i&&(r.encoderConfig=i);const p=Hb(r),m=zV(t);let g=null,v=null;R.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const w=await Fa({audio:m,video:p},"".concat(s,"-").concat(c));g=w.getAudioTracks()[0],v=w.getVideoTracks()[0]}catch(w){throw u.onError(w),w}if(!g||!v){const w=new me(H.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(w),w.throw(R)}if(r.optimizationMode&&kA(c,v,r,Ws(r.encoderConfig)),W("USE_STANDARD_BITRATE_DEFAULT")){const w=Ws(r.encoderConfig);r.encoderConfig=w,delete w.bitrateMax,delete w.bitrateMin}const _=new rv(g,t,m,s),E=new Kb(v,r,p,r.scalabiltyMode?Bb(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([_.getTrackId(),E.getTrackId()]),R.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[_,E]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Zt(8,"track-mic-"),i=ze.reportApiInvoke(null,{id:r,tag:ln.TRACER,name:Sn.CREATE_MIC_AUDIO_TRACK,options:[t]}),s=zV(t);let c=null;R.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Fa({audio:s},r)).getAudioTracks()[0]||null}catch(p){throw i.onError(p),p}if(!c){const p=new me(H.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(R)}const u=new rv(c,t,s,r);return i.onSuccess(u.getTrackId()),R.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:y6,createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:i,encoderConfig:s}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:s},p=Zt(8,"track-buf-"),m=ze.reportApiInvoke(null,{id:p,tag:ln.TRACER,name:Sn.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(W("DISABLE_WEBAUDIO"))throw new me(H.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",p);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(E,w){let C=null;if(typeof E=="string"){const k=DB.get(E);if(k)return R.debug("use cached audio resource: ",E),k;try{C=(await To(()=>ji.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new me(H.FETCH_AUDIO_FILE_FAILED,j.toString())}}else C=await new Pe((j,$)=>{const K=new FileReader;K.onload=J=>{J.target?j(J.target.result):$(new me(H.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{$(new me(H.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(E)});const U=await function(k){const j=Kp();return new Pe(($,K)=>{j.decodeAudioData(k,J=>{$(J)},J=>{K(new me(H.DECODE_AUDIO_FILE_FAILED,J.toString()))})})}(C);return typeof E=="string"&&w&&DB.set(E,U),U}(c,i)}catch(E){return m.onError(E),E.throw(R)}const v=new Ige(c),_=new Age(g,v,s?Gb(s):{},p);return R.info("create buffer source audio track success, trackId:",p),m.onSuccess(_.getTrackId()),_},setAppType:function(t){if(R.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw R.debug("Invalid appType"),new ce(H.INVALID_PARAMS,"invalid app type",t);an("APP_TYPE",Math.floor(t))},setLogLevel:function(t){R.setLogLevel(t)},enableLogUpload:function(){W("USE_NEW_LOG")?an("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){W("USE_NEW_LOG")?an("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new L8},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=ze.reportApiInvoke(null,{tag:ln.TRACER,name:Sn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Mn||t instanceof Xp)){const g=new ce(H.INVALID_TRACK,"the parameter is not a audio track");return i.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof Mn?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,p=c;const m=Date.now();return new Pe(g=>{const v=setInterval(()=>{const _=t.getVolumeLevel();u=_>u?_:u,p=_<p?_:p;const E=u-p>1e-4,w=Date.now()-m;if(E||w>r){clearInterval(v);const C=E,U={duration:w,deviceLabel:s,maxVolumeLevel:u,result:C};R.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(U))),i.onSuccess(U),g(C)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=ze.reportApiInvoke(null,{tag:ln.TRACER,name:Sn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof dn||t instanceof qp)){const E=new ce(H.INVALID_TRACK,"the parameter is not a video track");return i.onError(E),E.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof dn?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Cr()||Ab())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,g=0;try{const E=Date.now();m=await function(w,C,U,k){let j,$=0,K=null;return new Pe((J,ne)=>{function ae(){$>k&&j&&(j(),J($));const ee=U.getContext("2d");if(!ee){const Ee=new ce(H.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void ne(Ee)}ee.drawImage(w,0,0,160,120);const oe=ee.getImageData(0,0,U.width,U.height),ve=Math.floor(oe.data.length/3);if(K){for(let Ee=0;Ee<ve;Ee+=3)if(oe.data[Ee]!==K[Ee])return $+=1,void(K=oe.data);K=oe.data}else K=oe.data}setTimeout(()=>{j&&(j(),J($))},C),j=NA(()=>{ae()},30)})}(u,r,p,4),g=Date.now()-E}catch(E){throw i.onError(E),E}qve===zt.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=m>4,_={duration:g,changedPicNum:m,deviceLabel:s,result:v};return R.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),i.onSuccess(_),v},setArea:pI,audioElementPlayCenter:di,resumeAudioContext:function(){return di.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){pye.processExternalMediaAEC(t)},registerExtensions:function(t){const r=W("PLUGIN_INFO")||[];t.forEach(i=>{"name"in i&&!Ne(r).call(r,i.name)&&r.push(i.name);const s=i;s.__registered__=!0,s.logger.hookLog=R.extLog,s.reporter.hookApiInvoke=ze.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=W(c)})}),H$("PLUGIN_INFO",r)},ChannelMediaRelayError:Zp,ChannelMediaRelayEvent:nl,ChannelMediaRelayState:Ji,RemoteStreamFallbackType:Sge,RemoteStreamType:Ege,ConnectionDisconnectedReason:jt,AudienceLatencyLevelType:Jfe,AREAS:qt,preload:async function(t,r,i,s){return jI(t,r,i,s)},startLastmileProbeTest:async function(t,r,i,s){let c={state:"unavailable"};await jI(t,r,i,s);const u=await LI({appId:t,cname:r,token:i||t,uid:s,cloudProxyServer:"disabled"});if(!u)return c;await MI(u);let p,m=fW({mode:"rtc",codec:"vp8"});try{p=await m.join(t,r,i,s,{networkQualityProbe:!0})}catch{return c}const g=new Zve,v=g.createMuteAudioTrack();let _=await y6({mediaStreamTrack:v});await m.publish([_]);let[E,w,C]=await new Pe((J,ne)=>{const ae=setTimeout(()=>{clearTimeout(ae),J([!0,null,"audio"])},5e3);m.on("user-published",async(ee,oe)=>{ee.uid===p&&(clearTimeout(ae),J([!1,ee,oe]))})});if(E||!w)return await m.unpublish([_]),await m.leave(),_.close(),g.close(),c;await m.subscribe(w,C),await new Pe((J,ne)=>{const ae=setTimeout(()=>{clearTimeout(ae),J(null)},5e3)});let U=m.getRTCStats(),k=m.getLocalAudioStats();const j=U.RTT,$=k.sendJitterMs,K=k.currentPacketLossRate;return c={state:"complete",rtt:j,packetLossRate:K,jitter:$,networkQuality:((J,ne,ae)=>{let ee=1;if(ae>0){let mt=Math.log(100*ae)/Math.log(2)+1;mt=Math.min(5,Math.max(0,mt)),ee=1-mt/5}let oe=1;if(J>0){let mt=Math.log(J/40)/Math.log(2)+1;mt=Math.min(5,Math.max(0,mt)),oe=1-mt/5}let ve=1;if(ne>0){let mt=Math.log(ne/10)/Math.log(2.5)+1;mt=Math.min(5,Math.max(0,mt)),ve=1-mt/5}const Ee=.5*ee+.3*oe+.2*ve;let Be=0;return Be=Ee>=.8?1:Ee>=.6?2:Ee>=.4?3:Ee>=.2?4:5,Be})(j,$,K)},await m.unsubscribe(w),await m.unpublish([_]),await m.leave(),_.close(),g.close(),await MI(u),c}});return Object.defineProperties(tr,{onAudioAutoplayFailed:{get:()=>Mi.onAudioAutoplayFailed,set:t=>{Mi.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Mi.onAutoplayFailed,set:t=>{Mi.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>tr._onSecurityPolicyViolation,set(t){tr._onSecurityPolicyViolation=t,_W(t)}},__CLIENT_LIST__:{get:()=>W("SHOW_GLOBAL_CLIENT_LIST")?Bu:[]}}),Va.on(Mu.CAMERA_DEVICE_CHANGED,t=>{R.info("camera device changed",JSON.stringify(t)),tr.onCameraChanged&&tr.onCameraChanged(t),tr.safeEmit(mc.CAMERA_CHANGED,t)}),Va.on(Mu.RECORDING_DEVICE_CHANGED,t=>{R.info("microphone device changed",JSON.stringify(t)),tr.onMicrophoneChanged&&tr.onMicrophoneChanged(t),tr.safeEmit(mc.MICROPHONE_CHANGED,t)}),Va.on(Mu.PLAYOUT_DEVICE_CHANGED,t=>{R.debug("playout device changed",JSON.stringify(t)),tr.onPlaybackDeviceChanged&&tr.onPlaybackDeviceChanged(t),tr.safeEmit(mc.PLAYBACK_DEVICE_CHANGED,t)}),di.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Mi.onAudioAutoplayFailed&&Mi.onAudioAutoplayFailed()},sn.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Mi.onAudioAutoplayFailed&&Mi.onAudioAutoplayFailed(),tr.safeEmit(mc.AUTOPLAY_FAILED)}),sn.on(Mr.STATE_CHANGE,(t,r)=>{R.info("audio context state changed: ".concat(r," => ").concat(t)),tr.onAudioContextStateChanged&&tr.onAudioContextStateChanged(t,r),tr.safeEmit(mc.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Pn.on(Ru.NETWORK_STATE_CHANGE,(t,r)=>{R.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=tr),tr})})(Jte);var EKe=Jte.exports;const tf=ar(EKe);function SKe(){var Ue,Le,tt,Te,De,qe,It,rt,Fe,ut,vt;const{appointmentId:e}=V0(),n=ns(),[a,o]=Y.useState(null),[d,h]=Y.useState(!0),[f,y]=Y.useState(!1),[b,x]=Y.useState("video"),[T,S]=Y.useState([]),[N,O]=Y.useState(""),[A,I]=Y.useState({video:!0,audio:!0,speaker:!0}),[P,L]=Y.useState(null),[F,V]=Y.useState(null),[G,B]=Y.useState(null),[z,q]=Y.useState([]),[Z,ie]=Y.useState(!1),ue=Y.useRef(null),re=Y.useRef(null);Y.useEffect(()=>(fe(),pe(),()=>{Se()}),[e]);const pe=()=>{const Ce=tf.createClient({mode:"rtc",codec:"vp8"});Ce.on("user-published",async(xt,Nt)=>{await Ce.subscribe(xt,Nt),Nt==="video"&&(q(pt=>[...pt.filter(Xe=>Xe.uid!==xt.uid),xt]),re.current&&xt.videoTrack.play(re.current)),Nt==="audio"&&xt.audioTrack.play()}),Ce.on("user-unpublished",xt=>{q(Nt=>Nt.filter(pt=>pt.uid!==xt.uid))}),Ce.on("user-left",xt=>{q(Nt=>Nt.filter(pt=>pt.uid!==xt.uid))}),L(Ce)},Se=async()=>{F&&(F.stop(),F.close()),G&&(G.stop(),G.close()),P&&Z&&await P.leave()},fe=async()=>{try{const{data:Ce}=await Ya.getAppointmentDetails(e);o(Ce)}catch{et.error("Failed to load appointment details"),n("/doctors")}finally{h(!1)}},be=async()=>{if(!P||!(a!=null&&a.videoRoom)){et.error("Video call not available");return}try{const{config:Ce}=a.videoRoom;if(Ce.type==="agora"&&Ce.appId&&Ce.token){await P.join(Ce.appId,Ce.channelName,Ce.token,Ce.uid);const xt=await tf.createCameraVideoTrack(),Nt=await tf.createMicrophoneAudioTrack();V(xt),B(Nt),ue.current&&xt.play(ue.current),await P.publish([xt,Nt]),ie(!0),et.success("Joined video call successfully")}else et.error("Video call configuration not available")}catch(Ce){console.error("Error joining video call:",Ce),et.error("Failed to join video call")}},se=async()=>{try{await Se(),ie(!1),q([]),et.success("Left video call")}catch(Ce){console.error("Error leaving video call:",Ce)}},he=async()=>{try{await Ya.startConsultation(e),y(!0),(a==null?void 0:a.type)==="video"&&await be(),et.success("Consultation started")}catch{et.error("Failed to start consultation")}},Q=async()=>{try{Z&&await se(),await Ya.endConsultation(e),y(!1),et.success("Consultation ended"),n("/consultation-summary/"+e)}catch{et.error("Failed to end consultation")}},le=()=>{if(!N.trim())return;const Ce={id:Date.now(),text:N,sender:"patient",timestamp:new Date};S([...T,Ce]),O("")},we=async Ce=>{if(Ce==="video"&&F){const xt=!A.video;await F.setEnabled(xt),I(Nt=>({...Nt,video:xt}))}else if(Ce==="audio"&&G){const xt=!A.audio;await G.setEnabled(xt),I(Nt=>({...Nt,audio:xt}))}else Ce==="speaker"&&I(xt=>({...xt,speaker:!xt.speaker}))};return d?l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):a?l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(Ta,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:((tt=(Le=(Ue=a.doctor)==null?void 0:Ue.name)==null?void 0:Le[0])==null?void 0:tt.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(Te=a.doctor)==null?void 0:Te.name]}),l.jsx("p",{className:"text-sm text-slate-400",children:(De=a.doctor)==null?void 0:De.specialization})]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="confirmed"?"bg-green-500/20 text-green-400":a.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:a.status})})]})}),f?l.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[l.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[b==="video"&&l.jsxs("div",{className:"h-full relative",children:[l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:z.length>0?l.jsx("div",{ref:re,className:"w-full h-full",style:{background:"#1e293b"}}):l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((ut=(Fe=(rt=a.doctor)==null?void 0:rt.name)==null?void 0:Fe[0])==null?void 0:ut.toUpperCase())||"D"}),l.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(vt=a.doctor)==null?void 0:vt.name]}),l.jsx("p",{className:"text-slate-400",children:Z?"Waiting for doctor to join...":"Video consultation ready"})]})}),Z&&l.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[l.jsx("div",{ref:ue,className:"w-full h-full",style:{background:"#1e293b"}}),l.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),l.jsx("div",{className:"absolute top-4 left-4",children:l.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${Z?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${Z?"bg-green-400":"bg-yellow-400"} animate-pulse`}),Z?"Connected":"Connecting..."]})}),Z&&l.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[l.jsx(hf,{className:"w-4 h-4"}),z.length+1," participants"]})})]}),l.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[l.jsx("button",{onClick:()=>we("audio"),className:`p-3 rounded-full transition-colors ${A.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.audio?"Mute microphone":"Unmute microphone",children:A.audio?l.jsx(qJ,{className:"w-5 h-5"}):l.jsx(YJ,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>we("video"),className:`p-3 rounded-full transition-colors ${A.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.video?"Turn off camera":"Turn on camera",children:A.video?l.jsx(fk,{className:"w-5 h-5"}):l.jsx(DP,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>we("speaker"),className:`p-3 rounded-full transition-colors ${A.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.speaker?"Mute speaker":"Unmute speaker",children:A.speaker?l.jsx(UTe,{className:"w-5 h-5"}):l.jsx(FTe,{className:"w-5 h-5"})}),l.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:l.jsx(ITe,{className:"w-5 h-5"})}),l.jsx("button",{onClick:Q,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:l.jsx(bi,{className:"w-5 h-5"})})]})})]}),l.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[l.jsx("div",{className:"p-4 border-b border-slate-700",children:l.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),l.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:T.map(Ce=>l.jsx("div",{className:`flex ${Ce.sender==="patient"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Ce.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Ce.text})},Ce.id))}),l.jsx("div",{className:"p-4 border-t border-slate-700",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:Ce=>O(Ce.target.value),onKeyPress:Ce=>Ce.key==="Enter"&&le(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:le,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:l.jsx(K0,{className:"w-4 h-4"})})]})})]})]}):l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(qr,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(a.date).toLocaleDateString()," at ",a.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Jd,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),l.jsx("p",{className:"text-slate-400 text-sm capitalize",children:a.type})]})]}),a.symptoms&&l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Vn,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),l.jsx("p",{className:"text-slate-400 text-sm",children:a.symptoms})]})]})]})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Yy,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Experience"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[((qe=a.doctor)==null?void 0:qe.experience)||"5+"," years"]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(OP,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Location"}),l.jsx("p",{className:"text-slate-400 text-sm",children:((It=a.doctor)==null?void 0:It.location)||"Online"})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(qa,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Rating"}),l.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Ce=>l.jsx(qa,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Ce)),l.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),l.jsx("div",{className:"mt-8 text-center",children:l.jsxs("button",{onClick:he,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[l.jsx(Jd,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx(pa,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),l.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function wKe(){const{appointmentId:e}=V0(),n=ns(),[a,o]=Y.useState(null),[d,h]=Y.useState(!0),[f,y]=Y.useState(0),[b,x]=Y.useState(""),[T,S]=Y.useState(!1),[N,O]=Y.useState("summary");Y.useEffect(()=>{A()},[e]);const A=async()=>{try{const{data:V}=await Ya.getConsultationSummary(e);o(V)}catch{et.error("Failed to load consultation summary"),n("/doctors")}finally{h(!1)}},I=async()=>{if(f===0){et.error("Please provide a rating");return}S(!0);try{await Ya.submitReview(e,{rating:f,review:b}),et.success("Review submitted successfully"),o(V=>({...V,reviewSubmitted:!0}))}catch{et.error("Failed to submit review")}finally{S(!1)}},P=async()=>{try{const V=await Ya.downloadPrescription(e),G=new Blob([V.data],{type:"application/pdf"}),B=window.URL.createObjectURL(G),z=document.createElement("a");z.href=B,z.download=`prescription-${e}.pdf`,z.click(),window.URL.revokeObjectURL(B)}catch{et.error("Failed to download prescription")}};if(d)return l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const L={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},F=a||L;return l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(Ta,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),l.jsxs("p",{className:"text-sm text-slate-400",children:[new Date(F.date).toLocaleDateString(),"  ",F.duration]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[l.jsx($J,{className:"w-4 h-4"}),"Download"]}),l.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[l.jsx(LTe,{className:"w-4 h-4"}),"Share"]})]})]})}),l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:F.doctor.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl font-bold text-white",children:F.doctor.name}),l.jsx("p",{className:"text-slate-400",children:F.doctor.specialization})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(V=>l.jsx(qa,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},V))}),l.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[l.jsx("button",{onClick:()=>O("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),l.jsx("button",{onClick:()=>O("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),l.jsx("button",{onClick:()=>O("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[N==="summary"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:l.jsx(Hn,{className:"w-5 h-5 text-blue-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:F.diagnosis})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:l.jsx(Vn,{className:"w-5 h-5 text-green-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:F.notes})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:l.jsx(Xr,{className:"w-5 h-5 text-cyan-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),l.jsx("ul",{className:"space-y-3",children:F.recommendations.map((V,G)=>l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(Xr,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),l.jsx("span",{className:"text-slate-300",children:V})]},G))})]})]}),N==="prescription"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:l.jsx(tu,{className:"w-5 h-5 text-purple-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),l.jsx("div",{className:"space-y-4",children:F.prescription.map((V,G)=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-bold text-white",children:V.medication}),l.jsx("span",{className:"text-sm text-slate-400",children:V.duration})]}),l.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:V.dosage}),l.jsx("p",{className:"text-slate-300 text-sm",children:V.instructions})]},G))}),l.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(rT,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),l.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),N==="followup"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:l.jsx(qr,{className:"w-5 h-5 text-orange-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[l.jsx(ec,{className:"w-5 h-5 text-cyan-400"}),l.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),l.jsxs("p",{className:"text-slate-300",children:[new Date(F.followUp.date).toLocaleDateString()," - ",F.followUp.type]})]}),l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),l.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),l.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(qr,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(Xd,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Message Doctor"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(_Te,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!F.reviewSubmitted&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),l.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(V=>l.jsx("button",{onClick:()=>y(V),className:`p-1 transition-colors ${V<=f?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:l.jsx(qa,{className:"w-6 h-6 fill-current"})},V))})]}),l.jsx("textarea",{value:b,onChange:V=>x(V.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:I,disabled:T||f===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:T?l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):l.jsxs(l.Fragment,{children:[l.jsx(K0,{className:"w-4 h-4"}),"Submit Review"]})})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),l.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Energy Level"}),l.jsx("span",{className:"text-green-400",children:"Stable"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),l.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}function TKe(){const[e,n]=Y.useState(null),[a,o]=Y.useState(null),[d,h]=Y.useState(null),[f,y]=Y.useState([]),[b,x]=Y.useState(!1),[T,S]=Y.useState(!0),[N,O]=Y.useState(!0),A=Y.useRef(null),I=Y.useRef(null),P="e788e8f838484d4dafe4705d682df57c",L="healthai-test";Y.useEffect(()=>(F(),()=>{B()}),[]);const F=()=>{const Z=tf.createClient({mode:"rtc",codec:"vp8"});Z.on("user-published",async(ie,ue)=>{await Z.subscribe(ie,ue),ue==="video"&&(y(re=>[...re.filter(pe=>pe.uid!==ie.uid),ie]),I.current&&ie.videoTrack.play(I.current)),ue==="audio"&&ie.audioTrack.play()}),Z.on("user-unpublished",ie=>{y(ue=>ue.filter(re=>re.uid!==ie.uid))}),Z.on("user-left",ie=>{y(ue=>ue.filter(re=>re.uid!==ie.uid))}),n(Z)},V=async()=>{if(e)try{const Z=Math.floor(Math.random()*1e4);let ie=null;try{const Se=await(await fetch("/api/doctors/generate-video-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:L,uid:Z})})).json();Se.success&&(ie=Se.token,console.log("Generated token:",ie?"Token received":"No token (testing mode)"))}catch(pe){console.log("Failed to get token from server, using null token:",pe)}await e.join(P,L,ie,Z);const ue=await tf.createCameraVideoTrack(),re=await tf.createMicrophoneAudioTrack();o(ue),h(re),A.current&&ue.play(A.current),await e.publish([ue,re]),x(!0),et.success("Joined video call successfully!")}catch(Z){console.error("Error joining channel:",Z),et.error("Failed to join video call: "+Z.message)}},G=async()=>{if(e)try{await B(),x(!1),y([]),et.success("Left video call")}catch(Z){console.error("Error leaving channel:",Z),et.error("Failed to leave video call")}},B=async()=>{a&&(a.stop(),a.close(),o(null)),d&&(d.stop(),d.close(),h(null)),e&&b&&await e.leave()},z=async()=>{if(a){const Z=!T;await a.setEnabled(Z),S(Z)}},q=async()=>{if(d){const Z=!N;await d.setEnabled(Z),O(Z)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-6xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Video Call Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your Agora.io video calling setup"}),l.jsx("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:l.jsxs("p",{className:"text-sm text-slate-300",children:[l.jsx("strong",{children:"Channel:"})," ",L," | ",l.jsx("strong",{children:"App ID:"})," ",P.substring(0,8),"..."]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[l.jsx("div",{ref:A,className:"w-full h-full bg-slate-800"}),l.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:["You ",b?"(Live)":"(Preview)"]}),!T&&l.jsx("div",{className:"absolute inset-0 bg-slate-800 flex items-center justify-center",children:l.jsx(DP,{className:"w-16 h-16 text-slate-400"})})]}),l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[f.length>0?l.jsx("div",{ref:I,className:"w-full h-full bg-slate-800"}):l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Jd,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:b?"Waiting for others to join...":"Remote participant will appear here"})]})}),f.length>0&&l.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:"Remote User"})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[l.jsx("button",{onClick:q,className:`p-4 rounded-full transition-colors ${N?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:N?l.jsx(qJ,{className:"w-6 h-6"}):l.jsx(YJ,{className:"w-6 h-6"})}),l.jsx("button",{onClick:z,className:`p-4 rounded-full transition-colors ${T?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:T?l.jsx(Jd,{className:"w-6 h-6"}):l.jsx(DP,{className:"w-6 h-6"})}),b?l.jsxs("button",{onClick:G,className:"bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(PTe,{className:"w-5 h-5"}),"Leave Call"]}):l.jsxs("button",{onClick:V,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(yk,{className:"w-5 h-5"}),"Join Call"]})]}),l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${b?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${b?"bg-green-400 animate-pulse":"bg-slate-400"}`}),b?`Connected (${f.length+1} participants)`:"Not connected"]})}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Testing Instructions:"}),l.jsxs("ol",{className:"text-slate-300 space-y-2 list-decimal list-inside",children:[l.jsx("li",{children:'Click "Join Call" to start the video call'}),l.jsx("li",{children:"Allow camera and microphone permissions when prompted"}),l.jsx("li",{children:"Open this page in another browser tab/window to test with multiple participants"}),l.jsx("li",{children:"Test the mute/unmute and video on/off controls"}),l.jsx("li",{children:"Check that you can see and hear other participants"})]}),l.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:l.jsxs("p",{className:"text-blue-400 text-sm",children:[l.jsx("strong",{children:"Note:"})," This is using your Agora.io free tier (10,000 minutes/month). Perfect for testing and development!"]})}),l.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:" Troubleshooting"}),l.jsxs("div",{className:"text-yellow-300 text-sm space-y-1",children:[l.jsx("p",{children:l.jsx("strong",{children:"If video call fails:"})}),l.jsx("p",{children:" Check browser console for error messages"}),l.jsx("p",{children:" Ensure camera/microphone permissions are granted"}),l.jsx("p",{children:" Try disabling token authentication in Agora Console"}),l.jsx("p",{children:" Check server logs for token generation issues"})]})]}),l.jsxs("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-green-400 font-medium mb-2",children:" Quick Fix"}),l.jsx("div",{className:"text-green-300 text-sm",children:l.jsxs("p",{children:[l.jsx("strong",{children:"Easiest solution:"}),' Go to Agora Console  Project Settings  Change Authentication from "App ID + Token" to "App ID only"']})})]})]})]})})}function CKe(){const[e,n]=Y.useState(""),[a,o]=Y.useState(!1),[d,h]=Y.useState(null),f=async y=>{if(y.preventDefault(),!e){et.error("Please enter an email address");return}o(!0),h(null);try{const x=await(await fetch("/api/doctors/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).json();x.success?(h({success:!0,message:x.message}),et.success("Test email sent successfully!")):(h({success:!1,message:x.message}),et.error("Failed to send email"))}catch(b){console.error("Email test error:",b),h({success:!1,message:b.message}),et.error("Failed to send email")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-2xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Email Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your SMTP email configuration"})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(z0,{className:"w-5 h-5 text-cyan-400"}),"Current SMTP Configuration"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Host:"}),l.jsx("span",{className:"text-white ml-2",children:"smtp.gmail.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Port:"}),l.jsx("span",{className:"text-white ml-2",children:"587"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"User:"}),l.jsx("span",{className:"text-white ml-2",children:"tech@colabplatforms.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"From:"}),l.jsx("span",{className:"text-white ml-2",children:"HealthAI <tech@colabplatforms.com>"})]})]})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Send Test Email"}),l.jsxs("form",{onSubmit:f,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Email Address"}),l.jsx("input",{type:"email",value:e,onChange:y=>n(y.target.value),placeholder:"Enter email to receive test appointment confirmation",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",required:!0})]}),l.jsx("button",{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 text-white py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2",children:a?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sending..."]}):l.jsxs(l.Fragment,{children:[l.jsx(K0,{className:"w-5 h-5"}),"Send Test Email"]})})]})]}),d&&l.jsxs("div",{className:`rounded-2xl p-6 ${d.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.success?l.jsx(Xr,{className:"w-6 h-6 text-green-400"}):l.jsx(pa,{className:"w-6 h-6 text-red-400"}),l.jsx("h3",{className:`text-lg font-bold ${d.success?"text-green-400":"text-red-400"}`,children:d.success?"Email Sent Successfully!":"Email Failed"})]}),l.jsx("p",{className:`${d.success?"text-green-300":"text-red-300"}`,children:d.message}),d.success&&l.jsxs("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:"What to expect:"}),l.jsxs("ul",{className:"text-slate-300 text-sm space-y-1",children:[l.jsx("li",{children:' Check your inbox for "Appointment Confirmation - HealthAI"'}),l.jsx("li",{children:" The email will contain appointment details and a join link"}),l.jsx("li",{children:" It may take a few minutes to arrive"}),l.jsx("li",{children:" Check spam folder if not received"})]})]})]}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Email Features"}),l.jsxs("div",{className:"space-y-4 text-slate-300",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Appointment Confirmation"}),l.jsx("p",{className:"text-sm",children:"Professional HTML email with appointment details, doctor info, and video call join link."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Automated Reminders"}),l.jsx("p",{className:"text-sm",children:"System sends reminders 24 hours before and 30 minutes before appointments."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Mobile Responsive"}),l.jsx("p",{className:"text-sm",children:"Emails look great on all devices with touch-friendly buttons and responsive design."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Professional Design"}),l.jsx("p",{className:"text-sm",children:"Branded emails with HealthAI colors, gradients, and professional layout."})]})]})]}),l.jsxs("div",{className:"mt-8 bg-yellow-500/10 border border-yellow-500/20 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:"Troubleshooting"}),l.jsxs("div",{className:"space-y-2 text-yellow-300 text-sm",children:[l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Gmail App Password:"})," Make sure you're using an app password, not your regular Gmail password"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"2FA Required:"})," Gmail requires 2-factor authentication to generate app passwords"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Less Secure Apps:"}),' App passwords bypass the need for "less secure apps" setting']}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Rate Limits:"})," Gmail has sending limits (500 emails/day for free accounts)"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Spam Filters:"})," Test emails might go to spam initially"]})]})]})]})})}const NKe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ul={startTime:"09:00",endTime:"18:00",slotDuration:30};function RKe(){const[e,n]=Y.useState(ul),[a,o]=Y.useState({}),[d,h]=Y.useState({}),[f,y]=Y.useState(!1),[b,x]=Y.useState(!0),T=()=>{const G=[],B=new Date;for(let z=0;z<7;z++){const q=new Date(B);q.setDate(B.getDate()+z),G.push({date:q.toISOString().split("T")[0],dayName:NKe[q.getDay()],displayDate:q.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:z===0})}return G},[S]=Y.useState(T());Y.useEffect(()=>{N()},[]);const N=async()=>{var G,B,z,q,Z,ie,ue;try{const{data:re}=await Ya.getMyAvailability(),pe={startTime:((B=(G=re.availability)==null?void 0:G.settings)==null?void 0:B.startTime)||ul.startTime,endTime:((q=(z=re.availability)==null?void 0:z.settings)==null?void 0:q.endTime)||ul.endTime,slotDuration:((ie=(Z=re.availability)==null?void 0:Z.settings)==null?void 0:ie.slotDuration)||ul.slotDuration};n(pe),(ue=re.availability)!=null&&ue.blockedSlots&&h(re.availability.blockedSlots),O(pe)}catch(re){console.error("Failed to fetch availability:",re),O(ul)}finally{x(!1)}},O=G=>{G||(G=ul);const B={},z=G.startTime||ul.startTime,q=G.endTime||ul.endTime,Z=G.slotDuration||ul.slotDuration,ie=z.split(":"),ue=q.split(":");if(ie.length<2||ue.length<2){console.error("Invalid time format");return}const re=parseInt(ie[0],10),pe=parseInt(ie[1],10),Se=parseInt(ue[0],10),fe=parseInt(ue[1],10);S.forEach(be=>{B[be.date]=[];let se=re*60+pe;const he=Se*60+fe;for(;se<he;){const Q=Math.floor(se/60),le=se%60,we=`${Q.toString().padStart(2,"0")}:${le.toString().padStart(2,"0")}`,Ue=new Date(`2000-01-01T${we}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});B[be.date].push({time:we,display:Ue}),se+=Z}}),o(B)},A=(G,B)=>{const z={...e,[G]:B};n(z),O(z)},I=(G,B)=>{h(z=>{const q=z[G]||[];return q.includes(B)?{...z,[G]:q.filter(Z=>Z!==B)}:{...z,[G]:[...q,B]}})},P=G=>{const B=a[G]||[];(d[G]||[]).length===B.length?h(q=>({...q,[G]:[]})):h(q=>({...q,[G]:B.map(Z=>Z.time)}))},L=(G,B)=>(d[G]||[]).includes(B),F=G=>{const B=a[G]||[],z=d[G]||[];return B.length>0&&z.length===B.length},V=async()=>{var G,B;y(!0);try{const z=await Ya.updateMyAvailability({settings:e,blockedSlots:d});console.log("Save response:",z.data),et.success("Availability saved successfully!")}catch(z){console.error("Failed to save:",z),et.error(((B=(G=z.response)==null?void 0:G.data)==null?void 0:B.message)||"Failed to save availability")}finally{y(!1)}};return b?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),l.jsxs("button",{onClick:V,disabled:f,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[f?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsx(XJ,{className:"w-5 h-5"}),"Save Changes"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ec,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),l.jsx("select",{value:e.startTime,onChange:G=>A("startTime",G.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(G,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,q=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:q},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),l.jsx("select",{value:e.endTime,onChange:G=>A("endTime",G.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(G,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,q=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:q},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),l.jsxs("select",{value:e.slotDuration,onChange:G=>A("slotDuration",parseInt(G.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[l.jsx("option",{value:15,children:"15 minutes"}),l.jsx("option",{value:30,children:"30 minutes"}),l.jsx("option",{value:45,children:"45 minutes"}),l.jsx("option",{value:60,children:"60 minutes"})]})]})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",e.startTime," to ",e.endTime,", ",e.slotDuration," min slots"]})]}),l.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),l.jsx("span",{className:"text-slate-600",children:"Available"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),l.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),l.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),l.jsx("div",{className:"space-y-4",children:S.map(G=>{const B=a[G.date]||[],z=F(G.date);return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(qr,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:[G.dayName,G.isToday&&l.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:G.displayDate})]})]}),l.jsx("button",{onClick:()=>P(G.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${z?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:z?l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(_h,{className:"w-4 h-4"})," Unblock All"]}):l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4"})," Block Day"]})})]}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[B.map(q=>{const Z=L(G.date,q.time);return l.jsx("button",{onClick:()=>I(G.date,q.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Z?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:q.display},q.time)}),B.length===0&&l.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},G.date)})}),l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[l.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),l.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[l.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),l.jsx("li",{children:" Click individual slots to block specific times"}),l.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),l.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}const AKe={"Vitamin D":{foods:[{name:"Fish (salmon, mackerel, rohu)",diet:["non-vegetarian"]},{name:"Egg yolks",diet:["eggetarian","non-vegetarian"]},{name:"Fortified milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushrooms",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Egg bhurji with paneer",diet:["eggetarian","non-vegetarian"]},{name:"Dalia with milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom omelette",diet:["eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Fish fry with salad",diet:["non-vegetarian"]},{name:"Fish curry with rice",diet:["non-vegetarian"]},{name:"Egg curry with rice",diet:["eggetarian","non-vegetarian"]},{name:"Mushroom pulao",diet:["vegan","vegetarian"]}],dinner:[{name:"Tandoori fish with vegetables",diet:["non-vegetarian"]},{name:"Paneer tikka",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom masala",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Paneer cubes",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Boiled eggs",diet:["eggetarian","non-vegetarian"]},{name:"Orange juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Get 15-20 minutes of morning sunlight daily","Include fortified foods in your diet"]},"Vitamin B12":{foods:[{name:"Chicken, mutton",diet:["non-vegetarian"]},{name:"Fish",diet:["non-vegetarian"]},{name:"Eggs",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt, milk, paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Nutritional yeast",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Eggs with whole wheat bread",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt with muesli",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk smoothie",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia with almond milk",diet:["vegan"]}],lunch:[{name:"Chicken with rice",diet:["non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Paneer salad",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan"]}],dinner:[{name:"Tandoori chicken",diet:["non-vegetarian"]},{name:"Mutton curry",diet:["non-vegetarian"]},{name:"Paneer butter masala",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Soya chunks curry",diet:["vegan"]}],snacks:[{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk",diet:["vegan"]}],tips:["Vegetarians and vegans should consider B12 supplements","Include fortified foods in every meal"]},Iron:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Rajma, chana",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Spinach smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Poha with peanuts",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Dal rice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Liver curry",diet:["non-vegetarian"]},{name:"Rajma rice",diet:["vegan"]}],dinner:[{name:"Dal soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Grilled meat with vegetables",diet:["non-vegetarian"]}],snacks:[{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dried apricots",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C for better absorption","Avoid tea/coffee with meals"]},Calcium:{foods:[{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Leafy green vegetables",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified almond milk",diet:["vegan"]}],breakfast:[{name:"Milk with dalia",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt with fruits",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer paratha",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Paneer curry",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Broccoli soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]}],tips:["Include calcium-rich foods in every meal","Get adequate Vitamin D for calcium absorption"]},Hemoglobin:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Liver",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Beetroot juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach paratha",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Liver curry",diet:["non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot salad",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Grilled meat",diet:["non-vegetarian"]},{name:"Spinach soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal curry",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Jaggery",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C","Avoid calcium with iron-rich meals"]}};function IKe(){var he,Q,le,we,Ue,Le,tt;const{user:e}=ma(),[n,a]=Y.useState(!0),[o,d]=Y.useState(!1),[h,f]=Y.useState([]),[y,b]=Y.useState(null),[x,T]=Y.useState(null),[S,N]=Y.useState(""),[O,A]=Y.useState(!1),[I,P]=Y.useState(null),[L,F]=Y.useState(!0),[V,G]=Y.useState(!1);Y.useEffect(()=>{B(),z(),q()},[]);const B=async()=>{var Te;try{const{data:De}=await Pl.getDashboard(),qe=((Te=De.latestAnalysis)==null?void 0:Te.deficiencies)||[];f(qe.map(It=>typeof It=="string"?It:It.name||It.nutrient))}catch(De){console.error("Failed to fetch health data:",De)}finally{a(!1)}},z=async()=>{try{const Te=localStorage.getItem("token"),qe=await(await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${Te}`}})).json();qe.success&&qe.dietPlan&&(b(qe.dietPlan),G(!0))}catch(Te){console.error("Failed to fetch personalized plan:",Te)}},q=async()=>{try{const Te=localStorage.getItem("token"),qe=await(await fetch("/api/diet-recommendations/supplements/active",{headers:{Authorization:`Bearer ${Te}`}})).json();qe.success&&qe.recommendations&&T(qe.recommendations)}catch(Te){console.error("Failed to fetch supplement recommendations:",Te)}},Z=async()=>{d(!0);try{const Te=localStorage.getItem("token"),qe=await(await fetch("/api/diet-recommendations/diet-plan/generate",{method:"POST",headers:{Authorization:`Bearer ${Te}`,"Content-Type":"application/json"}})).json();qe.success?(b(qe.dietPlan),G(!0),et.success("AI-powered diet plan generated!")):et.error(qe.message||"Failed to generate plan")}catch(Te){console.error("Failed to generate AI plan:",Te),et.error("Failed to generate personalized plan")}finally{d(!1)}},ie=async()=>{try{const Te=localStorage.getItem("token"),qe=await(await fetch("/api/diet-recommendations/supplements/generate",{method:"POST",headers:{Authorization:`Bearer ${Te}`,"Content-Type":"application/json"}})).json();qe.success?(T(qe.recommendations),et.success("Supplement recommendations generated!")):et.error(qe.message||"Failed to generate recommendations")}catch(Te){console.error("Failed to generate supplements:",Te),et.error("Failed to generate supplement recommendations")}},ue=()=>{if(S.trim()){const Te=S.split(",").map(De=>De.trim()).filter(Boolean);f([...new Set([...h,...Te])]),N(""),A(!1),et.success("Deficiencies added")}},re=Te=>{f(h.filter(De=>De!==Te))},pe=()=>{var qe;const Te={breakfast:[],lunch:[],dinner:[],snacks:[],tips:[],foods:[]},De=((qe=e==null?void 0:e.profile)==null?void 0:qe.dietaryPreference)||"non-vegetarian";return h.forEach(It=>{const rt=Object.entries(AKe).find(([Fe])=>It.toLowerCase().includes(Fe.toLowerCase())||Fe.toLowerCase().includes(It.toLowerCase()));if(rt){const[,Fe]=rt,ut=vt=>vt.filter(Ce=>Ce.diet.includes(De)).map(Ce=>Ce.name);Te.breakfast.push(...ut(Fe.breakfast||[])),Te.lunch.push(...ut(Fe.lunch||[])),Te.dinner.push(...ut(Fe.dinner||[])),Te.snacks.push(...ut(Fe.snacks||[])),Te.foods.push(...ut(Fe.foods||[])),Te.tips.push(...Fe.tips||[])}}),Object.keys(Te).forEach(It=>{Te[It]=[...new Set(Te[It])]}),Te},Se=()=>x?h.map(Te=>{const De=Object.entries(x).find(([qe])=>Te.toLowerCase().includes(qe.toLowerCase())||qe.toLowerCase().includes(Te.toLowerCase()));return De?{deficiency:Te,...De[1]}:null}).filter(Boolean):[];if(n)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your personalized plan..."})]})});const fe=pe(),be=Se(),se=h.length>0&&(fe.breakfast.length>0||fe.lunch.length>0);return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Personalized Diet Plan"}),l.jsxs("p",{className:"text-slate-500 mt-1",children:["AI-generated nutrition guidance based on your health data",((he=e==null?void 0:e.profile)==null?void 0:he.age)&&`  ${e.profile.age} years`,((Q=e==null?void 0:e.profile)==null?void 0:Q.gender)&&`  ${e.profile.gender}`,((le=e==null?void 0:e.profile)==null?void 0:le.dietaryPreference)&&`  ${e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)}`]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:Z,disabled:o,className:"px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2 disabled:opacity-50 transition-all",style:{backgroundColor:"#8B7355"},children:o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating..."]}):y?l.jsxs(l.Fragment,{children:[l.jsx(Sy,{className:"w-5 h-5"}),"Regenerate Plan"]}):l.jsxs(l.Fragment,{children:[l.jsx(Sy,{className:"w-5 h-5"}),"Generate AI Plan"]})}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:L,onChange:Te=>F(Te.target.checked),className:"w-4 h-4 rounded border-slate-300 focus:ring-2",style:{accentColor:"#8B7355"}}),l.jsx("span",{className:"text-sm text-slate-600",children:"Enable diet recommendations"})]})]})]}),L?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(pa,{className:"w-5 h-5 text-amber-500"}),"Detected Deficiencies"]}),l.jsxs("button",{onClick:()=>A(!O),className:"flex items-center gap-1 text-sm text-cyan-600 hover:text-cyan-700",children:[l.jsx(Uc,{className:"w-4 h-4"})," Add Manually"]})]}),((we=e==null?void 0:e.profile)==null?void 0:we.dietaryPreference)&&l.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-xl",children:l.jsxs("p",{className:"text-sm text-green-700",children:[l.jsx("strong",{children:"Dietary Preference:"})," ",e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)," ","- All recommendations are filtered to match your preference.",l.jsx(Ut,{to:"/profile",className:"ml-2 text-cyan-600 hover:text-cyan-700 underline",children:"Change in Profile"})]})}),O&&l.jsxs("div",{className:"mb-4 p-4 bg-slate-50 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Don't have reports? Add your known deficiencies manually:"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:S,onChange:Te=>N(Te.target.value),placeholder:"e.g., Vitamin D, Iron, B12",className:"flex-1 px-4 py-2 bg-white border border-slate-200 rounded-lg text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"}),l.jsx("button",{onClick:ue,className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Add"})]})]}),h.length>0?l.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((Te,De)=>l.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-100 text-amber-700 rounded-full text-sm",children:[Te,l.jsx("button",{onClick:()=>re(Te),className:"hover:text-amber-900",children:""})]},De))}):l.jsx("p",{className:"text-slate-500 text-sm",children:"No deficiencies detected. Upload a health report or add deficiencies manually to get personalized recommendations."})]}),(y==null?void 0:y.deficiencyCorrections)&&y.deficiencyCorrections.length>0&&l.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border-2 border-green-200 p-6 shadow-lg",children:[l.jsxs("h2",{className:"text-xl font-bold text-green-900 mb-4 flex items-center gap-2",children:[l.jsx(O7,{className:"w-6 h-6 text-green-600"}),"Indian Foods Based on Your Report"]}),l.jsx("p",{className:"text-sm text-green-700 mb-4",children:"Personalized Indian food recommendations to address your detected deficiencies"}),l.jsx("div",{className:"space-y-4",children:y.deficiencyCorrections.map((Te,De)=>{var qe,It;return l.jsxs("div",{className:"bg-white rounded-xl p-4 border-l-4 border-green-500",children:[l.jsx("h3",{className:"font-bold text-green-900 mb-2",children:Te.deficiency}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-green-600 font-semibold mb-2",children:" Indian Foods (4-5 options):"}),l.jsx("ul",{className:"space-y-1",children:(qe=Te.indianFoods)==null?void 0:qe.slice(0,5).map((rt,Fe)=>l.jsxs("li",{className:"text-sm text-green-800 flex items-center gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),rt]},Fe))})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-green-600 font-semibold mb-2",children:" Meal Suggestions:"}),l.jsx("ul",{className:"space-y-1",children:(It=Te.mealSuggestions)==null?void 0:It.slice(0,5).map((rt,Fe)=>l.jsxs("li",{className:"text-sm text-green-800 flex items-center gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),rt]},Fe))})]})]})]},De)})})]}),y&&V&&l.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl border-2 border-purple-200 p-6 shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-xl font-bold text-purple-900 flex items-center gap-2",children:[l.jsx(Sy,{className:"w-6 h-6 text-purple-600"}),"AI-Powered Personalized Diet Plan"]}),l.jsx("button",{onClick:()=>G(!1),className:"text-purple-600 hover:text-purple-800 text-sm",children:"Show Basic Plan"})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-4",children:["Generated on ",new Date(y.generatedAt).toLocaleDateString(),"  Valid until ",new Date(y.validUntil).toLocaleDateString()]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Daily Calories"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:y.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Protein"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[(Ue=y.macroTargets)==null?void 0:Ue.protein,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Carbs"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[(Le=y.macroTargets)==null?void 0:Le.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Fats"}),l.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[(tt=y.macroTargets)==null?void 0:tt.fats,"g"]})]})]}),l.jsx("div",{className:"space-y-4",children:Object.entries(y.mealPlan||{}).map(([Te,De])=>De&&De.length>0&&l.jsxs("div",{className:"bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3 capitalize",children:Te.replace(/([A-Z])/g," $1").trim()}),l.jsx("div",{className:"space-y-2",children:De.map((qe,It)=>l.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:l.jsxs("div",{className:"flex justify-between items-start",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"font-medium text-purple-900",children:qe.name}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:qe.description}),qe.benefits&&l.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[" ",qe.benefits]})]}),l.jsxs("div",{className:"text-right ml-4",children:[l.jsxs("p",{className:"text-sm font-semibold text-purple-900",children:[qe.calories," cal"]}),qe.protein&&l.jsxs("p",{className:"text-xs text-purple-600",children:[qe.protein,"g protein"]})]})]})},It))})]},Te))}),y.keyFoods&&y.keyFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Key Foods to Include"}),l.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:y.keyFoods.map((Te,De)=>l.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[l.jsx("p",{className:"font-medium text-green-900",children:Te.name}),l.jsx("p",{className:"text-sm text-green-700 mt-1",children:Te.reason}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Frequency: ",Te.frequency]})]},De))})]}),y.deficiencyCorrections&&y.deficiencyCorrections.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Deficiency Corrections"}),l.jsx("div",{className:"space-y-3",children:y.deficiencyCorrections.map((Te,De)=>l.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border border-amber-200",children:[l.jsx("p",{className:"font-medium text-amber-900",children:Te.deficiency}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Foods:"})," ",Te.indianFoods.join(", ")]}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Meals:"})," ",Te.mealSuggestions.join(", ")]})]},De))})]}),y.lifestyleRecommendations&&y.lifestyleRecommendations.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsxs("h3",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[l.jsx(Ey,{className:"w-5 h-5 text-purple-600"}),"Lifestyle Tips"]}),l.jsx("ul",{className:"space-y-2",children:y.lifestyleRecommendations.map((Te,De)=>l.jsxs("li",{className:"flex items-start gap-2 text-purple-700",children:[l.jsx(Xr,{className:"w-4 h-4 mt-0.5 text-purple-500 shrink-0"}),Te]},De))})]}),y.avoidFoods&&y.avoidFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-red-900 mb-3",children:"Foods to Avoid"}),l.jsx("div",{className:"space-y-2",children:y.avoidFoods.map((Te,De)=>l.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[l.jsx("p",{className:"font-medium text-red-900",children:Te.food}),l.jsx("p",{className:"text-sm text-red-700 mt-1",children:Te.reason})]},De))})]})]}),se&&!V&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(O7,{className:"w-5 h-5 text-green-500"}),"Recommended Foods"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:fe.foods.slice(0,15).map((Te,De)=>l.jsx("span",{className:"px-3 py-1.5 bg-green-50 text-green-700 rounded-full text-sm border border-green-200",children:Te},De))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(LE,{icon:TTe,title:"Breakfast",color:"amber",items:fe.breakfast,expanded:I==="breakfast",onToggle:()=>P(I==="breakfast"?null:"breakfast")}),l.jsx(LE,{icon:_k,title:"Lunch",color:"orange",items:fe.lunch,expanded:I==="lunch",onToggle:()=>P(I==="lunch"?null:"lunch")}),l.jsx(LE,{icon:zf,title:"Dinner",color:"indigo",items:fe.dinner,expanded:I==="dinner",onToggle:()=>P(I==="dinner"?null:"dinner")}),l.jsx(LE,{icon:so,title:"Snacks",color:"green",items:fe.snacks,expanded:I==="snacks",onToggle:()=>P(I==="snacks"?null:"snacks")})]}),fe.tips.length>0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-2xl p-6",children:[l.jsxs("h2",{className:"text-lg font-semibold text-cyan-800 mb-4 flex items-center gap-2",children:[l.jsx(Ey,{className:"w-5 h-5"}),"Nutritional Tips"]}),l.jsx("ul",{className:"space-y-2",children:fe.tips.map((Te,De)=>l.jsxs("li",{className:"flex items-start gap-2 text-cyan-700",children:[l.jsx(Xr,{className:"w-4 h-4 mt-0.5 text-cyan-500 shrink-0"}),Te]},De))})]}),x&&x.supplements&&x.supplements.length>0?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(kl,{className:"w-5 h-5 text-purple-500"}),"AI-Powered Supplement Recommendations"]}),l.jsx("button",{onClick:ie,className:"text-sm text-purple-600 hover:text-purple-700",children:"Regenerate"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:x.consultationNote||"Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:x.supplements.map((Te,De)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Te.name}),Te.priority&&l.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${Te.priority==="high"?"bg-red-100 text-red-700":Te.priority==="medium"?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700"}`,children:[Te.priority," priority"]})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[l.jsx("strong",{children:"For:"})," ",Te.deficiency]}),l.jsx("p",{className:"text-sm text-purple-700 mb-2",children:Te.reason}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-2 mt-3",children:[l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Dosage:"}),l.jsx("p",{className:"text-purple-600",children:Te.dosage})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Timing:"}),l.jsx("p",{className:"text-purple-600",children:Te.timing})]})]}),Te.foodAlternatives&&Te.foodAlternatives.length>0&&l.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-green-700",children:[l.jsx("strong",{children:"Food alternatives:"})," ",Te.foodAlternatives.join(", ")]})}),Te.indianBrands&&Te.indianBrands.length>0&&l.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:[l.jsx("strong",{children:"Available brands:"})," ",Te.indianBrands.join(", ")]}),Te.precautions&&l.jsx("div",{className:"mt-2 p-2 bg-amber-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-amber-700",children:[l.jsx("strong",{children:" Precautions:"})," ",Te.precautions]})})]},De))}),x.generalGuidance&&x.generalGuidance.length>0&&l.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl",children:[l.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"General Guidance"}),l.jsx("ul",{className:"space-y-1",children:x.generalGuidance.map((Te,De)=>l.jsxs("li",{className:"text-sm text-blue-700 flex items-start gap-2",children:[l.jsx(Xr,{className:"w-4 h-4 mt-0.5 shrink-0"}),Te]},De))})]})]}):be.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(kl,{className:"w-5 h-5 text-purple-500"}),"Supplement Recommendations"]}),l.jsx("button",{onClick:ie,className:"px-4 py-2 text-sm text-white rounded-lg hover:shadow-lg",style:{backgroundColor:"#8B7355"},children:"Get AI Recommendations"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"General wellness guidance based on your deficiencies. Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:be.map((Te,De)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Te.category}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:Te.description}),l.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:Te.note})]},De))})]})]}),!se&&h.length===0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(so,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Diet Plan Available"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload a health report to get AI-analyzed deficiencies and personalized diet recommendations, or add your known deficiencies manually."}),l.jsx("button",{onClick:()=>A(!0),className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all",children:"Add Deficiencies Manually"})]}),l.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-500",children:[l.jsx("strong",{children:"Disclaimer:"})," This diet plan is AI-generated for informational purposes only. It is not a substitute for professional medical advice. Please consult a healthcare provider or registered dietitian before making significant changes to your diet."]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(so,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"Diet Recommendations Disabled"}),l.jsx("p",{className:"text-slate-500",children:"Enable diet recommendations to see your personalized plan."})]})]})}function LE({icon:e,title:n,color:a,items:o,expanded:d,onToggle:h}){const f={amber:"bg-amber-100 text-amber-700",orange:"bg-orange-100 text-orange-700",indigo:"bg-indigo-100 text-indigo-700",green:"bg-green-100 text-green-700"},y={amber:"border-amber-200",orange:"border-orange-200",indigo:"border-indigo-200",green:"border-green-200"};return l.jsxs("div",{className:`bg-white rounded-2xl border-2 ${y[a]} p-5 shadow-sm hover:shadow-md transition-shadow`,children:[l.jsxs("button",{onClick:h,className:"w-full flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${f[a]} flex items-center justify-center`,children:l.jsx(e,{className:"w-5 h-5"})}),l.jsx("h3",{className:"font-semibold text-slate-800 text-lg",children:n})]}),d?l.jsx(ETe,{className:"w-5 h-5 text-slate-400"}):l.jsx(iT,{className:"w-5 h-5 text-slate-400"})]}),d&&o.length>0&&l.jsx("ul",{className:"mt-4 space-y-2",children:o.map((b,x)=>l.jsxs("li",{className:"flex items-center gap-2 text-slate-700 text-sm font-medium",children:[l.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${f[a].split(" ")[1].replace("text-","bg-")}`}),b]},x))}),!d&&o.length>0&&l.jsxs("p",{className:"mt-2 text-sm text-slate-600 font-medium",children:[o.length," options available"]})]})}function OKe(){const{user:e}=ma(),n=Gl(),[a,o]=Y.useState([]),[d,h]=Y.useState(""),[f,y]=Y.useState(!1),[b,x]=Y.useState(!1),[T,S]=Y.useState(""),[N,O]=Y.useState(null),[A,I]=Y.useState([]),[P,L]=Y.useState(!1),[F,V]=Y.useState([]),[G,B]=Y.useState(null),z=Y.useRef(null),q=Y.useRef(null);Y.useEffect(()=>{(async()=>{try{const he=localStorage.getItem("token"),Q=await fetch("/api/health/reports",{headers:{Authorization:`Bearer ${he}`}});if(Q.ok){const le=await Q.json();I(le.reports||[])}}catch(he){console.error("Failed to load reports:",he)}})()},[]),Y.useEffect(()=>{e&&(()=>{try{const he=localStorage.getItem(`chat_sessions_${e==null?void 0:e.id}`);he&&V(JSON.parse(he))}catch(he){console.error("Failed to load chat sessions:",he)}})()},[e==null?void 0:e.id]),Y.useEffect(()=>{var he;e&&(async()=>{try{const Q=G||`session_${Date.now()}`;B(Q);const le=localStorage.getItem(`chat_history_${e==null?void 0:e.id}_${Q}`);if(le)o(JSON.parse(le));else{const we=Z();o([{role:"assistant",content:we,timestamp:new Date}])}}catch(Q){console.error("Failed to load chat history:",Q);const le=Z();o([{role:"assistant",content:le,timestamp:new Date}])}})(),(he=n.state)!=null&&he.selectedText&&h(`Can you explain this: "${n.state.selectedText}"`)},[e==null?void 0:e.id,n.state,e==null?void 0:e.name,G]),Y.useEffect(()=>{var se;(se=z.current)==null||se.scrollIntoView({behavior:"smooth"})},[a,T]);const Z=()=>{let se=`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant.

`;return A&&A.length>0?(se+=`I've reviewed your uploaded health reports:

`,A.slice(0,3).forEach(he=>{const Q=new Date(he.uploadDate).toLocaleDateString();if(se+=` **${he.reportType}** (${Q})
`,he.analysis&&(se+=`   ${he.analysis.substring(0,100)}...
`),he.metrics&&Object.keys(he.metrics).length>0){const le=Object.keys(he.metrics).slice(0,2);se+=`   Key metrics: ${le.join(", ")}
`}se+=`
`}),se+=`I have a complete understanding of your health profile. Feel free to ask me about your reports, health concerns, or get personalized recommendations!

What would you like to know?`):se+="I can help you understand your health reports, explain medical terms, provide diet guidance, and answer health-related questions. What would you like to know?",se},ie=(se,he)=>{x(!0),S("");let Q=0;const le=setInterval(()=>{Q<=se.length?(S(se.substring(0,Q)),Q++):(clearInterval(le),x(!1),he())},15);return()=>clearInterval(le)},ue=async()=>{if(confirm("Are you sure you want to clear the chat history?"))try{localStorage.removeItem(`chat_history_${e==null?void 0:e.id}_${G}`);const se=Z();o([{role:"assistant",content:se,timestamp:new Date}]),et.success("Chat cleared")}catch(se){console.error("Failed to clear chat:",se),et.error("Failed to clear chat")}},re=()=>{const se=`session_${Date.now()}`;B(se);const he=Z();o([{role:"assistant",content:he,timestamp:new Date}]),L(!1),et.success("New chat started")},pe=se=>{try{const he=localStorage.getItem(`chat_history_${e==null?void 0:e.id}_${se}`);he&&(o(JSON.parse(he)),B(se),L(!1))}catch(he){console.error("Failed to load session:",he),et.error("Failed to load chat session")}},Se=async se=>{if(se.preventDefault(),!d.trim()||f)return;const he={role:"user",content:d,timestamp:new Date};o(le=>[...le,he]);const Q=d;h(""),y(!0);try{const le=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:Q,conversationHistory:a.slice(-10),userReports:A.map(Ue=>({type:Ue.reportType,date:Ue.uploadDate,analysis:Ue.analysis,metrics:Ue.metrics}))})});if(!le.ok)throw new Error("Failed to get AI response");const we=await le.json();we.success&&we.response&&ie(we.response,()=>{const Ue={role:"assistant",content:we.response,timestamp:new Date};o(tt=>[...tt,Ue]),S("");const Le=[...a,he,Ue];localStorage.setItem(`chat_history_${e==null?void 0:e.id}_${G}`,JSON.stringify(Le))})}catch(le){console.error("AI Chat error:",le),et.error("Failed to get response");const we=fe(Q);ie(we,()=>{const Ue={role:"assistant",content:we,timestamp:new Date};o(Le=>[...Le,Ue]),S("")})}finally{y(!1)}},fe=se=>{const he=se.toLowerCase();return he.includes("vitamin d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)`:he.includes("iron")||he.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals`:"Thank you for your question. I'm here to help with understanding your health reports, explaining medical terms, providing diet guidance, and answering health-related questions."},be=(se,he)=>{navigator.clipboard.writeText(se),O(he),setTimeout(()=>O(null),2e3),et.success("Copied to clipboard")};return l.jsxs("div",{className:"w-full h-full bg-white flex flex-col md:flex-row",children:[P&&l.jsx("div",{className:"fixed inset-0 bg-black/30 z-40 md:hidden",onClick:()=>L(!1)}),l.jsxs("div",{className:`fixed md:static left-0 top-0 h-full w-64 bg-white border-r border-gray-200 flex flex-col transition-transform duration-300 z-50 md:z-auto ${P?"translate-x-0":"-translate-x-full md:translate-x-0"} md:translate-x-0 shrink-0`,children:[l.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between shrink-0",children:[l.jsx("h2",{className:"font-bold text-gray-900 text-xs",children:"Chat History"}),l.jsx("button",{onClick:()=>L(!1),className:"p-1 hover:bg-gray-100 rounded md:hidden",children:l.jsx(bi,{className:"w-4 h-4"})})]}),l.jsx("button",{onClick:re,className:"m-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 font-medium text-xs shrink-0",children:"+ New Chat"}),l.jsx("div",{className:"flex-1 overflow-y-auto px-2 space-y-1",children:F.length>0?F.map(se=>l.jsxs("button",{onClick:()=>pe(se.id),className:`w-full text-left p-2 rounded-lg transition text-xs ${G===se.id?"bg-blue-100 border-l-4 border-blue-600":"hover:bg-gray-100"}`,children:[l.jsx("p",{className:"font-medium text-gray-900 truncate text-xs",children:se.title}),l.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:se.preview})]},se.id)):l.jsx("p",{className:"text-xs text-gray-500 text-center py-6",children:"No chat history yet"})}),l.jsx("div",{className:"p-2 border-t border-gray-200 space-y-1 shrink-0",children:l.jsxs("button",{onClick:ue,className:"w-full px-2 py-1.5 text-xs text-red-600 hover:bg-red-50 rounded-lg transition flex items-center justify-center gap-2",children:[l.jsx(sT,{className:"w-3 h-3"}),"Clear Chat"]})})]}),l.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[l.jsx("div",{className:"flex items-center px-3 py-2 border-b border-gray-200 bg-white shrink-0",children:l.jsx("button",{onClick:()=>L(!P),className:"p-1.5 hover:bg-gray-100 rounded-lg transition md:hidden",title:"Toggle chat history",children:l.jsx(KJ,{className:"w-5 h-5 text-gray-700"})})}),l.jsxs("div",{ref:q,className:"flex-1 overflow-y-auto px-3 py-4 space-y-3 pb-24 md:pb-4",style:{userSelect:"text"},children:[a.map((se,he)=>l.jsxs("div",{className:`flex gap-2 ${se.role==="user"?"justify-end":"justify-start"}`,children:[se.role==="assistant"&&l.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:l.jsx($O,{className:"w-4 h-4 text-white"})}),l.jsxs("div",{className:`max-w-xs md:max-w-md rounded-2xl px-3 py-2 ${se.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[l.jsx("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed",children:se.content}),l.jsxs("div",{className:"flex items-center justify-between mt-1 gap-2",children:[l.jsx("span",{className:`text-xs ${se.role==="user"?"text-blue-100":"text-gray-500"}`,children:se.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),se.role==="assistant"&&l.jsx("button",{onClick:()=>be(se.content,he),className:"transition-colors p-0.5 rounded hover:bg-gray-200",title:"Copy response",children:N===he?l.jsx(_h,{className:"w-3 h-3 text-green-500"}):l.jsx(CTe,{className:"w-3 h-3 text-gray-500"})})]})]}),se.role==="user"&&l.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-gray-300",children:l.jsx(Bc,{className:"w-4 h-4 text-gray-700"})})]},he)),b&&T&&l.jsxs("div",{className:"flex gap-2 justify-start",children:[l.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:l.jsx($O,{className:"w-4 h-4 text-white"})}),l.jsx("div",{className:"max-w-xs md:max-w-md bg-gray-100 rounded-2xl px-3 py-2",children:l.jsxs("div",{className:"whitespace-pre-wrap break-words text-sm leading-relaxed text-gray-900",children:[T,l.jsx("span",{className:"inline-block w-1 h-3 ml-1 animate-pulse bg-blue-600"})]})})]}),f&&!b&&l.jsxs("div",{className:"flex gap-2 justify-start",children:[l.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center shrink-0 bg-blue-600",children:l.jsx($O,{className:"w-4 h-4 text-white"})}),l.jsx("div",{className:"bg-gray-100 rounded-2xl px-3 py-2",children:l.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[l.jsx(Xy,{className:"w-3 h-3 animate-spin text-blue-600"}),l.jsx("span",{className:"text-xs",children:"Analyzing..."})]})})]}),l.jsx("div",{ref:z})]}),l.jsx("div",{className:"fixed md:relative bottom-0 left-0 right-0 md:bottom-auto border-t border-gray-200 bg-white p-3 shrink-0 md:w-auto",children:l.jsxs("form",{onSubmit:Se,className:"flex gap-2 items-end",children:[l.jsxs("div",{className:"flex-1 relative",children:[l.jsx("input",{type:"text",value:d,onChange:se=>h(se.target.value),placeholder:"Ask...",className:"w-full px-3 py-2.5 bg-gray-50 rounded-2xl focus:outline-none transition-all text-sm border border-gray-200 focus:border-blue-500 focus:bg-white",disabled:f||b}),d&&l.jsx("button",{type:"button",onClick:()=>h(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-lg hover:opacity-70 transition-opacity text-gray-500",children:""})]}),l.jsx("button",{type:"submit",disabled:!d.trim()||f||b,className:"px-3 py-2.5 text-white rounded-2xl font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 flex-shrink-0 bg-blue-600 hover:bg-blue-700",title:d.trim()?"Send message":"Type a message first",children:f||b?l.jsx(Xy,{className:"w-4 h-4 animate-spin"}):l.jsx(K0,{className:"w-4 h-4"})})]})})]})]})}function PKe(){var be,se,he,Q,le,we,Ue,Le,tt,Te;const[e,n]=Y.useState(""),[a,o]=Y.useState(null),[d,h]=Y.useState(null),[f,y]=Y.useState(!1),[b,x]=Y.useState(null),[T,S]=Y.useState(!1),[N,O]=Y.useState(""),[A,I]=Y.useState(!1),[P,L]=Y.useState(null),[F,V]=Y.useState([]),[G,B]=Y.useState(!1),[z,q]=Y.useState(!1);Y.useEffect(()=>{Z()},[]);const Z=async()=>{var De;try{const qe=localStorage.getItem("token"),It=new Date().toISOString().split("T")[0],rt=await kn.get(`/api/nutrition/quick-checks/history/date?date=${It}`,{headers:{Authorization:`Bearer ${qe}`}});V(((De=rt.data.stats)==null?void 0:De.checks)||[])}catch(qe){console.error("Failed to fetch history:",qe)}},ie=De=>{const qe=De.toLowerCase();return/\d+/.test(qe)||["bowl","plate","cup","glass","slice","piece","gram","kg","ml","litre"].some(Ce=>qe.includes(Ce))?{show:!1,text:""}:["juice","milk","water","tea","coffee","smoothie","shake","lassi","soup","dal","curry"].some(Ce=>qe.includes(Ce))?{show:!0,text:" Add quantity: e.g., 250ml, 1 glass, 2 cups"}:["pizza","bread","toast","cake","sandwich","paratha","naan"].some(Ce=>qe.includes(Ce))?{show:!0,text:" Add quantity: e.g., 2 slices, 1 piece"}:["rice","roti","chicken","fish","meat","paneer","vegetables","pasta","biryani"].some(Ce=>qe.includes(Ce))?{show:!0,text:" Add quantity: e.g., 100g, 1 bowl, 1 plate"}:["egg","banana","apple","samosa","pakora","biscuit","idli","dosa"].some(Ce=>qe.includes(Ce))?{show:!0,text:" Add quantity: e.g., 2 pieces, 1 banana"}:{show:!0,text:" Add quantity for accurate results: e.g., 100g, 1 bowl, 2 pieces, 250ml"}},ue=De=>{const qe=De.toLowerCase();return["grilled","fried","baked","boiled","steamed","roasted","raw","cooked","homemade","restaurant","packaged","frozen"].some(Fe=>qe.includes(Fe))?{show:!1}:["chicken","fish","meat","egg","potato","vegetables","rice","noodles","samosa","pakora","fries","chips"].some(Fe=>qe.includes(Fe))?{show:!0}:{show:!1}},re=De=>{const qe=De.target.value;if(n(qe),qe.length>=3){const It=ie(qe);S(It.show),O(It.text);const rt=ue(qe);I(rt.show)}else S(!1),I(!1)},pe=async()=>{var De,qe;if(!e.trim()&&!a){et.error("Please enter a food item or upload an image");return}y(!0);try{const It=localStorage.getItem("token");let rt=null;if(a){const ut=new FileReader;rt=await new Promise((vt,Ce)=>{ut.onloadend=()=>{vt(ut.result.split(",")[1])},ut.onerror=Ce,ut.readAsDataURL(a)})}const Fe=await kn.post("/api/nutrition/quick-check",{foodDescription:e||void 0,imageBase64:rt,additionalContext:e||void 0},{headers:{Authorization:`Bearer ${It}`}});x(Fe.data.data),n(""),o(null),h(null),S(!1),et.success("Food analyzed and saved!"),Z()}catch(It){console.error("Quick check error:",It),et.error(((qe=(De=It.response)==null?void 0:De.data)==null?void 0:qe.message)||"Failed to analyze food")}finally{y(!1)}},Se=De=>{x({foodItem:{name:De.foodName,quantity:De.quantity||"",nutrition:{calories:De.calories||0,protein:De.protein||0,carbs:De.carbs||0,fats:De.fats||0}},isHealthy:De.isHealthy,healthScore:De.healthScore,analysis:De.analysis||"Previously analyzed food item",warnings:De.warnings||[],alternatives:De.alternatives||[]}),B(!1)},fe=async De=>{if(confirm("Delete this food check?"))try{const qe=localStorage.getItem("token");await kn.delete(`/api/nutrition/quick-checks/${De}`,{headers:{Authorization:`Bearer ${qe}`}}),et.success("Deleted"),Z()}catch{et.error("Failed to delete")}};return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-3xl p-6 shadow-lg border border-blue-100",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center",children:l.jsx(Ey,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Quick Check"}),l.jsx("p",{className:"text-sm text-gray-600",children:"Analyze any food instantly"})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"text",value:e,onChange:re,placeholder:"What did you eat? e.g., Pizza, Chicken...",className:"w-full px-5 py-4 pr-14 bg-white border-2 border-blue-200 rounded-2xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-gray-900 placeholder-gray-500 font-medium transition-all"}),l.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[l.jsxs("div",{className:"relative group",children:[l.jsx("div",{className:"p-2 text-gray-300 cursor-not-allowed opacity-50",children:l.jsx(fk,{className:"w-5 h-5"})}),l.jsx("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:"Coming soon"})]}),e&&l.jsx("button",{onClick:()=>{n(""),S(!1),I(!1)},className:"p-2 hover:bg-gray-100 rounded-lg transition",children:l.jsx(bi,{className:"w-5 h-5 text-gray-400"})})]})]}),T&&l.jsxs("div",{className:"bg-white border-2 border-amber-200 rounded-2xl p-4 flex items-start gap-3 animate-in fade-in slide-in-from-top-2",children:[l.jsx(El,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-semibold text-amber-900 mb-1",children:"Add Quantity"}),l.jsx("p",{className:"text-sm text-amber-700",children:N})]})]}),A&&l.jsxs("div",{className:"bg-white border-2 border-purple-200 rounded-2xl p-4 animate-in fade-in slide-in-from-top-2",children:[l.jsxs("p",{className:"text-sm font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[l.jsx(bTe,{className:"w-4 h-4"}),"How was it prepared?"]}),l.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{label:"Homemade",icon:""},{label:"Restaurant",icon:""},{label:"Packaged",icon:""},{label:"Grilled",icon:""},{label:"Fried",icon:""},{label:"Baked",icon:""}].map(De=>l.jsxs("button",{onClick:()=>{L(De.label),I(!1)},className:`px-3 py-2 rounded-xl text-sm font-medium transition-all ${P===De.label?"bg-purple-500 text-white":"bg-purple-50 text-purple-700 hover:bg-purple-100"}`,children:[De.icon," ",De.label]},De.label))})]}),l.jsx("div",{className:"grid grid-cols-1 gap-3",children:l.jsx("button",{onClick:pe,disabled:f||!e.trim()&&!a,className:"px-4 py-4 bg-gradient-to-r from-cyan-500 via-blue-500 to-blue-600 text-white rounded-2xl font-bold hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 transition-all flex items-center justify-center gap-2 shadow-lg",children:f?l.jsxs(l.Fragment,{children:[l.jsx(Xy,{className:"w-5 h-5 animate-spin"}),l.jsx("span",{className:"hidden sm:inline",children:"Analyzing..."})]}):l.jsxs(l.Fragment,{children:[l.jsx(El,{className:"w-5 h-5"}),l.jsx("span",{className:"hidden sm:inline",children:"Analyze Food"}),l.jsx("span",{className:"sm:hidden",children:"Check"})]})})})]})]}),b&&l.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4",children:[l.jsxs("div",{className:`rounded-3xl p-6 shadow-lg border-2 ${b.isHealthy?"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200":"bg-gradient-to-br from-red-50 to-orange-50 border-red-200"}`,children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:(be=b.foodItem)==null?void 0:be.name}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:(se=b.foodItem)==null?void 0:se.quantity}),P&&l.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[" ",P]})]}),l.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center font-bold text-xl ${b.isHealthy?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:b.healthScore})]}),l.jsx("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full font-semibold text-sm ${b.isHealthy?"bg-green-200 text-green-800":"bg-red-200 text-red-800"}`,children:b.isHealthy?l.jsxs(l.Fragment,{children:[l.jsx(Xr,{className:"w-4 h-4"}),"Healthy Choice"]}):l.jsxs(l.Fragment,{children:[l.jsx(pa,{className:"w-4 h-4"}),"Not Ideal"]})})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[l.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-orange-100 text-center",children:[l.jsx(xl,{className:"w-6 h-6 text-orange-500 mx-auto mb-2"}),l.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Calories"}),l.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:((Q=(he=b.foodItem)==null?void 0:he.nutrition)==null?void 0:Q.calories)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-red-100 text-center",children:[l.jsx(fr,{className:"w-6 h-6 text-red-500 mx-auto mb-2"}),l.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Protein"}),l.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[((we=(le=b.foodItem)==null?void 0:le.nutrition)==null?void 0:we.protein)||0,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-yellow-100 text-center",children:[l.jsx(El,{className:"w-6 h-6 text-yellow-500 mx-auto mb-2"}),l.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Carbs"}),l.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[((Le=(Ue=b.foodItem)==null?void 0:Ue.nutrition)==null?void 0:Le.carbs)||0,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-4 border-2 border-blue-100 text-center",children:[l.jsx(Ey,{className:"w-6 h-6 text-blue-500 mx-auto mb-2"}),l.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Fats"}),l.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[((Te=(tt=b.foodItem)==null?void 0:tt.nutrition)==null?void 0:Te.fats)||0,"g"]})]})]}),l.jsx("div",{className:"bg-white rounded-2xl p-5 border-2 border-gray-200",children:l.jsx("p",{className:"text-gray-700 leading-relaxed",children:b.analysis})}),b.warnings&&b.warnings.length>0&&l.jsx("div",{className:"bg-red-50 rounded-2xl p-5 border-2 border-red-200",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(pa,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-red-900 mb-2",children:" Watch Out"}),l.jsx("ul",{className:"space-y-1",children:b.warnings.map((De,qe)=>l.jsxs("li",{className:"text-sm text-red-700",children:[" ",De]},qe))})]})]})}),b.alternatives&&b.alternatives.length>0&&l.jsxs("div",{className:"bg-green-50 rounded-2xl p-5 border-2 border-green-200",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(Ey,{className:"w-6 h-6 text-green-600"}),l.jsx("h4",{className:"font-bold text-green-900",children:" Better Options"})]}),l.jsx("div",{className:"space-y-3",children:b.alternatives.slice(0,3).map((De,qe)=>{var It,rt,Fe,ut;return l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-green-200",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("p",{className:"font-bold text-green-900",children:De.name}),l.jsxs("span",{className:"text-xs font-bold bg-green-100 text-green-700 px-2 py-1 rounded-lg",children:[(It=De.nutrition)==null?void 0:It.calories," cal"]})]}),l.jsx("p",{className:"text-sm text-green-700 mb-2",children:De.description}),l.jsxs("div",{className:"flex gap-2 text-xs text-green-600 font-medium",children:[l.jsxs("span",{children:["P: ",(rt=De.nutrition)==null?void 0:rt.protein,"g"]}),l.jsxs("span",{children:["C: ",(Fe=De.nutrition)==null?void 0:Fe.carbs,"g"]}),l.jsxs("span",{children:["F: ",(ut=De.nutrition)==null?void 0:ut.fats,"g"]})]})]},qe)})})]}),l.jsx("button",{onClick:()=>{x(null),L(null)},className:"w-full py-3 bg-gray-200 text-gray-900 rounded-2xl font-bold hover:bg-gray-300 transition-all",children:"Clear"})]}),l.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-lg border-2 border-gray-200",children:[l.jsxs("button",{onClick:()=>B(!G),className:"w-full flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:l.jsx(NTe,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{className:"text-left",children:[l.jsx("h3",{className:"font-bold text-gray-900",children:"Today's Checks"}),l.jsxs("p",{className:"text-xs text-gray-600",children:[F.length," items"]})]})]}),l.jsx("span",{className:`text-2xl text-gray-400 transition-transform ${G?"rotate-180":""}`,children:""})]}),G&&l.jsx("div",{className:"space-y-2 border-t-2 border-gray-200 pt-4",children:F.length===0?l.jsx("p",{className:"text-center text-gray-500 py-4",children:"No checks yet today"}):F.map(De=>l.jsxs("button",{onClick:()=>Se(De),className:"w-full flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl hover:from-blue-100 hover:to-cyan-100 transition-all text-left",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"font-semibold text-gray-900",children:De.foodName}),l.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded-lg ${De.isHealthy?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[De.healthScore,"/100"]}),l.jsxs("span",{className:"text-xs text-gray-500",children:[De.calories," cal"]}),l.jsx("span",{className:"text-xs text-gray-500",children:new Date(De.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),l.jsx("button",{onClick:qe=>{qe.stopPropagation(),fe(De._id)},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition ml-2",children:l.jsx(sT,{className:"w-4 h-4"})})]},De._id))})]})]})}function DKe(){var le,we,Ue,Le,tt,Te,De,qe,It;const e=ns(),[n,a]=Y.useState(!0),[o,d]=Y.useState([]),[h,f]=Y.useState(null),[y,b]=Y.useState(null),[x,T]=Y.useState(!1),[S,N]=Y.useState(0),[O,A]=Y.useState(new Date().toISOString().split("T")[0]),[I,P]=Y.useState("breakfast"),[L,F]=Y.useState(""),[V,G]=Y.useState(!1),[B,z]=Y.useState(null);Y.useEffect(()=>{q()},[O]);const q=async()=>{try{const Fe={Authorization:`Bearer ${localStorage.getItem("token")}`},ut=new Date().toISOString().split("T")[0],vt=O===ut,[Ce,xt,Nt]=await Promise.all([vt?kn.get("/api/nutrition/logs/today",{headers:Fe}):kn.get(`/api/nutrition/logs?startDate=${O}&endDate=${O}`,{headers:Fe}),kn.get(`/api/nutrition/summary/daily?date=${O}`,{headers:Fe}),kn.get("/api/nutrition/goals",{headers:Fe}).catch(()=>({data:{healthGoal:null}}))]);d(Ce.data.foodLogs||[]),f(xt.data.summary),b(Nt.data.healthGoal);const pt=localStorage.getItem(`waterIntake_${O}`);N(pt?parseInt(pt):0)}catch(rt){console.error("Failed to fetch data:",rt),et.error("Failed to load nutrition data")}finally{a(!1)}},Z=()=>{const rt=S+1;N(rt),localStorage.setItem(`waterIntake_${O}`,rt),et.success("Water intake updated! ")},ie=()=>{if(S>0){const rt=S-1;N(rt),localStorage.setItem(`waterIntake_${O}`,rt)}},ue=async()=>{if(!L.trim()){et.error("Please enter a food item");return}G(!0);try{const rt=localStorage.getItem("token"),Fe=await kn.post("/api/nutrition/quick-check",{foodDescription:L},{headers:{Authorization:`Bearer ${rt}`}});z(Fe.data.data),et.success("Food analyzed!")}catch(rt){console.error("Analysis error:",rt),et.error("Failed to analyze food")}finally{G(!1)}},re=async()=>{if(!B){et.error("Please analyze food first");return}try{const rt=localStorage.getItem("token");await kn.post("/api/nutrition/log-meal",{mealType:I,foodItems:B.foodItem?[B.foodItem]:[],notes:L},{headers:{Authorization:`Bearer ${rt}`}}),et.success("Meal logged successfully!"),T(!1),F(""),z(null),q()}catch(rt){console.error("Log meal error:",rt),et.error("Failed to log meal")}},pe=async rt=>{if(confirm("Delete this meal?"))try{const Fe=localStorage.getItem("token");await kn.delete(`/api/nutrition/logs/${rt}`,{headers:{Authorization:`Bearer ${Fe}`}}),et.success("Meal deleted"),q()}catch(Fe){console.error("Delete error:",Fe),et.error("Failed to delete meal")}},Se=rt=>({breakfast:"",lunch:"",dinner:"",snack:""})[rt]||"",fe=()=>{const rt=new Date(O);rt.setDate(rt.getDate()-1),A(rt.toISOString().split("T")[0])},be=()=>{const rt=new Date(O);rt.setDate(rt.getDate()+1),A(rt.toISOString().split("T")[0])},se=rt=>{const Fe=new Date(rt+"T00:00:00"),ut=new Date,vt=new Date(ut);return vt.setDate(vt.getDate()-1),rt===ut.toISOString().split("T")[0]?"Today":rt===vt.toISOString().split("T")[0]?"Yesterday":Fe.toLocaleDateString("en-US",{month:"short",day:"numeric"})};if(n)return l.jsx("div",{className:"flex items-center justify-center h-screen",children:l.jsx(Xy,{className:"w-8 h-8 animate-spin text-blue-500"})});const he=(h==null?void 0:h.caloriePercentage)||0;return l.jsxs("div",{className:`w-full h-full bg-white flex flex-col ${x?"overflow-hidden":""}`,children:[l.jsxs("div",{className:"w-full px-3 md:px-6 lg:px-8 py-3 flex items-center justify-between bg-white border-b border-gray-200 sticky top-0 z-10 shrink-0",children:[l.jsx("button",{onClick:fe,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:l.jsx(xTe,{className:"w-5 h-5 text-gray-600"})}),l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Nutrition"}),l.jsx("p",{className:"text-lg font-bold text-gray-900",children:se(O)})]}),l.jsx("button",{onClick:be,className:"p-2 hover:bg-gray-100 rounded-lg transition",children:l.jsx(Dd,{className:"w-5 h-5 text-gray-600"})})]}),l.jsxs("div",{className:"w-full px-3 md:px-6 lg:px-8 py-4 space-y-4 pb-24 flex-1 overflow-y-auto",children:[!y&&l.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 flex items-start gap-3",children:[l.jsx(pa,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"font-semibold text-amber-900 mb-2",children:"Set Your Fitness Goal"}),l.jsx("button",{onClick:()=>e("/profile?tab=goals"),className:"text-sm bg-amber-600 text-white px-3 py-1 rounded-lg hover:bg-amber-700",children:"Set Goal Now"})]})]}),h&&y&&l.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl p-6 text-white shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-blue-100 text-sm mb-1",children:"Calories Today"}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-4xl font-bold",children:h.totalCalories}),l.jsxs("span",{className:"text-blue-100",children:["/ ",y.dailyCalorieTarget]})]})]}),l.jsxs("div",{className:"relative w-24 h-24",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${Math.min(he,100)}, 100`,strokeLinecap:"round"})]}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("span",{className:"text-sm font-bold",children:[Math.min(he,100).toFixed(0),"%"]})})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Protein"}),l.jsxs("p",{className:"font-bold",children:[h.totalProtein.toFixed(0),"g"]}),l.jsxs("p",{className:"text-xs text-blue-100",children:["/ ",y.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Carbs"}),l.jsxs("p",{className:"font-bold",children:[h.totalCarbs.toFixed(0),"g"]}),l.jsxs("p",{className:"text-xs text-blue-100",children:["/ ",y.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Fats"}),l.jsxs("p",{className:"font-bold",children:[h.totalFats.toFixed(0),"g"]}),l.jsxs("p",{className:"text-xs text-blue-100",children:["/ ",y.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-cyan-400 to-blue-500 rounded-3xl p-6 text-white shadow-lg",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-cyan-100 text-sm mb-1",children:"Water Reminder"}),l.jsx("p",{className:"text-2xl font-bold",children:"Drink water stay hydrated"})]}),l.jsx("div",{className:"text-4xl",children:""})]}),l.jsxs("p",{className:"text-cyan-100 mb-4",children:["Today you drink ",l.jsxs("span",{className:"font-bold text-white",children:[S," glass"]})," of water"]}),l.jsxs("p",{className:"text-cyan-100 mb-4 text-sm",children:[(S*.25).toFixed(2)," L"]}),l.jsx("div",{className:"grid grid-cols-6 gap-2 mb-4",children:Array.from({length:8}).map((rt,Fe)=>l.jsx("div",{onClick:()=>Fe<S?ie():Z(),className:`aspect-square rounded-lg flex items-center justify-center cursor-pointer transition-all transform hover:scale-110 ${Fe<S?"bg-white text-blue-500 shadow-lg":"bg-white/30 text-white"}`,children:l.jsx(uf,{className:"w-5 h-5"})},Fe))}),l.jsx("button",{onClick:Z,className:"w-full bg-white text-blue-600 font-bold py-2 rounded-xl hover:bg-blue-50 transition-all",children:"+ Add Water"})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Quick Check"}),l.jsx(PKe,{})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"My Daily Target"}),l.jsx("div",{className:"space-y-3",children:["breakfast","lunch","snack","dinner"].map(rt=>{const Fe=o.filter(vt=>vt.mealType===rt),ut=Fe.reduce((vt,Ce)=>{var xt;return vt+(((xt=Ce.totalNutrition)==null?void 0:xt.calories)||0)},0);return l.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white shadow-md",children:[l.jsxs("div",{className:"flex items-start justify-between mb-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm opacity-90 capitalize",children:rt}),l.jsxs("p",{className:"text-2xl font-bold",children:[ut," Kcal"]})]}),l.jsx("span",{className:"text-3xl",children:Se(rt)})]}),Fe.length>0?l.jsx("div",{className:"space-y-2 mb-3",children:Fe.map(vt=>{var Ce,xt,Nt;return l.jsxs("div",{className:"bg-white/20 rounded-lg p-2 flex items-center justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-sm font-medium",children:((xt=(Ce=vt.foodItems)==null?void 0:Ce[0])==null?void 0:xt.name)||"Food"}),l.jsxs("p",{className:"text-xs opacity-75",children:[(Nt=vt.totalNutrition)==null?void 0:Nt.calories," cal"]})]}),l.jsx("button",{onClick:()=>pe(vt._id),className:"p-1 hover:bg-white/30 rounded-lg transition",children:l.jsx(sT,{className:"w-4 h-4"})})]},vt._id)})}):null,l.jsxs("button",{onClick:()=>{if(!y){et.error("Please set your fitness goal first");return}P(rt),T(!0)},className:"w-full bg-white/30 hover:bg-white/40 text-white font-bold py-2 rounded-lg transition-all flex items-center justify-center gap-2",children:[l.jsx(Uc,{className:"w-5 h-5"}),"Add ",rt.charAt(0).toUpperCase()+rt.slice(1)]})]},rt)})})]})]}),x&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center md:justify-center",children:l.jsxs("div",{className:"bg-white w-full md:w-full md:max-w-2xl rounded-t-3xl md:rounded-3xl p-6 max-h-[85vh] md:max-h-[90vh] overflow-y-auto md:mb-0",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Add ",I.charAt(0).toUpperCase()+I.slice(1)]}),l.jsx("button",{onClick:()=>{T(!1),F(""),z(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(bi,{className:"w-6 h-6"})})]}),B?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white",children:[l.jsx("h3",{className:"font-bold text-white mb-4",children:(le=B.foodItem)==null?void 0:le.name}),l.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx(xl,{className:"w-5 h-5 text-orange-300 mx-auto mb-1"}),l.jsx("p",{className:"text-xs text-blue-100",children:"Calories"}),l.jsx("p",{className:"text-xl font-bold text-white",children:((Ue=(we=B.foodItem)==null?void 0:we.nutrition)==null?void 0:Ue.calories)||0})]}),l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx(fr,{className:"w-5 h-5 text-red-300 mx-auto mb-1"}),l.jsx("p",{className:"text-xs text-blue-100",children:"Protein"}),l.jsxs("p",{className:"text-xl font-bold text-white",children:[((tt=(Le=B.foodItem)==null?void 0:Le.nutrition)==null?void 0:tt.protein)||0,"g"]})]}),l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx(El,{className:"w-5 h-5 text-yellow-300 mx-auto mb-1"}),l.jsx("p",{className:"text-xs text-blue-100",children:"Carbs"}),l.jsxs("p",{className:"text-xl font-bold text-white",children:[((De=(Te=B.foodItem)==null?void 0:Te.nutrition)==null?void 0:De.carbs)||0,"g"]})]}),l.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[l.jsx(uf,{className:"w-5 h-5 text-cyan-300 mx-auto mb-1"}),l.jsx("p",{className:"text-xs text-blue-100",children:"Fats"}),l.jsxs("p",{className:"text-xl font-bold text-white",children:[((It=(qe=B.foodItem)==null?void 0:qe.nutrition)==null?void 0:It.fats)||0,"g"]})]})]}),B.isHealthy?l.jsxs("div",{className:"flex items-center gap-2 text-white bg-white/20 px-3 py-2 rounded-lg",children:[l.jsx(Xr,{className:"w-5 h-5"}),l.jsx("span",{className:"text-sm font-medium",children:"Healthy Choice"})]}):l.jsxs("div",{className:"flex items-center gap-2 text-white bg-white/20 px-3 py-2 rounded-lg",children:[l.jsx(pa,{className:"w-5 h-5"}),l.jsx("span",{className:"text-sm font-medium",children:"Not Ideal"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>{z(null),F("")},className:"flex-1 bg-gray-200 text-gray-900 font-bold py-3 rounded-xl hover:bg-gray-300",children:"Back"}),l.jsxs("button",{onClick:re,className:"flex-1 bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 flex items-center justify-center gap-2",children:[l.jsx(Xr,{className:"w-5 h-5"}),"Log Meal"]})]})]}):l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Food Item"}),l.jsx("input",{type:"text",value:L,onChange:rt=>F(rt.target.value),placeholder:"e.g., Chicken rice with vegetables",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"})]}),l.jsx("button",{onClick:ue,disabled:V||!L.trim(),className:"w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2",children:V?l.jsxs(l.Fragment,{children:[l.jsx(Xy,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):l.jsxs(l.Fragment,{children:[l.jsx(xl,{className:"w-5 h-5"}),"Analyze Food"]})})]})]})})]})}function kKe(){const[e,n]=Y.useState([]),[a,o]=Y.useState(!0),[d,h]=Y.useState("all");Y.useEffect(()=>{window.scrollTo(0,0),f()},[]);const f=async()=>{try{const{data:x}=await Pl.getReports();n(x)}catch{et.error("Failed to load reports")}finally{o(!1)}},y=d==="all"?e:e.filter(x=>x.reportType.toLowerCase().includes(d.toLowerCase())),b=["all",...new Set(e.map(x=>x.reportType))];return a?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading reports..."})]})}):l.jsxs("div",{className:"max-w-6xl mx-auto space-y-4 sm:space-y-6 animate-fade-in p-4",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4",children:[l.jsxs("div",{children:[l.jsxs(Ut,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2 text-sm",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800",children:"All Health Reports"}),l.jsx("p",{className:"text-slate-500 mt-1 text-sm",children:"View and manage all your uploaded health reports"})]}),l.jsxs(Ut,{to:"/upload",className:"px-4 py-2.5 sm:px-6 sm:py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all flex items-center justify-center gap-2 text-sm sm:text-base whitespace-nowrap",style:{backgroundColor:"#8B7355"},children:[l.jsx(Ts,{className:"w-4 h-4"}),"Upload Report"]})]}),e.length>0&&l.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[l.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-3 sm:p-6",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-cyan-100 flex items-center justify-center mb-2 sm:mb-0",children:l.jsx(Vn,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-500"})}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("p",{className:"text-xl sm:text-2xl font-bold text-slate-800",children:e.length}),l.jsx("p",{className:"text-slate-500 text-[10px] sm:text-sm",children:"Total Reports"})]})]})}),l.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-3 sm:p-6",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-emerald-100 flex items-center justify-center mb-2 sm:mb-0",children:l.jsx(ua,{className:"w-4 h-4 sm:w-5 sm:h-5 text-emerald-500"})}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("p",{className:"text-xl sm:text-2xl font-bold text-slate-800",children:e.filter(x=>x.status==="completed").length}),l.jsx("p",{className:"text-slate-500 text-[10px] sm:text-sm",children:"Analyzed"})]})]})}),l.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-3 sm:p-6",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-amber-100 flex items-center justify-center mb-2 sm:mb-0",children:l.jsx(qr,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-500"})}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("p",{className:"text-xs sm:text-base font-bold text-slate-800 leading-tight",children:e.length>0?new Date(e[0].createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A"}),l.jsx("p",{className:"text-slate-500 text-[10px] sm:text-sm",children:"Latest"})]})]})})]}),l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 snap-x snap-mandatory scrollbar-hide -mx-4 px-4 sm:mx-0 sm:px-0",children:b.map(x=>l.jsx("button",{onClick:()=>h(x),className:`px-3 py-1.5 sm:px-4 sm:py-2 rounded-xl font-medium whitespace-nowrap transition-all text-sm snap-start ${d===x?"bg-cyan-500 text-white shadow-md":"bg-white text-slate-600 border border-slate-200 hover:bg-slate-50"}`,children:x==="all"?"All Reports":x},x))}),y.length>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"hidden sm:grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(x=>{var T,S,N,O,A;return l.jsxs(Ut,{to:`/reports/${x._id}/summary`,onClick:()=>window.scrollTo(0,0),className:"bg-white rounded-2xl border-2 border-slate-200 p-4 sm:p-6 hover:border-cyan-400 hover:shadow-lg transition-all group",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-100 flex items-center justify-center group-hover:bg-red-200 transition-colors",children:l.jsx(Vn,{className:"w-6 h-6 text-red-500"})}),l.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${x.status==="completed"?"bg-emerald-100 text-emerald-600":x.status==="processing"?"bg-amber-100 text-amber-600":"bg-slate-100 text-slate-600"}`,children:x.status==="completed"?"ANALYZED":x.status.toUpperCase()})]}),l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2 group-hover:text-cyan-600 transition-colors",children:x.reportType}),(x.patientName||((T=x.aiAnalysis)==null?void 0:T.patientName))&&l.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:["Patient: ",x.patientName||((S=x.aiAnalysis)==null?void 0:S.patientName)]}),l.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-sm mb-3",children:[l.jsx(qr,{className:"w-4 h-4"}),l.jsx("span",{children:new Date(x.reportDate||x.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),((N=x.aiAnalysis)==null?void 0:N.healthScore)&&l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl mb-3",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Health Score"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-slate-800",children:x.aiAnalysis.healthScore}),l.jsx("span",{className:"text-slate-400 text-sm",children:"/100"})]})]}),((A=(O=x.aiAnalysis)==null?void 0:O.keyFindings)==null?void 0:A.length)>0&&l.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 mb-3",children:[l.jsx(pa,{className:"w-4 h-4"}),l.jsxs("span",{children:[x.aiAnalysis.keyFindings.length," key findings"]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100",children:[l.jsx("span",{className:"text-cyan-500 font-medium text-sm group-hover:text-cyan-600",children:"View Summary"}),l.jsx(Lh,{className:"w-4 h-4 text-cyan-500 group-hover:text-cyan-600"})]})]},x._id)})}),l.jsx("div",{className:"sm:hidden",children:y.length<=3?l.jsx("div",{className:"grid grid-cols-1 gap-3",children:y.map(x=>{var T;return l.jsx(Ut,{to:`/reports/${x._id}/summary`,onClick:()=>window.scrollTo(0,0),className:"bg-white rounded-xl border-2 border-slate-200 p-4 hover:border-cyan-400 transition-all",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center flex-shrink-0",children:l.jsx(Vn,{className:"w-5 h-5 text-red-500"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[l.jsx("h3",{className:"text-sm font-bold text-slate-800 truncate",children:x.reportType}),l.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium whitespace-nowrap ${x.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:x.status==="completed"?"DONE":"PENDING"})]}),l.jsx("p",{className:"text-xs text-slate-500 mb-2",children:new Date(x.reportDate||x.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),((T=x.aiAnalysis)==null?void 0:T.healthScore)&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-xs text-slate-600",children:"Score:"}),l.jsx("span",{className:"text-lg font-bold text-slate-800",children:x.aiAnalysis.healthScore}),l.jsx("span",{className:"text-xs text-slate-400",children:"/100"})]})]})]})},x._id)})}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex overflow-x-auto gap-3 pb-4 snap-x snap-mandatory scrollbar-hide -mx-4 px-4",children:y.map(x=>{var T;return l.jsxs(Ut,{to:`/reports/${x._id}/summary`,onClick:()=>window.scrollTo(0,0),className:"min-w-[280px] bg-white rounded-xl border-2 border-slate-200 p-4 hover:border-cyan-400 transition-all snap-start flex-shrink-0",children:[l.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center flex-shrink-0",children:l.jsx(Vn,{className:"w-5 h-5 text-red-500"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h3",{className:"text-sm font-bold text-slate-800 mb-1",children:x.reportType}),l.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${x.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:x.status==="completed"?"ANALYZED":"PENDING"})]})]}),l.jsx("p",{className:"text-xs text-slate-500 mb-3",children:new Date(x.reportDate||x.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),((T=x.aiAnalysis)==null?void 0:T.healthScore)&&l.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-50 rounded-lg",children:[l.jsx("span",{className:"text-xs text-slate-600",children:"Health Score"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-xl font-bold text-slate-800",children:x.aiAnalysis.healthScore}),l.jsx("span",{className:"text-xs text-slate-400",children:"/100"})]})]})]},x._id)})}),l.jsx("div",{className:"flex items-center justify-center gap-2 text-slate-400 text-xs",children:l.jsx("span",{children:" Scroll for more "})})]})})]}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(Vn,{className:"w-10 h-10 text-slate-400"})}),l.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Reports Found"}),l.jsx("p",{className:"text-slate-500 mb-6 text-sm",children:d==="all"?"Upload your first health report to get started":`No ${d} reports found`}),l.jsxs(Ut,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Vn,{className:"w-4 h-4"}),"Upload Report"]})]})]})}const ay=[{id:"water",label:"Drink 8 glasses of water",icon:""},{id:"workout",label:"Workout/Yoga (30 mins)",icon:""},{id:"fruits",label:"Eat 2 servings of fruits",icon:""},{id:"vegetables",label:"Eat 3 servings of vegetables",icon:""},{id:"sleep",label:"Sleep 7-8 hours",icon:""},{id:"meditation",label:"Meditate (10 mins)",icon:""},{id:"steps",label:"Walk 8,000 steps",icon:""},{id:"screen",label:"Limit screen time (< 2 hrs)",icon:""}];function jKe(){const[e,n]=Y.useState(1),[a,o]=Y.useState({}),[d,h]=Y.useState(0);Y.useEffect(()=>{window.scrollTo(0,0);const S=localStorage.getItem("challenge30Days");if(S){const N=JSON.parse(S);o(N),f(N)}},[]);const f=S=>{let N=0;for(let O=e;O>=1;O--){const A=S[O];if(A&&Object.values(A).filter(Boolean).length>=5)N++;else break}h(N)},y=(S,N)=>{var I;const O={...a,[S]:{...a[S],[N]:!((I=a[S])!=null&&I[N])}};o(O),localStorage.setItem("challenge30Days",JSON.stringify(O)),f(O);const A=Object.values(O[S]).filter(Boolean).length;A===ay.length?et.success(" Amazing! You completed all tasks for today!"):A===5&&et.success(" Great job! You're doing awesome!")},b=S=>{const N=a[S]||{};return Object.values(N).filter(Boolean).length/ay.length*100},x=()=>{let S=0;for(let N=1;N<=30;N++){const O=a[N]||{};S+=Object.values(O).filter(Boolean).length}return S/(ay.length*30)*100},T=()=>{let S=0;for(let N=1;N<=30;N++){const O=a[N]||{};Object.values(O).filter(Boolean).length>=5&&S++}return S};return l.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fade-in p-4",children:[l.jsxs("div",{children:[l.jsxs(Ut,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors mb-2",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsxs("div",{children:[l.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3",children:[l.jsx(PP,{className:"w-8 h-8 text-amber-500"}),"30 Days Health Challenge"]}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Build healthy habits, one day at a time"})]})})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[l.jsx("div",{className:"bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl sm:rounded-2xl p-3 sm:p-6 text-white",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3 mb-2",children:[l.jsx(xl,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-1 sm:mb-0"}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:d}),l.jsx("p",{className:"text-amber-100 text-[10px] sm:text-sm",children:"Day Streak"})]})]})}),l.jsx("div",{className:"bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl sm:rounded-2xl p-3 sm:p-6 text-white",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3 mb-2",children:[l.jsx(Xr,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-1 sm:mb-0"}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:T()}),l.jsx("p",{className:"text-emerald-100 text-[10px] sm:text-sm",children:"Days Done"})]})]})}),l.jsx("div",{className:"bg-gradient-to-br from-cyan-500 to-blue-500 rounded-xl sm:rounded-2xl p-3 sm:p-6 text-white",children:l.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:gap-3 mb-2",children:[l.jsx(Dl,{className:"w-6 h-6 sm:w-8 sm:h-8 mb-1 sm:mb-0"}),l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsxs("p",{className:"text-2xl sm:text-3xl font-bold",children:[x().toFixed(0),"%"]}),l.jsx("p",{className:"text-cyan-100 text-[10px] sm:text-sm",children:"Progress"})]})]})})]}),l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-4 sm:p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-800",children:"Select Day"}),l.jsxs("span",{className:"text-xs sm:text-sm text-slate-500",children:["Current: Day ",e]})]}),l.jsx("div",{className:"block sm:hidden space-y-3 max-h-[300px] overflow-y-auto",children:[0,1,2,3].map(S=>l.jsx("div",{className:"flex gap-2",children:Array.from({length:7},(N,O)=>S*7+O+1).filter(N=>N<=30).map(N=>{const O=b(N),A=O>=62.5;return l.jsx("button",{onClick:()=>n(N),className:`flex-1 aspect-square rounded-xl font-bold text-sm transition-all ${e===N?"bg-cyan-500 text-white shadow-lg scale-105":A?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200":O>0?"bg-amber-100 text-amber-700 hover:bg-amber-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:N},N)})},S))}),l.jsx("div",{className:"hidden sm:grid grid-cols-10 gap-2",children:Array.from({length:30},(S,N)=>N+1).map(S=>{const N=b(S),O=N>=62.5;return l.jsx("button",{onClick:()=>n(S),className:`aspect-square rounded-xl font-bold text-sm transition-all ${e===S?"bg-cyan-500 text-white shadow-lg scale-110":O?"bg-emerald-100 text-emerald-700 hover:bg-emerald-200":N>0?"bg-amber-100 text-amber-700 hover:bg-amber-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:S},S)})})]}),l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-xl font-bold text-slate-800",children:["Day ",e," Tasks"]}),l.jsxs("p",{className:"text-slate-500 text-sm",children:[Object.values(a[e]||{}).filter(Boolean).length," of ",ay.length," completed"]})]}),l.jsxs("div",{className:"text-right",children:[l.jsxs("div",{className:"text-2xl font-bold text-cyan-600",children:[b(e).toFixed(0),"%"]}),l.jsx("div",{className:"text-xs text-slate-500",children:"Progress"})]})]}),l.jsx("div",{className:"w-full bg-slate-100 rounded-full h-3 mb-6",children:l.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 transition-all duration-500",style:{width:`${b(e)}%`}})}),l.jsx("div",{className:"space-y-3",children:ay.map(S=>{var O;const N=(O=a[e])==null?void 0:O[S.id];return l.jsxs("button",{onClick:()=>y(e,S.id),className:`w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all ${N?"bg-emerald-50 border-emerald-200 hover:bg-emerald-100":"bg-white border-slate-200 hover:bg-slate-50"}`,children:[l.jsx("div",{className:"text-3xl",children:S.icon}),l.jsx("div",{className:"flex-1 text-left",children:l.jsx("p",{className:`font-medium ${N?"text-emerald-700 line-through":"text-slate-800"}`,children:S.label})}),l.jsx("div",{children:N?l.jsx(Xr,{className:"w-6 h-6 text-emerald-500"}):l.jsx(wTe,{className:"w-6 h-6 text-slate-300"})})]},S.id)})})]}),l.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-6 text-white",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx(Yy,{className:"w-6 h-6"}),l.jsx("h3",{className:"text-lg font-semibold",children:"Achievements"})]}),l.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[l.jsxs("div",{className:`p-3 rounded-xl text-center ${d>=3?"bg-white/20":"bg-white/10 opacity-50"}`,children:[l.jsx("div",{className:"text-2xl mb-1",children:""}),l.jsx("p",{className:"text-xs font-medium",children:"3 Day Streak"})]}),l.jsxs("div",{className:`p-3 rounded-xl text-center ${d>=7?"bg-white/20":"bg-white/10 opacity-50"}`,children:[l.jsx("div",{className:"text-2xl mb-1",children:""}),l.jsx("p",{className:"text-xs font-medium",children:"1 Week Streak"})]}),l.jsxs("div",{className:`p-3 rounded-xl text-center ${T()>=15?"bg-white/20":"bg-white/10 opacity-50"}`,children:[l.jsx("div",{className:"text-2xl mb-1",children:""}),l.jsx("p",{className:"text-xs font-medium",children:"Half Way"})]}),l.jsxs("div",{className:`p-3 rounded-xl text-center ${T()>=30?"bg-white/20":"bg-white/10 opacity-50"}`,children:[l.jsx("div",{className:"text-2xl mb-1",children:""}),l.jsx("p",{className:"text-xs font-medium",children:"Champion"})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:" Tips for Success"}),l.jsxs("ul",{className:"space-y-2 text-slate-600",children:[l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-500 mt-1",children:""}),l.jsx("span",{children:"Complete at least 5 tasks daily to maintain your streak"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-500 mt-1",children:""}),l.jsx("span",{children:"Set reminders on your phone for each task"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-500 mt-1",children:""}),l.jsx("span",{children:"Start with easier tasks and gradually increase difficulty"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-500 mt-1",children:""}),l.jsx("span",{children:"Share your progress with friends for accountability"})]})]})]})]})}function LKe(){var y,b,x,T,S,N,O;const{id:e}=V0(),[n,a]=Y.useState(null),[o,d]=Y.useState(!0);if(Y.useEffect(()=>{(async()=>{try{const{data:I}=await Pl.getReport(e);a(I.report)}catch{et.error("Failed to load report")}finally{d(!1)}})()},[e]),o)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading report..."})]})});if(!n)return l.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:h}=n,f=(h==null?void 0:h.healthScore)||0;return l.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in p-4",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs(Ut,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[l.jsx(Ta,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsx(Ut,{to:`/reports/${e}`,className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:"Back to Report Details "})]}),l.jsx("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-8 text-white",children:l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[l.jsxs("div",{children:[(n.patientName||(h==null?void 0:h.patientName))&&l.jsxs("div",{className:"mb-3",children:[l.jsx("p",{className:"text-sm text-white/60 uppercase tracking-wide",children:"Patient Name"}),l.jsx("p",{className:"text-xl font-semibold",children:n.patientName||(h==null?void 0:h.patientName)})]}),l.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[n.reportType," Analysis"]}),l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-white/70",children:[l.jsxs("p",{children:["Analyzed on ",new Date(n.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),(n.reportDate||(h==null?void 0:h.reportDate))&&l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"hidden sm:inline",children:""}),l.jsxs("p",{children:["Report Date: ",new Date(n.reportDate||(h==null?void 0:h.reportDate)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-5xl font-bold mb-2",children:f}),l.jsx("div",{className:"text-sm text-white/70",children:"Health Score"})]})]})}),(h==null?void 0:h.summary)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-blue-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-6 h-6 text-cyan-500"})," Report Summary"]}),l.jsx("p",{className:"text-slate-700 leading-relaxed text-lg",children:h.summary})]}),((y=h==null?void 0:h.keyFindings)==null?void 0:y.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(fr,{className:"w-6 h-6 text-red-500"})," Key Findings"]}),l.jsx("div",{className:"space-y-3",children:h.keyFindings.map((A,I)=>l.jsxs("div",{className:"flex items-start gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[l.jsx(Xr,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-1"}),l.jsx("p",{className:"text-slate-700 text-base",children:A})]},I))})]}),(h==null?void 0:h.metrics)&&Object.keys(h.metrics).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(Hn,{className:"w-6 h-6 text-cyan-500"})," All Health Metrics"]}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(h.metrics).map(([A,I])=>l.jsxs("div",{className:`p-5 rounded-xl border-2 ${I.status==="normal"?"bg-emerald-50 border-emerald-200":I.status==="high"?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:[l.jsx("p",{className:"text-sm text-slate-600 font-medium mb-2",children:A}),l.jsxs("p",{className:"text-2xl font-bold text-slate-800 mb-2",children:[I.value," ",l.jsx("span",{className:"text-sm font-normal text-slate-500",children:I.unit})]}),l.jsxs("p",{className:"text-xs text-slate-600 mb-3",children:["Normal: ",I.normalRange]}),l.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold ${I.status==="normal"?"bg-emerald-100 text-emerald-700":I.status==="high"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:I.status.toUpperCase()})]},A))})]}),((b=h==null?void 0:h.deficiencies)==null?void 0:b.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(rT,{className:"w-6 h-6 text-amber-500"})," Detected Deficiencies"]}),l.jsx("div",{className:"space-y-4",children:h.deficiencies.map((A,I)=>{var P;return l.jsxs("div",{className:`p-5 rounded-xl border-2 ${A.severity==="Severe"?"bg-red-50 border-red-200":A.severity==="Moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:[l.jsxs("div",{className:"flex items-start justify-between mb-3",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800",children:A.name}),l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${A.severity==="Severe"?"bg-red-100 text-red-700":A.severity==="Moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:A.severity})]}),A.explanation&&l.jsx("p",{className:"text-slate-700 mb-3",children:A.explanation}),((P=A.symptoms)==null?void 0:P.length)>0&&l.jsxs("div",{className:"mb-3",children:[l.jsx("p",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Symptoms:"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:A.symptoms.map((L,F)=>l.jsx("span",{className:"text-xs bg-white px-2 py-1 rounded border border-slate-300",children:L},F))})]}),A.currentValue&&l.jsxs("p",{className:"text-sm text-slate-600",children:[l.jsx("strong",{children:"Current:"})," ",A.currentValue," | ",l.jsx("strong",{children:"Normal:"})," ",A.normalRange]})]},I)})})]}),(h==null?void 0:h.foodRecommendations)&&Object.keys(h.foodRecommendations).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(so,{className:"w-6 h-6 text-emerald-500"})," Recommended Foods"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:Object.entries(h.foodRecommendations).map(([A,I])=>l.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsx("h3",{className:"font-bold text-emerald-700 mb-2 text-lg",children:A}),I.explanation&&l.jsx("p",{className:"text-sm text-emerald-600 mb-3",children:I.explanation}),I.frequency&&l.jsxs("p",{className:"text-xs text-emerald-700 font-medium mb-3",children:["Frequency: ",I.frequency]}),I.foods&&l.jsx("div",{className:"flex flex-wrap gap-2",children:I.foods.map((P,L)=>l.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full font-medium",children:P},L))})]},A))})]}),(h==null?void 0:h.supplementRecommendations)&&Object.keys(h.supplementRecommendations).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(tu,{className:"w-6 h-6 text-blue-600"})," Recommended Supplements"]}),l.jsx("div",{className:"space-y-6",children:Object.entries(h.supplementRecommendations).map(([A,I])=>l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:A}),Array.isArray(I)?l.jsx("div",{className:"space-y-3",children:I.map((P,L)=>l.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("p",{className:"font-semibold text-slate-800",children:P.name}),P.frequency&&l.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-medium",children:P.frequency})]}),P.dosage&&l.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[l.jsx("strong",{children:"Dosage:"})," ",P.dosage]}),P.timing&&l.jsxs("p",{className:"text-sm text-slate-700 mb-1",children:[l.jsx("strong",{children:"Timing:"})," ",P.timing]}),P.whyItHelps&&l.jsxs("p",{className:"text-sm text-slate-600 mb-1",children:[l.jsx("strong",{children:"Why:"})," ",P.whyItHelps]}),P.note&&l.jsxs("p",{className:"text-xs text-slate-600 italic",children:[" ",P.note]})]},L))}):null]},A))})]}),(h==null?void 0:h.recommendations)&&Object.keys(h.recommendations).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-8 shadow-sm",children:[l.jsxs("h2",{className:"text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(fr,{className:"w-6 h-6 text-red-500"})," Health Recommendations"]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((x=h.recommendations.immediate)==null?void 0:x.length)>0&&l.jsxs("div",{className:"p-6 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"font-bold text-red-700 mb-4 text-lg",children:" Immediate Actions"}),l.jsx("ul",{className:"space-y-2",children:h.recommendations.immediate.map((A,I)=>l.jsxs("li",{className:"text-sm text-red-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5 flex-shrink-0"}),A]},I))})]}),((T=h.recommendations.shortTerm)==null?void 0:T.length)>0&&l.jsxs("div",{className:"p-6 bg-amber-50 rounded-xl border-2 border-amber-200",children:[l.jsx("h3",{className:"font-bold text-amber-700 mb-4 text-lg",children:" Short-Term (2-4 weeks)"}),l.jsx("ul",{className:"space-y-2",children:h.recommendations.shortTerm.map((A,I)=>l.jsxs("li",{className:"text-sm text-amber-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full mt-1.5 flex-shrink-0"}),A]},I))})]}),((S=h.recommendations.longTerm)==null?void 0:S.length)>0&&l.jsxs("div",{className:"p-6 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsx("h3",{className:"font-bold text-emerald-700 mb-4 text-lg",children:" Long-Term (Ongoing)"}),l.jsx("ul",{className:"space-y-2",children:h.recommendations.longTerm.map((A,I)=>l.jsxs("li",{className:"text-sm text-emerald-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full mt-1.5 flex-shrink-0"}),A]},I))})]}),h.recommendations.diet&&l.jsxs("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:[l.jsx("h3",{className:"font-bold text-blue-700 mb-4 text-lg",children:" Diet Recommendations"}),l.jsx("p",{className:"text-sm text-blue-700",children:h.recommendations.diet})]}),((N=h.recommendations.lifestyle)==null?void 0:N.length)>0&&l.jsxs("div",{className:"p-6 bg-violet-50 rounded-xl border-2 border-violet-200",children:[l.jsx("h3",{className:"font-bold text-violet-700 mb-4 text-lg",children:" Lifestyle Changes"}),l.jsx("ul",{className:"space-y-2",children:h.recommendations.lifestyle.map((A,I)=>l.jsxs("li",{className:"text-sm text-violet-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-violet-500 rounded-full mt-1.5 flex-shrink-0"}),A]},I))})]}),((O=h.recommendations.followUpTests)==null?void 0:O.length)>0&&l.jsxs("div",{className:"p-6 bg-cyan-50 rounded-xl border-2 border-cyan-200",children:[l.jsx("h3",{className:"font-bold text-cyan-700 mb-4 text-lg",children:" Follow-Up Tests"}),l.jsx("ul",{className:"space-y-2",children:h.recommendations.followUpTests.map((A,I)=>l.jsxs("li",{className:"text-sm text-cyan-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-1.5 flex-shrink-0"}),A]},I))})]})]})]}),l.jsx("div",{className:"p-6 bg-blue-50 rounded-xl border-2 border-blue-200",children:l.jsxs("p",{className:"text-sm text-blue-700",children:[l.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})})]})}const aa=({children:e,allowedRoles:n})=>{const{user:a,loading:o}=ma();return o?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a?n&&!n.includes(a.role)?a.role==="admin"?l.jsx(Es,{to:"/admin"}):a.role==="doctor"?l.jsx(Es,{to:"/doctor/dashboard"}):l.jsx(Es,{to:"/dashboard"}):e:l.jsx(Es,{to:"/login"})},MKe=({children:e})=>{const{user:n,loading:a,isAdmin:o}=ma();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(Es,{to:"/dashboard"}):l.jsx(Es,{to:"/login"})},T1=({children:e})=>{const{user:n,loading:a,isDoctor:o}=ma();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(Es,{to:"/dashboard"}):l.jsx(Es,{to:"/login"})};function UKe(){const{user:e,isAdmin:n,isDoctor:a}=ma(),o=()=>e?n()?l.jsx(Es,{to:"/admin"}):a()?l.jsx(Es,{to:"/doctor/dashboard"}):l.jsx(Es,{to:"/dashboard"}):l.jsx(aCe,{});return l.jsxs(l.Fragment,{children:[l.jsx(zTe,{}),l.jsxs(kEe,{children:[l.jsx(rr,{path:"/",element:l.jsx(iCe,{})}),l.jsx(rr,{path:"/login",element:o()}),l.jsx(rr,{path:"/register",element:e?l.jsx(Es,{to:"/dashboard"}):l.jsx(sCe,{})}),l.jsx(rr,{path:"/register/doctor",element:e?l.jsx(Es,{to:"/doctor/dashboard"}):l.jsx(cCe,{})}),l.jsx(rr,{path:"/dashboard",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(cze,{})})})}),l.jsx(rr,{path:"/dashboard/classic",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(oze,{})})})}),l.jsx(rr,{path:"/upload",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(iKe,{})})})}),l.jsx(rr,{path:"/reports",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(kKe,{})})})}),l.jsx(rr,{path:"/reports/:id",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(oKe,{})})})}),l.jsx(rr,{path:"/reports/:id/summary",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(LKe,{})})})}),l.jsx(rr,{path:"/challenge",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(jKe,{})})})}),l.jsx(rr,{path:"/doctors",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(lKe,{})})})}),l.jsx(rr,{path:"/consultation/:appointmentId",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(SKe,{})})}),l.jsx(rr,{path:"/consultation-summary/:appointmentId",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(wKe,{})})})}),l.jsx(rr,{path:"/wearables",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(bKe,{})})})}),l.jsx(rr,{path:"/nutrition",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(DKe,{})})})}),l.jsx(rr,{path:"/subscription",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(_Ke,{})})})}),l.jsx(rr,{path:"/diet-plan",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(IKe,{})})})}),l.jsx(rr,{path:"/ai-chat",element:l.jsx(aa,{allowedRoles:["patient","client"],children:l.jsx(pi,{children:l.jsx(OKe,{})})})}),l.jsx(rr,{path:"/doctor/dashboard",element:l.jsx(T1,{children:l.jsx(pi,{isDoctor:!0,children:l.jsx(lze,{})})})}),l.jsx(rr,{path:"/doctor/availability",element:l.jsx(T1,{children:l.jsx(pi,{isDoctor:!0,children:l.jsx(RKe,{})})})}),l.jsx(rr,{path:"/patient/:patientId",element:l.jsx(T1,{children:l.jsx(pi,{isDoctor:!0,children:l.jsx(xKe,{})})})}),l.jsx(rr,{path:"/profile",element:l.jsx(aa,{children:l.jsx(pi,{children:l.jsx(dKe,{})})})}),l.jsx(rr,{path:"/admin",element:l.jsx(MKe,{children:l.jsx(pi,{isAdmin:!0,children:l.jsx(fKe,{})})})}),l.jsx(rr,{path:"/demo",element:l.jsx(mKe,{})}),l.jsx(rr,{path:"/video-test",element:l.jsx(TKe,{})}),l.jsx(rr,{path:"/email-test",element:l.jsx(CKe,{})})]})]})}C1.createRoot(document.getElementById("root")).render(l.jsx(ge.StrictMode,{children:l.jsx(GEe,{children:l.jsx(hTe,{children:l.jsxs(dCe,{children:[l.jsx(UKe,{}),l.jsx(DSe,{position:"top-right"})]})})})}));
