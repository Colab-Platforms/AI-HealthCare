function t_e(e,n){for(var a=0;a<n.length;a++){const o=n[a];if(typeof o!="string"&&!Array.isArray(o)){for(const d in o)if(d!=="default"&&!(d in e)){const p=Object.getOwnPropertyDescriptor(o,d);p&&Object.defineProperty(e,d,p.get?p:{enumerable:!0,get:()=>o[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const f of p.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function a(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(d){if(d.ep)return;d.ep=!0;const p=a(d);fetch(d.href,p)}})();var Id=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ar(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var AY={exports:{}},Sw={},IY={exports:{}},Rn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S0=Symbol.for("react.element"),n_e=Symbol.for("react.portal"),r_e=Symbol.for("react.fragment"),i_e=Symbol.for("react.strict_mode"),a_e=Symbol.for("react.profiler"),s_e=Symbol.for("react.provider"),o_e=Symbol.for("react.context"),c_e=Symbol.for("react.forward_ref"),l_e=Symbol.for("react.suspense"),d_e=Symbol.for("react.memo"),u_e=Symbol.for("react.lazy"),F$=Symbol.iterator;function h_e(e){return e===null||typeof e!="object"?null:(e=F$&&e[F$]||e["@@iterator"],typeof e=="function"?e:null)}var OY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},PY=Object.assign,DY={};function Df(e,n,a){this.props=e,this.context=n,this.refs=DY,this.updater=a||OY}Df.prototype.isReactComponent={};Df.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};Df.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function kY(){}kY.prototype=Df.prototype;function nk(e,n,a){this.props=e,this.context=n,this.refs=DY,this.updater=a||OY}var rk=nk.prototype=new kY;rk.constructor=nk;PY(rk,Df.prototype);rk.isPureReactComponent=!0;var V$=Array.isArray,jY=Object.prototype.hasOwnProperty,ik={current:null},LY={key:!0,ref:!0,__self:!0,__source:!0};function MY(e,n,a){var o,d={},p=null,f=null;if(n!=null)for(o in n.ref!==void 0&&(f=n.ref),n.key!==void 0&&(p=""+n.key),n)jY.call(n,o)&&!LY.hasOwnProperty(o)&&(d[o]=n[o]);var v=arguments.length-2;if(v===1)d.children=a;else if(1<v){for(var b=Array(v),E=0;E<v;E++)b[E]=arguments[E+2];d.children=b}if(e&&e.defaultProps)for(o in v=e.defaultProps,v)d[o]===void 0&&(d[o]=v[o]);return{$$typeof:S0,type:e,key:p,ref:f,props:d,_owner:ik.current}}function p_e(e,n){return{$$typeof:S0,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function ak(e){return typeof e=="object"&&e!==null&&e.$$typeof===S0}function m_e(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return n[a]})}var B$=/\/+/g;function sO(e,n){return typeof e=="object"&&e!==null&&e.key!=null?m_e(""+e.key):n.toString(36)}function wx(e,n,a,o,d){var p=typeof e;(p==="undefined"||p==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(p){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case S0:case n_e:f=!0}}if(f)return f=e,d=d(f),e=o===""?"."+sO(f,0):o,V$(d)?(a="",e!=null&&(a=e.replace(B$,"$&/")+"/"),wx(d,n,a,"",function(E){return E})):d!=null&&(ak(d)&&(d=p_e(d,a+(!d.key||f&&f.key===d.key?"":(""+d.key).replace(B$,"$&/")+"/")+e)),n.push(d)),1;if(f=0,o=o===""?".":o+":",V$(e))for(var v=0;v<e.length;v++){p=e[v];var b=o+sO(p,v);f+=wx(p,n,a,b,d)}else if(b=h_e(e),typeof b=="function")for(e=b.call(e),v=0;!(p=e.next()).done;)p=p.value,b=o+sO(p,v++),f+=wx(p,n,a,b,d);else if(p==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return f}function WE(e,n,a){if(e==null)return e;var o=[],d=0;return wx(e,o,"","",function(p){return n.call(a,p,d++)}),o}function f_e(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var Oa={current:null},Tx={transition:null},g_e={ReactCurrentDispatcher:Oa,ReactCurrentBatchConfig:Tx,ReactCurrentOwner:ik};function UY(){throw Error("act(...) is not supported in production builds of React.")}Rn.Children={map:WE,forEach:function(e,n,a){WE(e,function(){n.apply(this,arguments)},a)},count:function(e){var n=0;return WE(e,function(){n++}),n},toArray:function(e){return WE(e,function(n){return n})||[]},only:function(e){if(!ak(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Rn.Component=Df;Rn.Fragment=r_e;Rn.Profiler=a_e;Rn.PureComponent=nk;Rn.StrictMode=i_e;Rn.Suspense=l_e;Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=g_e;Rn.act=UY;Rn.cloneElement=function(e,n,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=PY({},e.props),d=e.key,p=e.ref,f=e._owner;if(n!=null){if(n.ref!==void 0&&(p=n.ref,f=ik.current),n.key!==void 0&&(d=""+n.key),e.type&&e.type.defaultProps)var v=e.type.defaultProps;for(b in n)jY.call(n,b)&&!LY.hasOwnProperty(b)&&(o[b]=n[b]===void 0&&v!==void 0?v[b]:n[b])}var b=arguments.length-2;if(b===1)o.children=a;else if(1<b){v=Array(b);for(var E=0;E<b;E++)v[E]=arguments[E+2];o.children=v}return{$$typeof:S0,type:e.type,key:d,ref:p,props:o,_owner:f}};Rn.createContext=function(e){return e={$$typeof:o_e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:s_e,_context:e},e.Consumer=e};Rn.createElement=MY;Rn.createFactory=function(e){var n=MY.bind(null,e);return n.type=e,n};Rn.createRef=function(){return{current:null}};Rn.forwardRef=function(e){return{$$typeof:c_e,render:e}};Rn.isValidElement=ak;Rn.lazy=function(e){return{$$typeof:u_e,_payload:{_status:-1,_result:e},_init:f_e}};Rn.memo=function(e,n){return{$$typeof:d_e,type:e,compare:n===void 0?null:n}};Rn.startTransition=function(e){var n=Tx.transition;Tx.transition={};try{e()}finally{Tx.transition=n}};Rn.unstable_act=UY;Rn.useCallback=function(e,n){return Oa.current.useCallback(e,n)};Rn.useContext=function(e){return Oa.current.useContext(e)};Rn.useDebugValue=function(){};Rn.useDeferredValue=function(e){return Oa.current.useDeferredValue(e)};Rn.useEffect=function(e,n){return Oa.current.useEffect(e,n)};Rn.useId=function(){return Oa.current.useId()};Rn.useImperativeHandle=function(e,n,a){return Oa.current.useImperativeHandle(e,n,a)};Rn.useInsertionEffect=function(e,n){return Oa.current.useInsertionEffect(e,n)};Rn.useLayoutEffect=function(e,n){return Oa.current.useLayoutEffect(e,n)};Rn.useMemo=function(e,n){return Oa.current.useMemo(e,n)};Rn.useReducer=function(e,n,a){return Oa.current.useReducer(e,n,a)};Rn.useRef=function(e){return Oa.current.useRef(e)};Rn.useState=function(e){return Oa.current.useState(e)};Rn.useSyncExternalStore=function(e,n,a){return Oa.current.useSyncExternalStore(e,n,a)};Rn.useTransition=function(){return Oa.current.useTransition()};Rn.version="18.3.1";IY.exports=Rn;var q=IY.exports;const fe=ar(q),v_e=t_e({__proto__:null,default:fe},[q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y_e=q,__e=Symbol.for("react.element"),b_e=Symbol.for("react.fragment"),E_e=Object.prototype.hasOwnProperty,x_e=y_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,S_e={key:!0,ref:!0,__self:!0,__source:!0};function FY(e,n,a){var o,d={},p=null,f=null;a!==void 0&&(p=""+a),n.key!==void 0&&(p=""+n.key),n.ref!==void 0&&(f=n.ref);for(o in n)E_e.call(n,o)&&!S_e.hasOwnProperty(o)&&(d[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps,n)d[o]===void 0&&(d[o]=n[o]);return{$$typeof:__e,type:e,key:p,ref:f,props:d,_owner:x_e.current}}Sw.Fragment=b_e;Sw.jsx=FY;Sw.jsxs=FY;AY.exports=Sw;var l=AY.exports,g1={},VY={exports:{}},Rs={},BY={exports:{}},GY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(se,pe){var De=se.length;se.push(pe);e:for(;0<De;){var Se=De-1>>>1,we=se[Se];if(0<d(we,pe))se[Se]=pe,se[De]=we,De=Se;else break e}}function a(se){return se.length===0?null:se[0]}function o(se){if(se.length===0)return null;var pe=se[0],De=se.pop();if(De!==pe){se[0]=De;e:for(var Se=0,we=se.length,qe=we>>>1;Se<qe;){var lt=2*(Se+1)-1,Ut=se[lt],Ht=lt+1,Ue=se[Ht];if(0>d(Ut,De))Ht<we&&0>d(Ue,Ut)?(se[Se]=Ue,se[Ht]=De,Se=Ht):(se[Se]=Ut,se[lt]=De,Se=lt);else if(Ht<we&&0>d(Ue,De))se[Se]=Ue,se[Ht]=De,Se=Ht;else break e}}return pe}function d(se,pe){var De=se.sortIndex-pe.sortIndex;return De!==0?De:se.id-pe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var f=Date,v=f.now();e.unstable_now=function(){return f.now()-v}}var b=[],E=[],T=1,w=null,N=3,P=!1,A=!1,k=!1,I=typeof setTimeout=="function"?setTimeout:null,F=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(se){for(var pe=a(E);pe!==null;){if(pe.callback===null)o(E);else if(pe.startTime<=se)o(E),pe.sortIndex=pe.expirationTime,n(b,pe);else break;pe=a(E)}}function W(se){if(k=!1,V(se),!A)if(a(b)!==null)A=!0,ue(B);else{var pe=a(E);pe!==null&&be(W,pe.startTime-se)}}function B(se,pe){A=!1,k&&(k=!1,F(re),re=-1),P=!0;var De=N;try{for(V(pe),w=a(b);w!==null&&(!(w.expirationTime>pe)||se&&!te());){var Se=w.callback;if(typeof Se=="function"){w.callback=null,N=w.priorityLevel;var we=Se(w.expirationTime<=pe);pe=e.unstable_now(),typeof we=="function"?w.callback=we:w===a(b)&&o(b),V(pe)}else o(b);w=a(b)}if(w!==null)var qe=!0;else{var lt=a(E);lt!==null&&be(W,lt.startTime-pe),qe=!1}return qe}finally{w=null,N=De,P=!1}}var z=!1,Y=null,re=-1,Z=5,ie=-1;function te(){return!(e.unstable_now()-ie<Z)}function de(){if(Y!==null){var se=e.unstable_now();ie=se;var pe=!0;try{pe=Y(!0,se)}finally{pe?xe():(z=!1,Y=null)}}else z=!1}var xe;if(typeof U=="function")xe=function(){U(de)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,Ce=me.port2;me.port1.onmessage=de,xe=function(){Ce.postMessage(null)}}else xe=function(){I(de,0)};function ue(se){Y=se,z||(z=!0,xe())}function be(se,pe){re=I(function(){se(e.unstable_now())},pe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(se){se.callback=null},e.unstable_continueExecution=function(){A||P||(A=!0,ue(B))},e.unstable_forceFrameRate=function(se){0>se||125<se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<se?Math.floor(1e3/se):5},e.unstable_getCurrentPriorityLevel=function(){return N},e.unstable_getFirstCallbackNode=function(){return a(b)},e.unstable_next=function(se){switch(N){case 1:case 2:case 3:var pe=3;break;default:pe=N}var De=N;N=pe;try{return se()}finally{N=De}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(se,pe){switch(se){case 1:case 2:case 3:case 4:case 5:break;default:se=3}var De=N;N=se;try{return pe()}finally{N=De}},e.unstable_scheduleCallback=function(se,pe,De){var Se=e.unstable_now();switch(typeof De=="object"&&De!==null?(De=De.delay,De=typeof De=="number"&&0<De?Se+De:Se):De=Se,se){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=De+we,se={id:T++,callback:pe,priorityLevel:se,startTime:De,expirationTime:we,sortIndex:-1},De>Se?(se.sortIndex=De,n(E,se),a(b)===null&&se===a(E)&&(k?(F(re),re=-1):k=!0,be(W,De-Se))):(se.sortIndex=we,n(b,se),A||P||(A=!0,ue(B))),se},e.unstable_shouldYield=te,e.unstable_wrapCallback=function(se){var pe=N;return function(){var De=N;N=pe;try{return se.apply(this,arguments)}finally{N=De}}}})(GY);BY.exports=GY;var w_e=BY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T_e=q,Ns=w_e;function rt(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var WY=new Set,by={};function Gh(e,n){Qm(e,n),Qm(e+"Capture",n)}function Qm(e,n){for(by[e]=n,e=0;e<n.length;e++)WY.add(n[e])}var Rl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v1=Object.prototype.hasOwnProperty,C_e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G$={},W$={};function N_e(e){return v1.call(W$,e)?!0:v1.call(G$,e)?!1:C_e.test(e)?W$[e]=!0:(G$[e]=!0,!1)}function R_e(e,n,a,o){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return o?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function A_e(e,n,a,o){if(n===null||typeof n>"u"||R_e(e,n,a,o))return!0;if(o)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Pa(e,n,a,o,d,p,f){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=o,this.attributeNamespace=d,this.mustUseProperty=a,this.propertyName=e,this.type=n,this.sanitizeURL=p,this.removeEmptyString=f}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Qi[e]=new Pa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];Qi[n]=new Pa(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Qi[e]=new Pa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Qi[e]=new Pa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Qi[e]=new Pa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Qi[e]=new Pa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Qi[e]=new Pa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Qi[e]=new Pa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Qi[e]=new Pa(e,5,!1,e.toLowerCase(),null,!1,!1)});var sk=/[\-:]([a-z])/g;function ok(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(sk,ok);Qi[n]=new Pa(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(sk,ok);Qi[n]=new Pa(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(sk,ok);Qi[n]=new Pa(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Qi[e]=new Pa(e,1,!1,e.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Pa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Qi[e]=new Pa(e,1,!1,e.toLowerCase(),null,!0,!0)});function ck(e,n,a,o){var d=Qi.hasOwnProperty(n)?Qi[n]:null;(d!==null?d.type!==0:o||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(A_e(n,a,d,o)&&(a=null),o||d===null?N_e(n)&&(a===null?e.removeAttribute(n):e.setAttribute(n,""+a)):d.mustUseProperty?e[d.propertyName]=a===null?d.type===3?!1:"":a:(n=d.attributeName,o=d.attributeNamespace,a===null?e.removeAttribute(n):(d=d.type,a=d===3||d===4&&a===!0?"":""+a,o?e.setAttributeNS(o,n,a):e.setAttribute(n,a))))}var Ll=T_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$E=Symbol.for("react.element"),Tm=Symbol.for("react.portal"),Cm=Symbol.for("react.fragment"),lk=Symbol.for("react.strict_mode"),y1=Symbol.for("react.profiler"),$Y=Symbol.for("react.provider"),HY=Symbol.for("react.context"),dk=Symbol.for("react.forward_ref"),_1=Symbol.for("react.suspense"),b1=Symbol.for("react.suspense_list"),uk=Symbol.for("react.memo"),Sd=Symbol.for("react.lazy"),zY=Symbol.for("react.offscreen"),$$=Symbol.iterator;function Ov(e){return e===null||typeof e!="object"?null:(e=$$&&e[$$]||e["@@iterator"],typeof e=="function"?e:null)}var Wr=Object.assign,oO;function Qv(e){if(oO===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);oO=n&&n[1]||""}return`
`+oO+e}var cO=!1;function lO(e,n){if(!e||cO)return"";cO=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(E){var o=E}Reflect.construct(e,[],n)}else{try{n.call()}catch(E){o=E}e.call(n.prototype)}else{try{throw Error()}catch(E){o=E}e()}}catch(E){if(E&&o&&typeof E.stack=="string"){for(var d=E.stack.split(`
`),p=o.stack.split(`
`),f=d.length-1,v=p.length-1;1<=f&&0<=v&&d[f]!==p[v];)v--;for(;1<=f&&0<=v;f--,v--)if(d[f]!==p[v]){if(f!==1||v!==1)do if(f--,v--,0>v||d[f]!==p[v]){var b=`
`+d[f].replace(" at new "," at ");return e.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",e.displayName)),b}while(1<=f&&0<=v);break}}}finally{cO=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?Qv(e):""}function I_e(e){switch(e.tag){case 5:return Qv(e.type);case 16:return Qv("Lazy");case 13:return Qv("Suspense");case 19:return Qv("SuspenseList");case 0:case 2:case 15:return e=lO(e.type,!1),e;case 11:return e=lO(e.type.render,!1),e;case 1:return e=lO(e.type,!0),e;default:return""}}function E1(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Cm:return"Fragment";case Tm:return"Portal";case y1:return"Profiler";case lk:return"StrictMode";case _1:return"Suspense";case b1:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case HY:return(e.displayName||"Context")+".Consumer";case $Y:return(e._context.displayName||"Context")+".Provider";case dk:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case uk:return n=e.displayName||null,n!==null?n:E1(e.type)||"Memo";case Sd:n=e._payload,e=e._init;try{return E1(e(n))}catch{}}return null}function O_e(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E1(n);case 8:return n===lk?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function qd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function KY(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function P_e(e){var n=KY(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var d=a.get,p=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return d.call(this)},set:function(f){o=""+f,p.call(this,f)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(f){o=""+f},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function HE(e){e._valueTracker||(e._valueTracker=P_e(e))}function YY(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return e&&(o=KY(e)?e.checked?"true":"false":e.value),e=o,e!==a?(n.setValue(e),!0):!1}function Wx(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function x1(e,n){var a=n.checked;return Wr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function H$(e,n){var a=n.defaultValue==null?"":n.defaultValue,o=n.checked!=null?n.checked:n.defaultChecked;a=qd(n.value!=null?n.value:a),e._wrapperState={initialChecked:o,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function qY(e,n){n=n.checked,n!=null&&ck(e,"checked",n,!1)}function S1(e,n){qY(e,n);var a=qd(n.value),o=n.type;if(a!=null)o==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?w1(e,n.type,a):n.hasOwnProperty("defaultValue")&&w1(e,n.type,qd(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function z$(e,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var o=n.type;if(!(o!=="submit"&&o!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,a||n===e.value||(e.value=n),e.defaultValue=n}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function w1(e,n,a){(n!=="number"||Wx(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var Zv=Array.isArray;function Vm(e,n,a,o){if(e=e.options,n){n={};for(var d=0;d<a.length;d++)n["$"+a[d]]=!0;for(a=0;a<e.length;a++)d=n.hasOwnProperty("$"+e[a].value),e[a].selected!==d&&(e[a].selected=d),d&&o&&(e[a].defaultSelected=!0)}else{for(a=""+qd(a),n=null,d=0;d<e.length;d++){if(e[d].value===a){e[d].selected=!0,o&&(e[d].defaultSelected=!0);return}n!==null||e[d].disabled||(n=e[d])}n!==null&&(n.selected=!0)}}function T1(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(rt(91));return Wr({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function K$(e,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(rt(92));if(Zv(a)){if(1<a.length)throw Error(rt(93));a=a[0]}n=a}n==null&&(n=""),a=n}e._wrapperState={initialValue:qd(a)}}function XY(e,n){var a=qd(n.value),o=qd(n.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),n.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),o!=null&&(e.defaultValue=""+o)}function Y$(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function JY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function C1(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?JY(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var zE,QY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,o,d){MSApp.execUnsafeLocalFunction(function(){return e(n,a,o,d)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(zE=zE||document.createElement("div"),zE.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=zE.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function Ey(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var iy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},D_e=["Webkit","ms","Moz","O"];Object.keys(iy).forEach(function(e){D_e.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),iy[n]=iy[e]})});function ZY(e,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||iy.hasOwnProperty(e)&&iy[e]?(""+n).trim():n+"px"}function eq(e,n){e=e.style;for(var a in n)if(n.hasOwnProperty(a)){var o=a.indexOf("--")===0,d=ZY(a,n[a],o);a==="float"&&(a="cssFloat"),o?e.setProperty(a,d):e[a]=d}}var k_e=Wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function N1(e,n){if(n){if(k_e[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(rt(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(rt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(rt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(rt(62))}}function R1(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var A1=null;function hk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var I1=null,Bm=null,Gm=null;function q$(e){if(e=C0(e)){if(typeof I1!="function")throw Error(rt(280));var n=e.stateNode;n&&(n=Rw(n),I1(e.stateNode,e.type,n))}}function tq(e){Bm?Gm?Gm.push(e):Gm=[e]:Bm=e}function nq(){if(Bm){var e=Bm,n=Gm;if(Gm=Bm=null,q$(e),n)for(e=0;e<n.length;e++)q$(n[e])}}function rq(e,n){return e(n)}function iq(){}var dO=!1;function aq(e,n,a){if(dO)return e(n,a);dO=!0;try{return rq(e,n,a)}finally{dO=!1,(Bm!==null||Gm!==null)&&(iq(),nq())}}function xy(e,n){var a=e.stateNode;if(a===null)return null;var o=Rw(a);if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(rt(231,n,typeof a));return a}var O1=!1;if(Rl)try{var Pv={};Object.defineProperty(Pv,"passive",{get:function(){O1=!0}}),window.addEventListener("test",Pv,Pv),window.removeEventListener("test",Pv,Pv)}catch{O1=!1}function j_e(e,n,a,o,d,p,f,v,b){var E=Array.prototype.slice.call(arguments,3);try{n.apply(a,E)}catch(T){this.onError(T)}}var ay=!1,$x=null,Hx=!1,P1=null,L_e={onError:function(e){ay=!0,$x=e}};function M_e(e,n,a,o,d,p,f,v,b){ay=!1,$x=null,j_e.apply(L_e,arguments)}function U_e(e,n,a,o,d,p,f,v,b){if(M_e.apply(this,arguments),ay){if(ay){var E=$x;ay=!1,$x=null}else throw Error(rt(198));Hx||(Hx=!0,P1=E)}}function Wh(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function sq(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function X$(e){if(Wh(e)!==e)throw Error(rt(188))}function F_e(e){var n=e.alternate;if(!n){if(n=Wh(e),n===null)throw Error(rt(188));return n!==e?null:e}for(var a=e,o=n;;){var d=a.return;if(d===null)break;var p=d.alternate;if(p===null){if(o=d.return,o!==null){a=o;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===a)return X$(d),e;if(p===o)return X$(d),n;p=p.sibling}throw Error(rt(188))}if(a.return!==o.return)a=d,o=p;else{for(var f=!1,v=d.child;v;){if(v===a){f=!0,a=d,o=p;break}if(v===o){f=!0,o=d,a=p;break}v=v.sibling}if(!f){for(v=p.child;v;){if(v===a){f=!0,a=p,o=d;break}if(v===o){f=!0,o=p,a=d;break}v=v.sibling}if(!f)throw Error(rt(189))}}if(a.alternate!==o)throw Error(rt(190))}if(a.tag!==3)throw Error(rt(188));return a.stateNode.current===a?e:n}function oq(e){return e=F_e(e),e!==null?cq(e):null}function cq(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=cq(e);if(n!==null)return n;e=e.sibling}return null}var lq=Ns.unstable_scheduleCallback,J$=Ns.unstable_cancelCallback,V_e=Ns.unstable_shouldYield,B_e=Ns.unstable_requestPaint,ei=Ns.unstable_now,G_e=Ns.unstable_getCurrentPriorityLevel,pk=Ns.unstable_ImmediatePriority,dq=Ns.unstable_UserBlockingPriority,zx=Ns.unstable_NormalPriority,W_e=Ns.unstable_LowPriority,uq=Ns.unstable_IdlePriority,ww=null,Bc=null;function $_e(e){if(Bc&&typeof Bc.onCommitFiberRoot=="function")try{Bc.onCommitFiberRoot(ww,e,void 0,(e.current.flags&128)===128)}catch{}}var ec=Math.clz32?Math.clz32:K_e,H_e=Math.log,z_e=Math.LN2;function K_e(e){return e>>>=0,e===0?32:31-(H_e(e)/z_e|0)|0}var KE=64,YE=4194304;function ey(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Kx(e,n){var a=e.pendingLanes;if(a===0)return 0;var o=0,d=e.suspendedLanes,p=e.pingedLanes,f=a&268435455;if(f!==0){var v=f&~d;v!==0?o=ey(v):(p&=f,p!==0&&(o=ey(p)))}else f=a&~d,f!==0?o=ey(f):p!==0&&(o=ey(p));if(o===0)return 0;if(n!==0&&n!==o&&!(n&d)&&(d=o&-o,p=n&-n,d>=p||d===16&&(p&4194240)!==0))return n;if(o&4&&(o|=a&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=o;0<n;)a=31-ec(n),d=1<<a,o|=e[a],n&=~d;return o}function Y_e(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function q_e(e,n){for(var a=e.suspendedLanes,o=e.pingedLanes,d=e.expirationTimes,p=e.pendingLanes;0<p;){var f=31-ec(p),v=1<<f,b=d[f];b===-1?(!(v&a)||v&o)&&(d[f]=Y_e(v,n)):b<=n&&(e.expiredLanes|=v),p&=~v}}function D1(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function hq(){var e=KE;return KE<<=1,!(KE&4194240)&&(KE=64),e}function uO(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function w0(e,n,a){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-ec(n),e[n]=a}function X_e(e,n){var a=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<a;){var d=31-ec(a),p=1<<d;n[d]=0,o[d]=-1,e[d]=-1,a&=~p}}function mk(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var o=31-ec(a),d=1<<o;d&n|e[o]&n&&(e[o]|=n),a&=~d}}var Jn=0;function pq(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var mq,fk,fq,gq,vq,k1=!1,qE=[],Ld=null,Md=null,Ud=null,Sy=new Map,wy=new Map,Cd=[],J_e="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q$(e,n){switch(e){case"focusin":case"focusout":Ld=null;break;case"dragenter":case"dragleave":Md=null;break;case"mouseover":case"mouseout":Ud=null;break;case"pointerover":case"pointerout":Sy.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":wy.delete(n.pointerId)}}function Dv(e,n,a,o,d,p){return e===null||e.nativeEvent!==p?(e={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:p,targetContainers:[d]},n!==null&&(n=C0(n),n!==null&&fk(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),e)}function Q_e(e,n,a,o,d){switch(n){case"focusin":return Ld=Dv(Ld,e,n,a,o,d),!0;case"dragenter":return Md=Dv(Md,e,n,a,o,d),!0;case"mouseover":return Ud=Dv(Ud,e,n,a,o,d),!0;case"pointerover":var p=d.pointerId;return Sy.set(p,Dv(Sy.get(p)||null,e,n,a,o,d)),!0;case"gotpointercapture":return p=d.pointerId,wy.set(p,Dv(wy.get(p)||null,e,n,a,o,d)),!0}return!1}function yq(e){var n=mh(e.target);if(n!==null){var a=Wh(n);if(a!==null){if(n=a.tag,n===13){if(n=sq(a),n!==null){e.blockedOn=n,vq(e.priority,function(){fq(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Cx(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=j1(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);A1=o,a.target.dispatchEvent(o),A1=null}else return n=C0(a),n!==null&&fk(n),e.blockedOn=a,!1;n.shift()}return!0}function Z$(e,n,a){Cx(e)&&a.delete(n)}function Z_e(){k1=!1,Ld!==null&&Cx(Ld)&&(Ld=null),Md!==null&&Cx(Md)&&(Md=null),Ud!==null&&Cx(Ud)&&(Ud=null),Sy.forEach(Z$),wy.forEach(Z$)}function kv(e,n){e.blockedOn===n&&(e.blockedOn=null,k1||(k1=!0,Ns.unstable_scheduleCallback(Ns.unstable_NormalPriority,Z_e)))}function Ty(e){function n(d){return kv(d,e)}if(0<qE.length){kv(qE[0],e);for(var a=1;a<qE.length;a++){var o=qE[a];o.blockedOn===e&&(o.blockedOn=null)}}for(Ld!==null&&kv(Ld,e),Md!==null&&kv(Md,e),Ud!==null&&kv(Ud,e),Sy.forEach(n),wy.forEach(n),a=0;a<Cd.length;a++)o=Cd[a],o.blockedOn===e&&(o.blockedOn=null);for(;0<Cd.length&&(a=Cd[0],a.blockedOn===null);)yq(a),a.blockedOn===null&&Cd.shift()}var Wm=Ll.ReactCurrentBatchConfig,Yx=!0;function ebe(e,n,a,o){var d=Jn,p=Wm.transition;Wm.transition=null;try{Jn=1,gk(e,n,a,o)}finally{Jn=d,Wm.transition=p}}function tbe(e,n,a,o){var d=Jn,p=Wm.transition;Wm.transition=null;try{Jn=4,gk(e,n,a,o)}finally{Jn=d,Wm.transition=p}}function gk(e,n,a,o){if(Yx){var d=j1(e,n,a,o);if(d===null)EO(e,n,o,qx,a),Q$(e,o);else if(Q_e(d,e,n,a,o))o.stopPropagation();else if(Q$(e,o),n&4&&-1<J_e.indexOf(e)){for(;d!==null;){var p=C0(d);if(p!==null&&mq(p),p=j1(e,n,a,o),p===null&&EO(e,n,o,qx,a),p===d)break;d=p}d!==null&&o.stopPropagation()}else EO(e,n,o,null,a)}}var qx=null;function j1(e,n,a,o){if(qx=null,e=hk(o),e=mh(e),e!==null)if(n=Wh(e),n===null)e=null;else if(a=n.tag,a===13){if(e=sq(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return qx=e,null}function _q(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(G_e()){case pk:return 1;case dq:return 4;case zx:case W_e:return 16;case uq:return 536870912;default:return 16}default:return 16}}var Od=null,vk=null,Nx=null;function bq(){if(Nx)return Nx;var e,n=vk,a=n.length,o,d="value"in Od?Od.value:Od.textContent,p=d.length;for(e=0;e<a&&n[e]===d[e];e++);var f=a-e;for(o=1;o<=f&&n[a-o]===d[p-o];o++);return Nx=d.slice(e,1<o?1-o:void 0)}function Rx(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function XE(){return!0}function eH(){return!1}function As(e){function n(a,o,d,p,f){this._reactName=a,this._targetInst=d,this.type=o,this.nativeEvent=p,this.target=f,this.currentTarget=null;for(var v in e)e.hasOwnProperty(v)&&(a=e[v],this[v]=a?a(p):p[v]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?XE:eH,this.isPropagationStopped=eH,this}return Wr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=XE)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=XE)},persist:function(){},isPersistent:XE}),n}var kf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yk=As(kf),T0=Wr({},kf,{view:0,detail:0}),nbe=As(T0),hO,pO,jv,Tw=Wr({},T0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_k,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==jv&&(jv&&e.type==="mousemove"?(hO=e.screenX-jv.screenX,pO=e.screenY-jv.screenY):pO=hO=0,jv=e),hO)},movementY:function(e){return"movementY"in e?e.movementY:pO}}),tH=As(Tw),rbe=Wr({},Tw,{dataTransfer:0}),ibe=As(rbe),abe=Wr({},T0,{relatedTarget:0}),mO=As(abe),sbe=Wr({},kf,{animationName:0,elapsedTime:0,pseudoElement:0}),obe=As(sbe),cbe=Wr({},kf,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),lbe=As(cbe),dbe=Wr({},kf,{data:0}),nH=As(dbe),ube={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hbe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pbe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mbe(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=pbe[e])?!!n[e]:!1}function _k(){return mbe}var fbe=Wr({},T0,{key:function(e){if(e.key){var n=ube[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=Rx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?hbe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_k,charCode:function(e){return e.type==="keypress"?Rx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Rx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),gbe=As(fbe),vbe=Wr({},Tw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rH=As(vbe),ybe=Wr({},T0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_k}),_be=As(ybe),bbe=Wr({},kf,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ebe=As(bbe),xbe=Wr({},Tw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Sbe=As(xbe),wbe=[9,13,27,32],bk=Rl&&"CompositionEvent"in window,sy=null;Rl&&"documentMode"in document&&(sy=document.documentMode);var Tbe=Rl&&"TextEvent"in window&&!sy,Eq=Rl&&(!bk||sy&&8<sy&&11>=sy),iH=" ",aH=!1;function xq(e,n){switch(e){case"keyup":return wbe.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Nm=!1;function Cbe(e,n){switch(e){case"compositionend":return Sq(n);case"keypress":return n.which!==32?null:(aH=!0,iH);case"textInput":return e=n.data,e===iH&&aH?null:e;default:return null}}function Nbe(e,n){if(Nm)return e==="compositionend"||!bk&&xq(e,n)?(e=bq(),Nx=vk=Od=null,Nm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Eq&&n.locale!=="ko"?null:n.data;default:return null}}var Rbe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sH(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!Rbe[e.type]:n==="textarea"}function wq(e,n,a,o){tq(o),n=Xx(n,"onChange"),0<n.length&&(a=new yk("onChange","change",null,a,o),e.push({event:a,listeners:n}))}var oy=null,Cy=null;function Abe(e){jq(e,0)}function Cw(e){var n=Im(e);if(YY(n))return e}function Ibe(e,n){if(e==="change")return n}var Tq=!1;if(Rl){var fO;if(Rl){var gO="oninput"in document;if(!gO){var oH=document.createElement("div");oH.setAttribute("oninput","return;"),gO=typeof oH.oninput=="function"}fO=gO}else fO=!1;Tq=fO&&(!document.documentMode||9<document.documentMode)}function cH(){oy&&(oy.detachEvent("onpropertychange",Cq),Cy=oy=null)}function Cq(e){if(e.propertyName==="value"&&Cw(Cy)){var n=[];wq(n,Cy,e,hk(e)),aq(Abe,n)}}function Obe(e,n,a){e==="focusin"?(cH(),oy=n,Cy=a,oy.attachEvent("onpropertychange",Cq)):e==="focusout"&&cH()}function Pbe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Cw(Cy)}function Dbe(e,n){if(e==="click")return Cw(n)}function kbe(e,n){if(e==="input"||e==="change")return Cw(n)}function jbe(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var rc=typeof Object.is=="function"?Object.is:jbe;function Ny(e,n){if(rc(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var d=a[o];if(!v1.call(n,d)||!rc(e[d],n[d]))return!1}return!0}function lH(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dH(e,n){var a=lH(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=n&&o>=n)return{node:a,offset:n-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=lH(a)}}function Nq(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Nq(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Rq(){for(var e=window,n=Wx();n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=Wx(e.document)}return n}function Ek(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function Lbe(e){var n=Rq(),a=e.focusedElem,o=e.selectionRange;if(n!==a&&a&&a.ownerDocument&&Nq(a.ownerDocument.documentElement,a)){if(o!==null&&Ek(a)){if(n=o.start,e=o.end,e===void 0&&(e=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(e,a.value.length);else if(e=(n=a.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var d=a.textContent.length,p=Math.min(o.start,d);o=o.end===void 0?p:Math.min(o.end,d),!e.extend&&p>o&&(d=o,o=p,p=d),d=dH(a,p);var f=dH(a,o);d&&f&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(n=n.createRange(),n.setStart(d.node,d.offset),e.removeAllRanges(),p>o?(e.addRange(n),e.extend(f.node,f.offset)):(n.setEnd(f.node,f.offset),e.addRange(n)))}}for(n=[],e=a;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)e=n[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Mbe=Rl&&"documentMode"in document&&11>=document.documentMode,Rm=null,L1=null,cy=null,M1=!1;function uH(e,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;M1||Rm==null||Rm!==Wx(o)||(o=Rm,"selectionStart"in o&&Ek(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),cy&&Ny(cy,o)||(cy=o,o=Xx(L1,"onSelect"),0<o.length&&(n=new yk("onSelect","select",null,n,a),e.push({event:n,listeners:o}),n.target=Rm)))}function JE(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var Am={animationend:JE("Animation","AnimationEnd"),animationiteration:JE("Animation","AnimationIteration"),animationstart:JE("Animation","AnimationStart"),transitionend:JE("Transition","TransitionEnd")},vO={},Aq={};Rl&&(Aq=document.createElement("div").style,"AnimationEvent"in window||(delete Am.animationend.animation,delete Am.animationiteration.animation,delete Am.animationstart.animation),"TransitionEvent"in window||delete Am.transitionend.transition);function Nw(e){if(vO[e])return vO[e];if(!Am[e])return e;var n=Am[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in Aq)return vO[e]=n[a];return e}var Iq=Nw("animationend"),Oq=Nw("animationiteration"),Pq=Nw("animationstart"),Dq=Nw("transitionend"),kq=new Map,hH="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zd(e,n){kq.set(e,n),Gh(n,[e])}for(var yO=0;yO<hH.length;yO++){var _O=hH[yO],Ube=_O.toLowerCase(),Fbe=_O[0].toUpperCase()+_O.slice(1);Zd(Ube,"on"+Fbe)}Zd(Iq,"onAnimationEnd");Zd(Oq,"onAnimationIteration");Zd(Pq,"onAnimationStart");Zd("dblclick","onDoubleClick");Zd("focusin","onFocus");Zd("focusout","onBlur");Zd(Dq,"onTransitionEnd");Qm("onMouseEnter",["mouseout","mouseover"]);Qm("onMouseLeave",["mouseout","mouseover"]);Qm("onPointerEnter",["pointerout","pointerover"]);Qm("onPointerLeave",["pointerout","pointerover"]);Gh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ty="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vbe=new Set("cancel close invalid load scroll toggle".split(" ").concat(ty));function pH(e,n,a){var o=e.type||"unknown-event";e.currentTarget=a,U_e(o,n,void 0,e),e.currentTarget=null}function jq(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],d=o.event;o=o.listeners;e:{var p=void 0;if(n)for(var f=o.length-1;0<=f;f--){var v=o[f],b=v.instance,E=v.currentTarget;if(v=v.listener,b!==p&&d.isPropagationStopped())break e;pH(d,v,E),p=b}else for(f=0;f<o.length;f++){if(v=o[f],b=v.instance,E=v.currentTarget,v=v.listener,b!==p&&d.isPropagationStopped())break e;pH(d,v,E),p=b}}}if(Hx)throw e=P1,Hx=!1,P1=null,e}function Sr(e,n){var a=n[G1];a===void 0&&(a=n[G1]=new Set);var o=e+"__bubble";a.has(o)||(Lq(n,e,2,!1),a.add(o))}function bO(e,n,a){var o=0;n&&(o|=4),Lq(a,e,o,n)}var QE="_reactListening"+Math.random().toString(36).slice(2);function Ry(e){if(!e[QE]){e[QE]=!0,WY.forEach(function(a){a!=="selectionchange"&&(Vbe.has(a)||bO(a,!1,e),bO(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[QE]||(n[QE]=!0,bO("selectionchange",!1,n))}}function Lq(e,n,a,o){switch(_q(n)){case 1:var d=ebe;break;case 4:d=tbe;break;default:d=gk}a=d.bind(null,n,a,e),d=void 0,!O1||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),o?d!==void 0?e.addEventListener(n,a,{capture:!0,passive:d}):e.addEventListener(n,a,!0):d!==void 0?e.addEventListener(n,a,{passive:d}):e.addEventListener(n,a,!1)}function EO(e,n,a,o,d){var p=o;if(!(n&1)&&!(n&2)&&o!==null)e:for(;;){if(o===null)return;var f=o.tag;if(f===3||f===4){var v=o.stateNode.containerInfo;if(v===d||v.nodeType===8&&v.parentNode===d)break;if(f===4)for(f=o.return;f!==null;){var b=f.tag;if((b===3||b===4)&&(b=f.stateNode.containerInfo,b===d||b.nodeType===8&&b.parentNode===d))return;f=f.return}for(;v!==null;){if(f=mh(v),f===null)return;if(b=f.tag,b===5||b===6){o=p=f;continue e}v=v.parentNode}}o=o.return}aq(function(){var E=p,T=hk(a),w=[];e:{var N=kq.get(e);if(N!==void 0){var P=yk,A=e;switch(e){case"keypress":if(Rx(a)===0)break e;case"keydown":case"keyup":P=gbe;break;case"focusin":A="focus",P=mO;break;case"focusout":A="blur",P=mO;break;case"beforeblur":case"afterblur":P=mO;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":P=tH;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":P=ibe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":P=_be;break;case Iq:case Oq:case Pq:P=obe;break;case Dq:P=Ebe;break;case"scroll":P=nbe;break;case"wheel":P=Sbe;break;case"copy":case"cut":case"paste":P=lbe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":P=rH}var k=(n&4)!==0,I=!k&&e==="scroll",F=k?N!==null?N+"Capture":null:N;k=[];for(var U=E,V;U!==null;){V=U;var W=V.stateNode;if(V.tag===5&&W!==null&&(V=W,F!==null&&(W=xy(U,F),W!=null&&k.push(Ay(U,W,V)))),I)break;U=U.return}0<k.length&&(N=new P(N,A,null,a,T),w.push({event:N,listeners:k}))}}if(!(n&7)){e:{if(N=e==="mouseover"||e==="pointerover",P=e==="mouseout"||e==="pointerout",N&&a!==A1&&(A=a.relatedTarget||a.fromElement)&&(mh(A)||A[Al]))break e;if((P||N)&&(N=T.window===T?T:(N=T.ownerDocument)?N.defaultView||N.parentWindow:window,P?(A=a.relatedTarget||a.toElement,P=E,A=A?mh(A):null,A!==null&&(I=Wh(A),A!==I||A.tag!==5&&A.tag!==6)&&(A=null)):(P=null,A=E),P!==A)){if(k=tH,W="onMouseLeave",F="onMouseEnter",U="mouse",(e==="pointerout"||e==="pointerover")&&(k=rH,W="onPointerLeave",F="onPointerEnter",U="pointer"),I=P==null?N:Im(P),V=A==null?N:Im(A),N=new k(W,U+"leave",P,a,T),N.target=I,N.relatedTarget=V,W=null,mh(T)===E&&(k=new k(F,U+"enter",A,a,T),k.target=V,k.relatedTarget=I,W=k),I=W,P&&A)t:{for(k=P,F=A,U=0,V=k;V;V=vm(V))U++;for(V=0,W=F;W;W=vm(W))V++;for(;0<U-V;)k=vm(k),U--;for(;0<V-U;)F=vm(F),V--;for(;U--;){if(k===F||F!==null&&k===F.alternate)break t;k=vm(k),F=vm(F)}k=null}else k=null;P!==null&&mH(w,N,P,k,!1),A!==null&&I!==null&&mH(w,I,A,k,!0)}}e:{if(N=E?Im(E):window,P=N.nodeName&&N.nodeName.toLowerCase(),P==="select"||P==="input"&&N.type==="file")var B=Ibe;else if(sH(N))if(Tq)B=kbe;else{B=Pbe;var z=Obe}else(P=N.nodeName)&&P.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(B=Dbe);if(B&&(B=B(e,E))){wq(w,B,a,T);break e}z&&z(e,N,E),e==="focusout"&&(z=N._wrapperState)&&z.controlled&&N.type==="number"&&w1(N,"number",N.value)}switch(z=E?Im(E):window,e){case"focusin":(sH(z)||z.contentEditable==="true")&&(Rm=z,L1=E,cy=null);break;case"focusout":cy=L1=Rm=null;break;case"mousedown":M1=!0;break;case"contextmenu":case"mouseup":case"dragend":M1=!1,uH(w,a,T);break;case"selectionchange":if(Mbe)break;case"keydown":case"keyup":uH(w,a,T)}var Y;if(bk)e:{switch(e){case"compositionstart":var re="onCompositionStart";break e;case"compositionend":re="onCompositionEnd";break e;case"compositionupdate":re="onCompositionUpdate";break e}re=void 0}else Nm?xq(e,a)&&(re="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(re="onCompositionStart");re&&(Eq&&a.locale!=="ko"&&(Nm||re!=="onCompositionStart"?re==="onCompositionEnd"&&Nm&&(Y=bq()):(Od=T,vk="value"in Od?Od.value:Od.textContent,Nm=!0)),z=Xx(E,re),0<z.length&&(re=new nH(re,e,null,a,T),w.push({event:re,listeners:z}),Y?re.data=Y:(Y=Sq(a),Y!==null&&(re.data=Y)))),(Y=Tbe?Cbe(e,a):Nbe(e,a))&&(E=Xx(E,"onBeforeInput"),0<E.length&&(T=new nH("onBeforeInput","beforeinput",null,a,T),w.push({event:T,listeners:E}),T.data=Y))}jq(w,n)})}function Ay(e,n,a){return{instance:e,listener:n,currentTarget:a}}function Xx(e,n){for(var a=n+"Capture",o=[];e!==null;){var d=e,p=d.stateNode;d.tag===5&&p!==null&&(d=p,p=xy(e,a),p!=null&&o.unshift(Ay(e,p,d)),p=xy(e,n),p!=null&&o.push(Ay(e,p,d))),e=e.return}return o}function vm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function mH(e,n,a,o,d){for(var p=n._reactName,f=[];a!==null&&a!==o;){var v=a,b=v.alternate,E=v.stateNode;if(b!==null&&b===o)break;v.tag===5&&E!==null&&(v=E,d?(b=xy(a,p),b!=null&&f.unshift(Ay(a,b,v))):d||(b=xy(a,p),b!=null&&f.push(Ay(a,b,v)))),a=a.return}f.length!==0&&e.push({event:n,listeners:f})}var Bbe=/\r\n?/g,Gbe=/\u0000|\uFFFD/g;function fH(e){return(typeof e=="string"?e:""+e).replace(Bbe,`
`).replace(Gbe,"")}function ZE(e,n,a){if(n=fH(n),fH(e)!==n&&a)throw Error(rt(425))}function Jx(){}var U1=null,F1=null;function V1(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var B1=typeof setTimeout=="function"?setTimeout:void 0,Wbe=typeof clearTimeout=="function"?clearTimeout:void 0,gH=typeof Promise=="function"?Promise:void 0,$be=typeof queueMicrotask=="function"?queueMicrotask:typeof gH<"u"?function(e){return gH.resolve(null).then(e).catch(Hbe)}:B1;function Hbe(e){setTimeout(function(){throw e})}function xO(e,n){var a=n,o=0;do{var d=a.nextSibling;if(e.removeChild(a),d&&d.nodeType===8)if(a=d.data,a==="/$"){if(o===0){e.removeChild(d),Ty(n);return}o--}else a!=="$"&&a!=="$?"&&a!=="$!"||o++;a=d}while(a);Ty(n)}function Fd(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function vH(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}var jf=Math.random().toString(36).slice(2),Mc="__reactFiber$"+jf,Iy="__reactProps$"+jf,Al="__reactContainer$"+jf,G1="__reactEvents$"+jf,zbe="__reactListeners$"+jf,Kbe="__reactHandles$"+jf;function mh(e){var n=e[Mc];if(n)return n;for(var a=e.parentNode;a;){if(n=a[Al]||a[Mc]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=vH(e);e!==null;){if(a=e[Mc])return a;e=vH(e)}return n}e=a,a=e.parentNode}return null}function C0(e){return e=e[Mc]||e[Al],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Im(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(rt(33))}function Rw(e){return e[Iy]||null}var W1=[],Om=-1;function eu(e){return{current:e}}function Cr(e){0>Om||(e.current=W1[Om],W1[Om]=null,Om--)}function pr(e,n){Om++,W1[Om]=e.current,e.current=n}var Xd={},pa=eu(Xd),Za=eu(!1),Ih=Xd;function Zm(e,n){var a=e.type.contextTypes;if(!a)return Xd;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===n)return o.__reactInternalMemoizedMaskedChildContext;var d={},p;for(p in a)d[p]=n[p];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=d),d}function es(e){return e=e.childContextTypes,e!=null}function Qx(){Cr(Za),Cr(pa)}function yH(e,n,a){if(pa.current!==Xd)throw Error(rt(168));pr(pa,n),pr(Za,a)}function Mq(e,n,a){var o=e.stateNode;if(n=n.childContextTypes,typeof o.getChildContext!="function")return a;o=o.getChildContext();for(var d in o)if(!(d in n))throw Error(rt(108,O_e(e)||"Unknown",d));return Wr({},a,o)}function Zx(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Xd,Ih=pa.current,pr(pa,e),pr(Za,Za.current),!0}function _H(e,n,a){var o=e.stateNode;if(!o)throw Error(rt(169));a?(e=Mq(e,n,Ih),o.__reactInternalMemoizedMergedChildContext=e,Cr(Za),Cr(pa),pr(pa,e)):Cr(Za),pr(Za,a)}var gl=null,Aw=!1,SO=!1;function Uq(e){gl===null?gl=[e]:gl.push(e)}function Ybe(e){Aw=!0,Uq(e)}function tu(){if(!SO&&gl!==null){SO=!0;var e=0,n=Jn;try{var a=gl;for(Jn=1;e<a.length;e++){var o=a[e];do o=o(!0);while(o!==null)}gl=null,Aw=!1}catch(d){throw gl!==null&&(gl=gl.slice(e+1)),lq(pk,tu),d}finally{Jn=n,SO=!1}}return null}var Pm=[],Dm=0,eS=null,tS=0,io=[],ao=0,Oh=null,vl=1,yl="";function oh(e,n){Pm[Dm++]=tS,Pm[Dm++]=eS,eS=e,tS=n}function Fq(e,n,a){io[ao++]=vl,io[ao++]=yl,io[ao++]=Oh,Oh=e;var o=vl;e=yl;var d=32-ec(o)-1;o&=~(1<<d),a+=1;var p=32-ec(n)+d;if(30<p){var f=d-d%5;p=(o&(1<<f)-1).toString(32),o>>=f,d-=f,vl=1<<32-ec(n)+d|a<<d|o,yl=p+e}else vl=1<<p|a<<d|o,yl=e}function xk(e){e.return!==null&&(oh(e,1),Fq(e,1,0))}function Sk(e){for(;e===eS;)eS=Pm[--Dm],Pm[Dm]=null,tS=Pm[--Dm],Pm[Dm]=null;for(;e===Oh;)Oh=io[--ao],io[ao]=null,yl=io[--ao],io[ao]=null,vl=io[--ao],io[ao]=null}var Cs=null,Ts=null,kr=!1,Jo=null;function Vq(e,n){var a=oo(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=e,n=e.deletions,n===null?(e.deletions=[a],e.flags|=16):n.push(a)}function bH(e,n){switch(e.tag){case 5:var a=e.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,Cs=e,Ts=Fd(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,Cs=e,Ts=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=Oh!==null?{id:vl,overflow:yl}:null,e.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=oo(18,null,null,0),a.stateNode=n,a.return=e,e.child=a,Cs=e,Ts=null,!0):!1;default:return!1}}function $1(e){return(e.mode&1)!==0&&(e.flags&128)===0}function H1(e){if(kr){var n=Ts;if(n){var a=n;if(!bH(e,n)){if($1(e))throw Error(rt(418));n=Fd(a.nextSibling);var o=Cs;n&&bH(e,n)?Vq(o,a):(e.flags=e.flags&-4097|2,kr=!1,Cs=e)}}else{if($1(e))throw Error(rt(418));e.flags=e.flags&-4097|2,kr=!1,Cs=e}}}function EH(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Cs=e}function ex(e){if(e!==Cs)return!1;if(!kr)return EH(e),kr=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!V1(e.type,e.memoizedProps)),n&&(n=Ts)){if($1(e))throw Bq(),Error(rt(418));for(;n;)Vq(e,n),n=Fd(n.nextSibling)}if(EH(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(rt(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(n===0){Ts=Fd(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}e=e.nextSibling}Ts=null}}else Ts=Cs?Fd(e.stateNode.nextSibling):null;return!0}function Bq(){for(var e=Ts;e;)e=Fd(e.nextSibling)}function ef(){Ts=Cs=null,kr=!1}function wk(e){Jo===null?Jo=[e]:Jo.push(e)}var qbe=Ll.ReactCurrentBatchConfig;function Lv(e,n,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(rt(309));var o=a.stateNode}if(!o)throw Error(rt(147,e));var d=o,p=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===p?n.ref:(n=function(f){var v=d.refs;f===null?delete v[p]:v[p]=f},n._stringRef=p,n)}if(typeof e!="string")throw Error(rt(284));if(!a._owner)throw Error(rt(290,e))}return e}function tx(e,n){throw e=Object.prototype.toString.call(n),Error(rt(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function xH(e){var n=e._init;return n(e._payload)}function Gq(e){function n(F,U){if(e){var V=F.deletions;V===null?(F.deletions=[U],F.flags|=16):V.push(U)}}function a(F,U){if(!e)return null;for(;U!==null;)n(F,U),U=U.sibling;return null}function o(F,U){for(F=new Map;U!==null;)U.key!==null?F.set(U.key,U):F.set(U.index,U),U=U.sibling;return F}function d(F,U){return F=Wd(F,U),F.index=0,F.sibling=null,F}function p(F,U,V){return F.index=V,e?(V=F.alternate,V!==null?(V=V.index,V<U?(F.flags|=2,U):V):(F.flags|=2,U)):(F.flags|=1048576,U)}function f(F){return e&&F.alternate===null&&(F.flags|=2),F}function v(F,U,V,W){return U===null||U.tag!==6?(U=IO(V,F.mode,W),U.return=F,U):(U=d(U,V),U.return=F,U)}function b(F,U,V,W){var B=V.type;return B===Cm?T(F,U,V.props.children,W,V.key):U!==null&&(U.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Sd&&xH(B)===U.type)?(W=d(U,V.props),W.ref=Lv(F,U,V),W.return=F,W):(W=jx(V.type,V.key,V.props,null,F.mode,W),W.ref=Lv(F,U,V),W.return=F,W)}function E(F,U,V,W){return U===null||U.tag!==4||U.stateNode.containerInfo!==V.containerInfo||U.stateNode.implementation!==V.implementation?(U=OO(V,F.mode,W),U.return=F,U):(U=d(U,V.children||[]),U.return=F,U)}function T(F,U,V,W,B){return U===null||U.tag!==7?(U=Th(V,F.mode,W,B),U.return=F,U):(U=d(U,V),U.return=F,U)}function w(F,U,V){if(typeof U=="string"&&U!==""||typeof U=="number")return U=IO(""+U,F.mode,V),U.return=F,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case $E:return V=jx(U.type,U.key,U.props,null,F.mode,V),V.ref=Lv(F,null,U),V.return=F,V;case Tm:return U=OO(U,F.mode,V),U.return=F,U;case Sd:var W=U._init;return w(F,W(U._payload),V)}if(Zv(U)||Ov(U))return U=Th(U,F.mode,V,null),U.return=F,U;tx(F,U)}return null}function N(F,U,V,W){var B=U!==null?U.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return B!==null?null:v(F,U,""+V,W);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case $E:return V.key===B?b(F,U,V,W):null;case Tm:return V.key===B?E(F,U,V,W):null;case Sd:return B=V._init,N(F,U,B(V._payload),W)}if(Zv(V)||Ov(V))return B!==null?null:T(F,U,V,W,null);tx(F,V)}return null}function P(F,U,V,W,B){if(typeof W=="string"&&W!==""||typeof W=="number")return F=F.get(V)||null,v(U,F,""+W,B);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case $E:return F=F.get(W.key===null?V:W.key)||null,b(U,F,W,B);case Tm:return F=F.get(W.key===null?V:W.key)||null,E(U,F,W,B);case Sd:var z=W._init;return P(F,U,V,z(W._payload),B)}if(Zv(W)||Ov(W))return F=F.get(V)||null,T(U,F,W,B,null);tx(U,W)}return null}function A(F,U,V,W){for(var B=null,z=null,Y=U,re=U=0,Z=null;Y!==null&&re<V.length;re++){Y.index>re?(Z=Y,Y=null):Z=Y.sibling;var ie=N(F,Y,V[re],W);if(ie===null){Y===null&&(Y=Z);break}e&&Y&&ie.alternate===null&&n(F,Y),U=p(ie,U,re),z===null?B=ie:z.sibling=ie,z=ie,Y=Z}if(re===V.length)return a(F,Y),kr&&oh(F,re),B;if(Y===null){for(;re<V.length;re++)Y=w(F,V[re],W),Y!==null&&(U=p(Y,U,re),z===null?B=Y:z.sibling=Y,z=Y);return kr&&oh(F,re),B}for(Y=o(F,Y);re<V.length;re++)Z=P(Y,F,re,V[re],W),Z!==null&&(e&&Z.alternate!==null&&Y.delete(Z.key===null?re:Z.key),U=p(Z,U,re),z===null?B=Z:z.sibling=Z,z=Z);return e&&Y.forEach(function(te){return n(F,te)}),kr&&oh(F,re),B}function k(F,U,V,W){var B=Ov(V);if(typeof B!="function")throw Error(rt(150));if(V=B.call(V),V==null)throw Error(rt(151));for(var z=B=null,Y=U,re=U=0,Z=null,ie=V.next();Y!==null&&!ie.done;re++,ie=V.next()){Y.index>re?(Z=Y,Y=null):Z=Y.sibling;var te=N(F,Y,ie.value,W);if(te===null){Y===null&&(Y=Z);break}e&&Y&&te.alternate===null&&n(F,Y),U=p(te,U,re),z===null?B=te:z.sibling=te,z=te,Y=Z}if(ie.done)return a(F,Y),kr&&oh(F,re),B;if(Y===null){for(;!ie.done;re++,ie=V.next())ie=w(F,ie.value,W),ie!==null&&(U=p(ie,U,re),z===null?B=ie:z.sibling=ie,z=ie);return kr&&oh(F,re),B}for(Y=o(F,Y);!ie.done;re++,ie=V.next())ie=P(Y,F,re,ie.value,W),ie!==null&&(e&&ie.alternate!==null&&Y.delete(ie.key===null?re:ie.key),U=p(ie,U,re),z===null?B=ie:z.sibling=ie,z=ie);return e&&Y.forEach(function(de){return n(F,de)}),kr&&oh(F,re),B}function I(F,U,V,W){if(typeof V=="object"&&V!==null&&V.type===Cm&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case $E:e:{for(var B=V.key,z=U;z!==null;){if(z.key===B){if(B=V.type,B===Cm){if(z.tag===7){a(F,z.sibling),U=d(z,V.props.children),U.return=F,F=U;break e}}else if(z.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===Sd&&xH(B)===z.type){a(F,z.sibling),U=d(z,V.props),U.ref=Lv(F,z,V),U.return=F,F=U;break e}a(F,z);break}else n(F,z);z=z.sibling}V.type===Cm?(U=Th(V.props.children,F.mode,W,V.key),U.return=F,F=U):(W=jx(V.type,V.key,V.props,null,F.mode,W),W.ref=Lv(F,U,V),W.return=F,F=W)}return f(F);case Tm:e:{for(z=V.key;U!==null;){if(U.key===z)if(U.tag===4&&U.stateNode.containerInfo===V.containerInfo&&U.stateNode.implementation===V.implementation){a(F,U.sibling),U=d(U,V.children||[]),U.return=F,F=U;break e}else{a(F,U);break}else n(F,U);U=U.sibling}U=OO(V,F.mode,W),U.return=F,F=U}return f(F);case Sd:return z=V._init,I(F,U,z(V._payload),W)}if(Zv(V))return A(F,U,V,W);if(Ov(V))return k(F,U,V,W);tx(F,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,U!==null&&U.tag===6?(a(F,U.sibling),U=d(U,V),U.return=F,F=U):(a(F,U),U=IO(V,F.mode,W),U.return=F,F=U),f(F)):a(F,U)}return I}var tf=Gq(!0),Wq=Gq(!1),nS=eu(null),rS=null,km=null,Tk=null;function Ck(){Tk=km=rS=null}function Nk(e){var n=nS.current;Cr(nS),e._currentValue=n}function z1(e,n,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===a)break;e=e.return}}function $m(e,n){rS=e,Tk=km=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Xa=!0),e.firstContext=null)}function fo(e){var n=e._currentValue;if(Tk!==e)if(e={context:e,memoizedValue:n,next:null},km===null){if(rS===null)throw Error(rt(308));km=e,rS.dependencies={lanes:0,firstContext:e}}else km=km.next=e;return n}var fh=null;function Rk(e){fh===null?fh=[e]:fh.push(e)}function $q(e,n,a,o){var d=n.interleaved;return d===null?(a.next=a,Rk(n)):(a.next=d.next,d.next=a),n.interleaved=a,Il(e,o)}function Il(e,n){e.lanes|=n;var a=e.alternate;for(a!==null&&(a.lanes|=n),a=e,e=e.return;e!==null;)e.childLanes|=n,a=e.alternate,a!==null&&(a.childLanes|=n),a=e,e=e.return;return a.tag===3?a.stateNode:null}var wd=!1;function Ak(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Hq(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Sl(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Vd(e,n,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,Un&2){var d=o.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),o.pending=n,Il(e,a)}return d=o.interleaved,d===null?(n.next=n,Rk(o)):(n.next=d.next,d.next=n),o.interleaved=n,Il(e,a)}function Ax(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,mk(e,a)}}function SH(e,n){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var d=null,p=null;if(a=a.firstBaseUpdate,a!==null){do{var f={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};p===null?d=p=f:p=p.next=f,a=a.next}while(a!==null);p===null?d=p=n:p=p.next=n}else d=p=n;a={baseState:o.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:o.shared,effects:o.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}function iS(e,n,a,o){var d=e.updateQueue;wd=!1;var p=d.firstBaseUpdate,f=d.lastBaseUpdate,v=d.shared.pending;if(v!==null){d.shared.pending=null;var b=v,E=b.next;b.next=null,f===null?p=E:f.next=E,f=b;var T=e.alternate;T!==null&&(T=T.updateQueue,v=T.lastBaseUpdate,v!==f&&(v===null?T.firstBaseUpdate=E:v.next=E,T.lastBaseUpdate=b))}if(p!==null){var w=d.baseState;f=0,T=E=b=null,v=p;do{var N=v.lane,P=v.eventTime;if((o&N)===N){T!==null&&(T=T.next={eventTime:P,lane:0,tag:v.tag,payload:v.payload,callback:v.callback,next:null});e:{var A=e,k=v;switch(N=n,P=a,k.tag){case 1:if(A=k.payload,typeof A=="function"){w=A.call(P,w,N);break e}w=A;break e;case 3:A.flags=A.flags&-65537|128;case 0:if(A=k.payload,N=typeof A=="function"?A.call(P,w,N):A,N==null)break e;w=Wr({},w,N);break e;case 2:wd=!0}}v.callback!==null&&v.lane!==0&&(e.flags|=64,N=d.effects,N===null?d.effects=[v]:N.push(v))}else P={eventTime:P,lane:N,tag:v.tag,payload:v.payload,callback:v.callback,next:null},T===null?(E=T=P,b=w):T=T.next=P,f|=N;if(v=v.next,v===null){if(v=d.shared.pending,v===null)break;N=v,v=N.next,N.next=null,d.lastBaseUpdate=N,d.shared.pending=null}}while(!0);if(T===null&&(b=w),d.baseState=b,d.firstBaseUpdate=E,d.lastBaseUpdate=T,n=d.shared.interleaved,n!==null){d=n;do f|=d.lane,d=d.next;while(d!==n)}else p===null&&(d.shared.lanes=0);Dh|=f,e.lanes=f,e.memoizedState=w}}function wH(e,n,a){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var o=e[n],d=o.callback;if(d!==null){if(o.callback=null,o=a,typeof d!="function")throw Error(rt(191,d));d.call(o)}}}var N0={},Gc=eu(N0),Oy=eu(N0),Py=eu(N0);function gh(e){if(e===N0)throw Error(rt(174));return e}function Ik(e,n){switch(pr(Py,n),pr(Oy,e),pr(Gc,N0),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:C1(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=C1(n,e)}Cr(Gc),pr(Gc,n)}function nf(){Cr(Gc),Cr(Oy),Cr(Py)}function zq(e){gh(Py.current);var n=gh(Gc.current),a=C1(n,e.type);n!==a&&(pr(Oy,e),pr(Gc,a))}function Ok(e){Oy.current===e&&(Cr(Gc),Cr(Oy))}var Br=eu(0);function aS(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var wO=[];function Pk(){for(var e=0;e<wO.length;e++)wO[e]._workInProgressVersionPrimary=null;wO.length=0}var Ix=Ll.ReactCurrentDispatcher,TO=Ll.ReactCurrentBatchConfig,Ph=0,Gr=null,vi=null,Pi=null,sS=!1,ly=!1,Dy=0,Xbe=0;function sa(){throw Error(rt(321))}function Dk(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!rc(e[a],n[a]))return!1;return!0}function kk(e,n,a,o,d,p){if(Ph=p,Gr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Ix.current=e===null||e.memoizedState===null?eEe:tEe,e=a(o,d),ly){p=0;do{if(ly=!1,Dy=0,25<=p)throw Error(rt(301));p+=1,Pi=vi=null,n.updateQueue=null,Ix.current=nEe,e=a(o,d)}while(ly)}if(Ix.current=oS,n=vi!==null&&vi.next!==null,Ph=0,Pi=vi=Gr=null,sS=!1,n)throw Error(rt(300));return e}function jk(){var e=Dy!==0;return Dy=0,e}function jc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Gr.memoizedState=Pi=e:Pi=Pi.next=e,Pi}function go(){if(vi===null){var e=Gr.alternate;e=e!==null?e.memoizedState:null}else e=vi.next;var n=Pi===null?Gr.memoizedState:Pi.next;if(n!==null)Pi=n,vi=e;else{if(e===null)throw Error(rt(310));vi=e,e={memoizedState:vi.memoizedState,baseState:vi.baseState,baseQueue:vi.baseQueue,queue:vi.queue,next:null},Pi===null?Gr.memoizedState=Pi=e:Pi=Pi.next=e}return Pi}function ky(e,n){return typeof n=="function"?n(e):n}function CO(e){var n=go(),a=n.queue;if(a===null)throw Error(rt(311));a.lastRenderedReducer=e;var o=vi,d=o.baseQueue,p=a.pending;if(p!==null){if(d!==null){var f=d.next;d.next=p.next,p.next=f}o.baseQueue=d=p,a.pending=null}if(d!==null){p=d.next,o=o.baseState;var v=f=null,b=null,E=p;do{var T=E.lane;if((Ph&T)===T)b!==null&&(b=b.next={lane:0,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null}),o=E.hasEagerState?E.eagerState:e(o,E.action);else{var w={lane:T,action:E.action,hasEagerState:E.hasEagerState,eagerState:E.eagerState,next:null};b===null?(v=b=w,f=o):b=b.next=w,Gr.lanes|=T,Dh|=T}E=E.next}while(E!==null&&E!==p);b===null?f=o:b.next=v,rc(o,n.memoizedState)||(Xa=!0),n.memoizedState=o,n.baseState=f,n.baseQueue=b,a.lastRenderedState=o}if(e=a.interleaved,e!==null){d=e;do p=d.lane,Gr.lanes|=p,Dh|=p,d=d.next;while(d!==e)}else d===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function NO(e){var n=go(),a=n.queue;if(a===null)throw Error(rt(311));a.lastRenderedReducer=e;var o=a.dispatch,d=a.pending,p=n.memoizedState;if(d!==null){a.pending=null;var f=d=d.next;do p=e(p,f.action),f=f.next;while(f!==d);rc(p,n.memoizedState)||(Xa=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),a.lastRenderedState=p}return[p,o]}function Kq(){}function Yq(e,n){var a=Gr,o=go(),d=n(),p=!rc(o.memoizedState,d);if(p&&(o.memoizedState=d,Xa=!0),o=o.queue,Lk(Jq.bind(null,a,o,e),[e]),o.getSnapshot!==n||p||Pi!==null&&Pi.memoizedState.tag&1){if(a.flags|=2048,jy(9,Xq.bind(null,a,o,d,n),void 0,null),ki===null)throw Error(rt(349));Ph&30||qq(a,n,d)}return d}function qq(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=Gr.updateQueue,n===null?(n={lastEffect:null,stores:null},Gr.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function Xq(e,n,a,o){n.value=a,n.getSnapshot=o,Qq(n)&&Zq(e)}function Jq(e,n,a){return a(function(){Qq(n)&&Zq(e)})}function Qq(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!rc(e,a)}catch{return!0}}function Zq(e){var n=Il(e,1);n!==null&&tc(n,e,1,-1)}function TH(e){var n=jc();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ky,lastRenderedState:e},n.queue=e,e=e.dispatch=Zbe.bind(null,Gr,e),[n.memoizedState,e]}function jy(e,n,a,o){return e={tag:e,create:n,destroy:a,deps:o,next:null},n=Gr.updateQueue,n===null?(n={lastEffect:null,stores:null},Gr.updateQueue=n,n.lastEffect=e.next=e):(a=n.lastEffect,a===null?n.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,n.lastEffect=e)),e}function eX(){return go().memoizedState}function Ox(e,n,a,o){var d=jc();Gr.flags|=e,d.memoizedState=jy(1|n,a,void 0,o===void 0?null:o)}function Iw(e,n,a,o){var d=go();o=o===void 0?null:o;var p=void 0;if(vi!==null){var f=vi.memoizedState;if(p=f.destroy,o!==null&&Dk(o,f.deps)){d.memoizedState=jy(n,a,p,o);return}}Gr.flags|=e,d.memoizedState=jy(1|n,a,p,o)}function CH(e,n){return Ox(8390656,8,e,n)}function Lk(e,n){return Iw(2048,8,e,n)}function tX(e,n){return Iw(4,2,e,n)}function nX(e,n){return Iw(4,4,e,n)}function rX(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function iX(e,n,a){return a=a!=null?a.concat([e]):null,Iw(4,4,rX.bind(null,n,e),a)}function Mk(){}function aX(e,n){var a=go();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&Dk(n,o[1])?o[0]:(a.memoizedState=[e,n],e)}function sX(e,n){var a=go();n=n===void 0?null:n;var o=a.memoizedState;return o!==null&&n!==null&&Dk(n,o[1])?o[0]:(e=e(),a.memoizedState=[e,n],e)}function oX(e,n,a){return Ph&21?(rc(a,n)||(a=hq(),Gr.lanes|=a,Dh|=a,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Xa=!0),e.memoizedState=a)}function Jbe(e,n){var a=Jn;Jn=a!==0&&4>a?a:4,e(!0);var o=TO.transition;TO.transition={};try{e(!1),n()}finally{Jn=a,TO.transition=o}}function cX(){return go().memoizedState}function Qbe(e,n,a){var o=Gd(e);if(a={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null},lX(e))dX(n,a);else if(a=$q(e,n,a,o),a!==null){var d=Ra();tc(a,e,o,d),uX(a,n,o)}}function Zbe(e,n,a){var o=Gd(e),d={lane:o,action:a,hasEagerState:!1,eagerState:null,next:null};if(lX(e))dX(n,d);else{var p=e.alternate;if(e.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var f=n.lastRenderedState,v=p(f,a);if(d.hasEagerState=!0,d.eagerState=v,rc(v,f)){var b=n.interleaved;b===null?(d.next=d,Rk(n)):(d.next=b.next,b.next=d),n.interleaved=d;return}}catch{}finally{}a=$q(e,n,d,o),a!==null&&(d=Ra(),tc(a,e,o,d),uX(a,n,o))}}function lX(e){var n=e.alternate;return e===Gr||n!==null&&n===Gr}function dX(e,n){ly=sS=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function uX(e,n,a){if(a&4194240){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,mk(e,a)}}var oS={readContext:fo,useCallback:sa,useContext:sa,useEffect:sa,useImperativeHandle:sa,useInsertionEffect:sa,useLayoutEffect:sa,useMemo:sa,useReducer:sa,useRef:sa,useState:sa,useDebugValue:sa,useDeferredValue:sa,useTransition:sa,useMutableSource:sa,useSyncExternalStore:sa,useId:sa,unstable_isNewReconciler:!1},eEe={readContext:fo,useCallback:function(e,n){return jc().memoizedState=[e,n===void 0?null:n],e},useContext:fo,useEffect:CH,useImperativeHandle:function(e,n,a){return a=a!=null?a.concat([e]):null,Ox(4194308,4,rX.bind(null,n,e),a)},useLayoutEffect:function(e,n){return Ox(4194308,4,e,n)},useInsertionEffect:function(e,n){return Ox(4,2,e,n)},useMemo:function(e,n){var a=jc();return n=n===void 0?null:n,e=e(),a.memoizedState=[e,n],e},useReducer:function(e,n,a){var o=jc();return n=a!==void 0?a(n):n,o.memoizedState=o.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},o.queue=e,e=e.dispatch=Qbe.bind(null,Gr,e),[o.memoizedState,e]},useRef:function(e){var n=jc();return e={current:e},n.memoizedState=e},useState:TH,useDebugValue:Mk,useDeferredValue:function(e){return jc().memoizedState=e},useTransition:function(){var e=TH(!1),n=e[0];return e=Jbe.bind(null,e[1]),jc().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,a){var o=Gr,d=jc();if(kr){if(a===void 0)throw Error(rt(407));a=a()}else{if(a=n(),ki===null)throw Error(rt(349));Ph&30||qq(o,n,a)}d.memoizedState=a;var p={value:a,getSnapshot:n};return d.queue=p,CH(Jq.bind(null,o,p,e),[e]),o.flags|=2048,jy(9,Xq.bind(null,o,p,a,n),void 0,null),a},useId:function(){var e=jc(),n=ki.identifierPrefix;if(kr){var a=yl,o=vl;a=(o&~(1<<32-ec(o)-1)).toString(32)+a,n=":"+n+"R"+a,a=Dy++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=Xbe++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},tEe={readContext:fo,useCallback:aX,useContext:fo,useEffect:Lk,useImperativeHandle:iX,useInsertionEffect:tX,useLayoutEffect:nX,useMemo:sX,useReducer:CO,useRef:eX,useState:function(){return CO(ky)},useDebugValue:Mk,useDeferredValue:function(e){var n=go();return oX(n,vi.memoizedState,e)},useTransition:function(){var e=CO(ky)[0],n=go().memoizedState;return[e,n]},useMutableSource:Kq,useSyncExternalStore:Yq,useId:cX,unstable_isNewReconciler:!1},nEe={readContext:fo,useCallback:aX,useContext:fo,useEffect:Lk,useImperativeHandle:iX,useInsertionEffect:tX,useLayoutEffect:nX,useMemo:sX,useReducer:NO,useRef:eX,useState:function(){return NO(ky)},useDebugValue:Mk,useDeferredValue:function(e){var n=go();return vi===null?n.memoizedState=e:oX(n,vi.memoizedState,e)},useTransition:function(){var e=NO(ky)[0],n=go().memoizedState;return[e,n]},useMutableSource:Kq,useSyncExternalStore:Yq,useId:cX,unstable_isNewReconciler:!1};function Ko(e,n){if(e&&e.defaultProps){n=Wr({},n),e=e.defaultProps;for(var a in e)n[a]===void 0&&(n[a]=e[a]);return n}return n}function K1(e,n,a,o){n=e.memoizedState,a=a(o,n),a=a==null?n:Wr({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Ow={isMounted:function(e){return(e=e._reactInternals)?Wh(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var o=Ra(),d=Gd(e),p=Sl(o,d);p.payload=n,a!=null&&(p.callback=a),n=Vd(e,p,d),n!==null&&(tc(n,e,d,o),Ax(n,e,d))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var o=Ra(),d=Gd(e),p=Sl(o,d);p.tag=1,p.payload=n,a!=null&&(p.callback=a),n=Vd(e,p,d),n!==null&&(tc(n,e,d,o),Ax(n,e,d))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=Ra(),o=Gd(e),d=Sl(a,o);d.tag=2,n!=null&&(d.callback=n),n=Vd(e,d,o),n!==null&&(tc(n,e,o,a),Ax(n,e,o))}};function NH(e,n,a,o,d,p,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,p,f):n.prototype&&n.prototype.isPureReactComponent?!Ny(a,o)||!Ny(d,p):!0}function hX(e,n,a){var o=!1,d=Xd,p=n.contextType;return typeof p=="object"&&p!==null?p=fo(p):(d=es(n)?Ih:pa.current,o=n.contextTypes,p=(o=o!=null)?Zm(e,d):Xd),n=new n(a,p),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Ow,e.stateNode=n,n._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=p),n}function RH(e,n,a,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==e&&Ow.enqueueReplaceState(n,n.state,null)}function Y1(e,n,a,o){var d=e.stateNode;d.props=a,d.state=e.memoizedState,d.refs={},Ak(e);var p=n.contextType;typeof p=="object"&&p!==null?d.context=fo(p):(p=es(n)?Ih:pa.current,d.context=Zm(e,p)),d.state=e.memoizedState,p=n.getDerivedStateFromProps,typeof p=="function"&&(K1(e,n,p,a),d.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(n=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),n!==d.state&&Ow.enqueueReplaceState(d,d.state,null),iS(e,a,d,o),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function rf(e,n){try{var a="",o=n;do a+=I_e(o),o=o.return;while(o);var d=a}catch(p){d=`
Error generating stack: `+p.message+`
`+p.stack}return{value:e,source:n,stack:d,digest:null}}function RO(e,n,a){return{value:e,source:null,stack:a??null,digest:n??null}}function q1(e,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var rEe=typeof WeakMap=="function"?WeakMap:Map;function pX(e,n,a){a=Sl(-1,a),a.tag=3,a.payload={element:null};var o=n.value;return a.callback=function(){lS||(lS=!0,aP=o),q1(e,n)},a}function mX(e,n,a){a=Sl(-1,a),a.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var d=n.value;a.payload=function(){return o(d)},a.callback=function(){q1(e,n)}}var p=e.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(a.callback=function(){q1(e,n),typeof o!="function"&&(Bd===null?Bd=new Set([this]):Bd.add(this));var f=n.stack;this.componentDidCatch(n.value,{componentStack:f!==null?f:""})}),a}function AH(e,n,a){var o=e.pingCache;if(o===null){o=e.pingCache=new rEe;var d=new Set;o.set(n,d)}else d=o.get(n),d===void 0&&(d=new Set,o.set(n,d));d.has(a)||(d.add(a),e=vEe.bind(null,e,n,a),n.then(e,e))}function IH(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function OH(e,n,a,o,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===n?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=Sl(-1,1),n.tag=2,Vd(a,n,1))),a.lanes|=1),e)}var iEe=Ll.ReactCurrentOwner,Xa=!1;function Ta(e,n,a,o){n.child=e===null?Wq(n,null,a,o):tf(n,e.child,a,o)}function PH(e,n,a,o,d){a=a.render;var p=n.ref;return $m(n,d),o=kk(e,n,a,o,p,d),a=jk(),e!==null&&!Xa?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Ol(e,n,d)):(kr&&a&&xk(n),n.flags|=1,Ta(e,n,o,d),n.child)}function DH(e,n,a,o,d){if(e===null){var p=a.type;return typeof p=="function"&&!Hk(p)&&p.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=p,fX(e,n,p,o,d)):(e=jx(a.type,null,o,n,n.mode,d),e.ref=n.ref,e.return=n,n.child=e)}if(p=e.child,!(e.lanes&d)){var f=p.memoizedProps;if(a=a.compare,a=a!==null?a:Ny,a(f,o)&&e.ref===n.ref)return Ol(e,n,d)}return n.flags|=1,e=Wd(p,o),e.ref=n.ref,e.return=n,n.child=e}function fX(e,n,a,o,d){if(e!==null){var p=e.memoizedProps;if(Ny(p,o)&&e.ref===n.ref)if(Xa=!1,n.pendingProps=o=p,(e.lanes&d)!==0)e.flags&131072&&(Xa=!0);else return n.lanes=e.lanes,Ol(e,n,d)}return X1(e,n,a,o,d)}function gX(e,n,a){var o=n.pendingProps,d=o.children,p=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},pr(Lm,bs),bs|=a;else{if(!(a&1073741824))return e=p!==null?p.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,pr(Lm,bs),bs|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=p!==null?p.baseLanes:a,pr(Lm,bs),bs|=o}else p!==null?(o=p.baseLanes|a,n.memoizedState=null):o=a,pr(Lm,bs),bs|=o;return Ta(e,n,d,a),n.child}function vX(e,n){var a=n.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function X1(e,n,a,o,d){var p=es(a)?Ih:pa.current;return p=Zm(n,p),$m(n,d),a=kk(e,n,a,o,p,d),o=jk(),e!==null&&!Xa?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~d,Ol(e,n,d)):(kr&&o&&xk(n),n.flags|=1,Ta(e,n,a,d),n.child)}function kH(e,n,a,o,d){if(es(a)){var p=!0;Zx(n)}else p=!1;if($m(n,d),n.stateNode===null)Px(e,n),hX(n,a,o),Y1(n,a,o,d),o=!0;else if(e===null){var f=n.stateNode,v=n.memoizedProps;f.props=v;var b=f.context,E=a.contextType;typeof E=="object"&&E!==null?E=fo(E):(E=es(a)?Ih:pa.current,E=Zm(n,E));var T=a.getDerivedStateFromProps,w=typeof T=="function"||typeof f.getSnapshotBeforeUpdate=="function";w||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(v!==o||b!==E)&&RH(n,f,o,E),wd=!1;var N=n.memoizedState;f.state=N,iS(n,o,f,d),b=n.memoizedState,v!==o||N!==b||Za.current||wd?(typeof T=="function"&&(K1(n,a,T,o),b=n.memoizedState),(v=wd||NH(n,a,v,o,N,b,E))?(w||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(n.flags|=4194308)):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=b),f.props=o,f.state=b,f.context=E,o=v):(typeof f.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{f=n.stateNode,Hq(e,n),v=n.memoizedProps,E=n.type===n.elementType?v:Ko(n.type,v),f.props=E,w=n.pendingProps,N=f.context,b=a.contextType,typeof b=="object"&&b!==null?b=fo(b):(b=es(a)?Ih:pa.current,b=Zm(n,b));var P=a.getDerivedStateFromProps;(T=typeof P=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(v!==w||N!==b)&&RH(n,f,o,b),wd=!1,N=n.memoizedState,f.state=N,iS(n,o,f,d);var A=n.memoizedState;v!==w||N!==A||Za.current||wd?(typeof P=="function"&&(K1(n,a,P,o),A=n.memoizedState),(E=wd||NH(n,a,E,o,N,A,b)||!1)?(T||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(o,A,b),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(o,A,b)),typeof f.componentDidUpdate=="function"&&(n.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof f.componentDidUpdate!="function"||v===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=A),f.props=o,f.state=A,f.context=b,o=E):(typeof f.componentDidUpdate!="function"||v===e.memoizedProps&&N===e.memoizedState||(n.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&N===e.memoizedState||(n.flags|=1024),o=!1)}return J1(e,n,a,o,p,d)}function J1(e,n,a,o,d,p){vX(e,n);var f=(n.flags&128)!==0;if(!o&&!f)return d&&_H(n,a,!1),Ol(e,n,p);o=n.stateNode,iEe.current=n;var v=f&&typeof a.getDerivedStateFromError!="function"?null:o.render();return n.flags|=1,e!==null&&f?(n.child=tf(n,e.child,null,p),n.child=tf(n,null,v,p)):Ta(e,n,v,p),n.memoizedState=o.state,d&&_H(n,a,!0),n.child}function yX(e){var n=e.stateNode;n.pendingContext?yH(e,n.pendingContext,n.pendingContext!==n.context):n.context&&yH(e,n.context,!1),Ik(e,n.containerInfo)}function jH(e,n,a,o,d){return ef(),wk(d),n.flags|=256,Ta(e,n,a,o),n.child}var Q1={dehydrated:null,treeContext:null,retryLane:0};function Z1(e){return{baseLanes:e,cachePool:null,transitions:null}}function _X(e,n,a){var o=n.pendingProps,d=Br.current,p=!1,f=(n.flags&128)!==0,v;if((v=f)||(v=e!==null&&e.memoizedState===null?!1:(d&2)!==0),v?(p=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),pr(Br,d&1),e===null)return H1(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(f=o.children,e=o.fallback,p?(o=n.mode,p=n.child,f={mode:"hidden",children:f},!(o&1)&&p!==null?(p.childLanes=0,p.pendingProps=f):p=kw(f,o,0,null),e=Th(e,o,a,null),p.return=n,e.return=n,p.sibling=e,n.child=p,n.child.memoizedState=Z1(a),n.memoizedState=Q1,e):Uk(n,f));if(d=e.memoizedState,d!==null&&(v=d.dehydrated,v!==null))return aEe(e,n,f,o,v,d,a);if(p){p=o.fallback,f=n.mode,d=e.child,v=d.sibling;var b={mode:"hidden",children:o.children};return!(f&1)&&n.child!==d?(o=n.child,o.childLanes=0,o.pendingProps=b,n.deletions=null):(o=Wd(d,b),o.subtreeFlags=d.subtreeFlags&14680064),v!==null?p=Wd(v,p):(p=Th(p,f,a,null),p.flags|=2),p.return=n,o.return=n,o.sibling=p,n.child=o,o=p,p=n.child,f=e.child.memoizedState,f=f===null?Z1(a):{baseLanes:f.baseLanes|a,cachePool:null,transitions:f.transitions},p.memoizedState=f,p.childLanes=e.childLanes&~a,n.memoizedState=Q1,o}return p=e.child,e=p.sibling,o=Wd(p,{mode:"visible",children:o.children}),!(n.mode&1)&&(o.lanes=a),o.return=n,o.sibling=null,e!==null&&(a=n.deletions,a===null?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=o,n.memoizedState=null,o}function Uk(e,n){return n=kw({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function nx(e,n,a,o){return o!==null&&wk(o),tf(n,e.child,null,a),e=Uk(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function aEe(e,n,a,o,d,p,f){if(a)return n.flags&256?(n.flags&=-257,o=RO(Error(rt(422))),nx(e,n,f,o)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(p=o.fallback,d=n.mode,o=kw({mode:"visible",children:o.children},d,0,null),p=Th(p,d,f,null),p.flags|=2,o.return=n,p.return=n,o.sibling=p,n.child=o,n.mode&1&&tf(n,e.child,null,f),n.child.memoizedState=Z1(f),n.memoizedState=Q1,p);if(!(n.mode&1))return nx(e,n,f,null);if(d.data==="$!"){if(o=d.nextSibling&&d.nextSibling.dataset,o)var v=o.dgst;return o=v,p=Error(rt(419)),o=RO(p,o,void 0),nx(e,n,f,o)}if(v=(f&e.childLanes)!==0,Xa||v){if(o=ki,o!==null){switch(f&-f){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(o.suspendedLanes|f)?0:d,d!==0&&d!==p.retryLane&&(p.retryLane=d,Il(e,d),tc(o,e,d,-1))}return $k(),o=RO(Error(rt(421))),nx(e,n,f,o)}return d.data==="$?"?(n.flags|=128,n.child=e.child,n=yEe.bind(null,e),d._reactRetry=n,null):(e=p.treeContext,Ts=Fd(d.nextSibling),Cs=n,kr=!0,Jo=null,e!==null&&(io[ao++]=vl,io[ao++]=yl,io[ao++]=Oh,vl=e.id,yl=e.overflow,Oh=n),n=Uk(n,o.children),n.flags|=4096,n)}function LH(e,n,a){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),z1(e.return,n,a)}function AO(e,n,a,o,d){var p=e.memoizedState;p===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:d}:(p.isBackwards=n,p.rendering=null,p.renderingStartTime=0,p.last=o,p.tail=a,p.tailMode=d)}function bX(e,n,a){var o=n.pendingProps,d=o.revealOrder,p=o.tail;if(Ta(e,n,o.children,a),o=Br.current,o&2)o=o&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&LH(e,a,n);else if(e.tag===19)LH(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(pr(Br,o),!(n.mode&1))n.memoizedState=null;else switch(d){case"forwards":for(a=n.child,d=null;a!==null;)e=a.alternate,e!==null&&aS(e)===null&&(d=a),a=a.sibling;a=d,a===null?(d=n.child,n.child=null):(d=a.sibling,a.sibling=null),AO(n,!1,d,a,p);break;case"backwards":for(a=null,d=n.child,n.child=null;d!==null;){if(e=d.alternate,e!==null&&aS(e)===null){n.child=d;break}e=d.sibling,d.sibling=a,a=d,d=e}AO(n,!0,a,null,p);break;case"together":AO(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function Px(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function Ol(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),Dh|=n.lanes,!(a&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(rt(153));if(n.child!==null){for(e=n.child,a=Wd(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=Wd(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function sEe(e,n,a){switch(n.tag){case 3:yX(n),ef();break;case 5:zq(n);break;case 1:es(n.type)&&Zx(n);break;case 4:Ik(n,n.stateNode.containerInfo);break;case 10:var o=n.type._context,d=n.memoizedProps.value;pr(nS,o._currentValue),o._currentValue=d;break;case 13:if(o=n.memoizedState,o!==null)return o.dehydrated!==null?(pr(Br,Br.current&1),n.flags|=128,null):a&n.child.childLanes?_X(e,n,a):(pr(Br,Br.current&1),e=Ol(e,n,a),e!==null?e.sibling:null);pr(Br,Br.current&1);break;case 19:if(o=(a&n.childLanes)!==0,e.flags&128){if(o)return bX(e,n,a);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),pr(Br,Br.current),o)break;return null;case 22:case 23:return n.lanes=0,gX(e,n,a)}return Ol(e,n,a)}var EX,eP,xX,SX;EX=function(e,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};eP=function(){};xX=function(e,n,a,o){var d=e.memoizedProps;if(d!==o){e=n.stateNode,gh(Gc.current);var p=null;switch(a){case"input":d=x1(e,d),o=x1(e,o),p=[];break;case"select":d=Wr({},d,{value:void 0}),o=Wr({},o,{value:void 0}),p=[];break;case"textarea":d=T1(e,d),o=T1(e,o),p=[];break;default:typeof d.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=Jx)}N1(a,o);var f;a=null;for(E in d)if(!o.hasOwnProperty(E)&&d.hasOwnProperty(E)&&d[E]!=null)if(E==="style"){var v=d[E];for(f in v)v.hasOwnProperty(f)&&(a||(a={}),a[f]="")}else E!=="dangerouslySetInnerHTML"&&E!=="children"&&E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(by.hasOwnProperty(E)?p||(p=[]):(p=p||[]).push(E,null));for(E in o){var b=o[E];if(v=d!=null?d[E]:void 0,o.hasOwnProperty(E)&&b!==v&&(b!=null||v!=null))if(E==="style")if(v){for(f in v)!v.hasOwnProperty(f)||b&&b.hasOwnProperty(f)||(a||(a={}),a[f]="");for(f in b)b.hasOwnProperty(f)&&v[f]!==b[f]&&(a||(a={}),a[f]=b[f])}else a||(p||(p=[]),p.push(E,a)),a=b;else E==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,v=v?v.__html:void 0,b!=null&&v!==b&&(p=p||[]).push(E,b)):E==="children"?typeof b!="string"&&typeof b!="number"||(p=p||[]).push(E,""+b):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&(by.hasOwnProperty(E)?(b!=null&&E==="onScroll"&&Sr("scroll",e),p||v===b||(p=[])):(p=p||[]).push(E,b))}a&&(p=p||[]).push("style",a);var E=p;(n.updateQueue=E)&&(n.flags|=4)}};SX=function(e,n,a,o){a!==o&&(n.flags|=4)};function Mv(e,n){if(!kr)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function oa(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(n)for(var d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags&14680064,o|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)a|=d.lanes|d.childLanes,o|=d.subtreeFlags,o|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=o,e.childLanes=a,n}function oEe(e,n,a){var o=n.pendingProps;switch(Sk(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return oa(n),null;case 1:return es(n.type)&&Qx(),oa(n),null;case 3:return o=n.stateNode,nf(),Cr(Za),Cr(pa),Pk(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(ex(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Jo!==null&&(cP(Jo),Jo=null))),eP(e,n),oa(n),null;case 5:Ok(n);var d=gh(Py.current);if(a=n.type,e!==null&&n.stateNode!=null)xX(e,n,a,o,d),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!o){if(n.stateNode===null)throw Error(rt(166));return oa(n),null}if(e=gh(Gc.current),ex(n)){o=n.stateNode,a=n.type;var p=n.memoizedProps;switch(o[Mc]=n,o[Iy]=p,e=(n.mode&1)!==0,a){case"dialog":Sr("cancel",o),Sr("close",o);break;case"iframe":case"object":case"embed":Sr("load",o);break;case"video":case"audio":for(d=0;d<ty.length;d++)Sr(ty[d],o);break;case"source":Sr("error",o);break;case"img":case"image":case"link":Sr("error",o),Sr("load",o);break;case"details":Sr("toggle",o);break;case"input":H$(o,p),Sr("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!p.multiple},Sr("invalid",o);break;case"textarea":K$(o,p),Sr("invalid",o)}N1(a,p),d=null;for(var f in p)if(p.hasOwnProperty(f)){var v=p[f];f==="children"?typeof v=="string"?o.textContent!==v&&(p.suppressHydrationWarning!==!0&&ZE(o.textContent,v,e),d=["children",v]):typeof v=="number"&&o.textContent!==""+v&&(p.suppressHydrationWarning!==!0&&ZE(o.textContent,v,e),d=["children",""+v]):by.hasOwnProperty(f)&&v!=null&&f==="onScroll"&&Sr("scroll",o)}switch(a){case"input":HE(o),z$(o,p,!0);break;case"textarea":HE(o),Y$(o);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(o.onclick=Jx)}o=d,n.updateQueue=o,o!==null&&(n.flags|=4)}else{f=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=JY(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=f.createElement(a,{is:o.is}):(e=f.createElement(a),a==="select"&&(f=e,o.multiple?f.multiple=!0:o.size&&(f.size=o.size))):e=f.createElementNS(e,a),e[Mc]=n,e[Iy]=o,EX(e,n,!1,!1),n.stateNode=e;e:{switch(f=R1(a,o),a){case"dialog":Sr("cancel",e),Sr("close",e),d=o;break;case"iframe":case"object":case"embed":Sr("load",e),d=o;break;case"video":case"audio":for(d=0;d<ty.length;d++)Sr(ty[d],e);d=o;break;case"source":Sr("error",e),d=o;break;case"img":case"image":case"link":Sr("error",e),Sr("load",e),d=o;break;case"details":Sr("toggle",e),d=o;break;case"input":H$(e,o),d=x1(e,o),Sr("invalid",e);break;case"option":d=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},d=Wr({},o,{value:void 0}),Sr("invalid",e);break;case"textarea":K$(e,o),d=T1(e,o),Sr("invalid",e);break;default:d=o}N1(a,d),v=d;for(p in v)if(v.hasOwnProperty(p)){var b=v[p];p==="style"?eq(e,b):p==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&QY(e,b)):p==="children"?typeof b=="string"?(a!=="textarea"||b!=="")&&Ey(e,b):typeof b=="number"&&Ey(e,""+b):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(by.hasOwnProperty(p)?b!=null&&p==="onScroll"&&Sr("scroll",e):b!=null&&ck(e,p,b,f))}switch(a){case"input":HE(e),z$(e,o,!1);break;case"textarea":HE(e),Y$(e);break;case"option":o.value!=null&&e.setAttribute("value",""+qd(o.value));break;case"select":e.multiple=!!o.multiple,p=o.value,p!=null?Vm(e,!!o.multiple,p,!1):o.defaultValue!=null&&Vm(e,!!o.multiple,o.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=Jx)}switch(a){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return oa(n),null;case 6:if(e&&n.stateNode!=null)SX(e,n,e.memoizedProps,o);else{if(typeof o!="string"&&n.stateNode===null)throw Error(rt(166));if(a=gh(Py.current),gh(Gc.current),ex(n)){if(o=n.stateNode,a=n.memoizedProps,o[Mc]=n,(p=o.nodeValue!==a)&&(e=Cs,e!==null))switch(e.tag){case 3:ZE(o.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ZE(o.nodeValue,a,(e.mode&1)!==0)}p&&(n.flags|=4)}else o=(a.nodeType===9?a:a.ownerDocument).createTextNode(o),o[Mc]=n,n.stateNode=o}return oa(n),null;case 13:if(Cr(Br),o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(kr&&Ts!==null&&n.mode&1&&!(n.flags&128))Bq(),ef(),n.flags|=98560,p=!1;else if(p=ex(n),o!==null&&o.dehydrated!==null){if(e===null){if(!p)throw Error(rt(318));if(p=n.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(rt(317));p[Mc]=n}else ef(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;oa(n),p=!1}else Jo!==null&&(cP(Jo),Jo=null),p=!0;if(!p)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(n.child.flags|=8192,n.mode&1&&(e===null||Br.current&1?_i===0&&(_i=3):$k())),n.updateQueue!==null&&(n.flags|=4),oa(n),null);case 4:return nf(),eP(e,n),e===null&&Ry(n.stateNode.containerInfo),oa(n),null;case 10:return Nk(n.type._context),oa(n),null;case 17:return es(n.type)&&Qx(),oa(n),null;case 19:if(Cr(Br),p=n.memoizedState,p===null)return oa(n),null;if(o=(n.flags&128)!==0,f=p.rendering,f===null)if(o)Mv(p,!1);else{if(_i!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(f=aS(e),f!==null){for(n.flags|=128,Mv(p,!1),o=f.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),n.subtreeFlags=0,o=a,a=n.child;a!==null;)p=a,e=o,p.flags&=14680066,f=p.alternate,f===null?(p.childLanes=0,p.lanes=e,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=f.childLanes,p.lanes=f.lanes,p.child=f.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=f.memoizedProps,p.memoizedState=f.memoizedState,p.updateQueue=f.updateQueue,p.type=f.type,e=f.dependencies,p.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return pr(Br,Br.current&1|2),n.child}e=e.sibling}p.tail!==null&&ei()>af&&(n.flags|=128,o=!0,Mv(p,!1),n.lanes=4194304)}else{if(!o)if(e=aS(f),e!==null){if(n.flags|=128,o=!0,a=e.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),Mv(p,!0),p.tail===null&&p.tailMode==="hidden"&&!f.alternate&&!kr)return oa(n),null}else 2*ei()-p.renderingStartTime>af&&a!==1073741824&&(n.flags|=128,o=!0,Mv(p,!1),n.lanes=4194304);p.isBackwards?(f.sibling=n.child,n.child=f):(a=p.last,a!==null?a.sibling=f:n.child=f,p.last=f)}return p.tail!==null?(n=p.tail,p.rendering=n,p.tail=n.sibling,p.renderingStartTime=ei(),n.sibling=null,a=Br.current,pr(Br,o?a&1|2:a&1),n):(oa(n),null);case 22:case 23:return Wk(),o=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(n.flags|=8192),o&&n.mode&1?bs&1073741824&&(oa(n),n.subtreeFlags&6&&(n.flags|=8192)):oa(n),null;case 24:return null;case 25:return null}throw Error(rt(156,n.tag))}function cEe(e,n){switch(Sk(n),n.tag){case 1:return es(n.type)&&Qx(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return nf(),Cr(Za),Cr(pa),Pk(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return Ok(n),null;case 13:if(Cr(Br),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(rt(340));ef()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Cr(Br),null;case 4:return nf(),null;case 10:return Nk(n.type._context),null;case 22:case 23:return Wk(),null;case 24:return null;default:return null}}var rx=!1,la=!1,lEe=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function jm(e,n){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(o){Yr(e,n,o)}else a.current=null}function tP(e,n,a){try{a()}catch(o){Yr(e,n,o)}}var MH=!1;function dEe(e,n){if(U1=Yx,e=Rq(),Ek(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var d=o.anchorOffset,p=o.focusNode;o=o.focusOffset;try{a.nodeType,p.nodeType}catch{a=null;break e}var f=0,v=-1,b=-1,E=0,T=0,w=e,N=null;t:for(;;){for(var P;w!==a||d!==0&&w.nodeType!==3||(v=f+d),w!==p||o!==0&&w.nodeType!==3||(b=f+o),w.nodeType===3&&(f+=w.nodeValue.length),(P=w.firstChild)!==null;)N=w,w=P;for(;;){if(w===e)break t;if(N===a&&++E===d&&(v=f),N===p&&++T===o&&(b=f),(P=w.nextSibling)!==null)break;w=N,N=w.parentNode}w=P}a=v===-1||b===-1?null:{start:v,end:b}}else a=null}a=a||{start:0,end:0}}else a=null;for(F1={focusedElem:e,selectionRange:a},Yx=!1,Ct=n;Ct!==null;)if(n=Ct,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Ct=e;else for(;Ct!==null;){n=Ct;try{var A=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(A!==null){var k=A.memoizedProps,I=A.memoizedState,F=n.stateNode,U=F.getSnapshotBeforeUpdate(n.elementType===n.type?k:Ko(n.type,k),I);F.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var V=n.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(rt(163))}}catch(W){Yr(n,n.return,W)}if(e=n.sibling,e!==null){e.return=n.return,Ct=e;break}Ct=n.return}return A=MH,MH=!1,A}function dy(e,n,a){var o=n.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&e)===e){var p=d.destroy;d.destroy=void 0,p!==void 0&&tP(n,a,p)}d=d.next}while(d!==o)}}function Pw(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.create;a.destroy=o()}a=a.next}while(a!==n)}}function nP(e){var n=e.ref;if(n!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof n=="function"?n(e):n.current=e}}function wX(e){var n=e.alternate;n!==null&&(e.alternate=null,wX(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Mc],delete n[Iy],delete n[G1],delete n[zbe],delete n[Kbe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function TX(e){return e.tag===5||e.tag===3||e.tag===4}function UH(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||TX(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function rP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=Jx));else if(o!==4&&(e=e.child,e!==null))for(rP(e,n,a),e=e.sibling;e!==null;)rP(e,n,a),e=e.sibling}function iP(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(iP(e,n,a),e=e.sibling;e!==null;)iP(e,n,a),e=e.sibling}var Ki=null,Yo=!1;function Ed(e,n,a){for(a=a.child;a!==null;)CX(e,n,a),a=a.sibling}function CX(e,n,a){if(Bc&&typeof Bc.onCommitFiberUnmount=="function")try{Bc.onCommitFiberUnmount(ww,a)}catch{}switch(a.tag){case 5:la||jm(a,n);case 6:var o=Ki,d=Yo;Ki=null,Ed(e,n,a),Ki=o,Yo=d,Ki!==null&&(Yo?(e=Ki,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):Ki.removeChild(a.stateNode));break;case 18:Ki!==null&&(Yo?(e=Ki,a=a.stateNode,e.nodeType===8?xO(e.parentNode,a):e.nodeType===1&&xO(e,a),Ty(e)):xO(Ki,a.stateNode));break;case 4:o=Ki,d=Yo,Ki=a.stateNode.containerInfo,Yo=!0,Ed(e,n,a),Ki=o,Yo=d;break;case 0:case 11:case 14:case 15:if(!la&&(o=a.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){d=o=o.next;do{var p=d,f=p.destroy;p=p.tag,f!==void 0&&(p&2||p&4)&&tP(a,n,f),d=d.next}while(d!==o)}Ed(e,n,a);break;case 1:if(!la&&(jm(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=a.memoizedProps,o.state=a.memoizedState,o.componentWillUnmount()}catch(v){Yr(a,n,v)}Ed(e,n,a);break;case 21:Ed(e,n,a);break;case 22:a.mode&1?(la=(o=la)||a.memoizedState!==null,Ed(e,n,a),la=o):Ed(e,n,a);break;default:Ed(e,n,a)}}function FH(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new lEe),n.forEach(function(o){var d=_Ee.bind(null,e,o);a.has(o)||(a.add(o),o.then(d,d))})}}function $o(e,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];try{var p=e,f=n,v=f;e:for(;v!==null;){switch(v.tag){case 5:Ki=v.stateNode,Yo=!1;break e;case 3:Ki=v.stateNode.containerInfo,Yo=!0;break e;case 4:Ki=v.stateNode.containerInfo,Yo=!0;break e}v=v.return}if(Ki===null)throw Error(rt(160));CX(p,f,d),Ki=null,Yo=!1;var b=d.alternate;b!==null&&(b.return=null),d.return=null}catch(E){Yr(d,n,E)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)NX(n,e),n=n.sibling}function NX(e,n){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if($o(n,e),Pc(e),o&4){try{dy(3,e,e.return),Pw(3,e)}catch(k){Yr(e,e.return,k)}try{dy(5,e,e.return)}catch(k){Yr(e,e.return,k)}}break;case 1:$o(n,e),Pc(e),o&512&&a!==null&&jm(a,a.return);break;case 5:if($o(n,e),Pc(e),o&512&&a!==null&&jm(a,a.return),e.flags&32){var d=e.stateNode;try{Ey(d,"")}catch(k){Yr(e,e.return,k)}}if(o&4&&(d=e.stateNode,d!=null)){var p=e.memoizedProps,f=a!==null?a.memoizedProps:p,v=e.type,b=e.updateQueue;if(e.updateQueue=null,b!==null)try{v==="input"&&p.type==="radio"&&p.name!=null&&qY(d,p),R1(v,f);var E=R1(v,p);for(f=0;f<b.length;f+=2){var T=b[f],w=b[f+1];T==="style"?eq(d,w):T==="dangerouslySetInnerHTML"?QY(d,w):T==="children"?Ey(d,w):ck(d,T,w,E)}switch(v){case"input":S1(d,p);break;case"textarea":XY(d,p);break;case"select":var N=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!p.multiple;var P=p.value;P!=null?Vm(d,!!p.multiple,P,!1):N!==!!p.multiple&&(p.defaultValue!=null?Vm(d,!!p.multiple,p.defaultValue,!0):Vm(d,!!p.multiple,p.multiple?[]:"",!1))}d[Iy]=p}catch(k){Yr(e,e.return,k)}}break;case 6:if($o(n,e),Pc(e),o&4){if(e.stateNode===null)throw Error(rt(162));d=e.stateNode,p=e.memoizedProps;try{d.nodeValue=p}catch(k){Yr(e,e.return,k)}}break;case 3:if($o(n,e),Pc(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{Ty(n.containerInfo)}catch(k){Yr(e,e.return,k)}break;case 4:$o(n,e),Pc(e);break;case 13:$o(n,e),Pc(e),d=e.child,d.flags&8192&&(p=d.memoizedState!==null,d.stateNode.isHidden=p,!p||d.alternate!==null&&d.alternate.memoizedState!==null||(Bk=ei())),o&4&&FH(e);break;case 22:if(T=a!==null&&a.memoizedState!==null,e.mode&1?(la=(E=la)||T,$o(n,e),la=E):$o(n,e),Pc(e),o&8192){if(E=e.memoizedState!==null,(e.stateNode.isHidden=E)&&!T&&e.mode&1)for(Ct=e,T=e.child;T!==null;){for(w=Ct=T;Ct!==null;){switch(N=Ct,P=N.child,N.tag){case 0:case 11:case 14:case 15:dy(4,N,N.return);break;case 1:jm(N,N.return);var A=N.stateNode;if(typeof A.componentWillUnmount=="function"){o=N,a=N.return;try{n=o,A.props=n.memoizedProps,A.state=n.memoizedState,A.componentWillUnmount()}catch(k){Yr(o,a,k)}}break;case 5:jm(N,N.return);break;case 22:if(N.memoizedState!==null){BH(w);continue}}P!==null?(P.return=N,Ct=P):BH(w)}T=T.sibling}e:for(T=null,w=e;;){if(w.tag===5){if(T===null){T=w;try{d=w.stateNode,E?(p=d.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(v=w.stateNode,b=w.memoizedProps.style,f=b!=null&&b.hasOwnProperty("display")?b.display:null,v.style.display=ZY("display",f))}catch(k){Yr(e,e.return,k)}}}else if(w.tag===6){if(T===null)try{w.stateNode.nodeValue=E?"":w.memoizedProps}catch(k){Yr(e,e.return,k)}}else if((w.tag!==22&&w.tag!==23||w.memoizedState===null||w===e)&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===e)break e;for(;w.sibling===null;){if(w.return===null||w.return===e)break e;T===w&&(T=null),w=w.return}T===w&&(T=null),w.sibling.return=w.return,w=w.sibling}}break;case 19:$o(n,e),Pc(e),o&4&&FH(e);break;case 21:break;default:$o(n,e),Pc(e)}}function Pc(e){var n=e.flags;if(n&2){try{e:{for(var a=e.return;a!==null;){if(TX(a)){var o=a;break e}a=a.return}throw Error(rt(160))}switch(o.tag){case 5:var d=o.stateNode;o.flags&32&&(Ey(d,""),o.flags&=-33);var p=UH(e);iP(e,p,d);break;case 3:case 4:var f=o.stateNode.containerInfo,v=UH(e);rP(e,v,f);break;default:throw Error(rt(161))}}catch(b){Yr(e,e.return,b)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function uEe(e,n,a){Ct=e,RX(e)}function RX(e,n,a){for(var o=(e.mode&1)!==0;Ct!==null;){var d=Ct,p=d.child;if(d.tag===22&&o){var f=d.memoizedState!==null||rx;if(!f){var v=d.alternate,b=v!==null&&v.memoizedState!==null||la;v=rx;var E=la;if(rx=f,(la=b)&&!E)for(Ct=d;Ct!==null;)f=Ct,b=f.child,f.tag===22&&f.memoizedState!==null?GH(d):b!==null?(b.return=f,Ct=b):GH(d);for(;p!==null;)Ct=p,RX(p),p=p.sibling;Ct=d,rx=v,la=E}VH(e)}else d.subtreeFlags&8772&&p!==null?(p.return=d,Ct=p):VH(e)}}function VH(e){for(;Ct!==null;){var n=Ct;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:la||Pw(5,n);break;case 1:var o=n.stateNode;if(n.flags&4&&!la)if(a===null)o.componentDidMount();else{var d=n.elementType===n.type?a.memoizedProps:Ko(n.type,a.memoizedProps);o.componentDidUpdate(d,a.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var p=n.updateQueue;p!==null&&wH(n,p,o);break;case 3:var f=n.updateQueue;if(f!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}wH(n,f,a)}break;case 5:var v=n.stateNode;if(a===null&&n.flags&4){a=v;var b=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&a.focus();break;case"img":b.src&&(a.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var E=n.alternate;if(E!==null){var T=E.memoizedState;if(T!==null){var w=T.dehydrated;w!==null&&Ty(w)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(rt(163))}la||n.flags&512&&nP(n)}catch(N){Yr(n,n.return,N)}}if(n===e){Ct=null;break}if(a=n.sibling,a!==null){a.return=n.return,Ct=a;break}Ct=n.return}}function BH(e){for(;Ct!==null;){var n=Ct;if(n===e){Ct=null;break}var a=n.sibling;if(a!==null){a.return=n.return,Ct=a;break}Ct=n.return}}function GH(e){for(;Ct!==null;){var n=Ct;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{Pw(4,n)}catch(b){Yr(n,a,b)}break;case 1:var o=n.stateNode;if(typeof o.componentDidMount=="function"){var d=n.return;try{o.componentDidMount()}catch(b){Yr(n,d,b)}}var p=n.return;try{nP(n)}catch(b){Yr(n,p,b)}break;case 5:var f=n.return;try{nP(n)}catch(b){Yr(n,f,b)}}}catch(b){Yr(n,n.return,b)}if(n===e){Ct=null;break}var v=n.sibling;if(v!==null){v.return=n.return,Ct=v;break}Ct=n.return}}var hEe=Math.ceil,cS=Ll.ReactCurrentDispatcher,Fk=Ll.ReactCurrentOwner,ho=Ll.ReactCurrentBatchConfig,Un=0,ki=null,ci=null,Xi=0,bs=0,Lm=eu(0),_i=0,Ly=null,Dh=0,Dw=0,Vk=0,uy=null,qa=null,Bk=0,af=1/0,fl=null,lS=!1,aP=null,Bd=null,ix=!1,Pd=null,dS=0,hy=0,sP=null,Dx=-1,kx=0;function Ra(){return Un&6?ei():Dx!==-1?Dx:Dx=ei()}function Gd(e){return e.mode&1?Un&2&&Xi!==0?Xi&-Xi:qbe.transition!==null?(kx===0&&(kx=hq()),kx):(e=Jn,e!==0||(e=window.event,e=e===void 0?16:_q(e.type)),e):1}function tc(e,n,a,o){if(50<hy)throw hy=0,sP=null,Error(rt(185));w0(e,a,o),(!(Un&2)||e!==ki)&&(e===ki&&(!(Un&2)&&(Dw|=a),_i===4&&Nd(e,Xi)),ts(e,o),a===1&&Un===0&&!(n.mode&1)&&(af=ei()+500,Aw&&tu()))}function ts(e,n){var a=e.callbackNode;q_e(e,n);var o=Kx(e,e===ki?Xi:0);if(o===0)a!==null&&J$(a),e.callbackNode=null,e.callbackPriority=0;else if(n=o&-o,e.callbackPriority!==n){if(a!=null&&J$(a),n===1)e.tag===0?Ybe(WH.bind(null,e)):Uq(WH.bind(null,e)),$be(function(){!(Un&6)&&tu()}),a=null;else{switch(pq(o)){case 1:a=pk;break;case 4:a=dq;break;case 16:a=zx;break;case 536870912:a=uq;break;default:a=zx}a=LX(a,AX.bind(null,e))}e.callbackPriority=n,e.callbackNode=a}}function AX(e,n){if(Dx=-1,kx=0,Un&6)throw Error(rt(327));var a=e.callbackNode;if(Hm()&&e.callbackNode!==a)return null;var o=Kx(e,e===ki?Xi:0);if(o===0)return null;if(o&30||o&e.expiredLanes||n)n=uS(e,o);else{n=o;var d=Un;Un|=2;var p=OX();(ki!==e||Xi!==n)&&(fl=null,af=ei()+500,wh(e,n));do try{fEe();break}catch(v){IX(e,v)}while(!0);Ck(),cS.current=p,Un=d,ci!==null?n=0:(ki=null,Xi=0,n=_i)}if(n!==0){if(n===2&&(d=D1(e),d!==0&&(o=d,n=oP(e,d))),n===1)throw a=Ly,wh(e,0),Nd(e,o),ts(e,ei()),a;if(n===6)Nd(e,o);else{if(d=e.current.alternate,!(o&30)&&!pEe(d)&&(n=uS(e,o),n===2&&(p=D1(e),p!==0&&(o=p,n=oP(e,p))),n===1))throw a=Ly,wh(e,0),Nd(e,o),ts(e,ei()),a;switch(e.finishedWork=d,e.finishedLanes=o,n){case 0:case 1:throw Error(rt(345));case 2:ch(e,qa,fl);break;case 3:if(Nd(e,o),(o&130023424)===o&&(n=Bk+500-ei(),10<n)){if(Kx(e,0)!==0)break;if(d=e.suspendedLanes,(d&o)!==o){Ra(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=B1(ch.bind(null,e,qa,fl),n);break}ch(e,qa,fl);break;case 4:if(Nd(e,o),(o&4194240)===o)break;for(n=e.eventTimes,d=-1;0<o;){var f=31-ec(o);p=1<<f,f=n[f],f>d&&(d=f),o&=~p}if(o=d,o=ei()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*hEe(o/1960))-o,10<o){e.timeoutHandle=B1(ch.bind(null,e,qa,fl),o);break}ch(e,qa,fl);break;case 5:ch(e,qa,fl);break;default:throw Error(rt(329))}}}return ts(e,ei()),e.callbackNode===a?AX.bind(null,e):null}function oP(e,n){var a=uy;return e.current.memoizedState.isDehydrated&&(wh(e,n).flags|=256),e=uS(e,n),e!==2&&(n=qa,qa=a,n!==null&&cP(n)),e}function cP(e){qa===null?qa=e:qa.push.apply(qa,e)}function pEe(e){for(var n=e;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var o=0;o<a.length;o++){var d=a[o],p=d.getSnapshot;d=d.value;try{if(!rc(p(),d))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Nd(e,n){for(n&=~Vk,n&=~Dw,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var a=31-ec(n),o=1<<a;e[a]=-1,n&=~o}}function WH(e){if(Un&6)throw Error(rt(327));Hm();var n=Kx(e,0);if(!(n&1))return ts(e,ei()),null;var a=uS(e,n);if(e.tag!==0&&a===2){var o=D1(e);o!==0&&(n=o,a=oP(e,o))}if(a===1)throw a=Ly,wh(e,0),Nd(e,n),ts(e,ei()),a;if(a===6)throw Error(rt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,ch(e,qa,fl),ts(e,ei()),null}function Gk(e,n){var a=Un;Un|=1;try{return e(n)}finally{Un=a,Un===0&&(af=ei()+500,Aw&&tu())}}function kh(e){Pd!==null&&Pd.tag===0&&!(Un&6)&&Hm();var n=Un;Un|=1;var a=ho.transition,o=Jn;try{if(ho.transition=null,Jn=1,e)return e()}finally{Jn=o,ho.transition=a,Un=n,!(Un&6)&&tu()}}function Wk(){bs=Lm.current,Cr(Lm)}function wh(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,Wbe(a)),ci!==null)for(a=ci.return;a!==null;){var o=a;switch(Sk(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&Qx();break;case 3:nf(),Cr(Za),Cr(pa),Pk();break;case 5:Ok(o);break;case 4:nf();break;case 13:Cr(Br);break;case 19:Cr(Br);break;case 10:Nk(o.type._context);break;case 22:case 23:Wk()}a=a.return}if(ki=e,ci=e=Wd(e.current,null),Xi=bs=n,_i=0,Ly=null,Vk=Dw=Dh=0,qa=uy=null,fh!==null){for(n=0;n<fh.length;n++)if(a=fh[n],o=a.interleaved,o!==null){a.interleaved=null;var d=o.next,p=a.pending;if(p!==null){var f=p.next;p.next=d,o.next=f}a.pending=o}fh=null}return e}function IX(e,n){do{var a=ci;try{if(Ck(),Ix.current=oS,sS){for(var o=Gr.memoizedState;o!==null;){var d=o.queue;d!==null&&(d.pending=null),o=o.next}sS=!1}if(Ph=0,Pi=vi=Gr=null,ly=!1,Dy=0,Fk.current=null,a===null||a.return===null){_i=1,Ly=n,ci=null;break}e:{var p=e,f=a.return,v=a,b=n;if(n=Xi,v.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var E=b,T=v,w=T.tag;if(!(T.mode&1)&&(w===0||w===11||w===15)){var N=T.alternate;N?(T.updateQueue=N.updateQueue,T.memoizedState=N.memoizedState,T.lanes=N.lanes):(T.updateQueue=null,T.memoizedState=null)}var P=IH(f);if(P!==null){P.flags&=-257,OH(P,f,v,p,n),P.mode&1&&AH(p,E,n),n=P,b=E;var A=n.updateQueue;if(A===null){var k=new Set;k.add(b),n.updateQueue=k}else A.add(b);break e}else{if(!(n&1)){AH(p,E,n),$k();break e}b=Error(rt(426))}}else if(kr&&v.mode&1){var I=IH(f);if(I!==null){!(I.flags&65536)&&(I.flags|=256),OH(I,f,v,p,n),wk(rf(b,v));break e}}p=b=rf(b,v),_i!==4&&(_i=2),uy===null?uy=[p]:uy.push(p),p=f;do{switch(p.tag){case 3:p.flags|=65536,n&=-n,p.lanes|=n;var F=pX(p,b,n);SH(p,F);break e;case 1:v=b;var U=p.type,V=p.stateNode;if(!(p.flags&128)&&(typeof U.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(Bd===null||!Bd.has(V)))){p.flags|=65536,n&=-n,p.lanes|=n;var W=mX(p,v,n);SH(p,W);break e}}p=p.return}while(p!==null)}DX(a)}catch(B){n=B,ci===a&&a!==null&&(ci=a=a.return);continue}break}while(!0)}function OX(){var e=cS.current;return cS.current=oS,e===null?oS:e}function $k(){(_i===0||_i===3||_i===2)&&(_i=4),ki===null||!(Dh&268435455)&&!(Dw&268435455)||Nd(ki,Xi)}function uS(e,n){var a=Un;Un|=2;var o=OX();(ki!==e||Xi!==n)&&(fl=null,wh(e,n));do try{mEe();break}catch(d){IX(e,d)}while(!0);if(Ck(),Un=a,cS.current=o,ci!==null)throw Error(rt(261));return ki=null,Xi=0,_i}function mEe(){for(;ci!==null;)PX(ci)}function fEe(){for(;ci!==null&&!V_e();)PX(ci)}function PX(e){var n=jX(e.alternate,e,bs);e.memoizedProps=e.pendingProps,n===null?DX(e):ci=n,Fk.current=null}function DX(e){var n=e;do{var a=n.alternate;if(e=n.return,n.flags&32768){if(a=cEe(a,n),a!==null){a.flags&=32767,ci=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{_i=6,ci=null;return}}else if(a=oEe(a,n,bs),a!==null){ci=a;return}if(n=n.sibling,n!==null){ci=n;return}ci=n=e}while(n!==null);_i===0&&(_i=5)}function ch(e,n,a){var o=Jn,d=ho.transition;try{ho.transition=null,Jn=1,gEe(e,n,a,o)}finally{ho.transition=d,Jn=o}return null}function gEe(e,n,a,o){do Hm();while(Pd!==null);if(Un&6)throw Error(rt(327));a=e.finishedWork;var d=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(rt(177));e.callbackNode=null,e.callbackPriority=0;var p=a.lanes|a.childLanes;if(X_e(e,p),e===ki&&(ci=ki=null,Xi=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||ix||(ix=!0,LX(zx,function(){return Hm(),null})),p=(a.flags&15990)!==0,a.subtreeFlags&15990||p){p=ho.transition,ho.transition=null;var f=Jn;Jn=1;var v=Un;Un|=4,Fk.current=null,dEe(e,a),NX(a,e),Lbe(F1),Yx=!!U1,F1=U1=null,e.current=a,uEe(a),B_e(),Un=v,Jn=f,ho.transition=p}else e.current=a;if(ix&&(ix=!1,Pd=e,dS=d),p=e.pendingLanes,p===0&&(Bd=null),$_e(a.stateNode),ts(e,ei()),n!==null)for(o=e.onRecoverableError,a=0;a<n.length;a++)d=n[a],o(d.value,{componentStack:d.stack,digest:d.digest});if(lS)throw lS=!1,e=aP,aP=null,e;return dS&1&&e.tag!==0&&Hm(),p=e.pendingLanes,p&1?e===sP?hy++:(hy=0,sP=e):hy=0,tu(),null}function Hm(){if(Pd!==null){var e=pq(dS),n=ho.transition,a=Jn;try{if(ho.transition=null,Jn=16>e?16:e,Pd===null)var o=!1;else{if(e=Pd,Pd=null,dS=0,Un&6)throw Error(rt(331));var d=Un;for(Un|=4,Ct=e.current;Ct!==null;){var p=Ct,f=p.child;if(Ct.flags&16){var v=p.deletions;if(v!==null){for(var b=0;b<v.length;b++){var E=v[b];for(Ct=E;Ct!==null;){var T=Ct;switch(T.tag){case 0:case 11:case 15:dy(8,T,p)}var w=T.child;if(w!==null)w.return=T,Ct=w;else for(;Ct!==null;){T=Ct;var N=T.sibling,P=T.return;if(wX(T),T===E){Ct=null;break}if(N!==null){N.return=P,Ct=N;break}Ct=P}}}var A=p.alternate;if(A!==null){var k=A.child;if(k!==null){A.child=null;do{var I=k.sibling;k.sibling=null,k=I}while(k!==null)}}Ct=p}}if(p.subtreeFlags&2064&&f!==null)f.return=p,Ct=f;else e:for(;Ct!==null;){if(p=Ct,p.flags&2048)switch(p.tag){case 0:case 11:case 15:dy(9,p,p.return)}var F=p.sibling;if(F!==null){F.return=p.return,Ct=F;break e}Ct=p.return}}var U=e.current;for(Ct=U;Ct!==null;){f=Ct;var V=f.child;if(f.subtreeFlags&2064&&V!==null)V.return=f,Ct=V;else e:for(f=U;Ct!==null;){if(v=Ct,v.flags&2048)try{switch(v.tag){case 0:case 11:case 15:Pw(9,v)}}catch(B){Yr(v,v.return,B)}if(v===f){Ct=null;break e}var W=v.sibling;if(W!==null){W.return=v.return,Ct=W;break e}Ct=v.return}}if(Un=d,tu(),Bc&&typeof Bc.onPostCommitFiberRoot=="function")try{Bc.onPostCommitFiberRoot(ww,e)}catch{}o=!0}return o}finally{Jn=a,ho.transition=n}}return!1}function $H(e,n,a){n=rf(a,n),n=pX(e,n,1),e=Vd(e,n,1),n=Ra(),e!==null&&(w0(e,1,n),ts(e,n))}function Yr(e,n,a){if(e.tag===3)$H(e,e,a);else for(;n!==null;){if(n.tag===3){$H(n,e,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Bd===null||!Bd.has(o))){e=rf(a,e),e=mX(n,e,1),n=Vd(n,e,1),e=Ra(),n!==null&&(w0(n,1,e),ts(n,e));break}}n=n.return}}function vEe(e,n,a){var o=e.pingCache;o!==null&&o.delete(n),n=Ra(),e.pingedLanes|=e.suspendedLanes&a,ki===e&&(Xi&a)===a&&(_i===4||_i===3&&(Xi&130023424)===Xi&&500>ei()-Bk?wh(e,0):Vk|=a),ts(e,n)}function kX(e,n){n===0&&(e.mode&1?(n=YE,YE<<=1,!(YE&130023424)&&(YE=4194304)):n=1);var a=Ra();e=Il(e,n),e!==null&&(w0(e,n,a),ts(e,a))}function yEe(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),kX(e,a)}function _Ee(e,n){var a=0;switch(e.tag){case 13:var o=e.stateNode,d=e.memoizedState;d!==null&&(a=d.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(rt(314))}o!==null&&o.delete(n),kX(e,a)}var jX;jX=function(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps||Za.current)Xa=!0;else{if(!(e.lanes&a)&&!(n.flags&128))return Xa=!1,sEe(e,n,a);Xa=!!(e.flags&131072)}else Xa=!1,kr&&n.flags&1048576&&Fq(n,tS,n.index);switch(n.lanes=0,n.tag){case 2:var o=n.type;Px(e,n),e=n.pendingProps;var d=Zm(n,pa.current);$m(n,a),d=kk(null,n,o,e,d,a);var p=jk();return n.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,es(o)?(p=!0,Zx(n)):p=!1,n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,Ak(n),d.updater=Ow,n.stateNode=d,d._reactInternals=n,Y1(n,o,e,a),n=J1(null,n,o,!0,p,a)):(n.tag=0,kr&&p&&xk(n),Ta(null,n,d,a),n=n.child),n;case 16:o=n.elementType;e:{switch(Px(e,n),e=n.pendingProps,d=o._init,o=d(o._payload),n.type=o,d=n.tag=EEe(o),e=Ko(o,e),d){case 0:n=X1(null,n,o,e,a);break e;case 1:n=kH(null,n,o,e,a);break e;case 11:n=PH(null,n,o,e,a);break e;case 14:n=DH(null,n,o,Ko(o.type,e),a);break e}throw Error(rt(306,o,""))}return n;case 0:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),X1(e,n,o,d,a);case 1:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),kH(e,n,o,d,a);case 3:e:{if(yX(n),e===null)throw Error(rt(387));o=n.pendingProps,p=n.memoizedState,d=p.element,Hq(e,n),iS(n,o,null,a);var f=n.memoizedState;if(o=f.element,p.isDehydrated)if(p={element:o,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){d=rf(Error(rt(423)),n),n=jH(e,n,o,a,d);break e}else if(o!==d){d=rf(Error(rt(424)),n),n=jH(e,n,o,a,d);break e}else for(Ts=Fd(n.stateNode.containerInfo.firstChild),Cs=n,kr=!0,Jo=null,a=Wq(n,null,o,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(ef(),o===d){n=Ol(e,n,a);break e}Ta(e,n,o,a)}n=n.child}return n;case 5:return zq(n),e===null&&H1(n),o=n.type,d=n.pendingProps,p=e!==null?e.memoizedProps:null,f=d.children,V1(o,d)?f=null:p!==null&&V1(o,p)&&(n.flags|=32),vX(e,n),Ta(e,n,f,a),n.child;case 6:return e===null&&H1(n),null;case 13:return _X(e,n,a);case 4:return Ik(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=tf(n,null,o,a):Ta(e,n,o,a),n.child;case 11:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),PH(e,n,o,d,a);case 7:return Ta(e,n,n.pendingProps,a),n.child;case 8:return Ta(e,n,n.pendingProps.children,a),n.child;case 12:return Ta(e,n,n.pendingProps.children,a),n.child;case 10:e:{if(o=n.type._context,d=n.pendingProps,p=n.memoizedProps,f=d.value,pr(nS,o._currentValue),o._currentValue=f,p!==null)if(rc(p.value,f)){if(p.children===d.children&&!Za.current){n=Ol(e,n,a);break e}}else for(p=n.child,p!==null&&(p.return=n);p!==null;){var v=p.dependencies;if(v!==null){f=p.child;for(var b=v.firstContext;b!==null;){if(b.context===o){if(p.tag===1){b=Sl(-1,a&-a),b.tag=2;var E=p.updateQueue;if(E!==null){E=E.shared;var T=E.pending;T===null?b.next=b:(b.next=T.next,T.next=b),E.pending=b}}p.lanes|=a,b=p.alternate,b!==null&&(b.lanes|=a),z1(p.return,a,n),v.lanes|=a;break}b=b.next}}else if(p.tag===10)f=p.type===n.type?null:p.child;else if(p.tag===18){if(f=p.return,f===null)throw Error(rt(341));f.lanes|=a,v=f.alternate,v!==null&&(v.lanes|=a),z1(f,a,n),f=p.sibling}else f=p.child;if(f!==null)f.return=p;else for(f=p;f!==null;){if(f===n){f=null;break}if(p=f.sibling,p!==null){p.return=f.return,f=p;break}f=f.return}p=f}Ta(e,n,d.children,a),n=n.child}return n;case 9:return d=n.type,o=n.pendingProps.children,$m(n,a),d=fo(d),o=o(d),n.flags|=1,Ta(e,n,o,a),n.child;case 14:return o=n.type,d=Ko(o,n.pendingProps),d=Ko(o.type,d),DH(e,n,o,d,a);case 15:return fX(e,n,n.type,n.pendingProps,a);case 17:return o=n.type,d=n.pendingProps,d=n.elementType===o?d:Ko(o,d),Px(e,n),n.tag=1,es(o)?(e=!0,Zx(n)):e=!1,$m(n,a),hX(n,o,d),Y1(n,o,d,a),J1(null,n,o,!0,e,a);case 19:return bX(e,n,a);case 22:return gX(e,n,a)}throw Error(rt(156,n.tag))};function LX(e,n){return lq(e,n)}function bEe(e,n,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oo(e,n,a,o){return new bEe(e,n,a,o)}function Hk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function EEe(e){if(typeof e=="function")return Hk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===dk)return 11;if(e===uk)return 14}return 2}function Wd(e,n){var a=e.alternate;return a===null?(a=oo(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function jx(e,n,a,o,d,p){var f=2;if(o=e,typeof e=="function")Hk(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case Cm:return Th(a.children,d,p,n);case lk:f=8,d|=8;break;case y1:return e=oo(12,a,n,d|2),e.elementType=y1,e.lanes=p,e;case _1:return e=oo(13,a,n,d),e.elementType=_1,e.lanes=p,e;case b1:return e=oo(19,a,n,d),e.elementType=b1,e.lanes=p,e;case zY:return kw(a,d,p,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case $Y:f=10;break e;case HY:f=9;break e;case dk:f=11;break e;case uk:f=14;break e;case Sd:f=16,o=null;break e}throw Error(rt(130,e==null?e:typeof e,""))}return n=oo(f,a,n,d),n.elementType=e,n.type=o,n.lanes=p,n}function Th(e,n,a,o){return e=oo(7,e,o,n),e.lanes=a,e}function kw(e,n,a,o){return e=oo(22,e,o,n),e.elementType=zY,e.lanes=a,e.stateNode={isHidden:!1},e}function IO(e,n,a){return e=oo(6,e,null,n),e.lanes=a,e}function OO(e,n,a){return n=oo(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function xEe(e,n,a,o,d){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uO(0),this.expirationTimes=uO(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uO(0),this.identifierPrefix=o,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function zk(e,n,a,o,d,p,f,v,b){return e=new xEe(e,n,a,v,b),n===1?(n=1,p===!0&&(n|=8)):n=0,p=oo(3,null,null,n),e.current=p,p.stateNode=e,p.memoizedState={element:o,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ak(p),e}function SEe(e,n,a){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Tm,key:o==null?null:""+o,children:e,containerInfo:n,implementation:a}}function MX(e){if(!e)return Xd;e=e._reactInternals;e:{if(Wh(e)!==e||e.tag!==1)throw Error(rt(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(es(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(rt(171))}if(e.tag===1){var a=e.type;if(es(a))return Mq(e,a,n)}return n}function UX(e,n,a,o,d,p,f,v,b){return e=zk(a,o,!0,e,d,p,f,v,b),e.context=MX(null),a=e.current,o=Ra(),d=Gd(a),p=Sl(o,d),p.callback=n??null,Vd(a,p,d),e.current.lanes=d,w0(e,d,o),ts(e,o),e}function jw(e,n,a,o){var d=n.current,p=Ra(),f=Gd(d);return a=MX(a),n.context===null?n.context=a:n.pendingContext=a,n=Sl(p,f),n.payload={element:e},o=o===void 0?null:o,o!==null&&(n.callback=o),e=Vd(d,n,f),e!==null&&(tc(e,d,f,p),Ax(e,d,f)),f}function hS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function HH(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function Kk(e,n){HH(e,n),(e=e.alternate)&&HH(e,n)}function wEe(){return null}var FX=typeof reportError=="function"?reportError:function(e){console.error(e)};function Yk(e){this._internalRoot=e}Lw.prototype.render=Yk.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(rt(409));jw(e,n,null,null)};Lw.prototype.unmount=Yk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;kh(function(){jw(null,e,null,null)}),n[Al]=null}};function Lw(e){this._internalRoot=e}Lw.prototype.unstable_scheduleHydration=function(e){if(e){var n=gq();e={blockedOn:null,target:e,priority:n};for(var a=0;a<Cd.length&&n!==0&&n<Cd[a].priority;a++);Cd.splice(a,0,e),a===0&&yq(e)}};function qk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Mw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function zH(){}function TEe(e,n,a,o,d){if(d){if(typeof o=="function"){var p=o;o=function(){var E=hS(f);p.call(E)}}var f=UX(n,o,e,0,null,!1,!1,"",zH);return e._reactRootContainer=f,e[Al]=f.current,Ry(e.nodeType===8?e.parentNode:e),kh(),f}for(;d=e.lastChild;)e.removeChild(d);if(typeof o=="function"){var v=o;o=function(){var E=hS(b);v.call(E)}}var b=zk(e,0,!1,null,null,!1,!1,"",zH);return e._reactRootContainer=b,e[Al]=b.current,Ry(e.nodeType===8?e.parentNode:e),kh(function(){jw(n,b,a,o)}),b}function Uw(e,n,a,o,d){var p=a._reactRootContainer;if(p){var f=p;if(typeof d=="function"){var v=d;d=function(){var b=hS(f);v.call(b)}}jw(n,f,e,d)}else f=TEe(a,n,e,d,o);return hS(f)}mq=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var a=ey(n.pendingLanes);a!==0&&(mk(n,a|1),ts(n,ei()),!(Un&6)&&(af=ei()+500,tu()))}break;case 13:kh(function(){var o=Il(e,1);if(o!==null){var d=Ra();tc(o,e,1,d)}}),Kk(e,1)}};fk=function(e){if(e.tag===13){var n=Il(e,134217728);if(n!==null){var a=Ra();tc(n,e,134217728,a)}Kk(e,134217728)}};fq=function(e){if(e.tag===13){var n=Gd(e),a=Il(e,n);if(a!==null){var o=Ra();tc(a,e,n,o)}Kk(e,n)}};gq=function(){return Jn};vq=function(e,n){var a=Jn;try{return Jn=e,n()}finally{Jn=a}};I1=function(e,n,a){switch(n){case"input":if(S1(e,a),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==e&&o.form===e.form){var d=Rw(o);if(!d)throw Error(rt(90));YY(o),S1(o,d)}}}break;case"textarea":XY(e,a);break;case"select":n=a.value,n!=null&&Vm(e,!!a.multiple,n,!1)}};rq=Gk;iq=kh;var CEe={usingClientEntryPoint:!1,Events:[C0,Im,Rw,tq,nq,Gk]},Uv={findFiberByHostInstance:mh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},NEe={bundleType:Uv.bundleType,version:Uv.version,rendererPackageName:Uv.rendererPackageName,rendererConfig:Uv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ll.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=oq(e),e===null?null:e.stateNode},findFiberByHostInstance:Uv.findFiberByHostInstance||wEe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ax=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ax.isDisabled&&ax.supportsFiber)try{ww=ax.inject(NEe),Bc=ax}catch{}}Rs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CEe;Rs.createPortal=function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qk(n))throw Error(rt(200));return SEe(e,n,null,a)};Rs.createRoot=function(e,n){if(!qk(e))throw Error(rt(299));var a=!1,o="",d=FX;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),n=zk(e,1,!1,null,null,a,!1,o,d),e[Al]=n.current,Ry(e.nodeType===8?e.parentNode:e),new Yk(n)};Rs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(rt(188)):(e=Object.keys(e).join(","),Error(rt(268,e)));return e=oq(n),e=e===null?null:e.stateNode,e};Rs.flushSync=function(e){return kh(e)};Rs.hydrate=function(e,n,a){if(!Mw(n))throw Error(rt(200));return Uw(null,e,n,!0,a)};Rs.hydrateRoot=function(e,n,a){if(!qk(e))throw Error(rt(405));var o=a!=null&&a.hydratedSources||null,d=!1,p="",f=FX;if(a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onRecoverableError!==void 0&&(f=a.onRecoverableError)),n=UX(n,null,e,1,a??null,d,!1,p,f),e[Al]=n.current,Ry(e),o)for(e=0;e<o.length;e++)a=o[e],d=a._getVersion,d=d(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,d]:n.mutableSourceEagerHydrationData.push(a,d);return new Lw(n)};Rs.render=function(e,n,a){if(!Mw(n))throw Error(rt(200));return Uw(null,e,n,!1,a)};Rs.unmountComponentAtNode=function(e){if(!Mw(e))throw Error(rt(40));return e._reactRootContainer?(kh(function(){Uw(null,null,e,!1,function(){e._reactRootContainer=null,e[Al]=null})}),!0):!1};Rs.unstable_batchedUpdates=Gk;Rs.unstable_renderSubtreeIntoContainer=function(e,n,a,o){if(!Mw(a))throw Error(rt(200));if(e==null||e._reactInternals===void 0)throw Error(rt(38));return Uw(e,n,a,!1,o)};Rs.version="18.3.1-next-f1338f8080-20240426";function VX(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(VX)}catch(e){console.error(e)}}VX(),VY.exports=Rs;var REe=VY.exports,KH=REe;g1.createRoot=KH.createRoot,g1.hydrateRoot=KH.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function My(){return My=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},My.apply(this,arguments)}var Dd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Dd||(Dd={}));const YH="popstate";function AEe(e){e===void 0&&(e={});function n(o,d){let{pathname:p,search:f,hash:v}=o.location;return lP("",{pathname:p,search:f,hash:v},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function a(o,d){return typeof d=="string"?d:pS(d)}return OEe(n,a,null,e)}function ti(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Xk(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function IEe(){return Math.random().toString(36).substr(2,8)}function qH(e,n){return{usr:e.state,key:e.key,idx:n}}function lP(e,n,a,o){return a===void 0&&(a=null),My({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?Lf(n):n,{state:a,key:n&&n.key||o||IEe()})}function pS(e){let{pathname:n="/",search:a="",hash:o=""}=e;return a&&a!=="?"&&(n+=a.charAt(0)==="?"?a:"?"+a),o&&o!=="#"&&(n+=o.charAt(0)==="#"?o:"#"+o),n}function Lf(e){let n={};if(e){let a=e.indexOf("#");a>=0&&(n.hash=e.substr(a),e=e.substr(0,a));let o=e.indexOf("?");o>=0&&(n.search=e.substr(o),e=e.substr(0,o)),e&&(n.pathname=e)}return n}function OEe(e,n,a,o){o===void 0&&(o={});let{window:d=document.defaultView,v5Compat:p=!1}=o,f=d.history,v=Dd.Pop,b=null,E=T();E==null&&(E=0,f.replaceState(My({},f.state,{idx:E}),""));function T(){return(f.state||{idx:null}).idx}function w(){v=Dd.Pop;let I=T(),F=I==null?null:I-E;E=I,b&&b({action:v,location:k.location,delta:F})}function N(I,F){v=Dd.Push;let U=lP(k.location,I,F);E=T()+1;let V=qH(U,E),W=k.createHref(U);try{f.pushState(V,"",W)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;d.location.assign(W)}p&&b&&b({action:v,location:k.location,delta:1})}function P(I,F){v=Dd.Replace;let U=lP(k.location,I,F);E=T();let V=qH(U,E),W=k.createHref(U);f.replaceState(V,"",W),p&&b&&b({action:v,location:k.location,delta:0})}function A(I){let F=d.location.origin!=="null"?d.location.origin:d.location.href,U=typeof I=="string"?I:pS(I);return U=U.replace(/ $/,"%20"),ti(F,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,F)}let k={get action(){return v},get location(){return e(d,f)},listen(I){if(b)throw new Error("A history only accepts one active listener");return d.addEventListener(YH,w),b=I,()=>{d.removeEventListener(YH,w),b=null}},createHref(I){return n(d,I)},createURL:A,encodeLocation(I){let F=A(I);return{pathname:F.pathname,search:F.search,hash:F.hash}},push:N,replace:P,go(I){return f.go(I)}};return k}var XH;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(XH||(XH={}));function PEe(e,n,a){return a===void 0&&(a="/"),DEe(e,n,a)}function DEe(e,n,a,o){let d=typeof n=="string"?Lf(n):n,p=Jk(d.pathname||"/",a);if(p==null)return null;let f=BX(e);kEe(f);let v=null;for(let b=0;v==null&&b<f.length;++b){let E=zEe(p);v=WEe(f[b],E)}return v}function BX(e,n,a,o){n===void 0&&(n=[]),a===void 0&&(a=[]),o===void 0&&(o="");let d=(p,f,v)=>{let b={relativePath:v===void 0?p.path||"":v,caseSensitive:p.caseSensitive===!0,childrenIndex:f,route:p};b.relativePath.startsWith("/")&&(ti(b.relativePath.startsWith(o),'Absolute route path "'+b.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),b.relativePath=b.relativePath.slice(o.length));let E=$d([o,b.relativePath]),T=a.concat(b);p.children&&p.children.length>0&&(ti(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+E+'".')),BX(p.children,n,T,E)),!(p.path==null&&!p.index)&&n.push({path:E,score:BEe(E,p.index),routesMeta:T})};return e.forEach((p,f)=>{var v;if(p.path===""||!((v=p.path)!=null&&v.includes("?")))d(p,f);else for(let b of GX(p.path))d(p,f,b)}),n}function GX(e){let n=e.split("/");if(n.length===0)return[];let[a,...o]=n,d=a.endsWith("?"),p=a.replace(/\?$/,"");if(o.length===0)return d?[p,""]:[p];let f=GX(o.join("/")),v=[];return v.push(...f.map(b=>b===""?p:[p,b].join("/"))),d&&v.push(...f),v.map(b=>e.startsWith("/")&&b===""?"/":b)}function kEe(e){e.sort((n,a)=>n.score!==a.score?a.score-n.score:GEe(n.routesMeta.map(o=>o.childrenIndex),a.routesMeta.map(o=>o.childrenIndex)))}const jEe=/^:[\w-]+$/,LEe=3,MEe=2,UEe=1,FEe=10,VEe=-2,JH=e=>e==="*";function BEe(e,n){let a=e.split("/"),o=a.length;return a.some(JH)&&(o+=VEe),n&&(o+=MEe),a.filter(d=>!JH(d)).reduce((d,p)=>d+(jEe.test(p)?LEe:p===""?UEe:FEe),o)}function GEe(e,n){return e.length===n.length&&e.slice(0,-1).every((o,d)=>o===n[d])?e[e.length-1]-n[n.length-1]:0}function WEe(e,n,a){let{routesMeta:o}=e,d={},p="/",f=[];for(let v=0;v<o.length;++v){let b=o[v],E=v===o.length-1,T=p==="/"?n:n.slice(p.length)||"/",w=$Ee({path:b.relativePath,caseSensitive:b.caseSensitive,end:E},T),N=b.route;if(!w)return null;Object.assign(d,w.params),f.push({params:d,pathname:$d([p,w.pathname]),pathnameBase:JEe($d([p,w.pathnameBase])),route:N}),w.pathnameBase!=="/"&&(p=$d([p,w.pathnameBase]))}return f}function $Ee(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[a,o]=HEe(e.path,e.caseSensitive,e.end),d=n.match(a);if(!d)return null;let p=d[0],f=p.replace(/(.)\/+$/,"$1"),v=d.slice(1);return{params:o.reduce((E,T,w)=>{let{paramName:N,isOptional:P}=T;if(N==="*"){let k=v[w]||"";f=p.slice(0,p.length-k.length).replace(/(.)\/+$/,"$1")}const A=v[w];return P&&!A?E[N]=void 0:E[N]=(A||"").replace(/%2F/g,"/"),E},{}),pathname:p,pathnameBase:f,pattern:e}}function HEe(e,n,a){n===void 0&&(n=!1),a===void 0&&(a=!0),Xk(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,v,b)=>(o.push({paramName:v,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,n?void 0:"i"),o]}function zEe(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Xk(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function Jk(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,o=e.charAt(a);return o&&o!=="/"?null:e.slice(a)||"/"}const KEe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,YEe=e=>KEe.test(e);function qEe(e,n){n===void 0&&(n="/");let{pathname:a,search:o="",hash:d=""}=typeof e=="string"?Lf(e):e,p;if(a)if(YEe(a))p=a;else{if(a.includes("//")){let f=a;a=a.replace(/\/\/+/g,"/"),Xk(!1,"Pathnames cannot have embedded double slashes - normalizing "+(f+" -> "+a))}a.startsWith("/")?p=QH(a.substring(1),"/"):p=QH(a,n)}else p=n;return{pathname:p,search:QEe(o),hash:ZEe(d)}}function QH(e,n){let a=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?a.length>1&&a.pop():d!=="."&&a.push(d)}),a.length>1?a.join("/"):"/"}function PO(e,n,a,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function XEe(e){return e.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function Qk(e,n){let a=XEe(e);return n?a.map((o,d)=>d===a.length-1?o.pathname:o.pathnameBase):a.map(o=>o.pathnameBase)}function Zk(e,n,a,o){o===void 0&&(o=!1);let d;typeof e=="string"?d=Lf(e):(d=My({},e),ti(!d.pathname||!d.pathname.includes("?"),PO("?","pathname","search",d)),ti(!d.pathname||!d.pathname.includes("#"),PO("#","pathname","hash",d)),ti(!d.search||!d.search.includes("#"),PO("#","search","hash",d)));let p=e===""||d.pathname==="",f=p?"/":d.pathname,v;if(f==null)v=a;else{let w=n.length-1;if(!o&&f.startsWith("..")){let N=f.split("/");for(;N[0]==="..";)N.shift(),w-=1;d.pathname=N.join("/")}v=w>=0?n[w]:"/"}let b=qEe(d,v),E=f&&f!=="/"&&f.endsWith("/"),T=(p||f===".")&&a.endsWith("/");return!b.pathname.endsWith("/")&&(E||T)&&(b.pathname+="/"),b}const $d=e=>e.join("/").replace(/\/\/+/g,"/"),JEe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),QEe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,ZEe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function exe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const WX=["post","put","patch","delete"];new Set(WX);const txe=["get",...WX];new Set(txe);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uy(){return Uy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Uy.apply(this,arguments)}const e2=q.createContext(null),nxe=q.createContext(null),nu=q.createContext(null),Fw=q.createContext(null),Ml=q.createContext({outlet:null,matches:[],isDataRoute:!1}),$X=q.createContext(null);function rxe(e,n){let{relative:a}=n===void 0?{}:n;Mf()||ti(!1);let{basename:o,navigator:d}=q.useContext(nu),{hash:p,pathname:f,search:v}=zX(e,{relative:a}),b=f;return o!=="/"&&(b=f==="/"?o:$d([o,f])),d.createHref({pathname:b,search:v,hash:p})}function Mf(){return q.useContext(Fw)!=null}function Ul(){return Mf()||ti(!1),q.useContext(Fw).location}function HX(e){q.useContext(nu).static||q.useLayoutEffect(e)}function Is(){let{isDataRoute:e}=q.useContext(Ml);return e?gxe():ixe()}function ixe(){Mf()||ti(!1);let e=q.useContext(e2),{basename:n,future:a,navigator:o}=q.useContext(nu),{matches:d}=q.useContext(Ml),{pathname:p}=Ul(),f=JSON.stringify(Qk(d,a.v7_relativeSplatPath)),v=q.useRef(!1);return HX(()=>{v.current=!0}),q.useCallback(function(E,T){if(T===void 0&&(T={}),!v.current)return;if(typeof E=="number"){o.go(E);return}let w=Zk(E,JSON.parse(f),p,T.relative==="path");e==null&&n!=="/"&&(w.pathname=w.pathname==="/"?n:$d([n,w.pathname])),(T.replace?o.replace:o.push)(w,T.state,T)},[n,o,f,p,e])}function Vw(){let{matches:e}=q.useContext(Ml),n=e[e.length-1];return n?n.params:{}}function zX(e,n){let{relative:a}=n===void 0?{}:n,{future:o}=q.useContext(nu),{matches:d}=q.useContext(Ml),{pathname:p}=Ul(),f=JSON.stringify(Qk(d,o.v7_relativeSplatPath));return q.useMemo(()=>Zk(e,JSON.parse(f),p,a==="path"),[e,f,p,a])}function axe(e,n){return sxe(e,n)}function sxe(e,n,a,o){Mf()||ti(!1);let{navigator:d}=q.useContext(nu),{matches:p}=q.useContext(Ml),f=p[p.length-1],v=f?f.params:{};f&&f.pathname;let b=f?f.pathnameBase:"/";f&&f.route;let E=Ul(),T;if(n){var w;let I=typeof n=="string"?Lf(n):n;b==="/"||(w=I.pathname)!=null&&w.startsWith(b)||ti(!1),T=I}else T=E;let N=T.pathname||"/",P=N;if(b!=="/"){let I=b.replace(/^\//,"").split("/");P="/"+N.replace(/^\//,"").split("/").slice(I.length).join("/")}let A=PEe(e,{pathname:P}),k=uxe(A&&A.map(I=>Object.assign({},I,{params:Object.assign({},v,I.params),pathname:$d([b,d.encodeLocation?d.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?b:$d([b,d.encodeLocation?d.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),p,a,o);return n&&k?q.createElement(Fw.Provider,{value:{location:Uy({pathname:"/",search:"",hash:"",state:null,key:"default"},T),navigationType:Dd.Pop}},k):k}function oxe(){let e=fxe(),n=exe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),a=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return q.createElement(q.Fragment,null,q.createElement("h2",null,"Unexpected Application Error!"),q.createElement("h3",{style:{fontStyle:"italic"}},n),a?q.createElement("pre",{style:d},a):null,null)}const cxe=q.createElement(oxe,null);class lxe extends q.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,a){return a.location!==n.location||a.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:a.error,location:a.location,revalidation:n.revalidation||a.revalidation}}componentDidCatch(n,a){console.error("React Router caught the following error during render",n,a)}render(){return this.state.error!==void 0?q.createElement(Ml.Provider,{value:this.props.routeContext},q.createElement($X.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function dxe(e){let{routeContext:n,match:a,children:o}=e,d=q.useContext(e2);return d&&d.static&&d.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=a.route.id),q.createElement(Ml.Provider,{value:n},o)}function uxe(e,n,a,o){var d;if(n===void 0&&(n=[]),a===void 0&&(a=null),o===void 0&&(o=null),e==null){var p;if(!a)return null;if(a.errors)e=a.matches;else if((p=o)!=null&&p.v7_partialHydration&&n.length===0&&!a.initialized&&a.matches.length>0)e=a.matches;else return null}let f=e,v=(d=a)==null?void 0:d.errors;if(v!=null){let T=f.findIndex(w=>w.route.id&&(v==null?void 0:v[w.route.id])!==void 0);T>=0||ti(!1),f=f.slice(0,Math.min(f.length,T+1))}let b=!1,E=-1;if(a&&o&&o.v7_partialHydration)for(let T=0;T<f.length;T++){let w=f[T];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(E=T),w.route.id){let{loaderData:N,errors:P}=a,A=w.route.loader&&N[w.route.id]===void 0&&(!P||P[w.route.id]===void 0);if(w.route.lazy||A){b=!0,E>=0?f=f.slice(0,E+1):f=[f[0]];break}}}return f.reduceRight((T,w,N)=>{let P,A=!1,k=null,I=null;a&&(P=v&&w.route.id?v[w.route.id]:void 0,k=w.route.errorElement||cxe,b&&(E<0&&N===0?(vxe("route-fallback"),A=!0,I=null):E===N&&(A=!0,I=w.route.hydrateFallbackElement||null)));let F=n.concat(f.slice(0,N+1)),U=()=>{let V;return P?V=k:A?V=I:w.route.Component?V=q.createElement(w.route.Component,null):w.route.element?V=w.route.element:V=T,q.createElement(dxe,{match:w,routeContext:{outlet:T,matches:F,isDataRoute:a!=null},children:V})};return a&&(w.route.ErrorBoundary||w.route.errorElement||N===0)?q.createElement(lxe,{location:a.location,revalidation:a.revalidation,component:k,error:P,children:U(),routeContext:{outlet:null,matches:F,isDataRoute:!0}}):U()},null)}var KX=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(KX||{}),YX=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(YX||{});function hxe(e){let n=q.useContext(e2);return n||ti(!1),n}function pxe(e){let n=q.useContext(nxe);return n||ti(!1),n}function mxe(e){let n=q.useContext(Ml);return n||ti(!1),n}function qX(e){let n=mxe(),a=n.matches[n.matches.length-1];return a.route.id||ti(!1),a.route.id}function fxe(){var e;let n=q.useContext($X),a=pxe(),o=qX();return n!==void 0?n:(e=a.errors)==null?void 0:e[o]}function gxe(){let{router:e}=hxe(KX.UseNavigateStable),n=qX(YX.UseNavigateStable),a=q.useRef(!1);return HX(()=>{a.current=!0}),q.useCallback(function(d,p){p===void 0&&(p={}),a.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,Uy({fromRouteId:n},p)))},[e,n])}const ZH={};function vxe(e,n,a){ZH[e]||(ZH[e]=!0)}function yxe(e,n){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Ss(e){let{to:n,replace:a,state:o,relative:d}=e;Mf()||ti(!1);let{future:p,static:f}=q.useContext(nu),{matches:v}=q.useContext(Ml),{pathname:b}=Ul(),E=Is(),T=Zk(n,Qk(v,p.v7_relativeSplatPath),b,d==="path"),w=JSON.stringify(T);return q.useEffect(()=>E(JSON.parse(w),{replace:a,state:o,relative:d}),[E,w,d,a,o]),null}function Dr(e){ti(!1)}function _xe(e){let{basename:n="/",children:a=null,location:o,navigationType:d=Dd.Pop,navigator:p,static:f=!1,future:v}=e;Mf()&&ti(!1);let b=n.replace(/^\/*/,"/"),E=q.useMemo(()=>({basename:b,navigator:p,static:f,future:Uy({v7_relativeSplatPath:!1},v)}),[b,v,p,f]);typeof o=="string"&&(o=Lf(o));let{pathname:T="/",search:w="",hash:N="",state:P=null,key:A="default"}=o,k=q.useMemo(()=>{let I=Jk(T,b);return I==null?null:{location:{pathname:I,search:w,hash:N,state:P,key:A},navigationType:d}},[b,T,w,N,P,A,d]);return k==null?null:q.createElement(nu.Provider,{value:E},q.createElement(Fw.Provider,{children:a,value:k}))}function bxe(e){let{children:n,location:a}=e;return axe(dP(n),a)}new Promise(()=>{});function dP(e,n){n===void 0&&(n=[]);let a=[];return q.Children.forEach(e,(o,d)=>{if(!q.isValidElement(o))return;let p=[...n,d];if(o.type===q.Fragment){a.push.apply(a,dP(o.props.children,p));return}o.type!==Dr&&ti(!1),!o.props.index||!o.props.children||ti(!1);let f={id:o.props.id||p.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(f.children=dP(o.props.children,p)),a.push(f)}),a}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uP(){return uP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},uP.apply(this,arguments)}function Exe(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function xxe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Sxe(e,n){return e.button===0&&(!n||n==="_self")&&!xxe(e)}function hP(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,a)=>{let o=e[a];return n.concat(Array.isArray(o)?o.map(d=>[a,d]):[[a,o]])},[]))}function wxe(e,n){let a=hP(e);return n&&n.forEach((o,d)=>{a.has(d)||n.getAll(d).forEach(p=>{a.append(d,p)})}),a}const Txe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Cxe="6";try{window.__reactRouterVersion=Cxe}catch{}const Nxe="startTransition",e7=v_e[Nxe];function Rxe(e){let{basename:n,children:a,future:o,window:d}=e,p=q.useRef();p.current==null&&(p.current=AEe({window:d,v5Compat:!0}));let f=p.current,[v,b]=q.useState({action:f.action,location:f.location}),{v7_startTransition:E}=o||{},T=q.useCallback(w=>{E&&e7?e7(()=>b(w)):b(w)},[b,E]);return q.useLayoutEffect(()=>f.listen(T),[f,T]),q.useEffect(()=>yxe(o),[o]),q.createElement(_xe,{basename:n,children:a,location:v.location,navigationType:v.action,navigator:f,future:o})}const Axe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Ixe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hn=q.forwardRef(function(n,a){let{onClick:o,relative:d,reloadDocument:p,replace:f,state:v,target:b,to:E,preventScrollReset:T,viewTransition:w}=n,N=Exe(n,Txe),{basename:P}=q.useContext(nu),A,k=!1;if(typeof E=="string"&&Ixe.test(E)&&(A=E,Axe))try{let V=new URL(window.location.href),W=E.startsWith("//")?new URL(V.protocol+E):new URL(E),B=Jk(W.pathname,P);W.origin===V.origin&&B!=null?E=B+W.search+W.hash:k=!0}catch{}let I=rxe(E,{relative:d}),F=Oxe(E,{replace:f,state:v,target:b,preventScrollReset:T,relative:d,viewTransition:w});function U(V){o&&o(V),V.defaultPrevented||F(V)}return q.createElement("a",uP({},N,{href:A||I,onClick:k||p?o:U,ref:a,target:b}))});var t7;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(t7||(t7={}));var n7;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(n7||(n7={}));function Oxe(e,n){let{target:a,replace:o,state:d,preventScrollReset:p,relative:f,viewTransition:v}=n===void 0?{}:n,b=Is(),E=Ul(),T=zX(e,{relative:f});return q.useCallback(w=>{if(Sxe(w,a)){w.preventDefault();let N=o!==void 0?o:pS(E)===pS(T);b(e,{replace:N,state:d,preventScrollReset:p,relative:f,viewTransition:v})}},[E,b,T,o,d,a,e,p,f,v])}function Pxe(e){let n=q.useRef(hP(e)),a=q.useRef(!1),o=Ul(),d=q.useMemo(()=>wxe(o.search,a.current?null:n.current),[o.search]),p=Is(),f=q.useCallback((v,b)=>{const E=hP(typeof v=="function"?v(d):v);a.current=!0,p("?"+E,b)},[p,d]);return[d,f]}let Dxe={data:""},kxe=e=>{if(typeof window=="object"){let n=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return n.nonce=window.__nonce__,n.parentNode||(e||document.head).appendChild(n),n.firstChild}return e||Dxe},jxe=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Lxe=/\/\*[^]*?\*\/|  +/g,r7=/\n+/g,Rd=(e,n)=>{let a="",o="",d="";for(let p in e){let f=e[p];p[0]=="@"?p[1]=="i"?a=p+" "+f+";":o+=p[1]=="f"?Rd(f,p):p+"{"+Rd(f,p[1]=="k"?"":n)+"}":typeof f=="object"?o+=Rd(f,n?n.replace(/([^,])+/g,v=>p.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,v):v?v+" "+b:b)):p):f!=null&&(p=/^--/.test(p)?p:p.replace(/[A-Z]/g,"-$&").toLowerCase(),d+=Rd.p?Rd.p(p,f):p+":"+f+";")}return a+(n&&d?n+"{"+d+"}":d)+o},hl={},XX=e=>{if(typeof e=="object"){let n="";for(let a in e)n+=a+XX(e[a]);return n}return e},Mxe=(e,n,a,o,d)=>{let p=XX(e),f=hl[p]||(hl[p]=(b=>{let E=0,T=11;for(;E<b.length;)T=101*T+b.charCodeAt(E++)>>>0;return"go"+T})(p));if(!hl[f]){let b=p!==e?e:(E=>{let T,w,N=[{}];for(;T=jxe.exec(E.replace(Lxe,""));)T[4]?N.shift():T[3]?(w=T[3].replace(r7," ").trim(),N.unshift(N[0][w]=N[0][w]||{})):N[0][T[1]]=T[2].replace(r7," ").trim();return N[0]})(e);hl[f]=Rd(d?{["@keyframes "+f]:b}:b,a?"":"."+f)}let v=a&&hl.g?hl.g:null;return a&&(hl.g=hl[f]),((b,E,T,w)=>{w?E.data=E.data.replace(w,b):E.data.indexOf(b)===-1&&(E.data=T?b+E.data:E.data+b)})(hl[f],n,o,v),f},Uxe=(e,n,a)=>e.reduce((o,d,p)=>{let f=n[p];if(f&&f.call){let v=f(a),b=v&&v.props&&v.props.className||/^go/.test(v)&&v;f=b?"."+b:v&&typeof v=="object"?v.props?"":Rd(v,""):v===!1?"":v}return o+d+(f??"")},"");function Bw(e){let n=this||{},a=e.call?e(n.p):e;return Mxe(a.unshift?a.raw?Uxe(a,[].slice.call(arguments,1),n.p):a.reduce((o,d)=>Object.assign(o,d&&d.call?d(n.p):d),{}):a,kxe(n.target),n.g,n.o,n.k)}let JX,pP,mP;Bw.bind({g:1});let Pl=Bw.bind({k:1});function Fxe(e,n,a,o){Rd.p=n,JX=e,pP=a,mP=o}function ru(e,n){let a=this||{};return function(){let o=arguments;function d(p,f){let v=Object.assign({},p),b=v.className||d.className;a.p=Object.assign({theme:pP&&pP()},v),a.o=/ *go\d+/.test(b),v.className=Bw.apply(a,o)+(b?" "+b:"");let E=e;return e[0]&&(E=v.as||e,delete v.as),mP&&E[0]&&mP(v),JX(E,v)}return d}}var Vxe=e=>typeof e=="function",mS=(e,n)=>Vxe(e)?e(n):e,Bxe=(()=>{let e=0;return()=>(++e).toString()})(),QX=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");e=!n||n.matches}return e}})(),Gxe=20,t2="default",ZX=(e,n)=>{let{toastLimit:a}=e.settings;switch(n.type){case 0:return{...e,toasts:[n.toast,...e.toasts].slice(0,a)};case 1:return{...e,toasts:e.toasts.map(f=>f.id===n.toast.id?{...f,...n.toast}:f)};case 2:let{toast:o}=n;return ZX(e,{type:e.toasts.find(f=>f.id===o.id)?1:0,toast:o});case 3:let{toastId:d}=n;return{...e,toasts:e.toasts.map(f=>f.id===d||d===void 0?{...f,dismissed:!0,visible:!1}:f)};case 4:return n.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(f=>f.id!==n.toastId)};case 5:return{...e,pausedAt:n.time};case 6:let p=n.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(f=>({...f,pauseDuration:f.pauseDuration+p}))}}},Lx=[],eJ={toasts:[],pausedAt:void 0,settings:{toastLimit:Gxe}},Uc={},tJ=(e,n=t2)=>{Uc[n]=ZX(Uc[n]||eJ,e),Lx.forEach(([a,o])=>{a===n&&o(Uc[n])})},nJ=e=>Object.keys(Uc).forEach(n=>tJ(e,n)),Wxe=e=>Object.keys(Uc).find(n=>Uc[n].toasts.some(a=>a.id===e)),Gw=(e=t2)=>n=>{tJ(n,e)},$xe={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Hxe=(e={},n=t2)=>{let[a,o]=q.useState(Uc[n]||eJ),d=q.useRef(Uc[n]);q.useEffect(()=>(d.current!==Uc[n]&&o(Uc[n]),Lx.push([n,o]),()=>{let f=Lx.findIndex(([v])=>v===n);f>-1&&Lx.splice(f,1)}),[n]);let p=a.toasts.map(f=>{var v,b,E;return{...e,...e[f.type],...f,removeDelay:f.removeDelay||((v=e[f.type])==null?void 0:v.removeDelay)||(e==null?void 0:e.removeDelay),duration:f.duration||((b=e[f.type])==null?void 0:b.duration)||(e==null?void 0:e.duration)||$xe[f.type],style:{...e.style,...(E=e[f.type])==null?void 0:E.style,...f.style}}});return{...a,toasts:p}},zxe=(e,n="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...a,id:(a==null?void 0:a.id)||Bxe()}),R0=e=>(n,a)=>{let o=zxe(n,e,a);return Gw(o.toasterId||Wxe(o.id))({type:2,toast:o}),o.id},yi=(e,n)=>R0("blank")(e,n);yi.error=R0("error");yi.success=R0("success");yi.loading=R0("loading");yi.custom=R0("custom");yi.dismiss=(e,n)=>{let a={type:3,toastId:e};n?Gw(n)(a):nJ(a)};yi.dismissAll=e=>yi.dismiss(void 0,e);yi.remove=(e,n)=>{let a={type:4,toastId:e};n?Gw(n)(a):nJ(a)};yi.removeAll=e=>yi.remove(void 0,e);yi.promise=(e,n,a)=>{let o=yi.loading(n.loading,{...a,...a==null?void 0:a.loading});return typeof e=="function"&&(e=e()),e.then(d=>{let p=n.success?mS(n.success,d):void 0;return p?yi.success(p,{id:o,...a,...a==null?void 0:a.success}):yi.dismiss(o),d}).catch(d=>{let p=n.error?mS(n.error,d):void 0;p?yi.error(p,{id:o,...a,...a==null?void 0:a.error}):yi.dismiss(o)}),e};var Kxe=1e3,Yxe=(e,n="default")=>{let{toasts:a,pausedAt:o}=Hxe(e,n),d=q.useRef(new Map).current,p=q.useCallback((w,N=Kxe)=>{if(d.has(w))return;let P=setTimeout(()=>{d.delete(w),f({type:4,toastId:w})},N);d.set(w,P)},[]);q.useEffect(()=>{if(o)return;let w=Date.now(),N=a.map(P=>{if(P.duration===1/0)return;let A=(P.duration||0)+P.pauseDuration-(w-P.createdAt);if(A<0){P.visible&&yi.dismiss(P.id);return}return setTimeout(()=>yi.dismiss(P.id,n),A)});return()=>{N.forEach(P=>P&&clearTimeout(P))}},[a,o,n]);let f=q.useCallback(Gw(n),[n]),v=q.useCallback(()=>{f({type:5,time:Date.now()})},[f]),b=q.useCallback((w,N)=>{f({type:1,toast:{id:w,height:N}})},[f]),E=q.useCallback(()=>{o&&f({type:6,time:Date.now()})},[o,f]),T=q.useCallback((w,N)=>{let{reverseOrder:P=!1,gutter:A=8,defaultPosition:k}=N||{},I=a.filter(V=>(V.position||k)===(w.position||k)&&V.height),F=I.findIndex(V=>V.id===w.id),U=I.filter((V,W)=>W<F&&V.visible).length;return I.filter(V=>V.visible).slice(...P?[U+1]:[0,U]).reduce((V,W)=>V+(W.height||0)+A,0)},[a]);return q.useEffect(()=>{a.forEach(w=>{if(w.dismissed)p(w.id,w.removeDelay);else{let N=d.get(w.id);N&&(clearTimeout(N),d.delete(w.id))}})},[a,p]),{toasts:a,handlers:{updateHeight:b,startPause:v,endPause:E,calculateOffset:T}}},qxe=Pl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Xxe=Pl`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Jxe=Pl`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Qxe=ru("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${qxe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Xxe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Jxe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Zxe=Pl`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,eSe=ru("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${Zxe} 1s linear infinite;
`,tSe=Pl`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,nSe=Pl`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,rSe=ru("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${tSe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${nSe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,iSe=ru("div")`
  position: absolute;
`,aSe=ru("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,sSe=Pl`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,oSe=ru("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${sSe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,cSe=({toast:e})=>{let{icon:n,type:a,iconTheme:o}=e;return n!==void 0?typeof n=="string"?q.createElement(oSe,null,n):n:a==="blank"?null:q.createElement(aSe,null,q.createElement(eSe,{...o}),a!=="loading"&&q.createElement(iSe,null,a==="error"?q.createElement(Qxe,{...o}):q.createElement(rSe,{...o})))},lSe=e=>`
0% {transform: translate3d(0,${e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,dSe=e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${e*-150}%,-1px) scale(.6); opacity:0;}
`,uSe="0%{opacity:0;} 100%{opacity:1;}",hSe="0%{opacity:1;} 100%{opacity:0;}",pSe=ru("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,mSe=ru("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,fSe=(e,n)=>{let a=e.includes("top")?1:-1,[o,d]=QX()?[uSe,hSe]:[lSe(a),dSe(a)];return{animation:n?`${Pl(o)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Pl(d)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},gSe=q.memo(({toast:e,position:n,style:a,children:o})=>{let d=e.height?fSe(e.position||n||"top-center",e.visible):{opacity:0},p=q.createElement(cSe,{toast:e}),f=q.createElement(mSe,{...e.ariaProps},mS(e.message,e));return q.createElement(pSe,{className:e.className,style:{...d,...a,...e.style}},typeof o=="function"?o({icon:p,message:f}):q.createElement(q.Fragment,null,p,f))});Fxe(q.createElement);var vSe=({id:e,className:n,style:a,onHeightUpdate:o,children:d})=>{let p=q.useCallback(f=>{if(f){let v=()=>{let b=f.getBoundingClientRect().height;o(e,b)};v(),new MutationObserver(v).observe(f,{subtree:!0,childList:!0,characterData:!0})}},[e,o]);return q.createElement("div",{ref:p,className:n,style:a},d)},ySe=(e,n)=>{let a=e.includes("top"),o=a?{top:0}:{bottom:0},d=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:QX()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${n*(a?1:-1)}px)`,...o,...d}},_Se=Bw`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,sx=16,bSe=({reverseOrder:e,position:n="top-center",toastOptions:a,gutter:o,children:d,toasterId:p,containerStyle:f,containerClassName:v})=>{let{toasts:b,handlers:E}=Yxe(a,p);return q.createElement("div",{"data-rht-toaster":p||"",style:{position:"fixed",zIndex:9999,top:sx,left:sx,right:sx,bottom:sx,pointerEvents:"none",...f},className:v,onMouseEnter:E.startPause,onMouseLeave:E.endPause},b.map(T=>{let w=T.position||n,N=E.calculateOffset(T,{reverseOrder:e,gutter:o,defaultPosition:n}),P=ySe(w,N);return q.createElement(vSe,{id:T.id,key:T.id,onHeightUpdate:E.updateHeight,className:T.visible?_Se:"",style:P},T.type==="custom"?mS(T.message,T):d?d(T):q.createElement(gSe,{toast:T,position:w}))}))},it=yi;function rJ(e,n){return function(){return e.apply(n,arguments)}}const{toString:ESe}=Object.prototype,{getPrototypeOf:n2}=Object,{iterator:Ww,toStringTag:iJ}=Symbol,$w=(e=>n=>{const a=ESe.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),ac=e=>(e=e.toLowerCase(),n=>$w(n)===e),Hw=e=>n=>typeof n===e,{isArray:Uf}=Array,sf=Hw("undefined");function A0(e){return e!==null&&!sf(e)&&e.constructor!==null&&!sf(e.constructor)&&ns(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const aJ=ac("ArrayBuffer");function xSe(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&aJ(e.buffer),n}const SSe=Hw("string"),ns=Hw("function"),sJ=Hw("number"),I0=e=>e!==null&&typeof e=="object",wSe=e=>e===!0||e===!1,Mx=e=>{if($w(e)!=="object")return!1;const n=n2(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(iJ in e)&&!(Ww in e)},TSe=e=>{if(!I0(e)||A0(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},CSe=ac("Date"),NSe=ac("File"),RSe=ac("Blob"),ASe=ac("FileList"),ISe=e=>I0(e)&&ns(e.pipe),OSe=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||ns(e.append)&&((n=$w(e))==="formdata"||n==="object"&&ns(e.toString)&&e.toString()==="[object FormData]"))},PSe=ac("URLSearchParams"),[DSe,kSe,jSe,LSe]=["ReadableStream","Request","Response","Headers"].map(ac),MSe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function O0(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let o,d;if(typeof e!="object"&&(e=[e]),Uf(e))for(o=0,d=e.length;o<d;o++)n.call(null,e[o],o,e);else{if(A0(e))return;const p=a?Object.getOwnPropertyNames(e):Object.keys(e),f=p.length;let v;for(o=0;o<f;o++)v=p[o],n.call(null,e[v],v,e)}}function oJ(e,n){if(A0(e))return null;n=n.toLowerCase();const a=Object.keys(e);let o=a.length,d;for(;o-- >0;)if(d=a[o],n===d.toLowerCase())return d;return null}const vh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,cJ=e=>!sf(e)&&e!==vh;function fP(){const{caseless:e,skipUndefined:n}=cJ(this)&&this||{},a={},o=(d,p)=>{const f=e&&oJ(a,p)||p;Mx(a[f])&&Mx(d)?a[f]=fP(a[f],d):Mx(d)?a[f]=fP({},d):Uf(d)?a[f]=d.slice():(!n||!sf(d))&&(a[f]=d)};for(let d=0,p=arguments.length;d<p;d++)arguments[d]&&O0(arguments[d],o);return a}const USe=(e,n,a,{allOwnKeys:o}={})=>(O0(n,(d,p)=>{a&&ns(d)?e[p]=rJ(d,a):e[p]=d},{allOwnKeys:o}),e),FSe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),VSe=(e,n,a,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},BSe=(e,n,a,o)=>{let d,p,f;const v={};if(n=n||{},e==null)return n;do{for(d=Object.getOwnPropertyNames(e),p=d.length;p-- >0;)f=d[p],(!o||o(f,e,n))&&!v[f]&&(n[f]=e[f],v[f]=!0);e=a!==!1&&n2(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},GSe=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const o=e.indexOf(n,a);return o!==-1&&o===a},WSe=e=>{if(!e)return null;if(Uf(e))return e;let n=e.length;if(!sJ(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},$Se=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&n2(Uint8Array)),HSe=(e,n)=>{const o=(e&&e[Ww]).call(e);let d;for(;(d=o.next())&&!d.done;){const p=d.value;n.call(e,p[0],p[1])}},zSe=(e,n)=>{let a;const o=[];for(;(a=e.exec(n))!==null;)o.push(a);return o},KSe=ac("HTMLFormElement"),YSe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,o,d){return o.toUpperCase()+d}),i7=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),qSe=ac("RegExp"),lJ=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),o={};O0(a,(d,p)=>{let f;(f=n(d,p,e))!==!1&&(o[p]=f||d)}),Object.defineProperties(e,o)},XSe=e=>{lJ(e,(n,a)=>{if(ns(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const o=e[a];if(ns(o)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},JSe=(e,n)=>{const a={},o=d=>{d.forEach(p=>{a[p]=!0})};return Uf(e)?o(e):o(String(e).split(n)),a},QSe=()=>{},ZSe=(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n;function ewe(e){return!!(e&&ns(e.append)&&e[iJ]==="FormData"&&e[Ww])}const twe=e=>{const n=new Array(10),a=(o,d)=>{if(I0(o)){if(n.indexOf(o)>=0)return;if(A0(o))return o;if(!("toJSON"in o)){n[d]=o;const p=Uf(o)?[]:{};return O0(o,(f,v)=>{const b=a(f,d+1);!sf(b)&&(p[v]=b)}),n[d]=void 0,p}}return o};return a(e,0)},nwe=ac("AsyncFunction"),rwe=e=>e&&(I0(e)||ns(e))&&ns(e.then)&&ns(e.catch),dJ=((e,n)=>e?setImmediate:n?((a,o)=>(vh.addEventListener("message",({source:d,data:p})=>{d===vh&&p===a&&o.length&&o.shift()()},!1),d=>{o.push(d),vh.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",ns(vh.postMessage)),iwe=typeof queueMicrotask<"u"?queueMicrotask.bind(vh):typeof process<"u"&&process.nextTick||dJ,awe=e=>e!=null&&ns(e[Ww]),Me={isArray:Uf,isArrayBuffer:aJ,isBuffer:A0,isFormData:OSe,isArrayBufferView:xSe,isString:SSe,isNumber:sJ,isBoolean:wSe,isObject:I0,isPlainObject:Mx,isEmptyObject:TSe,isReadableStream:DSe,isRequest:kSe,isResponse:jSe,isHeaders:LSe,isUndefined:sf,isDate:CSe,isFile:NSe,isBlob:RSe,isRegExp:qSe,isFunction:ns,isStream:ISe,isURLSearchParams:PSe,isTypedArray:$Se,isFileList:ASe,forEach:O0,merge:fP,extend:USe,trim:MSe,stripBOM:FSe,inherits:VSe,toFlatObject:BSe,kindOf:$w,kindOfTest:ac,endsWith:GSe,toArray:WSe,forEachEntry:HSe,matchAll:zSe,isHTMLForm:KSe,hasOwnProperty:i7,hasOwnProp:i7,reduceDescriptors:lJ,freezeMethods:XSe,toObjectSet:JSe,toCamelCase:YSe,noop:QSe,toFiniteNumber:ZSe,findKey:oJ,global:vh,isContextDefined:cJ,isSpecCompliantForm:ewe,toJSONObject:twe,isAsyncFn:nwe,isThenable:rwe,setImmediate:dJ,asap:iwe,isIterable:awe};function mn(e,n,a,o,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),o&&(this.request=o),d&&(this.response=d,this.status=d.status?d.status:null)}Me.inherits(mn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Me.toJSONObject(this.config),code:this.code,status:this.status}}});const uJ=mn.prototype,hJ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{hJ[e]={value:e}});Object.defineProperties(mn,hJ);Object.defineProperty(uJ,"isAxiosError",{value:!0});mn.from=(e,n,a,o,d,p)=>{const f=Object.create(uJ);Me.toFlatObject(e,f,function(T){return T!==Error.prototype},E=>E!=="isAxiosError");const v=e&&e.message?e.message:"Error",b=n==null&&e?e.code:n;return mn.call(f,v,b,a,o,d),e&&f.cause==null&&Object.defineProperty(f,"cause",{value:e,configurable:!0}),f.name=e&&e.name||"Error",p&&Object.assign(f,p),f};const swe=null;function gP(e){return Me.isPlainObject(e)||Me.isArray(e)}function pJ(e){return Me.endsWith(e,"[]")?e.slice(0,-2):e}function a7(e,n,a){return e?e.concat(n).map(function(d,p){return d=pJ(d),!a&&p?"["+d+"]":d}).join(a?".":""):n}function owe(e){return Me.isArray(e)&&!e.some(gP)}const cwe=Me.toFlatObject(Me,{},null,function(n){return/^is[A-Z]/.test(n)});function zw(e,n,a){if(!Me.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=Me.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,I){return!Me.isUndefined(I[k])});const o=a.metaTokens,d=a.visitor||T,p=a.dots,f=a.indexes,b=(a.Blob||typeof Blob<"u"&&Blob)&&Me.isSpecCompliantForm(n);if(!Me.isFunction(d))throw new TypeError("visitor must be a function");function E(A){if(A===null)return"";if(Me.isDate(A))return A.toISOString();if(Me.isBoolean(A))return A.toString();if(!b&&Me.isBlob(A))throw new mn("Blob is not supported. Use a Buffer instead.");return Me.isArrayBuffer(A)||Me.isTypedArray(A)?b&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function T(A,k,I){let F=A;if(A&&!I&&typeof A=="object"){if(Me.endsWith(k,"{}"))k=o?k:k.slice(0,-2),A=JSON.stringify(A);else if(Me.isArray(A)&&owe(A)||(Me.isFileList(A)||Me.endsWith(k,"[]"))&&(F=Me.toArray(A)))return k=pJ(k),F.forEach(function(V,W){!(Me.isUndefined(V)||V===null)&&n.append(f===!0?a7([k],W,p):f===null?k:k+"[]",E(V))}),!1}return gP(A)?!0:(n.append(a7(I,k,p),E(A)),!1)}const w=[],N=Object.assign(cwe,{defaultVisitor:T,convertValue:E,isVisitable:gP});function P(A,k){if(!Me.isUndefined(A)){if(w.indexOf(A)!==-1)throw Error("Circular reference detected in "+k.join("."));w.push(A),Me.forEach(A,function(F,U){(!(Me.isUndefined(F)||F===null)&&d.call(n,F,Me.isString(U)?U.trim():U,k,N))===!0&&P(F,k?k.concat(U):[U])}),w.pop()}}if(!Me.isObject(e))throw new TypeError("data must be an object");return P(e),n}function s7(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return n[o]})}function r2(e,n){this._pairs=[],e&&zw(e,this,n)}const mJ=r2.prototype;mJ.append=function(n,a){this._pairs.push([n,a])};mJ.toString=function(n){const a=n?function(o){return n.call(this,o,s7)}:s7;return this._pairs.map(function(d){return a(d[0])+"="+a(d[1])},"").join("&")};function lwe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function fJ(e,n,a){if(!n)return e;const o=a&&a.encode||lwe;Me.isFunction(a)&&(a={serialize:a});const d=a&&a.serialize;let p;if(d?p=d(n,a):p=Me.isURLSearchParams(n)?n.toString():new r2(n,a).toString(o),p){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+p}return e}class o7{constructor(){this.handlers=[]}use(n,a,o){return this.handlers.push({fulfilled:n,rejected:a,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Me.forEach(this.handlers,function(o){o!==null&&n(o)})}}const gJ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},dwe=typeof URLSearchParams<"u"?URLSearchParams:r2,uwe=typeof FormData<"u"?FormData:null,hwe=typeof Blob<"u"?Blob:null,pwe={isBrowser:!0,classes:{URLSearchParams:dwe,FormData:uwe,Blob:hwe},protocols:["http","https","file","blob","url","data"]},i2=typeof window<"u"&&typeof document<"u",vP=typeof navigator=="object"&&navigator||void 0,mwe=i2&&(!vP||["ReactNative","NativeScript","NS"].indexOf(vP.product)<0),fwe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gwe=i2&&window.location.href||"http://localhost",vwe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:i2,hasStandardBrowserEnv:mwe,hasStandardBrowserWebWorkerEnv:fwe,navigator:vP,origin:gwe},Symbol.toStringTag,{value:"Module"})),ha={...vwe,...pwe};function ywe(e,n){return zw(e,new ha.classes.URLSearchParams,{visitor:function(a,o,d,p){return ha.isNode&&Me.isBuffer(a)?(this.append(o,a.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)},...n})}function _we(e){return Me.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function bwe(e){const n={},a=Object.keys(e);let o;const d=a.length;let p;for(o=0;o<d;o++)p=a[o],n[p]=e[p];return n}function vJ(e){function n(a,o,d,p){let f=a[p++];if(f==="__proto__")return!0;const v=Number.isFinite(+f),b=p>=a.length;return f=!f&&Me.isArray(d)?d.length:f,b?(Me.hasOwnProp(d,f)?d[f]=[d[f],o]:d[f]=o,!v):((!d[f]||!Me.isObject(d[f]))&&(d[f]=[]),n(a,o,d[f],p)&&Me.isArray(d[f])&&(d[f]=bwe(d[f])),!v)}if(Me.isFormData(e)&&Me.isFunction(e.entries)){const a={};return Me.forEachEntry(e,(o,d)=>{n(_we(o),d,a,0)}),a}return null}function Ewe(e,n,a){if(Me.isString(e))try{return(n||JSON.parse)(e),Me.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(a||JSON.stringify)(e)}const P0={transitional:gJ,adapter:["xhr","http","fetch"],transformRequest:[function(n,a){const o=a.getContentType()||"",d=o.indexOf("application/json")>-1,p=Me.isObject(n);if(p&&Me.isHTMLForm(n)&&(n=new FormData(n)),Me.isFormData(n))return d?JSON.stringify(vJ(n)):n;if(Me.isArrayBuffer(n)||Me.isBuffer(n)||Me.isStream(n)||Me.isFile(n)||Me.isBlob(n)||Me.isReadableStream(n))return n;if(Me.isArrayBufferView(n))return n.buffer;if(Me.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let v;if(p){if(o.indexOf("application/x-www-form-urlencoded")>-1)return ywe(n,this.formSerializer).toString();if((v=Me.isFileList(n))||o.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return zw(v?{"files[]":n}:n,b&&new b,this.formSerializer)}}return p||d?(a.setContentType("application/json",!1),Ewe(n)):n}],transformResponse:[function(n){const a=this.transitional||P0.transitional,o=a&&a.forcedJSONParsing,d=this.responseType==="json";if(Me.isResponse(n)||Me.isReadableStream(n))return n;if(n&&Me.isString(n)&&(o&&!this.responseType||d)){const f=!(a&&a.silentJSONParsing)&&d;try{return JSON.parse(n,this.parseReviver)}catch(v){if(f)throw v.name==="SyntaxError"?mn.from(v,mn.ERR_BAD_RESPONSE,this,null,this.response):v}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ha.classes.FormData,Blob:ha.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Me.forEach(["delete","get","head","post","put","patch"],e=>{P0.headers[e]={}});const xwe=Me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Swe=e=>{const n={};let a,o,d;return e&&e.split(`
`).forEach(function(f){d=f.indexOf(":"),a=f.substring(0,d).trim().toLowerCase(),o=f.substring(d+1).trim(),!(!a||n[a]&&xwe[a])&&(a==="set-cookie"?n[a]?n[a].push(o):n[a]=[o]:n[a]=n[a]?n[a]+", "+o:o)}),n},c7=Symbol("internals");function Fv(e){return e&&String(e).trim().toLowerCase()}function Ux(e){return e===!1||e==null?e:Me.isArray(e)?e.map(Ux):String(e)}function wwe(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=a.exec(e);)n[o[1]]=o[2];return n}const Twe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function DO(e,n,a,o,d){if(Me.isFunction(o))return o.call(this,n,a);if(d&&(n=a),!!Me.isString(n)){if(Me.isString(o))return n.indexOf(o)!==-1;if(Me.isRegExp(o))return o.test(n)}}function Cwe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,o)=>a.toUpperCase()+o)}function Nwe(e,n){const a=Me.toCamelCase(" "+n);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+a,{value:function(d,p,f){return this[o].call(this,n,d,p,f)},configurable:!0})})}let rs=class{constructor(n){n&&this.set(n)}set(n,a,o){const d=this;function p(v,b,E){const T=Fv(b);if(!T)throw new Error("header name must be a non-empty string");const w=Me.findKey(d,T);(!w||d[w]===void 0||E===!0||E===void 0&&d[w]!==!1)&&(d[w||b]=Ux(v))}const f=(v,b)=>Me.forEach(v,(E,T)=>p(E,T,b));if(Me.isPlainObject(n)||n instanceof this.constructor)f(n,a);else if(Me.isString(n)&&(n=n.trim())&&!Twe(n))f(Swe(n),a);else if(Me.isObject(n)&&Me.isIterable(n)){let v={},b,E;for(const T of n){if(!Me.isArray(T))throw TypeError("Object iterator must return a key-value pair");v[E=T[0]]=(b=v[E])?Me.isArray(b)?[...b,T[1]]:[b,T[1]]:T[1]}f(v,a)}else n!=null&&p(a,n,o);return this}get(n,a){if(n=Fv(n),n){const o=Me.findKey(this,n);if(o){const d=this[o];if(!a)return d;if(a===!0)return wwe(d);if(Me.isFunction(a))return a.call(this,d,o);if(Me.isRegExp(a))return a.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=Fv(n),n){const o=Me.findKey(this,n);return!!(o&&this[o]!==void 0&&(!a||DO(this,this[o],o,a)))}return!1}delete(n,a){const o=this;let d=!1;function p(f){if(f=Fv(f),f){const v=Me.findKey(o,f);v&&(!a||DO(o,o[v],v,a))&&(delete o[v],d=!0)}}return Me.isArray(n)?n.forEach(p):p(n),d}clear(n){const a=Object.keys(this);let o=a.length,d=!1;for(;o--;){const p=a[o];(!n||DO(this,this[p],p,n,!0))&&(delete this[p],d=!0)}return d}normalize(n){const a=this,o={};return Me.forEach(this,(d,p)=>{const f=Me.findKey(o,p);if(f){a[f]=Ux(d),delete a[p];return}const v=n?Cwe(p):String(p).trim();v!==p&&delete a[p],a[v]=Ux(d),o[v]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return Me.forEach(this,(o,d)=>{o!=null&&o!==!1&&(a[d]=n&&Me.isArray(o)?o.join(", "):o)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const o=new this(n);return a.forEach(d=>o.set(d)),o}static accessor(n){const o=(this[c7]=this[c7]={accessors:{}}).accessors,d=this.prototype;function p(f){const v=Fv(f);o[v]||(Nwe(d,f),o[v]=!0)}return Me.isArray(n)?n.forEach(p):p(n),this}};rs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Me.reduceDescriptors(rs.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(o){this[a]=o}}});Me.freezeMethods(rs);function kO(e,n){const a=this||P0,o=n||a,d=rs.from(o.headers);let p=o.data;return Me.forEach(e,function(v){p=v.call(a,p,d.normalize(),n?n.status:void 0)}),d.normalize(),p}function yJ(e){return!!(e&&e.__CANCEL__)}function Ff(e,n,a){mn.call(this,e??"canceled",mn.ERR_CANCELED,n,a),this.name="CanceledError"}Me.inherits(Ff,mn,{__CANCEL__:!0});function _J(e,n,a){const o=a.config.validateStatus;!a.status||!o||o(a.status)?e(a):n(new mn("Request failed with status code "+a.status,[mn.ERR_BAD_REQUEST,mn.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function Rwe(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Awe(e,n){e=e||10;const a=new Array(e),o=new Array(e);let d=0,p=0,f;return n=n!==void 0?n:1e3,function(b){const E=Date.now(),T=o[p];f||(f=E),a[d]=b,o[d]=E;let w=p,N=0;for(;w!==d;)N+=a[w++],w=w%e;if(d=(d+1)%e,d===p&&(p=(p+1)%e),E-f<n)return;const P=T&&E-T;return P?Math.round(N*1e3/P):void 0}}function Iwe(e,n){let a=0,o=1e3/n,d,p;const f=(E,T=Date.now())=>{a=T,d=null,p&&(clearTimeout(p),p=null),e(...E)};return[(...E)=>{const T=Date.now(),w=T-a;w>=o?f(E,T):(d=E,p||(p=setTimeout(()=>{p=null,f(d)},o-w)))},()=>d&&f(d)]}const fS=(e,n,a=3)=>{let o=0;const d=Awe(50,250);return Iwe(p=>{const f=p.loaded,v=p.lengthComputable?p.total:void 0,b=f-o,E=d(b),T=f<=v;o=f;const w={loaded:f,total:v,progress:v?f/v:void 0,bytes:b,rate:E||void 0,estimated:E&&v&&T?(v-f)/E:void 0,event:p,lengthComputable:v!=null,[n?"download":"upload"]:!0};e(w)},a)},l7=(e,n)=>{const a=e!=null;return[o=>n[0]({lengthComputable:a,total:e,loaded:o}),n[1]]},d7=e=>(...n)=>Me.asap(()=>e(...n)),Owe=ha.hasStandardBrowserEnv?((e,n)=>a=>(a=new URL(a,ha.origin),e.protocol===a.protocol&&e.host===a.host&&(n||e.port===a.port)))(new URL(ha.origin),ha.navigator&&/(msie|trident)/i.test(ha.navigator.userAgent)):()=>!0,Pwe=ha.hasStandardBrowserEnv?{write(e,n,a,o,d,p,f){if(typeof document>"u")return;const v=[`${e}=${encodeURIComponent(n)}`];Me.isNumber(a)&&v.push(`expires=${new Date(a).toUTCString()}`),Me.isString(o)&&v.push(`path=${o}`),Me.isString(d)&&v.push(`domain=${d}`),p===!0&&v.push("secure"),Me.isString(f)&&v.push(`SameSite=${f}`),document.cookie=v.join("; ")},read(e){if(typeof document>"u")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Dwe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function kwe(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function bJ(e,n,a){let o=!Dwe(n);return e&&(o||a==!1)?kwe(e,n):n}const u7=e=>e instanceof rs?{...e}:e;function jh(e,n){n=n||{};const a={};function o(E,T,w,N){return Me.isPlainObject(E)&&Me.isPlainObject(T)?Me.merge.call({caseless:N},E,T):Me.isPlainObject(T)?Me.merge({},T):Me.isArray(T)?T.slice():T}function d(E,T,w,N){if(Me.isUndefined(T)){if(!Me.isUndefined(E))return o(void 0,E,w,N)}else return o(E,T,w,N)}function p(E,T){if(!Me.isUndefined(T))return o(void 0,T)}function f(E,T){if(Me.isUndefined(T)){if(!Me.isUndefined(E))return o(void 0,E)}else return o(void 0,T)}function v(E,T,w){if(w in n)return o(E,T);if(w in e)return o(void 0,E)}const b={url:p,method:p,data:p,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:v,headers:(E,T,w)=>d(u7(E),u7(T),w,!0)};return Me.forEach(Object.keys({...e,...n}),function(T){const w=b[T]||d,N=w(e[T],n[T],T);Me.isUndefined(N)&&w!==v||(a[T]=N)}),a}const EJ=e=>{const n=jh({},e);let{data:a,withXSRFToken:o,xsrfHeaderName:d,xsrfCookieName:p,headers:f,auth:v}=n;if(n.headers=f=rs.from(f),n.url=fJ(bJ(n.baseURL,n.url,n.allowAbsoluteUrls),e.params,e.paramsSerializer),v&&f.set("Authorization","Basic "+btoa((v.username||"")+":"+(v.password?unescape(encodeURIComponent(v.password)):""))),Me.isFormData(a)){if(ha.hasStandardBrowserEnv||ha.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(Me.isFunction(a.getHeaders)){const b=a.getHeaders(),E=["content-type","content-length"];Object.entries(b).forEach(([T,w])=>{E.includes(T.toLowerCase())&&f.set(T,w)})}}if(ha.hasStandardBrowserEnv&&(o&&Me.isFunction(o)&&(o=o(n)),o||o!==!1&&Owe(n.url))){const b=d&&p&&Pwe.read(p);b&&f.set(d,b)}return n},jwe=typeof XMLHttpRequest<"u",Lwe=jwe&&function(e){return new Promise(function(a,o){const d=EJ(e);let p=d.data;const f=rs.from(d.headers).normalize();let{responseType:v,onUploadProgress:b,onDownloadProgress:E}=d,T,w,N,P,A;function k(){P&&P(),A&&A(),d.cancelToken&&d.cancelToken.unsubscribe(T),d.signal&&d.signal.removeEventListener("abort",T)}let I=new XMLHttpRequest;I.open(d.method.toUpperCase(),d.url,!0),I.timeout=d.timeout;function F(){if(!I)return;const V=rs.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders()),B={data:!v||v==="text"||v==="json"?I.responseText:I.response,status:I.status,statusText:I.statusText,headers:V,config:e,request:I};_J(function(Y){a(Y),k()},function(Y){o(Y),k()},B),I=null}"onloadend"in I?I.onloadend=F:I.onreadystatechange=function(){!I||I.readyState!==4||I.status===0&&!(I.responseURL&&I.responseURL.indexOf("file:")===0)||setTimeout(F)},I.onabort=function(){I&&(o(new mn("Request aborted",mn.ECONNABORTED,e,I)),I=null)},I.onerror=function(W){const B=W&&W.message?W.message:"Network Error",z=new mn(B,mn.ERR_NETWORK,e,I);z.event=W||null,o(z),I=null},I.ontimeout=function(){let W=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const B=d.transitional||gJ;d.timeoutErrorMessage&&(W=d.timeoutErrorMessage),o(new mn(W,B.clarifyTimeoutError?mn.ETIMEDOUT:mn.ECONNABORTED,e,I)),I=null},p===void 0&&f.setContentType(null),"setRequestHeader"in I&&Me.forEach(f.toJSON(),function(W,B){I.setRequestHeader(B,W)}),Me.isUndefined(d.withCredentials)||(I.withCredentials=!!d.withCredentials),v&&v!=="json"&&(I.responseType=d.responseType),E&&([N,A]=fS(E,!0),I.addEventListener("progress",N)),b&&I.upload&&([w,P]=fS(b),I.upload.addEventListener("progress",w),I.upload.addEventListener("loadend",P)),(d.cancelToken||d.signal)&&(T=V=>{I&&(o(!V||V.type?new Ff(null,e,I):V),I.abort(),I=null)},d.cancelToken&&d.cancelToken.subscribe(T),d.signal&&(d.signal.aborted?T():d.signal.addEventListener("abort",T)));const U=Rwe(d.url);if(U&&ha.protocols.indexOf(U)===-1){o(new mn("Unsupported protocol "+U+":",mn.ERR_BAD_REQUEST,e));return}I.send(p||null)})},Mwe=(e,n)=>{const{length:a}=e=e?e.filter(Boolean):[];if(n||a){let o=new AbortController,d;const p=function(E){if(!d){d=!0,v();const T=E instanceof Error?E:this.reason;o.abort(T instanceof mn?T:new Ff(T instanceof Error?T.message:T))}};let f=n&&setTimeout(()=>{f=null,p(new mn(`timeout ${n} of ms exceeded`,mn.ETIMEDOUT))},n);const v=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(p):E.removeEventListener("abort",p)}),e=null)};e.forEach(E=>E.addEventListener("abort",p));const{signal:b}=o;return b.unsubscribe=()=>Me.asap(v),b}},Uwe=function*(e,n){let a=e.byteLength;if(a<n){yield e;return}let o=0,d;for(;o<a;)d=o+n,yield e.slice(o,d),o=d},Fwe=async function*(e,n){for await(const a of Vwe(e))yield*Uwe(a,n)},Vwe=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const n=e.getReader();try{for(;;){const{done:a,value:o}=await n.read();if(a)break;yield o}}finally{await n.cancel()}},h7=(e,n,a,o)=>{const d=Fwe(e,n);let p=0,f,v=b=>{f||(f=!0,o&&o(b))};return new ReadableStream({async pull(b){try{const{done:E,value:T}=await d.next();if(E){v(),b.close();return}let w=T.byteLength;if(a){let N=p+=w;a(N)}b.enqueue(new Uint8Array(T))}catch(E){throw v(E),E}},cancel(b){return v(b),d.return()}},{highWaterMark:2})},p7=64*1024,{isFunction:ox}=Me,Bwe=(({Request:e,Response:n})=>({Request:e,Response:n}))(Me.global),{ReadableStream:m7,TextEncoder:f7}=Me.global,g7=(e,...n)=>{try{return!!e(...n)}catch{return!1}},Gwe=e=>{e=Me.merge.call({skipUndefined:!0},Bwe,e);const{fetch:n,Request:a,Response:o}=e,d=n?ox(n):typeof fetch=="function",p=ox(a),f=ox(o);if(!d)return!1;const v=d&&ox(m7),b=d&&(typeof f7=="function"?(A=>k=>A.encode(k))(new f7):async A=>new Uint8Array(await new a(A).arrayBuffer())),E=p&&v&&g7(()=>{let A=!1;const k=new a(ha.origin,{body:new m7,method:"POST",get duplex(){return A=!0,"half"}}).headers.has("Content-Type");return A&&!k}),T=f&&v&&g7(()=>Me.isReadableStream(new o("").body)),w={stream:T&&(A=>A.body)};d&&["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!w[A]&&(w[A]=(k,I)=>{let F=k&&k[A];if(F)return F.call(k);throw new mn(`Response type '${A}' is not supported`,mn.ERR_NOT_SUPPORT,I)})});const N=async A=>{if(A==null)return 0;if(Me.isBlob(A))return A.size;if(Me.isSpecCompliantForm(A))return(await new a(ha.origin,{method:"POST",body:A}).arrayBuffer()).byteLength;if(Me.isArrayBufferView(A)||Me.isArrayBuffer(A))return A.byteLength;if(Me.isURLSearchParams(A)&&(A=A+""),Me.isString(A))return(await b(A)).byteLength},P=async(A,k)=>{const I=Me.toFiniteNumber(A.getContentLength());return I??N(k)};return async A=>{let{url:k,method:I,data:F,signal:U,cancelToken:V,timeout:W,onDownloadProgress:B,onUploadProgress:z,responseType:Y,headers:re,withCredentials:Z="same-origin",fetchOptions:ie}=EJ(A),te=n||fetch;Y=Y?(Y+"").toLowerCase():"text";let de=Mwe([U,V&&V.toAbortSignal()],W),xe=null;const me=de&&de.unsubscribe&&(()=>{de.unsubscribe()});let Ce;try{if(z&&E&&I!=="get"&&I!=="head"&&(Ce=await P(re,F))!==0){let Se=new a(k,{method:"POST",body:F,duplex:"half"}),we;if(Me.isFormData(F)&&(we=Se.headers.get("content-type"))&&re.setContentType(we),Se.body){const[qe,lt]=l7(Ce,fS(d7(z)));F=h7(Se.body,p7,qe,lt)}}Me.isString(Z)||(Z=Z?"include":"omit");const ue=p&&"credentials"in a.prototype,be={...ie,signal:de,method:I.toUpperCase(),headers:re.normalize().toJSON(),body:F,duplex:"half",credentials:ue?Z:void 0};xe=p&&new a(k,be);let se=await(p?te(xe,ie):te(k,be));const pe=T&&(Y==="stream"||Y==="response");if(T&&(B||pe&&me)){const Se={};["status","statusText","headers"].forEach(Ut=>{Se[Ut]=se[Ut]});const we=Me.toFiniteNumber(se.headers.get("content-length")),[qe,lt]=B&&l7(we,fS(d7(B),!0))||[];se=new o(h7(se.body,p7,qe,()=>{lt&&lt(),me&&me()}),Se)}Y=Y||"text";let De=await w[Me.findKey(w,Y)||"text"](se,A);return!pe&&me&&me(),await new Promise((Se,we)=>{_J(Se,we,{data:De,headers:rs.from(se.headers),status:se.status,statusText:se.statusText,config:A,request:xe})})}catch(ue){throw me&&me(),ue&&ue.name==="TypeError"&&/Load failed|fetch/i.test(ue.message)?Object.assign(new mn("Network Error",mn.ERR_NETWORK,A,xe),{cause:ue.cause||ue}):mn.from(ue,ue&&ue.code,A,xe)}}},Wwe=new Map,xJ=e=>{let n=e&&e.env||{};const{fetch:a,Request:o,Response:d}=n,p=[o,d,a];let f=p.length,v=f,b,E,T=Wwe;for(;v--;)b=p[v],E=T.get(b),E===void 0&&T.set(b,E=v?new Map:Gwe(n)),T=E;return E};xJ();const a2={http:swe,xhr:Lwe,fetch:{get:xJ}};Me.forEach(a2,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const v7=e=>`- ${e}`,$we=e=>Me.isFunction(e)||e===null||e===!1;function Hwe(e,n){e=Me.isArray(e)?e:[e];const{length:a}=e;let o,d;const p={};for(let f=0;f<a;f++){o=e[f];let v;if(d=o,!$we(o)&&(d=a2[(v=String(o)).toLowerCase()],d===void 0))throw new mn(`Unknown adapter '${v}'`);if(d&&(Me.isFunction(d)||(d=d.get(n))))break;p[v||"#"+f]=d}if(!d){const f=Object.entries(p).map(([b,E])=>`adapter ${b} `+(E===!1?"is not supported by the environment":"is not available in the build"));let v=a?f.length>1?`since :
`+f.map(v7).join(`
`):" "+v7(f[0]):"as no adapter specified";throw new mn("There is no suitable adapter to dispatch the request "+v,"ERR_NOT_SUPPORT")}return d}const SJ={getAdapter:Hwe,adapters:a2};function jO(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ff(null,e)}function y7(e){return jO(e),e.headers=rs.from(e.headers),e.data=kO.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),SJ.getAdapter(e.adapter||P0.adapter,e)(e).then(function(o){return jO(e),o.data=kO.call(e,e.transformResponse,o),o.headers=rs.from(o.headers),o},function(o){return yJ(o)||(jO(e),o&&o.response&&(o.response.data=kO.call(e,e.transformResponse,o.response),o.response.headers=rs.from(o.response.headers))),Promise.reject(o)})}const wJ="1.13.2",Kw={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{Kw[e]=function(o){return typeof o===e||"a"+(n<1?"n ":" ")+e}});const _7={};Kw.transitional=function(n,a,o){function d(p,f){return"[Axios v"+wJ+"] Transitional option '"+p+"'"+f+(o?". "+o:"")}return(p,f,v)=>{if(n===!1)throw new mn(d(f," has been removed"+(a?" in "+a:"")),mn.ERR_DEPRECATED);return a&&!_7[f]&&(_7[f]=!0,console.warn(d(f," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(p,f,v):!0}};Kw.spelling=function(n){return(a,o)=>(console.warn(`${o} is likely a misspelling of ${n}`),!0)};function zwe(e,n,a){if(typeof e!="object")throw new mn("options must be an object",mn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let d=o.length;for(;d-- >0;){const p=o[d],f=n[p];if(f){const v=e[p],b=v===void 0||f(v,p,e);if(b!==!0)throw new mn("option "+p+" must be "+b,mn.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new mn("Unknown option "+p,mn.ERR_BAD_OPTION)}}const Fx={assertOptions:zwe,validators:Kw},Dc=Fx.validators;let Ch=class{constructor(n){this.defaults=n||{},this.interceptors={request:new o7,response:new o7}}async request(n,a){try{return await this._request(n,a)}catch(o){if(o instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const p=d.stack?d.stack.replace(/^.+\n/,""):"";try{o.stack?p&&!String(o.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+p):o.stack=p}catch{}}throw o}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=jh(this.defaults,a);const{transitional:o,paramsSerializer:d,headers:p}=a;o!==void 0&&Fx.assertOptions(o,{silentJSONParsing:Dc.transitional(Dc.boolean),forcedJSONParsing:Dc.transitional(Dc.boolean),clarifyTimeoutError:Dc.transitional(Dc.boolean)},!1),d!=null&&(Me.isFunction(d)?a.paramsSerializer={serialize:d}:Fx.assertOptions(d,{encode:Dc.function,serialize:Dc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),Fx.assertOptions(a,{baseUrl:Dc.spelling("baseURL"),withXsrfToken:Dc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let f=p&&Me.merge(p.common,p[a.method]);p&&Me.forEach(["delete","get","head","post","put","patch","common"],A=>{delete p[A]}),a.headers=rs.concat(f,p);const v=[];let b=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(a)===!1||(b=b&&k.synchronous,v.unshift(k.fulfilled,k.rejected))});const E=[];this.interceptors.response.forEach(function(k){E.push(k.fulfilled,k.rejected)});let T,w=0,N;if(!b){const A=[y7.bind(this),void 0];for(A.unshift(...v),A.push(...E),N=A.length,T=Promise.resolve(a);w<N;)T=T.then(A[w++],A[w++]);return T}N=v.length;let P=a;for(;w<N;){const A=v[w++],k=v[w++];try{P=A(P)}catch(I){k.call(this,I);break}}try{T=y7.call(this,P)}catch(A){return Promise.reject(A)}for(w=0,N=E.length;w<N;)T=T.then(E[w++],E[w++]);return T}getUri(n){n=jh(this.defaults,n);const a=bJ(n.baseURL,n.url,n.allowAbsoluteUrls);return fJ(a,n.params,n.paramsSerializer)}};Me.forEach(["delete","get","head","options"],function(n){Ch.prototype[n]=function(a,o){return this.request(jh(o||{},{method:n,url:a,data:(o||{}).data}))}});Me.forEach(["post","put","patch"],function(n){function a(o){return function(p,f,v){return this.request(jh(v||{},{method:n,headers:o?{"Content-Type":"multipart/form-data"}:{},url:p,data:f}))}}Ch.prototype[n]=a(),Ch.prototype[n+"Form"]=a(!0)});let Kwe=class TJ{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(p){a=p});const o=this;this.promise.then(d=>{if(!o._listeners)return;let p=o._listeners.length;for(;p-- >0;)o._listeners[p](d);o._listeners=null}),this.promise.then=d=>{let p;const f=new Promise(v=>{o.subscribe(v),p=v}).then(d);return f.cancel=function(){o.unsubscribe(p)},f},n(function(p,f,v){o.reason||(o.reason=new Ff(p,f,v),a(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const n=new AbortController,a=o=>{n.abort(o)};return this.subscribe(a),n.signal.unsubscribe=()=>this.unsubscribe(a),n.signal}static source(){let n;return{token:new TJ(function(d){n=d}),cancel:n}}};function Ywe(e){return function(a){return e.apply(null,a)}}function qwe(e){return Me.isObject(e)&&e.isAxiosError===!0}const yP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(yP).forEach(([e,n])=>{yP[n]=e});function CJ(e){const n=new Ch(e),a=rJ(Ch.prototype.request,n);return Me.extend(a,Ch.prototype,n,{allOwnKeys:!0}),Me.extend(a,n,null,{allOwnKeys:!0}),a.create=function(d){return CJ(jh(e,d))},a}const Mn=CJ(P0);Mn.Axios=Ch;Mn.CanceledError=Ff;Mn.CancelToken=Kwe;Mn.isCancel=yJ;Mn.VERSION=wJ;Mn.toFormData=zw;Mn.AxiosError=mn;Mn.Cancel=Mn.CanceledError;Mn.all=function(n){return Promise.all(n)};Mn.spread=Ywe;Mn.isAxiosError=qwe;Mn.mergeConfig=jh;Mn.AxiosHeaders=rs;Mn.formToJSON=e=>vJ(Me.isHTMLForm(e)?new FormData(e):e);Mn.getAdapter=SJ.getAdapter;Mn.HttpStatusCode=yP;Mn.default=Mn;const{Axios:wKe,AxiosError:TKe,CanceledError:CKe,isCancel:NKe,CancelToken:RKe,VERSION:AKe,all:IKe,Cancel:OKe,isAxiosError:PKe,spread:DKe,toFormData:kKe,AxiosHeaders:jKe,HttpStatusCode:LKe,formToJSON:MKe,getAdapter:UKe,mergeConfig:FKe}=Mn,ut=Mn.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});ut.interceptors.request.use(e=>{const n=localStorage.getItem("token");return n&&(e.headers.Authorization=`Bearer ${n}`),e});ut.interceptors.response.use(e=>e,e=>{var n;return((n=e.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});const Nh={uploadReport:e=>ut.post("/health/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),getReports:()=>ut.get("/health/reports"),getReport:e=>ut.get(`/health/reports/${e}`),getDashboard:()=>ut.get("/health/dashboard"),getHistory:e=>ut.get("/health/history",{params:{reportType:e}}),compareReport:e=>ut.get(`/health/reports/${e}/compare`),chatAboutReport:(e,n,a)=>ut.post(`/health/reports/${e}/chat`,{message:n,chatHistory:a}),askAI:e=>ut.post("/health/ai-chat",e)},Ja={getAll:e=>ut.get("/doctors",{params:e}),getById:e=>ut.get(`/doctors/${e}`),getRecommended:e=>ut.get("/doctors/recommended",{params:{specializations:e}}),bookAppointment:e=>ut.post("/doctors/book",e),getAppointments:()=>ut.get("/doctors/appointments"),getAppointment:e=>ut.get(`/doctors/appointments/${e}`),startConsultation:e=>ut.post(`/doctors/appointments/${e}/start`),endConsultation:e=>ut.post(`/doctors/appointments/${e}/end`),getConsultationSummary:e=>ut.get(`/doctors/appointments/${e}/summary`),submitReview:(e,n)=>ut.post(`/doctors/appointments/${e}/review`,n),downloadPrescription:e=>ut.get(`/doctors/appointments/${e}/prescription`,{responseType:"blob"}),getDashboard:()=>ut.get("/doctors/me/dashboard"),getMyProfile:()=>ut.get("/doctors/me/profile"),updateMyProfile:e=>ut.put("/doctors/me/profile",e),getMyAppointments:e=>ut.get("/doctors/me/appointments",{params:e}),updateAppointmentStatus:(e,n)=>ut.patch(`/doctors/me/appointments/${e}`,n),getPatientProfile:(e,n)=>ut.get(`/doctors/patient/${e}`,{params:{appointmentId:n}}),getDoctorAppointments:(e,n)=>ut.get(`/doctors/${e}/appointments`,{params:{status:n}}),getMyAvailability:()=>ut.get("/doctors/me/availability"),updateMyAvailability:e=>ut.put("/doctors/me/availability",e),generateTimeSlots:()=>ut.post("/doctors/me/generate-slots"),getDoctorAvailableSlots:(e,n)=>ut.get(`/doctors/${e}/available-slots`,{params:{date:n}}),checkSlotAvailability:(e,n,a)=>ut.get(`/doctors/${e}/check-slot`,{params:{date:n,timeSlot:a}})},xm={connectDevice:(e,n)=>ut.post("/wearables/connect",{deviceType:e,deviceName:n}),disconnectDevice:e=>ut.post(`/wearables/disconnect/${e}`),getDevices:()=>ut.get("/wearables/devices"),syncMetrics:(e,n)=>ut.post("/wearables/sync",{deviceType:e,metrics:n}),addHeartRate:(e,n,a)=>ut.post("/wearables/heart-rate",{deviceType:e,bpm:n,type:a}),addSleepData:(e,n)=>ut.post("/wearables/sleep",{deviceType:e,sleepData:n}),getDashboard:()=>ut.get("/wearables/dashboard"),generateDemoData:e=>ut.post("/wearables/demo-data",{deviceType:e})},Vx={getStats:()=>ut.get("/admin/stats"),getUsers:e=>ut.get("/admin/users",{params:e}),getUserDetails:e=>ut.get(`/admin/users/${e}`),updateUserStatus:(e,n)=>ut.patch(`/admin/users/${e}/status`,{isActive:n}),getReports:e=>ut.get("/admin/reports",{params:e}),getDeficiencyRules:()=>ut.get("/admin/deficiency-rules"),createDeficiencyRule:e=>ut.post("/admin/deficiency-rules",e),updateDeficiencyRule:(e,n)=>ut.put(`/admin/deficiency-rules/${e}`,n),deleteDeficiencyRule:e=>ut.delete(`/admin/deficiency-rules/${e}`),getSupplements:()=>ut.get("/admin/supplements"),createSupplement:e=>ut.post("/admin/supplements",e),updateSupplement:(e,n)=>ut.put(`/admin/supplements/${e}`,n),deleteSupplement:e=>ut.delete(`/admin/supplements/${e}`),getDietPlans:e=>ut.get("/admin/diet-plans",{params:e}),createDietPlan:e=>ut.post("/admin/diet-plans",e),updateDietPlan:(e,n)=>ut.put(`/admin/diet-plans/${e}`,n),approveDietPlan:(e,n)=>ut.patch(`/admin/diet-plans/${e}/approve`,{status:n}),deleteDietPlan:e=>ut.delete(`/admin/diet-plans/${e}`),getDoctors:e=>ut.get("/admin/doctors",{params:e}),createDoctor:e=>ut.post("/admin/doctors",e),updateDoctor:(e,n)=>ut.put(`/admin/doctors/${e}`,n),approveDoctor:e=>ut.patch(`/admin/doctors/${e}/approve`),rejectDoctor:(e,n)=>ut.patch(`/admin/doctors/${e}/reject`,{reason:n}),deleteDoctor:e=>ut.delete(`/admin/doctors/${e}`),toggleDoctorVisibility:e=>ut.patch(`/admin/doctors/${e}/visibility`),getDoctorScheduleOverview:e=>ut.get(`/admin/doctors/${e}/schedule-overview`)},Xwe={getSubscription:()=>ut.get("/auth/subscription")},Jwe={analyzeFood:e=>ut.post("/nutrition/analyze-food",{foodDescription:e}),logMeal:e=>ut.post("/nutrition/log-meal",e),getTodayLogs:()=>ut.get("/nutrition/logs/today"),getDailySummary:e=>ut.get("/nutrition/summary/daily",{params:{date:e}}),getGoals:()=>ut.get("/nutrition/goals"),updateGoals:e=>ut.put("/nutrition/goals",e)},NJ=q.createContext(),ma=()=>q.useContext(NJ),Qwe=({children:e})=>{const[n,a]=q.useState(null),[o,d]=q.useState(!0);q.useEffect(()=>{const k=localStorage.getItem("token"),I=localStorage.getItem("user");k&&I&&(a(JSON.parse(I)),ut.defaults.headers.common.Authorization=`Bearer ${k}`),d(!1)},[]);const p=async(k,I)=>{const U=k.includes("@")?{email:k,password:I}:{phone:k,password:I},{data:V}=await ut.post("/auth/login",U);return localStorage.setItem("token",V.token),localStorage.setItem("user",JSON.stringify(V)),ut.defaults.headers.common.Authorization=`Bearer ${V.token}`,a(V),V},f=async(k,I,F,U={},V=null)=>{const{data:W}=await ut.post("/auth/register",{name:k,email:I,password:F,profile:U,nutritionGoal:V});return localStorage.setItem("token",W.token),localStorage.setItem("user",JSON.stringify(W)),ut.defaults.headers.common.Authorization=`Bearer ${W.token}`,a(W),W},v=async k=>{const{data:I}=await ut.post("/auth/register/doctor",k);return localStorage.setItem("token",I.token),localStorage.setItem("user",JSON.stringify(I)),ut.defaults.headers.common.Authorization=`Bearer ${I.token}`,a(I),I},b=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),delete ut.defaults.headers.common.Authorization,a(null)},E=k=>{a(k),localStorage.setItem("user",JSON.stringify(k))},T=()=>(n==null?void 0:n.role)==="admin",w=()=>(n==null?void 0:n.role)==="doctor",N=()=>(n==null?void 0:n.role)==="patient"||(n==null?void 0:n.role)==="client",P=()=>{var k;return((k=n==null?void 0:n.doctorProfile)==null?void 0:k.approvalStatus)==="approved"},A=()=>{var k;return((k=n==null?void 0:n.subscription)==null?void 0:k.status)==="active"};return l.jsx(NJ.Provider,{value:{user:n,login:p,register:f,registerDoctor:v,logout:b,updateUser:E,loading:o,isAdmin:T,isDoctor:w,isPatient:N,isDoctorApproved:P,isSubscribed:A},children:e})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zwe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eTe=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ze=(e,n)=>{const a=q.forwardRef(({color:o="currentColor",size:d=24,strokeWidth:p=2,absoluteStrokeWidth:f,className:v="",children:b,...E},T)=>q.createElement("svg",{ref:T,...Zwe,width:d,height:d,stroke:o,strokeWidth:f?Number(p)*24/Number(d):p,className:["lucide",`lucide-${eTe(e)}`,v].join(" "),...E},[...n.map(([w,N])=>q.createElement(w,N)),...Array.isArray(b)?b:[b]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=Ze("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=Ze("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=Ze("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nc=Ze("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=Ze("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=Ze("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tTe=Ze("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=Ze("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nTe=Ze("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rTe=Ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iTe=Ze("Bone",[["path",{d:"M17 10c.7-.7 1.69 0 2.5 0a2.5 2.5 0 1 0 0-5 .5.5 0 0 1-.5-.5 2.5 2.5 0 1 0-5 0c0 .81.7 1.8 0 2.5l-7 7c-.7.7-1.69 0-2.5 0a2.5 2.5 0 0 0 0 5c.28 0 .5.22.5.5a2.5 2.5 0 1 0 5 0c0-.81-.7-1.8 0-2.5Z",key:"w610uw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aTe=Ze("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=Ze("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sTe=Ze("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ji=Ze("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s2=Ze("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=Ze("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yh=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o2=Ze("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oTe=Ze("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cTe=Ze("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lTe=Ze("Cigarette",[["path",{d:"M18 12H2v4h16",key:"2rt1hm"}],["path",{d:"M22 12v4",key:"142cbu"}],["path",{d:"M7 12v4",key:"jqww69"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ic=Ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dTe=Ze("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uTe=Ze("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hTe=Ze("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AJ=Ze("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _P=Ze("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IJ=Ze("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b7=Ze("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qw=Ze("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=Ze("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OJ=Ze("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xw=Ze("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=Ze("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=Ze("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PJ=Ze("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gS=Ze("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=Ze("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pTe=Ze("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mTe=Ze("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=Ze("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fTe=Ze("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const py=Ze("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gTe=Ze("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const my=Ze("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vTe=Ze("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EP=Ze("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=Ze("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Ze("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xP=Ze("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yTe=Ze("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E7=Ze("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=Ze("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DJ=Ze("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=Ze("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=Ze("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Te=Ze("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Ze("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bTe=Ze("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ETe=Ze("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xTe=Ze("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=Ze("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qw=Ze("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const STe=Ze("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wTe=Ze("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TTe=Ze("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jJ=Ze("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x7=Ze("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fy=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bf=Ze("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gf=Ze("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CTe=Ze("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vS=Ze("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LJ=Ze("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=Ze("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zc=Ze("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MJ=Ze("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UJ=Ze("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=Ze("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SP=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FJ=Ze("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=Ze("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VJ=Ze("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=Ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=Ze("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zd=Ze("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wP=Ze("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=Ze("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NTe=Ze("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RTe=Ze("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=Ze("Watch",[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ATe=Ze("Wine",[["path",{d:"M8 22h8",key:"rmew8v"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M12 15v7",key:"t2xh3l"}],["path",{d:"M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",key:"10ffi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BJ=Ze("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=Ze("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function ITe(){const[e,n]=q.useState(""),[a,o]=q.useState({x:0,y:0}),[d,p]=q.useState(!1),f=Is();q.useEffect(()=>{const b=()=>{const E=window.getSelection(),T=E.toString().trim();if(T.length>0){const N=E.getRangeAt(0).getBoundingClientRect();n(T),o({x:N.left+N.width/2,y:N.top-10}),p(!0)}else p(!1)};return document.addEventListener("mouseup",b),document.addEventListener("touchend",b),()=>{document.removeEventListener("mouseup",b),document.removeEventListener("touchend",b)}},[]);const v=()=>{f("/ai-chat",{state:{selectedText:e}}),p(!1)};return d?l.jsx("div",{className:"fixed z-50 animate-fade-in",style:{left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%)"},children:l.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow-lg hover:shadow-xl transition-all text-sm font-medium",children:[l.jsx(k0,{className:"w-4 h-4"}),"Ask AI"]})}):null}function OTe(){const e=Ul(),n=Is(),{user:a,logout:o}=ma(),[d,p]=q.useState(!1);q.useEffect(()=>{const T=()=>{const P=document.querySelectorAll(".fixed.inset-0");let A=!1;P.forEach(I=>{const F=I.textContent;(F.includes("Add Meal")||F.includes("Edit Meal"))&&(A=!0)}),A=A||d;const k=document.querySelector(".mobile-bottom-nav-container");k&&(A?k.classList.add("hidden"):k.classList.remove("hidden"))};T();const w=setTimeout(T,100),N=new MutationObserver(T);return N.observe(document.body,{childList:!0,subtree:!0}),()=>{clearTimeout(w),N.disconnect()}},[d]);const f=[{path:"/dashboard",icon:Jw,label:"Home"},{path:"/ai-chat",icon:k0,label:"AI"},{path:"/nutrition",icon:zd,label:"Nutrition",isCenter:!0},{path:"/upload",icon:li,label:"Reports"}],v=[{path:"/profile",icon:Gf,label:"Profile"},{path:"/wearables",icon:_l,label:"Wearables",comingSoon:!0},{path:"/diet-plan",icon:Di,label:"Diet Plan"},{path:"#appointment",icon:ji,label:"Appointment",comingSoon:!0}],b=T=>e.pathname===T,E=()=>{o(),it.success("Logged out successfully"),n("/login"),p(!1)};return l.jsxs(l.Fragment,{children:[d&&l.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>p(!1)}),d&&l.jsxs("div",{className:"fixed bottom-24 right-4 bg-white rounded-2xl shadow-2xl z-50 w-56 overflow-hidden animate-fade-in",children:[l.jsx("div",{className:"p-4 border-b border-[#E5DFD3]",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"font-semibold text-[#2C2416]",children:"Menu"}),l.jsx("button",{onClick:()=>p(!1),className:"text-[#5C4F3D] hover:text-[#2C2416]",children:l.jsx(Ji,{className:"w-5 h-5"})})]})}),l.jsxs("div",{className:"space-y-1 p-2",children:[v.map(T=>{const w=T.icon,N=b(T.path);return T.comingSoon?l.jsxs("div",{className:"w-full flex items-center justify-between px-4 py-3 text-[#5C4F3D] bg-[#F5F1EA] rounded-xl opacity-60 cursor-not-allowed text-sm",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]}),l.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-medium",children:"Soon"})]},T.label):T.path==="#appointment"?l.jsxs("button",{onClick:()=>{it.info("Appointment coming soon"),p(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-[#5C4F3D] hover:bg-[#F5F1EA] rounded-xl transition-colors text-sm",children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]},T.label):l.jsxs(hn,{to:T.path,onClick:()=>p(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl transition-colors text-sm ${N?"bg-[#F5F1EA] text-[#8B7355] font-medium":"text-[#5C4F3D] hover:bg-[#F5F1EA]"}`,children:[l.jsx(w,{className:"w-5 h-5"}),l.jsx("span",{children:T.label})]},T.path)}),l.jsx("div",{className:"border-t border-[#E5DFD3] my-2"}),l.jsx("div",{className:"px-4 py-2 text-xs text-[#5C4F3D] font-medium",children:a==null?void 0:a.name}),l.jsxs("button",{onClick:E,className:"w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 rounded-xl transition-colors text-sm font-medium",children:[l.jsx(c2,{className:"w-5 h-5"}),l.jsx("span",{children:"Logout"})]})]})]}),l.jsx("nav",{className:"mobile-bottom-nav-container",children:l.jsxs("div",{className:"mobile-bottom-nav",children:[f.map(T=>{const w=T.icon,N=b(T.path);return T.isCenter?l.jsx(hn,{to:T.path,className:"nav-center-fab","aria-label":T.label,title:T.label,children:l.jsx(w,{className:"w-7 h-7"})},T.path):l.jsx(hn,{to:T.path,className:`nav-item-modern ${N?"active":""}`,"aria-label":T.label,title:T.label,children:l.jsx(w,{className:"w-5 h-5"})},T.path)}),l.jsx("button",{onClick:()=>p(!d),className:`nav-item-modern ${d?"active":""}`,"aria-label":"More options",title:"More options",children:l.jsx(bTe,{className:"w-5 h-5"})})]})})]})}const PTe=[{path:"/dashboard",icon:Jw,label:"Dashboard"},{path:"/ai-chat",icon:k0,label:"AI Assistant"},{path:"/upload",icon:li,label:"My Reports"},{path:"/nutrition",icon:zd,label:"Nutrition"},{path:"/diet-plan",icon:nc,label:"Diet Plan"},{path:"/profile",icon:Gf,label:"Profile"},{path:"/doctors",icon:ji,label:"Appointments",comingSoon:!0},{path:"/wearables",icon:_l,label:"Devices",comingSoon:!0}],DTe=[{path:"/doctor/dashboard",icon:Jw,label:"Dashboard"},{path:"/doctor/availability",icon:ic,label:"Manage Slots"},{path:"/profile",icon:Gf,label:"Profile"}],kTe=[{path:"/admin",icon:Jw,label:"Dashboard"},{path:"/profile",icon:Gf,label:"Settings"}];function wa({children:e,isAdmin:n,isDoctor:a}){var k,I,F,U,V,W;const{user:o,logout:d,isAdmin:p,isDoctor:f}=ma(),v=Ul(),b=Is(),[E,T]=q.useState(!1),w=()=>{d(),b("/")};let N=PTe,P="/dashboard",A="Patient Portal";return p()||n?(N=kTe,P="/admin",A="Admin Panel"):(f()||a)&&(N=DTe,P="/doctor/dashboard",A=((k=o==null?void 0:o.doctorProfile)==null?void 0:k.specialization)||"Doctor Portal"),l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsx("aside",{className:`fixed inset-y-0 right-0 lg:left-0 lg:right-auto z-50 w-64 bg-white shadow-lg lg:shadow-sm transform transition-transform duration-300 hidden lg:flex lg:flex-col ${E?"translate-x-0":"translate-x-full lg:translate-x-0"}`,style:{borderRight:"2px solid #E5DFD3",borderLeft:"2px solid #E5DFD3"},children:l.jsxs("div",{className:"flex flex-col h-full",children:[l.jsx("div",{className:"p-6 shrink-0",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs(hn,{to:P,className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold",style:{color:"#2C2416"},children:"HealthAI"}),l.jsx("p",{className:"text-xs",style:{color:"#5C4F3D"},children:A})]})]})}),l.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:N.map(({path:B,icon:z,label:Y,comingSoon:re})=>re?l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all cursor-not-allowed relative",style:{color:"#5C4F3D",opacity:.6},children:[l.jsx(z,{className:"w-5 h-5"}),l.jsx("span",{children:Y}),l.jsx("span",{className:"ml-auto text-xs px-2 py-0.5 rounded-full font-semibold",style:{backgroundColor:"#8B7355",color:"white"},children:"Soon"})]},B):l.jsxs(hn,{to:B,onClick:()=>T(!1),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${v.pathname===B?"border":""}`,style:v.pathname===B?{backgroundColor:"#F5F1EA",color:"#8B7355",borderColor:"#E5DFD3"}:{color:"#5C4F3D"},onMouseEnter:Z=>{v.pathname!==B&&(Z.currentTarget.style.backgroundColor="#F5F1EA",Z.currentTarget.style.color="#2C2416")},onMouseLeave:Z=>{v.pathname!==B&&(Z.currentTarget.style.backgroundColor="transparent",Z.currentTarget.style.color="#5C4F3D")},children:[l.jsx(z,{className:"w-5 h-5"}),l.jsx("span",{children:Y})]},B))}),l.jsx("div",{className:"p-4 shrink-0",style:{borderTop:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl",style:{backgroundColor:"#F5F1EA"},children:[l.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold",children:(F=(I=o==null?void 0:o.name)==null?void 0:I[0])==null?void 0:F.toUpperCase()})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium truncate",style:{color:"#2C2416"},children:f()?`Dr. ${o==null?void 0:o.name}`:o==null?void 0:o.name}),l.jsx("p",{className:"text-xs truncate",style:{color:"#5C4F3D"},children:o==null?void 0:o.email})]}),l.jsx("button",{onClick:w,className:"p-2 rounded-lg transition-all shrink-0",style:{color:"#5C4F3D"},onMouseEnter:B=>{B.currentTarget.style.color="#dc2626",B.currentTarget.style.backgroundColor="#fee2e2"},onMouseLeave:B=>{B.currentTarget.style.color="#5C4F3D",B.currentTarget.style.backgroundColor="transparent"},title:"Logout",children:l.jsx(c2,{className:"w-5 h-5"})})]})})]})}),E&&l.jsx("div",{className:"fixed inset-0 bg-black/20 z-40 lg:hidden",onClick:()=>T(!1)}),l.jsxs("div",{className:"flex-1 flex flex-col min-h-screen lg:ml-64",children:[l.jsx("header",{className:"sticky top-0 z-30 bg-white/80 backdrop-blur-xl",style:{borderBottom:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center justify-between px-3 md:px-4 lg:px-8 py-3 md:py-4",children:[l.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 md:flex-none",children:[l.jsxs(hn,{to:P,className:"lg:hidden flex items-center gap-2 flex-shrink-0",children:[l.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"text-sm font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsx("h1",{className:"text-base md:text-lg font-semibold hidden sm:block",style:{color:"#2C2416"},children:((U=N.find(B=>B.path===v.pathname))==null?void 0:U.label)||"Dashboard"})]}),l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 overflow-hidden",children:[l.jsx("div",{className:"hidden md:flex items-center",children:l.jsxs("div",{className:"relative",children:[l.jsx(Fy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",placeholder:"Search...",className:"w-48 pl-10 pr-4 py-2 rounded-xl text-sm focus:outline-none",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"}})]})}),l.jsxs("button",{className:"relative p-2 rounded-xl transition-all flex-shrink-0",style:{color:"#5C4F3D"},children:[l.jsx(rTe,{className:"w-5 h-5"}),l.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full"})]}),l.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#8B7355"},children:l.jsx("span",{className:"text-white font-bold text-sm",children:(W=(V=o==null?void 0:o.name)==null?void 0:V[0])==null?void 0:W.toUpperCase()})})]})]})}),l.jsx("main",{className:"flex-1 p-3 md:p-4 lg:p-8 main-content-mobile overflow-x-hidden w-full",children:e}),!p()&&!f()&&!n&&!a&&l.jsx(OTe,{})]}),v.pathname!=="/ai-chat"&&l.jsx(ITe,{})]})}function jTe(){const[e,n]=q.useState(null),[a,o]=q.useState(!1),[d,p]=q.useState(!1);q.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches){p(!0);return}const b=T=>{T.preventDefault(),n(T);const N=window.innerWidth<768?500:3e3,P=setTimeout(()=>{o(!0)},N);return()=>clearTimeout(P)},E=()=>{p(!0),o(!1),n(null),it.success("App installed successfully!")};return window.addEventListener("beforeinstallprompt",b),window.addEventListener("appinstalled",E),()=>{window.removeEventListener("beforeinstallprompt",b),window.removeEventListener("appinstalled",E)}},[]);const f=async()=>{if(!e)return;e.prompt();const{outcome:b}=await e.userChoice;b==="accepted"&&it.success("Installing HealthAI app..."),n(null),o(!1)},v=()=>{o(!1)};return d||!a||!e?null:l.jsx("div",{className:"fixed bottom-24 md:bottom-8 right-4 md:right-8 z-40 animate-slide-up",children:l.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-[#E5DFD3] p-4 md:p-6 max-w-sm",children:[l.jsxs("div",{className:"flex items-start justify-between mb-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center flex-shrink-0",children:l.jsx(IJ,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-[#2C2416] text-sm md:text-base",children:"Install HealthAI"}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Add to your home screen"})]})]}),l.jsx("button",{onClick:v,className:"text-[#5C4F3D] hover:text-[#2C2416] flex-shrink-0",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D] mb-4",children:"Get quick access to your health data and features offline"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all text-sm md:text-base",children:"Install"}),l.jsx("button",{onClick:v,className:"flex-1 px-4 py-2 bg-[#F5F1EA] text-[#2C2416] rounded-xl font-medium hover:bg-[#E5DFD3] transition-all text-sm md:text-base",children:"Later"})]})]})})}const LTe=()=>{const[e,n]=q.useState(!1),[a,o]=q.useState(!1),d=q.useRef(null);return q.useEffect(()=>{const p=f=>{d.current&&!d.current.contains(f.target)&&o(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]),l.jsx("header",{className:"fixed top-5 z-50 left-1/2 -translate-x-1/2 w-[calc(100%-200px)] max-w-5xl max-md:w-[calc(100%-40px)]",children:l.jsx("div",{className:"bg-white/50 backdrop-blur-3xl rounded-[28px] border border-white/60 shadow-2xl shadow-black/10",children:l.jsxs("div",{className:"px-6 lg:px-8",children:[l.jsxs("div",{className:"flex items-center justify-between h-16",children:[l.jsxs("nav",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Showcase"})]}),l.jsx(hn,{to:"/",className:"absolute left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"text-xl lg:text-2xl font-serif text-[#2C2416]",children:"HealthAI"})}),l.jsxs("div",{className:"hidden lg:flex items-center gap-6",children:[l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] transition-colors font-medium",children:"FAQ"}),l.jsxs("div",{className:"relative",ref:d,children:[l.jsx("button",{onClick:()=>o(!a),className:"w-10 h-10 rounded-full bg-[#8B7355] flex items-center justify-center hover:bg-[#6F5A43] transition-colors ml-2",children:l.jsx(Kc,{className:"w-5 h-5 text-white"})}),a&&l.jsxs("div",{className:"absolute right-0 mt-3 w-48 bg-white/90 backdrop-blur-2xl rounded-2xl shadow-xl border border-white/40 py-2 animate-fade-in",children:[l.jsx(hn,{to:"/login",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Sign In"}),l.jsx(hn,{to:"/register",className:"block px-6 py-3 text-sm text-[#5C4F3D] hover:bg-[#F5F1EA]/50 transition-colors font-medium",onClick:()=>o(!1),children:"Get Started"})]})]})]}),l.jsx("button",{className:"lg:hidden p-2 text-[#5C4F3D] ml-auto",onClick:()=>n(!e),children:e?l.jsx(Ji,{className:"w-6 h-6"}):l.jsx(yTe,{className:"w-6 h-6"})})]}),e&&l.jsx("div",{className:"lg:hidden py-6 border-t border-white/20",children:l.jsxs("nav",{className:"flex flex-col gap-4",children:[l.jsx("a",{href:"#features",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Features"}),l.jsx("a",{href:"#showcase",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Showcase"}),l.jsx("a",{href:"#testimonials",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Testimonials"}),l.jsx("a",{href:"#faq",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"FAQ"}),l.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-white/20",children:[l.jsx(hn,{to:"/login",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Sign In"}),l.jsx(hn,{to:"/register",className:"text-sm text-[#5C4F3D] hover:text-[#2C2416] py-2 font-medium",children:"Get Started"})]})]})})]})})})},MTe=()=>l.jsxs("div",{className:"relative min-h-screen flex items-center overflow-hidden bg-[#F5F1EA]",children:[l.jsxs("div",{className:"absolute inset-0 z-0",children:[l.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",children:[l.jsx("source",{src:"https://cdn.shopify.com/videos/c/o/v/dcb48db72fdb4641a2af2df51c03aad5.mp4",type:"video/mp4"}),l.jsx("img",{src:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=1920&h=1080&fit=crop",alt:"Healthcare",className:"w-full h-full object-cover"})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/70 via-white/30 to-transparent lg:from-white/60 lg:via-white/20 lg:to-transparent"})]}),l.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-32",children:l.jsxs("div",{className:"max-w-xl lg:max-w-2xl text-center lg:text-left",children:[l.jsx("p",{className:"text-xs sm:text-sm uppercase tracking-[0.2em] text-black mb-6 font-medium",children:"SMART NUTRITION TRACKING"}),l.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-serif text-black mb-6 leading-[1.1]",children:["Track calories.",l.jsx("br",{}),l.jsx("span",{className:"italic",children:"Naturally"})," healthy."]}),l.jsx("p",{className:"text-base sm:text-lg md:text-xl text-black mb-10 leading-relaxed max-w-lg",children:"Discover nutrition tracking that works with you. AI-powered insights, personalized meal plans, effortless calorie counting."}),l.jsxs(hn,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-[#8B7355] text-white rounded-full font-medium hover:bg-[#6F5A43] transition-all group shadow-lg",children:["Start Tracking",l.jsx(so,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]})]})}),l.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 z-10",children:[l.jsx("span",{className:"text-xs uppercase tracking-wider text-black font-medium",children:"SCROLL"}),l.jsx("div",{className:"w-px h-12 bg-black/30"})]})]}),UTe=()=>{const e=[{icon:ir,title:"Calorie Tracking",description:"Effortless daily tracking"},{icon:Ca,title:"Progress Analytics",description:"Real-time health insights"},{icon:Lh,title:"Goal Setting",description:"Personalized targets"},{icon:Di,title:"Wellness Plans",description:"AI-powered recommendations"}];return l.jsx("section",{id:"features",className:"py-20 bg-[#F5F1EA]",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-6",children:l.jsx(o,{className:"w-12 h-12 text-[#8B7355] stroke-[1.5]"})}),l.jsx("h3",{className:"text-lg font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})})})},FTe=()=>l.jsx("section",{className:"bg-[#8B7355] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsxs("div",{className:"relative rounded-3xl overflow-hidden group",children:[l.jsx("img",{src:"https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=800&h=600&fit=crop",alt:"AI-Powered Nutrition",className:"w-full h-full object-cover min-h-[400px]"}),l.jsxs("div",{className:"absolute bottom-8 left-8 right-8 bg-white/95 backdrop-blur-sm rounded-2xl p-6",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"AI-Powered Nutrition"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Smart meal recognition and instant calorie calculation with advanced AI technology."})]})]}),l.jsxs("div",{className:"flex flex-col gap-8",children:[l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-2xl font-serif text-[#2C2416] mb-2",children:"Track Everything"}),l.jsx("h4",{className:"text-xl font-serif text-[#2C2416] mb-4",children:"Achieve Anything"}),l.jsxs("ul",{className:"space-y-2 text-sm text-[#5C4F3D]",children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Calorie & Macro Tracking"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Meal Planning & Recipes"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-1 h-1 rounded-full bg-[#8B7355]"}),"Progress Analytics"]})]})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&h=400&fit=crop",alt:"Healthy Food",className:"w-48 h-64 object-cover rounded-2xl"})})]})}),l.jsx("div",{className:"relative rounded-3xl overflow-hidden bg-[#E5DFD3] p-8",children:l.jsxs("div",{className:"flex items-center gap-6",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsx("div",{className:"w-16 h-16 rounded-full bg-white flex items-center justify-center",children:l.jsx(LJ,{className:"w-8 h-8 text-[#8B7355]"})})}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-xl font-serif text-[#2C2416] mb-2",children:"Mobile App"}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:"Track on-the-go with our iOS & Android app"})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=200&h=200&fit=crop",alt:"Mobile App",className:"w-32 h-32 object-cover rounded-xl"})})]})})]})]})})}),VTe=()=>{const e=[{icon:ir,title:"Smart Tracking",description:"AI-powered meal recognition and logging"},{icon:Ca,title:"Progress Insights",description:"Real-time analytics and trends"},{icon:Lh,title:"Goal Achievement",description:"Personalized nutrition targets"},{icon:of,title:"Expert Support",description:"Nutritionist-approved guidance"}];return l.jsx("section",{className:"bg-[#F5F1EA] py-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:l.jsxs("div",{className:"grid lg:grid-cols-2 gap-16 items-center",children:[l.jsx("div",{className:"relative",children:l.jsx("div",{className:"rounded-3xl overflow-hidden",children:l.jsx("img",{src:"https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=800&h=1000&fit=crop",alt:"Healthy Nutrition",className:"w-full h-full object-cover"})})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm uppercase tracking-[0.2em] text-[#8B7355] mb-4 font-medium",children:"WHY HEALTHAI"}),l.jsxs("h2",{className:"text-4xl md:text-5xl font-serif text-[#2C2416] mb-6 leading-tight",children:["Nutrition that",l.jsx("br",{}),"works for you."]}),l.jsx("p",{className:"text-lg text-[#5C4F3D] mb-8 leading-relaxed",children:"We believe nutrition tracking should be simple, not stressful. Every feature is designed with your health goals in mind, powered by AI for effortless tracking."}),l.jsx("div",{className:"grid grid-cols-2 gap-6",children:e.map((n,a)=>{const o=n.icon;return l.jsxs("div",{className:"bg-white rounded-2xl p-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-full bg-[#F5F1EA] flex items-center justify-center mb-4",children:l.jsx(o,{className:"w-6 h-6 text-[#8B7355]"})}),l.jsx("h3",{className:"text-base font-serif text-[#2C2416] mb-2",children:n.title}),l.jsx("p",{className:"text-sm text-[#5C4F3D]",children:n.description})]},a)})})]})]})})})},BTe=()=>{const[e,n]=q.useState(0),a=q.useRef(null),o=[{title:"Track Your Health Metrics",description:"Monitor vital signs, lab results, and health trends all in one place with AI-powered insights.",phoneScreen:"dashboard",cards:[{icon:Di,title:"Heart Rate",value:"72 bpm",color:"rose",position:"left-top"},{icon:ir,title:"Blood Pressure",value:"120/80",color:"blue",position:"left-bottom"},{icon:Ca,title:"Health Score",value:"85/100",color:"emerald",position:"right-top"},{icon:Qw,title:"Vitamin D",value:"45 ng/mL",color:"amber",position:"right-bottom"}]},{title:"Smart Nutrition Tracking",description:"Track your meals and get actionable feedback that helps you build a better relationship with food.",phoneScreen:"nutrition",cards:[{icon:zd,title:"Today's Meals",value:"3 logged",color:"emerald",position:"left-top"},{icon:ir,title:"Calories",value:"1,850 kcal",color:"orange",position:"left-bottom"},{icon:Ca,title:"Protein",value:"95g",color:"blue",position:"right-top"},{icon:Di,title:"Macro Balance",value:"Optimal",color:"purple",position:"right-bottom"}]},{title:"AI-Powered Health Insights",description:"Get personalized recommendations based on your medical reports and wearable data.",phoneScreen:"ai-chat",cards:[{icon:k0,title:"AI Assistant",value:"24/7 Available",color:"cyan",position:"left-top"},{icon:Ca,title:"Insights",value:"12 new",color:"indigo",position:"left-bottom"},{icon:ji,title:"Reminders",value:"5 today",color:"pink",position:"right-top"},{icon:Di,title:"Health Tips",value:"Updated",color:"red",position:"right-bottom"}]},{title:"Sleep & Recovery Tracking",description:"Improve your sleep by understanding patterns, identifying disruptions, and building habits.",phoneScreen:"sleep",cards:[{icon:Vf,title:"Sleep Quality",value:"85%",color:"indigo",position:"left-top"},{icon:ir,title:"Sleep Duration",value:"7h 45m",color:"blue",position:"left-bottom"},{icon:Ca,title:"Deep Sleep",value:"2h 15m",color:"purple",position:"right-top"},{icon:Di,title:"REM Sleep",value:"1h 30m",color:"pink",position:"right-bottom"}]}];q.useEffect(()=>{const v=()=>{if(!a.current)return;const b=a.current,{top:E,height:T}=b.getBoundingClientRect(),w=window.innerHeight,N=(w/2-E)/(T-w/2),P=Math.max(0,Math.min(1,N)),A=Math.floor(P*o.length),k=Math.min(A,o.length-1);n(k)};return window.addEventListener("scroll",v),v(),()=>window.removeEventListener("scroll",v)},[o.length]);const d=v=>({"left-top":"left-[1%] sm:left-[3%] md:left-[8%] top-[8%] sm:top-[10%] md:top-[12%]","left-bottom":"left-[1%] sm:left-[5%] md:left-[10%] bottom-[12%] sm:bottom-[15%] md:bottom-[18%]","right-top":"right-[1%] sm:right-[3%] md:right-[8%] top-[14%] sm:top-[16%] md:top-[18%]","right-bottom":"right-[1%] sm:right-[5%] md:right-[10%] bottom-[6%] sm:bottom-[9%] md:bottom-[12%]"})[v]||"left-[10%] top-[20%]",p=(v,b)=>({"left-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 translate-y-16 scale-75","left-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 translate-x-32 -translate-y-16 scale-75","right-top":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 translate-y-16 scale-75","right-bottom":b?"opacity-100 translate-x-0 translate-y-0 scale-100":"opacity-0 -translate-x-32 -translate-y-16 scale-75"})[v],f=v=>({dashboard:"from-blue-500 to-cyan-500",nutrition:"from-emerald-500 to-green-500","ai-chat":"from-purple-500 to-pink-500",sleep:"from-indigo-500 to-blue-500"})[v]||"from-cyan-500 to-blue-500";return l.jsx("div",{id:"showcase",ref:a,className:"relative bg-[#F5F1EA]",style:{height:`${o.length*100}vh`},children:l.jsx("div",{className:"sticky top-0 h-screen flex items-center justify-center overflow-hidden pt-20 sm:pt-24 px-2 sm:px-4",children:l.jsx("div",{className:"relative w-full max-w-7xl mx-auto",children:l.jsxs("div",{className:"relative flex flex-col items-center",children:[l.jsxs("div",{className:"text-center mb-8 sm:mb-12 max-w-2xl px-4 transition-all duration-700 transform relative z-30",children:[l.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-[#2C2416] mb-3 sm:mb-4 leading-tight",children:o[e].title}),l.jsx("p",{className:"text-[#5C4F3D] text-sm sm:text-base md:text-lg leading-relaxed",children:o[e].description})]}),l.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",children:o[e].cards.map((v,b)=>{const E=v.icon,T={rose:{bg:"bg-rose-50",icon:"text-rose-500",value:"text-rose-600",border:"border-rose-100"},blue:{bg:"bg-blue-50",icon:"text-blue-500",value:"text-blue-600",border:"border-blue-100"},emerald:{bg:"bg-emerald-50",icon:"text-emerald-500",value:"text-emerald-600",border:"border-emerald-100"},amber:{bg:"bg-amber-50",icon:"text-amber-500",value:"text-amber-600",border:"border-amber-100"},orange:{bg:"bg-orange-50",icon:"text-orange-500",value:"text-orange-600",border:"border-orange-100"},purple:{bg:"bg-purple-50",icon:"text-purple-500",value:"text-purple-600",border:"border-purple-100"},cyan:{bg:"bg-cyan-50",icon:"text-cyan-500",value:"text-cyan-600",border:"border-cyan-100"},indigo:{bg:"bg-indigo-50",icon:"text-indigo-500",value:"text-indigo-600",border:"border-indigo-100"},pink:{bg:"bg-pink-50",icon:"text-pink-500",value:"text-pink-600",border:"border-pink-100"},red:{bg:"bg-red-50",icon:"text-red-500",value:"text-red-600",border:"border-red-100"}},w=T[v.color]||T.blue;return l.jsx("div",{className:`absolute ${d(v.position)} ${p(v.position,!0)} 
                      transition-all duration-1000 ease-out`,style:{transitionDelay:`${b*150}ms`},children:l.jsxs("div",{className:`bg-white rounded-xl sm:rounded-2xl shadow-xl p-3 sm:p-4 md:p-6 border ${w.border} 
                      hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 w-32 sm:w-40 md:w-48`,children:[l.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-lg sm:rounded-xl ${w.bg} flex items-center justify-center mb-2 sm:mb-3`,children:l.jsx(E,{className:`w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 ${w.icon}`,strokeWidth:2})}),l.jsx("h4",{className:"text-[#2C2416] font-medium text-xs sm:text-sm md:text-base mb-1 leading-tight",children:v.title}),l.jsx("p",{className:`${w.value} font-bold text-base sm:text-lg md:text-xl`,children:v.value})]})},b)})}),l.jsxs("div",{className:"relative transform perspective-1000 z-20",children:[l.jsxs("div",{className:"relative w-[240px] sm:w-[280px] md:w-[320px] lg:w-[340px] h-[480px] sm:h-[560px] md:h-[640px] lg:h-[680px] bg-slate-900 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] p-2 sm:p-3 shadow-2xl",children:[l.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-28 sm:w-32 md:w-36 h-5 sm:h-6 md:h-7 bg-slate-900 rounded-b-2xl sm:rounded-b-3xl z-10"}),l.jsx("div",{className:"relative w-full h-full bg-white rounded-[2rem] sm:rounded-[2.5rem] md:rounded-[3rem] overflow-hidden",children:l.jsxs("div",{className:`absolute inset-0 bg-gradient-to-br ${f(o[e].phoneScreen)} 
                    transition-all duration-1000 ease-in-out`,children:[l.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-5 md:px-6 pt-2 sm:pt-3 text-white text-[10px] sm:text-xs",children:[l.jsx("span",{children:"9:41"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-3 h-2 sm:w-4 sm:h-3 border border-white rounded-sm"}),l.jsx("div",{className:"w-0.5 h-2 sm:w-1 sm:h-3 bg-white rounded-sm"})]})]}),l.jsxs("div",{className:"px-4 sm:px-5 md:px-6 pt-6 sm:pt-7 md:pt-8",children:[l.jsxs("h3",{className:"text-white text-lg sm:text-xl md:text-2xl font-bold",children:[o[e].phoneScreen==="dashboard"&&"Dashboard",o[e].phoneScreen==="nutrition"&&"Nutrition",o[e].phoneScreen==="ai-chat"&&"AI Assistant",o[e].phoneScreen==="sleep"&&"Sleep"]}),l.jsx("p",{className:"text-white/80 text-[10px] sm:text-xs md:text-sm mt-1",children:new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsx("div",{className:`absolute inset-x-4 sm:inset-x-5 md:inset-x-6 top-24 sm:top-28 md:top-32 bottom-4 sm:bottom-5 md:bottom-6 bg-white/10 backdrop-blur-md rounded-2xl sm:rounded-3xl border border-white/20 p-4 sm:p-5 md:p-6 \r
                      transition-all duration-1000 shadow-inner`,children:l.jsx("div",{className:"space-y-3 sm:space-y-4",children:[1,2,3].map(v=>l.jsx("div",{className:"bg-white/20 rounded-xl sm:rounded-2xl h-14 sm:h-16 md:h-20 animate-pulse shadow-lg",style:{animationDelay:`${v*200}ms`,animationDuration:"2s"}},v))})})]})})]}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/10 to-slate-900/30 rounded-[2.5rem] sm:rounded-[3rem] md:rounded-[3.5rem] -z-10 blur-2xl sm:blur-3xl transform scale-105"})]})]})})})})},GTe=()=>l.jsx("section",{className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"mb-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] flex items-center justify-center",children:[l.jsxs("div",{className:"relative z-10 text-center px-8 py-16",children:[l.jsxs("h2",{className:"text-4xl md:text-5xl lg:text-6xl font-serif text-white mb-6 leading-tight",children:["Access personalized",l.jsx("br",{}),"nutrition tracking"]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 mt-8",children:[l.jsxs(hn,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:["Get started",l.jsx(so,{className:"w-5 h-5"})]}),l.jsx("button",{className:"inline-flex items-center gap-2 px-8 py-4 bg-white/20 backdrop-blur-md text-white rounded-full font-medium hover:bg-white/30 transition-all border border-white/30",children:"See if I'm eligible"})]})]}),l.jsx("svg",{className:"absolute bottom-0 left-0 w-full h-32 opacity-20",viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:l.jsx("path",{d:"M0,50 Q300,10 600,50 T1200,50 L1200,120 L0,120 Z",fill:"currentColor",className:"text-[#6F5A43]"})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Track your health,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"stay on track"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Monitor your daily nutrition intake with AI-powered insights to help you maintain optimal health."}),l.jsxs(hn,{to:"/register",className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:["Get started ",l.jsx(so,{className:"w-5 h-5"})]})]}),l.jsx("div",{className:"mt-8 flex items-center justify-center",children:l.jsx("div",{className:"w-32 h-32 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/20",children:l.jsx(ir,{className:"w-16 h-16 text-white"})})})]})}),l.jsx("div",{className:"rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[500px] p-8 md:p-12",children:l.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 h-full flex flex-col justify-between shadow-2xl",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"text-3xl md:text-4xl font-serif text-white mb-4 leading-tight",children:["Eat healthy,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"get strong"})]}),l.jsx("p",{className:"text-white/90 text-base mb-6",children:"Find nutritional, protein-packed meal plans to help you maintain muscle mass and achieve your goals."}),l.jsxs("button",{className:"inline-flex items-center text-white font-medium hover:gap-3 gap-2 transition-all",children:[l.jsx("span",{className:"w-5 h-5 rounded-full border border-white flex items-center justify-center",children:l.jsx("span",{className:"text-xs",children:"i"})}),"Learn more about nutrition"]})]}),l.jsx("div",{className:"mt-8 grid grid-cols-4 gap-2",children:[...Array(8)].map((e,n)=>l.jsx("div",{className:"aspect-square rounded-lg bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/10",children:l.jsx(nc,{className:"w-6 h-6 text-white/60"})},n))})]})})]}),l.jsx("div",{className:"mt-8 rounded-[32px] bg-[#8B7355] overflow-hidden relative min-h-[400px] p-8 md:p-12",children:l.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-8 md:p-12 border border-white/20 shadow-2xl",children:l.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[l.jsxs("h3",{className:"text-3xl md:text-5xl font-serif text-white mb-4 leading-tight",children:["It's more than a plan,",l.jsx("br",{}),l.jsx("span",{className:"text-[#D4C5B0]",children:"it's personal"})]}),l.jsx("p",{className:"text-white/90 text-base mb-8 max-w-2xl mx-auto",children:"A healthcare provider will review your information, so that they can combine guidance on nutrition, activity, sleep, and more into a plan designed around your body's needs."}),l.jsx(hn,{to:"/register",className:"inline-flex items-center gap-2 px-8 py-4 bg-white text-[#8B7355] rounded-full font-medium hover:bg-[#F5F1EA] transition-all shadow-lg",children:"Get started"})]})})})]})});function WTe(){const[e,n]=q.useState(0),a=[{stars:5,quote:"HealthAI identified my vitamin D deficiency that my doctor missed. The personalized nutrition plan has completely transformed my energy levels and overall health. I feel like I have a personal health advisor in my pocket.",author:"Sarah Johnson",role:"Marketing Manager",location:"San Francisco",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"As a busy professional, I never had time to properly analyze my health reports. HealthAI does it instantly and gives me actionable insights. The doctor recommendations were spot-on and saved me months of searching.",author:"Michael Chen",role:"Software Engineer",location:"Seattle",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face"},{stars:5,quote:"The AI analysis caught early signs of metabolic issues that could have become serious. The preventive care recommendations and supplement guidance have been life-changing. This is the future of healthcare.",author:"Emily Rodriguez",role:"Fitness Instructor",location:"Austin",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face"}],o=()=>n(p=>(p+1)%a.length),d=()=>n(p=>(p-1+a.length)%a.length);return l.jsx("section",{id:"testimonials",className:"py-20 md:py-32 bg-[#F5F1EA]",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"Testimonials"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Hear from our users"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"Join thousands who've transformed their health with AI-powered insights."})]}),l.jsxs("div",{className:"max-w-4xl mx-auto",children:[l.jsxs("div",{className:"relative bg-white/60 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl border border-[#E5DFD3]",children:[l.jsx(STe,{className:"absolute top-8 right-8 w-16 h-16 text-[#8B7355]/20"}),l.jsx("div",{className:"flex gap-1 mb-6",children:[...Array(a[e].stars)].map((p,f)=>l.jsx(zc,{className:"w-5 h-5 fill-amber-400 text-amber-400"},f))}),l.jsxs("blockquote",{className:"text-xl md:text-2xl text-[#2C2416] leading-relaxed mb-8 font-serif",children:['"',a[e].quote,'"']}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("img",{src:a[e].image,alt:a[e].author,className:"w-14 h-14 rounded-full object-cover border-2 border-[#E5DFD3]"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-[#2C2416]",children:a[e].author}),l.jsxs("p",{className:"text-sm text-[#5C4F3D]",children:[a[e].role,"  ",a[e].location]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mt-8",children:[l.jsx("button",{onClick:d,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(co,{className:"w-5 h-5 text-[#2C2416]"})}),l.jsx("div",{className:"flex gap-2",children:a.map((p,f)=>l.jsx("button",{onClick:()=>n(f),className:`w-2.5 h-2.5 rounded-full transition-colors ${f===e?"bg-[#8B7355]":"bg-[#E5DFD3] hover:bg-[#8B7355]/50"}`},f))}),l.jsx("button",{onClick:o,className:"w-12 h-12 rounded-full border border-[#E5DFD3] bg-white/60 hover:bg-white transition-colors flex items-center justify-center",children:l.jsx(so,{className:"w-5 h-5 text-[#2C2416]"})})]})]})]})})}function $Te(){const[e,n]=q.useState(0),a=[{question:"What types of health reports can I upload?",answer:"HealthAI supports all common medical report formats including blood tests, lab results, imaging reports, and general health checkups. You can upload PDFs, images, or even photos of paper reports. Our AI can extract and analyze data from virtually any medical document."},{question:"How accurate is the AI analysis?",answer:"Our AI has been trained on millions of medical records and achieves 98% accuracy in data extraction and analysis. However, our insights are meant to supplement, not replace, professional medical advice. We always recommend consulting with healthcare professionals for serious health concerns."},{question:"Is my health data secure and private?",answer:"Absolutely. We use bank-level encryption to protect your data and are fully HIPAA compliant. Your health information is never shared with third parties without your explicit consent. You have complete control over your data and can delete it at any time."},{question:"Can I connect with real doctors through the platform?",answer:"Yes! Based on your AI analysis, we recommend verified healthcare professionals who specialize in your specific health needs. Our network includes thousands of doctors, specialists, and healthcare providers who understand our AI insights."},{question:"What if I don't have any medical reports?",answer:"No problem! You can start by taking our comprehensive health assessment, or we can help you understand what tests to request from your doctor. We also provide guidance on essential health screenings based on your age, gender, and health goals."},{question:"Can I cancel my subscription anytime?",answer:"Yes, you can cancel your subscription at any time with no penalties or fees. If you cancel mid-cycle, you'll continue to have access to all features until the end of your billing period. We also offer a 30-day money-back guarantee for new subscribers."}];return l.jsx("section",{id:"faq",className:"py-20 md:py-32 bg-white",children:l.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-16",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-[#8B7355]"}),l.jsx("span",{className:"text-sm uppercase tracking-wider text-[#5C4F3D] font-medium",children:"FAQ"})]}),l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-[#2C2416] mb-6",children:"Got questions?"}),l.jsx("p",{className:"text-lg text-[#5C4F3D]",children:"We've got answers. If you can't find what you're looking for, chat with our team."})]}),l.jsx("div",{className:"space-y-4",children:a.map((o,d)=>l.jsxs("div",{className:"border border-[#E5DFD3] rounded-xl overflow-hidden bg-white/60 backdrop-blur-sm",children:[l.jsxs("button",{onClick:()=>n(e===d?null:d),className:"w-full flex items-center justify-between p-6 text-left",children:[l.jsx("span",{className:"text-lg font-medium text-[#2C2416] pr-4",children:o.question}),l.jsx(o2,{className:`w-5 h-5 text-[#5C4F3D] shrink-0 transition-transform duration-200 ${e===d?"rotate-180":""}`})]}),l.jsx("div",{className:`overflow-hidden transition-all duration-200 ${e===d?"max-h-96":"max-h-0"}`,children:l.jsx("p",{className:"px-6 pb-6 text-[#5C4F3D] leading-relaxed",children:o.answer})})]},d))})]})})}function HTe(){return l.jsx("section",{className:"py-20 md:py-32 bg-[#8B7355]",children:l.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[l.jsx("h2",{className:"text-3xl md:text-5xl font-serif text-white mb-6",children:"Ready to transform your health with AI?"}),l.jsx("p",{className:"text-lg text-white/90 mb-10 max-w-2xl mx-auto",children:"Join 10,000+ people who've made the switch to proactive, AI-powered healthcare. Your future self will thank you."}),l.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[l.jsxs(hn,{to:"/register",className:"bg-white text-[#8B7355] hover:bg-[#F5F1EA] rounded-full px-8 py-4 text-base font-medium transition-all inline-flex items-center gap-2 shadow-lg",children:["Start your free analysis",l.jsx(so,{className:"w-5 h-5"})]}),l.jsx(hn,{to:"/login",className:"rounded-full px-8 py-4 text-base font-medium border-2 border-white/40 text-white hover:bg-white/10 bg-transparent transition-all backdrop-blur-sm",children:"Talk to our team"})]}),l.jsx("p",{className:"text-sm text-white/80 mt-6",children:"Free forever plan  No credit card required  Cancel anytime"})]})})}function zTe(){return l.jsx("footer",{className:"bg-[#2C2416] text-white py-16",children:l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-8 mb-12",children:[l.jsxs("div",{className:"col-span-2 lg:col-span-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("div",{className:"w-8 h-8 bg-[#8B7355] rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-5 h-5 text-white"})}),l.jsx("span",{className:"font-serif text-xl",children:"HealthAI"})]}),l.jsx("p",{className:"text-white/60 text-sm mb-4",children:"AI-powered health insights for better living."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Features"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Pricing"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Mobile App"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"API"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"About"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Blog"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Careers"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Press"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Resources"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Help Center"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Health Guides"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Find a Doctor"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Partner with Us"})})]})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-semibold mb-4",children:"Legal"}),l.jsxs("ul",{className:"space-y-3 text-sm",children:[l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Privacy Policy"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"Terms of Service"})}),l.jsx("li",{children:l.jsx("a",{href:"#",className:"text-white/60 hover:text-white transition-colors",children:"HIPAA Compliance"})})]})]})]}),l.jsxs("div",{className:"pt-8 border-t border-white/10 flex flex-col md:flex-row items-center justify-between gap-4",children:[l.jsx("p",{className:"text-sm text-white/60",children:" 2024 HealthAI. All rights reserved."}),l.jsx("p",{className:"text-sm text-white/60",children:"Made with  for better health"})]})]})})}function KTe(){return l.jsxs("div",{className:"min-h-screen bg-[#F5F1EA]",children:[l.jsx(LTe,{}),l.jsx(MTe,{}),l.jsx(UTe,{}),l.jsx(FTe,{}),l.jsx(VTe,{}),l.jsx(GTe,{}),l.jsx(BTe,{}),l.jsx(WTe,{}),l.jsx($Te,{}),l.jsx(HTe,{}),l.jsx(zTe,{})]})}function YTe(){const[e,n]=q.useState(""),[a,o]=q.useState(""),[d,p]=q.useState(!1),[f,v]=q.useState(!1),{login:b}=ma(),E=Is(),T=async w=>{var N,P;w.preventDefault(),v(!0);try{const A=await b(e,a);it.success("Welcome back!"),E(A.role==="admin"?"/admin":A.role==="doctor"?"/doctor/dashboard":"/dashboard")}catch(A){it.error(((P=(N=A.response)==null?void 0:N.data)==null?void 0:P.message)||"Login failed")}finally{v(!1)}};return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center w-full p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(ir,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Welcome to HealthAI"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Your AI-powered health companion for smarter healthcare decisions."})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Sign In"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Access your health dashboard"})]}),l.jsxs("form",{onSubmit:T,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address"}),l.jsxs("div",{className:"relative",children:[l.jsx(D0,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:e,onChange:w=>n(w.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:d?"text":"password",value:a,onChange:w=>o(w.target.value),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>p(!d),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:d?l.jsx(OJ,{className:"w-5 h-5"}):l.jsx(Xw,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded",style:{borderColor:"#E5DFD3"}}),l.jsx("span",{className:"text-sm",style:{color:"#5C4F3D"},children:"Remember me"})]}),l.jsx("a",{href:"#",className:"text-sm font-medium",style:{color:"#8B7355"},children:"Forgot password?"})]}),l.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:f?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Sign In ",l.jsx(so,{className:"w-5 h-5"})]})})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Don't have an account?"," ",l.jsx(hn,{to:"/register",className:"font-semibold",style:{color:"#8B7355"},children:"Create one"})]}),l.jsx("div",{className:"mt-6 text-center",children:l.jsx(hn,{to:"/register/doctor",className:"text-sm",style:{color:"#5C4F3D"},children:"Register as a Doctor "})})]})})]})}function qTe(){const[e,n]=q.useState(1),[a,o]=q.useState(null),[d,p]=q.useState({name:"",email:"",password:"",confirmPassword:"",age:"",gender:"",height:"",weight:"",bloodGroup:"",dietaryPreference:"non-vegetarian",activityLevel:"sedentary",chronicConditions:[],allergies:[],currentMedications:[],smoker:!1,smokingFrequency:"",alcohol:!1,alcoholFrequency:"",sleepHours:"7",stressLevel:"moderate",waterIntake:"8",nutritionGoal:"general_health",targetWeight:"",weeklyGoal:"0.5"}),[f,v]=q.useState(!1),[b,E]=q.useState(!1),[T,w]=q.useState(""),[N,P]=q.useState(""),[A,k]=q.useState(""),{register:I}=ma(),F=Is(),U=Z=>{o(Z),Z==="doctor"?F("/register/doctor"):n(2)},V=async Z=>{var ie,te;if(Z.preventDefault(),d.password!==d.confirmPassword){it.error("Passwords do not match");return}if(!d.age||!d.gender){it.error("Please provide your age and gender");return}E(!0);try{const de={age:parseInt(d.age),gender:d.gender,height:d.height?parseFloat(d.height):void 0,weight:d.weight?parseFloat(d.weight):void 0,bloodGroup:d.bloodGroup||void 0,dietaryPreference:d.dietaryPreference,activityLevel:d.activityLevel,medicalHistory:{conditions:d.chronicConditions,currentMedications:d.currentMedications},lifestyle:{smoker:d.smoker,smokingFrequency:d.smokingFrequency,alcohol:d.alcohol,alcoholFrequency:d.alcoholFrequency,sleepHours:parseInt(d.sleepHours),stressLevel:d.stressLevel,waterIntake:parseInt(d.waterIntake)},allergies:d.allergies},xe={goal:d.nutritionGoal,targetWeight:d.targetWeight?parseFloat(d.targetWeight):null,weeklyGoal:parseFloat(d.weeklyGoal)};await I(d.name,d.email,d.password,de,xe),it.success("Account created successfully! Your personalized nutrition plan is ready."),F("/dashboard")}catch(de){it.error(((te=(ie=de.response)==null?void 0:ie.data)==null?void 0:te.message)||"Registration failed")}finally{E(!1)}},W=()=>{if(e===2){if(!d.name||!d.email||!d.password||!d.age||!d.gender){it.error("Please fill in all required fields");return}if(d.password!==d.confirmPassword){it.error("Passwords do not match");return}}if(e===3&&(!d.height||!d.weight)){it.error("Please provide your height and weight for accurate nutrition calculations");return}n(e+1)},B=()=>n(e-1),z=(Z,ie)=>{p(te=>({...te,[Z]:te[Z].includes(ie)?te[Z].filter(de=>de!==ie):[...te[Z],ie]}))},Y=(Z,ie)=>{ie&&!d[Z].includes(ie)&&p(te=>({...te,[Z]:[...te[Z],ie]}))},re=(Z,ie)=>{p(te=>({...te,[Z]:te[Z].filter(de=>de!==ie)}))};if(e===1)return l.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:"#8B7355"},children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold",style:{color:"#2C2416"},children:"HealthAI"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Join HealthAI"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Choose how you want to use our platform"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("button",{onClick:()=>U("patient"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(Di,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Patient"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Upload health reports, get AI-powered insights, personalized diet plans, and connect with doctors."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"AI Health Report Analysis"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Personalized Diet Plans"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Get Started ",l.jsx(so,{className:"w-4 h-4 ml-2"})]})]}),l.jsxs("button",{onClick:()=>U("doctor"),className:"bg-white rounded-2xl p-8 text-left hover:shadow-lg transition-all group",style:{border:"2px solid #E5DFD3"},children:[l.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center mb-4 transition-colors",style:{backgroundColor:"#F5F1EA"},children:l.jsx(MJ,{className:"w-8 h-8 transition-colors",style:{color:"#8B7355"}})}),l.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"#2C2416"},children:"I am a Doctor"}),l.jsx("p",{className:"text-sm mb-4",style:{color:"#5C4F3D"},children:"Join our platform to provide consultations, manage appointments, and help patients."}),l.jsxs("ul",{className:"text-sm space-y-2",style:{color:"#5C4F3D"},children:[l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Manage Your Schedule"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"Video Consultations"]}),l.jsxs("li",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"#8B7355"}}),"View Patient Reports"]})]}),l.jsxs("div",{className:"mt-6 flex items-center font-medium",style:{color:"#8B7355"},children:["Apply Now ",l.jsx(so,{className:"w-4 h-4 ml-2"})]})]})]}),l.jsxs("p",{className:"text-center mt-8",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(hn,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})});if(e===2)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Di,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Your Health Journey Starts Here"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Get personalized health insights, diet plans, and supplement recommendations based on your unique profile."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:()=>n(1),className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Basic Information"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 1 of 4 - Let's start with the basics"})]}),l.jsxs("form",{onSubmit:Z=>{Z.preventDefault(),W()},className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Full Name *"}),l.jsxs("div",{className:"relative",children:[l.jsx(Kc,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"text",value:d.name,onChange:Z=>p({...d,name:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"John Doe",required:!0})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Age *"}),l.jsx("input",{type:"number",value:d.age,onChange:Z=>p({...d,age:Z.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"25",min:"1",max:"120",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Gender *"}),l.jsxs("select",{value:d.gender,onChange:Z=>p({...d,gender:Z.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"",children:"Select"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Email Address *"}),l.jsxs("div",{className:"relative",children:[l.jsx(D0,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"email",value:d.email,onChange:Z=>p({...d,email:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"you@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:f?"text":"password",value:d.password,onChange:Z=>p({...d,password:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-12 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0}),l.jsx("button",{type:"button",onClick:()=>v(!f),className:"absolute right-4 top-1/2 -translate-y-1/2",style:{color:"#5C4F3D"},children:f?l.jsx(OJ,{className:"w-5 h-5"}):l.jsx(Xw,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Confirm Password *"}),l.jsxs("div",{className:"relative",children:[l.jsx(EP,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"password",value:d.confirmPassword,onChange:Z=>p({...d,confirmPassword:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"",required:!0})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(so,{className:"w-5 h-5"})]})]}),l.jsxs("p",{className:"text-center mt-6",style:{color:"#5C4F3D"},children:["Already have an account?"," ",l.jsx(hn,{to:"/login",className:"font-semibold",style:{color:"#8B7355"},children:"Sign in"})]})]})})]});if(e===3)return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(x7,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Health Profile"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us calculate your personalized nutrition goals based on your body metrics."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:l.jsxs("div",{className:"w-full max-w-md",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Health Profile"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 2 of 4 - Your body metrics"})]}),l.jsxs("form",{onSubmit:Z=>{Z.preventDefault(),W()},className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Height (cm) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(TTe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.height,onChange:Z=>p({...d,height:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"170",min:"100",max:"250",step:"0.1",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weight (kg) *"}),l.jsxs("div",{className:"relative",children:[l.jsx(x7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsx("input",{type:"number",value:d.weight,onChange:Z=>p({...d,weight:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:"70",min:"30",max:"300",step:"0.1",required:!0})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Blood Group"}),l.jsxs("div",{className:"relative",children:[l.jsx(b7,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5",style:{color:"#5C4F3D"}}),l.jsxs("select",{value:d.bloodGroup,onChange:Z=>p({...d,bloodGroup:Z.target.value}),className:"w-full bg-white rounded-xl py-3 pl-12 pr-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select (Optional)"}),l.jsx("option",{value:"A+",children:"A+"}),l.jsx("option",{value:"A-",children:"A-"}),l.jsx("option",{value:"B+",children:"B+"}),l.jsx("option",{value:"B-",children:"B-"}),l.jsx("option",{value:"AB+",children:"AB+"}),l.jsx("option",{value:"AB-",children:"AB-"}),l.jsx("option",{value:"O+",children:"O+"}),l.jsx("option",{value:"O-",children:"O-"})]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Dietary Preference *"}),l.jsxs("select",{value:d.dietaryPreference,onChange:Z=>p({...d,dietaryPreference:Z.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"This helps us recommend suitable diet plans"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Activity Level *"}),l.jsxs("select",{value:d.activityLevel,onChange:Z=>p({...d,activityLevel:Z.target.value}),className:"w-full bg-white rounded-xl py-3 px-4 focus:outline-none",style:{border:"1px solid #E5DFD3",color:"#2C2416"},required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"lightly_active",children:"Lightly Active (1-3 days/week)"}),l.jsx("option",{value:"moderately_active",children:"Moderately Active (3-5 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (6-7 days/week)"}),l.jsx("option",{value:"extremely_active",children:"Extremely Active (Athlete)"})]}),l.jsx("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:"Used to calculate your daily calorie needs"})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(so,{className:"w-5 h-5"})]})]})]})})]});if(e===4){const Z=["Diabetes","Hypertension","Thyroid","Asthma","Heart Disease","Arthritis"],ie=["Peanuts","Dairy","Gluten","Shellfish","Eggs","Soy"];return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Di,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Lifestyle & Health History"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"Help us understand your lifestyle and medical background for better recommendations."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Lifestyle & Medical History"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 3 of 4 - Optional but recommended"})]}),l.jsxs("form",{onSubmit:te=>{te.preventDefault(),W()},className:"space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Lifestyle Habits"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(lTe,{className:"w-4 h-4"}),"Do you smoke?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.smoker,onChange:()=>p({...d,smoker:!1,smokingFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.smoker,onChange:()=>p({...d,smoker:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.smoker&&l.jsxs("select",{value:d.smokingFrequency,onChange:te=>p({...d,smokingFrequency:te.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 times/week)"}),l.jsx("option",{value:"regular",children:"Regular (3-6 times/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (Daily)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(ATe,{className:"w-4 h-4"}),"Do you consume alcohol?"]}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:!d.alcohol,onChange:()=>p({...d,alcohol:!1,alcoholFrequency:""}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"No"})]}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",checked:d.alcohol,onChange:()=>p({...d,alcohol:!0}),className:"text-cyan-500"}),l.jsx("span",{className:"text-sm",style:{color:"#2C2416"},children:"Yes"})]})]}),d.alcohol&&l.jsxs("select",{value:d.alcoholFrequency,onChange:te=>p({...d,alcoholFrequency:te.target.value}),className:"mt-2 w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"",children:"Select frequency"}),l.jsx("option",{value:"occasional",children:"Occasional (1-2 drinks/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (3-7 drinks/week)"}),l.jsx("option",{value:"heavy",children:"Heavy (8+ drinks/week)"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(Vf,{className:"w-4 h-4"}),"Average sleep hours per night: ",d.sleepHours,"h"]}),l.jsx("input",{type:"range",min:"4",max:"12",value:d.sleepHours,onChange:te=>p({...d,sleepHours:te.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"4h"}),l.jsx("span",{children:"12h"})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"#2C2416"},children:[l.jsx(b7,{className:"w-4 h-4"}),"Water intake (glasses/day): ",d.waterIntake]}),l.jsx("input",{type:"range",min:"1",max:"15",value:d.waterIntake,onChange:te=>p({...d,waterIntake:te.target.value}),className:"w-full"}),l.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"#5C4F3D"},children:[l.jsx("span",{children:"1"}),l.jsx("span",{children:"15"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Stress Level"}),l.jsxs("select",{value:d.stressLevel,onChange:te=>p({...d,stressLevel:te.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"low",children:"Low"}),l.jsx("option",{value:"moderate",children:"Moderate"}),l.jsx("option",{value:"high",children:"High"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4",style:{border:"1px solid #E5DFD3"},children:[l.jsx("h3",{className:"font-semibold mb-4",style:{color:"#2C2416"},children:"Medical History (Optional)"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Z.map(te=>l.jsx("button",{type:"button",onClick:()=>z("chronicConditions",te),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${d.chronicConditions.includes(te)?"text-white":""}`,style:{backgroundColor:d.chronicConditions.includes(te)?"#8B7355":"#F5F1EA",color:d.chronicConditions.includes(te)?"white":"#5C4F3D"},children:te},te))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:T,onChange:te=>w(te.target.value),placeholder:"Add custom condition",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:te=>{te.key==="Enter"&&(te.preventDefault(),Y("chronicConditions",T),w(""))}}),l.jsx("button",{type:"button",onClick:()=>{Y("chronicConditions",T),w("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.chronicConditions.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.chronicConditions.map(te=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[te,l.jsx("button",{type:"button",onClick:()=>re("chronicConditions",te),children:l.jsx(Ji,{className:"w-3 h-3"})})]},te))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:ie.map(te=>l.jsx("button",{type:"button",onClick:()=>z("allergies",te),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors",style:{backgroundColor:d.allergies.includes(te)?"#8B7355":"#F5F1EA",color:d.allergies.includes(te)?"white":"#5C4F3D"},children:te},te))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:A,onChange:te=>k(te.target.value),placeholder:"Add custom allergy",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:te=>{te.key==="Enter"&&(te.preventDefault(),Y("allergies",A),k(""))}}),l.jsx("button",{type:"button",onClick:()=>{Y("allergies",A),k("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.allergies.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.allergies.map(te=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[te,l.jsx("button",{type:"button",onClick:()=>re("allergies",te),children:l.jsx(Ji,{className:"w-3 h-3"})})]},te))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Current Medications"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:te=>P(te.target.value),placeholder:"Add medication",className:"flex-1 rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},onKeyPress:te=>{te.key==="Enter"&&(te.preventDefault(),Y("currentMedications",N),P(""))}}),l.jsx("button",{type:"button",onClick:()=>{Y("currentMedications",N),P("")},className:"px-3 py-2 text-white rounded-lg text-sm",style:{backgroundColor:"#8B7355"},children:l.jsx(Wc,{className:"w-4 h-4"})})]}),d.currentMedications.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:d.currentMedications.map(te=>l.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"#F5F1EA",color:"#8B7355"},children:[te,l.jsx("button",{type:"button",onClick:()=>re("currentMedications",te),children:l.jsx(Ji,{className:"w-3 h-3"})})]},te))})]})]})]}),l.jsxs("button",{type:"submit",className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#8B7355"},children:["Continue ",l.jsx(so,{className:"w-5 h-5"})]})]})]})})]})}if(e===5){const ie=(()=>{if(!d.targetWeight||!d.weight)return null;const te=Math.abs(parseFloat(d.targetWeight)-parseFloat(d.weight));return Math.ceil(te/parseFloat(d.weeklyGoal))})();return l.jsxs("div",{className:"min-h-screen flex",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden",style:{background:"linear-gradient(to bottom right, #8B7355, #A0826D, #8B7355)"},children:[l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"}),l.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"})]}),l.jsxs("div",{className:"relative z-10 flex flex-col justify-center items-center p-12 text-white",children:[l.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-xl rounded-3xl flex items-center justify-center mb-8",children:l.jsx(Lh,{className:"w-10 h-10"})}),l.jsx("h1",{className:"text-4xl font-bold mb-4 text-center",children:"Set Your Goals"}),l.jsx("p",{className:"text-xl text-white/80 text-center max-w-md",children:"We'll calculate your personalized nutrition plan based on your goals."}),l.jsxs("div",{className:"mt-8 flex gap-2",children:[l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white/40"}),l.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})]})]})]}),l.jsx("div",{className:"flex-1 flex items-center justify-center p-8 overflow-y-auto",children:l.jsxs("div",{className:"w-full max-w-md py-8",children:[l.jsxs("button",{onClick:B,className:"flex items-center gap-2 mb-6",style:{color:"#5C4F3D"},children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-3xl font-bold mb-2",style:{color:"#2C2416"},children:"Your Nutrition Goals"}),l.jsx("p",{style:{color:"#5C4F3D"},children:"Step 4 of 4 - Almost done!"})]}),l.jsxs("form",{onSubmit:V,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"#2C2416"},children:"What's your primary goal?"}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"weight_loss"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_loss"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_loss"?"#F5F1EA":"white"},children:[l.jsx(FJ,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_loss"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Loss"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"weight_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="weight_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="weight_gain"?"#F5F1EA":"white"},children:[l.jsx(Ca,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="weight_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Weight Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"muscle_gain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="muscle_gain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="muscle_gain"?"#F5F1EA":"white"},children:[l.jsx(bP,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="muscle_gain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Muscle Gain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"maintain"}),className:"p-4 rounded-xl border-2 transition-all",style:{borderColor:d.nutritionGoal==="maintain"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="maintain"?"#F5F1EA":"white"},children:[l.jsx(l2,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="maintain"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"Maintain"})]}),l.jsxs("button",{type:"button",onClick:()=>p({...d,nutritionGoal:"general_health"}),className:"p-4 rounded-xl border-2 transition-all col-span-2",style:{borderColor:d.nutritionGoal==="general_health"?"#8B7355":"#E5DFD3",backgroundColor:d.nutritionGoal==="general_health"?"#F5F1EA":"white"},children:[l.jsx(Di,{className:"w-8 h-8 mx-auto mb-2",style:{color:d.nutritionGoal==="general_health"?"#8B7355":"#5C4F3D"}}),l.jsx("p",{className:"text-sm font-medium",style:{color:"#2C2416"},children:"General Health"})]})]})]}),(d.nutritionGoal==="weight_loss"||d.nutritionGoal==="weight_gain")&&l.jsxs("div",{className:"bg-white rounded-xl p-4 space-y-4",style:{border:"1px solid #E5DFD3"},children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Target Weight (kg)"}),l.jsx("input",{type:"number",value:d.targetWeight,onChange:te=>p({...d,targetWeight:te.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},placeholder:d.weight,min:"30",max:"300",step:"0.1"}),l.jsxs("p",{className:"text-xs mt-1",style:{color:"#5C4F3D"},children:["Current: ",d.weight," kg"]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"#2C2416"},children:"Weekly Goal"}),l.jsxs("select",{value:d.weeklyGoal,onChange:te=>p({...d,weeklyGoal:te.target.value}),className:"w-full rounded-lg py-2 px-3 text-sm",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3",color:"#2C2416"},children:[l.jsx("option",{value:"0.25",children:"0.25 kg/week (Slow & Steady)"}),l.jsx("option",{value:"0.5",children:"0.5 kg/week (Recommended)"}),l.jsx("option",{value:"1",children:"1 kg/week (Aggressive)"})]})]}),ie&&l.jsx("div",{className:"rounded-lg p-3",style:{backgroundColor:"#F5F1EA"},children:l.jsxs("p",{className:"text-sm",style:{color:"#8B7355"},children:[l.jsx("strong",{children:"Estimated time:"})," ",ie," weeks (",Math.ceil(ie/4)," months)"]})})]}),l.jsx("div",{className:"rounded-xl p-4",style:{backgroundColor:"#F5F1EA",border:"1px solid #E5DFD3"},children:l.jsxs("p",{className:"text-sm",style:{color:"#5C4F3D"},children:[l.jsx("strong",{style:{color:"#2C2416"},children:"What happens next?"})," We'll calculate your personalized daily calorie and macro goals based on your profile and goals. You can adjust these anytime from your nutrition dashboard."]})}),l.jsx("button",{type:"submit",disabled:b,className:"w-full py-3 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",style:{backgroundColor:"#8B7355"},children:b?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:["Create Account & Calculate Goals ",l.jsx(so,{className:"w-5 h-5"})]})})]})]})})]})}return null}const XTe=["General Physician","Cardiologist","Dermatologist","Endocrinologist","Gastroenterologist","Neurologist","Nutritionist","Oncologist","Orthopedic","Pediatrician","Psychiatrist","Pulmonologist"],S7=[{id:"license",name:"Medical License",description:"Valid medical license certificate"},{id:"degree",name:"Medical Degree",description:"MBBS/MD or equivalent degree certificate"},{id:"id_proof",name:"ID Proof",description:"Government issued ID (Aadhar/Passport)"}];function JTe(){const{registerDoctor:e}=ma(),n=Is(),[a,o]=q.useState(!1),[d,p]=q.useState(1),[f,v]=q.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",specialization:"",qualifications:"",experience:"",hospital:"",licenseNumber:"",consultationFee:"",bio:""}),[b,E]=q.useState({}),T=A=>{v({...f,[A.target.name]:A.target.value})},w=(A,k)=>{k&&E(I=>({...I,[A]:{file:k,name:k.name,size:(k.size/1024).toFixed(1)+" KB"}}))},N=A=>{E(k=>{const I={...k};return delete I[A],I})},P=async A=>{var I,F;if(A.preventDefault(),f.password!==f.confirmPassword){it.error("Passwords do not match");return}const k=S7.filter(U=>!b[U.id]);if(k.length>0){it.error(`Please upload: ${k.map(U=>U.name).join(", ")}`);return}o(!0);try{const U=Object.entries(b).map(([V,W])=>({name:W.name,type:V,url:`pending_upload_${V}`}));await e({...f,qualifications:f.qualifications.split(",").map(V=>V.trim()).filter(Boolean),experience:parseInt(f.experience),consultationFee:parseInt(f.consultationFee)||500,documents:U}),it.success("Registration successful! Your profile is pending approval."),n("/doctor/dashboard")}catch(U){it.error(((F=(I=U.response)==null?void 0:I.data)==null?void 0:F.message)||"Registration failed")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"w-full max-w-2xl",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs(hn,{to:"/",className:"inline-flex items-center gap-2 mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center",children:l.jsx(ir,{className:"w-7 h-7 text-white"})}),l.jsx("span",{className:"text-2xl font-bold text-slate-800",children:"HealthAI"})]}),l.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Doctor Registration"}),l.jsx("p",{className:"text-slate-500",children:"Join our platform and connect with patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-center gap-4 mb-8",children:[1,2,3].map(A=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-semibold ${d>=A?"bg-cyan-500 text-white":"bg-slate-200 text-slate-400"}`,children:A}),l.jsx("span",{className:`text-sm hidden sm:block ${d>=A?"text-cyan-600 font-medium":"text-slate-400"}`,children:A===1?"Account":A===2?"Professional":"Documents"}),A<3&&l.jsx("div",{className:`w-8 h-1 rounded ${d>A?"bg-cyan-500":"bg-slate-200"}`})]},A))}),l.jsxs("form",{onSubmit:P,children:[d===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:f.name,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"Dr. John Smith",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",name:"email",value:f.email,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"doctor@example.com",required:!0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone"}),l.jsx("input",{type:"tel",name:"phone",value:f.phone,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"+91 98765 43210"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Password"}),l.jsx("input",{type:"password",name:"password",value:f.password,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0,minLength:6})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Confirm Password"}),l.jsx("input",{type:"password",name:"confirmPassword",value:f.confirmPassword,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"",required:!0})]})]}),l.jsx("button",{type:"button",onClick:()=>p(2),className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all mt-4",children:"Continue "})]}),d===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Specialization"}),l.jsxs("select",{name:"specialization",value:f.specialization,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:outline-none",required:!0,children:[l.jsx("option",{value:"",children:"Select specialization"}),XTe.map(A=>l.jsx("option",{value:A,children:A},A))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Experience (years)"}),l.jsx("input",{type:"number",name:"experience",value:f.experience,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"5",required:!0,min:0})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Medical License Number"}),l.jsx("input",{type:"text",name:"licenseNumber",value:f.licenseNumber,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MCI-12345",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Qualifications (comma separated)"}),l.jsx("input",{type:"text",name:"qualifications",value:f.qualifications,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"MBBS, MD, FRCP"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",name:"hospital",value:f.hospital,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"City Hospital"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consultation Fee ()"}),l.jsx("input",{type:"number",name:"consultationFee",value:f.consultationFee,onChange:T,className:"w-full bg-white border border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none",placeholder:"500",min:0})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4",children:[l.jsxs("button",{type:"button",onClick:()=>p(1),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"button",onClick:()=>p(3),className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:"Continue "})]})]}),d===3&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:l.jsxs("p",{className:"text-sm text-amber-800",children:[l.jsx("strong",{children:"Important:"})," Please upload clear copies of the following documents. These will be reviewed by our admin team before your profile is approved."]})}),S7.map(A=>l.jsxs("div",{className:"border border-slate-200 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("h4",{className:"font-medium text-slate-800",children:[A.name," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:A.description})]}),b[A.id]?l.jsx(bi,{className:"w-5 h-5 text-green-500"}):null]}),b[A.id]?l.jsxs("div",{className:"mt-3 flex items-center justify-between bg-slate-50 rounded-lg p-3",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-slate-700",children:b[A.id].name}),l.jsx("p",{className:"text-xs text-slate-500",children:b[A.id].size})]})]}),l.jsx("button",{type:"button",onClick:()=>N(A.id),className:"p-1 text-slate-400 hover:text-red-500",children:l.jsx(Ji,{className:"w-4 h-4"})})]}):l.jsxs("label",{className:"mt-3 flex items-center justify-center gap-2 p-4 border-2 border-dashed border-slate-200 rounded-lg cursor-pointer hover:border-cyan-500 hover:bg-cyan-50 transition-all",children:[l.jsx(lo,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload"}),l.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:k=>w(A.id,k.target.files[0])})]})]},A.id)),l.jsxs("div",{className:"flex gap-3 mt-6",children:[l.jsxs("button",{type:"button",onClick:()=>p(2),className:"flex-1 py-3 bg-slate-100 text-slate-700 font-semibold rounded-xl hover:bg-slate-200 transition-all flex items-center justify-center gap-2",children:[l.jsx(co,{className:"w-4 h-4"})," Back"]}),l.jsx("button",{type:"submit",disabled:a,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:a?"Submitting...":"Submit Application"})]})]})]}),l.jsxs("p",{className:"text-center text-slate-500 mt-6",children:["Already have an account? ",l.jsx(hn,{to:"/login",className:"text-cyan-600 hover:text-cyan-700 font-medium",children:"Sign in"})]})]}),l.jsxs("p",{className:"text-center text-sm text-slate-500 mt-6 flex items-center justify-center gap-2",children:[l.jsx(MJ,{className:"w-4 h-4"}),"Your profile will be reviewed by our admin team before being listed."]})]})})}const Vv="healthai_cache_",QTe=5*60*1e3,Lc={set(e,n,a=QTe){try{const o={value:n,expiry:Date.now()+a};localStorage.setItem(Vv+e,JSON.stringify(o))}catch(o){console.error("Cache set error:",o)}},get(e){try{const n=localStorage.getItem(Vv+e);if(!n)return null;const a=JSON.parse(n);return Date.now()>a.expiry?(this.delete(e),null):a.value}catch(n){return console.error("Cache get error:",n),null}},delete(e){try{localStorage.removeItem(Vv+e)}catch(n){console.error("Cache delete error:",n)}},clear(){try{Object.keys(localStorage).forEach(n=>{n.startsWith(Vv)&&localStorage.removeItem(n)})}catch(e){console.error("Cache clear error:",e)}},cleanup(){try{Object.keys(localStorage).forEach(n=>{if(n.startsWith(Vv)){const a=localStorage.getItem(n);if(a){const o=JSON.parse(a);Date.now()>o.expiry&&localStorage.removeItem(n)}}})}catch(e){console.error("Cache cleanup error:",e)}}};Lc.cleanup();setInterval(()=>Lc.cleanup(),5*60*1e3);const GJ=q.createContext(),ZTe=()=>{const e=q.useContext(GJ);if(!e)throw new Error("useData must be used within DataProvider");return e},eCe=({children:e})=>{const[n,a]=q.useState(null),[o,d]=q.useState(null),[p,f]=q.useState(null),[v,b]=q.useState({dashboard:!1,wearable:!1,nutrition:!1}),E=q.useCallback(async(A=!1)=>{if(!A){const k=Lc.get("dashboard");if(k)return a(k),k}b(k=>({...k,dashboard:!0}));try{const I=(await Nh.getDashboard()).data;return a(I),Lc.set("dashboard",I,3*60*1e3),I}catch(k){throw console.error("Failed to fetch dashboard:",k),k}finally{b(k=>({...k,dashboard:!1}))}},[]),T=q.useCallback(async(A=!1)=>{if(!A){const k=Lc.get("wearable");if(k)return d(k),k}b(k=>({...k,wearable:!0}));try{const I=(await xm.getDashboard()).data;return d(I),Lc.set("wearable",I,2*60*1e3),I}catch(k){console.error("Failed to fetch wearable:",k);const I={connected:!1};return d(I),I}finally{b(k=>({...k,wearable:!1}))}},[]),w=q.useCallback(async(A,k=!1)=>{var F;const I=`nutrition_${A}`;if(!k){const U=Lc.get(I);if(U)return f(U),U}b(U=>({...U,nutrition:!0}));try{const V=((F=(await Jwe.getDailySummary(A)).data)==null?void 0:F.summary)||null;return f(V),V&&Lc.set(I,V,5*60*1e3),V}catch(U){return console.error("Failed to fetch nutrition:",U),f(null),null}finally{b(U=>({...U,nutrition:!1}))}},[]),N=q.useCallback((A=[])=>{A.length===0?(Lc.clear(),a(null),d(null),f(null)):A.forEach(k=>{Lc.delete(k),k==="dashboard"&&a(null),k==="wearable"&&d(null),k.startsWith("nutrition_")&&f(null)})},[]),P={dashboardData:n,wearableData:o,nutritionData:p,loading:v,fetchDashboard:E,fetchWearable:T,fetchNutrition:w,invalidateCache:N};return l.jsx(GJ.Provider,{value:P,children:e})};function WJ(e){var n,a,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(n=0;n<d;n++)e[n]&&(a=WJ(e[n]))&&(o&&(o+=" "),o+=a)}else for(a in e)e[a]&&(o&&(o+=" "),o+=a);return o}function On(){for(var e,n,a=0,o="",d=arguments.length;a<d;a++)(e=arguments[a])&&(n=WJ(e))&&(o&&(o+=" "),o+=n);return o}var tCe=Array.isArray,is=tCe,nCe=typeof Id=="object"&&Id&&Id.Object===Object&&Id,$J=nCe,rCe=$J,iCe=typeof self=="object"&&self&&self.Object===Object&&self,aCe=rCe||iCe||Function("return this")(),Xc=aCe,sCe=Xc,oCe=sCe.Symbol,j0=oCe,w7=j0,HJ=Object.prototype,cCe=HJ.hasOwnProperty,lCe=HJ.toString,Bv=w7?w7.toStringTag:void 0;function dCe(e){var n=cCe.call(e,Bv),a=e[Bv];try{e[Bv]=void 0;var o=!0}catch{}var d=lCe.call(e);return o&&(n?e[Bv]=a:delete e[Bv]),d}var uCe=dCe,hCe=Object.prototype,pCe=hCe.toString;function mCe(e){return pCe.call(e)}var fCe=mCe,T7=j0,gCe=uCe,vCe=fCe,yCe="[object Null]",_Ce="[object Undefined]",C7=T7?T7.toStringTag:void 0;function bCe(e){return e==null?e===void 0?_Ce:yCe:C7&&C7 in Object(e)?gCe(e):vCe(e)}var Fl=bCe;function ECe(e){return e!=null&&typeof e=="object"}var Vl=ECe,xCe=Fl,SCe=Vl,wCe="[object Symbol]";function TCe(e){return typeof e=="symbol"||SCe(e)&&xCe(e)==wCe}var Wf=TCe,CCe=is,NCe=Wf,RCe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ACe=/^\w*$/;function ICe(e,n){if(CCe(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||NCe(e)?!0:ACe.test(e)||!RCe.test(e)||n!=null&&e in Object(n)}var h2=ICe;function OCe(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var iu=OCe;const $f=ar(iu);var PCe=Fl,DCe=iu,kCe="[object AsyncFunction]",jCe="[object Function]",LCe="[object GeneratorFunction]",MCe="[object Proxy]";function UCe(e){if(!DCe(e))return!1;var n=PCe(e);return n==jCe||n==LCe||n==kCe||n==MCe}var p2=UCe;const pn=ar(p2);var FCe=Xc,VCe=FCe["__core-js_shared__"],BCe=VCe,MO=BCe,N7=function(){var e=/[^.]+$/.exec(MO&&MO.keys&&MO.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function GCe(e){return!!N7&&N7 in e}var WCe=GCe,$Ce=Function.prototype,HCe=$Ce.toString;function zCe(e){if(e!=null){try{return HCe.call(e)}catch{}try{return e+""}catch{}}return""}var zJ=zCe,KCe=p2,YCe=WCe,qCe=iu,XCe=zJ,JCe=/[\\^$.*+?()[\]{}|]/g,QCe=/^\[object .+?Constructor\]$/,ZCe=Function.prototype,eNe=Object.prototype,tNe=ZCe.toString,nNe=eNe.hasOwnProperty,rNe=RegExp("^"+tNe.call(nNe).replace(JCe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function iNe(e){if(!qCe(e)||YCe(e))return!1;var n=KCe(e)?rNe:QCe;return n.test(XCe(e))}var aNe=iNe;function sNe(e,n){return e==null?void 0:e[n]}var oNe=sNe,cNe=aNe,lNe=oNe;function dNe(e,n){var a=lNe(e,n);return cNe(a)?a:void 0}var $h=dNe,uNe=$h,hNe=uNe(Object,"create"),Zw=hNe,R7=Zw;function pNe(){this.__data__=R7?R7(null):{},this.size=0}var mNe=pNe;function fNe(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}var gNe=fNe,vNe=Zw,yNe="__lodash_hash_undefined__",_Ne=Object.prototype,bNe=_Ne.hasOwnProperty;function ENe(e){var n=this.__data__;if(vNe){var a=n[e];return a===yNe?void 0:a}return bNe.call(n,e)?n[e]:void 0}var xNe=ENe,SNe=Zw,wNe=Object.prototype,TNe=wNe.hasOwnProperty;function CNe(e){var n=this.__data__;return SNe?n[e]!==void 0:TNe.call(n,e)}var NNe=CNe,RNe=Zw,ANe="__lodash_hash_undefined__";function INe(e,n){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=RNe&&n===void 0?ANe:n,this}var ONe=INe,PNe=mNe,DNe=gNe,kNe=xNe,jNe=NNe,LNe=ONe;function Hf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Hf.prototype.clear=PNe;Hf.prototype.delete=DNe;Hf.prototype.get=kNe;Hf.prototype.has=jNe;Hf.prototype.set=LNe;var MNe=Hf;function UNe(){this.__data__=[],this.size=0}var FNe=UNe;function VNe(e,n){return e===n||e!==e&&n!==n}var m2=VNe,BNe=m2;function GNe(e,n){for(var a=e.length;a--;)if(BNe(e[a][0],n))return a;return-1}var eT=GNe,WNe=eT,$Ne=Array.prototype,HNe=$Ne.splice;function zNe(e){var n=this.__data__,a=WNe(n,e);if(a<0)return!1;var o=n.length-1;return a==o?n.pop():HNe.call(n,a,1),--this.size,!0}var KNe=zNe,YNe=eT;function qNe(e){var n=this.__data__,a=YNe(n,e);return a<0?void 0:n[a][1]}var XNe=qNe,JNe=eT;function QNe(e){return JNe(this.__data__,e)>-1}var ZNe=QNe,eRe=eT;function tRe(e,n){var a=this.__data__,o=eRe(a,e);return o<0?(++this.size,a.push([e,n])):a[o][1]=n,this}var nRe=tRe,rRe=FNe,iRe=KNe,aRe=XNe,sRe=ZNe,oRe=nRe;function zf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}zf.prototype.clear=rRe;zf.prototype.delete=iRe;zf.prototype.get=aRe;zf.prototype.has=sRe;zf.prototype.set=oRe;var tT=zf,cRe=$h,lRe=Xc,dRe=cRe(lRe,"Map"),f2=dRe,A7=MNe,uRe=tT,hRe=f2;function pRe(){this.size=0,this.__data__={hash:new A7,map:new(hRe||uRe),string:new A7}}var mRe=pRe;function fRe(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}var gRe=fRe,vRe=gRe;function yRe(e,n){var a=e.__data__;return vRe(n)?a[typeof n=="string"?"string":"hash"]:a.map}var nT=yRe,_Re=nT;function bRe(e){var n=_Re(this,e).delete(e);return this.size-=n?1:0,n}var ERe=bRe,xRe=nT;function SRe(e){return xRe(this,e).get(e)}var wRe=SRe,TRe=nT;function CRe(e){return TRe(this,e).has(e)}var NRe=CRe,RRe=nT;function ARe(e,n){var a=RRe(this,e),o=a.size;return a.set(e,n),this.size+=a.size==o?0:1,this}var IRe=ARe,ORe=mRe,PRe=ERe,DRe=wRe,kRe=NRe,jRe=IRe;function Kf(e){var n=-1,a=e==null?0:e.length;for(this.clear();++n<a;){var o=e[n];this.set(o[0],o[1])}}Kf.prototype.clear=ORe;Kf.prototype.delete=PRe;Kf.prototype.get=DRe;Kf.prototype.has=kRe;Kf.prototype.set=jRe;var g2=Kf,KJ=g2,LRe="Expected a function";function v2(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError(LRe);var a=function(){var o=arguments,d=n?n.apply(this,o):o[0],p=a.cache;if(p.has(d))return p.get(d);var f=e.apply(this,o);return a.cache=p.set(d,f)||p,f};return a.cache=new(v2.Cache||KJ),a}v2.Cache=KJ;var YJ=v2;const MRe=ar(YJ);var URe=YJ,FRe=500;function VRe(e){var n=URe(e,function(o){return a.size===FRe&&a.clear(),o}),a=n.cache;return n}var BRe=VRe,GRe=BRe,WRe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$Re=/\\(\\)?/g,HRe=GRe(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(WRe,function(a,o,d,p){n.push(d?p.replace($Re,"$1"):o||a)}),n}),zRe=HRe;function KRe(e,n){for(var a=-1,o=e==null?0:e.length,d=Array(o);++a<o;)d[a]=n(e[a],a,e);return d}var y2=KRe,I7=j0,YRe=y2,qRe=is,XRe=Wf,O7=I7?I7.prototype:void 0,P7=O7?O7.toString:void 0;function qJ(e){if(typeof e=="string")return e;if(qRe(e))return YRe(e,qJ)+"";if(XRe(e))return P7?P7.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var JRe=qJ,QRe=JRe;function ZRe(e){return e==null?"":QRe(e)}var XJ=ZRe,eAe=is,tAe=h2,nAe=zRe,rAe=XJ;function iAe(e,n){return eAe(e)?e:tAe(e,n)?[e]:nAe(rAe(e))}var JJ=iAe,aAe=Wf;function sAe(e){if(typeof e=="string"||aAe(e))return e;var n=e+"";return n=="0"&&1/e==-1/0?"-0":n}var rT=sAe,oAe=JJ,cAe=rT;function lAe(e,n){n=oAe(n,e);for(var a=0,o=n.length;e!=null&&a<o;)e=e[cAe(n[a++])];return a&&a==o?e:void 0}var _2=lAe,dAe=_2;function uAe(e,n,a){var o=e==null?void 0:dAe(e,n);return o===void 0?a:o}var QJ=uAe;const po=ar(QJ);function hAe(e){return e==null}var pAe=hAe;const bn=ar(pAe);var mAe=Fl,fAe=is,gAe=Vl,vAe="[object String]";function yAe(e){return typeof e=="string"||!fAe(e)&&gAe(e)&&mAe(e)==vAe}var _Ae=yAe;const Mh=ar(_Ae);var ZJ={exports:{}},Qn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b2=Symbol.for("react.element"),E2=Symbol.for("react.portal"),iT=Symbol.for("react.fragment"),aT=Symbol.for("react.strict_mode"),sT=Symbol.for("react.profiler"),oT=Symbol.for("react.provider"),cT=Symbol.for("react.context"),bAe=Symbol.for("react.server_context"),lT=Symbol.for("react.forward_ref"),dT=Symbol.for("react.suspense"),uT=Symbol.for("react.suspense_list"),hT=Symbol.for("react.memo"),pT=Symbol.for("react.lazy"),EAe=Symbol.for("react.offscreen"),eQ;eQ=Symbol.for("react.module.reference");function yo(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case b2:switch(e=e.type,e){case iT:case sT:case aT:case dT:case uT:return e;default:switch(e=e&&e.$$typeof,e){case bAe:case cT:case lT:case pT:case hT:case oT:return e;default:return n}}case E2:return n}}}Qn.ContextConsumer=cT;Qn.ContextProvider=oT;Qn.Element=b2;Qn.ForwardRef=lT;Qn.Fragment=iT;Qn.Lazy=pT;Qn.Memo=hT;Qn.Portal=E2;Qn.Profiler=sT;Qn.StrictMode=aT;Qn.Suspense=dT;Qn.SuspenseList=uT;Qn.isAsyncMode=function(){return!1};Qn.isConcurrentMode=function(){return!1};Qn.isContextConsumer=function(e){return yo(e)===cT};Qn.isContextProvider=function(e){return yo(e)===oT};Qn.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===b2};Qn.isForwardRef=function(e){return yo(e)===lT};Qn.isFragment=function(e){return yo(e)===iT};Qn.isLazy=function(e){return yo(e)===pT};Qn.isMemo=function(e){return yo(e)===hT};Qn.isPortal=function(e){return yo(e)===E2};Qn.isProfiler=function(e){return yo(e)===sT};Qn.isStrictMode=function(e){return yo(e)===aT};Qn.isSuspense=function(e){return yo(e)===dT};Qn.isSuspenseList=function(e){return yo(e)===uT};Qn.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===iT||e===sT||e===aT||e===dT||e===uT||e===EAe||typeof e=="object"&&e!==null&&(e.$$typeof===pT||e.$$typeof===hT||e.$$typeof===oT||e.$$typeof===cT||e.$$typeof===lT||e.$$typeof===eQ||e.getModuleId!==void 0)};Qn.typeOf=yo;ZJ.exports=Qn;var xAe=ZJ.exports,SAe=Fl,wAe=Vl,TAe="[object Number]";function CAe(e){return typeof e=="number"||wAe(e)&&SAe(e)==TAe}var tQ=CAe;const NAe=ar(tQ);var RAe=tQ;function AAe(e){return RAe(e)&&e!=+e}var IAe=AAe;const Yf=ar(IAe);var Zo=function(n){return n===0?0:n>0?1:-1},_h=function(n){return Mh(n)&&n.indexOf("%")===n.length-1},ct=function(n){return NAe(n)&&!Yf(n)},OAe=function(n){return bn(n)},Ei=function(n){return ct(n)||Mh(n)},PAe=0,qf=function(n){var a=++PAe;return"".concat(n||"").concat(a)},Uh=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!ct(n)&&!Mh(n))return o;var p;if(_h(n)){var f=n.indexOf("%");p=a*parseFloat(n.slice(0,f))/100}else p=+n;return Yf(p)&&(p=o),d&&p>a&&(p=a),p},Ad=function(n){if(!n)return null;var a=Object.keys(n);return a&&a.length?n[a[0]]:null},DAe=function(n){if(!Array.isArray(n))return!1;for(var a=n.length,o={},d=0;d<a;d++)if(!o[n[d]])o[n[d]]=!0;else return!0;return!1},Yi=function(n,a){return ct(n)&&ct(a)?function(o){return n+o*(a-n)}:function(){return a}};function yS(e,n,a){return!e||!e.length?null:e.find(function(o){return o&&(typeof n=="function"?n(o):po(o,n))===a})}var kAe=function(n,a){return ct(n)&&ct(a)?n-a:Mh(n)&&Mh(a)?n.localeCompare(a):n instanceof Date&&a instanceof Date?n.getTime()-a.getTime():String(n).localeCompare(String(a))};function zm(e,n){for(var a in e)if({}.hasOwnProperty.call(e,a)&&(!{}.hasOwnProperty.call(n,a)||e[a]!==n[a]))return!1;for(var o in n)if({}.hasOwnProperty.call(n,o)&&!{}.hasOwnProperty.call(e,o))return!1;return!0}function TP(e){"@babel/helpers - typeof";return TP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},TP(e)}var jAe=["viewBox","children"],LAe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],D7=["points","pathLength"],UO={svg:jAe,polygon:D7,polyline:D7},x2=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],_S=function(n,a){if(!n||typeof n=="function"||typeof n=="boolean")return null;var o=n;if(q.isValidElement(n)&&(o=n.props),!$f(o))return null;var d={};return Object.keys(o).forEach(function(p){x2.includes(p)&&(d[p]=a||function(f){return o[p](o,f)})}),d},MAe=function(n,a,o){return function(d){return n(a,o,d),null}},bS=function(n,a,o){if(!$f(n)||TP(n)!=="object")return null;var d=null;return Object.keys(n).forEach(function(p){var f=n[p];x2.includes(p)&&typeof f=="function"&&(d||(d={}),d[p]=MAe(f,a,o))}),d},UAe=["children"],FAe=["children"];function k7(e,n){if(e==null)return{};var a=VAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function VAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function CP(e){"@babel/helpers - typeof";return CP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},CP(e)}var j7={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},wl=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},L7=null,FO=null,S2=function e(n){if(n===L7&&Array.isArray(FO))return FO;var a=[];return q.Children.forEach(n,function(o){bn(o)||(xAe.isFragment(o)?a=a.concat(e(o.props.children)):a.push(o))}),FO=a,L7=n,a};function mo(e,n){var a=[],o=[];return Array.isArray(n)?o=n.map(function(d){return wl(d)}):o=[wl(n)],S2(e).forEach(function(d){var p=po(d,"type.displayName")||po(d,"type.name");o.indexOf(p)!==-1&&a.push(d)}),a}function Es(e,n){var a=mo(e,n);return a&&a[0]}var M7=function(n){if(!n||!n.props)return!1;var a=n.props,o=a.width,d=a.height;return!(!ct(o)||o<=0||!ct(d)||d<=0)},BAe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],GAe=function(n){return n&&n.type&&Mh(n.type)&&BAe.indexOf(n.type)>=0},nQ=function(n){return n&&CP(n)==="object"&&"clipDot"in n},WAe=function(n,a,o,d){var p,f=(p=UO==null?void 0:UO[d])!==null&&p!==void 0?p:[];return a.startsWith("data-")||!pn(n)&&(d&&f.includes(a)||LAe.includes(a))||o&&x2.includes(a)},yn=function(n,a,o){if(!n||typeof n=="function"||typeof n=="boolean")return null;var d=n;if(q.isValidElement(n)&&(d=n.props),!$f(d))return null;var p={};return Object.keys(d).forEach(function(f){var v;WAe((v=d)===null||v===void 0?void 0:v[f],f,a,o)&&(p[f]=d[f])}),p},NP=function e(n,a){if(n===a)return!0;var o=q.Children.count(n);if(o!==q.Children.count(a))return!1;if(o===0)return!0;if(o===1)return U7(Array.isArray(n)?n[0]:n,Array.isArray(a)?a[0]:a);for(var d=0;d<o;d++){var p=n[d],f=a[d];if(Array.isArray(p)||Array.isArray(f)){if(!e(p,f))return!1}else if(!U7(p,f))return!1}return!0},U7=function(n,a){if(bn(n)&&bn(a))return!0;if(!bn(n)&&!bn(a)){var o=n.props||{},d=o.children,p=k7(o,UAe),f=a.props||{},v=f.children,b=k7(f,FAe);return d&&v?zm(p,b)&&NP(d,v):!d&&!v?zm(p,b):!1}return!1},F7=function(n,a){var o=[],d={};return S2(n).forEach(function(p,f){if(GAe(p))o.push(p);else if(p){var v=wl(p.type),b=a[v]||{},E=b.handler,T=b.once;if(E&&(!T||!d[v])){var w=E(p,v,f);o.push(w),d[v]=!0}}}),o},$Ae=function(n){var a=n&&n.type;return a&&j7[a]?j7[a]:null},HAe=function(n,a){return S2(a).indexOf(n)},zAe=["children","width","height","viewBox","className","style","title","desc"];function RP(){return RP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},RP.apply(this,arguments)}function KAe(e,n){if(e==null)return{};var a=YAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function YAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function AP(e){var n=e.children,a=e.width,o=e.height,d=e.viewBox,p=e.className,f=e.style,v=e.title,b=e.desc,E=KAe(e,zAe),T=d||{width:a,height:o,x:0,y:0},w=On("recharts-surface",p);return fe.createElement("svg",RP({},yn(E,!0,"svg"),{className:w,width:a,height:o,style:f,viewBox:"".concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height)}),fe.createElement("title",null,v),fe.createElement("desc",null,b),n)}var qAe=["children","className"];function IP(){return IP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},IP.apply(this,arguments)}function XAe(e,n){if(e==null)return{};var a=JAe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function JAe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var mr=fe.forwardRef(function(e,n){var a=e.children,o=e.className,d=XAe(e,qAe),p=On("recharts-layer",o);return fe.createElement("g",IP({className:p},yn(d,!0),{ref:n}),a)}),Tl=function(n,a){for(var o=arguments.length,d=new Array(o>2?o-2:0),p=2;p<o;p++)d[p-2]=arguments[p]};function QAe(e,n,a){var o=-1,d=e.length;n<0&&(n=-n>d?0:d+n),a=a>d?d:a,a<0&&(a+=d),d=n>a?0:a-n>>>0,n>>>=0;for(var p=Array(d);++o<d;)p[o]=e[o+n];return p}var ZAe=QAe,eIe=ZAe;function tIe(e,n,a){var o=e.length;return a=a===void 0?o:a,!n&&a>=o?e:eIe(e,n,a)}var nIe=tIe,rIe="\\ud800-\\udfff",iIe="\\u0300-\\u036f",aIe="\\ufe20-\\ufe2f",sIe="\\u20d0-\\u20ff",oIe=iIe+aIe+sIe,cIe="\\ufe0e\\ufe0f",lIe="\\u200d",dIe=RegExp("["+lIe+rIe+oIe+cIe+"]");function uIe(e){return dIe.test(e)}var rQ=uIe;function hIe(e){return e.split("")}var pIe=hIe,iQ="\\ud800-\\udfff",mIe="\\u0300-\\u036f",fIe="\\ufe20-\\ufe2f",gIe="\\u20d0-\\u20ff",vIe=mIe+fIe+gIe,yIe="\\ufe0e\\ufe0f",_Ie="["+iQ+"]",OP="["+vIe+"]",PP="\\ud83c[\\udffb-\\udfff]",bIe="(?:"+OP+"|"+PP+")",aQ="[^"+iQ+"]",sQ="(?:\\ud83c[\\udde6-\\uddff]){2}",oQ="[\\ud800-\\udbff][\\udc00-\\udfff]",EIe="\\u200d",cQ=bIe+"?",lQ="["+yIe+"]?",xIe="(?:"+EIe+"(?:"+[aQ,sQ,oQ].join("|")+")"+lQ+cQ+")*",SIe=lQ+cQ+xIe,wIe="(?:"+[aQ+OP+"?",OP,sQ,oQ,_Ie].join("|")+")",TIe=RegExp(PP+"(?="+PP+")|"+wIe+SIe,"g");function CIe(e){return e.match(TIe)||[]}var NIe=CIe,RIe=pIe,AIe=rQ,IIe=NIe;function OIe(e){return AIe(e)?IIe(e):RIe(e)}var PIe=OIe,DIe=nIe,kIe=rQ,jIe=PIe,LIe=XJ;function MIe(e){return function(n){n=LIe(n);var a=kIe(n)?jIe(n):void 0,o=a?a[0]:n.charAt(0),d=a?DIe(a,1).join(""):n.slice(1);return o[e]()+d}}var UIe=MIe,FIe=UIe,VIe=FIe("toUpperCase"),BIe=VIe;const mT=ar(BIe);function hr(e){return function(){return e}}const dQ=Math.cos,ES=Math.sin,sc=Math.sqrt,xS=Math.PI,fT=2*xS,DP=Math.PI,kP=2*DP,lh=1e-6,GIe=kP-lh;function uQ(e){this._+=e[0];for(let n=1,a=e.length;n<a;++n)this._+=arguments[n]+e[n]}function WIe(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return uQ;const a=10**n;return function(o){this._+=o[0];for(let d=1,p=o.length;d<p;++d)this._+=Math.round(arguments[d]*a)/a+o[d]}}class $Ie{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?uQ:WIe(n)}moveTo(n,a){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,a){this._append`L${this._x1=+n},${this._y1=+a}`}quadraticCurveTo(n,a,o,d){this._append`Q${+n},${+a},${this._x1=+o},${this._y1=+d}`}bezierCurveTo(n,a,o,d,p,f){this._append`C${+n},${+a},${+o},${+d},${this._x1=+p},${this._y1=+f}`}arcTo(n,a,o,d,p){if(n=+n,a=+a,o=+o,d=+d,p=+p,p<0)throw new Error(`negative radius: ${p}`);let f=this._x1,v=this._y1,b=o-n,E=d-a,T=f-n,w=v-a,N=T*T+w*w;if(this._x1===null)this._append`M${this._x1=n},${this._y1=a}`;else if(N>lh)if(!(Math.abs(w*b-E*T)>lh)||!p)this._append`L${this._x1=n},${this._y1=a}`;else{let P=o-f,A=d-v,k=b*b+E*E,I=P*P+A*A,F=Math.sqrt(k),U=Math.sqrt(N),V=p*Math.tan((DP-Math.acos((k+N-I)/(2*F*U)))/2),W=V/U,B=V/F;Math.abs(W-1)>lh&&this._append`L${n+W*T},${a+W*w}`,this._append`A${p},${p},0,0,${+(w*P>T*A)},${this._x1=n+B*b},${this._y1=a+B*E}`}}arc(n,a,o,d,p,f){if(n=+n,a=+a,o=+o,f=!!f,o<0)throw new Error(`negative radius: ${o}`);let v=o*Math.cos(d),b=o*Math.sin(d),E=n+v,T=a+b,w=1^f,N=f?d-p:p-d;this._x1===null?this._append`M${E},${T}`:(Math.abs(this._x1-E)>lh||Math.abs(this._y1-T)>lh)&&this._append`L${E},${T}`,o&&(N<0&&(N=N%kP+kP),N>GIe?this._append`A${o},${o},0,1,${w},${n-v},${a-b}A${o},${o},0,1,${w},${this._x1=E},${this._y1=T}`:N>lh&&this._append`A${o},${o},0,${+(N>=DP)},${w},${this._x1=n+o*Math.cos(p)},${this._y1=a+o*Math.sin(p)}`)}rect(n,a,o,d){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+a}h${o=+o}v${+d}h${-o}Z`}toString(){return this._}}function w2(e){let n=3;return e.digits=function(a){if(!arguments.length)return n;if(a==null)n=null;else{const o=Math.floor(a);if(!(o>=0))throw new RangeError(`invalid digits: ${a}`);n=o}return e},()=>new $Ie(n)}function T2(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function hQ(e){this._context=e}hQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:this._context.lineTo(e,n);break}}};function gT(e){return new hQ(e)}function pQ(e){return e[0]}function mQ(e){return e[1]}function fQ(e,n){var a=hr(!0),o=null,d=gT,p=null,f=w2(v);e=typeof e=="function"?e:e===void 0?pQ:hr(e),n=typeof n=="function"?n:n===void 0?mQ:hr(n);function v(b){var E,T=(b=T2(b)).length,w,N=!1,P;for(o==null&&(p=d(P=f())),E=0;E<=T;++E)!(E<T&&a(w=b[E],E,b))===N&&((N=!N)?p.lineStart():p.lineEnd()),N&&p.point(+e(w,E,b),+n(w,E,b));if(P)return p=null,P+""||null}return v.x=function(b){return arguments.length?(e=typeof b=="function"?b:hr(+b),v):e},v.y=function(b){return arguments.length?(n=typeof b=="function"?b:hr(+b),v):n},v.defined=function(b){return arguments.length?(a=typeof b=="function"?b:hr(!!b),v):a},v.curve=function(b){return arguments.length?(d=b,o!=null&&(p=d(o)),v):d},v.context=function(b){return arguments.length?(b==null?o=p=null:p=d(o=b),v):o},v}function cx(e,n,a){var o=null,d=hr(!0),p=null,f=gT,v=null,b=w2(E);e=typeof e=="function"?e:e===void 0?pQ:hr(+e),n=typeof n=="function"?n:hr(n===void 0?0:+n),a=typeof a=="function"?a:a===void 0?mQ:hr(+a);function E(w){var N,P,A,k=(w=T2(w)).length,I,F=!1,U,V=new Array(k),W=new Array(k);for(p==null&&(v=f(U=b())),N=0;N<=k;++N){if(!(N<k&&d(I=w[N],N,w))===F)if(F=!F)P=N,v.areaStart(),v.lineStart();else{for(v.lineEnd(),v.lineStart(),A=N-1;A>=P;--A)v.point(V[A],W[A]);v.lineEnd(),v.areaEnd()}F&&(V[N]=+e(I,N,w),W[N]=+n(I,N,w),v.point(o?+o(I,N,w):V[N],a?+a(I,N,w):W[N]))}if(U)return v=null,U+""||null}function T(){return fQ().defined(d).curve(f).context(p)}return E.x=function(w){return arguments.length?(e=typeof w=="function"?w:hr(+w),o=null,E):e},E.x0=function(w){return arguments.length?(e=typeof w=="function"?w:hr(+w),E):e},E.x1=function(w){return arguments.length?(o=w==null?null:typeof w=="function"?w:hr(+w),E):o},E.y=function(w){return arguments.length?(n=typeof w=="function"?w:hr(+w),a=null,E):n},E.y0=function(w){return arguments.length?(n=typeof w=="function"?w:hr(+w),E):n},E.y1=function(w){return arguments.length?(a=w==null?null:typeof w=="function"?w:hr(+w),E):a},E.lineX0=E.lineY0=function(){return T().x(e).y(n)},E.lineY1=function(){return T().x(e).y(a)},E.lineX1=function(){return T().x(o).y(n)},E.defined=function(w){return arguments.length?(d=typeof w=="function"?w:hr(!!w),E):d},E.curve=function(w){return arguments.length?(f=w,p!=null&&(v=f(p)),E):f},E.context=function(w){return arguments.length?(w==null?p=v=null:v=f(p=w),E):p},E}class gQ{constructor(n,a){this._context=n,this._x=a}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,a){switch(n=+n,a=+a,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,a,n,a):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+a)/2,n,this._y0,n,a);break}}this._x0=n,this._y0=a}}function HIe(e){return new gQ(e,!0)}function zIe(e){return new gQ(e,!1)}const C2={draw(e,n){const a=sc(n/xS);e.moveTo(a,0),e.arc(0,0,a,0,fT)}},KIe={draw(e,n){const a=sc(n/5)/2;e.moveTo(-3*a,-a),e.lineTo(-a,-a),e.lineTo(-a,-3*a),e.lineTo(a,-3*a),e.lineTo(a,-a),e.lineTo(3*a,-a),e.lineTo(3*a,a),e.lineTo(a,a),e.lineTo(a,3*a),e.lineTo(-a,3*a),e.lineTo(-a,a),e.lineTo(-3*a,a),e.closePath()}},vQ=sc(1/3),YIe=vQ*2,qIe={draw(e,n){const a=sc(n/YIe),o=a*vQ;e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath()}},XIe={draw(e,n){const a=sc(n),o=-a/2;e.rect(o,o,a,a)}},JIe=.8908130915292852,yQ=ES(xS/10)/ES(7*xS/10),QIe=ES(fT/10)*yQ,ZIe=-dQ(fT/10)*yQ,eOe={draw(e,n){const a=sc(n*JIe),o=QIe*a,d=ZIe*a;e.moveTo(0,-a),e.lineTo(o,d);for(let p=1;p<5;++p){const f=fT*p/5,v=dQ(f),b=ES(f);e.lineTo(b*a,-v*a),e.lineTo(v*o-b*d,b*o+v*d)}e.closePath()}},VO=sc(3),tOe={draw(e,n){const a=-sc(n/(VO*3));e.moveTo(0,a*2),e.lineTo(-VO*a,-a),e.lineTo(VO*a,-a),e.closePath()}},Zs=-.5,eo=sc(3)/2,jP=1/sc(12),nOe=(jP/2+1)*3,rOe={draw(e,n){const a=sc(n/nOe),o=a/2,d=a*jP,p=o,f=a*jP+a,v=-p,b=f;e.moveTo(o,d),e.lineTo(p,f),e.lineTo(v,b),e.lineTo(Zs*o-eo*d,eo*o+Zs*d),e.lineTo(Zs*p-eo*f,eo*p+Zs*f),e.lineTo(Zs*v-eo*b,eo*v+Zs*b),e.lineTo(Zs*o+eo*d,Zs*d-eo*o),e.lineTo(Zs*p+eo*f,Zs*f-eo*p),e.lineTo(Zs*v+eo*b,Zs*b-eo*v),e.closePath()}};function iOe(e,n){let a=null,o=w2(d);e=typeof e=="function"?e:hr(e||C2),n=typeof n=="function"?n:hr(n===void 0?64:+n);function d(){let p;if(a||(a=p=o()),e.apply(this,arguments).draw(a,+n.apply(this,arguments)),p)return a=null,p+""||null}return d.type=function(p){return arguments.length?(e=typeof p=="function"?p:hr(p),d):e},d.size=function(p){return arguments.length?(n=typeof p=="function"?p:hr(+p),d):n},d.context=function(p){return arguments.length?(a=p??null,d):a},d}function SS(){}function wS(e,n,a){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+n)/6,(e._y0+4*e._y1+a)/6)}function _Q(e){this._context=e}_Q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:wS(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function aOe(e){return new _Q(e)}function bQ(e){this._context=e}bQ.prototype={areaStart:SS,areaEnd:SS,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._x2=e,this._y2=n;break;case 1:this._point=2,this._x3=e,this._y3=n;break;case 2:this._point=3,this._x4=e,this._y4=n,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+n)/6);break;default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function sOe(e){return new bQ(e)}function EQ(e){this._context=e}EQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var a=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(a,o):this._context.moveTo(a,o);break;case 3:this._point=4;default:wS(this,e,n);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n}};function oOe(e){return new EQ(e)}function xQ(e){this._context=e}xQ.prototype={areaStart:SS,areaEnd:SS,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,n){e=+e,n=+n,this._point?this._context.lineTo(e,n):(this._point=1,this._context.moveTo(e,n))}};function cOe(e){return new xQ(e)}function V7(e){return e<0?-1:1}function B7(e,n,a){var o=e._x1-e._x0,d=n-e._x1,p=(e._y1-e._y0)/(o||d<0&&-0),f=(a-e._y1)/(d||o<0&&-0),v=(p*d+f*o)/(o+d);return(V7(p)+V7(f))*Math.min(Math.abs(p),Math.abs(f),.5*Math.abs(v))||0}function G7(e,n){var a=e._x1-e._x0;return a?(3*(e._y1-e._y0)/a-n)/2:n}function BO(e,n,a){var o=e._x0,d=e._y0,p=e._x1,f=e._y1,v=(p-o)/3;e._context.bezierCurveTo(o+v,d+v*n,p-v,f-v*a,p,f)}function TS(e){this._context=e}TS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:BO(this,this._t0,G7(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,n){var a=NaN;if(e=+e,n=+n,!(e===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;break;case 2:this._point=3,BO(this,G7(this,a=B7(this,e,n)),a);break;default:BO(this,this._t0,a=B7(this,e,n));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=n,this._t0=a}}};function SQ(e){this._context=new wQ(e)}(SQ.prototype=Object.create(TS.prototype)).point=function(e,n){TS.prototype.point.call(this,n,e)};function wQ(e){this._context=e}wQ.prototype={moveTo:function(e,n){this._context.moveTo(n,e)},closePath:function(){this._context.closePath()},lineTo:function(e,n){this._context.lineTo(n,e)},bezierCurveTo:function(e,n,a,o,d,p){this._context.bezierCurveTo(n,e,o,a,p,d)}};function lOe(e){return new TS(e)}function dOe(e){return new SQ(e)}function TQ(e){this._context=e}TQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,n=this._y,a=e.length;if(a)if(this._line?this._context.lineTo(e[0],n[0]):this._context.moveTo(e[0],n[0]),a===2)this._context.lineTo(e[1],n[1]);else for(var o=W7(e),d=W7(n),p=0,f=1;f<a;++p,++f)this._context.bezierCurveTo(o[0][p],d[0][p],o[1][p],d[1][p],e[f],n[f]);(this._line||this._line!==0&&a===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,n){this._x.push(+e),this._y.push(+n)}};function W7(e){var n,a=e.length-1,o,d=new Array(a),p=new Array(a),f=new Array(a);for(d[0]=0,p[0]=2,f[0]=e[0]+2*e[1],n=1;n<a-1;++n)d[n]=1,p[n]=4,f[n]=4*e[n]+2*e[n+1];for(d[a-1]=2,p[a-1]=7,f[a-1]=8*e[a-1]+e[a],n=1;n<a;++n)o=d[n]/p[n-1],p[n]-=o,f[n]-=o*f[n-1];for(d[a-1]=f[a-1]/p[a-1],n=a-2;n>=0;--n)d[n]=(f[n]-d[n+1])/p[n];for(p[a-1]=(e[a]+d[a-1])/2,n=0;n<a-1;++n)p[n]=2*e[n+1]-d[n+1];return[d,p]}function uOe(e){return new TQ(e)}function vT(e,n){this._context=e,this._t=n}vT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,n){switch(e=+e,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,n):this._context.moveTo(e,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(e,n);else{var a=this._x*(1-this._t)+e*this._t;this._context.lineTo(a,this._y),this._context.lineTo(a,n)}break}}this._x=e,this._y=n}};function hOe(e){return new vT(e,.5)}function pOe(e){return new vT(e,0)}function mOe(e){return new vT(e,1)}function cf(e,n){if((f=e.length)>1)for(var a=1,o,d,p=e[n[0]],f,v=p.length;a<f;++a)for(d=p,p=e[n[a]],o=0;o<v;++o)p[o][1]+=p[o][0]=isNaN(d[o][1])?d[o][0]:d[o][1]}function LP(e){for(var n=e.length,a=new Array(n);--n>=0;)a[n]=n;return a}function fOe(e,n){return e[n]}function gOe(e){const n=[];return n.key=e,n}function vOe(){var e=hr([]),n=LP,a=cf,o=fOe;function d(p){var f=Array.from(e.apply(this,arguments),gOe),v,b=f.length,E=-1,T;for(const w of p)for(v=0,++E;v<b;++v)(f[v][E]=[0,+o(w,f[v].key,E,p)]).data=w;for(v=0,T=T2(n(f));v<b;++v)f[T[v]].index=v;return a(f,T),f}return d.keys=function(p){return arguments.length?(e=typeof p=="function"?p:hr(Array.from(p)),d):e},d.value=function(p){return arguments.length?(o=typeof p=="function"?p:hr(+p),d):o},d.order=function(p){return arguments.length?(n=p==null?LP:typeof p=="function"?p:hr(Array.from(p)),d):n},d.offset=function(p){return arguments.length?(a=p??cf,d):a},d}function yOe(e,n){if((o=e.length)>0){for(var a,o,d=0,p=e[0].length,f;d<p;++d){for(f=a=0;a<o;++a)f+=e[a][d][1]||0;if(f)for(a=0;a<o;++a)e[a][d][1]/=f}cf(e,n)}}function _Oe(e,n){if((d=e.length)>0){for(var a=0,o=e[n[0]],d,p=o.length;a<p;++a){for(var f=0,v=0;f<d;++f)v+=e[f][a][1]||0;o[a][1]+=o[a][0]=-v/2}cf(e,n)}}function bOe(e,n){if(!(!((f=e.length)>0)||!((p=(d=e[n[0]]).length)>0))){for(var a=0,o=1,d,p,f;o<p;++o){for(var v=0,b=0,E=0;v<f;++v){for(var T=e[n[v]],w=T[o][1]||0,N=T[o-1][1]||0,P=(w-N)/2,A=0;A<v;++A){var k=e[n[A]],I=k[o][1]||0,F=k[o-1][1]||0;P+=I-F}b+=w,E+=P*w}d[o-1][1]+=d[o-1][0]=a,b&&(a-=E/b)}d[o-1][1]+=d[o-1][0]=a,cf(e,n)}}function Vy(e){"@babel/helpers - typeof";return Vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Vy(e)}var EOe=["type","size","sizeType"];function MP(){return MP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},MP.apply(this,arguments)}function $7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function H7(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$7(Object(a),!0).forEach(function(o){xOe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function xOe(e,n,a){return n=SOe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function SOe(e){var n=wOe(e,"string");return Vy(n)=="symbol"?n:n+""}function wOe(e,n){if(Vy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Vy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function TOe(e,n){if(e==null)return{};var a=COe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function COe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var CQ={symbolCircle:C2,symbolCross:KIe,symbolDiamond:qIe,symbolSquare:XIe,symbolStar:eOe,symbolTriangle:tOe,symbolWye:rOe},NOe=Math.PI/180,ROe=function(n){var a="symbol".concat(mT(n));return CQ[a]||C2},AOe=function(n,a,o){if(a==="area")return n;switch(o){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var d=18*NOe;return 1.25*n*n*(Math.tan(d)-Math.tan(d*2)*Math.pow(Math.tan(d),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},IOe=function(n,a){CQ["symbol".concat(mT(n))]=a},N2=function(n){var a=n.type,o=a===void 0?"circle":a,d=n.size,p=d===void 0?64:d,f=n.sizeType,v=f===void 0?"area":f,b=TOe(n,EOe),E=H7(H7({},b),{},{type:o,size:p,sizeType:v}),T=function(){var I=ROe(o),F=iOe().type(I).size(AOe(p,v,o));return F()},w=E.className,N=E.cx,P=E.cy,A=yn(E,!0);return N===+N&&P===+P&&p===+p?fe.createElement("path",MP({},A,{className:On("recharts-symbols",w),transform:"translate(".concat(N,", ").concat(P,")"),d:T()})):null};N2.registerSymbol=IOe;function lf(e){"@babel/helpers - typeof";return lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lf(e)}function UP(){return UP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},UP.apply(this,arguments)}function z7(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function OOe(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?z7(Object(a),!0).forEach(function(o){By(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z7(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function POe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function DOe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,RQ(o.key),o)}}function kOe(e,n,a){return n&&DOe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function jOe(e,n,a){return n=CS(n),LOe(e,NQ()?Reflect.construct(n,a||[],CS(e).constructor):n.apply(e,a))}function LOe(e,n){if(n&&(lf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MOe(e)}function MOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NQ=function(){return!!e})()}function CS(e){return CS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},CS(e)}function UOe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&FP(e,n)}function FP(e,n){return FP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},FP(e,n)}function By(e,n,a){return n=RQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function RQ(e){var n=FOe(e,"string");return lf(n)=="symbol"?n:n+""}function FOe(e,n){if(lf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(lf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var to=32,R2=function(e){function n(){return POe(this,n),jOe(this,n,arguments)}return UOe(n,e),kOe(n,[{key:"renderIcon",value:function(o){var d=this.props.inactiveColor,p=to/2,f=to/6,v=to/3,b=o.inactive?d:o.color;if(o.type==="plainline")return fe.createElement("line",{strokeWidth:4,fill:"none",stroke:b,strokeDasharray:o.payload.strokeDasharray,x1:0,y1:p,x2:to,y2:p,className:"recharts-legend-icon"});if(o.type==="line")return fe.createElement("path",{strokeWidth:4,fill:"none",stroke:b,d:"M0,".concat(p,"h").concat(v,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*v,",").concat(p,`
            H`).concat(to,"M").concat(2*v,",").concat(p,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(v,",").concat(p),className:"recharts-legend-icon"});if(o.type==="rect")return fe.createElement("path",{stroke:"none",fill:b,d:"M0,".concat(to/8,"h").concat(to,"v").concat(to*3/4,"h").concat(-to,"z"),className:"recharts-legend-icon"});if(fe.isValidElement(o.legendIcon)){var E=OOe({},o);return delete E.legendIcon,fe.cloneElement(o.legendIcon,E)}return fe.createElement(N2,{fill:b,cx:p,cy:p,size:to,sizeType:"diameter",type:o.type})}},{key:"renderItems",value:function(){var o=this,d=this.props,p=d.payload,f=d.iconSize,v=d.layout,b=d.formatter,E=d.inactiveColor,T={x:0,y:0,width:to,height:to},w={display:v==="horizontal"?"inline-block":"block",marginRight:10},N={display:"inline-block",verticalAlign:"middle",marginRight:4};return p.map(function(P,A){var k=P.formatter||b,I=On(By(By({"recharts-legend-item":!0},"legend-item-".concat(A),!0),"inactive",P.inactive));if(P.type==="none")return null;var F=pn(P.value)?null:P.value;Tl(!pn(P.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var U=P.inactive?E:P.color;return fe.createElement("li",UP({className:I,style:w,key:"legend-item-".concat(A)},bS(o.props,P,A)),fe.createElement(AP,{width:f,height:f,viewBox:T,style:N},o.renderIcon(P)),fe.createElement("span",{className:"recharts-legend-item-text",style:{color:U}},k?k(F,P,A):F))})}},{key:"render",value:function(){var o=this.props,d=o.payload,p=o.layout,f=o.align;if(!d||!d.length)return null;var v={padding:0,margin:0,textAlign:p==="horizontal"?f:"left"};return fe.createElement("ul",{className:"recharts-default-legend",style:v},this.renderItems())}}])}(q.PureComponent);By(R2,"displayName","Legend");By(R2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var VOe=tT;function BOe(){this.__data__=new VOe,this.size=0}var GOe=BOe;function WOe(e){var n=this.__data__,a=n.delete(e);return this.size=n.size,a}var $Oe=WOe;function HOe(e){return this.__data__.get(e)}var zOe=HOe;function KOe(e){return this.__data__.has(e)}var YOe=KOe,qOe=tT,XOe=f2,JOe=g2,QOe=200;function ZOe(e,n){var a=this.__data__;if(a instanceof qOe){var o=a.__data__;if(!XOe||o.length<QOe-1)return o.push([e,n]),this.size=++a.size,this;a=this.__data__=new JOe(o)}return a.set(e,n),this.size=a.size,this}var e1e=ZOe,t1e=tT,n1e=GOe,r1e=$Oe,i1e=zOe,a1e=YOe,s1e=e1e;function Xf(e){var n=this.__data__=new t1e(e);this.size=n.size}Xf.prototype.clear=n1e;Xf.prototype.delete=r1e;Xf.prototype.get=i1e;Xf.prototype.has=a1e;Xf.prototype.set=s1e;var AQ=Xf,o1e="__lodash_hash_undefined__";function c1e(e){return this.__data__.set(e,o1e),this}var l1e=c1e;function d1e(e){return this.__data__.has(e)}var u1e=d1e,h1e=g2,p1e=l1e,m1e=u1e;function NS(e){var n=-1,a=e==null?0:e.length;for(this.__data__=new h1e;++n<a;)this.add(e[n])}NS.prototype.add=NS.prototype.push=p1e;NS.prototype.has=m1e;var IQ=NS;function f1e(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(n(e[a],a,e))return!0;return!1}var OQ=f1e;function g1e(e,n){return e.has(n)}var PQ=g1e,v1e=IQ,y1e=OQ,_1e=PQ,b1e=1,E1e=2;function x1e(e,n,a,o,d,p){var f=a&b1e,v=e.length,b=n.length;if(v!=b&&!(f&&b>v))return!1;var E=p.get(e),T=p.get(n);if(E&&T)return E==n&&T==e;var w=-1,N=!0,P=a&E1e?new v1e:void 0;for(p.set(e,n),p.set(n,e);++w<v;){var A=e[w],k=n[w];if(o)var I=f?o(k,A,w,n,e,p):o(A,k,w,e,n,p);if(I!==void 0){if(I)continue;N=!1;break}if(P){if(!y1e(n,function(F,U){if(!_1e(P,U)&&(A===F||d(A,F,a,o,p)))return P.push(U)})){N=!1;break}}else if(!(A===k||d(A,k,a,o,p))){N=!1;break}}return p.delete(e),p.delete(n),N}var DQ=x1e,S1e=Xc,w1e=S1e.Uint8Array,T1e=w1e;function C1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o,d){a[++n]=[d,o]}),a}var N1e=C1e;function R1e(e){var n=-1,a=Array(e.size);return e.forEach(function(o){a[++n]=o}),a}var A2=R1e,K7=j0,Y7=T1e,A1e=m2,I1e=DQ,O1e=N1e,P1e=A2,D1e=1,k1e=2,j1e="[object Boolean]",L1e="[object Date]",M1e="[object Error]",U1e="[object Map]",F1e="[object Number]",V1e="[object RegExp]",B1e="[object Set]",G1e="[object String]",W1e="[object Symbol]",$1e="[object ArrayBuffer]",H1e="[object DataView]",q7=K7?K7.prototype:void 0,GO=q7?q7.valueOf:void 0;function z1e(e,n,a,o,d,p,f){switch(a){case H1e:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case $1e:return!(e.byteLength!=n.byteLength||!p(new Y7(e),new Y7(n)));case j1e:case L1e:case F1e:return A1e(+e,+n);case M1e:return e.name==n.name&&e.message==n.message;case V1e:case G1e:return e==n+"";case U1e:var v=O1e;case B1e:var b=o&D1e;if(v||(v=P1e),e.size!=n.size&&!b)return!1;var E=f.get(e);if(E)return E==n;o|=k1e,f.set(e,n);var T=I1e(v(e),v(n),o,d,p,f);return f.delete(e),T;case W1e:if(GO)return GO.call(e)==GO.call(n)}return!1}var K1e=z1e;function Y1e(e,n){for(var a=-1,o=n.length,d=e.length;++a<o;)e[d+a]=n[a];return e}var kQ=Y1e,q1e=kQ,X1e=is;function J1e(e,n,a){var o=n(e);return X1e(e)?o:q1e(o,a(e))}var Q1e=J1e;function Z1e(e,n){for(var a=-1,o=e==null?0:e.length,d=0,p=[];++a<o;){var f=e[a];n(f,a,e)&&(p[d++]=f)}return p}var ePe=Z1e;function tPe(){return[]}var nPe=tPe,rPe=ePe,iPe=nPe,aPe=Object.prototype,sPe=aPe.propertyIsEnumerable,X7=Object.getOwnPropertySymbols,oPe=X7?function(e){return e==null?[]:(e=Object(e),rPe(X7(e),function(n){return sPe.call(e,n)}))}:iPe,cPe=oPe;function lPe(e,n){for(var a=-1,o=Array(e);++a<e;)o[a]=n(a);return o}var dPe=lPe,uPe=Fl,hPe=Vl,pPe="[object Arguments]";function mPe(e){return hPe(e)&&uPe(e)==pPe}var fPe=mPe,J7=fPe,gPe=Vl,jQ=Object.prototype,vPe=jQ.hasOwnProperty,yPe=jQ.propertyIsEnumerable,_Pe=J7(function(){return arguments}())?J7:function(e){return gPe(e)&&vPe.call(e,"callee")&&!yPe.call(e,"callee")},I2=_Pe,RS={exports:{}};function bPe(){return!1}var EPe=bPe;RS.exports;(function(e,n){var a=Xc,o=EPe,d=n&&!n.nodeType&&n,p=d&&!0&&e&&!e.nodeType&&e,f=p&&p.exports===d,v=f?a.Buffer:void 0,b=v?v.isBuffer:void 0,E=b||o;e.exports=E})(RS,RS.exports);var LQ=RS.exports,xPe=9007199254740991,SPe=/^(?:0|[1-9]\d*)$/;function wPe(e,n){var a=typeof e;return n=n??xPe,!!n&&(a=="number"||a!="symbol"&&SPe.test(e))&&e>-1&&e%1==0&&e<n}var O2=wPe,TPe=9007199254740991;function CPe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=TPe}var P2=CPe,NPe=Fl,RPe=P2,APe=Vl,IPe="[object Arguments]",OPe="[object Array]",PPe="[object Boolean]",DPe="[object Date]",kPe="[object Error]",jPe="[object Function]",LPe="[object Map]",MPe="[object Number]",UPe="[object Object]",FPe="[object RegExp]",VPe="[object Set]",BPe="[object String]",GPe="[object WeakMap]",WPe="[object ArrayBuffer]",$Pe="[object DataView]",HPe="[object Float32Array]",zPe="[object Float64Array]",KPe="[object Int8Array]",YPe="[object Int16Array]",qPe="[object Int32Array]",XPe="[object Uint8Array]",JPe="[object Uint8ClampedArray]",QPe="[object Uint16Array]",ZPe="[object Uint32Array]",wr={};wr[HPe]=wr[zPe]=wr[KPe]=wr[YPe]=wr[qPe]=wr[XPe]=wr[JPe]=wr[QPe]=wr[ZPe]=!0;wr[IPe]=wr[OPe]=wr[WPe]=wr[PPe]=wr[$Pe]=wr[DPe]=wr[kPe]=wr[jPe]=wr[LPe]=wr[MPe]=wr[UPe]=wr[FPe]=wr[VPe]=wr[BPe]=wr[GPe]=!1;function eDe(e){return APe(e)&&RPe(e.length)&&!!wr[NPe(e)]}var tDe=eDe;function nDe(e){return function(n){return e(n)}}var MQ=nDe,AS={exports:{}};AS.exports;(function(e,n){var a=$J,o=n&&!n.nodeType&&n,d=o&&!0&&e&&!e.nodeType&&e,p=d&&d.exports===o,f=p&&a.process,v=function(){try{var b=d&&d.require&&d.require("util").types;return b||f&&f.binding&&f.binding("util")}catch{}}();e.exports=v})(AS,AS.exports);var rDe=AS.exports,iDe=tDe,aDe=MQ,Q7=rDe,Z7=Q7&&Q7.isTypedArray,sDe=Z7?aDe(Z7):iDe,UQ=sDe,oDe=dPe,cDe=I2,lDe=is,dDe=LQ,uDe=O2,hDe=UQ,pDe=Object.prototype,mDe=pDe.hasOwnProperty;function fDe(e,n){var a=lDe(e),o=!a&&cDe(e),d=!a&&!o&&dDe(e),p=!a&&!o&&!d&&hDe(e),f=a||o||d||p,v=f?oDe(e.length,String):[],b=v.length;for(var E in e)(n||mDe.call(e,E))&&!(f&&(E=="length"||d&&(E=="offset"||E=="parent")||p&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||uDe(E,b)))&&v.push(E);return v}var gDe=fDe,vDe=Object.prototype;function yDe(e){var n=e&&e.constructor,a=typeof n=="function"&&n.prototype||vDe;return e===a}var _De=yDe;function bDe(e,n){return function(a){return e(n(a))}}var FQ=bDe,EDe=FQ,xDe=EDe(Object.keys,Object),SDe=xDe,wDe=_De,TDe=SDe,CDe=Object.prototype,NDe=CDe.hasOwnProperty;function RDe(e){if(!wDe(e))return TDe(e);var n=[];for(var a in Object(e))NDe.call(e,a)&&a!="constructor"&&n.push(a);return n}var ADe=RDe,IDe=p2,ODe=P2;function PDe(e){return e!=null&&ODe(e.length)&&!IDe(e)}var L0=PDe,DDe=gDe,kDe=ADe,jDe=L0;function LDe(e){return jDe(e)?DDe(e):kDe(e)}var yT=LDe,MDe=Q1e,UDe=cPe,FDe=yT;function VDe(e){return MDe(e,FDe,UDe)}var BDe=VDe,ez=BDe,GDe=1,WDe=Object.prototype,$De=WDe.hasOwnProperty;function HDe(e,n,a,o,d,p){var f=a&GDe,v=ez(e),b=v.length,E=ez(n),T=E.length;if(b!=T&&!f)return!1;for(var w=b;w--;){var N=v[w];if(!(f?N in n:$De.call(n,N)))return!1}var P=p.get(e),A=p.get(n);if(P&&A)return P==n&&A==e;var k=!0;p.set(e,n),p.set(n,e);for(var I=f;++w<b;){N=v[w];var F=e[N],U=n[N];if(o)var V=f?o(U,F,N,n,e,p):o(F,U,N,e,n,p);if(!(V===void 0?F===U||d(F,U,a,o,p):V)){k=!1;break}I||(I=N=="constructor")}if(k&&!I){var W=e.constructor,B=n.constructor;W!=B&&"constructor"in e&&"constructor"in n&&!(typeof W=="function"&&W instanceof W&&typeof B=="function"&&B instanceof B)&&(k=!1)}return p.delete(e),p.delete(n),k}var zDe=HDe,KDe=$h,YDe=Xc,qDe=KDe(YDe,"DataView"),XDe=qDe,JDe=$h,QDe=Xc,ZDe=JDe(QDe,"Promise"),eke=ZDe,tke=$h,nke=Xc,rke=tke(nke,"Set"),VQ=rke,ike=$h,ake=Xc,ske=ike(ake,"WeakMap"),oke=ske,VP=XDe,BP=f2,GP=eke,WP=VQ,$P=oke,BQ=Fl,Jf=zJ,tz="[object Map]",cke="[object Object]",nz="[object Promise]",rz="[object Set]",iz="[object WeakMap]",az="[object DataView]",lke=Jf(VP),dke=Jf(BP),uke=Jf(GP),hke=Jf(WP),pke=Jf($P),dh=BQ;(VP&&dh(new VP(new ArrayBuffer(1)))!=az||BP&&dh(new BP)!=tz||GP&&dh(GP.resolve())!=nz||WP&&dh(new WP)!=rz||$P&&dh(new $P)!=iz)&&(dh=function(e){var n=BQ(e),a=n==cke?e.constructor:void 0,o=a?Jf(a):"";if(o)switch(o){case lke:return az;case dke:return tz;case uke:return nz;case hke:return rz;case pke:return iz}return n});var mke=dh,WO=AQ,fke=DQ,gke=K1e,vke=zDe,sz=mke,oz=is,cz=LQ,yke=UQ,_ke=1,lz="[object Arguments]",dz="[object Array]",lx="[object Object]",bke=Object.prototype,uz=bke.hasOwnProperty;function Eke(e,n,a,o,d,p){var f=oz(e),v=oz(n),b=f?dz:sz(e),E=v?dz:sz(n);b=b==lz?lx:b,E=E==lz?lx:E;var T=b==lx,w=E==lx,N=b==E;if(N&&cz(e)){if(!cz(n))return!1;f=!0,T=!1}if(N&&!T)return p||(p=new WO),f||yke(e)?fke(e,n,a,o,d,p):gke(e,n,b,a,o,d,p);if(!(a&_ke)){var P=T&&uz.call(e,"__wrapped__"),A=w&&uz.call(n,"__wrapped__");if(P||A){var k=P?e.value():e,I=A?n.value():n;return p||(p=new WO),d(k,I,a,o,p)}}return N?(p||(p=new WO),vke(e,n,a,o,d,p)):!1}var xke=Eke,Ske=xke,hz=Vl;function GQ(e,n,a,o,d){return e===n?!0:e==null||n==null||!hz(e)&&!hz(n)?e!==e&&n!==n:Ske(e,n,a,o,GQ,d)}var D2=GQ,wke=AQ,Tke=D2,Cke=1,Nke=2;function Rke(e,n,a,o){var d=a.length,p=d,f=!o;if(e==null)return!p;for(e=Object(e);d--;){var v=a[d];if(f&&v[2]?v[1]!==e[v[0]]:!(v[0]in e))return!1}for(;++d<p;){v=a[d];var b=v[0],E=e[b],T=v[1];if(f&&v[2]){if(E===void 0&&!(b in e))return!1}else{var w=new wke;if(o)var N=o(E,T,b,e,n,w);if(!(N===void 0?Tke(T,E,Cke|Nke,o,w):N))return!1}}return!0}var Ake=Rke,Ike=iu;function Oke(e){return e===e&&!Ike(e)}var WQ=Oke,Pke=WQ,Dke=yT;function kke(e){for(var n=Dke(e),a=n.length;a--;){var o=n[a],d=e[o];n[a]=[o,d,Pke(d)]}return n}var jke=kke;function Lke(e,n){return function(a){return a==null?!1:a[e]===n&&(n!==void 0||e in Object(a))}}var $Q=Lke,Mke=Ake,Uke=jke,Fke=$Q;function Vke(e){var n=Uke(e);return n.length==1&&n[0][2]?Fke(n[0][0],n[0][1]):function(a){return a===e||Mke(a,e,n)}}var Bke=Vke;function Gke(e,n){return e!=null&&n in Object(e)}var Wke=Gke,$ke=JJ,Hke=I2,zke=is,Kke=O2,Yke=P2,qke=rT;function Xke(e,n,a){n=$ke(n,e);for(var o=-1,d=n.length,p=!1;++o<d;){var f=qke(n[o]);if(!(p=e!=null&&a(e,f)))break;e=e[f]}return p||++o!=d?p:(d=e==null?0:e.length,!!d&&Yke(d)&&Kke(f,d)&&(zke(e)||Hke(e)))}var Jke=Xke,Qke=Wke,Zke=Jke;function e2e(e,n){return e!=null&&Zke(e,n,Qke)}var t2e=e2e,n2e=D2,r2e=QJ,i2e=t2e,a2e=h2,s2e=WQ,o2e=$Q,c2e=rT,l2e=1,d2e=2;function u2e(e,n){return a2e(e)&&s2e(n)?o2e(c2e(e),n):function(a){var o=r2e(a,e);return o===void 0&&o===n?i2e(a,e):n2e(n,o,l2e|d2e)}}var h2e=u2e;function p2e(e){return e}var Qf=p2e;function m2e(e){return function(n){return n==null?void 0:n[e]}}var f2e=m2e,g2e=_2;function v2e(e){return function(n){return g2e(n,e)}}var y2e=v2e,_2e=f2e,b2e=y2e,E2e=h2,x2e=rT;function S2e(e){return E2e(e)?_2e(x2e(e)):b2e(e)}var w2e=S2e,T2e=Bke,C2e=h2e,N2e=Qf,R2e=is,A2e=w2e;function I2e(e){return typeof e=="function"?e:e==null?N2e:typeof e=="object"?R2e(e)?C2e(e[0],e[1]):T2e(e):A2e(e)}var au=I2e;function O2e(e,n,a,o){for(var d=e.length,p=a+(o?1:-1);o?p--:++p<d;)if(n(e[p],p,e))return p;return-1}var HQ=O2e;function P2e(e){return e!==e}var D2e=P2e;function k2e(e,n,a){for(var o=a-1,d=e.length;++o<d;)if(e[o]===n)return o;return-1}var j2e=k2e,L2e=HQ,M2e=D2e,U2e=j2e;function F2e(e,n,a){return n===n?U2e(e,n,a):L2e(e,M2e,a)}var V2e=F2e,B2e=V2e;function G2e(e,n){var a=e==null?0:e.length;return!!a&&B2e(e,n,0)>-1}var W2e=G2e;function $2e(e,n,a){for(var o=-1,d=e==null?0:e.length;++o<d;)if(a(n,e[o]))return!0;return!1}var H2e=$2e;function z2e(){}var K2e=z2e,$O=VQ,Y2e=K2e,q2e=A2,X2e=1/0,J2e=$O&&1/q2e(new $O([,-0]))[1]==X2e?function(e){return new $O(e)}:Y2e,Q2e=J2e,Z2e=IQ,eje=W2e,tje=H2e,nje=PQ,rje=Q2e,ije=A2,aje=200;function sje(e,n,a){var o=-1,d=eje,p=e.length,f=!0,v=[],b=v;if(a)f=!1,d=tje;else if(p>=aje){var E=n?null:rje(e);if(E)return ije(E);f=!1,d=nje,b=new Z2e}else b=n?[]:v;e:for(;++o<p;){var T=e[o],w=n?n(T):T;if(T=a||T!==0?T:0,f&&w===w){for(var N=b.length;N--;)if(b[N]===w)continue e;n&&b.push(w),v.push(T)}else d(b,w,a)||(b!==v&&b.push(w),v.push(T))}return v}var oje=sje,cje=au,lje=oje;function dje(e,n){return e&&e.length?lje(e,cje(n)):[]}var uje=dje;const pz=ar(uje);function zQ(e,n,a){return n===!0?pz(e,a):pn(n)?pz(e,n):e}function df(e){"@babel/helpers - typeof";return df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},df(e)}var hje=["ref"];function mz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function pl(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?mz(Object(a),!0).forEach(function(o){_T(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function pje(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function fz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,YQ(o.key),o)}}function mje(e,n,a){return n&&fz(e.prototype,n),a&&fz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function fje(e,n,a){return n=IS(n),gje(e,KQ()?Reflect.construct(n,a||[],IS(e).constructor):n.apply(e,a))}function gje(e,n){if(n&&(df(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vje(e)}function vje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KQ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KQ=function(){return!!e})()}function IS(e){return IS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},IS(e)}function yje(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&HP(e,n)}function HP(e,n){return HP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},HP(e,n)}function _T(e,n,a){return n=YQ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function YQ(e){var n=_je(e,"string");return df(n)=="symbol"?n:n+""}function _je(e,n){if(df(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(df(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function bje(e,n){if(e==null)return{};var a=Eje(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Eje(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function xje(e){return e.value}function Sje(e,n){if(fe.isValidElement(e))return fe.cloneElement(e,n);if(typeof e=="function")return fe.createElement(e,n);n.ref;var a=bje(n,hje);return fe.createElement(R2,a)}var gz=1,Km=function(e){function n(){var a;pje(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=fje(this,n,[].concat(d)),_T(a,"lastBoundingBox",{width:-1,height:-1}),a}return yje(n,e),mje(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();return o.height=this.wrapperNode.offsetHeight,o.width=this.wrapperNode.offsetWidth,o}return null}},{key:"updateBBox",value:function(){var o=this.props.onBBoxUpdate,d=this.getBBox();d?(Math.abs(d.width-this.lastBoundingBox.width)>gz||Math.abs(d.height-this.lastBoundingBox.height)>gz)&&(this.lastBoundingBox.width=d.width,this.lastBoundingBox.height=d.height,o&&o(d)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,o&&o(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?pl({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(o){var d=this.props,p=d.layout,f=d.align,v=d.verticalAlign,b=d.margin,E=d.chartWidth,T=d.chartHeight,w,N;if(!o||(o.left===void 0||o.left===null)&&(o.right===void 0||o.right===null))if(f==="center"&&p==="vertical"){var P=this.getBBoxSnapshot();w={left:((E||0)-P.width)/2}}else w=f==="right"?{right:b&&b.right||0}:{left:b&&b.left||0};if(!o||(o.top===void 0||o.top===null)&&(o.bottom===void 0||o.bottom===null))if(v==="middle"){var A=this.getBBoxSnapshot();N={top:((T||0)-A.height)/2}}else N=v==="bottom"?{bottom:b&&b.bottom||0}:{top:b&&b.top||0};return pl(pl({},w),N)}},{key:"render",value:function(){var o=this,d=this.props,p=d.content,f=d.width,v=d.height,b=d.wrapperStyle,E=d.payloadUniqBy,T=d.payload,w=pl(pl({position:"absolute",width:f||"auto",height:v||"auto"},this.getDefaultPosition(b)),b);return fe.createElement("div",{className:"recharts-legend-wrapper",style:w,ref:function(P){o.wrapperNode=P}},Sje(p,pl(pl({},this.props),{},{payload:zQ(T,E,xje)})))}}],[{key:"getWithHeight",value:function(o,d){var p=pl(pl({},this.defaultProps),o.props),f=p.layout;return f==="vertical"&&ct(o.props.height)?{height:o.props.height}:f==="horizontal"?{width:o.props.width||d}:null}}])}(q.PureComponent);_T(Km,"displayName","Legend");_T(Km,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var vz=j0,wje=I2,Tje=is,yz=vz?vz.isConcatSpreadable:void 0;function Cje(e){return Tje(e)||wje(e)||!!(yz&&e&&e[yz])}var Nje=Cje,Rje=kQ,Aje=Nje;function qQ(e,n,a,o,d){var p=-1,f=e.length;for(a||(a=Aje),d||(d=[]);++p<f;){var v=e[p];n>0&&a(v)?n>1?qQ(v,n-1,a,o,d):Rje(d,v):o||(d[d.length]=v)}return d}var XQ=qQ;function Ije(e){return function(n,a,o){for(var d=-1,p=Object(n),f=o(n),v=f.length;v--;){var b=f[e?v:++d];if(a(p[b],b,p)===!1)break}return n}}var Oje=Ije,Pje=Oje,Dje=Pje(),kje=Dje,jje=kje,Lje=yT;function Mje(e,n){return e&&jje(e,n,Lje)}var JQ=Mje,Uje=L0;function Fje(e,n){return function(a,o){if(a==null)return a;if(!Uje(a))return e(a,o);for(var d=a.length,p=n?d:-1,f=Object(a);(n?p--:++p<d)&&o(f[p],p,f)!==!1;);return a}}var Vje=Fje,Bje=JQ,Gje=Vje,Wje=Gje(Bje),k2=Wje,$je=k2,Hje=L0;function zje(e,n){var a=-1,o=Hje(e)?Array(e.length):[];return $je(e,function(d,p,f){o[++a]=n(d,p,f)}),o}var QQ=zje;function Kje(e,n){var a=e.length;for(e.sort(n);a--;)e[a]=e[a].value;return e}var Yje=Kje,_z=Wf;function qje(e,n){if(e!==n){var a=e!==void 0,o=e===null,d=e===e,p=_z(e),f=n!==void 0,v=n===null,b=n===n,E=_z(n);if(!v&&!E&&!p&&e>n||p&&f&&b&&!v&&!E||o&&f&&b||!a&&b||!d)return 1;if(!o&&!p&&!E&&e<n||E&&a&&d&&!o&&!p||v&&a&&d||!f&&d||!b)return-1}return 0}var Xje=qje,Jje=Xje;function Qje(e,n,a){for(var o=-1,d=e.criteria,p=n.criteria,f=d.length,v=a.length;++o<f;){var b=Jje(d[o],p[o]);if(b){if(o>=v)return b;var E=a[o];return b*(E=="desc"?-1:1)}}return e.index-n.index}var Zje=Qje,HO=y2,eLe=_2,tLe=au,nLe=QQ,rLe=Yje,iLe=MQ,aLe=Zje,sLe=Qf,oLe=is;function cLe(e,n,a){n.length?n=HO(n,function(p){return oLe(p)?function(f){return eLe(f,p.length===1?p[0]:p)}:p}):n=[sLe];var o=-1;n=HO(n,iLe(tLe));var d=nLe(e,function(p,f,v){var b=HO(n,function(E){return E(p)});return{criteria:b,index:++o,value:p}});return rLe(d,function(p,f){return aLe(p,f,a)})}var lLe=cLe;function dLe(e,n,a){switch(a.length){case 0:return e.call(n);case 1:return e.call(n,a[0]);case 2:return e.call(n,a[0],a[1]);case 3:return e.call(n,a[0],a[1],a[2])}return e.apply(n,a)}var uLe=dLe,hLe=uLe,bz=Math.max;function pLe(e,n,a){return n=bz(n===void 0?e.length-1:n,0),function(){for(var o=arguments,d=-1,p=bz(o.length-n,0),f=Array(p);++d<p;)f[d]=o[n+d];d=-1;for(var v=Array(n+1);++d<n;)v[d]=o[d];return v[n]=a(f),hLe(e,this,v)}}var mLe=pLe;function fLe(e){return function(){return e}}var gLe=fLe,vLe=$h,yLe=function(){try{var e=vLe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ZQ=yLe,_Le=gLe,Ez=ZQ,bLe=Qf,ELe=Ez?function(e,n){return Ez(e,"toString",{configurable:!0,enumerable:!1,value:_Le(n),writable:!0})}:bLe,xLe=ELe,SLe=800,wLe=16,TLe=Date.now;function CLe(e){var n=0,a=0;return function(){var o=TLe(),d=wLe-(o-a);if(a=o,d>0){if(++n>=SLe)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}var NLe=CLe,RLe=xLe,ALe=NLe,ILe=ALe(RLe),OLe=ILe,PLe=Qf,DLe=mLe,kLe=OLe;function jLe(e,n){return kLe(DLe(e,n,PLe),e+"")}var LLe=jLe,MLe=m2,ULe=L0,FLe=O2,VLe=iu;function BLe(e,n,a){if(!VLe(a))return!1;var o=typeof n;return(o=="number"?ULe(a)&&FLe(n,a.length):o=="string"&&n in a)?MLe(a[n],e):!1}var bT=BLe,GLe=XQ,WLe=lLe,$Le=LLe,xz=bT,HLe=$Le(function(e,n){if(e==null)return[];var a=n.length;return a>1&&xz(e,n[0],n[1])?n=[]:a>2&&xz(n[0],n[1],n[2])&&(n=[n[0]]),WLe(e,GLe(n,1),[])}),zLe=HLe;const j2=ar(zLe);function Gy(e){"@babel/helpers - typeof";return Gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Gy(e)}function zP(){return zP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},zP.apply(this,arguments)}function KLe(e,n){return JLe(e)||XLe(e,n)||qLe(e,n)||YLe()}function YLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qLe(e,n){if(e){if(typeof e=="string")return Sz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sz(e,n)}}function Sz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function XLe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function JLe(e){if(Array.isArray(e))return e}function wz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function zO(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?wz(Object(a),!0).forEach(function(o){QLe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function QLe(e,n,a){return n=ZLe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ZLe(e){var n=eMe(e,"string");return Gy(n)=="symbol"?n:n+""}function eMe(e,n){if(Gy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Gy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function tMe(e){return Array.isArray(e)&&Ei(e[0])&&Ei(e[1])?e.join(" ~ "):e}var nMe=function(n){var a=n.separator,o=a===void 0?" : ":a,d=n.contentStyle,p=d===void 0?{}:d,f=n.itemStyle,v=f===void 0?{}:f,b=n.labelStyle,E=b===void 0?{}:b,T=n.payload,w=n.formatter,N=n.itemSorter,P=n.wrapperClassName,A=n.labelClassName,k=n.label,I=n.labelFormatter,F=n.accessibilityLayer,U=F===void 0?!1:F,V=function(){if(T&&T.length){var de={padding:0,margin:0},xe=(N?j2(T,N):T).map(function(me,Ce){if(me.type==="none")return null;var ue=zO({display:"block",paddingTop:4,paddingBottom:4,color:me.color||"#000"},v),be=me.formatter||w||tMe,se=me.value,pe=me.name,De=se,Se=pe;if(be&&De!=null&&Se!=null){var we=be(se,pe,me,Ce,T);if(Array.isArray(we)){var qe=KLe(we,2);De=qe[0],Se=qe[1]}else De=we}return fe.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Ce),style:ue},Ei(Se)?fe.createElement("span",{className:"recharts-tooltip-item-name"},Se):null,Ei(Se)?fe.createElement("span",{className:"recharts-tooltip-item-separator"},o):null,fe.createElement("span",{className:"recharts-tooltip-item-value"},De),fe.createElement("span",{className:"recharts-tooltip-item-unit"},me.unit||""))});return fe.createElement("ul",{className:"recharts-tooltip-item-list",style:de},xe)}return null},W=zO({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},p),B=zO({margin:0},E),z=!bn(k),Y=z?k:"",re=On("recharts-default-tooltip",P),Z=On("recharts-tooltip-label",A);z&&I&&T!==void 0&&T!==null&&(Y=I(k,T));var ie=U?{role:"status","aria-live":"assertive"}:{};return fe.createElement("div",zP({className:re,style:W},ie),fe.createElement("p",{className:Z,style:B},fe.isValidElement(Y)?Y:"".concat(Y)),V())};function Wy(e){"@babel/helpers - typeof";return Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Wy(e)}function dx(e,n,a){return n=rMe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rMe(e){var n=iMe(e,"string");return Wy(n)=="symbol"?n:n+""}function iMe(e,n){if(Wy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Wy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Gv="recharts-tooltip-wrapper",aMe={visibility:"hidden"};function sMe(e){var n=e.coordinate,a=e.translateX,o=e.translateY;return On(Gv,dx(dx(dx(dx({},"".concat(Gv,"-right"),ct(a)&&n&&ct(n.x)&&a>=n.x),"".concat(Gv,"-left"),ct(a)&&n&&ct(n.x)&&a<n.x),"".concat(Gv,"-bottom"),ct(o)&&n&&ct(n.y)&&o>=n.y),"".concat(Gv,"-top"),ct(o)&&n&&ct(n.y)&&o<n.y))}function Tz(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.key,d=e.offsetTopLeft,p=e.position,f=e.reverseDirection,v=e.tooltipDimension,b=e.viewBox,E=e.viewBoxDimension;if(p&&ct(p[o]))return p[o];var T=a[o]-v-d,w=a[o]+d;if(n[o])return f[o]?T:w;if(f[o]){var N=T,P=b[o];return N<P?Math.max(w,b[o]):Math.max(T,b[o])}var A=w+v,k=b[o]+E;return A>k?Math.max(T,b[o]):Math.max(w,b[o])}function oMe(e){var n=e.translateX,a=e.translateY,o=e.useTranslate3d;return{transform:o?"translate3d(".concat(n,"px, ").concat(a,"px, 0)"):"translate(".concat(n,"px, ").concat(a,"px)")}}function cMe(e){var n=e.allowEscapeViewBox,a=e.coordinate,o=e.offsetTopLeft,d=e.position,p=e.reverseDirection,f=e.tooltipBox,v=e.useTranslate3d,b=e.viewBox,E,T,w;return f.height>0&&f.width>0&&a?(T=Tz({allowEscapeViewBox:n,coordinate:a,key:"x",offsetTopLeft:o,position:d,reverseDirection:p,tooltipDimension:f.width,viewBox:b,viewBoxDimension:b.width}),w=Tz({allowEscapeViewBox:n,coordinate:a,key:"y",offsetTopLeft:o,position:d,reverseDirection:p,tooltipDimension:f.height,viewBox:b,viewBoxDimension:b.height}),E=oMe({translateX:T,translateY:w,useTranslate3d:v})):E=aMe,{cssProperties:E,cssClasses:sMe({translateX:T,translateY:w,coordinate:a})}}function uf(e){"@babel/helpers - typeof";return uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},uf(e)}function Cz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Nz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Cz(Object(a),!0).forEach(function(o){YP(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function lMe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function dMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,tZ(o.key),o)}}function uMe(e,n,a){return n&&dMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function hMe(e,n,a){return n=OS(n),pMe(e,eZ()?Reflect.construct(n,a||[],OS(e).constructor):n.apply(e,a))}function pMe(e,n){if(n&&(uf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mMe(e)}function mMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(eZ=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},OS(e)}function fMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&KP(e,n)}function KP(e,n){return KP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KP(e,n)}function YP(e,n,a){return n=tZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function tZ(e){var n=gMe(e,"string");return uf(n)=="symbol"?n:n+""}function gMe(e,n){if(uf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(uf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Rz=1,vMe=function(e){function n(){var a;lMe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=hMe(this,n,[].concat(d)),YP(a,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),YP(a,"handleKeyDown",function(f){if(f.key==="Escape"){var v,b,E,T;a.setState({dismissed:!0,dismissedAtCoordinate:{x:(v=(b=a.props.coordinate)===null||b===void 0?void 0:b.x)!==null&&v!==void 0?v:0,y:(E=(T=a.props.coordinate)===null||T===void 0?void 0:T.y)!==null&&E!==void 0?E:0}})}}),a}return fMe(n,e),uMe(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();(Math.abs(o.width-this.state.lastBoundingBox.width)>Rz||Math.abs(o.height-this.state.lastBoundingBox.height)>Rz)&&this.setState({lastBoundingBox:{width:o.width,height:o.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var o,d;this.props.active&&this.updateBBox(),this.state.dismissed&&(((o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==this.state.dismissedAtCoordinate.x||((d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var o=this,d=this.props,p=d.active,f=d.allowEscapeViewBox,v=d.animationDuration,b=d.animationEasing,E=d.children,T=d.coordinate,w=d.hasPayload,N=d.isAnimationActive,P=d.offset,A=d.position,k=d.reverseDirection,I=d.useTranslate3d,F=d.viewBox,U=d.wrapperStyle,V=cMe({allowEscapeViewBox:f,coordinate:T,offsetTopLeft:P,position:A,reverseDirection:k,tooltipBox:this.state.lastBoundingBox,useTranslate3d:I,viewBox:F}),W=V.cssClasses,B=V.cssProperties,z=Nz(Nz({transition:N&&p?"transform ".concat(v,"ms ").concat(b):void 0},B),{},{pointerEvents:"none",visibility:!this.state.dismissed&&p&&w?"visible":"hidden",position:"absolute",top:0,left:0},U);return fe.createElement("div",{tabIndex:-1,className:W,style:z,ref:function(re){o.wrapperNode=re}},E)}}])}(q.PureComponent),yMe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Hh={isSsr:yMe()};function hf(e){"@babel/helpers - typeof";return hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hf(e)}function Az(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Iz(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Az(Object(a),!0).forEach(function(o){L2(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Az(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function _Me(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function bMe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,rZ(o.key),o)}}function EMe(e,n,a){return n&&bMe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xMe(e,n,a){return n=PS(n),SMe(e,nZ()?Reflect.construct(n,a||[],PS(e).constructor):n.apply(e,a))}function SMe(e,n){if(n&&(hf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wMe(e)}function wMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nZ=function(){return!!e})()}function PS(e){return PS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},PS(e)}function TMe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&qP(e,n)}function qP(e,n){return qP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},qP(e,n)}function L2(e,n,a){return n=rZ(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rZ(e){var n=CMe(e,"string");return hf(n)=="symbol"?n:n+""}function CMe(e,n){if(hf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(hf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function NMe(e){return e.dataKey}function RMe(e,n){return fe.isValidElement(e)?fe.cloneElement(e,n):typeof e=="function"?fe.createElement(e,n):fe.createElement(nMe,n)}var xs=function(e){function n(){return _Me(this,n),xMe(this,n,arguments)}return TMe(n,e),EMe(n,[{key:"render",value:function(){var o=this,d=this.props,p=d.active,f=d.allowEscapeViewBox,v=d.animationDuration,b=d.animationEasing,E=d.content,T=d.coordinate,w=d.filterNull,N=d.isAnimationActive,P=d.offset,A=d.payload,k=d.payloadUniqBy,I=d.position,F=d.reverseDirection,U=d.useTranslate3d,V=d.viewBox,W=d.wrapperStyle,B=A??[];w&&B.length&&(B=zQ(A.filter(function(Y){return Y.value!=null&&(Y.hide!==!0||o.props.includeHidden)}),k,NMe));var z=B.length>0;return fe.createElement(vMe,{allowEscapeViewBox:f,animationDuration:v,animationEasing:b,isAnimationActive:N,active:p,coordinate:T,hasPayload:z,offset:P,position:I,reverseDirection:F,useTranslate3d:U,viewBox:V,wrapperStyle:W},RMe(E,Iz(Iz({},this.props),{},{payload:B})))}}])}(q.PureComponent);L2(xs,"displayName","Tooltip");L2(xs,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Hh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var AMe=Xc,IMe=function(){return AMe.Date.now()},OMe=IMe,PMe=/\s/;function DMe(e){for(var n=e.length;n--&&PMe.test(e.charAt(n)););return n}var kMe=DMe,jMe=kMe,LMe=/^\s+/;function MMe(e){return e&&e.slice(0,jMe(e)+1).replace(LMe,"")}var UMe=MMe,FMe=UMe,Oz=iu,VMe=Wf,Pz=NaN,BMe=/^[-+]0x[0-9a-f]+$/i,GMe=/^0b[01]+$/i,WMe=/^0o[0-7]+$/i,$Me=parseInt;function HMe(e){if(typeof e=="number")return e;if(VMe(e))return Pz;if(Oz(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Oz(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=FMe(e);var a=GMe.test(e);return a||WMe.test(e)?$Me(e.slice(2),a?2:8):BMe.test(e)?Pz:+e}var iZ=HMe,zMe=iu,KO=OMe,Dz=iZ,KMe="Expected a function",YMe=Math.max,qMe=Math.min;function XMe(e,n,a){var o,d,p,f,v,b,E=0,T=!1,w=!1,N=!0;if(typeof e!="function")throw new TypeError(KMe);n=Dz(n)||0,zMe(a)&&(T=!!a.leading,w="maxWait"in a,p=w?YMe(Dz(a.maxWait)||0,n):p,N="trailing"in a?!!a.trailing:N);function P(z){var Y=o,re=d;return o=d=void 0,E=z,f=e.apply(re,Y),f}function A(z){return E=z,v=setTimeout(F,n),T?P(z):f}function k(z){var Y=z-b,re=z-E,Z=n-Y;return w?qMe(Z,p-re):Z}function I(z){var Y=z-b,re=z-E;return b===void 0||Y>=n||Y<0||w&&re>=p}function F(){var z=KO();if(I(z))return U(z);v=setTimeout(F,k(z))}function U(z){return v=void 0,N&&o?P(z):(o=d=void 0,f)}function V(){v!==void 0&&clearTimeout(v),E=0,o=b=d=v=void 0}function W(){return v===void 0?f:U(KO())}function B(){var z=KO(),Y=I(z);if(o=arguments,d=this,b=z,Y){if(v===void 0)return A(b);if(w)return clearTimeout(v),v=setTimeout(F,n),P(b)}return v===void 0&&(v=setTimeout(F,n)),f}return B.cancel=V,B.flush=W,B}var JMe=XMe,QMe=JMe,ZMe=iu,eUe="Expected a function";function tUe(e,n,a){var o=!0,d=!0;if(typeof e!="function")throw new TypeError(eUe);return ZMe(a)&&(o="leading"in a?!!a.leading:o,d="trailing"in a?!!a.trailing:d),QMe(e,n,{leading:o,maxWait:n,trailing:d})}var nUe=tUe;const aZ=ar(nUe);function $y(e){"@babel/helpers - typeof";return $y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$y(e)}function kz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ux(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?kz(Object(a),!0).forEach(function(o){rUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function rUe(e,n,a){return n=iUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function iUe(e){var n=aUe(e,"string");return $y(n)=="symbol"?n:n+""}function aUe(e,n){if($y(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if($y(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function sUe(e,n){return dUe(e)||lUe(e,n)||cUe(e,n)||oUe()}function oUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cUe(e,n){if(e){if(typeof e=="string")return jz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jz(e,n)}}function jz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function lUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function dUe(e){if(Array.isArray(e))return e}var DS=q.forwardRef(function(e,n){var a=e.aspect,o=e.initialDimension,d=o===void 0?{width:-1,height:-1}:o,p=e.width,f=p===void 0?"100%":p,v=e.height,b=v===void 0?"100%":v,E=e.minWidth,T=E===void 0?0:E,w=e.minHeight,N=e.maxHeight,P=e.children,A=e.debounce,k=A===void 0?0:A,I=e.id,F=e.className,U=e.onResize,V=e.style,W=V===void 0?{}:V,B=q.useRef(null),z=q.useRef();z.current=U,q.useImperativeHandle(n,function(){return Object.defineProperty(B.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),B.current},configurable:!0})});var Y=q.useState({containerWidth:d.width,containerHeight:d.height}),re=sUe(Y,2),Z=re[0],ie=re[1],te=q.useCallback(function(xe,me){ie(function(Ce){var ue=Math.round(xe),be=Math.round(me);return Ce.containerWidth===ue&&Ce.containerHeight===be?Ce:{containerWidth:ue,containerHeight:be}})},[]);q.useEffect(function(){var xe=function(pe){var De,Se=pe[0].contentRect,we=Se.width,qe=Se.height;te(we,qe),(De=z.current)===null||De===void 0||De.call(z,we,qe)};k>0&&(xe=aZ(xe,k,{trailing:!0,leading:!1}));var me=new ResizeObserver(xe),Ce=B.current.getBoundingClientRect(),ue=Ce.width,be=Ce.height;return te(ue,be),me.observe(B.current),function(){me.disconnect()}},[te,k]);var de=q.useMemo(function(){var xe=Z.containerWidth,me=Z.containerHeight;if(xe<0||me<0)return null;Tl(_h(f)||_h(b),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,b),Tl(!a||a>0,"The aspect(%s) must be greater than zero.",a);var Ce=_h(f)?xe:f,ue=_h(b)?me:b;a&&a>0&&(Ce?ue=Ce/a:ue&&(Ce=ue*a),N&&ue>N&&(ue=N)),Tl(Ce>0||ue>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,Ce,ue,f,b,T,w,a);var be=!Array.isArray(P)&&wl(P.type).endsWith("Chart");return fe.Children.map(P,function(se){return fe.isValidElement(se)?q.cloneElement(se,ux({width:Ce,height:ue},be?{style:ux({height:"100%",width:"100%",maxHeight:ue,maxWidth:Ce},se.props.style)}:{})):se})},[a,P,b,N,w,T,Z,f]);return fe.createElement("div",{id:I?"".concat(I):void 0,className:On("recharts-responsive-container",F),style:ux(ux({},W),{},{width:f,height:b,minWidth:T,minHeight:w,maxHeight:N}),ref:B},de)}),sZ=function(n){return null};sZ.displayName="Cell";function Hy(e){"@babel/helpers - typeof";return Hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hy(e)}function Lz(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function XP(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Lz(Object(a),!0).forEach(function(o){uUe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lz(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function uUe(e,n,a){return n=hUe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function hUe(e){var n=pUe(e,"string");return Hy(n)=="symbol"?n:n+""}function pUe(e,n){if(Hy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Hy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var ym={widthCache:{},cacheCount:0},mUe=2e3,fUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Mz="recharts_measurement_span";function gUe(e){var n=XP({},e);return Object.keys(n).forEach(function(a){n[a]||delete n[a]}),n}var fy=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Hh.isSsr)return{width:0,height:0};var o=gUe(a),d=JSON.stringify({text:n,copyStyle:o});if(ym.widthCache[d])return ym.widthCache[d];try{var p=document.getElementById(Mz);p||(p=document.createElement("span"),p.setAttribute("id",Mz),p.setAttribute("aria-hidden","true"),document.body.appendChild(p));var f=XP(XP({},fUe),o);Object.assign(p.style,f),p.textContent="".concat(n);var v=p.getBoundingClientRect(),b={width:v.width,height:v.height};return ym.widthCache[d]=b,++ym.cacheCount>mUe&&(ym.cacheCount=0,ym.widthCache={}),b}catch{return{width:0,height:0}}},vUe=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function zy(e){"@babel/helpers - typeof";return zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zy(e)}function kS(e,n){return EUe(e)||bUe(e,n)||_Ue(e,n)||yUe()}function yUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _Ue(e,n){if(e){if(typeof e=="string")return Uz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Uz(e,n)}}function Uz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function bUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function EUe(e){if(Array.isArray(e))return e}function xUe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Fz(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,wUe(o.key),o)}}function SUe(e,n,a){return n&&Fz(e.prototype,n),a&&Fz(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function wUe(e){var n=TUe(e,"string");return zy(n)=="symbol"?n:n+""}function TUe(e,n){if(zy(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(zy(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Vz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Bz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,CUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,NUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,oZ={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},RUe=Object.keys(oZ),Mm="NaN";function AUe(e,n){return e*oZ[n]}var hx=function(){function e(n,a){xUe(this,e),this.num=n,this.unit=a,this.num=n,this.unit=a,Number.isNaN(n)&&(this.unit=""),a!==""&&!CUe.test(a)&&(this.num=NaN,this.unit=""),RUe.includes(a)&&(this.num=AUe(n,a),this.unit="px")}return SUe(e,[{key:"add",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num+a.num,this.unit)}},{key:"subtract",value:function(a){return this.unit!==a.unit?new e(NaN,""):new e(this.num-a.num,this.unit)}},{key:"multiply",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num*a.num,this.unit||a.unit)}},{key:"divide",value:function(a){return this.unit!==""&&a.unit!==""&&this.unit!==a.unit?new e(NaN,""):new e(this.num/a.num,this.unit||a.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(a){var o,d=(o=NUe.exec(a))!==null&&o!==void 0?o:[],p=kS(d,3),f=p[1],v=p[2];return new e(parseFloat(f),v??"")}}])}();function cZ(e){if(e.includes(Mm))return Mm;for(var n=e;n.includes("*")||n.includes("/");){var a,o=(a=Vz.exec(n))!==null&&a!==void 0?a:[],d=kS(o,4),p=d[1],f=d[2],v=d[3],b=hx.parse(p??""),E=hx.parse(v??""),T=f==="*"?b.multiply(E):b.divide(E);if(T.isNaN())return Mm;n=n.replace(Vz,T.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var w,N=(w=Bz.exec(n))!==null&&w!==void 0?w:[],P=kS(N,4),A=P[1],k=P[2],I=P[3],F=hx.parse(A??""),U=hx.parse(I??""),V=k==="+"?F.add(U):F.subtract(U);if(V.isNaN())return Mm;n=n.replace(Bz,V.toString())}return n}var Gz=/\(([^()]*)\)/;function IUe(e){for(var n=e;n.includes("(");){var a=Gz.exec(n),o=kS(a,2),d=o[1];n=n.replace(Gz,cZ(d))}return n}function OUe(e){var n=e.replace(/\s+/g,"");return n=IUe(n),n=cZ(n),n}function PUe(e){try{return OUe(e)}catch{return Mm}}function YO(e){var n=PUe(e.slice(5,-1));return n===Mm?"":n}var DUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],kUe=["dx","dy","angle","className","breakAll"];function JP(){return JP=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},JP.apply(this,arguments)}function Wz(e,n){if(e==null)return{};var a=jUe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function jUe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function $z(e,n){return FUe(e)||UUe(e,n)||MUe(e,n)||LUe()}function LUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MUe(e,n){if(e){if(typeof e=="string")return Hz(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hz(e,n)}}function Hz(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function UUe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n===0){if(Object(a)!==a)return;b=!1}else for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function FUe(e){if(Array.isArray(e))return e}var lZ=/[ \f\n\r\t\v\u2028\u2029]+/,dZ=function(n){var a=n.children,o=n.breakAll,d=n.style;try{var p=[];bn(a)||(o?p=a.toString().split(""):p=a.toString().split(lZ));var f=p.map(function(b){return{word:b,width:fy(b,d).width}}),v=o?0:fy("",d).width;return{wordsWithComputedWidth:f,spaceWidth:v}}catch{return null}},VUe=function(n,a,o,d,p){var f=n.maxLines,v=n.children,b=n.style,E=n.breakAll,T=ct(f),w=v,N=function(){var Ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ce.reduce(function(ue,be){var se=be.word,pe=be.width,De=ue[ue.length-1];if(De&&(d==null||p||De.width+pe+o<Number(d)))De.words.push(se),De.width+=pe+o;else{var Se={words:[se],width:pe};ue.push(Se)}return ue},[])},P=N(a),A=function(Ce){return Ce.reduce(function(ue,be){return ue.width>be.width?ue:be})};if(!T)return P;for(var k="",I=function(Ce){var ue=w.slice(0,Ce),be=dZ({breakAll:E,style:b,children:ue+k}).wordsWithComputedWidth,se=N(be),pe=se.length>f||A(se).width>Number(d);return[pe,se]},F=0,U=w.length-1,V=0,W;F<=U&&V<=w.length-1;){var B=Math.floor((F+U)/2),z=B-1,Y=I(z),re=$z(Y,2),Z=re[0],ie=re[1],te=I(B),de=$z(te,1),xe=de[0];if(!Z&&!xe&&(F=B+1),Z&&xe&&(U=B-1),!Z&&xe){W=ie;break}V++}return W||P},zz=function(n){var a=bn(n)?[]:n.toString().split(lZ);return[{words:a}]},BUe=function(n){var a=n.width,o=n.scaleToFit,d=n.children,p=n.style,f=n.breakAll,v=n.maxLines;if((a||o)&&!Hh.isSsr){var b,E,T=dZ({breakAll:f,children:d,style:p});if(T){var w=T.wordsWithComputedWidth,N=T.spaceWidth;b=w,E=N}else return zz(d);return VUe({breakAll:f,children:d,maxLines:v,style:p},b,E,a,o)}return zz(d)},Kz="#808080",jS=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,p=d===void 0?0:d,f=n.lineHeight,v=f===void 0?"1em":f,b=n.capHeight,E=b===void 0?"0.71em":b,T=n.scaleToFit,w=T===void 0?!1:T,N=n.textAnchor,P=N===void 0?"start":N,A=n.verticalAnchor,k=A===void 0?"end":A,I=n.fill,F=I===void 0?Kz:I,U=Wz(n,DUe),V=q.useMemo(function(){return BUe({breakAll:U.breakAll,children:U.children,maxLines:U.maxLines,scaleToFit:w,style:U.style,width:U.width})},[U.breakAll,U.children,U.maxLines,w,U.style,U.width]),W=U.dx,B=U.dy,z=U.angle,Y=U.className,re=U.breakAll,Z=Wz(U,kUe);if(!Ei(o)||!Ei(p))return null;var ie=o+(ct(W)?W:0),te=p+(ct(B)?B:0),de;switch(k){case"start":de=YO("calc(".concat(E,")"));break;case"middle":de=YO("calc(".concat((V.length-1)/2," * -").concat(v," + (").concat(E," / 2))"));break;default:de=YO("calc(".concat(V.length-1," * -").concat(v,")"));break}var xe=[];if(w){var me=V[0].width,Ce=U.width;xe.push("scale(".concat((ct(Ce)?Ce/me:1)/me,")"))}return z&&xe.push("rotate(".concat(z,", ").concat(ie,", ").concat(te,")")),xe.length&&(Z.transform=xe.join(" ")),fe.createElement("text",JP({},yn(Z,!0),{x:ie,y:te,className:On("recharts-text",Y),textAnchor:P,fill:F.includes("url")?Kz:F}),V.map(function(ue,be){var se=ue.words.join(re?"":" ");return fe.createElement("tspan",{x:ie,dy:be===0?de:v,key:"".concat(se,"-").concat(be)},se)}))};function Yd(e,n){return e==null||n==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function GUe(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function M2(e){let n,a,o;e.length!==2?(n=Yd,a=(v,b)=>Yd(e(v),b),o=(v,b)=>e(v)-b):(n=e===Yd||e===GUe?e:WUe,a=e,o=e);function d(v,b,E=0,T=v.length){if(E<T){if(n(b,b)!==0)return T;do{const w=E+T>>>1;a(v[w],b)<0?E=w+1:T=w}while(E<T)}return E}function p(v,b,E=0,T=v.length){if(E<T){if(n(b,b)!==0)return T;do{const w=E+T>>>1;a(v[w],b)<=0?E=w+1:T=w}while(E<T)}return E}function f(v,b,E=0,T=v.length){const w=d(v,b,E,T-1);return w>E&&o(v[w-1],b)>-o(v[w],b)?w-1:w}return{left:d,center:f,right:p}}function WUe(){return 0}function uZ(e){return e===null?NaN:+e}function*$Ue(e,n){for(let a of e)a!=null&&(a=+a)>=a&&(yield a)}const HUe=M2(Yd),M0=HUe.right;M2(uZ).center;class Yz extends Map{constructor(n,a=YUe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:a}}),n!=null)for(const[o,d]of n)this.set(o,d)}get(n){return super.get(qz(this,n))}has(n){return super.has(qz(this,n))}set(n,a){return super.set(zUe(this,n),a)}delete(n){return super.delete(KUe(this,n))}}function qz({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):a}function zUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)?e.get(o):(e.set(o,a),a)}function KUe({_intern:e,_key:n},a){const o=n(a);return e.has(o)&&(a=e.get(o),e.delete(o)),a}function YUe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function qUe(e=Yd){if(e===Yd)return hZ;if(typeof e!="function")throw new TypeError("compare is not a function");return(n,a)=>{const o=e(n,a);return o||o===0?o:(e(a,a)===0)-(e(n,n)===0)}}function hZ(e,n){return(e==null||!(e>=e))-(n==null||!(n>=n))||(e<n?-1:e>n?1:0)}const XUe=Math.sqrt(50),JUe=Math.sqrt(10),QUe=Math.sqrt(2);function LS(e,n,a){const o=(n-e)/Math.max(0,a),d=Math.floor(Math.log10(o)),p=o/Math.pow(10,d),f=p>=XUe?10:p>=JUe?5:p>=QUe?2:1;let v,b,E;return d<0?(E=Math.pow(10,-d)/f,v=Math.round(e*E),b=Math.round(n*E),v/E<e&&++v,b/E>n&&--b,E=-E):(E=Math.pow(10,d)*f,v=Math.round(e/E),b=Math.round(n/E),v*E<e&&++v,b*E>n&&--b),b<v&&.5<=a&&a<2?LS(e,n,a*2):[v,b,E]}function QP(e,n,a){if(n=+n,e=+e,a=+a,!(a>0))return[];if(e===n)return[e];const o=n<e,[d,p,f]=o?LS(n,e,a):LS(e,n,a);if(!(p>=d))return[];const v=p-d+1,b=new Array(v);if(o)if(f<0)for(let E=0;E<v;++E)b[E]=(p-E)/-f;else for(let E=0;E<v;++E)b[E]=(p-E)*f;else if(f<0)for(let E=0;E<v;++E)b[E]=(d+E)/-f;else for(let E=0;E<v;++E)b[E]=(d+E)*f;return b}function ZP(e,n,a){return n=+n,e=+e,a=+a,LS(e,n,a)[2]}function eD(e,n,a){n=+n,e=+e,a=+a;const o=n<e,d=o?ZP(n,e,a):ZP(e,n,a);return(o?-1:1)*(d<0?1/-d:d)}function Xz(e,n){let a;for(const o of e)o!=null&&(a<o||a===void 0&&o>=o)&&(a=o);return a}function Jz(e,n){let a;for(const o of e)o!=null&&(a>o||a===void 0&&o>=o)&&(a=o);return a}function pZ(e,n,a=0,o=1/0,d){if(n=Math.floor(n),a=Math.floor(Math.max(0,a)),o=Math.floor(Math.min(e.length-1,o)),!(a<=n&&n<=o))return e;for(d=d===void 0?hZ:qUe(d);o>a;){if(o-a>600){const b=o-a+1,E=n-a+1,T=Math.log(b),w=.5*Math.exp(2*T/3),N=.5*Math.sqrt(T*w*(b-w)/b)*(E-b/2<0?-1:1),P=Math.max(a,Math.floor(n-E*w/b+N)),A=Math.min(o,Math.floor(n+(b-E)*w/b+N));pZ(e,n,P,A,d)}const p=e[n];let f=a,v=o;for(Wv(e,a,n),d(e[o],p)>0&&Wv(e,a,o);f<v;){for(Wv(e,f,v),++f,--v;d(e[f],p)<0;)++f;for(;d(e[v],p)>0;)--v}d(e[a],p)===0?Wv(e,a,v):(++v,Wv(e,v,o)),v<=n&&(a=v+1),n<=v&&(o=v-1)}return e}function Wv(e,n,a){const o=e[n];e[n]=e[a],e[a]=o}function ZUe(e,n,a){if(e=Float64Array.from($Ue(e)),!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return Jz(e);if(n>=1)return Xz(e);var o,d=(o-1)*n,p=Math.floor(d),f=Xz(pZ(e,p).subarray(0,p+1)),v=Jz(e.subarray(p+1));return f+(v-f)*(d-p)}}function e5e(e,n,a=uZ){if(!(!(o=e.length)||isNaN(n=+n))){if(n<=0||o<2)return+a(e[0],0,e);if(n>=1)return+a(e[o-1],o-1,e);var o,d=(o-1)*n,p=Math.floor(d),f=+a(e[p],p,e),v=+a(e[p+1],p+1,e);return f+(v-f)*(d-p)}}function t5e(e,n,a){e=+e,n=+n,a=(d=arguments.length)<2?(n=e,e=0,1):d<3?1:+a;for(var o=-1,d=Math.max(0,Math.ceil((n-e)/a))|0,p=new Array(d);++o<d;)p[o]=e+o*a;return p}function _o(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function Bl(e,n){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const tD=Symbol("implicit");function U2(){var e=new Yz,n=[],a=[],o=tD;function d(p){let f=e.get(p);if(f===void 0){if(o!==tD)return o;e.set(p,f=n.push(p)-1)}return a[f%a.length]}return d.domain=function(p){if(!arguments.length)return n.slice();n=[],e=new Yz;for(const f of p)e.has(f)||e.set(f,n.push(f)-1);return d},d.range=function(p){return arguments.length?(a=Array.from(p),d):a.slice()},d.unknown=function(p){return arguments.length?(o=p,d):o},d.copy=function(){return U2(n,a).unknown(o)},_o.apply(d,arguments),d}function Ky(){var e=U2().unknown(void 0),n=e.domain,a=e.range,o=0,d=1,p,f,v=!1,b=0,E=0,T=.5;delete e.unknown;function w(){var N=n().length,P=d<o,A=P?d:o,k=P?o:d;p=(k-A)/Math.max(1,N-b+E*2),v&&(p=Math.floor(p)),A+=(k-A-p*(N-b))*T,f=p*(1-b),v&&(A=Math.round(A),f=Math.round(f));var I=t5e(N).map(function(F){return A+p*F});return a(P?I.reverse():I)}return e.domain=function(N){return arguments.length?(n(N),w()):n()},e.range=function(N){return arguments.length?([o,d]=N,o=+o,d=+d,w()):[o,d]},e.rangeRound=function(N){return[o,d]=N,o=+o,d=+d,v=!0,w()},e.bandwidth=function(){return f},e.step=function(){return p},e.round=function(N){return arguments.length?(v=!!N,w()):v},e.padding=function(N){return arguments.length?(b=Math.min(1,E=+N),w()):b},e.paddingInner=function(N){return arguments.length?(b=Math.min(1,N),w()):b},e.paddingOuter=function(N){return arguments.length?(E=+N,w()):E},e.align=function(N){return arguments.length?(T=Math.max(0,Math.min(1,N)),w()):T},e.copy=function(){return Ky(n(),[o,d]).round(v).paddingInner(b).paddingOuter(E).align(T)},_o.apply(w(),arguments)}function mZ(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return mZ(n())},e}function gy(){return mZ(Ky.apply(null,arguments).paddingInner(1))}function F2(e,n,a){e.prototype=n.prototype=a,a.constructor=e}function fZ(e,n){var a=Object.create(e.prototype);for(var o in n)a[o]=n[o];return a}function U0(){}var Yy=.7,MS=1/Yy,Ym="\\s*([+-]?\\d+)\\s*",qy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$c="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",n5e=/^#([0-9a-f]{3,8})$/,r5e=new RegExp(`^rgb\\(${Ym},${Ym},${Ym}\\)$`),i5e=new RegExp(`^rgb\\(${$c},${$c},${$c}\\)$`),a5e=new RegExp(`^rgba\\(${Ym},${Ym},${Ym},${qy}\\)$`),s5e=new RegExp(`^rgba\\(${$c},${$c},${$c},${qy}\\)$`),o5e=new RegExp(`^hsl\\(${qy},${$c},${$c}\\)$`),c5e=new RegExp(`^hsla\\(${qy},${$c},${$c},${qy}\\)$`),Qz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};F2(U0,Xy,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Zz,formatHex:Zz,formatHex8:l5e,formatHsl:d5e,formatRgb:eK,toString:eK});function Zz(){return this.rgb().formatHex()}function l5e(){return this.rgb().formatHex8()}function d5e(){return gZ(this).formatHsl()}function eK(){return this.rgb().formatRgb()}function Xy(e){var n,a;return e=(e+"").trim().toLowerCase(),(n=n5e.exec(e))?(a=n[1].length,n=parseInt(n[1],16),a===6?tK(n):a===3?new Qa(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):a===8?px(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):a===4?px(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=r5e.exec(e))?new Qa(n[1],n[2],n[3],1):(n=i5e.exec(e))?new Qa(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=a5e.exec(e))?px(n[1],n[2],n[3],n[4]):(n=s5e.exec(e))?px(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=o5e.exec(e))?iK(n[1],n[2]/100,n[3]/100,1):(n=c5e.exec(e))?iK(n[1],n[2]/100,n[3]/100,n[4]):Qz.hasOwnProperty(e)?tK(Qz[e]):e==="transparent"?new Qa(NaN,NaN,NaN,0):null}function tK(e){return new Qa(e>>16&255,e>>8&255,e&255,1)}function px(e,n,a,o){return o<=0&&(e=n=a=NaN),new Qa(e,n,a,o)}function u5e(e){return e instanceof U0||(e=Xy(e)),e?(e=e.rgb(),new Qa(e.r,e.g,e.b,e.opacity)):new Qa}function nD(e,n,a,o){return arguments.length===1?u5e(e):new Qa(e,n,a,o??1)}function Qa(e,n,a,o){this.r=+e,this.g=+n,this.b=+a,this.opacity=+o}F2(Qa,nD,fZ(U0,{brighter(e){return e=e==null?MS:Math.pow(MS,e),new Qa(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Yy:Math.pow(Yy,e),new Qa(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Qa(Rh(this.r),Rh(this.g),Rh(this.b),US(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nK,formatHex:nK,formatHex8:h5e,formatRgb:rK,toString:rK}));function nK(){return`#${bh(this.r)}${bh(this.g)}${bh(this.b)}`}function h5e(){return`#${bh(this.r)}${bh(this.g)}${bh(this.b)}${bh((isNaN(this.opacity)?1:this.opacity)*255)}`}function rK(){const e=US(this.opacity);return`${e===1?"rgb(":"rgba("}${Rh(this.r)}, ${Rh(this.g)}, ${Rh(this.b)}${e===1?")":`, ${e})`}`}function US(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Rh(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function bh(e){return e=Rh(e),(e<16?"0":"")+e.toString(16)}function iK(e,n,a,o){return o<=0?e=n=a=NaN:a<=0||a>=1?e=n=NaN:n<=0&&(e=NaN),new Qo(e,n,a,o)}function gZ(e){if(e instanceof Qo)return new Qo(e.h,e.s,e.l,e.opacity);if(e instanceof U0||(e=Xy(e)),!e)return new Qo;if(e instanceof Qo)return e;e=e.rgb();var n=e.r/255,a=e.g/255,o=e.b/255,d=Math.min(n,a,o),p=Math.max(n,a,o),f=NaN,v=p-d,b=(p+d)/2;return v?(n===p?f=(a-o)/v+(a<o)*6:a===p?f=(o-n)/v+2:f=(n-a)/v+4,v/=b<.5?p+d:2-p-d,f*=60):v=b>0&&b<1?0:f,new Qo(f,v,b,e.opacity)}function p5e(e,n,a,o){return arguments.length===1?gZ(e):new Qo(e,n,a,o??1)}function Qo(e,n,a,o){this.h=+e,this.s=+n,this.l=+a,this.opacity=+o}F2(Qo,p5e,fZ(U0,{brighter(e){return e=e==null?MS:Math.pow(MS,e),new Qo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Yy:Math.pow(Yy,e),new Qo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,o=a+(a<.5?a:1-a)*n,d=2*a-o;return new Qa(qO(e>=240?e-240:e+120,d,o),qO(e,d,o),qO(e<120?e+240:e-120,d,o),this.opacity)},clamp(){return new Qo(aK(this.h),mx(this.s),mx(this.l),US(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=US(this.opacity);return`${e===1?"hsl(":"hsla("}${aK(this.h)}, ${mx(this.s)*100}%, ${mx(this.l)*100}%${e===1?")":`, ${e})`}`}}));function aK(e){return e=(e||0)%360,e<0?e+360:e}function mx(e){return Math.max(0,Math.min(1,e||0))}function qO(e,n,a){return(e<60?n+(a-n)*e/60:e<180?a:e<240?n+(a-n)*(240-e)/60:n)*255}const V2=e=>()=>e;function m5e(e,n){return function(a){return e+a*n}}function f5e(e,n,a){return e=Math.pow(e,a),n=Math.pow(n,a)-e,a=1/a,function(o){return Math.pow(e+o*n,a)}}function g5e(e){return(e=+e)==1?vZ:function(n,a){return a-n?f5e(n,a,e):V2(isNaN(n)?a:n)}}function vZ(e,n){var a=n-e;return a?m5e(e,a):V2(isNaN(e)?n:e)}const sK=function e(n){var a=g5e(n);function o(d,p){var f=a((d=nD(d)).r,(p=nD(p)).r),v=a(d.g,p.g),b=a(d.b,p.b),E=vZ(d.opacity,p.opacity);return function(T){return d.r=f(T),d.g=v(T),d.b=b(T),d.opacity=E(T),d+""}}return o.gamma=e,o}(1);function v5e(e,n){n||(n=[]);var a=e?Math.min(n.length,e.length):0,o=n.slice(),d;return function(p){for(d=0;d<a;++d)o[d]=e[d]*(1-p)+n[d]*p;return o}}function y5e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _5e(e,n){var a=n?n.length:0,o=e?Math.min(a,e.length):0,d=new Array(o),p=new Array(a),f;for(f=0;f<o;++f)d[f]=Zf(e[f],n[f]);for(;f<a;++f)p[f]=n[f];return function(v){for(f=0;f<o;++f)p[f]=d[f](v);return p}}function b5e(e,n){var a=new Date;return e=+e,n=+n,function(o){return a.setTime(e*(1-o)+n*o),a}}function FS(e,n){return e=+e,n=+n,function(a){return e*(1-a)+n*a}}function E5e(e,n){var a={},o={},d;(e===null||typeof e!="object")&&(e={}),(n===null||typeof n!="object")&&(n={});for(d in n)d in e?a[d]=Zf(e[d],n[d]):o[d]=n[d];return function(p){for(d in a)o[d]=a[d](p);return o}}var rD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,XO=new RegExp(rD.source,"g");function x5e(e){return function(){return e}}function S5e(e){return function(n){return e(n)+""}}function w5e(e,n){var a=rD.lastIndex=XO.lastIndex=0,o,d,p,f=-1,v=[],b=[];for(e=e+"",n=n+"";(o=rD.exec(e))&&(d=XO.exec(n));)(p=d.index)>a&&(p=n.slice(a,p),v[f]?v[f]+=p:v[++f]=p),(o=o[0])===(d=d[0])?v[f]?v[f]+=d:v[++f]=d:(v[++f]=null,b.push({i:f,x:FS(o,d)})),a=XO.lastIndex;return a<n.length&&(p=n.slice(a),v[f]?v[f]+=p:v[++f]=p),v.length<2?b[0]?S5e(b[0].x):x5e(n):(n=b.length,function(E){for(var T=0,w;T<n;++T)v[(w=b[T]).i]=w.x(E);return v.join("")})}function Zf(e,n){var a=typeof n,o;return n==null||a==="boolean"?V2(n):(a==="number"?FS:a==="string"?(o=Xy(n))?(n=o,sK):w5e:n instanceof Xy?sK:n instanceof Date?b5e:y5e(n)?v5e:Array.isArray(n)?_5e:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?E5e:FS)(e,n)}function B2(e,n){return e=+e,n=+n,function(a){return Math.round(e*(1-a)+n*a)}}function T5e(e,n){n===void 0&&(n=e,e=Zf);for(var a=0,o=n.length-1,d=n[0],p=new Array(o<0?0:o);a<o;)p[a]=e(d,d=n[++a]);return function(f){var v=Math.max(0,Math.min(o-1,Math.floor(f*=o)));return p[v](f-v)}}function C5e(e){return function(){return e}}function VS(e){return+e}var oK=[0,1];function Na(e){return e}function iD(e,n){return(n-=e=+e)?function(a){return(a-e)/n}:C5e(isNaN(n)?NaN:.5)}function N5e(e,n){var a;return e>n&&(a=e,e=n,n=a),function(o){return Math.max(e,Math.min(n,o))}}function R5e(e,n,a){var o=e[0],d=e[1],p=n[0],f=n[1];return d<o?(o=iD(d,o),p=a(f,p)):(o=iD(o,d),p=a(p,f)),function(v){return p(o(v))}}function A5e(e,n,a){var o=Math.min(e.length,n.length)-1,d=new Array(o),p=new Array(o),f=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++f<o;)d[f]=iD(e[f],e[f+1]),p[f]=a(n[f],n[f+1]);return function(v){var b=M0(e,v,1,o)-1;return p[b](d[b](v))}}function F0(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ET(){var e=oK,n=oK,a=Zf,o,d,p,f=Na,v,b,E;function T(){var N=Math.min(e.length,n.length);return f!==Na&&(f=N5e(e[0],e[N-1])),v=N>2?A5e:R5e,b=E=null,w}function w(N){return N==null||isNaN(N=+N)?p:(b||(b=v(e.map(o),n,a)))(o(f(N)))}return w.invert=function(N){return f(d((E||(E=v(n,e.map(o),FS)))(N)))},w.domain=function(N){return arguments.length?(e=Array.from(N,VS),T()):e.slice()},w.range=function(N){return arguments.length?(n=Array.from(N),T()):n.slice()},w.rangeRound=function(N){return n=Array.from(N),a=B2,T()},w.clamp=function(N){return arguments.length?(f=N?!0:Na,T()):f!==Na},w.interpolate=function(N){return arguments.length?(a=N,T()):a},w.unknown=function(N){return arguments.length?(p=N,w):p},function(N,P){return o=N,d=P,T()}}function G2(){return ET()(Na,Na)}function I5e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function BS(e,n){if((a=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var a,o=e.slice(0,a);return[o.length>1?o[0]+o.slice(2):o,+e.slice(a+1)]}function pf(e){return e=BS(Math.abs(e)),e?e[1]:NaN}function O5e(e,n){return function(a,o){for(var d=a.length,p=[],f=0,v=e[0],b=0;d>0&&v>0&&(b+v+1>o&&(v=Math.max(1,o-b)),p.push(a.substring(d-=v,d+v)),!((b+=v+1)>o));)v=e[f=(f+1)%e.length];return p.reverse().join(n)}}function P5e(e){return function(n){return n.replace(/[0-9]/g,function(a){return e[+a]})}}var D5e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jy(e){if(!(n=D5e.exec(e)))throw new Error("invalid format: "+e);var n;return new W2({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Jy.prototype=W2.prototype;function W2(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}W2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function k5e(e){e:for(var n=e.length,a=1,o=-1,d;a<n;++a)switch(e[a]){case".":o=d=a;break;case"0":o===0&&(o=a),d=a;break;default:if(!+e[a])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(d+1):e}var yZ;function j5e(e,n){var a=BS(e,n);if(!a)return e+"";var o=a[0],d=a[1],p=d-(yZ=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,f=o.length;return p===f?o:p>f?o+new Array(p-f+1).join("0"):p>0?o.slice(0,p)+"."+o.slice(p):"0."+new Array(1-p).join("0")+BS(e,Math.max(0,n+p-1))[0]}function cK(e,n){var a=BS(e,n);if(!a)return e+"";var o=a[0],d=a[1];return d<0?"0."+new Array(-d).join("0")+o:o.length>d+1?o.slice(0,d+1)+"."+o.slice(d+1):o+new Array(d-o.length+2).join("0")}const lK={"%":(e,n)=>(e*100).toFixed(n),b:e=>Math.round(e).toString(2),c:e=>e+"",d:I5e,e:(e,n)=>e.toExponential(n),f:(e,n)=>e.toFixed(n),g:(e,n)=>e.toPrecision(n),o:e=>Math.round(e).toString(8),p:(e,n)=>cK(e*100,n),r:cK,s:j5e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function dK(e){return e}var uK=Array.prototype.map,hK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function L5e(e){var n=e.grouping===void 0||e.thousands===void 0?dK:O5e(uK.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",p=e.numerals===void 0?dK:P5e(uK.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"":e.minus+"",b=e.nan===void 0?"NaN":e.nan+"";function E(w){w=Jy(w);var N=w.fill,P=w.align,A=w.sign,k=w.symbol,I=w.zero,F=w.width,U=w.comma,V=w.precision,W=w.trim,B=w.type;B==="n"?(U=!0,B="g"):lK[B]||(V===void 0&&(V=12),W=!0,B="g"),(I||N==="0"&&P==="=")&&(I=!0,N="0",P="=");var z=k==="$"?a:k==="#"&&/[boxX]/.test(B)?"0"+B.toLowerCase():"",Y=k==="$"?o:/[%p]/.test(B)?f:"",re=lK[B],Z=/[defgprs%]/.test(B);V=V===void 0?6:/[gprs]/.test(B)?Math.max(1,Math.min(21,V)):Math.max(0,Math.min(20,V));function ie(te){var de=z,xe=Y,me,Ce,ue;if(B==="c")xe=re(te)+xe,te="";else{te=+te;var be=te<0||1/te<0;if(te=isNaN(te)?b:re(Math.abs(te),V),W&&(te=k5e(te)),be&&+te==0&&A!=="+"&&(be=!1),de=(be?A==="("?A:v:A==="-"||A==="("?"":A)+de,xe=(B==="s"?hK[8+yZ/3]:"")+xe+(be&&A==="("?")":""),Z){for(me=-1,Ce=te.length;++me<Ce;)if(ue=te.charCodeAt(me),48>ue||ue>57){xe=(ue===46?d+te.slice(me+1):te.slice(me))+xe,te=te.slice(0,me);break}}}U&&!I&&(te=n(te,1/0));var se=de.length+te.length+xe.length,pe=se<F?new Array(F-se+1).join(N):"";switch(U&&I&&(te=n(pe+te,pe.length?F-xe.length:1/0),pe=""),P){case"<":te=de+te+xe+pe;break;case"=":te=de+pe+te+xe;break;case"^":te=pe.slice(0,se=pe.length>>1)+de+te+xe+pe.slice(se);break;default:te=pe+de+te+xe;break}return p(te)}return ie.toString=function(){return w+""},ie}function T(w,N){var P=E((w=Jy(w),w.type="f",w)),A=Math.max(-8,Math.min(8,Math.floor(pf(N)/3)))*3,k=Math.pow(10,-A),I=hK[8+A/3];return function(F){return P(k*F)+I}}return{format:E,formatPrefix:T}}var fx,$2,_Z;M5e({thousands:",",grouping:[3],currency:["$",""]});function M5e(e){return fx=L5e(e),$2=fx.format,_Z=fx.formatPrefix,fx}function U5e(e){return Math.max(0,-pf(Math.abs(e)))}function F5e(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pf(n)/3)))*3-pf(Math.abs(e)))}function V5e(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,pf(n)-pf(e))+1}function bZ(e,n,a,o){var d=eD(e,n,a),p;switch(o=Jy(o??",f"),o.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(n));return o.precision==null&&!isNaN(p=F5e(d,f))&&(o.precision=p),_Z(o,f)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(p=V5e(d,Math.max(Math.abs(e),Math.abs(n))))&&(o.precision=p-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(p=U5e(d))&&(o.precision=p-(o.type==="%")*2);break}}return $2(o)}function su(e){var n=e.domain;return e.ticks=function(a){var o=n();return QP(o[0],o[o.length-1],a??10)},e.tickFormat=function(a,o){var d=n();return bZ(d[0],d[d.length-1],a??10,o)},e.nice=function(a){a==null&&(a=10);var o=n(),d=0,p=o.length-1,f=o[d],v=o[p],b,E,T=10;for(v<f&&(E=f,f=v,v=E,E=d,d=p,p=E);T-- >0;){if(E=ZP(f,v,a),E===b)return o[d]=f,o[p]=v,n(o);if(E>0)f=Math.floor(f/E)*E,v=Math.ceil(v/E)*E;else if(E<0)f=Math.ceil(f*E)/E,v=Math.floor(v*E)/E;else break;b=E}return e},e}function GS(){var e=G2();return e.copy=function(){return F0(e,GS())},_o.apply(e,arguments),su(e)}function EZ(e){var n;function a(o){return o==null||isNaN(o=+o)?n:o}return a.invert=a,a.domain=a.range=function(o){return arguments.length?(e=Array.from(o,VS),a):e.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return EZ(e).unknown(n)},e=arguments.length?Array.from(e,VS):[0,1],su(a)}function xZ(e,n){e=e.slice();var a=0,o=e.length-1,d=e[a],p=e[o],f;return p<d&&(f=a,a=o,o=f,f=d,d=p,p=f),e[a]=n.floor(d),e[o]=n.ceil(p),e}function pK(e){return Math.log(e)}function mK(e){return Math.exp(e)}function B5e(e){return-Math.log(-e)}function G5e(e){return-Math.exp(-e)}function W5e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function $5e(e){return e===10?W5e:e===Math.E?Math.exp:n=>Math.pow(e,n)}function H5e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),n=>Math.log(n)/e)}function fK(e){return(n,a)=>-e(-n,a)}function H2(e){const n=e(pK,mK),a=n.domain;let o=10,d,p;function f(){return d=H5e(o),p=$5e(o),a()[0]<0?(d=fK(d),p=fK(p),e(B5e,G5e)):e(pK,mK),n}return n.base=function(v){return arguments.length?(o=+v,f()):o},n.domain=function(v){return arguments.length?(a(v),f()):a()},n.ticks=v=>{const b=a();let E=b[0],T=b[b.length-1];const w=T<E;w&&([E,T]=[T,E]);let N=d(E),P=d(T),A,k;const I=v==null?10:+v;let F=[];if(!(o%1)&&P-N<I){if(N=Math.floor(N),P=Math.ceil(P),E>0){for(;N<=P;++N)for(A=1;A<o;++A)if(k=N<0?A/p(-N):A*p(N),!(k<E)){if(k>T)break;F.push(k)}}else for(;N<=P;++N)for(A=o-1;A>=1;--A)if(k=N>0?A/p(-N):A*p(N),!(k<E)){if(k>T)break;F.push(k)}F.length*2<I&&(F=QP(E,T,I))}else F=QP(N,P,Math.min(P-N,I)).map(p);return w?F.reverse():F},n.tickFormat=(v,b)=>{if(v==null&&(v=10),b==null&&(b=o===10?"s":","),typeof b!="function"&&(!(o%1)&&(b=Jy(b)).precision==null&&(b.trim=!0),b=$2(b)),v===1/0)return b;const E=Math.max(1,o*v/n.ticks().length);return T=>{let w=T/p(Math.round(d(T)));return w*o<o-.5&&(w*=o),w<=E?b(T):""}},n.nice=()=>a(xZ(a(),{floor:v=>p(Math.floor(d(v))),ceil:v=>p(Math.ceil(d(v)))})),n}function SZ(){const e=H2(ET()).domain([1,10]);return e.copy=()=>F0(e,SZ()).base(e.base()),_o.apply(e,arguments),e}function gK(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function vK(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function z2(e){var n=1,a=e(gK(n),vK(n));return a.constant=function(o){return arguments.length?e(gK(n=+o),vK(n)):n},su(a)}function wZ(){var e=z2(ET());return e.copy=function(){return F0(e,wZ()).constant(e.constant())},_o.apply(e,arguments)}function yK(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function z5e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function K5e(e){return e<0?-e*e:e*e}function K2(e){var n=e(Na,Na),a=1;function o(){return a===1?e(Na,Na):a===.5?e(z5e,K5e):e(yK(a),yK(1/a))}return n.exponent=function(d){return arguments.length?(a=+d,o()):a},su(n)}function Y2(){var e=K2(ET());return e.copy=function(){return F0(e,Y2()).exponent(e.exponent())},_o.apply(e,arguments),e}function Y5e(){return Y2.apply(null,arguments).exponent(.5)}function _K(e){return Math.sign(e)*e*e}function q5e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function TZ(){var e=G2(),n=[0,1],a=!1,o;function d(p){var f=q5e(e(p));return isNaN(f)?o:a?Math.round(f):f}return d.invert=function(p){return e.invert(_K(p))},d.domain=function(p){return arguments.length?(e.domain(p),d):e.domain()},d.range=function(p){return arguments.length?(e.range((n=Array.from(p,VS)).map(_K)),d):n.slice()},d.rangeRound=function(p){return d.range(p).round(!0)},d.round=function(p){return arguments.length?(a=!!p,d):a},d.clamp=function(p){return arguments.length?(e.clamp(p),d):e.clamp()},d.unknown=function(p){return arguments.length?(o=p,d):o},d.copy=function(){return TZ(e.domain(),n).round(a).clamp(e.clamp()).unknown(o)},_o.apply(d,arguments),su(d)}function CZ(){var e=[],n=[],a=[],o;function d(){var f=0,v=Math.max(1,n.length);for(a=new Array(v-1);++f<v;)a[f-1]=e5e(e,f/v);return p}function p(f){return f==null||isNaN(f=+f)?o:n[M0(a,f)]}return p.invertExtent=function(f){var v=n.indexOf(f);return v<0?[NaN,NaN]:[v>0?a[v-1]:e[0],v<a.length?a[v]:e[e.length-1]]},p.domain=function(f){if(!arguments.length)return e.slice();e=[];for(let v of f)v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(Yd),d()},p.range=function(f){return arguments.length?(n=Array.from(f),d()):n.slice()},p.unknown=function(f){return arguments.length?(o=f,p):o},p.quantiles=function(){return a.slice()},p.copy=function(){return CZ().domain(e).range(n).unknown(o)},_o.apply(p,arguments)}function NZ(){var e=0,n=1,a=1,o=[.5],d=[0,1],p;function f(b){return b!=null&&b<=b?d[M0(o,b,0,a)]:p}function v(){var b=-1;for(o=new Array(a);++b<a;)o[b]=((b+1)*n-(b-a)*e)/(a+1);return f}return f.domain=function(b){return arguments.length?([e,n]=b,e=+e,n=+n,v()):[e,n]},f.range=function(b){return arguments.length?(a=(d=Array.from(b)).length-1,v()):d.slice()},f.invertExtent=function(b){var E=d.indexOf(b);return E<0?[NaN,NaN]:E<1?[e,o[0]]:E>=a?[o[a-1],n]:[o[E-1],o[E]]},f.unknown=function(b){return arguments.length&&(p=b),f},f.thresholds=function(){return o.slice()},f.copy=function(){return NZ().domain([e,n]).range(d).unknown(p)},_o.apply(su(f),arguments)}function RZ(){var e=[.5],n=[0,1],a,o=1;function d(p){return p!=null&&p<=p?n[M0(e,p,0,o)]:a}return d.domain=function(p){return arguments.length?(e=Array.from(p),o=Math.min(e.length,n.length-1),d):e.slice()},d.range=function(p){return arguments.length?(n=Array.from(p),o=Math.min(e.length,n.length-1),d):n.slice()},d.invertExtent=function(p){var f=n.indexOf(p);return[e[f-1],e[f]]},d.unknown=function(p){return arguments.length?(a=p,d):a},d.copy=function(){return RZ().domain(e).range(n).unknown(a)},_o.apply(d,arguments)}const JO=new Date,QO=new Date;function xi(e,n,a,o){function d(p){return e(p=arguments.length===0?new Date:new Date(+p)),p}return d.floor=p=>(e(p=new Date(+p)),p),d.ceil=p=>(e(p=new Date(p-1)),n(p,1),e(p),p),d.round=p=>{const f=d(p),v=d.ceil(p);return p-f<v-p?f:v},d.offset=(p,f)=>(n(p=new Date(+p),f==null?1:Math.floor(f)),p),d.range=(p,f,v)=>{const b=[];if(p=d.ceil(p),v=v==null?1:Math.floor(v),!(p<f)||!(v>0))return b;let E;do b.push(E=new Date(+p)),n(p,v),e(p);while(E<p&&p<f);return b},d.filter=p=>xi(f=>{if(f>=f)for(;e(f),!p(f);)f.setTime(f-1)},(f,v)=>{if(f>=f)if(v<0)for(;++v<=0;)for(;n(f,-1),!p(f););else for(;--v>=0;)for(;n(f,1),!p(f););}),a&&(d.count=(p,f)=>(JO.setTime(+p),QO.setTime(+f),e(JO),e(QO),Math.floor(a(JO,QO))),d.every=p=>(p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?d.filter(o?f=>o(f)%p===0:f=>d.count(0,f)%p===0):d)),d}const WS=xi(()=>{},(e,n)=>{e.setTime(+e+n)},(e,n)=>n-e);WS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?xi(n=>{n.setTime(Math.floor(n/e)*e)},(n,a)=>{n.setTime(+n+a*e)},(n,a)=>(a-n)/e):WS);WS.range;const bl=1e3,uo=bl*60,El=uo*60,Dl=El*24,q2=Dl*7,bK=Dl*30,ZO=Dl*365,Eh=xi(e=>{e.setTime(e-e.getMilliseconds())},(e,n)=>{e.setTime(+e+n*bl)},(e,n)=>(n-e)/bl,e=>e.getUTCSeconds());Eh.range;const X2=xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bl)},(e,n)=>{e.setTime(+e+n*uo)},(e,n)=>(n-e)/uo,e=>e.getMinutes());X2.range;const J2=xi(e=>{e.setUTCSeconds(0,0)},(e,n)=>{e.setTime(+e+n*uo)},(e,n)=>(n-e)/uo,e=>e.getUTCMinutes());J2.range;const Q2=xi(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bl-e.getMinutes()*uo)},(e,n)=>{e.setTime(+e+n*El)},(e,n)=>(n-e)/El,e=>e.getHours());Q2.range;const Z2=xi(e=>{e.setUTCMinutes(0,0,0)},(e,n)=>{e.setTime(+e+n*El)},(e,n)=>(n-e)/El,e=>e.getUTCHours());Z2.range;const V0=xi(e=>e.setHours(0,0,0,0),(e,n)=>e.setDate(e.getDate()+n),(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*uo)/Dl,e=>e.getDate()-1);V0.range;const xT=xi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/Dl,e=>e.getUTCDate()-1);xT.range;const AZ=xi(e=>{e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n)},(e,n)=>(n-e)/Dl,e=>Math.floor(e/Dl));AZ.range;function zh(e){return xi(n=>{n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},(n,a)=>{n.setDate(n.getDate()+a*7)},(n,a)=>(a-n-(a.getTimezoneOffset()-n.getTimezoneOffset())*uo)/q2)}const ST=zh(0),$S=zh(1),X5e=zh(2),J5e=zh(3),mf=zh(4),Q5e=zh(5),Z5e=zh(6);ST.range;$S.range;X5e.range;J5e.range;mf.range;Q5e.range;Z5e.range;function Kh(e){return xi(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCDate(n.getUTCDate()+a*7)},(n,a)=>(a-n)/q2)}const wT=Kh(0),HS=Kh(1),e4e=Kh(2),t4e=Kh(3),ff=Kh(4),n4e=Kh(5),r4e=Kh(6);wT.range;HS.range;e4e.range;t4e.range;ff.range;n4e.range;r4e.range;const ej=xi(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,n)=>{e.setMonth(e.getMonth()+n)},(e,n)=>n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12,e=>e.getMonth());ej.range;const tj=xi(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCMonth(e.getUTCMonth()+n)},(e,n)=>n.getUTCMonth()-e.getUTCMonth()+(n.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());tj.range;const kl=xi(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n)},(e,n)=>n.getFullYear()-e.getFullYear(),e=>e.getFullYear());kl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xi(n=>{n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,a)=>{n.setFullYear(n.getFullYear()+a*e)});kl.range;const jl=xi(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n)},(e,n)=>n.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());jl.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xi(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,a)=>{n.setUTCFullYear(n.getUTCFullYear()+a*e)});jl.range;function IZ(e,n,a,o,d,p){const f=[[Eh,1,bl],[Eh,5,5*bl],[Eh,15,15*bl],[Eh,30,30*bl],[p,1,uo],[p,5,5*uo],[p,15,15*uo],[p,30,30*uo],[d,1,El],[d,3,3*El],[d,6,6*El],[d,12,12*El],[o,1,Dl],[o,2,2*Dl],[a,1,q2],[n,1,bK],[n,3,3*bK],[e,1,ZO]];function v(E,T,w){const N=T<E;N&&([E,T]=[T,E]);const P=w&&typeof w.range=="function"?w:b(E,T,w),A=P?P.range(E,+T+1):[];return N?A.reverse():A}function b(E,T,w){const N=Math.abs(T-E)/w,P=M2(([,,I])=>I).right(f,N);if(P===f.length)return e.every(eD(E/ZO,T/ZO,w));if(P===0)return WS.every(Math.max(eD(E,T,w),1));const[A,k]=f[N/f[P-1][2]<f[P][2]/N?P-1:P];return A.every(k)}return[v,b]}const[i4e,a4e]=IZ(jl,tj,wT,AZ,Z2,J2),[s4e,o4e]=IZ(kl,ej,ST,V0,Q2,X2);function e1(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function t1(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function $v(e,n,a){return{y:e,m:n,d:a,H:0,M:0,S:0,L:0}}function c4e(e){var n=e.dateTime,a=e.date,o=e.time,d=e.periods,p=e.days,f=e.shortDays,v=e.months,b=e.shortMonths,E=Hv(d),T=zv(d),w=Hv(p),N=zv(p),P=Hv(f),A=zv(f),k=Hv(v),I=zv(v),F=Hv(b),U=zv(b),V={a:be,A:se,b:pe,B:De,c:null,d:CK,e:CK,f:O4e,g:B4e,G:W4e,H:R4e,I:A4e,j:I4e,L:OZ,m:P4e,M:D4e,p:Se,q:we,Q:AK,s:IK,S:k4e,u:j4e,U:L4e,V:M4e,w:U4e,W:F4e,x:null,X:null,y:V4e,Y:G4e,Z:$4e,"%":RK},W={a:qe,A:lt,b:Ut,B:Ht,c:null,d:NK,e:NK,f:Y4e,g:i3e,G:s3e,H:H4e,I:z4e,j:K4e,L:DZ,m:q4e,M:X4e,p:Ue,q:dt,Q:AK,s:IK,S:J4e,u:Q4e,U:Z4e,V:e3e,w:t3e,W:n3e,x:null,X:null,y:r3e,Y:a3e,Z:o3e,"%":RK},B={a:ie,A:te,b:de,B:xe,c:me,d:wK,e:wK,f:w4e,g:SK,G:xK,H:TK,I:TK,j:b4e,L:S4e,m:_4e,M:E4e,p:Z,q:y4e,Q:C4e,s:N4e,S:x4e,u:p4e,U:m4e,V:f4e,w:h4e,W:g4e,x:Ce,X:ue,y:SK,Y:xK,Z:v4e,"%":T4e};V.x=z(a,V),V.X=z(o,V),V.c=z(n,V),W.x=z(a,W),W.X=z(o,W),W.c=z(n,W);function z(Ne,Ke){return function(bt){var Te=[],gt=-1,Qe=0,Ft=Ne.length,At,ye,et;for(bt instanceof Date||(bt=new Date(+bt));++gt<Ft;)Ne.charCodeAt(gt)===37&&(Te.push(Ne.slice(Qe,gt)),(ye=EK[At=Ne.charAt(++gt)])!=null?At=Ne.charAt(++gt):ye=At==="e"?" ":"0",(et=Ke[At])&&(At=et(bt,ye)),Te.push(At),Qe=gt+1);return Te.push(Ne.slice(Qe,gt)),Te.join("")}}function Y(Ne,Ke){return function(bt){var Te=$v(1900,void 0,1),gt=re(Te,Ne,bt+="",0),Qe,Ft;if(gt!=bt.length)return null;if("Q"in Te)return new Date(Te.Q);if("s"in Te)return new Date(Te.s*1e3+("L"in Te?Te.L:0));if(Ke&&!("Z"in Te)&&(Te.Z=0),"p"in Te&&(Te.H=Te.H%12+Te.p*12),Te.m===void 0&&(Te.m="q"in Te?Te.q:0),"V"in Te){if(Te.V<1||Te.V>53)return null;"w"in Te||(Te.w=1),"Z"in Te?(Qe=t1($v(Te.y,0,1)),Ft=Qe.getUTCDay(),Qe=Ft>4||Ft===0?HS.ceil(Qe):HS(Qe),Qe=xT.offset(Qe,(Te.V-1)*7),Te.y=Qe.getUTCFullYear(),Te.m=Qe.getUTCMonth(),Te.d=Qe.getUTCDate()+(Te.w+6)%7):(Qe=e1($v(Te.y,0,1)),Ft=Qe.getDay(),Qe=Ft>4||Ft===0?$S.ceil(Qe):$S(Qe),Qe=V0.offset(Qe,(Te.V-1)*7),Te.y=Qe.getFullYear(),Te.m=Qe.getMonth(),Te.d=Qe.getDate()+(Te.w+6)%7)}else("W"in Te||"U"in Te)&&("w"in Te||(Te.w="u"in Te?Te.u%7:"W"in Te?1:0),Ft="Z"in Te?t1($v(Te.y,0,1)).getUTCDay():e1($v(Te.y,0,1)).getDay(),Te.m=0,Te.d="W"in Te?(Te.w+6)%7+Te.W*7-(Ft+5)%7:Te.w+Te.U*7-(Ft+6)%7);return"Z"in Te?(Te.H+=Te.Z/100|0,Te.M+=Te.Z%100,t1(Te)):e1(Te)}}function re(Ne,Ke,bt,Te){for(var gt=0,Qe=Ke.length,Ft=bt.length,At,ye;gt<Qe;){if(Te>=Ft)return-1;if(At=Ke.charCodeAt(gt++),At===37){if(At=Ke.charAt(gt++),ye=B[At in EK?Ke.charAt(gt++):At],!ye||(Te=ye(Ne,bt,Te))<0)return-1}else if(At!=bt.charCodeAt(Te++))return-1}return Te}function Z(Ne,Ke,bt){var Te=E.exec(Ke.slice(bt));return Te?(Ne.p=T.get(Te[0].toLowerCase()),bt+Te[0].length):-1}function ie(Ne,Ke,bt){var Te=P.exec(Ke.slice(bt));return Te?(Ne.w=A.get(Te[0].toLowerCase()),bt+Te[0].length):-1}function te(Ne,Ke,bt){var Te=w.exec(Ke.slice(bt));return Te?(Ne.w=N.get(Te[0].toLowerCase()),bt+Te[0].length):-1}function de(Ne,Ke,bt){var Te=F.exec(Ke.slice(bt));return Te?(Ne.m=U.get(Te[0].toLowerCase()),bt+Te[0].length):-1}function xe(Ne,Ke,bt){var Te=k.exec(Ke.slice(bt));return Te?(Ne.m=I.get(Te[0].toLowerCase()),bt+Te[0].length):-1}function me(Ne,Ke,bt){return re(Ne,n,Ke,bt)}function Ce(Ne,Ke,bt){return re(Ne,a,Ke,bt)}function ue(Ne,Ke,bt){return re(Ne,o,Ke,bt)}function be(Ne){return f[Ne.getDay()]}function se(Ne){return p[Ne.getDay()]}function pe(Ne){return b[Ne.getMonth()]}function De(Ne){return v[Ne.getMonth()]}function Se(Ne){return d[+(Ne.getHours()>=12)]}function we(Ne){return 1+~~(Ne.getMonth()/3)}function qe(Ne){return f[Ne.getUTCDay()]}function lt(Ne){return p[Ne.getUTCDay()]}function Ut(Ne){return b[Ne.getUTCMonth()]}function Ht(Ne){return v[Ne.getUTCMonth()]}function Ue(Ne){return d[+(Ne.getUTCHours()>=12)]}function dt(Ne){return 1+~~(Ne.getUTCMonth()/3)}return{format:function(Ne){var Ke=z(Ne+="",V);return Ke.toString=function(){return Ne},Ke},parse:function(Ne){var Ke=Y(Ne+="",!1);return Ke.toString=function(){return Ne},Ke},utcFormat:function(Ne){var Ke=z(Ne+="",W);return Ke.toString=function(){return Ne},Ke},utcParse:function(Ne){var Ke=Y(Ne+="",!0);return Ke.toString=function(){return Ne},Ke}}}var EK={"-":"",_:" ",0:"0"},Li=/^\s*\d+/,l4e=/^%/,d4e=/[\\^$*+?|[\]().{}]/g;function Bn(e,n,a){var o=e<0?"-":"",d=(o?-e:e)+"",p=d.length;return o+(p<a?new Array(a-p+1).join(n)+d:d)}function u4e(e){return e.replace(d4e,"\\$&")}function Hv(e){return new RegExp("^(?:"+e.map(u4e).join("|")+")","i")}function zv(e){return new Map(e.map((n,a)=>[n.toLowerCase(),a]))}function h4e(e,n,a){var o=Li.exec(n.slice(a,a+1));return o?(e.w=+o[0],a+o[0].length):-1}function p4e(e,n,a){var o=Li.exec(n.slice(a,a+1));return o?(e.u=+o[0],a+o[0].length):-1}function m4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.U=+o[0],a+o[0].length):-1}function f4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.V=+o[0],a+o[0].length):-1}function g4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.W=+o[0],a+o[0].length):-1}function xK(e,n,a){var o=Li.exec(n.slice(a,a+4));return o?(e.y=+o[0],a+o[0].length):-1}function SK(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),a+o[0].length):-1}function v4e(e,n,a){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(a,a+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),a+o[0].length):-1}function y4e(e,n,a){var o=Li.exec(n.slice(a,a+1));return o?(e.q=o[0]*3-3,a+o[0].length):-1}function _4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.m=o[0]-1,a+o[0].length):-1}function wK(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.d=+o[0],a+o[0].length):-1}function b4e(e,n,a){var o=Li.exec(n.slice(a,a+3));return o?(e.m=0,e.d=+o[0],a+o[0].length):-1}function TK(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.H=+o[0],a+o[0].length):-1}function E4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.M=+o[0],a+o[0].length):-1}function x4e(e,n,a){var o=Li.exec(n.slice(a,a+2));return o?(e.S=+o[0],a+o[0].length):-1}function S4e(e,n,a){var o=Li.exec(n.slice(a,a+3));return o?(e.L=+o[0],a+o[0].length):-1}function w4e(e,n,a){var o=Li.exec(n.slice(a,a+6));return o?(e.L=Math.floor(o[0]/1e3),a+o[0].length):-1}function T4e(e,n,a){var o=l4e.exec(n.slice(a,a+1));return o?a+o[0].length:-1}function C4e(e,n,a){var o=Li.exec(n.slice(a));return o?(e.Q=+o[0],a+o[0].length):-1}function N4e(e,n,a){var o=Li.exec(n.slice(a));return o?(e.s=+o[0],a+o[0].length):-1}function CK(e,n){return Bn(e.getDate(),n,2)}function R4e(e,n){return Bn(e.getHours(),n,2)}function A4e(e,n){return Bn(e.getHours()%12||12,n,2)}function I4e(e,n){return Bn(1+V0.count(kl(e),e),n,3)}function OZ(e,n){return Bn(e.getMilliseconds(),n,3)}function O4e(e,n){return OZ(e,n)+"000"}function P4e(e,n){return Bn(e.getMonth()+1,n,2)}function D4e(e,n){return Bn(e.getMinutes(),n,2)}function k4e(e,n){return Bn(e.getSeconds(),n,2)}function j4e(e){var n=e.getDay();return n===0?7:n}function L4e(e,n){return Bn(ST.count(kl(e)-1,e),n,2)}function PZ(e){var n=e.getDay();return n>=4||n===0?mf(e):mf.ceil(e)}function M4e(e,n){return e=PZ(e),Bn(mf.count(kl(e),e)+(kl(e).getDay()===4),n,2)}function U4e(e){return e.getDay()}function F4e(e,n){return Bn($S.count(kl(e)-1,e),n,2)}function V4e(e,n){return Bn(e.getFullYear()%100,n,2)}function B4e(e,n){return e=PZ(e),Bn(e.getFullYear()%100,n,2)}function G4e(e,n){return Bn(e.getFullYear()%1e4,n,4)}function W4e(e,n){var a=e.getDay();return e=a>=4||a===0?mf(e):mf.ceil(e),Bn(e.getFullYear()%1e4,n,4)}function $4e(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Bn(n/60|0,"0",2)+Bn(n%60,"0",2)}function NK(e,n){return Bn(e.getUTCDate(),n,2)}function H4e(e,n){return Bn(e.getUTCHours(),n,2)}function z4e(e,n){return Bn(e.getUTCHours()%12||12,n,2)}function K4e(e,n){return Bn(1+xT.count(jl(e),e),n,3)}function DZ(e,n){return Bn(e.getUTCMilliseconds(),n,3)}function Y4e(e,n){return DZ(e,n)+"000"}function q4e(e,n){return Bn(e.getUTCMonth()+1,n,2)}function X4e(e,n){return Bn(e.getUTCMinutes(),n,2)}function J4e(e,n){return Bn(e.getUTCSeconds(),n,2)}function Q4e(e){var n=e.getUTCDay();return n===0?7:n}function Z4e(e,n){return Bn(wT.count(jl(e)-1,e),n,2)}function kZ(e){var n=e.getUTCDay();return n>=4||n===0?ff(e):ff.ceil(e)}function e3e(e,n){return e=kZ(e),Bn(ff.count(jl(e),e)+(jl(e).getUTCDay()===4),n,2)}function t3e(e){return e.getUTCDay()}function n3e(e,n){return Bn(HS.count(jl(e)-1,e),n,2)}function r3e(e,n){return Bn(e.getUTCFullYear()%100,n,2)}function i3e(e,n){return e=kZ(e),Bn(e.getUTCFullYear()%100,n,2)}function a3e(e,n){return Bn(e.getUTCFullYear()%1e4,n,4)}function s3e(e,n){var a=e.getUTCDay();return e=a>=4||a===0?ff(e):ff.ceil(e),Bn(e.getUTCFullYear()%1e4,n,4)}function o3e(){return"+0000"}function RK(){return"%"}function AK(e){return+e}function IK(e){return Math.floor(+e/1e3)}var _m,jZ,LZ;c3e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function c3e(e){return _m=c4e(e),jZ=_m.format,_m.parse,LZ=_m.utcFormat,_m.utcParse,_m}function l3e(e){return new Date(e)}function d3e(e){return e instanceof Date?+e:+new Date(+e)}function nj(e,n,a,o,d,p,f,v,b,E){var T=G2(),w=T.invert,N=T.domain,P=E(".%L"),A=E(":%S"),k=E("%I:%M"),I=E("%I %p"),F=E("%a %d"),U=E("%b %d"),V=E("%B"),W=E("%Y");function B(z){return(b(z)<z?P:v(z)<z?A:f(z)<z?k:p(z)<z?I:o(z)<z?d(z)<z?F:U:a(z)<z?V:W)(z)}return T.invert=function(z){return new Date(w(z))},T.domain=function(z){return arguments.length?N(Array.from(z,d3e)):N().map(l3e)},T.ticks=function(z){var Y=N();return e(Y[0],Y[Y.length-1],z??10)},T.tickFormat=function(z,Y){return Y==null?B:E(Y)},T.nice=function(z){var Y=N();return(!z||typeof z.range!="function")&&(z=n(Y[0],Y[Y.length-1],z??10)),z?N(xZ(Y,z)):T},T.copy=function(){return F0(T,nj(e,n,a,o,d,p,f,v,b,E))},T}function u3e(){return _o.apply(nj(s4e,o4e,kl,ej,ST,V0,Q2,X2,Eh,jZ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function h3e(){return _o.apply(nj(i4e,a4e,jl,tj,wT,xT,Z2,J2,Eh,LZ).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function TT(){var e=0,n=1,a,o,d,p,f=Na,v=!1,b;function E(w){return w==null||isNaN(w=+w)?b:f(d===0?.5:(w=(p(w)-a)*d,v?Math.max(0,Math.min(1,w)):w))}E.domain=function(w){return arguments.length?([e,n]=w,a=p(e=+e),o=p(n=+n),d=a===o?0:1/(o-a),E):[e,n]},E.clamp=function(w){return arguments.length?(v=!!w,E):v},E.interpolator=function(w){return arguments.length?(f=w,E):f};function T(w){return function(N){var P,A;return arguments.length?([P,A]=N,f=w(P,A),E):[f(0),f(1)]}}return E.range=T(Zf),E.rangeRound=T(B2),E.unknown=function(w){return arguments.length?(b=w,E):b},function(w){return p=w,a=w(e),o=w(n),d=a===o?0:1/(o-a),E}}function ou(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function MZ(){var e=su(TT()(Na));return e.copy=function(){return ou(e,MZ())},Bl.apply(e,arguments)}function UZ(){var e=H2(TT()).domain([1,10]);return e.copy=function(){return ou(e,UZ()).base(e.base())},Bl.apply(e,arguments)}function FZ(){var e=z2(TT());return e.copy=function(){return ou(e,FZ()).constant(e.constant())},Bl.apply(e,arguments)}function rj(){var e=K2(TT());return e.copy=function(){return ou(e,rj()).exponent(e.exponent())},Bl.apply(e,arguments)}function p3e(){return rj.apply(null,arguments).exponent(.5)}function VZ(){var e=[],n=Na;function a(o){if(o!=null&&!isNaN(o=+o))return n((M0(e,o,1)-1)/(e.length-1))}return a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let d of o)d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(Yd),a},a.interpolator=function(o){return arguments.length?(n=o,a):n},a.range=function(){return e.map((o,d)=>n(d/(e.length-1)))},a.quantiles=function(o){return Array.from({length:o+1},(d,p)=>ZUe(e,p/o))},a.copy=function(){return VZ(n).domain(e)},Bl.apply(a,arguments)}function CT(){var e=0,n=.5,a=1,o=1,d,p,f,v,b,E=Na,T,w=!1,N;function P(k){return isNaN(k=+k)?N:(k=.5+((k=+T(k))-p)*(o*k<o*p?v:b),E(w?Math.max(0,Math.min(1,k)):k))}P.domain=function(k){return arguments.length?([e,n,a]=k,d=T(e=+e),p=T(n=+n),f=T(a=+a),v=d===p?0:.5/(p-d),b=p===f?0:.5/(f-p),o=p<d?-1:1,P):[e,n,a]},P.clamp=function(k){return arguments.length?(w=!!k,P):w},P.interpolator=function(k){return arguments.length?(E=k,P):E};function A(k){return function(I){var F,U,V;return arguments.length?([F,U,V]=I,E=T5e(k,[F,U,V]),P):[E(0),E(.5),E(1)]}}return P.range=A(Zf),P.rangeRound=A(B2),P.unknown=function(k){return arguments.length?(N=k,P):N},function(k){return T=k,d=k(e),p=k(n),f=k(a),v=d===p?0:.5/(p-d),b=p===f?0:.5/(f-p),o=p<d?-1:1,P}}function BZ(){var e=su(CT()(Na));return e.copy=function(){return ou(e,BZ())},Bl.apply(e,arguments)}function GZ(){var e=H2(CT()).domain([.1,1,10]);return e.copy=function(){return ou(e,GZ()).base(e.base())},Bl.apply(e,arguments)}function WZ(){var e=z2(CT());return e.copy=function(){return ou(e,WZ()).constant(e.constant())},Bl.apply(e,arguments)}function ij(){var e=K2(CT());return e.copy=function(){return ou(e,ij()).exponent(e.exponent())},Bl.apply(e,arguments)}function m3e(){return ij.apply(null,arguments).exponent(.5)}const OK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Ky,scaleDiverging:BZ,scaleDivergingLog:GZ,scaleDivergingPow:ij,scaleDivergingSqrt:m3e,scaleDivergingSymlog:WZ,scaleIdentity:EZ,scaleImplicit:tD,scaleLinear:GS,scaleLog:SZ,scaleOrdinal:U2,scalePoint:gy,scalePow:Y2,scaleQuantile:CZ,scaleQuantize:NZ,scaleRadial:TZ,scaleSequential:MZ,scaleSequentialLog:UZ,scaleSequentialPow:rj,scaleSequentialQuantile:VZ,scaleSequentialSqrt:p3e,scaleSequentialSymlog:FZ,scaleSqrt:Y5e,scaleSymlog:wZ,scaleThreshold:RZ,scaleTime:u3e,scaleUtc:h3e,tickFormat:bZ},Symbol.toStringTag,{value:"Module"}));var f3e=Wf;function g3e(e,n,a){for(var o=-1,d=e.length;++o<d;){var p=e[o],f=n(p);if(f!=null&&(v===void 0?f===f&&!f3e(f):a(f,v)))var v=f,b=p}return b}var $Z=g3e;function v3e(e,n){return e>n}var y3e=v3e,_3e=$Z,b3e=y3e,E3e=Qf;function x3e(e){return e&&e.length?_3e(e,E3e,b3e):void 0}var S3e=x3e;const kd=ar(S3e);function w3e(e,n){return e<n}var T3e=w3e,C3e=$Z,N3e=T3e,R3e=Qf;function A3e(e){return e&&e.length?C3e(e,R3e,N3e):void 0}var I3e=A3e;const NT=ar(I3e);var O3e=y2,P3e=au,D3e=QQ,k3e=is;function j3e(e,n){var a=k3e(e)?O3e:D3e;return a(e,P3e(n))}var L3e=j3e,M3e=XQ,U3e=L3e;function F3e(e,n){return M3e(U3e(e,n),1)}var V3e=F3e;const B3e=ar(V3e);var G3e=D2;function W3e(e,n){return G3e(e,n)}var $3e=W3e;const gf=ar($3e);var eg=1e9,H3e={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},sj,jr=!0,vo="[DecimalError] ",Ah=vo+"Invalid argument: ",aj=vo+"Exponent out of range: ",tg=Math.floor,uh=Math.pow,z3e=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ws,Oi=1e7,Tr=7,HZ=9007199254740991,zS=tg(HZ/Tr),Nt={};Nt.absoluteValue=Nt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Nt.comparedTo=Nt.cmp=function(e){var n,a,o,d,p=this;if(e=new p.constructor(e),p.s!==e.s)return p.s||-e.s;if(p.e!==e.e)return p.e>e.e^p.s<0?1:-1;for(o=p.d.length,d=e.d.length,n=0,a=o<d?o:d;n<a;++n)if(p.d[n]!==e.d[n])return p.d[n]>e.d[n]^p.s<0?1:-1;return o===d?0:o>d^p.s<0?1:-1};Nt.decimalPlaces=Nt.dp=function(){var e=this,n=e.d.length-1,a=(n-e.e)*Tr;if(n=e.d[n],n)for(;n%10==0;n/=10)a--;return a<0?0:a};Nt.dividedBy=Nt.div=function(e){return Cl(this,new this.constructor(e))};Nt.dividedToIntegerBy=Nt.idiv=function(e){var n=this,a=n.constructor;return ur(Cl(n,new a(e),0,1),a.precision)};Nt.equals=Nt.eq=function(e){return!this.cmp(e)};Nt.exponent=function(){return di(this)};Nt.greaterThan=Nt.gt=function(e){return this.cmp(e)>0};Nt.greaterThanOrEqualTo=Nt.gte=function(e){return this.cmp(e)>=0};Nt.isInteger=Nt.isint=function(){return this.e>this.d.length-2};Nt.isNegative=Nt.isneg=function(){return this.s<0};Nt.isPositive=Nt.ispos=function(){return this.s>0};Nt.isZero=function(){return this.s===0};Nt.lessThan=Nt.lt=function(e){return this.cmp(e)<0};Nt.lessThanOrEqualTo=Nt.lte=function(e){return this.cmp(e)<1};Nt.logarithm=Nt.log=function(e){var n,a=this,o=a.constructor,d=o.precision,p=d+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(ws))throw Error(vo+"NaN");if(a.s<1)throw Error(vo+(a.s?"NaN":"-Infinity"));return a.eq(ws)?new o(0):(jr=!1,n=Cl(Qy(a,p),Qy(e,p),p),jr=!0,ur(n,d))};Nt.minus=Nt.sub=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?YZ(n,e):zZ(n,(e.s=-e.s,e))};Nt.modulo=Nt.mod=function(e){var n,a=this,o=a.constructor,d=o.precision;if(e=new o(e),!e.s)throw Error(vo+"NaN");return a.s?(jr=!1,n=Cl(a,e,0,1).times(e),jr=!0,a.minus(n)):ur(new o(a),d)};Nt.naturalExponential=Nt.exp=function(){return KZ(this)};Nt.naturalLogarithm=Nt.ln=function(){return Qy(this)};Nt.negated=Nt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Nt.plus=Nt.add=function(e){var n=this;return e=new n.constructor(e),n.s==e.s?zZ(n,e):YZ(n,(e.s=-e.s,e))};Nt.precision=Nt.sd=function(e){var n,a,o,d=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ah+e);if(n=di(d)+1,o=d.d.length-1,a=o*Tr+1,o=d.d[o],o){for(;o%10==0;o/=10)a--;for(o=d.d[0];o>=10;o/=10)a++}return e&&n>a?n:a};Nt.squareRoot=Nt.sqrt=function(){var e,n,a,o,d,p,f,v=this,b=v.constructor;if(v.s<1){if(!v.s)return new b(0);throw Error(vo+"NaN")}for(e=di(v),jr=!1,d=Math.sqrt(+v),d==0||d==1/0?(n=Fc(v.d),(n.length+e)%2==0&&(n+="0"),d=Math.sqrt(n),e=tg((e+1)/2)-(e<0||e%2),d==1/0?n="5e"+e:(n=d.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),o=new b(n)):o=new b(d.toString()),a=b.precision,d=f=a+3;;)if(p=o,o=p.plus(Cl(v,p,f+2)).times(.5),Fc(p.d).slice(0,f)===(n=Fc(o.d)).slice(0,f)){if(n=n.slice(f-3,f+1),d==f&&n=="4999"){if(ur(p,a+1,0),p.times(p).eq(v)){o=p;break}}else if(n!="9999")break;f+=4}return jr=!0,ur(o,a)};Nt.times=Nt.mul=function(e){var n,a,o,d,p,f,v,b,E,T=this,w=T.constructor,N=T.d,P=(e=new w(e)).d;if(!T.s||!e.s)return new w(0);for(e.s*=T.s,a=T.e+e.e,b=N.length,E=P.length,b<E&&(p=N,N=P,P=p,f=b,b=E,E=f),p=[],f=b+E,o=f;o--;)p.push(0);for(o=E;--o>=0;){for(n=0,d=b+o;d>o;)v=p[d]+P[o]*N[d-o-1]+n,p[d--]=v%Oi|0,n=v/Oi|0;p[d]=(p[d]+n)%Oi|0}for(;!p[--f];)p.pop();return n?++a:p.shift(),e.d=p,e.e=a,jr?ur(e,w.precision):e};Nt.toDecimalPlaces=Nt.todp=function(e,n){var a=this,o=a.constructor;return a=new o(a),e===void 0?a:(Yc(e,0,eg),n===void 0?n=o.rounding:Yc(n,0,8),ur(a,e+di(a)+1,n))};Nt.toExponential=function(e,n){var a,o=this,d=o.constructor;return e===void 0?a=Fh(o,!0):(Yc(e,0,eg),n===void 0?n=d.rounding:Yc(n,0,8),o=ur(new d(o),e+1,n),a=Fh(o,!0,e+1)),a};Nt.toFixed=function(e,n){var a,o,d=this,p=d.constructor;return e===void 0?Fh(d):(Yc(e,0,eg),n===void 0?n=p.rounding:Yc(n,0,8),o=ur(new p(d),e+di(d)+1,n),a=Fh(o.abs(),!1,e+di(o)+1),d.isneg()&&!d.isZero()?"-"+a:a)};Nt.toInteger=Nt.toint=function(){var e=this,n=e.constructor;return ur(new n(e),di(e)+1,n.rounding)};Nt.toNumber=function(){return+this};Nt.toPower=Nt.pow=function(e){var n,a,o,d,p,f,v=this,b=v.constructor,E=12,T=+(e=new b(e));if(!e.s)return new b(ws);if(v=new b(v),!v.s){if(e.s<1)throw Error(vo+"Infinity");return v}if(v.eq(ws))return v;if(o=b.precision,e.eq(ws))return ur(v,o);if(n=e.e,a=e.d.length-1,f=n>=a,p=v.s,f){if((a=T<0?-T:T)<=HZ){for(d=new b(ws),n=Math.ceil(o/Tr+4),jr=!1;a%2&&(d=d.times(v),DK(d.d,n)),a=tg(a/2),a!==0;)v=v.times(v),DK(v.d,n);return jr=!0,e.s<0?new b(ws).div(d):ur(d,o)}}else if(p<0)throw Error(vo+"NaN");return p=p<0&&e.d[Math.max(n,a)]&1?-1:1,v.s=1,jr=!1,d=e.times(Qy(v,o+E)),jr=!0,d=KZ(d),d.s=p,d};Nt.toPrecision=function(e,n){var a,o,d=this,p=d.constructor;return e===void 0?(a=di(d),o=Fh(d,a<=p.toExpNeg||a>=p.toExpPos)):(Yc(e,1,eg),n===void 0?n=p.rounding:Yc(n,0,8),d=ur(new p(d),e,n),a=di(d),o=Fh(d,e<=a||a<=p.toExpNeg,e)),o};Nt.toSignificantDigits=Nt.tosd=function(e,n){var a=this,o=a.constructor;return e===void 0?(e=o.precision,n=o.rounding):(Yc(e,1,eg),n===void 0?n=o.rounding:Yc(n,0,8)),ur(new o(a),e,n)};Nt.toString=Nt.valueOf=Nt.val=Nt.toJSON=Nt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,n=di(e),a=e.constructor;return Fh(e,n<=a.toExpNeg||n>=a.toExpPos)};function zZ(e,n){var a,o,d,p,f,v,b,E,T=e.constructor,w=T.precision;if(!e.s||!n.s)return n.s||(n=new T(e)),jr?ur(n,w):n;if(b=e.d,E=n.d,f=e.e,d=n.e,b=b.slice(),p=f-d,p){for(p<0?(o=b,p=-p,v=E.length):(o=E,d=f,v=b.length),f=Math.ceil(w/Tr),v=f>v?f+1:v+1,p>v&&(p=v,o.length=1),o.reverse();p--;)o.push(0);o.reverse()}for(v=b.length,p=E.length,v-p<0&&(p=v,o=E,E=b,b=o),a=0;p;)a=(b[--p]=b[p]+E[p]+a)/Oi|0,b[p]%=Oi;for(a&&(b.unshift(a),++d),v=b.length;b[--v]==0;)b.pop();return n.d=b,n.e=d,jr?ur(n,w):n}function Yc(e,n,a){if(e!==~~e||e<n||e>a)throw Error(Ah+e)}function Fc(e){var n,a,o,d=e.length-1,p="",f=e[0];if(d>0){for(p+=f,n=1;n<d;n++)o=e[n]+"",a=Tr-o.length,a&&(p+=Td(a)),p+=o;f=e[n],o=f+"",a=Tr-o.length,a&&(p+=Td(a))}else if(f===0)return"0";for(;f%10===0;)f/=10;return p+f}var Cl=function(){function e(o,d){var p,f=0,v=o.length;for(o=o.slice();v--;)p=o[v]*d+f,o[v]=p%Oi|0,f=p/Oi|0;return f&&o.unshift(f),o}function n(o,d,p,f){var v,b;if(p!=f)b=p>f?1:-1;else for(v=b=0;v<p;v++)if(o[v]!=d[v]){b=o[v]>d[v]?1:-1;break}return b}function a(o,d,p){for(var f=0;p--;)o[p]-=f,f=o[p]<d[p]?1:0,o[p]=f*Oi+o[p]-d[p];for(;!o[0]&&o.length>1;)o.shift()}return function(o,d,p,f){var v,b,E,T,w,N,P,A,k,I,F,U,V,W,B,z,Y,re,Z=o.constructor,ie=o.s==d.s?1:-1,te=o.d,de=d.d;if(!o.s)return new Z(o);if(!d.s)throw Error(vo+"Division by zero");for(b=o.e-d.e,Y=de.length,B=te.length,P=new Z(ie),A=P.d=[],E=0;de[E]==(te[E]||0);)++E;if(de[E]>(te[E]||0)&&--b,p==null?U=p=Z.precision:f?U=p+(di(o)-di(d))+1:U=p,U<0)return new Z(0);if(U=U/Tr+2|0,E=0,Y==1)for(T=0,de=de[0],U++;(E<B||T)&&U--;E++)V=T*Oi+(te[E]||0),A[E]=V/de|0,T=V%de|0;else{for(T=Oi/(de[0]+1)|0,T>1&&(de=e(de,T),te=e(te,T),Y=de.length,B=te.length),W=Y,k=te.slice(0,Y),I=k.length;I<Y;)k[I++]=0;re=de.slice(),re.unshift(0),z=de[0],de[1]>=Oi/2&&++z;do T=0,v=n(de,k,Y,I),v<0?(F=k[0],Y!=I&&(F=F*Oi+(k[1]||0)),T=F/z|0,T>1?(T>=Oi&&(T=Oi-1),w=e(de,T),N=w.length,I=k.length,v=n(w,k,N,I),v==1&&(T--,a(w,Y<N?re:de,N))):(T==0&&(v=T=1),w=de.slice()),N=w.length,N<I&&w.unshift(0),a(k,w,I),v==-1&&(I=k.length,v=n(de,k,Y,I),v<1&&(T++,a(k,Y<I?re:de,I))),I=k.length):v===0&&(T++,k=[0]),A[E++]=T,v&&k[0]?k[I++]=te[W]||0:(k=[te[W]],I=1);while((W++<B||k[0]!==void 0)&&U--)}return A[0]||A.shift(),P.e=b,ur(P,f?p+di(P)+1:p)}}();function KZ(e,n){var a,o,d,p,f,v,b=0,E=0,T=e.constructor,w=T.precision;if(di(e)>16)throw Error(aj+di(e));if(!e.s)return new T(ws);for(jr=!1,v=w,f=new T(.03125);e.abs().gte(.1);)e=e.times(f),E+=5;for(o=Math.log(uh(2,E))/Math.LN10*2+5|0,v+=o,a=d=p=new T(ws),T.precision=v;;){if(d=ur(d.times(e),v),a=a.times(++b),f=p.plus(Cl(d,a,v)),Fc(f.d).slice(0,v)===Fc(p.d).slice(0,v)){for(;E--;)p=ur(p.times(p),v);return T.precision=w,n==null?(jr=!0,ur(p,w)):p}p=f}}function di(e){for(var n=e.e*Tr,a=e.d[0];a>=10;a/=10)n++;return n}function n1(e,n,a){if(n>e.LN10.sd())throw jr=!0,a&&(e.precision=a),Error(vo+"LN10 precision limit exceeded");return ur(new e(e.LN10),n)}function Td(e){for(var n="";e--;)n+="0";return n}function Qy(e,n){var a,o,d,p,f,v,b,E,T,w=1,N=10,P=e,A=P.d,k=P.constructor,I=k.precision;if(P.s<1)throw Error(vo+(P.s?"NaN":"-Infinity"));if(P.eq(ws))return new k(0);if(n==null?(jr=!1,E=I):E=n,P.eq(10))return n==null&&(jr=!0),n1(k,E);if(E+=N,k.precision=E,a=Fc(A),o=a.charAt(0),p=di(P),Math.abs(p)<15e14){for(;o<7&&o!=1||o==1&&a.charAt(1)>3;)P=P.times(e),a=Fc(P.d),o=a.charAt(0),w++;p=di(P),o>1?(P=new k("0."+a),p++):P=new k(o+"."+a.slice(1))}else return b=n1(k,E+2,I).times(p+""),P=Qy(new k(o+"."+a.slice(1)),E-N).plus(b),k.precision=I,n==null?(jr=!0,ur(P,I)):P;for(v=f=P=Cl(P.minus(ws),P.plus(ws),E),T=ur(P.times(P),E),d=3;;){if(f=ur(f.times(T),E),b=v.plus(Cl(f,new k(d),E)),Fc(b.d).slice(0,E)===Fc(v.d).slice(0,E))return v=v.times(2),p!==0&&(v=v.plus(n1(k,E+2,I).times(p+""))),v=Cl(v,new k(w),E),k.precision=I,n==null?(jr=!0,ur(v,I)):v;v=b,d+=2}}function PK(e,n){var a,o,d;for((a=n.indexOf("."))>-1&&(n=n.replace(".","")),(o=n.search(/e/i))>0?(a<0&&(a=o),a+=+n.slice(o+1),n=n.substring(0,o)):a<0&&(a=n.length),o=0;n.charCodeAt(o)===48;)++o;for(d=n.length;n.charCodeAt(d-1)===48;)--d;if(n=n.slice(o,d),n){if(d-=o,a=a-o-1,e.e=tg(a/Tr),e.d=[],o=(a+1)%Tr,a<0&&(o+=Tr),o<d){for(o&&e.d.push(+n.slice(0,o)),d-=Tr;o<d;)e.d.push(+n.slice(o,o+=Tr));n=n.slice(o),o=Tr-n.length}else o-=d;for(;o--;)n+="0";if(e.d.push(+n),jr&&(e.e>zS||e.e<-zS))throw Error(aj+a)}else e.s=0,e.e=0,e.d=[0];return e}function ur(e,n,a){var o,d,p,f,v,b,E,T,w=e.d;for(f=1,p=w[0];p>=10;p/=10)f++;if(o=n-f,o<0)o+=Tr,d=n,E=w[T=0];else{if(T=Math.ceil((o+1)/Tr),p=w.length,T>=p)return e;for(E=p=w[T],f=1;p>=10;p/=10)f++;o%=Tr,d=o-Tr+f}if(a!==void 0&&(p=uh(10,f-d-1),v=E/p%10|0,b=n<0||w[T+1]!==void 0||E%p,b=a<4?(v||b)&&(a==0||a==(e.s<0?3:2)):v>5||v==5&&(a==4||b||a==6&&(o>0?d>0?E/uh(10,f-d):0:w[T-1])%10&1||a==(e.s<0?8:7))),n<1||!w[0])return b?(p=di(e),w.length=1,n=n-p-1,w[0]=uh(10,(Tr-n%Tr)%Tr),e.e=tg(-n/Tr)||0):(w.length=1,w[0]=e.e=e.s=0),e;if(o==0?(w.length=T,p=1,T--):(w.length=T+1,p=uh(10,Tr-o),w[T]=d>0?(E/uh(10,f-d)%uh(10,d)|0)*p:0),b)for(;;)if(T==0){(w[0]+=p)==Oi&&(w[0]=1,++e.e);break}else{if(w[T]+=p,w[T]!=Oi)break;w[T--]=0,p=1}for(o=w.length;w[--o]===0;)w.pop();if(jr&&(e.e>zS||e.e<-zS))throw Error(aj+di(e));return e}function YZ(e,n){var a,o,d,p,f,v,b,E,T,w,N=e.constructor,P=N.precision;if(!e.s||!n.s)return n.s?n.s=-n.s:n=new N(e),jr?ur(n,P):n;if(b=e.d,w=n.d,o=n.e,E=e.e,b=b.slice(),f=E-o,f){for(T=f<0,T?(a=b,f=-f,v=w.length):(a=w,o=E,v=b.length),d=Math.max(Math.ceil(P/Tr),v)+2,f>d&&(f=d,a.length=1),a.reverse(),d=f;d--;)a.push(0);a.reverse()}else{for(d=b.length,v=w.length,T=d<v,T&&(v=d),d=0;d<v;d++)if(b[d]!=w[d]){T=b[d]<w[d];break}f=0}for(T&&(a=b,b=w,w=a,n.s=-n.s),v=b.length,d=w.length-v;d>0;--d)b[v++]=0;for(d=w.length;d>f;){if(b[--d]<w[d]){for(p=d;p&&b[--p]===0;)b[p]=Oi-1;--b[p],b[d]+=Oi}b[d]-=w[d]}for(;b[--v]===0;)b.pop();for(;b[0]===0;b.shift())--o;return b[0]?(n.d=b,n.e=o,jr?ur(n,P):n):new N(0)}function Fh(e,n,a){var o,d=di(e),p=Fc(e.d),f=p.length;return n?(a&&(o=a-f)>0?p=p.charAt(0)+"."+p.slice(1)+Td(o):f>1&&(p=p.charAt(0)+"."+p.slice(1)),p=p+(d<0?"e":"e+")+d):d<0?(p="0."+Td(-d-1)+p,a&&(o=a-f)>0&&(p+=Td(o))):d>=f?(p+=Td(d+1-f),a&&(o=a-d-1)>0&&(p=p+"."+Td(o))):((o=d+1)<f&&(p=p.slice(0,o)+"."+p.slice(o)),a&&(o=a-f)>0&&(d+1===f&&(p+="."),p+=Td(o))),e.s<0?"-"+p:p}function DK(e,n){if(e.length>n)return e.length=n,!0}function qZ(e){var n,a,o;function d(p){var f=this;if(!(f instanceof d))return new d(p);if(f.constructor=d,p instanceof d){f.s=p.s,f.e=p.e,f.d=(p=p.d)?p.slice():p;return}if(typeof p=="number"){if(p*0!==0)throw Error(Ah+p);if(p>0)f.s=1;else if(p<0)p=-p,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(p===~~p&&p<1e7){f.e=0,f.d=[p];return}return PK(f,p.toString())}else if(typeof p!="string")throw Error(Ah+p);if(p.charCodeAt(0)===45?(p=p.slice(1),f.s=-1):f.s=1,z3e.test(p))PK(f,p);else throw Error(Ah+p)}if(d.prototype=Nt,d.ROUND_UP=0,d.ROUND_DOWN=1,d.ROUND_CEIL=2,d.ROUND_FLOOR=3,d.ROUND_HALF_UP=4,d.ROUND_HALF_DOWN=5,d.ROUND_HALF_EVEN=6,d.ROUND_HALF_CEIL=7,d.ROUND_HALF_FLOOR=8,d.clone=qZ,d.config=d.set=K3e,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<o.length;)e.hasOwnProperty(a=o[n++])||(e[a]=this[a]);return d.config(e),d}function K3e(e){if(!e||typeof e!="object")throw Error(vo+"Object expected");var n,a,o,d=["precision",1,eg,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<d.length;n+=3)if((o=e[a=d[n]])!==void 0)if(tg(o)===o&&o>=d[n+1]&&o<=d[n+2])this[a]=o;else throw Error(Ah+a+": "+o);if((o=e[a="LN10"])!==void 0)if(o==Math.LN10)this[a]=new this(o);else throw Error(Ah+a+": "+o);return this}var sj=qZ(H3e);ws=new sj(1);const rr=sj;function Y3e(e){return Q3e(e)||J3e(e)||X3e(e)||q3e()}function q3e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X3e(e,n){if(e){if(typeof e=="string")return aD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aD(e,n)}}function J3e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Q3e(e){if(Array.isArray(e))return aD(e)}function aD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var Z3e=function(n){return n},XZ={},JZ=function(n){return n===XZ},kK=function(n){return function a(){return arguments.length===0||arguments.length===1&&JZ(arguments.length<=0?void 0:arguments[0])?a:n.apply(void 0,arguments)}},eFe=function e(n,a){return n===1?a:kK(function(){for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];var f=d.filter(function(v){return v!==XZ}).length;return f>=n?a.apply(void 0,d):e(n-f,kK(function(){for(var v=arguments.length,b=new Array(v),E=0;E<v;E++)b[E]=arguments[E];var T=d.map(function(w){return JZ(w)?b.shift():w});return a.apply(void 0,Y3e(T).concat(b))}))})},RT=function(n){return eFe(n.length,n)},sD=function(n,a){for(var o=[],d=n;d<a;++d)o[d-n]=d;return o},tFe=RT(function(e,n){return Array.isArray(n)?n.map(e):Object.keys(n).map(function(a){return n[a]}).map(e)}),nFe=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];if(!a.length)return Z3e;var d=a.reverse(),p=d[0],f=d.slice(1);return function(){return f.reduce(function(v,b){return b(v)},p.apply(void 0,arguments))}},oD=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},QZ=function(n){var a=null,o=null;return function(){for(var d=arguments.length,p=new Array(d),f=0;f<d;f++)p[f]=arguments[f];return a&&p.every(function(v,b){return v===a[b]})||(a=p,o=n.apply(void 0,p)),o}};function rFe(e){var n;return e===0?n=1:n=Math.floor(new rr(e).abs().log(10).toNumber())+1,n}function iFe(e,n,a){for(var o=new rr(e),d=0,p=[];o.lt(n)&&d<1e5;)p.push(o.toNumber()),o=o.add(a),d++;return p}var aFe=RT(function(e,n,a){var o=+e,d=+n;return o+a*(d-o)}),sFe=RT(function(e,n,a){var o=n-+e;return o=o||1/0,(a-e)/o}),oFe=RT(function(e,n,a){var o=n-+e;return o=o||1/0,Math.max(0,Math.min(1,(a-e)/o))});const AT={rangeStep:iFe,getDigitCount:rFe,interpolateNumber:aFe,uninterpolateNumber:sFe,uninterpolateTruncation:oFe};function cD(e){return dFe(e)||lFe(e)||ZZ(e)||cFe()}function cFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lFe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function dFe(e){if(Array.isArray(e))return lD(e)}function Zy(e,n){return pFe(e)||hFe(e,n)||ZZ(e,n)||uFe()}function uFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZZ(e,n){if(e){if(typeof e=="string")return lD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lD(e,n)}}function lD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function hFe(e,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var a=[],o=!0,d=!1,p=void 0;try{for(var f=e[Symbol.iterator](),v;!(o=(v=f.next()).done)&&(a.push(v.value),!(n&&a.length===n));o=!0);}catch(b){d=!0,p=b}finally{try{!o&&f.return!=null&&f.return()}finally{if(d)throw p}}return a}}function pFe(e){if(Array.isArray(e))return e}function eee(e){var n=Zy(e,2),a=n[0],o=n[1],d=a,p=o;return a>o&&(d=o,p=a),[d,p]}function tee(e,n,a){if(e.lte(0))return new rr(0);var o=AT.getDigitCount(e.toNumber()),d=new rr(10).pow(o),p=e.div(d),f=o!==1?.05:.1,v=new rr(Math.ceil(p.div(f).toNumber())).add(a).mul(f),b=v.mul(d);return n?b:new rr(Math.ceil(b))}function mFe(e,n,a){var o=1,d=new rr(e);if(!d.isint()&&a){var p=Math.abs(e);p<1?(o=new rr(10).pow(AT.getDigitCount(e)-1),d=new rr(Math.floor(d.div(o).toNumber())).mul(o)):p>1&&(d=new rr(Math.floor(e)))}else e===0?d=new rr(Math.floor((n-1)/2)):a||(d=new rr(Math.floor(e)));var f=Math.floor((n-1)/2),v=nFe(tFe(function(b){return d.add(new rr(b-f).mul(o)).toNumber()}),sD);return v(0,n)}function nee(e,n,a,o){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-e)/(a-1)))return{step:new rr(0),tickMin:new rr(0),tickMax:new rr(0)};var p=tee(new rr(n).sub(e).div(a-1),o,d),f;e<=0&&n>=0?f=new rr(0):(f=new rr(e).add(n).div(2),f=f.sub(new rr(f).mod(p)));var v=Math.ceil(f.sub(e).div(p).toNumber()),b=Math.ceil(new rr(n).sub(f).div(p).toNumber()),E=v+b+1;return E>a?nee(e,n,a,o,d+1):(E<a&&(b=n>0?b+(a-E):b,v=n>0?v:v+(a-E)),{step:p,tickMin:f.sub(new rr(v).mul(p)),tickMax:f.add(new rr(b).mul(p))})}function fFe(e){var n=Zy(e,2),a=n[0],o=n[1],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(d,2),v=eee([a,o]),b=Zy(v,2),E=b[0],T=b[1];if(E===-1/0||T===1/0){var w=T===1/0?[E].concat(cD(sD(0,d-1).map(function(){return 1/0}))):[].concat(cD(sD(0,d-1).map(function(){return-1/0})),[T]);return a>o?oD(w):w}if(E===T)return mFe(E,d,p);var N=nee(E,T,f,p),P=N.step,A=N.tickMin,k=N.tickMax,I=AT.rangeStep(A,k.add(new rr(.1).mul(P)),P);return a>o?oD(I):I}function gFe(e,n){var a=Zy(e,2),o=a[0],d=a[1],p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=eee([o,d]),v=Zy(f,2),b=v[0],E=v[1];if(b===-1/0||E===1/0)return[o,d];if(b===E)return[b];var T=Math.max(n,2),w=tee(new rr(E).sub(b).div(T-1),p,0),N=[].concat(cD(AT.rangeStep(new rr(b),new rr(E).sub(new rr(.99).mul(w)),w)),[E]);return o>d?oD(N):N}var vFe=QZ(fFe),yFe=QZ(gFe),_Fe="Invariant failed";function Vh(e,n){throw new Error(_Fe)}var bFe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function vf(e){"@babel/helpers - typeof";return vf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vf(e)}function KS(){return KS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},KS.apply(this,arguments)}function EFe(e,n){return TFe(e)||wFe(e,n)||SFe(e,n)||xFe()}function xFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SFe(e,n){if(e){if(typeof e=="string")return jK(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jK(e,n)}}function jK(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function wFe(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function TFe(e){if(Array.isArray(e))return e}function CFe(e,n){if(e==null)return{};var a=NFe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function NFe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function RFe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function AFe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,aee(o.key),o)}}function IFe(e,n,a){return n&&AFe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function OFe(e,n,a){return n=YS(n),PFe(e,ree()?Reflect.construct(n,a||[],YS(e).constructor):n.apply(e,a))}function PFe(e,n){if(n&&(vf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DFe(e)}function DFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ree(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ree=function(){return!!e})()}function YS(e){return YS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},YS(e)}function kFe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&dD(e,n)}function dD(e,n){return dD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},dD(e,n)}function iee(e,n,a){return n=aee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function aee(e){var n=jFe(e,"string");return vf(n)=="symbol"?n:n+""}function jFe(e,n){if(vf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(vf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var B0=function(e){function n(){return RFe(this,n),OFe(this,n,arguments)}return kFe(n,e),IFe(n,[{key:"render",value:function(){var o=this.props,d=o.offset,p=o.layout,f=o.width,v=o.dataKey,b=o.data,E=o.dataPointFormatter,T=o.xAxis,w=o.yAxis,N=CFe(o,bFe),P=yn(N,!1);this.props.direction==="x"&&T.type!=="number"&&Vh();var A=b.map(function(k){var I=E(k,v),F=I.x,U=I.y,V=I.value,W=I.errorVal;if(!W)return null;var B=[],z,Y;if(Array.isArray(W)){var re=EFe(W,2);z=re[0],Y=re[1]}else z=Y=W;if(p==="vertical"){var Z=T.scale,ie=U+d,te=ie+f,de=ie-f,xe=Z(V-z),me=Z(V+Y);B.push({x1:me,y1:te,x2:me,y2:de}),B.push({x1:xe,y1:ie,x2:me,y2:ie}),B.push({x1:xe,y1:te,x2:xe,y2:de})}else if(p==="horizontal"){var Ce=w.scale,ue=F+d,be=ue-f,se=ue+f,pe=Ce(V-z),De=Ce(V+Y);B.push({x1:be,y1:De,x2:se,y2:De}),B.push({x1:ue,y1:pe,x2:ue,y2:De}),B.push({x1:be,y1:pe,x2:se,y2:pe})}return fe.createElement(mr,KS({className:"recharts-errorBar",key:"bar-".concat(B.map(function(Se){return"".concat(Se.x1,"-").concat(Se.x2,"-").concat(Se.y1,"-").concat(Se.y2)}))},P),B.map(function(Se){return fe.createElement("line",KS({},Se,{key:"line-".concat(Se.x1,"-").concat(Se.x2,"-").concat(Se.y1,"-").concat(Se.y2)}))}))});return fe.createElement(mr,{className:"recharts-errorBars"},A)}}])}(fe.Component);iee(B0,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});iee(B0,"displayName","ErrorBar");function e0(e){"@babel/helpers - typeof";return e0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e0(e)}function LK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function sh(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?LK(Object(a),!0).forEach(function(o){LFe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):LK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function LFe(e,n,a){return n=MFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function MFe(e){var n=UFe(e,"string");return e0(n)=="symbol"?n:n+""}function UFe(e,n){if(e0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(e0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var see=function(n){var a=n.children,o=n.formattedGraphicalItems,d=n.legendWidth,p=n.legendContent,f=Es(a,Km);if(!f)return null;var v=Km.defaultProps,b=v!==void 0?sh(sh({},v),f.props):{},E;return f.props&&f.props.payload?E=f.props&&f.props.payload:p==="children"?E=(o||[]).reduce(function(T,w){var N=w.item,P=w.props,A=P.sectors||P.data||[];return T.concat(A.map(function(k){return{type:f.props.iconType||N.props.legendType,value:k.name,color:k.fill,payload:k}}))},[]):E=(o||[]).map(function(T){var w=T.item,N=w.type.defaultProps,P=N!==void 0?sh(sh({},N),w.props):{},A=P.dataKey,k=P.name,I=P.legendType,F=P.hide;return{inactive:F,dataKey:A,type:b.iconType||I||"square",color:oj(w),value:k||A,payload:P}}),sh(sh(sh({},b),Km.getWithHeight(f,d)),{},{payload:E,item:f})};function t0(e){"@babel/helpers - typeof";return t0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t0(e)}function MK(e){return GFe(e)||BFe(e)||VFe(e)||FFe()}function FFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VFe(e,n){if(e){if(typeof e=="string")return uD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uD(e,n)}}function BFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function GFe(e){if(Array.isArray(e))return uD(e)}function uD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function UK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function qr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?UK(Object(a),!0).forEach(function(o){qm(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):UK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function qm(e,n,a){return n=WFe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function WFe(e){var n=$Fe(e,"string");return t0(n)=="symbol"?n:n+""}function $Fe(e,n){if(t0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(t0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Ia(e,n,a){return bn(e)||bn(n)?a:Ei(n)?po(e,n,a):pn(n)?n(e):a}function vy(e,n,a,o){var d=B3e(e,function(v){return Ia(v,n)});if(a==="number"){var p=d.filter(function(v){return ct(v)||parseFloat(v)});return p.length?[NT(p),kd(p)]:[1/0,-1/0]}var f=o?d.filter(function(v){return!bn(v)}):d;return f.map(function(v){return Ei(v)||v instanceof Date?v:""})}var HFe=function(n){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],d=arguments.length>2?arguments[2]:void 0,p=arguments.length>3?arguments[3]:void 0,f=-1,v=(a=o==null?void 0:o.length)!==null&&a!==void 0?a:0;if(v<=1)return 0;if(p&&p.axisType==="angleAxis"&&Math.abs(Math.abs(p.range[1]-p.range[0])-360)<=1e-6)for(var b=p.range,E=0;E<v;E++){var T=E>0?d[E-1].coordinate:d[v-1].coordinate,w=d[E].coordinate,N=E>=v-1?d[0].coordinate:d[E+1].coordinate,P=void 0;if(Zo(w-T)!==Zo(N-w)){var A=[];if(Zo(N-w)===Zo(b[1]-b[0])){P=N;var k=w+b[1]-b[0];A[0]=Math.min(k,(k+T)/2),A[1]=Math.max(k,(k+T)/2)}else{P=T;var I=N+b[1]-b[0];A[0]=Math.min(w,(I+w)/2),A[1]=Math.max(w,(I+w)/2)}var F=[Math.min(w,(P+w)/2),Math.max(w,(P+w)/2)];if(n>F[0]&&n<=F[1]||n>=A[0]&&n<=A[1]){f=d[E].index;break}}else{var U=Math.min(T,N),V=Math.max(T,N);if(n>(U+w)/2&&n<=(V+w)/2){f=d[E].index;break}}}else for(var W=0;W<v;W++)if(W===0&&n<=(o[W].coordinate+o[W+1].coordinate)/2||W>0&&W<v-1&&n>(o[W].coordinate+o[W-1].coordinate)/2&&n<=(o[W].coordinate+o[W+1].coordinate)/2||W===v-1&&n>(o[W].coordinate+o[W-1].coordinate)/2){f=o[W].index;break}return f},oj=function(n){var a,o=n,d=o.type.displayName,p=(a=n.type)!==null&&a!==void 0&&a.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,f=p.stroke,v=p.fill,b;switch(d){case"Line":b=f;break;case"Area":case"Radar":b=f&&f!=="none"?f:v;break;default:b=v;break}return b},zFe=function(n){var a=n.barSize,o=n.totalSize,d=n.stackGroups,p=d===void 0?{}:d;if(!p)return{};for(var f={},v=Object.keys(p),b=0,E=v.length;b<E;b++)for(var T=p[v[b]].stackGroups,w=Object.keys(T),N=0,P=w.length;N<P;N++){var A=T[w[N]],k=A.items,I=A.cateAxisId,F=k.filter(function(Y){return wl(Y.type).indexOf("Bar")>=0});if(F&&F.length){var U=F[0].type.defaultProps,V=U!==void 0?qr(qr({},U),F[0].props):F[0].props,W=V.barSize,B=V[I];f[B]||(f[B]=[]);var z=bn(W)?a:W;f[B].push({item:F[0],stackList:F.slice(1),barSize:bn(z)?void 0:Uh(z,o,0)})}}return f},KFe=function(n){var a=n.barGap,o=n.barCategoryGap,d=n.bandSize,p=n.sizeList,f=p===void 0?[]:p,v=n.maxBarSize,b=f.length;if(b<1)return null;var E=Uh(a,d,0,!0),T,w=[];if(f[0].barSize===+f[0].barSize){var N=!1,P=d/b,A=f.reduce(function(W,B){return W+B.barSize||0},0);A+=(b-1)*E,A>=d&&(A-=(b-1)*E,E=0),A>=d&&P>0&&(N=!0,P*=.9,A=b*P);var k=(d-A)/2>>0,I={offset:k-E,size:0};T=f.reduce(function(W,B){var z={item:B.item,position:{offset:I.offset+I.size+E,size:N?P:B.barSize}},Y=[].concat(MK(W),[z]);return I=Y[Y.length-1].position,B.stackList&&B.stackList.length&&B.stackList.forEach(function(re){Y.push({item:re,position:I})}),Y},w)}else{var F=Uh(o,d,0,!0);d-2*F-(b-1)*E<=0&&(E=0);var U=(d-2*F-(b-1)*E)/b;U>1&&(U>>=0);var V=v===+v?Math.min(U,v):U;T=f.reduce(function(W,B,z){var Y=[].concat(MK(W),[{item:B.item,position:{offset:F+(U+E)*z+(U-V)/2,size:V}}]);return B.stackList&&B.stackList.length&&B.stackList.forEach(function(re){Y.push({item:re,position:Y[Y.length-1].position})}),Y},w)}return T},YFe=function(n,a,o,d){var p=o.children,f=o.width,v=o.margin,b=f-(v.left||0)-(v.right||0),E=see({children:p,legendWidth:b});if(E){var T=d||{},w=T.width,N=T.height,P=E.align,A=E.verticalAlign,k=E.layout;if((k==="vertical"||k==="horizontal"&&A==="middle")&&P!=="center"&&ct(n[P]))return qr(qr({},n),{},qm({},P,n[P]+(w||0)));if((k==="horizontal"||k==="vertical"&&P==="center")&&A!=="middle"&&ct(n[A]))return qr(qr({},n),{},qm({},A,n[A]+(N||0)))}return n},qFe=function(n,a,o){return bn(a)?!0:n==="horizontal"?a==="yAxis":n==="vertical"||o==="x"?a==="xAxis":o==="y"?a==="yAxis":!0},oee=function(n,a,o,d,p){var f=a.props.children,v=mo(f,B0).filter(function(E){return qFe(d,p,E.props.direction)});if(v&&v.length){var b=v.map(function(E){return E.props.dataKey});return n.reduce(function(E,T){var w=Ia(T,o);if(bn(w))return E;var N=Array.isArray(w)?[NT(w),kd(w)]:[w,w],P=b.reduce(function(A,k){var I=Ia(T,k,0),F=N[0]-Math.abs(Array.isArray(I)?I[0]:I),U=N[1]+Math.abs(Array.isArray(I)?I[1]:I);return[Math.min(F,A[0]),Math.max(U,A[1])]},[1/0,-1/0]);return[Math.min(P[0],E[0]),Math.max(P[1],E[1])]},[1/0,-1/0])}return null},XFe=function(n,a,o,d,p){var f=a.map(function(v){return oee(n,v,o,p,d)}).filter(function(v){return!bn(v)});return f&&f.length?f.reduce(function(v,b){return[Math.min(v[0],b[0]),Math.max(v[1],b[1])]},[1/0,-1/0]):null},cee=function(n,a,o,d,p){var f=a.map(function(b){var E=b.props.dataKey;return o==="number"&&E&&oee(n,b,E,d)||vy(n,E,o,p)});if(o==="number")return f.reduce(function(b,E){return[Math.min(b[0],E[0]),Math.max(b[1],E[1])]},[1/0,-1/0]);var v={};return f.reduce(function(b,E){for(var T=0,w=E.length;T<w;T++)v[E[T]]||(v[E[T]]=!0,b.push(E[T]));return b},[])},lee=function(n,a){return n==="horizontal"&&a==="xAxis"||n==="vertical"&&a==="yAxis"||n==="centric"&&a==="angleAxis"||n==="radial"&&a==="radiusAxis"},dee=function(n,a,o,d){if(d)return n.map(function(b){return b.coordinate});var p,f,v=n.map(function(b){return b.coordinate===a&&(p=!0),b.coordinate===o&&(f=!0),b.coordinate});return p||v.push(a),f||v.push(o),v},xl=function(n,a,o){if(!n)return null;var d=n.scale,p=n.duplicateDomain,f=n.type,v=n.range,b=n.realScaleType==="scaleBand"?d.bandwidth()/2:2,E=(a||o)&&f==="category"&&d.bandwidth?d.bandwidth()/b:0;if(E=n.axisType==="angleAxis"&&(v==null?void 0:v.length)>=2?Zo(v[0]-v[1])*2*E:E,a&&(n.ticks||n.niceTicks)){var T=(n.ticks||n.niceTicks).map(function(w){var N=p?p.indexOf(w):w;return{coordinate:d(N)+E,value:w,offset:E}});return T.filter(function(w){return!Yf(w.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(w,N){return{coordinate:d(w)+E,value:w,index:N,offset:E}}):d.ticks&&!o?d.ticks(n.tickCount).map(function(w){return{coordinate:d(w)+E,value:w,offset:E}}):d.domain().map(function(w,N){return{coordinate:d(w)+E,value:p?p[w]:w,index:N,offset:E}})},r1=new WeakMap,gx=function(n,a){if(typeof a!="function")return n;r1.has(n)||r1.set(n,new WeakMap);var o=r1.get(n);if(o.has(a))return o.get(a);var d=function(){n.apply(void 0,arguments),a.apply(void 0,arguments)};return o.set(a,d),d},JFe=function(n,a,o){var d=n.scale,p=n.type,f=n.layout,v=n.axisType;if(d==="auto")return f==="radial"&&v==="radiusAxis"?{scale:Ky(),realScaleType:"band"}:f==="radial"&&v==="angleAxis"?{scale:GS(),realScaleType:"linear"}:p==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!o)?{scale:gy(),realScaleType:"point"}:p==="category"?{scale:Ky(),realScaleType:"band"}:{scale:GS(),realScaleType:"linear"};if(Mh(d)){var b="scale".concat(mT(d));return{scale:(OK[b]||gy)(),realScaleType:OK[b]?b:"point"}}return pn(d)?{scale:d}:{scale:gy(),realScaleType:"point"}},FK=1e-4,QFe=function(n){var a=n.domain();if(!(!a||a.length<=2)){var o=a.length,d=n.range(),p=Math.min(d[0],d[1])-FK,f=Math.max(d[0],d[1])+FK,v=n(a[0]),b=n(a[o-1]);(v<p||v>f||b<p||b>f)&&n.domain([a[0],a[o-1]])}},ZFe=function(n,a){if(!n)return null;for(var o=0,d=n.length;o<d;o++)if(n[o].item===a)return n[o].position;return null},eVe=function(n,a){if(!a||a.length!==2||!ct(a[0])||!ct(a[1]))return n;var o=Math.min(a[0],a[1]),d=Math.max(a[0],a[1]),p=[n[0],n[1]];return(!ct(n[0])||n[0]<o)&&(p[0]=o),(!ct(n[1])||n[1]>d)&&(p[1]=d),p[0]>d&&(p[0]=d),p[1]<o&&(p[1]=o),p},tVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var p=0,f=0,v=0;v<a;++v){var b=Yf(n[v][o][1])?n[v][o][0]:n[v][o][1];b>=0?(n[v][o][0]=p,n[v][o][1]=p+b,p=n[v][o][1]):(n[v][o][0]=f,n[v][o][1]=f+b,f=n[v][o][1])}},nVe=function(n){var a=n.length;if(!(a<=0))for(var o=0,d=n[0].length;o<d;++o)for(var p=0,f=0;f<a;++f){var v=Yf(n[f][o][1])?n[f][o][0]:n[f][o][1];v>=0?(n[f][o][0]=p,n[f][o][1]=p+v,p=n[f][o][1]):(n[f][o][0]=0,n[f][o][1]=0)}},rVe={sign:tVe,expand:yOe,none:cf,silhouette:_Oe,wiggle:bOe,positive:nVe},iVe=function(n,a,o){var d=a.map(function(v){return v.props.dataKey}),p=rVe[o],f=vOe().keys(d).value(function(v,b){return+Ia(v,b,0)}).order(LP).offset(p);return f(n)},aVe=function(n,a,o,d,p,f){if(!n)return null;var v=f?a.reverse():a,b={},E=v.reduce(function(w,N){var P,A=(P=N.type)!==null&&P!==void 0&&P.defaultProps?qr(qr({},N.type.defaultProps),N.props):N.props,k=A.stackId,I=A.hide;if(I)return w;var F=A[o],U=w[F]||{hasStack:!1,stackGroups:{}};if(Ei(k)){var V=U.stackGroups[k]||{numericAxisId:o,cateAxisId:d,items:[]};V.items.push(N),U.hasStack=!0,U.stackGroups[k]=V}else U.stackGroups[qf("_stackId_")]={numericAxisId:o,cateAxisId:d,items:[N]};return qr(qr({},w),{},qm({},F,U))},b),T={};return Object.keys(E).reduce(function(w,N){var P=E[N];if(P.hasStack){var A={};P.stackGroups=Object.keys(P.stackGroups).reduce(function(k,I){var F=P.stackGroups[I];return qr(qr({},k),{},qm({},I,{numericAxisId:o,cateAxisId:d,items:F.items,stackedData:iVe(n,F.items,p)}))},A)}return qr(qr({},w),{},qm({},N,P))},T)},sVe=function(n,a){var o=a.realScaleType,d=a.type,p=a.tickCount,f=a.originalDomain,v=a.allowDecimals,b=o||a.scale;if(b!=="auto"&&b!=="linear")return null;if(p&&d==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var E=n.domain();if(!E.length)return null;var T=vFe(E,p,v);return n.domain([NT(T),kd(T)]),{niceTicks:T}}if(p&&d==="number"){var w=n.domain(),N=yFe(w,p,v);return{niceTicks:N}}return null};function qS(e){var n=e.axis,a=e.ticks,o=e.bandSize,d=e.entry,p=e.index,f=e.dataKey;if(n.type==="category"){if(!n.allowDuplicatedCategory&&n.dataKey&&!bn(d[n.dataKey])){var v=yS(a,"value",d[n.dataKey]);if(v)return v.coordinate+o/2}return a[p]?a[p].coordinate+o/2:null}var b=Ia(d,bn(f)?n.dataKey:f);return bn(b)?null:n.scale(b)}var VK=function(n){var a=n.axis,o=n.ticks,d=n.offset,p=n.bandSize,f=n.entry,v=n.index;if(a.type==="category")return o[v]?o[v].coordinate+d:null;var b=Ia(f,a.dataKey,a.domain[v]);return bn(b)?null:a.scale(b)-p/2+d},oVe=function(n){var a=n.numericAxis,o=a.scale.domain();if(a.type==="number"){var d=Math.min(o[0],o[1]),p=Math.max(o[0],o[1]);return d<=0&&p>=0?0:p<0?p:d}return o[0]},cVe=function(n,a){var o,d=(o=n.type)!==null&&o!==void 0&&o.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,p=d.stackId;if(Ei(p)){var f=a[p];if(f){var v=f.items.indexOf(n);return v>=0?f.stackedData[v]:null}}return null},lVe=function(n){return n.reduce(function(a,o){return[NT(o.concat([a[0]]).filter(ct)),kd(o.concat([a[1]]).filter(ct))]},[1/0,-1/0])},uee=function(n,a,o){return Object.keys(n).reduce(function(d,p){var f=n[p],v=f.stackedData,b=v.reduce(function(E,T){var w=lVe(T.slice(a,o+1));return[Math.min(E[0],w[0]),Math.max(E[1],w[1])]},[1/0,-1/0]);return[Math.min(b[0],d[0]),Math.max(b[1],d[1])]},[1/0,-1/0]).map(function(d){return d===1/0||d===-1/0?0:d})},BK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,GK=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,hD=function(n,a,o){if(pn(n))return n(a,o);if(!Array.isArray(n))return a;var d=[];if(ct(n[0]))d[0]=o?n[0]:Math.min(n[0],a[0]);else if(BK.test(n[0])){var p=+BK.exec(n[0])[1];d[0]=a[0]-p}else pn(n[0])?d[0]=n[0](a[0]):d[0]=a[0];if(ct(n[1]))d[1]=o?n[1]:Math.max(n[1],a[1]);else if(GK.test(n[1])){var f=+GK.exec(n[1])[1];d[1]=a[1]+f}else pn(n[1])?d[1]=n[1](a[1]):d[1]=a[1];return d},XS=function(n,a,o){if(n&&n.scale&&n.scale.bandwidth){var d=n.scale.bandwidth();if(!o||d>0)return d}if(n&&a&&a.length>=2){for(var p=j2(a,function(w){return w.coordinate}),f=1/0,v=1,b=p.length;v<b;v++){var E=p[v],T=p[v-1];f=Math.min((E.coordinate||0)-(T.coordinate||0),f)}return f===1/0?0:f}return o?void 0:0},WK=function(n,a,o){return!n||!n.length||gf(n,po(o,"type.defaultProps.domain"))?a:n},hee=function(n,a){var o=n.type.defaultProps?qr(qr({},n.type.defaultProps),n.props):n.props,d=o.dataKey,p=o.name,f=o.unit,v=o.formatter,b=o.tooltipType,E=o.chartType,T=o.hide;return qr(qr({},yn(n,!1)),{},{dataKey:d,unit:f,formatter:v,name:p||d,color:oj(n),value:Ia(a,d),type:b,payload:a,chartType:E,hide:T})};function n0(e){"@babel/helpers - typeof";return n0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n0(e)}function $K(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function HK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$K(Object(a),!0).forEach(function(o){dVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$K(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function dVe(e,n,a){return n=uVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function uVe(e){var n=hVe(e,"string");return n0(n)=="symbol"?n:n+""}function hVe(e,n){if(n0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(n0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var JS=Math.PI/180,pVe=function(n){return n*180/Math.PI},qi=function(n,a,o,d){return{x:n+Math.cos(-JS*d)*o,y:a+Math.sin(-JS*d)*o}},mVe=function(n,a){var o=n.x,d=n.y,p=a.x,f=a.y;return Math.sqrt(Math.pow(o-p,2)+Math.pow(d-f,2))},fVe=function(n,a){var o=n.x,d=n.y,p=a.cx,f=a.cy,v=mVe({x:o,y:d},{x:p,y:f});if(v<=0)return{radius:v};var b=(o-p)/v,E=Math.acos(b);return d>f&&(E=2*Math.PI-E),{radius:v,angle:pVe(E),angleInRadian:E}},gVe=function(n){var a=n.startAngle,o=n.endAngle,d=Math.floor(a/360),p=Math.floor(o/360),f=Math.min(d,p);return{startAngle:a-f*360,endAngle:o-f*360}},vVe=function(n,a){var o=a.startAngle,d=a.endAngle,p=Math.floor(o/360),f=Math.floor(d/360),v=Math.min(p,f);return n+v*360},zK=function(n,a){var o=n.x,d=n.y,p=fVe({x:o,y:d},a),f=p.radius,v=p.angle,b=a.innerRadius,E=a.outerRadius;if(f<b||f>E)return!1;if(f===0)return!0;var T=gVe(a),w=T.startAngle,N=T.endAngle,P=v,A;if(w<=N){for(;P>N;)P-=360;for(;P<w;)P+=360;A=P>=w&&P<=N}else{for(;P>w;)P-=360;for(;P<N;)P+=360;A=P>=N&&P<=w}return A?HK(HK({},a),{},{radius:f,angle:vVe(P,a)}):null};function r0(e){"@babel/helpers - typeof";return r0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r0(e)}var yVe=["offset"];function _Ve(e){return SVe(e)||xVe(e)||EVe(e)||bVe()}function bVe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EVe(e,n){if(e){if(typeof e=="string")return pD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pD(e,n)}}function xVe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function SVe(e){if(Array.isArray(e))return pD(e)}function pD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function wVe(e,n){if(e==null)return{};var a=TVe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function TVe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function KK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function gi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?KK(Object(a),!0).forEach(function(o){CVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):KK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function CVe(e,n,a){return n=NVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function NVe(e){var n=RVe(e,"string");return r0(n)=="symbol"?n:n+""}function RVe(e,n){if(r0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(r0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function i0(){return i0=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},i0.apply(this,arguments)}var AVe=function(n){var a=n.value,o=n.formatter,d=bn(n.children)?a:n.children;return pn(o)?o(d):d},IVe=function(n,a){var o=Zo(a-n),d=Math.min(Math.abs(a-n),360);return o*d},OVe=function(n,a,o){var d=n.position,p=n.viewBox,f=n.offset,v=n.className,b=p,E=b.cx,T=b.cy,w=b.innerRadius,N=b.outerRadius,P=b.startAngle,A=b.endAngle,k=b.clockWise,I=(w+N)/2,F=IVe(P,A),U=F>=0?1:-1,V,W;d==="insideStart"?(V=P+U*f,W=k):d==="insideEnd"?(V=A-U*f,W=!k):d==="end"&&(V=A+U*f,W=k),W=F<=0?W:!W;var B=qi(E,T,I,V),z=qi(E,T,I,V+(W?1:-1)*359),Y="M".concat(B.x,",").concat(B.y,`
    A`).concat(I,",").concat(I,",0,1,").concat(W?0:1,`,
    `).concat(z.x,",").concat(z.y),re=bn(n.id)?qf("recharts-radial-line-"):n.id;return fe.createElement("text",i0({},o,{dominantBaseline:"central",className:On("recharts-radial-bar-label",v)}),fe.createElement("defs",null,fe.createElement("path",{id:re,d:Y})),fe.createElement("textPath",{xlinkHref:"#".concat(re)},a))},PVe=function(n){var a=n.viewBox,o=n.offset,d=n.position,p=a,f=p.cx,v=p.cy,b=p.innerRadius,E=p.outerRadius,T=p.startAngle,w=p.endAngle,N=(T+w)/2;if(d==="outside"){var P=qi(f,v,E+o,N),A=P.x,k=P.y;return{x:A,y:k,textAnchor:A>=f?"start":"end",verticalAnchor:"middle"}}if(d==="center")return{x:f,y:v,textAnchor:"middle",verticalAnchor:"middle"};if(d==="centerTop")return{x:f,y:v,textAnchor:"middle",verticalAnchor:"start"};if(d==="centerBottom")return{x:f,y:v,textAnchor:"middle",verticalAnchor:"end"};var I=(b+E)/2,F=qi(f,v,I,N),U=F.x,V=F.y;return{x:U,y:V,textAnchor:"middle",verticalAnchor:"middle"}},DVe=function(n){var a=n.viewBox,o=n.parentViewBox,d=n.offset,p=n.position,f=a,v=f.x,b=f.y,E=f.width,T=f.height,w=T>=0?1:-1,N=w*d,P=w>0?"end":"start",A=w>0?"start":"end",k=E>=0?1:-1,I=k*d,F=k>0?"end":"start",U=k>0?"start":"end";if(p==="top"){var V={x:v+E/2,y:b-w*d,textAnchor:"middle",verticalAnchor:P};return gi(gi({},V),o?{height:Math.max(b-o.y,0),width:E}:{})}if(p==="bottom"){var W={x:v+E/2,y:b+T+N,textAnchor:"middle",verticalAnchor:A};return gi(gi({},W),o?{height:Math.max(o.y+o.height-(b+T),0),width:E}:{})}if(p==="left"){var B={x:v-I,y:b+T/2,textAnchor:F,verticalAnchor:"middle"};return gi(gi({},B),o?{width:Math.max(B.x-o.x,0),height:T}:{})}if(p==="right"){var z={x:v+E+I,y:b+T/2,textAnchor:U,verticalAnchor:"middle"};return gi(gi({},z),o?{width:Math.max(o.x+o.width-z.x,0),height:T}:{})}var Y=o?{width:E,height:T}:{};return p==="insideLeft"?gi({x:v+I,y:b+T/2,textAnchor:U,verticalAnchor:"middle"},Y):p==="insideRight"?gi({x:v+E-I,y:b+T/2,textAnchor:F,verticalAnchor:"middle"},Y):p==="insideTop"?gi({x:v+E/2,y:b+N,textAnchor:"middle",verticalAnchor:A},Y):p==="insideBottom"?gi({x:v+E/2,y:b+T-N,textAnchor:"middle",verticalAnchor:P},Y):p==="insideTopLeft"?gi({x:v+I,y:b+N,textAnchor:U,verticalAnchor:A},Y):p==="insideTopRight"?gi({x:v+E-I,y:b+N,textAnchor:F,verticalAnchor:A},Y):p==="insideBottomLeft"?gi({x:v+I,y:b+T-N,textAnchor:U,verticalAnchor:P},Y):p==="insideBottomRight"?gi({x:v+E-I,y:b+T-N,textAnchor:F,verticalAnchor:P},Y):$f(p)&&(ct(p.x)||_h(p.x))&&(ct(p.y)||_h(p.y))?gi({x:v+Uh(p.x,E),y:b+Uh(p.y,T),textAnchor:"end",verticalAnchor:"end"},Y):gi({x:v+E/2,y:b+T/2,textAnchor:"middle",verticalAnchor:"middle"},Y)},kVe=function(n){return"cx"in n&&ct(n.cx)};function da(e){var n=e.offset,a=n===void 0?5:n,o=wVe(e,yVe),d=gi({offset:a},o),p=d.viewBox,f=d.position,v=d.value,b=d.children,E=d.content,T=d.className,w=T===void 0?"":T,N=d.textBreakAll;if(!p||bn(v)&&bn(b)&&!q.isValidElement(E)&&!pn(E))return null;if(q.isValidElement(E))return q.cloneElement(E,d);var P;if(pn(E)){if(P=q.createElement(E,d),q.isValidElement(P))return P}else P=AVe(d);var A=kVe(p),k=yn(d,!0);if(A&&(f==="insideStart"||f==="insideEnd"||f==="end"))return OVe(d,P,k);var I=A?PVe(d):DVe(d);return fe.createElement(jS,i0({className:On("recharts-label",w)},k,I,{breakAll:N}),P)}da.displayName="Label";var pee=function(n){var a=n.cx,o=n.cy,d=n.angle,p=n.startAngle,f=n.endAngle,v=n.r,b=n.radius,E=n.innerRadius,T=n.outerRadius,w=n.x,N=n.y,P=n.top,A=n.left,k=n.width,I=n.height,F=n.clockWise,U=n.labelViewBox;if(U)return U;if(ct(k)&&ct(I)){if(ct(w)&&ct(N))return{x:w,y:N,width:k,height:I};if(ct(P)&&ct(A))return{x:P,y:A,width:k,height:I}}return ct(w)&&ct(N)?{x:w,y:N,width:0,height:0}:ct(a)&&ct(o)?{cx:a,cy:o,startAngle:p||d||0,endAngle:f||d||0,innerRadius:E||0,outerRadius:T||b||v||0,clockWise:F}:n.viewBox?n.viewBox:{}},jVe=function(n,a){return n?n===!0?fe.createElement(da,{key:"label-implicit",viewBox:a}):Ei(n)?fe.createElement(da,{key:"label-implicit",viewBox:a,value:n}):q.isValidElement(n)?n.type===da?q.cloneElement(n,{key:"label-implicit",viewBox:a}):fe.createElement(da,{key:"label-implicit",content:n,viewBox:a}):pn(n)?fe.createElement(da,{key:"label-implicit",content:n,viewBox:a}):$f(n)?fe.createElement(da,i0({viewBox:a},n,{key:"label-implicit"})):null:null},LVe=function(n,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&o&&!n.label)return null;var d=n.children,p=pee(n),f=mo(d,da).map(function(b,E){return q.cloneElement(b,{viewBox:a||p,key:"label-".concat(E)})});if(!o)return f;var v=jVe(n.label,a||p);return[v].concat(_Ve(f))};da.parseViewBox=pee;da.renderCallByParent=LVe;function MVe(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}var UVe=MVe;const FVe=ar(UVe);function a0(e){"@babel/helpers - typeof";return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a0(e)}var VVe=["valueAccessor"],BVe=["data","dataKey","clockWise","id","textBreakAll"];function GVe(e){return zVe(e)||HVe(e)||$Ve(e)||WVe()}function WVe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Ve(e,n){if(e){if(typeof e=="string")return mD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mD(e,n)}}function HVe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zVe(e){if(Array.isArray(e))return mD(e)}function mD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function QS(){return QS=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},QS.apply(this,arguments)}function YK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function qK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?YK(Object(a),!0).forEach(function(o){KVe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):YK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function KVe(e,n,a){return n=YVe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function YVe(e){var n=qVe(e,"string");return a0(n)=="symbol"?n:n+""}function qVe(e,n){if(a0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(a0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function XK(e,n){if(e==null)return{};var a=XVe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function XVe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var JVe=function(n){return Array.isArray(n.value)?FVe(n.value):n.value};function Nl(e){var n=e.valueAccessor,a=n===void 0?JVe:n,o=XK(e,VVe),d=o.data,p=o.dataKey,f=o.clockWise,v=o.id,b=o.textBreakAll,E=XK(o,BVe);return!d||!d.length?null:fe.createElement(mr,{className:"recharts-label-list"},d.map(function(T,w){var N=bn(p)?a(T,w):Ia(T&&T.payload,p),P=bn(v)?{}:{id:"".concat(v,"-").concat(w)};return fe.createElement(da,QS({},yn(T,!0),E,P,{parentViewBox:T.parentViewBox,value:N,textBreakAll:b,viewBox:da.parseViewBox(bn(f)?T:qK(qK({},T),{},{clockWise:f})),key:"label-".concat(w),index:w}))}))}Nl.displayName="LabelList";function QVe(e,n){return e?e===!0?fe.createElement(Nl,{key:"labelList-implicit",data:n}):fe.isValidElement(e)||pn(e)?fe.createElement(Nl,{key:"labelList-implicit",data:n,content:e}):$f(e)?fe.createElement(Nl,QS({data:n},e,{key:"labelList-implicit"})):null:null}function ZVe(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&a&&!e.label)return null;var o=e.children,d=mo(o,Nl).map(function(f,v){return q.cloneElement(f,{data:n,key:"labelList-".concat(v)})});if(!a)return d;var p=QVe(e.label,n);return[p].concat(GVe(d))}Nl.renderCallByParent=ZVe;function s0(e){"@babel/helpers - typeof";return s0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s0(e)}function fD(){return fD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},fD.apply(this,arguments)}function JK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function QK(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?JK(Object(a),!0).forEach(function(o){eBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):JK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function eBe(e,n,a){return n=tBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function tBe(e){var n=nBe(e,"string");return s0(n)=="symbol"?n:n+""}function nBe(e,n){if(s0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(s0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var rBe=function(n,a){var o=Zo(a-n),d=Math.min(Math.abs(a-n),359.999);return o*d},vx=function(n){var a=n.cx,o=n.cy,d=n.radius,p=n.angle,f=n.sign,v=n.isExternal,b=n.cornerRadius,E=n.cornerIsExternal,T=b*(v?1:-1)+d,w=Math.asin(b/T)/JS,N=E?p:p+f*w,P=qi(a,o,T,N),A=qi(a,o,d,N),k=E?p-f*w:p,I=qi(a,o,T*Math.cos(w*JS),k);return{center:P,circleTangency:A,lineTangency:I,theta:w}},mee=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,p=n.outerRadius,f=n.startAngle,v=n.endAngle,b=rBe(f,v),E=f+b,T=qi(a,o,p,f),w=qi(a,o,p,E),N="M ".concat(T.x,",").concat(T.y,`
    A `).concat(p,",").concat(p,`,0,
    `).concat(+(Math.abs(b)>180),",").concat(+(f>E),`,
    `).concat(w.x,",").concat(w.y,`
  `);if(d>0){var P=qi(a,o,d,f),A=qi(a,o,d,E);N+="L ".concat(A.x,",").concat(A.y,`
            A `).concat(d,",").concat(d,`,0,
            `).concat(+(Math.abs(b)>180),",").concat(+(f<=E),`,
            `).concat(P.x,",").concat(P.y," Z")}else N+="L ".concat(a,",").concat(o," Z");return N},iBe=function(n){var a=n.cx,o=n.cy,d=n.innerRadius,p=n.outerRadius,f=n.cornerRadius,v=n.forceCornerRadius,b=n.cornerIsExternal,E=n.startAngle,T=n.endAngle,w=Zo(T-E),N=vx({cx:a,cy:o,radius:p,angle:E,sign:w,cornerRadius:f,cornerIsExternal:b}),P=N.circleTangency,A=N.lineTangency,k=N.theta,I=vx({cx:a,cy:o,radius:p,angle:T,sign:-w,cornerRadius:f,cornerIsExternal:b}),F=I.circleTangency,U=I.lineTangency,V=I.theta,W=b?Math.abs(E-T):Math.abs(E-T)-k-V;if(W<0)return v?"M ".concat(A.x,",").concat(A.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):mee({cx:a,cy:o,innerRadius:d,outerRadius:p,startAngle:E,endAngle:T});var B="M ".concat(A.x,",").concat(A.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(w<0),",").concat(P.x,",").concat(P.y,`
    A`).concat(p,",").concat(p,",0,").concat(+(W>180),",").concat(+(w<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(w<0),",").concat(U.x,",").concat(U.y,`
  `);if(d>0){var z=vx({cx:a,cy:o,radius:d,angle:E,sign:w,isExternal:!0,cornerRadius:f,cornerIsExternal:b}),Y=z.circleTangency,re=z.lineTangency,Z=z.theta,ie=vx({cx:a,cy:o,radius:d,angle:T,sign:-w,isExternal:!0,cornerRadius:f,cornerIsExternal:b}),te=ie.circleTangency,de=ie.lineTangency,xe=ie.theta,me=b?Math.abs(E-T):Math.abs(E-T)-Z-xe;if(me<0&&f===0)return"".concat(B,"L").concat(a,",").concat(o,"Z");B+="L".concat(de.x,",").concat(de.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(w<0),",").concat(te.x,",").concat(te.y,`
      A`).concat(d,",").concat(d,",0,").concat(+(me>180),",").concat(+(w>0),",").concat(Y.x,",").concat(Y.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(w<0),",").concat(re.x,",").concat(re.y,"Z")}else B+="L".concat(a,",").concat(o,"Z");return B},aBe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},fee=function(n){var a=QK(QK({},aBe),n),o=a.cx,d=a.cy,p=a.innerRadius,f=a.outerRadius,v=a.cornerRadius,b=a.forceCornerRadius,E=a.cornerIsExternal,T=a.startAngle,w=a.endAngle,N=a.className;if(f<p||T===w)return null;var P=On("recharts-sector",N),A=f-p,k=Uh(v,A,0,!0),I;return k>0&&Math.abs(T-w)<360?I=iBe({cx:o,cy:d,innerRadius:p,outerRadius:f,cornerRadius:Math.min(k,A/2),forceCornerRadius:b,cornerIsExternal:E,startAngle:T,endAngle:w}):I=mee({cx:o,cy:d,innerRadius:p,outerRadius:f,startAngle:T,endAngle:w}),fe.createElement("path",fD({},yn(a,!0),{className:P,d:I,role:"img"}))};function o0(e){"@babel/helpers - typeof";return o0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},o0(e)}function gD(){return gD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},gD.apply(this,arguments)}function ZK(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function e9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?ZK(Object(a),!0).forEach(function(o){sBe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ZK(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function sBe(e,n,a){return n=oBe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function oBe(e){var n=cBe(e,"string");return o0(n)=="symbol"?n:n+""}function cBe(e,n){if(o0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(o0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var t9={curveBasisClosed:sOe,curveBasisOpen:oOe,curveBasis:aOe,curveBumpX:HIe,curveBumpY:zIe,curveLinearClosed:cOe,curveLinear:gT,curveMonotoneX:lOe,curveMonotoneY:dOe,curveNatural:uOe,curveStep:hOe,curveStepAfter:mOe,curveStepBefore:pOe},yx=function(n){return n.x===+n.x&&n.y===+n.y},Kv=function(n){return n.x},Yv=function(n){return n.y},lBe=function(n,a){if(pn(n))return n;var o="curve".concat(mT(n));return(o==="curveMonotone"||o==="curveBump")&&a?t9["".concat(o).concat(a==="vertical"?"Y":"X")]:t9[o]||gT},dBe=function(n){var a=n.type,o=a===void 0?"linear":a,d=n.points,p=d===void 0?[]:d,f=n.baseLine,v=n.layout,b=n.connectNulls,E=b===void 0?!1:b,T=lBe(o,v),w=E?p.filter(function(k){return yx(k)}):p,N;if(Array.isArray(f)){var P=E?f.filter(function(k){return yx(k)}):f,A=w.map(function(k,I){return e9(e9({},k),{},{base:P[I]})});return v==="vertical"?N=cx().y(Yv).x1(Kv).x0(function(k){return k.base.x}):N=cx().x(Kv).y1(Yv).y0(function(k){return k.base.y}),N.defined(yx).curve(T),N(A)}return v==="vertical"&&ct(f)?N=cx().y(Yv).x1(Kv).x0(f):ct(f)?N=cx().x(Kv).y1(Yv).y0(f):N=fQ().x(Kv).y(Yv),N.defined(yx).curve(T),N(w)},Xm=function(n){var a=n.className,o=n.points,d=n.path,p=n.pathRef;if((!o||!o.length)&&!d)return null;var f=o&&o.length?dBe(n):d;return q.createElement("path",gD({},yn(n,!1),_S(n),{className:On("recharts-curve",a),d:f,ref:p}))},gee={exports:{}},uBe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",hBe=uBe,pBe=hBe;function vee(){}function yee(){}yee.resetWarningCache=vee;var mBe=function(){function e(o,d,p,f,v,b){if(b!==pBe){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}e.isRequired=e;function n(){return e}var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:yee,resetWarningCache:vee};return a.PropTypes=a,a};gee.exports=mBe();var fBe=gee.exports;const jt=ar(fBe);var gBe=Object.getOwnPropertyNames,vBe=Object.getOwnPropertySymbols,yBe=Object.prototype.hasOwnProperty;function n9(e,n){return function(o,d,p){return e(o,d,p)&&n(o,d,p)}}function _x(e){return function(a,o,d){if(!a||!o||typeof a!="object"||typeof o!="object")return e(a,o,d);var p=d.cache,f=p.get(a),v=p.get(o);if(f&&v)return f===o&&v===a;p.set(a,o),p.set(o,a);var b=e(a,o,d);return p.delete(a),p.delete(o),b}}function _Be(e){return e!=null?e[Symbol.toStringTag]:void 0}function r9(e){return gBe(e).concat(vBe(e))}var bBe=Object.hasOwn||function(e,n){return yBe.call(e,n)};function Yh(e,n){return e===n||!e&&!n&&e!==e&&n!==n}var EBe="__v",xBe="__o",SBe="_owner",i9=Object.getOwnPropertyDescriptor,a9=Object.keys;function wBe(e,n,a){var o=e.length;if(n.length!==o)return!1;for(;o-- >0;)if(!a.equals(e[o],n[o],o,o,e,n,a))return!1;return!0}function TBe(e,n){return Yh(e.getTime(),n.getTime())}function CBe(e,n){return e.name===n.name&&e.message===n.message&&e.cause===n.cause&&e.stack===n.stack}function NBe(e,n){return e===n}function s9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),p=e.entries(),f,v,b=0;(f=p.next())&&!f.done;){for(var E=n.entries(),T=!1,w=0;(v=E.next())&&!v.done;){if(d[w]){w++;continue}var N=f.value,P=v.value;if(a.equals(N[0],P[0],b,w,e,n,a)&&a.equals(N[1],P[1],N[0],P[0],e,n,a)){T=d[w]=!0;break}w++}if(!T)return!1;b++}return!0}var RBe=Yh;function ABe(e,n,a){var o=a9(e),d=o.length;if(a9(n).length!==d)return!1;for(;d-- >0;)if(!_ee(e,n,a,o[d]))return!1;return!0}function qv(e,n,a){var o=r9(e),d=o.length;if(r9(n).length!==d)return!1;for(var p,f,v;d-- >0;)if(p=o[d],!_ee(e,n,a,p)||(f=i9(e,p),v=i9(n,p),(f||v)&&(!f||!v||f.configurable!==v.configurable||f.enumerable!==v.enumerable||f.writable!==v.writable)))return!1;return!0}function IBe(e,n){return Yh(e.valueOf(),n.valueOf())}function OBe(e,n){return e.source===n.source&&e.flags===n.flags}function o9(e,n,a){var o=e.size;if(o!==n.size)return!1;if(!o)return!0;for(var d=new Array(o),p=e.values(),f,v;(f=p.next())&&!f.done;){for(var b=n.values(),E=!1,T=0;(v=b.next())&&!v.done;){if(!d[T]&&a.equals(f.value,v.value,f.value,v.value,e,n,a)){E=d[T]=!0;break}T++}if(!E)return!1}return!0}function PBe(e,n){var a=e.length;if(n.length!==a)return!1;for(;a-- >0;)if(e[a]!==n[a])return!1;return!0}function DBe(e,n){return e.hostname===n.hostname&&e.pathname===n.pathname&&e.protocol===n.protocol&&e.port===n.port&&e.hash===n.hash&&e.username===n.username&&e.password===n.password}function _ee(e,n,a,o){return(o===SBe||o===xBe||o===EBe)&&(e.$$typeof||n.$$typeof)?!0:bBe(n,o)&&a.equals(e[o],n[o],o,o,e,n,a)}var kBe="[object Arguments]",jBe="[object Boolean]",LBe="[object Date]",MBe="[object Error]",UBe="[object Map]",FBe="[object Number]",VBe="[object Object]",BBe="[object RegExp]",GBe="[object Set]",WBe="[object String]",$Be="[object URL]",HBe=Array.isArray,c9=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,l9=Object.assign,zBe=Object.prototype.toString.call.bind(Object.prototype.toString);function KBe(e){var n=e.areArraysEqual,a=e.areDatesEqual,o=e.areErrorsEqual,d=e.areFunctionsEqual,p=e.areMapsEqual,f=e.areNumbersEqual,v=e.areObjectsEqual,b=e.arePrimitiveWrappersEqual,E=e.areRegExpsEqual,T=e.areSetsEqual,w=e.areTypedArraysEqual,N=e.areUrlsEqual,P=e.unknownTagComparators;return function(k,I,F){if(k===I)return!0;if(k==null||I==null)return!1;var U=typeof k;if(U!==typeof I)return!1;if(U!=="object")return U==="number"?f(k,I,F):U==="function"?d(k,I,F):!1;var V=k.constructor;if(V!==I.constructor)return!1;if(V===Object)return v(k,I,F);if(HBe(k))return n(k,I,F);if(c9!=null&&c9(k))return w(k,I,F);if(V===Date)return a(k,I,F);if(V===RegExp)return E(k,I,F);if(V===Map)return p(k,I,F);if(V===Set)return T(k,I,F);var W=zBe(k);if(W===LBe)return a(k,I,F);if(W===BBe)return E(k,I,F);if(W===UBe)return p(k,I,F);if(W===GBe)return T(k,I,F);if(W===VBe)return typeof k.then!="function"&&typeof I.then!="function"&&v(k,I,F);if(W===$Be)return N(k,I,F);if(W===MBe)return o(k,I,F);if(W===kBe)return v(k,I,F);if(W===jBe||W===FBe||W===WBe)return b(k,I,F);if(P){var B=P[W];if(!B){var z=_Be(k);z&&(B=P[z])}if(B)return B(k,I,F)}return!1}}function YBe(e){var n=e.circular,a=e.createCustomConfig,o=e.strict,d={areArraysEqual:o?qv:wBe,areDatesEqual:TBe,areErrorsEqual:CBe,areFunctionsEqual:NBe,areMapsEqual:o?n9(s9,qv):s9,areNumbersEqual:RBe,areObjectsEqual:o?qv:ABe,arePrimitiveWrappersEqual:IBe,areRegExpsEqual:OBe,areSetsEqual:o?n9(o9,qv):o9,areTypedArraysEqual:o?qv:PBe,areUrlsEqual:DBe,unknownTagComparators:void 0};if(a&&(d=l9({},d,a(d))),n){var p=_x(d.areArraysEqual),f=_x(d.areMapsEqual),v=_x(d.areObjectsEqual),b=_x(d.areSetsEqual);d=l9({},d,{areArraysEqual:p,areMapsEqual:f,areObjectsEqual:v,areSetsEqual:b})}return d}function qBe(e){return function(n,a,o,d,p,f,v){return e(n,a,v)}}function XBe(e){var n=e.circular,a=e.comparator,o=e.createState,d=e.equals,p=e.strict;if(o)return function(b,E){var T=o(),w=T.cache,N=w===void 0?n?new WeakMap:void 0:w,P=T.meta;return a(b,E,{cache:N,equals:d,meta:P,strict:p})};if(n)return function(b,E){return a(b,E,{cache:new WeakMap,equals:d,meta:void 0,strict:p})};var f={cache:void 0,equals:d,meta:void 0,strict:p};return function(b,E){return a(b,E,f)}}var JBe=cu();cu({strict:!0});cu({circular:!0});cu({circular:!0,strict:!0});cu({createInternalComparator:function(){return Yh}});cu({strict:!0,createInternalComparator:function(){return Yh}});cu({circular:!0,createInternalComparator:function(){return Yh}});cu({circular:!0,createInternalComparator:function(){return Yh},strict:!0});function cu(e){e===void 0&&(e={});var n=e.circular,a=n===void 0?!1:n,o=e.createInternalComparator,d=e.createState,p=e.strict,f=p===void 0?!1:p,v=YBe(e),b=KBe(v),E=o?o(b):qBe(b);return XBe({circular:a,comparator:b,createState:d,equals:E,strict:f})}function QBe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function d9(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=-1,o=function d(p){a<0&&(a=p),p-a>n?(e(p),a=-1):QBe(d)};requestAnimationFrame(o)}function vD(e){"@babel/helpers - typeof";return vD=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vD(e)}function ZBe(e){return r6e(e)||n6e(e)||t6e(e)||e6e()}function e6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t6e(e,n){if(e){if(typeof e=="string")return u9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u9(e,n)}}function u9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function n6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function r6e(e){if(Array.isArray(e))return e}function i6e(){var e={},n=function(){return null},a=!1,o=function d(p){if(!a){if(Array.isArray(p)){if(!p.length)return;var f=p,v=ZBe(f),b=v[0],E=v.slice(1);if(typeof b=="number"){d9(d.bind(null,E),b);return}d(b),d9(d.bind(null,E));return}vD(p)==="object"&&(e=p,n(e)),typeof p=="function"&&p()}};return{stop:function(){a=!0},start:function(p){a=!1,o(p)},subscribe:function(p){return n=p,function(){n=function(){return null}}}}}function c0(e){"@babel/helpers - typeof";return c0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c0(e)}function h9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function p9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?h9(Object(a),!0).forEach(function(o){bee(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function bee(e,n,a){return n=a6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function a6e(e){var n=s6e(e,"string");return c0(n)==="symbol"?n:String(n)}function s6e(e,n){if(c0(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(c0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var o6e=function(n,a){return[Object.keys(n),Object.keys(a)].reduce(function(o,d){return o.filter(function(p){return d.includes(p)})})},c6e=function(n){return n},l6e=function(n){return n.replace(/([A-Z])/g,function(a){return"-".concat(a.toLowerCase())})},yy=function(n,a){return Object.keys(a).reduce(function(o,d){return p9(p9({},o),{},bee({},d,n(d,a[d])))},{})},m9=function(n,a,o){return n.map(function(d){return"".concat(l6e(d)," ").concat(a,"ms ").concat(o)}).join(",")};function d6e(e,n){return p6e(e)||h6e(e,n)||Eee(e,n)||u6e()}function u6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function p6e(e){if(Array.isArray(e))return e}function m6e(e){return v6e(e)||g6e(e)||Eee(e)||f6e()}function f6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eee(e,n){if(e){if(typeof e=="string")return yD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yD(e,n)}}function g6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function v6e(e){if(Array.isArray(e))return yD(e)}function yD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var ZS=1e-4,xee=function(n,a){return[0,3*n,3*a-6*n,3*n-3*a+1]},See=function(n,a){return n.map(function(o,d){return o*Math.pow(a,d)}).reduce(function(o,d){return o+d})},f9=function(n,a){return function(o){var d=xee(n,a);return See(d,o)}},y6e=function(n,a){return function(o){var d=xee(n,a),p=[].concat(m6e(d.map(function(f,v){return f*v}).slice(1)),[0]);return See(p,o)}},g9=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0],p=a[1],f=a[2],v=a[3];if(a.length===1)switch(a[0]){case"linear":d=0,p=0,f=1,v=1;break;case"ease":d=.25,p=.1,f=.25,v=1;break;case"ease-in":d=.42,p=0,f=1,v=1;break;case"ease-out":d=.42,p=0,f=.58,v=1;break;case"ease-in-out":d=0,p=0,f=.58,v=1;break;default:{var b=a[0].split("(");if(b[0]==="cubic-bezier"&&b[1].split(")")[0].split(",").length===4){var E=b[1].split(")")[0].split(",").map(function(I){return parseFloat(I)}),T=d6e(E,4);d=T[0],p=T[1],f=T[2],v=T[3]}}}var w=f9(d,f),N=f9(p,v),P=y6e(d,f),A=function(F){return F>1?1:F<0?0:F},k=function(F){for(var U=F>1?1:F,V=U,W=0;W<8;++W){var B=w(V)-U,z=P(V);if(Math.abs(B-U)<ZS||z<ZS)return N(V);V=A(V-B/z)}return N(V)};return k.isStepper=!1,k},_6e=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.stiff,o=a===void 0?100:a,d=n.damping,p=d===void 0?8:d,f=n.dt,v=f===void 0?17:f,b=function(T,w,N){var P=-(T-w)*o,A=N*p,k=N+(P-A)*v/1e3,I=N*v/1e3+T;return Math.abs(I-w)<ZS&&Math.abs(k)<ZS?[w,0]:[I,k]};return b.isStepper=!0,b.dt=v,b},b6e=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var d=a[0];if(typeof d=="string")switch(d){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return g9(d);case"spring":return _6e();default:if(d.split("(")[0]==="cubic-bezier")return g9(d)}return typeof d=="function"?d:null};function l0(e){"@babel/helpers - typeof";return l0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},l0(e)}function v9(e){return S6e(e)||x6e(e)||wee(e)||E6e()}function E6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function S6e(e){if(Array.isArray(e))return bD(e)}function y9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function zi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?y9(Object(a),!0).forEach(function(o){_D(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function _D(e,n,a){return n=w6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function w6e(e){var n=T6e(e,"string");return l0(n)==="symbol"?n:String(n)}function T6e(e,n){if(l0(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(l0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function C6e(e,n){return A6e(e)||R6e(e,n)||wee(e,n)||N6e()}function N6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wee(e,n){if(e){if(typeof e=="string")return bD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bD(e,n)}}function bD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function R6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function A6e(e){if(Array.isArray(e))return e}var ew=function(n,a,o){return n+(a-n)*o},ED=function(n){var a=n.from,o=n.to;return a!==o},I6e=function e(n,a,o){var d=yy(function(p,f){if(ED(f)){var v=n(f.from,f.to,f.velocity),b=C6e(v,2),E=b[0],T=b[1];return zi(zi({},f),{},{from:E,velocity:T})}return f},a);return o<1?yy(function(p,f){return ED(f)?zi(zi({},f),{},{velocity:ew(f.velocity,d[p].velocity,o),from:ew(f.from,d[p].from,o)}):f},a):e(n,d,o-1)};const O6e=function(e,n,a,o,d){var p=o6e(e,n),f=p.reduce(function(I,F){return zi(zi({},I),{},_D({},F,[e[F],n[F]]))},{}),v=p.reduce(function(I,F){return zi(zi({},I),{},_D({},F,{from:e[F],velocity:0,to:n[F]}))},{}),b=-1,E,T,w=function(){return null},N=function(){return yy(function(F,U){return U.from},v)},P=function(){return!Object.values(v).filter(ED).length},A=function(F){E||(E=F);var U=F-E,V=U/a.dt;v=I6e(a,v,V),d(zi(zi(zi({},e),n),N())),E=F,P()||(b=requestAnimationFrame(w))},k=function(F){T||(T=F);var U=(F-T)/o,V=yy(function(B,z){return ew.apply(void 0,v9(z).concat([a(U)]))},f);if(d(zi(zi(zi({},e),n),V)),U<1)b=requestAnimationFrame(w);else{var W=yy(function(B,z){return ew.apply(void 0,v9(z).concat([a(1)]))},f);d(zi(zi(zi({},e),n),W))}};return w=a.isStepper?A:k,function(){return requestAnimationFrame(w),function(){cancelAnimationFrame(b)}}};function yf(e){"@babel/helpers - typeof";return yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yf(e)}var P6e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function D6e(e,n){if(e==null)return{};var a=k6e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function k6e(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}function i1(e){return U6e(e)||M6e(e)||L6e(e)||j6e()}function j6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L6e(e,n){if(e){if(typeof e=="string")return xD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xD(e,n)}}function M6e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function U6e(e){if(Array.isArray(e))return xD(e)}function xD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function _9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Ho(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?_9(Object(a),!0).forEach(function(o){ny(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function ny(e,n,a){return n=Tee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function F6e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function V6e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Tee(o.key),o)}}function B6e(e,n,a){return n&&V6e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tee(e){var n=G6e(e,"string");return yf(n)==="symbol"?n:String(n)}function G6e(e,n){if(yf(e)!=="object"||e===null)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(yf(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function W6e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&SD(e,n)}function SD(e,n){return SD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},SD(e,n)}function $6e(e){var n=H6e();return function(){var o=tw(e),d;if(n){var p=tw(this).constructor;d=Reflect.construct(o,arguments,p)}else d=o.apply(this,arguments);return wD(this,d)}}function wD(e,n){if(n&&(yf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TD(e)}function TD(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H6e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tw(e){return tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},tw(e)}var qc=function(e){W6e(a,e);var n=$6e(a);function a(o,d){var p;F6e(this,a),p=n.call(this,o,d);var f=p.props,v=f.isActive,b=f.attributeName,E=f.from,T=f.to,w=f.steps,N=f.children,P=f.duration;if(p.handleStyleChange=p.handleStyleChange.bind(TD(p)),p.changeStyle=p.changeStyle.bind(TD(p)),!v||P<=0)return p.state={style:{}},typeof N=="function"&&(p.state={style:T}),wD(p);if(w&&w.length)p.state={style:w[0].style};else if(E){if(typeof N=="function")return p.state={style:E},wD(p);p.state={style:b?ny({},b,E):E}}else p.state={style:{}};return p}return B6e(a,[{key:"componentDidMount",value:function(){var d=this.props,p=d.isActive,f=d.canBegin;this.mounted=!0,!(!p||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(d){var p=this.props,f=p.isActive,v=p.canBegin,b=p.attributeName,E=p.shouldReAnimate,T=p.to,w=p.from,N=this.state.style;if(v){if(!f){var P={style:b?ny({},b,T):T};this.state&&N&&(b&&N[b]!==T||!b&&N!==T)&&this.setState(P);return}if(!(JBe(d.to,T)&&d.canBegin&&d.isActive)){var A=!d.canBegin||!d.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var k=A||E?w:d.to;if(this.state&&N){var I={style:b?ny({},b,k):k};(b&&N[b]!==k||!b&&N!==k)&&this.setState(I)}this.runAnimation(Ho(Ho({},this.props),{},{from:k,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var d=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),d&&d()}},{key:"handleStyleChange",value:function(d){this.changeStyle(d)}},{key:"changeStyle",value:function(d){this.mounted&&this.setState({style:d})}},{key:"runJSAnimation",value:function(d){var p=this,f=d.from,v=d.to,b=d.duration,E=d.easing,T=d.begin,w=d.onAnimationEnd,N=d.onAnimationStart,P=O6e(f,v,b6e(E),b,this.changeStyle),A=function(){p.stopJSAnimation=P()};this.manager.start([N,T,A,b,w])}},{key:"runStepAnimation",value:function(d){var p=this,f=d.steps,v=d.begin,b=d.onAnimationStart,E=f[0],T=E.style,w=E.duration,N=w===void 0?0:w,P=function(k,I,F){if(F===0)return k;var U=I.duration,V=I.easing,W=V===void 0?"ease":V,B=I.style,z=I.properties,Y=I.onAnimationEnd,re=F>0?f[F-1]:I,Z=z||Object.keys(B);if(typeof W=="function"||W==="spring")return[].concat(i1(k),[p.runJSAnimation.bind(p,{from:re.style,to:B,duration:U,easing:W}),U]);var ie=m9(Z,U,W),te=Ho(Ho(Ho({},re.style),B),{},{transition:ie});return[].concat(i1(k),[te,U,Y]).filter(c6e)};return this.manager.start([b].concat(i1(f.reduce(P,[T,Math.max(N,v)])),[d.onAnimationEnd]))}},{key:"runAnimation",value:function(d){this.manager||(this.manager=i6e());var p=d.begin,f=d.duration,v=d.attributeName,b=d.to,E=d.easing,T=d.onAnimationStart,w=d.onAnimationEnd,N=d.steps,P=d.children,A=this.manager;if(this.unSubscribe=A.subscribe(this.handleStyleChange),typeof E=="function"||typeof P=="function"||E==="spring"){this.runJSAnimation(d);return}if(N.length>1){this.runStepAnimation(d);return}var k=v?ny({},v,b):b,I=m9(Object.keys(k),f,E);A.start([T,p,Ho(Ho({},k),{},{transition:I}),f,w])}},{key:"render",value:function(){var d=this.props,p=d.children;d.begin;var f=d.duration;d.attributeName,d.easing;var v=d.isActive;d.steps,d.from,d.to,d.canBegin,d.onAnimationEnd,d.shouldReAnimate,d.onAnimationReStart;var b=D6e(d,P6e),E=q.Children.count(p),T=this.state.style;if(typeof p=="function")return p(T);if(!v||E===0||f<=0)return p;var w=function(P){var A=P.props,k=A.style,I=k===void 0?{}:k,F=A.className,U=q.cloneElement(P,Ho(Ho({},b),{},{style:Ho(Ho({},I),T),className:F}));return U};return E===1?w(q.Children.only(p)):fe.createElement("div",null,q.Children.map(p,function(N){return w(N)}))}}]),a}(q.PureComponent);qc.displayName="Animate";qc.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};qc.propTypes={from:jt.oneOfType([jt.object,jt.string]),to:jt.oneOfType([jt.object,jt.string]),attributeName:jt.string,duration:jt.number,begin:jt.number,easing:jt.oneOfType([jt.string,jt.func]),steps:jt.arrayOf(jt.shape({duration:jt.number.isRequired,style:jt.object.isRequired,easing:jt.oneOfType([jt.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),jt.func]),properties:jt.arrayOf("string"),onAnimationEnd:jt.func})),children:jt.oneOfType([jt.node,jt.func]),isActive:jt.bool,canBegin:jt.bool,onAnimationEnd:jt.func,shouldReAnimate:jt.bool,onAnimationStart:jt.func,onAnimationReStart:jt.func};function d0(e){"@babel/helpers - typeof";return d0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},d0(e)}function nw(){return nw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},nw.apply(this,arguments)}function z6e(e,n){return X6e(e)||q6e(e,n)||Y6e(e,n)||K6e()}function K6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y6e(e,n){if(e){if(typeof e=="string")return b9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b9(e,n)}}function b9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function q6e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function X6e(e){if(Array.isArray(e))return e}function E9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function x9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?E9(Object(a),!0).forEach(function(o){J6e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function J6e(e,n,a){return n=Q6e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Q6e(e){var n=Z6e(e,"string");return d0(n)=="symbol"?n:n+""}function Z6e(e,n){if(d0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(d0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var S9=function(n,a,o,d,p){var f=Math.min(Math.abs(o)/2,Math.abs(d)/2),v=d>=0?1:-1,b=o>=0?1:-1,E=d>=0&&o>=0||d<0&&o<0?1:0,T;if(f>0&&p instanceof Array){for(var w=[0,0,0,0],N=0,P=4;N<P;N++)w[N]=p[N]>f?f:p[N];T="M".concat(n,",").concat(a+v*w[0]),w[0]>0&&(T+="A ".concat(w[0],",").concat(w[0],",0,0,").concat(E,",").concat(n+b*w[0],",").concat(a)),T+="L ".concat(n+o-b*w[1],",").concat(a),w[1]>0&&(T+="A ".concat(w[1],",").concat(w[1],",0,0,").concat(E,`,
        `).concat(n+o,",").concat(a+v*w[1])),T+="L ".concat(n+o,",").concat(a+d-v*w[2]),w[2]>0&&(T+="A ".concat(w[2],",").concat(w[2],",0,0,").concat(E,`,
        `).concat(n+o-b*w[2],",").concat(a+d)),T+="L ".concat(n+b*w[3],",").concat(a+d),w[3]>0&&(T+="A ".concat(w[3],",").concat(w[3],",0,0,").concat(E,`,
        `).concat(n,",").concat(a+d-v*w[3])),T+="Z"}else if(f>0&&p===+p&&p>0){var A=Math.min(f,p);T="M ".concat(n,",").concat(a+v*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+b*A,",").concat(a,`
            L `).concat(n+o-b*A,",").concat(a,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+o,",").concat(a+v*A,`
            L `).concat(n+o,",").concat(a+d-v*A,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n+o-b*A,",").concat(a+d,`
            L `).concat(n+b*A,",").concat(a+d,`
            A `).concat(A,",").concat(A,",0,0,").concat(E,",").concat(n,",").concat(a+d-v*A," Z")}else T="M ".concat(n,",").concat(a," h ").concat(o," v ").concat(d," h ").concat(-o," Z");return T},e8e=function(n,a){if(!n||!a)return!1;var o=n.x,d=n.y,p=a.x,f=a.y,v=a.width,b=a.height;if(Math.abs(v)>0&&Math.abs(b)>0){var E=Math.min(p,p+v),T=Math.max(p,p+v),w=Math.min(f,f+b),N=Math.max(f,f+b);return o>=E&&o<=T&&d>=w&&d<=N}return!1},t8e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},cj=function(n){var a=x9(x9({},t8e),n),o=q.useRef(),d=q.useState(-1),p=z6e(d,2),f=p[0],v=p[1];q.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var W=o.current.getTotalLength();W&&v(W)}catch{}},[]);var b=a.x,E=a.y,T=a.width,w=a.height,N=a.radius,P=a.className,A=a.animationEasing,k=a.animationDuration,I=a.animationBegin,F=a.isAnimationActive,U=a.isUpdateAnimationActive;if(b!==+b||E!==+E||T!==+T||w!==+w||T===0||w===0)return null;var V=On("recharts-rectangle",P);return U?fe.createElement(qc,{canBegin:f>0,from:{width:T,height:w,x:b,y:E},to:{width:T,height:w,x:b,y:E},duration:k,animationEasing:A,isActive:U},function(W){var B=W.width,z=W.height,Y=W.x,re=W.y;return fe.createElement(qc,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:I,duration:k,isActive:F,easing:A},fe.createElement("path",nw({},yn(a,!0),{className:V,d:S9(Y,re,B,z,N),ref:o})))}):fe.createElement("path",nw({},yn(a,!0),{className:V,d:S9(b,E,T,w,N)}))};function CD(){return CD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},CD.apply(this,arguments)}var IT=function(n){var a=n.cx,o=n.cy,d=n.r,p=n.className,f=On("recharts-dot",p);return a===+a&&o===+o&&d===+d?q.createElement("circle",CD({},yn(n,!1),_S(n),{className:f,cx:a,cy:o,r:d})):null};function u0(e){"@babel/helpers - typeof";return u0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u0(e)}var n8e=["x","y","top","left","width","height","className"];function ND(){return ND=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},ND.apply(this,arguments)}function w9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function r8e(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?w9(Object(a),!0).forEach(function(o){i8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):w9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function i8e(e,n,a){return n=a8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function a8e(e){var n=s8e(e,"string");return u0(n)=="symbol"?n:n+""}function s8e(e,n){if(u0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(u0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function o8e(e,n){if(e==null)return{};var a=c8e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function c8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var l8e=function(n,a,o,d,p,f){return"M".concat(n,",").concat(p,"v").concat(d,"M").concat(f,",").concat(a,"h").concat(o)},d8e=function(n){var a=n.x,o=a===void 0?0:a,d=n.y,p=d===void 0?0:d,f=n.top,v=f===void 0?0:f,b=n.left,E=b===void 0?0:b,T=n.width,w=T===void 0?0:T,N=n.height,P=N===void 0?0:N,A=n.className,k=o8e(n,n8e),I=r8e({x:o,y:p,top:v,left:E,width:w,height:P},k);return!ct(o)||!ct(p)||!ct(w)||!ct(P)||!ct(v)||!ct(E)?null:fe.createElement("path",ND({},yn(I,!0),{className:On("recharts-cross",A),d:l8e(o,p,w,P,v,E)}))},u8e=FQ,h8e=u8e(Object.getPrototypeOf,Object),p8e=h8e,m8e=Fl,f8e=p8e,g8e=Vl,v8e="[object Object]",y8e=Function.prototype,_8e=Object.prototype,Cee=y8e.toString,b8e=_8e.hasOwnProperty,E8e=Cee.call(Object);function x8e(e){if(!g8e(e)||m8e(e)!=v8e)return!1;var n=f8e(e);if(n===null)return!0;var a=b8e.call(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&Cee.call(a)==E8e}var S8e=x8e;const w8e=ar(S8e);var T8e=Fl,C8e=Vl,N8e="[object Boolean]";function R8e(e){return e===!0||e===!1||C8e(e)&&T8e(e)==N8e}var A8e=R8e;const I8e=ar(A8e);function h0(e){"@babel/helpers - typeof";return h0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},h0(e)}function rw(){return rw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},rw.apply(this,arguments)}function O8e(e,n){return j8e(e)||k8e(e,n)||D8e(e,n)||P8e()}function P8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D8e(e,n){if(e){if(typeof e=="string")return T9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return T9(e,n)}}function T9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function k8e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function j8e(e){if(Array.isArray(e))return e}function C9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function N9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?C9(Object(a),!0).forEach(function(o){L8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function L8e(e,n,a){return n=M8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function M8e(e){var n=U8e(e,"string");return h0(n)=="symbol"?n:n+""}function U8e(e,n){if(h0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(h0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var R9=function(n,a,o,d,p){var f=o-d,v;return v="M ".concat(n,",").concat(a),v+="L ".concat(n+o,",").concat(a),v+="L ".concat(n+o-f/2,",").concat(a+p),v+="L ".concat(n+o-f/2-d,",").concat(a+p),v+="L ".concat(n,",").concat(a," Z"),v},F8e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},V8e=function(n){var a=N9(N9({},F8e),n),o=q.useRef(),d=q.useState(-1),p=O8e(d,2),f=p[0],v=p[1];q.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var V=o.current.getTotalLength();V&&v(V)}catch{}},[]);var b=a.x,E=a.y,T=a.upperWidth,w=a.lowerWidth,N=a.height,P=a.className,A=a.animationEasing,k=a.animationDuration,I=a.animationBegin,F=a.isUpdateAnimationActive;if(b!==+b||E!==+E||T!==+T||w!==+w||N!==+N||T===0&&w===0||N===0)return null;var U=On("recharts-trapezoid",P);return F?fe.createElement(qc,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:N,x:b,y:E},to:{upperWidth:T,lowerWidth:w,height:N,x:b,y:E},duration:k,animationEasing:A,isActive:F},function(V){var W=V.upperWidth,B=V.lowerWidth,z=V.height,Y=V.x,re=V.y;return fe.createElement(qc,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:I,duration:k,easing:A},fe.createElement("path",rw({},yn(a,!0),{className:U,d:R9(Y,re,W,B,z),ref:o})))}):fe.createElement("g",null,fe.createElement("path",rw({},yn(a,!0),{className:U,d:R9(b,E,T,w,N)})))},B8e=["option","shapeType","propTransformer","activeClassName","isActive"];function p0(e){"@babel/helpers - typeof";return p0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},p0(e)}function G8e(e,n){if(e==null)return{};var a=W8e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function W8e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function A9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function iw(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?A9(Object(a),!0).forEach(function(o){$8e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function $8e(e,n,a){return n=H8e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function H8e(e){var n=z8e(e,"string");return p0(n)=="symbol"?n:n+""}function z8e(e,n){if(p0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(p0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function K8e(e,n){return iw(iw({},n),e)}function Y8e(e,n){return e==="symbols"}function I9(e){var n=e.shapeType,a=e.elementProps;switch(n){case"rectangle":return fe.createElement(cj,a);case"trapezoid":return fe.createElement(V8e,a);case"sector":return fe.createElement(fee,a);case"symbols":if(Y8e(n))return fe.createElement(N2,a);break;default:return null}}function q8e(e){return q.isValidElement(e)?e.props:e}function X8e(e){var n=e.option,a=e.shapeType,o=e.propTransformer,d=o===void 0?K8e:o,p=e.activeClassName,f=p===void 0?"recharts-active-shape":p,v=e.isActive,b=G8e(e,B8e),E;if(q.isValidElement(n))E=q.cloneElement(n,iw(iw({},b),q8e(n)));else if(pn(n))E=n(b);else if(w8e(n)&&!I8e(n)){var T=d(n,b);E=fe.createElement(I9,{shapeType:a,elementProps:T})}else{var w=b;E=fe.createElement(I9,{shapeType:a,elementProps:w})}return v?fe.createElement(mr,{className:f},E):E}function OT(e,n){return n!=null&&"trapezoids"in e.props}function PT(e,n){return n!=null&&"sectors"in e.props}function m0(e,n){return n!=null&&"points"in e.props}function J8e(e,n){var a,o,d=e.x===(n==null||(a=n.labelViewBox)===null||a===void 0?void 0:a.x)||e.x===n.x,p=e.y===(n==null||(o=n.labelViewBox)===null||o===void 0?void 0:o.y)||e.y===n.y;return d&&p}function Q8e(e,n){var a=e.endAngle===n.endAngle,o=e.startAngle===n.startAngle;return a&&o}function Z8e(e,n){var a=e.x===n.x,o=e.y===n.y,d=e.z===n.z;return a&&o&&d}function eGe(e,n){var a;return OT(e,n)?a=J8e:PT(e,n)?a=Q8e:m0(e,n)&&(a=Z8e),a}function tGe(e,n){var a;return OT(e,n)?a="trapezoids":PT(e,n)?a="sectors":m0(e,n)&&(a="points"),a}function nGe(e,n){if(OT(e,n)){var a;return(a=n.tooltipPayload)===null||a===void 0||(a=a[0])===null||a===void 0||(a=a.payload)===null||a===void 0?void 0:a.payload}if(PT(e,n)){var o;return(o=n.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}return m0(e,n)?n.payload:{}}function rGe(e){var n=e.activeTooltipItem,a=e.graphicalItem,o=e.itemData,d=tGe(a,n),p=nGe(a,n),f=o.filter(function(b,E){var T=gf(p,b),w=a.props[d].filter(function(A){var k=eGe(a,n);return k(A,n)}),N=a.props[d].indexOf(w[w.length-1]),P=E===N;return T&&P}),v=o.indexOf(f[f.length-1]);return v}var iGe=Math.ceil,aGe=Math.max;function sGe(e,n,a,o){for(var d=-1,p=aGe(iGe((n-e)/(a||1)),0),f=Array(p);p--;)f[o?p:++d]=e,e+=a;return f}var oGe=sGe,cGe=iZ,O9=1/0,lGe=17976931348623157e292;function dGe(e){if(!e)return e===0?e:0;if(e=cGe(e),e===O9||e===-O9){var n=e<0?-1:1;return n*lGe}return e===e?e:0}var Nee=dGe,uGe=oGe,hGe=bT,a1=Nee;function pGe(e){return function(n,a,o){return o&&typeof o!="number"&&hGe(n,a,o)&&(a=o=void 0),n=a1(n),a===void 0?(a=n,n=0):a=a1(a),o=o===void 0?n<a?1:-1:a1(o),uGe(n,a,o,e)}}var mGe=pGe,fGe=mGe,gGe=fGe(),vGe=gGe;const aw=ar(vGe);function f0(e){"@babel/helpers - typeof";return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},f0(e)}function P9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function D9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?P9(Object(a),!0).forEach(function(o){Ree(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Ree(e,n,a){return n=yGe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function yGe(e){var n=_Ge(e,"string");return f0(n)=="symbol"?n:n+""}function _Ge(e,n){if(f0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(f0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var bGe=["Webkit","Moz","O","ms"],EGe=function(n,a){var o=n.replace(/(\w)/,function(p){return p.toUpperCase()}),d=bGe.reduce(function(p,f){return D9(D9({},p),{},Ree({},f+o,a))},{});return d[n]=a,d};function _f(e){"@babel/helpers - typeof";return _f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_f(e)}function sw(){return sw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},sw.apply(this,arguments)}function k9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function s1(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?k9(Object(a),!0).forEach(function(o){_s(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function xGe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function j9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Iee(o.key),o)}}function SGe(e,n,a){return n&&j9(e.prototype,n),a&&j9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function wGe(e,n,a){return n=ow(n),TGe(e,Aee()?Reflect.construct(n,a||[],ow(e).constructor):n.apply(e,a))}function TGe(e,n){if(n&&(_f(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CGe(e)}function CGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Aee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Aee=function(){return!!e})()}function ow(e){return ow=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},ow(e)}function NGe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&RD(e,n)}function RD(e,n){return RD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},RD(e,n)}function _s(e,n,a){return n=Iee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Iee(e){var n=RGe(e,"string");return _f(n)=="symbol"?n:n+""}function RGe(e,n){if(_f(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(_f(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var AGe=function(n){var a=n.data,o=n.startIndex,d=n.endIndex,p=n.x,f=n.width,v=n.travellerWidth;if(!a||!a.length)return{};var b=a.length,E=gy().domain(aw(0,b)).range([p,p+f-v]),T=E.domain().map(function(w){return E(w)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:E(o),endX:E(d),scale:E,scaleValues:T}},L9=function(n){return n.changedTouches&&!!n.changedTouches.length},bf=function(e){function n(a){var o;return xGe(this,n),o=wGe(this,n,[a]),_s(o,"handleDrag",function(d){o.leaveTimer&&(clearTimeout(o.leaveTimer),o.leaveTimer=null),o.state.isTravellerMoving?o.handleTravellerMove(d):o.state.isSlideMoving&&o.handleSlideDrag(d)}),_s(o,"handleTouchMove",function(d){d.changedTouches!=null&&d.changedTouches.length>0&&o.handleDrag(d.changedTouches[0])}),_s(o,"handleDragEnd",function(){o.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var d=o.props,p=d.endIndex,f=d.onDragEnd,v=d.startIndex;f==null||f({endIndex:p,startIndex:v})}),o.detachDragEndListener()}),_s(o,"handleLeaveWrapper",function(){(o.state.isTravellerMoving||o.state.isSlideMoving)&&(o.leaveTimer=window.setTimeout(o.handleDragEnd,o.props.leaveTimeOut))}),_s(o,"handleEnterSlideOrTraveller",function(){o.setState({isTextActive:!0})}),_s(o,"handleLeaveSlideOrTraveller",function(){o.setState({isTextActive:!1})}),_s(o,"handleSlideDragStart",function(d){var p=L9(d)?d.changedTouches[0]:d;o.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:p.pageX}),o.attachDragEndListener()}),o.travellerDragStartHandlers={startX:o.handleTravellerDragStart.bind(o,"startX"),endX:o.handleTravellerDragStart.bind(o,"endX")},o.state={},o}return NGe(n,e),SGe(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(o){var d=o.startX,p=o.endX,f=this.state.scaleValues,v=this.props,b=v.gap,E=v.data,T=E.length-1,w=Math.min(d,p),N=Math.max(d,p),P=n.getIndexInRange(f,w),A=n.getIndexInRange(f,N);return{startIndex:P-P%b,endIndex:A===T?T:A-A%b}}},{key:"getTextOfTick",value:function(o){var d=this.props,p=d.data,f=d.tickFormatter,v=d.dataKey,b=Ia(p[o],v,o);return pn(f)?f(b,o):b}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(o){var d=this.state,p=d.slideMoveStartX,f=d.startX,v=d.endX,b=this.props,E=b.x,T=b.width,w=b.travellerWidth,N=b.startIndex,P=b.endIndex,A=b.onChange,k=o.pageX-p;k>0?k=Math.min(k,E+T-w-v,E+T-w-f):k<0&&(k=Math.max(k,E-f,E-v));var I=this.getIndex({startX:f+k,endX:v+k});(I.startIndex!==N||I.endIndex!==P)&&A&&A(I),this.setState({startX:f+k,endX:v+k,slideMoveStartX:o.pageX})}},{key:"handleTravellerDragStart",value:function(o,d){var p=L9(d)?d.changedTouches[0]:d;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:o,brushMoveStartX:p.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(o){var d=this.state,p=d.brushMoveStartX,f=d.movingTravellerId,v=d.endX,b=d.startX,E=this.state[f],T=this.props,w=T.x,N=T.width,P=T.travellerWidth,A=T.onChange,k=T.gap,I=T.data,F={startX:this.state.startX,endX:this.state.endX},U=o.pageX-p;U>0?U=Math.min(U,w+N-P-E):U<0&&(U=Math.max(U,w-E)),F[f]=E+U;var V=this.getIndex(F),W=V.startIndex,B=V.endIndex,z=function(){var re=I.length-1;return f==="startX"&&(v>b?W%k===0:B%k===0)||v<b&&B===re||f==="endX"&&(v>b?B%k===0:W%k===0)||v>b&&B===re};this.setState(_s(_s({},f,E+U),"brushMoveStartX",o.pageX),function(){A&&z()&&A(V)})}},{key:"handleTravellerMoveKeyboard",value:function(o,d){var p=this,f=this.state,v=f.scaleValues,b=f.startX,E=f.endX,T=this.state[d],w=v.indexOf(T);if(w!==-1){var N=w+o;if(!(N===-1||N>=v.length)){var P=v[N];d==="startX"&&P>=E||d==="endX"&&P<=b||this.setState(_s({},d,P),function(){p.props.onChange(p.getIndex({startX:p.state.startX,endX:p.state.endX}))})}}}},{key:"renderBackground",value:function(){var o=this.props,d=o.x,p=o.y,f=o.width,v=o.height,b=o.fill,E=o.stroke;return fe.createElement("rect",{stroke:E,fill:b,x:d,y:p,width:f,height:v})}},{key:"renderPanorama",value:function(){var o=this.props,d=o.x,p=o.y,f=o.width,v=o.height,b=o.data,E=o.children,T=o.padding,w=q.Children.only(E);return w?fe.cloneElement(w,{x:d,y:p,width:f,height:v,margin:T,compact:!0,data:b}):null}},{key:"renderTravellerLayer",value:function(o,d){var p,f,v=this,b=this.props,E=b.y,T=b.travellerWidth,w=b.height,N=b.traveller,P=b.ariaLabel,A=b.data,k=b.startIndex,I=b.endIndex,F=Math.max(o,this.props.x),U=s1(s1({},yn(this.props,!1)),{},{x:F,y:E,width:T,height:w}),V=P||"Min value: ".concat((p=A[k])===null||p===void 0?void 0:p.name,", Max value: ").concat((f=A[I])===null||f===void 0?void 0:f.name);return fe.createElement(mr,{tabIndex:0,role:"slider","aria-label":V,"aria-valuenow":o,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[d],onTouchStart:this.travellerDragStartHandlers[d],onKeyDown:function(B){["ArrowLeft","ArrowRight"].includes(B.key)&&(B.preventDefault(),B.stopPropagation(),v.handleTravellerMoveKeyboard(B.key==="ArrowRight"?1:-1,d))},onFocus:function(){v.setState({isTravellerFocused:!0})},onBlur:function(){v.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(N,U))}},{key:"renderSlide",value:function(o,d){var p=this.props,f=p.y,v=p.height,b=p.stroke,E=p.travellerWidth,T=Math.min(o,d)+E,w=Math.max(Math.abs(d-o)-E,0);return fe.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:b,fillOpacity:.2,x:T,y:f,width:w,height:v})}},{key:"renderText",value:function(){var o=this.props,d=o.startIndex,p=o.endIndex,f=o.y,v=o.height,b=o.travellerWidth,E=o.stroke,T=this.state,w=T.startX,N=T.endX,P=5,A={pointerEvents:"none",fill:E};return fe.createElement(mr,{className:"recharts-brush-texts"},fe.createElement(jS,sw({textAnchor:"end",verticalAnchor:"middle",x:Math.min(w,N)-P,y:f+v/2},A),this.getTextOfTick(d)),fe.createElement(jS,sw({textAnchor:"start",verticalAnchor:"middle",x:Math.max(w,N)+b+P,y:f+v/2},A),this.getTextOfTick(p)))}},{key:"render",value:function(){var o=this.props,d=o.data,p=o.className,f=o.children,v=o.x,b=o.y,E=o.width,T=o.height,w=o.alwaysShowText,N=this.state,P=N.startX,A=N.endX,k=N.isTextActive,I=N.isSlideMoving,F=N.isTravellerMoving,U=N.isTravellerFocused;if(!d||!d.length||!ct(v)||!ct(b)||!ct(E)||!ct(T)||E<=0||T<=0)return null;var V=On("recharts-brush",p),W=fe.Children.count(f)===1,B=EGe("userSelect","none");return fe.createElement(mr,{className:V,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:B},this.renderBackground(),W&&this.renderPanorama(),this.renderSlide(P,A),this.renderTravellerLayer(P,"startX"),this.renderTravellerLayer(A,"endX"),(k||I||F||U||w)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(o){var d=o.x,p=o.y,f=o.width,v=o.height,b=o.stroke,E=Math.floor(p+v/2)-1;return fe.createElement(fe.Fragment,null,fe.createElement("rect",{x:d,y:p,width:f,height:v,fill:b,stroke:"none"}),fe.createElement("line",{x1:d+1,y1:E,x2:d+f-1,y2:E,fill:"none",stroke:"#fff"}),fe.createElement("line",{x1:d+1,y1:E+2,x2:d+f-1,y2:E+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(o,d){var p;return fe.isValidElement(o)?p=fe.cloneElement(o,d):pn(o)?p=o(d):p=n.renderDefaultTraveller(d),p}},{key:"getDerivedStateFromProps",value:function(o,d){var p=o.data,f=o.width,v=o.x,b=o.travellerWidth,E=o.updateId,T=o.startIndex,w=o.endIndex;if(p!==d.prevData||E!==d.prevUpdateId)return s1({prevData:p,prevTravellerWidth:b,prevUpdateId:E,prevX:v,prevWidth:f},p&&p.length?AGe({data:p,width:f,x:v,travellerWidth:b,startIndex:T,endIndex:w}):{scale:null,scaleValues:null});if(d.scale&&(f!==d.prevWidth||v!==d.prevX||b!==d.prevTravellerWidth)){d.scale.range([v,v+f-b]);var N=d.scale.domain().map(function(P){return d.scale(P)});return{prevData:p,prevTravellerWidth:b,prevUpdateId:E,prevX:v,prevWidth:f,startX:d.scale(o.startIndex),endX:d.scale(o.endIndex),scaleValues:N}}return null}},{key:"getIndexInRange",value:function(o,d){for(var p=o.length,f=0,v=p-1;v-f>1;){var b=Math.floor((f+v)/2);o[b]>d?v=b:f=b}return d>=o[v]?v:f}}])}(q.PureComponent);_s(bf,"displayName","Brush");_s(bf,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var IGe=k2;function OGe(e,n){var a;return IGe(e,function(o,d,p){return a=n(o,d,p),!a}),!!a}var PGe=OGe,DGe=OQ,kGe=au,jGe=PGe,LGe=is,MGe=bT;function UGe(e,n,a){var o=LGe(e)?DGe:jGe;return a&&MGe(e,n,a)&&(n=void 0),o(e,kGe(n))}var FGe=UGe;const VGe=ar(FGe);var Hc=function(n,a){var o=n.alwaysShow,d=n.ifOverflow;return o&&(d="extendDomain"),d===a},M9=ZQ;function BGe(e,n,a){n=="__proto__"&&M9?M9(e,n,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[n]=a}var GGe=BGe,WGe=GGe,$Ge=JQ,HGe=au;function zGe(e,n){var a={};return n=HGe(n),$Ge(e,function(o,d,p){WGe(a,d,n(o,d,p))}),a}var KGe=zGe;const YGe=ar(KGe);function qGe(e,n){for(var a=-1,o=e==null?0:e.length;++a<o;)if(!n(e[a],a,e))return!1;return!0}var XGe=qGe,JGe=k2;function QGe(e,n){var a=!0;return JGe(e,function(o,d,p){return a=!!n(o,d,p),a}),a}var ZGe=QGe,eWe=XGe,tWe=ZGe,nWe=au,rWe=is,iWe=bT;function aWe(e,n,a){var o=rWe(e)?eWe:tWe;return a&&iWe(e,n,a)&&(n=void 0),o(e,nWe(n))}var sWe=aWe;const Oee=ar(sWe);var oWe=["x","y"];function g0(e){"@babel/helpers - typeof";return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},g0(e)}function AD(){return AD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},AD.apply(this,arguments)}function U9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Xv(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?U9(Object(a),!0).forEach(function(o){cWe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function cWe(e,n,a){return n=lWe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function lWe(e){var n=dWe(e,"string");return g0(n)=="symbol"?n:n+""}function dWe(e,n){if(g0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(g0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function uWe(e,n){if(e==null)return{};var a=hWe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function hWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function pWe(e,n){var a=e.x,o=e.y,d=uWe(e,oWe),p="".concat(a),f=parseInt(p,10),v="".concat(o),b=parseInt(v,10),E="".concat(n.height||d.height),T=parseInt(E,10),w="".concat(n.width||d.width),N=parseInt(w,10);return Xv(Xv(Xv(Xv(Xv({},n),d),f?{x:f}:{}),b?{y:b}:{}),{},{height:T,width:N,name:n.name,radius:n.radius})}function F9(e){return fe.createElement(X8e,AD({shapeType:"rectangle",propTransformer:pWe,activeClassName:"recharts-active-bar"},e))}var mWe=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(o,d){if(typeof n=="number")return n;var p=ct(o)||OAe(o);return p?n(o,d):(p||Vh(),a)}},fWe=["value","background"],Pee;function Ef(e){"@babel/helpers - typeof";return Ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ef(e)}function gWe(e,n){if(e==null)return{};var a=vWe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function vWe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function cw(){return cw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},cw.apply(this,arguments)}function V9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function oi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?V9(Object(a),!0).forEach(function(o){jd(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):V9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function yWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function B9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,kee(o.key),o)}}function _We(e,n,a){return n&&B9(e.prototype,n),a&&B9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function bWe(e,n,a){return n=lw(n),EWe(e,Dee()?Reflect.construct(n,a||[],lw(e).constructor):n.apply(e,a))}function EWe(e,n){if(n&&(Ef(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xWe(e)}function xWe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Dee=function(){return!!e})()}function lw(e){return lw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},lw(e)}function SWe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&ID(e,n)}function ID(e,n){return ID=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},ID(e,n)}function jd(e,n,a){return n=kee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function kee(e){var n=wWe(e,"string");return Ef(n)=="symbol"?n:n+""}function wWe(e,n){if(Ef(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Ef(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var G0=function(e){function n(){var a;yWe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=bWe(this,n,[].concat(d)),jd(a,"state",{isAnimationFinished:!1}),jd(a,"id",qf("recharts-bar-")),jd(a,"handleAnimationEnd",function(){var f=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),f&&f()}),jd(a,"handleAnimationStart",function(){var f=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),f&&f()}),a}return SWe(n,e),_We(n,[{key:"renderRectanglesStatically",value:function(o){var d=this,p=this.props,f=p.shape,v=p.dataKey,b=p.activeIndex,E=p.activeBar,T=yn(this.props,!1);return o&&o.map(function(w,N){var P=N===b,A=P?E:f,k=oi(oi(oi({},T),w),{},{isActive:P,option:A,index:N,dataKey:v,onAnimationStart:d.handleAnimationStart,onAnimationEnd:d.handleAnimationEnd});return fe.createElement(mr,cw({className:"recharts-bar-rectangle"},bS(d.props,w,N),{key:"rectangle-".concat(w==null?void 0:w.x,"-").concat(w==null?void 0:w.y,"-").concat(w==null?void 0:w.value,"-").concat(N)}),fe.createElement(F9,k))})}},{key:"renderRectanglesWithAnimation",value:function(){var o=this,d=this.props,p=d.data,f=d.layout,v=d.isAnimationActive,b=d.animationBegin,E=d.animationDuration,T=d.animationEasing,w=d.animationId,N=this.state.prevData;return fe.createElement(qc,{begin:b,duration:E,isActive:v,easing:T,from:{t:0},to:{t:1},key:"bar-".concat(w),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(P){var A=P.t,k=p.map(function(I,F){var U=N&&N[F];if(U){var V=Yi(U.x,I.x),W=Yi(U.y,I.y),B=Yi(U.width,I.width),z=Yi(U.height,I.height);return oi(oi({},I),{},{x:V(A),y:W(A),width:B(A),height:z(A)})}if(f==="horizontal"){var Y=Yi(0,I.height),re=Y(A);return oi(oi({},I),{},{y:I.y+I.height-re,height:re})}var Z=Yi(0,I.width),ie=Z(A);return oi(oi({},I),{},{width:ie})});return fe.createElement(mr,null,o.renderRectanglesStatically(k))})}},{key:"renderRectangles",value:function(){var o=this.props,d=o.data,p=o.isAnimationActive,f=this.state.prevData;return p&&d&&d.length&&(!f||!gf(f,d))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(d)}},{key:"renderBackground",value:function(){var o=this,d=this.props,p=d.data,f=d.dataKey,v=d.activeIndex,b=yn(this.props.background,!1);return p.map(function(E,T){E.value;var w=E.background,N=gWe(E,fWe);if(!w)return null;var P=oi(oi(oi(oi(oi({},N),{},{fill:"#eee"},w),b),bS(o.props,E,T)),{},{onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd,dataKey:f,index:T,className:"recharts-bar-background-rectangle"});return fe.createElement(F9,cw({key:"background-bar-".concat(T),option:o.props.background,isActive:T===v},P))})}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,f=p.data,v=p.xAxis,b=p.yAxis,E=p.layout,T=p.children,w=mo(T,B0);if(!w)return null;var N=E==="vertical"?f[0].height/2:f[0].width/2,P=function(I,F){var U=Array.isArray(I.value)?I.value[1]:I.value;return{x:I.x,y:I.y,value:U,errorVal:Ia(I,F)}},A={clipPath:o?"url(#clipPath-".concat(d,")"):null};return fe.createElement(mr,A,w.map(function(k){return fe.cloneElement(k,{key:"error-bar-".concat(d,"-").concat(k.props.dataKey),data:f,xAxis:v,yAxis:b,layout:E,offset:N,dataPointFormatter:P})}))}},{key:"render",value:function(){var o=this.props,d=o.hide,p=o.data,f=o.className,v=o.xAxis,b=o.yAxis,E=o.left,T=o.top,w=o.width,N=o.height,P=o.isAnimationActive,A=o.background,k=o.id;if(d||!p||!p.length)return null;var I=this.state.isAnimationFinished,F=On("recharts-bar",f),U=v&&v.allowDataOverflow,V=b&&b.allowDataOverflow,W=U||V,B=bn(k)?this.id:k;return fe.createElement(mr,{className:F},U||V?fe.createElement("defs",null,fe.createElement("clipPath",{id:"clipPath-".concat(B)},fe.createElement("rect",{x:U?E:E-w/2,y:V?T:T-N/2,width:U?w:w*2,height:V?N:N*2}))):null,fe.createElement(mr,{className:"recharts-bar-rectangles",clipPath:W?"url(#clipPath-".concat(B,")"):null},A?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(W,B),(!P||I)&&Nl.renderCallByParent(this.props,p))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curData:o.data,prevData:d.curData}:o.data!==d.curData?{curData:o.data}:null}}])}(q.PureComponent);Pee=G0;jd(G0,"displayName","Bar");jd(G0,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});jd(G0,"getComposedData",function(e){var n=e.props,a=e.item,o=e.barPosition,d=e.bandSize,p=e.xAxis,f=e.yAxis,v=e.xAxisTicks,b=e.yAxisTicks,E=e.stackedData,T=e.dataStartIndex,w=e.displayedData,N=e.offset,P=ZFe(o,a);if(!P)return null;var A=n.layout,k=a.type.defaultProps,I=k!==void 0?oi(oi({},k),a.props):a.props,F=I.dataKey,U=I.children,V=I.minPointSize,W=A==="horizontal"?f:p,B=E?W.scale.domain():null,z=oVe({numericAxis:W}),Y=mo(U,sZ),re=w.map(function(Z,ie){var te,de,xe,me,Ce,ue;E?te=eVe(E[T+ie],B):(te=Ia(Z,F),Array.isArray(te)||(te=[z,te]));var be=mWe(V,Pee.defaultProps.minPointSize)(te[1],ie);if(A==="horizontal"){var se,pe=[f.scale(te[0]),f.scale(te[1])],De=pe[0],Se=pe[1];de=VK({axis:p,ticks:v,bandSize:d,offset:P.offset,entry:Z,index:ie}),xe=(se=Se??De)!==null&&se!==void 0?se:void 0,me=P.size;var we=De-Se;if(Ce=Number.isNaN(we)?0:we,ue={x:de,y:f.y,width:me,height:f.height},Math.abs(be)>0&&Math.abs(Ce)<Math.abs(be)){var qe=Zo(Ce||be)*(Math.abs(be)-Math.abs(Ce));xe-=qe,Ce+=qe}}else{var lt=[p.scale(te[0]),p.scale(te[1])],Ut=lt[0],Ht=lt[1];if(de=Ut,xe=VK({axis:f,ticks:b,bandSize:d,offset:P.offset,entry:Z,index:ie}),me=Ht-Ut,Ce=P.size,ue={x:p.x,y:xe,width:p.width,height:Ce},Math.abs(be)>0&&Math.abs(me)<Math.abs(be)){var Ue=Zo(me||be)*(Math.abs(be)-Math.abs(me));me+=Ue}}return oi(oi(oi({},Z),{},{x:de,y:xe,width:me,height:Ce,value:E?te:te[1],payload:Z,background:ue},Y&&Y[ie]&&Y[ie].props),{},{tooltipPayload:[hee(a,Z)],tooltipPosition:{x:de+me/2,y:xe+Ce/2}})});return oi({data:re,layout:A},N)});function v0(e){"@babel/helpers - typeof";return v0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},v0(e)}function TWe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function G9(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,jee(o.key),o)}}function CWe(e,n,a){return n&&G9(e.prototype,n),a&&G9(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function W9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function qo(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?W9(Object(a),!0).forEach(function(o){DT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function DT(e,n,a){return n=jee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function jee(e){var n=NWe(e,"string");return v0(n)=="symbol"?n:n+""}function NWe(e,n){if(v0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(v0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var Lee=function(n,a,o,d,p){var f=n.width,v=n.height,b=n.layout,E=n.children,T=Object.keys(a),w={left:o.left,leftMirror:o.left,right:f-o.right,rightMirror:f-o.right,top:o.top,topMirror:o.top,bottom:v-o.bottom,bottomMirror:v-o.bottom},N=!!Es(E,G0);return T.reduce(function(P,A){var k=a[A],I=k.orientation,F=k.domain,U=k.padding,V=U===void 0?{}:U,W=k.mirror,B=k.reversed,z="".concat(I).concat(W?"Mirror":""),Y,re,Z,ie,te;if(k.type==="number"&&(k.padding==="gap"||k.padding==="no-gap")){var de=F[1]-F[0],xe=1/0,me=k.categoricalDomain.sort(kAe);if(me.forEach(function(lt,Ut){Ut>0&&(xe=Math.min((lt||0)-(me[Ut-1]||0),xe))}),Number.isFinite(xe)){var Ce=xe/de,ue=k.layout==="vertical"?o.height:o.width;if(k.padding==="gap"&&(Y=Ce*ue/2),k.padding==="no-gap"){var be=Uh(n.barCategoryGap,Ce*ue),se=Ce*ue/2;Y=se-be-(se-be)/ue*be}}}d==="xAxis"?re=[o.left+(V.left||0)+(Y||0),o.left+o.width-(V.right||0)-(Y||0)]:d==="yAxis"?re=b==="horizontal"?[o.top+o.height-(V.bottom||0),o.top+(V.top||0)]:[o.top+(V.top||0)+(Y||0),o.top+o.height-(V.bottom||0)-(Y||0)]:re=k.range,B&&(re=[re[1],re[0]]);var pe=JFe(k,p,N),De=pe.scale,Se=pe.realScaleType;De.domain(F).range(re),QFe(De);var we=sVe(De,qo(qo({},k),{},{realScaleType:Se}));d==="xAxis"?(te=I==="top"&&!W||I==="bottom"&&W,Z=o.left,ie=w[z]-te*k.height):d==="yAxis"&&(te=I==="left"&&!W||I==="right"&&W,Z=w[z]-te*k.width,ie=o.top);var qe=qo(qo(qo({},k),we),{},{realScaleType:Se,x:Z,y:ie,scale:De,width:d==="xAxis"?o.width:k.width,height:d==="yAxis"?o.height:k.height});return qe.bandSize=XS(qe,we),!k.hide&&d==="xAxis"?w[z]+=(te?-1:1)*qe.height:k.hide||(w[z]+=(te?-1:1)*qe.width),qo(qo({},P),{},DT({},A,qe))},{})},Mee=function(n,a){var o=n.x,d=n.y,p=a.x,f=a.y;return{x:Math.min(o,p),y:Math.min(d,f),width:Math.abs(p-o),height:Math.abs(f-d)}},RWe=function(n){var a=n.x1,o=n.y1,d=n.x2,p=n.y2;return Mee({x:a,y:o},{x:d,y:p})},Uee=function(){function e(n){TWe(this,e),this.scale=n}return CWe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.bandAware,p=o.position;if(a!==void 0){if(p)switch(p){case"start":return this.scale(a);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+f}case"end":{var v=this.bandwidth?this.bandwidth():0;return this.scale(a)+v}default:return this.scale(a)}if(d){var b=this.bandwidth?this.bandwidth()/2:0;return this.scale(a)+b}return this.scale(a)}}},{key:"isInRange",value:function(a){var o=this.range(),d=o[0],p=o[o.length-1];return d<=p?a>=d&&a<=p:a>=p&&a<=d}}],[{key:"create",value:function(a){return new e(a)}}])}();DT(Uee,"EPS",1e-4);var lj=function(n){var a=Object.keys(n).reduce(function(o,d){return qo(qo({},o),{},DT({},d,Uee.create(n[d])))},{});return qo(qo({},a),{},{apply:function(d){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=p.bandAware,v=p.position;return YGe(d,function(b,E){return a[E].apply(b,{bandAware:f,position:v})})},isInRange:function(d){return Oee(d,function(p,f){return a[f].isInRange(p)})}})};function AWe(e){return(e%180+180)%180}var IWe=function(n){var a=n.width,o=n.height,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=AWe(d),f=p*Math.PI/180,v=Math.atan(o/a),b=f>v&&f<Math.PI-v?o/Math.sin(f):a/Math.cos(f);return Math.abs(b)},OWe=au,PWe=L0,DWe=yT;function kWe(e){return function(n,a,o){var d=Object(n);if(!PWe(n)){var p=OWe(a);n=DWe(n),a=function(v){return p(d[v],v,d)}}var f=e(n,a,o);return f>-1?d[p?n[f]:f]:void 0}}var jWe=kWe,LWe=Nee;function MWe(e){var n=LWe(e),a=n%1;return n===n?a?n-a:n:0}var UWe=MWe,FWe=HQ,VWe=au,BWe=UWe,GWe=Math.max;function WWe(e,n,a){var o=e==null?0:e.length;if(!o)return-1;var d=a==null?0:BWe(a);return d<0&&(d=GWe(o+d,0)),FWe(e,VWe(n),d)}var $We=WWe,HWe=jWe,zWe=$We,KWe=HWe(zWe),YWe=KWe;const qWe=ar(YWe);var XWe=MRe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),dj=q.createContext(void 0),uj=q.createContext(void 0),Fee=q.createContext(void 0),Vee=q.createContext({}),Bee=q.createContext(void 0),Gee=q.createContext(0),Wee=q.createContext(0),$9=function(n){var a=n.state,o=a.xAxisMap,d=a.yAxisMap,p=a.offset,f=n.clipPathId,v=n.children,b=n.width,E=n.height,T=XWe(p);return fe.createElement(dj.Provider,{value:o},fe.createElement(uj.Provider,{value:d},fe.createElement(Vee.Provider,{value:p},fe.createElement(Fee.Provider,{value:T},fe.createElement(Bee.Provider,{value:f},fe.createElement(Gee.Provider,{value:E},fe.createElement(Wee.Provider,{value:b},v)))))))},JWe=function(){return q.useContext(Bee)},$ee=function(n){var a=q.useContext(dj);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},QWe=function(){var n=q.useContext(dj);return Ad(n)},ZWe=function(){var n=q.useContext(uj),a=qWe(n,function(o){return Oee(o.domain,Number.isFinite)});return a||Ad(n)},Hee=function(n){var a=q.useContext(uj);a==null&&Vh();var o=a[n];return o==null&&Vh(),o},e$e=function(){var n=q.useContext(Fee);return n},t$e=function(){return q.useContext(Vee)},hj=function(){return q.useContext(Wee)},pj=function(){return q.useContext(Gee)};function xf(e){"@babel/helpers - typeof";return xf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xf(e)}function n$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Kee(o.key),o)}}function i$e(e,n,a){return n&&r$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a$e(e,n,a){return n=dw(n),s$e(e,zee()?Reflect.construct(n,a||[],dw(e).constructor):n.apply(e,a))}function s$e(e,n){if(n&&(xf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o$e(e)}function o$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zee=function(){return!!e})()}function dw(e){return dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},dw(e)}function c$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&OD(e,n)}function OD(e,n){return OD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},OD(e,n)}function H9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function z9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?H9(Object(a),!0).forEach(function(o){mj(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function mj(e,n,a){return n=Kee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Kee(e){var n=l$e(e,"string");return xf(n)=="symbol"?n:n+""}function l$e(e,n){if(xf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(xf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function d$e(e,n){return m$e(e)||p$e(e,n)||h$e(e,n)||u$e()}function u$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h$e(e,n){if(e){if(typeof e=="string")return K9(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return K9(e,n)}}function K9(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function p$e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function m$e(e){if(Array.isArray(e))return e}function PD(){return PD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},PD.apply(this,arguments)}var f$e=function(n,a){var o;return fe.isValidElement(n)?o=fe.cloneElement(n,a):pn(n)?o=n(a):o=fe.createElement("line",PD({},a,{className:"recharts-reference-line-line"})),o},g$e=function(n,a,o,d,p,f,v,b,E){var T=p.x,w=p.y,N=p.width,P=p.height;if(o){var A=E.y,k=n.y.apply(A,{position:f});if(Hc(E,"discard")&&!n.y.isInRange(k))return null;var I=[{x:T+N,y:k},{x:T,y:k}];return b==="left"?I.reverse():I}if(a){var F=E.x,U=n.x.apply(F,{position:f});if(Hc(E,"discard")&&!n.x.isInRange(U))return null;var V=[{x:U,y:w+P},{x:U,y:w}];return v==="top"?V.reverse():V}if(d){var W=E.segment,B=W.map(function(z){return n.apply(z,{position:f})});return Hc(E,"discard")&&VGe(B,function(z){return!n.isInRange(z)})?null:B}return null};function v$e(e){var n=e.x,a=e.y,o=e.segment,d=e.xAxisId,p=e.yAxisId,f=e.shape,v=e.className,b=e.alwaysShow,E=JWe(),T=$ee(d),w=Hee(p),N=e$e();if(!E||!N)return null;Tl(b===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var P=lj({x:T.scale,y:w.scale}),A=Ei(n),k=Ei(a),I=o&&o.length===2,F=g$e(P,A,k,I,N,e.position,T.orientation,w.orientation,e);if(!F)return null;var U=d$e(F,2),V=U[0],W=V.x,B=V.y,z=U[1],Y=z.x,re=z.y,Z=Hc(e,"hidden")?"url(#".concat(E,")"):void 0,ie=z9(z9({clipPath:Z},yn(e,!0)),{},{x1:W,y1:B,x2:Y,y2:re});return fe.createElement(mr,{className:On("recharts-reference-line",v)},f$e(f,ie),da.renderCallByParent(e,RWe({x1:W,y1:B,x2:Y,y2:re})))}var fj=function(e){function n(){return n$e(this,n),a$e(this,n,arguments)}return c$e(n,e),i$e(n,[{key:"render",value:function(){return fe.createElement(v$e,this.props)}}])}(fe.Component);mj(fj,"displayName","ReferenceLine");mj(fj,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function DD(){return DD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},DD.apply(this,arguments)}function Sf(e){"@babel/helpers - typeof";return Sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Sf(e)}function Y9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function q9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Y9(Object(a),!0).forEach(function(o){kT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function y$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,qee(o.key),o)}}function b$e(e,n,a){return n&&_$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function E$e(e,n,a){return n=uw(n),x$e(e,Yee()?Reflect.construct(n,a||[],uw(e).constructor):n.apply(e,a))}function x$e(e,n){if(n&&(Sf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S$e(e)}function S$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yee=function(){return!!e})()}function uw(e){return uw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},uw(e)}function w$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&kD(e,n)}function kD(e,n){return kD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},kD(e,n)}function kT(e,n,a){return n=qee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function qee(e){var n=T$e(e,"string");return Sf(n)=="symbol"?n:n+""}function T$e(e,n){if(Sf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Sf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var C$e=function(n){var a=n.x,o=n.y,d=n.xAxis,p=n.yAxis,f=lj({x:d.scale,y:p.scale}),v=f.apply({x:a,y:o},{bandAware:!0});return Hc(n,"discard")&&!f.isInRange(v)?null:v},jT=function(e){function n(){return y$e(this,n),E$e(this,n,arguments)}return w$e(n,e),b$e(n,[{key:"render",value:function(){var o=this.props,d=o.x,p=o.y,f=o.r,v=o.alwaysShow,b=o.clipPathId,E=Ei(d),T=Ei(p);if(Tl(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!E||!T)return null;var w=C$e(this.props);if(!w)return null;var N=w.x,P=w.y,A=this.props,k=A.shape,I=A.className,F=Hc(this.props,"hidden")?"url(#".concat(b,")"):void 0,U=q9(q9({clipPath:F},yn(this.props,!0)),{},{cx:N,cy:P});return fe.createElement(mr,{className:On("recharts-reference-dot",I)},n.renderDot(k,U),da.renderCallByParent(this.props,{x:N-f,y:P-f,width:2*f,height:2*f}))}}])}(fe.Component);kT(jT,"displayName","ReferenceDot");kT(jT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});kT(jT,"renderDot",function(e,n){var a;return fe.isValidElement(e)?a=fe.cloneElement(e,n):pn(e)?a=e(n):a=fe.createElement(IT,DD({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),a});function jD(){return jD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},jD.apply(this,arguments)}function wf(e){"@babel/helpers - typeof";return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wf(e)}function X9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function J9(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?X9(Object(a),!0).forEach(function(o){LT(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function N$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function R$e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Jee(o.key),o)}}function A$e(e,n,a){return n&&R$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function I$e(e,n,a){return n=hw(n),O$e(e,Xee()?Reflect.construct(n,a||[],hw(e).constructor):n.apply(e,a))}function O$e(e,n){if(n&&(wf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return P$e(e)}function P$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xee=function(){return!!e})()}function hw(e){return hw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},hw(e)}function D$e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&LD(e,n)}function LD(e,n){return LD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},LD(e,n)}function LT(e,n,a){return n=Jee(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function Jee(e){var n=k$e(e,"string");return wf(n)=="symbol"?n:n+""}function k$e(e,n){if(wf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(wf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var j$e=function(n,a,o,d,p){var f=p.x1,v=p.x2,b=p.y1,E=p.y2,T=p.xAxis,w=p.yAxis;if(!T||!w)return null;var N=lj({x:T.scale,y:w.scale}),P={x:n?N.x.apply(f,{position:"start"}):N.x.rangeMin,y:o?N.y.apply(b,{position:"start"}):N.y.rangeMin},A={x:a?N.x.apply(v,{position:"end"}):N.x.rangeMax,y:d?N.y.apply(E,{position:"end"}):N.y.rangeMax};return Hc(p,"discard")&&(!N.isInRange(P)||!N.isInRange(A))?null:Mee(P,A)},MT=function(e){function n(){return N$e(this,n),I$e(this,n,arguments)}return D$e(n,e),A$e(n,[{key:"render",value:function(){var o=this.props,d=o.x1,p=o.x2,f=o.y1,v=o.y2,b=o.className,E=o.alwaysShow,T=o.clipPathId;Tl(E===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var w=Ei(d),N=Ei(p),P=Ei(f),A=Ei(v),k=this.props.shape;if(!w&&!N&&!P&&!A&&!k)return null;var I=j$e(w,N,P,A,this.props);if(!I&&!k)return null;var F=Hc(this.props,"hidden")?"url(#".concat(T,")"):void 0;return fe.createElement(mr,{className:On("recharts-reference-area",b)},n.renderRect(k,J9(J9({clipPath:F},yn(this.props,!0)),I)),da.renderCallByParent(this.props,I))}}])}(fe.Component);LT(MT,"displayName","ReferenceArea");LT(MT,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});LT(MT,"renderRect",function(e,n){var a;return fe.isValidElement(e)?a=fe.cloneElement(e,n):pn(e)?a=e(n):a=fe.createElement(cj,jD({},n,{className:"recharts-reference-area-rect"})),a});function Qee(e,n,a){if(n<1)return[];if(n===1&&a===void 0)return e;for(var o=[],d=0;d<e.length;d+=n)o.push(e[d]);return o}function L$e(e,n,a){var o={width:e.width+n.width,height:e.height+n.height};return IWe(o,a)}function M$e(e,n,a){var o=a==="width",d=e.x,p=e.y,f=e.width,v=e.height;return n===1?{start:o?d:p,end:o?d+f:p+v}:{start:o?d+f:p+v,end:o?d:p}}function pw(e,n,a,o,d){if(e*n<e*o||e*n>e*d)return!1;var p=a();return e*(n-e*p/2-o)>=0&&e*(n+e*p/2-d)<=0}function U$e(e,n){return Qee(e,n+1)}function F$e(e,n,a,o,d){for(var p=(o||[]).slice(),f=n.start,v=n.end,b=0,E=1,T=f,w=function(){var A=o==null?void 0:o[b];if(A===void 0)return{v:Qee(o,E)};var k=b,I,F=function(){return I===void 0&&(I=a(A,k)),I},U=A.coordinate,V=b===0||pw(e,U,F,T,v);V||(b=0,T=f,E+=1),V&&(T=U+e*(F()/2+d),b+=E)},N;E<=p.length;)if(N=w(),N)return N.v;return[]}function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},y0(e)}function Q9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ca(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Q9(Object(a),!0).forEach(function(o){V$e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Q9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function V$e(e,n,a){return n=B$e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function B$e(e){var n=G$e(e,"string");return y0(n)=="symbol"?n:n+""}function G$e(e,n){if(y0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(y0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function W$e(e,n,a,o,d){for(var p=(o||[]).slice(),f=p.length,v=n.start,b=n.end,E=function(N){var P=p[N],A,k=function(){return A===void 0&&(A=a(P,N)),A};if(N===f-1){var I=e*(P.coordinate+e*k()/2-b);p[N]=P=ca(ca({},P),{},{tickCoord:I>0?P.coordinate-I*e:P.coordinate})}else p[N]=P=ca(ca({},P),{},{tickCoord:P.coordinate});var F=pw(e,P.tickCoord,k,v,b);F&&(b=P.tickCoord-e*(k()/2+d),p[N]=ca(ca({},P),{},{isShow:!0}))},T=f-1;T>=0;T--)E(T);return p}function $$e(e,n,a,o,d,p){var f=(o||[]).slice(),v=f.length,b=n.start,E=n.end;if(p){var T=o[v-1],w=a(T,v-1),N=e*(T.coordinate+e*w/2-E);f[v-1]=T=ca(ca({},T),{},{tickCoord:N>0?T.coordinate-N*e:T.coordinate});var P=pw(e,T.tickCoord,function(){return w},b,E);P&&(E=T.tickCoord-e*(w/2+d),f[v-1]=ca(ca({},T),{},{isShow:!0}))}for(var A=p?v-1:v,k=function(U){var V=f[U],W,B=function(){return W===void 0&&(W=a(V,U)),W};if(U===0){var z=e*(V.coordinate-e*B()/2-b);f[U]=V=ca(ca({},V),{},{tickCoord:z<0?V.coordinate-z*e:V.coordinate})}else f[U]=V=ca(ca({},V),{},{tickCoord:V.coordinate});var Y=pw(e,V.tickCoord,B,b,E);Y&&(b=V.tickCoord+e*(B()/2+d),f[U]=ca(ca({},V),{},{isShow:!0}))},I=0;I<A;I++)k(I);return f}function gj(e,n,a){var o=e.tick,d=e.ticks,p=e.viewBox,f=e.minTickGap,v=e.orientation,b=e.interval,E=e.tickFormatter,T=e.unit,w=e.angle;if(!d||!d.length||!o)return[];if(ct(b)||Hh.isSsr)return U$e(d,typeof b=="number"&&ct(b)?b:0);var N=[],P=v==="top"||v==="bottom"?"width":"height",A=T&&P==="width"?fy(T,{fontSize:n,letterSpacing:a}):{width:0,height:0},k=function(V,W){var B=pn(E)?E(V.value,W):V.value;return P==="width"?L$e(fy(B,{fontSize:n,letterSpacing:a}),A,w):fy(B,{fontSize:n,letterSpacing:a})[P]},I=d.length>=2?Zo(d[1].coordinate-d[0].coordinate):1,F=M$e(p,I,P);return b==="equidistantPreserveStart"?F$e(I,F,k,d,f):(b==="preserveStart"||b==="preserveStartEnd"?N=$$e(I,F,k,d,f,b==="preserveStartEnd"):N=W$e(I,F,k,d,f),N.filter(function(U){return U.isShow}))}var H$e=["viewBox"],z$e=["viewBox"],K$e=["ticks"];function Tf(e){"@babel/helpers - typeof";return Tf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Tf(e)}function Um(){return Um=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Um.apply(this,arguments)}function Z9(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function fi(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Z9(Object(a),!0).forEach(function(o){vj(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z9(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function o1(e,n){if(e==null)return{};var a=Y$e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Y$e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function q$e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function eY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ete(o.key),o)}}function X$e(e,n,a){return n&&eY(e.prototype,n),a&&eY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function J$e(e,n,a){return n=mw(n),Q$e(e,Zee()?Reflect.construct(n,a||[],mw(e).constructor):n.apply(e,a))}function Q$e(e,n){if(n&&(Tf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Z$e(e)}function Z$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zee=function(){return!!e})()}function mw(e){return mw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},mw(e)}function eHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&MD(e,n)}function MD(e,n){return MD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},MD(e,n)}function vj(e,n,a){return n=ete(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ete(e){var n=tHe(e,"string");return Tf(n)=="symbol"?n:n+""}function tHe(e,n){if(Tf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Tf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ng=function(e){function n(a){var o;return q$e(this,n),o=J$e(this,n,[a]),o.state={fontSize:"",letterSpacing:""},o}return eHe(n,e),X$e(n,[{key:"shouldComponentUpdate",value:function(o,d){var p=o.viewBox,f=o1(o,H$e),v=this.props,b=v.viewBox,E=o1(v,z$e);return!zm(p,b)||!zm(f,E)||!zm(d,this.state)}},{key:"componentDidMount",value:function(){var o=this.layerReference;if(o){var d=o.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];d&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}},{key:"getTickLineCoord",value:function(o){var d=this.props,p=d.x,f=d.y,v=d.width,b=d.height,E=d.orientation,T=d.tickSize,w=d.mirror,N=d.tickMargin,P,A,k,I,F,U,V=w?-1:1,W=o.tickSize||T,B=ct(o.tickCoord)?o.tickCoord:o.coordinate;switch(E){case"top":P=A=o.coordinate,I=f+ +!w*b,k=I-V*W,U=k-V*N,F=B;break;case"left":k=I=o.coordinate,A=p+ +!w*v,P=A-V*W,F=P-V*N,U=B;break;case"right":k=I=o.coordinate,A=p+ +w*v,P=A+V*W,F=P+V*N,U=B;break;default:P=A=o.coordinate,I=f+ +w*b,k=I+V*W,U=k+V*N,F=B;break}return{line:{x1:P,y1:k,x2:A,y2:I},tick:{x:F,y:U}}}},{key:"getTickTextAnchor",value:function(){var o=this.props,d=o.orientation,p=o.mirror,f;switch(d){case"left":f=p?"start":"end";break;case"right":f=p?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var o=this.props,d=o.orientation,p=o.mirror,f="end";switch(d){case"left":case"right":f="middle";break;case"top":f=p?"start":"end";break;default:f=p?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.x,p=o.y,f=o.width,v=o.height,b=o.orientation,E=o.mirror,T=o.axisLine,w=fi(fi(fi({},yn(this.props,!1)),yn(T,!1)),{},{fill:"none"});if(b==="top"||b==="bottom"){var N=+(b==="top"&&!E||b==="bottom"&&E);w=fi(fi({},w),{},{x1:d,y1:p+N*v,x2:d+f,y2:p+N*v})}else{var P=+(b==="left"&&!E||b==="right"&&E);w=fi(fi({},w),{},{x1:d+P*f,y1:p,x2:d+P*f,y2:p+v})}return fe.createElement("line",Um({},w,{className:On("recharts-cartesian-axis-line",po(T,"className"))}))}},{key:"renderTicks",value:function(o,d,p){var f=this,v=this.props,b=v.tickLine,E=v.stroke,T=v.tick,w=v.tickFormatter,N=v.unit,P=gj(fi(fi({},this.props),{},{ticks:o}),d,p),A=this.getTickTextAnchor(),k=this.getTickVerticalAnchor(),I=yn(this.props,!1),F=yn(T,!1),U=fi(fi({},I),{},{fill:"none"},yn(b,!1)),V=P.map(function(W,B){var z=f.getTickLineCoord(W),Y=z.line,re=z.tick,Z=fi(fi(fi(fi({textAnchor:A,verticalAnchor:k},I),{},{stroke:"none",fill:E},F),re),{},{index:B,payload:W,visibleTicksCount:P.length,tickFormatter:w});return fe.createElement(mr,Um({className:"recharts-cartesian-axis-tick",key:"tick-".concat(W.value,"-").concat(W.coordinate,"-").concat(W.tickCoord)},bS(f.props,W,B)),b&&fe.createElement("line",Um({},U,Y,{className:On("recharts-cartesian-axis-tick-line",po(b,"className"))})),T&&n.renderTickItem(T,Z,"".concat(pn(w)?w(W.value,B):W.value).concat(N||"")))});return fe.createElement("g",{className:"recharts-cartesian-axis-ticks"},V)}},{key:"render",value:function(){var o=this,d=this.props,p=d.axisLine,f=d.width,v=d.height,b=d.ticksGenerator,E=d.className,T=d.hide;if(T)return null;var w=this.props,N=w.ticks,P=o1(w,K$e),A=N;return pn(b)&&(A=N&&N.length>0?b(this.props):b(P)),f<=0||v<=0||!A||!A.length?null:fe.createElement(mr,{className:On("recharts-cartesian-axis",E),ref:function(I){o.layerReference=I}},p&&this.renderAxisLine(),this.renderTicks(A,this.state.fontSize,this.state.letterSpacing),da.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(o,d,p){var f,v=On(d.className,"recharts-cartesian-axis-tick-value");return fe.isValidElement(o)?f=fe.cloneElement(o,fi(fi({},d),{},{className:v})):pn(o)?f=o(fi(fi({},d),{},{className:v})):f=fe.createElement(jS,Um({},d,{className:"recharts-cartesian-axis-tick-value"}),p),f}}])}(q.Component);vj(ng,"displayName","CartesianAxis");vj(ng,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var nHe=["x1","y1","x2","y2","key"],rHe=["offset"];function Bh(e){"@babel/helpers - typeof";return Bh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bh(e)}function tY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ua(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?tY(Object(a),!0).forEach(function(o){iHe(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function iHe(e,n,a){return n=aHe(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function aHe(e){var n=sHe(e,"string");return Bh(n)=="symbol"?n:n+""}function sHe(e,n){if(Bh(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Bh(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function xh(){return xh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},xh.apply(this,arguments)}function nY(e,n){if(e==null)return{};var a=oHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function oHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}var cHe=function(n){var a=n.fill;if(!a||a==="none")return null;var o=n.fillOpacity,d=n.x,p=n.y,f=n.width,v=n.height,b=n.ry;return fe.createElement("rect",{x:d,y:p,ry:b,width:f,height:v,stroke:"none",fill:a,fillOpacity:o,className:"recharts-cartesian-grid-bg"})};function tte(e,n){var a;if(fe.isValidElement(e))a=fe.cloneElement(e,n);else if(pn(e))a=e(n);else{var o=n.x1,d=n.y1,p=n.x2,f=n.y2,v=n.key,b=nY(n,nHe),E=yn(b,!1);E.offset;var T=nY(E,rHe);a=fe.createElement("line",xh({},T,{x1:o,y1:d,x2:p,y2:f,fill:"none",key:v}))}return a}function lHe(e){var n=e.x,a=e.width,o=e.horizontal,d=o===void 0?!0:o,p=e.horizontalPoints;if(!d||!p||!p.length)return null;var f=p.map(function(v,b){var E=ua(ua({},e),{},{x1:n,y1:v,x2:n+a,y2:v,key:"line-".concat(b),index:b});return tte(d,E)});return fe.createElement("g",{className:"recharts-cartesian-grid-horizontal"},f)}function dHe(e){var n=e.y,a=e.height,o=e.vertical,d=o===void 0?!0:o,p=e.verticalPoints;if(!d||!p||!p.length)return null;var f=p.map(function(v,b){var E=ua(ua({},e),{},{x1:v,y1:n,x2:v,y2:n+a,key:"line-".concat(b),index:b});return tte(d,E)});return fe.createElement("g",{className:"recharts-cartesian-grid-vertical"},f)}function uHe(e){var n=e.horizontalFill,a=e.fillOpacity,o=e.x,d=e.y,p=e.width,f=e.height,v=e.horizontalPoints,b=e.horizontal,E=b===void 0?!0:b;if(!E||!n||!n.length)return null;var T=v.map(function(N){return Math.round(N+d-d)}).sort(function(N,P){return N-P});d!==T[0]&&T.unshift(0);var w=T.map(function(N,P){var A=!T[P+1],k=A?d+f-N:T[P+1]-N;if(k<=0)return null;var I=P%n.length;return fe.createElement("rect",{key:"react-".concat(P),y:N,x:o,height:k,width:p,stroke:"none",fill:n[I],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return fe.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},w)}function hHe(e){var n=e.vertical,a=n===void 0?!0:n,o=e.verticalFill,d=e.fillOpacity,p=e.x,f=e.y,v=e.width,b=e.height,E=e.verticalPoints;if(!a||!o||!o.length)return null;var T=E.map(function(N){return Math.round(N+p-p)}).sort(function(N,P){return N-P});p!==T[0]&&T.unshift(0);var w=T.map(function(N,P){var A=!T[P+1],k=A?p+v-N:T[P+1]-N;if(k<=0)return null;var I=P%o.length;return fe.createElement("rect",{key:"react-".concat(P),x:N,y:f,width:k,height:b,stroke:"none",fill:o[I],fillOpacity:d,className:"recharts-cartesian-grid-bg"})});return fe.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},w)}var pHe=function(n,a){var o=n.xAxis,d=n.width,p=n.height,f=n.offset;return dee(gj(ua(ua(ua({},ng.defaultProps),o),{},{ticks:xl(o,!0),viewBox:{x:0,y:0,width:d,height:p}})),f.left,f.left+f.width,a)},mHe=function(n,a){var o=n.yAxis,d=n.width,p=n.height,f=n.offset;return dee(gj(ua(ua(ua({},ng.defaultProps),o),{},{ticks:xl(o,!0),viewBox:{x:0,y:0,width:d,height:p}})),f.top,f.top+f.height,a)},bm={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function _0(e){var n,a,o,d,p,f,v=hj(),b=pj(),E=t$e(),T=ua(ua({},e),{},{stroke:(n=e.stroke)!==null&&n!==void 0?n:bm.stroke,fill:(a=e.fill)!==null&&a!==void 0?a:bm.fill,horizontal:(o=e.horizontal)!==null&&o!==void 0?o:bm.horizontal,horizontalFill:(d=e.horizontalFill)!==null&&d!==void 0?d:bm.horizontalFill,vertical:(p=e.vertical)!==null&&p!==void 0?p:bm.vertical,verticalFill:(f=e.verticalFill)!==null&&f!==void 0?f:bm.verticalFill,x:ct(e.x)?e.x:E.left,y:ct(e.y)?e.y:E.top,width:ct(e.width)?e.width:E.width,height:ct(e.height)?e.height:E.height}),w=T.x,N=T.y,P=T.width,A=T.height,k=T.syncWithTicks,I=T.horizontalValues,F=T.verticalValues,U=QWe(),V=ZWe();if(!ct(P)||P<=0||!ct(A)||A<=0||!ct(w)||w!==+w||!ct(N)||N!==+N)return null;var W=T.verticalCoordinatesGenerator||pHe,B=T.horizontalCoordinatesGenerator||mHe,z=T.horizontalPoints,Y=T.verticalPoints;if((!z||!z.length)&&pn(B)){var re=I&&I.length,Z=B({yAxis:V?ua(ua({},V),{},{ticks:re?I:V.ticks}):void 0,width:v,height:b,offset:E},re?!0:k);Tl(Array.isArray(Z),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(Z),"]")),Array.isArray(Z)&&(z=Z)}if((!Y||!Y.length)&&pn(W)){var ie=F&&F.length,te=W({xAxis:U?ua(ua({},U),{},{ticks:ie?F:U.ticks}):void 0,width:v,height:b,offset:E},ie?!0:k);Tl(Array.isArray(te),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Bh(te),"]")),Array.isArray(te)&&(Y=te)}return fe.createElement("g",{className:"recharts-cartesian-grid"},fe.createElement(cHe,{fill:T.fill,fillOpacity:T.fillOpacity,x:T.x,y:T.y,width:T.width,height:T.height,ry:T.ry}),fe.createElement(lHe,xh({},T,{offset:E,horizontalPoints:z,xAxis:U,yAxis:V})),fe.createElement(dHe,xh({},T,{offset:E,verticalPoints:Y,xAxis:U,yAxis:V})),fe.createElement(uHe,xh({},T,{horizontalPoints:z})),fe.createElement(hHe,xh({},T,{verticalPoints:Y})))}_0.displayName="CartesianGrid";var fHe=["type","layout","connectNulls","ref"],gHe=["key"];function Cf(e){"@babel/helpers - typeof";return Cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cf(e)}function rY(e,n){if(e==null)return{};var a=vHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function vHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function _y(){return _y=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},_y.apply(this,arguments)}function iY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function ys(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?iY(Object(a),!0).forEach(function(o){Xo(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):iY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Em(e){return EHe(e)||bHe(e)||_He(e)||yHe()}function yHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _He(e,n){if(e){if(typeof e=="string")return UD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return UD(e,n)}}function bHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function EHe(e){if(Array.isArray(e))return UD(e)}function UD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function xHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function aY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,rte(o.key),o)}}function SHe(e,n,a){return n&&aY(e.prototype,n),a&&aY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function wHe(e,n,a){return n=fw(n),THe(e,nte()?Reflect.construct(n,a||[],fw(e).constructor):n.apply(e,a))}function THe(e,n){if(n&&(Cf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CHe(e)}function CHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nte=function(){return!!e})()}function fw(e){return fw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},fw(e)}function NHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&FD(e,n)}function FD(e,n){return FD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},FD(e,n)}function Xo(e,n,a){return n=rte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function rte(e){var n=RHe(e,"string");return Cf(n)=="symbol"?n:n+""}function RHe(e,n){if(Cf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Cf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var rg=function(e){function n(){var a;xHe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=wHe(this,n,[].concat(d)),Xo(a,"state",{isAnimationFinished:!0,totalLength:0}),Xo(a,"generateSimpleStrokeDasharray",function(f,v){return"".concat(v,"px ").concat(f-v,"px")}),Xo(a,"getStrokeDasharray",function(f,v,b){var E=b.reduce(function(F,U){return F+U});if(!E)return a.generateSimpleStrokeDasharray(v,f);for(var T=Math.floor(f/E),w=f%E,N=v-f,P=[],A=0,k=0;A<b.length;k+=b[A],++A)if(k+b[A]>w){P=[].concat(Em(b.slice(0,A)),[w-k]);break}var I=P.length%2===0?[0,N]:[N];return[].concat(Em(n.repeat(b,T)),Em(P),I).map(function(F){return"".concat(F,"px")}).join(", ")}),Xo(a,"id",qf("recharts-line-")),Xo(a,"pathRef",function(f){a.mainCurve=f}),Xo(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),Xo(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return NHe(n,e),SHe(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();this.setState({totalLength:o})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();o!==this.state.totalLength&&this.setState({totalLength:o})}}},{key:"getTotalLength",value:function(){var o=this.mainCurve;try{return o&&o.getTotalLength&&o.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var p=this.props,f=p.points,v=p.xAxis,b=p.yAxis,E=p.layout,T=p.children,w=mo(T,B0);if(!w)return null;var N=function(k,I){return{x:k.x,y:k.y,value:k.value,errorVal:Ia(k.payload,I)}},P={clipPath:o?"url(#clipPath-".concat(d,")"):null};return fe.createElement(mr,P,w.map(function(A){return fe.cloneElement(A,{key:"bar-".concat(A.props.dataKey),data:f,xAxis:v,yAxis:b,layout:E,dataPointFormatter:N})}))}},{key:"renderDots",value:function(o,d,p){var f=this.props.isAnimationActive;if(f&&!this.state.isAnimationFinished)return null;var v=this.props,b=v.dot,E=v.points,T=v.dataKey,w=yn(this.props,!1),N=yn(b,!0),P=E.map(function(k,I){var F=ys(ys(ys({key:"dot-".concat(I),r:3},w),N),{},{index:I,cx:k.x,cy:k.y,value:k.value,dataKey:T,payload:k.payload,points:E});return n.renderDotItem(b,F)}),A={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(p,")"):null};return fe.createElement(mr,_y({className:"recharts-line-dots",key:"dots"},A),P)}},{key:"renderCurveStatically",value:function(o,d,p,f){var v=this.props,b=v.type,E=v.layout,T=v.connectNulls;v.ref;var w=rY(v,fHe),N=ys(ys(ys({},yn(w,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:d?"url(#clipPath-".concat(p,")"):null,points:o},f),{},{type:b,layout:E,connectNulls:T});return fe.createElement(Xm,_y({},N,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(o,d){var p=this,f=this.props,v=f.points,b=f.strokeDasharray,E=f.isAnimationActive,T=f.animationBegin,w=f.animationDuration,N=f.animationEasing,P=f.animationId,A=f.animateNewValues,k=f.width,I=f.height,F=this.state,U=F.prevPoints,V=F.totalLength;return fe.createElement(qc,{begin:T,duration:w,isActive:E,easing:N,from:{t:0},to:{t:1},key:"line-".concat(P),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(W){var B=W.t;if(U){var z=U.length/v.length,Y=v.map(function(de,xe){var me=Math.floor(xe*z);if(U[me]){var Ce=U[me],ue=Yi(Ce.x,de.x),be=Yi(Ce.y,de.y);return ys(ys({},de),{},{x:ue(B),y:be(B)})}if(A){var se=Yi(k*2,de.x),pe=Yi(I/2,de.y);return ys(ys({},de),{},{x:se(B),y:pe(B)})}return ys(ys({},de),{},{x:de.x,y:de.y})});return p.renderCurveStatically(Y,o,d)}var re=Yi(0,V),Z=re(B),ie;if(b){var te="".concat(b).split(/[,\s]+/gim).map(function(de){return parseFloat(de)});ie=p.getStrokeDasharray(Z,V,te)}else ie=p.generateSimpleStrokeDasharray(V,Z);return p.renderCurveStatically(v,o,d,{strokeDasharray:ie})})}},{key:"renderCurve",value:function(o,d){var p=this.props,f=p.points,v=p.isAnimationActive,b=this.state,E=b.prevPoints,T=b.totalLength;return v&&f&&f.length&&(!E&&T>0||!gf(E,f))?this.renderCurveWithAnimation(o,d):this.renderCurveStatically(f,o,d)}},{key:"render",value:function(){var o,d=this.props,p=d.hide,f=d.dot,v=d.points,b=d.className,E=d.xAxis,T=d.yAxis,w=d.top,N=d.left,P=d.width,A=d.height,k=d.isAnimationActive,I=d.id;if(p||!v||!v.length)return null;var F=this.state.isAnimationFinished,U=v.length===1,V=On("recharts-line",b),W=E&&E.allowDataOverflow,B=T&&T.allowDataOverflow,z=W||B,Y=bn(I)?this.id:I,re=(o=yn(f,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},Z=re.r,ie=Z===void 0?3:Z,te=re.strokeWidth,de=te===void 0?2:te,xe=nQ(f)?f:{},me=xe.clipDot,Ce=me===void 0?!0:me,ue=ie*2+de;return fe.createElement(mr,{className:V},W||B?fe.createElement("defs",null,fe.createElement("clipPath",{id:"clipPath-".concat(Y)},fe.createElement("rect",{x:W?N:N-P/2,y:B?w:w-A/2,width:W?P:P*2,height:B?A:A*2})),!Ce&&fe.createElement("clipPath",{id:"clipPath-dots-".concat(Y)},fe.createElement("rect",{x:N-ue/2,y:w-ue/2,width:P+ue,height:A+ue}))):null,!U&&this.renderCurve(z,Y),this.renderErrorBar(z,Y),(U||f)&&this.renderDots(z,Ce,Y),(!k||F)&&Nl.renderCallByParent(this.props,v))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:d.curPoints}:o.points!==d.curPoints?{curPoints:o.points}:null}},{key:"repeat",value:function(o,d){for(var p=o.length%2!==0?[].concat(Em(o),[0]):o,f=[],v=0;v<d;++v)f=[].concat(Em(f),Em(p));return f}},{key:"renderDotItem",value:function(o,d){var p;if(fe.isValidElement(o))p=fe.cloneElement(o,d);else if(pn(o))p=o(d);else{var f=d.key,v=rY(d,gHe),b=On("recharts-line-dot",typeof o!="boolean"?o.className:"");p=fe.createElement(IT,_y({key:f},v,{className:b}))}return p}}])}(q.PureComponent);Xo(rg,"displayName","Line");Xo(rg,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Hh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Xo(rg,"getComposedData",function(e){var n=e.props,a=e.xAxis,o=e.yAxis,d=e.xAxisTicks,p=e.yAxisTicks,f=e.dataKey,v=e.bandSize,b=e.displayedData,E=e.offset,T=n.layout,w=b.map(function(N,P){var A=Ia(N,f);return T==="horizontal"?{x:qS({axis:a,ticks:d,bandSize:v,entry:N,index:P}),y:bn(A)?null:o.scale(A),value:A,payload:N}:{x:bn(A)?null:a.scale(A),y:qS({axis:o,ticks:p,bandSize:v,entry:N,index:P}),value:A,payload:N}});return ys({points:w,layout:T},E)});var AHe=["layout","type","stroke","connectNulls","isRange","ref"],IHe=["key"],ite;function Nf(e){"@babel/helpers - typeof";return Nf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Nf(e)}function ate(e,n){if(e==null)return{};var a=OHe(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function OHe(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function Sh(){return Sh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Sh.apply(this,arguments)}function sY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function xd(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?sY(Object(a),!0).forEach(function(o){Vc(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function PHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function oY(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ote(o.key),o)}}function DHe(e,n,a){return n&&oY(e.prototype,n),a&&oY(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function kHe(e,n,a){return n=gw(n),jHe(e,ste()?Reflect.construct(n,a||[],gw(e).constructor):n.apply(e,a))}function jHe(e,n){if(n&&(Nf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LHe(e)}function LHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ste(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ste=function(){return!!e})()}function gw(e){return gw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},gw(e)}function MHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&VD(e,n)}function VD(e,n){return VD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},VD(e,n)}function Vc(e,n,a){return n=ote(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function ote(e){var n=UHe(e,"string");return Nf(n)=="symbol"?n:n+""}function UHe(e,n){if(Nf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Nf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Gl=function(e){function n(){var a;PHe(this,n);for(var o=arguments.length,d=new Array(o),p=0;p<o;p++)d[p]=arguments[p];return a=kHe(this,n,[].concat(d)),Vc(a,"state",{isAnimationFinished:!0}),Vc(a,"id",qf("recharts-area-")),Vc(a,"handleAnimationEnd",function(){var f=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),pn(f)&&f()}),Vc(a,"handleAnimationStart",function(){var f=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),pn(f)&&f()}),a}return MHe(n,e),DHe(n,[{key:"renderDots",value:function(o,d,p){var f=this.props.isAnimationActive,v=this.state.isAnimationFinished;if(f&&!v)return null;var b=this.props,E=b.dot,T=b.points,w=b.dataKey,N=yn(this.props,!1),P=yn(E,!0),A=T.map(function(I,F){var U=xd(xd(xd({key:"dot-".concat(F),r:3},N),P),{},{index:F,cx:I.x,cy:I.y,dataKey:w,value:I.value,payload:I.payload,points:T});return n.renderDotItem(E,U)}),k={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(p,")"):null};return fe.createElement(mr,Sh({className:"recharts-area-dots"},k),A)}},{key:"renderHorizontalRect",value:function(o){var d=this.props,p=d.baseLine,f=d.points,v=d.strokeWidth,b=f[0].x,E=f[f.length-1].x,T=o*Math.abs(b-E),w=kd(f.map(function(N){return N.y||0}));return ct(p)&&typeof p=="number"?w=Math.max(p,w):p&&Array.isArray(p)&&p.length&&(w=Math.max(kd(p.map(function(N){return N.y||0})),w)),ct(w)?fe.createElement("rect",{x:b<E?b:b-T,y:0,width:T,height:Math.floor(w+(v?parseInt("".concat(v),10):1))}):null}},{key:"renderVerticalRect",value:function(o){var d=this.props,p=d.baseLine,f=d.points,v=d.strokeWidth,b=f[0].y,E=f[f.length-1].y,T=o*Math.abs(b-E),w=kd(f.map(function(N){return N.x||0}));return ct(p)&&typeof p=="number"?w=Math.max(p,w):p&&Array.isArray(p)&&p.length&&(w=Math.max(kd(p.map(function(N){return N.x||0})),w)),ct(w)?fe.createElement("rect",{x:0,y:b<E?b:b-T,width:w+(v?parseInt("".concat(v),10):1),height:Math.floor(T)}):null}},{key:"renderClipRect",value:function(o){var d=this.props.layout;return d==="vertical"?this.renderVerticalRect(o):this.renderHorizontalRect(o)}},{key:"renderAreaStatically",value:function(o,d,p,f){var v=this.props,b=v.layout,E=v.type,T=v.stroke,w=v.connectNulls,N=v.isRange;v.ref;var P=ate(v,AHe);return fe.createElement(mr,{clipPath:p?"url(#clipPath-".concat(f,")"):null},fe.createElement(Xm,Sh({},yn(P,!0),{points:o,connectNulls:w,type:E,baseLine:d,layout:b,stroke:"none",className:"recharts-area-area"})),T!=="none"&&fe.createElement(Xm,Sh({},yn(this.props,!1),{className:"recharts-area-curve",layout:b,type:E,connectNulls:w,fill:"none",points:o})),T!=="none"&&N&&fe.createElement(Xm,Sh({},yn(this.props,!1),{className:"recharts-area-curve",layout:b,type:E,connectNulls:w,fill:"none",points:d})))}},{key:"renderAreaWithAnimation",value:function(o,d){var p=this,f=this.props,v=f.points,b=f.baseLine,E=f.isAnimationActive,T=f.animationBegin,w=f.animationDuration,N=f.animationEasing,P=f.animationId,A=this.state,k=A.prevPoints,I=A.prevBaseLine;return fe.createElement(qc,{begin:T,duration:w,isActive:E,easing:N,from:{t:0},to:{t:1},key:"area-".concat(P),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(F){var U=F.t;if(k){var V=k.length/v.length,W=v.map(function(re,Z){var ie=Math.floor(Z*V);if(k[ie]){var te=k[ie],de=Yi(te.x,re.x),xe=Yi(te.y,re.y);return xd(xd({},re),{},{x:de(U),y:xe(U)})}return re}),B;if(ct(b)&&typeof b=="number"){var z=Yi(I,b);B=z(U)}else if(bn(b)||Yf(b)){var Y=Yi(I,0);B=Y(U)}else B=b.map(function(re,Z){var ie=Math.floor(Z*V);if(I[ie]){var te=I[ie],de=Yi(te.x,re.x),xe=Yi(te.y,re.y);return xd(xd({},re),{},{x:de(U),y:xe(U)})}return re});return p.renderAreaStatically(W,B,o,d)}return fe.createElement(mr,null,fe.createElement("defs",null,fe.createElement("clipPath",{id:"animationClipPath-".concat(d)},p.renderClipRect(U))),fe.createElement(mr,{clipPath:"url(#animationClipPath-".concat(d,")")},p.renderAreaStatically(v,b,o,d)))})}},{key:"renderArea",value:function(o,d){var p=this.props,f=p.points,v=p.baseLine,b=p.isAnimationActive,E=this.state,T=E.prevPoints,w=E.prevBaseLine,N=E.totalLength;return b&&f&&f.length&&(!T&&N>0||!gf(T,f)||!gf(w,v))?this.renderAreaWithAnimation(o,d):this.renderAreaStatically(f,v,o,d)}},{key:"render",value:function(){var o,d=this.props,p=d.hide,f=d.dot,v=d.points,b=d.className,E=d.top,T=d.left,w=d.xAxis,N=d.yAxis,P=d.width,A=d.height,k=d.isAnimationActive,I=d.id;if(p||!v||!v.length)return null;var F=this.state.isAnimationFinished,U=v.length===1,V=On("recharts-area",b),W=w&&w.allowDataOverflow,B=N&&N.allowDataOverflow,z=W||B,Y=bn(I)?this.id:I,re=(o=yn(f,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},Z=re.r,ie=Z===void 0?3:Z,te=re.strokeWidth,de=te===void 0?2:te,xe=nQ(f)?f:{},me=xe.clipDot,Ce=me===void 0?!0:me,ue=ie*2+de;return fe.createElement(mr,{className:V},W||B?fe.createElement("defs",null,fe.createElement("clipPath",{id:"clipPath-".concat(Y)},fe.createElement("rect",{x:W?T:T-P/2,y:B?E:E-A/2,width:W?P:P*2,height:B?A:A*2})),!Ce&&fe.createElement("clipPath",{id:"clipPath-dots-".concat(Y)},fe.createElement("rect",{x:T-ue/2,y:E-ue/2,width:P+ue,height:A+ue}))):null,U?null:this.renderArea(z,Y),(f||U)&&this.renderDots(z,Ce,Y),(!k||F)&&Nl.renderCallByParent(this.props,v))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,curBaseLine:o.baseLine,prevPoints:d.curPoints,prevBaseLine:d.curBaseLine}:o.points!==d.curPoints||o.baseLine!==d.curBaseLine?{curPoints:o.points,curBaseLine:o.baseLine}:null}}])}(q.PureComponent);ite=Gl;Vc(Gl,"displayName","Area");Vc(Gl,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Hh.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Vc(Gl,"getBaseValue",function(e,n,a,o){var d=e.layout,p=e.baseValue,f=n.props.baseValue,v=f??p;if(ct(v)&&typeof v=="number")return v;var b=d==="horizontal"?o:a,E=b.scale.domain();if(b.type==="number"){var T=Math.max(E[0],E[1]),w=Math.min(E[0],E[1]);return v==="dataMin"?w:v==="dataMax"||T<0?T:Math.max(Math.min(E[0],E[1]),0)}return v==="dataMin"?E[0]:v==="dataMax"?E[1]:E[0]});Vc(Gl,"getComposedData",function(e){var n=e.props,a=e.item,o=e.xAxis,d=e.yAxis,p=e.xAxisTicks,f=e.yAxisTicks,v=e.bandSize,b=e.dataKey,E=e.stackedData,T=e.dataStartIndex,w=e.displayedData,N=e.offset,P=n.layout,A=E&&E.length,k=ite.getBaseValue(n,a,o,d),I=P==="horizontal",F=!1,U=w.map(function(W,B){var z;A?z=E[T+B]:(z=Ia(W,b),Array.isArray(z)?F=!0:z=[k,z]);var Y=z[1]==null||A&&Ia(W,b)==null;return I?{x:qS({axis:o,ticks:p,bandSize:v,entry:W,index:B}),y:Y?null:d.scale(z[1]),value:z,payload:W}:{x:Y?null:o.scale(z[1]),y:qS({axis:d,ticks:f,bandSize:v,entry:W,index:B}),value:z,payload:W}}),V;return A||F?V=U.map(function(W){var B=Array.isArray(W.value)?W.value[0]:null;return I?{x:W.x,y:B!=null&&W.y!=null?d.scale(B):null}:{x:B!=null?o.scale(B):null,y:W.y}}):V=I?d.scale(k):o.scale(k),xd({points:U,baseLine:V,layout:P,isRange:F},N)});Vc(Gl,"renderDotItem",function(e,n){var a;if(fe.isValidElement(e))a=fe.cloneElement(e,n);else if(pn(e))a=e(n);else{var o=On("recharts-area-dot",typeof e!="boolean"?e.className:""),d=n.key,p=ate(n,IHe);a=fe.createElement(IT,Sh({},p,{key:d,className:o}))}return a});function Rf(e){"@babel/helpers - typeof";return Rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Rf(e)}function FHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function VHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,dte(o.key),o)}}function BHe(e,n,a){return n&&VHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function GHe(e,n,a){return n=vw(n),WHe(e,cte()?Reflect.construct(n,a||[],vw(e).constructor):n.apply(e,a))}function WHe(e,n){if(n&&(Rf(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $He(e)}function $He(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cte=function(){return!!e})()}function vw(e){return vw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},vw(e)}function HHe(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&BD(e,n)}function BD(e,n){return BD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},BD(e,n)}function lte(e,n,a){return n=dte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function dte(e){var n=zHe(e,"string");return Rf(n)=="symbol"?n:n+""}function zHe(e,n){if(Rf(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Rf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function GD(){return GD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},GD.apply(this,arguments)}function KHe(e){var n=e.xAxisId,a=hj(),o=pj(),d=$ee(n);return d==null?null:q.createElement(ng,GD({},d,{className:On("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:a,height:o},ticksGenerator:function(f){return xl(f,!0)}}))}var Jd=function(e){function n(){return FHe(this,n),GHe(this,n,arguments)}return HHe(n,e),BHe(n,[{key:"render",value:function(){return q.createElement(KHe,this.props)}}])}(q.Component);lte(Jd,"displayName","XAxis");lte(Jd,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Af(e){"@babel/helpers - typeof";return Af=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Af(e)}function YHe(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function qHe(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,pte(o.key),o)}}function XHe(e,n,a){return n&&qHe(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function JHe(e,n,a){return n=yw(n),QHe(e,ute()?Reflect.construct(n,a||[],yw(e).constructor):n.apply(e,a))}function QHe(e,n){if(n&&(Af(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZHe(e)}function ZHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ute(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ute=function(){return!!e})()}function yw(e){return yw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},yw(e)}function e7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&WD(e,n)}function WD(e,n){return WD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},WD(e,n)}function hte(e,n,a){return n=pte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function pte(e){var n=t7e(e,"string");return Af(n)=="symbol"?n:n+""}function t7e(e,n){if(Af(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(Af(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function $D(){return $D=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},$D.apply(this,arguments)}var n7e=function(n){var a=n.yAxisId,o=hj(),d=pj(),p=Hee(a);return p==null?null:q.createElement(ng,$D({},p,{className:On("recharts-".concat(p.axisType," ").concat(p.axisType),p.className),viewBox:{x:0,y:0,width:o,height:d},ticksGenerator:function(v){return xl(v,!0)}}))},Qd=function(e){function n(){return YHe(this,n),JHe(this,n,arguments)}return e7e(n,e),XHe(n,[{key:"render",value:function(){return q.createElement(n7e,this.props)}}])}(q.Component);hte(Qd,"displayName","YAxis");hte(Qd,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function cY(e){return s7e(e)||a7e(e)||i7e(e)||r7e()}function r7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i7e(e,n){if(e){if(typeof e=="string")return HD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HD(e,n)}}function a7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function s7e(e){if(Array.isArray(e))return HD(e)}function HD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}var zD=function(n,a,o,d,p){var f=mo(n,fj),v=mo(n,jT),b=[].concat(cY(f),cY(v)),E=mo(n,MT),T="".concat(d,"Id"),w=d[0],N=a;if(b.length&&(N=b.reduce(function(k,I){if(I.props[T]===o&&Hc(I.props,"extendDomain")&&ct(I.props[w])){var F=I.props[w];return[Math.min(k[0],F),Math.max(k[1],F)]}return k},N)),E.length){var P="".concat(w,"1"),A="".concat(w,"2");N=E.reduce(function(k,I){if(I.props[T]===o&&Hc(I.props,"extendDomain")&&ct(I.props[P])&&ct(I.props[A])){var F=I.props[P],U=I.props[A];return[Math.min(k[0],F,U),Math.max(k[1],F,U)]}return k},N)}return p&&p.length&&(N=p.reduce(function(k,I){return ct(I)?[Math.min(k[0],I),Math.max(k[1],I)]:k},N)),N},mte={exports:{}};(function(e){var n=Object.prototype.hasOwnProperty,a="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(a=!1));function d(b,E,T){this.fn=b,this.context=E,this.once=T||!1}function p(b,E,T,w,N){if(typeof T!="function")throw new TypeError("The listener must be a function");var P=new d(T,w||b,N),A=a?a+E:E;return b._events[A]?b._events[A].fn?b._events[A]=[b._events[A],P]:b._events[A].push(P):(b._events[A]=P,b._eventsCount++),b}function f(b,E){--b._eventsCount===0?b._events=new o:delete b._events[E]}function v(){this._events=new o,this._eventsCount=0}v.prototype.eventNames=function(){var E=[],T,w;if(this._eventsCount===0)return E;for(w in T=this._events)n.call(T,w)&&E.push(a?w.slice(1):w);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(T)):E},v.prototype.listeners=function(E){var T=a?a+E:E,w=this._events[T];if(!w)return[];if(w.fn)return[w.fn];for(var N=0,P=w.length,A=new Array(P);N<P;N++)A[N]=w[N].fn;return A},v.prototype.listenerCount=function(E){var T=a?a+E:E,w=this._events[T];return w?w.fn?1:w.length:0},v.prototype.emit=function(E,T,w,N,P,A){var k=a?a+E:E;if(!this._events[k])return!1;var I=this._events[k],F=arguments.length,U,V;if(I.fn){switch(I.once&&this.removeListener(E,I.fn,void 0,!0),F){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,T),!0;case 3:return I.fn.call(I.context,T,w),!0;case 4:return I.fn.call(I.context,T,w,N),!0;case 5:return I.fn.call(I.context,T,w,N,P),!0;case 6:return I.fn.call(I.context,T,w,N,P,A),!0}for(V=1,U=new Array(F-1);V<F;V++)U[V-1]=arguments[V];I.fn.apply(I.context,U)}else{var W=I.length,B;for(V=0;V<W;V++)switch(I[V].once&&this.removeListener(E,I[V].fn,void 0,!0),F){case 1:I[V].fn.call(I[V].context);break;case 2:I[V].fn.call(I[V].context,T);break;case 3:I[V].fn.call(I[V].context,T,w);break;case 4:I[V].fn.call(I[V].context,T,w,N);break;default:if(!U)for(B=1,U=new Array(F-1);B<F;B++)U[B-1]=arguments[B];I[V].fn.apply(I[V].context,U)}}return!0},v.prototype.on=function(E,T,w){return p(this,E,T,w,!1)},v.prototype.once=function(E,T,w){return p(this,E,T,w,!0)},v.prototype.removeListener=function(E,T,w,N){var P=a?a+E:E;if(!this._events[P])return this;if(!T)return f(this,P),this;var A=this._events[P];if(A.fn)A.fn===T&&(!N||A.once)&&(!w||A.context===w)&&f(this,P);else{for(var k=0,I=[],F=A.length;k<F;k++)(A[k].fn!==T||N&&!A[k].once||w&&A[k].context!==w)&&I.push(A[k]);I.length?this._events[P]=I.length===1?I[0]:I:f(this,P)}return this},v.prototype.removeAllListeners=function(E){var T;return E?(T=a?a+E:E,this._events[T]&&f(this,T)):(this._events=new o,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=a,v.EventEmitter=v,e.exports=v})(mte);var o7e=mte.exports;const c7e=ar(o7e);var c1=new c7e,l1="recharts.syncMouseEvents";function b0(e){"@babel/helpers - typeof";return b0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},b0(e)}function l7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function d7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fte(o.key),o)}}function u7e(e,n,a){return n&&d7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d1(e,n,a){return n=fte(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function fte(e){var n=h7e(e,"string");return b0(n)=="symbol"?n:n+""}function h7e(e,n){if(b0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(b0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var p7e=function(){function e(){l7e(this,e),d1(this,"activeIndex",0),d1(this,"coordinateList",[]),d1(this,"layout","horizontal")}return u7e(e,[{key:"setDetails",value:function(a){var o,d=a.coordinateList,p=d===void 0?null:d,f=a.container,v=f===void 0?null:f,b=a.layout,E=b===void 0?null:b,T=a.offset,w=T===void 0?null:T,N=a.mouseHandlerCallback,P=N===void 0?null:N;this.coordinateList=(o=p??this.coordinateList)!==null&&o!==void 0?o:[],this.container=v??this.container,this.layout=E??this.layout,this.offset=w??this.offset,this.mouseHandlerCallback=P??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(a){if(this.coordinateList.length!==0)switch(a.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(a){this.activeIndex=a}},{key:"spoofMouse",value:function(){var a,o;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var d=this.container.getBoundingClientRect(),p=d.x,f=d.y,v=d.height,b=this.coordinateList[this.activeIndex].coordinate,E=((a=window)===null||a===void 0?void 0:a.scrollX)||0,T=((o=window)===null||o===void 0?void 0:o.scrollY)||0,w=p+b+E,N=f+this.offset.top+v/2+T;this.mouseHandlerCallback({pageX:w,pageY:N})}}}])}();function m7e(e,n,a){if(a==="number"&&n===!0&&Array.isArray(e)){var o=e==null?void 0:e[0],d=e==null?void 0:e[1];if(o&&d&&ct(o)&&ct(d))return!0}return!1}function f7e(e,n,a,o){var d=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?n.x-d:a.left+.5,y:e==="horizontal"?a.top+.5:n.y-d,width:e==="horizontal"?o:a.width-1,height:e==="horizontal"?a.height-1:o}}function gte(e){var n=e.cx,a=e.cy,o=e.radius,d=e.startAngle,p=e.endAngle,f=qi(n,a,o,d),v=qi(n,a,o,p);return{points:[f,v],cx:n,cy:a,radius:o,startAngle:d,endAngle:p}}function g7e(e,n,a){var o,d,p,f;if(e==="horizontal")o=n.x,p=o,d=a.top,f=a.top+a.height;else if(e==="vertical")d=n.y,f=d,o=a.left,p=a.left+a.width;else if(n.cx!=null&&n.cy!=null)if(e==="centric"){var v=n.cx,b=n.cy,E=n.innerRadius,T=n.outerRadius,w=n.angle,N=qi(v,b,E,w),P=qi(v,b,T,w);o=N.x,d=N.y,p=P.x,f=P.y}else return gte(n);return[{x:o,y:d},{x:p,y:f}]}function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},E0(e)}function lY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function bx(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?lY(Object(a),!0).forEach(function(o){v7e(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):lY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function v7e(e,n,a){return n=y7e(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function y7e(e){var n=_7e(e,"string");return E0(n)=="symbol"?n:n+""}function _7e(e,n){if(E0(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(E0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function b7e(e){var n,a,o=e.element,d=e.tooltipEventType,p=e.isActive,f=e.activeCoordinate,v=e.activePayload,b=e.offset,E=e.activeTooltipIndex,T=e.tooltipAxisBandSize,w=e.layout,N=e.chartName,P=(n=o.props.cursor)!==null&&n!==void 0?n:(a=o.type.defaultProps)===null||a===void 0?void 0:a.cursor;if(!o||!P||!p||!f||N!=="ScatterChart"&&d!=="axis")return null;var A,k=Xm;if(N==="ScatterChart")A=f,k=d8e;else if(N==="BarChart")A=f7e(w,f,b,T),k=cj;else if(w==="radial"){var I=gte(f),F=I.cx,U=I.cy,V=I.radius,W=I.startAngle,B=I.endAngle;A={cx:F,cy:U,startAngle:W,endAngle:B,innerRadius:V,outerRadius:V},k=fee}else A={points:g7e(w,f,b)},k=Xm;var z=bx(bx(bx(bx({stroke:"#ccc",pointerEvents:"none"},b),A),yn(P,!1)),{},{payload:v,payloadIndex:E,className:On("recharts-tooltip-cursor",P.className)});return q.isValidElement(P)?q.cloneElement(P,z):q.createElement(k,z)}var E7e=["item"],x7e=["children","className","width","height","style","compact","title","desc"];function If(e){"@babel/helpers - typeof";return If=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},If(e)}function Fm(){return Fm=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},Fm.apply(this,arguments)}function dY(e,n){return T7e(e)||w7e(e,n)||yte(e,n)||S7e()}function S7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function w7e(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o,d,p,f,v=[],b=!0,E=!1;try{if(p=(a=a.call(e)).next,n!==0)for(;!(b=(o=p.call(a)).done)&&(v.push(o.value),v.length!==n);b=!0);}catch(T){E=!0,d=T}finally{try{if(!b&&a.return!=null&&(f=a.return(),Object(f)!==f))return}finally{if(E)throw d}}return v}}function T7e(e){if(Array.isArray(e))return e}function uY(e,n){if(e==null)return{};var a=C7e(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function C7e(e,n){if(e==null)return{};var a={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(n.indexOf(o)>=0)continue;a[o]=e[o]}return a}function N7e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function R7e(e,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_te(o.key),o)}}function A7e(e,n,a){return n&&R7e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function I7e(e,n,a){return n=_w(n),O7e(e,vte()?Reflect.construct(n,a||[],_w(e).constructor):n.apply(e,a))}function O7e(e,n){if(n&&(If(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return P7e(e)}function P7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vte(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vte=function(){return!!e})()}function _w(e){return _w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_w(e)}function D7e(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&KD(e,n)}function KD(e,n){return KD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KD(e,n)}function Of(e){return L7e(e)||j7e(e)||yte(e)||k7e()}function k7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yte(e,n){if(e){if(typeof e=="string")return YD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return YD(e,n)}}function j7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function L7e(e){if(Array.isArray(e))return YD(e)}function YD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function hY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Be(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?hY(Object(a),!0).forEach(function(o){Yt(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Yt(e,n,a){return n=_te(n),n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function _te(e){var n=M7e(e,"string");return If(n)=="symbol"?n:n+""}function M7e(e,n){if(If(e)!="object"||!e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var o=a.call(e,n);if(If(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}var U7e={xAxis:["bottom","top"],yAxis:["left","right"]},F7e={width:"100%",height:"100%"},bte={x:0,y:0};function Ex(e){return e}var V7e=function(n,a){return a==="horizontal"?n.x:a==="vertical"?n.y:a==="centric"?n.angle:n.radius},B7e=function(n,a,o,d){var p=a.find(function(T){return T&&T.index===o});if(p){if(n==="horizontal")return{x:p.coordinate,y:d.y};if(n==="vertical")return{x:d.x,y:p.coordinate};if(n==="centric"){var f=p.coordinate,v=d.radius;return Be(Be(Be({},d),qi(d.cx,d.cy,v,f)),{},{angle:f,radius:v})}var b=p.coordinate,E=d.angle;return Be(Be(Be({},d),qi(d.cx,d.cy,b,E)),{},{angle:E,radius:b})}return bte},UT=function(n,a){var o=a.graphicalItems,d=a.dataStartIndex,p=a.dataEndIndex,f=(o??[]).reduce(function(v,b){var E=b.props.data;return E&&E.length?[].concat(Of(v),Of(E)):v},[]);return f.length>0?f:n&&n.length&&ct(d)&&ct(p)?n.slice(d,p+1):[]};function Ete(e){return e==="number"?[0,"auto"]:void 0}var qD=function(n,a,o,d){var p=n.graphicalItems,f=n.tooltipAxis,v=UT(a,n);return o<0||!p||!p.length||o>=v.length?null:p.reduce(function(b,E){var T,w=(T=E.props.data)!==null&&T!==void 0?T:a;w&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=o&&(w=w.slice(n.dataStartIndex,n.dataEndIndex+1));var N;if(f.dataKey&&!f.allowDuplicatedCategory){var P=w===void 0?v:w;N=yS(P,f.dataKey,d)}else N=w&&w[o]||v[o];return N?[].concat(Of(b),[hee(E,N)]):b},[])},pY=function(n,a,o,d){var p=d||{x:n.chartX,y:n.chartY},f=V7e(p,o),v=n.orderedTooltipTicks,b=n.tooltipAxis,E=n.tooltipTicks,T=HFe(f,v,E,b);if(T>=0&&E){var w=E[T]&&E[T].value,N=qD(n,a,T,w),P=B7e(o,v,T,p);return{activeTooltipIndex:T,activeLabel:w,activePayload:N,activeCoordinate:P}}return null},G7e=function(n,a){var o=a.axes,d=a.graphicalItems,p=a.axisType,f=a.axisIdKey,v=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.layout,w=n.children,N=n.stackOffset,P=lee(T,p);return o.reduce(function(A,k){var I,F=k.type.defaultProps!==void 0?Be(Be({},k.type.defaultProps),k.props):k.props,U=F.type,V=F.dataKey,W=F.allowDataOverflow,B=F.allowDuplicatedCategory,z=F.scale,Y=F.ticks,re=F.includeHidden,Z=F[f];if(A[Z])return A;var ie=UT(n.data,{graphicalItems:d.filter(function(we){var qe,lt=f in we.props?we.props[f]:(qe=we.type.defaultProps)===null||qe===void 0?void 0:qe[f];return lt===Z}),dataStartIndex:b,dataEndIndex:E}),te=ie.length,de,xe,me;m7e(F.domain,W,U)&&(de=hD(F.domain,null,W),P&&(U==="number"||z!=="auto")&&(me=vy(ie,V,"category")));var Ce=Ete(U);if(!de||de.length===0){var ue,be=(ue=F.domain)!==null&&ue!==void 0?ue:Ce;if(V){if(de=vy(ie,V,U),U==="category"&&P){var se=DAe(de);B&&se?(xe=de,de=aw(0,te)):B||(de=WK(be,de,k).reduce(function(we,qe){return we.indexOf(qe)>=0?we:[].concat(Of(we),[qe])},[]))}else if(U==="category")B?de=de.filter(function(we){return we!==""&&!bn(we)}):de=WK(be,de,k).reduce(function(we,qe){return we.indexOf(qe)>=0||qe===""||bn(qe)?we:[].concat(Of(we),[qe])},[]);else if(U==="number"){var pe=XFe(ie,d.filter(function(we){var qe,lt,Ut=f in we.props?we.props[f]:(qe=we.type.defaultProps)===null||qe===void 0?void 0:qe[f],Ht="hide"in we.props?we.props.hide:(lt=we.type.defaultProps)===null||lt===void 0?void 0:lt.hide;return Ut===Z&&(re||!Ht)}),V,p,T);pe&&(de=pe)}P&&(U==="number"||z!=="auto")&&(me=vy(ie,V,"category"))}else P?de=aw(0,te):v&&v[Z]&&v[Z].hasStack&&U==="number"?de=N==="expand"?[0,1]:uee(v[Z].stackGroups,b,E):de=cee(ie,d.filter(function(we){var qe=f in we.props?we.props[f]:we.type.defaultProps[f],lt="hide"in we.props?we.props.hide:we.type.defaultProps.hide;return qe===Z&&(re||!lt)}),U,T,!0);if(U==="number")de=zD(w,de,Z,p,Y),be&&(de=hD(be,de,W));else if(U==="category"&&be){var De=be,Se=de.every(function(we){return De.indexOf(we)>=0});Se&&(de=De)}}return Be(Be({},A),{},Yt({},Z,Be(Be({},F),{},{axisType:p,domain:de,categoricalDomain:me,duplicateDomain:xe,originalDomain:(I=F.domain)!==null&&I!==void 0?I:Ce,isCategorical:P,layout:T})))},{})},W7e=function(n,a){var o=a.graphicalItems,d=a.Axis,p=a.axisType,f=a.axisIdKey,v=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.layout,w=n.children,N=UT(n.data,{graphicalItems:o,dataStartIndex:b,dataEndIndex:E}),P=N.length,A=lee(T,p),k=-1;return o.reduce(function(I,F){var U=F.type.defaultProps!==void 0?Be(Be({},F.type.defaultProps),F.props):F.props,V=U[f],W=Ete("number");if(!I[V]){k++;var B;return A?B=aw(0,P):v&&v[V]&&v[V].hasStack?(B=uee(v[V].stackGroups,b,E),B=zD(w,B,V,p)):(B=hD(W,cee(N,o.filter(function(z){var Y,re,Z=f in z.props?z.props[f]:(Y=z.type.defaultProps)===null||Y===void 0?void 0:Y[f],ie="hide"in z.props?z.props.hide:(re=z.type.defaultProps)===null||re===void 0?void 0:re.hide;return Z===V&&!ie}),"number",T),d.defaultProps.allowDataOverflow),B=zD(w,B,V,p)),Be(Be({},I),{},Yt({},V,Be(Be({axisType:p},d.defaultProps),{},{hide:!0,orientation:po(U7e,"".concat(p,".").concat(k%2),null),domain:B,originalDomain:W,isCategorical:A,layout:T})))}return I},{})},$7e=function(n,a){var o=a.axisType,d=o===void 0?"xAxis":o,p=a.AxisComp,f=a.graphicalItems,v=a.stackGroups,b=a.dataStartIndex,E=a.dataEndIndex,T=n.children,w="".concat(d,"Id"),N=mo(T,p),P={};return N&&N.length?P=G7e(n,{axes:N,graphicalItems:f,axisType:d,axisIdKey:w,stackGroups:v,dataStartIndex:b,dataEndIndex:E}):f&&f.length&&(P=W7e(n,{Axis:p,graphicalItems:f,axisType:d,axisIdKey:w,stackGroups:v,dataStartIndex:b,dataEndIndex:E})),P},H7e=function(n){var a=Ad(n),o=xl(a,!1,!0);return{tooltipTicks:o,orderedTooltipTicks:j2(o,function(d){return d.coordinate}),tooltipAxis:a,tooltipAxisBandSize:XS(a,o)}},mY=function(n){var a=n.children,o=n.defaultShowTooltip,d=Es(a,bf),p=0,f=0;return n.data&&n.data.length!==0&&(f=n.data.length-1),d&&d.props&&(d.props.startIndex>=0&&(p=d.props.startIndex),d.props.endIndex>=0&&(f=d.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:p,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!o}},z7e=function(n){return!n||!n.length?!1:n.some(function(a){var o=wl(a&&a.type);return o&&o.indexOf("Bar")>=0})},fY=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},K7e=function(n,a){var o=n.props,d=n.graphicalItems,p=n.xAxisMap,f=p===void 0?{}:p,v=n.yAxisMap,b=v===void 0?{}:v,E=o.width,T=o.height,w=o.children,N=o.margin||{},P=Es(w,bf),A=Es(w,Km),k=Object.keys(b).reduce(function(B,z){var Y=b[z],re=Y.orientation;return!Y.mirror&&!Y.hide?Be(Be({},B),{},Yt({},re,B[re]+Y.width)):B},{left:N.left||0,right:N.right||0}),I=Object.keys(f).reduce(function(B,z){var Y=f[z],re=Y.orientation;return!Y.mirror&&!Y.hide?Be(Be({},B),{},Yt({},re,po(B,"".concat(re))+Y.height)):B},{top:N.top||0,bottom:N.bottom||0}),F=Be(Be({},I),k),U=F.bottom;P&&(F.bottom+=P.props.height||bf.defaultProps.height),A&&a&&(F=YFe(F,d,o,a));var V=E-F.left-F.right,W=T-F.top-F.bottom;return Be(Be({brushBottom:U},F),{},{width:Math.max(V,0),height:Math.max(W,0)})},Y7e=function(n,a){if(a==="xAxis")return n[a].width;if(a==="yAxis")return n[a].height},xte=function(n){var a=n.chartName,o=n.GraphicalChild,d=n.defaultTooltipEventType,p=d===void 0?"axis":d,f=n.validateTooltipEventTypes,v=f===void 0?["axis"]:f,b=n.axisComponents,E=n.legendContent,T=n.formatAxisMap,w=n.defaultProps,N=function(F,U){var V=U.graphicalItems,W=U.stackGroups,B=U.offset,z=U.updateId,Y=U.dataStartIndex,re=U.dataEndIndex,Z=F.barSize,ie=F.layout,te=F.barGap,de=F.barCategoryGap,xe=F.maxBarSize,me=fY(ie),Ce=me.numericAxisName,ue=me.cateAxisName,be=z7e(V),se=[];return V.forEach(function(pe,De){var Se=UT(F.data,{graphicalItems:[pe],dataStartIndex:Y,dataEndIndex:re}),we=pe.type.defaultProps!==void 0?Be(Be({},pe.type.defaultProps),pe.props):pe.props,qe=we.dataKey,lt=we.maxBarSize,Ut=we["".concat(Ce,"Id")],Ht=we["".concat(ue,"Id")],Ue={},dt=b.reduce(function(fa,Da){var oc=U["".concat(Da.axisType,"Map")],nt=we["".concat(Da.axisType,"Id")];oc&&oc[nt]||Da.axisType==="zAxis"||Vh();var Lt=oc[nt];return Be(Be({},fa),{},Yt(Yt({},Da.axisType,Lt),"".concat(Da.axisType,"Ticks"),xl(Lt)))},Ue),Ne=dt[ue],Ke=dt["".concat(ue,"Ticks")],bt=W&&W[Ut]&&W[Ut].hasStack&&cVe(pe,W[Ut].stackGroups),Te=wl(pe.type).indexOf("Bar")>=0,gt=XS(Ne,Ke),Qe=[],Ft=be&&zFe({barSize:Z,stackGroups:W,totalSize:Y7e(dt,ue)});if(Te){var At,ye,et=bn(lt)?xe:lt,zt=(At=(ye=XS(Ne,Ke,!0))!==null&&ye!==void 0?ye:et)!==null&&At!==void 0?At:0;Qe=KFe({barGap:te,barCategoryGap:de,bandSize:zt!==gt?zt:gt,sizeList:Ft[Ht],maxBarSize:et}),zt!==gt&&(Qe=Qe.map(function(fa){return Be(Be({},fa),{},{position:Be(Be({},fa.position),{},{offset:fa.position.offset-zt/2})})}))}var ui=pe&&pe.type&&pe.type.getComposedData;ui&&se.push({props:Be(Be({},ui(Be(Be({},dt),{},{displayedData:Se,props:F,dataKey:qe,item:pe,bandSize:gt,barPosition:Qe,offset:B,stackedData:bt,layout:ie,dataStartIndex:Y,dataEndIndex:re}))),{},Yt(Yt(Yt({key:pe.key||"item-".concat(De)},Ce,dt[Ce]),ue,dt[ue]),"animationId",z)),childIndex:HAe(pe,F.children),item:pe})}),se},P=function(F,U){var V=F.props,W=F.dataStartIndex,B=F.dataEndIndex,z=F.updateId;if(!M7({props:V}))return null;var Y=V.children,re=V.layout,Z=V.stackOffset,ie=V.data,te=V.reverseStackOrder,de=fY(re),xe=de.numericAxisName,me=de.cateAxisName,Ce=mo(Y,o),ue=aVe(ie,Ce,"".concat(xe,"Id"),"".concat(me,"Id"),Z,te),be=b.reduce(function(we,qe){var lt="".concat(qe.axisType,"Map");return Be(Be({},we),{},Yt({},lt,$7e(V,Be(Be({},qe),{},{graphicalItems:Ce,stackGroups:qe.axisType===xe&&ue,dataStartIndex:W,dataEndIndex:B}))))},{}),se=K7e(Be(Be({},be),{},{props:V,graphicalItems:Ce}),U==null?void 0:U.legendBBox);Object.keys(be).forEach(function(we){be[we]=T(V,be[we],se,we.replace("Map",""),a)});var pe=be["".concat(me,"Map")],De=H7e(pe),Se=N(V,Be(Be({},be),{},{dataStartIndex:W,dataEndIndex:B,updateId:z,graphicalItems:Ce,stackGroups:ue,offset:se}));return Be(Be({formattedGraphicalItems:Se,graphicalItems:Ce,offset:se,stackGroups:ue},De),be)},A=function(I){function F(U){var V,W,B;return N7e(this,F),B=I7e(this,F,[U]),Yt(B,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Yt(B,"accessibilityManager",new p7e),Yt(B,"handleLegendBBoxUpdate",function(z){if(z){var Y=B.state,re=Y.dataStartIndex,Z=Y.dataEndIndex,ie=Y.updateId;B.setState(Be({legendBBox:z},P({props:B.props,dataStartIndex:re,dataEndIndex:Z,updateId:ie},Be(Be({},B.state),{},{legendBBox:z}))))}}),Yt(B,"handleReceiveSyncEvent",function(z,Y,re){if(B.props.syncId===z){if(re===B.eventEmitterSymbol&&typeof B.props.syncMethod!="function")return;B.applySyncEvent(Y)}}),Yt(B,"handleBrushChange",function(z){var Y=z.startIndex,re=z.endIndex;if(Y!==B.state.dataStartIndex||re!==B.state.dataEndIndex){var Z=B.state.updateId;B.setState(function(){return Be({dataStartIndex:Y,dataEndIndex:re},P({props:B.props,dataStartIndex:Y,dataEndIndex:re,updateId:Z},B.state))}),B.triggerSyncEvent({dataStartIndex:Y,dataEndIndex:re})}}),Yt(B,"handleMouseEnter",function(z){var Y=B.getMouseInfo(z);if(Y){var re=Be(Be({},Y),{},{isTooltipActive:!0});B.setState(re),B.triggerSyncEvent(re);var Z=B.props.onMouseEnter;pn(Z)&&Z(re,z)}}),Yt(B,"triggeredAfterMouseMove",function(z){var Y=B.getMouseInfo(z),re=Y?Be(Be({},Y),{},{isTooltipActive:!0}):{isTooltipActive:!1};B.setState(re),B.triggerSyncEvent(re);var Z=B.props.onMouseMove;pn(Z)&&Z(re,z)}),Yt(B,"handleItemMouseEnter",function(z){B.setState(function(){return{isTooltipActive:!0,activeItem:z,activePayload:z.tooltipPayload,activeCoordinate:z.tooltipPosition||{x:z.cx,y:z.cy}}})}),Yt(B,"handleItemMouseLeave",function(){B.setState(function(){return{isTooltipActive:!1}})}),Yt(B,"handleMouseMove",function(z){z.persist(),B.throttleTriggeredAfterMouseMove(z)}),Yt(B,"handleMouseLeave",function(z){B.throttleTriggeredAfterMouseMove.cancel();var Y={isTooltipActive:!1};B.setState(Y),B.triggerSyncEvent(Y);var re=B.props.onMouseLeave;pn(re)&&re(Y,z)}),Yt(B,"handleOuterEvent",function(z){var Y=$Ae(z),re=po(B.props,"".concat(Y));if(Y&&pn(re)){var Z,ie;/.*touch.*/i.test(Y)?ie=B.getMouseInfo(z.changedTouches[0]):ie=B.getMouseInfo(z),re((Z=ie)!==null&&Z!==void 0?Z:{},z)}}),Yt(B,"handleClick",function(z){var Y=B.getMouseInfo(z);if(Y){var re=Be(Be({},Y),{},{isTooltipActive:!0});B.setState(re),B.triggerSyncEvent(re);var Z=B.props.onClick;pn(Z)&&Z(re,z)}}),Yt(B,"handleMouseDown",function(z){var Y=B.props.onMouseDown;if(pn(Y)){var re=B.getMouseInfo(z);Y(re,z)}}),Yt(B,"handleMouseUp",function(z){var Y=B.props.onMouseUp;if(pn(Y)){var re=B.getMouseInfo(z);Y(re,z)}}),Yt(B,"handleTouchMove",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.throttleTriggeredAfterMouseMove(z.changedTouches[0])}),Yt(B,"handleTouchStart",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseDown(z.changedTouches[0])}),Yt(B,"handleTouchEnd",function(z){z.changedTouches!=null&&z.changedTouches.length>0&&B.handleMouseUp(z.changedTouches[0])}),Yt(B,"handleDoubleClick",function(z){var Y=B.props.onDoubleClick;if(pn(Y)){var re=B.getMouseInfo(z);Y(re,z)}}),Yt(B,"handleContextMenu",function(z){var Y=B.props.onContextMenu;if(pn(Y)){var re=B.getMouseInfo(z);Y(re,z)}}),Yt(B,"triggerSyncEvent",function(z){B.props.syncId!==void 0&&c1.emit(l1,B.props.syncId,z,B.eventEmitterSymbol)}),Yt(B,"applySyncEvent",function(z){var Y=B.props,re=Y.layout,Z=Y.syncMethod,ie=B.state.updateId,te=z.dataStartIndex,de=z.dataEndIndex;if(z.dataStartIndex!==void 0||z.dataEndIndex!==void 0)B.setState(Be({dataStartIndex:te,dataEndIndex:de},P({props:B.props,dataStartIndex:te,dataEndIndex:de,updateId:ie},B.state)));else if(z.activeTooltipIndex!==void 0){var xe=z.chartX,me=z.chartY,Ce=z.activeTooltipIndex,ue=B.state,be=ue.offset,se=ue.tooltipTicks;if(!be)return;if(typeof Z=="function")Ce=Z(se,z);else if(Z==="value"){Ce=-1;for(var pe=0;pe<se.length;pe++)if(se[pe].value===z.activeLabel){Ce=pe;break}}var De=Be(Be({},be),{},{x:be.left,y:be.top}),Se=Math.min(xe,De.x+De.width),we=Math.min(me,De.y+De.height),qe=se[Ce]&&se[Ce].value,lt=qD(B.state,B.props.data,Ce),Ut=se[Ce]?{x:re==="horizontal"?se[Ce].coordinate:Se,y:re==="horizontal"?we:se[Ce].coordinate}:bte;B.setState(Be(Be({},z),{},{activeLabel:qe,activeCoordinate:Ut,activePayload:lt,activeTooltipIndex:Ce}))}else B.setState(z)}),Yt(B,"renderCursor",function(z){var Y,re=B.state,Z=re.isTooltipActive,ie=re.activeCoordinate,te=re.activePayload,de=re.offset,xe=re.activeTooltipIndex,me=re.tooltipAxisBandSize,Ce=B.getTooltipEventType(),ue=(Y=z.props.active)!==null&&Y!==void 0?Y:Z,be=B.props.layout,se=z.key||"_recharts-cursor";return fe.createElement(b7e,{key:se,activeCoordinate:ie,activePayload:te,activeTooltipIndex:xe,chartName:a,element:z,isActive:ue,layout:be,offset:de,tooltipAxisBandSize:me,tooltipEventType:Ce})}),Yt(B,"renderPolarAxis",function(z,Y,re){var Z=po(z,"type.axisType"),ie=po(B.state,"".concat(Z,"Map")),te=z.type.defaultProps,de=te!==void 0?Be(Be({},te),z.props):z.props,xe=ie&&ie[de["".concat(Z,"Id")]];return q.cloneElement(z,Be(Be({},xe),{},{className:On(Z,xe.className),key:z.key||"".concat(Y,"-").concat(re),ticks:xl(xe,!0)}))}),Yt(B,"renderPolarGrid",function(z){var Y=z.props,re=Y.radialLines,Z=Y.polarAngles,ie=Y.polarRadius,te=B.state,de=te.radiusAxisMap,xe=te.angleAxisMap,me=Ad(de),Ce=Ad(xe),ue=Ce.cx,be=Ce.cy,se=Ce.innerRadius,pe=Ce.outerRadius;return q.cloneElement(z,{polarAngles:Array.isArray(Z)?Z:xl(Ce,!0).map(function(De){return De.coordinate}),polarRadius:Array.isArray(ie)?ie:xl(me,!0).map(function(De){return De.coordinate}),cx:ue,cy:be,innerRadius:se,outerRadius:pe,key:z.key||"polar-grid",radialLines:re})}),Yt(B,"renderLegend",function(){var z=B.state.formattedGraphicalItems,Y=B.props,re=Y.children,Z=Y.width,ie=Y.height,te=B.props.margin||{},de=Z-(te.left||0)-(te.right||0),xe=see({children:re,formattedGraphicalItems:z,legendWidth:de,legendContent:E});if(!xe)return null;var me=xe.item,Ce=uY(xe,E7e);return q.cloneElement(me,Be(Be({},Ce),{},{chartWidth:Z,chartHeight:ie,margin:te,onBBoxUpdate:B.handleLegendBBoxUpdate}))}),Yt(B,"renderTooltip",function(){var z,Y=B.props,re=Y.children,Z=Y.accessibilityLayer,ie=Es(re,xs);if(!ie)return null;var te=B.state,de=te.isTooltipActive,xe=te.activeCoordinate,me=te.activePayload,Ce=te.activeLabel,ue=te.offset,be=(z=ie.props.active)!==null&&z!==void 0?z:de;return q.cloneElement(ie,{viewBox:Be(Be({},ue),{},{x:ue.left,y:ue.top}),active:be,label:Ce,payload:be?me:[],coordinate:xe,accessibilityLayer:Z})}),Yt(B,"renderBrush",function(z){var Y=B.props,re=Y.margin,Z=Y.data,ie=B.state,te=ie.offset,de=ie.dataStartIndex,xe=ie.dataEndIndex,me=ie.updateId;return q.cloneElement(z,{key:z.key||"_recharts-brush",onChange:gx(B.handleBrushChange,z.props.onChange),data:Z,x:ct(z.props.x)?z.props.x:te.left,y:ct(z.props.y)?z.props.y:te.top+te.height+te.brushBottom-(re.bottom||0),width:ct(z.props.width)?z.props.width:te.width,startIndex:de,endIndex:xe,updateId:"brush-".concat(me)})}),Yt(B,"renderReferenceElement",function(z,Y,re){if(!z)return null;var Z=B,ie=Z.clipPathId,te=B.state,de=te.xAxisMap,xe=te.yAxisMap,me=te.offset,Ce=z.type.defaultProps||{},ue=z.props,be=ue.xAxisId,se=be===void 0?Ce.xAxisId:be,pe=ue.yAxisId,De=pe===void 0?Ce.yAxisId:pe;return q.cloneElement(z,{key:z.key||"".concat(Y,"-").concat(re),xAxis:de[se],yAxis:xe[De],viewBox:{x:me.left,y:me.top,width:me.width,height:me.height},clipPathId:ie})}),Yt(B,"renderActivePoints",function(z){var Y=z.item,re=z.activePoint,Z=z.basePoint,ie=z.childIndex,te=z.isRange,de=[],xe=Y.props.key,me=Y.item.type.defaultProps!==void 0?Be(Be({},Y.item.type.defaultProps),Y.item.props):Y.item.props,Ce=me.activeDot,ue=me.dataKey,be=Be(Be({index:ie,dataKey:ue,cx:re.x,cy:re.y,r:4,fill:oj(Y.item),strokeWidth:2,stroke:"#fff",payload:re.payload,value:re.value},yn(Ce,!1)),_S(Ce));return de.push(F.renderActiveDot(Ce,be,"".concat(xe,"-activePoint-").concat(ie))),Z?de.push(F.renderActiveDot(Ce,Be(Be({},be),{},{cx:Z.x,cy:Z.y}),"".concat(xe,"-basePoint-").concat(ie))):te&&de.push(null),de}),Yt(B,"renderGraphicChild",function(z,Y,re){var Z=B.filterFormatItem(z,Y,re);if(!Z)return null;var ie=B.getTooltipEventType(),te=B.state,de=te.isTooltipActive,xe=te.tooltipAxis,me=te.activeTooltipIndex,Ce=te.activeLabel,ue=B.props.children,be=Es(ue,xs),se=Z.props,pe=se.points,De=se.isRange,Se=se.baseLine,we=Z.item.type.defaultProps!==void 0?Be(Be({},Z.item.type.defaultProps),Z.item.props):Z.item.props,qe=we.activeDot,lt=we.hide,Ut=we.activeBar,Ht=we.activeShape,Ue=!!(!lt&&de&&be&&(qe||Ut||Ht)),dt={};ie!=="axis"&&be&&be.props.trigger==="click"?dt={onClick:gx(B.handleItemMouseEnter,z.props.onClick)}:ie!=="axis"&&(dt={onMouseLeave:gx(B.handleItemMouseLeave,z.props.onMouseLeave),onMouseEnter:gx(B.handleItemMouseEnter,z.props.onMouseEnter)});var Ne=q.cloneElement(z,Be(Be({},Z.props),dt));function Ke(Da){return typeof xe.dataKey=="function"?xe.dataKey(Da.payload):null}if(Ue)if(me>=0){var bt,Te;if(xe.dataKey&&!xe.allowDuplicatedCategory){var gt=typeof xe.dataKey=="function"?Ke:"payload.".concat(xe.dataKey.toString());bt=yS(pe,gt,Ce),Te=De&&Se&&yS(Se,gt,Ce)}else bt=pe==null?void 0:pe[me],Te=De&&Se&&Se[me];if(Ht||Ut){var Qe=z.props.activeIndex!==void 0?z.props.activeIndex:me;return[q.cloneElement(z,Be(Be(Be({},Z.props),dt),{},{activeIndex:Qe})),null,null]}if(!bn(bt))return[Ne].concat(Of(B.renderActivePoints({item:Z,activePoint:bt,basePoint:Te,childIndex:me,isRange:De})))}else{var Ft,At=(Ft=B.getItemByXY(B.state.activeCoordinate))!==null&&Ft!==void 0?Ft:{graphicalItem:Ne},ye=At.graphicalItem,et=ye.item,zt=et===void 0?z:et,ui=ye.childIndex,fa=Be(Be(Be({},Z.props),dt),{},{activeIndex:ui});return[q.cloneElement(zt,fa),null,null]}return De?[Ne,null,null]:[Ne,null]}),Yt(B,"renderCustomized",function(z,Y,re){return q.cloneElement(z,Be(Be({key:"recharts-customized-".concat(re)},B.props),B.state))}),Yt(B,"renderMap",{CartesianGrid:{handler:Ex,once:!0},ReferenceArea:{handler:B.renderReferenceElement},ReferenceLine:{handler:Ex},ReferenceDot:{handler:B.renderReferenceElement},XAxis:{handler:Ex},YAxis:{handler:Ex},Brush:{handler:B.renderBrush,once:!0},Bar:{handler:B.renderGraphicChild},Line:{handler:B.renderGraphicChild},Area:{handler:B.renderGraphicChild},Radar:{handler:B.renderGraphicChild},RadialBar:{handler:B.renderGraphicChild},Scatter:{handler:B.renderGraphicChild},Pie:{handler:B.renderGraphicChild},Funnel:{handler:B.renderGraphicChild},Tooltip:{handler:B.renderCursor,once:!0},PolarGrid:{handler:B.renderPolarGrid,once:!0},PolarAngleAxis:{handler:B.renderPolarAxis},PolarRadiusAxis:{handler:B.renderPolarAxis},Customized:{handler:B.renderCustomized}}),B.clipPathId="".concat((V=U.id)!==null&&V!==void 0?V:qf("recharts"),"-clip"),B.throttleTriggeredAfterMouseMove=aZ(B.triggeredAfterMouseMove,(W=U.throttleDelay)!==null&&W!==void 0?W:1e3/60),B.state={},B}return D7e(F,I),A7e(F,[{key:"componentDidMount",value:function(){var V,W;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(V=this.props.margin.left)!==null&&V!==void 0?V:0,top:(W=this.props.margin.top)!==null&&W!==void 0?W:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var V=this.props,W=V.children,B=V.data,z=V.height,Y=V.layout,re=Es(W,xs);if(re){var Z=re.props.defaultIndex;if(!(typeof Z!="number"||Z<0||Z>this.state.tooltipTicks.length-1)){var ie=this.state.tooltipTicks[Z]&&this.state.tooltipTicks[Z].value,te=qD(this.state,B,Z,ie),de=this.state.tooltipTicks[Z].coordinate,xe=(this.state.offset.top+z)/2,me=Y==="horizontal",Ce=me?{x:de,y:xe}:{y:de,x:xe},ue=this.state.formattedGraphicalItems.find(function(se){var pe=se.item;return pe.type.name==="Scatter"});ue&&(Ce=Be(Be({},Ce),ue.props.points[Z].tooltipPosition),te=ue.props.points[Z].tooltipPayload);var be={activeTooltipIndex:Z,isTooltipActive:!0,activeLabel:ie,activePayload:te,activeCoordinate:Ce};this.setState(be),this.renderCursor(re),this.accessibilityManager.setIndex(Z)}}}},{key:"getSnapshotBeforeUpdate",value:function(V,W){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==W.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==V.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==V.margin){var B,z;this.accessibilityManager.setDetails({offset:{left:(B=this.props.margin.left)!==null&&B!==void 0?B:0,top:(z=this.props.margin.top)!==null&&z!==void 0?z:0}})}return null}},{key:"componentDidUpdate",value:function(V){NP([Es(V.children,xs)],[Es(this.props.children,xs)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var V=Es(this.props.children,xs);if(V&&typeof V.props.shared=="boolean"){var W=V.props.shared?"axis":"item";return v.indexOf(W)>=0?W:p}return p}},{key:"getMouseInfo",value:function(V){if(!this.container)return null;var W=this.container,B=W.getBoundingClientRect(),z=vUe(B),Y={chartX:Math.round(V.pageX-z.left),chartY:Math.round(V.pageY-z.top)},re=B.width/W.offsetWidth||1,Z=this.inRange(Y.chartX,Y.chartY,re);if(!Z)return null;var ie=this.state,te=ie.xAxisMap,de=ie.yAxisMap,xe=this.getTooltipEventType(),me=pY(this.state,this.props.data,this.props.layout,Z);if(xe!=="axis"&&te&&de){var Ce=Ad(te).scale,ue=Ad(de).scale,be=Ce&&Ce.invert?Ce.invert(Y.chartX):null,se=ue&&ue.invert?ue.invert(Y.chartY):null;return Be(Be({},Y),{},{xValue:be,yValue:se},me)}return me?Be(Be({},Y),me):null}},{key:"inRange",value:function(V,W){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,z=this.props.layout,Y=V/B,re=W/B;if(z==="horizontal"||z==="vertical"){var Z=this.state.offset,ie=Y>=Z.left&&Y<=Z.left+Z.width&&re>=Z.top&&re<=Z.top+Z.height;return ie?{x:Y,y:re}:null}var te=this.state,de=te.angleAxisMap,xe=te.radiusAxisMap;if(de&&xe){var me=Ad(de);return zK({x:Y,y:re},me)}return null}},{key:"parseEventsOfWrapper",value:function(){var V=this.props.children,W=this.getTooltipEventType(),B=Es(V,xs),z={};B&&W==="axis"&&(B.props.trigger==="click"?z={onClick:this.handleClick}:z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var Y=_S(this.props,this.handleOuterEvent);return Be(Be({},Y),z)}},{key:"addListener",value:function(){c1.on(l1,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){c1.removeListener(l1,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(V,W,B){for(var z=this.state.formattedGraphicalItems,Y=0,re=z.length;Y<re;Y++){var Z=z[Y];if(Z.item===V||Z.props.key===V.key||W===wl(Z.item.type)&&B===Z.childIndex)return Z}return null}},{key:"renderClipPath",value:function(){var V=this.clipPathId,W=this.state.offset,B=W.left,z=W.top,Y=W.height,re=W.width;return fe.createElement("defs",null,fe.createElement("clipPath",{id:V},fe.createElement("rect",{x:B,y:z,height:Y,width:re})))}},{key:"getXScales",value:function(){var V=this.state.xAxisMap;return V?Object.entries(V).reduce(function(W,B){var z=dY(B,2),Y=z[0],re=z[1];return Be(Be({},W),{},Yt({},Y,re.scale))},{}):null}},{key:"getYScales",value:function(){var V=this.state.yAxisMap;return V?Object.entries(V).reduce(function(W,B){var z=dY(B,2),Y=z[0],re=z[1];return Be(Be({},W),{},Yt({},Y,re.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(V){var W;return(W=this.state.xAxisMap)===null||W===void 0||(W=W[V])===null||W===void 0?void 0:W.scale}},{key:"getYScaleByAxisId",value:function(V){var W;return(W=this.state.yAxisMap)===null||W===void 0||(W=W[V])===null||W===void 0?void 0:W.scale}},{key:"getItemByXY",value:function(V){var W=this.state,B=W.formattedGraphicalItems,z=W.activeItem;if(B&&B.length)for(var Y=0,re=B.length;Y<re;Y++){var Z=B[Y],ie=Z.props,te=Z.item,de=te.type.defaultProps!==void 0?Be(Be({},te.type.defaultProps),te.props):te.props,xe=wl(te.type);if(xe==="Bar"){var me=(ie.data||[]).find(function(se){return e8e(V,se)});if(me)return{graphicalItem:Z,payload:me}}else if(xe==="RadialBar"){var Ce=(ie.data||[]).find(function(se){return zK(V,se)});if(Ce)return{graphicalItem:Z,payload:Ce}}else if(OT(Z,z)||PT(Z,z)||m0(Z,z)){var ue=rGe({graphicalItem:Z,activeTooltipItem:z,itemData:de.data}),be=de.activeIndex===void 0?ue:de.activeIndex;return{graphicalItem:Be(Be({},Z),{},{childIndex:be}),payload:m0(Z,z)?de.data[ue]:Z.props.data[ue]}}}return null}},{key:"render",value:function(){var V=this;if(!M7(this))return null;var W=this.props,B=W.children,z=W.className,Y=W.width,re=W.height,Z=W.style,ie=W.compact,te=W.title,de=W.desc,xe=uY(W,x7e),me=yn(xe,!1);if(ie)return fe.createElement($9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},fe.createElement(AP,Fm({},me,{width:Y,height:re,title:te,desc:de}),this.renderClipPath(),F7(B,this.renderMap)));if(this.props.accessibilityLayer){var Ce,ue;me.tabIndex=(Ce=this.props.tabIndex)!==null&&Ce!==void 0?Ce:0,me.role=(ue=this.props.role)!==null&&ue!==void 0?ue:"application",me.onKeyDown=function(se){V.accessibilityManager.keyboardEvent(se)},me.onFocus=function(){V.accessibilityManager.focus()}}var be=this.parseEventsOfWrapper();return fe.createElement($9,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},fe.createElement("div",Fm({className:On("recharts-wrapper",z),style:Be({position:"relative",cursor:"default",width:Y,height:re},Z)},be,{ref:function(pe){V.container=pe}}),fe.createElement(AP,Fm({},me,{width:Y,height:re,title:te,desc:de,style:F7e}),this.renderClipPath(),F7(B,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(q.Component);Yt(A,"displayName",a),Yt(A,"defaultProps",Be({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},w)),Yt(A,"getDerivedStateFromProps",function(I,F){var U=I.dataKey,V=I.data,W=I.children,B=I.width,z=I.height,Y=I.layout,re=I.stackOffset,Z=I.margin,ie=F.dataStartIndex,te=F.dataEndIndex;if(F.updateId===void 0){var de=mY(I);return Be(Be(Be({},de),{},{updateId:0},P(Be(Be({props:I},de),{},{updateId:0}),F)),{},{prevDataKey:U,prevData:V,prevWidth:B,prevHeight:z,prevLayout:Y,prevStackOffset:re,prevMargin:Z,prevChildren:W})}if(U!==F.prevDataKey||V!==F.prevData||B!==F.prevWidth||z!==F.prevHeight||Y!==F.prevLayout||re!==F.prevStackOffset||!zm(Z,F.prevMargin)){var xe=mY(I),me={chartX:F.chartX,chartY:F.chartY,isTooltipActive:F.isTooltipActive},Ce=Be(Be({},pY(F,V,Y)),{},{updateId:F.updateId+1}),ue=Be(Be(Be({},xe),me),Ce);return Be(Be(Be({},ue),P(Be({props:I},ue),F)),{},{prevDataKey:U,prevData:V,prevWidth:B,prevHeight:z,prevLayout:Y,prevStackOffset:re,prevMargin:Z,prevChildren:W})}if(!NP(W,F.prevChildren)){var be,se,pe,De,Se=Es(W,bf),we=Se&&(be=(se=Se.props)===null||se===void 0?void 0:se.startIndex)!==null&&be!==void 0?be:ie,qe=Se&&(pe=(De=Se.props)===null||De===void 0?void 0:De.endIndex)!==null&&pe!==void 0?pe:te,lt=we!==ie||qe!==te,Ut=!bn(V),Ht=Ut&&!lt?F.updateId:F.updateId+1;return Be(Be({updateId:Ht},P(Be(Be({props:I},F),{},{updateId:Ht,dataStartIndex:we,dataEndIndex:qe}),F)),{},{prevChildren:W,dataStartIndex:we,dataEndIndex:qe})}return null}),Yt(A,"renderActiveDot",function(I,F,U){var V;return q.isValidElement(I)?V=q.cloneElement(I,F):pn(I)?V=I(F):V=fe.createElement(IT,F),fe.createElement(mr,{className:"recharts-active-dot",key:U},V)});var k=q.forwardRef(function(F,U){return fe.createElement(A,Fm({},F,{ref:U}))});return k.displayName=A.displayName,k},Ste=xte({chartName:"LineChart",GraphicalChild:rg,axisComponents:[{axisType:"xAxis",AxisComp:Jd},{axisType:"yAxis",AxisComp:Qd}],formatAxisMap:Lee}),wte=xte({chartName:"AreaChart",GraphicalChild:Gl,axisComponents:[{axisType:"xAxis",AxisComp:Jd},{axisType:"yAxis",AxisComp:Qd}],formatAxisMap:Lee});const Tte={vitaminD:{name:"Vitamin D",icon:UJ,color:"amber",unit:"ng/mL",normalRange:"30-100",lowExplanation:"When Vitamin D is low, you may feel tired all the time, have weak bones that break easily, feel sad or depressed, get sick often, and have muscle pain. Your body needs sunlight and certain foods to make Vitamin D.",tips:["Get 15-20 minutes of sunlight daily","Eat eggs, fish, and fortified milk","Consider supplements if advised by doctor"]},vitaminB12:{name:"Vitamin B12",icon:u2,color:"red",unit:"pg/mL",normalRange:"300-900",lowExplanation:"Low Vitamin B12 makes you feel very tired and weak. You might feel dizzy, have trouble thinking clearly, feel numbness in hands or feet, and look pale. Your body needs B12 to make healthy blood cells.",tips:["Eat meat, fish, eggs, and dairy","Vegetarians may need supplements","Get tested if you feel constantly tired"]},iron:{name:"Iron",icon:qw,color:"rose",unit:"mcg/dL",normalRange:"60-170",lowExplanation:"Low iron means your blood cannot carry enough oxygen. You will feel very tired, look pale, feel short of breath, have cold hands and feet, and may have headaches. Women often have low iron.",tips:["Eat red meat, spinach, and beans","Take iron with Vitamin C for better absorption","Avoid tea/coffee with iron-rich meals"]},hemoglobin:{name:"Hemoglobin",icon:Di,color:"red",unit:"g/dL",normalRange:"12-17",lowExplanation:"Low hemoglobin means anemia - your blood cannot carry enough oxygen to your body. You will feel extremely tired, weak, dizzy, and may have pale skin. Your heart has to work harder.",tips:["Eat iron-rich foods","Include Vitamin C in your diet","See a doctor if symptoms persist"]},calcium:{name:"Calcium",icon:iTe,color:"slate",unit:"mg/dL",normalRange:"8.5-10.5",lowExplanation:"Low calcium weakens your bones and teeth. You may have muscle cramps, numbness in fingers, brittle nails, and bones that break easily. Long-term low calcium can cause osteoporosis.",tips:["Drink milk and eat dairy products","Eat leafy green vegetables","Get enough Vitamin D for calcium absorption"]},vitaminC:{name:"Vitamin C",icon:vS,color:"orange",unit:"mg/dL",normalRange:"0.6-2.0",lowExplanation:"Low Vitamin C means your body cannot heal wounds properly. You may have bleeding gums, bruise easily, feel tired, have dry skin, and get sick often. Your immune system becomes weak.",tips:["Eat citrus fruits like oranges and lemons","Include tomatoes and bell peppers","Eat fresh fruits and vegetables daily"]},cholesterol:{name:"Cholesterol",icon:ir,color:"yellow",unit:"mg/dL",normalRange:"<200",lowExplanation:"While high cholesterol is usually the concern, very low cholesterol can affect hormone production and brain function. However, most people need to focus on keeping cholesterol in healthy range.",tips:["Limit fried and fatty foods","Exercise regularly","Eat more fiber and vegetables"]},bloodSugar:{name:"Blood Sugar",icon:Qw,color:"purple",unit:"mg/dL",normalRange:"70-100",lowExplanation:"Low blood sugar (hypoglycemia) makes you feel shaky, sweaty, confused, and very hungry. You may feel dizzy or faint. High blood sugar over time can lead to diabetes and damage organs.",tips:["Eat regular meals","Limit sugary foods and drinks","Exercise helps control blood sugar"]},thyroid:{name:"Thyroid (TSH)",icon:sTe,color:"indigo",unit:"mIU/L",normalRange:"0.4-4.0",lowExplanation:"Thyroid problems affect your energy and weight. Low thyroid makes you tired, gain weight, feel cold, and have dry skin. High thyroid makes you anxious, lose weight, and feel hot.",tips:["Get thyroid checked if you have unexplained weight changes","Iodine in salt helps thyroid function","Take thyroid medicine as prescribed"]},heartRate:{name:"Heart Rate",icon:Di,color:"red",unit:"bpm",normalRange:"60-100",lowExplanation:"Very low heart rate can mean your heart is not pumping enough blood. You may feel dizzy, tired, or faint. Athletes often have lower heart rates which is normal for them.",tips:["Regular exercise strengthens your heart","Reduce stress and anxiety","Limit caffeine and alcohol"]},sleep:{name:"Sleep",icon:Vf,color:"indigo",unit:"hours",normalRange:"7-9",lowExplanation:"Not enough sleep makes you tired, irritable, and unable to think clearly. Long-term poor sleep increases risk of heart disease, diabetes, and weight gain. Your body heals during sleep.",tips:["Sleep 7-9 hours every night","Keep a regular sleep schedule","Avoid screens before bedtime"]},steps:{name:"Daily Steps",icon:PJ,color:"cyan",unit:"steps",normalRange:"8,000-10,000",lowExplanation:"Not walking enough means less exercise for your body. This can lead to weight gain, weak muscles, poor heart health, and low energy. Walking is the easiest exercise for everyone.",tips:["Aim for 8,000-10,000 steps daily","Take stairs instead of elevator","Walk after meals for better digestion"]}},q7e=({metric:e,onClose:n})=>{if(!e)return null;const a=Tte[e];if(!a)return null;const o=a.icon;return l.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",onClick:n,children:l.jsxs("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl w-full sm:max-w-md max-h-[85vh] overflow-y-auto p-5 sm:p-6 relative animate-slide-up sm:animate-fade-in shadow-xl",onClick:d=>d.stopPropagation(),children:[l.jsx("div",{className:"w-12 h-1 bg-slate-300 rounded-full mx-auto mb-4 sm:hidden"}),l.jsx("button",{onClick:n,className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 p-1",children:l.jsx(Ji,{className:"w-5 h-5"})}),l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-${a.color}-100 flex items-center justify-center`,children:l.jsx(o,{className:`w-5 h-5 sm:w-6 sm:h-6 text-${a.color}-500`})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-800",children:a.name}),l.jsxs("p",{className:"text-slate-500 text-xs sm:text-sm",children:["Normal: ",a.normalRange," ",a.unit]})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-cyan-600 font-medium mb-2 text-sm sm:text-base",children:"What happens when it's low?"}),l.jsx("p",{className:"text-slate-600 text-xs sm:text-sm leading-relaxed",children:a.lowExplanation})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-emerald-600 font-medium mb-2 text-sm sm:text-base",children:"Simple Tips to Improve"}),l.jsx("ul",{className:"space-y-2",children:a.tips.map((d,p)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-600 text-xs sm:text-sm",children:[l.jsx("span",{className:"text-emerald-500 mt-0.5",children:""}),d]},p))})]}),l.jsx("button",{onClick:n,className:"w-full mt-5 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors sm:hidden",children:"Got it"})]})})},no=({metricKey:e,value:n,unit:a,status:o,subtitle:d,onInfoClick:p})=>{const f=Tte[e];if(!f)return null;const v=f.icon,E={normal:"emerald",low:"amber",high:"red",critical:"red"}[o]||"slate",T=n!=null&&n!=="";return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm group relative p-3 sm:p-5 hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[l.jsx("span",{className:"text-slate-500 text-xs sm:text-sm truncate pr-2",children:f.name}),l.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[l.jsx("button",{onClick:()=>p(e),className:"w-5 h-5 sm:w-6 sm:h-6 rounded-lg bg-slate-100 flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity hover:bg-slate-200",title:"Learn more",children:l.jsx(Xw,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5 text-cyan-500"})}),l.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-lg bg-${f.color}-100 flex items-center justify-center`,children:l.jsx(v,{className:`w-3 h-3 sm:w-4 sm:h-4 text-${f.color}-500`})})]})]}),l.jsx("div",{className:"flex items-baseline gap-1 sm:gap-2 flex-wrap",children:T?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:n}),l.jsx("span",{className:"text-slate-400 text-xs sm:text-sm",children:a||f.unit}),o&&l.jsx("span",{className:`text-${E}-600 text-[10px] sm:text-xs ml-auto px-1.5 sm:px-2 py-0.5 bg-${E}-100 rounded-full`,children:o.toUpperCase()})]}):l.jsx("span",{className:"text-slate-400 text-sm",children:"No data"})}),d&&l.jsx("p",{className:"text-slate-400 text-[10px] sm:text-xs mt-1 sm:mt-2 truncate",children:d})]})};function X7e(){var De,Se,we,qe,lt,Ut,Ht,Ue,dt;const{user:e}=ma(),{dashboardData:n,wearableData:a,nutritionData:o,loading:d,fetchDashboard:p,fetchWearable:f,fetchNutrition:v}=ZTe(),[b,E]=q.useState(null),[T,w]=q.useState(new Date().toISOString().split("T")[0]),[N,P]=q.useState(null),[A,k]=q.useState(null);q.useEffect(()=>{(async()=>{var Ke,bt;try{k(null),await Promise.all([p(),f()])}catch(Te){console.error("Failed to fetch dashboard:",Te),k(((bt=(Ke=Te.response)==null?void 0:Ke.data)==null?void 0:bt.message)||"Failed to load dashboard data")}})()},[p,f]),q.useEffect(()=>{(async()=>{const Ke=await v(T);P(Ke)})()},[T,v]);const I=d.dashboard||d.wearable,F=n,U=N||o;if(I)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your health data..."})]})});if(A)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-red-500 mb-4",children:A}),l.jsx("button",{onClick:fetchData,className:"px-6 py-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600",children:"Try Again"})]})});const{user:V,healthScores:W,latestAnalysis:B,recentReports:z}=F||{},Y=z&&z.length>0,re=((De=V==null?void 0:V.healthMetrics)==null?void 0:De.healthScore)||(B==null?void 0:B.healthScore)||null,Z=(B==null?void 0:B.metrics)||{},ie=Ne=>Ne==null?null:typeof Ne=="object"&&Ne.value!==void 0?Ne.value:Ne,te={vitaminD:ie(Z.vitaminD),vitaminB12:ie(Z.vitaminB12),iron:ie(Z.iron),calcium:ie(Z.calcium),hemoglobin:ie(Z.hemoglobin),bloodSugar:ie(Z.bloodSugar)||ie(Z.glucose),tsh:ie(Z.tsh)||ie(Z.thyroid),vitaminC:ie(Z.vitaminC),cholesterol:ie(Z.cholesterol)||ie(Z.totalCholesterol)},de=(a==null?void 0:a.connected)&&(a==null?void 0:a.todayMetrics),xe=(a==null?void 0:a.todayMetrics)||{steps:0,caloriesBurned:0},me=(a==null?void 0:a.recentHeartRate)||[],Ce=(a==null?void 0:a.recentSleep)||[],ue=me.length>0?Math.round(me.reduce((Ne,Ke)=>Ne+Ke.bpm,0)/me.length):null,be=Ce.length>0?(Ce.reduce((Ne,Ke)=>Ne+Ke.totalSleepMinutes,0)/Ce.length/60).toFixed(1):null,se=(W==null?void 0:W.length)>0?W.map(Ne=>({date:new Date(Ne.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Ne.score,type:Ne.type})):[],pe=(Ne,Ke,bt)=>{if(!Ne)return null;const Te=parseFloat(Ne);return Te<Ke*.7?"critical":Te<Ke?"low":Te>bt*1.3||Te>bt?"high":"normal"};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[b&&l.jsx(q7e,{metric:b,onClose:()=>E(null)}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-xl sm:text-3xl font-bold text-slate-800",children:["Welcome back, ",l.jsx("span",{className:"text-cyan-600",children:(Se=e==null?void 0:e.name)==null?void 0:Se.split(" ")[0]})]}),l.jsx("p",{className:"text-slate-500 mt-1 text-sm sm:text-base",children:"Your complete health overview. Tap the eye icon to learn more."})]}),l.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[l.jsxs(hn,{to:"/upload",className:"px-3 sm:px-6 py-2 sm:py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50 flex items-center gap-1 sm:gap-2 text-xs sm:text-base",children:[l.jsx(lo,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Upload Records"}),l.jsx("span",{className:"sm:hidden",children:"Upload"})]}),l.jsxs("button",{className:"px-3 sm:px-6 py-2 sm:py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-1 sm:gap-2 text-xs sm:text-base",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-3 h-3 sm:w-4 sm:h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Log Symptoms"}),l.jsx("span",{className:"sm:hidden",children:"Log"})]})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[Y&&re?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-4 mb-4",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Your overall health progress"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl sm:text-4xl font-bold text-slate-800",children:re}),l.jsx("span",{className:"text-slate-400 text-sm",children:"/100"}),se.length>1&&l.jsxs("span",{className:"text-emerald-500 text-xs sm:text-sm ml-2",children:[se[se.length-1].score>se[se.length-2].score?"+":"",se[se.length-1].score-se[se.length-2].score,"%"]})]})]}),se.length>0&&l.jsx(DS,{width:"100%",height:140,children:l.jsxs(wte,{data:se,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),l.jsx(_0,{strokeDasharray:"3 3",stroke:"#e2e8f0",vertical:!1}),l.jsx(Jd,{dataKey:"date",stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1}),l.jsx(Qd,{stroke:"#94a3b8",fontSize:10,tickLine:!1,axisLine:!1,domain:[50,100],hide:!0}),l.jsx(xs,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"12px"},labelStyle:{color:"#64748b"},formatter:Ne=>[`${Ne}/100`,"Score"]}),l.jsx(Gl,{type:"monotone",dataKey:"score",stroke:"#10b981",strokeWidth:2,fill:"url(#scoreGradient)"})]})})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-8 text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(Ca,{className:"w-8 h-8 text-slate-400"})}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No Health Data Yet"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload your first health report to see your personalized health score and track your progress over time."}),l.jsxs(hn,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(lo,{className:"w-4 h-4"}),"Upload Your First Report"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 sm:p-6",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{children:[l.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(zd,{className:"w-5 h-5 text-emerald-500"}),"Nutrition Tracker"]}),l.jsx("p",{className:"text-slate-500 text-xs sm:text-sm",children:"Daily calorie and macro tracking"})]})}),l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx("input",{type:"date",value:T,onChange:Ne=>w(Ne.target.value),className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"}),l.jsx("button",{onClick:()=>w(new Date().toISOString().split("T")[0]),className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg text-sm font-medium transition-colors",children:"Today"})]}),U?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Calories"}),l.jsxs("span",{className:"text-sm font-semibold text-slate-800",children:[U.totalCalories||0," / ",U.calorieGoal||1800]})]}),l.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:l.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.min((U.totalCalories||0)/(U.calorieGoal||1800)*100,100)}%`,backgroundColor:"#8B7355"}})}),!U.calorieGoal&&l.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:[l.jsx(hn,{to:"/profile",className:"underline",children:"Set your fitness goal"})," for personalized targets"]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[l.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Bx,{className:"w-3 h-3 text-blue-500"}),l.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Protein"})]}),l.jsxs("p",{className:"text-lg font-bold text-blue-700",children:[(U.totalProtein||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-blue-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-blue-500 h-1 rounded-full",style:{width:`${Math.min((U.totalProtein||0)/(U.proteinGoal||80)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-amber-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Bx,{className:"w-3 h-3 text-amber-500"}),l.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Carbs"})]}),l.jsxs("p",{className:"text-lg font-bold text-amber-700",children:[(U.totalCarbs||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-amber-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-amber-500 h-1 rounded-full",style:{width:`${Math.min((U.totalCarbs||0)/(U.carbsGoal||200)*100,100)}%`}})})]}),l.jsxs("div",{className:"bg-rose-50 rounded-xl p-3",children:[l.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[l.jsx(Bx,{className:"w-3 h-3 text-rose-500"}),l.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"Fats"})]}),l.jsxs("p",{className:"text-lg font-bold text-rose-700",children:[(U.totalFats||0).toFixed(2),"g"]}),l.jsx("div",{className:"w-full bg-rose-200 rounded-full h-1 mt-2",children:l.jsx("div",{className:"bg-rose-500 h-1 rounded-full",style:{width:`${Math.min((U.totalFats||0)/(U.fatsGoal||50)*100,100)}%`}})})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100",children:[l.jsx("span",{className:"text-sm text-slate-600",children:"Meals logged today"}),l.jsx("span",{className:"text-sm font-semibold text-slate-800",children:((we=U.mealsLogged)!=null&&we.breakfast?1:0)+((qe=U.mealsLogged)!=null&&qe.lunch?1:0)+((lt=U.mealsLogged)!=null&&lt.dinner?1:0)+(((Ut=U.mealsLogged)==null?void 0:Ut.snacks)||0)})]}),l.jsxs(hn,{to:"/nutrition",className:"w-full py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center justify-center gap-2 text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-4 h-4"}),"Log Meal"]})]}):l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-3",children:l.jsx(zd,{className:"w-6 h-6 text-slate-400"})}),l.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"No meals logged for this day"}),l.jsxs(hn,{to:"/nutrition",className:"inline-flex items-center gap-2 px-4 py-2 text-white rounded-xl font-medium hover:shadow-lg text-sm transition-all",style:{backgroundColor:"#8B7355"},children:[l.jsx(Wc,{className:"w-4 h-4"}),"Log Your First Meal"]})]})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-4 h-4 sm:w-5 sm:h-5 text-cyan-500"}),"Vital Signs & Activity"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"heartRate",value:ue,status:pe(ue,60,100),subtitle:de?"From wearable":"Connect device",onInfoClick:E}),l.jsx(no,{metricKey:"sleep",value:be,status:be?pe(parseFloat(be),7,9):null,subtitle:Ce.length>0?`${Ce.length} nights avg`:"Track sleep",onInfoClick:E}),l.jsx(no,{metricKey:"steps",value:xe.steps>0?xe.steps.toLocaleString():null,unit:"steps",status:xe.steps>=8e3?"normal":xe.steps>=5e3?"low":xe.steps>0?"critical":null,subtitle:de?`${xe.caloriesBurned} cal`:"Today",onInfoClick:E}),l.jsx(no,{metricKey:"cholesterol",value:te.cholesterol,status:pe(te.cholesterol,0,200),subtitle:"From blood work",onInfoClick:E})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(Qw,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-500"}),"Vitamins & Minerals"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"vitaminD",value:te.vitaminD,status:pe(te.vitaminD,30,100),subtitle:"Bone & immune health",onInfoClick:E}),l.jsx(no,{metricKey:"vitaminB12",value:te.vitaminB12,status:pe(te.vitaminB12,300,900),subtitle:"Energy & nerves",onInfoClick:E}),l.jsx(no,{metricKey:"iron",value:te.iron,status:pe(te.iron,60,170),subtitle:"Blood oxygen",onInfoClick:E}),l.jsx(no,{metricKey:"calcium",value:te.calcium,status:pe(te.calcium,8.5,10.5),subtitle:"Bones & teeth",onInfoClick:E})]})]}),l.jsxs("div",{children:[l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-800 mb-2 sm:mb-3 flex items-center gap-2",children:[l.jsx(qw,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-500"}),"Blood & Hormones"]}),l.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[l.jsx(no,{metricKey:"hemoglobin",value:te.hemoglobin,status:pe(te.hemoglobin,12,17),subtitle:"Oxygen carrier",onInfoClick:E}),l.jsx(no,{metricKey:"bloodSugar",value:te.bloodSugar,status:pe(te.bloodSugar,70,100),subtitle:"Fasting glucose",onInfoClick:E}),l.jsx(no,{metricKey:"thyroid",value:te.tsh,status:pe(te.tsh,.4,4),subtitle:"Metabolism control",onInfoClick:E}),l.jsx(no,{metricKey:"vitaminC",value:te.vitaminC,status:pe(te.vitaminC,.6,2),subtitle:"Immune & healing",onInfoClick:E})]})]}),Y&&se.length>1&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Ca,{className:"w-5 h-5 text-cyan-500"}),"Health Improvement Tracking"]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[l.jsx(ic,{className:"w-4 h-4"}),"Last updated: ",new Date().toLocaleDateString()]})]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Overall Trend"}),l.jsx(tTe,{className:"w-4 h-4 text-green-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-green-500",children:"Improved"}),l.jsx("span",{className:"text-xs text-slate-400",children:"vs last month"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Based on lab values and wearable data"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Stable Metrics"}),l.jsx(l2,{className:"w-4 h-4 text-blue-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"6"}),l.jsx("span",{className:"text-xs text-slate-400",children:"out of 12"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Maintaining healthy ranges"})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-slate-600 text-sm",children:"Needs Attention"}),l.jsx(Yw,{className:"w-4 h-4 text-yellow-500"})]}),l.jsxs("div",{className:"flex items-baseline gap-2",children:[l.jsx("span",{className:"text-2xl font-bold text-yellow-500",children:"2"}),l.jsx("span",{className:"text-xs text-slate-400",children:"metrics"})]}),l.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Vitamin D, Iron levels"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h4",{className:"text-slate-800 font-medium",children:"Lab Values Trend"}),l.jsxs("select",{className:"bg-slate-50 border border-slate-200 rounded-lg px-3 py-1 text-slate-700 text-sm",children:[l.jsx("option",{children:"Vitamin D"}),l.jsx("option",{children:"Iron"}),l.jsx("option",{children:"B12"}),l.jsx("option",{children:"Hemoglobin"})]})]}),l.jsx(DS,{width:"100%",height:200,children:l.jsxs(Ste,{data:se.map((Ne,Ke)=>({date:Ne.date,score:Ne.score})),children:[l.jsx(_0,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(Jd,{dataKey:"date",stroke:"#94a3b8",fontSize:12}),l.jsx(Qd,{stroke:"#94a3b8",fontSize:12}),l.jsx(xs,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"8px"},labelStyle:{color:"#64748b"}}),l.jsx(rg,{type:"monotone",dataKey:"score",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",strokeWidth:2}})]})}),l.jsxs("div",{className:"flex items-center gap-4 mt-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),l.jsx("span",{className:"text-slate-600",children:"Health Score Trend"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Lh,{className:"w-4 h-4 text-green-500"}),l.jsx("span",{className:"text-slate-500",children:"Target: 80+ score"})]})]})]}),(B==null?void 0:B.recommendations)&&l.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("h4",{className:"text-slate-800 font-medium mb-4 flex items-center gap-2",children:[l.jsx(RJ,{className:"w-5 h-5 text-cyan-500"}),"Personalized Recommendations"]}),l.jsx("div",{className:"space-y-3",children:(Ht=B.recommendations.lifestyle)==null?void 0:Ht.slice(0,3).map((Ne,Ke)=>l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-lg",children:[l.jsx(bi,{className:"w-5 h-5 text-green-500 mt-0.5 shrink-0"}),l.jsx("div",{children:l.jsx("p",{className:"text-slate-800 font-medium text-sm",children:Ne})})]},Ke))})]})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsxs("div",{className:"rounded-2xl p-6",style:{backgroundColor:"#F5F1EA",border:"2px solid #E5DFD3"},children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("div",{className:"px-3 py-1 rounded-full flex items-center gap-2",style:{backgroundColor:"#E5DFD3"},children:[l.jsx(Hd,{className:"w-4 h-4 text-cyan-600"}),l.jsx("span",{className:"text-cyan-700 text-sm font-medium",children:"AI ANALYSIS"})]})}),l.jsx("span",{className:"text-slate-500 text-sm",children:B?"Based on your reports":"No reports yet"})]}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-3",children:((Ue=B==null?void 0:B.summary)==null?void 0:Ue.split(".")[0])||"Upload a health report to get AI insights"}),l.jsx("p",{className:"text-slate-600 mb-6",children:B?B.summary:"Our AI will analyze your health reports and provide personalized insights, recommendations, and track your health trends over time."}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[!Y&&l.jsxs(hn,{to:"/upload",className:"px-6 py-2 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2",style:{backgroundColor:"#8B7355"},children:[l.jsx(lo,{className:"w-4 h-4"}),"Upload Your First Report"]}),de&&l.jsx(hn,{to:"/wearables",className:"px-6 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-50",children:"View Wearable Data"})]})]}),((dt=B==null?void 0:B.keyFindings)==null?void 0:dt.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Key Findings from Your Reports"}),l.jsx("div",{className:"space-y-3",children:B.keyFindings.slice(0,4).map((Ne,Ke)=>{const bt=typeof Ne=="string"?Ne:Ne.title||Ne.finding||JSON.stringify(Ne),Te=typeof Ne=="object"?Ne.description:null,gt=typeof Ne=="object"?Ne.severity:"low";return l.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 rounded-xl",children:[l.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${gt==="high"?"bg-red-500":gt==="medium"?"bg-amber-500":"bg-emerald-500"}`}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-medium",children:bt}),Te&&l.jsx("p",{className:"text-slate-500 text-sm mt-1",children:Te})]})]},Ke)})})]})]}),l.jsx("div",{className:"space-y-6",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"font-semibold text-slate-800",children:"Recent Reports"}),l.jsx(hn,{to:"/profile",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"View All"})]}),l.jsx("div",{className:"space-y-3",children:(z==null?void 0:z.length)>0?z.slice(0,3).map(Ne=>l.jsxs(hn,{to:`/reports/${Ne._id}`,className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-red-500"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-slate-800 font-medium truncate",children:Ne.reportType}),l.jsx("p",{className:"text-slate-400 text-sm",children:new Date(Ne.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ne.status==="completed"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"}`,children:Ne.status==="completed"?"ANALYZED":"PENDING"})]},Ne._id)):l.jsxs("div",{className:"text-center py-4",children:[l.jsx(li,{className:"w-10 h-10 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No reports uploaded yet"}),l.jsx(hn,{to:"/upload",className:"text-cyan-500 text-sm hover:text-cyan-600",children:"+ Upload Report"})]})})]})})]})]})}function J7e(){var E,T;const{user:e}=ma(),[n,a]=q.useState(null),[o,d]=q.useState(!0);if(q.useEffect(()=>{(async()=>{try{const{data:N}=await Ja.getDashboard();a(N)}catch(N){console.error("Failed to fetch dashboard:",N)}finally{d(!1)}})()},[]),o)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading dashboard..."})]})});const{doctor:p,stats:f,todaySchedule:v,upcomingSchedule:b}=n||{};return(p==null?void 0:p.approvalStatus)==="pending"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(ic,{className:"w-8 h-8 text-amber-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Approval Pending"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Your profile is under review. You'll be notified once approved."}),l.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium",children:[l.jsx(Aa,{className:"w-4 h-4"})," Pending Review"]})]})}):(p==null?void 0:p.approvalStatus)==="rejected"?l.jsx("div",{className:"max-w-lg mx-auto mt-20",children:l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center shadow-sm",children:[l.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(BJ,{className:"w-8 h-8 text-red-500"})}),l.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"Application Rejected"}),l.jsx("p",{className:"text-slate-500",children:"Please contact support for more information."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["Welcome, Dr. ",(E=p==null?void 0:p.name)==null?void 0:E.split(" ")[0],"! "]}),l.jsx("p",{className:"text-slate-500 mt-1",children:p==null?void 0:p.specialization})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs(hn,{to:"/doctor/availability",className:"flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-all",children:[l.jsx(Gf,{className:"w-4 h-4"})," Manage Slots"]}),p!=null&&p.isListed?l.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4"})," Listed"]}):l.jsxs("span",{className:"px-3 py-2 bg-amber-100 text-amber-700 rounded-xl text-sm font-medium flex items-center gap-1",children:[l.jsx(Aa,{className:"w-4 h-4"})," Not Listed"]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(ji,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.todayAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Today"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(Ca,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.upcomingAppointments)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Upcoming"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(of,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:(f==null?void 0:f.totalPatients)||0}),l.jsx("p",{className:"text-sm text-slate-500",children:"Patients"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(zc,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((T=p==null?void 0:p.rating)==null?void 0:T.toFixed(1))||"0.0"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Rating"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-cyan-500"})," Today's Schedule"]})}),(v==null?void 0:v.length)>0?l.jsx("div",{className:"space-y-3",children:v.map(w=>{var N,P,A,k,I;return l.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center text-cyan-600 font-bold",children:((A=(P=(N=w.patient)==null?void 0:N.name)==null?void 0:P[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(k=w.patient)==null?void 0:k.name}),l.jsx("p",{className:"text-sm text-slate-500",children:w.timeSlot})]})]}),l.jsxs(hn,{to:`/patient/${(I=w.patient)==null?void 0:I._id}?appointmentId=${w._id}`,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 transition-all text-sm flex items-center gap-1",children:[l.jsx(Xw,{className:"w-4 h-4"})," View"]})]},w._id)})}):l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(ji,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No appointments today"})]})]}),(b==null?void 0:b.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ic,{className:"w-5 h-5 text-green-500"})," Upcoming Appointments"]}),l.jsx("div",{className:"space-y-3",children:b.slice(0,5).map(w=>{var N,P,A,k;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl flex items-center justify-between",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center text-green-600 font-bold",children:((A=(P=(N=w.patient)==null?void 0:N.name)==null?void 0:P[0])==null?void 0:A.toUpperCase())||"P"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-slate-800",children:(k=w.patient)==null?void 0:k.name}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(w.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",w.timeSlot]})]})]})},w._id)})})]})]})}function qh(e,n,a,o){function d(p){return p instanceof a?p:new a(function(f){f(p)})}return new(a||(a=Promise))(function(p,f){function v(T){try{E(o.next(T))}catch(w){f(w)}}function b(T){try{E(o.throw(T))}catch(w){f(w)}}function E(T){T.done?p(T.value):d(T.value).then(v,b)}E((o=o.apply(e,n||[])).next())})}const Q7e=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Pf(e,n,a){const o=Z7e(e),{webkitRelativePath:d}=e,p=typeof n=="string"?n:typeof d=="string"&&d.length>0?d:`./${e.name}`;return typeof o.path!="string"&&gY(o,"path",p),gY(o,"relativePath",p),o}function Z7e(e){const{name:n}=e;if(n&&n.lastIndexOf(".")!==-1&&!e.type){const o=n.split(".").pop().toLowerCase(),d=Q7e.get(o);d&&Object.defineProperty(e,"type",{value:d,writable:!1,configurable:!1,enumerable:!0})}return e}function gY(e,n,a){Object.defineProperty(e,n,{value:a,writable:!1,configurable:!1,enumerable:!0})}const eze=[".DS_Store","Thumbs.db"];function tze(e){return qh(this,void 0,void 0,function*(){return bw(e)&&nze(e.dataTransfer)?sze(e.dataTransfer,e.type):rze(e)?ize(e):Array.isArray(e)&&e.every(n=>"getFile"in n&&typeof n.getFile=="function")?aze(e):[]})}function nze(e){return bw(e)}function rze(e){return bw(e)&&bw(e.target)}function bw(e){return typeof e=="object"&&e!==null}function ize(e){return XD(e.target.files).map(n=>Pf(n))}function aze(e){return qh(this,void 0,void 0,function*(){return(yield Promise.all(e.map(a=>a.getFile()))).map(a=>Pf(a))})}function sze(e,n){return qh(this,void 0,void 0,function*(){if(e.items){const a=XD(e.items).filter(d=>d.kind==="file");if(n!=="drop")return a;const o=yield Promise.all(a.map(oze));return vY(Cte(o))}return vY(XD(e.files).map(a=>Pf(a)))})}function vY(e){return e.filter(n=>eze.indexOf(n.name)===-1)}function XD(e){if(e===null)return[];const n=[];for(let a=0;a<e.length;a++){const o=e[a];n.push(o)}return n}function oze(e){if(typeof e.webkitGetAsEntry!="function")return yY(e);const n=e.webkitGetAsEntry();return n&&n.isDirectory?Nte(n):yY(e,n)}function Cte(e){return e.reduce((n,a)=>[...n,...Array.isArray(a)?Cte(a):[a]],[])}function yY(e,n){return qh(this,void 0,void 0,function*(){var a;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const p=yield e.getAsFileSystemHandle();if(p===null)throw new Error(`${e} is not a File`);if(p!==void 0){const f=yield p.getFile();return f.handle=p,Pf(f)}}const o=e.getAsFile();if(!o)throw new Error(`${e} is not a File`);return Pf(o,(a=n==null?void 0:n.fullPath)!==null&&a!==void 0?a:void 0)})}function cze(e){return qh(this,void 0,void 0,function*(){return e.isDirectory?Nte(e):lze(e)})}function Nte(e){const n=e.createReader();return new Promise((a,o)=>{const d=[];function p(){n.readEntries(f=>qh(this,void 0,void 0,function*(){if(f.length){const v=Promise.all(f.map(cze));d.push(v),p()}else try{const v=yield Promise.all(d);a(v)}catch(v){o(v)}}),f=>{o(f)})}p()})}function lze(e){return qh(this,void 0,void 0,function*(){return new Promise((n,a)=>{e.file(o=>{const d=Pf(o,e.fullPath);n(d)},o=>{a(o)})})})}var u1=function(e,n){if(e&&n){var a=Array.isArray(n)?n:n.split(",");if(a.length===0)return!0;var o=e.name||"",d=(e.type||"").toLowerCase(),p=d.replace(/\/.*$/,"");return a.some(function(f){var v=f.trim().toLowerCase();return v.charAt(0)==="."?o.toLowerCase().endsWith(v):v.endsWith("/*")?p===v.replace(/\/.*$/,""):d===v})}return!0};function _Y(e){return hze(e)||uze(e)||Ate(e)||dze()}function dze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hze(e){if(Array.isArray(e))return JD(e)}function bY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function EY(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?bY(Object(a),!0).forEach(function(o){Rte(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function Rte(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function x0(e,n){return fze(e)||mze(e,n)||Ate(e,n)||pze()}function pze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ate(e,n){if(e){if(typeof e=="string")return JD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return JD(e,n)}}function JD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function mze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,p=!1,f,v;try{for(a=a.call(e);!(d=(f=a.next()).done)&&(o.push(f.value),!(n&&o.length===n));d=!0);}catch(b){p=!0,v=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(p)throw v}}return o}}function fze(e){if(Array.isArray(e))return e}var gze=typeof u1=="function"?u1:u1.default,vze="file-invalid-type",yze="file-too-large",_ze="file-too-small",bze="too-many-files",Eze=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=n.split(","),o=a.length>1?"one of ".concat(a.join(", ")):a[0];return{code:vze,message:"File type must be ".concat(o)}},xY=function(n){return{code:yze,message:"File is larger than ".concat(n," ").concat(n===1?"byte":"bytes")}},SY=function(n){return{code:_ze,message:"File is smaller than ".concat(n," ").concat(n===1?"byte":"bytes")}},xze={code:bze,message:"Too many files"};function Ite(e,n){var a=e.type==="application/x-moz-file"||gze(e,n);return[a,a?null:Eze(n)]}function Ote(e,n,a){if(ph(e.size))if(ph(n)&&ph(a)){if(e.size>a)return[!1,xY(a)];if(e.size<n)return[!1,SY(n)]}else{if(ph(n)&&e.size<n)return[!1,SY(n)];if(ph(a)&&e.size>a)return[!1,xY(a)]}return[!0,null]}function ph(e){return e!=null}function Sze(e){var n=e.files,a=e.accept,o=e.minSize,d=e.maxSize,p=e.multiple,f=e.maxFiles,v=e.validator;return!p&&n.length>1||p&&f>=1&&n.length>f?!1:n.every(function(b){var E=Ite(b,a),T=x0(E,1),w=T[0],N=Ote(b,o,d),P=x0(N,1),A=P[0],k=v?v(b):null;return w&&A&&!k})}function Ew(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function xx(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(n){return n==="Files"||n==="application/x-moz-file"}):!!e.target&&!!e.target.files}function wY(e){e.preventDefault()}function wze(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function Tze(e){return e.indexOf("Edge/")!==-1}function Cze(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return wze(e)||Tze(e)}function kc(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(o){for(var d=arguments.length,p=new Array(d>1?d-1:0),f=1;f<d;f++)p[f-1]=arguments[f];return n.some(function(v){return!Ew(o)&&v&&v.apply(void 0,[o].concat(p)),Ew(o)})}}function Nze(){return"showOpenFilePicker"in window}function Rze(e){if(ph(e)){var n=Object.entries(e).filter(function(a){var o=x0(a,2),d=o[0],p=o[1],f=!0;return Pte(d)||(console.warn('Skipped "'.concat(d,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),f=!1),(!Array.isArray(p)||!p.every(Dte))&&(console.warn('Skipped "'.concat(d,'" because an invalid file extension was provided.')),f=!1),f}).reduce(function(a,o){var d=x0(o,2),p=d[0],f=d[1];return EY(EY({},a),{},Rte({},p,f))},{});return[{description:"Files",accept:n}]}return e}function Aze(e){if(ph(e))return Object.entries(e).reduce(function(n,a){var o=x0(a,2),d=o[0],p=o[1];return[].concat(_Y(n),[d],_Y(p))},[]).filter(function(n){return Pte(n)||Dte(n)}).join(",")}function Ize(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Oze(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function Pte(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function Dte(e){return/^.*\.[\w]+$/.test(e)}var Pze=["children"],Dze=["open"],kze=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],jze=["refKey","onChange","onClick"];function Lze(e){return Fze(e)||Uze(e)||kte(e)||Mze()}function Mze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Uze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Fze(e){if(Array.isArray(e))return QD(e)}function h1(e,n){return Gze(e)||Bze(e,n)||kte(e,n)||Vze()}function Vze(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kte(e,n){if(e){if(typeof e=="string")return QD(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor&&(a=e.constructor.name),a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return QD(e,n)}}function QD(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=e[a];return o}function Bze(e,n){var a=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(a!=null){var o=[],d=!0,p=!1,f,v;try{for(a=a.call(e);!(d=(f=a.next()).done)&&(o.push(f.value),!(n&&o.length===n));d=!0);}catch(b){p=!0,v=b}finally{try{!d&&a.return!=null&&a.return()}finally{if(p)throw v}}return o}}function Gze(e){if(Array.isArray(e))return e}function TY(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),a.push.apply(a,o)}return a}function Vr(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?TY(Object(a),!0).forEach(function(o){ZD(e,o,a[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):TY(Object(a)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(a,o))})}return e}function ZD(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function xw(e,n){if(e==null)return{};var a=Wze(e,n),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(d=0;d<p.length;d++)o=p[d],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}function Wze(e,n){if(e==null)return{};var a={},o=Object.keys(e),d,p;for(p=0;p<o.length;p++)d=o[p],!(n.indexOf(d)>=0)&&(a[d]=e[d]);return a}var yj=q.forwardRef(function(e,n){var a=e.children,o=xw(e,Pze),d=Lte(o),p=d.open,f=xw(d,Dze);return q.useImperativeHandle(n,function(){return{open:p}},[p]),fe.createElement(q.Fragment,null,a(Vr(Vr({},f),{},{open:p})))});yj.displayName="Dropzone";var jte={disabled:!1,getFilesFromEvent:tze,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};yj.defaultProps=jte;yj.propTypes={children:jt.func,accept:jt.objectOf(jt.arrayOf(jt.string)),multiple:jt.bool,preventDropOnDocument:jt.bool,noClick:jt.bool,noKeyboard:jt.bool,noDrag:jt.bool,noDragEventsBubbling:jt.bool,minSize:jt.number,maxSize:jt.number,maxFiles:jt.number,disabled:jt.bool,getFilesFromEvent:jt.func,onFileDialogCancel:jt.func,onFileDialogOpen:jt.func,useFsAccessApi:jt.bool,autoFocus:jt.bool,onDragEnter:jt.func,onDragLeave:jt.func,onDragOver:jt.func,onDrop:jt.func,onDropAccepted:jt.func,onDropRejected:jt.func,onError:jt.func,validator:jt.func};var ek={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Lte(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Vr(Vr({},jte),e),a=n.accept,o=n.disabled,d=n.getFilesFromEvent,p=n.maxSize,f=n.minSize,v=n.multiple,b=n.maxFiles,E=n.onDragEnter,T=n.onDragLeave,w=n.onDragOver,N=n.onDrop,P=n.onDropAccepted,A=n.onDropRejected,k=n.onFileDialogCancel,I=n.onFileDialogOpen,F=n.useFsAccessApi,U=n.autoFocus,V=n.preventDropOnDocument,W=n.noClick,B=n.noKeyboard,z=n.noDrag,Y=n.noDragEventsBubbling,re=n.onError,Z=n.validator,ie=q.useMemo(function(){return Aze(a)},[a]),te=q.useMemo(function(){return Rze(a)},[a]),de=q.useMemo(function(){return typeof I=="function"?I:CY},[I]),xe=q.useMemo(function(){return typeof k=="function"?k:CY},[k]),me=q.useRef(null),Ce=q.useRef(null),ue=q.useReducer($ze,ek),be=h1(ue,2),se=be[0],pe=be[1],De=se.isFocused,Se=se.isFileDialogActive,we=q.useRef(typeof window<"u"&&window.isSecureContext&&F&&Nze()),qe=function(){!we.current&&Se&&setTimeout(function(){if(Ce.current){var Lt=Ce.current.files;Lt.length||(pe({type:"closeDialog"}),xe())}},300)};q.useEffect(function(){return window.addEventListener("focus",qe,!1),function(){window.removeEventListener("focus",qe,!1)}},[Ce,Se,xe,we]);var lt=q.useRef([]),Ut=function(Lt){me.current&&me.current.contains(Lt.target)||(Lt.preventDefault(),lt.current=[])};q.useEffect(function(){return V&&(document.addEventListener("dragover",wY,!1),document.addEventListener("drop",Ut,!1)),function(){V&&(document.removeEventListener("dragover",wY),document.removeEventListener("drop",Ut))}},[me,V]),q.useEffect(function(){return!o&&U&&me.current&&me.current.focus(),function(){}},[me,U,o]);var Ht=q.useCallback(function(nt){re?re(nt):console.error(nt)},[re]),Ue=q.useCallback(function(nt){nt.preventDefault(),nt.persist(),ui(nt),lt.current=[].concat(Lze(lt.current),[nt.target]),xx(nt)&&Promise.resolve(d(nt)).then(function(Lt){if(!(Ew(nt)&&!Y)){var fr=Lt.length,Wn=fr>0&&Sze({files:Lt,accept:ie,minSize:f,maxSize:p,multiple:v,maxFiles:b,validator:Z}),Ye=fr>0&&!Wn;pe({isDragAccept:Wn,isDragReject:Ye,isDragActive:!0,type:"setDraggedFiles"}),E&&E(nt)}}).catch(function(Lt){return Ht(Lt)})},[d,E,Ht,Y,ie,f,p,v,b,Z]),dt=q.useCallback(function(nt){nt.preventDefault(),nt.persist(),ui(nt);var Lt=xx(nt);if(Lt&&nt.dataTransfer)try{nt.dataTransfer.dropEffect="copy"}catch{}return Lt&&w&&w(nt),!1},[w,Y]),Ne=q.useCallback(function(nt){nt.preventDefault(),nt.persist(),ui(nt);var Lt=lt.current.filter(function(Wn){return me.current&&me.current.contains(Wn)}),fr=Lt.indexOf(nt.target);fr!==-1&&Lt.splice(fr,1),lt.current=Lt,!(Lt.length>0)&&(pe({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),xx(nt)&&T&&T(nt))},[me,T,Y]),Ke=q.useCallback(function(nt,Lt){var fr=[],Wn=[];nt.forEach(function(Ye){var St=Ite(Ye,ie),Dn=h1(St,2),ni=Dn[0],ka=Dn[1],Zi=Ote(Ye,f,p),gr=h1(Zi,2),Xr=gr[0],lu=gr[1],du=Z?Z(Ye):null;if(ni&&Xr&&!du)fr.push(Ye);else{var cc=[ka,lu];du&&(cc=cc.concat(du)),Wn.push({file:Ye,errors:cc.filter(function(W0){return W0})})}}),(!v&&fr.length>1||v&&b>=1&&fr.length>b)&&(fr.forEach(function(Ye){Wn.push({file:Ye,errors:[xze]})}),fr.splice(0)),pe({acceptedFiles:fr,fileRejections:Wn,isDragReject:Wn.length>0,type:"setFiles"}),N&&N(fr,Wn,Lt),Wn.length>0&&A&&A(Wn,Lt),fr.length>0&&P&&P(fr,Lt)},[pe,v,ie,f,p,b,N,P,A,Z]),bt=q.useCallback(function(nt){nt.preventDefault(),nt.persist(),ui(nt),lt.current=[],xx(nt)&&Promise.resolve(d(nt)).then(function(Lt){Ew(nt)&&!Y||Ke(Lt,nt)}).catch(function(Lt){return Ht(Lt)}),pe({type:"reset"})},[d,Ke,Ht,Y]),Te=q.useCallback(function(){if(we.current){pe({type:"openDialog"}),de();var nt={multiple:v,types:te};window.showOpenFilePicker(nt).then(function(Lt){return d(Lt)}).then(function(Lt){Ke(Lt,null),pe({type:"closeDialog"})}).catch(function(Lt){Ize(Lt)?(xe(Lt),pe({type:"closeDialog"})):Oze(Lt)?(we.current=!1,Ce.current?(Ce.current.value=null,Ce.current.click()):Ht(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Ht(Lt)});return}Ce.current&&(pe({type:"openDialog"}),de(),Ce.current.value=null,Ce.current.click())},[pe,de,xe,F,Ke,Ht,te,v]),gt=q.useCallback(function(nt){!me.current||!me.current.isEqualNode(nt.target)||(nt.key===" "||nt.key==="Enter"||nt.keyCode===32||nt.keyCode===13)&&(nt.preventDefault(),Te())},[me,Te]),Qe=q.useCallback(function(){pe({type:"focus"})},[]),Ft=q.useCallback(function(){pe({type:"blur"})},[]),At=q.useCallback(function(){W||(Cze()?setTimeout(Te,0):Te())},[W,Te]),ye=function(Lt){return o?null:Lt},et=function(Lt){return B?null:ye(Lt)},zt=function(Lt){return z?null:ye(Lt)},ui=function(Lt){Y&&Lt.stopPropagation()},fa=q.useMemo(function(){return function(){var nt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Lt=nt.refKey,fr=Lt===void 0?"ref":Lt,Wn=nt.role,Ye=nt.onKeyDown,St=nt.onFocus,Dn=nt.onBlur,ni=nt.onClick,ka=nt.onDragEnter,Zi=nt.onDragOver,gr=nt.onDragLeave,Xr=nt.onDrop,lu=xw(nt,kze);return Vr(Vr(ZD({onKeyDown:et(kc(Ye,gt)),onFocus:et(kc(St,Qe)),onBlur:et(kc(Dn,Ft)),onClick:ye(kc(ni,At)),onDragEnter:zt(kc(ka,Ue)),onDragOver:zt(kc(Zi,dt)),onDragLeave:zt(kc(gr,Ne)),onDrop:zt(kc(Xr,bt)),role:typeof Wn=="string"&&Wn!==""?Wn:"presentation"},fr,me),!o&&!B?{tabIndex:0}:{}),lu)}},[me,gt,Qe,Ft,At,Ue,dt,Ne,bt,B,z,o]),Da=q.useCallback(function(nt){nt.stopPropagation()},[]),oc=q.useMemo(function(){return function(){var nt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Lt=nt.refKey,fr=Lt===void 0?"ref":Lt,Wn=nt.onChange,Ye=nt.onClick,St=xw(nt,jze),Dn=ZD({accept:ie,multiple:v,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:ye(kc(Wn,bt)),onClick:ye(kc(Ye,Da)),tabIndex:-1},fr,Ce);return Vr(Vr({},Dn),St)}},[Ce,a,v,bt,o]);return Vr(Vr({},se),{},{isFocused:De&&!o,getRootProps:fa,getInputProps:oc,rootRef:me,inputRef:Ce,open:ye(Te)})}function $ze(e,n){switch(n.type){case"focus":return Vr(Vr({},e),{},{isFocused:!0});case"blur":return Vr(Vr({},e),{},{isFocused:!1});case"openDialog":return Vr(Vr({},ek),{},{isFileDialogActive:!0});case"closeDialog":return Vr(Vr({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return Vr(Vr({},e),{},{isDragActive:n.isDragActive,isDragAccept:n.isDragAccept,isDragReject:n.isDragReject});case"setFiles":return Vr(Vr({},e),{},{acceptedFiles:n.acceptedFiles,fileRejections:n.fileRejections,isDragReject:n.isDragReject});case"reset":return Vr({},ek);default:return e}}function CY(){}const Hze=[{value:"Blood Test",label:"Blood Test"},{value:"X-Ray",label:"X-Ray"},{value:"MRI",label:"MRI"},{value:"CT Scan",label:"CT Scan"},{value:"ECG",label:"ECG"},{value:"Ultrasound",label:"Ultrasound"},{value:"General Checkup",label:"General Checkup"},{value:"Other",label:"Other"}];function zze(){const[e,n]=q.useState([]),[a,o]=q.useState(!1),[d,p]=q.useState(0),[f,v]=q.useState(!1),b=Is(),E=q.useCallback(async V=>{var B,z;v(!0),o(!0),p(0);const W=setInterval(()=>{p(Y=>Y>=90?(clearInterval(W),90):Y+10)},500);try{const Y=new FormData;Y.append("report",V.file),Y.append("reportType",V.reportType);const{data:re}=await Nh.uploadReport(Y);clearInterval(W),p(100),it.success("Report analyzed successfully!"),setTimeout(()=>b(`/reports/${re.report._id}`),500)}catch(Y){clearInterval(W),console.error("Upload error:",Y),it.error(((z=(B=Y.response)==null?void 0:B.data)==null?void 0:z.message)||"Failed to analyze report"),p(0),v(!1),o(!1)}},[b]),T=q.useCallback(V=>{if(V.length>0){const W={file:V[0],id:Math.random().toString(36).substring(2,11),reportType:"Blood Test",name:V[0].name,size:V[0].size};n([W]),E(W)}},[E]),{getRootProps:w,getInputProps:N,isDragActive:P}=Lte({onDrop:T,accept:{"application/pdf":[".pdf"],"image/*":[".png",".jpg",".jpeg"]},maxSize:10*1024*1024}),A=(V,W)=>{const B=e.map(z=>z.id===V?{...z,reportType:W}:z);if(n(B),!f&&!a){const z=B.find(Y=>Y.id===V);z&&E(z)}},k=V=>{!f&&!a&&n(W=>W.filter(B=>B.id!==V))},F=(e.reduce((V,W)=>V+W.size,0)/(1024*1024)).toFixed(1),U=100;return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Upload Medical Reports"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Upload your medical documents for AI-powered analysis"})]}),l.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-cyan-500 to-blue-500 p-6 sm:p-8",children:l.jsxs("div",{className:"text-white max-w-2xl",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",children:"How It Works"}),l.jsx("p",{className:"text-white/90 text-sm",children:"Upload your medical reports and get instant AI-powered analysis with personalized health insights"})]})}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[l.jsxs("div",{...w(),className:`relative border-2 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all ${P?"border-cyan-500 bg-cyan-50":"border-slate-300 hover:border-cyan-400 bg-white"}`,children:[l.jsx("input",{...N()}),l.jsx("div",{className:"w-16 h-16 rounded-2xl bg-cyan-100 flex items-center justify-center mx-auto mb-4",children:l.jsx(lo,{className:"w-8 h-8 text-cyan-600"})}),l.jsx("p",{className:"text-lg font-semibold text-slate-800 mb-2",children:P?"Drop your files here":"Drag & drop files here"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"or click to browse from your device"}),l.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-slate-600",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4 text-emerald-500"})," PDF"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4 text-emerald-500"})," PNG"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4 text-emerald-500"})," JPG"]}),l.jsx("span",{children:"Max 10MB per file"})]})]}),e.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm",children:[l.jsx("div",{className:"p-4 border-b border-slate-200",children:l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Uploaded Files (",e.length,")"]})}),l.jsx("div",{className:"divide-y divide-slate-200",children:e.map(V=>l.jsxs("div",{className:"p-4 flex items-center gap-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-cyan-600"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"font-medium text-slate-800 truncate",children:V.name}),l.jsxs("p",{className:"text-sm text-slate-500",children:[(V.size/1024/1024).toFixed(2)," MB"]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("select",{value:V.reportType,onChange:W=>A(V.id,W.target.value),disabled:f||a,className:"appearance-none bg-white text-slate-800 text-sm px-4 py-2 pr-8 rounded-xl border border-slate-300 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:Hze.map(W=>l.jsx("option",{value:W.value,children:W.label},W.value))}),l.jsx(o2,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]}),l.jsx("button",{onClick:()=>k(V.id),disabled:f||a,className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:l.jsx(SP,{className:"w-5 h-5"})})]},V.id))})]}),(a||f)&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(vTe,{className:"w-5 h-5 text-cyan-600 animate-spin"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:"Analyzing your report..."}),l.jsx("p",{className:"text-sm text-slate-500",children:"AI is extracting health insights"})]})]}),l.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500",style:{width:`${d}%`}})}),l.jsxs("p",{className:"text-sm text-slate-500 mt-2 text-right",children:[d,"%"]})]}),!f&&!a&&e.length>0&&l.jsxs("button",{onClick:()=>{e.length>0&&E(e[0])},className:"w-full py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[l.jsx(lo,{className:"w-5 h-5"}),"Analyze Report"]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:l.jsx(dTe,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:"Storage"}),l.jsxs("p",{className:"text-sm text-slate-500",children:[F," MB of ",U," MB"]})]})]}),l.jsx("div",{className:"h-2 bg-slate-200 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full",style:{width:`${parseFloat(F)/U*100}%`}})})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h3",{className:"font-semibold text-slate-800 mb-4",children:"Recent Uploads"}),l.jsx("div",{className:"space-y-3",children:e.length===0?l.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No files uploaded yet"}):e.slice(0,3).map(V=>l.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-600"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm text-slate-800 truncate",children:V.name}),l.jsx("p",{className:"text-xs text-slate-500",children:V.reportType})]})]},V.id))})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx(vS,{className:"w-5 h-5 text-emerald-500"}),l.jsx("span",{className:"font-semibold text-slate-800",children:"Secure Upload"})]}),l.jsx("p",{className:"text-sm text-slate-600",children:"Your files are encrypted end-to-end and stored securely. We comply with HIPAA regulations."})]})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-slate-500 pt-4",children:[l.jsx(vS,{className:"w-4 h-4"}),l.jsx("span",{children:"End-to-end Encrypted & HIPAA Compliant"})]})]})}function Kze({vital:e,onClose:n}){const[a,o]=q.useState("overview");if(!e)return null;const{name:d,value:p,unit:f,normalRange:v,status:b,description:E,recommendations:T,foodsToConsume:w,foodsToAvoid:N,symptoms:P,severity:A}=e,I=(z=>{if(!z)return{min:0,max:100};const Y=z.split("-").map(re=>parseFloat(re.trim()));return{min:Y[0],max:Y[1]}})(v),F=parseFloat(p),U=()=>F<I.min?0:F>I.max?100:(F-I.min)/(I.max-I.min)*100,W=b==="normal"?{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-700",badge:"bg-emerald-100"}:b==="borderline"?{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700",badge:"bg-amber-100"}:{bg:"bg-red-50",border:"border-red-200",text:"text-red-700",badge:"bg-red-100"},B=U();return l.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:`${W.bg} border-b-2 ${W.border} p-6 flex items-center justify-between sticky top-0`,children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:`w-12 h-12 rounded-xl ${W.badge} flex items-center justify-center`,children:[b==="normal"&&l.jsx(bi,{className:`w-6 h-6 ${W.text}`}),b==="borderline"&&l.jsx(Aa,{className:`w-6 h-6 ${W.text}`}),b==="high"&&l.jsx(Ca,{className:`w-6 h-6 ${W.text}`})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:d}),l.jsx("p",{className:`text-sm ${W.text} font-medium capitalize`,children:b})]})]}),l.jsx("button",{onClick:n,className:"p-2 hover:bg-white/50 rounded-lg transition-colors",children:l.jsx(Ji,{className:"w-6 h-6 text-slate-600"})})]}),l.jsxs("div",{className:"p-6 space-y-6",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 border border-slate-200",children:[l.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Your Value"}),l.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[p," ",l.jsx("span",{className:"text-sm text-slate-500",children:f})]})]}),l.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[l.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Normal Range"}),l.jsx("p",{className:"text-2xl font-bold text-blue-700",children:v})]}),l.jsxs("div",{className:`${W.bg} rounded-xl p-4 border-2 ${W.border}`,children:[l.jsx("p",{className:`text-xs ${W.text} font-medium mb-1`,children:"Status"}),l.jsx("p",{className:`text-2xl font-bold ${W.text} capitalize`,children:b})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Range Indicator"}),l.jsxs("div",{className:"relative h-12 bg-gradient-to-r from-red-200 via-amber-200 to-emerald-200 rounded-xl overflow-hidden border-2 border-slate-200",children:[l.jsx("div",{className:"absolute top-0 bottom-0 bg-white/40 border-l-2 border-r-2 border-blue-500",style:{left:`${I.min/(I.max*1.2)*100}%`,right:`${100-I.max/(I.max*1.2)*100}%`}}),l.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-full bg-slate-800 border-2 border-white shadow-lg",style:{left:`${B}%`},children:l.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 left-0 w-8 h-8 bg-slate-800 rounded-full border-4 border-white shadow-lg"})})]}),l.jsxs("div",{className:"flex justify-between text-xs text-slate-600 font-medium",children:[l.jsx("span",{children:"Low"}),l.jsx("span",{children:"Normal"}),l.jsx("span",{children:"High"})]})]})]}),l.jsx("div",{className:"flex gap-2 border-b border-slate-200",children:[{id:"overview",label:"Overview"},{id:"recommendations",label:"What to Do"},{id:"foods",label:"Foods & Diet"}].map(z=>l.jsx("button",{onClick:()=>o(z.id),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${a===z.id?"border-cyan-500 text-cyan-600":"border-transparent text-slate-600 hover:text-slate-800"}`,children:z.label},z.id))}),l.jsxs("div",{className:"space-y-4",children:[a==="overview"&&l.jsxs("div",{className:"space-y-4",children:[E&&l.jsx("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:l.jsx("p",{className:"text-sm text-blue-900 leading-relaxed",children:E})}),l.jsxs("div",{className:`p-4 rounded-xl border-2 ${W.border} ${W.bg}`,children:[l.jsxs("h3",{className:`font-semibold ${W.text} mb-2 flex items-center gap-2`,children:[l.jsx(mTe,{className:"w-4 h-4"}),"What This Means"]}),l.jsxs("p",{className:`text-sm ${W.text}`,children:[b==="normal"&&"Your value is within the normal range. Keep maintaining your current lifestyle and habits.",b==="borderline"&&"Your value is slightly outside the normal range. Consider making lifestyle adjustments and monitor regularly.",b==="high"&&"Your value is significantly outside the normal range. Consult with a healthcare provider and make necessary changes."]})]}),P&&P.length>0&&l.jsxs("div",{className:"p-4 bg-amber-50 rounded-xl border border-amber-200",children:[l.jsxs("h3",{className:"font-semibold text-amber-900 mb-3 flex items-center gap-2",children:[l.jsx(Aa,{className:"w-4 h-4"}),"Associated Symptoms"]}),l.jsx("ul",{className:"space-y-2",children:P.map((z,Y)=>l.jsxs("li",{className:"text-sm text-amber-800 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-amber-600 rounded-full mt-1.5 flex-shrink-0"}),z]},Y))})]})]}),a==="recommendations"&&l.jsxs("div",{className:"space-y-4",children:[T&&T.length>0?l.jsx("div",{className:"space-y-3",children:T.map((z,Y)=>l.jsx("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:l.jsx("p",{className:"text-sm text-emerald-900 leading-relaxed",children:z})},Y))}):l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:l.jsx("p",{className:"text-sm text-slate-600",children:"No specific recommendations available."})}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-200",children:[l.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"General Tips"}),l.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Monitor this value regularly"]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Maintain a healthy lifestyle"]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mt-1.5 flex-shrink-0"}),"Consult a healthcare provider if concerned"]})]})]})]}),a==="foods"&&l.jsxs("div",{className:"space-y-4",children:[w&&w.length>0&&l.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-200",children:[l.jsxs("h3",{className:"font-semibold text-emerald-900 mb-3 flex items-center gap-2",children:[l.jsx(bi,{className:"w-4 h-4"}),"Foods to Consume"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((z,Y)=>l.jsx("span",{className:"px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium",children:z},Y))})]}),N&&N.length>0&&l.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border border-red-200",children:[l.jsxs("h3",{className:"font-semibold text-red-900 mb-3 flex items-center gap-2",children:[l.jsx(Aa,{className:"w-4 h-4"}),"Foods to Avoid"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:N.map((z,Y)=>l.jsx("span",{className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:z},Y))})]}),!w&&!N&&l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:l.jsx("p",{className:"text-sm text-slate-600",children:"No specific dietary recommendations available."})})]})]}),A&&l.jsx("div",{className:`p-4 rounded-xl border-2 ${A==="severe"?"bg-red-50 border-red-200":A==="moderate"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:l.jsxs("p",{className:`text-sm font-medium ${A==="severe"?"text-red-700":A==="moderate"?"text-amber-700":"text-yellow-700"}`,children:[l.jsx("strong",{children:"Severity:"})," ",A.charAt(0).toUpperCase()+A.slice(1)]})})]}),l.jsx("div",{className:"border-t border-slate-200 p-6 bg-slate-50",children:l.jsx("p",{className:"text-xs text-slate-600 text-center",children:"This information is for educational purposes only. Always consult with a healthcare provider for medical advice."})})]})})}function Yze(){var de,xe,me,Ce,ue,be,se,pe,De;const{id:e}=Vw(),[n,a]=q.useState(null),[o,d]=q.useState([]),[p,f]=q.useState(!0),[v,b]=q.useState(null),[E,T]=q.useState(!1),[w,N]=q.useState(!1),[P,A]=q.useState(!1),[k,I]=q.useState([]),[F,U]=q.useState(""),[V,W]=q.useState(!1),[B,z]=q.useState(null),Y=q.useRef(null);q.useEffect(()=>{(async()=>{try{const{data:we}=await Nh.getReport(e);a(we.report),d(we.recommendedDoctors||[])}catch{it.error("Failed to load report")}finally{f(!1)}})()},[e]),q.useEffect(()=>{var Se;(Se=Y.current)==null||Se.scrollIntoView({behavior:"smooth"})},[k]);const re=async()=>{var Se,we;if(v){N(!w);return}T(!0);try{const{data:qe}=await Nh.compareReport(e);b(qe),N(!0)}catch(qe){it.error(((we=(Se=qe.response)==null?void 0:Se.data)==null?void 0:we.message)||"No previous report found")}finally{T(!1)}},Z=async Se=>{if(Se.preventDefault(),!F.trim()||V)return;const we=F.trim();U(""),I(qe=>[...qe,{role:"user",content:we}]),W(!0);try{const{data:qe}=await Nh.chatAboutReport(e,we,k);I(lt=>[...lt,{role:"assistant",content:qe.response}])}catch{it.error("Failed to get response"),I(lt=>lt.slice(0,-1))}finally{W(!1)}};if(p)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading report..."})]})});if(!n)return l.jsx("div",{className:"text-center py-12 text-slate-400",children:"Report not found"});const{aiAnalysis:ie}=n,te=(ie==null?void 0:ie.healthScore)||0;return l.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[l.jsxs(hn,{to:"/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 font-medium transition-colors",children:[l.jsx(co,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-6",children:[l.jsxs("div",{className:"flex items-center gap-5",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(li,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-2xl font-bold",children:[n.reportType," Report"]}),l.jsxs("p",{className:"text-white/70",children:["Analyzed on ",new Date(n.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]})]}),l.jsxs("div",{className:"text-center p-4 bg-white/10 backdrop-blur-sm rounded-xl",children:[l.jsx("p",{className:"text-4xl font-bold",children:te}),l.jsx("p",{className:"text-sm text-white/70",children:"Health Score"})]})]}),l.jsx("div",{className:"relative flex gap-3 mt-6 pt-6 border-t border-white/20",children:l.jsxs("button",{onClick:re,disabled:E,className:"flex items-center gap-2 px-4 py-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all font-medium",children:[l.jsx(gS,{className:"w-4 h-4"}),E?"Loading...":w?"Hide Comparison":"Compare with Previous"]})})]}),w&&v&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-blue-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(gS,{className:"w-5 h-5 text-blue-500"})," Health Comparison"]}),l.jsx("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${v.comparison.overallTrend==="improved"?"bg-emerald-100 text-emerald-700":v.comparison.overallTrend==="declined"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"}`,children:v.comparison.overallTrend==="improved"?" Improved":v.comparison.overallTrend==="declined"?" Declined":" Stable"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border-2 border-slate-200",children:[l.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Previous Report"}),l.jsx("p",{className:"font-medium text-slate-800",children:new Date(v.previousReport.createdAt).toLocaleDateString()}),l.jsxs("p",{className:"text-2xl font-bold text-slate-600",children:[v.previousReport.healthScore,"/100"]})]}),l.jsxs("div",{className:"bg-cyan-50 p-4 rounded-xl border-2 border-cyan-200",children:[l.jsx("p",{className:"text-sm text-cyan-700 mb-1",children:"Current Report"}),l.jsx("p",{className:"font-medium text-slate-800",children:new Date(v.currentReport.createdAt).toLocaleDateString()}),l.jsxs("p",{className:"text-2xl font-bold text-cyan-600",children:[v.currentReport.healthScore,"/100"]})]})]}),l.jsx("p",{className:"text-slate-700",children:v.comparison.summary})]}),P&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-violet-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[l.jsx(Hd,{className:"w-5 h-5 text-violet-500"})," Ask About Your Report"]}),l.jsx("button",{onClick:()=>A(!1),className:"p-2 text-slate-400 hover:text-slate-800 rounded-lg",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"h-64 overflow-y-auto mb-4 space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[k.length===0&&l.jsxs("p",{className:"text-slate-500 text-center py-8",children:["Ask any questions about your health report.",l.jsx("br",{}),'"What does my hemoglobin level mean?"']}),k.map((Se,we)=>l.jsx("div",{className:`flex ${Se.role==="user"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${Se.role==="user"?"bg-violet-500 text-white":"bg-white border border-slate-200 text-slate-800"}`,children:Se.content})},we)),V&&l.jsx("div",{className:"flex justify-start",children:l.jsx("div",{className:"bg-white border border-slate-200 p-3 rounded-xl",children:l.jsx("span",{className:"animate-pulse text-slate-600",children:"Thinking..."})})}),l.jsx("div",{ref:Y})]}),l.jsxs("form",{onSubmit:Z,className:"flex gap-2",children:[l.jsx("input",{type:"text",value:F,onChange:Se=>U(Se.target.value),placeholder:"Ask a question...",className:"flex-1 bg-white border-2 border-slate-200 rounded-xl py-3 px-4 text-slate-800 placeholder-slate-400 focus:border-violet-400 focus:outline-none",disabled:V}),l.jsx("button",{type:"submit",disabled:V||!F.trim(),className:"px-4 py-3 bg-violet-500 text-white rounded-xl hover:bg-violet-600 transition-all disabled:opacity-50",children:l.jsx(Bf,{className:"w-5 h-5"})})]})]}),(ie==null?void 0:ie.summary)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-cyan-500"})," Summary"]}),l.jsx("p",{className:"text-slate-700 leading-relaxed",children:ie.summary})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[((de=ie==null?void 0:ie.keyFindings)==null?void 0:de.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(Di,{className:"w-5 h-5 text-blue-500"})," Key Findings"]}),l.jsx("ul",{className:"space-y-2",children:ie.keyFindings.map((Se,we)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-700",children:[l.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),Se]},we))})]}),((xe=ie==null?void 0:ie.riskFactors)==null?void 0:xe.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(Yw,{className:"w-5 h-5 text-amber-500"})," Risk Factors"]}),l.jsx("ul",{className:"space-y-2",children:ie.riskFactors.map((Se,we)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-700",children:[l.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full mt-2 flex-shrink-0"}),Se]},we))})]})]}),(ie==null?void 0:ie.metrics)&&Object.keys(ie.metrics).length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-bold text-slate-800 mb-6",children:"Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(ie.metrics).map(([Se,we])=>l.jsxs("button",{onClick:()=>z({name:Se.replace(/([A-Z])/g," $1").trim(),value:we.value,unit:we.unit,normalRange:we.normalRange,status:we.status,description:we.description,recommendations:we.recommendations,foodsToConsume:we.foodsToConsume,foodsToAvoid:we.foodsToAvoid,symptoms:we.symptoms,severity:we.severity}),className:`p-4 rounded-xl border-2 text-left transition-all hover:shadow-lg hover:scale-105 cursor-pointer ${we.status==="normal"?"bg-emerald-50 border-emerald-200 hover:border-emerald-300":we.status==="borderline"?"bg-amber-50 border-amber-200 hover:border-amber-300":"bg-red-50 border-red-200 hover:border-red-300"}`,children:[l.jsx("p",{className:"text-sm text-slate-600 capitalize mb-1 font-medium",children:Se.replace(/([A-Z])/g," $1")}),l.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[we.value," ",l.jsx("span",{className:"text-sm font-normal text-slate-500",children:we.unit})]}),l.jsxs("div",{className:"flex items-center justify-between mt-2",children:[l.jsxs("span",{className:"text-xs text-slate-600",children:["Normal: ",we.normalRange]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${we.status==="normal"?"bg-emerald-100 text-emerald-700":we.status==="borderline"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:we.status})]})]},Se))})]}),((me=ie==null?void 0:ie.deficiencies)==null?void 0:me.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-l-4 border-amber-500 border-t-2 border-r-2 border-b-2 border-t-slate-200 border-r-slate-200 border-b-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(qw,{className:"w-5 h-5 text-amber-500"})," Detected Deficiencies"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:ie.deficiencies.map((Se,we)=>{var qe;return l.jsxs("button",{onClick:()=>z({name:Se.name,value:Se.currentValue,unit:"",normalRange:Se.normalRange,status:Se.severity==="severe"?"high":Se.severity==="moderate"?"borderline":"normal",description:`${Se.name} deficiency detected in your report.`,recommendations:Se.recommendations,foodsToConsume:Se.foodsToConsume,foodsToAvoid:Se.foodsToAvoid,symptoms:Se.symptoms,severity:Se.severity}),className:`p-4 rounded-xl border-2 text-left transition-all hover:shadow-lg hover:scale-105 cursor-pointer ${Se.severity==="severe"?"bg-red-50 border-red-200 hover:border-red-300":Se.severity==="moderate"?"bg-amber-50 border-amber-200 hover:border-amber-300":"bg-yellow-50 border-yellow-200 hover:border-yellow-300"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"font-bold text-slate-800",children:Se.name}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Se.severity==="severe"?"bg-red-100 text-red-700":Se.severity==="moderate"?"bg-amber-100 text-amber-700":"bg-yellow-100 text-yellow-700"}`,children:Se.severity})]}),l.jsxs("p",{className:"text-sm text-slate-700 font-medium",children:["Current: ",Se.currentValue]}),l.jsxs("p",{className:"text-sm text-slate-600",children:["Normal: ",Se.normalRange]}),((qe=Se.symptoms)==null?void 0:qe.length)>0&&l.jsxs("p",{className:"text-xs text-slate-600 mt-2",children:["Symptoms: ",Se.symptoms.join(", ")]})]},we)})})]}),((Ce=ie==null?void 0:ie.supplements)==null?void 0:Ce.length)>0&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-2 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"})," Natural Supplement Recommendations"]}),l.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Natural Indian foods and remedies to address your deficiencies"}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:ie.supplements.map((Se,we)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border-2 border-green-200",children:[l.jsx("p",{className:"font-bold text-green-700",children:Se.category}),l.jsx("p",{className:"text-sm text-green-600 mt-1",children:Se.reason}),l.jsx("p",{className:"text-xs text-green-700 mt-2 font-medium",children:Se.naturalSources||Se.generalDosage}),Se.note&&l.jsx("p",{className:"text-xs text-green-600 mt-1 italic",children:Se.note})]},we))})]}),(ie==null?void 0:ie.dietPlan)&&l.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-bold text-slate-800 mb-2 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-emerald-500"})," Personalized Diet Plan"]}),ie.dietPlan.overview&&l.jsx("p",{className:"text-slate-700 mb-6",children:ie.dietPlan.overview}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[{key:"breakfast",label:"Breakfast",icon:"",color:"emerald",bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-700"},{key:"lunch",label:"Lunch",icon:"",color:"blue",bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-700"},{key:"dinner",label:"Dinner",icon:"",color:"violet",bg:"bg-violet-50",border:"border-violet-200",text:"text-violet-700"},{key:"snacks",label:"Snacks",icon:"",color:"amber",bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-700"}].map(({key:Se,label:we,icon:qe,bg:lt,border:Ut,text:Ht})=>{var Ue;return((Ue=ie.dietPlan[Se])==null?void 0:Ue.length)>0&&l.jsxs("div",{className:`p-4 rounded-xl ${lt} border-2 ${Ut}`,children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx("span",{className:"text-xl",children:qe}),l.jsx("span",{className:`font-bold ${Ht}`,children:we})]}),ie.dietPlan[Se].map((dt,Ne)=>l.jsxs("div",{className:"mb-2",children:[l.jsx("p",{className:`text-sm ${Ht} font-medium`,children:dt.meal}),dt.tip&&l.jsx("p",{className:"text-xs text-slate-600 italic",children:dt.tip})]},Ne))]},Se)})}),(((ue=ie.dietPlan.foodsToIncrease)==null?void 0:ue.length)>0||((be=ie.dietPlan.foodsToLimit)==null?void 0:be.length)>0)&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[((se=ie.dietPlan.foodsToIncrease)==null?void 0:se.length)>0&&l.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border-2 border-emerald-200",children:[l.jsx("h3",{className:"font-bold text-emerald-700 mb-3",children:" Foods to Increase"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:ie.dietPlan.foodsToIncrease.map((Se,we)=>l.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-medium",children:Se},we))})]}),((pe=ie.dietPlan.foodsToLimit)==null?void 0:pe.length)>0&&l.jsxs("div",{className:"p-4 bg-red-50 rounded-xl border-2 border-red-200",children:[l.jsx("h3",{className:"font-bold text-red-700 mb-3",children:" Foods to Limit"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:ie.dietPlan.foodsToLimit.map((Se,we)=>l.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-3 py-1 rounded-full font-medium",children:Se},we))})]})]}),((De=ie.dietPlan.tips)==null?void 0:De.length)>0&&l.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl",children:[l.jsxs("h3",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[l.jsx(Hd,{className:"w-4 h-4 text-amber-500"})," Diet Tips"]}),l.jsx("ul",{className:"space-y-2",children:ie.dietPlan.tips.map((Se,we)=>l.jsxs("li",{className:"text-sm text-slate-700 flex items-start gap-2",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-500 rounded-full mt-2"}),Se]},we))})]})]}),l.jsx("div",{className:"p-4 bg-blue-50 rounded-xl border-2 border-blue-200",children:l.jsxs("p",{className:"text-sm text-blue-700",children:[l.jsx("strong",{children:"Disclaimer:"})," This AI analysis is for informational wellness support only and should not replace professional medical advice. Always consult with a healthcare provider for medical decisions."]})}),B&&l.jsx(Kze,{vital:B,onClose:()=>z(null)})]})}const qze=["All","General Physician","Nutritionist","Cardiologist","Dermatologist","Endocrinologist","Neurologist"];function Xze(){var de,xe,me,Ce;const e=Is(),[n,a]=q.useState([]),[o,d]=q.useState([]),[p,f]=q.useState(!0),[v,b]=q.useState("All"),[E,T]=q.useState(""),[w,N]=q.useState(null),[P,A]=q.useState({date:"",timeSlot:"",symptoms:""}),[k,I]=q.useState(!1),[F,U]=q.useState("doctors"),[V,W]=q.useState([]),[B,z]=q.useState(!1);q.useEffect(()=>{Y()},[v]);const Y=async()=>{try{const ue={};v!=="All"&&(ue.specialization=v);const[be,se]=await Promise.all([Ja.getAll(ue),Ja.getAppointments()]);a(be.data),d(se.data)}catch(ue){console.error("Failed to fetch data:",ue)}finally{f(!1)}};q.useEffect(()=>{w&&P.date&&re()},[w,P.date]);const re=async()=>{var ue;if(!(!w||!P.date)){z(!0);try{const{data:be}=await Ja.getDoctorAvailableSlots(w._id);console.log("Slots response:",be);const se=new Date(P.date).toDateString();console.log("Looking for dateKey:",se),console.log("Available keys:",Object.keys(be.slotsByDate||{})),W(((ue=be.slotsByDate)==null?void 0:ue[se])||[])}catch(be){console.error("Failed to fetch slots:",be),W([])}finally{z(!1)}}},Z=n.filter(ue=>{var be,se,pe;return((se=ue.name||((be=ue.user)==null?void 0:be.name))==null?void 0:se.toLowerCase().includes(E.toLowerCase()))||((pe=ue.specialization)==null?void 0:pe.toLowerCase().includes(E.toLowerCase()))}),ie=async ue=>{var be,se;if(ue.preventDefault(),!P.date||!P.timeSlot){it.error("Please select date and time");return}I(!0);try{await Ja.bookAppointment({doctorId:w._id,...P,type:"video"}),it.success("Appointment booked successfully!"),N(null),A({date:"",timeSlot:"",symptoms:""}),W([]),Y()}catch(pe){it.error(((se=(be=pe.response)==null?void 0:be.data)==null?void 0:se.message)||"Failed to book appointment")}finally{I(!1)}},te=()=>{const ue=[];for(let be=0;be<7;be++){const se=new Date;se.setDate(se.getDate()+be),ue.push({value:se.toISOString().split("T")[0],label:se.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:be===0})}return ue};return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Find Doctors"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Book video consultations with healthcare specialists"})]}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:[l.jsxs("button",{onClick:()=>U("doctors"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${F==="doctors"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(Kc,{className:"w-4 h-4"})," Find Doctors"]}),l.jsxs("button",{onClick:()=>U("appointments"),className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition-all ${F==="appointments"?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(ji,{className:"w-4 h-4"})," My Appointments",o.length>0&&l.jsx("span",{className:"ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-600 text-xs rounded-full",children:o.length})]})]}),F==="doctors"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-4 shadow-sm",children:l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(Fy,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:E,onChange:ue=>T(ue.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"})]}),l.jsx("select",{value:v,onChange:ue=>b(ue.target.value),className:"px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:qze.map(ue=>l.jsx("option",{value:ue,children:ue},ue))})]})}),p?l.jsxs("div",{className:"text-center py-12",children:[l.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto"}),l.jsx("p",{className:"text-slate-500 mt-4",children:"Loading doctors..."})]}):Z.length>0?l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Z.map(ue=>{var se,pe,De;const be=ue.name||((se=ue.user)==null?void 0:se.name)||"Doctor";return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[l.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:(pe=be[0])==null?void 0:pe.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",be]}),l.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:ue.specialization}),l.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l.jsx(zc,{className:"w-4 h-4 text-amber-400 fill-amber-400"}),l.jsx("span",{className:"text-sm text-slate-600",children:((De=ue.rating)==null?void 0:De.toFixed(1))||"4.5"}),l.jsx("span",{className:"text-slate-300",children:""}),l.jsxs("span",{className:"text-sm text-slate-500",children:[ue.experience||5,"+ yrs"]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xl font-bold text-slate-800",children:["",ue.consultationFee||500]}),l.jsx("span",{className:"text-sm text-slate-500",children:" / session"})]}),l.jsx("button",{onClick:()=>N(ue),className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all",children:"Book Now"})]})]},ue._id)})}):l.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border border-slate-200",children:[l.jsx(Fy,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No doctors found"})]})]}),F==="appointments"&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Your Appointments"}),o.length>0?l.jsx("div",{className:"space-y-3",children:o.map(ue=>{var be,se,pe,De,Se,we,qe,lt;return l.jsx("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:((Se=(De=((be=ue.doctor)==null?void 0:be.name)||((pe=(se=ue.doctor)==null?void 0:se.user)==null?void 0:pe.name))==null?void 0:De[0])==null?void 0:Se.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-medium text-slate-800",children:["Dr. ",((we=ue.doctor)==null?void 0:we.name)||((lt=(qe=ue.doctor)==null?void 0:qe.user)==null?void 0:lt.name)]}),l.jsxs("p",{className:"text-sm text-slate-500",children:[new Date(ue.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),"  ",ue.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${ue.status==="completed"?"bg-green-100 text-green-600":ue.status==="scheduled"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:ue.status}),ue.status==="scheduled"&&l.jsx("button",{onClick:()=>e(`/consultation/${ue._id}`),className:"px-3 py-1 bg-cyan-500 text-white text-sm font-medium rounded-lg hover:bg-cyan-600",children:"Join Call"})]})]})},ue._id)})}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx(ji,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),l.jsx("p",{className:"text-slate-500",children:"No appointments yet"}),l.jsx("button",{onClick:()=>U("doctors"),className:"mt-3 text-cyan-600 font-medium hover:text-cyan-700",children:"Book your first appointment "})]})]}),w&&l.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up max-h-[90vh] overflow-y-auto",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Book Appointment"}),l.jsx("button",{onClick:()=>{N(null),W([]),A({date:"",timeSlot:"",symptoms:""})},className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-xl mb-6",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(me=(xe=w.name||((de=w.user)==null?void 0:de.name))==null?void 0:xe[0])==null?void 0:me.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("p",{className:"font-semibold text-slate-800",children:["Dr. ",w.name||((Ce=w.user)==null?void 0:Ce.name)]}),l.jsx("p",{className:"text-sm text-cyan-600",children:w.specialization})]})]}),l.jsxs("form",{onSubmit:ie,className:"space-y-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Date"}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:te().map(ue=>l.jsxs("button",{type:"button",onClick:()=>A({...P,date:ue.value,timeSlot:""}),className:`p-2 rounded-xl text-center transition-all ${P.date===ue.value?"bg-cyan-500 text-white":"bg-slate-50 text-slate-600 hover:bg-slate-100 border border-slate-200"}`,children:[l.jsx("div",{className:"text-xs font-medium",children:ue.label.split(" ")[0]}),l.jsx("div",{className:"text-sm font-bold",children:ue.label.split(" ")[2]})]},ue.value))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select Time"}),B?l.jsxs("div",{className:"flex items-center justify-center py-6",children:[l.jsx("div",{className:"w-6 h-6 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"}),l.jsx("span",{className:"ml-2 text-slate-500 text-sm",children:"Loading slots..."})]}):V.length>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:V.map(ue=>{const be=P.timeSlot===ue.timeSlot,se=ue.status==="passed",pe=ue.status==="booked",De=ue.status==="blocked",Se=ue.status==="available";return l.jsxs("button",{type:"button",onClick:()=>Se&&A({...P,timeSlot:ue.timeSlot}),disabled:!Se,className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${be?"bg-cyan-500 text-white ring-2 ring-cyan-300":se?"bg-slate-100 text-slate-400 cursor-not-allowed line-through":pe?"bg-red-50 text-red-400 cursor-not-allowed border border-red-200":De?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200 cursor-pointer"}`,title:se?"Time passed":pe?"Already booked":De?"Not available":"Available",children:[ue.timeSlot,pe&&l.jsx("span",{className:"ml-1 text-xs",children:"(Booked)"})]},ue.timeSlot)})}),l.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-100 border border-emerald-300"})," Available"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-red-50 border border-red-200"})," Booked"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"w-3 h-3 rounded-full bg-slate-100 border border-slate-200"})," Passed/Unavailable"]})]})]}):P.date?l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(ic,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"No slots available for this date"})]}):l.jsxs("div",{className:"text-center py-6 bg-slate-50 rounded-xl",children:[l.jsx(ji,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),l.jsx("p",{className:"text-slate-500 text-sm",children:"Select a date first"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Symptoms (Optional)"}),l.jsx("textarea",{value:P.symptoms,onChange:ue=>A({...P,symptoms:ue.target.value}),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none resize-none",rows:3,placeholder:"Describe your symptoms..."})]}),l.jsxs("div",{className:"p-4 bg-cyan-50 border border-cyan-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Kd,{className:"w-5 h-5 text-cyan-600"}),l.jsx("span",{className:"font-medium text-cyan-700",children:"Video Consultation"})]}),l.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"You'll receive a video call link via email"})]}),l.jsxs("div",{className:"flex gap-3 pt-2",children:[l.jsx("button",{type:"button",onClick:()=>{N(null),W([])},className:"flex-1 py-3 bg-slate-100 text-slate-700 font-medium rounded-xl hover:bg-slate-200 transition-all",children:"Cancel"}),l.jsx("button",{type:"submit",disabled:k||!P.date||!P.timeSlot,className:"flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:k?"Booking...":`Confirm  ${w.consultationFee||500}`})]})]})]})})]})}function Jze(){var te,de,xe,me,Ce,ue,be,se,pe,De,Se,we,qe,lt,Ut,Ht,Ue,dt,Ne,Ke,bt,Te,gt;const{user:e,updateUser:n}=ma(),[a,o]=q.useState(!1),[d,p]=q.useState(null),[f,v]=q.useState(""),[b,E]=q.useState("profile"),[T,w]=q.useState(null),[N,P]=q.useState(!1),[A,k]=q.useState({goalType:"maintenance",currentWeight:((te=e==null?void 0:e.profile)==null?void 0:te.weight)||"",targetWeight:"",height:((de=e==null?void 0:e.profile)==null?void 0:de.height)||"",age:((xe=e==null?void 0:e.profile)==null?void 0:xe.age)||"",gender:((me=e==null?void 0:e.profile)==null?void 0:me.gender)||"male",activityLevel:"moderate",dietaryPreference:((Ce=e==null?void 0:e.profile)==null?void 0:Ce.dietaryPreference)||"non-vegetarian"}),[I,F]=q.useState({name:(e==null?void 0:e.name)||"",profile:{age:((ue=e==null?void 0:e.profile)==null?void 0:ue.age)||"",gender:((be=e==null?void 0:e.profile)==null?void 0:be.gender)||"",dietaryPreference:((se=e==null?void 0:e.profile)==null?void 0:se.dietaryPreference)||"non-vegetarian",height:((pe=e==null?void 0:e.profile)==null?void 0:pe.height)||"",weight:((De=e==null?void 0:e.profile)==null?void 0:De.weight)||"",bloodGroup:((Se=e==null?void 0:e.profile)==null?void 0:Se.bloodGroup)||"",allergies:((qe=(we=e==null?void 0:e.profile)==null?void 0:we.allergies)==null?void 0:qe.join(", "))||"",chronicConditions:((Ut=(lt=e==null?void 0:e.profile)==null?void 0:lt.chronicConditions)==null?void 0:Ut.join(", "))||""}});q.useEffect(()=>{const Qe=async()=>{try{const{data:At}=await Nh.getHistory();p(At);const ye=Object.keys(At.history||{});ye.length>0&&v(ye[0])}catch(At){console.error("Failed to fetch health history:",At)}},Ft=async()=>{try{const At=localStorage.getItem("token"),ye=await Mn.get("/api/nutrition/goals",{headers:{Authorization:`Bearer ${At}`}});ye.data.healthGoal&&(w(ye.data.healthGoal),k({goalType:ye.data.healthGoal.goalType,currentWeight:ye.data.healthGoal.currentWeight,targetWeight:ye.data.healthGoal.targetWeight,height:ye.data.healthGoal.height,age:ye.data.healthGoal.age,gender:ye.data.healthGoal.gender,activityLevel:ye.data.healthGoal.activityLevel,dietaryPreference:ye.data.healthGoal.dietaryPreference}))}catch{console.log("No health goal set yet")}};Qe(),Ft()},[]);const U=Qe=>{const{name:Ft,value:At}=Qe.target;if(Ft.startsWith("profile.")){const ye=Ft.split(".")[1];F(et=>({...et,profile:{...et.profile,[ye]:At}}))}else F(ye=>({...ye,[Ft]:At}))},V=async Qe=>{var Ft,At;Qe.preventDefault(),o(!0);try{const ye={name:I.name,profile:{...I.profile,age:I.profile.age?Number(I.profile.age):void 0,height:I.profile.height?Number(I.profile.height):void 0,weight:I.profile.weight?Number(I.profile.weight):void 0,allergies:I.profile.allergies?I.profile.allergies.split(",").map(zt=>zt.trim()).filter(Boolean):[],chronicConditions:I.profile.chronicConditions?I.profile.chronicConditions.split(",").map(zt=>zt.trim()).filter(Boolean):[]}},{data:et}=await ut.put("/auth/profile",ye);n(et),it.success("Profile updated successfully!")}catch(ye){it.error(((At=(Ft=ye.response)==null?void 0:Ft.data)==null?void 0:At.message)||"Failed to update profile")}finally{o(!1)}},W=async Qe=>{var Ft,At;Qe.preventDefault(),P(!0);try{const ye=localStorage.getItem("token"),et={...A,currentWeight:Number(A.currentWeight),targetWeight:Number(A.targetWeight),height:Number(A.height),age:Number(A.age)},zt=await Mn.post("/api/nutrition/goals",et,{headers:{Authorization:`Bearer ${ye}`}});w(zt.data.healthGoal),it.success("Fitness goal set successfully! Your daily targets have been calculated.")}catch(ye){it.error(((At=(Ft=ye.response)==null?void 0:Ft.data)==null?void 0:At.message)||"Failed to set fitness goal")}finally{P(!1)}},B=Qe=>{const{name:Ft,value:At}=Qe.target;k(ye=>({...ye,[Ft]:At}))},z=I.profile.height&&I.profile.weight?(I.profile.weight/Math.pow(I.profile.height/100,2)).toFixed(1):null,re=(Qe=>Qe?Qe<18.5?{label:"Underweight",color:"blue"}:Qe<25?{label:"Normal",color:"emerald"}:Qe<30?{label:"Overweight",color:"amber"}:{label:"Obese",color:"red"}:{label:"N/A",color:"slate"})(parseFloat(z)),Z=((Ue=(Ht=d==null?void 0:d.history)==null?void 0:Ht[f])==null?void 0:Ue.map(Qe=>({date:new Date(Qe.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:Qe.healthScore||0})).reverse())||[],ie=Object.keys((d==null?void 0:d.history)||{});return l.jsxs("div",{className:"w-full overflow-x-hidden space-y-6 animate-fade-in px-3 md:px-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Profile"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your information and track health progress"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl p-3 md:p-6 text-white relative overflow-hidden shadow-lg",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col gap-4 md:gap-6",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 md:gap-6",children:[l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-2xl md:text-3xl font-bold",children:(Ne=(dt=e==null?void 0:e.name)==null?void 0:dt[0])==null?void 0:Ne.toUpperCase()}),l.jsx("button",{className:"absolute -bottom-2 -right-2 w-8 h-8 bg-white rounded-full flex items-center justify-center text-cyan-600 shadow-lg hover:scale-110 transition-transform",children:l.jsx(s2,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:e==null?void 0:e.name}),l.jsxs("div",{className:"flex flex-col gap-2 mt-2 text-white/90 text-sm md:text-base",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(D0,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.email]}),(e==null?void 0:e.phone)&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(d2,{className:"w-4 h-4 flex-shrink-0"})," ",e==null?void 0:e.phone]})]})]})]}),l.jsxs("div",{className:"flex gap-3 md:gap-4",children:[l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:((Ke=e==null?void 0:e.healthMetrics)==null?void 0:Ke.healthScore)||"--"}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"Health Score"})]}),z&&l.jsxs("div",{className:"text-center p-3 md:p-4 bg-white/10 backdrop-blur-sm rounded-xl flex-1",children:[l.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:z}),l.jsx("p",{className:"text-xs md:text-sm text-white/80",children:"BMI"})]})]})]})]}),l.jsx("div",{className:"flex gap-1 md:gap-2 p-1 bg-slate-100 rounded-xl w-full md:w-fit overflow-x-auto",children:[{id:"profile",label:"Edit Profile",icon:Kc},{id:"goals",label:"Fitness Goals",icon:Lh},{id:"history",label:"Health History",icon:ir}].map(Qe=>l.jsxs("button",{onClick:()=>E(Qe.id),className:`flex items-center gap-1 md:gap-2 px-3 md:px-5 py-2 md:py-2.5 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${b===Qe.id?"bg-white text-slate-800 shadow-sm":"text-slate-600 hover:text-slate-800"}`,children:[l.jsx(Qe.icon,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden md:inline",children:Qe.label}),l.jsx("span",{className:"md:hidden",children:Qe.label.split(" ")[0]})]},Qe.id))}),b==="profile"&&l.jsxs("form",{onSubmit:V,className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-4 md:space-y-6",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-800 mb-4 md:mb-6 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-cyan-500"}),"Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",name:"name",value:I.name,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:e==null?void 0:e.email,className:"w-full bg-slate-50 border border-slate-200 rounded-xl py-3 px-4 text-slate-500",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"profile.age",value:I.profile.age,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"1",max:"120",placeholder:"Enter your age"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"profile.gender",value:I.profile.gender,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select gender"}),l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{className:"md:col-span-2",children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"profile.dietaryPreference",value:I.profile.dietaryPreference,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(Di,{className:"w-5 h-5 text-red-500"}),"Health Information"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-5",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"profile.height",value:I.profile.height,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"50",max:"300",placeholder:"170"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",name:"profile.weight",value:I.profile.weight,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",min:"10",max:"500",placeholder:"70"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Blood Group"}),l.jsxs("select",{name:"profile.bloodGroup",value:I.profile.bloodGroup,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(Qe=>l.jsx("option",{value:Qe,children:Qe},Qe))]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[l.jsx(Aa,{className:"w-5 h-5 text-amber-500"}),"Medical History"]}),l.jsxs("div",{className:"space-y-5",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Allergies ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.allergies",value:I.profile.allergies,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Chronic Conditions ",l.jsx("span",{className:"text-slate-400 font-normal",children:"(comma separated)"})]}),l.jsx("input",{type:"text",name:"profile.chronicConditions",value:I.profile.chronicConditions,onChange:U,className:"w-full bg-white border border-slate-300 rounded-xl py-3 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsx("button",{type:"submit",disabled:a,className:"w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:a?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsxs(l.Fragment,{children:[l.jsx(jJ,{className:"w-5 h-5"}),"Save Changes"]})})]}),l.jsxs("div",{className:"space-y-6",children:[z&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"BMI Calculator"}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-24 h-24 rounded-full bg-${re.color}-100 flex items-center justify-center mx-auto mb-4`,children:l.jsx("span",{className:`text-3xl font-bold text-${re.color}-600`,children:z})}),l.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium bg-${re.color}-100 text-${re.color}-700`,children:re.label})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Quick Stats"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Total Reports"}),l.jsx("span",{className:"font-bold text-slate-800",children:(d==null?void 0:d.totalReports)||0})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Report Types"}),l.jsx("span",{className:"font-bold text-slate-800",children:ie.length})]}),l.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-xl",children:[l.jsx("span",{className:"text-slate-600",children:"Subscription"}),l.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-sm font-medium capitalize",children:((bt=e==null?void 0:e.subscription)==null?void 0:bt.plan)||"Free"})]})]})]})]})]}),b==="goals"&&l.jsxs("form",{onSubmit:W,className:"max-w-4xl space-y-6",children:[T&&l.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl border-2 border-blue-200 p-3 md:p-6 shadow-sm w-full overflow-hidden",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3 md:gap-4 mb-4",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-lg md:text-xl font-bold text-blue-900 mb-1",children:"Your Current Goal"}),l.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:"Daily targets calculated based on your goal"})]}),l.jsx("div",{className:"px-3 md:px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold capitalize text-sm md:text-base whitespace-nowrap",children:T.goalType.replace("_"," ")})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mt-4",children:[l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Daily Calories"}),l.jsx("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:T.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Protein"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Carbs"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-2 md:p-4 rounded-xl",children:[l.jsx("p",{className:"text-xs md:text-sm text-slate-600 mb-1",children:"Fats"}),l.jsxs("p",{className:"text-lg md:text-2xl font-bold text-slate-800 truncate",children:[T.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:T?"Update Your Fitness Goal":"Set Your Fitness Goal"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Goal Type"}),l.jsxs("select",{name:"goalType",value:A.goalType,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"weight_loss",children:"Weight Loss (Fat Loss)"}),l.jsx("option",{value:"muscle_gain",children:"Muscle Gain (Bulking)"}),l.jsx("option",{value:"weight_gain",children:"Weight Gain"}),l.jsx("option",{value:"maintenance",children:"Maintenance"}),l.jsx("option",{value:"health_improvement",children:"Health Improvement"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Activity Level"}),l.jsxs("select",{name:"activityLevel",value:A.activityLevel,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),l.jsx("option",{value:"light",children:"Light (Exercise 1-3 days/week)"}),l.jsx("option",{value:"moderate",children:"Moderate (Exercise 3-5 days/week)"}),l.jsx("option",{value:"active",children:"Active (Exercise 6-7 days/week)"}),l.jsx("option",{value:"very_active",children:"Very Active (Hard exercise daily)"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Current Weight (kg)"}),l.jsx("input",{type:"number",name:"currentWeight",value:A.currentWeight,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Target Weight (kg)"}),l.jsx("input",{type:"number",name:"targetWeight",value:A.targetWeight,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"30",max:"300",step:"0.1"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",name:"height",value:A.height,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"100",max:"250"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",name:"age",value:A.age,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,min:"10",max:"120"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Gender"}),l.jsxs("select",{name:"gender",value:A.gender,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Dietary Preference"}),l.jsxs("select",{name:"dietaryPreference",value:A.dietaryPreference,onChange:B,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:[l.jsx("option",{value:"vegetarian",children:"Vegetarian"}),l.jsx("option",{value:"vegan",children:"Vegan"}),l.jsx("option",{value:"non-vegetarian",children:"Non-Vegetarian"}),l.jsx("option",{value:"eggetarian",children:"Eggetarian"})]})]})]}),l.jsxs("button",{type:"submit",disabled:N,className:"mt-6 w-full md:w-auto px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg font-medium hover:shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:[l.jsx(Lh,{className:"w-5 h-5"}),N?"Calculating...":T?"Update Goal":"Set Goal & Calculate Targets"]})]}),l.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:l.jsxs("div",{className:"flex gap-3",children:[l.jsx(Aa,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"How it works (Scientifically Backed)"}),l.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["We use the ",l.jsx("strong",{children:"Mifflin-St Jeor equation"})," (industry standard used by WHO, fitness apps, and hospitals) to calculate your BMR:"]}),l.jsxs("p",{className:"text-xs text-blue-600 font-mono mb-2",children:["Male: BMR = (10  weight) + (6.25  height)  (5  age) + 5",l.jsx("br",{}),"Female: BMR = (10  weight) + (6.25  height)  (5  age)  161"]}),l.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Then we calculate TDEE (Total Daily Energy Expenditure) by multiplying BMR with your activity level, and adjust calories based on your goal:"}),l.jsxs("ul",{className:"text-xs text-blue-600 space-y-1 ml-4",children:[l.jsx("li",{children:" Muscle Gain: +350 calories"}),l.jsx("li",{children:" Fat Loss: -400 calories"}),l.jsx("li",{children:" Maintenance: No adjustment"})]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:[l.jsx("strong",{children:"Macros:"})," Protein = 1.6g per kg body weight (realistic & sustainable), Fats = 0.8g per kg, Carbs = remaining calories. These targets will be used throughout the platform to track your nutrition and provide personalized recommendations."]})]})]})})]}),b==="history"&&l.jsx("div",{className:"space-y-6",children:ie.length>0?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Health Score Trend"}),l.jsx("p",{className:"text-sm text-slate-500",children:"Track your progress over time"})]}),l.jsx("select",{value:f,onChange:Qe=>v(Qe.target.value),className:"bg-white border border-slate-300 rounded-xl py-2 px-4 text-slate-800 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 focus:outline-none",children:ie.map(Qe=>l.jsx("option",{value:Qe,children:Qe},Qe))})]}),Z.length>1?l.jsx(DS,{width:"100%",height:300,children:l.jsxs(wte,{data:Z,children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"historyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.3}),l.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:0})]})}),l.jsx(_0,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),l.jsx(Jd,{dataKey:"date",stroke:"#64748b",fontSize:12}),l.jsx(Qd,{domain:[0,100],stroke:"#64748b",fontSize:12}),l.jsx(xs,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0",borderRadius:"12px"},labelStyle:{color:"#475569"}}),l.jsx(Gl,{type:"monotone",dataKey:"score",stroke:"#06b6d4",strokeWidth:3,fill:"url(#historyGradient)"})]})}):l.jsxs("div",{className:"text-center py-12 text-slate-500",children:[l.jsx(li,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),l.jsx("p",{children:"Upload more reports to see your health trend"})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 shadow-sm",children:[l.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6",children:["Recent ",f," Reports"]}),l.jsx("div",{className:"space-y-3",children:(gt=(Te=d==null?void 0:d.history)==null?void 0:Te[f])==null?void 0:gt.slice(0,5).map((Qe,Ft)=>{var et;const At=d.history[f][Ft+1],ye=At?Qe.healthScore-At.healthScore:null;return l.jsxs(hn,{to:`/reports/${Qe._id}`,className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-all group border border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-cyan-100 flex items-center justify-center",children:l.jsx(li,{className:"w-6 h-6 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-slate-800",children:new Date(Qe.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}),l.jsx("p",{className:"text-sm text-slate-500",children:((et=Qe.keyFindings)==null?void 0:et.slice(0,2).join(", "))||"View details"})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[ye!==null&&l.jsxs("span",{className:`text-sm font-semibold ${ye>0?"text-emerald-600":ye<0?"text-red-600":"text-slate-500"}`,children:[ye>0?"+":"",ye]}),l.jsx("span",{className:"text-2xl font-bold text-cyan-600",children:Qe.healthScore||"--"}),l.jsx(oTe,{className:"w-5 h-5 text-slate-400 group-hover:text-cyan-500 transition-colors"})]})]},Qe._id)})})]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-3 md:p-6 text-center py-16 shadow-sm",children:[l.jsx(li,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"No Health History Yet"}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Upload health reports to track your progress over time"}),l.jsxs(hn,{to:"/upload",className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[l.jsx(lo,{className:"w-5 h-5"}),"Upload Your First Report"]})]})})]})}const p1={name:"John Doe",email:"john@example.com",profile:{age:32,gender:"male",height:175,weight:72,bloodGroup:"O+",allergies:["Penicillin"],chronicConditions:["None"]}},Qze=[{date:"Jul",score:65},{date:"Aug",score:68},{date:"Sep",score:72},{date:"Oct",score:70},{date:"Nov",score:75},{date:"Dec",score:78}],zo={summary:"Overall health is good with some areas needing attention. Blood sugar levels are slightly elevated.",keyFindings:["Hemoglobin levels are normal at 14.2 g/dL","Cholesterol is borderline high at 210 mg/dL","Vitamin D deficiency detected"],riskFactors:["Pre-diabetic blood sugar levels","Sedentary lifestyle indicators"],metrics:{hemoglobin:{value:14.2,unit:"g/dL",status:"normal",normalRange:"12-16"},bloodSugar:{value:115,unit:"mg/dL",status:"borderline",normalRange:"70-100"},cholesterol:{value:210,unit:"mg/dL",status:"borderline",normalRange:"<200"}},recommendations:{diet:[{item:"Leafy Greens",reason:"Rich in iron and vitamins",priority:"high"},{item:"Fatty Fish",reason:"Omega-3 helps reduce cholesterol",priority:"high"},{item:"Nuts & Seeds",reason:"Good fats for heart health",priority:"medium"}],exercise:[{activity:"Brisk Walking",duration:"30 mins",frequency:"daily",reason:"Improves cardiovascular health"},{activity:"Strength Training",duration:"20 mins",frequency:"3x/week",reason:"Builds muscle"}]},doctorConsultation:{specializations:["Endocrinologist","Cardiologist"],reason:"Blood sugar and cholesterol need monitoring"}},tk=[{_id:"1",name:"Dr. Sarah Johnson",specialization:"Cardiologist",experience:12,fee:800,rating:4.8,reviews:124,hospital:"City Heart Hospital",available:!0,slots:["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM"]},{_id:"2",name:"Dr. Raj Patel",specialization:"Endocrinologist",experience:15,fee:900,rating:4.9,reviews:89,hospital:"Diabetes Care Center",available:!0,slots:["10:00 AM","11:00 AM","04:00 PM","05:00 PM"]},{_id:"3",name:"Dr. Emily Chen",specialization:"General Physician",experience:8,fee:500,rating:4.7,reviews:156,hospital:"Family Health Clinic",available:!0,slots:["09:00 AM","10:00 AM","02:00 PM","03:00 PM","04:00 PM"]},{_id:"4",name:"Dr. Michael Brown",specialization:"Neurologist",experience:18,fee:1200,rating:4.9,reviews:67,hospital:"Neuro Care Institute",available:!0,slots:["11:00 AM","02:00 PM","03:00 PM"]},{_id:"5",name:"Dr. Priya Sharma",specialization:"Dermatologist",experience:10,fee:600,rating:4.6,reviews:203,hospital:"Skin & Care Clinic",available:!1,slots:[]}],Zze=[{_id:"apt1",doctor:tk[1],date:"2024-12-15",timeSlot:"10:00 AM",status:"confirmed",type:"online",meetLink:"https://meet.healthai.com/apt-xyz123",amountPaid:450}],NY={summary:"Your health has improved since your last checkup.",metricChanges:[{metric:"Health Score",previous:"72",current:"78",change:"improved"},{metric:"Blood Sugar",previous:"125 mg/dL",current:"115 mg/dL",change:"improved"}]},m1={cholesterol:"Your cholesterol level of 210 mg/dL is borderline high. Focus on reducing saturated fats and increasing fiber. Regular exercise helps too.",worried:"No immediate alarm, but attention needed. Blood sugar is pre-diabetic and cholesterol borderline. Lifestyle changes can help. Follow up with specialists.",default:"Your health score is 78/100. Key areas: managing blood sugar and cholesterol through diet and exercise. Ask me anything specific!"},RY=["All","Cardiologist","Endocrinologist","General Physician","Neurologist","Dermatologist","Orthopedic","Pediatrician"],eKe=["Blood Test","X-Ray","MRI","CT Scan","ECG","General Checkup"];function tKe(){const[e,n]=q.useState("dashboard"),[a,o]=q.useState(!1),[d,p]=q.useState([]),[f,v]=q.useState(""),[b,E]=q.useState(!1),[T,w]=q.useState(!1),[N,P]=q.useState(null),[A,k]=q.useState(0),[I,F]=q.useState({date:"",slot:"",type:"online"}),[U,V]=q.useState(tk),[W,B]=q.useState(Zze),[z,Y]=q.useState("All"),[re,Z]=q.useState(""),[ie,te]=q.useState(0),[de,xe]=q.useState(null),[me,Ce]=q.useState(!1),[ue,be]=q.useState({name:"",specialization:"",experience:"",fee:"",hospital:""}),[se,pe]=q.useState(!1),[De,Se]=q.useState(p1.profile),we=q.useRef(null);q.useEffect(()=>{var ye;(ye=we.current)==null||ye.scrollIntoView({behavior:"smooth"})},[d]);const qe=ye=>{if(ye.preventDefault(),!f.trim())return;const et=f.toLowerCase();p(zt=>[...zt,{role:"user",content:f}]),v(""),setTimeout(()=>{const zt=Object.keys(m1).find(ui=>et.includes(ui));p(ui=>[...ui,{role:"assistant",content:m1[zt]||m1.default}])},800)},lt=()=>{if(A===0)k(1);else if(A===1&&I.date&&I.slot)k(2);else if(A===2){const ye={_id:`apt${Date.now()}`,doctor:N,date:I.date,timeSlot:I.slot,status:"confirmed",type:I.type,meetLink:`https://meet.healthai.com/apt-${Math.random().toString(36).substr(2,9)}`,amountPaid:N.fee/2};B(et=>[ye,...et]),k(3)}},Ut=()=>{P(null),k(0),F({date:"",slot:"",type:"online"})},Ht=()=>{ie===0&&de&&(te(1),Ce(!0),setTimeout(()=>{Ce(!1),te(2)},2500))},Ue=()=>{ue.name&&ue.specialization&&ue.fee&&(V(ye=>[...ye,{...ue,_id:`doc${Date.now()}`,rating:4.5,reviews:0,available:!0,slots:["10:00 AM","02:00 PM","04:00 PM"]}]),be({name:"",specialization:"",experience:"",fee:"",hospital:""}),pe(!1))},dt=U.filter(ye=>(z==="All"||ye.specialization===z)&&ye.name.toLowerCase().includes(re.toLowerCase())),Ne=({trend:ye})=>ye==="improved"?l.jsx(Ca,{className:"w-4 h-4 text-green-600"}):ye==="declined"?l.jsx(FJ,{className:"w-4 h-4 text-red-600"}):l.jsx(l2,{className:"w-4 h-4 text-gray-400"}),Ke=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Welcome back, John!"}),l.jsx("p",{className:"text-gray-600",children:"Here's your health overview"})]}),l.jsxs("button",{onClick:()=>n("upload"),className:"btn-primary flex items-center gap-2",children:[l.jsx(lo,{className:"w-4 h-4"})," Upload Report"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{icon:ir,color:"primary",label:"Health Score",value:"78/100"},{icon:li,color:"blue",label:"Total Reports",value:"6"},{icon:Ca,color:"green",label:"BMI",value:"23.5"},{icon:ji,color:"purple",label:"Last Checkup",value:"Dec 5"}].map((ye,et)=>l.jsx("div",{className:"card",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:`w-12 h-12 bg-${ye.color}-100 rounded-xl flex items-center justify-center`,children:l.jsx(ye.icon,{className:`w-6 h-6 text-${ye.color}-600`})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-gray-500",children:ye.label}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ye.value})]})]})},et))}),W.length>0&&l.jsxs("div",{className:"card border-2 border-green-200 bg-green-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(ji,{className:"w-5 h-5 text-green-600"})," Upcoming Appointments"]}),W.filter(ye=>ye.status==="confirmed").map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.doctor.name[4]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.doctor.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[ye.doctor.specialization,"  ",ye.date," at ",ye.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[ye.type==="online"&&ye.meetLink&&l.jsxs("a",{href:ye.meetLink,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:[l.jsx(Kd,{className:"w-4 h-4"})," Join Call"]}),l.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:"Confirmed"})]})]},ye._id))]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Score Trend"}),l.jsx(DS,{width:"100%",height:200,children:l.jsxs(Ste,{data:Qze,children:[l.jsx(_0,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),l.jsx(Jd,{dataKey:"date"}),l.jsx(Qd,{domain:[0,100]}),l.jsx(xs,{}),l.jsx(rg,{type:"monotone",dataKey:"score",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e"}})]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"}),l.jsx("h3",{className:"font-semibold",children:"Diet Recommendations"})]}),l.jsx("ul",{className:"space-y-2",children:zo.recommendations.diet.map((ye,et)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.item})," - ",ye.reason]})]},et))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(bP,{className:"w-5 h-5 text-blue-600"}),l.jsx("h3",{className:"font-semibold",children:"Exercise Plan"})]}),l.jsx("ul",{className:"space-y-2",children:zo.recommendations.exercise.map((ye,et)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),l.jsxs("span",{children:[l.jsx("strong",{children:ye.activity})," - ",ye.duration,", ",ye.frequency]})]},et))})]})]}),l.jsx("div",{className:"card border-l-4 border-yellow-500 bg-yellow-50",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Aa,{className:"w-5 h-5 text-orange-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold",children:"Doctor Consultation Recommended"}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:zo.doctorConsultation.reason}),l.jsxs("p",{className:"text-sm mt-2",children:[l.jsx("strong",{children:"Specialists:"})," ",zo.doctorConsultation.specializations.join(", ")]}),l.jsx("button",{onClick:()=>n("doctors"),className:"btn-primary mt-3 text-sm",children:"Find Doctors"})]})]})})]}),bt=()=>l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Health Report"}),l.jsx("p",{className:"text-gray-600",children:"Upload your medical report for AI-powered analysis"})]}),ie===0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Report Type"}),l.jsx("select",{className:"input",children:eKe.map(ye=>l.jsx("option",{children:ye},ye))})]}),l.jsxs("div",{className:"card",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload File"}),de?l.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(li,{className:"w-10 h-10 text-primary-600"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:de.name}),l.jsxs("p",{className:"text-sm text-gray-500",children:[de.size," MB"]})]})]}),l.jsx("button",{onClick:()=>xe(null),className:"p-2 text-gray-400 hover:text-red-500",children:l.jsx(Ji,{className:"w-5 h-5"})})]}):l.jsxs("div",{onClick:()=>xe({name:"blood_test_report.pdf",size:2.4}),className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-primary-400 transition-colors",children:[l.jsx(lo,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop or click to upload"}),l.jsx("p",{className:"text-sm text-gray-500",children:"PDF, PNG, JPG - max 10MB"})]})]}),l.jsxs("button",{onClick:Ht,disabled:!de,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(lo,{className:"w-5 h-5"})," Analyze Report"]})]}),ie===1&&l.jsxs("div",{className:"card text-center py-12",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold",children:"Analyzing Your Report..."}),l.jsx("p",{className:"text-gray-600 mt-2",children:"Our AI is extracting insights from your report"}),l.jsx("div",{className:"mt-6 space-y-2 text-left max-w-xs mx-auto",children:["Extracting text from PDF...","Analyzing health metrics...","Generating recommendations..."].map((ye,et)=>l.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[l.jsx(yh,{className:"w-4 h-4 text-green-600"}),l.jsx("span",{children:ye})]},et))})]}),ie===2&&l.jsxs("div",{className:"space-y-6",children:[l.jsx("div",{className:"card bg-green-50 border-2 border-green-200",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(yh,{className:"w-8 h-8 text-green-600"}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Analysis Complete!"}),l.jsx("p",{className:"text-green-700",children:"Your report has been analyzed successfully"})]})]})}),l.jsx("button",{onClick:()=>n("report"),className:"btn-primary w-full",children:"View Full Analysis"})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl text-sm text-blue-800",children:[l.jsx("strong",{children:"Note:"})," AI analysis is for informational purposes only. Always consult a healthcare provider."]})]}),Te=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?"Manage Doctors":"Find Doctors"}),l.jsx("p",{className:"text-gray-600",children:a?"Add and manage platform doctors":"Book consultations with specialists"})]}),a&&l.jsxs("button",{onClick:()=>pe(!0),className:"btn-primary flex items-center gap-2",children:[l.jsx(Wc,{className:"w-4 h-4"})," Add Doctor"]})]}),l.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(Fy,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),l.jsx("input",{type:"text",placeholder:"Search doctors...",value:re,onChange:ye=>Z(ye.target.value),className:"input pl-12"})]}),l.jsx("div",{className:"flex gap-2 flex-wrap",children:RY.slice(0,5).map(ye=>l.jsx("button",{onClick:()=>Y(ye),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${z===ye?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:ye},ye))})]}),l.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:dt.map(ye=>{var et;return l.jsxs("div",{className:"card hover:shadow-md transition-shadow",children:[l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-xl flex items-center justify-center text-2xl font-bold text-primary-600",children:((et=ye.name.split(" ")[1])==null?void 0:et[0])||ye.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-semibold text-gray-900",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization}),l.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[l.jsx(zc,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),l.jsx("span",{className:"text-sm font-medium",children:ye.rating}),l.jsxs("span",{className:"text-sm text-gray-500",children:["(",ye.reviews,")"]})]})]})]}),l.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ic,{className:"w-4 h-4"}),l.jsxs("span",{children:[ye.experience," years experience"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(xP,{className:"w-4 h-4"}),l.jsx("span",{children:ye.hospital})]})]}),l.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["",ye.fee]}),l.jsx("span",{className:"text-sm text-gray-500",children:" / session"})]}),ye.available?l.jsx("button",{onClick:()=>{P(ye),k(0)},className:"btn-primary text-sm",children:"Book Now"}):l.jsx("span",{className:"px-3 py-1.5 bg-gray-100 text-gray-500 rounded-xl text-sm",children:"Unavailable"})]})]},ye._id)})}),se&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:"Add New Doctor"}),l.jsx("button",{onClick:()=>pe(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Doctor Name"}),l.jsx("input",{type:"text",value:ue.name,onChange:ye=>be({...ue,name:ye.target.value}),className:"input",placeholder:"Dr. John Smith"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Specialization"}),l.jsxs("select",{value:ue.specialization,onChange:ye=>be({...ue,specialization:ye.target.value}),className:"input",children:[l.jsx("option",{value:"",children:"Select"}),RY.slice(1).map(ye=>l.jsx("option",{children:ye},ye))]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Experience (yrs)"}),l.jsx("input",{type:"number",value:ue.experience,onChange:ye=>be({...ue,experience:ye.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fee ()"}),l.jsx("input",{type:"number",value:ue.fee,onChange:ye=>be({...ue,fee:ye.target.value}),className:"input"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hospital/Clinic"}),l.jsx("input",{type:"text",value:ue.hospital,onChange:ye=>be({...ue,hospital:ye.target.value}),className:"input"})]}),l.jsx("button",{onClick:Ue,className:"btn-primary w-full",children:"Add Doctor"})]})]})})]}),gt=()=>{var ye;return N&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto",children:[A<3&&l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:A===0?"Book Appointment":A===1?"Select Slot":"Payment"}),l.jsx("button",{onClick:Ut,className:"p-2 hover:bg-gray-100 rounded-lg",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),A===0&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-full flex items-center justify-center text-xl font-bold text-primary-600",children:(ye=N.name.split(" ")[1])==null?void 0:ye[0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold",children:N.name}),l.jsx("p",{className:"text-sm text-primary-600",children:N.specialization}),l.jsx("p",{className:"text-sm text-gray-500",children:N.hospital})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consultation Type"}),l.jsx("div",{className:"flex gap-4",children:["online","in-person"].map(et=>l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"radio",name:"type",checked:I.type===et,onChange:()=>F({...I,type:et}),className:"text-primary-600"}),et==="online"?l.jsxs(l.Fragment,{children:[l.jsx(Kd,{className:"w-4 h-4"})," Online"]}):l.jsxs(l.Fragment,{children:[l.jsx(xP,{className:"w-4 h-4"})," In-Person"]})]},et))})]}),l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl",children:[l.jsxs("p",{className:"text-sm text-blue-800",children:[l.jsx("strong",{children:"Consultation Fee:"})," ",N.fee]}),l.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Pay ",N.fee/2," now to confirm (50% advance)"]})]}),l.jsx("button",{onClick:lt,className:"btn-primary w-full",children:"Select Date & Time"})]}),A===1&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),l.jsx("input",{type:"date",value:I.date,onChange:et=>F({...I,date:et.target.value}),min:new Date().toISOString().split("T")[0],className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Slots"}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.slots.map(et=>l.jsx("button",{onClick:()=>F({...I,slot:et}),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${I.slot===et?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:et},et))})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:()=>k(0),className:"flex-1 py-2.5 border border-gray-300 rounded-xl font-medium",children:"Back"}),l.jsx("button",{onClick:lt,disabled:!I.date||!I.slot,className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),A===2&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Doctor"}),l.jsx("span",{className:"font-medium",children:N.name})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Date"}),l.jsx("span",{className:"font-medium",children:I.date})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Time"}),l.jsx("span",{className:"font-medium",children:I.slot})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-600",children:"Type"}),l.jsx("span",{className:"font-medium capitalize",children:I.type})]}),l.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[l.jsx("span",{className:"font-semibold",children:"Amount to Pay"}),l.jsxs("span",{className:"font-bold text-primary-600",children:["",N.fee/2]})]})]}),l.jsxs("div",{className:"p-4 border border-gray-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(AJ,{className:"w-5 h-5 text-gray-600"}),l.jsx("span",{className:"font-medium",children:"Payment Method"})]}),l.jsx("div",{className:"space-y-2",children:["UPI","Credit/Debit Card","Net Banking"].map(et=>l.jsxs("label",{className:"flex items-center gap-2 p-2 border rounded-lg cursor-pointer hover:bg-gray-50",children:[l.jsx("input",{type:"radio",name:"payment",defaultChecked:et==="UPI"}),l.jsx("span",{children:et})]},et))})]}),l.jsxs("button",{onClick:lt,className:"btn-primary w-full flex items-center justify-center gap-2",children:[l.jsx(vS,{className:"w-4 h-4"})," Pay ",N.fee/2," Securely"]})]}),A===3&&l.jsxs("div",{className:"text-center py-6",children:[l.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(yh,{className:"w-8 h-8 text-green-600"})}),l.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),l.jsx("p",{className:"text-gray-600 mb-4",children:"Your appointment has been scheduled"}),l.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl text-left space-y-2 mb-4",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Doctor:"})," ",N.name]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Date:"})," ",I.date," at ",I.slot]}),l.jsxs("p",{children:[l.jsx("strong",{children:"Type:"})," ",I.type==="online"?"Video Consultation":"In-Person"]}),I.type==="online"&&l.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[l.jsxs("p",{className:"text-sm text-blue-800 font-medium flex items-center gap-2",children:[l.jsx(Kd,{className:"w-4 h-4"})," Video Call Link"]}),l.jsxs("p",{className:"text-sm text-blue-600 mt-1 break-all",children:["https://meet.healthai.com/apt-",Math.random().toString(36).substr(2,6)]}),l.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Link will be available in your dashboard"})]})]}),l.jsx("button",{onClick:()=>{Ut(),n("dashboard")},className:"btn-primary w-full",children:"Go to Dashboard"})]})]})})},Qe=()=>{var ye,et;return l.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Settings"}),l.jsx("p",{className:"text-gray-600",children:"Manage your personal and health information"})]}),l.jsx("div",{className:"card gradient-bg text-white",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-8 h-8"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold",children:"Health Score"}),l.jsx("p",{className:"text-3xl font-bold",children:"78/100"})]}),l.jsxs("div",{className:"ml-auto text-right",children:[l.jsx("p",{className:"text-sm opacity-80",children:"BMI"}),l.jsx("p",{className:"text-2xl font-bold",children:"23.5"})]})]})}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-primary-600"})," Basic Information"]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),l.jsx("input",{type:"text",value:p1.name,className:"input",readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),l.jsx("input",{type:"email",value:p1.email,className:"input bg-gray-50",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Age"}),l.jsx("input",{type:"number",value:De.age,onChange:zt=>Se({...De,age:zt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),l.jsxs("select",{value:De.gender,onChange:zt=>Se({...De,gender:zt.target.value}),className:"input",children:[l.jsx("option",{value:"male",children:"Male"}),l.jsx("option",{value:"female",children:"Female"}),l.jsx("option",{value:"other",children:"Other"})]})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Information"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Height (cm)"}),l.jsx("input",{type:"number",value:De.height,onChange:zt=>Se({...De,height:zt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Weight (kg)"}),l.jsx("input",{type:"number",value:De.weight,onChange:zt=>Se({...De,weight:zt.target.value}),className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),l.jsx("select",{value:De.bloodGroup,onChange:zt=>Se({...De,bloodGroup:zt.target.value}),className:"input",children:["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(zt=>l.jsx("option",{children:zt},zt))})]})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Medical History"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allergies"}),l.jsx("input",{type:"text",value:(ye=De.allergies)==null?void 0:ye.join(", "),className:"input",placeholder:"e.g., Penicillin, Peanuts"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chronic Conditions"}),l.jsx("input",{type:"text",value:(et=De.chronicConditions)==null?void 0:et.join(", "),className:"input",placeholder:"e.g., Diabetes, Hypertension"})]})]})]}),l.jsxs("button",{className:"btn-primary w-full flex items-center justify-center gap-2",onClick:()=>alert("Profile saved!"),children:[l.jsx(yh,{className:"w-5 h-5"})," Save Changes"]})]})},Ft=()=>l.jsxs("div",{className:"space-y-6",children:[l.jsxs("button",{onClick:()=>n("dashboard"),className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[l.jsx(co,{className:"w-4 h-4"})," Back to Dashboard"]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-primary-100 rounded-xl flex items-center justify-center",children:l.jsx(li,{className:"w-7 h-7 text-primary-600"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blood Test Report"}),l.jsx("p",{className:"text-gray-500",children:"Analyzed on Dec 5, 2024"})]})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"text-3xl font-bold text-primary-600",children:"78"}),l.jsx("div",{className:"text-sm text-gray-500",children:"Health Score"})]})]}),l.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100",children:[l.jsxs("button",{onClick:()=>E(!b),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-xl hover:bg-blue-100",children:[l.jsx(gS,{className:"w-4 h-4"}),b?"Hide":"Compare"]}),l.jsxs("button",{onClick:()=>w(!T),className:"flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-xl hover:bg-purple-100",children:[l.jsx(E7,{className:"w-4 h-4"}),"Ask AI"]})]})]}),b&&l.jsxs("div",{className:"card border-2 border-blue-200 bg-blue-50/50",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[l.jsx(gS,{className:"w-5 h-5 text-blue-600"})," Health Comparison"]}),l.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-700",children:" Improved"})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Previous (Oct)"}),l.jsx("p",{className:"text-2xl font-bold text-gray-400",children:"72/100"})]}),l.jsxs("div",{className:"bg-white p-4 rounded-xl",children:[l.jsx("p",{className:"text-sm text-gray-500",children:"Current (Dec)"}),l.jsx("p",{className:"text-2xl font-bold text-primary-600",children:"78/100"})]})]}),l.jsx("p",{className:"text-gray-700 mb-4",children:NY.summary}),l.jsx("div",{className:"space-y-2 mb-4",children:NY.metricChanges.map((ye,et)=>l.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Ne,{trend:ye.change}),l.jsx("span",{className:"font-medium",children:ye.metric})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("span",{className:"text-gray-500",children:ye.previous}),"  ",l.jsx("span",{className:"font-medium",children:ye.current})]})]},et))})]}),T&&l.jsxs("div",{className:"card border-2 border-purple-200",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(E7,{className:"w-5 h-5 text-purple-600"})," Ask About Your Report"]}),l.jsxs("div",{className:"h-48 overflow-y-auto mb-4 space-y-3 p-3 bg-gray-50 rounded-xl",children:[d.length===0&&l.jsx("p",{className:"text-gray-500 text-center py-6",children:'Try: "What does my cholesterol mean?" or "Should I be worried?"'}),d.map((ye,et)=>l.jsx("div",{className:`flex ${ye.role==="user"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-[80%] p-3 rounded-xl ${ye.role==="user"?"bg-purple-600 text-white":"bg-white border"}`,children:ye.content})},et)),l.jsx("div",{ref:we})]}),l.jsxs("form",{onSubmit:qe,className:"flex gap-2",children:[l.jsx("input",{type:"text",value:f,onChange:ye=>v(ye.target.value),placeholder:"Ask a question...",className:"input flex-1"}),l.jsx("button",{type:"submit",className:"btn-primary px-4",children:l.jsx(Bf,{className:"w-5 h-5"})})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(ir,{className:"w-5 h-5 text-primary-600"})," Summary"]}),l.jsx("p",{className:"text-gray-700",children:zo.summary})]}),l.jsxs("div",{className:"card",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Health Metrics"}),l.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Object.entries(zo.metrics).map(([ye,et])=>l.jsxs("div",{className:`p-4 rounded-xl ${et.status==="normal"?"bg-green-50":"bg-yellow-50"}`,children:[l.jsx("p",{className:"text-sm text-gray-600 capitalize",children:ye.replace(/([A-Z])/g," $1")}),l.jsxs("p",{className:"text-xl font-bold",children:[et.value," ",et.unit]}),l.jsxs("p",{className:"text-xs text-gray-500",children:["Normal: ",et.normalRange]}),l.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded ${et.status==="normal"?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,children:et.status})]},ye))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(Di,{className:"w-5 h-5 text-blue-600"})," Key Findings"]}),l.jsx("ul",{className:"space-y-2",children:zo.keyFindings.map((ye,et)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"}),ye]},et))})]}),l.jsxs("div",{className:"card border-l-4 border-orange-400",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(Yw,{className:"w-5 h-5 text-orange-600"})," Risk Factors"]}),l.jsx("ul",{className:"space-y-2",children:zo.riskFactors.map((ye,et)=>l.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[l.jsx("span",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full mt-2"}),ye]},et))})]})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(nc,{className:"w-5 h-5 text-green-600"})," Diet"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:zo.recommendations.diet.map((ye,et)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-green-800",children:ye.item}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${ye.priority==="high"?"bg-green-200 text-green-800":"bg-gray-200"}`,children:ye.priority})]}),l.jsx("p",{className:"text-sm text-green-700",children:ye.reason})]},et))})]}),l.jsxs("div",{className:"card",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(bP,{className:"w-5 h-5 text-blue-600"})," Exercise"]}),zo.recommendations.exercise.map((ye,et)=>l.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl mb-3",children:[l.jsxs("div",{className:"flex justify-between mb-2",children:[l.jsx("span",{className:"font-medium text-blue-800",children:ye.activity}),l.jsxs("span",{className:"text-sm text-blue-600",children:[ye.duration,"  ",ye.frequency]})]}),l.jsx("p",{className:"text-sm text-blue-700",children:ye.reason})]},et))]}),l.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[l.jsx(of,{className:"w-5 h-5 text-primary-600"})," Recommended Doctors"]}),l.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:tk.filter(ye=>zo.doctorConsultation.specializations.includes(ye.specialization)).map(ye=>l.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[l.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center text-lg font-bold text-primary-600",children:ye.name.split(" ")[1][0]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:ye.name}),l.jsx("p",{className:"text-sm text-primary-600",children:ye.specialization})]})]}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-2",children:[l.jsx(zc,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),ye.rating,"  ",l.jsx(ic,{className:"w-4 h-4"}),ye.experience," yrs"]}),l.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t",children:[l.jsxs("span",{className:"font-semibold",children:["",ye.fee]}),l.jsx("button",{onClick:()=>{P(ye),n("doctors")},className:"text-sm bg-primary-600 text-white px-3 py-1.5 rounded-lg hover:bg-primary-700",children:"Book Now"})]})]},ye._id))})]})]}),At=()=>l.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full flex flex-col",children:[l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-10 h-10 gradient-bg rounded-xl flex items-center justify-center",children:l.jsx(ir,{className:"w-6 h-6 text-white"})}),l.jsx("span",{className:"text-xl font-bold text-gray-900",children:"HealthAI"})]}),l.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Demo Mode"})]}),l.jsx("nav",{className:"px-4 space-y-1 flex-1",children:[{id:"dashboard",icon:pTe,label:"Dashboard"},{id:"upload",icon:lo,label:"Upload Report"},{id:"report",icon:li,label:"Report & Chat"},{id:"doctors",icon:of,label:"Doctors"},{id:"profile",icon:Kc,label:"Profile"}].map(ye=>l.jsxs("button",{onClick:()=>n(ye.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${e===ye.id?"bg-primary-50 text-primary-600":"text-gray-600 hover:bg-gray-50"}`,children:[l.jsx(ye.icon,{className:"w-5 h-5"}),l.jsx("span",{className:"font-medium",children:ye.label})]},ye.id))}),l.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:l.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:a,onChange:ye=>o(ye.target.checked),className:"w-4 h-4 text-primary-600 rounded"}),l.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Admin Mode"}),l.jsx(Gf,{className:"w-4 h-4 text-gray-400"})]})}),l.jsx("div",{className:"p-4 border-t border-gray-100",children:l.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[l.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:l.jsx("span",{className:"text-primary-600 font-semibold",children:"J"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a?"Admin User":"John Doe"}),l.jsx("p",{className:"text-xs text-gray-500 truncate",children:a?"admin@healthai.com":"john@example.com"})]}),l.jsx(c2,{className:"w-5 h-5 text-gray-400"})]})})]});return l.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[l.jsx(At,{}),l.jsxs("main",{className:"flex-1 ml-64 p-8",children:[e==="dashboard"&&l.jsx(Ke,{}),e==="upload"&&l.jsx(bt,{}),e==="report"&&l.jsx(Ft,{}),e==="doctors"&&l.jsx(Te,{}),e==="profile"&&l.jsx(Qe,{})]}),l.jsx(gt,{})]})}function nKe(){const[e,n]=q.useState(null),[a,o]=q.useState(!0),[d,p]=q.useState("overview");q.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:b}=await Vx.getStats();n(b)}catch{it.error("Failed to load stats")}finally{o(!1)}};if(a)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin"})});const v=[{id:"overview",label:"Overview",icon:ir},{id:"doctors",label:"Doctors",icon:VJ}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Admin Dashboard"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Manage platform settings and monitor activity"})]}),l.jsx("div",{className:"flex gap-2 p-1 bg-slate-100 rounded-xl w-fit",children:v.map(({id:b,label:E,icon:T})=>l.jsxs("button",{onClick:()=>p(b),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-all ${d===b?"bg-white text-slate-800 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:[l.jsx(T,{className:"w-4 h-4"}),l.jsx("span",{children:E})]},b))}),d==="overview"&&l.jsx(rKe,{stats:e}),d==="doctors"&&l.jsx(iKe,{})]})}function rKe({stats:e}){var n,a,o,d;return e?l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center mb-3",children:l.jsx(of,{className:"w-5 h-5 text-blue-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Patients"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((n=e.stats)==null?void 0:n.totalUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center mb-3",children:l.jsx(bi,{className:"w-5 h-5 text-green-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Active Users"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((a=e.stats)==null?void 0:a.activeUsers)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center mb-3",children:l.jsx(li,{className:"w-5 h-5 text-purple-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Total Reports"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((o=e.stats)==null?void 0:o.totalReports)||0})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center mb-3",children:l.jsx(Aa,{className:"w-5 h-5 text-amber-600"})}),l.jsx("p",{className:"text-sm text-slate-500",children:"Pending Doctors"}),l.jsx("p",{className:"text-2xl font-bold text-slate-800",children:((d=e.stats)==null?void 0:d.pendingDoctors)||0})]})]}):null}function iKe(){const[e,n]=q.useState([]),[a,o]=q.useState(!0),[d,p]=q.useState("all");q.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:w}=await Vx.getDoctors();n(w.doctors||[])}catch{it.error("Failed to load doctors")}finally{o(!1)}},v=async w=>{try{await Vx.approveDoctor(w),n(e.map(N=>N._id===w?{...N,approvalStatus:"approved",isListed:!0}:N)),it.success("Doctor approved!")}catch{it.error("Failed to approve")}},b=async w=>{try{await Vx.rejectDoctor(w),n(e.map(N=>N._id===w?{...N,approvalStatus:"rejected",isListed:!1}:N)),it.success("Doctor rejected")}catch{it.error("Failed to reject")}},E=e.filter(w=>d==="all"?!0:w.approvalStatus===d),T=e.filter(w=>w.approvalStatus==="pending").length;return a?l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 animate-pulse h-64"}):l.jsxs("div",{className:"space-y-4",children:[T>0&&l.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-center gap-4",children:[l.jsx(Aa,{className:"w-6 h-6 text-amber-500"}),l.jsx("div",{className:"flex-1",children:l.jsxs("p",{className:"font-medium text-amber-800",children:[T," Doctor(s) Pending Approval"]})}),l.jsx("button",{onClick:()=>p("pending"),className:"px-4 py-2 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600",children:"Review"})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Doctor Management"}),l.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(w=>l.jsx("button",{onClick:()=>p(w),className:`px-3 py-1.5 rounded-lg text-sm font-medium capitalize ${d===w?"bg-cyan-500 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:w},w))})]}),l.jsxs("div",{className:"space-y-3",children:[E.map(w=>{var N,P;return l.jsx("div",{className:`p-4 rounded-xl border ${w.approvalStatus==="pending"?"bg-amber-50 border-amber-200":w.approvalStatus==="rejected"?"bg-red-50 border-red-200":"bg-slate-50 border-slate-200"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold",children:(P=(N=w.name)==null?void 0:N[0])==null?void 0:P.toUpperCase()}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:["Dr. ",w.name]}),l.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${w.approvalStatus==="approved"?"bg-green-100 text-green-700":w.approvalStatus==="rejected"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:w.approvalStatus})]}),l.jsx("p",{className:"text-sm text-cyan-600",children:w.specialization}),l.jsxs("p",{className:"text-xs text-slate-500",children:[w.experience," yrs  ",w.consultationFee||0]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:w.approvalStatus==="pending"&&l.jsxs(l.Fragment,{children:[l.jsxs("button",{onClick:()=>v(w._id),className:"px-3 py-1.5 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 flex items-center gap-1",children:[l.jsx(bi,{className:"w-4 h-4"})," Approve"]}),l.jsxs("button",{onClick:()=>b(w._id),className:"px-3 py-1.5 bg-slate-200 text-red-600 text-sm font-medium rounded-lg hover:bg-slate-300 flex items-center gap-1",children:[l.jsx(BJ,{className:"w-4 h-4"})," Reject"]})]})})]})},w._id)}),E.length===0&&l.jsxs("div",{className:"text-center py-8 text-slate-500",children:[l.jsx(VJ,{className:"w-10 h-10 mx-auto mb-2 text-slate-300"}),l.jsx("p",{children:"No doctors found"})]})]})]})]})}const aKe=[{id:"free",name:"Free",price:0,period:"forever",features:["1 Report analysis per month","Basic AI insights","View doctor listings","Email support"],color:"slate",icon:zc},{id:"basic",name:"Basic",price:0,period:"month",features:["5 Report analyses per month","Full AI analysis with deficiencies","Personalized diet plans","Supplement recommendations","Health trend tracking","Priority support"],color:"cyan",icon:u2,popular:!0},{id:"premium",name:"Premium",price:0,period:"month",features:["Unlimited report analyses","Advanced AI insights","Personalized diet & exercise plans","Supplement recommendations","Health trend analytics","Chat with AI about reports","Doctor recommendations","24/7 Priority support"],color:"violet",icon:_P}];function sKe(){var E;const{user:e}=ma(),[n,a]=q.useState(null),[o,d]=q.useState(!0),[p,f]=q.useState("monthly");q.useEffect(()=>{v()},[]);const v=async()=>{try{const{data:T}=await Xwe.getSubscription();a(T)}catch{console.error("Failed to fetch subscription")}finally{d(!1)}},b=(n==null?void 0:n.plan)||((E=e==null?void 0:e.subscription)==null?void 0:E.plan)||"free";return o?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"})}):l.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in",children:[l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"inline-flex items-center gap-2 bg-violet-500/20 text-violet-400 px-4 py-2 rounded-full text-sm font-semibold mb-4",children:[l.jsx(_P,{className:"w-4 h-4"}),"Subscription Plans"]}),l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Choose Your Plan"}),l.jsx("p",{className:"text-slate-400 max-w-lg mx-auto",children:"Unlock the full potential of AI-powered health insights with our premium plans"})]}),l.jsxs("div",{className:"bg-gradient-to-r from-cyan-600 to-blue-600 rounded-2xl p-6 text-white relative overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 opacity-10",children:l.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"})}),l.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center",children:l.jsx(_P,{className:"w-7 h-7"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Current Plan"}),l.jsx("h2",{className:"text-2xl font-bold capitalize",children:b})]})]}),l.jsxs("div",{className:"flex items-center gap-6",children:[(n==null?void 0:n.endDate)&&l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-white/70 text-sm",children:"Renewal Date"}),l.jsx("p",{className:"font-semibold",children:new Date(n.endDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl",children:[l.jsx(ji,{className:"w-4 h-4"}),l.jsx("span",{className:"font-medium capitalize",children:(n==null?void 0:n.status)||"Active"})]})]})]})]}),l.jsx("div",{className:"flex justify-center",children:l.jsxs("div",{className:"flex items-center gap-3 p-1 bg-slate-800 rounded-xl",children:[l.jsx("button",{onClick:()=>f("monthly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all ${p==="monthly"?"bg-slate-700 text-white":"text-slate-400"}`,children:"Monthly"}),l.jsxs("button",{onClick:()=>f("yearly"),className:`px-6 py-2.5 rounded-lg font-medium transition-all flex items-center gap-2 ${p==="yearly"?"bg-slate-700 text-white":"text-slate-400"}`,children:["Yearly",l.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-400 px-2 py-0.5 rounded-full",children:"Save 20%"})]})]})}),l.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:aKe.map(T=>{const w=T.icon,N=b===T.id,P=p==="yearly"?Math.round(T.price*12*.8):T.price;return l.jsxs("div",{className:`bg-[#111827] rounded-2xl border p-6 relative ${T.popular?"border-cyan-500":"border-slate-700"} ${N?"ring-2 ring-cyan-500 ring-offset-2 ring-offset-[#0a0f1a]":""}`,children:[T.popular&&l.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:l.jsx("span",{className:"bg-cyan-500 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg",children:"Most Popular"})}),l.jsxs("div",{className:"text-center mb-6 pt-2",children:[l.jsx("div",{className:`w-14 h-14 rounded-2xl mx-auto mb-4 flex items-center justify-center bg-${T.color}-500/20`,children:l.jsx(w,{className:`w-7 h-7 text-${T.color}-400`})}),l.jsx("h3",{className:"text-xl font-bold text-white",children:T.name}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("span",{className:"text-4xl font-bold text-white",children:["",P]}),l.jsxs("span",{className:"text-slate-400",children:["/",p==="yearly"?"year":T.period]})]})]}),l.jsx("ul",{className:"space-y-3 mb-8",children:T.features.map((A,k)=>l.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[l.jsx("div",{className:`w-5 h-5 rounded-full bg-${T.color}-500/20 flex items-center justify-center flex-shrink-0 mt-0.5`,children:l.jsx(yh,{className:`w-3 h-3 text-${T.color}-400`})}),l.jsx("span",{className:"text-slate-400",children:A})]},k))}),l.jsx("button",{className:`w-full py-3 rounded-xl font-semibold transition-all ${N?"bg-slate-800 text-slate-500 cursor-default":T.popular?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:opacity-90":"border-2 border-slate-700 text-slate-300 hover:border-cyan-500 hover:text-cyan-400"}`,disabled:N,children:N?"Current Plan":T.price===0?"Downgrade":"Upgrade Now"})]},T.id)})}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex items-start gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:l.jsx(AJ,{className:"w-6 h-6 text-blue-400"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-bold text-white mb-2",children:"Secure Payment"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"All payments are processed securely. You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect immediately and unused time is prorated."})]})]})})]})}const Jv=[{id:"apple_watch",name:"Apple Watch",icon:_l,description:"Sync health data from your Apple Watch and iPhone",tags:["Heart Rate","Activity","Sleep"],color:"bg-slate-800",textColor:"text-slate-800"},{id:"google_fit",name:"Google Fit",icon:ir,description:"Aggregates data from Android devices and apps",tags:["Activity","Nutrition","Weight"],color:"bg-blue-500",textColor:"text-blue-600"},{id:"fitbit",name:"Fitbit",icon:u2,description:"Track steps, heart rate, and sleep patterns",tags:["Steps","Heart","Sleep"],color:"bg-cyan-500",textColor:"text-cyan-600"},{id:"garmin",name:"Garmin Connect",icon:Ca,description:"High-fidelity GPS and heart rate data",tags:["Cardio","GPS","Training"],color:"bg-indigo-600",textColor:"text-indigo-600"},{id:"samsung",name:"Samsung Health",icon:LJ,description:"Galaxy Watch and phone health data",tags:["Activity","Sleep","Stress"],color:"bg-purple-600",textColor:"text-purple-600"},{id:"oura",name:"Oura Ring",icon:Vf,description:"Advanced sleep and recovery tracking",tags:["Sleep","Recovery","HRV"],color:"bg-slate-700",textColor:"text-slate-700"}];function oKe(){const[e,n]=q.useState([]),[a,o]=q.useState(!0),[d,p]=q.useState(!1),[f,v]=q.useState(!1),[b,E]=q.useState(null);q.useEffect(()=>{T()},[]);const T=async()=>{try{const{data:I}=await xm.getDashboard();I.devices&&n(I.devices)}catch(I){console.error("Failed to fetch devices:",I)}finally{o(!1)}},w=async()=>{p(!0);try{e.length>0?(await xm.generateDemoData(e[0].type),await T(),it.success("All devices synced successfully!")):it.error("No devices connected")}catch(I){console.error("Sync failed:",I),it.error("Failed to sync devices")}finally{p(!1)}},N=async I=>{try{const F=Jv.find(U=>U.id===I);await xm.connectDevice(I,F==null?void 0:F.name),await xm.generateDemoData(I),await T(),v(!1),it.success(`${F==null?void 0:F.name} connected successfully!`)}catch(F){console.error("Failed to connect:",F),it.error("Failed to connect device")}},P=async I=>{try{await xm.disconnectDevice(I),await T(),it.success("Device disconnected")}catch(F){console.error("Failed to disconnect:",F),it.error("Failed to disconnect device")}},A=I=>{const F=Jv.find(U=>U.id===I);return(F==null?void 0:F.icon)||_l},k=I=>{const F=Jv.find(U=>U.id===I);return(F==null?void 0:F.color)||"bg-slate-600"};return a?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading devices..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Connected Devices"}),l.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[l.jsx(ic,{className:"w-4 h-4"}),"Last synced: ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("button",{onClick:w,disabled:d||e.length===0,className:"flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl hover:bg-slate-50 transition-all disabled:opacity-50",children:[l.jsx(wTe,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Sync All"]}),l.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl hover:shadow-lg transition-all",children:[l.jsx(Wc,{className:"w-4 h-4"}),"Add Device"]})]})]}),e.length===0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 flex items-start gap-3",children:[l.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-100 flex items-center justify-center shrink-0 mt-0.5",children:l.jsx(Aa,{className:"w-4 h-4 text-cyan-600"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-cyan-900 font-medium",children:"No devices connected yet"}),l.jsx("p",{className:"text-cyan-700 text-sm mt-1",children:"Connect your wearable devices to automatically track your health metrics and get personalized insights."})]})]}),e.length>0&&l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(gTe,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Your Devices"}),l.jsxs("span",{className:"px-2 py-0.5 bg-cyan-100 text-cyan-700 rounded-full text-xs font-medium",children:[e.length," connected"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((I,F)=>{const U=A(I.type),V=k(I.type),W=Math.floor(Math.random()*50)+50;return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:[l.jsxs("div",{className:"flex items-start justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${V} flex items-center justify-center`,children:l.jsx(U,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:I.name}),l.jsx("p",{className:"text-slate-500 text-sm",children:I.type})]})]}),l.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[l.jsx(bi,{className:"w-3 h-3"}),"Active"]})]}),l.jsx("div",{className:"flex gap-1 mb-4 h-16 bg-slate-50 rounded-lg p-2",children:[...Array(7)].map((B,z)=>{const Y=30+Math.random()*70;return l.jsx("div",{className:"flex-1 bg-gradient-to-t from-cyan-500 to-blue-500 rounded-sm",style:{height:`${Y}%`,marginTop:"auto"}},z)})}),l.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-200",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(Di,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Heart"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(PJ,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Steps"})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[l.jsx(Vf,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs",children:"Sleep"})]})]}),l.jsxs("div",{className:"flex items-center gap-1 text-slate-500 text-xs",children:[l.jsx(nTe,{className:"w-4 h-4"}),W,"%"]})]}),l.jsxs("div",{className:"mt-4 flex gap-2",children:[l.jsx("button",{onClick:()=>w(),className:"flex-1 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm font-medium",children:"Sync Now"}),l.jsx("button",{onClick:()=>P(I.type),className:"px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Disconnect"})]})]},F)})})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(_l,{className:"w-5 h-5 text-slate-600"}),l.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Available Integrations"})]})}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Jv.map(I=>{const F=I.icon,U=e.some(V=>V.type===I.id);return l.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:shadow-md transition-all",children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[l.jsx("div",{className:`w-12 h-12 rounded-xl ${I.color} flex items-center justify-center shrink-0`,children:l.jsx(F,{className:"w-6 h-6 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("p",{className:"text-slate-800 font-semibold",children:I.name}),U&&l.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:"Connected"})]}),l.jsx("p",{className:"text-slate-500 text-sm mb-3",children:I.description}),l.jsx("div",{className:"flex flex-wrap gap-2",children:I.tags.map(V=>l.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded-lg text-slate-600 text-xs",children:V},V))})]})]}),l.jsx("button",{onClick:()=>U?P(I.id):N(I.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${U?"bg-slate-100 text-slate-700 hover:bg-slate-200":"bg-gradient-to-r from-cyan-500 to-blue-500 text-white hover:shadow-lg"}`,children:U?"Disconnect":"Connect"})]})},I.id)})})]}),f&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-fade-in",children:l.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl animate-slide-up",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Connect a Device"}),l.jsx("button",{onClick:()=>v(!1),className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-slate-200 transition-colors",children:l.jsx(Ji,{className:"w-5 h-5"})})]}),l.jsx("p",{className:"text-slate-500 mb-6",children:"Select a device or service to connect"}),l.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:Jv.map(I=>{const F=I.icon,U=e.some(V=>V.type===I.id);return l.jsxs("button",{onClick:()=>!U&&N(I.id),disabled:U,className:`w-full p-4 border rounded-xl transition-all flex items-center gap-4 text-left ${U?"bg-slate-50 border-slate-200 opacity-60 cursor-not-allowed":"bg-white border-slate-200 hover:border-cyan-500 hover:shadow-sm"}`,children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${I.color} flex items-center justify-center shrink-0`,children:l.jsx(F,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"text-slate-800 font-medium",children:I.name}),U&&l.jsx(bi,{className:"w-4 h-4 text-emerald-500"})]}),l.jsx("p",{className:"text-slate-500 text-sm",children:I.description})]})]},I.id)})})]})})]})}function cKe(){var k,I,F,U,V,W,B,z,Y,re,Z,ie,te,de,xe,me,Ce,ue,be;const{patientId:e}=Vw(),[n]=Pxe(),a=n.get("appointmentId"),[o,d]=q.useState(null),[p,f]=q.useState(!0),[v,b]=q.useState("overview");if(q.useEffect(()=>{(async()=>{try{const{data:pe}=await Ja.getPatientProfile(e,a);d(pe)}catch(pe){console.error("Failed to fetch patient profile:",pe)}finally{f(!1)}})()},[e,a]),p)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:"Loading patient profile..."})]})});if(!o)return l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 text-center py-16",children:[l.jsx("p",{className:"text-slate-400",children:"Patient not found or access denied."}),l.jsx(hn,{to:"/doctors",className:"mt-4 inline-block px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-semibold rounded-xl",children:"Go Back"})]});const{patient:E,healthSummary:T,healthReports:w,wearableSummary:N,appointmentHistory:P}=o,A=[{id:"overview",label:"Overview",icon:Kc},{id:"reports",label:"Health Reports",icon:li},{id:"wearables",label:"Wearable Data",icon:_l},{id:"history",label:"Appointment History",icon:ji}];return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs(hn,{to:"/doctor/dashboard",className:"inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[l.jsx(co,{className:"w-4 h-4"}),"Back to Dashboard"]}),l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[l.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white text-3xl font-bold",children:(I=(k=E.name)==null?void 0:k.charAt(0))==null?void 0:I.toUpperCase()}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h1",{className:"text-2xl font-bold text-white",children:E.name}),l.jsxs("div",{className:"flex flex-wrap gap-4 mt-2 text-sm text-slate-400",children:[E.email&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(D0,{className:"w-4 h-4"})," ",E.email]}),E.phone&&l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(d2,{className:"w-4 h-4"})," ",E.phone]}),((F=E.profile)==null?void 0:F.age)&&l.jsxs("span",{children:[E.profile.age," years old"]}),((U=E.profile)==null?void 0:U.gender)&&l.jsx("span",{className:"capitalize",children:E.profile.gender})]})]}),(T==null?void 0:T.healthScore)&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`text-4xl font-bold ${T.healthScore>=80?"text-emerald-400":T.healthScore>=60?"text-amber-400":"text-red-400"}`,children:T.healthScore}),l.jsx("p",{className:"text-sm text-slate-400",children:"Health Score"})]})]})}),l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:A.map(se=>l.jsxs("button",{onClick:()=>b(se.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${v===se.id?"bg-cyan-500 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:[l.jsx(se.icon,{className:"w-4 h-4"}),se.label]},se.id))}),v==="overview"&&l.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(Kc,{className:"w-5 h-5 text-cyan-400"})," Basic Information"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((V=E.profile)==null?void 0:V.height)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Height"}),l.jsxs("p",{className:"font-semibold text-white",children:[E.profile.height," cm"]})]}),((W=E.profile)==null?void 0:W.weight)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Weight"}),l.jsxs("p",{className:"font-semibold text-white",children:[E.profile.weight," kg"]})]}),((B=E.profile)==null?void 0:B.bloodGroup)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"Blood Group"}),l.jsx("p",{className:"font-semibold text-white",children:E.profile.bloodGroup})]}),((z=E.healthMetrics)==null?void 0:z.bmi)&&l.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-400",children:"BMI"}),l.jsx("p",{className:"font-semibold text-white",children:E.healthMetrics.bmi.toFixed(1)})]})]}),((re=(Y=E.profile)==null?void 0:Y.allergies)==null?void 0:re.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Allergies"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.allergies.map((se,pe)=>l.jsx("span",{className:"px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm",children:se},pe))})]}),((ie=(Z=E.profile)==null?void 0:Z.chronicConditions)==null?void 0:ie.length)>0&&l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Chronic Conditions"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:E.profile.chronicConditions.map((se,pe)=>l.jsx("span",{className:"px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm",children:se},pe))})]})]}),T&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(Di,{className:"w-5 h-5 text-red-400"})," Health Summary"]}),((te=T.deficiencies)==null?void 0:te.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["Deficiencies (",T.deficiencies.length,")"]}),l.jsx("div",{className:"space-y-2",children:T.deficiencies.slice(0,3).map((se,pe)=>{var we,qe,lt;const De=typeof se.currentValue=="object"?((we=se.currentValue)==null?void 0:we.value)||JSON.stringify(se.currentValue):se.currentValue,Se=typeof se.normalRange=="object"?((qe=se.normalRange)==null?void 0:qe.value)||JSON.stringify(se.normalRange):se.normalRange;return l.jsxs("div",{className:`p-3 rounded-xl ${se.severity==="severe"?"bg-red-500/10 border border-red-500/30":se.severity==="moderate"?"bg-amber-500/10 border border-amber-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("span",{className:"font-medium text-white",children:typeof se.name=="object"?((lt=se.name)==null?void 0:lt.value)||"Unknown":se.name}),l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${se.severity==="severe"?"bg-red-500/20 text-red-400":se.severity==="moderate"?"bg-amber-500/20 text-amber-400":"bg-yellow-500/20 text-yellow-400"}`,children:se.severity})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Current: ",De," | Normal: ",Se]})]},pe)})})]}),((de=T.riskFactors)==null?void 0:de.length)>0&&l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Risk Factors"}),l.jsx("div",{className:"flex flex-wrap gap-2",children:T.riskFactors.map((se,pe)=>l.jsx("span",{className:"px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm",children:typeof se=="object"?(se==null?void 0:se.name)||(se==null?void 0:se.value)||JSON.stringify(se):se},pe))})]}),((xe=T.keyFindings)==null?void 0:xe.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Key Findings"}),l.jsx("ul",{className:"space-y-1",children:T.keyFindings.slice(0,4).map((se,pe)=>{const De=typeof se=="object"?(se==null?void 0:se.title)||(se==null?void 0:se.finding)||(se==null?void 0:se.value)||JSON.stringify(se):se;return l.jsxs("li",{className:"text-sm text-slate-300 flex items-start gap-2",children:[l.jsx("span",{className:"text-cyan-400 mt-1",children:""}),De]},pe)})})]})]}),N&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 lg:col-span-2",children:[l.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(_l,{className:"w-5 h-5 text-blue-400"})," Wearable Data Summary"]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"p-4 bg-blue-500/10 rounded-xl text-center border border-blue-500/20",children:[l.jsx(ir,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((me=N.avgSteps)==null?void 0:me.toLocaleString())||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Steps/Day"})]}),l.jsxs("div",{className:"p-4 bg-red-500/10 rounded-xl text-center border border-red-500/20",children:[l.jsx(Di,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgHeartRate||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Heart Rate"})]}),l.jsxs("div",{className:"p-4 bg-indigo-500/10 rounded-xl text-center border border-indigo-500/20",children:[l.jsx(ic,{className:"w-6 h-6 text-indigo-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:N.avgSleepHours||"N/A"}),l.jsx("p",{className:"text-sm text-slate-400",children:"Avg Sleep (hrs)"})]}),l.jsxs("div",{className:"p-4 bg-emerald-500/10 rounded-xl text-center border border-emerald-500/20",children:[l.jsx(_l,{className:"w-6 h-6 text-emerald-400 mx-auto mb-2"}),l.jsx("p",{className:"text-2xl font-bold text-white",children:((Ce=N.devices)==null?void 0:Ce.length)||0}),l.jsx("p",{className:"text-sm text-slate-400",children:"Connected Devices"})]})]})]})]}),v==="reports"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Health Reports"}),(w==null?void 0:w.length)>0?l.jsx("div",{className:"space-y-3",children:w.map(se=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center",children:l.jsx(li,{className:"w-6 h-6 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("p",{className:"font-semibold text-white",children:se.reportType}),l.jsx("p",{className:"text-sm text-slate-400",children:new Date(se.createdAt).toLocaleDateString()})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[se.healthScore&&l.jsxs("span",{className:`font-bold ${se.healthScore>=80?"text-emerald-400":se.healthScore>=60?"text-amber-400":"text-red-400"}`,children:["Score: ",se.healthScore]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${se.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:se.status})]})]},se._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No health reports available"})]}),v==="wearables"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Wearable Device Data"}),N?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Connected Devices"}),l.jsx("div",{className:"flex flex-wrap gap-3",children:(ue=N.devices)==null?void 0:ue.map((se,pe)=>l.jsxs("div",{className:"px-4 py-2 bg-cyan-500/10 border border-cyan-500/20 rounded-xl flex items-center gap-2",children:[l.jsx(_l,{className:"w-4 h-4 text-cyan-400"}),l.jsx("span",{className:"font-medium text-cyan-300",children:se.name||se.type})]},pe))})]}),((be=N.recentMetrics)==null?void 0:be.length)>0&&l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Recent Activity (Last 7 Days)"}),l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b border-slate-700",children:[l.jsx("th",{className:"text-left py-2 text-slate-400 font-medium",children:"Date"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Steps"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Calories"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Active Min"}),l.jsx("th",{className:"text-right py-2 text-slate-400 font-medium",children:"Distance"})]})}),l.jsx("tbody",{children:N.recentMetrics.map((se,pe)=>{var De,Se;return l.jsxs("tr",{className:"border-b border-slate-700/50",children:[l.jsx("td",{className:"py-2 text-white",children:new Date(se.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:(De=se.steps)==null?void 0:De.toLocaleString()}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:se.caloriesBurned}),l.jsx("td",{className:"py-2 text-right text-slate-300",children:se.activeMinutes}),l.jsxs("td",{className:"py-2 text-right text-slate-300",children:[(Se=se.distance)==null?void 0:Se.toFixed(1)," km"]})]},pe)})})]})})]})]}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No wearable data available"})]}),v==="history"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Appointment History"}),(P==null?void 0:P.length)>0?l.jsx("div",{className:"space-y-3",children:P.map(se=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ji,{className:"w-5 h-5 text-slate-400"}),l.jsx("span",{className:"font-semibold text-white",children:new Date(se.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),l.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${se.status==="completed"?"bg-emerald-500/20 text-emerald-400":se.status==="scheduled"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400"}`,children:se.status})]}),se.doctor&&l.jsxs("p",{className:"text-sm text-slate-400",children:["Dr. ",se.doctor.name," - ",se.doctor.specialization]}),se.symptoms&&l.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Symptoms:"})," ",se.symptoms]}),se.notes&&l.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[l.jsx("span",{className:"font-medium text-slate-400",children:"Notes:"})," ",se.notes]})]},se._id))}):l.jsx("p",{className:"text-slate-400 text-center py-8",children:"No appointment history"})]})]})}var Mte={exports:{}};(function(e,n){(function(a,o){e.exports=o()})(Id,function(){function a(t,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if(s!=="default"&&!(s in t)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Id<"u"?Id:typeof self<"u"?self:{};function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var p=function(t){try{return!!t()}catch{return!0}},f=!p(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),v=f,b=Function.prototype,E=b.call,T=v&&b.bind.bind(E,E),w=v?T:function(t){return function(){return E.apply(t,arguments)}},N=w({}.isPrototypeOf),P=function(t){return t&&t.Math===Math&&t},A=P(typeof globalThis=="object"&&globalThis)||P(typeof window=="object"&&window)||P(typeof self=="object"&&self)||P(typeof o=="object"&&o)||P(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),k=f,I=Function.prototype,F=I.apply,U=I.call,V=typeof Reflect=="object"&&Reflect.apply||(k?U.bind(F):function(){return U.apply(F,arguments)}),W=w,B=W({}.toString),z=W("".slice),Y=function(t){return z(B(t),8,-1)},re=Y,Z=w,ie=function(t){if(re(t)==="Function")return Z(t)},te=typeof document=="object"&&document.all,de=te===void 0&&te!==void 0?function(t){return typeof t=="function"||t===te}:function(t){return typeof t=="function"},xe={},me=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Ce=f,ue=Function.prototype.call,be=Ce?ue.bind(ue):function(){return ue.apply(ue,arguments)},se={},pe={}.propertyIsEnumerable,De=Object.getOwnPropertyDescriptor,Se=De&&!pe.call({1:2},1);se.f=Se?function(t){var r=De(this,t);return!!r&&r.enumerable}:pe;var we,qe,lt=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},Ut=p,Ht=Y,Ue=Object,dt=w("".split),Ne=Ut(function(){return!Ue("z").propertyIsEnumerable(0)})?function(t){return Ht(t)==="String"?dt(t,""):Ue(t)}:Ue,Ke=function(t){return t==null},bt=Ke,Te=TypeError,gt=function(t){if(bt(t))throw new Te("Can't call method on "+t);return t},Qe=Ne,Ft=gt,At=function(t){return Qe(Ft(t))},ye=de,et=function(t){return typeof t=="object"?t!==null:ye(t)},zt={},ui=zt,fa=A,Da=de,oc=function(t){return Da(t)?t:void 0},nt=function(t,r){return arguments.length<2?oc(ui[t])||oc(fa[t]):ui[t]&&ui[t][r]||fa[t]&&fa[t][r]},Lt=A.navigator,fr=Lt&&Lt.userAgent,Wn=fr?String(fr):"",Ye=A,St=Wn,Dn=Ye.process,ni=Ye.Deno,ka=Dn&&Dn.versions||ni&&ni.version,Zi=ka&&ka.v8;Zi&&(qe=(we=Zi.split("."))[0]>0&&we[0]<4?1:+(we[0]+we[1])),!qe&&St&&(!(we=St.match(/Edge\/(\d+)/))||we[1]>=74)&&(we=St.match(/Chrome\/(\d+)/))&&(qe=+we[1]);var gr=qe,Xr=gr,lu=p,du=A.String,cc=!!Object.getOwnPropertySymbols&&!lu(function(){var t=Symbol("symbol detection");return!du(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Xr&&Xr<41}),W0=cc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vte=nt,Bte=de,Gte=N,Wte=Object,ig=W0?function(t){return typeof t=="symbol"}:function(t){var r=Vte("Symbol");return Bte(r)&&Gte(r.prototype,Wte(t))},$te=String,Xh=function(t){try{return $te(t)}catch{return"Object"}},Hte=de,zte=Xh,Kte=TypeError,ja=function(t){if(Hte(t))return t;throw new Kte(zte(t)+" is not a function")},Yte=ja,qte=Ke,ag=function(t,r){var i=t[r];return qte(i)?void 0:Yte(i)},_j=be,bj=de,Ej=et,Xte=TypeError,xj={exports:{}},Sj=A,Jte=Object.defineProperty,Qte=A,Zte=function(t,r){try{Jte(Sj,t,{value:r,configurable:!0,writable:!0})}catch{Sj[t]=r}return r},wj="__core-js_shared__",Tj=xj.exports=Qte[wj]||Zte(wj,{});(Tj.versions||(Tj.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var FT=xj.exports,Cj=FT,Jh=function(t,r){return Cj[t]||(Cj[t]=r||{})},ene=gt,tne=Object,lc=function(t){return tne(ene(t))},nne=lc,rne=w({}.hasOwnProperty),ri=Object.hasOwn||function(t,r){return rne(nne(t),r)},ine=w,ane=0,sne=Math.random(),one=ine(1.1.toString),VT=function(t){return"Symbol("+(t===void 0?"":t)+")_"+one(++ane+sne,36)},cne=Jh,Nj=ri,lne=VT,dne=cc,une=W0,Qh=A.Symbol,BT=cne("wks"),hne=une?Qh.for||Qh:Qh&&Qh.withoutSetter||lne,Zn=function(t){return Nj(BT,t)||(BT[t]=dne&&Nj(Qh,t)?Qh[t]:hne("Symbol."+t)),BT[t]},pne=be,Rj=et,Aj=ig,mne=ag,fne=function(t,r){var i,s;if(bj(i=t.toString)&&!Ej(s=_j(i,t))||bj(i=t.valueOf)&&!Ej(s=_j(i,t)))return s;throw new Xte("Can't convert object to primitive value")},gne=TypeError,vne=Zn("toPrimitive"),yne=function(t,r){if(!Rj(t)||Aj(t))return t;var i,s=mne(t,vne);if(s){if(i=pne(s,t,r),!Rj(i)||Aj(i))return i;throw new gne("Can't convert object to primitive value")}return fne(t)},_ne=ig,GT=function(t){var r=yne(t,"string");return _ne(r)?r:r+""},Ij=et,WT=A.document,bne=Ij(WT)&&Ij(WT.createElement),$T=function(t){return bne?WT.createElement(t):{}},Ene=$T,Oj=!me&&!p(function(){return Object.defineProperty(Ene("div"),"a",{get:function(){return 7}}).a!==7}),xne=me,Sne=be,wne=se,Tne=lt,Cne=At,Nne=GT,Rne=ri,Ane=Oj,Pj=Object.getOwnPropertyDescriptor;xe.f=xne?Pj:function(t,r){if(t=Cne(t),r=Nne(r),Ane)try{return Pj(t,r)}catch{}if(Rne(t,r))return Tne(!Sne(wne.f,t,r),t[r])};var Ine=p,One=de,Pne=/#|\.prototype\./,sg=function(t,r){var i=kne[Dne(t)];return i===Lne||i!==jne&&(One(r)?Ine(r):!!r)},Dne=sg.normalize=function(t){return String(t).replace(Pne,".").toLowerCase()},kne=sg.data={},jne=sg.NATIVE="N",Lne=sg.POLYFILL="P",Dj=sg,Mne=ja,Une=f,Fne=ie(ie.bind),Wl=function(t,r){return Mne(t),r===void 0?t:Une?Fne(t,r):function(){return t.apply(r,arguments)}},Os={},kj=me&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Vne=et,Bne=String,Gne=TypeError,ga=function(t){if(Vne(t))return t;throw new Gne(Bne(t)+" is not an object")},Wne=me,$ne=Oj,Hne=kj,$0=ga,jj=GT,zne=TypeError,HT=Object.defineProperty,Kne=Object.getOwnPropertyDescriptor,zT="enumerable",KT="configurable",YT="writable";Os.f=Wne?Hne?function(t,r,i){if($0(t),r=jj(r),$0(i),typeof t=="function"&&r==="prototype"&&"value"in i&&YT in i&&!i[YT]){var s=Kne(t,r);s&&s[YT]&&(t[r]=i.value,i={configurable:KT in i?i[KT]:s[KT],enumerable:zT in i?i[zT]:s[zT],writable:!1})}return HT(t,r,i)}:HT:function(t,r,i){if($0(t),r=jj(r),$0(i),$ne)try{return HT(t,r,i)}catch{}if("get"in i||"set"in i)throw new zne("Accessors not supported");return"value"in i&&(t[r]=i.value),t};var Yne=Os,qne=lt,uu=me?function(t,r,i){return Yne.f(t,r,qne(1,i))}:function(t,r,i){return t[r]=i,t},og=A,Xne=V,Jne=ie,Qne=de,Zne=xe.f,ere=Dj,Zh=zt,tre=Wl,ep=uu,Lj=ri,nre=function(t){var r=function(i,s,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(i);case 2:return new t(i,s)}return new t(i,s,c)}return Xne(t,this,arguments)};return r.prototype=t.prototype,r},Zt=function(t,r){var i,s,c,u,h,m,g,y,_,x=t.target,S=t.global,C=t.stat,M=t.proto,D=S?og:C?og[x]:og[x]&&og[x].prototype,j=S?Zh:Zh[x]||ep(Zh,x,{})[x],$=j.prototype;for(u in r)s=!(i=ere(S?u:x+(C?".":"#")+u,t.forced))&&D&&Lj(D,u),m=j[u],s&&(g=t.dontCallGetSet?(_=Zne(D,u))&&_.value:D[u]),h=s&&g?g:r[u],(i||M||typeof m!=typeof h)&&(y=t.bind&&s?tre(h,og):t.wrap&&s?nre(h):M&&Qne(h)?Jne(h):h,(t.sham||h&&h.sham||m&&m.sham)&&ep(y,"sham",!0),ep(j,u,y),M&&(Lj(Zh,c=x+"Prototype")||ep(Zh,c,{}),ep(Zh[c],u,h),t.real&&$&&(i||!$[u])&&ep($,u,h)))},rre=Math.ceil,ire=Math.floor,are=Math.trunc||function(t){var r=+t;return(r>0?ire:rre)(r)},sre=are,qT=function(t){var r=+t;return r!=r||r===0?0:sre(r)},ore=qT,cre=Math.max,lre=Math.min,XT=function(t,r){var i=ore(t);return i<0?cre(i+r,0):lre(i,r)},dre=qT,ure=Math.min,Mj=function(t){var r=dre(t);return r>0?ure(r,9007199254740991):0},hre=Mj,$l=function(t){return hre(t.length)},pre=At,mre=XT,fre=$l,Uj=function(t){return function(r,i,s){var c=pre(r),u=fre(c);if(u===0)return!t&&-1;var h,m=mre(s,u);if(t&&i!=i){for(;u>m;)if((h=c[m++])!=h)return!0}else for(;u>m;m++)if((t||m in c)&&c[m]===i)return t||m||0;return!t&&-1}},JT={includes:Uj(!0),indexOf:Uj(!1)},gre=JT.includes;Zt({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(t){return gre(this,t,arguments.length>1?arguments[1]:void 0)}});var vre=A,yre=zt,as=function(t,r){var i=yre[t+"Prototype"],s=i&&i[r];if(s)return s;var c=vre[t],u=c&&c.prototype;return u&&u[r]},_re=as("Array","includes"),bre=et,Ere=Y,xre=Zn("match"),QT=function(t){var r;return bre(t)&&((r=t[xre])!==void 0?!!r:Ere(t)==="RegExp")},Sre=QT,wre=TypeError,Fj={};Fj[Zn("toStringTag")]="z";var ZT=String(Fj)==="[object z]",Tre=ZT,Cre=de,H0=Y,Nre=Zn("toStringTag"),Rre=Object,Are=H0(function(){return arguments}())==="Arguments",Hl=Tre?H0:function(t){var r,i,s;return t===void 0?"Undefined":t===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=Rre(t),Nre))=="string"?i:Are?H0(r):(s=H0(r))==="Object"&&Cre(r.callee)?"Arguments":s},Ire=Hl,Ore=String,va=function(t){if(Ire(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Ore(t)},Pre=Zn("match"),Dre=Zt,kre=function(t){if(Sre(t))throw new wre("The method doesn't accept regular expressions");return t},jre=gt,Vj=va,Lre=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[Pre]=!1,"/./"[t](r)}catch{}}return!1},Mre=w("".indexOf);Dre({target:"String",proto:!0,forced:!Lre("includes")},{includes:function(t){return!!~Mre(Vj(jre(this)),Vj(kre(t)),arguments.length>1?arguments[1]:void 0)}});var Ure=as("String","includes"),Bj=N,Fre=_re,Vre=Ure,eC=Array.prototype,tC=String.prototype,Bre=function(t){var r=t.includes;return t===eC||Bj(eC,t)&&r===eC.includes?Fre:typeof t=="string"||t===tC||Bj(tC,t)&&r===tC.includes?Vre:r},Re=d(Bre),Gre=ja,Wre=lc,$re=Ne,Hre=$l,Gj=TypeError,Wj="Reduce of empty array with no initial value",zre=function(t){return function(r,i,s,c){var u=Wre(r),h=$re(u),m=Hre(u);if(Gre(i),m===0&&s<2)throw new Gj(Wj);var g=t?m-1:0,y=t?-1:1;if(s<2)for(;;){if(g in h){c=h[g],g+=y;break}if(g+=y,t?g<0:m<=g)throw new Gj(Wj)}for(;t?g>=0:m>g;g+=y)g in h&&(c=i(c,h[g],g,u));return c}},Kre={left:zre(!1)},Yre=p,z0=function(t,r){var i=[][t];return!!i&&Yre(function(){i.call(null,r||function(){return 1},1)})},cg=A,qre=Wn,Xre=Y,K0=function(t){return qre.slice(0,t.length)===t},nC=K0("Bun/")?"BUN":K0("Cloudflare-Workers")?"CLOUDFLARE":K0("Deno/")?"DENO":K0("Node.js/")?"NODE":cg.Bun&&typeof Bun.version=="string"?"BUN":cg.Deno&&typeof Deno.version=="object"?"DENO":Xre(cg.process)==="process"?"NODE":cg.window&&cg.document?"BROWSER":"REST",Y0=nC==="NODE",Jre=Kre.left;Zt({target:"Array",proto:!0,forced:!Y0&&gr>79&&gr<83||!z0("reduce")},{reduce:function(t){var r=arguments.length;return Jre(this,t,r,r>1?arguments[1]:void 0)}});var Qre=as("Array","reduce"),Zre=N,eie=Qre,rC=Array.prototype,tie=function(t){var r=t.reduce;return t===rC||Zre(rC,t)&&r===rC.reduce?eie:r},$j=tie,ss=d($j),nie=Y,lg=Array.isArray||function(t){return nie(t)==="Array"},rie=Zt,iie=lg,aie=w([].reverse),Hj=[1,2];rie({target:"Array",proto:!0,forced:String(Hj)===String(Hj.reverse())},{reverse:function(){return iie(this)&&(this.length=this.length),aie(this)}});var sie=as("Array","reverse"),oie=N,cie=sie,iC=Array.prototype,lie=function(t){var r=t.reverse;return t===iC||oie(iC,t)&&r===iC.reverse?cie:r},zj=lie,Kj=d(zj),die=VT,Yj=Jh("keys"),q0=function(t){return Yj[t]||(Yj[t]=die(t))},uie=!p(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),hie=ri,pie=de,mie=lc,fie=uie,qj=q0("IE_PROTO"),aC=Object,gie=aC.prototype,sC=fie?aC.getPrototypeOf:function(t){var r=mie(t);if(hie(r,qj))return r[qj];var i=r.constructor;return pie(i)&&r instanceof i?i.prototype:r instanceof aC?gie:null},vie=w,yie=ja,_ie=et,bie=function(t){return _ie(t)||t===null},Eie=String,xie=TypeError,Sie=function(t,r,i){try{return vie(yie(Object.getOwnPropertyDescriptor(t,r)[i]))}catch{}},wie=et,Tie=gt,Cie=function(t){if(bie(t))return t;throw new xie("Can't set "+Eie(t)+" as a prototype")},Nie=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,i={};try{(t=Sie(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(s,c){return Tie(s),Cie(c),wie(s)&&(r?t(s,c):s.__proto__=c),s}}():void 0),X0={},J0={},oC=ri,Rie=At,Aie=JT.indexOf,Iie=J0,Xj=w([].push),Jj=function(t,r){var i,s=Rie(t),c=0,u=[];for(i in s)!oC(Iie,i)&&oC(s,i)&&Xj(u,i);for(;r.length>c;)oC(s,i=r[c++])&&(~Aie(u,i)||Xj(u,i));return u},cC=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Oie=Jj,Pie=cC.concat("length","prototype");X0.f=Object.getOwnPropertyNames||function(t){return Oie(t,Pie)};var dg={};dg.f=Object.getOwnPropertySymbols;var Die=nt,kie=X0,jie=dg,Lie=ga,Mie=w([].concat),Uie=Die("Reflect","ownKeys")||function(t){var r=kie.f(Lie(t)),i=jie.f;return i?Mie(r,i(t)):r},Qj=ri,Fie=Uie,Vie=xe,Bie=Os,lC={},Gie=Jj,Wie=cC,Q0=Object.keys||function(t){return Gie(t,Wie)},$ie=me,Hie=kj,zie=Os,Kie=ga,Yie=At,qie=Q0;lC.f=$ie&&!Hie?Object.defineProperties:function(t,r){Kie(t);for(var i,s=Yie(r),c=qie(r),u=c.length,h=0;u>h;)zie.f(t,i=c[h++],s[i]);return t};var Z0,Zj=nt("document","documentElement"),Xie=ga,Jie=lC,eL=cC,Qie=J0,Zie=Zj,eae=$T,dC="prototype",uC="script",tL=q0("IE_PROTO"),hC=function(){},nL=function(t){return"<"+uC+">"+t+"</"+uC+">"},rL=function(t){t.write(nL("")),t.close();var r=t.parentWindow.Object;return t=null,r},e_=function(){try{Z0=new ActiveXObject("htmlfile")}catch{}var t,r,i;e_=typeof document<"u"?document.domain&&Z0?rL(Z0):(r=eae("iframe"),i="java"+uC+":",r.style.display="none",Zie.appendChild(r),r.src=String(i),(t=r.contentWindow.document).open(),t.write(nL("document.F=Object")),t.close(),t.F):rL(Z0);for(var s=eL.length;s--;)delete e_[dC][eL[s]];return e_()};Qie[tL]=!0;var ug=Object.create||function(t,r){var i;return t!==null?(hC[dC]=Xie(t),i=new hC,hC[dC]=null,i[tL]=t):i=e_(),r===void 0?i:Jie.f(i,r)},tae=et,nae=uu,iL=Error,rae=w("".replace),iae=String(new iL("zxcasd").stack),aL=/\n\s*at [^:]*:[^\n]*/,aae=aL.test(iae),sae=lt,oae=!p(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",sae(1,7)),t.stack!==7)}),cae=uu,lae=function(t,r){if(aae&&typeof t=="string"&&!iL.prepareStackTrace)for(;r--;)t=rae(t,aL,"");return t},dae=oae,sL=Error.captureStackTrace,tp={},uae=tp,hae=Zn("iterator"),pae=Array.prototype,oL=function(t){return t!==void 0&&(uae.Array===t||pae[hae]===t)},mae=Hl,cL=ag,fae=Ke,gae=tp,vae=Zn("iterator"),t_=function(t){if(!fae(t))return cL(t,vae)||cL(t,"@@iterator")||gae[mae(t)]},yae=be,_ae=ja,bae=ga,Eae=Xh,xae=t_,Sae=TypeError,pC=function(t,r){var i=arguments.length<2?xae(t):r;if(_ae(i))return bae(yae(i,t));throw new Sae(Eae(t)+" is not iterable")},wae=be,lL=ga,Tae=ag,dL=function(t,r,i){var s,c;lL(t);try{if(!(s=Tae(t,"return"))){if(r==="throw")throw i;return i}s=wae(s,t)}catch(u){c=!0,s=u}if(r==="throw")throw i;if(c)throw s;return lL(s),i},Cae=Wl,Nae=be,Rae=ga,Aae=Xh,Iae=oL,Oae=$l,uL=N,Pae=pC,Dae=t_,hL=dL,kae=TypeError,n_=function(t,r){this.stopped=t,this.result=r},pL=n_.prototype,hg=function(t,r,i){var s,c,u,h,m,g,y,_=i&&i.that,x=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),M=!(!i||!i.INTERRUPTED),D=Cae(r,_),j=function(K){return s&&hL(s,"normal"),new n_(!0,K)},$=function(K){return x?(Rae(K),M?D(K[0],K[1],j):D(K[0],K[1])):M?D(K,j):D(K)};if(S)s=t.iterator;else if(C)s=t;else{if(!(c=Dae(t)))throw new kae(Aae(t)+" is not iterable");if(Iae(c)){for(u=0,h=Oae(t);h>u;u++)if((m=$(t[u]))&&uL(pL,m))return m;return new n_(!1)}s=Pae(t,c)}for(g=S?t.next:s.next;!(y=Nae(g,s)).done;){try{m=$(y.value)}catch(K){hL(s,"throw",K)}if(typeof m=="object"&&m&&uL(pL,m))return m}return new n_(!1)},jae=va,Lae=Zt,Mae=N,Uae=sC,r_=Nie,Fae=function(t,r,i){for(var s=Fie(r),c=Bie.f,u=Vie.f,h=0;h<s.length;h++){var m=s[h];Qj(t,m)||i&&Qj(i,m)||c(t,m,u(r,m))}},mL=ug,mC=uu,fC=lt,Vae=function(t,r){tae(r)&&"cause"in r&&nae(t,"cause",r.cause)},Bae=function(t,r,i,s){dae&&(sL?sL(t,r):cae(t,"stack",lae(i,s)))},Gae=hg,Wae=function(t,r){return t===void 0?arguments.length<2?"":r:jae(t)},$ae=Zn("toStringTag"),i_=Error,Hae=[].push,np=function(t,r){var i,s=Mae(gC,this);r_?i=r_(new i_,s?Uae(this):gC):(i=s?this:mL(gC),mC(i,$ae,"Error")),r!==void 0&&mC(i,"message",Wae(r)),Bae(i,np,i.stack,1),arguments.length>2&&Vae(i,arguments[2]);var c=[];return Gae(t,Hae,{that:c}),mC(i,"errors",c),i};r_?r_(np,i_):Fae(np,i_,{name:!0});var gC=np.prototype=mL(i_.prototype,{constructor:fC(1,np),message:fC(1,""),name:fC(1,"AggregateError")});Lae({global:!0},{AggregateError:np});var a_,pg,s_,zae=de,fL=A.WeakMap,Kae=zae(fL)&&/native code/.test(String(fL)),gL=A,Yae=et,qae=uu,vC=ri,yC=FT,Xae=q0,Jae=J0,vL="Object already initialized",_C=gL.TypeError,Qae=gL.WeakMap;if(Kae||yC.state){var dc=yC.state||(yC.state=new Qae);dc.get=dc.get,dc.has=dc.has,dc.set=dc.set,a_=function(t,r){if(dc.has(t))throw new _C(vL);return r.facade=t,dc.set(t,r),r},pg=function(t){return dc.get(t)||{}},s_=function(t){return dc.has(t)}}else{var rp=Xae("state");Jae[rp]=!0,a_=function(t,r){if(vC(t,rp))throw new _C(vL);return r.facade=t,qae(t,rp,r),r},pg=function(t){return vC(t,rp)?t[rp]:{}},s_=function(t){return vC(t,rp)}}var hu,yL,_L,pu={set:a_,get:pg,has:s_,enforce:function(t){return s_(t)?pg(t):a_(t,{})},getterFor:function(t){return function(r){var i;if(!Yae(r)||(i=pg(r)).type!==t)throw new _C("Incompatible receiver, "+t+" required");return i}}},bC=me,Zae=ri,bL=Function.prototype,ese=bC&&Object.getOwnPropertyDescriptor,EL=Zae(bL,"name"),xL={PROPER:EL&&(function(){}).name==="something",CONFIGURABLE:EL&&(!bC||bC&&ese(bL,"name").configurable)},tse=uu,zl=function(t,r,i,s){return s&&s.enumerable?t[r]=i:tse(t,r,i),t},nse=p,rse=de,ise=et,ase=ug,SL=sC,sse=zl,EC=Zn("iterator"),wL=!1;[].keys&&("next"in(_L=[].keys())?(yL=SL(SL(_L)))!==Object.prototype&&(hu=yL):wL=!0);var ose=!ise(hu)||nse(function(){var t={};return hu[EC].call(t)!==t});rse((hu=ose?{}:ase(hu))[EC])||sse(hu,EC,function(){return this});var TL={IteratorPrototype:hu,BUGGY_SAFARI_ITERATORS:wL},cse=Hl,lse=ZT?{}.toString:function(){return"[object "+cse(this)+"]"},dse=ZT,use=Os.f,hse=uu,pse=ri,mse=lse,CL=Zn("toStringTag"),Jc=function(t,r,i,s){var c=i?t:t&&t.prototype;c&&(pse(c,CL)||use(c,CL,{configurable:!0,value:r}),s&&!dse&&hse(c,"toString",mse))},fse=TL.IteratorPrototype,gse=ug,vse=lt,yse=Jc,_se=tp,bse=function(){return this},xC=function(t,r,i,s){var c=r+" Iterator";return t.prototype=gse(fse,{next:vse(+!s,i)}),yse(t,c,!1,!0),_se[c]=bse,t},Ese=Zt,xse=be,Sse=xL,wse=xC,Tse=sC,Cse=Jc,NL=zl,RL=tp,Nse=TL,Rse=Sse.PROPER,o_=Nse.BUGGY_SAFARI_ITERATORS,SC=Zn("iterator"),AL="keys",c_="values",IL="entries",Ase=function(){return this},OL=function(t,r,i,s,c,u,h){wse(i,r,s);var m,g,y,_=function($){if($===c&&D)return D;if(!o_&&$&&$ in C)return C[$];switch($){case AL:case c_:case IL:return function(){return new i(this,$)}}return function(){return new i(this)}},x=r+" Iterator",S=!1,C=t.prototype,M=C[SC]||C["@@iterator"]||c&&C[c],D=!o_&&M||_(c),j=r==="Array"&&C.entries||M;if(j&&(m=Tse(j.call(new t)))!==Object.prototype&&m.next&&(Cse(m,x,!0,!0),RL[x]=Ase),Rse&&c===c_&&M&&M.name!==c_&&(S=!0,D=function(){return xse(M,this)}),c)if(g={values:_(c_),keys:u?D:_(AL),entries:_(IL)},h)for(y in g)(o_||S||!(y in C))&&NL(C,y,g[y]);else Ese({target:r,proto:!0,forced:o_||S},g);return h&&C[SC]!==D&&NL(C,SC,D,{}),RL[r]=D,g},l_=function(t,r){return{value:t,done:r}},Ise=At,PL=tp,DL=pu;Os.f;var Ose=OL,d_=l_,kL="Array Iterator",Pse=DL.set,Dse=DL.getterFor(kL);Ose(Array,"Array",function(t,r){Pse(this,{type:kL,target:Ise(t),index:0,kind:r})},function(){var t=Dse(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,d_(void 0,!0);switch(t.kind){case"keys":return d_(i,!1);case"values":return d_(r[i],!1)}return d_([i,r[i]],!1)},"values"),PL.Arguments=PL.Array;var kse=Os,u_=function(t,r,i){return kse.f(t,r,i)},jse=nt,Lse=u_,Mse=me,jL=Zn("species"),Use=N,Fse=TypeError,wC=function(t,r){if(Use(r,t))return t;throw new Fse("Incorrect invocation")},Vse=de,TC=FT,Bse=w(Function.toString);Vse(TC.inspectSource)||(TC.inspectSource=function(t){return Bse(t)});var LL=TC.inspectSource,Gse=w,Wse=p,ML=de,$se=Hl,Hse=LL,UL=function(){},FL=nt("Reflect","construct"),CC=/^\s*(?:class|function)\b/,zse=Gse(CC.exec),Kse=!CC.test(UL),mg=function(t){if(!ML(t))return!1;try{return FL(UL,[],t),!0}catch{return!1}},VL=function(t){if(!ML(t))return!1;switch($se(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Kse||!!zse(CC,Hse(t))}catch{return!0}};VL.sham=!0;var fg,ip,BL,NC,h_=!FL||Wse(function(){var t;return mg(mg.call)||!mg(Object)||!mg(function(){t=!0})||t})?VL:mg,Yse=h_,qse=Xh,Xse=TypeError,GL=ga,Jse=function(t){if(Yse(t))return t;throw new Xse(qse(t)+" is not a constructor")},Qse=Ke,Zse=Zn("species"),RC=function(t,r){var i,s=GL(t).constructor;return s===void 0||Qse(i=GL(s)[Zse])?r:Jse(i)},Kl=w([].slice),eoe=TypeError,mu=function(t,r){if(t<r)throw new eoe("Not enough arguments");return t},WL=/(?:ipad|iphone|ipod).*applewebkit/i.test(Wn),os=A,toe=V,noe=Wl,$L=de,roe=ri,HL=p,zL=Zj,ioe=Kl,KL=$T,aoe=mu,soe=WL,ooe=Y0,AC=os.setImmediate,IC=os.clearImmediate,coe=os.process,OC=os.Dispatch,loe=os.Function,YL=os.MessageChannel,doe=os.String,PC=0,gg={},qL="onreadystatechange";HL(function(){fg=os.location});var DC=function(t){if(roe(gg,t)){var r=gg[t];delete gg[t],r()}},kC=function(t){return function(){DC(t)}},XL=function(t){DC(t.data)},JL=function(t){os.postMessage(doe(t),fg.protocol+"//"+fg.host)};AC&&IC||(AC=function(t){aoe(arguments.length,1);var r=$L(t)?t:loe(t),i=ioe(arguments,1);return gg[++PC]=function(){toe(r,void 0,i)},ip(PC),PC},IC=function(t){delete gg[t]},ooe?ip=function(t){coe.nextTick(kC(t))}:OC&&OC.now?ip=function(t){OC.now(kC(t))}:YL&&!soe?(NC=(BL=new YL).port2,BL.port1.onmessage=XL,ip=noe(NC.postMessage,NC)):os.addEventListener&&$L(os.postMessage)&&!os.importScripts&&fg&&fg.protocol!=="file:"&&!HL(JL)?(ip=JL,os.addEventListener("message",XL,!1)):ip=qL in KL("script")?function(t){zL.appendChild(KL("script"))[qL]=function(){zL.removeChild(this),DC(t)}}:function(t){setTimeout(kC(t),0)});var p_={set:AC,clear:IC},QL=A,uoe=me,hoe=Object.getOwnPropertyDescriptor,ZL=function(t){if(!uoe)return QL[t];var r=hoe(QL,t);return r&&r.value},eM=function(){this.head=null,this.tail=null};eM.prototype={add:function(t){var r={item:t,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var ap,jC,LC,MC,tM,nM=eM,poe=/ipad|iphone|ipod/i.test(Wn)&&typeof Pebble<"u",moe=/web0s(?!.*chrome)/i.test(Wn),sp=A,foe=ZL,rM=Wl,UC=p_.set,goe=nM,voe=WL,yoe=poe,_oe=moe,FC=Y0,iM=sp.MutationObserver||sp.WebKitMutationObserver,aM=sp.document,sM=sp.process,m_=sp.Promise,VC=foe("queueMicrotask");if(!VC){var f_=new goe,g_=function(){var t,r;for(FC&&(t=sM.domain)&&t.exit();r=f_.get();)try{r()}catch(i){throw f_.head&&ap(),i}t&&t.enter()};voe||FC||_oe||!iM||!aM?!yoe&&m_&&m_.resolve?((MC=m_.resolve(void 0)).constructor=m_,tM=rM(MC.then,MC),ap=function(){tM(g_)}):FC?ap=function(){sM.nextTick(g_)}:(UC=rM(UC,sp),ap=function(){UC(g_)}):(jC=!0,LC=aM.createTextNode(""),new iM(g_).observe(LC,{characterData:!0}),ap=function(){LC.data=jC=!jC}),VC=function(t){f_.head||ap(),f_.add(t)}}var oM=VC,op=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},fu=A.Promise,boe=A,vg=fu,Eoe=de,xoe=Dj,Soe=LL,woe=Zn,cM=nC,BC=gr,lM=vg&&vg.prototype,Toe=woe("species"),dM=Eoe(boe.PromiseRejectionEvent),Coe=xoe("Promise",function(){var t=Soe(vg),r=t!==String(vg);if(!r&&BC===66||!lM.catch||!lM.finally)return!0;if(!BC||BC<51||!/native code/.test(t)){var i=new vg(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[Toe]=s,!(i.then(function(){})instanceof s))return!0}return!(r||cM!=="BROWSER"&&cM!=="DENO"||dM)}),yg={CONSTRUCTOR:Coe,REJECTION_EVENT:dM},uc={},uM=ja,Noe=TypeError,Roe=function(t){var r,i;this.promise=new t(function(s,c){if(r!==void 0||i!==void 0)throw new Noe("Bad Promise constructor");r=s,i=c}),this.resolve=uM(r),this.reject=uM(i)};uc.f=function(t){return new Roe(t)};var GC,hM,pM,Aoe=Zt,v_=Y0,Yl=A,Ioe=zt,_g=be,Ooe=zl,Poe=Jc,Doe=function(t){var r=jse(t);Mse&&r&&!r[jL]&&Lse(r,jL,{configurable:!0,get:function(){return this}})},koe=ja,WC=de,joe=et,Loe=wC,Moe=RC,mM=p_.set,$C=oM,Uoe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Foe=op,Voe=nM,fM=pu,HC=fu,gM=yg,vM=uc,y_="Promise",yM=gM.CONSTRUCTOR,Boe=gM.REJECTION_EVENT,zC=fM.getterFor(y_),Goe=fM.set,Woe=HC&&HC.prototype,bg=HC,KC=Woe,_M=Yl.TypeError,YC=Yl.document,qC=Yl.process,XC=vM.f,$oe=XC,Hoe=!!(YC&&YC.createEvent&&Yl.dispatchEvent),bM="unhandledrejection",EM=function(t){var r;return!(!joe(t)||!WC(r=t.then))&&r},xM=function(t,r){var i,s,c,u=r.value,h=r.state===1,m=h?t.ok:t.fail,g=t.resolve,y=t.reject,_=t.domain;try{m?(h||(r.rejection===2&&Koe(r),r.rejection=1),m===!0?i=u:(_&&_.enter(),i=m(u),_&&(_.exit(),c=!0)),i===t.promise?y(new _M("Promise-chain cycle")):(s=EM(i))?_g(s,i,g,y):g(i)):y(u)}catch(x){_&&!c&&_.exit(),y(x)}},SM=function(t,r){t.notified||(t.notified=!0,$C(function(){for(var i,s=t.reactions;i=s.get();)xM(i,t);t.notified=!1,r&&!t.rejection&&zoe(t)}))},wM=function(t,r,i){var s,c;Hoe?((s=YC.createEvent("Event")).promise=r,s.reason=i,s.initEvent(t,!1,!0),Yl.dispatchEvent(s)):s={promise:r,reason:i},!Boe&&(c=Yl["on"+t])?c(s):t===bM&&Uoe("Unhandled promise rejection",i)},zoe=function(t){_g(mM,Yl,function(){var r,i=t.facade,s=t.value;if(TM(t)&&(r=Foe(function(){v_?qC.emit("unhandledRejection",s,i):wM(bM,i,s)}),t.rejection=v_||TM(t)?2:1,r.error))throw r.value})},TM=function(t){return t.rejection!==1&&!t.parent},Koe=function(t){_g(mM,Yl,function(){var r=t.facade;v_?qC.emit("rejectionHandled",r):wM("rejectionhandled",r,t.value)})},cp=function(t,r,i){return function(s){t(r,s,i)}},lp=function(t,r,i){t.done||(t.done=!0,i&&(t=i),t.value=r,t.state=2,SM(t,!0))},JC=function(t,r,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===r)throw new _M("Promise can't be resolved itself");var s=EM(r);s?$C(function(){var c={done:!1};try{_g(s,r,cp(JC,c,t),cp(lp,c,t))}catch(u){lp(c,u,t)}}):(t.value=r,t.state=1,SM(t,!1))}catch(c){lp({done:!1},c,t)}}};yM&&(KC=(bg=function(t){Loe(this,KC),koe(t),_g(GC,this);var r=zC(this);try{t(cp(JC,r),cp(lp,r))}catch(i){lp(r,i)}}).prototype,(GC=function(t){Goe(this,{type:y_,done:!1,notified:!1,parent:!1,reactions:new Voe,rejection:!1,state:0,value:null})}).prototype=Ooe(KC,"then",function(t,r){var i=zC(this),s=XC(Moe(this,bg));return i.parent=!0,s.ok=!WC(t)||t,s.fail=WC(r)&&r,s.domain=v_?qC.domain:void 0,i.state===0?i.reactions.add(s):$C(function(){xM(s,i)}),s.promise}),hM=function(){var t=new GC,r=zC(t);this.promise=t,this.resolve=cp(JC,r),this.reject=cp(lp,r)},vM.f=XC=function(t){return t===bg||t===pM?new hM(t):$oe(t)}),Aoe({global:!0,wrap:!0,forced:yM},{Promise:bg}),pM=Ioe.Promise,Poe(bg,y_,!1,!0),Doe(y_);var CM=Zn("iterator"),NM=!1;try{var Yoe=0,RM={next:function(){return{done:!!Yoe++}},return:function(){NM=!0}};RM[CM]=function(){return this},Array.from(RM,function(){throw 2})}catch{}var qoe=fu,Xoe=function(t,r){try{if(!r&&!NM)return!1}catch{return!1}var i=!1;try{var s={};s[CM]=function(){return{next:function(){return{done:i=!0}}}},t(s)}catch{}return i},__=yg.CONSTRUCTOR||!Xoe(function(t){qoe.all(t).then(void 0,function(){})}),Joe=be,Qoe=ja,Zoe=uc,ece=op,tce=hg;Zt({target:"Promise",stat:!0,forced:__},{all:function(t){var r=this,i=Zoe.f(r),s=i.resolve,c=i.reject,u=ece(function(){var h=Qoe(r.resolve),m=[],g=0,y=1;tce(t,function(_){var x=g++,S=!1;y++,Joe(h,r,_).then(function(C){S||(S=!0,m[x]=C,--y||s(m))},c)}),--y||s(m)});return u.error&&c(u.value),i.promise}});var nce=Zt,rce=yg.CONSTRUCTOR;fu&&fu.prototype,nce({target:"Promise",proto:!0,forced:rce,real:!0},{catch:function(t){return this.then(void 0,t)}});var ice=be,ace=ja,sce=uc,oce=op,cce=hg;Zt({target:"Promise",stat:!0,forced:__},{race:function(t){var r=this,i=sce.f(r),s=i.reject,c=oce(function(){var u=ace(r.resolve);cce(t,function(h){ice(u,r,h).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var lce=uc;Zt({target:"Promise",stat:!0,forced:yg.CONSTRUCTOR},{reject:function(t){var r=lce.f(this);return(0,r.reject)(t),r.promise}});var dce=ga,uce=et,hce=uc,AM=function(t,r){if(dce(t),uce(r)&&r.constructor===t)return r;var i=hce.f(t);return(0,i.resolve)(r),i.promise},pce=Zt,mce=fu,fce=yg.CONSTRUCTOR,gce=AM,vce=nt("Promise"),yce=!fce;pce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return gce(yce&&this===vce?mce:this,t)}});var _ce=be,bce=ja,Ece=uc,xce=op,Sce=hg;Zt({target:"Promise",stat:!0,forced:__},{allSettled:function(t){var r=this,i=Ece.f(r),s=i.resolve,c=i.reject,u=xce(function(){var h=bce(r.resolve),m=[],g=0,y=1;Sce(t,function(_){var x=g++,S=!1;y++,_ce(h,r,_).then(function(C){S||(S=!0,m[x]={status:"fulfilled",value:C},--y||s(m))},function(C){S||(S=!0,m[x]={status:"rejected",reason:C},--y||s(m))})}),--y||s(m)});return u.error&&c(u.value),i.promise}});var wce=be,Tce=ja,Cce=nt,Nce=uc,Rce=op,Ace=hg,IM="No one promise resolved";Zt({target:"Promise",stat:!0,forced:__},{any:function(t){var r=this,i=Cce("AggregateError"),s=Nce.f(r),c=s.resolve,u=s.reject,h=Rce(function(){var m=Tce(r.resolve),g=[],y=0,_=1,x=!1;Ace(t,function(S){var C=y++,M=!1;_++,wce(m,r,S).then(function(D){M||x||(x=!0,c(D))},function(D){M||x||(M=!0,g[C]=D,--_||u(new i(g,IM)))})}),--_||u(new i(g,IM))});return h.error&&u(h.value),s.promise}});var Ice=Zt,Oce=V,Pce=Kl,Dce=uc,kce=ja,OM=op,QC=A.Promise,PM=!1;Ice({target:"Promise",stat:!0,forced:!QC||!QC.try||OM(function(){QC.try(function(t){PM=t===8},8)}).error||!PM},{try:function(t){var r=arguments.length>1?Pce(arguments,1):[],i=Dce.f(this),s=OM(function(){return Oce(kce(t),void 0,r)});return(s.error?i.reject:i.resolve)(s.value),i.promise}});var jce=uc;Zt({target:"Promise",stat:!0},{withResolvers:function(){var t=jce.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Lce=Zt,ZC=fu,Mce=p,Uce=nt,Fce=de,Vce=RC,DM=AM,Bce=ZC&&ZC.prototype;Lce({target:"Promise",proto:!0,real:!0,forced:!!ZC&&Mce(function(){Bce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Vce(this,Uce("Promise")),i=Fce(t);return this.then(i?function(s){return DM(r,t()).then(function(){return s})}:t,i?function(s){return DM(r,t()).then(function(){throw s})}:t)}});var eN=w,Gce=qT,Wce=va,$ce=gt,Hce=eN("".charAt),kM=eN("".charCodeAt),zce=eN("".slice),jM=function(t){return function(r,i){var s,c,u=Wce($ce(r)),h=Gce(i),m=u.length;return h<0||h>=m?t?"":void 0:(s=kM(u,h))<55296||s>56319||h+1===m||(c=kM(u,h+1))<56320||c>57343?t?Hce(u,h):s:t?zce(u,h,h+2):c-56320+(s-55296<<10)+65536}},tN={codeAt:jM(!1),charAt:jM(!0)},Kce=tN.charAt,Yce=va,LM=pu,qce=OL,MM=l_,UM="String Iterator",Xce=LM.set,Jce=LM.getterFor(UM);qce(String,"String",function(t){Xce(this,{type:UM,string:Yce(t),index:0})},function(){var t,r=Jce(this),i=r.string,s=r.index;return s>=i.length?MM(void 0,!0):(t=Kce(i,s),r.index+=t.length,MM(t,!1))});var Qce=zt.Promise,Zce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ele=A,tle=Jc,FM=tp;for(var nN in Zce)tle(ele[nN],nN),FM[nN]=FM.Array;var VM=Qce,ke=d(VM),nle=as("Array","values"),rle=Hl,ile=ri,ale=N,sle=nle,rN=Array.prototype,ole={DOMTokenList:!0,NodeList:!0},cle=function(t){var r=t.values;return t===rN||ale(rN,t)&&r===rN.values||ile(ole,rle(t))?sle:r},ya=d(cle),BM=Xh,lle=TypeError,GM=Kl,dle=Math.floor,iN=function(t,r){var i=t.length;if(i<8)for(var s,c,u=1;u<i;){for(c=u,s=t[u];c&&r(t[c-1],s)>0;)t[c]=t[--c];c!==u++&&(t[c]=s)}else for(var h=dle(i/2),m=iN(GM(t,0,h),r),g=iN(GM(t,h),r),y=m.length,_=g.length,x=0,S=0;x<y||S<_;)t[x+S]=x<y&&S<_?r(m[x],g[S])<=0?m[x++]:g[S++]:x<y?m[x++]:g[S++];return t},WM=iN,$M=Wn.match(/firefox\/(\d+)/i),ule=!!$M&&+$M[1],hle=/MSIE|Trident/.test(Wn),HM=Wn.match(/AppleWebKit\/(\d+)\./),ple=!!HM&&+HM[1],mle=Zt,zM=w,fle=ja,gle=lc,KM=$l,vle=function(t,r){if(!delete t[r])throw new lle("Cannot delete property "+BM(r)+" of "+BM(t))},YM=va,aN=p,yle=WM,_le=z0,qM=ule,ble=hle,XM=gr,JM=ple,ql=[],QM=zM(ql.sort),Ele=zM(ql.push),xle=aN(function(){ql.sort(void 0)}),Sle=aN(function(){ql.sort(null)}),wle=_le("sort"),ZM=!aN(function(){if(XM)return XM<70;if(!(qM&&qM>3)){if(ble)return!0;if(JM)return JM<603;var t,r,i,s,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)ql.push({k:r+s,v:i})}for(ql.sort(function(u,h){return h.v-u.v}),s=0;s<ql.length;s++)r=ql[s].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});mle({target:"Array",proto:!0,forced:xle||!Sle||!wle||!ZM},{sort:function(t){t!==void 0&&fle(t);var r=gle(this);if(ZM)return t===void 0?QM(r):QM(r,t);var i,s,c=[],u=KM(r);for(s=0;s<u;s++)s in r&&Ele(c,r[s]);for(yle(c,function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:YM(m)>YM(g)?1:-1}}(t)),i=KM(c),s=0;s<i;)r[s]=c[s++];for(;s<u;)vle(r,s++);return r}});var Tle=as("Array","sort"),Cle=N,Nle=Tle,sN=Array.prototype,Rle=function(t){var r=t.sort;return t===sN||Cle(sN,t)&&r===sN.sort?Nle:r},gu=d(Rle),Ale=Zt,Ile=w,Ole=XT,Ple=RangeError,eU=String.fromCharCode,tU=String.fromCodePoint,Dle=Ile([].join);Ale({target:"String",stat:!0,forced:!!tU&&tU.length!==1},{fromCodePoint:function(t){for(var r,i=[],s=arguments.length,c=0;s>c;){if(r=+arguments[c++],Ole(r,1114111)!==r)throw new Ple(r+" is not a valid code point");i[c]=r<65536?eU(r):eU(55296+((r-=65536)>>10),r%1024+56320)}return Dle(i,"")}});var kle=p,jle=Zn("iterator"),b_=!kle(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),s="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),s+=u+c}),i.delete("a",2),i.delete("b",void 0),!t.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[jle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Lle=zl,oN=Zt,nU=A,cN=ZL,Mle=nt,E_=be,bo=w,Eg=me,rU=b_,iU=zl,Ule=u_,Fle=function(t,r,i){for(var s in r)i&&i.unsafe&&t[s]?t[s]=r[s]:Lle(t,s,r[s],i);return t},Vle=Jc,Ble=xC,lN=pu,aU=wC,dN=de,Gle=ri,Wle=Wl,$le=Hl,Hle=ga,sU=et,_a=va,zle=ug,oU=lt,cU=pC,Kle=t_,x_=l_,dp=mu,Yle=WM,qle=Zn("iterator"),up="URLSearchParams",lU=up+"Iterator",dU=lN.set,Ps=lN.getterFor(up),Xle=lN.getterFor(lU),uU=cN("fetch"),S_=cN("Request"),xg=cN("Headers"),uN=S_&&S_.prototype,hU=xg&&xg.prototype,Jle=nU.TypeError,Qle=nU.encodeURIComponent,Zle=String.fromCharCode,ede=Mle("String","fromCodePoint"),tde=parseInt,w_=bo("".charAt),pU=bo([].join),Xl=bo([].push),mU=bo("".replace),nde=bo([].shift),fU=bo([].splice),gU=bo("".split),vU=bo("".slice),rde=bo(/./.exec),ide=/\+/g,ade=/^[0-9a-f]+$/i,yU=function(t,r){var i=vU(t,r,r+2);return rde(ade,i)?tde(i,16):NaN},sde=function(t){for(var r=0,i=128;i>0&&t&i;i>>=1)r++;return r},ode=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},_U=function(t){for(var r=(t=mU(t,ide," ")).length,i="",s=0;s<r;){var c=w_(t,s);if(c==="%"){if(w_(t,s+1)==="%"||s+3>r){i+="%",s++;continue}var u=yU(t,s+1);if(u!=u){i+=c,s++;continue}s+=2;var h=sde(u);if(h===0)c=Zle(u);else{if(h===1||h>4){i+="",s++;continue}for(var m=[u],g=1;g<h&&!(++s+3>r||w_(t,s)!=="%");){var y=yU(t,s+1);if(y!=y){s+=3;break}if(y>191||y<128)break;Xl(m,y),s+=2,g++}if(m.length!==h){i+="";continue}var _=ode(m);_===null?i+="":c=ede(_)}}i+=c,s++}return i},cde=/[!'()~]|%20/g,lde={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},dde=function(t){return lde[t]},bU=function(t){return mU(Qle(t),cde,dde)},hN=Ble(function(t,r){dU(this,{type:lU,target:Ps(t).entries,index:0,kind:r})},up,function(){var t=Xle(this),r=t.target,i=t.index++;if(!r||i>=r.length)return t.target=null,x_(void 0,!0);var s=r[i];switch(t.kind){case"keys":return x_(s.key,!1);case"values":return x_(s.value,!1)}return x_([s.key,s.value],!1)},!0),EU=function(t){this.entries=[],this.url=null,t!==void 0&&(sU(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?w_(t,0)==="?"?vU(t,1):t:_a(t)))};EU.prototype={type:up,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,i,s,c,u,h,m,g=this.entries,y=Kle(t);if(y)for(i=(r=cU(t,y)).next;!(s=E_(i,r)).done;){if(u=(c=cU(Hle(s.value))).next,(h=E_(u,c)).done||(m=E_(u,c)).done||!E_(u,c).done)throw new Jle("Expected sequence with length 2");Xl(g,{key:_a(h.value),value:_a(m.value)})}else for(var _ in t)Gle(t,_)&&Xl(g,{key:_,value:_a(t[_])})},parseQuery:function(t){if(t)for(var r,i,s=this.entries,c=gU(t,"&"),u=0;u<c.length;)(r=c[u++]).length&&(i=gU(r,"="),Xl(s,{key:_U(nde(i)),value:_U(pU(i,"="))}))},serialize:function(){for(var t,r=this.entries,i=[],s=0;s<r.length;)t=r[s++],Xl(i,bU(t.key)+"="+bU(t.value));return pU(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var T_=function(){aU(this,hp);var t=dU(this,new EU(arguments.length>0?arguments[0]:void 0));Eg||(this.size=t.entries.length)},hp=T_.prototype;if(Fle(hp,{append:function(t,r){var i=Ps(this);dp(arguments.length,2),Xl(i.entries,{key:_a(t),value:_a(r)}),Eg||this.length++,i.updateURL()},delete:function(t){for(var r=Ps(this),i=dp(arguments.length,1),s=r.entries,c=_a(t),u=i<2?void 0:arguments[1],h=u===void 0?u:_a(u),m=0;m<s.length;){var g=s[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(fU(s,m,1),h!==void 0)break}Eg||(this.size=s.length),r.updateURL()},get:function(t){var r=Ps(this).entries;dp(arguments.length,1);for(var i=_a(t),s=0;s<r.length;s++)if(r[s].key===i)return r[s].value;return null},getAll:function(t){var r=Ps(this).entries;dp(arguments.length,1);for(var i=_a(t),s=[],c=0;c<r.length;c++)r[c].key===i&&Xl(s,r[c].value);return s},has:function(t){for(var r=Ps(this).entries,i=dp(arguments.length,1),s=_a(t),c=i<2?void 0:arguments[1],u=c===void 0?c:_a(c),h=0;h<r.length;){var m=r[h++];if(m.key===s&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var i=Ps(this);dp(arguments.length,1);for(var s,c=i.entries,u=!1,h=_a(t),m=_a(r),g=0;g<c.length;g++)(s=c[g]).key===h&&(u?fU(c,g--,1):(u=!0,s.value=m));u||Xl(c,{key:h,value:m}),Eg||(this.size=c.length),i.updateURL()},sort:function(){var t=Ps(this);Yle(t.entries,function(r,i){return r.key>i.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,i=Ps(this).entries,s=Wle(t,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)s((r=i[c++]).value,r.key,this)},keys:function(){return new hN(this,"keys")},values:function(){return new hN(this,"values")},entries:function(){return new hN(this,"entries")}},{enumerable:!0}),iU(hp,qle,hp.entries,{}),iU(hp,"toString",function(){return Ps(this).serialize()},{enumerable:!0}),Eg&&Ule(hp,"size",{get:function(){return Ps(this).entries.length},configurable:!0,enumerable:!0}),Vle(T_,up),oN({global:!0,forced:!rU},{URLSearchParams:T_}),!rU&&dN(xg)){var ude=bo(hU.has),hde=bo(hU.set),xU=function(t){if(sU(t)){var r,i=t.body;if($le(i)===up)return r=t.headers?new xg(t.headers):new xg,ude(r,"content-type")||hde(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),zle(t,{body:oU(0,_a(i)),headers:oU(0,r)})}return t};if(dN(uU)&&oN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return uU(t,arguments.length>1?xU(arguments[1]):{})}}),dN(S_)){var pN=function(t){return aU(this,uN),new S_(t,arguments.length>1?xU(arguments[1]):{})};uN.constructor=pN,pN.prototype=uN,oN({global:!0,dontCallGetSet:!0,forced:!0},{Request:pN})}}var Ds,pde={URLSearchParams:T_,getState:Ps},mde=zt.URLSearchParams,SU=me,fde=w,gde=be,vde=p,mN=Q0,yde=dg,_de=se,bde=lc,Ede=Ne,pp=Object.assign,wU=Object.defineProperty,xde=fde([].concat),Sde=!pp||vde(function(){if(SU&&pp({b:1},pp(wU({},"a",{enumerable:!0,get:function(){wU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},i=Symbol("assign detection"),s="abcdefghijklmnopqrst";return t[i]=7,s.split("").forEach(function(c){r[c]=c}),pp({},t)[i]!==7||mN(pp({},r)).join("")!==s})?function(t,r){for(var i=bde(t),s=arguments.length,c=1,u=yde.f,h=_de.f;s>c;)for(var m,g=Ede(arguments[c++]),y=u?xde(mN(g),u(g)):mN(g),_=y.length,x=0;_>x;)m=y[x++],SU&&!gde(h,g,m)||(i[m]=g[m]);return i}:pp,wde=ga,Tde=dL,Cde=me,Nde=Os,Rde=lt,fN=function(t,r,i){Cde?Nde.f(t,r,Rde(0,i)):t[r]=i},Ade=Wl,Ide=be,Ode=lc,Pde=function(t,r,i,s){try{return s?r(wde(i)[0],i[1]):r(i)}catch(c){Tde(t,"throw",c)}},Dde=oL,kde=h_,jde=$l,TU=fN,Lde=pC,Mde=t_,CU=Array,vu=w,gN=2147483647,Ude=/[^\0-\u007E]/,NU=/[.\u3002\uFF0E\uFF61]/g,RU="Overflow: input needs wider integers to process",AU=RangeError,Fde=vu(NU.exec),mp=Math.floor,vN=String.fromCharCode,IU=vu("".charCodeAt),OU=vu([].join),Jl=vu([].push),Vde=vu("".replace),Bde=vu("".split),Gde=vu("".toLowerCase),PU=function(t){return t+22+75*(t<26)},Wde=function(t,r,i){var s=0;for(t=i?mp(t/700):t>>1,t+=mp(t/r);t>455;)t=mp(t/35),s+=36;return mp(s+36*t/(t+38))},$de=function(t){var r=[];t=function($){for(var K=[],J=0,ne=$.length;J<ne;){var ae=IU($,J++);if(ae>=55296&&ae<=56319&&J<ne){var Q=IU($,J++);(64512&Q)==56320?Jl(K,((1023&ae)<<10)+(1023&Q)+65536):(Jl(K,ae),J--)}else Jl(K,ae)}return K}(t);var i,s,c=t.length,u=128,h=0,m=72;for(i=0;i<t.length;i++)(s=t[i])<128&&Jl(r,vN(s));var g=r.length,y=g;for(g&&Jl(r,"-");y<c;){var _=gN;for(i=0;i<t.length;i++)(s=t[i])>=u&&s<_&&(_=s);var x=y+1;if(_-u>mp((gN-h)/x))throw new AU(RU);for(h+=(_-u)*x,u=_,i=0;i<t.length;i++){if((s=t[i])<u&&++h>gN)throw new AU(RU);if(s===u){for(var S=h,C=36;;){var M=C<=m?1:C>=m+26?26:C-m;if(S<M)break;var D=S-M,j=36-M;Jl(r,vN(PU(M+D%j))),S=mp(D/j),C+=36}Jl(r,vN(PU(S))),m=Wde(h,x,y===g),h=0,y++}}h++,u++}return OU(r,"")},Hde=Zt,yN=me,zde=b_,_N=A,DU=Wl,ks=w,C_=zl,js=u_,Kde=wC,bN=ri,EN=Sde,fp=function(t){var r=Ode(t),i=kde(this),s=arguments.length,c=s>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Ade(c,s>2?arguments[2]:void 0));var h,m,g,y,_,x,S=Mde(r),C=0;if(!S||this===CU&&Dde(S))for(h=jde(r),m=i?new this(h):CU(h);h>C;C++)x=u?c(r[C],C):r[C],TU(m,C,x);else for(m=i?new this:[],_=(y=Lde(r,S)).next;!(g=Ide(_,y)).done;C++)x=u?Pde(y,c,[g.value,C],!0):g.value,TU(m,C,x);return m.length=C,m},Eo=Kl,Yde=tN.codeAt,qde=function(t){var r,i,s=[],c=Bde(Vde(Gde(t),NU,"."),".");for(r=0;r<c.length;r++)i=c[r],Jl(s,Fde(Ude,i)?"xn--"+$de(i):i);return OU(s,".")},Qc=va,Xde=Jc,Jde=mu,kU=pde,jU=pu,Qde=jU.set,N_=jU.getterFor("URL"),Zde=kU.URLSearchParams,eue=kU.getState,Sg=_N.URL,xN=_N.TypeError,R_=_N.parseInt,tue=Math.floor,LU=Math.pow,Ls=ks("".charAt),xo=ks(/./.exec),wg=ks([].join),nue=ks(1.1.toString),rue=ks([].pop),gp=ks([].push),SN=ks("".replace),iue=ks([].shift),aue=ks("".split),Tg=ks("".slice),A_=ks("".toLowerCase),sue=ks([].unshift),wN="Invalid scheme",yu="Invalid host",MU="Invalid port",UU=/[a-z]/i,oue=/[\d+-.a-z]/i,TN=/\d/,cue=/^0x/i,lue=/^[0-7]+$/,due=/^\d+$/,FU=/^[\da-f]+$/i,uue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hue=/[\0\t\n\r #/:<>?@[\\\]^|]/,pue=/^[\u0000-\u0020]+/,mue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,fue=/[\t\n\r]/g,Cg=function(t){var r,i,s,c;if(typeof t=="number"){for(r=[],i=0;i<4;i++)sue(r,t%256),t=tue(t/256);return wg(r,".")}if(typeof t=="object"){for(r="",s=function(u){for(var h=null,m=1,g=null,y=0,_=0;_<8;_++)u[_]!==0?(y>m&&(h=g,m=y),g=null,y=0):(g===null&&(g=_),++y);return y>m?g:h}(t),i=0;i<8;i++)c&&t[i]===0||(c&&(c=!1),s===i?(r+=i?":":"::",c=!0):(r+=nue(t[i],16),i<7&&(r+=":")));return"["+r+"]"}return t},I_={},VU=EN({},I_,{" ":1,'"':1,"<":1,">":1,"`":1}),BU=EN({},VU,{"#":1,"?":1,"{":1,"}":1}),CN=EN({},BU,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ql=function(t,r){var i=Yde(t,0);return i>32&&i<127&&!bN(r,t)?t:encodeURIComponent(t)},O_={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ng=function(t,r){var i;return t.length===2&&xo(UU,Ls(t,0))&&((i=Ls(t,1))===":"||!r&&i==="|")},GU=function(t){var r;return t.length>1&&Ng(Tg(t,0,2))&&(t.length===2||(r=Ls(t,2))==="/"||r==="\\"||r==="?"||r==="#")},gue=function(t){return t==="."||A_(t)==="%2e"},NN={},WU={},RN={},$U={},HU={},AN={},zU={},KU={},P_={},D_={},IN={},ON={},PN={},DN={},YU={},kN={},vp={},hc={},qU={},_u={},Zc={},jN=function(t,r,i){var s,c,u,h=Qc(t);if(r){if(c=this.parse(h))throw new xN(c);this.searchParams=null}else{if(i!==void 0&&(s=new jN(i,!0)),c=this.parse(h,null,s))throw new xN(c);(u=eue(new Zde)).bindURL(this),this.searchParams=u}};jN.prototype={type:"URL",parse:function(t,r,i){var s,c,u,h,m,g=this,y=r||NN,_=0,x="",S=!1,C=!1,M=!1;for(t=Qc(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=SN(t,pue,""),t=SN(t,mue,"$1")),t=SN(t,fue,""),s=fp(t);_<=s.length;){switch(c=s[_],y){case NN:if(!c||!xo(UU,c)){if(r)return wN;y=RN;continue}x+=A_(c),y=WU;break;case WU:if(c&&(xo(oue,c)||c==="+"||c==="-"||c==="."))x+=A_(c);else{if(c!==":"){if(r)return wN;x="",y=RN,_=0;continue}if(r&&(g.isSpecial()!==bN(O_,x)||x==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=x,r)return void(g.isSpecial()&&O_[g.scheme]===g.port&&(g.port=null));x="",g.scheme==="file"?y=DN:g.isSpecial()&&i&&i.scheme===g.scheme?y=$U:g.isSpecial()?y=KU:s[_+1]==="/"?(y=HU,_++):(g.cannotBeABaseURL=!0,gp(g.path,""),y=qU)}break;case RN:if(!i||i.cannotBeABaseURL&&c!=="#")return wN;if(i.cannotBeABaseURL&&c==="#"){g.scheme=i.scheme,g.path=Eo(i.path),g.query=i.query,g.fragment="",g.cannotBeABaseURL=!0,y=Zc;break}y=i.scheme==="file"?DN:AN;continue;case $U:if(c!=="/"||s[_+1]!=="/"){y=AN;continue}y=P_,_++;break;case HU:if(c==="/"){y=D_;break}y=hc;continue;case AN:if(g.scheme=i.scheme,c===Ds)g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query=i.query;else if(c==="/"||c==="\\"&&g.isSpecial())y=zU;else if(c==="?")g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query="",y=_u;else{if(c!=="#"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.path.length--,y=hc;continue}g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,g.path=Eo(i.path),g.query=i.query,g.fragment="",y=Zc}break;case zU:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=i.username,g.password=i.password,g.host=i.host,g.port=i.port,y=hc;continue}y=D_}else y=P_;break;case KU:if(y=P_,c!=="/"||Ls(x,_+1)!=="/")continue;_++;break;case P_:if(c!=="/"&&c!=="\\"){y=D_;continue}break;case D_:if(c==="@"){S&&(x="%40"+x),S=!0,u=fp(x);for(var D=0;D<u.length;D++){var j=u[D];if(j!==":"||M){var $=Ql(j,CN);M?g.password+=$:g.username+=$}else M=!0}x=""}else if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(S&&x==="")return"Invalid authority";_-=fp(x).length+1,x="",y=IN}else x+=c;break;case IN:case ON:if(r&&g.scheme==="file"){y=kN;continue}if(c!==":"||C){if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&x==="")return yu;if(r&&x===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(x))return h;if(x="",y=vp,r)return;continue}c==="["?C=!0:c==="]"&&(C=!1),x+=c}else{if(x==="")return yu;if(h=g.parseHost(x))return h;if(x="",y=PN,r===ON)return}break;case PN:if(!xo(TN,c)){if(c===Ds||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(x!==""){var K=R_(x,10);if(K>65535)return MU;g.port=g.isSpecial()&&K===O_[g.scheme]?null:K,x=""}if(r)return;y=vp;continue}return MU}x+=c;break;case DN:if(g.scheme="file",c==="/"||c==="\\")y=YU;else{if(!i||i.scheme!=="file"){y=hc;continue}switch(c){case Ds:g.host=i.host,g.path=Eo(i.path),g.query=i.query;break;case"?":g.host=i.host,g.path=Eo(i.path),g.query="",y=_u;break;case"#":g.host=i.host,g.path=Eo(i.path),g.query=i.query,g.fragment="",y=Zc;break;default:GU(wg(Eo(s,_),""))||(g.host=i.host,g.path=Eo(i.path),g.shortenPath()),y=hc;continue}}break;case YU:if(c==="/"||c==="\\"){y=kN;break}i&&i.scheme==="file"&&!GU(wg(Eo(s,_),""))&&(Ng(i.path[0],!0)?gp(g.path,i.path[0]):g.host=i.host),y=hc;continue;case kN:if(c===Ds||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Ng(x))y=hc;else if(x===""){if(g.host="",r)return;y=vp}else{if(h=g.parseHost(x))return h;if(g.host==="localhost"&&(g.host=""),r)return;x="",y=vp}continue}x+=c;break;case vp:if(g.isSpecial()){if(y=hc,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Ds&&(y=hc,c!=="/"))continue}else g.fragment="",y=Zc;else g.query="",y=_u;break;case hc:if(c===Ds||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=A_(m=x))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||gp(g.path,"")):gue(x)?c==="/"||c==="\\"&&g.isSpecial()||gp(g.path,""):(g.scheme==="file"&&!g.path.length&&Ng(x)&&(g.host&&(g.host=""),x=Ls(x,0)+":"),gp(g.path,x)),x="",g.scheme==="file"&&(c===Ds||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)iue(g.path);c==="?"?(g.query="",y=_u):c==="#"&&(g.fragment="",y=Zc)}else x+=Ql(c,BU);break;case qU:c==="?"?(g.query="",y=_u):c==="#"?(g.fragment="",y=Zc):c!==Ds&&(g.path[0]+=Ql(c,I_));break;case _u:r||c!=="#"?c!==Ds&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Ql(c,I_)):(g.fragment="",y=Zc);break;case Zc:c!==Ds&&(g.fragment+=Ql(c,VU))}_++}},parseHost:function(t){var r,i,s;if(Ls(t,0)==="["){if(Ls(t,t.length-1)!=="]"||(r=function(c){var u,h,m,g,y,_,x,S=[0,0,0,0,0,0,0,0],C=0,M=null,D=0,j=function(){return Ls(c,D)};if(j()===":"){if(Ls(c,1)!==":")return;D+=2,M=++C}for(;j();){if(C===8)return;if(j()!==":"){for(u=h=0;h<4&&xo(FU,j());)u=16*u+R_(j(),16),D++,h++;if(j()==="."){if(h===0||(D-=h,C>6))return;for(m=0;j();){if(g=null,m>0){if(!(j()==="."&&m<4))return;D++}if(!xo(TN,j()))return;for(;xo(TN,j());){if(y=R_(j(),10),g===null)g=y;else{if(g===0)return;g=10*g+y}if(g>255)return;D++}S[C]=256*S[C]+g,++m!=2&&m!==4||C++}if(m!==4)return;break}if(j()===":"){if(D++,!j())return}else if(j())return;S[C++]=u}else{if(M!==null)return;D++,M=++C}}if(M!==null)for(_=C-M,C=7;C!==0&&_>0;)x=S[C],S[C--]=S[M+_-1],S[M+--_]=x;else if(C!==8)return;return S}(Tg(t,1,-1)),!r))return yu;this.host=r}else if(this.isSpecial()){if(t=qde(t),xo(uue,t)||(r=function(c){var u,h,m,g,y,_,x,S=aue(c,".");if(S.length&&S[S.length-1]===""&&S.length--,(u=S.length)>4)return c;for(h=[],m=0;m<u;m++){if((g=S[m])==="")return c;if(y=10,g.length>1&&Ls(g,0)==="0"&&(y=xo(cue,g)?16:8,g=Tg(g,y===8?1:2)),g==="")_=0;else{if(!xo(y===10?due:y===8?lue:FU,g))return c;_=R_(g,y)}gp(h,_)}for(m=0;m<u;m++)if(_=h[m],m===u-1){if(_>=LU(256,5-u))return null}else if(_>255)return null;for(x=rue(h),m=0;m<h.length;m++)x+=h[m]*LU(256,3-m);return x}(t),r===null))return yu;this.host=r}else{if(xo(hue,t))return yu;for(r="",i=fp(t),s=0;s<i.length;s++)r+=Ql(i[s],I_);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return bN(O_,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&Ng(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,i=t.username,s=t.password,c=t.host,u=t.port,h=t.path,m=t.query,g=t.fragment,y=r+":";return c!==null?(y+="//",t.includesCredentials()&&(y+=i+(s?":"+s:"")+"@"),y+=Cg(c),u!==null&&(y+=":"+u)):r==="file"&&(y+="//"),y+=t.cannotBeABaseURL?h[0]:h.length?"/"+wg(h,"/"):"",m!==null&&(y+="?"+m),g!==null&&(y+="#"+g),y},setHref:function(t){var r=this.parse(t);if(r)throw new xN(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new yp(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Cg(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Qc(t)+":",NN)},getUsername:function(){return this.username},setUsername:function(t){var r=fp(Qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=Ql(r[i],CN)}},getPassword:function(){return this.password},setPassword:function(t){var r=fp(Qc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=Ql(r[i],CN)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Cg(t):Cg(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,IN)},getHostname:function(){var t=this.host;return t===null?"":Cg(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ON)},getPort:function(){var t=this.port;return t===null?"":Qc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Qc(t))===""?this.port=null:this.parse(t,PN))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+wg(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,vp))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Qc(t))===""?this.query=null:(Ls(t,0)==="?"&&(t=Tg(t,1)),this.query="",this.parse(t,_u)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Qc(t))!==""?(Ls(t,0)==="#"&&(t=Tg(t,1)),this.fragment="",this.parse(t,Zc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var yp=function(t){var r=Kde(this,ba),i=Jde(arguments.length,1)>1?arguments[1]:void 0,s=Qde(r,new jN(t,!1,i));yN||(r.href=s.serialize(),r.origin=s.getOrigin(),r.protocol=s.getProtocol(),r.username=s.getUsername(),r.password=s.getPassword(),r.host=s.getHost(),r.hostname=s.getHostname(),r.port=s.getPort(),r.pathname=s.getPathname(),r.search=s.getSearch(),r.searchParams=s.getSearchParams(),r.hash=s.getHash())},ba=yp.prototype,Ms=function(t,r){return{get:function(){return N_(this)[t]()},set:r&&function(i){return N_(this)[r](i)},configurable:!0,enumerable:!0}};if(yN&&(js(ba,"href",Ms("serialize","setHref")),js(ba,"origin",Ms("getOrigin")),js(ba,"protocol",Ms("getProtocol","setProtocol")),js(ba,"username",Ms("getUsername","setUsername")),js(ba,"password",Ms("getPassword","setPassword")),js(ba,"host",Ms("getHost","setHost")),js(ba,"hostname",Ms("getHostname","setHostname")),js(ba,"port",Ms("getPort","setPort")),js(ba,"pathname",Ms("getPathname","setPathname")),js(ba,"search",Ms("getSearch","setSearch")),js(ba,"searchParams",Ms("getSearchParams")),js(ba,"hash",Ms("getHash","setHash"))),C_(ba,"toJSON",function(){return N_(this).serialize()},{enumerable:!0}),C_(ba,"toString",function(){return N_(this).serialize()},{enumerable:!0}),Sg){var XU=Sg.createObjectURL,JU=Sg.revokeObjectURL;XU&&C_(yp,"createObjectURL",DU(XU,Sg)),JU&&C_(yp,"revokeObjectURL",DU(JU,Sg))}Xde(yp,"URL"),Hde({global:!0,forced:!zde,sham:!yN},{URL:yp});var vue=Zt,QU=p,yue=mu,ZU=va,_ue=b_,LN=nt("URL"),bue=_ue&&QU(function(){LN.canParse()}),Eue=QU(function(){return LN.canParse.length!==1});vue({target:"URL",stat:!0,forced:!bue||Eue},{canParse:function(t){var r=yue(arguments.length,1),i=ZU(t),s=r<2||arguments[1]===void 0?void 0:ZU(arguments[1]);try{return!!new LN(i,s)}catch{return!1}}});var xue=Zt,Sue=mu,e5=va,wue=b_,Tue=nt("URL");xue({target:"URL",stat:!0,forced:!wue},{parse:function(t){var r=Sue(arguments.length,1),i=e5(t),s=r<2||arguments[1]===void 0?void 0:e5(arguments[1]);try{return new Tue(i,s)}catch{return null}}});var k_=d(zt.URL);let t5=!0,n5=!0;function j_(t,r,i){const s=t.match(r);return s&&s.length>=i&&parseInt(s[i],10)}function bu(t,r,i){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=y=>{const _=i(y);_&&(m.handleEvent?m.handleEvent(_):m(_))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const u=s.removeEventListener;s.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,g])},Object.defineProperty(s,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Cue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(t5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Nue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(n5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function r5(){if(typeof window=="object"){if(t5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function MN(t,r){n5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function i5(t){return Object.prototype.toString.call(t)==="[object Object]"}function a5(t){var r;return i5(t)?ss(r=Object.keys(t)).call(r,function(i,s){const c=i5(t[s]),u=c?a5(t[s]):t[s],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[s]:u})},{}):t}function UN(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?UN(t,t.get(r[s]),i):s.endsWith("Ids")&&r[s].forEach(c=>{UN(t,t.get(c),i)})}))}function s5(t,r,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===s&&m.trackId===h.id&&UN(t,m,c)})}),c}const o5=r5;function c5(t,r){const i=t&&t.navigator;if(!i.mediaDevices)return;const s=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const y=typeof h[g]=="object"?h[g]:{ideal:h[g]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const _=function(x,S){return x?x+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(y.ideal!==void 0){m.optional=m.optional||[];let x={};typeof y.ideal=="number"?(x[_("min",g)]=y.ideal,m.optional.push(x),x={},x[_("max",g)]=y.ideal,m.optional.push(x)):(x[_("",g)]=y.ideal,m.optional.push(x))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[_("",g)]=y.exact):["min","max"].forEach(x=>{y[x]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[_(x,g)]=y[x])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(y,_,x){_ in y&&!(x in y)&&(y[x]=y[_],delete y[_])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const y=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let _;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?_=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(_=["front"]),_)return i.mediaDevices.enumerateDevices().then(x=>{x=x.filter(C=>C.kind==="videoinput");let S=x.find(C=>_.some(M=>{var D;return Re(D=C.label.toLowerCase()).call(D,M)}));return!S&&x.length&&Re(_).call(_,"back")&&(S=x[x.length-1]),S&&(h.video.deviceId=g.exact?{exact:S.deviceId}:{ideal:S.deviceId}),h.video=s(h.video),o5("chrome: "+JSON.stringify(h)),m(h)})}h.video=s(h.video)}return o5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,g){c(h,y=>{i.webkitGetUserMedia(y,m,_=>{g&&g(u(_))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,g=>h(g).then(y=>{if(g.audio&&!y.getAudioTracks().length||g.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return y},y=>ke.reject(u(y))))}}}function l5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function d5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const u=new Event("track");u.track=s.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(s=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const u=new Event("track");u.track=s,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else bu(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function u5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function h5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const g={};return m.result().forEach(y=>{const _={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(x=>{_[x]=y.stat(x)}),g[_.id]=_}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){s(h(u(g)))};return r.apply(this,[m,i])}return new ke((m,g)=>{r.apply(this,[function(y){m(h(u(y)))},g])}).then(s,c)}}function p5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const i=t.RTCPeerConnection.prototype.getSenders;i&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>s5(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),bu(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>s5(c,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let s,c,u;return this.getSenders().forEach(h=>{h.track===i&&(s?u=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||s&&c?ke.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():ke.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function m5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(_=>_.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function f5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return m5(t);const i=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(x=>x.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const y=new t.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}s.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function u(g,y){let _=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(x=>{const S=g._reverseStreams[x],C=g._streams[S.id];_=_.replace(new RegExp(C.id,"g"),S.id)}),new RTCSessionDescription({type:y.type,sdp:_})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[y.id];if(S)S.addTrack(g),ke.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new t.MediaStream([g]);this._streams[y.id]=C,this._reverseStreams[C.id]=y,this.addStream(C)}return this.getSenders().find(C=>C.track===g)},["createOffer","createAnswer"].forEach(function(g){const y=t.RTCPeerConnection.prototype[g],_={[g](){const x=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[S=>{const C=u(this,S);x[0].apply(null,[C])},S=>{x[1]&&x[1].apply(null,S)},arguments[2]]):y.apply(this,arguments).then(S=>u(this,S))}};t.RTCPeerConnection.prototype[g]=_[g]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,y){let _=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(x=>{const S=g._reverseStreams[x],C=g._streams[S.id];_=_.replace(new RegExp(S.id,"g"),C.id)}),new RTCSessionDescription({type:y.type,sdp:_})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:u(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(x=>g.track===x)&&(y=this._streams[_])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function FN(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]})}function g5(t,r){bu(t,"negotiationneeded",i=>{const s=i.target;if(!(r.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return i})}var v5=Object.freeze({__proto__:null,fixNegotiationNeeded:g5,shimAddTrackRemoveTrack:f5,shimAddTrackRemoveTrackWithNative:m5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(s=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:u5,shimGetStats:h5,shimGetUserMedia:c5,shimMediaStream:l5,shimOnTrack:d5,shimPeerConnection:FN,shimSenderReceiverGetStats:p5});function y5(t,r){const i=t&&t.navigator,s=t&&t.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){MN("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function _5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function VN(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return s.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(g=>{g.type=i[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((y,_)=>{m.set(_,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function b5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ke.resolve(new Map)}}function E5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),bu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function x5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){MN("removeStream","removeTrack"),this.getSenders().forEach(i=>{var s;i.track&&Re(s=r.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function S5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function w5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(s){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function T5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function C5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ke.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function N5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ke.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var R5=Object.freeze({__proto__:null,shimAddTransceiver:w5,shimCreateAnswer:N5,shimCreateOffer:C5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,ke.reject(s)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:T5,shimGetUserMedia:y5,shimOnTrack:_5,shimPeerConnection:VN,shimRTCDataChannel:S5,shimReceiverGetStats:E5,shimRemoveStream:x5,shimSenderGetStats:b5});function A5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){var s;this._localStreams||(this._localStreams=[]),Re(s=this._localStreams).call(s,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?Re(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const s=r.getTracks();this.getSenders().forEach(c=>{Re(s).call(s,c.track)&&this.removeTrack(c)})})}}function I5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),Re(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function O5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.createOffer,s=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,y){const _=arguments.length>=2?arguments[2]:arguments[0],x=i.apply(this,[_]);return y?(x.then(g,y),ke.resolve()):x},r.createAnswer=function(g,y){const _=arguments.length>=2?arguments[2]:arguments[0],x=s.apply(this,[_]);return y?(x.then(g,y),ke.resolve()):x};let m=function(g,y,_){const x=c.apply(this,[g]);return _?(x.then(y,_),ke.resolve()):x};r.setLocalDescription=m,m=function(g,y,_){const x=u.apply(this,[g]);return _?(x.then(y,_),ke.resolve()):x},r.setRemoteDescription=m,m=function(g,y,_){const x=h.apply(this,[g]);return _?(x.then(y,_),ke.resolve()):x},r.addIceCandidate=m}function P5(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,s=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>s(D5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,s,c){r.mediaDevices.getUserMedia(i).then(s,c)}).bind(r))}function D5(t){return t&&t.video!==void 0?Object.assign({},t,{video:a5(t.video)}):t}function k5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(MN("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,s)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function j5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function L5(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function M5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var U5=Object.freeze({__proto__:null,shimAudioContext:M5,shimCallbacksAPI:O5,shimConstraints:D5,shimCreateOfferLegacy:L5,shimGetUserMedia:P5,shimLocalStreamsAPI:A5,shimRTCIceServerUrls:k5,shimRemoteStreamsAPI:I5,shimTrackEventTransceiver:j5}),F5=`	
\v\f\r \u2028\u2029\uFEFF`,Rue=gt,Aue=va,BN=F5,V5=w("".replace),Iue=RegExp("^["+BN+"]+"),Oue=RegExp("(^|[^"+BN+"])["+BN+"]+$"),Pue=function(t){return function(r){var i=Aue(Rue(r));return 1&t&&(i=V5(i,Iue,"")),2&t&&(i=V5(i,Oue,"$1")),i}},Due={trim:Pue(3)},kue=xL.PROPER,jue=p,B5=F5,Lue=Due.trim;Zt({target:"String",proto:!0,forced:function(t){return jue(function(){return!!B5[t]()||""[t]()!==""||kue&&B5[t].name!==t})}("trim")},{trim:function(){return Lue(this)}});var Mue=as("String","trim"),Uue=N,Fue=Mue,GN=String.prototype,Vue=function(t){var r=t.trim;return typeof t=="string"||t===GN||Uue(GN,t)&&r===GN.trim?Fue:r},Si=d(Vue),G5={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(s=>s.trim())},r.splitSections=function(i){return i.split(`
m=`).map((s,c)=>(c>0?"m="+s:s).trim()+`\r
`)},r.getDescription=function(i){const s=r.splitSections(i);return s&&s[0]},r.getMediaSections=function(i){const s=r.splitSections(i);return s.shift(),s},r.matchPrefix=function(i,s){return r.splitLines(i).filter(c=>c.indexOf(s)===0)},r.parseCandidate=function(i){let s;s=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":c.relatedAddress=s[u+1];break;case"rport":c.relatedPort=parseInt(s[u+1],10);break;case"tcptype":c.tcpType=s[u+1];break;case"ufrag":c.ufrag=s[u+1],c.usernameFragment=s[u+1];break;default:c[s[u]]===void 0&&(c[s[u]]=s[u+1])}return c},r.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const u=i.type;return s.push("typ"),s.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let s=i.payloadType;i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const s={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),s[c[0].trim()]=c[1];return s},r.writeFmtp=function(i){let s="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),s+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return s},r.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(i){let s="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},r.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},u=i.indexOf(":",s);return u>-1?(c.attribute=i.substring(s+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(s+1),c},r.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},r.getMid=function(i){const s=r.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},r.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},r.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:r.matchPrefix(i+s,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,s){let c="a=setup:"+s+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,s){return r.matchPrefix(i+s,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,s){const c=r.matchPrefix(i+s,"a=ice-ufrag:")[0],u=r.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(s+=`a=ice-lite\r
`),s},r.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(g){const y=r.parseRtpMap(g),_=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=_.length?r.parseFmtp(_[0]):{},y.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),s.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(y.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{s.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return s.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),s},r.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return s.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const s=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(S=>r.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),g=m.length>0&&m[0].ssrc;let y;const _=r.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(C=>parseInt(C,10)));_.length>0&&_[0].length>1&&_[0][0]===g&&(y=_[0][1]),c.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let C={ssrc:g,codecPayloadType:parseInt(S.parameters.apt,10)};g&&y&&(C.rtx={ssrc:y}),s.push(C),u&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},s.push(C))}}),s.length===0&&g&&s.push({ssrc:g});let x=r.matchPrefix(i,"b=");return x.length&&(x=x[0].indexOf("b=TIAS:")===0?parseInt(x[0].substring(7),10):x[0].indexOf("b=AS:")===0?1e3*parseInt(x[0].substring(5),10)*.95-16e3:void 0,s.forEach(S=>{S.maxBitrate=x})),s},r.parseRtcpParameters=function(i){const s={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},r.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+=`a=rtcp-rsize\r
`),i.mux&&(s+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),s},r.parseMsid=function(i){let s;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},r.parseSctpDescription=function(i){const s=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,s){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,s,c){let u;const h=s!==void 0?s:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,s){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return s?r.getDirection(s):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const s=r.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},r.parseOLine=function(i){const s=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const s=r.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(G5);var W5=G5.exports,_p=d(W5),Bue=a({__proto__:null,default:_p},[W5]);function L_(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new r(i),c=_p.parseCandidate(i.candidate),u=Object.assign(s,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},t.RTCIceCandidate.prototype=r.prototype,bu(t,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new t.RTCIceCandidate(i.candidate),writable:"false"}),i))}function WN(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||bu(t,"icecandidate",r=>{if(r.candidate){const i=_p.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function M_(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const g=_p.splitSections(m.sdp);return g.shift(),g.some(y=>{const _=_p.parseMLine(y);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},s=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const y=parseInt(g[1],10);return y!=y?-1:y},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},u=function(m,g){let y=65536;r.browser==="firefox"&&r.version===57&&(y=65535);const _=_p.matchPrefix(m.sdp,"a=max-message-size:");return _.length>0?y=parseInt(_[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(y=2147483637),y},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=s(arguments[0]),g=c(m),y=u(arguments[0],m);let _;_=g===0&&y===0?Number.POSITIVE_INFINITY:g===0||y===0?Math.max(g,y):Math.min(g,y);const x={};Object.defineProperty(x,"maxMessageSize",{get:()=>_}),this._sctp=x}return h.apply(this,arguments)}}function U_(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(s,c){const u=s.send;s.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}const i=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return r(s,this),s},bu(t,"datachannel",s=>(r(s.channel,s.target),s))}function $N(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function HN(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter(u=>Si(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function F_(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ke.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ke.resolve())})}function V_(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const i=t.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?i.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Gue=Object.freeze({__proto__:null,removeExtmapAllowMixed:HN,shimAddIceCandidateNullOrEmpty:F_,shimConnectionState:$N,shimMaxMessageSize:M_,shimParameterlessSetLocalDescription:V_,shimRTCIceCandidate:L_,shimRTCIceCandidateRelayProtocol:WN,shimSendThrowTypeError:U_});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=r5,s=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=j_(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=j_(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=j_(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:s,commonShim:Gue,extractVersion:j_,disableLog:Cue,disableWarnings:Nue,sdp:Bue};switch(s.browser){case"chrome":if(!v5||!FN||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(s.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=v5,F_(t,s),V_(t),c5(t,s),l5(t),FN(t,s),d5(t),f5(t,s),u5(t),h5(t),p5(t),g5(t,s),L_(t),WN(t),$N(t),M_(t,s),U_(t),HN(t,s);break;case"firefox":if(!R5||!VN||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=R5,F_(t,s),V_(t),y5(t,s),VN(t,s),_5(t),x5(t),b5(t),E5(t),S5(t),w5(t),T5(t),C5(t),N5(t),L_(t),$N(t),M_(t,s),U_(t);break;case"safari":if(!U5||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=U5,F_(t,s),V_(t),k5(t),L5(t),O5(t),A5(t),I5(t),j5(t),P5(t),M5(t),L_(t),WN(t),M_(t,s),U_(t),HN(t,s);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Wue=p,$5=A.RegExp,$ue=!Wue(function(){var t=!0;try{$5(".","d")}catch{t=!1}var r={},i="",s=t?"dgimsy":"gimsy",c=function(m,g){Object.defineProperty(r,m,{get:function(){return i+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var h in t&&(u.hasIndices="d"),u)c(h,u[h]);return Object.getOwnPropertyDescriptor($5.prototype,"flags").get.call(r)!==s||i!==s}),Hue=ga,zue=be,Kue=ri,Yue=N,H5={correct:$ue},que=function(){var t=Hue(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},Xue=RegExp.prototype,zN=H5.correct?function(t){return t.flags}:function(t){return H5.correct||!Yue(Xue,t)||Kue(t,"flags")?t.flags:zue(que,t)},KN=w,Jue=Math.floor,YN=KN("".charAt),Que=KN("".replace),qN=KN("".slice),Zue=/\$([$&'`]|\d{1,2})/g,ehe=Zt,the=be,XN=w,z5=gt,nhe=de,rhe=et,ihe=QT,bp=va,ahe=ag,she=zN,ohe=function(t,r,i,s,c,u){var h=i+t.length,m=s.length,g=Zue;return Que(u,g,function(y,_){var x;switch(YN(_,0)){case"$":return"$";case"&":return t;case"`":return qN(r,0,i);case"'":return qN(r,h);case"<":x=c[qN(_,1,-1)];break;default:var S=+_;if(S===0)return y;if(S>m){var C=Jue(S/10);return C===0?y:C<=m?s[C-1]===void 0?YN(_,1):s[C-1]+YN(_,1):y}x=s[S-1]}return x===void 0?"":x})},che=Zn("replace"),lhe=TypeError,JN=XN("".indexOf),dhe=XN("".replace),K5=XN("".slice),uhe=Math.max;ehe({target:"String",proto:!0},{replaceAll:function(t,r){var i,s,c,u,h,m,g,y,_,x,S=z5(this),C=0,M="";if(rhe(t)){if((i=ihe(t))&&(s=bp(z5(she(t))),!~JN(s,"g")))throw new lhe("`.replaceAll` does not allow non-global regexes");if(c=ahe(t,che))return the(c,t,S,r);if(i)return dhe(bp(S),t,r)}for(u=bp(S),h=bp(t),(m=nhe(r))||(r=bp(r)),g=h.length,y=uhe(1,g),_=JN(u,h);_!==-1;)x=m?bp(r(h,_,u)):ohe(h,u,_,[],void 0,r),M+=K5(u,C,_)+x,C=_+g,_=_+y>u.length?-1:JN(u,h,_+y);return C<u.length&&(M+=K5(u,C)),M}});var hhe=as("String","replaceAll"),phe=N,mhe=hhe,QN=String.prototype,fhe=function(t){var r=t.replaceAll;return typeof t=="string"||t===QN||phe(QN,t)&&r===QN.replaceAll?mhe:r},ghe=d(fhe),ZN=A;Zt({global:!0,forced:ZN.globalThis!==ZN},{globalThis:ZN});var Y5=d(A),eR={exports:{}};(function(t,r){(function(i,s){var c="function",u="undefined",h="object",m="string",g="major",y="model",_="name",x="type",S="vendor",C="version",M="architecture",D="console",j="mobile",$="tablet",K="smarttv",J="wearable",ne="embedded",ae="Amazon",Q="Apple",oe="ASUS",ge="BlackBerry",Ee="Browser",Fe="Chrome",ht="Firefox",ot="Google",wt="Honor",_t="Huawei",qt="LG",Nn="Microsoft",ve="Motorola",Pe="Nvidia",We="OnePlus",_e="Opera",O="OPPO",X="Samsung",ee="Sharp",Ie="Sony",ft="Xiaomi",vn="Zebra",xr="Facebook",vs="Chromium OS",_d="Mac OS",VE=" Browser",fm=function(nr){for(var dr={},wn=0;wn<nr.length;wn++)dr[nr[wn].toUpperCase()]=nr[wn];return dr},BE=function(nr,dr){return typeof nr===m&&rh(dr).indexOf(rh(nr))!==-1},rh=function(nr){return nr.toLowerCase()},Iv=function(nr,dr){if(typeof nr===m)return nr=nr.replace(/^\s\s*/,""),typeof dr===u?nr:nr.substring(0,500)},ih=function(nr,dr){for(var wn,aa,Go,zn,ul,Gt,Wo=0;Wo<dr.length&&!ul;){var ah=dr[Wo],Oc=dr[Wo+1];for(wn=aa=0;wn<ah.length&&!ul&&ah[wn];)if(ul=ah[wn++].exec(nr))for(Go=0;Go<Oc.length;Go++)Gt=ul[++aa],typeof(zn=Oc[Go])===h&&zn.length>0?zn.length===2?typeof zn[1]==c?this[zn[0]]=zn[1].call(this,Gt):this[zn[0]]=zn[1]:zn.length===3?typeof zn[1]!==c||zn[1].exec&&zn[1].test?this[zn[0]]=Gt?Gt.replace(zn[1],zn[2]):s:this[zn[0]]=Gt?zn[1].call(this,Gt,zn[2]):s:zn.length===4&&(this[zn[0]]=Gt?zn[3].call(this,Gt.replace(zn[1],zn[2])):s):this[zn]=Gt||s;Wo+=2}},bd=function(nr,dr){for(var wn in dr)if(typeof dr[wn]===h&&dr[wn].length>0){for(var aa=0;aa<dr[wn].length;aa++)if(BE(dr[wn][aa],nr))return wn==="?"?s:wn}else if(BE(dr[wn],nr))return wn==="?"?s:wn;return dr.hasOwnProperty("*")?dr["*"]:nr},M$={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},U$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,C],[/opios[\/ ]+([\w\.]+)/i],[C,[_,_e+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[C,[_,_e+" GX"]],[/\bopr\/([\w\.]+)/i],[C,[_,_e]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[C,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,C],[/quark(?:pc)?\/([-\w\.]+)/i],[C,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[C,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[_,"UC"+Ee]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[_,"Smart Lenovo "+Ee]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+Ee],C],[/\bfocus\/([\w\.]+)/i],[C,[_,ht+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[_,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[_,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[_,"MIUI"+VE]],[/fxios\/([\w\.-]+)/i],[C,[_,ht]],[/\bqihoobrowser\/?([\w\.]*)/i],[C,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],C],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+VE],C],[/samsungbrowser\/([\w\.]+)/i],[C,[_,X+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[C,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,C],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[C,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,xr],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[_,Fe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Fe+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[_,"Android "+Ee]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[C,bd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],C],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[_,ht+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[C,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[C,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[M,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[M,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[M,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[M,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[M,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[M,/ower/,"",rh]],[/ sun4\w[;\)]/i],[[M,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[M,rh]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[S,X],[x,$]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[y,[S,X],[x,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[y,[S,Q],[x,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[S,Q],[x,$]],[/(macintosh);/i],[y,[S,Q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[S,ee],[x,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[y,[S,wt],[x,$]],[/honor([-\w ]+)[;\)]/i],[y,[S,wt],[x,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[y,[S,_t],[x,$]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[S,_t],[x,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[y,/_/g," "],[S,ft],[x,$]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[y,/_/g," "],[S,ft],[x,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[S,O],[x,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[y,[S,bd,{OnePlus:["304","403","203"],"*":O}],[x,$]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[S,"Vivo"],[x,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[y,[S,"Realme"],[x,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[S,ve],[x,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[S,ve],[x,$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[S,qt],[x,$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[S,qt],[x,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[y,[S,"Lenovo"],[x,$]],[/(nokia) (t[12][01])/i],[S,y,[x,$]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[y,/_/g," "],[x,j],[S,"Nokia"]],[/(pixel (c|tablet))\b/i],[y,[S,ot],[x,$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[S,ot],[x,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[S,Ie],[x,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[S,Ie],[x,$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[S,We],[x,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[S,ae],[x,$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[S,ae],[x,j]],[/(playbook);[-\w\),; ]+(rim)/i],[y,S,[x,$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[S,ge],[x,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[S,oe],[x,$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[S,oe],[x,j]],[/(nexus 9)/i],[y,[S,"HTC"],[x,$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[y,/_/g," "],[x,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[y,[S,"TCL"],[x,$]],[/(itel) ((\w+))/i],[[S,rh],y,[x,bd,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[S,"Acer"],[x,$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[S,"Meizu"],[x,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[y,[S,"Ulefone"],[x,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[y,[S,"Energizer"],[x,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[y,[S,"Cat"],[x,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[y,[S,"Smartfren"],[x,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[y,[S,"Nothing"],[x,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[y,[S,"Archos"],[x,$]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[y,[S,"Archos"],[x,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[S,y,[x,$]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[S,y,[x,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,y,[x,$]],[/(surface duo)/i],[y,[S,Nn],[x,$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[S,"Fairphone"],[x,j]],[/(u304aa)/i],[y,[S,"AT&T"],[x,j]],[/\bsie-(\w*)/i],[y,[S,"Siemens"],[x,j]],[/\b(rct\w+) b/i],[y,[S,"RCA"],[x,$]],[/\b(venue[\d ]{2,7}) b/i],[y,[S,"Dell"],[x,$]],[/\b(q(?:mv|ta)\w+) b/i],[y,[S,"Verizon"],[x,$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[S,"Barnes & Noble"],[x,$]],[/\b(tm\d{3}\w+) b/i],[y,[S,"NuVision"],[x,$]],[/\b(k88) b/i],[y,[S,"ZTE"],[x,$]],[/\b(nx\d{3}j) b/i],[y,[S,"ZTE"],[x,j]],[/\b(gen\d{3}) b.+49h/i],[y,[S,"Swiss"],[x,j]],[/\b(zur\d{3}) b/i],[y,[S,"Swiss"],[x,$]],[/\b((zeki)?tb.*\b) b/i],[y,[S,"Zeki"],[x,$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],y,[x,$]],[/\b(ns-?\w{0,9}) b/i],[y,[S,"Insignia"],[x,$]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[S,"NextBook"],[x,$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],y,[x,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],y,[x,j]],[/\b(ph-1) /i],[y,[S,"Essential"],[x,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[S,"Envizen"],[x,$]],[/\b(trio[-\w\. ]+) b/i],[y,[S,"MachSpeed"],[x,$]],[/\btu_(1491) b/i],[y,[S,"Rotor"],[x,$]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[y,[S,Pe],[x,$]],[/(sprint) (\w+)/i],[S,y,[x,j]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[S,Nn],[x,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[S,vn],[x,$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[S,vn],[x,j]],[/smart-tv.+(samsung)/i],[S,[x,K]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[S,X],[x,K]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,qt],[x,K]],[/(apple) ?tv/i],[S,[y,Q+" TV"],[x,K]],[/crkey/i],[[y,Fe+"cast"],[S,ot],[x,K]],[/droid.+aft(\w+)( bui|\))/i],[y,[S,ae],[x,K]],[/(shield \w+ tv)/i],[y,[S,Pe],[x,K]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[S,ee],[x,K]],[/(bravia[\w ]+)( bui|\))/i],[y,[S,Ie],[x,K]],[/(mi(tv|box)-?\w+) bui/i],[y,[S,ft],[x,K]],[/Hbbtv.*(technisat) (.*);/i],[S,y,[x,K]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Iv],[y,Iv],[x,K]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[y,[x,K]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,K]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,y,[x,D]],[/droid.+; (shield)( bui|\))/i],[y,[S,Pe],[x,D]],[/(playstation \w+)/i],[y,[S,Ie],[x,D]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[S,Nn],[x,D]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[y,[S,X],[x,J]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[S,y,[x,J]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[y,[S,O],[x,J]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[S,Q],[x,J]],[/(opwwe\d{3})/i],[y,[S,We],[x,J]],[/(moto 360)/i],[y,[S,ve],[x,J]],[/(smartwatch 3)/i],[y,[S,Ie],[x,J]],[/(g watch r)/i],[y,[S,qt],[x,J]],[/droid.+; (wt63?0{2,3})\)/i],[y,[S,vn],[x,J]],[/droid.+; (glass) \d/i],[y,[S,ot],[x,J]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,y,[x,J]],[/; (quest( \d| pro)?)/i],[y,[S,xr],[x,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[x,ne]],[/(aeobc)\b/i],[y,[S,ae],[x,ne]],[/(homepod).+mac os/i],[y,[S,Q],[x,ne]],[/windows iot/i],[[x,ne]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[y,[x,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[x,$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[y,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,C],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,C],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,C],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[C,bd,M$]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,bd,M$],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,_d],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],C],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,C],[/\(bb(10);/i],[C,[_,ge]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[C,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[_,ht+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[_,Fe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,vs],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,C],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,C]]},Bo=function(nr,dr){if(typeof nr===h&&(dr=nr,nr=s),!(this instanceof Bo))return new Bo(nr,dr).getResult();var wn=typeof i!==u&&i.navigator?i.navigator:s,aa=nr||(wn&&wn.userAgent?wn.userAgent:""),Go=wn&&wn.userAgentData?wn.userAgentData:s,zn=dr?function(Gt,Wo){var ah={};for(var Oc in Gt)Wo[Oc]&&Wo[Oc].length%2==0?ah[Oc]=Wo[Oc].concat(Gt[Oc]):ah[Oc]=Gt[Oc];return ah}(U$,dr):U$,ul=wn&&wn.userAgent==aa;return this.getBrowser=function(){var Gt={};return Gt[_]=s,Gt[C]=s,ih.call(Gt,aa,zn.browser),Gt[g]=function(Wo){return typeof Wo===m?Wo.replace(/[^\d\.]/g,"").split(".")[0]:s}(Gt[C]),ul&&wn&&wn.brave&&typeof wn.brave.isBrave==c&&(Gt[_]="Brave"),Gt},this.getCPU=function(){var Gt={};return Gt[M]=s,ih.call(Gt,aa,zn.cpu),Gt},this.getDevice=function(){var Gt={};return Gt[S]=s,Gt[y]=s,Gt[x]=s,ih.call(Gt,aa,zn.device),ul&&!Gt[x]&&Go&&Go.mobile&&(Gt[x]=j),ul&&Gt[y]=="Macintosh"&&wn&&typeof wn.standalone!==u&&wn.maxTouchPoints&&wn.maxTouchPoints>2&&(Gt[y]="iPad",Gt[x]=$),Gt},this.getEngine=function(){var Gt={};return Gt[_]=s,Gt[C]=s,ih.call(Gt,aa,zn.engine),Gt},this.getOS=function(){var Gt={};return Gt[_]=s,Gt[C]=s,ih.call(Gt,aa,zn.os),ul&&!Gt[_]&&Go&&Go.platform&&Go.platform!="Unknown"&&(Gt[_]=Go.platform.replace(/chrome os/i,vs).replace(/macos/i,_d)),Gt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return aa},this.setUA=function(Gt){return aa=typeof Gt===m&&Gt.length>500?Iv(Gt,500):Gt,this},this.setUA(aa),this};Bo.VERSION="0.7.41",Bo.BROWSER=fm([_,C,g]),Bo.CPU=fm([M]),Bo.DEVICE=fm([y,S,x,D,j,K,$,J,ne]),Bo.ENGINE=Bo.OS=fm([_,C]),t.exports&&(r=t.exports=Bo),r.UAParser=Bo;var gm=typeof i!==u&&(i.jQuery||i.Zepto);if(gm&&!gm.ua){var GE=new Bo;gm.ua=GE.getResult(),gm.ua.get=function(){return GE.getUA()},gm.ua.set=function(nr){GE.setUA(nr);var dr=GE.getResult();for(var wn in dr)gm.ua[wn]=dr[wn]}}})(typeof window=="object"?window:o)})(eR,eR.exports);var vhe=d(eR.exports),q5=p_.clear;Zt({global:!0,bind:!0,forced:A.clearImmediate!==q5},{clearImmediate:q5});var X5=A,yhe=V,_he=de,bhe=nC,Ehe=Wn,xhe=Kl,She=mu,whe=X5.Function,The=/MSIE .\./.test(Ehe)||bhe==="BUN"&&function(){var t=X5.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),Che=Zt,J5=A,Q5=p_.set,Nhe=function(t,r){var i=1;return The?function(s,c){var u=She(arguments.length,1)>i,h=_he(s)?s:whe(s),m=u?xhe(arguments,i):[],g=u?function(){yhe(h,this,m)}:h;return t(g)}:t},Z5=J5.setImmediate?Nhe(Q5):Q5;Che({global:!0,bind:!0,forced:J5.setImmediate!==Z5},{setImmediate:Z5});var e4=d(zt.setImmediate),Rhe=A,Ahe=oM,Ihe=ja,Ohe=mu,Phe=me;Zt({global:!0,dontCallGetSet:!0,forced:p(function(){return Phe&&Object.getOwnPropertyDescriptor(Rhe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){Ohe(arguments.length,1),Ahe(Ihe(t))}});var t4=d(zt.queueMicrotask);function n4(t,r){return function(){return t.apply(r,arguments)}}const{toString:Dhe}=Object.prototype,{getPrototypeOf:tR}=Object,{iterator:B_,toStringTag:r4}=Symbol,G_=(nR=Object.create(null),t=>{const r=Dhe.call(t);return nR[r]||(nR[r]=r.slice(8,-1).toLowerCase())});var nR;const So=t=>(t=t.toLowerCase(),r=>G_(r)===t),W_=t=>r=>typeof r===t,{isArray:Ep}=Array,xp=W_("undefined");function Rg(t){return t!==null&&!xp(t)&&t.constructor!==null&&!xp(t.constructor)&&La(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const i4=So("ArrayBuffer"),khe=W_("string"),La=W_("function"),a4=W_("number"),Ag=t=>t!==null&&typeof t=="object",$_=t=>{if(G_(t)!=="object")return!1;const r=tR(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||r4 in t||B_ in t)},jhe=So("Date"),Lhe=So("File"),Mhe=So("Blob"),Uhe=So("FileList"),Fhe=So("URLSearchParams"),[Vhe,Bhe,Ghe,Whe]=["ReadableStream","Request","Response","Headers"].map(So);function Ig(t,r){let i,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Ep(t))for(i=0,s=t.length;i<s;i++)r.call(null,t[i],i,t);else{if(Rg(t))return;const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,t[m],m,t)}}function s4(t,r){if(Rg(t))return null;r=r.toLowerCase();const i=Object.keys(t);let s,c=i.length;for(;c-- >0;)if(s=i[c],r===s.toLowerCase())return s;return null}const Eu=Y5!==void 0?Y5:typeof self<"u"?self:typeof window<"u"?window:Id,o4=t=>!xp(t)&&t!==Eu,$he=(rR=typeof Uint8Array<"u"&&tR(Uint8Array),t=>rR&&t instanceof rR);var rR;const Hhe=So("HTMLFormElement"),c4=(t=>{let{hasOwnProperty:r}=t;return(i,s)=>r.call(i,s)})(Object.prototype),zhe=So("RegExp"),l4=(t,r)=>{const i=Object.getOwnPropertyDescriptors(t),s={};Ig(i,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(s[u]=h||c)}),Object.defineProperties(t,s)},Khe=So("AsyncFunction"),d4=(u4=typeof e4=="function",h4=La(Eu.postMessage),u4?e4:h4?(iR="axios@".concat(Math.random()),H_=[],Eu.addEventListener("message",t=>{let{source:r,data:i}=t;r===Eu&&i===iR&&H_.length&&H_.shift()()},!1),t=>{H_.push(t),Eu.postMessage(iR,"*")}):t=>setTimeout(t));var u4,h4,iR,H_;const Yhe=t4!==void 0?t4.bind(Eu):typeof process<"u"&&process.nextTick||d4;var Le={isArray:Ep,isArrayBuffer:i4,isBuffer:Rg,isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||La(t.append)&&((r=G_(t))==="formdata"||r==="object"&&La(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&i4(t.buffer),r},isString:khe,isNumber:a4,isBoolean:t=>t===!0||t===!1,isObject:Ag,isPlainObject:$_,isEmptyObject:t=>{if(!Ag(t)||Rg(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},isReadableStream:Vhe,isRequest:Bhe,isResponse:Ghe,isHeaders:Whe,isUndefined:xp,isDate:jhe,isFile:Lhe,isBlob:Mhe,isRegExp:zhe,isFunction:La,isStream:t=>Ag(t)&&La(t.pipe),isURLSearchParams:Fhe,isTypedArray:$he,isFileList:Uhe,forEach:Ig,merge:function t(){const{caseless:r,skipUndefined:i}=o4(this)&&this||{},s={},c=(u,h)=>{const m=r&&s4(s,h)||h;$_(s[m])&&$_(u)?s[m]=t(s[m],u):$_(u)?s[m]=t({},u):Ep(u)?s[m]=u.slice():i&&xp(u)||(s[m]=u)};for(let u=0,h=arguments.length;u<h;u++)arguments[u]&&Ig(arguments[u],c);return s},extend:function(t,r,i){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ig(r,(c,u)=>{i&&La(c)?t[u]=n4(c,i):t[u]=c},{allOwnKeys:s}),t},trim:t=>Si(t)?Si(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,i,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),i&&Object.assign(t.prototype,i)},toFlatObject:(t,r,i,s)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],s&&!s(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=i!==!1&&tR(t)}while(t&&(!i||i(t,r))&&t!==Object.prototype);return r},kindOf:G_,kindOfTest:So,endsWith:(t,r,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=r.length;const s=t.indexOf(r,i);return s!==-1&&s===i},toArray:t=>{if(!t)return null;if(Ep(t))return t;let r=t.length;if(!a4(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=t[r];return i},forEachEntry:(t,r)=>{const i=(t&&t[B_]).call(t);let s;for(;(s=i.next())&&!s.done;){const c=s.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let i;const s=[];for(;(i=t.exec(r))!==null;)s.push(i);return s},isHTMLForm:Hhe,hasOwnProperty:c4,hasOwnProp:c4,reduceDescriptors:l4,freezeMethods:t=>{l4(t,(r,i)=>{if(La(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=t[i];La(s)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(t,r)=>{const i={},s=c=>{c.forEach(u=>{i[u]=!0})};return Ep(t)?s(t):s(String(t).split(r)),i},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,s){return i.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:s4,global:Eu,isContextDefined:o4,isSpecCompliantForm:function(t){return!!(t&&La(t.append)&&t[r4]==="FormData"&&t[B_])},toJSONObject:t=>{const r=new Array(10),i=(s,c)=>{if(Ag(s)){if(r.indexOf(s)>=0)return;if(Rg(s))return s;if(!("toJSON"in s)){r[c]=s;const u=Ep(s)?[]:{};return Ig(s,(h,m)=>{const g=i(h,c+1);!xp(g)&&(u[m]=g)}),r[c]=void 0,u}}return s};return i(t,0)},isAsyncFn:Khe,isThenable:t=>t&&(Ag(t)||La(t))&&La(t.then)&&La(t.catch),setImmediate:d4,asap:Yhe,isIterable:t=>t!=null&&La(t[B_])};function cn(t,r,i,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}Le.inherits(cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Le.toJSONObject(this.config),code:this.code,status:this.status}}});const p4=cn.prototype,m4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{m4[t]={value:t}}),Object.defineProperties(cn,m4),Object.defineProperty(p4,"isAxiosError",{value:!0}),cn.from=(t,r,i,s,c,u)=>{const h=Object.create(p4);Le.toFlatObject(t,h,function(y){return y!==Error.prototype},y=>y!=="isAxiosError");const m=t&&t.message?t.message:"Error",g=r==null&&t?t.code:r;return cn.call(h,m,g,i,s,c),t&&h.cause==null&&Object.defineProperty(h,"cause",{value:t,configurable:!0}),h.name=t&&t.name||"Error",u&&Object.assign(h,u),h};function aR(t){return Le.isPlainObject(t)||Le.isArray(t)}function f4(t){return Le.endsWith(t,"[]")?t.slice(0,-2):t}function g4(t,r,i){return t?t.concat(r).map(function(s,c){return s=f4(s),!i&&c?"["+s+"]":s}).join(i?".":""):r}const qhe=Le.toFlatObject(Le,{},null,function(t){return/^is[A-Z]/.test(t)});function z_(t,r,i){if(!Le.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const s=(i=Le.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,C){return!Le.isUndefined(C[S])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&Le.isSpecCompliantForm(r);if(!Le.isFunction(c))throw new TypeError("visitor must be a function");function g(S){if(S===null)return"";if(Le.isDate(S))return S.toISOString();if(Le.isBoolean(S))return S.toString();if(!m&&Le.isBlob(S))throw new cn("Blob is not supported. Use a Buffer instead.");return Le.isArrayBuffer(S)||Le.isTypedArray(S)?m&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function y(S,C,M){let D=S;if(S&&!M&&typeof S=="object"){if(Le.endsWith(C,"{}"))C=s?C:C.slice(0,-2),S=JSON.stringify(S);else if(Le.isArray(S)&&function(j){return Le.isArray(j)&&!j.some(aR)}(S)||(Le.isFileList(S)||Le.endsWith(C,"[]"))&&(D=Le.toArray(S)))return C=f4(C),D.forEach(function(j,$){!Le.isUndefined(j)&&j!==null&&r.append(h===!0?g4([C],$,u):h===null?C:C+"[]",g(j))}),!1}return!!aR(S)||(r.append(g4(M,C,u),g(S)),!1)}const _=[],x=Object.assign(qhe,{defaultVisitor:y,convertValue:g,isVisitable:aR});if(!Le.isObject(t))throw new TypeError("data must be an object");return function S(C,M){if(!Le.isUndefined(C)){if(_.indexOf(C)!==-1)throw Error("Circular reference detected in "+M.join("."));_.push(C),Le.forEach(C,function(D,j){(!(Le.isUndefined(D)||D===null)&&c.call(r,D,Le.isString(j)?Si(j).call(j):j,M,x))===!0&&S(D,M?M.concat(j):[j])}),_.pop()}}(t),r}function v4(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function sR(t,r){this._pairs=[],t&&z_(t,this,r)}const y4=sR.prototype;function Xhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _4(t,r,i){if(!r)return t;const s=i&&i.encode||Xhe;Le.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):Le.isURLSearchParams(r)?r.toString():new sR(r,i).toString(s),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}y4.append=function(t,r){this._pairs.push([t,r])},y4.toString=function(t){const r=t?function(i){return t.call(this,i,v4)}:v4;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var b4=class{constructor(){this.handlers=[]}use(t,r,i){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Le.forEach(this.handlers,function(r){r!==null&&t(r)})}},E4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},x4={exports:{}},Jhe=Zt,Qhe=me,S4=Os.f;Jhe({target:"Object",stat:!0,forced:Object.defineProperty!==S4,sham:!Qhe},{defineProperty:S4});var w4=zt.Object,Zhe=x4.exports=function(t,r,i){return w4.defineProperty(t,r,i)};w4.defineProperty.sham&&(Zhe.sham=!0);var T4=d(x4.exports),epe=TypeError,C4=lg,tpe=h_,npe=et,rpe=Zn("species"),N4=Array,ipe=function(t){var r;return C4(t)&&(r=t.constructor,(tpe(r)&&(r===N4||C4(r.prototype))||npe(r)&&(r=r[rpe])===null)&&(r=void 0)),r===void 0?N4:r},R4=function(t,r){return new(ipe(t))(r===0?0:r)},ape=p,spe=gr,ope=Zn("species"),A4=function(t){return spe>=51||!ape(function(){var r=[];return(r.constructor={})[ope]=function(){return{foo:1}},r[t](Boolean).foo!==1})},cpe=Zt,lpe=p,dpe=lg,upe=et,hpe=lc,ppe=$l,I4=function(t){if(t>9007199254740991)throw epe("Maximum allowed index exceeded");return t},O4=fN,mpe=R4,fpe=A4,gpe=gr,P4=Zn("isConcatSpreadable"),vpe=gpe>=51||!lpe(function(){var t=[];return t[P4]=!1,t.concat()[0]!==t}),ype=function(t){if(!upe(t))return!1;var r=t[P4];return r!==void 0?!!r:dpe(t)};cpe({target:"Array",proto:!0,forced:!vpe||!fpe("concat")},{concat:function(t){var r,i,s,c,u,h=hpe(this),m=mpe(h,0),g=0;for(r=-1,s=arguments.length;r<s;r++)if(ype(u=r===-1?h:arguments[r]))for(c=ppe(u),I4(g+c),i=0;i<c;i++,g++)i in u&&O4(m,g,u[i]);else I4(g+1),O4(m,g++,u);return m.length=g,m}});var D4={},_pe=Y,bpe=At,k4=X0.f,Epe=Kl,j4=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];D4.f=function(t){return j4&&_pe(t)==="Window"?function(r){try{return k4(r)}catch{return Epe(j4)}}(t):k4(bpe(t))};var Sp={},xpe=Zn;Sp.f=xpe;var L4=zt,Spe=ri,wpe=Sp,Tpe=Os.f,Lr=function(t){var r=L4.Symbol||(L4.Symbol={});Spe(r,t)||Tpe(r,t,{value:wpe.f(t)})},Cpe=be,Npe=nt,Rpe=Zn,Ape=zl,M4=function(){var t=Npe("Symbol"),r=t&&t.prototype,i=r&&r.valueOf,s=Rpe("toPrimitive");r&&!r[s]&&Ape(r,s,function(c){return Cpe(i,this)},{})},Ipe=Wl,Ope=Ne,Ppe=lc,Dpe=$l,kpe=R4,U4=w([].push),jpe=function(t){var r=t===1,i=t===2,s=t===3,c=t===4,u=t===6,h=t===7,m=t===5||u;return function(g,y,_,x){for(var S,C,M=Ppe(g),D=Ope(M),j=Dpe(D),$=Ipe(y,_),K=0,J=x||kpe,ne=r?J(g,j):i||h?J(g,0):void 0;j>K;K++)if((m||K in D)&&(C=$(S=D[K],K,M),t))if(r)ne[K]=C;else if(C)switch(t){case 3:return!0;case 5:return S;case 6:return K;case 2:U4(ne,S)}else switch(t){case 4:return!1;case 7:U4(ne,S)}return u?-1:s||c?c:ne}},F4={forEach:jpe(0)},K_=Zt,Og=A,oR=be,Lpe=w,wp=me,Tp=cc,Mpe=p,wi=ri,Upe=N,cR=ga,Y_=At,lR=GT,Fpe=va,dR=lt,Cp=ug,V4=Q0,Vpe=X0,B4=D4,Bpe=dg,G4=xe,W4=Os,Gpe=lC,$4=se,H4=zl,Wpe=u_,uR=Jh,z4=J0,K4=VT,$pe=Zn,Hpe=Sp,zpe=Lr,Kpe=M4,Ype=Jc,Y4=pu,q_=F4.forEach,Ma=q0("hidden"),X_="Symbol",Pg="prototype",qpe=Y4.set,q4=Y4.getterFor(X_),wo=Object[Pg],xu=Og.Symbol,J_=xu&&xu[Pg],Xpe=Og.RangeError,Jpe=Og.TypeError,hR=Og.QObject,X4=G4.f,Su=W4.f,J4=B4.f,Qpe=$4.f,Q4=Lpe([].push),el=uR("symbols"),Dg=uR("op-symbols"),Zpe=uR("wks"),pR=!hR||!hR[Pg]||!hR[Pg].findChild,Z4=function(t,r,i){var s=X4(wo,r);s&&delete wo[r],Su(t,r,i),s&&t!==wo&&Su(wo,r,s)},mR=wp&&Mpe(function(){return Cp(Su({},"a",{get:function(){return Su(this,"a",{value:7}).a}})).a!==7})?Z4:Su,fR=function(t,r){var i=el[t]=Cp(J_);return qpe(i,{type:X_,tag:t,description:r}),wp||(i.description=r),i},Q_=function(t,r,i){t===wo&&Q_(Dg,r,i),cR(t);var s=lR(r);return cR(i),wi(el,s)?(i.enumerable?(wi(t,Ma)&&t[Ma][s]&&(t[Ma][s]=!1),i=Cp(i,{enumerable:dR(0,!1)})):(wi(t,Ma)||Su(t,Ma,dR(1,Cp(null))),t[Ma][s]=!0),mR(t,s,i)):Su(t,s,i)},gR=function(t,r){cR(t);var i=Y_(r),s=V4(i).concat(r3(i));return q_(s,function(c){wp&&!oR(e3,i,c)||Q_(t,c,i[c])}),t},e3=function(t){var r=lR(t),i=oR(Qpe,this,r);return!(this===wo&&wi(el,r)&&!wi(Dg,r))&&(!(i||!wi(this,r)||!wi(el,r)||wi(this,Ma)&&this[Ma][r])||i)},t3=function(t,r){var i=Y_(t),s=lR(r);if(i!==wo||!wi(el,s)||wi(Dg,s)){var c=X4(i,s);return!c||!wi(el,s)||wi(i,Ma)&&i[Ma][s]||(c.enumerable=!0),c}},n3=function(t){var r=J4(Y_(t)),i=[];return q_(r,function(s){wi(el,s)||wi(z4,s)||Q4(i,s)}),i},r3=function(t){var r=t===wo,i=J4(r?Dg:Y_(t)),s=[];return q_(i,function(c){!wi(el,c)||r&&!wi(wo,c)||Q4(s,el[c])}),s};Tp||(xu=function(){if(Upe(J_,this))throw new Jpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Fpe(arguments[0]):void 0,r=K4(t),i=function(s){var c=this===void 0?Og:this;c===wo&&oR(i,Dg,s),wi(c,Ma)&&wi(c[Ma],r)&&(c[Ma][r]=!1);var u=dR(1,s);try{mR(c,r,u)}catch(h){if(!(h instanceof Xpe))throw h;Z4(c,r,u)}};return wp&&pR&&mR(wo,r,{configurable:!0,set:i}),fR(r,t)},H4(J_=xu[Pg],"toString",function(){return q4(this).tag}),H4(xu,"withoutSetter",function(t){return fR(K4(t),t)}),$4.f=e3,W4.f=Q_,Gpe.f=gR,G4.f=t3,Vpe.f=B4.f=n3,Bpe.f=r3,Hpe.f=function(t){return fR($pe(t),t)},wp&&Wpe(J_,"description",{configurable:!0,get:function(){return q4(this).description}})),K_({global:!0,wrap:!0,forced:!Tp,sham:!Tp},{Symbol:xu}),q_(V4(Zpe),function(t){zpe(t)}),K_({target:X_,stat:!0,forced:!Tp},{useSetter:function(){pR=!0},useSimple:function(){pR=!1}}),K_({target:"Object",stat:!0,forced:!Tp,sham:!wp},{create:function(t,r){return r===void 0?Cp(t):gR(Cp(t),r)},defineProperty:Q_,defineProperties:gR,getOwnPropertyDescriptor:t3}),K_({target:"Object",stat:!0,forced:!Tp},{getOwnPropertyNames:n3}),Kpe(),Ype(xu,X_),z4[Ma]=!0;var i3=cc&&!!Symbol.for&&!!Symbol.keyFor,eme=Zt,tme=nt,nme=ri,rme=va,a3=Jh,ime=i3,vR=a3("string-to-symbol-registry"),ame=a3("symbol-to-string-registry");eme({target:"Symbol",stat:!0,forced:!ime},{for:function(t){var r=rme(t);if(nme(vR,r))return vR[r];var i=tme("Symbol")(r);return vR[r]=i,ame[i]=r,i}});var sme=Zt,ome=ri,cme=ig,lme=Xh,dme=i3,s3=Jh("symbol-to-string-registry");sme({target:"Symbol",stat:!0,forced:!dme},{keyFor:function(t){if(!cme(t))throw new TypeError(lme(t)+" is not a symbol");if(ome(s3,t))return s3[t]}});var o3=lg,ume=de,c3=Y,hme=va,l3=w([].push),pme=Zt,d3=nt,u3=V,mme=be,kg=w,h3=p,p3=de,m3=ig,f3=Kl,fme=function(t){if(ume(t))return t;if(o3(t)){for(var r=t.length,i=[],s=0;s<r;s++){var c=t[s];typeof c=="string"?l3(i,c):typeof c!="number"&&c3(c)!=="Number"&&c3(c)!=="String"||l3(i,hme(c))}var u=i.length,h=!0;return function(m,g){if(h)return h=!1,g;if(o3(this))return g;for(var y=0;y<u;y++)if(i[y]===m)return g}}},gme=cc,vme=String,Zl=d3("JSON","stringify"),Z_=kg(/./.exec),g3=kg("".charAt),yme=kg("".charCodeAt),_me=kg("".replace),bme=kg(1.1.toString),Eme=/[\uD800-\uDFFF]/g,v3=/^[\uD800-\uDBFF]$/,y3=/^[\uDC00-\uDFFF]$/,_3=!gme||h3(function(){var t=d3("Symbol")("stringify detection");return Zl([t])!=="[null]"||Zl({a:t})!=="{}"||Zl(Object(t))!=="{}"}),b3=h3(function(){return Zl("\uDF06\uD834")!=='"\\udf06\\ud834"'||Zl("\uDEAD")!=='"\\udead"'}),xme=function(t,r){var i=f3(arguments),s=fme(r);if(p3(s)||t!==void 0&&!m3(t))return i[1]=function(c,u){if(p3(s)&&(u=mme(s,this,vme(c),u)),!m3(u))return u},u3(Zl,null,i)},Sme=function(t,r,i){var s=g3(i,r-1),c=g3(i,r+1);return Z_(v3,t)&&!Z_(y3,c)||Z_(y3,t)&&!Z_(v3,s)?"\\u"+bme(yme(t,0),16):t};Zl&&pme({target:"JSON",stat:!0,forced:_3||b3},{stringify:function(t,r,i){var s=f3(arguments),c=u3(_3?xme:Zl,null,s);return b3&&typeof c=="string"?_me(c,Eme,Sme):c}});var E3=dg,wme=lc;Zt({target:"Object",stat:!0,forced:!cc||p(function(){E3.f(1)})},{getOwnPropertySymbols:function(t){var r=E3.f;return r?r(wme(t)):[]}}),Lr("asyncDispose"),Lr("asyncIterator"),Lr("dispose"),Lr("hasInstance"),Lr("isConcatSpreadable"),Lr("iterator"),Lr("match"),Lr("matchAll"),Lr("replace"),Lr("search"),Lr("species"),Lr("split");var Tme=M4;Lr("toPrimitive"),Tme();var Cme=nt,Nme=Jc;Lr("toStringTag"),Nme(Cme("Symbol"),"Symbol"),Lr("unscopables"),Jc(A.JSON,"JSON",!0);var Rme=zt.Symbol,Ame=Zn,Ime=Os.f,x3=Ame("metadata"),S3=Function.prototype;S3[x3]===void 0&&Ime(S3,x3,{value:null}),Lr("metadata");var Ome=Rme,Pme=w,yR=nt("Symbol"),Dme=yR.keyFor,kme=Pme(yR.prototype.valueOf),w3=yR.isRegisteredSymbol||function(t){try{return Dme(kme(t))!==void 0}catch{return!1}};Zt({target:"Symbol",stat:!0},{isRegisteredSymbol:w3});for(var jme=Jh,T3=nt,Lme=w,Mme=ig,Ume=Zn,eb=T3("Symbol"),C3=eb.isWellKnownSymbol,N3=T3("Object","getOwnPropertyNames"),Fme=Lme(eb.prototype.valueOf),R3=jme("wks"),_R=0,A3=N3(eb),Vme=A3.length;_R<Vme;_R++)try{var I3=A3[_R];Mme(eb[I3])&&Ume(I3)}catch{}var O3=function(t){if(C3&&C3(t))return!0;try{for(var r=Fme(t),i=0,s=N3(R3),c=s.length;i<c;i++)if(R3[s[i]]==r)return!0}catch{}return!1};Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:O3}),Lr("customMatcher"),Lr("observable"),Zt({target:"Symbol",stat:!0},{isRegistered:w3}),Zt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:O3}),Lr("matcher"),Lr("metadataKey"),Lr("patternMatch"),Lr("replaceAll");var Np=d(Ome),P3=d(Sp.f("iterator"));function jg(t){return jg=typeof Np=="function"&&typeof P3=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Np=="function"&&r.constructor===Np&&r!==Np.prototype?"symbol":typeof r},jg(t)}var Bme=d(Sp.f("toPrimitive"));function Gme(t){var r=function(i,s){if(jg(i)!="object"||!i)return i;var c=i[Bme];if(c!==void 0){var u=c.call(i,s);if(jg(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}(t,"string");return jg(r)=="symbol"?r:r+""}function L(t,r,i){return(r=Gme(r))in t?T4(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}var D3=d(mde),Wme={isBrowser:!0,classes:{URLSearchParams:D3!==void 0?D3:sR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const bR=typeof window<"u"&&typeof document<"u",ER=typeof navigator=="object"&&navigator||void 0,$me=bR&&(!ER||["ReactNative","NativeScript","NS"].indexOf(ER.product)<0),Hme=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",zme=bR&&window.location.href||"http://localhost";function k3(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function j3(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?k3(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k3(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var ea=j3(j3({},Object.freeze({__proto__:null,hasBrowserEnv:bR,hasStandardBrowserEnv:$me,hasStandardBrowserWebWorkerEnv:Hme,navigator:ER,origin:zme})),Wme);function L3(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Kme(t,r){return z_(t,new ea.classes.URLSearchParams,function(i){for(var s=1;s<arguments.length;s++){var c=arguments[s]!=null?arguments[s]:{};s%2?L3(Object(c),!0).forEach(function(u){L(i,u,c[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(c)):L3(Object(c)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(c,u))})}return i}({visitor:function(i,s,c,u){return ea.isNode&&Le.isBuffer(i)?(this.append(s,i.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},r))}var Yme=tN.charAt,M3=be,qme=ga,Xme=de,Jme=Y,Qme=/./.exec,Zme=TypeError,efe=Zt,U3=be,F3=ie,tfe=xC,tb=l_,V3=gt,B3=Mj,Lg=va,nfe=ga,rfe=et,ife=Y,afe=QT,G3=zN,sfe=ag,ofe=p,cfe=RC,lfe=function(t,r,i){return r+(i?Yme(t,r).length:1)},dfe=function(t,r){var i=t.exec;if(Xme(i)){var s=M3(i,t,r);return s!==null&&qme(s),s}if(Jme(t)==="RegExp")return M3(Qme,t,r);throw new Zme("RegExp#exec called on incompatible receiver")},W3=pu,ufe=Zn("matchAll"),$3="RegExp String",H3=$3+" Iterator",hfe=W3.set,pfe=W3.getterFor(H3),mfe=TypeError,xR=F3("".indexOf),nb=F3("".matchAll),SR=!!nb&&!ofe(function(){nb("a",/./)}),ffe=tfe(function(t,r,i,s){hfe(this,{type:H3,regexp:t,string:r,global:i,unicode:s,done:!1})},$3,function(){var t=pfe(this);if(t.done)return tb(void 0,!0);var r=t.regexp,i=t.string,s=dfe(r,i);return s===null?(t.done=!0,tb(void 0,!0)):t.global?(Lg(s[0])===""&&(r.lastIndex=lfe(i,B3(r.lastIndex),t.unicode)),tb(s,!1)):(t.done=!0,tb(s,!1))}),z3=function(t){var r,i,s,c=nfe(this),u=Lg(t),h=cfe(c,RegExp),m=Lg(G3(c));return r=new h(h===RegExp?c.source:c,m),i=!!~xR(m,"g"),s=!!~xR(m,"u"),r.lastIndex=B3(c.lastIndex),new ffe(r,u,i,s)};efe({target:"String",proto:!0,forced:SR},{matchAll:function(t){var r,i,s,c,u=V3(this);if(rfe(t)){if(afe(t)&&(r=Lg(V3(G3(t))),!~xR(r,"g")))throw new mfe("`.matchAll` does not allow non-global regexes");if(SR)return nb(u,t);if((s=sfe(t,ufe))===void 0&&ife(t)==="RegExp"&&(s=z3),s)return U3(s,t,u)}else if(SR)return nb(u,t);return i=Lg(u),c=new RegExp(t,"g"),U3(z3,c,i)}});var gfe=as("String","matchAll"),vfe=N,yfe=gfe,wR=String.prototype,_fe=function(t){var r=t.matchAll;return typeof t=="string"||t===wR||vfe(wR,t)&&r===wR.matchAll?yfe:r},bfe=d(_fe);function K3(t){function r(i,s,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=u>=i.length;return h=!h&&Le.isArray(c)?c.length:h,g?(Le.hasOwnProp(c,h)?c[h]=[c[h],s]:c[h]=s,!m):(c[h]&&Le.isObject(c[h])||(c[h]=[]),r(i,s,c[h],u)&&Le.isArray(c[h])&&(c[h]=function(y){const _={},x=Object.keys(y);let S;const C=x.length;let M;for(S=0;S<C;S++)M=x[S],_[M]=y[M];return _}(c[h])),!m)}if(Le.isFormData(t)&&Le.isFunction(t.entries)){const i={};return Le.forEachEntry(t,(s,c)=>{r(function(u){return bfe(Le).call(Le,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(s),c,i,0)}),i}return null}const TR={transitional:E4,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const i=r.getContentType()||"",s=i.indexOf("application/json")>-1,c=Le.isObject(t);if(c&&Le.isHTMLForm(t)&&(t=new FormData(t)),Le.isFormData(t))return s?JSON.stringify(K3(t)):t;if(Le.isArrayBuffer(t)||Le.isBuffer(t)||Le.isStream(t)||Le.isFile(t)||Le.isBlob(t)||Le.isReadableStream(t))return t;if(Le.isArrayBufferView(t))return t.buffer;if(Le.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Kme(t,this.formSerializer).toString();if((u=Le.isFileList(t))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return z_(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||s?(r.setContentType("application/json",!1),function(h,m,g){if(Le.isString(h))try{return(m||JSON.parse)(h),Si(Le).call(Le,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(g||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||TR.transitional,i=r&&r.forcedJSONParsing,s=this.responseType==="json";if(Le.isResponse(t)||Le.isReadableStream(t))return t;if(t&&Le.isString(t)&&(i&&!this.responseType||s)){const c=!(r&&r.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?cn.from(u,cn.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ea.classes.FormData,Blob:ea.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Le.forEach(["delete","get","head","post","put","patch"],t=>{TR.headers[t]={}});var CR=TR;const Efe=Le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Y3=Symbol("internals");function Mg(t){var r;return t&&Si(r=String(t)).call(r).toLowerCase()}function rb(t){return t===!1||t==null?t:Le.isArray(t)?t.map(rb):String(t)}function NR(t,r,i,s,c){return Le.isFunction(s)?s.call(this,r,i):(c&&(r=i),Le.isString(r)?Le.isString(s)?r.indexOf(s)!==-1:Le.isRegExp(s)?s.test(r):void 0:void 0)}class ib{constructor(r){r&&this.set(r)}set(r,i,s){const c=this;function u(g,y,_){const x=Mg(y);if(!x)throw new Error("header name must be a non-empty string");const S=Le.findKey(c,x);(!S||c[S]===void 0||_===!0||_===void 0&&c[S]!==!1)&&(c[S||y]=rb(g))}const h=(g,y)=>Le.forEach(g,(_,x)=>u(_,x,y));if(Le.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(Le.isString(r)&&(r=Si(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Si(m=r).call(m)))h((g=>{const y={};let _,x,S;return g&&g.split(`
`).forEach(function(C){var M,D;S=C.indexOf(":"),_=Si(M=C.substring(0,S)).call(M).toLowerCase(),x=Si(D=C.substring(S+1)).call(D),!_||y[_]&&Efe[_]||(_==="set-cookie"?y[_]?y[_].push(x):y[_]=[x]:y[_]=y[_]?y[_]+", "+x:x)}),y})(r),i);else if(Le.isObject(r)&&Le.isIterable(r)){let g,y,_={};for(const x of r){if(!Le.isArray(x))throw TypeError("Object iterator must return a key-value pair");_[y=x[0]]=(g=_[y])?Le.isArray(g)?[...g,x[1]]:[g,x[1]]:x[1]}h(_,i)}else r!=null&&u(i,r,s);var m;return this}get(r,i){if(r=Mg(r)){const s=Le.findKey(this,r);if(s){const c=this[s];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(u);)h[g[1]]=g[2];return h}(c);if(Le.isFunction(i))return i.call(this,c,s);if(Le.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=Mg(r)){const s=Le.findKey(this,r);return!(!s||this[s]===void 0||i&&!NR(0,this[s],s,i))}return!1}delete(r,i){const s=this;let c=!1;function u(h){if(h=Mg(h)){const m=Le.findKey(s,h);!m||i&&!NR(0,s[m],m,i)||(delete s[m],c=!0)}}return Le.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let s=i.length,c=!1;for(;s--;){const u=i[s];r&&!NR(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,s={};return Le.forEach(this,(c,u)=>{var h;const m=Le.findKey(s,u);if(m)return i[m]=rb(c),void delete i[u];const g=r?function(y){return Si(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,x,S)=>x.toUpperCase()+S)}(u):Si(h=String(u)).call(h);g!==u&&delete i[u],i[g]=rb(c),s[g]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return Le.forEach(this,(s,c)=>{s!=null&&s!==!1&&(i[c]=r&&Le.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,s]=r;return i+": "+s}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[Y3]=this[Y3]={accessors:{}}).accessors,s=this.prototype;function c(u){const h=Mg(u);i[h]||(function(m,g){const y=Le.toCamelCase(" "+g);["get","set","has"].forEach(_=>{Object.defineProperty(m,_+y,{value:function(x,S,C){return this[_].call(this,g,x,S,C)},configurable:!0})})}(s,u),i[h]=!0)}return Le.isArray(r)?r.forEach(c):c(r),this}}ib.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Le.reduceDescriptors(ib.prototype,(t,r)=>{let{value:i}=t,s=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[s]=c}}}),Le.freezeMethods(ib);var To=ib;function RR(t,r){const i=this||CR,s=r||i,c=To.from(s.headers);let u=s.data;return Le.forEach(t,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function q3(t){return!(!t||!t.__CANCEL__)}function Rp(t,r,i){cn.call(this,t??"canceled",cn.ERR_CANCELED,r,i),this.name="CanceledError"}function X3(t,r,i){const s=i.config.validateStatus;i.status&&s&&!s(i.status)?r(new cn("Request failed with status code "+i.status,[cn.ERR_BAD_REQUEST,cn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}Le.inherits(Rp,cn,{__CANCEL__:!0});const ab=function(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=function(u,h){u=u||10;const m=new Array(u),g=new Array(u);let y,_=0,x=0;return h=h!==void 0?h:1e3,function(S){const C=Date.now(),M=g[x];y||(y=C),m[_]=S,g[_]=C;let D=x,j=0;for(;D!==_;)j+=m[D++],D%=u;if(_=(_+1)%u,_===x&&(x=(x+1)%u),C-y<h)return;const $=M&&C-M;return $?Math.round(1e3*j/$):void 0}}(50,250);return function(u,h){let m,g,y=0,_=1e3/h;const x=function(S){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),u(...S)};return[function(){const S=Date.now(),C=S-y;for(var M=arguments.length,D=new Array(M),j=0;j<M;j++)D[j]=arguments[j];C>=_?x(D,S):(m=D,g||(g=setTimeout(()=>{g=null,x(m)},_-C)))},()=>m&&x(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,g=h-s,y=c(g);s=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},J3=(t,r)=>{const i=t!=null;return[s=>r[0]({lengthComputable:i,total:t,loaded:s}),r[1]]},Q3=t=>function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return Le.asap(()=>t(...i))};var xfe=ea.hasStandardBrowserEnv?((t,r)=>i=>(i=new k_(i,ea.origin),t.protocol===i.protocol&&t.host===i.host&&(r||t.port===i.port)))(new k_(ea.origin),ea.navigator&&/(msie|trident)/i.test(ea.navigator.userAgent)):()=>!0,Sfe=ea.hasStandardBrowserEnv?{write(t,r,i,s,c,u,h){if(typeof document>"u")return;const m=["".concat(t,"=").concat(encodeURIComponent(r))];Le.isNumber(i)&&m.push("expires=".concat(new Date(i).toUTCString())),Le.isString(s)&&m.push("path=".concat(s)),Le.isString(c)&&m.push("domain=".concat(c)),u===!0&&m.push("secure"),Le.isString(h)&&m.push("SameSite=".concat(h)),document.cookie=m.join("; ")},read(t){if(typeof document>"u")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Z3(t,r,i){let s=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(s||i==0)?function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c}(t,r):r}function eF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function AR(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?eF(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):eF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const tF=t=>t instanceof To?AR({},t):t;function wu(t,r){r=r||{};const i={};function s(y,_,x,S){return Le.isPlainObject(y)&&Le.isPlainObject(_)?Le.merge.call({caseless:S},y,_):Le.isPlainObject(_)?Le.merge({},_):Le.isArray(_)?_.slice():_}function c(y,_,x,S){return Le.isUndefined(_)?Le.isUndefined(y)?void 0:s(void 0,y,0,S):s(y,_,0,S)}function u(y,_){if(!Le.isUndefined(_))return s(void 0,_)}function h(y,_){return Le.isUndefined(_)?Le.isUndefined(y)?void 0:s(void 0,y):s(void 0,_)}function m(y,_,x){return x in r?s(y,_):x in t?s(void 0,y):void 0}const g={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,_,x)=>c(tF(y),tF(_),0,!0)};return Le.forEach(Object.keys(AR(AR({},t),r)),function(y){const _=g[y]||c,x=_(t[y],r[y],y);Le.isUndefined(x)&&_!==m||(i[y]=x)}),i}var nF=t=>{const r=wu({},t);let{data:i,withXSRFToken:s,xsrfHeaderName:c,xsrfCookieName:u,headers:h,auth:m}=r;if(r.headers=h=To.from(h),r.url=_4(Z3(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),m&&h.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),Le.isFormData(i)){if(ea.hasStandardBrowserEnv||ea.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(Le.isFunction(i.getHeaders)){const g=i.getHeaders(),y=["content-type","content-length"];Object.entries(g).forEach(_=>{let[x,S]=_;Re(y).call(y,x.toLowerCase())&&h.set(x,S)})}}if(ea.hasStandardBrowserEnv&&(s&&Le.isFunction(s)&&(s=s(r)),s||s!==!1&&xfe(r.url))){const g=c&&u&&Sfe.read(u);g&&h.set(c,g)}return r},wfe=typeof XMLHttpRequest<"u"&&function(t){return new ke(function(r,i){const s=nF(t);let c=s.data;const u=To.from(s.headers).normalize();let h,m,g,y,_,{responseType:x,onUploadProgress:S,onDownloadProgress:C}=s;function M(){y&&y(),_&&_(),s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let D=new XMLHttpRequest;function j(){if(!D)return;const K=To.from("getAllResponseHeaders"in D&&D.getAllResponseHeaders());X3(function(J){r(J),M()},function(J){i(J),M()},{data:x&&x!=="text"&&x!=="json"?D.response:D.responseText,status:D.status,statusText:D.statusText,headers:K,config:t,request:D}),D=null}D.open(s.method.toUpperCase(),s.url,!0),D.timeout=s.timeout,"onloadend"in D?D.onloadend=j:D.onreadystatechange=function(){D&&D.readyState===4&&(D.status!==0||D.responseURL&&D.responseURL.indexOf("file:")===0)&&setTimeout(j)},D.onabort=function(){D&&(i(new cn("Request aborted",cn.ECONNABORTED,t,D)),D=null)},D.onerror=function(K){const J=new cn(K&&K.message?K.message:"Network Error",cn.ERR_NETWORK,t,D);J.event=K||null,i(J),D=null},D.ontimeout=function(){let K=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const J=s.transitional||E4;s.timeoutErrorMessage&&(K=s.timeoutErrorMessage),i(new cn(K,J.clarifyTimeoutError?cn.ETIMEDOUT:cn.ECONNABORTED,t,D)),D=null},c===void 0&&u.setContentType(null),"setRequestHeader"in D&&Le.forEach(u.toJSON(),function(K,J){D.setRequestHeader(J,K)}),Le.isUndefined(s.withCredentials)||(D.withCredentials=!!s.withCredentials),x&&x!=="json"&&(D.responseType=s.responseType),C&&([g,_]=ab(C,!0),D.addEventListener("progress",g)),S&&D.upload&&([m,y]=ab(S),D.upload.addEventListener("progress",m),D.upload.addEventListener("loadend",y)),(s.cancelToken||s.signal)&&(h=K=>{D&&(i(!K||K.type?new Rp(null,t,D):K),D.abort(),D=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const $=function(K){const J=/^([-+\w]{1,25})(:?\/\/|:)/.exec(K);return J&&J[1]||""}(s.url);$&&ea.protocols.indexOf($)===-1?i(new cn("Unsupported protocol "+$+":",cn.ERR_BAD_REQUEST,t)):D.send(c||null)})},Tfe=(t,r)=>{const{length:i}=t=t?t.filter(Boolean):[];if(r||i){let s,c=new AbortController;const u=function(y){if(!s){s=!0,m();const _=y instanceof Error?y:this.reason;c.abort(_ instanceof cn?_:new Rp(_ instanceof Error?_.message:_))}};let h=r&&setTimeout(()=>{h=null,u(new cn("timeout ".concat(r," of ms exceeded"),cn.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),t=null)};t.forEach(y=>y.addEventListener("abort",u));const{signal:g}=c;return g.unsubscribe=()=>Le.asap(m),g}},IR=d(VM),rF=Sp.f("asyncIterator"),Cfe=d(rF);function OR(t,r){this.v=t,this.k=r}function Mi(t){return function(){return new Ug(t.apply(this,arguments))}}function Ug(t){var r,i;function s(u,h){try{var m=t[u](h),g=m.value,y=g instanceof OR;IR.resolve(y?g.v:g).then(function(_){if(y){var x=u==="return"?"return":"next";if(!g.k||_.done)return s(x,_);_=t[x](_).value}c(m.done?"return":"normal",_)},function(_){s("throw",_)})}catch(_){c("throw",_)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?s(r.key,r.arg):i=null}this._invoke=function(u,h){return new IR(function(m,g){var y={key:u,arg:h,resolve:m,reject:g,next:null};i?i=i.next=y:(r=i=y,s(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function Tt(t){return new OR(t,0)}function Ap(t){var r={},i=!1;function s(c,u){return i=!0,u=new IR(function(h){h(t[c](u))}),{done:!1,value:new OR(u,1)}}return r[Np!==void 0&&P3||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):s("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return i?(i=!1,c):s("return",c)}),r}Ug.prototype[typeof Np=="function"&&Cfe||"@@asyncIterator"]=function(){return this},Ug.prototype.next=function(t){return this._invoke("next",t)},Ug.prototype.throw=function(t){return this._invoke("throw",t)},Ug.prototype.return=function(t){return this._invoke("return",t)};var sb=d(rF);function PR(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=sb,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new ob(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function ob(t){function r(i){if(Object(i)!==i)return ke.reject(new TypeError(i+" is not an object."));var s=i.done;return ke.resolve(i.value).then(function(c){return{value:c,done:s}})}return ob=function(i){this.s=i,this.n=i.next},ob.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?ke.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?ke.reject(i):r(s.apply(this.s,arguments))}},new ob(t)}const Nfe=function*(t,r){let i=t.byteLength;if(!r||i<r)return void(yield t);let s,c=0;for(;c<i;)s=c+r,yield t.slice(c,s),c=s},Rfe=function(){var t=Mi(function*(r,i){var s,c=!1,u=!1;try{for(var h,m=PR(Afe(r));c=!(h=yield Tt(m.next())).done;c=!1){const g=h.value;yield*Ap(PR(Nfe(g,i)))}}catch(g){u=!0,s=g}finally{try{c&&m.return!=null&&(yield Tt(m.return()))}finally{if(u)throw s}}});return function(r,i){return t.apply(this,arguments)}}(),Afe=function(){var t=Mi(function*(r){if(r[sb])return void(yield*Ap(PR(r)));const i=r.getReader();try{for(;;){const{done:s,value:c}=yield Tt(i.read());if(s)break;yield c}}finally{yield Tt(i.cancel())}});return function(r){return t.apply(this,arguments)}}(),iF=(t,r,i,s)=>{const c=Rfe(t,r);let u,h=0,m=g=>{u||(u=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:y,value:_}=await c.next();if(y)return m(),void g.close();let x=_.byteLength;if(i){let S=h+=x;i(S)}g.enqueue(new Uint8Array(_))}catch(y){throw m(y),y}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function aF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function sF(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aF(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):aF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const{isFunction:cb}=Le,Ife=(t=>{let{Request:r,Response:i}=t;return{Request:r,Response:i}})(Le.global),{ReadableStream:oF,TextEncoder:cF}=Le.global,lF=function(t){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return!!t(...i)}catch{return!1}},Ofe=t=>{t=Le.merge.call({skipUndefined:!0},Ife,t);const{fetch:r,Request:i,Response:s}=t,c=r?cb(r):typeof fetch=="function",u=cb(i),h=cb(s);if(!c)return!1;const m=c&&cb(oF),g=c&&(typeof cF=="function"?(y=new cF,M=>y.encode(M)):async M=>new Uint8Array(await new i(M).arrayBuffer()));var y;const _=u&&m&&lF(()=>{let M=!1;const D=new i(ea.origin,{body:new oF,method:"POST",get duplex(){return M=!0,"half"}}).headers.has("Content-Type");return M&&!D}),x=h&&m&&lF(()=>Le.isReadableStream(new s("").body)),S={stream:x&&(M=>M.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(M=>{!S[M]&&(S[M]=(D,j)=>{let $=D&&D[M];if($)return $.call(D);throw new cn("Response type '".concat(M,"' is not supported"),cn.ERR_NOT_SUPPORT,j)})});const C=async(M,D)=>{const j=Le.toFiniteNumber(M.getContentLength());return j??(async $=>$==null?0:Le.isBlob($)?$.size:Le.isSpecCompliantForm($)?(await new i(ea.origin,{method:"POST",body:$}).arrayBuffer()).byteLength:Le.isArrayBufferView($)||Le.isArrayBuffer($)?$.byteLength:(Le.isURLSearchParams($)&&($+=""),Le.isString($)?(await g($)).byteLength:void 0))(D)};return async M=>{let{url:D,method:j,data:$,signal:K,cancelToken:J,timeout:ne,onDownloadProgress:ae,onUploadProgress:Q,responseType:oe,headers:ge,withCredentials:Ee="same-origin",fetchOptions:Fe}=nF(M),ht=r||fetch;oe=oe?(oe+"").toLowerCase():"text";let ot=Tfe([K,J&&J.toAbortSignal()],ne),wt=null;const _t=ot&&ot.unsubscribe&&(()=>{ot.unsubscribe()});let qt;try{if(Q&&_&&j!=="get"&&j!=="head"&&(qt=await C(ge,$))!==0){let O,X=new i(D,{method:"POST",body:$,duplex:"half"});if(Le.isFormData($)&&(O=X.headers.get("content-type"))&&ge.setContentType(O),X.body){const[ee,Ie]=J3(qt,ab(Q3(Q)));$=iF(X.body,65536,ee,Ie)}}Le.isString(Ee)||(Ee=Ee?"include":"omit");const Nn=u&&"credentials"in i.prototype,ve=sF(sF({},Fe),{},{signal:ot,method:j.toUpperCase(),headers:ge.normalize().toJSON(),body:$,duplex:"half",credentials:Nn?Ee:void 0});wt=u&&new i(D,ve);let Pe=await(u?ht(wt,Fe):ht(D,ve));const We=x&&(oe==="stream"||oe==="response");if(x&&(ae||We&&_t)){const O={};["status","statusText","headers"].forEach(ft=>{O[ft]=Pe[ft]});const X=Le.toFiniteNumber(Pe.headers.get("content-length")),[ee,Ie]=ae&&J3(X,ab(Q3(ae),!0))||[];Pe=new s(iF(Pe.body,65536,ee,()=>{Ie&&Ie(),_t&&_t()}),O)}oe=oe||"text";let _e=await S[Le.findKey(S,oe)||"text"](Pe,M);return!We&&_t&&_t(),await new ke((O,X)=>{X3(O,X,{data:_e,headers:To.from(Pe.headers),status:Pe.status,statusText:Pe.statusText,config:M,request:wt})})}catch(Nn){throw _t&&_t(),Nn&&Nn.name==="TypeError"&&/Load failed|fetch/i.test(Nn.message)?Object.assign(new cn("Network Error",cn.ERR_NETWORK,M,wt),{cause:Nn.cause||Nn}):cn.from(Nn,Nn&&Nn.code,M,wt)}}},Pfe=new Map,dF=t=>{let r=t&&t.env||{};const{fetch:i,Request:s,Response:c}=r,u=[s,c,i];let h,m,g=u.length,y=Pfe;for(;g--;)h=u[g],m=y.get(h),m===void 0&&y.set(h,m=g?new Map:Ofe(r)),y=m;return m};dF();const DR={http:null,xhr:wfe,fetch:{get:dF}};Le.forEach(DR,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const uF=t=>"- ".concat(t),Dfe=t=>Le.isFunction(t)||t===null||t===!1;var hF={getAdapter:function(t,r){t=Le.isArray(t)?t:[t];const{length:i}=t;let s,c;const u={};for(let h=0;h<i;h++){let m;if(s=t[h],c=s,!Dfe(s)&&(c=DR[(m=String(s)).toLowerCase()],c===void 0))throw new cn("Unknown adapter '".concat(m,"'"));if(c&&(Le.isFunction(c)||(c=c.get(r))))break;u[m||"#"+h]=c}if(!c){const h=Object.entries(u).map(m=>{let[g,y]=m;return"adapter ".concat(g," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new cn("There is no suitable adapter to dispatch the request "+(i?h.length>1?`since :
`+h.map(uF).join(`
`):" "+uF(h[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:DR};function kR(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Rp(null,t)}function pF(t){return kR(t),t.headers=To.from(t.headers),t.data=RR.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),hF.getAdapter(t.adapter||CR.adapter,t)(t).then(function(r){return kR(t),r.data=RR.call(t,t.transformResponse,r),r.headers=To.from(r.headers),r},function(r){return q3(r)||(kR(t),r&&r.response&&(r.response.data=RR.call(t,t.transformResponse,r.response),r.response.headers=To.from(r.response.headers))),ke.reject(r)})}const mF="1.13.2",lb={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{lb[t]=function(i){return typeof i===t||"a"+(r<1?"n ":" ")+t}});const fF={};lb.transitional=function(t,r,i){function s(c,u){return"[Axios v"+mF+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(t===!1)throw new cn(s(u," has been removed"+(r?" in "+r:"")),cn.ERR_DEPRECATED);return r&&!fF[u]&&(fF[u]=!0,console.warn(s(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},lb.spelling=function(t){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(t)),!0)};var db={assertOptions:function(t,r,i){if(typeof t!="object")throw new cn("options must be an object",cn.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let c=s.length;for(;c-- >0;){const u=s[c],h=r[u];if(h){const m=t[u],g=m===void 0||h(m,u,t);if(g!==!0)throw new cn("option "+u+" must be "+g,cn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new cn("Unknown option "+u,cn.ERR_BAD_OPTION)}},validators:lb};const pc=db.validators;let ub=class{constructor(t){this.defaults=t||{},this.interceptors={request:new b4,response:new b4}}async request(t,r){try{return await this._request(t,r)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=wu(this.defaults,r);const{transitional:i,paramsSerializer:s,headers:c}=r;i!==void 0&&db.assertOptions(i,{silentJSONParsing:pc.transitional(pc.boolean),forcedJSONParsing:pc.transitional(pc.boolean),clarifyTimeoutError:pc.transitional(pc.boolean)},!1),s!=null&&(Le.isFunction(s)?r.paramsSerializer={serialize:s}:db.assertOptions(s,{encode:pc.function,serialize:pc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),db.assertOptions(r,{baseUrl:pc.spelling("baseURL"),withXsrfToken:pc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&Le.merge(c.common,c[r.method]);c&&Le.forEach(["delete","get","head","post","put","patch","common"],C=>{delete c[C]}),r.headers=To.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(r)===!1||(m=m&&C.synchronous,h.unshift(C.fulfilled,C.rejected))});const g=[];let y;this.interceptors.response.forEach(function(C){g.push(C.fulfilled,C.rejected)});let _,x=0;if(!m){const C=[pF.bind(this),void 0];for(C.unshift(...h),C.push(...g),_=C.length,y=ke.resolve(r);x<_;)y=y.then(C[x++],C[x++]);return y}_=h.length;let S=r;for(;x<_;){const C=h[x++],M=h[x++];try{S=C(S)}catch(D){M.call(this,D);break}}try{y=pF.call(this,S)}catch(C){return ke.reject(C)}for(x=0,_=g.length;x<_;)y=y.then(g[x++],g[x++]);return y}getUri(t){return _4(Z3((t=wu(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};Le.forEach(["delete","get","head","options"],function(t){ub.prototype[t]=function(r,i){return this.request(wu(i||{},{method:t,url:r,data:(i||{}).data}))}}),Le.forEach(["post","put","patch"],function(t){function r(i){return function(s,c,u){return this.request(wu(u||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}ub.prototype[t]=r(),ub.prototype[t+"Form"]=r(!0)});var hb=ub;class jR{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ke(function(c){i=c});const s=this;this.promise.then(c=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](c);s._listeners=null}),this.promise.then=c=>{let u;const h=new ke(m=>{s.subscribe(m),u=m}).then(c);return h.cancel=function(){s.unsubscribe(u)},h},r(function(c,u,h){s.reason||(s.reason=new Rp(c,u,h),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=s=>{r.abort(s)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new jR(function(s){r=s}),cancel:r}}}var kfe=jR;const LR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(LR).forEach(t=>{let[r,i]=t;LR[i]=r});var jfe=LR;const ii=function t(r){const i=new hb(r),s=n4(hb.prototype.request,i);return Le.extend(s,hb.prototype,i,{allOwnKeys:!0}),Le.extend(s,i,null,{allOwnKeys:!0}),s.create=function(c){return t(wu(r,c))},s}(CR);ii.Axios=hb,ii.CanceledError=Rp,ii.CancelToken=kfe,ii.isCancel=q3,ii.VERSION=mF,ii.toFormData=z_,ii.AxiosError=cn,ii.Cancel=ii.CanceledError,ii.all=function(t){return ke.all(t)},ii.spread=function(t){return function(r){return t.apply(null,r)}},ii.isAxiosError=function(t){return Le.isObject(t)&&t.isAxiosError===!0},ii.mergeConfig=wu,ii.AxiosHeaders=To,ii.formToJSON=t=>K3(Le.isHTMLForm(t)?new FormData(t):t),ii.getAdapter=hF.getAdapter,ii.HttpStatusCode=jfe,ii.default=ii;var Ui=ii;const Lfe=()=>{};function Fg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Lfe};return t.promise=new ke((r,i)=>{t.resolve=s=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(s),t.value=s)},t.reject=s=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,i(s))}}),t}const pb=new Map,mb=new Map,mc=new Map;let vr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Kt=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const gF=new vhe;let Co=gF.getResult(),MR=null;function Wt(t){if(!MR){Co=gF.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Kt.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Kt.CHROME;case"Safari":case"Mobile Safari":return Kt.SAFARI;case"Edge":return Kt.EDGE;case"Firefox":return Kt.FIREFOX;case"QQ":case"QQBrowser":return Kt.QQ;case"Opera":return Kt.OPERA;case"WeChat":return Kt.WECHAT;default:return m.browser.name||""}}(Co),i=vF(Co),s=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Co),c=Co.os.version,u=vF(Co,!1),h=Co.device.type;if(!(r&&i&&s&&c))return{name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h};MR={name:r,version:i,os:s,osVersion:c,browserVersion:u,deviceType:h}}return MR}function vF(t){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",i?r.split(".")[0]:r}function fb(){return Wt().os}function yF(){const t=Wt();return"".concat(t.os," ").concat(t.osVersion)}function gb(){const t=Wt();return!!(Co.engine.name==="WebKit"&&t.os===vr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Kt.SAFARI||ai()&&t.name!==Kt.SAFARI)}function tl(){return Wt().name===Kt.CHROME}function Nr(){return Wt().name===Kt.SAFARI}function _F(){const t=Wt();if(t.name!==Kt.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function bF(){return Wt().name===Kt.EDGE}function En(){return Wt().name===Kt.FIREFOX}function ai(){return Wt().os===vr.IOS}function No(t){const r=Wt();return!(r.name!==Kt.CHROME||!r.osVersion)&&Number(r.version)>=t}function EF(t){const r=Wt();return!(r.name!==Kt.CHROME||!r.osVersion)&&Number(r.version)<t}function UR(t,r,i){const s=Wt();return!(s.name!==t||!s.osVersion)&&(i?Number(s.version)>=r&&Number(s.version)<=i:Number(s.version)===r)}function ed(t){const r=Wt();return!(r.name!==Kt.EDGE||!r.osVersion)&&Number(r.version)>=t}function FR(t){const r=Wt();return!(r.name!==Kt.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function xF(t){const r=Wt();return!(r.name!==Kt.SAFARI||!r.osVersion)&&Number(r.version)>=t}function SF(t,r,i){const s=Wt();if(s.os!==vr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function wF(t,r,i){const s=Wt();if(s.os!==vr.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function VR(t,r,i){const s=Wt();if(s.name!==Kt.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return i?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function Tu(t){const r=Wt();return!(r.name!==Kt.OPERA||!r.osVersion)&&Number(r.version)>=t}function TF(){const t=Wt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Ip(){const t=Wt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function BR(){const t=Wt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function CF(){const t=Wt();if(t.os!==vr.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Us(){return Nr()&&navigator.maxTouchPoints>0}function NF(){return Wt().name===Kt.WECHAT}function RF(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function AF(){const t=fb();return function(){const{deviceType:r}=Wt();return r==="mobile"||r==="tablet"}()||t===vr.ANDROID||t===vr.IOS||t===vr.HARMONY_OS}function fc(){const t=Wt();return t.name!==Kt.EDGE&&t.name!==Kt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Vg(){return fb()===vr.ANDROID}function Bg(){const t=Wt();return Vg()&&(t.name===Kt.CHROME||t.name===Kt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function vt(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function IF(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Oe(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?IF(Object(i),!0).forEach(function(s){vt(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):IF(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let H=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),he=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),vt(this,"code",void 0),vt(this,"message",void 0),vt(this,"data",void 0),vt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Fs(t,r){if(typeof t!="boolean")throw new he(H.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Kn(t,r,i){if(!Re(i).call(i,t))throw new he(H.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function ln(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<i||t>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new he(H.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(s,"]. integer only"))}function GR(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new he(H.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&ln(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&ln(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&ln(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&ln(t.ideal,"".concat(r,".ideal"),1,1/0)}else ln(t,r,1,1/0)}function Mr(t,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new he(H.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!OF(t,i,s,c))throw new he(H.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function nl(t,r){if(!Array.isArray(t))throw new he(H.INVALID_PARAMS,"".concat(r," should be an array"))}function kn(t){return t==null}function OF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=i&&t.length>=r&&(!s||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}function PF(t,r,i){if("getBigUint64"in DataView.prototype)return t.getBigUint64(r,i);const s=t.getUint32(r,i),c=t.getUint32(r+4,i),u=0,h=+!i;return BigInt(s*h+c*u)<<BigInt(32)|BigInt(s*u+c*h)}function DF(t,r,i,s){if("setBigUint64"in DataView.prototype)return t.setBigUint64(r,i,s);const c=Number(i>>BigInt(32)),u=Number(i&BigInt(4294967295));t.setUint32(r,c,s),t.setUint32(r+4,u,s)}var Gg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Gg||{}),WR=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(WR||{});const kF=new class{constructor(){vt(this,"_clientSize",null),vt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),vt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),vt(this,"getStyle",t=>window.getComputedStyle(t,null)),vt(this,"checkCssVisibleProperty",t=>{var r;let i=!0;const s=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=s;return(c==="none"||Re(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(g=>{var y;const _=g.split("(")[0];return Re(y=["brightness","blur","opacity"]).call(y,_)}).map(g=>{const[y,_]=g.split(/\(|\)/);return[y,Number(_.match(/^[0-9\.]+/))]}).forEach(g=>{const[y,_]=g;switch(y){case"brightness":(_<.1||_>3)&&(i=!1);break;case"blur":_>3&&(i=!1);break;case"opacity":_<.1&&(i=!1)}}),i)}),vt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let i=!0,s=!0;const c=h=>r(h);let u=t;for(;u&&s;)c(u)||(i=!1,s=!1),u=u.parentElement,u||(s=!1);return i}),vt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),vt(this,"getSizeAboutClient",t=>{const{width:r,height:i,left:s,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:i,left:s,right:c,top:u,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),vt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(t,r,i)}),vt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),vt(this,"checkCoverForAPoint",(t,r,i)=>{const s=this.elementFromPoint(t,r);return s!==null&&s!==i}),vt(this,"getPointPositionList",()=>{const{width:t,height:r,left:i,top:s}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let y=0;y<5;y++){const _=(i*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,x=(s*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:_,y:x})}return[...h]}),vt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),vt(this,"checkSizeIsVisible",(t,r,i)=>(t>50||i/t<=10)&&(r>50||i/r<=10)),vt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:i,bottom:s,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,g,y,_;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(g=r<u?r:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(s<0)return!1;_=s<c?s:c;const x=g-m,S=_-y;return this.checkSizeIsVisible(x,S,h)}),vt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),vt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Gg.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(Gg.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Gg.SIZE)}}return this.returnHiddenResult(Gg.STYLE)}return this.returnHiddenResult(WR.UNMOUNTED)}return this.returnHiddenResult(WR.INVALID_HTML_ELEMENT)}),vt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function $R(t){return new TextEncoder().encode(t)}const jF=function(t,r){const i=new Uint8Array(t.byteLength+r.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(r),t.byteLength),i},HR=async t=>function(r,i){let s="";return new Uint8Array(r).forEach(c=>{s+=c.toString(i).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",$R(t)),16);let An=class{constructor(){vt(this,"_events",{}),vt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,r);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,s||[])}}safeEmit(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}},Wg=null;function LF(){if(Wg)return Wg;if(window.electron)return Wg=window.electron;if(!window.require)return null;try{return Wg=window.require("electron"),Wg}catch{return null}}let Tn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t.VOS_FALLBACK_CN="vosFallbackCN",t.DATACHANNEL_FAILBACK="datachannelFailback",t}({}),dn=function(t){return t.TRACER="tracer",t}({});function MF(t){return ln(t.timeout,"config.timeout",0,1e5),ln(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ln(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ln(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Mfe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Dt=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.FALLBACK_TO_HLS="FALLBACK_TO_HLS",t.UID_CONFLICT="UID_CONFLICT",t}({});function Cu(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function UF(t){return Mr(t.turnServerURL,"turnServerURL"),Mr(t.username,"username"),Mr(t.password,"password"),t.udpport&&ln(t.udpport,"udpport",1,99999,!0),t.forceturn&&Fs(t.forceturn,"forceturn"),t.security&&Fs(t.security,"security"),t.tcpport&&ln(t.tcpport,"tcpport",1,99999,!0),!0}let Op=function(t){return t[t.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",t[t.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",t[t.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",t}({});function zR(t){return t.level!==void 0&&Kn(t.level,"level",[1,2,3]),t.delay!==void 0&&ln(t.delay,"delay",0,3e3,!0),!0}let Rt=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t.FALLBACK_TO_HLS="fallback-to-hls",t.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",t.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",t.AV1_DECODABLE_RESULT="av1-decodable-result",t}({}),KR=function(t){return t.CONFIG="config",t.VOSERROR="vos_error",t.AP_ERROR="ap_error",t}({}),$r=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Ti=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Nu=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function er(t,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return t.getListeners(r).length===0?ke.reject(new he(H.UNEXPECTED_ERROR,"can not emit promise")):new ke((u,h)=>{t.emit(r,...s,u,h)})}function fn(t,r){if(t.getListeners(r).length===0)return ke.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return er(t,r,...s)}function Ea(t,r){if(t.getListeners(r).length===0)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return Ru(t,r,...s)}function Ru(t,r){let i=null,s=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{i=m},m=>{s=m}),s!==null)throw s;if(i===null)throw new he(H.UNEXPECTED_ERROR,"handler is not sync");return i}const jn=new class extends An{set networkState(t){this.emit(Nu.NETWORK_STATE_CHANGE,t,this._networkState),t===Ti.ONLINE?this.emit(Nu.ONLINE):t===Ti.OFFLINE&&(this.onlineWaiter=new ke(r=>{this.once(Nu.ONLINE,()=>{this.onlineWaiter=void 0,r(Ti.ONLINE)})}),this.emit(Nu.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ti.ONLINE}constructor(){super(),vt(this,"_moduleName","network-indicator"),vt(this,"_networkState",Ti.ONLINE),vt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ti.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ti.OFFLINE})}},Fi=[];for(let t=0;t<256;++t)Fi.push((t+256).toString(16).slice(1));const FF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let YR;const Ufe=new Uint8Array(16);function Ffe(){return FF?FF():function(i,s,c){var u,h,m,g;const y=(u=(h=(i=i||{}).random)!==null&&h!==void 0?h:(m=(g=i).rng)===null||m===void 0?void 0:m.call(g))!==null&&u!==void 0?u:function(){if(!YR){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");YR=crypto.getRandomValues.bind(crypto)}return YR(Ufe)}();if(y.length<16)throw new Error("Random bytes length must be >= 16");if(y[6]=15&y[6]|64,y[8]=63&y[8]|128,s){if((c=c||0)<0||c+16>s.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let _=0;_<16;++_)s[c+_]=y[_];return s}return function(_){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Fi[_[x+0]]+Fi[_[x+1]]+Fi[_[x+2]]+Fi[_[x+3]]+"-"+Fi[_[x+4]]+Fi[_[x+5]]+"-"+Fi[_[x+6]]+Fi[_[x+7]]+"-"+Fi[_[x+8]]+Fi[_[x+9]]+"-"+Fi[_[x+10]]+Fi[_[x+11]]+Fi[_[x+12]]+Fi[_[x+13]]+Fi[_[x+14]]+Fi[_[x+15]]).toLowerCase()}(y)}(t,r,void 0);var t,r}function vb(t,r){const i=t.indexOf(r);i!==-1&&t.splice(i,1)}function Pp(t){const r=[];return t.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function yb(t){ke!==void 0?ke.resolve().then(t):setTimeout(t,0)}function xn(t){return JSON.parse(JSON.stringify(t))}function Au(t){try{return xn(t)}catch{return t}}const VF={};function td(t,r){VF[r]||(VF[r]=!0,t())}function Iu(t){const r=window.atob(t),i=new Uint8Array(new ArrayBuffer(r.length));for(let s=0;s<r.length;s+=1)i[s]=r.charCodeAt(s);return i}function nd(t){let r="";for(let i=0;i<t.length;i+=1)r+=String.fromCharCode(t[i]);return window.btoa(r)}function BF(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(t);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const s=new Uint8Array(r);s.set(i),i=s}return i}function GF(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=ss(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(s));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function gc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function WF(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(i=>{r+=typeof i=="string"?gc(i):i.size}),r+138}function Vfe(t){const r=new he(H.TIMEOUT,"timeout");return new ke((i,s)=>{window.setTimeout(()=>s(r),t)})}function yr(t){return new ke(r=>{window.setTimeout(r,t)})}function en(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+en(t-i.length,"")}function Ou(){let t,r=!1;try{var i;t=ghe(i=Ffe()).call(i,"-","")}catch{r=!0}return!r&&t&&t.length===32||(t=en(32,"")),t.toUpperCase()}const $g=()=>{},$F=new class{constructor(){vt(this,"fnMap",new Map)}throttleByKey(t,r,i,s){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:g,args:u,skipFn:s})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,Oe(Oe({},m),{},{fn:t,args:u,skipFn:s}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:t,threshold:i,timer:m,args:u,skipFn:s})}}},HF=$F.throttleByKey.bind($F);function zF(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function qR(t,r){if(!zF(t)||!zF(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const i=[...t];for(let s=0;s<r.length;s++)i[s]=qR(t[s],r[s]);return i}{const i=Oe({},t);for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&(Object.prototype.hasOwnProperty.call(t,s)?i[s]=qR(t[s],r[s]):i[s]=r[s]);return i}}function KF(t,r){let i=[0];if(i=new Array(r).fill(0),t===0)return i;let s=0;for(;t>0&&(i[s]=255&t,t>>=8,s++,s!==r););return i}function Dp(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function XR(t,r){try{return typeof t=="object"&&typeof r=="object"&&JSON.stringify(t)===JSON.stringify(r)}catch{return!1}}function JR(t){return ss(t).call(t,(r,i)=>r+i,0)}function YF(t){const r="0123456789abcdef";function i(J){let ne,ae="";for(ne=0;ne<=3;ne++)ae+=r.charAt(J>>8*ne+4&15)+r.charAt(J>>8*ne&15);return ae}function s(J,ne){const ae=(65535&J)+(65535&ne);return(J>>16)+(ne>>16)+(ae>>16)<<16|65535&ae}function c(J,ne,ae,Q,oe,ge){return s(function(Ee,Fe){return Ee<<Fe|Ee>>>32-Fe}(s(s(ne,J),s(Q,ge)),oe),ae)}function u(J,ne,ae,Q,oe,ge,Ee){return c(ne&ae|~ne&Q,J,ne,oe,ge,Ee)}function h(J,ne,ae,Q,oe,ge,Ee){return c(ne&Q|ae&~Q,J,ne,oe,ge,Ee)}function m(J,ne,ae,Q,oe,ge,Ee){return c(ne^ae^Q,J,ne,oe,ge,Ee)}function g(J,ne,ae,Q,oe,ge,Ee){return c(ae^(ne|~Q),J,ne,oe,ge,Ee)}const y=function(J){let ne;const ae=1+(J.length+8>>6),Q=new Array(16*ae);for(ne=0;ne<16*ae;ne++)Q[ne]=0;for(ne=0;ne<J.length;ne++)Q[ne>>2]|=J.charCodeAt(ne)<<ne%4*8;return Q[ne>>2]|=128<<ne%4*8,Q[16*ae-2]=8*J.length,Q}(t);let _,x,S,C,M,D=1732584193,j=-271733879,$=-1732584194,K=271733878;for(_=0;_<y.length;_+=16)x=D,S=j,C=$,M=K,D=u(D,j,$,K,y[_+0],7,-680876936),K=u(K,D,j,$,y[_+1],12,-389564586),$=u($,K,D,j,y[_+2],17,606105819),j=u(j,$,K,D,y[_+3],22,-1044525330),D=u(D,j,$,K,y[_+4],7,-176418897),K=u(K,D,j,$,y[_+5],12,1200080426),$=u($,K,D,j,y[_+6],17,-1473231341),j=u(j,$,K,D,y[_+7],22,-45705983),D=u(D,j,$,K,y[_+8],7,1770035416),K=u(K,D,j,$,y[_+9],12,-1958414417),$=u($,K,D,j,y[_+10],17,-42063),j=u(j,$,K,D,y[_+11],22,-1990404162),D=u(D,j,$,K,y[_+12],7,1804603682),K=u(K,D,j,$,y[_+13],12,-40341101),$=u($,K,D,j,y[_+14],17,-1502002290),j=u(j,$,K,D,y[_+15],22,1236535329),D=h(D,j,$,K,y[_+1],5,-165796510),K=h(K,D,j,$,y[_+6],9,-1069501632),$=h($,K,D,j,y[_+11],14,643717713),j=h(j,$,K,D,y[_+0],20,-373897302),D=h(D,j,$,K,y[_+5],5,-701558691),K=h(K,D,j,$,y[_+10],9,38016083),$=h($,K,D,j,y[_+15],14,-660478335),j=h(j,$,K,D,y[_+4],20,-405537848),D=h(D,j,$,K,y[_+9],5,568446438),K=h(K,D,j,$,y[_+14],9,-1019803690),$=h($,K,D,j,y[_+3],14,-187363961),j=h(j,$,K,D,y[_+8],20,1163531501),D=h(D,j,$,K,y[_+13],5,-1444681467),K=h(K,D,j,$,y[_+2],9,-51403784),$=h($,K,D,j,y[_+7],14,1735328473),j=h(j,$,K,D,y[_+12],20,-1926607734),D=m(D,j,$,K,y[_+5],4,-378558),K=m(K,D,j,$,y[_+8],11,-2022574463),$=m($,K,D,j,y[_+11],16,1839030562),j=m(j,$,K,D,y[_+14],23,-35309556),D=m(D,j,$,K,y[_+1],4,-1530992060),K=m(K,D,j,$,y[_+4],11,1272893353),$=m($,K,D,j,y[_+7],16,-155497632),j=m(j,$,K,D,y[_+10],23,-1094730640),D=m(D,j,$,K,y[_+13],4,681279174),K=m(K,D,j,$,y[_+0],11,-358537222),$=m($,K,D,j,y[_+3],16,-722521979),j=m(j,$,K,D,y[_+6],23,76029189),D=m(D,j,$,K,y[_+9],4,-640364487),K=m(K,D,j,$,y[_+12],11,-421815835),$=m($,K,D,j,y[_+15],16,530742520),j=m(j,$,K,D,y[_+2],23,-995338651),D=g(D,j,$,K,y[_+0],6,-198630844),K=g(K,D,j,$,y[_+7],10,1126891415),$=g($,K,D,j,y[_+14],15,-1416354905),j=g(j,$,K,D,y[_+5],21,-57434055),D=g(D,j,$,K,y[_+12],6,1700485571),K=g(K,D,j,$,y[_+3],10,-1894986606),$=g($,K,D,j,y[_+10],15,-1051523),j=g(j,$,K,D,y[_+1],21,-2054922799),D=g(D,j,$,K,y[_+8],6,1873313359),K=g(K,D,j,$,y[_+15],10,-30611744),$=g($,K,D,j,y[_+6],15,-1560198380),j=g(j,$,K,D,y[_+13],21,1309151649),D=g(D,j,$,K,y[_+4],6,-145523070),K=g(K,D,j,$,y[_+11],10,-1120210379),$=g($,K,D,j,y[_+2],15,718787259),j=g(j,$,K,D,y[_+9],21,-343485551),D=s(D,x),j=s(j,S),$=s($,C),K=s(K,M);return i(D)+i(j)+i($)+i(K)}let Bfe=1,qF=console,Rr=class{static setLogger(t){qF=t}constructor(t,r){vt(this,"id",void 0),vt(this,"lockingPromise",ke.resolve()),vt(this,"locks",0),vt(this,"name",""),vt(this,"lockId",void 0),this.lockId=Bfe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");qF.debug("".concat(i," ").concat(s))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const i=new ke(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),s=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),s}};function kp(t,r){return function(i,s,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(s));try{for(var g=arguments.length,y=new Array(g),_=0;_<g;_++)y[_]=arguments[_];return await u.apply(this,y)}finally{m()}},c}}const Yn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function _b(t,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,i)}function Ro(t,r,i,s){const c=Object.assign({},Yn,s);let u=c.timeout;const h=async()=>{await function(y){return new ke(_=>{window.setTimeout(_,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const g=new ke(async(y,_)=>{r=r||(()=>!1),i=i||(()=>!0);for(let x=0;x<c.maxRetryCount;x+=1){if(m)return _(new he(H.OPERATION_ABORTED));try{const S=await t();if(!r(S,x)||x+1===c.maxRetryCount)return y(S);await h()}catch(S){if(!i(S,x)||x+1===c.maxRetryCount)return _(S);await h()}}});return g.cancel=()=>m=!0,g}let bb,QR=class{constructor(t){vt(this,"input",[]),vt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ss(t=this.input).call(t,(r,i)=>r+i)/this.input.length}},Eb=0,ZR=0;function eA(t,r,i,s){return new ke((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),Eb+=gc(r.data)):i&&(r.data.size?Eb+=r.data.size:r.data instanceof FormData?Eb+=WF(r.data):Eb+=gc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ui.request(r).then(h=>{typeof h.data=="string"?ZR+=gc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?ZR+=h.data.byteLength:ZR+=gc(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Ui.isCancel(h)?u(new he(H.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new he(H.NETWORK_TIMEOUT,h.message)):h.response?u(new he(H.NETWORK_RESPONSE_ERROR,h.response.status)):u(new he(H.NETWORK_ERROR,h.message))})})}async function Gfe(t,r){const i=new Blob([r.data],{type:"buffer"});return await eA(t,Oe(Oe({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XF=()=>window.isSecureContext!==void 0;function Vs(t){if(Array.isArray(t))return t.map(i=>i);if(!JF(t))return t;const r={};for(const i in t){const s=t[i];JF(s)||Array.isArray(s)?r[i]=Vs(s):r[i]=s}return r}function JF(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let tA=class{constructor(t){vt(this,"input",[]),vt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Bs={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Hg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Bs,remoteCandidate:Bs},updateInterval:0},QF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},ZF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},eV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let nA=class{constructor(t,r){vt(this,"onFirstVideoReceived",void 0),vt(this,"onFirstVideoDecoded",void 0),vt(this,"onFirstAudioReceived",void 0),vt(this,"onFirstVideoDecodedTimeout",void 0),vt(this,"onFirstAudioDecoded",void 0),vt(this,"onSelectedLocalCandidateChanged",void 0),vt(this,"onSelectedRemoteCandidateChanged",void 0),vt(this,"videoIsReady",!1),vt(this,"videoIsReady2",{}),vt(this,"pc",void 0),vt(this,"options",void 0),vt(this,"intervalTimer",void 0),vt(this,"stats",Vs(Hg)),vt(this,"isFirstVideoReceived",{}),vt(this,"isFirstVideoDecoded",{}),vt(this,"isFirstAudioReceived",{}),vt(this,"isFirstAudioDecoded",{}),vt(this,"isFirstVideoDecodedTimeout",{}),vt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ke(t=>{t({local:Oe({},Bs),remote:Oe({},Bs)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,u=0,h=0;for(const m of i)t[m].forEach((g,y)=>{if(!this.lossRateWindowStats[r-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const _=this.lossRateWindowStats[r-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,x=this.lossRateWindowStats[r-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(s+=_,u+=x):(c+=_,h+=x),Number.isNaN(_)||Number.isNaN(_)?g.packetLostRate=0:g.packetLostRate=_<=0||x<=0?0:x/(_+x)});t.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Wfe=class extends nA{constructor(){super(...arguments),vt(this,"_stats",Hg),vt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Vs(Hg);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const s=r.find(c=>c.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var i;const s=Re(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=Vs(ZF);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Vs(QF),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Oe({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Vs(tV);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Vs(eV);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ke((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{s[c]=i.stat(c)}),r.push(s)}),r}},jp=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),xb=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),rA=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Ua=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Lp=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Lp||{});function zg(t,r,i,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Lp.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[s]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[i]);if(typeof m!="number")return;const g=Number(t[s]);if(typeof g!="number")return;const y=h-g;return y?(u-m)/y*c:void 0}let nV=class extends nA{constructor(){super(...arguments),vt(this,"_stats",Hg),vt(this,"report",void 0),vt(this,"lastDecodeVideoReceiverStats",new Map),vt(this,"lastVideoFramesRecv",new Map),vt(this,"lastVideoFramesSent",new Map),vt(this,"lastVideoFramesDecode",new Map),vt(this,"lastVideoFramesOutput",new Map),vt(this,"lastVideoJBDelay",new Map),vt(this,"lastAudioJBDelay",new Map),vt(this,"mediaBytesSent",new Map),vt(this,"mediaBytesRetransmit",new Map),vt(this,"mediaBytesTargetEncode",new Map),vt(this,"lastDecodeAudioReceiverStats",new Map),vt(this,"lastAudioConcealment",new Map),vt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Vs(Hg),this.report.forEach(t=>{switch(t.type){case Ua.OUTBOUND:case Ua.INBOUND:{const r=t.mediaType||t.kind,i=!r&&"frameWidth"in t,s=!r&&!("frameWidth"in t);t.type===Ua.OUTBOUND?r==="audio"||s?this.processAudioOutboundStats(t):(r==="video"||i)&&this.processVideoOutboundStats(t):t.type===Ua.INBOUND&&(r==="audio"||s?this.processAudioInboundStats(t):(r==="video"||i)&&this.processVideoInboundStats(t));break}case Ua.TRANSPORT:{this.processTransportStats(t);const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Ua.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Oe({},Bs),remote:Oe({},Bs)};return t.forEach(i=>{let s;if(i.type===Ua.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===Ua.CANDIDATE_PAIR&&i.selected&&(s=i),s){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const u=t.get(s.localCandidateId);u&&c(r.local,u)}if(s.remoteCandidateId){const u=t.get(s.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Ua.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Ua.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Ua.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Oe({},r),Oe({},this.stats.selectedCandidatePair.localCandidate)),t.type===Ua.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Oe({},r),Oe({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(s=>s.ssrc===t.ssrc);r||(r=Vs(tV),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=zg(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Lp.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,i,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Oe({},r))}calculateAudioFreeze(t,r,i){const s=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&s!=null){const c=s.lts,u=i.timestamp,h=u-c;if(h<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=s.nonSilent+m,y=t.totalSamplesReceived-r.totalSamplesReceived;if(y<=0)return;const _=80*y/h,x=200*y/h,S=h/y;let C=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>_&&(s.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*S)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*S)),C=s.plc80+1);let M=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>x&&(s.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*S)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*S)),M=s.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:u,plc80:C,plc200:M})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Vs(QF),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.estimatedPlayoutTimestamp=t.estimatedPlayoutTimestamp;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),s=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=zg(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=zg(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Lp.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=zg(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Lp.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=zg(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Lp.kMillisecondsFromSeconds),s&&u-s.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):s?r.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Oe({},r),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);r||(r=Vs(ZF),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new tA(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const c=new tA(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const c=new tA(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-s.lastFrameCount,u=t.totalEncodeTime-s.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Ua.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(r||(r=Vs(eV),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const i=this.findRemoteStatsId(t.ssrc,Ua.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}processTransportStats(t){this._stats.transport.bytesReceived=t.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=t.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=t.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=t.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(t,r){var i;const s=Array.from(ya(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===t);return s?s.id:null}processVideoMediaSource(t,r){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,r){const i=this.report.get(t);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,r,i){var s,c,u,h;const m=r?this.report.get(r):void 0,g=(s=m==null?void 0:m.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof g!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,_=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,x=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof y=="number"&&typeof _=="number"||(y=0,_=0),x==null){const S=Date.now(),C=this.lastVideoFramesSent.get(i.ssrc);C&&S-C.lts>=800?(x=Math.round((g-C.count)/((S-C.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:S,rate:x})):C?x=C.rate:this.lastVideoFramesSent.set(i.ssrc,{count:g,lts:S,rate:0})}i.sentFrame={width:y,height:_,frameRate:Math.max(0,x)}}processVideoTrackReceiverStats(t,r,i){var s,c,u,h,m;const g=r?this.report.get(r):void 0,y=(s=g==null?void 0:g.framesReceived)!==null&&s!==void 0?s:t.framesReceived,_=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,x=(u=g==null?void 0:g.frameHeight)!==null&&u!==void 0?u:t.frameHeight,S=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,C=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof y=="number"){const M=this.lastVideoFramesRecv.get(i.ssrc),D=Date.now();i.framesReceivedCount=y;let j=0;M&&D-M.lts>=800?(j=Math.round((y-M.count)/((D-M.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:D,rate:j})):M?j=M.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:D,rate:0}),i.receivedFrame={width:_||0,height:x||0,frameRate:j||0},i.decodedFrame={width:_||0,height:x||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:_||0,height:x||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(S&&C){const M=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=M.jitterBufferMs;const j=C-M.jitterBufferEmittedCount;j>0&&(D=1e3*(S-M.jitterBufferDelay)/j),i.jitterBufferMs=D,i.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:C,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,r,i){var s,c,u,h;const m=r?this.report.get(r):void 0,g=(s=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&s!==void 0?s:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=g,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(t,r,i){var s,c,u,h,m,g,y,_,x;const S=r?this.report.get(r):void 0,C=(s=S==null?void 0:S.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,M=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,D=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,j=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,$=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,K=(g=S==null?void 0:S.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,J=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:t.concealedSamples,ne=(_=S==null?void 0:S.silentConcealedSamples)!==null&&_!==void 0?_:t.silentConcealedSamples,ae=(x=S==null?void 0:S.concealmentEvents)!==null&&x!==void 0?x:t.concealmentEvents;if(typeof M=="number"&&(i.totalSamplesReceived=M),typeof ne=="number"&&(i.silentConcealedSamples=ne),typeof ae=="number"&&(i.concealmentEvents=ae),typeof J=="number"&&(i.concealedSamples=J),C&&M&&(i.accelerateRate=C/M),D&&j){const oe=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ge=oe.jitterBufferMs;const Ee=j-oe.jitterBufferEmittedCount;Ee>0&&(ge=1e3*(D-oe.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(ge),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:j,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=$;let Q=1920;K&&M&&(Q=M/K/50,i.receivedFrames=Math.round(M/Q)),J&&(i.droppedFrames=Math.round(J/Q))}processRemoteInboundStats(t,r){const i=this.report.get(t);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const s=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},$fe=class extends nA{updateStats(){return ke.resolve()}};function Sb(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Wfe(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new nV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ke||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(m))}(t)?new nV(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new $fe(t,{updateInterval:r,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const rV="websdk_ng_install_id";function iA(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let t=window.localStorage.getItem(rV);return t||(t=Ou(),window.localStorage.setItem(rV,t)),sn("INSTALL_ID",t),t}catch{return}}const cs=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],s=r[2];return"".concat(i,".").concat(s)}return"4.0.0.999"}("4.24.2"),aA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Pu=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Hr=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=s,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Hr;const wb={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},sA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},oA="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",cA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},tn=Oe(Oe(Oe(Oe({},cA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:sA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},wb),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function sn(t,r,i){var s,c,u;Re(s=Object.keys(tn)).call(s,t)&&(!i&&Re(c=Object.keys(Fa)).call(c,t)||(tn[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(tn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,tn.USE_NEW_NETWORK_CONFIG=u,u&&(tn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],tn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],tn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],tn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],tn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",tn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",tn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(tn.ENABLE_INSTANT_VIDEO=!0,tn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(tn.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(tn.NEW_TURN_MODE||(tn.NEW_TURN_MODE=4))))}function G(t){if(t==="TURN_DOMAINS"){const r=tn.TURN_DOMAINS;return Re(r).call(r,G("TURN_DOMAIN"))?r:[G("TURN_DOMAIN")].concat(r)}return tn[t]}aA||(tn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],tn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],tn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],tn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],tn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],tn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],tn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",tn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",tn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",tn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",tn.AREAS=["NORTH_AMERICA","OVERSEA"]);let iV=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Fa={};var pt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_RTE_URL="SET_RTE_URL",t.SET_RTE_SID="SET_RTE_SID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(pt||{});let Du=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const aV=128,Hfe=96,sV=1e3,Mp=10;let zfe=0;var oV=(()=>{var t={8:(s,c,u)=>{u.r(c),u.d(c,{Parser:()=>Ee,Printer:()=>_t,parse:()=>Pe,print:()=>We});const h=`
`,m="".concat("\r").concat(h),g=" ";let y;function _(_e){return _e>="0"&&_e<="9"}function x(_e){return _e>="!"&&_e<="~"}function S(_e){return x(_e)||_e>=""&&_e<=""}function C(_e){return _e==="!"||_e>="#"&&_e<="'"||_e>="*"&&_e<="+"||_e>="-"&&_e<="."||_e>="0"&&_e<="9"||_e>="A"&&_e<="Z"||_e>="^"&&_e<="~"}function M(_e){return _e>="1"&&_e<="9"}function D(_e){return _e>="A"&&_e<="Z"||_e>="a"&&_e<="z"}function j(_e){return _e==="d"||_e==="h"||_e==="m"||_e==="s"}function $(_e){return _e>""&&_e<"	"||_e>"\v"&&_e<"\f"||_e>""&&_e<""}function K(_e){return D(_e)||_(_e)||_e==="+"||_e==="/"}function J(_e){return _(_e)||D(_e)||_e==="+"||_e==="/"||_e==="-"||_e==="_"}function ne(_e){return D(_e)||_(_e)||_e==="+"||_e==="/"}function ae(_e,O){var X=Object.keys(_e);if(Object.getOwnPropertySymbols){var ee=Object.getOwnPropertySymbols(_e);O&&(ee=ee.filter(function(Ie){return Object.getOwnPropertyDescriptor(_e,Ie).enumerable})),X.push.apply(X,ee)}return X}function Q(_e){for(var O=1;O<arguments.length;O++){var X=arguments[O]!=null?arguments[O]:{};O%2?ae(Object(X),!0).forEach(function(ee){oe(_e,ee,X[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(X)):ae(Object(X)).forEach(function(ee){Object.defineProperty(_e,ee,Object.getOwnPropertyDescriptor(X,ee))})}return _e}function oe(_e,O,X){return O in _e?Object.defineProperty(_e,O,{value:X,enumerable:!0,configurable:!0,writable:!0}):_e[O]=X,_e}(function(_e){_e.VERSION="v",_e.ORIGIN="o",_e.SESSION_NAME="s",_e.INFORMATION="i",_e.URI="u",_e.EMAIL="e",_e.PHONE="p",_e.CONNECTION="c",_e.BANDWIDTH="b",_e.TIME="t",_e.REPEAT="r",_e.ZONE_ADJUSTMENTS="z",_e.KEY="k",_e.ATTRIBUTE="a",_e.MEDIA="m"})(y||(y={}));class ge{consumeText(O,X){let ee=X;for(;ee<O.length;){const Ie=O[ee];if(Ie==="\0"||Ie==="\r"||Ie===h)break;ee+=1}if(ee-X==0)throw new Error("Invalid text, at ".concat(O));return ee}consumeUnicastAddress(O,X,ee){return this.consumeTill(O,X,g)}consumeOneOrMore(O,X,ee){let Ie=X;for(;ee(O[Ie]);)Ie++;if(Ie-X==0)throw new Error("Invalid rule at ".concat(X,"."));return Ie}consumeSpace(O,X){if(O[X]===g)return X+1;throw new Error("Invalid space at ".concat(X,"."))}consumeIP4Address(O,X){let ee=X;for(let Ie=0;Ie<4;Ie++)if(ee=this.consumeDecimalUChar(O,ee),Ie!==3){if(O[ee]!==".")throw new Error("Invalid IP4 address.");ee++}return ee}consumeDecimalUChar(O,X){let ee=X;for(let ft=0;ft<3&&_(O[ee]);ft++,ee++);if(ee-X==0)throw new Error("Invalid decimal uchar.");const Ie=parseInt(O.slice(X,ee));if(Ie>=0&&Ie<=255)return ee;throw new Error("Invalid decimal uchar")}consumeIP6Address(O,X){let ee=this.consumeHexpart(O,X);return O[ee]===":"&&(ee+=1,ee=this.consumeIP4Address(O,ee)),ee}consumeHexpart(O,X){let ee=X;if(O[ee]===":"&&O[ee+1]===":"){ee+=2;try{ee=this.consumeHexseq(O,ee)}catch{}return ee}if(ee=this.consumeHexseq(O,ee),O[ee]===":"&&O[ee+1]===":"){ee+=2;try{ee=this.consumeHexseq(O,ee)}catch{}return ee}return ee}consumeHexseq(O,X){let ee=X;for(;ee=this.consumeHex4(O,ee),O[ee]===":"&&O[ee+1]!==":";)ee+=1;return ee}consumeHex4(O,X){let ee=0;for(;ee<4;ee++)if(!((Ie=O[X+ee])>="0"&&Ie<="9"||Ie>="a"&&Ie<="f"||Ie>="A"&&Ie<="F")){if(ee===0)throw new Error("Invalid hex 4");break}var Ie;return X+ee}consumeFQDN(O,X){let ee=X;for(;_(O[ee])||D(O[ee])||O[ee]==="-"||O[ee]===".";)ee+=1;if(ee-X<4)throw new Error("Invalid FQDN");return ee}consumeExtnAddr(O,X){return this.consumeOneOrMore(O,X,S)}consumeMulticastAddress(O,X,ee){switch(ee){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(O,X);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(O,X);default:try{return this.consumeFQDN(O,X)}catch{return this.consumeExtnAddr(O,X)}}}consumeIP6MulticastAddress(O,X){const ee=this.consumeHexpart(O,X);return O[ee]==="/"?this.consumeInteger(O,ee+1):ee}consumeIP4MulticastAddress(O,X){let ee=X+3;const Ie=O.slice(X,ee),ft=parseInt(Ie);if(ft<224||ft>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let vn=0;vn<3;vn++){if(O[ee]!==".")throw new Error("Invalid IP4 multicast address.");ee+=1,ee=this.consumeDecimalUChar(O,ee)}return O[ee]==="/"&&(ee+=1),ee=this.consumeTTL(O,ee),O[ee]==="/"&&(ee=this.consumeInteger(O,ee)),ee}consumeInteger(O,X){if(!M(O[X]))throw new Error("Invalid integer.");for(X+=1;_(O[X]);)X+=1;return X}consumeTTL(O,X){if(O[X]==="0")return X+1;if(!M(O[X]))throw new Error("Invalid TTL.");X+=1;for(let ee=0;ee<2&&_(O[X]);ee++)X+=1;return X}consumeToken(O,X){return this.consumeOneOrMore(O,X,C)}consumeTime(O,X){let ee=X;if(O[ee]==="0")return ee+1;for(M(O[ee])&&(ee+=1);_(O[ee]);)ee++;if(ee-X<10)throw new Error("Invalid time");return ee}consumeAddress(O,X){return this.consumeTill(O,X,g)}consumeTypedTime(O,X){let ee=X;return ee=this.consumeOneOrMore(O,ee,_),j(O[ee])?ee+1:ee}consumeRepeatInterval(O,X){if(!M(O[X]))throw new Error("Invalid repeat interval");for(X+=1;_(O[X]);)X+=1;return j(O[X])&&(X+=1),X}consumePort(O,X){return this.consumeOneOrMore(O,X,_)}consume(O,X,ee){for(let Ie=0;Ie<ee.length;Ie++){if(X+Ie>=O.length)throw new Error("consume exceeding value length");if(O[X+Ie]!==ee[Ie])throw new Error("consume ".concat(ee," failed at ").concat(Ie))}return X+ee.length}consumeTill(O,X,ee){let Ie=X;for(;Ie<O.length&&(typeof ee!="string"||O[Ie]!==ee)&&(typeof ee!="function"||!ee(O[Ie]));)Ie++;return Ie}}class Ee extends ge{constructor(){super(),oe(this,"records",[]),oe(this,"currentLine",0)}parse(O){const X=this.probeEOL(O);this.records=O.split(X).filter(bd=>!!Si(bd).call(bd)).map(this.parseLine),this.currentLine=0;const ee=this.parseVersion(),Ie=this.parseOrigin(),ft=this.parseSessionName(),vn=this.parseInformation(),xr=this.parseUri(),vs=this.parseEmail(),_d=this.parsePhone(),VE=this.parseConnection(),fm=this.parseBandWidth(),BE=this.parseTimeFields(),rh=this.parseKey(),Iv=this.parseSessionAttribute(),ih=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ee,origin:Ie,sessionName:ft,information:vn,uri:xr,emails:vs,phones:_d,connection:VE,bandwidths:fm,timeFields:BE,key:rh,attributes:Iv,mediaDescriptions:ih}}getCurrentRecord(){const O=this.records[this.currentLine];if(!O)throw new Error("Record doesn't exit.");return O}probeEOL(O){for(let X=0;X<O.length;X++)if(O[X]===h)return O[X-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(O,X){if(O.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ee=O[0];if(O[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ee,value:O.slice(2),line:X,cur:0}}parseSessionAttribute(){const O=new ht;for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==y.ATTRIBUTE)break;const ee={attField:this.extractOneOrMore(X,Ie=>C(Ie)&&Ie!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,ee.attValue=this.extractOneOrMore(X,$)),O.parse(ee),this.currentLine++}return O.digest()}parseMediaAttributes(O){const X=new ot(O);for(;this.currentLine<this.records.length;){const ee=this.getCurrentRecord();if(ee.type!==y.ATTRIBUTE)break;const Ie={attField:this.extractOneOrMore(ee,ft=>C(ft)&&ft!==":"),_cur:0};ee.value[ee.cur]===":"&&(ee.cur+=1,Ie.attValue=this.extractOneOrMore(ee,$)),X.parse(Ie),this.currentLine++}return X.digest()}parseKey(){const O=this.getCurrentRecord();if(O.type===y.KEY){if(O.value==="prompt"||O.value==="clear:"||O.value==="base64:"||O.value==="uri:")return O.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const O=this.getCurrentRecord();if(O.type===y.ZONE_ADJUSTMENTS){const X=[];for(;;)try{const ee=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);let Ie=!1;O.value[O.cur]==="-"&&(Ie=!0,O.cur+=1);const ft=this.extract(O,this.consumeTypedTime);X.push({time:ee,typedTime:ft,back:Ie})}catch{break}if(X.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,X}return[]}parseRepeat(){const O=[];for(;;){const X=this.getCurrentRecord();if(X.type!==y.REPEAT)break;{const ee=this.extract(X,this.consumeRepeatInterval),Ie=this.parseTypedTime(X);O.push({repeatInterval:ee,typedTimes:Ie}),this.currentLine++}}return O}parseTypedTime(O){const X=[];for(;;)try{this.consumeSpaceForRecord(O),X.push(this.extract(O,this.consumeTypedTime))}catch{break}if(X.length===0)throw new Error("Invalid typed time.");return X}parseTime(){const O=this.getCurrentRecord(),X=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);const ee=this.extract(O,this.consumeTime);return this.currentLine++,{startTime:X,stopTime:ee}}parseBandWidth(){const O=[];for(;this.currentLine<this.records.length;){const X=this.getCurrentRecord();if(X.type!==y.BANDWIDTH)break;{const ee=this.extractOneOrMore(X,C);if(X.value[X.cur]!==":")throw new Error("Invalid bandwidth field.");X.cur++;const Ie=this.extractOneOrMore(X,_);O.push({bwtype:ee,bandwidth:Ie}),this.currentLine++}}return O}parseVersion(){const O=this.getCurrentRecord();if(O.type!==y.VERSION)throw new Error("first sdp record must be version");const X=O.value.slice(0,this.consumeOneOrMore(O.value,0,_));if(X.length!==O.value.length)throw new Error('invalid proto version, "v='.concat(O.value,'"'));return this.currentLine++,X}parseOrigin(){const O=this.getCurrentRecord();if(O.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const X=this.extractOneOrMore(O,S);this.consumeSpaceForRecord(O);const ee=this.extractOneOrMore(O,_);this.consumeSpaceForRecord(O);const Ie=this.extractOneOrMore(O,_);this.consumeSpaceForRecord(O);const ft=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const vn=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const xr=this.extract(O,this.consumeUnicastAddress);return this.currentLine++,{username:X,sessId:ee,sessVersion:Ie,nettype:ft,addrtype:vn,unicastAddress:xr}}parseSessionName(){const O=this.getCurrentRecord();if(O.type===y.SESSION_NAME){const X=this.extract(O,this.consumeText);return this.currentLine++,X}}parseInformation(){const O=this.getCurrentRecord();if(O.type!==y.INFORMATION)return;const X=this.extract(O,this.consumeText);return this.currentLine++,X}parseUri(){const O=this.getCurrentRecord();if(O.type===y.URI)return this.currentLine++,O.value}parseEmail(){const O=[];for(;;){const X=this.getCurrentRecord();if(X.type!==y.EMAIL)break;O.push(X.value),this.currentLine++}return O}parsePhone(){const O=[];for(;;){const X=this.getCurrentRecord();if(X.type!==y.PHONE)break;O.push(X.value),this.currentLine++}return O}parseConnection(){const O=this.getCurrentRecord();if(O.type===y.CONNECTION){const X=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const ee=this.extractOneOrMore(O,C);this.consumeSpaceForRecord(O);const Ie=this.extract(O,this.consumeAddress);return this.currentLine++,{nettype:X,addrtype:ee,address:Ie}}}parseMedia(){const O=this.getCurrentRecord(),X=this.extract(O,this.consumeToken);this.consumeSpaceForRecord(O);let ee=this.extract(O,this.consumePort);O.value[O.cur]==="/"&&(O.cur+=1,ee+=this.extract(O,this.consumeInteger)),this.consumeSpaceForRecord(O);const Ie=[];for(Ie.push(this.extract(O,this.consumeToken));O.value[O.cur]==="/";)O.cur+=1,Ie.push(this.extract(O,this.consumeToken));if(Ie.length===0)throw new Error("Invalid proto");const ft=this.parseFmt(O);return this.currentLine++,{mediaType:X,port:ee,protos:Ie,fmts:ft}}parseTimeFields(){const O=[];for(;this.getCurrentRecord().type===y.TIME;){const X=this.parseTime(),ee=this.parseRepeat(),Ie=this.parseZone();O.push({time:X,repeats:ee,zones:Ie})}return O}parseMediaDescription(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const X=this.parseMedia(),ee=this.parseInformation(),Ie=this.parseConnections(),ft=this.parseBandWidth(),vn=this.parseKey(),xr=this.parseMediaAttributes(X);O.push({media:X,information:ee,connections:Ie,bandwidths:ft,key:vn,attributes:xr})}return O}parseConnections(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)O.push(this.parseConnection());return O}parseFmt(O){const X=[];for(;;)try{this.consumeSpaceForRecord(O),X.push(this.extract(O,this.consumeToken))}catch{break}if(X.length===0)throw new Error("Invalid fmts");return X}extract(O,X){for(var ee=arguments.length,Ie=new Array(ee>2?ee-2:0),ft=2;ft<ee;ft++)Ie[ft-2]=arguments[ft];const vn=X.call(this,O.value,O.cur,...Ie),xr=O.value.slice(O.cur,vn);return O.cur=vn,xr}extractOneOrMore(O,X){const ee=this.consumeOneOrMore(O.value,O.cur,X),Ie=O.value.slice(O.cur,ee);return O.cur=ee,Ie}consumeSpaceForRecord(O){if(O.value[O.cur]!==g)throw new Error("Invalid space at ".concat(O.cur,"."));O.cur+=1}}class Fe extends ge{constructor(){super(...arguments),oe(this,"attributes",void 0),oe(this,"digested",!1)}extractOneOrMore(O,X,ee){const Ie=this.consumeOneOrMore(O.attValue,O._cur,X),ft=O.attValue.slice(O._cur,Ie),[vn,xr]=ee||[];if(typeof vn=="number"&&ft.length<vn)throw new Error("error in length, should be more or equal than ".concat(vn," characters."));if(typeof xr=="number"&&ft.length>xr)throw new Error("error in length, should be less or equal than ".concat(xr," characters."));return O._cur=Ie,ft}consumeAttributeSpace(O){if(O.attValue[O._cur]!==g)throw new Error("Invalid space at ".concat(O._cur,"."));O._cur+=1}extract(O,X){if(!O.attValue)throw new Error("Nothing to extract from attValue.");for(var ee=arguments.length,Ie=new Array(ee>2?ee-2:0),ft=2;ft<ee;ft++)Ie[ft-2]=arguments[ft];const vn=X.call(this,O.attValue,O._cur,...Ie),xr=O.attValue.slice(O._cur,vn);return O._cur=vn,xr}atEnd(O){if(!O.attValue)throw new Error;return O._cur>=O.attValue.length}peekChar(O){if(!O.attValue)throw new Error;return O.attValue[O._cur]}peek(O,X){if(!O.attValue)throw new Error;for(let ee=0;ee<X.length;ee++)if(X[ee]!==O.attValue[O._cur+ee])return!1;return!0}parseIceUfrag(O){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(O,K,[4,256])}parseIcePwd(O){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(O,K,[22,256])}parseIceOptions(O){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const X=[];for(;!this.atEnd(O);){X.push(this.extractOneOrMore(O,K));try{this.consumeAttributeSpace(O)}catch(ee){if(this.atEnd(O))break;throw ee}}this.attributes.iceOptions=X}parseFingerprint(O){const X=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill);this.attributes.fingerprints.push({hashFunction:X,fingerprint:ee})}parseExtmap(O){const X=this.extractOneOrMore(O,_);let ee;this.peekChar(O)==="/"&&(this.extract(O,this.consume,"/"),ee=this.extract(O,this.consumeToken)),this.consumeAttributeSpace(O);const Ie=this.extract(O,this.consumeTill,g),ft=Q(Q({entry:parseInt(X,10)},ee&&{direction:ee}),{},{extensionName:Ie});this.peekChar(O)===g&&(this.consumeAttributeSpace(O),ft.extensionAttributes=this.extract(O,this.consumeTill)),this.attributes.extmaps.push(ft)}parseSetup(O){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const X=this.extract(O,this.consumeTill);if(X!=="active"&&X!=="passive"&&X!=="actpass"&&X!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=X}}class ht extends Fe{constructor(){super(...arguments),oe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"group":this.parseGroup(O);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"fingerprint":this.parseFingerprint(O);break;case"setup":this.parseSetup(O);break;case"tls-id":this.parseTlsId(O);break;case"identity":this.parseIdentity(O);break;case"extmap":this.parseExtmap(O);break;case"msid-semantic":this.parseMsidSemantic(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(X){throw console.error("parsing session attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),X}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(O){const X=this.extract(O,this.consumeToken),ee=[];for(;!this.atEnd(O)&&this.peekChar(O)===g;)this.consumeAttributeSpace(O),ee.push(this.extract(O,this.consumeToken));this.attributes.groups.push({semantic:X,identificationTag:ee})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(O){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(O,J)}parseIdentity(O){const X=this.extractOneOrMore(O,ne),ee=[];for(;!this.atEnd(O)&&this.peekChar(O)===g;){this.consumeAttributeSpace(O);const Ie=this.extract(O,this.consumeToken);this.extract(O,this.consume,"=");const ft=this.extractOneOrMore(O,vn=>vn!==g&&$(vn));ee.push({name:Ie,value:ft})}this.attributes.identities.push({assertionValue:X,extensions:ee})}parseMsidSemantic(O){this.peekChar(O)===g&&this.consumeAttributeSpace(O);const X={semantic:this.extract(O,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(O)}catch{break}if(this.peekChar(O)==="*"){this.extract(O,this.consume,"*"),X.applyForAll=!0;break}{const ee=this.extract(O,this.consumeTill,g);X.identifierList.push(ee)}}this.attributes.msidSemantic=X}}class ot extends Fe{constructor(O){super(),oe(this,"attributes",void 0),O.protos.indexOf("RTP")!==-1||O.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"extmap":this.parseExtmap(O);break;case"setup":this.parseSetup(O);break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"candidate":this.parseCandidate(O);break;case"remote-candidate":this.parseRemoteCandidate(O);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(O);break;case"rtpmap":this.parseRtpmap(O);break;case"ptime":this.parsePtime(O);break;case"maxptime":this.parseMaxPtime(O);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(O);break;case"ssrc":this.parseSSRC(O);break;case"fmtp":this.parseFmtp(O);break;case"rtcp-fb":this.parseRtcpFb(O);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(O);break;case"mid":this.parseMid(O);break;case"msid":this.parseMsid(O);break;case"imageattr":this.parseImageAttr(O);break;case"rid":this.parseRid(O);break;case"simulcast":this.parseSimulcast(O);break;case"sctp-port":this.parseSctpPort(O);break;case"max-message-size":this.parseMaxMessageSize(O);break;case"ssrc-group":this.parseSSRCGroup(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(X){throw console.error("parsing media attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),X}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}parseCandidate(O){const X=this.extractOneOrMore(O,K,[1,32]);this.consumeAttributeSpace(O);const ee=this.extractOneOrMore(O,_,[1,5]);this.consumeAttributeSpace(O);const Ie=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ft=this.extractOneOrMore(O,_,[1,10]);this.consumeAttributeSpace(O);const vn=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const xr=this.extract(O,this.consumePort);this.consumeAttributeSpace(O),this.extract(O,this.consume,"typ"),this.consumeAttributeSpace(O);const vs={foundation:X,componentId:ee,transport:Ie,priority:ft,connectionAddress:vn,port:xr,type:this.extract(O,this.consumeToken),extension:{}};for(this.peek(O," raddr")&&(this.extract(O,this.consume," raddr"),this.consumeAttributeSpace(O),vs.relAddr=this.extract(O,this.consumeAddress)),this.peek(O," rport")&&(this.extract(O,this.consume," rport"),this.consumeAttributeSpace(O),vs.relPort=this.extract(O,this.consumePort));this.peekChar(O)===g;){this.consumeAttributeSpace(O);const _d=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O),vs.extension[_d]=this.extractOneOrMore(O,x)}this.attributes.candidates.push(vs)}parseRemoteCandidate(O){const X=[];for(;;){const ee=this.extractOneOrMore(O,_,[1,5]);this.consumeAttributeSpace(O);const Ie=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const ft=this.extract(O,this.consumePort);X.push({componentId:ee,connectionAddress:Ie,port:ft});try{this.consumeAttributeSpace(O)}catch{break}}this.attributes.remoteCandidatesList.push(X)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(O){const X=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,"/");this.extract(O,this.consume,"/");const Ie={encodingName:ee,clockRate:this.extractOneOrMore(O,_)};this.atEnd(O)||this.peekChar(O)!=="/"||(this.extract(O,this.consume,"/"),Ie.encodingParameters=parseInt(this.extract(O,this.consumeTill),10));const ft=this.attributes.payloads.find(vn=>vn.payloadType===parseInt(X,10));ft?ft.rtpMap=Ie:this.attributes.payloads.push({payloadType:parseInt(X,10),rtpMap:Ie,rtcpFeedbacks:[]})}parsePtime(O){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(O,this.consumeTill)}parseMaxPtime(O){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(O,this.consumeTill)}parseDirection(O){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=O.attField}parseSSRC(O){const X=this.extractOneOrMore(O,_);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,":");let Ie;this.peekChar(O)===":"&&(this.extract(O,this.consume,":"),Ie=this.extract(O,this.consumeTill));const ft=this.attributes.ssrcs.find(vn=>vn.ssrcId===parseInt(X,10));ft?ft.attributes[ee]=Ie:this.attributes.ssrcs.push({ssrcId:parseInt(X,10),attributes:{[ee]:Ie}})}parseFmtp(O){const X=this.extract(O,this.consumeTill,g);this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill),Ie={};ee.split(";").forEach(vn=>{let[xr,vs]=vn.split("=");xr=Si(xr).call(xr);const _d=typeof vs=="string"?Si(vs).call(vs):null;typeof xr=="string"&&xr.length>0&&(Ie[xr]=_d)});const ft=this.attributes.payloads.find(vn=>vn.payloadType===parseInt(X,10));ft?ft.fmtp={parameters:Ie}:this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[],fmtp:{parameters:Ie}})}parseFmtParameters(O){const X={},ee=this.extract(O,this.consumeTill,"=");O._cur++;const Ie=this.extract(O,this.consumeTill,";");for(X[ee]=Ie;O.attValue[O._cur]===";";){const ft=this.extract(O,this.consumeTill,"=");O._cur++;const vn=this.extract(O,this.consumeTill,";");X[ft]=vn}return X}parseRtcpFb(O){let X="";X=this.peekChar(O)==="*"?this.extract(O,this.consume,"*"):this.extract(O,this.consumeTill,g),this.consumeAttributeSpace(O);const ee=this.extract(O,this.consumeTill,g);let Ie;if(ee==="trr-int")Ie={type:ee,interval:this.extract(O,this.consumeTill)};else{const ft={type:ee};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),ft.parameter=this.extract(O,this.consumeToken),this.peekChar(O)===g&&(ft.additional=this.extract(O,this.consumeTill))),Ie=ft}if(X==="*")this.attributes.rtcpFeedbackWildcards.push(Ie);else{const ft=this.attributes.payloads.find(vn=>vn.payloadType===parseInt(X,10));ft?ft.rtcpFeedbacks.push(Ie):this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[Ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(O){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const X={port:this.extract(O,this.consumePort)};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),X.netType=this.extractOneOrMore(O,C),this.consumeAttributeSpace(O),X.addressType=this.extractOneOrMore(O,C),this.consumeAttributeSpace(O),X.address=this.extract(O,this.consumeAddress)),this.attributes.rtcp=X}parseMsid(O){const X={id:this.extractOneOrMore(O,C,[1,64])};this.peekChar(O)===g&&(this.consumeAttributeSpace(O),X.appdata=this.extractOneOrMore(O,C,[1,64])),this.attributes.msids.push(X)}parseImageAttr(O){this.attributes.imageattr.push(O.attValue)}parseRid(O){const X=this.extractOneOrMore(O,Ie=>D(Ie)||_(Ie)||Ie==="_"||Ie==="-");this.consumeAttributeSpace(O);const ee={id:X,direction:this.extract(O,this.consumeToken),params:[]};if(this.peekChar(O)===g){if(this.consumeAttributeSpace(O),this.peek(O,"pt=")){this.extract(O,this.consume,"pt=");const Ie=[];for(;;){const ft=this.extract(O,this.consumeToken);Ie.push(ft);try{this.extract(O,this.consume,",")}catch{break}}ee.payloads=Ie,this.peekChar(O)===g&&this.extract(O,this.consume,g)}for(;;){const Ie=this.extract(O,this.consumeToken);switch(Ie){case"depend":{const ft={type:Ie,rids:this.extract(O,this.consume,"=").split(",")};ee.params.push(ft);break}default:{const ft={type:Ie};this.peekChar(O)==="="&&(this.extract(O,this.consume,"="),ft.val=this.extract(O,this.consumeTill,";")),ee.params.push(ft)}}try{this.extract(O,this.consume,";")}catch{break}}}this.attributes.rids.push(ee)}parseSimulcast(O){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=O.attValue,this.extract(O,this.consumeTill)}parseSctpPort(O){this.attributes.sctpPort=this.extractOneOrMore(O,_,[1,5])}parseMaxMessageSize(O){this.attributes.maxMessageSize=this.extractOneOrMore(O,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(O){this.attributes.mid=this.extract(O,this.consumeToken)}parseSSRCGroup(O){const X=this.extract(O,this.consumeToken),ee=[];for(;;)try{this.consumeAttributeSpace(O);const Ie=this.extract(O,this.consumeInteger);ee.push(parseInt(Ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:X,ssrcIds:ee})}}function wt(_e,O,X){return O in _e?Object.defineProperty(_e,O,{value:X,enumerable:!0,configurable:!0,writable:!0}):_e[O]=X,_e}class _t{constructor(){wt(this,"eol",m)}print(O,X){let ee="";return X&&(this.eol=X),ee+=this.printVersion(O.version),ee+=this.printOrigin(O.origin),ee+=this.printSessionName(O.sessionName),ee+=this.printInformation(O.information),ee+=this.printUri(O.uri),ee+=this.printEmail(O.emails),ee+=this.printPhone(O.phones),ee+=this.printConnection(O.connection),ee+=this.printBandwidth(O.bandwidths),ee+=this.printTimeFields(O.timeFields),ee+=this.printKey(O.key),ee+=this.printSessionAttributes(O.attributes),ee+=this.printMediaDescription(O.mediaDescriptions),ee}printVersion(O){return"v=".concat(O).concat(this.eol)}printOrigin(O){return"o=".concat(O.username," ").concat(O.sessId," ").concat(O.sessVersion," ").concat(O.nettype," ").concat(O.addrtype," ").concat(O.unicastAddress).concat(this.eol)}printSessionName(O){return O?"s=".concat(O).concat(this.eol):""}printInformation(O){return O?"i=".concat(O).concat(this.eol):""}printUri(O){return O?"u=".concat(O).concat(this.eol):""}printEmail(O){let X="";for(const ee of O)X+="e=".concat(ee).concat(this.eol);return X}printPhone(O){let X="";for(const ee of O)X+="e=".concat(ee).concat(this.eol);return X}printConnection(O){return O?"c=".concat(O.nettype," ").concat(O.addrtype," ").concat(O.address).concat(this.eol):""}printBandwidth(O){let X="";for(const ee of O)X+="b=".concat(ee.bwtype,":").concat(ee.bandwidth).concat(this.eol);return X}printTimeFields(O){let X="";for(const ee of O){X+="t=".concat(ee.time.startTime," ").concat(ee.time.startTime).concat(this.eol);for(const Ie of ee.repeats)X+="r=".concat(Ie.repeatInterval," ").concat(Ie.typedTimes.join(" ")).concat(this.eol);ee.zoneAdjustments&&(X+="z=",X+="z=".concat(ee.zoneAdjustments.map(Ie=>"".concat(Ie.time," ").concat(Ie.back?"-":""," ").concat(Ie.typedTime)).join(" ")).concat(this.eol),X+=this.eol)}return X}printKey(O){return O?"k=".concat(O).concat(this.eol):""}printAttributes(O){let X="";for(const ee of O)X+="a=".concat(ee.attField).concat(ee.attValue?":".concat(ee.attValue):"").concat(this.eol);return X}printMediaDescription(O){let X="";for(const ee of O)X+=this.printMedia(ee.media),X+=this.printInformation(ee.information),X+=this.printConnections(ee.connections),X+=this.printBandwidth(ee.bandwidths),X+=this.printKey(ee.key),X+=this.printMediaAttributes(ee);return X}printConnections(O){let X="";for(const ee of O)X+=this.printConnection(ee);return X}printMedia(O){return"m=".concat(O.mediaType," ").concat(O.port," ").concat(O.protos.join("/")," ").concat(O.fmts.join(" ")).concat(this.eol)}printSessionAttributes(O){return new Nn(this.eol).print(O)}printMediaAttributes(O){return new ve(this.eol).print(O)}}class qt{constructor(O){wt(this,"eol",void 0),this.eol=O}printIceUfrag(O){return O===void 0?"":"a=ice-ufrag:".concat(O).concat(this.eol)}printIcePwd(O){return O===void 0?"":"a=ice-pwd:".concat(O).concat(this.eol)}printIceOptions(O){return O===void 0?"":"a=ice-options:".concat(O.join(g)).concat(this.eol)}printFingerprints(O){return O.length>0?O.map(X=>"a=fingerprint:".concat(X.hashFunction).concat(g).concat(X.fingerprint)).join(this.eol)+this.eol:""}printExtmap(O){return O.map(X=>"a=extmap:".concat(X.entry).concat(X.direction?"/".concat(X.direction):"").concat(g).concat(X.extensionName).concat(X.extensionAttributes?"".concat(g).concat(X.extensionAttributes):"").concat(this.eol)).join("")}printSetup(O){return O===void 0?"":"a=setup:".concat(O).concat(this.eol)}printUnrecognized(O){return O.map(X=>"a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol)).join("")}}class Nn extends qt{print(O){let X="";return X+=this.printGroups(O.groups),X+=this.printMsidSemantic(O.msidSemantic),X+=this.printIceLite(O.iceLite),X+=this.printIceUfrag(O.iceUfrag),X+=this.printIcePwd(O.icePwd),X+=this.printIceOptions(O.iceOptions),X+=this.printFingerprints(O.fingerprints),X+=this.printSetup(O.setup),X+=this.printTlsId(O.tlsId),X+=this.printIdentity(O.identities),X+=this.printExtmap(O.extmaps),X+=this.printUnrecognized(O.unrecognized),X}printGroups(O){let X="";return O.length>0&&(X+=O.map(ee=>"a=group:".concat(ee.semantic).concat(ee.identificationTag.map(Ie=>"".concat(g).concat(Ie)).join("")).concat(this.eol)).join("")),X}printIceLite(O){return O===void 0?"":"a=ice-lite"+this.eol}printTlsId(O){return O?"a=tls-id:".concat(O).concat(this.eol):""}printIdentity(O){return O.length===0?"":O.map(X=>"a=identity:".concat(X.assertionValue).concat(X.extensions.map(ee=>"".concat(g).concat(ee.name).concat(ee.value?"=".concat(ee.value):"")))).join(this.eol)+this.eol}printMsidSemantic(O){if(!O)return"";let X="a=msid-semantic:".concat(O.semantic);return O.applyForAll?X+="".concat(g,"*"):O.identifierList.length>0&&(X+=O.identifierList.map(ee=>"".concat(g).concat(ee))),X+this.eol}}class ve extends qt{print(O){const X=O.attributes;let ee="";return ee+=this.printRTCP(X.rtcp),ee+=this.printIceUfrag(X.iceUfrag),ee+=this.printIcePwd(X.icePwd),ee+=this.printIceOptions(X.iceOptions),ee+=this.printCandidates(X.candidates),ee+=this.printRemoteCandidatesList(X.remoteCandidatesList),ee+=this.printEndOfCandidates(X.endOfCandidates),ee+=this.printFingerprints(X.fingerprints),ee+=this.printSetup(X.setup),ee+=this.printMid(X.mid),ee+=this.printExtmap(X.extmaps),ee+=this.printRTPRelated(X),ee+=this.printPtime(X.ptime),ee+=this.printMaxPtime(X.maxPtime),ee+=this.printDirection(X.direction),ee+=this.printSSRCGroups(X.ssrcGroups),ee+=this.printSSRC(X.ssrcs),ee+=this.printRTCPMux(X.rtcpMux),ee+=this.printRTCPMuxOnly(X.rtcpMuxOnly),ee+=this.printRTCPRsize(X.rtcpRsize),ee+=this.printMSId(X.msids),ee+=this.printImageattr(X.imageattr),ee+=this.printRid(X.rids),ee+=this.printSimulcast(X.simulcast),ee+=this.printSCTPPort(X.sctpPort),ee+=this.printMaxMessageSize(X.maxMessageSize),ee+=this.printUnrecognized(X.unrecognized),ee}printCandidates(O){return O.map(X=>"a=candidate:".concat(X.foundation).concat(g).concat(X.componentId).concat(g).concat(X.transport).concat(g).concat(X.priority).concat(g).concat(X.connectionAddress).concat(g).concat(X.port).concat(g,"typ").concat(g).concat(X.type).concat(X.relAddr?"".concat(g,"raddr").concat(g).concat(X.relAddr):"").concat(X.relPort?"".concat(g,"rport").concat(g).concat(X.relPort):"").concat(Object.keys(X.extension).map(ee=>"".concat(g).concat(ee).concat(g).concat(X.extension[ee])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(O){return O.map(X=>"a=remote-candidates:".concat(X.join(g)).concat(this.eol)).join("")}printEndOfCandidates(O){return O===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(O){if(!O.payloads)return"";const X=O.payloads;let ee="";ee+=O.rtcpFeedbackWildcards.map(Ie=>this.printRTCPFeedback("*",Ie)).join("");for(const Ie of X)ee+=this.printRtpMap(Ie.payloadType,Ie.rtpMap),ee+=this.printFmtp(Ie.payloadType,Ie.fmtp),ee+=Ie.rtcpFeedbacks.map(ft=>this.printRTCPFeedback(Ie.payloadType,ft)).join("");return ee}printFmtp(O,X){if(!X)return"";const ee=Object.keys(X.parameters);return ee.length===1&&X.parameters[ee[0]]===null?"a=fmtp:".concat(O).concat(g).concat(ee[0]).concat(this.eol):"a=fmtp:".concat(O).concat(g).concat(Object.keys(X.parameters).map(Ie=>"".concat(Ie,"=").concat(X.parameters[Ie])).join(";")).concat(this.eol)}printRtpMap(O,X){return X?"a=rtpmap:".concat(O).concat(g).concat(X.encodingName,"/").concat(X.clockRate).concat(X.encodingParameters?"/".concat(X.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(O,X){let ee="a=rtcp-fb:".concat(O).concat(g),Ie=X;return Ie.type==="trr-int"?ee+="ttr-int".concat(g).concat(Ie.interval):(ee+="".concat(Ie.type),Ie.parameter&&(ee+="".concat(g).concat(Ie.parameter),Ie.additional&&(ee+="".concat(g).concat(Ie.additional)))),ee+this.eol}printPtime(O){return O===void 0?"":"a=ptime:".concat(O).concat(this.eol)}printMaxPtime(O){return O===void 0?"":"a=maxptime:".concat(O).concat(this.eol)}printDirection(O){return O===void 0?"":"a=".concat(O).concat(this.eol)}printSSRC(O){return O.map(X=>Object.keys(X.attributes).map(ee=>"a=ssrc:".concat(X.ssrcId.toString(10)).concat(g).concat(ee).concat(X.attributes[ee]?":".concat(X.attributes[ee]):"").concat(this.eol)).join("")).join("")}printRTCPMux(O){return O===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(O){return O===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(O){return O===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(O){if(O===void 0)return"";let X="a=rtcp:".concat(O.port);return O.netType&&(X+="".concat(g).concat(O.netType)),O.addressType&&(X+="".concat(g).concat(O.addressType)),O.address&&(X+="".concat(g).concat(O.address)),X+this.eol}printMSId(O){return O.map(X=>"a=msid:".concat(X.id).concat(X.appdata?"".concat(g).concat(X.appdata):"").concat(this.eol)).join("")}printImageattr(O){return O.map(X=>"a=imageattr:".concat(X).concat(this.eol)).join("")}printRid(O){return O.map(X=>{let ee="a=rid:".concat(X.id).concat(g).concat(X.direction);return X.payloads&&(ee+="".concat(g,"pt=").concat(X.payloads.join(","))),X.params.length>0&&(ee+="".concat(g).concat(X.params.map(Ie=>Ie.type==="depend"?"depend=".concat(Ie.rids.join(",")):"".concat(Ie.type,"=").concat(Ie.val)).join(";"))),ee+this.eol}).join("")}printSimulcast(O){return O===void 0?"":"a=simulcast:".concat(O).concat(this.eol)}printSCTPPort(O){return O===void 0?"":"a=sctp-port:".concat(O).concat(this.eol)}printMaxMessageSize(O){return O===void 0?"":"a=max-message-size:".concat(O).concat(this.eol)}printMid(O){return O===void 0?"":"a=mid:".concat(O).concat(this.eol)}printSSRCGroups(O){return O.map(X=>"a=ssrc-group:".concat(X.semantic).concat(X.ssrcIds.map(ee=>"".concat(g).concat(ee.toString(10))).join("")).concat(this.eol)).join("")}}function Pe(_e){return new Ee().parse(_e)}function We(_e,O){return new _t().print(_e,O)}}},r={};function i(s){if(r[s])return r[s].exports;var c=r[s]={exports:{}};return t[s](c,c.exports,i),c.exports}return i.d=(s,c)=>{for(var u in c)i.o(c,u)&&!i.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:c[u]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i(8)})();function Ci(t){return oV.parse(t)}function rl(t,r){return oV.print(t,r)}var Kfe=as("Array","keys"),Yfe=Hl,qfe=ri,Xfe=N,Jfe=Kfe,lA=Array.prototype,Qfe={DOMTokenList:!0,NodeList:!0},Zfe=function(t){var r=t.keys;return t===lA||Xfe(lA,t)&&r===lA.keys||qfe(Qfe,Yfe(t))?Jfe:r},si=d(Zfe);function Ln(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function cV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function xt(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cV(Object(i),!0).forEach(function(s){Ln(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):cV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function Tb(t,r){return Tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,s){return i.__proto__=s,i},Tb(t,r)}function dA(){dA=function(c,u){return new i(c,void 0,u)};var t=RegExp.prototype,r=new WeakMap;function i(c,u,h){var m=RegExp(c,u);return r.set(m,h||r.get(c)),Tb(m,i.prototype)}function s(c,u){var h,m=r.get(u);return ss(h=Object.keys(m)).call(h,function(g,y){var _=m[y];if(typeof _=="number")g[y]=c[_];else{for(var x=0;c[_[x]]===void 0&&x+1<_.length;)x++;g[y]=c[_[x]]}return g},Object.create(null))}return function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),u&&Tb(c,u)}(i,RegExp),i.prototype.exec=function(c){var u=t.exec.call(this,c);if(u){u.groups=s(u,this);var h=u.indices;h&&(h.groups=s(h,this))}return u},i.prototype[Symbol.replace]=function(c,u){if(typeof u=="string"){var h=r.get(this);return t[Symbol.replace].call(this,c,u.replace(/\$<([^>]+)(>|$)/g,function(g,y,_){if(_==="")return g;var x=h[y];return Array.isArray(x)?"$"+x.join("$"):typeof x=="number"?"$"+x:""}))}if(typeof u=="function"){var m=this;return t[Symbol.replace].call(this,c,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(s(g,m)),u.apply(this,g)})}return t[Symbol.replace].call(this,c,u)},dA.apply(this,arguments)}const lV=new class extends An{constructor(){super(...arguments),Ln(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class ege{constructor(r){Ln(this,"logger",void 0),Ln(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function uA(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function dV(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const ls={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Cb=Date.now(),Kg=t=>{for(const r in ls)if(Object.prototype.hasOwnProperty.call(ls,r)&&ls[r]===t)return r;return"DEFAULT"},R=new class{constructor(){Ln(this,"proxyServerURL",void 0),Ln(this,"logLevel",ls.DEBUG),Ln(this,"uploadState","collecting"),Ln(this,"uploadLogWaitingList",[]),Ln(this,"uploadLogUploadingList",[]),Ln(this,"uploadErrorCount",0),Ln(this,"currentLogID",0),Ln(this,"url",void 0),Ln(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.DEBUG].concat(r);this.log.apply(this,s)}info(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.INFO].concat(r);this.log.apply(this,s)}warning(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.WARNING].concat(r);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.ERROR].concat(r);this.log.apply(this,s)}upload(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=[ls.DEBUG].concat(r);this.uploadLog.apply(this,s)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){sn("UPLOAD_LOG",!0)}disableLogUpload(){sn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new ege(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Cb<100)return void setTimeout(()=>{this.log(...r)},Date.now()-Cb);const s=Math.max(0,Math.min(4,r[0]));if(r[0]=uA()+" Agora-SDK [".concat(Kg(s),"]:"),this.appendLogToWaitingList(s,...r),s<this.logLevel)return;const c=uA()+" %cAgora-SDK [".concat(Kg(s),"]:");let u=[];if(!G("USE_NEW_LOG"))switch(s){case ls.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case ls.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case ls.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case ls.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-Cb<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-Cb);const s=Math.max(0,Math.min(4,r[0]));r[0]=uA()+" Agora-SDK [".concat(Kg(s),"]:"),this.appendLogToWaitingList(s,...r)}appendLogToWaitingList(t){if(!G("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=dV()+" Agora-SDK [".concat(Kg(t),"]:"):i[0]=dV()+" Agora-SDK [".concat(Kg(t),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:cs,process_id:G("PROCESS_ID"),payload:JSON.stringify(t)};return Ro(async()=>{const i=await Ui.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=i,s}},()=>(this.uploadLogUploadingList=[],!1),i=>{const s={status:-1,message:i.message,errorRange:t.map(c=>c.log_item_id)};return i.response?(s.status=i.response.status,s.data=i.response.data,s.headers=i.response.headers):i.request&&(s.status=i.request.status),lV.reportLogUploadError(s),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var uV;function tge(t){return Mr(t.reportId,"params.reportId",0,100,!1),Mr(t.category,"params.category",0,100,!1),Mr(t.event,"params.event",0,100,!1),Mr(t.label,"params.label",0,100,!1),ln(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(uV={}).FREE="free",uV.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const nge={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sr=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.RTE_DETAIL="rte_detail_stats",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Cn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let rge=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function at(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,s){const c=s.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);s.value=function(){for(var h,m=arguments.length,g=new Array(m),y=0;y<m;y++)g[y]=arguments[y];let _=g;if(t.argsMap)try{_=t.argsMap(this,...g)}catch(S){R.warning(S),_=[]}try{JSON.stringify(_)}catch{R.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const x=(t.report||$e).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:_,tag:dn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const S=c.apply(this,g);return S instanceof ke?S.then(C=>(x.onSuccess(t.reportResult&&C),C)).catch(C=>{throw x.onError(C),C}):(x.onSuccess(t.reportResult&&S),S)}catch(S){throw x.onError(S),S}}}return s}}const $e=new class{constructor(){Ln(this,"baseInfoMap",new Map),Ln(this,"proxyServer",void 0),Ln(this,"eventUploadTimer",void 0),Ln(this,"setSessionIdTimer",void 0),Ln(this,"url",void 0),Ln(this,"sids",new Set),Ln(this,"backupUrl",void 0),Ln(this,"_appId",void 0),Ln(this,"_aid",0),Ln(this,"keyEventUploadPendingItems",[]),Ln(this,"normalEventUploadPendingItems",[]),Ln(this,"apiInvokeUploadPendingItems",[]),Ln(this,"apiInvokeCount",0),Ln(this,"apiInvokeLoggedCount",0),Ln(this,"ltsList",[]),Ln(this,"lastSendNormalEventTime",Date.now()),Ln(this,"customReportCounterTimer",void 0),Ln(this,"customReportCount",0),Ln(this,"extApiInvoke",async t=>{for(const r of t){const i=xt(xt({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:dn.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,s]=r;return i+s}),16)||0}reportApiInvoke(t,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!G("SHOW_REPORT_INVOKER_LOG"),h=!!G("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function y(C,M){if(m){let D="[apiInvoke-".concat(g,"]");if(r.id&&(D+="[".concat(r.id,"]")),r.name&&(D+="[".concat(r.name,"]"),r.name===Tn.JOIN))return R.info("".concat(D," ").concat(C));R.info("".concat(D," ").concat(C),C==="start"?r.options:M||"")}}const _=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:s,options:r.options,states:r.states||null});y("start");let x=!1;yr(r.timeout).then(()=>{x||(this.sendApiInvoke(xt(xt({},_()),{},{error:H.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const S=new he(H.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:C=>{const M=()=>{if(x)throw S;return x=!0,this.sendApiInvoke(xt(xt({},_()),{},{success:!0},r.reportResult&&{result:C})),y("onSuccess"),C};return i?HF(M,r.name+"Success",i,()=>x=!0):M()},onError:C=>{const M=()=>{if(x)throw C;x=!0,this.sendApiInvoke(xt(xt({},_()),{},{success:!1,error:C})),y("onFailure",C.toString())};return i?HF(M,r.name+"Error",i,()=>x=!0):M()}}}_send(t,r,i){this.send({type:t,data:r},i)}_sendApiInvoke(t){return this.sendApiInvoke(t)}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=r.cname,s.rteUrl=r.rteUrl;const c=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:aA?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientRole:_}=r,x=Date.now(),S=xt(xt({},s),{},{eventType:sr.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:oA,lts:x,elapse:x-i,extend:JSON.stringify(c),mode:r.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:cs,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientType:Re(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||"",rteUrl:r.rteUrl,rteSid:r.rteSid});var C;this.send({type:Cn.SESSION,data:S},!0)}reportRteDetail(t){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,s=Date.now(),c=xt(xt({},i),{},{eventType:sr.RTE_DETAIL,lts:s,success:!0,elapse:s-r.startTime,vid:i.vid===void 0?0:Number(i.vid),ua:navigator.userAgent});this.send({type:Cn.RTE_DETAIL,data:c},!0)}joinChooseServer(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid);const c=Date.now(),u=xt(xt({},s),{},{role:r.role,eventType:sr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Cn.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{eventType:sr.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Cn.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;const c=Date.now(),{firstSuccess:u,addr:h,isProxy:m}=r,g=c-i.startTime,y=xt(xt({},s),{},{eventType:sr.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:iA(),isABTestSuccess:r.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:m?1:0}),_=y.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),h)if(y.signalChannel==="1"){const x=dA(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),S=h.match(x);y.gatewayIp=S&&S.groups?S.groups.ip:"",y.gatewayPort=S&&S.groups?S.groups.port:""}else if(m){const x=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=h.match(/p=[0-9]{1,6}/g);y.gatewayIp=x&&x.length?x[0].split("=")[1].replace(/-/g,"."):"",y.gatewayPort=S&&S.length?S[0].split("=")[1]:""}else{const x=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=h.match(/(:|p=)[0-9]{1,6}/g);y.gatewayIp=x&&x.length?x[0].split("//")[1].replace(/-/g,"."):"",y.gatewayPort=S&&S.length?S[0].split(/:|p=/g)[1]:""}if(u)this.send({type:Cn.JOIN_GATEWAY,data:y},!0);else{let x={isSuccess:_,port:y.gatewayPort};delete y.success,delete y.eventType,delete y.firstSuccess,delete y.gatewayPort,y.vid=Number(y.vid);const S=Object.assign({},y,x,{eventType:sr.REJOIN_GATEWAY});this.send({type:Cn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),c=xt(xt({},i.info),{},{lts:s,timeout:r,elapse:s-i.startTime});this.send({type:Cn.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{eventType:sr.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Cn.PUBLISH,data:u},!0)}subscribe(t,r,i){const s=this.baseInfoMap.get(t);if(!s)return;const c=s.info,u=Date.now(),h=xt(xt({},c),{},{eventType:sr.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-s.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Cn.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const i=[...si(r=this.baseInfoMap).call(r)],s=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const u=c.info,h=Date.now(),m=xt(xt({},u),{},{eventType:sr.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Cn.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=r.peerPubStatusMs-(i.lastJoinSuccessTime||c),h=xt(xt({},s),{},{elapse:c-i.startTime,eventType:sr.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>u?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0,firstReceivedEncodedFrame:r.firstReceivedEncodedFrame?Math.max(r.firstReceivedEncodedFrame-r.joinChannelStart,0):void 0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""});this.send({type:Cn.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=xt(xt(xt({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((s.firstFrame||h)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=xt(xt(xt({},u),s),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.AB_TEST,lts:c});this.send({type:Cn.AB_TEST,data:u},!0)}pcStats(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-i.startTime,eventType:sr.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Cn.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:sr.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Cn.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,i,s){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=xt(xt(xt({},u),s),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{eventType:sr.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:Cn.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{eventType:sr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Cn.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{eventType:sr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Cn.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt({},s),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Cn.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now();(function(u,h,m){const g=u[h];if(!g||typeof g!="string")return[u];u[h]="";const y=gc(JSON.stringify(u));let _=0;const x=[];let S=0;for(let C=0;C<g.length;C++)S+=g.charCodeAt(C)<=127?1:3,S<=m-y||(x[x.length]=Oe(Oe({},u),{},{[h]:g.substring(_,C)}),_=C,S=g.charCodeAt(C)<=127?1:3);return _!==g.length-1&&(x[x.length]=Oe(Oe({},u),{},{[h]:g.substring(_)})),x})(xt(xt(xt({},s),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Cn.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Cn.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:Cn.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,c=Date.now(),u=xt(xt(xt({},s),r),{},{elapse:c-i.startTime,lts:c});this.send({type:Cn.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new he(H.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=r.map(c=>({type:Cn.USER_ANALYTICS,data:xt(xt({sid:t},c),{},{lts:i})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw R.error("send custom report message failed",c.toString()),new he(H.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=G("NOT_REPORT_EVENT");if(t.tag&&Re(r)&&Re(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:c,cid:u}=i.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof he){const{code:g,message:y}=t.error;h=g||y||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:s,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Cn.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&t.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const i=[],s=[];for(;t.length;){const u=t.shift();i.length<20?i.push(u):s.push(u)}t.push(...s);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),gu(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&i.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{G("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){jn.networkState===Ti.OFFLINE&&await ke.race([jn.onlineWaiter,yr(2*Yn.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=$R(JSON.stringify(h.data)),g=new ArrayBuffer(5),y=(x=>{let S=0;return Object.entries(Cn).forEach(C=>{let[M,D]=C;D===x.type&&(S=rge[M])}),S})(h),_=new DataView(g);_.setUint16(0,m.byteLength,!0),_.setUint8(2,255&y),_.setUint8(3,y>>>8&255),_.setUint8(4,y>>>16&255),u=jF(u,new Uint8Array(g)),u=jF(u,m)}),u},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await eA(s,{timeout:1e4,data:r(t),headers:xt(xt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),s=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:i,aid:s};jn.networkState===Ti.OFFLINE&&await ke.race([jn.onlineWaiter,yr(2*Yn.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Gfe(h,{timeout:1e4,data:c}):await eA(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const i=Object.assign({},nge);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:r}),i}reportResourceTiming(t,r){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:s,tag:dn.TRACER}).onSuccess()}};lV.on("REPORT_LOG_UPLOAD",t=>{t.networkState=jn.networkState,$e.reportApiInvoke(null,{name:"logUploadError",options:t,tag:dn.TRACER}).onSuccess("logUploadError")});let ce=class extends he{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ln(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}};const _r={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function It(){return _r}function hV(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(tl()||bF())&&!AF())}function Nb(){return!_r.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fc()}function Yg(t){return!(En()||EF(87)||Nb()||!G("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}function pV(t){return G("ENABLE_INSTANT_VIDEO")?G("ENABLE_INSTANT_VIDEO"):!(t==null||!t.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB"))}function mV(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function fV(){if(mV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in t)||!t.suppressLocalAudioPlayback)}return No(141)||ed(141)||Tu(141)}function gV(){if(mV()){const t=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in t)||!t.restrictOwnAudio)}return No(141)||ed(141)||Tu(125)}let Ur=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Up(t,r,i){return{sampleRate:t,stereo:r,bitrate:i}}function $t(t,r,i,s,c){return{width:t,height:r,frameRate:i,bitrateMin:s,bitrateMax:c}}function Gs(t,r,i,s,c){return{width:{max:t},height:{max:r},frameRate:i,bitrateMin:s,bitrateMax:c}}function hA(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const ige={"90p":$t(160,90),"90p_1":$t(160,90),"120p":$t(160,120,15,30,65),"120p_1":$t(160,120,15,30,65),"120p_3":$t(120,120,15,30,50),"120p_4":$t(212,120),"180p":$t(320,180,15,30,140),"180p_1":$t(320,180,15,30,140),"180p_3":$t(180,180,15,30,100),"180p_4":$t(240,180,15,30,120),"240p":$t(320,240,15,40,200),"240p_1":$t(320,240,15,40,200),"240p_3":$t(240,240,15,40,140),"240p_4":$t(424,240,15,40,220),"360p":$t(640,360,15,80,400),"360p_1":$t(640,360,15,80,400),"360p_3":$t(360,360,15,80,260),"360p_4":$t(640,360,30,80,600),"360p_6":$t(360,360,30,80,400),"360p_7":$t(480,360,15,80,320),"360p_8":$t(480,360,30,80,490),"360p_9":$t(640,360,15,80,800),"360p_10":$t(640,360,24,80,800),"360p_11":$t(640,360,24,80,1e3),"480p":$t(640,480,15,100,500),"480p_1":$t(640,480,15,100,500),"480p_2":$t(640,480,30,100,1e3),"480p_3":$t(480,480,15,100,400),"480p_4":$t(640,480,30,100,750),"480p_6":$t(480,480,30,100,600),"480p_8":$t(848,480,15,100,610),"480p_9":$t(848,480,30,100,930),"480p_10":$t(640,480,10,100,400),"720p":$t(1280,720,15,120,1130),"720p_auto":$t(1280,720,30,900,3e3),"720p_1":$t(1280,720,15,120,1130),"720p_2":$t(1280,720,30,120,2e3),"720p_3":$t(1280,720,30,120,1710),"720p_5":$t(960,720,15,120,910),"720p_6":$t(960,720,30,120,1380),"1080p":$t(1920,1080,15,120,2080),"1080p_1":$t(1920,1080,15,120,2080),"1080p_2":$t(1920,1080,30,120,3e3),"1080p_3":$t(1920,1080,30,120,3150),"1080p_5":$t(1920,1080,60,120,4780),"1440p":$t(2560,1440,30,120,4850),"1440p_1":$t(2560,1440,30,120,4850),"1440p_2":$t(2560,1440,60,120,7350),"4k":$t(3840,2160,30,120,8910),"4k_1":$t(3840,2160,30,120,8910),"4k_3":$t(3840,2160,60,120,13500)},age={"480p":Gs(640,480,5),"480p_1":Gs(640,480,5),"480p_2":Gs(640,480,30),"480p_3":Gs(640,480,15),"720p":Gs(1280,720,5),"720p_auto":$t(1280,720,30,900,3e3),"720p_1":Gs(1280,720,5),"720p_2":Gs(1280,720,30),"720p_3":Gs(1280,720,15),"1080p":Gs(1920,1080,5),"1080p_1":Gs(1920,1080,5),"1080p_2":Gs(1920,1080,30),"1080p_3":Gs(1920,1080,15)},sge={"1SL1TL":hA(1,1),"3SL3TL":hA(3,3),"2SL3TL":hA(2,3)};function Ws(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},ige[t]):t}function pA(t){return typeof t=="string"?Object.assign({},age[t]):t}function Rb(t){return typeof t=="string"?Object.assign({},sge[t]):t}const oge={speech_low_quality:Up(16e3,!1),speech_standard:Up(32e3,!1,18),music_standard:Up(48e3,!1),standard_stereo:Up(48e3,!0,56),high_quality:Up(48e3,!1,128),high_quality_stereo:Up(48e3,!0,192)};function Ab(t){return typeof t=="string"?Object.assign({},oge[t]):t}const ku=[];function vV(t){return Kn(t,"mediaSource",["screen","window","application"]),!0}let He=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Qt=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Fp=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),cge=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),lge=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ju=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Vp=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),ds=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Bp=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Va=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const mA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},yV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},dge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},_V={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ni=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Ba=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),qg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Lu=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Jr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),vc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const gA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Ib=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Mt(t,r,i,s,c){var u,h,m={};return Object.keys(s).forEach(function(g){m[g]=s[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=ss(u=Kj(h=i.slice()).call(h)).call(u,function(g,y){return y(t,r,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function le(t,r,i){return(r=function(s){var c=function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(s);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function bV(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function _n(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?bV(Object(i),!0).forEach(function(s){le(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bV(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class EV extends An{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ju.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),le(this,"trackMediaType",void 0),le(this,"_ID",void 0),le(this,"_rtpTransceiver",void 0),le(this,"_lowRtpTransceiver",void 0),le(this,"_hints",[]),le(this,"_isClosed",!1),le(this,"_originMediaStreamTrack",void 0),le(this,"mediaStreamTrack",void 0),le(this,"_external",{}),this._ID=i||en(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(s){Re(ku).call(ku,s)||ku.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||td(()=>{var i;$e.reportApiInvoke(null,{name:Tn.GET_MEDIA_STREAM_TRACK,options:[],tag:dn.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Fp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=ku.indexOf(r);i!==-1&&ku.splice(i,1)}(this),this.emit(Vp.CLOSED),this.removeAllListeners(ju.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Fp.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ju.TRANSCEIVER_UPDATED,r,i)}}class Gp extends EV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),le(this,"_enabled",!0),le(this,"_muted",!1),le(this,"_isExternalTrack",!1),le(this,"_isClosed",!1),le(this,"_enabledMutex",void 0),le(this,"processor",void 0),le(this,"_processorContext",void 0),le(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Rr("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(He.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}stateCheck(r,i){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),Fs(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new he(H.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new he(H.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ke.resolve([])}}const xV=window.AudioContext||window.webkitAudioContext;let vA,Ga=null;const on=new class extends An{constructor(){super(...arguments),le(this,"prevState",void 0),le(this,"curState",void 0),le(this,"currentTime",void 0),le(this,"currentTimeStuckAt",void 0),le(this,"interruptDetectorTrack",void 0),le(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Ur.IOS_15_16_INTERRUPTION_START)}),le(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Ga&&await Ga.suspend(),this.emit(Ur.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){R.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){R.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Wp(){if(!Ga){if(function(){if(!xV)return void R.error("your browser is not support web audio");R.info("create audio context");const t=_n({},G("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(t)),Ga=new xV(t),on.curState=Ga.state,Ga.onstatechange=()=>{on.prevState=on.curState,on.curState=Ga?Ga.state:void 0;const{prevState:r,curState:i}=on,s=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",g=Wt().osVersion;(ai()||Us())&&u&&c&&(R.info("ios".concat(g,"-interruption-start")),on.emit(Ur.IOS_INTERRUPTION_START)),(ai()||Us())&&(h||m)&&s&&(R.info("ios".concat(g,"-interruption-end")),on.emit(Ur.IOS_INTERRUPTION_END)),r!==i&&on.emit(Ur.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Ga)===null||r===void 0?void 0:r.currentTime;on.currentTime!==i?(on.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(i)),on.currentTimeStuckAt=void 0),on.currentTime=i):(i!==on.currentTimeStuckAt&&($e.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:dn.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(i))),on.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c,u=!1,h=!1,m=!1;function g($){r.state==="running"?y(!1):ai()||Us()?r.state==="suspended"&&(y(!0),$&&r.resume().then(_,_)):r.state!=="closed"&&(y(!0),$&&r.resume().then(_,_))}function y($){if(u!==$){u=$;for(let K=0,J=i;K<J.length;K+=1){const ne=J[K];$?window.addEventListener(ne,x,{capture:!0,passive:!0}):window.removeEventListener(ne,x,{capture:!0,passive:!0})}}}function _(){g(!1)}function x(){g(!0)}function S(){let $;try{$=s.play(),$?$.then(D,D):(s.addEventListener("playing",D),s.addEventListener("abort",D),s.addEventListener("error",D))}catch{D()}}function C($){m||(s.paused?$?(M(!1),m=!0,S()):M(!0):M(!1))}function M($){if(h!==$){h=$;for(let K=0,J=i;K<J.length;K++){const ne=J[K];$?window.addEventListener(ne,j,{capture:!0,passive:!0}):window.removeEventListener(ne,j,{capture:!0,passive:!0})}}}function D(){s.removeEventListener("playing",D),s.removeEventListener("abort",D),s.removeEventListener("error",D),m=!1,C(!1)}function j(){C(!0)}if(ai()&&G("IOS_BG_TAG")){const $=r.createMediaStreamDestination(),K=document.createElement("div");K.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=K.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=$.stream,c=()=>{if(G("IOS_AUTO_RESTART_BG_TAG")&&s&&s.srcObject&&!m&&(!s.paused||h!==!0)){s.paused||s.pause();try{m=!0,S()}catch{m=!1}return!0}},C(!0)}return on.on(Ur.STATE_CHANGE,function(){g(!0)}),g(!1),c}(Ga).then(r=>{vA=r})}(),!Ga)throw new he(H.NOT_SUPPORTED,"can not create audio context");return Ga}return Ga}function Mu(t){if(function(){if(yA!==null)return yA;const s=Wp(),c=s.createBufferSource(),u=s.createGain(),h=s.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),yA=m,m}())return;const r=t.connect,i=t.disconnect;t.connect=(s,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),Re(h=t._inputNodes).call(h,s)||(s instanceof AudioNode?(t._inputNodes.push(s),r.call(t,s,c,u)):r.call(t,s,c)),t},t.disconnect=(s,c,u)=>{i.call(t),s?vb(t._inputNodes,s):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let yA=null;function _A(t,r){let i=!1;const s=1/r;if(G("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):t(performance.now()/1e3)},1e3*s)}else{const c=Wp();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+s),t(c.currentTime)};h()}return()=>{i=!0}}class SV{constructor(){le(this,"context",void 0),le(this,"analyserNode",void 0),le(this,"sourceNode",void 0),this.context=Wp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ai()||Us()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<r.length;++c)r[c]=s[c]/128-1}const i=ss(r).call(r,(s,c)=>s+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class wV extends An{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),le(this,"outputNode",void 0),le(this,"outputTrack",void 0),le(this,"isPlayed",!1),le(this,"sourceNode",void 0),le(this,"context",void 0),le(this,"audioBufferNode",void 0),le(this,"destNode",void 0),le(this,"audioOutputLevel",0),le(this,"volumeLevelAnalyser",void 0),le(this,"_processedNode",void 0),le(this,"playNode",void 0),le(this,"isDestroyed",!1),le(this,"onNoAudioInput",void 0),le(this,"isNoAudioInput",!1),le(this,"_noAudioInputCount",0),this.context=Wp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Mu(this.outputNode),this.volumeLevelAnalyser=new SV}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Va.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const u=s.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!It().webAudioMediaStreamDest)throw new he(H.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&yb(()=>{on.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ai()||Us()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let s;i.getFloatTimeDomainData?(s=new Float32Array(i.fftSize),i.getFloatTimeDomainData(s)):(s=new Uint8Array(i.fftSize),i.getByteTimeDomainData(s));let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await yr(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bA extends wV{get isFreeze(){return!1}constructor(r,i,s){var c;if(super(),le(this,"sourceNode",void 0),le(this,"track",void 0),le(this,"clonedTrack",void 0),le(this,"audioElement",void 0),le(this,"isCurrentTrackCloned",!1),le(this,"isRemoteTrack",!1),le(this,"originVolumeLevelAnalyser",void 0),le(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Mu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),Mu(this.outputNode),this.emit(Va.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new he(H.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),Mu(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,R.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Mu(g),this.originVolumeLevelAnalyser=new SV,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Wt();i&&h.os===vr.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(on.on(Ur.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),Mu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Va.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),on.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),R.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));Mu(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function TV(t,r,i){const s=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function uge(t,r){const i=await CV(t.mediaSource),{sourceId:s,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ke((m,g)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const x=document.createElement("div");x.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",x.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const M=document.createElement("button");M.innerHTML="cancel",M.setAttribute("style","width: 85px;"),M.onclick=()=>{document.body.removeChild($);const K=new Error("NotAllowedError");K.name="NotAllowedError",g(K)};let D=h;const j=document.createElement("div");if(h){const K=document.createElement("input");K.setAttribute("type","checkbox");const J=document.createElement("span");K.setAttribute("style","margin-right: 6px;"),J.innerText="Share audio",K.checked=D,K.onchange=()=>{D=K.checked},j.appendChild(K),j.appendChild(J)}C.appendChild(j),C.appendChild(M),_.appendChild(x),_.appendChild(S),_.appendChild(C);const $=document.createElement("div");$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),$.appendChild(y),$.appendChild(_),document.body.appendChild($),u.map(K=>{if(K.id){const J=document.createElement("div");J.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ne=K.thumbnail;try{const{width:ae}=ne.getSize();ae>1920&&(ne=ne.resize({width:1920}))}catch(ae){throw ae&&ae.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ae}J.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ne.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+K.name.replace(/[\u00A0-\u9999<>\&]/g,function(ae){return"&#"+ae.charCodeAt(0)+";"})+"</span>",J.onclick=()=>{document.body.removeChild($),m({sourceId:K.id,audio:D})},S.appendChild(J)}})})}(i,r);return await TV(s,t,c)}async function CV(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const i=LF();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new he(H.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{s=null}s&&s.then||(s=new ke((u,h)=>{i.desktopCapturer.getSources({types:r},(m,g)=>{m?h(m):u(g)})}));try{return await s}catch(u){throw new he(H.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const EA=new Rr("safari");let NV=!1,RV=!1;async function Wa(t,r){let i=0,s=null;for(;i<2;)try{s=await hge(t,r,i>0);break}catch(c){if(c instanceof he)throw R.error("[".concat(r,"] ").concat(c.toString())),c;const u=Ob(c.name||c.code||c,c.message);if(u.code===H.MEDIA_OPTION_INVALID){R.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await yr(500);continue}throw R.error("[".concat(r,"] ").concat(u.toString())),u}if(!s)throw new he(H.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function hge(t,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new he(H.NOT_SUPPORTED,"can not find getUserMedia");i&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const s=It(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return R.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(LF())t.screen.sourceId?$p(c,await TV(t.screen.sourceId,t.screen,!!t.screenAudio)):$p(c,await uge(t.screen,!!t.screenAudio));else if(tl()&&t.screen.extensionId&&t.screen.mandatory){if(!s.getStreamFromExtension)throw new he(H.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const S=await(h=t.screen.extensionId,m=r,new ke((C,M)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},D=>{if(!D||!D.streamId)return R.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),D),void M(new he(H.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(D.streamId)})}catch(D){R.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),D.toString()),M(new he(H.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=S,$p(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(s.getDisplayMedia){var u;t.screen.mediaSource&&vV(t.screen.mediaSource);const S={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:M,systemAudio:D,preferCurrentTab:j,windowAudio:$,monitorTypeSurfaces:K}=t.screen,J={selfBrowserSurface:C,surfaceSwitching:M,systemAudio:D,preferCurrentTab:j,windowAudio:$,monitorTypeSurfaces:K};!C&&delete J.selfBrowserSurface,!M&&delete J.surfaceSwitching,!D&&delete J.systemAudio,!j&&delete J.preferCurrentTab,!$&&delete J.windowAudio,!K&&delete J.monitorTypeSurfaces,R.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:S,audio:t.screenAudio,controls:J})),$p(c,await navigator.mediaDevices.getDisplayMedia(_n({video:S,audio:t.screenAudio},J)))}else{if(!En())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new he(H.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&vV(t.screen.mediaSource);const S={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};R.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(S))),$p(c,await navigator.mediaDevices.getUserMedia(S))}}var h,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},y=G("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),g=qR(g,y)}catch{}R.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),Wt();let _,x=null;(Nr()||ai()||gb())&&(x=await EA.lock());try{_=await navigator.mediaDevices.getUserMedia(g)}catch(S){throw x&&x(),S}return g.audio&&(NV=!0),g.video&&(RV=!0),$p(c,_),x&&x(),c}function Ob(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new he(H.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new he(H.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new he(H.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new he(H.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new he(H.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new he(H.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return R.error("getUserMedia unexpected error",t),new he(H.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function $p(t,r){const i=t.getVideoTracks()[0],s=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(s&&t.removeTrack(s),t.addTrack(u)),c&&(i&&t.removeTrack(i),t.addTrack(c))}const $a=new class extends An{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Lu.STATE_CHANGE,t),this._state=t)}constructor(){super(),le(this,"_state",qg.IDLE),le(this,"isAccessMicrophonePermission",!1),le(this,"isAccessCameraPermission",!1),le(this,"lastAccessMicrophonePermission",!1),le(this,"lastAccessCameraPermission",!1),le(this,"checkdeviceMatched",!1),le(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(Vg()||fb()===vr.HARMONY_OS)&&fc())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>R.error(t.toString()))}async enumerateDevices(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new he(H.NOT_SUPPORTED,"enumerateDevices() not supported.");const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,g=null,y=null;if(!i&&(u||h)){if(EA.isLocked&&(R.debug("[device manager] wait GUM lock"),(await EA.lock())(),R.debug("[device manager] GUM unlock")),NV&&(u=!1,this.isAccessMicrophonePermission=!0),RV&&(h=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const x=Ob(_.name||_.code||_,_.message);if(x.code===H.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(_){const x=Ob(_.name||_.code||_,_.message);if(x.code===H.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(_){const x=Ob(_.name||_.code||_,_.message);if(x.code===H.PERMISSION_DENIED)throw x;R.warning("getUserMedia failed in getDevices",x)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",t,"cam permission",r)}try{const _=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(x=>x.stop()),g&&g.getTracks().forEach(x=>x.stop()),y&&y.getTracks().forEach(x=>x.stop()),m=null,g=null,y=null,_}catch(_){return m&&m.getTracks().forEach(x=>x.stop()),g&&g.getTracks().forEach(x=>x.stop()),y&&y.getTracks().forEach(x=>x.stop()),m=null,g=null,y=null,new he(H.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===t&&(r=i.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===t);if(!r)throw new he(H.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=qg.INITING;try{await this.updateDevicesInfo(),this.state=qg.INITEND}catch(t){throw this.state=qg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(R.warning("Device Detection functionality cannot start properly.",t.toString()),t):new he(H.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):R.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):R.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==qg.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Lu.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Lu.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Lu.PLAYOUT_DEVICE_CHANGED,c)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),i=t.filter(c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let xA=!1;const Vi=new class extends An{constructor(){super(...arguments),le(this,"onAutoplayFailed",void 0),le(this,"onAudioAutoplayFailed",void 0)}};function AV(){if(xA)return G("FLS_AUTOPLAY_EMITS")?(Vi.onAutoplayFailed&&Vi.onAutoplayFailed(),Vi.emit("autoplay-failed")):void 0;{const t=r=>{r.preventDefault(),xA=!1,Bg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};xA=!0,Bg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Vi.onAutoplayFailed?Vi.onAutoplayFailed():Vi.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Vi.emit("autoplay-failed")}}function IV(t,r,i,s){if(!t)return;const c=$e.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=_n(_n({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Vi.onAutoplayFailed||Vi.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:s,extend:void 0});$e.send({type:Cn.AUTOPLAY_FAILED,data:m},!0)}const pge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],hi=new class{constructor(){le(this,"onAutoplayFailed",void 0),le(this,"elementMap",new Map),le(this,"elementStateMap",new Map),le(this,"elementsNeedToResume",[]),le(this,"sinkIdMap",new Map),le(this,"autoResumeAfterInterruption",t=>ke.all(Array.from(this.elementMap.entries()).map(async r=>{let[i,s]=r;const c=this.elementStateMap.get(i),u=s.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(R.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return s.pause(),s.play();if(on.curState==="running")return Ip()?(s.pause(),s.play()):c&&c==="paused"?s.play():void 0}}))),le(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t;const s=i.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),on.on(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),on.on(Ur.STATE_CHANGE,()=>{ai()&&on.prevState==="suspended"&&on.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const i=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),i)try{await i.setSinkId(r)}catch(s){throw new he(H.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(t,r,i,s){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Jr.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{R.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){R.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{s&&IV(s,"audio",m.message,r),R.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),yb(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),AV()}))})}updateTrack(t,r){const i=this.elementMap.get(t);i&&(i.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const i=this.elementMap.get(t);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}getVolume(t){const r=this.elementMap.get(t);return r?r.volume:0}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){pge.forEach(i=>{r.addEventListener(i,s=>{const c=this.elementStateMap.get(t),u=s.type==="pause"?"paused":s.type;if(R.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),s.type==="error"){const h=r==null?void 0:r.error;h&&R.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{R.debug("Auto resume audio element success")}).catch(i=>{R.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ke(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Bg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Fn(){return function(t,r,i){const s=i.value;return typeof s=="function"&&(i.value=function(){this._isClosed&&new he(H.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=s.apply(this,u);return m instanceof ke?new ke((g,y)=>{m.then(g).catch(y)}):m}),i}}class OV extends An{constructor(r){super(),le(this,"name","VideoProcessorDestination"),le(this,"ID","0"),le(this,"_source",void 0),le(this,"videoContext",void 0),le(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new he(H.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new he(H.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Ni.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ni.ON_TRACK,void 0)}}class PV extends An{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),le(this,"constraintsMap",new Map),le(this,"statsRegistry",[]),le(this,"usageRegistry",[]),le(this,"trackId",void 0),le(this,"direction",void 0),le(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await er(this,Ba.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),fn(this,Ba.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return R.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),fn(this,Ba.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){R.error(new he(H.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof ke&&(s=await s),r.push(_n(_n({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class DV extends An{constructor(r){super(),le(this,"name","AudioProcessorDestination"),le(this,"ID","0"),le(this,"inputTrack",void 0),le(this,"inputNode",void 0),le(this,"audioProcessorContext",void 0),le(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new he(H.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new he(H.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ni.ON_TRACK,void 0),this.emit(Ni.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Ni.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Ni.ON_NODE,this.inputNode))}}class kV extends An{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,s){super(),le(this,"constraintsMap",new Map),le(this,"statsRegistry",[]),le(this,"audioContext",void 0),le(this,"trackId",void 0),le(this,"direction",void 0),le(this,"usageRegistry",[]),le(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=s}async getConstraints(){return er(this,Ba.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var s;return R.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),fn(this,Ba.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(s=this.constraintsMap).call(s)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),fn(this,Ba.REQUEST_UPDATE_CONSTRAINTS,Array.from(ya(i=this.constraintsMap).call(i)))}registerStats(r,i,s){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:s})}unregisterStats(r,i){const s=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:s,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){R.error(new he(H.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let s=i();s instanceof ke&&(s=await s),r.push(_n(_n({},s),{},{direction:this.direction}))}catch(s){R.error("gather extension usage error",s)}return r}getDirection(){return this.direction}}class SA extends An{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),le(this,"context",void 0),le(this,"processSourceNode",void 0),le(this,"outputTrack",void 0),le(this,"processedNode",void 0),le(this,"clonedTrack",void 0),le(this,"outputNode",void 0),this.outputNode=new mge}setVolume(){}createOutputTrack(){throw new he(H.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class mge{disconnect(){}connect(){}}function jV(t){return new ke((r,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=ai()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&En()||(s=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch($g),setTimeout(()=>{s||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function Pb(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const i=Ws(t.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!RF()&&i.frameRate&&(r.frameRate=i.frameRate),bF()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),En()&&(r.frameRate={ideal:30,max:30}),r}function LV(t){const r={};return RF()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,tl()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function MV(t){const r=LV(t);if(t.encoderConfig){const i=Ab(t.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),Vg()&&(r.sampleRate=void 0),r}const UV=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:i,width:s,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=s,height:m=c}=r;if(!u||!h||!m)return;h=Dp(h),m=Dp(m),u=Dp(u);const{max:g,min:y}=function(C,M,D){const j=200*Math.pow(D/15,.6)*Math.pow(C*M/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:_,bitrateMin:x}=r||{};_||R.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(_,", brMin: ").concat(x,"]"));const{maxFramerate:S}=G("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(u=Math.min(u,S)),{frameRate:u,bitrateMax:_||g,bitrateMin:x||y,scaleResolutionDownBy:1,scale:0}},FV=async(t,r,i)=>await(async(s,c,u)=>{const h=function(y){const _=[];for(let x=0;x<y.length;x+=2)_.push(parseInt(y.slice(x,x+2),16));return Uint8Array.from(_)}(YF(""+c+u)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,s))})(t.buffer,r,i),wA=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ke((i,s)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await VV(c);i({buffer:u,width:r.width,height:r.height})}else s(new he(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},VV=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var BV,GV,WV,$V,HV,zV,KV,YV,qV,XV,JV,QV,ZV,eB,tB,nB,rB,iB,Pn,aB,sB,oB,cB,lB,dB,yc,uB,hB,pB,mB,fB,gB,vB,yB,_B,bB,EB,xB,SB,zr;let Vn=(BV=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),GV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),WV=Fn(),$V=kp("LocalAudioTrack","_enabledMutex"),HV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),zV=Fn(),KV=kp("LocalAudioTrack","_enabledMutex"),YV=at({argsMap:(t,r)=>[t.getTrackId(),r]}),qV=Fn(),XV=Fn(),JV=Fn(),QV=at({argsMap:t=>[t.getTrackId()]}),ZV=Fn(),eB=at({argsMap:t=>[t.getTrackId()]}),tB=Fn(),nB=at({argsMap:t=>[t.getTrackId()]}),rB=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),iB=at({argsMap:t=>[t.getTrackId()]}),Mt((Pn=class extends Gp{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?hi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,i,s){super(t,i),le(this,"trackMediaType",Bp.AUDIO),le(this,"_encoderConfig",void 0),le(this,"_trackSource",void 0),le(this,"metadata",[]),le(this,"_enabled",!0),le(this,"_volume",100),le(this,"_useAudioElement",!0),le(this,"_bypassWebAudio",!1),le(this,"processor",void 0),le(this,"_processorContext",void 0),le(this,"_processorDestination",void 0),le(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!s,this._trackSource=new SA,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Nr()&&!Ga?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ln(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&hi.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,fn(this,He.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!hV())throw new he(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await hi.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,i){return this._setEnabled(t,r,i)}async _setEnabled(t,r,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await fn(this,He.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await fn(this,He.NEED_MUTE_TRACK,this):await fn(this,He.NEED_UNMUTE_TRACK,this))}getStats(){return td(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ea(this,He.GET_STATS)||_n({},mA)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Va.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Va.ON_AUDIO_BUFFER),this._source.on(Va.ON_AUDIO_BUFFER,i=>t(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),hi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?hi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ke.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new he(H.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new he(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Ni.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await fn(this,He.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this))}),t.on(Ni.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Ni.ON_TRACK),t.removeAllListeners(Ni.ON_NODE)}bindProcessorContextEvents(t){t.on(Ba.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Ba.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof SA&&(this._trackSource=new bA(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new kV(this._source.context,this.getTrackId(),"local"),r=new DV(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Va.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(hi.stop(this.getTrackId()),this._source.play()),fn(this,He.NEED_REPLACE_MIXING_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[BV],Object.getOwnPropertyDescriptor(Pn.prototype,"setVolume"),Pn.prototype),Mt(Pn.prototype,"setPlaybackDevice",[GV,WV],Object.getOwnPropertyDescriptor(Pn.prototype,"setPlaybackDevice"),Pn.prototype),Mt(Pn.prototype,"setEnabled",[$V,HV,zV],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Mt(Pn.prototype,"setMuted",[KV,YV,qV],Object.getOwnPropertyDescriptor(Pn.prototype,"setMuted"),Pn.prototype),Mt(Pn.prototype,"getStats",[XV],Object.getOwnPropertyDescriptor(Pn.prototype,"getStats"),Pn.prototype),Mt(Pn.prototype,"setAudioFrameCallback",[JV],Object.getOwnPropertyDescriptor(Pn.prototype,"setAudioFrameCallback"),Pn.prototype),Mt(Pn.prototype,"play",[QV,ZV],Object.getOwnPropertyDescriptor(Pn.prototype,"play"),Pn.prototype),Mt(Pn.prototype,"stop",[eB,tB],Object.getOwnPropertyDescriptor(Pn.prototype,"stop"),Pn.prototype),Mt(Pn.prototype,"close",[nB],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Mt(Pn.prototype,"pipe",[rB],Object.getOwnPropertyDescriptor(Pn.prototype,"pipe"),Pn.prototype),Mt(Pn.prototype,"unpipe",[iB],Object.getOwnPropertyDescriptor(Pn.prototype,"unpipe"),Pn.prototype),Pn),Xg=(aB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),sB=Fn(),oB=kp("MicrophoneAudioTrack","_enabledMutex"),cB=at({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),lB=Fn(),dB=at({argsMap:t=>[t.getTrackId()]}),Mt((yc=class extends Vn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,i,s){super(t,r.encoderConfig?Ab(r.encoderConfig):{},s,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),le(this,"_config",void 0),le(this,"_deviceName","default"),le(this,"_constraints",void 0),le(this,"_originalConstraints",void 0),le(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Ip()||BR())&&on.bindInterruptDetectorTrack(this)}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await $a.getDeviceById(t),i={};i.audio=_n({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Wa(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Wa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await $a.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,i){if(r)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),G("AUTO_RESET_AUDIO_ROUTE")&&(ai()||Us())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=_n({},this._constraints),u=$a.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Wa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await fn(this,He.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ip()||BR())&&on.unbindInterruptDetectorTrack(this),ku.some(t=>function(r){return"__className__"in r&&r.__className__==="MicrophoneAudioTrack"}(t))||vA&&vA()&&($e.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:dn.TRACER}).onSuccess(),R.debug("restart background audio tag success"))}onTrackEnded(){if((ai()||Us())&&this._enabled&&!this._isClosed&&on.duringInterruption){const t=async()=>{on.off(Ur.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(Ur.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,i=$a.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const s=await Wa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Ba.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Ba.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[aB,sB],Object.getOwnPropertyDescriptor(yc.prototype,"setDevice"),yc.prototype),Mt(yc.prototype,"setEnabled",[oB,cB,lB],Object.getOwnPropertyDescriptor(yc.prototype,"setEnabled"),yc.prototype),Mt(yc.prototype,"close",[dB],Object.getOwnPropertyDescriptor(yc.prototype,"close"),yc.prototype),yc),fge=(uB=at({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),hB=Fn(),pB=at({argsMap:t=>[t.getTrackId()]}),mB=Fn(),fB=at({argsMap:t=>[t.getTrackId()]}),gB=Fn(),vB=at({argsMap:t=>[t.getTrackId()]}),yB=Fn(),_B=at({argsMap:t=>[t.getTrackId()]}),bB=Fn(),EB=at({argsMap:t=>[t.getTrackId()]}),xB=at({argsMap:t=>[t.getTrackId()]}),SB=Fn(),Mt((zr=class extends Vn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,i,s){super(r.createOutputTrack(),i,s),le(this,"source",void 0),le(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Va.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Vp.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ln(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[uB,hB],Object.getOwnPropertyDescriptor(zr.prototype,"startProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"pauseProcessAudioBuffer",[pB,mB],Object.getOwnPropertyDescriptor(zr.prototype,"pauseProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"seekAudioBuffer",[fB,gB],Object.getOwnPropertyDescriptor(zr.prototype,"seekAudioBuffer"),zr.prototype),Mt(zr.prototype,"resumeProcessAudioBuffer",[vB,yB],Object.getOwnPropertyDescriptor(zr.prototype,"resumeProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"stopProcessAudioBuffer",[_B,bB],Object.getOwnPropertyDescriptor(zr.prototype,"stopProcessAudioBuffer"),zr.prototype),Mt(zr.prototype,"close",[EB],Object.getOwnPropertyDescriptor(zr.prototype,"close"),zr.prototype),Mt(zr.prototype,"setAudioBufferPlaybackSpeed",[xB,SB],Object.getOwnPropertyDescriptor(zr.prototype,"setAudioBufferPlaybackSpeed"),zr.prototype),zr);class or extends Vn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Wp().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,en(8,"track-mix-")),le(this,"trackList",void 0),le(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}vb(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof or?i.emit(ju.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class gge extends wV{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Va.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),le(this,"audioBuffer",void 0),le(this,"sourceNode",void 0),le(this,"startPlayTime",0),le(this,"startPlayOffset",0),le(this,"pausePlayTime",0),le(this,"options",void 0),le(this,"currentLoopCount",0),le(this,"currentPlaybackSpeed",100),le(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const wB=new Map;function TB(t,r){if(t.length===0||r.length===0)return 1/0;const i=JR(t),s=JR(r);return Math.floor(s/i)}class TA{get rendFrameRate(){const r=Math.max(1,TB(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Jr.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){le(this,"trackId",void 0),le(this,"config",void 0),le(this,"onFirstVideoFrameDecoded",void 0),le(this,"onFirstVideoFrameRender",void 0),le(this,"onVideoBufferReady",void 0),le(this,"onVideoStateChanged",void 0),le(this,"freezeTimeCounterList",[]),le(this,"renderFreezeAccTime",0),le(this,"renderFreezeAccTime2",0),le(this,"isKeepLastFrame",!1),le(this,"isDestroyed",!1),le(this,"timeUpdatedCount",0),le(this,"freezeTime",0),le(this,"playbackTime",0),le(this,"lastTimeUpdatedTime",0),le(this,"autoplayFailed",!1),le(this,"videoTrack",void 0),le(this,"videoElement",void 0),le(this,"cacheVideoElement",void 0),le(this,"cancelRVFId",void 0),le(this,"internal",!1),le(this,"_render_interframe_delays",[]),le(this,"_render_interframe_delays_sizes",[]),le(this,"_videoState",vc.VideoStateStopped),le(this,"videoElementCheckInterval",void 0),le(this,"videoElementFreezeTimeout",void 0),le(this,"_videoElementStatus",Jr.NONE),le(this,"_isInPage",!0),le(this,"isGettingVideoDimensions",!1),le(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),le(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&on.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yF())),CF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),le(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&R.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Jr.PLAYING;break;case"loadeddata":if(this.videoState=vc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Jr.CANPLAY;break;case"stalled":this.videoElementStatus=Jr.STALLED;break;case"suspend":this.videoElementStatus=Jr.SUSPEND;break;case"pause":this.videoElementStatus=Jr.PAUSED,ai()||Us()||Nr()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Jr.WAITING;break;case"abort":this.videoElementStatus=Jr.ABORT;break;case"ended":this.videoElementStatus=Jr.ENDED;break;case"emptied":this.videoElementStatus=Jr.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=Jr.ERROR,R.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>G("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,xa.lastVisibleTime<xa.lastHiddenTime||u<xa.lastHiddenTime||u<xa.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),le(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yF())),CF()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),on.on(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.on(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&IV(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});const s=Wt();if((s.name==="Safari"&&Number(s.version)===15||Ip())&&i&&i.then){const c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return R.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const s=i.getImageData(0,0,r.width,r.height);return r.remove(),s}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new ke((u,h)=>{s.toBlob(async m=>{if(s.remove(),m){const g=await VV(m);u({buffer:g,width:s.width,height:s.height})}else h(new he(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await wA(r)}destroy(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,on.off(Ur.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),on.off(Ur.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),r?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=vc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Jr.INIT,!this.videoElementCheckInterval&&(CB.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(u){return u!==document.body&&document.body.contains(u)}(this.videoElement)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,G("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===vc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=vc.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(y,_)=>{if(this.videoElementStatus===Jr.PLAYING){if(u){const C=_.presentationTime-u.presentationTime,M=_.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(M),this._render_interframe_delays.push(C);const D=JR(this._render_interframe_delays_sizes),j=D-this._render_interframe_delays_sizes[0];if(D>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===vc.VideoStateStarting&&(this.videoState=vc.VideoStateDecoding),this.videoState===vc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,G("VIDEO_FREEZE_DURATION"))),C<G("VIDEO_FREEZE_DURATION")&&this.videoState===vc.VideoStateFrozen&&(this.videoState=vc.VideoStateDecoding),C>G("VIDEO_FREEZE_DURATION")&&xa.lastVisibleTime>=xa.lastHiddenTime&&u.timestamp>xa.lastVisibleTime&&u.timestamp>xa.lastHiddenTime){const $=Math.min(66,TB(this._render_interframe_delays_sizes,this._render_interframe_delays)),K=Math.max(0,C-(M-1)*$);this.renderFreezeAccTime2+=K>$?K:0,this.renderFreezeAccTime+=C}}u=_n(_n({},_),{},{timestamp:y})}else this.isSkipCalcRenderFreezeTime()&&(u=_n(_n({},_),{},{timestamp:y}));var x,S;G("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(x=(S=this.videoElement).requestVideoFrameCallback)===null||x===void 0?void 0:x.call(S,g))};this.cancelRVFId=(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0?void 0:r.call(i,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Vg()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=Wt();this.config.noStyle||(s.name==="Safari"&&Number(s.version)===15||Ip()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,En()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,En()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{R.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){var r,i;CB.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((r=(i=this.videoElement).cancelVideoFrameCallback)===null||r===void 0||r.call(i,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Jr.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Jr.DESTROYED||this.internal}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{R.error(s)}),this.autoplayFailed=!1,Bg()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Bg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),AV()}}const CB=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Db extends TA{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),le(this,"container",void 0),le(this,"slot",void 0),this.slot=r.element,this.internal=i,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;var s;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,s):await wA(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var NB,RB,AB,IB,OB,PB,DB,kB,jB,LB,MB,UB,FB,VB,BB,GB,WB,$B,HB,zB,KB,YB,qB,XB,JB,QB,ZB,e6,Ot,t6,n6,r6,i6,a6,s6,o6,c6,Ha;let un=(NB=at({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),RB=Fn(),AB=at({argsMap:t=>[t.getTrackId()]}),IB=kp("LocalVideoTrack","_enabledMutex"),OB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),PB=Fn(),DB=kp("LocalVideoTrack","_enabledMutex"),kB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),jB=Fn(),LB=at({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),MB=Fn(),UB=at({argsMap:(t,r)=>[t.getTrackId(),r]}),FB=Fn(),VB=Fn(),BB=at({argsMap:(t,r,i)=>[t.getTrackId(),r,i]}),GB=Fn(),WB=Fn(),$B=Fn(),HB=at({argsMap:t=>[t.getTrackId()]}),zB=Fn(),KB=Fn(),YB=Fn(),qB=Fn(),XB=Fn(),JB=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),QB=at({argsMap:t=>[t.getTrackId()]}),ZB=at({argsMap:t=>[t.getTrackId()]}),e6=at({argsMap:(t,r,i)=>[t.getTrackId(),r.label,i]}),Ot=class Ute extends Gp{get videoHeight(){if(Nr()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Nr()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,s,c,u,h){if(super(r,u),le(this,"trackMediaType",Bp.VIDEO),le(this,"_player",void 0),le(this,"isUseScaleResolutionDownBy",!1),le(this,"_videoVisibleTimer",null),le(this,"_previousVideoVisibleStatus",void 0),le(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),le(this,"_encoderConfig",void 0),le(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),le(this,"_optimizationMode",void 0),le(this,"_saveEncodeBitrateRatio",1),le(this,"_videoHeight",void 0),le(this,"_videoWidth",void 0),le(this,"_forceBitrateLimit",void 0),le(this,"_enabled",!0),le(this,"_processorDestination",void 0),le(this,"_processorContext",void 0),Nr()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],i&&this._hints.indexOf(Qt.CUSTOM_TRACK)!==-1?this._encoderConfig=xn(i):this._encoderConfig=i,this._hints.indexOf(Qt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(UR(Kt.CHROME,115)&&fb().indexOf("Windows")!==-1){const m=function(g,y){if("VideoFrame"in window&&"TransformStream"in window&&It().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(g),x=new MediaStreamTrackGenerator({kind:"video"});let S,C,M=Date.now();const D=()=>{j&&(clearInterval(j),j=void 0),S&&(S.close(),S=void 0),g.stop(),C=void 0,x.removeEventListener("ended",D)};let j=window.setInterval(()=>{if(C&&S&&Date.now()-M>1e3)try{x.readyState==="live"?C.enqueue(S.clone()):D()}catch{D()}},1e3);const $=new TransformStream({transform:(K,J)=>{x.readyState==="live"?(C=J,M=Date.now(),S===void 0?(S=K,J.enqueue(K.clone())):(J.enqueue(S),S=K)):K.close()}});return x.addEventListener("ended",D),_.readable.pipeThrough($).pipeTo(x.writable),x}}(r);m&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(Qt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new PV(this.getTrackId(),"local"),this._processorDestination=new OV(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=_n(_n(_n({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new TA(s):this._player=new Db(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Vp.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return i||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await fn(this,He.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await fn(this,He.NEED_MUTE_TRACK,this):await fn(this,He.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),R.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new he(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Ws(r),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const s=Pb({encoderConfig:r});(Nr()||ai()||Us())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const u=new he(H.UNEXPECTED_ERROR,c.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(Qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(R)}}getStats(){return td(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ea(this,He.GET_STATS)||_n({},fA)}async setBeautyEffect(r){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await wA(r)}async findClosestProfile(){const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings(),{width:c,height:u,frameRate:h}=this._encoderConfig||{},m=Dp(this._videoWidth||r||c||0),g=Dp(this._videoHeight||i||u||0),y=function(_,x,S){if(!Array.isArray(G("VIDEO_ENCODER_CONFIG_LIST"))||G("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const C=Math.min(_,x);return!(C>=480)&&_n(_n({},G("VIDEO_ENCODER_CONFIG_LIST").find(M=>M.height>C)),{},{frameRate:S})}(m,g,Dp(s||h||15));if(y)return R.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(y))),this.setEncoderConfiguration(y)}async setBitrateLimit(r){R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void R.error(H.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await fn(this,He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=i,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return R.error(H.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){jV(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch($g)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new he(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Ws(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!r||!i||!s)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(g,y,_,x,S){const C=G("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:x,max:S};if(S===void 0){const M=Math.floor(200*Math.pow(_/15,.6)*Math.pow(g*y/640/360,.75));S=C==="STANDARD_BITRATE"?4*M:2*M,x=x??M}else x=x??Math.floor(S/10);return{min:x,max:S}}(r,i,s,u,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,G("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){const[g,y]=function(_,x,S){const C=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(_*x/230400,.75)),M=_*x,D=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let $=ya(D).call(D).next().value,K=1;if(D.has(M))$=D.get(M);else{var J;const Fe=gu(J=Array.from(D.entries())).call(J,(ot,wt)=>{let[_t]=ot,[qt]=wt;return _t-qt}),ht=Fe.find(ot=>{let[wt]=ot;return wt>M});if(ht){const ot=Fe.indexOf(ht);if(ot>0){const wt=Fe[ot-1],_t=(M-wt[0])/(ht[0]-wt[0]);$=wt[1]+_t*(ht[1]-wt[1])}else $=ht[1]}else $=Fe[Fe.length-1][1]}if(j.has(M))K=j.get(M);else{var ne;const Fe=gu(ne=Array.from(j.entries())).call(ne,(ot,wt)=>{let[_t]=ot,[qt]=wt;return _t-qt}),ht=Fe.find(ot=>{let[wt]=ot;return wt>M});if(ht){const ot=Fe.indexOf(ht);if(ot>0){const wt=Fe[ot-1],_t=(M-wt[0])/(ht[0]-wt[0]);K=wt[1]+_t*(ht[1]-wt[1])}else K=ht[1]}else K=Fe[Fe.length-1][1]}const ae=G("VIDEO_NEW_BITRATE_RATIO");ae&&ae>0&&($=ae/100);const Q=Math.floor(C*$),oe=Math.floor(65e4*Math.pow(_*x/230400,.5)*Math.pow(S/15,.69));let ge=Q;const Ee=G("VIDEO_STANDARD_BITRATE_VERSION");return Ee&&Ee>0&&(Ee===1?ge=C:Ee===2?ge=Q:Ee===3&&(ge=oe)),[Math.floor(ge/1e3),K]}(r,i,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=y,R.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=kF.checkOneElementVisible(u),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const y=$e.reportApiInvoke(null,{tag:dn.TRACER,name:Tn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new he(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new he(H.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=_n(_n({},s),Ws(r))),s=Au(s);const c=en(8,"track-video-cloned-"),u=new Ute(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Au(this._scalabilityMode),this._optimizationMode,c,Au(this._hints));return r&&s&&u.setEncoderConfiguration(s),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new he(H.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new he(H.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(td(()=>{$e.reportApiInvoke(null,{name:Tn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:dn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void R.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new he(H.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void R.warning("Video track is not published, SEI can not be send");const s=i.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):R.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Ni.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fn(this,He.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ni.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ba.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ba.REQUEST_CONSTRAINTS)}},Mt(Ot.prototype,"play",[NB,RB],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),Mt(Ot.prototype,"stop",[AB],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),Mt(Ot.prototype,"setEnabled",[IB,OB,PB],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),Mt(Ot.prototype,"setMuted",[DB,kB,jB],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),Mt(Ot.prototype,"setSaveEncodeBitrateRatio",[LB,MB],Object.getOwnPropertyDescriptor(Ot.prototype,"setSaveEncodeBitrateRatio"),Ot.prototype),Mt(Ot.prototype,"setEncoderConfiguration",[UB,FB],Object.getOwnPropertyDescriptor(Ot.prototype,"setEncoderConfiguration"),Ot.prototype),Mt(Ot.prototype,"getStats",[VB],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),Mt(Ot.prototype,"setBeautyEffect",[BB,GB],Object.getOwnPropertyDescriptor(Ot.prototype,"setBeautyEffect"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameData",[WB],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameData"),Ot.prototype),Mt(Ot.prototype,"getCurrentFrameImage",[$B],Object.getOwnPropertyDescriptor(Ot.prototype,"getCurrentFrameImage"),Ot.prototype),Mt(Ot.prototype,"findClosestProfile",[HB,zB],Object.getOwnPropertyDescriptor(Ot.prototype,"findClosestProfile"),Ot.prototype),Mt(Ot.prototype,"setBitrateLimit",[KB],Object.getOwnPropertyDescriptor(Ot.prototype,"setBitrateLimit"),Ot.prototype),Mt(Ot.prototype,"setOptimizationMode",[YB],Object.getOwnPropertyDescriptor(Ot.prototype,"setOptimizationMode"),Ot.prototype),Mt(Ot.prototype,"setScalabiltyMode",[qB],Object.getOwnPropertyDescriptor(Ot.prototype,"setScalabiltyMode"),Ot.prototype),Mt(Ot.prototype,"updateMediaStreamTrackResolution",[XB],Object.getOwnPropertyDescriptor(Ot.prototype,"updateMediaStreamTrackResolution"),Ot.prototype),Mt(Ot.prototype,"pipe",[JB],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),Mt(Ot.prototype,"unpipe",[QB],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),Mt(Ot.prototype,"close",[ZB],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),Mt(Ot.prototype,"replaceTrack",[e6],Object.getOwnPropertyDescriptor(Ot.prototype,"replaceTrack"),Ot.prototype),Ot),kb=(t6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),n6=Fn(),r6=kp("CameraVideoTrack","_enabledMutex"),i6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),a6=Fn(),s6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),o6=Fn(),c6=at({argsMap:t=>[t.getTrackId()]}),Ha=class Fte extends un{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,c,u,h){super(r,Ws(i.encoderConfig),c,u,h),le(this,"_config",void 0),le(this,"_originalConstraints",void 0),le(this,"_constraints",void 0),le(this,"_enabled",!0),le(this,"_deviceName","default"),le(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ip()||BR())&&!function(){const m=Wt();if(m.os!==vr.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&NF()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=Ws(this._config.encoderConfig),on.on(Ur.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.on(Ur.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await $a.getDeviceById(r),s={};s.video=_n({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Wa(s,this.getTrackId())}catch(u){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Wa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await $a.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:_n(_n({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Wa(i,this.getTrackId())}catch(c){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Wa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=_n({},i.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Wa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await fn(this,He.NEED_ENABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await fn(this,He.NEED_DISABLE_TRACK,this)}catch(s){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new he(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Ws(r),G("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const s=xn(this._config);s.encoderConfig=r;const c=Pb(s);(Nr()||ai()||Us())&&(c.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new he(H.UNEXPECTED_ERROR,u.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Qt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fn(this,He.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ai()||Us())&&this._enabled&&!this._isClosed&&on.duringInterruption){const r=async()=>{on.off(Ur.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};on.on(Ur.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vp.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=$a.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const c=await Wa({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),on.off(Ur.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),on.off(Ur.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;r&&(s=_n(_n({},s),Ws(r))),s=Au(s);const c=en(8,"track-cam-cloned-"),u=new Fte(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Au(_n(_n({},this._config),{},{encoderConfig:s})),Au(this._constraints),Au(this._scalabilityMode),this._optimizationMode,c);return r&&s&&u.setEncoderConfiguration(s),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(Ba.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){s(c)}}),this.processorContext.on(Ba.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Mt(Ha.prototype,"setDevice",[t6,n6],Object.getOwnPropertyDescriptor(Ha.prototype,"setDevice"),Ha.prototype),Mt(Ha.prototype,"setEnabled",[r6,i6,a6],Object.getOwnPropertyDescriptor(Ha.prototype,"setEnabled"),Ha.prototype),Mt(Ha.prototype,"setEncoderConfiguration",[s6,o6],Object.getOwnPropertyDescriptor(Ha.prototype,"setEncoderConfiguration"),Ha.prototype),Mt(Ha.prototype,"close",[c6],Object.getOwnPropertyDescriptor(Ha.prototype,"close"),Ha.prototype),Ha);function l6(t){const r=en(8,"track-cus-"),i=$e.reportApiInvoke(null,{id:r,tag:dn.TRACER,name:Tn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),s=new Vn(t.mediaStreamTrack,t.encoderConfig?Ab(t.encoderConfig):{},r,!1);return R.info("create custom audio track success with config",t,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s}function CA(t,r,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=_n(_n({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?R.debug("[".concat(t,"] set content hint to"),i.optimizationMode):R.debug("[".concat(t,"] set content hint failed")))):R.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var d6,u6,h6,p6,us,m6,f6,g6,v6,y6,_6,b6,Kr;class E6 extends EV{getUserId(){return this._userId}constructor(r,i,s,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(en(5,""))),le(this,"_userId",void 0),le(this,"_uintId",void 0),le(this,"_isDestroyed",!1),le(this,"store",void 0),le(this,"processor",void 0),le(this,"processorContext",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Hp=(d6=at({argsMap:(t,r,i)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),u6=at({argsMap:t=>[t.getTrackId()]}),h6=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),p6=at({argsMap:t=>[t.getTrackId()]}),Mt((us=class extends E6{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Jr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,i,s,c){super(t,r,i,s),le(this,"_videoVisibleTimer",null),le(this,"_previousVideoVisibleStatus",void 0),le(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),le(this,"trackMediaType",Bp.VIDEO),le(this,"_videoWidth",void 0),le(this,"_videoHeight",void 0),le(this,"_player",void 0),le(this,"_prePlayer",void 0),le(this,"processorDestination",void 0),le(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new PV(this.getTrackId(),"remote"),this.processorDestination=new OV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return td(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ea(this,He.GET_STATS)||_n({},_V)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(ds.PLAY_START),typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=_n(_n({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(i);else{let s=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new TA(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(i)):this._player=new Db(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ds.FIRST_FRAME_DECODED),c&&this.safeEmit(ds.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(ds.VIDEO_STATE_CHANGED,u)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ds.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(ds.PLAY_END)}stop(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(t),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){jV(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch($g)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=kF.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=$e.reportApiInvoke(null,{tag:dn.TRACER,name:Tn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new he(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new he(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ni.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ni.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ju.SEI_RECEIVED,t)}}).prototype,"play",[d6],Object.getOwnPropertyDescriptor(us.prototype,"play"),us.prototype),Mt(us.prototype,"stop",[u6],Object.getOwnPropertyDescriptor(us.prototype,"stop"),us.prototype),Mt(us.prototype,"pipe",[h6],Object.getOwnPropertyDescriptor(us.prototype,"pipe"),us.prototype),Mt(us.prototype,"unpipe",[p6],Object.getOwnPropertyDescriptor(us.prototype,"unpipe"),us.prototype),us),zp=(m6=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),f6=at({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),g6=at({argsMap:(t,r)=>[t.getTrackId(),r]}),v6=at({argsMap:t=>[t.getTrackId()]}),y6=at({argsMap:t=>[t.getTrackId()]}),_6=at({argsMap:(t,r)=>[t.getTrackId(),r.name]}),b6=at({argsMap:t=>[t.getTrackId()]}),Mt((Kr=class extends E6{get isPlaying(){return this._useAudioElement?hi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,i,s){super(t,r,i,s),le(this,"trackMediaType",Bp.AUDIO),le(this,"_source",void 0),le(this,"_useAudioElement",!0),le(this,"_volume",100),le(this,"processorContext",void 0),le(this,"processorDestination",void 0),le(this,"_played",!1),le(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new SA,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bA(t,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Va.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ds.FIRST_FRAME_DECODED)}),this.processorContext=new kV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new DV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Va.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Va.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Va.ON_AUDIO_BUFFER),this._source.on(Va.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?hi.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}setAmplifiedVolume(t){this._useAudioElement&&this._played&&(hi.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,t=Math.min(t,G("MAX_WEBAUDIO_VOLUME")),this._volume=t,this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!hV())throw new he(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await hi.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?hi.getVolume(this.getTrackId()):this._source instanceof bA?this._source.getAudioVolume():0}getStats(){return td(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ea(this,He.GET_STATS)||_n({},yV)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),hi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(R.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?hi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&hi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new he(H.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new he(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new he(H.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ni.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ni.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ni.ON_TRACK),this.processorDestination.removeAllListeners(Ni.ON_NODE)}}).prototype,"setVolume",[m6],Object.getOwnPropertyDescriptor(Kr.prototype,"setVolume"),Kr.prototype),Mt(Kr.prototype,"setAmplifiedVolume",[f6],Object.getOwnPropertyDescriptor(Kr.prototype,"setAmplifiedVolume"),Kr.prototype),Mt(Kr.prototype,"setPlaybackDevice",[g6],Object.getOwnPropertyDescriptor(Kr.prototype,"setPlaybackDevice"),Kr.prototype),Mt(Kr.prototype,"play",[v6],Object.getOwnPropertyDescriptor(Kr.prototype,"play"),Kr.prototype),Mt(Kr.prototype,"stop",[y6],Object.getOwnPropertyDescriptor(Kr.prototype,"stop"),Kr.prototype),Mt(Kr.prototype,"pipe",[_6],Object.getOwnPropertyDescriptor(Kr.prototype,"pipe"),Kr.prototype),Mt(Kr.prototype,"unpipe",[b6],Object.getOwnPropertyDescriptor(Kr.prototype,"unpipe"),Kr.prototype),Kr);const xa=new class extends An{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),le(this,"_lastHiddenTime",0),le(this,"_lastVisibleTime",0),le(this,"needUploadStats",[]),le(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),R.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class x6 extends An{constructor(r,i){super(),le(this,"trackMediaType",Bp.DATA),le(this,"_version",1),le(this,"_type",3),le(this,"_config",void 0),le(this,"_originDataChannel",void 0),le(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),le(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),le(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ke((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const s=setTimeout(()=>{var c;i(new he(H.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new he(H.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new he(H.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[Ib.OPEN,Ib.CLOSE,Ib.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),r.addEventListener(i,s)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;r.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class vge extends x6{constructor(r){super(r),le(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&R.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(Ib.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class yge extends x6{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function jb(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>k_.revokeObjectURL(t),0),new Worker(k_.createObjectURL(t))}const S6=71,NA=1,RA=2,AA=1,w6=2;var rd=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(rd||{});function IA(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=t.getUint8(0);if(i!==S6)return;const s=t.getUint16(1),c=NA+RA+s,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:i,tlvLen:s,tlv:[],frame:u};let m=NA+RA;for(;m<c;){const g=t.getUint8(m),y=t.getUint16(m+AA),_=AA+w6;if(g===rd.AUDIO_LEVEL){let x=t.getUint8(m+_);for(let S=1;S<y;S++)x=x<<8|t.getUint8(m+_+S);h.tlv.push({tag:g,length:y,value:r?127^x>>1:127&x})}else if(g===rd.METADATA||g===rd.AUDIO_64_BIT_PTS){const x=new Uint8Array(y);for(let S=0;S<y;S++)x[S]=t.getUint8(m+_+S);h.tlv.push({tag:g,length:y,value:x})}m+=_+y}return h}const Lb=new Map,Mb=127,Uu=1e-10,OA=139/13,Ub=new Map;function PA(t,r,i){const s="".concat(t,"-").concat(r,"-").concat(i);let c=0;return Ub.has(s)?c=Ub.get(s):(c=Math.log(function(h,m){const g=h-m;m<g&&(m=g);let y=1;for(let _=h,x=1;_>m;_--,x++)y=y*_/x;return y}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(i)+i*t,Ub.set(s,c)),c<Uu&&(c=Uu),c}function T6(t,r,i){const s=r.length,c=t.length/s;let u=!1;for(let h=0,m=0;h<s;h++){let g=0;for(let y=m+c;m<y;m++)t[m]>i&&g++;r[h]!==g&&(r[h]=g,u=!0)}return u}window.cache=Ub;let _ge=0;class C6{constructor(r){le(this,"id",void 0),le(this,"immediates",[]),le(this,"lastNonSilence",-1),le(this,"immediateSpeechActivityScore",Uu),le(this,"lastLevelChangedTime",Date.now()),le(this,"levels",[]),le(this,"longs",[]),le(this,"longSpeechActivityScore",Uu),le(this,"mediums",[]),le(this,"mediumSpeechActivityScore",Uu),le(this,"minLevel",0),le(this,"nextMinLevel",0),le(this,"nextMinLevelWindowLength",0),le(this,"energyScore",0),this.id=r||"".concat(_ge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,s=this.minLevel+OA;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<s&&(h=0);const m=Math.floor(h/OA);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return T6(this.mediums,this.longs,4)}computeMediums(){return T6(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=PA(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=PA(this.longs[0],10,47),this.longSpeechActivityScore>Uu&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=PA(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(Kj(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let s=r;return r<0&&(s=0),r>Mb&&(s=Mb),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+OA?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>Mb&&(i=Mb),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class bge{constructor(r){le(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class DA{constructor(r,i,s){le(this,"isDominant",void 0),le(this,"energyRanking",void 0),le(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=s}}class Ege extends An{constructor(r){super(),le(this,"dominantId",null),le(this,"lastDecisionTime",0),le(this,"lastLevelChangedTime",0),le(this,"lastLevelIdleTime",0),le(this,"relativeSpeechActivities",[]),le(this,"speakers",new Map),le(this,"enableSilence",!1),le(this,"timeoutToSilenceInterval",0),le(this,"decisionMaker",null),le(this,"loudest",[]),le(this,"numLoudestToTrack",3),le(this,"energyExpireTimeMs",250),le(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),s!=null&&(this.energyAlphaPct=s),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const s=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const u=c.levelChanged(i,s);return this.updateLoudestList(c,u,s)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new C6(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,s){const c=r.id===this.dominantId;if(i<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new DA(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new DA(c,0,r.energyScore);const u=s-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new DA(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new bge(this),this.decisionMaker.execute())}makeDecision(r){let i=null,s=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=ya(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const _=this.speakers.entries().next();_.value&&(u=_.value[0],m=_.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let y=2;for(const _ of this.speakers.entries()){const[x,S]=_;if(S===m)continue;S.evaluateSpeechActivityScores(r);for(let j=0;j<g.length;++j){const $=m==null?Uu:m.getSpeechActivityScore(j);g[j]=Math.log(S.getSpeechActivityScore(j)/$)}const C=g[0],M=g[1],D=g[2];C>3&&M>2&&D>0&&M>y&&(y=M,u=x)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===i||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let s=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):s=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(r){const i=[];for(const c of ya(s=this.speakers).call(s)){var s;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Kp=new Map;let Ao=null,Fb=null;const N6=3;let Fu=[];const Io=new Map,Vb=new Map;class xge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){le(this,"id",void 0),le(this,"track",void 0),le(this,"score",0),le(this,"active",!0),le(this,"muted",!1),le(this,"timer",0),le(this,"actives",0),le(this,"inactives",0),this.id=r,this.track=i,this.setActive(Io.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:s}=function(){const c=[],u=[];return Array.from(ya(Io).call(Io)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&s.length>0){let c;s.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let s;return Array.from(ya(Io).call(Io)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!s||c.score<s.score)&&(s=c)}),s}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let s;return Array.from(ya(Io).call(Io)).forEach(c=>{c.active||c.id===i||c.samples<40||(!s||c.score>s.score)&&(s=c)}),s}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Bb;function R6(t){const r=Io.get(t);r&&(Io.delete(t),r.clearTimer())}const Gb=new Map,Sge=new Map,kA="video/h264",jA="video/h265";function A6(t,r,i){let s=new Uint8Array(t,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(c.push(s[u],s[u+1],s[u+3]),u+=4):(c.push(s[u]),u++);return new Uint8Array(c)}function I6(t){const r=t.length;let i=[],s=0;for(;s<r;)s+2<r&&t[s]===0&&t[s+1]===0&&(t[s+2]===0||t[s+2]===1||t[s+2]===2||t[s+2]===3)?(i.push(t[s],t[s+1],3,t[s+2]),s+=3):(i.push(t[s]),s++);return new Uint8Array(i)}function O6(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const i=r+(t[r+2]===0?4:3);if(i>=t.length)return"";const s=t[i];return 128&s?"":(s>>1&63)>=32||i+1<t.length&&!(248&t[i+1])?jA:(31&s)<=31?kA:""}const Wb=new Map,Jg=new Map;(function(){const t=Wt();_r.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),_r.getStreamFromExtension=t.name===Kt.CHROME&&Number(t.version)>34,_r.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),_r.supportMinBitrate=t.name===Kt.CHROME||t.name===Kt.EDGE,_r.supportSetRtpSenderParameters=function(){const r=Wt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!fc()||!(!Nr()&&!gb())||r.name===Kt.FIREFOX&&Number(r.version)>=64)}(),t.name===Kt.SAFARI&&(Number(t.version)>=14?_r.supportDualStream=!0:_r.supportDualStream=!1),_r.webAudioMediaStreamDest=function(){const r=Wt();return!(r.name===Kt.SAFARI&&Number(r.version)<12)}(),_r.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",_r.supportWebGL=typeof WebGLRenderingContext<"u",_r.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,fc()||(_r.webAudioWithAEC=!0),_r.supportShareAudio=function(){const r=Wt();return(r.os===vr.WIN_10||r.os===vr.WIN_81||r.os===vr.WIN_7||r.os===vr.LINUX||r.os===vr.MAC_OS||r.os===vr.CHROMIUM_OS)&&r.name===Kt.CHROME&&Number(r.version)>=74}(),_r.supportDataChannel=!!(No(76)||FR(68)||xF(14)),_r.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!En()&&!!r&&r.prototype.setConfiguration instanceof Function}(),_r.supportWebRTCEncodedTransform=No(87)||_F()||FR(117),_r.supportWebRTCInsertableStream=function(){const r=Wt();return(r.name===Kt.CHROME||r.name===Kt.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_r.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,_r.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,_r.supportSuppressLocalAudioPlayback=fV(),_r.supportRestrictOwnAudio=gV(),yb(()=>{_r.supportDualStreamEncoding=function(){const r=Wt();return!!G("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.debug("browser ua: ",navigator.userAgent),R.info("browser info: ",t),R.info("browser compatibility: ",_r)})})();const wge=["CHINA","GLOBAL"],P6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Vu=[],Yp=[];function Bu(t,r){return!!r&&Vu.some(i=>i.uid===t&&i.channelName===r)}function LA(){return Yp.length>0}var Tge=F4.forEach,D6=z0("forEach")?[].forEach:function(t){return Tge(this,t,arguments.length>1?arguments[1]:void 0)};Zt({target:"Array",proto:!0,forced:[].forEach!==D6},{forEach:D6});var Cge=as("Array","forEach"),Nge=Hl,Rge=ri,Age=N,Ige=Cge,MA=Array.prototype,Oge={DOMTokenList:!0,NodeList:!0},Pge=function(t){var r=t.forEach;return t===MA||Age(MA,t)&&r===MA.forEach||Rge(Oge,Nge(t))?Ige:r},Dge=d(Pge),kge=lc,k6=Q0;Zt({target:"Object",stat:!0,forced:p(function(){k6(1)})},{keys:function(t){return k6(kge(t))}});var jge=d(zt.Object.keys),Lge=d($j),Mge=d(zj),Uge=Zt,j6=lg,Fge=h_,Vge=et,L6=XT,Bge=$l,Gge=At,Wge=fN,$ge=Zn,Hge=Kl,zge=A4("slice"),Kge=$ge("species"),UA=Array,Yge=Math.max;Uge({target:"Array",proto:!0,forced:!zge},{slice:function(t,r){var i,s,c,u=Gge(this),h=Bge(u),m=L6(t,h),g=L6(r===void 0?h:r,h);if(j6(u)&&(i=u.constructor,(Fge(i)&&(i===UA||j6(i.prototype))||Vge(i)&&(i=i[Kge])===null)&&(i=void 0),i===UA||i===void 0))return Hge(u,m,g);for(s=new(i===void 0?UA:i)(Yge(g-m,0)),c=0;m<g;m++,c++)m in u&&Wge(s,c,u[m]);return s.length=c,s}});var qge=as("Array","slice"),Xge=N,Jge=qge,FA=Array.prototype,Qge=function(t){var r=t.slice;return t===FA||Xge(FA,t)&&r===FA.slice?Jge:r},Zge=d(Qge);function je(t,r,i,s,c){var u,h,m,g={};return Dge(u=jge(s)).call(u,function(y){g[y]=s[y]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Lge(h=Mge(m=Zge(i).call(i)).call(m)).call(h,function(y,_){return _(t,r,y)||y},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(T4(t,r,g),null):g}let $b=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),VA=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),hs=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t[t.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",t}({}),Ri=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),tt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),kt=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),ze=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t.VOS_FALLBACK="vos_fallback",t.VOS_FALLBACK_PROMISE="vos_fallback_promise",t}({}),Xe=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SET_DUAL_STREAM_MODE="set_dual_stream_mode",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.CONFIGURE="configure",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),Gu=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),mt=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t.ENABLE_MULTI_STREAM="enable_multi_stream",t}({}),Ai=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Et=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t.ON_FALLBACK="websocket:on_fallback",t}({});function Hb(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw R.error("Invalid Channel Name ".concat(t)),new ce(H.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function zb(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||OF(t,1,255)))throw new ce(H.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let il=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const eve={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},BA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function GA(t,r){Mr(t.url,"".concat(r,".url"),1,1e3,!1),kn(t.x)||ln(t.x,"".concat(r,".x"),0,1e4),kn(t.y)||ln(t.y,"".concat(r,".y"),0,1e4),kn(t.width)||ln(t.width,"".concat(r,".width"),0,1e4),kn(t.height)||ln(t.height,"".concat(r,".height"),0,1e4),kn(t.zOrder)||ln(t.zOrder,"".concat(r,".zOrder"),0,255),kn(t.alpha)||ln(t.alpha,"".concat(r,".alpha"),0,1,!1)}const tve={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let id=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),WA=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),cr=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function M6(t){if(!t.channelName)throw new ce(H.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new ce(H.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Mr(t.token,"info.token",1,2047),zb(t.uid),Hb(t.channelName),!0}let Bi=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),al=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),ta=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),qp=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),nn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),$n=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t.VOS_FALLBACK="vos-fallback",t.VOS_FALLBACK_PROMISE="vos-fallback-promise",t.RESET_SIGNAL="reset-signal",t.DATACHANNEL_FAILBACK="datachannel-failback",t}({}),Kb=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),br=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Xt=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const U6=[Xt.AFRICA,Xt.ASIA,Xt.CHINA,Xt.EUROPE,Xt.GLOBAL,Xt.INDIA,Xt.JAPAN,Xt.NORTH_AMERICA,Xt.OCEANIA,Xt.OVERSEA,Xt.SOUTH_AMERICA];let Qr=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const Yb={CHINA:{},ASIA:{CODE:Qr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Qr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Qr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Qr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Qr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Qr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Qr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Qr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Qr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Qr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Qr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Qr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Qr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aA&&(Yb.CHINA={CODE:Qr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Oo=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",t.FALLBACK_TO_HLS="fallback_to_hls",t.UPDATE_VOS_CONFIGURE="update_vos_configure",t}({});function F6(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class V6 extends An{constructor(r,i){super(),L(this,"onICEConnectionStateChange",void 0),L(this,"onConnectionStateChange",void 0),L(this,"onDTLSTransportStateChange",void 0),L(this,"onDTLSTransportError",void 0),L(this,"onICETransportStateChange",void 0),L(this,"onFirstAudioReceived",void 0),L(this,"onFirstVideoReceived",void 0),L(this,"onFirstAudioDecoded",void 0),L(this,"onFirstVideoDecoded",void 0),L(this,"onFirstVideoRender",void 0),L(this,"onFirstVideoBufferReady",void 0),L(this,"onFirstVideoDecodedTimeout",void 0),L(this,"onSelectedLocalCandidateChanged",void 0),L(this,"onSelectedRemoteCandidateChanged",void 0),L(this,"onICECandidateError",void 0),L(this,"getLocalVideoStats",void 0)}}class qb extends V6{constructor(r,i){super(r,i),L(this,"establishPromise",void 0)}}let Ge=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ar=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),sl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const B6=["disconnected","failed"];let Ae=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Jt=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Je=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t.FirstVideoPreRender="FirstVideoPreRender",t.FirstVideoBufferReady="FirstVideoBufferReady",t}({}),$s=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Hs=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ir=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),ad=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),lr=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),_c=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),ps=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Po=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Xp=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Hn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Jp=function(t){return t.ABORT="abort",t}({}),sd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),nve=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const rve={[$b.ACCESS_POINT]:{[Ri.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ri.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ri.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ri.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ri.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ri.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ri.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[$b.UNILBS]:{[hs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[hs.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[$b.STRING_UID_ALLOCATOR]:{[VA.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[VA.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[VA.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Qp(t){const r=rve[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[t%1e4];if(!i){if(Math.floor(t/1e4)===$b.ACCESS_POINT){const s=t%1e4;if(s.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const ive={[tt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[tt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[tt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[tt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[tt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[tt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[tt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[tt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[tt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[tt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[tt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[tt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[tt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[tt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[tt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[tt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[tt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[tt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[tt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[tt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[tt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[tt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[tt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[tt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[tt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[tt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[tt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[tt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[tt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[tt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[tt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[tt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[tt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[tt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[tt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[tt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[tt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[tt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[tt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[tt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[tt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[tt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[tt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[tt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[tt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[tt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[tt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[tt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[tt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[tt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[tt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[tt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[tt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[tt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[tt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[tt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[tt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[tt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[tt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[tt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[tt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[tt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[tt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[tt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Wu(t){return ive[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function G6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function $A(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?G6(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):G6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function HA(t,r){if(typeof t=="string")return t;const{proxy:i,host:s,port:c}=t;if(r){const u=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const ave=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,sve=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,ove=/wss:\/\/(.+):([0-9]+)\/?/,cve=/wss:\/\/(.[^\/]+)\/?/;let lve=0;class dve{constructor(r,i){L(this,"id",0),L(this,"store",void 0),L(this,"recordIndex",void 0),L(this,"websockets",[]),L(this,"try443PortDuration",2e3),L(this,"forceCloseWSDuration",5e3),L(this,"try443PortTimeout",null),L(this,"forceCloseTimeout",null),L(this,"isTry443PortFailed",!1),L(this,"isNormalPortFailed",!1),L(this,"useDoubleDomain",!1),L(this,"useProxy",!1),L(this,"startTime",Date.now()),this.id=++lve,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];R.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,s){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:s});const c=G("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(S=>{var C;return Re(C=r.host).call(C,S)});m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(S=>{g.push(HA($A($A({},r),{},{host:r.host.replace(m,S)}),i))});else{const S=$A({},r);if(i&&m){const C=c.find(M=>M!==m);C&&(S.host=S.host.replace(m,C))}g.push(HA(S,i))}try{g.forEach(S=>{const C=new WebSocket(S);C.binaryType="arraybuffer",h.push(C),this.logger("ws is connecting:",C.url)})}catch(S){if(this.logger("ws create failed"),h.forEach(C=>C.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,s);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,s);throw new ce(H.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const y=Fg();this.store&&this.store.recordJoinChannelService({urls:h.map(S=>S.url),service:"gateway"},this.recordIndex),h.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(C=>{C!==S&&(C.onopen=null,C.onclose=null,C.onmessage=null,C.close(),this.logger("close backup websocket: ".concat(C.url)))}),this.websockets.length=0,y.resolve(S)},S.onclose=C=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(S.readyState));const M=h.every(D=>D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(M)),M&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(C.reason)),y.reject({code:C.code,reason:Kb.A_ROUND_WS_FAILED})):!i&&M&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),x()),i?this.isTry443PortFailed=M:this.isNormalPortFailed=M},S.onmessage=C=>this.logger("".concat(S.url," onmessage: ").concat(C.data))}),this.websockets.push(...h);const _=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},x=()=>{if(y.isResolved)return _();Wt().os===vr.MAC_OS&&En()&&_(),this.createWebSocket(r,!0,!0).then(S=>{y.resolve(S)}).catch(S=>{this.isNormalPortFailed&&y.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return s||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,x()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(r,i,s,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,g;return[,h,m,g]=u.match(ave)||[],h||([,m,g]=u.match(sve)||[]),m&&g||([,m,g]=u.match(ove)||[]),m&&g||([,m]=u.match(cve)||[]),m||R.warning("un-destructible url: ",u),{proxy:h,host:m,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,s&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(r,!!s,!1).finally(()=>this.clearTimeout())}}function W6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class $6 extends An{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Re(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Et.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Et.CONNECTED):this._state==="closed"?this.emit(Et.CLOSED):this._state==="failed"&&this.emit(Et.FAILED))}resetReconnectCount(r){R.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),L(this,"_websocketUrl",null),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"urls",[]),L(this,"_reconnectMode","tryNext"),L(this,"reconnectReason",void 0),L(this,"_initMutex",void 0),L(this,"name",void 0),L(this,"_state","closed"),L(this,"reconnectInterrupter",void 0),L(this,"websocket",void 0),L(this,"retryConfig",void 0),L(this,"reconnectCount",0),L(this,"forceCloseTimeout",5e3),L(this,"onlineReconnectListener",void 0),L(this,"useCompress",void 0),L(this,"tryDoubleDomain",!1),L(this,"use443PortOnly",!1),L(this,"wsInflateLength",0),L(this,"wsDeflateLength",0),L(this,"closeEstablishingWs",()=>{}),L(this,"store",void 0),L(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(x){for(var S=1;S<arguments.length;S++){var C=arguments[S]!=null?arguments[S]:{};S%2?W6(Object(C),!0).forEach(function(M){L(x,M,C[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(C)):W6(Object(C)).forEach(function(M){Object.defineProperty(x,M,Object.getOwnPropertyDescriptor(C,M))})}return x}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Rr("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=i,y=Math.max(300,Math.floor(3*m/5)),_=Math.max(1.2,Math.floor(8*g)/10);Ti.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=_),jn.on(Nu.NETWORK_STATE_CHANGE,(x,S)=>{x!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(x)),x===Ti.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{var c;const u=Fg(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(m){return!(Nb()||G("USE_NEW_TOKEN")||!G("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||G("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(lr.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(u.resolve).catch(u.reject),this.once(Et.CLOSED,()=>{u.reject(new he(H.WS_DISCONNECT))}),this.once(Et.CONNECTED,u.resolve),await u.promise}catch{}finally{s()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new he(H.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(s){throw new he(H.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const s=Fg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=_=>{var x;(x=this.store)===null||x===void 0||x.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async _=>{var x;if(R.debug("[".concat(this.name,"] websocket close ").concat((x=this.websocket)===null||x===void 0?void 0:x.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new he(H.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ea(this,Et.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,C=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return s.reject(new he(H.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);s.resolve()}},h=_=>{this.emit(Et.ON_MESSAGE,_)},m=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=G("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),r);const g=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;this._websocketUrl=HA(r);const _=await this.chooseBestWebsocketConnection(r);this.websocket=_,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(_){const x=this.state==="closed",S=_ instanceof he,C=S&&_.code===H.WS_ABORT,M=S&&_.code===H.WS_ERR,D=S?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[_]},g),x||M?(s.reject(x?new he(H.WS_DISCONNECT,"websocket is closed: ".concat(D)):new he(H.WS_ERR,"init websocket failed: ".concat(D))),M&&R.error("[".concat(this.name,"] init websocket failed: ").concat(D))):u&&u(_)}return s.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||jn.isOnline||!jn.onlineWaiter||(this.onlineReconnectListener=jn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,i){const h=_b(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ke.race([yr(h),this.onlineReconnectListener||new ke(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Et.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await er(this,Et.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;R.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;if(Array.isArray(m)){if(Re(m).call(m,"dynamic key expired"))return this.emit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(Re(m).call(m,"request downgrade fallback"))return this.emit(Et.ON_FALLBACK),!1}return this.reconnectWithAction(r,i)}return!0}}class zA extends $6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const s=Fg(),c=function(h,m){return new dve(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new he(H.WS_ABORT,"choose best websocket aborted"))};const u=G("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Qg extends $6{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new ke((s,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),h.forEach(M=>{M.onclose=null,M.onopen=null,M.onmessage=null,M.close()}),c(new he(H.WS_ABORT,"choose best websocket aborted"))};const m=G("GATEWAY_DOMAINS");let g;const y=r.indexOf("?h="),_=m.find(M=>y!==-1?Re(r).call(r,M,y):Re(r).call(r,M));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",m);let x=!this.tryDoubleDomain||!_;if(!x&&_){var S;const M=Date.now();try{m.forEach(D=>{const j=y===-1?r.replace(_,D):r.substr(0,y)+r.substr(y).replace(_,D),$=new WebSocket(j);$.binaryType="arraybuffer",h.push($),R.debug("[choose-best-ws] ws is connecting:",$.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();x=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:h.map(D=>D.url),service:"gateway"},i),h.forEach(D=>{D.onopen=()=>{if(u)return;const j=Date.now()-M;R.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter($=>$!==D).forEach($=>{R.debug("[choose-best-ws]close backup websocket: ".concat($.url)),$.close()}),u=!0,s(D)},D.onclose=j=>{g=j,!u&&(h.find($=>!($.readyState===WebSocket.CLOSED||$.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),u=!0,c(g)))},D.onmessage=j=>{R.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(j.data))}}),yr(this.forceCloseTimeout).then(()=>{h.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(x){var C;let M;R.debug("[choose-best-ws] use single url: ",r),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[r],service:"gateway"},i);try{M=new WebSocket(r),h.push(M),M.binaryType="arraybuffer"}catch(D){const j=new he(H.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return R.error("[".concat(this.name,"]").concat(j)),void c(j)}M.onopen=()=>{s(M)},M.onclose=D=>{c(D)},M.onmessage=D=>{R.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(D.data))},yr(this.forceCloseTimeout).then(()=>{M&&M.readyState!==WebSocket.OPEN&&M.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class H6 extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),L(this,"__name__","AgoraRTCSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"wsInflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===mt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===mt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(c._type===mt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case tt.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case tt.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case tt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case tt.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case tt.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",$r.OFFLINE)})}async request(r,i,s,c){const u=en(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new ke((M,D)=>{if(this.connectionState===kt.CONNECTED)return M();const j=()=>{this.off(ze.WS_CLOSED,$),M()},$=()=>{this.off(ze.WS_CONNECTED,j),D(new ce(H.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,$),r!==Xe.PUBLISH&&r!==Xe.PUBLISH_DATASTREAM&&r!==Xe.SUBSCRIBE&&r!==Xe.SUBSCRIBE_DATASTREAM&&r!==Xe.UNSUBSCRIBE&&r!==Xe.UNSUBSCRIBE_DATASTREAM&&r!==Xe.UNPUBLISH&&r!==Xe.UNPUBLISH_DATASTREAM&&r!==Xe.CONTROL&&r!==Xe.RESTART_ICE||this.once(ze.DISCONNECT_P2P,()=>{D(new ce(H.DISCONNECT_P2P))}),r!==Xe.PUBLISH&&r!==Xe.RESTART_ICE||this.once(ze.ABORT_P2P_EXECUTION,()=>{D(new ce(H.DISCONNECT_P2P))})});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Xe.JOIN||r===Xe.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const y=new ke((M,D)=>{let j=!1;const $=(J,ne)=>{j=!0,M({isSuccess:J==="success",message:ne||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{D(new ce(H.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await y}catch(M){if(this.connectionState===kt.CLOSED||r===Xe.LEAVE)throw new ce(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===Xe.JOIN||r===Xe.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Wu(x),C=new ce(H.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===tt.ERR_TOO_MANY_BROADCASTERS?((r===Xe.JOIN||r===Xe.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===tt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$r.MULTI_IP)):this.reconnect(S.action,$r.SERVER_ERROR),r===Xe.JOIN||r===Xe.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ke(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Gu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ke((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,c=>s(this.initError||new ce(H.WS_ABORT,c))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,ze.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(Xe.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!i)return this.emit(ze.REPORT_JOIN_GATEWAY,Kb.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ce(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Ru(this,ze.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Xe.REJOIN,r);return!!i&&(this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(s=>{this.emit(mt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(mt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(mt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(mt.MUTE_AUDIO,{uid:s.uid}):this.emit(mt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(mt.MUTE_VIDEO,{uid:s.uid}):this.emit(mt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(mt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(mt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(mt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(mt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(mt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Xe.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Wu(r.code);if(r.code===28&&"detail"in r&&(R.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(ze.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===tt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Dt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):r.code===tt.K_VOS_FALLBACK&&"detail"in r?(R.info("[".concat(this.clientId,"] receive vos fallback notification: "),r.detail),r.detail==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")?void er(this,ze.VOS_FALLBACK_PROMISE,r.detail).then(()=>{this.reconnect("recover",i.desc)}).catch(s=>{R.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),s)}):r.detail==="fallback_hls"&&G("ENABLE_FALLBACK_TO_HLS")?(this.emit(ze.VOS_FALLBACK,r.detail),void this.close(Dt.FALLBACK_TO_HLS)):this.reconnect(i.action,i.desc)):void this.reconnect(i.action,$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$r.TIMEOUT):this.request(Xe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Xe.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(Gu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(Et.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(Et.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(Et.WILL_RECONNECT,(r,i,s)=>{const c=Ru(this,ze.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=Kb.P2P_DISCONNECTED),u&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(ze.REPORT_JOIN_GATEWAY,i||Kb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ze.DISCONNECT_P2P)),s(r)}),this.websocket.on(Et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",$r.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ce){if(r.code===H.UNEXPECTED_RESPONSE&&r.data.code===tt.ERR_NO_AUTHORIZED)return this.initError=new ce(H.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Dt.TOKEN_EXPIRE);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$r.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Et.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.PRE_CONNECT_PC,()=>{this.emit(ze.PRE_CONNECT_PC)}),this.websocket.on(Et.ON_FALLBACK,()=>{G("ENABLE_FALLBACK_TO_HLS")&&this.emit(ze.VOS_FALLBACK,"fallback_hls")})}}let uve=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),qn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function z6(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Xb(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?z6(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z6(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let KA=0;function zs(t){const r=G("TURN_DOMAINS");KA=(KA+1)%r.length;const i=r[KA]||"edge.agora.io";return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(i):(R.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function Jb(t){try{const r=G("TURN_DOMAINS"),i=G("GATEWAY_DOMAINS").concat(r).find(s=>Re(t).call(t,s));return i?t.split(".".concat(i))[0].replace(/-/g,"."):t}catch{return R.debug("serverUrlToIp error, fallback to url",t),t}}function YA(t,r){t.addresses||(t.addresses=[]);const i=function(m,g){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(x=>{let{ip:S,port:C}=x;return{address:"".concat(S,":").concat(C)}});const y=G("GATEWAY_DOMAINS");let _=y[1]&&Re(g).call(g,y[1])?1:0;return m.map(x=>{let{domain_prefix:S,port:C,ip:M}=x;if(S)return{address:"".concat(S,".").concat(y[_++%y.length],":").concat(C)};const D=/^[\.\:\d]+$/.test(M),j=D?"".concat(M.replace(/[^\d]/g,"-"),".").concat(y[_++%y.length],":").concat(C):"".concat(M,":").concat(C);return D||R.debug("Cannot recognized as ip address: ".concat(M,", use as host3")),{ip:M,port:C,address:j}})}(t.addresses,r),s=Array.isArray(t.detail)&&t.detail[18];if(s&&typeof s=="string"){const m=s.split(";");for(let g=0;g<m.length;g++){var c;const y=Si(c=m[g]).call(c);i[g]&&y&&(i[g].ip6=y)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,g]=u.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Gi(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function K6(t){const r=t._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Gi(r.width),"x").concat(Gi(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function Qb(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Zg(t,r){let i,s,c;switch(r){case qn.CHOOSE_SERVER:s=4096,c="choose server";break;case qn.CLOUD_PROXY:s=1048576,c="proxy";break;case qn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case qn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new ce(H.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>Xb(Xb({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:Xb(Xb({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!i)throw new ce(H.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return i}async function Y6(t,r){return await ke.all(t.addresses.map(async i=>({address:zs(i.ip),tcpport:i.port,udpport:i.port,username:r&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Hr.username,password:r&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await HR(r.toString()):Hr.password})))}function qA(t,r){const i=r.getMediaStreamTrack(!0).getSettings(),s=r.videoHeight||i.height,c=r.videoWidth||i.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Gi(t.height),Gi(t.width)),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function od(t){let{candidateType:r,relayProtocol:i,type:s,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:i,protocol:h};if(s!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=u}return m}function bc(t){const r=t.split(":"),i=t.split(/[-.]/),s=Re(t).call(t,"-")?"-":".";let c=t;return r.length>1?i.length>1?(i[1]="**",c=i[0]+s+"**:"+r[r.length-1]):c=r.length>2?r[0]+s+"**:"+r[r.length-1]:"**:"+r[r.length-1]:i.length>1&&(c=i[0]+s+"**"),c}function q6(t,r){return t.getTransceivers().find(i=>i.sender.track===r||i.receiver.track===r)}function ev(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(r){return r in xb}(t)?t:xb.L1T3}const X6={[Ge.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Ge.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function J6(t){t.send&&(Zp(Ge.VIDEO,t.send.videoExtensions),Zp(Ge.AUDIO,t.send.audioExtensions)),t.recv&&(Zp(Ge.VIDEO,t.recv.videoExtensions),Zp(Ge.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(Zp(Ge.VIDEO,t.sendrecv.videoExtensions),Zp(Ge.AUDIO,t.sendrecv.audioExtensions))}function Q6(t,r){t.send&&(Zb(Ge.VIDEO,t.send.videoExtensions,r.send.videoExtensions),Zb(Ge.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(Zb(Ge.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),Zb(Ge.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))}function Zb(t,r,i){r.forEach(s=>{var c;const u=X6[t].find(m=>{var g;let{key:y}=m;return Re(g=s.extensionName).call(g,y)});if(!u)return;const h=i.find(m=>{let{extensionName:g}=m;return Re(g).call(g,u.key)});h&&Re(c=h.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=h.extensionName)})}function Zp(t,r){r.forEach(i=>{var s;const c=X6[t].find(u=>{var h;let{key:m}=u;return Re(h=i.extensionName).call(h,m)});Re(s=i.extensionName).call(s,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function Z6(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Re(t).call(t,"abs-send-time")}function eE(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Re(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function e8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function t8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function tv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:y,unsupportedVideoDownlinkCodec:_}=r,{useXR:x}=i;let S=[],C=[],M=[],D=[],j=!1,$=!1;if(Ci(t).mediaDescriptions.forEach(J=>{s&&s!==J.attributes.direction||(J.media.mediaType!=="video"||j||(C=J.attributes.payloads,D=J.attributes.extmaps,j=!0),J.media.mediaType!=="audio"||$||(S=J.attributes.payloads,M=J.attributes.extmaps,$=!0))}),!D||C.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!M||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(C.forEach(J=>{var ne;(ne=J.rtpMap)!==null&&ne!==void 0&&ne.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),x&&J.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(J=>{var ne;(ne=J.rtpMap)!==null&&ne!==void 0&&ne.clockRate&&(J.rtpMap.clockRate=parseInt(J.rtpMap.clockRate)),x&&J.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(J=>{var ne;return((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())!=="rtx"}),C=C.filter(J=>{var ne;return((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())!=="rtx"})),u){const J=C.filter(Q=>{var oe;return/(red)|(ulpfec)|(flexfec)/i.test(((oe=Q.rtpMap)===null||oe===void 0?void 0:oe.encodingName)||"")}),ne=cd(J,C).map(Q=>Q.payloadType),ae=[...J.map(Q=>Q.payloadType),...ne];C=C.filter(Q=>!Re(ae).call(ae,Q.payloadType))}if(h&&(S=S.filter(J=>{var ne;return!/(red)|(ulpfec)|(flexfec)/i.test(((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(J=>{var ne;return Re(m).call(m,((ne=J.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const J=C.filter(ne=>{var ae;return Re(g).call(g,((ae=ne.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLowerCase())||"")});C=J.concat(c?[]:cd(J,C))}const K=G("UNSUPPORTED_VIDEO_CODEC");if(K&&K.length>0){const J=C.filter(Q=>Q.rtpMap&&Re(K).call(K,Q.rtpMap.encodingName.toLowerCase())),ne=cd(J,C),ae=J.concat(ne).map(Q=>Q.payloadType);C=C.filter(Q=>!Re(ae).call(ae,Q.payloadType)),R.debug("unsupportedVideoCodec: ".concat(K,", toBeRemoved: ").concat(ae))}if(y&&y.length>0&&s==="sendonly"){const J=C.filter(Q=>Q.rtpMap&&Re(y).call(y,Q.rtpMap.encodingName.toLowerCase())),ne=cd(J,C),ae=J.concat(ne).map(Q=>Q.payloadType);C=C.filter(Q=>!Re(ae).call(ae,Q.payloadType)),R.debug("unsupportedVideoUplinkCodec: ".concat(y,", toBeRemoved: ").concat(ae))}if(_&&_.length>0&&s==="recvonly"){const J=C.filter(Q=>Q.rtpMap&&Re(_).call(_,Q.rtpMap.encodingName.toLowerCase())),ne=cd(J,C),ae=J.concat(ne).map(Q=>Q.payloadType);C=C.filter(Q=>!Re(ae).call(ae,Q.payloadType)),R.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(ae))}return{audioCodecs:S,videoCodecs:C,audioExtensions:M,videoExtensions:D}}function Ec(t){const r=Ci(t);let i,s;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!s){const u=c.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&r.attributes.fingerprints.length>0&&(s={fingerprints:r.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function XA(t,r){const i=[],s=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const g=(m=s.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?g:void 0})});else if(s.length>0){const h=s[0].ssrcIds[0],m=s[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function n8(t,r,i){const{cname:s}=t;let c=[];r&&(c=r8(r)),c.length===0&&(c=t.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),R.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=rv(t.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(_=>{y.push({kind:Ge.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:Ge.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:s,preSSRCs:y}}function r8(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(bc(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(bc(t.ip6),":").concat(t.port)))),r}function nv(t,r,i){const s=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const g=en(8,"track-"),y={ssrcId:h,attributes:t8({label:g,mslabel:i=i||en(10,""),msid:"".concat(i," ").concat(g)},r&&{cname:r})};if(s.push(y),m!==void 0){const _={ssrcId:m,attributes:t8({label:g,mslabel:i,msid:"".concat(i," ").concat(g)},r&&{cname:r})};s.push(_),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:s,ssrcGroups:c}}function $u(t,r){r instanceof Vn&&t.attributes.payloads.forEach(i=>{var s;const c=(s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),c==="opus"&&typeof G("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=G("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!En()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),r instanceof Xg&&c==="opus"&&r._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function JA(t){const r=t.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function QA(t,r){var i;if(t.attributes.payloads.forEach(c=>{var u;((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&G("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(r instanceof un&&r._encoderConfig&&r._hints.indexOf(Qt.SCREEN_TRACK)===-1))return;const s=r._encoderConfig;It().supportMinBitrate&&s.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;Re(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),It().supportMinBitrate&&!Re(i=r._hints).call(i,Qt.LOW_STREAM)&&s.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;Re(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function i8(t){if(t.media.mediaType!=="video")return;const r=Wt();if(r.name!==Kt.SAFARI&&r.os!==vr.IOS)return;const i=t.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));i!==-1&&t.attributes.extmaps.splice(i,1)}function tE(t,r,i){if(!r)return;let s,c;if(t.media.mediaType==="video"?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=s.find(h=>eE(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(g=>eE(g.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,y){return y.filter(_=>!!g.find(x=>x.payloadType===_.payloadType&&!!x.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(y=>y.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>eE(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=s.find(h=>Z6(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(g=>g.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(g,y){return y.filter(_=>!!g.find(x=>x.payloadType===_.payloadType&&!!x.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(y=>y.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>Z6(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function ZA(t,r,i){if(En()||t.media.mediaType!=="video"||!(r instanceof un)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!G("SIMULCAST")||i==="vp9"&&G("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const s=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<s;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:xn(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:xn(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function a8(){try{const t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:xb.L1T3}]});const r=await t.createOffer();if(!r.sdp)return void t.close();const i=Ci(r.sdp).mediaDescriptions[0];if(!i)return;const s=i.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return t.close(),s}catch{return}}async function eI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const _=tv(y,m,g,"sendonly"),x=tv(y,m,g,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(_,x,"videoExtensions",S,C,M),Ks(_,x,"videoCodecs",S,C,M),Ks(_,x,"audioExtensions",S,C,M),Ks(_,x,"audioCodecs",S,C,M),G("RAISE_H264_BASELINE_PRIORITY")){const D=[],j=[];if(M.videoCodecs.forEach(($,K)=>{var J;if(((J=$.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){var ne,ae;const Q=M.videoCodecs[K+1],oe=Q&&l8($,Q),ge=(ne=$.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"],Ee=(ae=$.fmtp)===null||ae===void 0?void 0:ae.parameters["packetization-mode"];!ge||ge!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Ee!==G("FIRST_PACKETIZATION_MODE")?oe?j.push([$,Q]):j.push([$]):oe?D.push([$,Q]):D.push([$])}}),D.length>0&&j.length>0){R.debug("raising H264 baseline profile priority"),M.videoCodecs.forEach((K,J)=>{var ne;if(((ne=K.rtpMap)===null||ne===void 0?void 0:ne.encodingName.toLocaleLowerCase())==="h264"){const ae=l8(K,M.videoCodecs[J+1]),Q=D.shift()||j.shift()||[];Q.length>0&&(ae?M.videoCodecs.splice(J,2,...Q):M.videoCodecs.splice(J,1,...Q))}});const $=C.videoCodecs.filter(K=>{var J,ne;return((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ne=K.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID")});if($.length>0){const K=cd($,C.videoCodecs).map(ne=>ne.payloadType),J=[...$.map(ne=>ne.payloadType),...K];C.videoCodecs=C.videoCodecs.filter(ne=>!Re(J).call(J,ne.payloadType))}G("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(K=>{var J,ne;return!(((J=K.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((ne=K.fmtp)===null||ne===void 0?void 0:ne.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:C,sendrecv:M}}return{send:S,recv:C,sendrecv:M}}(t,r,s);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function s8(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=tv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(t,r,"videoExtensions",i,s,c),Ks(t,r,"videoCodecs",i,s,c),Ks(t,r,"audioExtensions",i,s,c),Ks(t,r,"audioCodecs",i,s,c),G("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){R.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(s.videoCodecs=s.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:s,sendrecv:c}}function Ks(t,r,i,s,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return t[i].forEach(m=>{r[i].some((g,y)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(y),!0})?u[i].push(m):s[i].push(m)}),void r[i].forEach((m,g)=>{h.indexOf(g)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return t[i].forEach(m=>{r[i].some((g,y)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(y),!0})?u[i].push(m):s[i].push(m)}),void r[i].forEach((m,g)=>{h.indexOf(g)===-1&&c[i].push(m)})}}function rv(t){const{send:r,recv:i,sendrecv:s}=t;if(!s){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...s.audioCodecs],c.videoCodecs=[...r.videoCodecs,...s.videoCodecs],c.audioExtensions=[...r.audioExtensions,...s.audioExtensions],c.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):c=xn(s),i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...s.audioCodecs],u.videoCodecs=[...i.videoCodecs,...s.videoCodecs],u.audioExtensions=[...i.audioExtensions,...s.audioExtensions],u.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):u=xn(s),{send:c,recv:u}}function em(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function iv(t,r,i,s){let c=[];if(t===Ge.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return Re(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],g=[];if(i.videoCodecs.forEach(y=>{const _=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";Re(_).call(_,s)?u.push(y):Re(_).call(_,"vp9")?h.push(y):Re(_).call(_,"vp8")?m.push(y):Re(_).call(_,"h264")&&g.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):g.length!==0&&(u=g,y="h264"),R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=r.videoCodecs.filter(y=>u.some(_=>_.payloadType===y.payloadType)))}if(c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const u=cd(c,r.videoCodecs);c=[...c,...u]}}else{c=r.audioCodecs.filter(h=>{var m;return Re(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,s)});const u=r.audioCodecs.filter(h=>{var m;return Re(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(R.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(h=>{var m;return Re(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),G("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function cd(t,r){const i=t.map(s=>s.payloadType.toString());return r.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&Re(i).call(i,s.fmtp&&s.fmtp.parameters.apt))}async function na(t,r,i){const s=r.toString(),c=o8(s,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:s});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=tI(h,i||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function tI(t,r,i){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;const s=Ci(t),{useXR:c}=r;return s.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!Re(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&em(u),u.media.mediaType==="video"&&function(m){m.media.mediaType==="video"&&G("ENABLE_DOWN_SPS_PPS")&&m.attributes.payloads.filter(g=>{var y;return((y=g.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(u),c&&Re(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),rl(s)}function o8(t,r,i,s){if(G("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(s,`
`),t),r==="offer"?c=>{o8(c,"answer",i==="local"?"remote":"local",s)}:void 0}async function c8(t,r,i){try{var s;if(!It().supportSetRtpSenderParameters||!function(g){return g==="vp9"||g==="av1"}(t)||!G("ENABLE_SVC"))return;const c={},u={},h=r.getParameters(),m=(s=h.encodings)===null||s===void 0?void 0:s[0];u.scalabilityMode=ev(i),m&&Object.assign(m,u),Object.assign(h,c),await r.setParameters(h),R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(h.encodings)))}catch(c){R.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function nE(t){const r=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>Re(t).call(t,i))}function l8(t,r){try{var i;return((i=t.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function d8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Sa(t,r){return typeof G(t)===r?G(t):void 0}function hve(){try{const t=G("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?d8(Object(s),!0).forEach(function(c){L(r,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):d8(Object(s)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(s,c))})}return r}({},t)}catch(t){return R.debug("handle gateway attributes failed: ",t),{}}}const u8={};function xc(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&R.debug("install service ".concat(t.name)),u8[t.name]=t}function Do(t){const r=u8[t];if(!r)throw new he(H.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function h8(t,r){return Do("DataStream").create(t,r)}function rE(){return Do("InterceptFrame").create()}function p8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Or(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?p8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const nI=new Map;class pve extends An{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit($n.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit($n.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var s,c,u;super(),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"key",void 0),L(this,"ntpOffset",0),L(this,"usingProxy",!1),L(this,"signal",void 0),L(this,"role",void 0),L(this,"isPreallocation",void 0),L(this,"isPreSub",void 0),L(this,"inChannelInfo",{joinAt:null,duration:0}),L(this,"spec",void 0),L(this,"_state","DISCONNECTED"),L(this,"_statsCollector",void 0),L(this,"_disconnectedReason",void 0),L(this,"isSignalRecover",!1),L(this,"hasChangeBGPAddress",!1),L(this,"trafficStatsInterval",void 0),L(this,"networkQualityInterval",void 0),L(this,"_joinGatewayStartTime",0),L(this,"_signalTimeout",!1),L(this,"_clientRoleOptions",void 0),L(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(s={spec:Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Do("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,s)):this.store.useDcSignal?function(h){return Do("DataChannelSignal").create(h)}({spec:Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),store:r}):new H6(Or(Or({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(r){this.usingProxy=r}async join(r,i,s){if(this.store.useDcSignal){let _=!1;r.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(r.cloudProxyServer,")")),_=!0):"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length>255||"".concat(r.apResponse.cid,"_").concat(r.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):r.apResponse.addresses.some(x=>x.fingerprint)||G("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=nI.get(r.cname);if(u||(u=new Map,nI.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const _=new ce(H.UID_CONFLICT);throw $e.joinGateway(r.sid,{lts:c,succ:!1,ec:_.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:r.preload}),_}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{R.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(h));const _=r.gatewayAddrs.map(S=>{let{address:C}=S;const[M,D]=C.split(":"),j={host:M,port:D};return r.proxyServer&&(j.proxy=r.proxyServer),j});let x;x=this.store.useDcSignal?await this.signal.init(r.apResponse.addresses):await this.signal.init(_),h=x.uid,R.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var y;throw _.code===H.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||$e.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=_.data)===null||y===void 0?void 0:y.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:r.preload}),_&&_.code===H.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(R.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),u.delete(r.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit($n.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit($n.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit($n.NETWORK_QUALITY,{uplinkNetworkQuality:Qb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Qb(this._statsCollector.trafficStats.B_dnq)}):this.emit($n.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Dt.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==kt.CONNECTED||await function(s,c){return c===1/0?s:ke.race([s,Vfe(c)])}(this.signal.request(Xe.LEAVE,void 0,!0),3e3)}catch(s){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(i),i!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Xe.PUBLISH,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===tt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Xe.PUBLISH_DATASTREAM,u,!0)}catch(h){if(s&&h.data&&h.data.code===tt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Xe.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ke.all(r.map(i=>this.signal.request(Xe.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){R.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Xe.PRE_SUBSCRIBE,c,!0)}catch(u){if(s&&u.data&&u.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Xe.SUBSCRIBE,c,!0))._message}catch(u){if(s&&u.data&&u.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Xe.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(s&&u.data&&u.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Xe.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(i&&c.data&&c.data.code===tt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,u=s.width,h=s.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(r);if(i)return this.signal.request(Xe.SET_VIDEO_PROFILE,i);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(Xe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(s){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ke.all(r.map(s=>this.signal.request(Xe.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:i},!0)))}catch(s){R.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(r){try{await this.signal.request(Xe.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Xe.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Xe.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Xe.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),R.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let s,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const u=Object.assign({},i);delete u.delay,delete u.level,await this.signal.request(Xe.SET_CLIENT_ROLE,Or(Or({role:r,level:c,delay:s},u),{},{client_ts:Date.now()})),this.role=r}async setDualStreamMode(r,i,s){await this.signal.request(Xe.SET_DUAL_STREAM_MODE,{mode:r},s,i)}async setRemoteVideoStreamType(r,i){await this.signal.request(Xe.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Xe.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(Xe.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(Xe.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Xe.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Or({},this.inChannelInfo)}async setConfigure(r){if(r&&Array.isArray(r)&&r.length!==0)return this.signal.request(Xe.CONFIGURE,r)}async getGatewayVersion(){return(await this.signal.request(Xe.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=nI.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Hr.username,password:Hr.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Or(Or({},Hr),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Xe.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);s&&s.B_st!==i.B_st&&yb(()=>{this.emit($n.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var i,s,c,u;if(!this.joinInfo||!this.key)throw new ce(H.UNEXPECTED_ERROR,"can not generate join message, no join info");const h=Object.assign({},this.joinInfo.apResponse);let m=G("REPORT_APP_SCENARIO");if(typeof m!="string")try{m=JSON.stringify(m)}catch{m=void 0}var g;m&&m.length>128&&(m=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit($n.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,Re(Yp).call(Yp,g)||Yp.push(g);const y=Yg(this.store),_=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),x=pV(this.store),S=hve(),C=No(87)||_F()||FR(117),M=(function(){const K=Wt();if(K.name!==Kt.SAFARI||!K.browserVersion)return!1;const J=K.browserVersion.split(".");return Number(J[0])>18||Number(J[0])===18&&Number(J[1])>=4}()||SF(18,4,!1))&&VR(18,6,!0)&&this.spec.codec==="h264"&&G("ENABLE_ABSSENDTIME_AS_SENTTS"),D=!(((s=h.detail)===null||s===void 0?void 0:s[3])!=="CN"||!G("ENABLE_QUALITY_FALLBACK"))&&G("ENABLE_QUALITY_FALLBACK"),j=!!G("ENABLE_AP_MULTI_IP")&&((c=h.detail)===null||c===void 0?void 0:c[5])==="multi-ip",$=Or({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:cs,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:h,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:m,attributes:{userAttributes:Or(Or({enableEncodedTransform:(!!G("ENABLE_AUDIO_METADATA")||!!G("ENABLE_AUDIO_PTS"))&&C||!!G("ENABLE_AUDIO_TOPN")&&UR(Kt.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!G("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Sa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Sa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Sa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:x,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Sa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("FORCE_ENABLE_AUT_CC")||!Nb()&&(!!G("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Sa("USE_XR","boolean"),enableLossbasedBwe:Sa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("FORCE_ENABLE_AUT_CC")||!Nb()&&(!!G("ENABLE_AUT_CC")||void 0),enableCCFallback:Sa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:y?Sa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Sa("PUBLISH_TWCC","boolean"),enableSubTWCC:Sa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Sa("USE_PUB_RTX","boolean"),enableSubRTX:Sa("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0,enableVosFallback:G("ENABLE_VOS_FALLBACK"),enableQualityFallback:D},S),{},{audioDuplicate:Sa("ENABLE_AUDIO_RED","boolean")?(u=Sa("AUDIO_DUPLICATE_NUM","number"))!==null&&u!==void 0?u:2:void 0,senttsUsesAbsSendTime:!!M||void 0,enableDualStreamFlag:Sa("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&($.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&($.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?($.aes_secret=this.joinInfo.aespassword,$.aes_encrypt=!0):$.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&($.aes_salt=this.joinInfo.aessalt)),h.addresses[this.signal.websocket.currentURLIndex]&&($.ap_response.ticket=h.addresses[this.signal.websocket.currentURLIndex].ticket,delete h.addresses),this.joinInfo.defaultVideoStream!==void 0&&($.default_video_stream=this.joinInfo.defaultVideoStream),$}getRejoinMessage(){if(!this.joinInfo)throw new ce(H.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ze.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ze.WS_RECONNECTING,r=>{this.joinInfo&&$e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||$r.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",$e.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ze.WS_CLOSED,r=>{let i;switch(r){case Dt.LEAVE:i=$r.LEAVE;break;case Dt.UID_BANNED:case Dt.IP_BANNED:case Dt.CHANNEL_BANNED:case Dt.SERVER_ERROR:i=$r.SERVER_ERROR;break;case Dt.FALLBACK:i=$r.FALLBACK;break;case Dt.LICENSE_MISSING:case Dt.LICENSE_EXPIRED:case Dt.LICENSE_MINUTES_EXCEEDED:case Dt.LICENSE_PERIOD_INVALID:case Dt.LICENSE_MULTIPLE_SDK_SERVICE:case Dt.LICENSE_ILLEGAL:case Dt.TOKEN_EXPIRE:i=r;break;default:i=$r.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+$r.NETWORK_ERROR)),this.joinInfo&&$e.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Dt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Dt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ze.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if($e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));sn("EVENT_REPORT_DOMAIN",r[1]),sn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),sn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(mt.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(ze.REQUEST_RECOVER,(r,i,s)=>{if(!this.joinInfo)return s(new ce(H.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,er(this,$n.REQUEST_NEW_GATEWAY_LIST).then(i).catch(s)}),this.signal.on(ze.REQUEST_JOIN_INFO,async(r,i,s)=>{var c,u,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=xn((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(G("NEW_TURN_MODE")&&m&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let S=m.servers.map(D=>"turnServerURL"in D&&G("USE_TURN_IP")?Or(Or({},D),{},{turnServerURL:Jb(D.turnServerURL)}):D),C=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(D=>G("USE_TURN_IP")?Or(Or({},D),{},{turnServerURL:Jb(D.turnServerURL)}):D);const M=this.signal.currentURLIndex;S.length>0&&(S=[S[M%S.length]],m.servers=S),Array.isArray(C)&&C.length>0&&(C=[C[0]],m.serversFromGateway=C),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(M))}const{iceParameters:y,dtlsParameters:_,rtpCapabilities:x}=await er(this,$n.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:y,dtlsParameters:_,rtpCapabilities:x,version:"2"}}))}catch(S){i(S)}}),this.signal.on(ze.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(ze.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let s,c="";var u;r instanceof ce?(s=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):s=r,$e.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(ze.IS_P2P_DISCONNECTED,r=>{r(Ru(this,$n.IS_P2P_DISCONNECTED))}),this.signal.on(ze.DISCONNECT_P2P,()=>{this.emit($n.DISCONNECT_P2P)}),this.signal.on(ze.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ze.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ze.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit($n.JOIN_RESPONSE,r,i)}),this.signal.on(ze.PRE_CONNECT_PC,async(r,i)=>{if(this.joinInfo){var s,c;this.updateTurnConfigFromSignal();const h=this.getCurrentGatewayAddress(),m=xn((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(G("NEW_TURN_MODE")&&m&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var u;let y=m.servers.map(S=>"turnServerURL"in S&&G("USE_TURN_IP")?Or(Or({},S),{},{turnServerURL:Jb(S.turnServerURL)}):S),_=(u=m.serversFromGateway)===null||u===void 0?void 0:u.map(S=>G("USE_TURN_IP")?Or(Or({},S),{},{turnServerURL:Jb(S.turnServerURL)}):S);const x=this.signal.currentURLIndex;y.length>0&&(y=[y[x%y.length]],m.servers=y),Array.isArray(_)&&_.length>0&&(_=[_[0]],m.serversFromGateway=_),R.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(x,",in pre pc"))}const g=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(h&&g){const y=r8(h);er(this,$n.PRE_CONNECT_PC,{candidates:y,fingerprint:g,turnServer:m}).then(_=>{r==null||r(_)}).catch(i||(()=>{}))}}}),this.signal.on(ze.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(r))}),this.signal.on(ze.VOS_FALLBACK,r=>{this.emit($n.VOS_FALLBACK,r)}),this.signal.on(ze.DATACHANNEL_FAILBACK,r=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit($n.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(Xe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(Xe.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(s){throw R.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(Xe.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(Xe.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(s){throw R.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(r){const i={users:r.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(Xe.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(r,i){const s={action:r.find(c=>c.stream_type===nn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Xe.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const s={action:r.find(c=>c.stream_type===nn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Xe.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const s={action:r===Ge.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Xe.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const s={action:r===Ge.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Xe.CONTROL,s,!0,!0)}catch(c){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Xe.RESTART_ICE,i,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||$r.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(R.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Xe.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Dt.FALLBACK)),this.store.useDcSignal=!1,this.signal=new H6(Or(Or({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit($n.RESET_SIGNAL)}}let iE=0,rI=0;function ko(t,r,i,s){return new ke((c,u)=>{r.timeout=r.timeout||G("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),iE+=gc(r.data)):i&&(r.data.size?iE+=r.data.size:r.data instanceof FormData?iE+=WF(r.data):iE+=gc(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ui.request(r).then(h=>{typeof h.data=="string"?rI+=gc(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?rI+=h.data.byteLength:rI+=gc(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Ui.isCancel(h)?u(new ce(H.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new ce(H.NETWORK_TIMEOUT,h.message)):h.response?u(new ce(H.NETWORK_RESPONSE_ERROR,h.response.status)):u(new ce(H.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ve){var Pe=0;return function(){return Pe<ve.length?{done:!1,value:ve[Pe++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(ve,Pe,We){return ve==Array.prototype||ve==Object.prototype||(ve[Pe]=We.value),ve},s,c=function(ve){ve=[typeof globalThis=="object"&&globalThis,ve,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var Pe=0;Pe<ve.length;++Pe){var We=ve[Pe];if(We&&We.Math==Math)return We}throw Error("Cannot find global object")}(this);function u(ve,Pe){if(Pe)e:{var We=c;ve=ve.split(".");for(var _e=0;_e<ve.length-1;_e++){var O=ve[_e];if(!(O in We))break e;We=We[O]}(Pe=Pe(_e=We[ve=ve[ve.length-1]]))!=_e&&Pe!=null&&i(We,ve,{configurable:!0,writable:!0,value:Pe})}}function h(ve){return(ve={next:ve})[Symbol.iterator]=function(){return this},ve}function m(ve){var Pe=typeof Symbol<"u"&&Symbol.iterator&&ve[Symbol.iterator];return Pe?Pe.call(ve):{next:r(ve)}}if(u("Symbol",function(ve){function Pe(O,X){this.A=O,i(this,"description",{configurable:!0,writable:!0,value:X})}if(ve)return ve;Pe.prototype.toString=function(){return this.A};var We="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",_e=0;return function O(X){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new Pe(We+(X||"")+"_"+_e++,X)}}),u("Symbol.iterator",function(ve){if(ve)return ve;ve=Symbol("Symbol.iterator");for(var Pe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),We=0;We<Pe.length;We++){var _e=c[Pe[We]];typeof _e=="function"&&typeof _e.prototype[ve]!="function"&&i(_e.prototype,ve,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ve}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var y={};try{y.__proto__={a:!0},g=y.a;break e}catch{}g=!1}s=g?function(ve,Pe){if(ve.__proto__=Pe,ve.__proto__!==Pe)throw new TypeError(ve+" is not extensible");return ve}:null}var _=s;function x(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(ve){if(ve.m)throw new TypeError("Generator is already running");ve.m=!0}function C(ve,Pe){return ve.h=3,{value:Pe}}function M(ve){this.g=new x,this.G=ve}function D(ve,Pe,We,_e){try{var O=Pe.call(ve.g.j,We);if(!(O instanceof Object))throw new TypeError("Iterator result "+O+" is not an object");if(!O.done)return ve.g.m=!1,O;var X=O.value}catch(ee){return ve.g.j=null,ve.g.s(ee),j(ve)}return ve.g.j=null,_e.call(ve.g,X),j(ve)}function j(ve){for(;ve.g.h;)try{var Pe=ve.G(ve.g);if(Pe)return ve.g.m=!1,{value:Pe.value,done:!1}}catch(We){ve.g.v=void 0,ve.g.s(We)}if(ve.g.m=!1,ve.g.l){if(Pe=ve.g.l,ve.g.l=null,Pe.F)throw Pe.D;return{value:Pe.return,done:!0}}return{value:void 0,done:!0}}function $(ve){this.next=function(Pe){return ve.o(Pe)},this.throw=function(Pe){return ve.s(Pe)},this.return=function(Pe){return function(We,_e){S(We.g);var O=We.g.j;return O?D(We,"return"in O?O.return:function(X){return{value:X,done:!0}},_e,We.g.return):(We.g.return(_e),j(We))}(ve,Pe)},this[Symbol.iterator]=function(){return this}}function K(ve,Pe){return Pe=new $(new M(Pe)),_&&ve.prototype&&_(Pe,ve.prototype),Pe}if(x.prototype.o=function(ve){this.v=ve},x.prototype.s=function(ve){this.l={D:ve,F:!0},this.h=this.C||this.u},x.prototype.return=function(ve){this.l={return:ve},this.h=this.u},M.prototype.o=function(ve){return S(this.g),this.g.j?D(this,this.g.j.next,ve,this.g.o):(this.g.o(ve),j(this))},M.prototype.s=function(ve){return S(this.g),this.g.j?D(this,this.g.j.throw,ve,this.g.o):(this.g.s(ve),j(this))},u("Array.prototype.entries",function(ve){return ve||function(){return function(Pe,We){Pe instanceof String&&(Pe+="");var _e=0,O=!1,X={next:function(){if(!O&&_e<Pe.length){var ee=_e++;return{value:We(ee,Pe[ee]),done:!1}}return O=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(Pe,We){return[Pe,We]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var J=function(ve,Pe){for(var We=0;We<ve.length;We++)Pe(ve[We])},ne=function(ve){return ve.replace(/\r?\n|\r/g,`\r
`)},ae=function(ve,Pe,We){return Pe instanceof Blob?(We=We!==void 0?We+"":typeof Pe.name=="string"?Pe.name:"blob",Pe.name===We&&Object.prototype.toString.call(Pe)!=="[object Blob]"||(Pe=new File([Pe],We)),[String(ve),Pe]):[String(ve),String(Pe)]},Q=function(ve,Pe){if(ve.length<Pe)throw new TypeError(Pe+" argument required, but only "+ve.length+" present.")},oe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ge=oe.FormData,Ee=oe.XMLHttpRequest&&oe.XMLHttpRequest.prototype.send,Fe=oe.Request&&oe.fetch,ht=oe.navigator&&oe.navigator.sendBeacon,ot=oe.Element&&oe.Element.prototype,wt=oe.Symbol&&Symbol.toStringTag;wt&&(Blob.prototype[wt]||(Blob.prototype[wt]="Blob"),"File"in oe&&!File.prototype[wt]&&(File.prototype[wt]="File"));try{new File([],"")}catch{oe.File=function(Pe,We,_e){return Pe=new Blob(Pe,_e||{}),Object.defineProperties(Pe,{name:{value:We},lastModified:{value:+(_e&&_e.lastModified!==void 0?new Date(_e.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),wt&&Object.defineProperty(Pe,wt,{value:"File"}),Pe}}var _t=function(ve){return ve.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},qt=function(ve){this.i=[];var Pe=this;ve&&J(ve.elements,function(We){if(We.name&&!We.disabled&&We.type!=="submit"&&We.type!=="button"&&!We.matches("form fieldset[disabled] *"))if(We.type==="file"){var _e=We.files&&We.files.length?We.files:[new File([],"",{type:"application/octet-stream"})];J(_e,function(O){Pe.append(We.name,O)})}else We.type==="select-multiple"||We.type==="select-one"?J(We.options,function(O){!O.disabled&&O.selected&&Pe.append(We.name,O.value)}):We.type==="checkbox"||We.type==="radio"?We.checked&&Pe.append(We.name,We.value):(_e=We.type==="textarea"?ne(We.value):We.value,Pe.append(We.name,_e))})};if((t=qt.prototype).append=function(ve,Pe,We){Q(arguments,2),this.i.push(ae(ve,Pe,We))},t.delete=function(ve){Q(arguments,1);var Pe=[];ve=String(ve),J(this.i,function(We){We[0]!==ve&&Pe.push(We)}),this.i=Pe},t.entries=function ve(){var Pe,We=this;return K(ve,function(_e){if(_e.h==1&&(Pe=0),_e.h!=3)return Pe<We.i.length?_e=C(_e,We.i[Pe]):(_e.h=0,_e=void 0),_e;Pe++,_e.h=2})},t.forEach=function(ve,Pe){Q(arguments,1);for(var We=m(this),_e=We.next();!_e.done;_e=We.next()){var O=m(_e.value);_e=O.next().value,O=O.next().value,ve.call(Pe,O,_e,this)}},t.get=function(ve){Q(arguments,1);var Pe=this.i;ve=String(ve);for(var We=0;We<Pe.length;We++)if(Pe[We][0]===ve)return Pe[We][1];return null},t.getAll=function(ve){Q(arguments,1);var Pe=[];return ve=String(ve),J(this.i,function(We){We[0]===ve&&Pe.push(We[1])}),Pe},t.has=function(ve){Q(arguments,1),ve=String(ve);for(var Pe=0;Pe<this.i.length;Pe++)if(this.i[Pe][0]===ve)return!0;return!1},t.keys=function ve(){var Pe,We,_e,O,X=this;return K(ve,function(ee){if(ee.h==1&&(Pe=m(X),We=Pe.next()),ee.h!=3)return We.done?void(ee.h=0):(_e=We.value,O=m(_e),C(ee,O.next().value));We=Pe.next(),ee.h=2})},t.set=function(ve,Pe,We){Q(arguments,2),ve=String(ve);var _e=[],O=ae(ve,Pe,We),X=!0;J(this.i,function(ee){ee[0]===ve?X&&(X=!_e.push(O)):_e.push(ee)}),X&&_e.push(O),this.i=_e},t.values=function ve(){var Pe,We,_e,O,X=this;return K(ve,function(ee){if(ee.h==1&&(Pe=m(X),We=Pe.next()),ee.h!=3)return We.done?void(ee.h=0):(_e=We.value,(O=m(_e)).next(),C(ee,O.next().value));We=Pe.next(),ee.h=2})},qt.prototype._asNative=function(){for(var ve=new ge,Pe=m(this),We=Pe.next();!We.done;We=Pe.next()){var _e=m(We.value);We=_e.next().value,_e=_e.next().value,ve.append(We,_e)}return ve},qt.prototype._blob=function(){var ve="----formdata-polyfill-"+Math.random(),Pe=[],We="--"+ve+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(_e,O){return typeof _e=="string"?Pe.push(We+_t(ne(O))+`"\r
\r
`+ne(_e)+`\r
`):Pe.push(We+_t(ne(O))+'"; filename="'+_t(_e.name)+`"\r
Content-Type: `+(_e.type||"application/octet-stream")+`\r
\r
`,_e,`\r
`)}),Pe.push("--"+ve+"--"),new Blob(Pe,{type:"multipart/form-data; boundary="+ve})},qt.prototype[Symbol.iterator]=function(){return this.entries()},qt.prototype.toString=function(){return"[object FormData]"},ot&&!ot.matches&&(ot.matches=ot.matchesSelector||ot.mozMatchesSelector||ot.msMatchesSelector||ot.oMatchesSelector||ot.webkitMatchesSelector||function(ve){for(var Pe=(ve=(this.document||this.ownerDocument).querySelectorAll(ve)).length;0<=--Pe&&ve.item(Pe)!==this;);return-1<Pe}),wt&&(qt.prototype[wt]="FormData"),Ee){var Nn=oe.XMLHttpRequest.prototype.setRequestHeader;oe.XMLHttpRequest.prototype.setRequestHeader=function(ve,Pe){Nn.call(this,ve,Pe),ve.toLowerCase()==="content-type"&&(this.B=!0)},oe.XMLHttpRequest.prototype.send=function(ve){ve instanceof qt?(ve=ve._blob(),this.B||this.setRequestHeader("Content-Type",ve.type),Ee.call(this,ve)):Ee.call(this,ve)}}Fe&&(oe.fetch=function(ve,Pe){return Pe&&Pe.body&&Pe.body instanceof qt&&(Pe.body=Pe.body._blob()),Fe.call(this,ve,Pe)}),ht&&(oe.navigator.sendBeacon=function(ve,Pe){return Pe instanceof qt&&(Pe=Pe._asNative()),ht.call(this,ve,Pe)}),oe.FormData=qt}})();const av=()=>{const t=G("AREAS");return t.length===0&&t.push(Xt.GLOBAL),ss(t).call(t,(r,i,s)=>{const c=m8(i);return c?s===0?c:"".concat(r,",").concat(c):r},"")},m8=t=>t===Xt.OVERSEA?"".concat(Qr.ASIA,",").concat(Qr.EUROPE,",").concat(Qr.AFRICA,",").concat(Qr.NORTH_AMERICA,",").concat(Qr.SOUTH_AMERICA,",").concat(Qr.OCEANIA):Qr[t],mve=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(i=>{const s=Yb[i],c=Object.keys(s);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(s[u]))})}),r},aE={GLOBAL:{ASIA:[Xt.CHINA,Xt.JAPAN,Xt.INDIA,Xt.KOREA,Xt.HKMC],EUROPE:[],NORTH_AMERICA:[Xt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},sE=Object.keys(aE[Xt.GLOBAL]),iI=[Xt.CHINA,Xt.NORTH_AMERICA,Xt.EUROPE,Xt.ASIA,Xt.JAPAN,Xt.INDIA,Xt.OCEANIA,Xt.SOUTH_AMERICA,Xt.AFRICA,Xt.KOREA,Xt.HKMC,Xt.US],fve=function(t,r){let i=[];if(Re(t).call(t,Xt.GLOBAL)){const u=[Xt.GLOBAL,Xt.OVERSEA],h=Object.keys(Yb);if(r===Xt.GLOBAL)throw new ce(H.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Xt.CHINA)i=[Xt.OVERSEA];else if(c=r,Re(sE).call(sE,c)){const m=(s=r,aE[Xt.GLOBAL][s]||[]),g=[...u,r,...m];i=h.filter(y=>!Re(g).call(g,y))}else if(function(m){let g=!1;return sE.forEach(y=>{var _;Re(_=aE[Xt.GLOBAL][y]).call(_,m)&&(g=!0)}),g}(r)){const m=function(y){let _;return sE.forEach(x=>{var S;Re(S=aE[Xt.GLOBAL][x]).call(S,y)&&(_=x)}),_}(r),g=[...u,m,r];i=h.filter(y=>!Re(g).call(g,y))}else i=t;i=function(m){const g=[];return iI.forEach(y=>{Re(m).call(m,y)&&g.push(y)}),g.concat(m.filter(y=>!Re(iI).call(iI,y)))}(i)}else i=t;var s,c;return i};function f8(t){var r,i;if(!t&&Re(r=G("AREAS")).call(r,Xt.EXTENSIONS))return R.debug("update area from ap : reset"),void aI(wge,!0);if(!Re(i=G("AREAS")).call(i,Xt.GLOBAL)||!t)return;let s=Yb.EXTENSIONS;s&&(s={CODE:m8(Xt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},R.debug("update area from ap success: ".concat(t,",config is "),s),sn("AREAS",[Xt.EXTENSIONS],!0),Object.keys(s).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?sn(c,s[c][0]):sn(c,s[c])}))}function aI(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=$e.reportApiInvoke(null,{name:Tn.SET_AREA,options:t,tag:dn.TRACER});try{let s=[];if(typeof t=="string"&&(s=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!Re(U6).call(U6,u))throw new ce(H.INVALID_PARAMS,"invalid area code")}),s=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new ce(H.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),s=h?fve(m,h):m}if(!r){if(Fa.AREAS){const u=new ce(H.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void R.warning("setArea is prohibited because of config-distribute")}if(Re(s).call(s,Xt.GLOBAL)&&G("AREAS")===Xt.EXTENSIONS){const u=new ce(H.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void R.warning("setArea is prohibited because of ap extensions")}}sn("AREAS",s,r);const c=mve(s);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?sn(u,c[u][0]):sn(u,c[u])}),R.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function g8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Sc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?g8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let sI=1;function gve(t,r,i,s,c){sI+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:sI,requestId:sI,version:cs,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,g,y=t[0];return Ro(async()=>{m=Date.now();const _=await ko(y,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,_.code!==0){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:g});throw R.error(C.toString()),C}const x=JSON.parse(_.json_body);if(x.code!==200){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(x.code,", reason: ").concat(x.reason),{code:x.code,responseTime:g});throw R.error(C.toString()),C}if(!x.servers||x.servers.length===0){const C=new ce(H.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:x.code,responseTime:g});throw R.error(C.toString()),C}const S=function(C,M){return{addressList:C.servers.map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(D.wss,"?serviceName=").concat(encodeURIComponent(M))),workerToken:C.workerToken,vid:C.vid}}(x,r);return G("LIVE_STREAMING_ADDRESS")&&(S.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Sc(Sc({},S),{},{responseTime:g})},(_,x)=>($e.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_.addressList),firstSuccess:x===0,responseTime:g,serverIp:t[x%t.length]}),!1),(_,x)=>($e.apworkerEvent(i.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:r,responseTime:g,serverIp:t[x%t.length]}),!!(_.code!==H.OPERATION_ABORTED&&_.code!==H.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(y=t[(x+1)%t.length],!0)),c)}let oI=1;function v8(t,r,i,s){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,g=Date.now();let y;const _=r.role,[x,S]=lI(r,u,[qn.CHOOSE_SERVER]);let C=jn.networkState;return Ro(async()=>{C&&jn.networkState===Ti.OFFLINE&&jn.onlineWaiter&&await ke.race([jn.onlineWaiter,yr(s&&s.maxRetryTimeout||Yn.maxRetryTimeout)]),C=jn.networkState;const{data:M,headers:D}=await ko(c,{data:x,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=D.http3==="1"?1:-1,$e.reportResourceTiming(c,m),_8(M,c,r,g,[qn.CHOOSE_SERVER],y);const j=Zg(M,qn.CHOOSE_SERVER);return cI(j),YA(j,c)},M=>(M&&$e.joinChooseServer(m,{role:_,lts:g,succ:!0,csAddr:c,opid:S,serverList:M.gatewayAddrs.map(D=>D.address),ec:null,cid:M.cid.toString(),uid:M.uid.toString(),csIp:M.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:M.res.detail&&M.res.detail[38],vid:M.vid}),!1),M=>M.code!==H.OPERATION_ABORTED&&(M.code===H.CAN_NOT_GET_GATEWAY_SERVER?M.data.retry:($e.joinChooseServer(m,{role:_,lts:g,succ:!1,csAddr:c,serverList:null,opid:S,ec:M.code,csIp:M.data&&M.data.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:y,corssRegionTagReq:r.apRequestDetail}),R.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),M),!0)),s)}function y8(t,r,i,s){let c,{url:u,areaCode:h,serviceIds:m}=t;const g=Date.now(),y=r.role,[_,x]=lI(r,h,m);let S;return Ro(async()=>{S&&jn.networkState===Ti.OFFLINE&&jn.onlineWaiter&&await ke.race([jn.onlineWaiter,yr(s&&s.maxRetryTimeout||Yn.maxRetryTimeout)]),S=jn.networkState;const{data:C,headers:M}=await ko(u,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=M.http3==="1"?1:-1,$e.reportResourceTiming(u,r.sid),_8(C,u,r,g,m,c);const D=Zg(C,qn.CHOOSE_SERVER),j=Zg(C,r.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK),$=performance.getEntriesByName(u),K=$[$.length-1];let J;return K&&(J={name:K.name,protocol:"nextHopProtocol"in K?K.nextHopProtocol:"",dnscost:"domainLookupEnd"in K&&"domainLookupStart"in K&&typeof K.domainLookupEnd=="number"&&typeof K.domainLookupStart=="number"?K.domainLookupEnd-K.domainLookupStart:-1,tcpTlsCost:"connectEnd"in K&&"connectStart"in K&&typeof K.connectEnd=="number"&&typeof K.connectStart=="number"?K.connectEnd-K.connectStart:-1,reqCost:"requestStart"in K&&typeof K.requestStart=="number"&&"responseEnd"in K&&typeof K.responseEnd=="number"?K.responseEnd-K.requestStart:-1,handleCost:"leave_ts"in C&&"enter_ts"in C&&typeof C.leave_ts=="number"&&typeof C.enter_ts=="number"?C.leave_ts-C.enter_ts:-1}),cI(D),{gatewayInfo:YA(D,u),proxyInfo:j,url:u,resourceTimingInfo:J}},C=>{var M;return C.gatewayInfo&&$e.joinChooseServer(r.sid,{role:y,lts:g,succ:!0,csAddr:u,serverList:C.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:x,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.gatewayInfo.res.detail&&C.gatewayInfo.res.detail[38],vid:(M=C.gatewayInfo)===null||M===void 0?void 0:M.vid,resourceTimingInfo:C.resourceTimingInfo?JSON.stringify(C.resourceTimingInfo):void 0}),C.proxyInfo&&$e.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:C.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1},C=>C.code!==H.OPERATION_ABORTED&&(C.code===H.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:($e.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:C.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:S})}),R.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),C),!0)),s)}const _8=(t,r,i,s,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:g}=i,y=[],_=x=>{x.flag===4096?$e.joinChooseServer(h,{role:i.role,lts:s,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:x.error.message,csIp:x.error.data&&x.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):x.flag!==1048576&&x.flag!==4194304&&x.flag!==4194310||$e.joinWebProxyAP(h,{lts:s,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:x.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(x=>{const S=x.buffer.code;if(x.uri===23&&S===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),x.buffer.edges_services=[];else{const C={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:t.detail[502]}),flag:x.buffer.flag};y.push(C),_(C)}if(S!==0){const C=Qp(S),M={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:t.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?R.warning(M.error.toString()):y.push(M),_(M)}}),y.length)throw R.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(y.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message,", retry: ").concat(x.error.data.retry)).join(" | "))),new ce(H.CAN_NOT_GET_GATEWAY_SERVER,y.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!y.find(x=>x.error.data.retry),csIp:t.detail[502],desc:[...new Set(y.map(x=>{var S;return x==null||(S=x.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(x=>!!x))]})},cI=t=>{var r,i,s,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(G("AP_AREA")&&((s=t.detail)!==null&&s!==void 0&&s[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?f8(t.detail[23].toLowerCase()):f8()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((i=t.detail)===null||i===void 0?void 0:i[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var u;const y=Si(u=m[g]).call(u);t.addresses[g]&&m&&(t.addresses[g].fingerprint=y)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const h=G("GATEWAY_ADDRESS").map(m=>{var g,y;const _=(g=(y=t.addresses.find(x=>x.ip===m.ip&&x.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:m.fingerprint||_}});t.addresses=h}},vve=(t,r)=>{if(t.response_body&&t.response_body.length){const i=t.response_body[0];if(i.buffer.code!==0){const s=Qp(i.buffer.code);throw new ce(H.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",r),new ce(H.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},lI=(t,r,i)=>{const s=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Sc(Sc(Sc({6:t.stringUid,11:r,12:G("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:i,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,s]},yve=(t,r)=>{const i=Math.floor(Math.random()*1e12),s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let tm=0;function nm(t){return ke.all(t.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const sv=async t=>{let{fragementLength:r,referenceList:i,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let g,y=0;const _=async()=>{const x=(()=>{const S=h*m,C=S+m;return i.slice(S,C).map(s)})();u&&u.push(...x);try{g=await nm(x)}catch(S){if(y+=m,h++,!(y>=i.length))return void await _();c(S)}x.forEach(S=>S.cancel())};return await _(),g},b8=async t=>{let{referenceList:r,asyncMapHandler:i,closeFn:s}=t;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(g){if(u++,u>=c||s!=null&&s(g))throw g;return h()}};return h()};async function _ve(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new ke((g,y)=>{let _;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:S=>{S.close(),clearTimeout(_),g(!0)},error:S=>{clearTimeout(_),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const x=[r,i,s,c,u,h];for(let S=0;S<x.length;S++){const C=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(x[S])});try{await t.decode(C)}catch{return void g(!1)}}})(),_=setTimeout(()=>{g(!1)},5e3)})}async function oE(t,r,i,s){return{gatewayInfo:await async function(u,h,m,g){let y=null;const _=[],x=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:av()})),M=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),D=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),v8(j,u,h,m)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},M),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},M),D},S=async()=>{if(await yr(1e3),y!==null)return y;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:av()})),M=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),D=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),v8(j,u,h,m)),allFailedhandler:j=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},M),j[0]},promisesCollector:_});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},M),D};try{return y=await nm([x(),S()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),y}catch(C){throw C[0]}}(t,r,i,s)}}async function E8(t,r,i,s,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await oE(t,r,i,c);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:C}=await w8(t,r,i,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:S};const M=C.map(D=>({turnServerURL:D.address,tcpport:D.tcpport||Hr.tcpport,udpport:D.udpport||Hr.udpport,username:D.username||Hr.username,password:D.password||Hr.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const D=(h=t.uid)!==null&&h!==void 0?h:S.uid,j="glb:".concat(D.toString()),$=await HR(j),K=C.map(J=>({turnServerURL:J.address,tcpport:J.tcpport||Hr.tcpport,udpport:J.udpport||Hr.udpport,username:j,password:$,forceturn:!1,security:!0}));M.push(...K)}return t.turnServer={mode:"manual",servers:M},{gatewayInfo:S}}return await oE(t,r,i,c)}const{proxyInfo:m,gatewayInfo:g}=await w8(t,r,i,c),y={gatewayInfo:g},_=m.map(S=>({turnServerURL:S.address,tcpport:u==="proxy3"?void 0:S.tcpport?S.tcpport:Hr.tcpport,udpport:u==="proxy4"?void 0:S.udpport?S.udpport:Hr.udpport,username:S.username||Hr.username,password:S.password||Hr.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var x;const S=(x=t.uid)!==null&&x!==void 0?x:g.uid,C="glb:".concat(S.toString()),M=await HR(C),D=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Hr.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Hr.udpport,username:C,password:M,forceturn:u!=="proxy4",security:u==="proxy5"}));_.push(...D)}return t.turnServer={mode:"manual",servers:_},R.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),y}async function x8(t,r,i,s,c){const u=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(y,_,x,S,C){const M=Date.now(),D={sid:x.sid,opid:10,appid:x.appId,string_uid:_};let j=y[0];const $=await Ro(()=>ko(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:D,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(K,J)=>{if(K.code===0){if(K.uid<=0||K.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(K.uid),K),$e.reqUserAccount(D.sid,{lts:M,success:!1,serverAddr:j,stringUid:D.string_uid,uid:K.uid,errorCode:H.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new ce(H.INVALID_UINT_UID_FROM_STRING_UID);return $e.reqUserAccount(D.sid,{lts:M,success:!0,serverAddr:j,stringUid:D.string_uid,uid:K.uid,errorCode:null,extend:D}),!1}const ne=Qp(K.code);return ne.retry&&(j=y[(J+1)%y.length]),$e.reqUserAccount(D.sid,{lts:M,success:!1,serverAddr:j,stringUid:D.string_uid,uid:K.uid,errorCode:ne.desc,extend:D}),ne.retry},(K,J)=>K.code!==H.OPERATION_ABORTED&&($e.reqUserAccount(D.sid,{lts:M,success:!1,serverAddr:j,stringUid:D.string_uid,uid:null,errorCode:K.code,extend:D}),j=y[(J+1)%y.length],!0),C);if($.code!==0){const K=Qp($.code);throw new ce(H.UNEXPECTED_RESPONSE,K.desc)}return $}(h,t,r,i,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function bve(t,r,i){const s=G("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?s.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await b8({referenceList:c,asyncMapHandler:h=>async function(m,g,y,_){const x=Date.now(),S={sid:y.sid,opid:10,appid:y.appId,string_uid:g};try{const C=await ko(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){const M=Qp(C.code);throw new ce(H.UNEXPECTED_RESPONSE,"preload sua error:".concat(M.desc),M)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new ce(H.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:x,url:m,req:S,uid:C.uid,elapse:Date.now()-x}}catch(C){throw C}}(h,t,r,i),closeFn:h=>h.code===H.OPERATION_ABORTED||h.code===H.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Eve(t,r,i){const s=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=s.map(g=>function(y,_,x,S){const C=Wt(),M={flag:64,cipher_method:0,features:Sc(Sc(Sc(Sc(Sc({install_id:iA(),device:C.name,system:C.os,system_general:navigator.userAgent,vendor:_.appId,version:cs,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:uve.WEB_RTC,browser_name:C.name,browser_version:C.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),C.os&&{os_name:C.os}),C.osVersion&&{os_version:C.osVersion}),{},{detail:""})};return Ro(()=>ko(y,{data:M,timeout:1e3,cancelToken:x,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,D=>D.code!==H.OPERATION_ABORTED,S)}(g,t,r,i));let u=null,h=null,m={};try{u=await nm(c)}catch(g){if(g.code===H.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),$e.reportApiInvoke(t.sid,{name:Tn.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(g){if(!g.test_tags)return{};const y=g.test_tags,_=Object.keys(y),x={};return _.forEach(S=>{var C;const M=Si(C=S.slice(4)).call(C),D=JSON.parse(y[S]),j=D[1];x[M]={tag:D[0]||"",value:j}}),x}(u)}catch{}return m}async function S8(t,r){const i=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK]}));try{return await b8({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let g,{url:y,areaCode:_,serviceIds:x}=u;const S=Date.now(),[C,M]=lI(h,_,x);let D=jn.networkState;try{D&&jn.networkState===Ti.OFFLINE&&jn.onlineWaiter&&await ke.race([jn.onlineWaiter,yr(Yn.maxRetryTimeout)]),D=jn.networkState;const{data:j,headers:$}=await ko(y,{data:C,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=$.http3==="1"?1:-1,(ae=>{const Q=[];if(ae.response_body.forEach(oe=>{const ge=oe.buffer.code;if(oe.uri===23&&ge===0&&!oe.buffer.edges_services)if(oe.buffer.flag===4194310)oe.buffer.edges_services=[];else{const Ee={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:G("NO_EDGES_RETRY"),csIp:ae.detail[502]}),flag:oe.buffer.flag};Q.push(Ee)}if(ge!==0){const Ee=Qp(ge),Fe={error:new ce(H.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:ae.detail[502]}),flag:oe.buffer.flag};oe.buffer.flag===4194310?R.warning(Fe.error.toString()):Q.push(Fe)}}),Q.length)throw new ce(H.CAN_NOT_GET_GATEWAY_SERVER,Q.map(oe=>"flag: ".concat(oe.flag,", message: ").concat(oe.error.message)).join(" | "),{retry:!!Q.find(oe=>oe.error.data.retry),csIp:ae.detail[502],desc:[...new Set(Q.map(oe=>{var ge;return oe==null||(ge=oe.error)===null||ge===void 0||(ge=ge.data)===null||ge===void 0?void 0:ge.desc}).filter(oe=>!!oe))]})})(j);const J=Zg(j,qn.CHOOSE_SERVER),ne=Zg(j,qn.CLOUD_PROXY_FALLBACK);return cI(J),{gatewayInfo:YA(J,y),proxyInfo:ne,opid:M,requestTime:S,url:y,isHttp3:g,elapse:Date.now()-S}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===H.OPERATION_ABORTED||c.code===H.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function w8(t,r,i,s){const c=G("PROXY_SERVER_TYPE3"),u=(C,M,D)=>{let j=D||c;return Array.isArray(j)&&(j=M%2==0&&c[1]||c[0]),"https://".concat(j,"/ap/?url=").concat(C)};let h=null;const m=[],g=async()=>{const C=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((j,$)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$),{url:K,areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),M=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),D=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),y8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},M),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},M),D},y=async()=>{if(await yr(1e3),h!==null)return h;const C=G("WEBCS_DOMAIN_BACKUP_LIST").map((j,$)=>{let K;return K=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),$),{url:K,areaCode:av(),serviceIds:[qn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?qn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qn.CLOUD_PROXY:qn.CLOUD_PROXY_FALLBACK]}}),M=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(j=>j.url)}),D=await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:j=>(R.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),y8(j,t,r,i)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},M),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},M),D};let _,x,S;try{({gatewayInfo:_,proxyInfo:x,url:S}=await nm([g(),y()]))}catch(C){throw C[0]}if(m.length&&m.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!_||!x)throw new ce(H.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=S,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&S){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Re(c).call(c,C)&&(t.proxyServer=C,R.setProxyServer(C),$e.setProxyServer(C))}return h={gatewayInfo:_,proxyInfo:await Y6(x,_.uid)},h}async function xve(t,r,i){const s=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=s.map(u=>function(h,m,g,y){const _={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:cs,cname:m.cname,uid:m.uid.toString(),requestId:oI,seq:oI};oI+=1;const x={service_name:"tele_channel",json_body:JSON.stringify(_)};return Ro(async()=>{const S=await ko(h,{data:x,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const M=new ce(H.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(M.toString()),M}const C=JSON.parse(S.json_body);if(C.code!==200){const M=new ce(H.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw R.error(M.toString()),M}if(!C.servers||C.servers.length===0){const M=new ce(H.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(M.toString()),M}return{vid:C.vid,workerToken:C.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(M.wss))}},void 0,S=>!!(S.code!==H.OPERATION_ABORTED&&S.code!==H.UNEXPECTED_RESPONSE||S.data&&S.data.retry),y)}(u,t,r,i));try{const u=await nm(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Sve(t,r,i){let s=null;const c=[],u=async h=>{const m=G(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await yr(1e3),s!==null)?s:await sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(R.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(y,_,x,S){const[C]=yve(_,[qn.CHOOSE_SERVER]);let M=jn.networkState;return Ro(async()=>{M&&jn.networkState===Ti.OFFLINE&&jn.onlineWaiter&&await ke.race([jn.onlineWaiter,yr(S&&S.maxRetryTimeout||Yn.maxRetryTimeout)]),M=jn.networkState;const D=await ko(y,{data:C,cancelToken:x,headers:{"Content-Type":"multipart/form-data;"}},!0);return vve(D,y)},()=>!1,D=>D.code!==H.OPERATION_ABORTED&&(D.code===H.UPDATE_TICKET_FAILED?D.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),D),!0)),S)}(g,t,r,i)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return s=await nm([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),s}catch(h){throw h[0]}}function T8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function dI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?T8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class wve extends An{get isSuccess(){return!!this.configs}constructor(r,i){super(),L(this,"configs",void 0),L(this,"store",void 0),L(this,"joinInfo",void 0),L(this,"cancelToken",void 0),L(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),L(this,"interval",void 0),L(this,"mutex",void 0),L(this,"mutableParamsRead",!1),L(this,"configCache",{}),L(this,"limit_bitrate",void 0),this.mutex=new Rr("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,$e.reportApiInvoke(null,{options:void 0,name:Tn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:dn.TRACER}).onSuccess(JSON.stringify(Fa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await Eve(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(r));const s=function(c){var u;const h=gu(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let _=h.length-1;_>y;_--){const x=h[_],S=c[x].value;if(typeof S.__priority=="number"){const C=S.__priority,M=h[_-1],D=c[M].value;if(typeof D.__priority=="number"){if(!(C>D.__priority))continue;{const j=x;h[_]=h[_-1],h[_-1]=j}}else{const j=x;h[_]=h[_-1],h[_-1]=j}}}const m=Date.now(),g={};return h.forEach(y=>{const _=c[y].value.__expires;_&&_<=m||(g[y]=c[y])}),g}(r);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new ce(H.NETWORK_RESPONSE_ERROR,s);R.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){F6(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(Oo.UPDATE_BITRATE_LIMIT,r):this.emit(Oo.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&dI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},s=Object.keys(r),c=[];s.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const g=h.__type,y=r[u].value,_=r[u].tag;let x=0;g?g===iV.REALTIME&&(x=1):Object.keys(y).some(S=>Object.prototype.hasOwnProperty.call(cA,S)||!LA()&&Object.prototype.hasOwnProperty.call(wb,S)?(x=1,!0):void 0),c.push({tag:_,isApplied:x,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:g,isApplied:y}=u;this.store.sessionId&&$e.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){R.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,g=m.__expires,y=m.__type;Object.keys(m).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(u,_)||(u[_]=dI(dI({value:m[_]},g&&{expires:g}),y&&{type:y}))})}),u}(r);try{var s;const c=(s=i.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete i.LIMIT_BITRATE,c&&F6(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const g=Date.now();Object.keys(m).forEach(y=>{const{value:_,type:x,expires:S}=m[y];S&&S<=g||((x===iV.REALTIME||Object.prototype.hasOwnProperty.call(cA,y))&&(Fa[y]=_,tn[y]=_,R.debug("Update realtime parameters from config distribute",y,_)),x||LA()||!Object.prototype.hasOwnProperty.call(wb,y)||(Fa[y]=_,tn[y]=_,R.debug("Update gateway parameters from config distribute",y,_)))})}catch(g){R.error("Error update config immediately: ".concat(m),g.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),R.debug("Caching global parameters ".concat(u))}catch(c){R.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(s=>{switch(s){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(tn,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(tn[s],u)||(Fa[s]=u,tn[s]=u,this.emit(Oo.UPDATE_CLIENT_ROLE_OPTIONS,u),R.debug("Updating client role options: ".concat(JSON.stringify(u))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(tn,s)){var c;const{value:u,expires:h}=r[s];if(h&&h<=i)return;typeof u=="number"&&Re(c=[0,1,4,5,6,7,8,9]).call(c,u)&&(Fa[s]={value:u},tn[s]=u,this.emit(Oo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,u),R.debug("Updating client remote stream type: ".concat(JSON.stringify(u))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(tn,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(tn[s],u)||(Fa[s]=u,tn[s]=u,this.emit(Oo.FALLBACK_TO_HLS,u),R.debug("Updating enable force hls: ".concat(JSON.stringify(u))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(tn,s)){const{value:u,expires:h}=r[s];if(h&&h<=i)return;XR(tn[s],u)||(Fa[s]=u,tn[s]=u,this.emit(Oo.UPDATE_VOS_CONFIGURE,u),R.debug("Updating vos configure: ".concat(JSON.stringify(u))))}}})}catch(i){R.error("Error handling global parameter config:",i.message)}}}class Tve extends An{constructor(){super(...arguments),L(this,"resultStorage",new Map)}setLocalAudioStats(r,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(r,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(s)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(s))}setRemoteAudioStats(r,i){const s=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const s=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(r,i,s){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(s);const u=r==="VIDEO_ENCODE_FAILED"?G("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=u){var h;const m=Re(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",uI[r],r,i),!c.isPrevNormal&&m&&this.emit("exception",uI[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Gi(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var i;return!(!r.codecType||Re(i=G("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof or&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const uI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Zr=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(t,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function C8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Hu(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?C8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):C8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class ov{constructor(r){L(this,"store",void 0),L(this,"onStatsException",void 0),L(this,"onUploadPublishDuration",void 0),L(this,"onStatsChanged",void 0),L(this,"onVideoCodecChanged",void 0),L(this,"localStats",new Map),L(this,"remoteStats",new Map),L(this,"updateStatsInterval",void 0),L(this,"trafficStats",void 0),L(this,"trafficStatsPeerList",[]),L(this,"uplinkStats",void 0),L(this,"exceptionMonitor",void 0),L(this,"p2pChannel",void 0),L(this,"scalabilityMode",xb.L1T1),L(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Tve,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ae.LocalAudioTrack)||Hu({},mA)}getLocalVideoTrackStats(){return this.localStats.get(Ae.LocalVideoTrack)||Hu({},fA)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(s[h]=i(h,m))});return s}getRemoteNetworkQualityStats(r){const i={};if(r){var s;const c=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getNetworkQuality(){let r=0,i=0;return this.trafficStats&&(r=Qb(this.trafficStats.B_unq),i=Qb(this.trafficStats.B_dnq)),{uplinkNetworkQuality:r,downlinkNetworkQuality:i}}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(s[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(s[h]=i(h,m))});return s}getRTCStats(){let r=0,i=0,s=0,c=0;const u=this.localStats.get(Ae.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ae.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(Ae.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:_,videoStats:x}=y;_&&(s+=_.receiveBytes,c+=_.receiveBitrate),x&&(s+=x.receiveBytes,c+=x.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Zr.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,s){if(!r)return!1;const c=!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||i.framesDecodeCount>s.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case Ae.LocalVideoTrack:case Ae.LocalVideoLowTrack:{const m=c,g=Hu({},fA),y=r.getStats(),_=r.getLocalMedia(s);if(y){const x=y.videoSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(x){const S=r.getLocalVideoSize(),C=r.getEncoderConfig(Ae.LocalVideoTrack);var u;(x.codec==="H264"||x.codec==="H265"||x.codec==="VP8"||x.codec==="VP9"||x.codec==="AV1X"||x.codec==="AV1")&&(g.codecType=x.codec,(m==null?void 0:m.codecType)!==x.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,x.codec.toLocaleLowerCase()))),g.sendBytes=x.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,x.inputFrame?(g.captureFrameRate=x.inputFrame.frameRate,g.captureResolutionHeight=x.inputFrame.height,g.captureResolutionWidth=x.inputFrame.width):S&&(g.captureResolutionWidth=S.width,g.captureResolutionHeight=S.height),x.sentFrame?(g.sendFrameRate=x.sentFrame.frameRate,g.sendResolutionHeight=x.sentFrame.height,g.sendResolutionWidth=x.sentFrame.width):S&&(g.sendResolutionWidth=S.width,g.sendResolutionHeight=S.height),x.avgEncodeMs&&(g.encodeDelay=x.avgEncodeMs),C&&C.bitrateMax?g.targetSendBitrate=1e3*C.bitrateMax:x.targetBitrate&&(g.targetSendBitrate=x.targetBitrate),g.sendPackets=x.packets,g.sendPacketsLost=x.packetsLost,g.sendJitterMs=x.jitterMs,g.sendRttMs=x.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(x)&&(g.totalFreezeTime+=1),x.scalabilityMode&&this.scalabilityMode!==x.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(x.scalabilityMode)),this.scalabilityMode=x.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(s,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,g);break}case Ae.LocalAudioTrack:{const m=c,g=Hu({},mA),y=r.getStats(),_=r.getLocalMedia(s);if(y){const x=y.audioSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(x){if(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(g.codecType=x.codec),x.inputLevel)g.sendVolumeLevel=Math.round(32767*x.inputLevel);else{const S=r.getLocalAudioVolume();S&&(g.sendVolumeLevel=Math.round(32767*S))}g.sendBytes=x.bytes,g.sendPackets=x.packets,g.sendPacketsLost=x.packetsLost,g.sendJitterMs=x.jitterMs,g.sendRttMs=x.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ae.LocalAudioTrack,g),g&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var s,c;let[u,{videoStats:h,audioStats:m,videoPcStats:g}]=i;const y=m,_=h,x=g,S=Hu({},yV),C=Hu({},_V),M=Hu({},dge),{audioTrack:D,videoTrack:j,audioSSRC:$,videoSSRC:K}=r.getRemoteMedia(u);let J;J=this.store.useP2P?r.getStats(!0):r.getStats();const ne=(s=J)===null||s===void 0?void 0:s.audioRecv.find(ge=>ge.ssrc===$),ae=(c=J)===null||c===void 0?void 0:c.videoRecv.find(ge=>ge.ssrc===K),Q=this.trafficStats&&this.trafficStats.peer_delay.find(ge=>ge.peer_uid===u);if(ne&&(ne.codec!=="opus"&&ne.codec!=="aac"&&ne.codec!=="PCMU"&&ne.codec!=="PCMA"&&ne.codec!=="G722"||(S.codecType=ne.codec),ne.outputLevel?S.receiveLevel=Math.round(32767*ne.outputLevel):D&&(S.receiveLevel=Math.round(32767*D.getVolumeLevel())),S.receiveBytes=ne.bytes,S.receivePackets=ne.packets,S.receivePacketsLost=ne.packetsLost,S.receivePacketsDiscarded=ne.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=y?8*Math.max(0,S.receiveBytes-y.receiveBytes):0,S.totalDuration=y?y.totalDuration+1:1,S.totalFreezeTime=y?y.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=ne.jitterBufferMs,S.totalDuration>10&&ov.isRemoteAudioFreeze(D)&&(S.totalFreezeTime+=1)),ae){var oe;ae.codec!=="H264"&&ae.codec!=="H265"&&ae.codec!=="VP8"&&ae.codec!=="VP9"&&ae.codec!=="AV1X"&&ae.codec!=="AV1"||(C.codecType=ae.codec),C.receiveBytes=ae.bytes,C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.decodeFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,C.renderFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,ae.outputFrame&&(C.renderFrameRate=ae.outputFrame.frameRate),ae.receivedFrame?(C.receiveFrameRate=ae.receivedFrame.frameRate,C.receiveResolutionHeight=ae.receivedFrame.height,C.receiveResolutionWidth=ae.receivedFrame.width):j&&(C.receiveResolutionHeight=j._videoHeight||0,C.receiveResolutionWidth=j._videoWidth||0),ae.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ae.framesRateFirefox)),C.receivePackets=ae.packets,C.receivePacketsLost=ae.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost);const ge=_?_.totalFreezeTime:0,Ee=_?_.totalDuration:0;C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=(oe=ae.totalFreezesDuration)!==null&&oe!==void 0?oe:ge||0,C.receiveDelay=ae.jitterBufferMs||0;const Fe=!!K&&r.getRemoteVideoIsReady(K);ae.totalFreezesDuration===void 0&&j&&Fe&&ov.isRemoteVideoFreeze(j,ae,x)&&(C.totalFreezeTime+=1),C.freezeRate=Math.max(0,Math.min((C.totalFreezeTime-ge)/(C.totalDuration-Ee),1))}Q&&(S.end2EndDelay=Q.B_ad,C.end2EndDelay=Q.B_vd,S.transportDelay=Q.B_ed,C.transportDelay=Q.B_ed,S.currentPacketLossRate=Q.B_ealr4/100,C.currentPacketLossRate=Q.B_evlr4/100,M.uplinkNetworkQuality=Q.B_punq?Q.B_punq:0,M.downlinkNetworkQuality=Q.B_pdnq?Q.B_pdnq:0),this.remoteStats.set(u,{audioStats:S,videoStats:C,videoPcStats:ae,networkStats:M}),D&&this.exceptionMonitor.setRemoteAudioStats(D,S),j&&this.exceptionMonitor.setRemoteVideoStats(j,C)})}}class N8{constructor(){L(this,"destChannelMediaInfos",new Map),L(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){M6(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){M6(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){Hb(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function R8(t){if(!(t instanceof N8))return new ce(H.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),i=t.getDestChannelMediaInfo();if(!r)return new ce(H.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new ce(H.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ld{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){L(this,"uid",void 0),L(this,"_uintid",void 0),L(this,"_trust_in_room_",!0),L(this,"_trust_audio_enabled_state_",!0),L(this,"_trust_video_enabled_state_",!0),L(this,"_trust_audio_mute_state_",!0),L(this,"_trust_video_mute_state_",!0),L(this,"_audio_muted_",!1),L(this,"_video_muted_",!1),L(this,"_audio_enabled_",!0),L(this,"_video_enabled_",!0),L(this,"_audio_added_",!1),L(this,"_video_added_",!1),L(this,"_is_pre_created",!1),L(this,"_video_pre_subscribed",!1),L(this,"_audio_pre_subscribed",!1),L(this,"_trust_video_stream_added_state_",!0),L(this,"_trust_audio_stream_added_state_",!0),L(this,"_audioTrack",void 0),L(this,"_videoTrack",void 0),L(this,"_dataChannels",[]),L(this,"_audioSSRC",void 0),L(this,"_videoSSRC",void 0),L(this,"_audioOrtc",void 0),L(this,"_videoOrtc",void 0),L(this,"_cname",void 0),L(this,"_rtxSsrcId",void 0),L(this,"_videoMid",void 0),L(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function A8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function hI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Cve=t=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(t?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),cE="9",pI=2e4,lE=4e4;let I8=class{get localCapabilities(){return xn(this._localCapabilities)}get rtpCapabilities(){return xn(this._rtpCapabilities)}get candidates(){return xn(this._candidates)}get iceParameters(){return xn(this._iceParameters)}get dtlsParameters(){return xn(this._dtlsParameters)}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_originCandidates",void 0),L(this,"_iceParameters",void 0),L(this,"_isUseExtmapAllowMixed",void 0),L(this,"_isUseLocalCodecs",void 0),L(this,"_isUseDataChannel",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),L(this,"useLocalCodecsMids",[]),L(this,"preloadSsrcs",[]),L(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=r,this._isUseLocalCodecs=i,this._isUseDataChannel=s,t=xn(t);const{iceParameters:c,dtlsParameters:u,candidates:h,rtpCapabilities:m,setup:g,localCapabilities:y,cname:_}=t;this._rtpCapabilities=m,this._candidates=h,this._originCandidates=xn(h),this._iceParameters=c,this._dtlsParameters=u,this._localCapabilities=y,this.setup=g,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(m),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(t){return t.length===this.preloadSsrcs.length&&t.every(r=>{var i;return Re(i=this.preloadSsrcs).call(i,r)})}preloadRemoteMedia(t){let r=0;const i=[],s=[];for(;t>0;){const c=[hI({ssrcId:lE+r},G("USE_SUB_RTX")?{rtx:lE+r+1}:{})],u="".concat(lE+r,"_").concat(pI+r),{ssrcs:h,ssrcGroups:m}=nv(c,this.cname,G("SYNC_GROUP")?u:void 0),g=this.preCreateOrRecycleSendMedia("video",h,m,void 0),y=[{ssrcId:pI+r}],_="".concat(lE+r,"_").concat(pI+r),{ssrcs:x,ssrcGroups:S}=nv(y,this.cname,G("SYNC_GROUP")?_:void 0),C=this.preCreateOrRecycleSendMedia("audio",x,S,void 0);t--,r+=2,i.push(g,C),s.push(h[0].ssrcId,x[0].ssrcId)}return this.useLocalCodecsMids.push(...i),this.preloadSsrcs=s,{mids:i,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(t,r,i,s){const c=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;R.debug("create or recycle send media without remote rtp capabilities, ssrcs ",r[0].ssrcId);const h=t===Ge.VIDEO?u.videoCodecs:u.audioCodecs,m=t===Ge.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let y={media:{mediaType:t,port:cE,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return y=this.mungSendMediaDesc(y,s),this.sessionDesc.mediaDescriptions.push(y),this.updateBundleMids(),g}toString(){return rl(this.sessionDesc)}send(t,r,i,s){const{ssrcs:c,ssrcGroups:u}=nv(r,this.cname,G("SYNC_GROUP")?i:void 0),h=this.findPreloadMediaDesc(c);if(h){if(En()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(t,c);let g;return m===-1||m===1&&(Nr()||function(){const y=Wt();return!(y.name!==Kt.CHROME||!y.osVersion)&&Number(y.version)<=90}()||No(143)||ed(143)||G("RESERVE_MID_1_MLINE")||G("ENABLE_ENCODED_TRANSFORM")&&tl())||m===0&&!function(y){const _=Wt();return!(_.name!==Kt.FIREFOX||!_.osVersion)&&Number(_.version)===y}(138)&&G("USE_SUB_RTX")||TF()?(g=this.createOrRecycleSendMedia(t,c,u,"sendonly",s),this.updateBundleMids()):(g=xn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,s)),En()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:r}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:r}}batchSend(t){const r=t.map(c=>{let{kind:u,ssrcMsg:h,mslabel:m}=c;return this.send(u,h,m)}),i=[];let s=!1;return r.forEach(c=>{let{mid:u,needExchangeSDP:h}=c;h&&(s=!0),i.push(u)}),{mids:i,needExchangeSDP:s}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.mid==="0"||En()||TF()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Re(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Re(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,r,i,s){t.forEach((c,u)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",r,i,s[u])}),this.updateBundleMids()}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const r=this.sessionDesc||Ci((i=this._isUseExtmapAllowMixed,this._isUseDataChannel?Cve(i):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(i?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var i;this._rtpCapabilities=t;let s=!1;const c=this.rtpCapabilities.send,u=this.localCapabilities.send,h=this.localCapabilities.recv,m=h.videoCodecs,g=h.audioCodecs,y=h.videoExtensions,_=h.audioExtensions;for(const M of r.mediaDescriptions){var x;if(M.attributes.direction!=="sendonly"||typeof M.attributes.mid!="string"||!Re(x=this.useLocalCodecsMids).call(x,M.attributes.mid)){if(s=!0,M.attributes.iceUfrag=this._iceParameters.iceUfrag,M.attributes.icePwd=this._iceParameters.icePwd,M.attributes.fingerprints=this._dtlsParameters.fingerprints,M.attributes.candidates=this._candidates,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video")if(this._isUseLocalCodecs&&M.attributes.direction==="sendonly"){var S;M.media.fmts=m.map(j=>j.payloadType.toString(10)),M.attributes.payloads=m,M.attributes.extmaps=y;const D=M.attributes.mid;typeof D!="string"||Re(S=this.useLocalCodecsMids).call(S,D)||this.useLocalCodecsMids.push(D)}else if(c.videoCodecs.length===0){const D=u.videoCodecs.filter(j=>{var $,K;return($=j.rtpMap)===null||$===void 0?void 0:Re(K=$.encodingName.toLowerCase()).call(K,"vp8")});D.length===0&&D.push(u.videoCodecs[0]),M.media.fmts=D.map(j=>j.payloadType.toString(10)),M.attributes.payloads=D,M.attributes.extmaps=[]}else M.media.fmts=c.videoCodecs.map(D=>D.payloadType.toString(10)),M.attributes.payloads=c.videoCodecs,M.attributes.extmaps=c.videoExtensions;if(M.media.mediaType==="audio")if(this._isUseLocalCodecs&&M.attributes.direction==="sendonly"){var C;M.media.fmts=g.map(j=>j.payloadType.toString(10)),M.attributes.payloads=g,M.attributes.extmaps=_;const D=M.attributes.mid;typeof D!="string"||Re(C=this.useLocalCodecsMids).call(C,D)||this.useLocalCodecsMids.push(D)}else if(c.audioCodecs.length===0){const D=u.audioCodecs.filter(j=>{var $,K;return($=j.rtpMap)===null||$===void 0?void 0:Re(K=$.encodingName.toLowerCase()).call(K,"opus")})||[u.audioCodecs[0]];M.media.fmts=D.map(j=>j.payloadType.toString(10)),M.attributes.payloads=D,M.attributes.extmaps=[]}else M.media.fmts=c.audioCodecs.map(D=>D.payloadType.toString(10)),M.attributes.payloads=c.audioCodecs,M.attributes.extmaps=c.audioExtensions,em(M)}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(t){const r=this._originCandidates.filter(s=>s.transport==="udp"),i=[];if(r.forEach(s=>{i.push(hI(hI({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),r.length!==0){switch(t){case Ar.TCP_RELAY:this._candidates=i;break;case Ar.UDP_TCP_RELAY:case Ar.RELAY:this._candidates=[...r,...i];break;default:this._candidates=r}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=xn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(En()){if(s){const c=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(c||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!c||c!==i.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if(i.media.mediaType==="application")return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),r={media:{mediaType:"application",port:cE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r),{mediaDesc:r,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,r,i,s,c,u){const h=t._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=iv(h,m,this.localCapabilities.send,h===Ge.VIDEO?s:c),y=h===Ge.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let x={media:{mediaType:h,port:cE,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};x=this.mungRecvMediaDsec(x,t,u);const S=this.findFirstClosedMedia(h);if(S){const C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateRemoteDtlsParameters(t){const r=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),i=new Set(t.map(c=>c.fingerprint));let s=!1;r.size!==i.size&&(s=!0);for(const c of r)i.has(c)||(s=!0);return s}updateRemoteCodec(t,r,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").filter(x=>{var S;return Re(S=Object.keys(Du)).call(S,x)}))],c=new Set(r);if(s.every(x=>c.has(x)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const u=this._rtpCapabilities.recv.videoCodecs.filter(x=>r.some(S=>{var C;return Re(C=x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||"").call(C,S)}));if(u.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(r)),!1;const h=[...new Set(u.map(x=>x.rtpMap&&x.rtpMap.encodingName.toLowerCase()||""))];let m;if(R.debug("updateRemoteCodec, from ".concat(s," to ").concat(h)),t.length===0)m=this.sessionDesc.mediaDescriptions.filter(x=>x.media.mediaType==="video"&&x.attributes.direction==="recvonly");else if(m=this.sessionDesc.mediaDescriptions.filter(x=>x.attributes.mid&&x.media.mediaType==="video"&&Re(t).call(t,x.attributes.mid)&&x.attributes.direction==="recvonly"),m.length!==t.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(r)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const x=cd(u,this.rtpCapabilities.recv.videoCodecs);u.push(...x)}this._rtpCapabilities.recv.videoCodecs=u;const g=this.localCapabilities.send,y=this.rtpCapabilities.recv,_=iv(Ge.VIDEO,y,g,i);return m.forEach(x=>{const S=_.map(C=>C.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(x.attributes.mid,", from"),x.attributes.payloads,"to",_),x.attributes.payloads=_,x.media.fmts=S}),R.debug("updateRemoteCodec success, mids: ".concat(t,", codecs: ").concat(r,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(t,r,i,s,c){const u=this.rtpCapabilities.send.videoCodecs,h=this._isUseLocalCodecs||u.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,m=t===Ge.VIDEO?h.videoCodecs:h.audioCodecs,g=t===Ge.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:cE,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};_=this.mungSendMediaDesc(_,c);const x=this.findFirstClosedMedia(t);if(x){const S=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,r,i){const s=xn(t);return JA(s),$u(s,r),QA(s,r),i8(s),tE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=xn(t);return i.attributes&&i.attributes.payloads&&Array.isArray(i.attributes.payloads)&&i.attributes.payloads.length>0&&i.attributes.payloads.forEach(s=>{s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&G("ENABLE_DOWN_SPS_PPS")&&(s.fmtp&&s.fmtp.parameters||(s.fmtp={parameters:{}}),s.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),tE(i,r,this.localCapabilities.recv),em(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>En()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var r;return(r=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||r===void 0?void 0:r.attributes.ssrcs}};function O8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ol(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?O8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}var rm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(rm||{});const dE=new Map;function P8(t,r,i,s){let{scale:c}=t;if(c===0&&s===rm.UP||c>=r.length-1&&s===rm.DOWN)return t;let u=ol(ol({},t),{},{scale:s===rm.DOWN?++c:--c});switch(i){case"maintain-framerate":u=ol(ol({},u),r[c].motion);break;case"maintain-resolution":u=ol(ol({},u),r[c].detail);break;case"balanced":u=ol(ol({},u),r[c].balanced)}return u}function D8(t,r){if(r){const i={overUse:0,underUse:0,adaptationList:k8(r)};dE.set(t,i)}else dE.delete(t)}function k8(t){const r=ol({},t),{bitrateMax:i,frameRate:s,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:x,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:M,BALANCE_BITRATE_FACTOR:D,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:$,MOTION_RESOLUTION_FACTOR:K,MOTION_BITRATE_FACTOR:J,DETAIL_FRAMERATE_FACTOR:ne,DETAIL_BITRATE_FACTOR:ae}=sA,Q=Math.min(r.frameRate,m),oe=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(C,1)*Q),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:i,bitrateMin:u}}];for(let ge=1;ge<=g;ge++){const Ee={bwe_up:Math.round(Math.pow(x,ge)*i),bwe_down:Math.round(Math.pow(S,ge+1)*i),fps_up:Math.round(Math.pow(M,ge)*Q),fps_down:Math.round(Math.pow(C,ge+1)*Q)},Fe={scaleResolutionDownBy:c/Math.pow($,ge),frameRate:Math.max(Math.round(Math.pow(j,ge)*s),h),bitrateMax:Math.max(Math.round(Math.pow(D,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(D,ge)*u),y)},ht={scaleResolutionDownBy:c/Math.pow(K,ge),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(J,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(J,ge)*u),y)},ot={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ne,ge)*s),h),bitrateMax:Math.max(Math.round(Math.pow(ae,ge)*i),_),bitrateMin:Math.max(Math.round(Math.pow(ae,ge)*u),y)};oe.push({scale:ge,threshold:Ee,balanced:Fe,motion:ht,detail:ot})}return oe}function Nve(t,r,i,s,c,u){const h=dE.get(t)||{overUse:0,underUse:0,adaptationList:k8(c)},{adaptationList:m}=h;dE.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:y}=sA,{scale:_}=s;let x,S;return typeof r=="number"&&r>0&&function(C,M,D,j){if(M>=D.length)return!1;let{threshold:{fps_down:$}}=D[M];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&($=D[0].threshold.fps_down),C<$}(r,_,m,u)&&(h.overUse++,S=jp.CPU,h.overUse>g)||typeof i=="number"&&i>0&&function(C,M,D){if(M>=D.length)return!1;const{threshold:{bwe_down:j}}=D[M];return C<j}(i,_,m)&&(h.overUse++,S=jp.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,x=P8(s,m,u,rm.DOWN),[x,S]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(C,M,D,j){if(M===0)return;let{threshold:{fps_up:$}}=D[M];return G("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&($=D[1].threshold.fps_up),C>$}(r,_,m,u)&&function(C,M,D){if(M===0)return;const{threshold:{bwe_up:j}}=D[M];return C>j}(i,_,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,x=P8(s,m,u,rm.UP),x.scale===0&&(S=jp.NONE))),[x,S])}function j8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function mI(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?j8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function L8(t){var r;return!!G("ENABLE_AG_ADAPTATION")&&!!(t instanceof kb||Re(r=t._hints).call(r,Qt.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(SF(14,0,!1)&&wF(17,4,!0)||xF(14)&&VR(17,4,!0)))}const uE=new Map;function M8(t,r,i,s,c,u){if(im(t,i),c(r),s!=="balanced"&&s!=="maintain-framerate"&&s!=="maintain-resolution")return;let h=-1;D8(t,r);const m=window.setInterval(()=>{const y=uE.get(t);if(!G("ENABLE_AG_ADAPTATION")||!y)return im(t,i),void c(r);const _=u();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(h===-1)return void(h=Date.now());if(Date.now()-h<1e3)return;const x=_.sendFrameRate,S=_.OutgoingAvailableBandwidth,[C,M]=Nve(t,x,S,y.adaptationConfig,r,s);M&&(i.qualityLimitationReason=M),C&&y.adaptationConfig.scale!==C.scale&&(R.debug("[".concat(t,"] applyAdaptation: ").concat(i.qualityLimitationReason,`
           sendFps `).concat(x,", bwe ").concat(S,", switch from ").concat(y.adaptationConfig.scale," to ").concat(C.scale," ")),y.adaptationConfig=mI(mI({},y.adaptationConfig),C),c(C))}},G("CHECK_LOCAL_STATS_INTERVAL")),g=mI({},r);uE.set(t,{timer:m,adaptationConfig:g,originConfig:r,adaptationFunc:c}),R.debug("[".concat(t,"] start adaptation, originConfig: ").concat(JSON.stringify(r),", degradationPreference: ").concat(s))}function im(t,r){const i=uE.get(t);if(i){const{timer:s}=i;window.clearTimeout(s),uE.delete(t)}r.qualityLimitationReason=jp.NONE,D8(t)}function Rve(t,r){var i;let s;switch(r){case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoTrack:s=Re(i=t._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:s=nn.Low}return s}function fI(t){const r=It();if(t.some(i=>i._bypassWebAudio))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function gI(t,r){fI(t);const i=new or;return t.forEach(s=>i.addAudioTrack(s)),i}const Ave=!It().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fc();function cv(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.useDcSignal)return i={spec:r,store:t},Do("DataChannelConnection").create(i);var i;return Ave?function(c){return Do("PlanBConnection").create(c)}({spec:r,store:t}):new za(r,t)}function vI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function yI(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Cu(t.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Vt;function U8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function jo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?U8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let za=(Vt=class hh extends qb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Re(i=Object.keys(Du)).call(i,r)}))]}constructor(r,i){super(r,i),L(this,"id",en(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:G("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"isPreRender",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",jp.NONE),L(this,"isFirstConnected",!1),this.store=i,this.forceTurn=yI(r),this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(hh.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Sb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ec(i.sdp),c=await eI({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rv(c),this.initialOffer=i,G("ENABLE_SVC")&&this.store.codec=="av1"){const h=await a8();var r;h&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(h))}let u;return i.sdp&&nE(i.sdp)&&(u=xn(c),J6(u)),jo(jo({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new he(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&nE(this.initialOffer.sdp)&&Q6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new I8(jo(jo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&Yg(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=tI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),Yg(this.store))if(r.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=G("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{const{preSSRCs:h=[]}=r,m=h.map(y=>y.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:g}=this.remoteSDP.batchSend(h.map(y=>Object.assign({},y)));await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const h=u.receiver.track;let m;h.kind==="video"&&G("ENABLE_PRE_RENDER")&&(m=new Db({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(en(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const y=this.preMediaMap.get(i[c]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},m.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(i[c],{mid:s,track:h,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||h}const{preSSRCs:c=[]}=r,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:_,player:x,track:S}]=g;return h.push(_),m.push(y),this.preMediaMap.delete(y),x&&x.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await na(this.peerConnection,this.remoteSDP,this.extension),R.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),$e.reportApiInvoke(this.store.sessionId,{name:Tn.PRELOAD_MEDIA_FAILED,options:[c,m],tag:dn.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(y=>Object.assign({},y)));await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):R.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Mi(function*(){const u=yield Tt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=ev();r.forEach(j=>{const $=c.peerConnection.addTransceiver(j._mediaStreamTrack,jo({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push($),j._updateRtpTransceiver($)}),En()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=yield Tt(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,y),x=Ci(_),S=y.map(j=>{const $=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return XA($,G("USE_PUB_RTX"))});let C;try{C=yield S}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const $=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Tt(c.stopSending(y,!0)),j}c.remoteSDP.receive(r,i,s,C);const M=c.remoteSDP.toString(),D=c.logSDPExchange(_,"offer","local","send");return yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r)),D==null||D(M),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:M})),h.map((j,$)=>{const K=y[$];return{localSSRC:S[$],id:K,transceiver:j}})}catch(h){throw h instanceof he?h:new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof he?s:new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof he?i:new he(H.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var y;im(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);h&&(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:y}]=h;if(g===u)return this.preMediaMap.delete(m),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Mi(function*(){const s=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration,u=G("FORCE_TURN_TCP")||i.forceTurn;if(r===Ar.RELAY&&!c)return;if(c&&!u){const x=r===Ar.RELAY?"relay":"all",S=i.peerConnection.getConfiguration();S.iceTransportPolicy!==x&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(x,"]")),S.iceTransportPolicy=x,i.peerConnection.setConfiguration(S))}i.remoteSDP.updateCandidates(r);const h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Ec(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;i.remoteSDP.restartICE(g);const y=i.remoteSDP.toString(),_=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Tt(i.peerConnection.setLocalDescription(h)),_==null||_(y),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ar.TCP_RELAY),await na(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{im(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return jo(jo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new he(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?En()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:jo(jo({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:jo(jo({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=bc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(Cu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:G("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...hh.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...hh.newTurnServerConfigToIceServers(r.turnServer.servers)),G("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...hh.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...hh.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=G("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const h=c.address+":"+c.port,m=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(h)),", remote ").concat(JSON.stringify(bc(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=q6(this.peerConnection,r._mediaStreamTrack),g=UV(r);if(L8(r)&&m&&i&&g&&this.getLocalVideoStats&&Re(s=["vp8","vp9"]).call(s,this.store.codec)){var y;const D=u.degradationPreference||(Re(y=r._hints).call(y,Qt.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");M8(this.id+m.mid,g,this,D,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:D,frameRate:j,scaleResolutionDownBy:$}=r._encoderConfig;D&&(h.maxBitrate=1e3*D),(Re(_=r._hints).call(_,Qt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=Gi(j)),$&&$>=1&&(h.scaleResolutionDownBy=$))}const{maxFramerate:x}=G("ENCODER_CONFIG_LIMIT");if(x&&typeof x=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,x):x),G("DSCP_TYPE")&&fc()){var S;const D=G("DSCP_TYPE");Re(S=["very-low","low","medium","high"]).call(S,D)&&(h.networkPriority=D)}const C=i.getParameters(),M=(c=C.encodings)===null||c===void 0?void 0:c[0];En()&&!M&&(u.encodings=[h]),M&&Object.assign(M,h),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await c8(this.store.codec,i,G("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Gi(m)),g&&g>=1&&Re(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const y=r.getParameters(),_=(c=y.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(y,{});try{await r.setParameters(y),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(x){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",x):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof un&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){if(G("FORBID_MODIFY_LOCAL_OFFER_SDP"))return r;const c=Ci(r);return i.forEach((u,h)=>{const m=s[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&($u(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,m;const y=r[g],_=i[g];if(_ instanceof un&&!Re(s=_._hints).call(s,Qt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=y.sender.getParameters();await y.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!En()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof un&&this.isVP8Simulcast(c)){const u=r[s],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof un&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Re(i=r._hints).call(i,Qt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(It().supportPCSetConfiguration){const i=hh.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},je(Vt.prototype,"updateRemoteRTPCapabilities",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"updateRemoteRTPCapabilities"),Vt.prototype),je(Vt.prototype,"connect",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"connect"),Vt.prototype),je(Vt.prototype,"updateRemoteConnect",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"updateRemoteConnect"),Vt.prototype),je(Vt.prototype,"createDataChannels",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"createDataChannels"),Vt.prototype),je(Vt.prototype,"receive",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"receive"),Vt.prototype),je(Vt.prototype,"batchReceive",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"batchReceive"),Vt.prototype),je(Vt.prototype,"stopReceiving",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"stopReceiving"),Vt.prototype),je(Vt.prototype,"muteRemote",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"muteRemote"),Vt.prototype),je(Vt.prototype,"unmuteRemote",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteRemote"),Vt.prototype),je(Vt.prototype,"muteLocal",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"muteLocal"),Vt.prototype),je(Vt.prototype,"unmuteLocal",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteLocal"),Vt.prototype),je(Vt.prototype,"close",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"close"),Vt.prototype),je(Vt.prototype,"updateEncoderConfig",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"updateEncoderConfig"),Vt.prototype),je(Vt.prototype,"updateSendParameters",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"updateSendParameters"),Vt.prototype),je(Vt.prototype,"replaceTrack",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"replaceTrack"),Vt.prototype),je(Vt.prototype,"updateAdaptation",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"updateAdaptation"),Vt.prototype),je(Vt.prototype,"getRemoteSSRC",[Wi],Object.getOwnPropertyDescriptor(Vt.prototype,"getRemoteSSRC"),Vt.prototype),Vt);function Wi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function _I(t,r){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Gi(r.width),s.height=Gi(r.height);const c=Gi(r.framerate||15);document.body.append(i),document.body.append(s);let u=t._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play().catch($g);const h=s.getContext("2d");if(!h)throw new ce(H.UNEXPECTED_ERROR,"can not get canvas context");const m=It(),g=s.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const _=i.videoWidth,x=i.videoHeight/_,S=s.width*x;Math.abs(S-s.height)>=2&&(R.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(S)),s.height=S)}h.drawImage(i,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,i.srcObject=new MediaStream([u]))},s.stopCapture=_A(()=>s.startCapture&&s.startCapture(),c);const y=g.stop;return g.stop=()=>{y.call(g),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),R.debug("clean low stream renderer")},g}var F8=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(F8||{}),Lo=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(Lo||{}),yt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(yt||{}),Er=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t[t.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",t}(Er||{}),Fr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Fr||{}),am=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t[t.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",t}(am||{}),bI=function(t){return t[t.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",t[t.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",t}(bI||{});const zu=1e3,hE=6,lv=3,Ive=Math.max(hE,lv,60);function st(t,r,i){i!=null&&Number.isFinite(i)&&(t[r]=Math.round(Math.max(0,i)))}function V8(t){const r={[Fr.CONN_TYPE]:0,[Fr.RTT]:t.rtt,[Fr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=t.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[Fr.CONN_TYPE]=1),i==="tcp"&&(r[Fr.CONN_TYPE]=3),i==="tls"&&(r[Fr.CONN_TYPE]=4);break}case"srflx":r[Fr.CONN_TYPE]=2;break;case"unknown":r[Fr.CONN_TYPE]=5;break;default:r[Fr.CONN_TYPE]=0}return r}function B8(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class G8 extends An{constructor(r){super(),L(this,"store",void 0),L(this,"uploadWRTCStatsTimer",void 0),L(this,"uploadOutboundDenoiserStatsTimer",void 0),L(this,"uploadExtStatsTimer",void 0),L(this,"uploadExtUsageStatsTimer",void 0),L(this,"uploadInboundExtStatsTimer",void 0),L(this,"requestStats",void 0),L(this,"requestTransportStats",void 0),L(this,"requestLocalMedia",void 0),L(this,"requestRemoteMedia",void 0),L(this,"requestAllTracks",void 0),L(this,"requestVideoIsReady",void 0),L(this,"requestUploadStats",void 0),L(this,"requestUpload",void 0),L(this,"uploadOutboundStarted",!1),L(this,"uploadInboundStarted",!1),L(this,"uploadTransportStarted",!1),L(this,"uploadBaseStatsStarted",!1),L(this,"uploadExtensionUsageStarted",!1),L(this,"lastRecvStats",void 0),L(this,"lastSendStats",void 0),L(this,"lastRefRecvStats",void 0),L(this,"lastRefSendStats",void 0),L(this,"lastNormalRecvStats",void 0),L(this,"lastNormalSendStats",void 0),L(this,"lastExtendStats",{}),L(this,"needUploadStats",{}),L(this,"needUploadRenderFreezeTime",!0),L(this,"lastUploadCompensateTime",-1),L(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%lv==0,s=r%hE==0,c=r%60==0;let u,h;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),u||h){var m;const g={};if(this.uploadTransportStarted&&u){const _=this.getTransportStats(u,i?this.lastRefSendStats:void 0,h,i);_&&(g.misc=[_])}if(this.uploadOutboundStarted&&u){const _=this.getOutboundStats(u,s?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,c);_&&(g.outbound=[_])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const _=this.getInboundStats(h,s?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(g.inbound=_)}const y=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;if(y&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[am.RTC_PEER_CONNECTION_STATE]=rA[y]):g.misc=[{addition:{[am.RTC_PEER_CONNECTION_STATE]:rA[y]}}]),xa.needUploadStats.length>0||s){const _=xa.needUploadStats.shift()||(xa.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[am.PAGE_VISIBILITY]=_):g.misc=[{addition:{[am.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[F8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=u,s&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=u),i&&(this.lastRefRecvStats=h,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,xa.startCollectStats();let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,s;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[am.RTC_PEER_CONNECTION_STATE]:rA[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Ive+1&&(r=1)},zu)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=r%lv==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&u){const m=this.requestRemoteMedia()||[],g=[];m.forEach(y=>{let[_,x]=y;const S={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&x.has(Ge.VIDEO)&&_.videoTrack){const C=function(M,D,j){if(!D.videoRecv.find(K=>K.ssrc===M))return;const $={};if(j&&j._player){const K=j._player,{renderFreezeAccTime2:J,videoElementStatus:ne}=K;if(xa.visibility==="visible"&&ne===Jr.PLAYING&&It().supportRequestVideoFrameCallback){const ae=Math.min(6e3,J);K.renderFreezeAccTime2=Math.max(0,J-ae),st($,Lo.Video_Render_Freeze_Time_Render2,ae),G("USE_NEW_RENDER_FREEZE_TIME")&&st($,Lo.Video_Render_Freeze_Time_Render,ae)}}return $}(_._videoSSRC,u,_.videoTrack);C&&(S.video=C)}S.video&&g.push(S)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,i,s,c){if(!this.requestStats)return;if(!c)return r.rtt==null?void 0:{addition:{[Fr.RTT]:r.rtt,[Fr.CONN_TYPE]:void 0,[Fr.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const u=V8(r);if(this.store.useP2P){if(s){const h=V8(s);u[Fr.CONN_TYPE]&&h[Fr.CONN_TYPE]&&(u[Fr.CONN_TYPE]+=h[Fr.CONN_TYPE]<<3)}u[Fr.CONN_TYPE]?u[Fr.CONN_TYPE]+=110:u[Fr.CONN_TYPE]=110}else{u[Fr.CONN_TYPE]?u[Fr.CONN_TYPE]+=100:u[Fr.CONN_TYPE]=100;const h=function(m,g){return g?[Math.ceil(8*(m.transport.bytesSent-g.transport.bytesSent)/(m.timestamp-g.timestamp)),Math.ceil(8*(m.transport.bytesReceived-g.transport.bytesReceived)/(m.timestamp-g.timestamp))]:[0,0]}(r,i);u[bI.Transport_Send_Bitrate]=h[0],u[bI.Transport_Recv_Bitrate]=h[1]}return{addition:u}}getOutboundStats(r,i,s,c,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,y;return h.forEach(_=>{let[x,{track:S,ssrcs:C}]=_;switch(x){case Ae.LocalVideoLowTrack:case Ae.LocalVideoTrack:if(x===Ae.LocalVideoTrack){var M;const D=function(J,ne,ae,Q,oe,ge){const Ee=ne.videoSend.find(wt=>wt.ssrc===J);if(!Ee)return;const Fe={},{sentFrame:ht,inputFrame:ot}=Ee;if(Q&&(st(Fe,Lo.Video_Send_Qp_Sum,Ee.qpSumPerFrame),ot&&ht)){const wt=ot.frameRate,_t=ht.frameRate;Fe[Lo.Video_Send_Freeze]=function(qt,Nn){let ve=!0;return ve=!(qt<=5)&&(qt<=10?Nn<3:qt<=20?Nn<4:Nn<5),ve}(wt,_t)?1:0}if(oe){switch(ht&&(st(Fe,yt.Video_Send_Height,ht.height),st(Fe,yt.Video_Send_Width,ht.width),st(Fe,yt.Video_Send_Frame_Rate,ht.frameRate)),Fe[yt.Video_Send_Disabled]=ae._originMediaStreamTrack&&!ae._originMediaStreamTrack.enabled||ae._mediaStreamTrack&&!ae._mediaStreamTrack.enabled?1:0,Ee.adaptionChangeReason){case"none":Fe[yt.Video_Send_Adaptation]=0;break;case"cpu":Fe[yt.Video_Send_Adaptation]=1;break;case"bandwidth":Fe[yt.Video_Send_Adaptation]=2;break;case"other":Fe[yt.Video_Send_Adaptation]=3}let wt=0;Ee.adaptionChangeReason&&(wt+=B8(Ee.adaptionChangeReason)),ne.qualityLimitationReason&&(wt+=B8(ne.qualityLimitationReason)<<3),Fe[yt.Video_Send_Adaptation]=wt,Fe[yt.Video_Send_Player_Status]=gA[ae._player?ae._player.videoElementStatus:"uninit"],st(Fe,yt.Video_Send_Nacks,Ee.nacksCount),st(Fe,yt.Video_Send_Plis,Ee.plisCount),st(Fe,yt.Video_Send_Firs,Ee.firsCount),st(Fe,yt.Video_Send_Avg_Encode,Ee.avgEncodeMs),st(Fe,yt.Video_Send_Huge_Frame_Sent,Ee.hugeFramesSent),st(Fe,yt.Video_Send_Bytes_Retransmit,Ee.retransmittedBytesSent),st(Fe,yt.Video_Send_Packages_Retransmit,Ee.retransmittedPacketsSent),st(Fe,yt.Video_Send_Key_Frames_Encoded,Ee.keyFramesEncoded);const _t=oe.videoSend.find(qt=>qt.ssrc===J);if(_t){let qt=zu*lv;_t.timestamp&&Ee.timestamp&&(qt=Ee.timestamp-_t.timestamp),_t.packets!=null&&Ee.packets!=null&&st(Fe,yt.Video_Send_Package_Rate,1e3*(Ee.packets-_t.packets)/qt),Ee.packetsLost!=null&&_t.packetsLost!=null&&st(Fe,yt.Video_Send_Package_Lost,Ee.packetsLost-_t.packetsLost),_t.bytes!=null&&Ee.bytes!=null&&st(Fe,yt.Video_Send_Bitrate,8*(Ee.bytes-_t.bytes)/qt)}}return Fe}(C[0].ssrcId,r,S,i,s),j=S.__className__==="CameraVideoTrack"?3:Re(M=S._hints).call(M,Qt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||u)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);const $=S&&function(J,ne,ae,Q){const oe=ne.videoSend.find(Ee=>Ee.ssrc===J);if(!oe)return null;const ge={};if(Q){const Ee=oe.inputFrame,Fe=Ee&&Ee.height||ae.videoHeight||0,ht=Ee&&Ee.width||ae.videoWidth||0,ot=Ee&&Ee.frameRate||0;st(ge,yt.Video_Capture_Height,Fe),st(ge,yt.Video_Capture_Width,ht),st(ge,yt.Video_Capture_Frame_Rate,ot)}return ge}(C[0].ssrcId,r,S,!!s),K=function(J,ne){const ae={};return ne&&(st(ae,yt.Video_Send_Retransmit,J.bitrate.retransmit),st(ae,yt.Video_Send_Target_Encoded,J.bitrate.targetEncoded),st(ae,yt.Video_Send_Actual_Encoded,J.bitrate.actualEncoded),st(ae,yt.Video_Send_Transmit,J.bitrate.transmit),st(ae,yt.Video_Send_Bandwidth,J.sendBandwidth)),ae}(r,!!s);g=Object.assign({},D,$,K)}else y=function(D,j,$,K,J){const ne=j.videoSend.find(Q=>Q.ssrc===D);if(!ne)return;const ae={};if(K){const Q=ne.sentFrame;Q&&(st(ae,yt.Video_Send_Low_Height,Q.height),st(ae,yt.Video_Send_Low_Width,Q.width),st(ae,yt.Video_Send_Low_Frame_Rate,Q.frameRate));const oe=K.videoSend.find(ge=>ge.ssrc===D);if(oe){let ge=zu*hE;oe.timestamp&&ne.timestamp&&(ge=ne.timestamp-oe.timestamp),oe.packets!=null&&ne.packets!=null&&st(ae,yt.Video_Send_Low_Package_Rate,1e3*(ne.packets-oe.packets)/ge),ne.packetsLost!=null&&oe.packetsLost!=null&&st(ae,yt.Video_Send_Low_Package_Lost,ne.packetsLost-oe.packetsLost),oe.bytes!=null&&ne.bytes!=null&&st(ae,yt.Video_Send_Low_Bitrate,8*(ne.bytes-oe.bytes)/ge)}}return ae}(C[0].ssrcId,r,0,s);break;case Ae.LocalAudioTrack:m=S&&function(D,j,$,K,J,ne){const ae=j.audioSend.find(oe=>oe.ssrc===D);if(!ae)return;const Q={};if(J){Q[yt.Audio_Send_Disabled]=$._originMediaStreamTrack&&!$._originMediaStreamTrack.enabled||$._mediaStreamTrack&&!$._mediaStreamTrack.enabled?1:0;const oe=100*$._source.getAccurateVolumeLevel(),ge=ae.inputLevel;if(ge!=null){const Fe=Math.ceil(50*Math.log10(100*ge+1));st(Q,yt.Audio_Send_Level,Fe)}st(Q,yt.Audio_Capture_PCM_Level,oe),st(Q,yt.Audio_Send_AEC_Return_Loss,ae.aecReturnLoss),st(Q,yt.Audio_Send_AEC_Return_Loss_Enhancement,ae.aecReturnLossEnhancement),st(Q,yt.Audio_Send_Bytes_Retransmit,ae.retransmittedBytesSent),st(Q,yt.Audio_Send_Packages_Retransmit,ae.retransmittedPacketsSent),Q[yt.Audio_Send_Freeze]=0;const Ee=J.audioSend.find(Fe=>Fe.ssrc===D);if(Ee){let Fe=zu*hE;Ee.timestamp&&ae.timestamp&&(Fe=ae.timestamp-Ee.timestamp),Ee.bytes!=null&&ae.bytes!=null&&st(Q,yt.Audio_Send_Bitrate,8*(ae.bytes-Ee.bytes)/Fe),Ee.packets!=null&&ae.packets!=null&&st(Q,yt.Audio_Send_Package_Rate,1e3*(ae.packets-Ee.packets)/Fe)}}return Q}(C[0].ssrcId,r,S,0,s)}}),{high:g,low:y,audio:m}}getInboundStats(r,i,s,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[g,y]=m;const _={peer:g.uid};let x;if(y.has(Ge.VIDEO)&&g.videoTrack){const S=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,C=g.videoTrack?function(M,D,j,$,K,J,ne,ae){const Q=D.videoRecv.find(_t=>_t.ssrc===M);if(!Q)return;const oe={},{receivedFrame:ge,outputFrame:Ee,decodeFrameRate:Fe}=Q;st(oe,Er.Video_Render_Frame_Rate_Decode,Fe),Q.framesRateFirefox&&st(oe,Er.Video_Recv_Frame_Rate,Q.framesRateFirefox),ge&&st(oe,Er.Video_Recv_Frame_Rate,ge.frameRate),st(oe,Er.Video_Recv_Frame_Dropped,Q.framesDroppedCount),st(oe,Er.Video_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),st(oe,Er.Video_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),st(oe,Er.Video_Recv_Packages_Discarded,Q.packetsDiscarded),st(oe,Er.Video_Recv_Avg_Decode,Q.avgDecodeMs),st(oe,Er.Video_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs),st(oe,Er.Video_Recv_Avg_Assembly_Time,Q.avgFramesAssembledFromMultiplePacketsMs),st(oe,Er.Video_Recv_Avg_Inter_Frame_Delay,Q.avgInterFrameDelayMs),st(oe,Er.Video_Recv_Key_Frames_Decoded,Q.keyFramesDecoded);const ht=ae&&ae.videoRecv.find(_t=>_t.ssrc===M);if(ht){const _t=D.timestamp-ae.timestamp||zu;Q.packetsLost!=null&&ht.packetsLost!=null&&st(oe,Er.Video_Recv_Package_Lost,Q.packetsLost-ht.packetsLost),ht.bytes!=null&&Q.bytes!=null&&st(oe,Er.Video_Recv_Bitrate,8*(Q.bytes-ht.bytes)/_t),ht.packets!=null&&Q.packets!=null&&st(oe,Er.Video_Recv_Package_Rate,1e3*(Q.packets-ht.packets)/_t)}const ot=J&&J.videoRecv.find(_t=>_t.ssrc===M);if(ot&&(st(oe,Lo.Video_Recv_Qp_Sum,Q.qpSumPerFrame),oe[Lo.Video_Recv_Freeze]=$&&ov.isRemoteVideoFreeze(j,Q,ot)?1:0),ne){var wt;const _t=ne.videoRecv.find(Nn=>Nn.ssrc===M);ge?(st(oe,yt.Video_Recv_Height,ge.height),st(oe,yt.Video_Recv_Width,ge.width)):j&&(st(oe,yt.Video_Recv_Height,j._videoHeight||0),st(oe,yt.Video_Recv_Width,j._videoWidth||0)),Ee&&st(oe,yt.Video_Recv_Frame_Rate_Output,Ee.frameRate);const qt=(wt=j._player)===null||wt===void 0?void 0:wt.rendFrameRate.toFixed(0);if(qt&&st(oe,yt.Video_Render_Frame_Rate_Render,+qt),st(oe,yt.Video_Recv_Jitter_Buffer,Q.jitterBufferMs),st(oe,yt.Video_Recv_Current_Delay,Q.currentDelayMs),st(oe,yt.Video_Recv_Firs,Q.firsCount),st(oe,yt.Video_Recv_Nacks,Q.nacksCount),st(oe,yt.Video_Recv_Plis,Q.plisCount),j){oe[yt.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Nn=j._player;if(Nn){const{freezeTimeCounterList:ve,renderFreezeAccTime:Pe,renderFreezeAccTime2:We,videoElementStatus:_e}=Nn;if(ve&&ve.length>0&&st(oe,Lo.Video_Render_Freeze_Time,ve.splice(0,1)[0]),K&&xa.visibility==="visible"&&_e===Jr.PLAYING&&It().supportRequestVideoFrameCallback){const O=Math.min(6e3,We);Nn.renderFreezeAccTime2=Math.max(0,We-O),st(oe,Lo.Video_Render_Freeze_Time_Render2,O);const X=Math.min(6e3,Pe);Nn.renderFreezeAccTime=Math.max(0,Pe-X),st(oe,Lo.Video_Render_Freeze_Time_Render,G("USE_NEW_RENDER_FREEZE_TIME")?O:X)}if(typeof Q.totalFreezesDuration=="number"){const O=_t&&_t.totalFreezesDuration?Q.totalFreezesDuration-_t.totalFreezesDuration:Q.totalFreezesDuration;st(oe,yt.Video_Render_Freeze_Duration,1e3*O)}}}if(oe[yt.Video_Recv_Player_Status]=gA[j._player?j._player.videoElementStatus:"uninit"],_t&&Q.totalInterFrameDelay!==void 0&&Q.totalSquaredInterFrameDelay!==void 0&&_t.totalInterFrameDelay!==void 0&&_t.totalSquaredInterFrameDelay!==void 0){const Nn=Q.totalInterFrameDelay-_t.totalInterFrameDelay,ve=Q.totalSquaredInterFrameDelay-_t.totalSquaredInterFrameDelay,Pe=Q.framesDecodeCount-_t.framesDecodeCount,We=Nn/Pe*1e3,_e=Math.round(1e3*Math.sqrt((ve-Math.pow(Nn,2)/Pe)/Pe));!isNaN(_e)&&We+_e>Math.max(3*We,We+150)&&(oe[yt.Video_Recv_I_Frame_Delay]=_e)}}return oe}(g._videoSSRC,r,g.videoTrack,S===!0,this.needUploadRenderFreezeTime,i,s,c):void 0;if(C&&(_.video=C),g.videoTrack){const M=r.videoRecv.find(D=>D.ssrc===g._videoSSRC);M&&M.estimatedPlayoutTimestamp&&(x=M.estimatedPlayoutTimestamp)}}if(y.has(Ge.AUDIO)&&g.audioTrack){const S=g.audioTrack?function(C,M,D,j,$,K){const J=M.audioRecv.find(oe=>oe.ssrc===C);if(!J)return;const ne={};st(ne,Er.Audio_Recv_Jitter,J.jitterMs),st(ne,Er.Audio_Recv_Bytes_Retransmit,J.retransmittedBytesReceived),st(ne,Er.Audio_Recv_Packages_Retransmit,J.retransmittedPacketsReceived),st(ne,Er.Audio_Recv_Packages_Discarded,J.packetsDiscarded),st(ne,Er.Audio_Recv_Avg_Processing_Delay,J.avgProcessingDelayMs);const ae=K&&K.audioRecv.find(oe=>oe.ssrc===C);if(ae){const oe=zu;J.packets!=null&&ae.packets!=null&&st(ne,Er.Audio_Recv_Package_Rate,1e3*(J.packets-ae.packets)/oe),J.packetsLost!=null&&ae.packetsLost!=null&&st(ne,Er.Audio_Recv_Package_Lost,J.packetsLost-ae.packetsLost)}if(j){const{receivedFrames:oe,droppedFrames:ge}=J;oe!=null&&ge!=null&&(ne[Lo.Audio_Recv_Freeze]=(Q=oe)===0||100*ge/Q>20?1:0)}var Q;if($){const oe=100*D._source.getAccurateVolumeLevel(),ge=J.outputLevel;if(ge!=null){const Fe=Math.ceil(50*Math.log10(100*ge+1));st(ne,yt.Audio_Render_Level,Fe)}st(ne,yt.Audio_Recv_PCM_Level,oe),D&&(ne[yt.Audio_Recv_Disabled]=D._originMediaStreamTrack.enabled&&D._mediaStreamTrack.enabled?0:1),st(ne,yt.Audio_Recv_Jitter_Buffer,J.jitterBufferMs),st(ne,yt.Audio_Recv_Current_Delay,J.jitterBufferMs),ne[yt.Audio_Recv_Player_Status]=gA[hi.getPlayerState(D.getTrackId())];const Ee=$.audioRecv.find(Fe=>Fe.ssrc===C);if(Ee){Ee.bytes!=null&&J.bytes!=null&&st(ne,yt.Audio_Recv_Bitrate,8*(J.bytes-Ee.bytes)/(zu*lv));const Fe=J.concealedSamples-Ee.concealedSamples;Fe>0&&st(ne,yt.Audio_Recv_Concealed_Samples,Fe);const ht=J.totalSamplesReceived-Ee.totalSamplesReceived;ht>0&&st(ne,yt.Audio_Recv_Total_Samples_Received,ht);const ot=J.freezeSamples80-Ee.freezeSamples80;ot>0&&st(ne,yt.Audio_Render_Freeze_Samples_80ms,ot);const wt=J.freezeSamples200-Ee.freezeSamples200;wt>0&&st(ne,yt.Audio_Render_Freeze_Samples_200ms,wt);const _t=J.freezeMs80-Ee.freezeMs80;st(ne,yt.Audio_Render_Freeze_Time_80ms,_t<0?0:_t);const qt=J.freezeMs200-Ee.freezeMs200;st(ne,yt.Audio_Render_Freeze_Time_200ms,qt<0?0:qt)}}return ne}(g._audioSSRC,r,g.audioTrack,i,s,c):void 0;if(S&&(_.audio=S),g.audioTrack&&x){const C=r.audioRecv.find(M=>M.ssrc===g._audioSSRC);if(C&&C.estimatedPlayoutTimestamp){const M=C.estimatedPlayoutTimestamp-x;_.audio?_.audio[Er.Audio_Recv_AV_Sync_TIME]=M:_.audio={[Er.Audio_Recv_AV_Sync_TIME]:M}}}}(_.video||_.audio)&&h.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof Xg);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(Gu.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,s]=r;s.has(Ge.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),s.has(Ge.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),s={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,_]of h)_.has(Ge.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),_.has(Ge.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=function(y,_){const x={};for(const{id:D,value:j,level:$,direction:K}of y){var S;const J=(S=_.get(D))!==null&&S!==void 0?S:0,ne=j===2?J+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:J;var C,M;_.set(D,ne),x[D]?(j===2&&(x[D].value=j),$>x[D].level&&(x[D].level=$),K==="remote"&&(x[D].remoteUidCount+=1),x[D].totalTs=(C=_.get(D))!==null&&C!==void 0?C:0):x[D]={value:j,level:$,remoteUidCount:K==="local"?0:1,totalTs:(M=_.get(D))!==null&&M!==void 0?M:0}}return Object.keys(x).map(D=>{const{level:j,value:$,totalTs:K}=x[D];return{id:D,level:j,value:$,totalTs:K}})}(c,r);const m=Date.now(),g=m>i?m:i+1;this.requestUpload&&this.requestUpload(Gu.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,xa.stopCollectStats()}}const Ove=G("ICE_RESTART_INTERVAL");let pE=new Map,sm=new Map,dd=[Ar.UDP_TCP_RELAY,Ar.TCP_RELAY,Ar.RELAY],EI=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration;function W8(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=pE.get(t.id);i&&(window.clearTimeout(i),pE.delete(t.id));const s=sm.get(t.id);r&&s&&s.index===dd.length-1&&(R.debug("[".concat(t.id,"] reset ICE restart policy")),sm.delete(t.id))}function $8(t,r,i){if(pE.size===0&&sm.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!function(m,g){if(m.length!==g.length)return!1;for(let y=0;y<m.length;y+=1){const _=m[y];if(m.filter(x=>x===_).length!==g.filter(x=>x===_).length)return!1}return!0}(dd,G("RESTART_SEQUENCE"))&&(dd=G("RESTART_SEQUENCE").filter(m=>{var g;if(Re(g=Object.values(Ar)).call(g,m))return!0}),R.debug("use reconnection policy from config distribution, queues: ".concat(dd.join(" => ")))),EI=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&It().supportPCSetConfiguration),dd.length===0)return void i();let s,{index:c=0,type:u}=sm.get(t.id)||{};if(EI&&u===Ar.RELAY)return void i();let h=u&&c>=dd.length-1;if(EI)u=Ar.RELAY;else{if(h)return void i();u?(c++,u=dd[c]):(u=dd[0],c=0)}R.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),sm.set(t.id,{index:c,type:u}),s=window.setTimeout(()=>$8(t,r,i),Ove),pE.set(t.id,s)}var Pt;function H8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function wc(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?H8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):H8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function z8(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=sb,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new mE(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function mE(t){function r(i){if(Object(i)!==i)return ke.reject(new TypeError(i+" is not an object."));var s=i.done;return ke.resolve(i.value).then(function(c){return{value:c,done:s}})}return mE=function(i){this.s=i,this.n=i.next},mE.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?ke.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?ke.reject(i):r(s.apply(this.s,arguments))}},new mE(t)}let Ku=(Pt=class extends An{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Je.StateChange,r,this._state)}constructor(t,r){super(),L(this,"isPlanB",void 0),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"connection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"remoteDataChannelMap",new Map),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"pendingLocalDataChannels",[]),L(this,"pendingRemoteDataChannels",[]),L(this,"statsCollector",void 0),L(this,"shouldForwardP2PCreation",void 0),L(this,"iceFailedCount",0),L(this,"dtlsFailedCount",0),L(this,"mutex",void 0),L(this,"_state",Jt.Disconnected),L(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?sl.FIRST_CONNECTION:sl.OLD_FIRST_CONNECTION),L(this,"_isStartRestartIce",!1),L(this,"_restartTimer",void 0),L(this,"_isTryConnecting",!1),L(this,"_iceError",null),L(this,"_forceTurn",!1),L(this,"_isWaitPcToRePub",!1),L(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void c(new he(H.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void s();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];this.store.enableInstantMuteRestore?(y.track._originMediaStreamTrack.enabled=!1,R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):y.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(y=>{let[,{id:_}]=y;return _}));const g=this.createMuteMessage(h);await fn(this,Je.RequestMuteLocal,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jt.Connected)return void c(new he(H.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(this.store.enableInstantMuteRestore)y.track._originMediaStreamTrack.enabled=!0,R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(y.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const _=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=_,y.track._originMediaStreamTrack=_}else{const _=_I(i,Ru(this,Je.RequestLowStreamParameter));y.track._mediaStreamTrack=_,y.track._originMediaStreamTrack=_}await new ke((_,x)=>{this.handleReplaceTrack(y.track,_,x,!0)})}}this.store.enableInstantMuteRestore?R.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(y=>{let[,{id:_}]=y;return _}));const g=this.createUnmuteMessage(h);await fn(this,Je.RequestUnmuteLocal,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==Jt.Connected)return void s();const{id:y,track:_}=g;await this.connection.updateSendParameters(y,_),await this.connection.updateEncoderConfig(y,_),this.emit(Je.UpdateVideoEncoder,_),s()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),L(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Jt.Connected)return void s();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleReplaceMixingTrack",async(i,s,c,u)=>{if(!this.connection||this.state!==Jt.Connected)return void s();const h=gI([i]);let m;R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),s()}catch(y){c(y)}finally{var g;(g=m)===null||g===void 0||g()}}),L(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:x}]=_;return i===x});if(!this.connection||!y||this.state!==Jt.Connected)return void s();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const _=y[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],_)}if(y[0]===Ae.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const _=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(_){const x=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=x,_.track._originMediaStreamTrack=x,await new ke((S,C)=>{this.handleReplaceTrack(_.track,S,C,!0)})}}s()}catch(y){c(y)}finally{var g;(g=h)===null||g===void 0||g()}}),L(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new G8(this.store),this.bindStatsUploaderEvents(),this.mutex=new Rr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!It().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&fc(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&It().supportPCSetConfiguration&&AF(),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var i;this.state=Jt.New,this._forceTurn=yI(t),R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||r)&&((s||r)&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=cv(this.store,t),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new he(H.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?sl.FIRST_CONNECTION:sl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new he(H.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Jt.Connected){this.store.peerConnectionStart();const r=await this.connection.connect(t);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected,r}if(this.connection instanceof za&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),$e.reportApiInvoke(this.store.sessionId,{name:Tn.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:dn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Je.RequestReconnect)});await this.connection.updateRemoteConnect(t)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return Re(u=[Ae.LocalVideoLowTrack,Ae.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),s=r.map(c=>{let[u]=c;return u});if(this.connection instanceof za||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if($e.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Re(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>Re(t).call(t,u));c&&(this.store.codec=c,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,t)}}async getEstablishParams(){var t;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof za&&this.connection.peerConnectionState!=="closed"&&Re(t=[Jt.New,Jt.Connected]).call(t,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(t){if(!this.connection||this.state!==Jt.Connected){if(this.state===Jt.Disconnected)throw new he(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(i=>{var s;Re(s=this.pendingLocalDataChannels).call(s,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}),t.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(t,r,i){var s=this;return Mi(function*(){const c=yield Tt(s.mutex.lock("From P2PChannel.publish"));try{var u;const h=s.connection&&Re(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Jt.Connected||h){if(s.state===Jt.Disconnected)throw new he(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const g=t.filter(y=>s.pendingLocalTracks.indexOf(y)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(h&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const m=s.filterTobePublishedTracks(t,r,i);if(m.length===0)return void(yield Tt(s.tryToUnmuteAudio(t)));yield*Ap(z8(s.doPublish(s.connection,m)))}finally{c()}})()}doPublish(t,r){var i=this;return Mi(function*(){r.forEach(S=>{let{track:C,type:M}=S;const D=Date.now();i.store.publish(C.getTrackId(),M===Ae.LocalAudioTrack?"audio":"video",D)}),i.bindLocalTrackEvents(r);const s=r.map(S=>{let{track:C}=S;return C}),c=yield Tt(t.send(s,i.store.codec,i.store.audioCodec)),u=(yield Tt(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(S){throw c.throw(S),(S==null?void 0:S.code)===H.WS_ABORT&&r.forEach(C=>{let{track:M}=C;i.pendingLocalTracks.indexOf(M)===-1&&i.pendingLocalTracks.push(M)}),i.unbindLocalTrackEvents(r),S}const g=i.mapPubResToRemoteConfig(h,m,s),y=(yield Tt(c.next(g))).value;if(i.state===Jt.Disconnected)throw new he(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const _=G("ENABLE_ENCODED_TRANSFORM"),x=G("ENABLE_AUDIO_METADATA");s.forEach(async S=>{const C=S.getRTCRtpTransceiver();if(!C||!_)return;const{interceptLocalVideoFrame:M,interceptLocalAudioFrame:D}=rE();S.trackMediaType===Ge.VIDEO?await M(C.sender,S):S.trackMediaType===Ge.AUDIO&&await D(C.sender,{metadata:x?()=>{const j=S.metadata.shift();return j&&j.value}:void 0})}),r.forEach(S=>{let{type:C}=S;i.statsCollector.addLocalStats(C)}),i.assignLocalTracks(r,y),i.statsUploader.startUploadOutboundStats(),r.forEach(S=>{let{track:C,type:M}=S;const D=Date.now();i.store.publish(C.getTrackId(),M===Ae.LocalAudioTrack?"audio":"video",void 0,D)})})()}async updateVideoStreamParameter(t,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof un))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=qA(u,h)),m.maxFramerate=u.framerate?Gi(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,s);if(s._encoderConfig||(s._encoderConfig={}),r!==Ae.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=s._originMediaStreamTrack;if(!u.canvas)return R.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=Gi(m.width)),m.height&&(g.height=Gi(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=_A(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Gi(m.framerate)))})(u,t)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),R.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var r=this;return Mi(function*(){if(!r.connection||r.state!==Jt.Connected)return;const i=yield Tt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ae.LocalVideoTrack);if(!c)throw new he(H.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ae.LocalVideoLowTrack))throw new he(H.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Ae.LocalVideoLowTrack}];if(yield*Ap(z8(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var s;const h=(s=r.localTrackMap.get(Ae.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield Tt(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,Je.RequestRePublish,this.pendingLocalTracks),this.emit(Je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await er(this,Je.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:s}=this.pendingRemoteTracks[r];(s!==Ge.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==Ge.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await er(this,Je.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===Ge.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(Je.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Jt.Connected)return void t.forEach(s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Jt.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jt.Connected)return;const t=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ae.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const i=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[c,{track:u}]=s;return{type:c,track:u}})),r.forEach(s=>{let[c]=s;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Jt.Connected)throw new he(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(s=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:g}=h;return m.uid===t.uid&&g===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(s=>s.id)}async subscribe(t,r,i,s,c){var u;if(!this.connection||this.state!==Jt.Connected)throw new he(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,g,y;const _=this.connection.getPreMedia(i);if(_)R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),g=_.transceiver,h=_.track,m=_.mid,y=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:_.firstVideoRender});else if(c){const C=c.find(D=>{let{stream_type:j}=D;return j===r});if(!C)throw new he(H.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const M=await this.connection.receive(r,C.ssrcs,String(t._uintid),C.attributes);(this.connection instanceof za||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=M.transceiver),h=M.track,m=M.id}else{const C=await this.connection.receive(r,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);(this.connection instanceof za||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=C.transceiver),h=C.track,m=C.id}if(r===Ge.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new zp(h,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new Hp(h,t.uid,t._uintid,this.store,y),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(ds.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(ds.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),y?t._videoTrack.once(ds.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(ds.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:C,interceptRemoteAudioFrame:M}=rE();r==Ge.VIDEO?await C(g.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(D=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(D)}),onFirstFrame:D=>{var j;const $=Array.from(si(j=this.remoteUserMap).call(j)).find(K=>K._videoSSRC===D.ssrc);$&&this.store.firstVideoFrameDecoded($.uid,{firstReceivedEncodedFrame:Date.now(),frameType:D.type,rtpTimestamp:D.rtpTimestamp,framePayloadType:D.payloadType,frameDataLength:D.length,mimeType:D.mimeType})}}):r==Ge.AUDIO&&await M(g.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:D=>{this.safeEmit(Je.AudioMetadata,D)},onPts:D=>{this.safeEmit(Je.AudioPts,D)}})}const x=this.remoteUserMap.get(t);x?x.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(C=>{let{user:M,kind:D}=C;return M.uid===t.uid&&r===D});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Je.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Jt.Connected)throw new he(H.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);if(u){const{track:h,mid:m,transceiver:g,player:y}=u;i.set(c.ssrcId,{track:h,id:m,transceiver:g,player:y})}else r.push(c)});const s=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,s[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=i.get(h);if(!m)return void R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:g,id:y,transceiver:_,player:x}=m;if(_&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:M,interceptRemoteAudioFrame:D}=rE();u==Ge.VIDEO?await M(_.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(j=>{var $;return($=c._videoTrack)===null||$===void 0?void 0:$._onSei(j)}),onFirstFrame:j=>{var $;const K=Array.from(si($=this.remoteUserMap).call($)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==Ge.AUDIO&&await D(_.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),enablePts:!!G("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Je.AudioMetadata,j)},onPts:j=>{this.safeEmit(Je.AudioPts,j)}})}if(u===Ge.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new zp(g,c.uid,c._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),_&&c._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new Hp(g,c.uid,c._uintid,this.store,x),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),_&&c._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(c,c._videoTrack)),G("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:M,interceptRemoteAudioFrame:D}=rE();u==Ge.VIDEO?await M(_.receiver,{onSei:j=>{var $;($=c._videoTrack)===null||$===void 0||$._onSei(j)},onFirstFrame:j=>{var $;const K=Array.from(si($=this.remoteUserMap).call($)).find(J=>J._videoSSRC===j.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==Ge.AUDIO&&await D(_.receiver)}const S=this.remoteUserMap.get(c);S?S.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const C=this.pendingRemoteTracks.findIndex(M=>{let{user:D,kind:j}=M;return D.uid===c.uid&&u===j});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Je.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid});if(s.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Jt.Connected||i||s.forEach(h=>{let{kind:m}=h;var g;if(m===Ge.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===Ge.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Jt.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:g}]=h;var y,_;if(g===Ge.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===Ge.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((_=m._videoTrack)===null||_===void 0||_._destroy(),m._videoTrack=void 0);else if(g===Ge.AUDIO){var x;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((x=m._audioTrack)===null||x===void 0||x._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,r);if(i.length===0)return;r.forEach(c=>{c._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(c=>{s&&s.delete(c.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:y}=m;return u!==void 0?g.uid===c.uid&&u===y:g.uid===c.uid});h.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(h)}if(!this.connection||this.state!==Jt.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===Ge.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===Ge.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});const i=ss(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,g;if(h===Ge.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Ge.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(h===Ge.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(t){return!this.connection||this.state!==Jt.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Ge.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ae.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ae.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Ae.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Ae.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Ae.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,i,s,c){if(t){const h=this.localTrackMap.get(Ae.LocalAudioTrack),m=s?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Qt.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(g=>g instanceof Vn),m=s?(u=this.localTrackMap.get(Ae.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof un);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Qt.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Ge.VIDEO?i._videoSSRC:i._audioSSRC;c&&$e.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Ge.VIDEO,audio:s===Ge.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Rr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jt.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ae.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ae.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof un||r&&r.track instanceof Vn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(si(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ae.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=gu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Ae.LocalVideoTrack:Re(r=s._hints).call(r,Qt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Ae.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Ae.LocalVideoLowTrack:}}),this.emit(Je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Je.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(r,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const i of this.pendingRemoteDataChannels){const{user:s,id:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Mi(function*(){if(!r.connection||r.state!==Jt.Connected)return;const i=yield Tt(r.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Tt(r.connection.restartICE(t));const u=yield Tt(s.next());if(u.done)return;const h=u.value,m=yield h;switch(vI(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ar.UDP_TCP_RELAY:r._pcStatsUploadType=sl.UDP_TCP_RESTART;break;case Ar.TCP_RELAY:r._pcStatsUploadType=sl.TCP_RESTART;break;case Ar.RELAY:r._pcStatsUploadType=sl.RELAY_RESTART;break;default:r._pcStatsUploadType=sl.OLD_RESTART}r._isTryConnecting=!0,s.next(m)}catch(u){var c;(c=s)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ae.LocalVideoTrack),i=this.localTrackMap.get(Ae.LocalAudioTrack),s=t.videoSend.find(C=>C.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(C=>C.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!c)return 1;const u=Ea(this,Je.NeedSignalRTT),h=s?s.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*y/1500,x=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=r==null?void 0:r.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qt.SCREEN_TRACK)===-1){const C=S._encoderConfig.bitrateMax,M=t.bitrate.actualEncoded;if(C&&M){const D=(1e3*C-M)/(1e3*C);return P6[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=t.audioRecv.find(M=>M.ssrc===c),m=t.videoRecv.find(M=>M.ssrc===u);if(!h&&!m)return void(r+=1);const g=Ea(this,Je.NeedSignalRTT),y=t.rtt,_=(y&&g?(y+g)/2:y||g)||0,x=h?h.jitterMs:void 0,S=t.recvPacketLossRate;let C=.7*S*100/50+.3*_/1500;x&&(C=.6*S*100/50+.2*_/1500+.2*x/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ke((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}async replaceTrack(t,r){var i;if(R.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Jt.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!s)return;const c=s[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),s[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,s[1].id)),this.isPlanB){const u=s[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ae.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding){const u=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ke((m,g)=>{this.handleReplaceTrack(u.track,m,g,!0)})}}}filterTobePublishedTracks(t,r,i){const s=[],c=this.getAllTracks();t=Pp(t=t.filter(g=>c.indexOf(g)===-1));let u,h=!1;const m=this.localTrackMap.get(Ae.LocalAudioTrack);for(const g of t){if(g instanceof un&&(this.localTrackMap.has(Ae.LocalVideoTrack)||h?new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Ae.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(g,i);s.push({track:y,type:Ae.LocalVideoLowTrack})}if(g instanceof Vn)if(m){const y=m.track;if(y instanceof or)fI([g]),y.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const _=gI([y,g]);R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(y,_)}}else u instanceof or?(fI([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&It().webAudioMediaStreamDest&&!g._bypassWebAudio?u=gI(u?[g,u]:[g]):u=g}return u&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:Ae.LocalAudioTrack})),s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Pp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Vn){const c=this.localTrackMap.get(Ae.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Ae.LocalAudioTrack,c]),c.track.close())):r.push([Ae.LocalAudioTrack,c])}if(s instanceof un){const c=this.localTrackMap.get(Ae.LocalVideoTrack);if(!c)continue;r.push([Ae.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ae.LocalVideoLowTrack);u&&r.push([Ae.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=Pp(t)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Pp(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ae.LocalVideoTrack:i.addListener(He.GET_STATS,this.handleGetLocalVideoStats),i.addListener(He.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.GET_STATS,this.handleGetLocalAudioStats),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(He.GET_STATS,this.handleGetLocalAudioStats),t.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(He.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ae.LocalVideoTrack:i.off(He.GET_STATS,this.handleGetLocalVideoStats),i.off(He.GET_RTC_STATS,this.handleGetRTCStats),i.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(He.GET_STATS,this.handleGetLocalAudioStats),r.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(He.GET_STATS,this.handleGetLocalAudioStats),t.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(He.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Hp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof zp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(He.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,h,{track:m,type:g}=i;switch(g){case Ae.LocalAudioTrack:u=nn.Audio,h={dtx:m instanceof Xg&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ae.LocalVideoTrack:u=Re(c=m._hints).call(c,Qt.SCREEN_TRACK)?nn.Screen:nn.High,h=wc(wc({},K6(m)),{},{codec:this.store.codec,svc_mode:ev()});break;case Ae.LocalVideoLowTrack:u=nn.Low,h=wc(wc({},K6(m)),{},{codec:this.store.codec,svc_mode:ev()})}return{stream_type:u,attributes:h,ssrcs:r[s]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Je.PeerConnectionStateChange,r),r==="connecting"&&t instanceof za&&!En()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},G("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof za&&W8(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=sl.DISCONNECTED_OR_FAILED,Ea(this,Je.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),s=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));$e.reportApiInvoke(this.store.sessionId,{name:Tn.REPUB_AFTER_PC_CONNECTED,options:i.concat(s),tag:dn.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&t instanceof za&&!En()&&!this._forceTurn&&!this.store.useDcSignal){if(Re(B6).call(B6,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{vI(t)&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Ea(this,Je.QueryClientConnectionState)==="CONNECTED"&&this.emit(Je.RequestRestartICE,c))},s=()=>{vI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{$8(t,i,s)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&Ea(this,Je.QueryClientConnectionState)==="CONNECTED"&&this.emit(Je.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Je.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),$e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:dn.TRACER}).onSuccess(),this.emit(Je.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ds.FIRST_FRAME_DECODED),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,Cn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,Cn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===r);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoRender=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s),this.emit(Je.FirstVideoPreRender,s.uid,r))},t.onFirstVideoReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,Cn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstVideoBufferReady=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&this.emit(Je.FirstVideoBufferReady,s.uid,r)},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Je.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return wc(wc({},r),i)},t.onICECandidateError=r=>{this._iceError=r}}fallbackConnection(){R.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Jt.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=cv(this.store),this.emit(Je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(t){t instanceof za&&function(r){sm.delete(r.id),W8(r)}(t),t.close(),this.emit(Je.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Ae.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Ae.LocalVideoTrack)){const c=this.localTrackMap.get(Ae.LocalVideoLowTrack);c&&r.push([Ae.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Ae.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Ae.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Ae.LocalVideoLowTrack);c&&r.push([Ae.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([t,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(t,r){const i=[];return r.forEach(s=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case Ge.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Ge.VIDEO,ssrcId:s._videoSSRC}));case Ge.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Ge.AUDIO,ssrcId:s._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(i=>{let[s,{kind:c}]=i;if(r.has(s)){let u=r.get(s);c===Ge.VIDEO?u|=br.Video:u|=br.Audio,r.set(s,u)}else c===Ge.VIDEO?r.set(s,br.Video):r.set(s,br.Audio)}),{users:Array.from(r.entries()).map(i=>{let[s,c]=i;return{stream_id:s.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ae.LocalVideoTrack),i=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ke((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ke((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof za&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof za)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof za&&this.connection.isPreRender}mapPubResToRemoteConfig(t,r,i){return t.map((s,c)=>{var u;let{stream_type:h}=s;const m=(u=r.find(g=>{let{stream_type:y}=g;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&G("DISABLE_SCREEN_SHARE_REMB")){const g=i[c]._hints;(Re(g).call(g,Qt.SCREEN_TRACK)||Re(g).call(g,Qt.SCREEN_LOW_TRACK))&&(m.remb=!1,R.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Vn){var r;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(s.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(s);return void await fn(this,Je.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Je.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Je.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yr(_b(this.dtlsFailedCount,Yn)),this.emit(Je.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await er(this,Je.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Je.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof un)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof un).length>1)throw new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Vn).length>1&&(t.some(r=>r instanceof Vn&&r._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof un&&this.pendingLocalTracks.some(i=>i instanceof un))throw new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Vn&&this.pendingLocalTracks.some(i=>i instanceof Vn)&&(!It().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vn&&i._bypassWebAudio)))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var i;const s=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,c=wc(wc({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=s?t._mediaStreamTrack.clone():_I(t,c);const h=en(8,"track-low-"),m=new un(u,wc(wc({},s&&{scaleResolutionDownBy:qA(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ju.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,Fp.LOW_STREAM)}),m._hints.push(Qt.LOW_STREAM),Re(i=t._hints).call(i,Qt.SCREEN_TRACK)&&m._hints.push(Qt.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),t.addListener(He.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof za){var c,u,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:_,peerConnectionState:x}=this.connection,{local:S,remote:C}=await this.connection.getSelectedCandidatePair();$e.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:y,dtlsstate:_,connectionstate:x,intSucc:r?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=S==null?void 0:S.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=S.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(h=C.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=C.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,i=r.firstVideoFrameDecoded.find(_=>_.userId===t.uid);if(!i)return;const{isInternalUpload:s,isExternalUpload:c}=i;if(s&&c)return;const{subscribeEnd:u,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=i;let{firstRender:y=0}=i;if(u&&(y||h)&&m&&g){i.isInternalUpload=!0;const{playEnd:_}=i;_&&(i.isExternalUpload=!0);const{firstPreRender:x=0}=i;y=x||y;const S=t.videoTrack,C={peer:t._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:x||0,firstRender:_?Math.max(y,_):Math.max(y,u),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:pV(this.store),firstReceivedEncodedFrame:i.firstReceivedEncodedFrame||0,frameType:i.frameType||"",rtpTimestamp:i.rtpTimestamp||0,framePayloadType:i.framePayloadType||0,frameDataLength:i.frameDataLength||0,mimeType:i.mimeType||""};$e.firstXLAPeerFirstVideoFrame(this.store.sessionId,C)}}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");$e.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,Cn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Ae.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Fp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},je(Pt.prototype,"startP2PConnection",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"startP2PConnection"),Pt.prototype),je(Pt.prototype,"connect",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),je(Pt.prototype,"updateRemoteRTPCapabilities",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"updateRemoteRTPCapabilities"),Pt.prototype),je(Pt.prototype,"publishDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"publishDataChannel"),Pt.prototype),je(Pt.prototype,"unpublish",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublish"),Pt.prototype),je(Pt.prototype,"unpublishDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishDataChannel"),Pt.prototype),je(Pt.prototype,"unpublishLowStream",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unpublishLowStream"),Pt.prototype),je(Pt.prototype,"subscribeDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribeDataChannel"),Pt.prototype),je(Pt.prototype,"subscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"subscribe"),Pt.prototype),je(Pt.prototype,"massSubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"massSubscribe"),Pt.prototype),je(Pt.prototype,"unsubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribe"),Pt.prototype),je(Pt.prototype,"unsubscribeDataChannel",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unsubscribeDataChannel"),Pt.prototype),je(Pt.prototype,"massUnsubscribe",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"massUnsubscribe"),Pt.prototype),je(Pt.prototype,"muteRemote",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"muteRemote"),Pt.prototype),je(Pt.prototype,"unmuteRemote",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteRemote"),Pt.prototype),je(Pt.prototype,"hasRemoteMediaWithLock",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"hasRemoteMediaWithLock"),Pt.prototype),je(Pt.prototype,"disconnectForReconnect",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"disconnectForReconnect"),Pt.prototype),je(Pt.prototype,"updateBitrateLimit",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"updateBitrateLimit"),Pt.prototype),je(Pt.prototype,"remoteMediaSsrcChanged",[pi],Object.getOwnPropertyDescriptor(Pt.prototype,"remoteMediaSsrcChanged"),Pt.prototype),Pt);function pi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function K8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Y8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?K8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):K8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const Pve=Date.now(),Dve=20,xI=new Map,fE=new Map;async function q8(t){const r=xI.get(t),i=Array.isArray(r)&&r[r.length-1],s=fE.get(t);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:i.payload};s.firstRecvTs===0&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const u=i.sendTs-s.firstSendTs,h=u-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),X8(i.context,c),m=0):m=Math.min(m,Dve),setTimeout(()=>r.length&&q8(t),m)}function X8(t,r){t.safeEmit(Rt.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function kve(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return X8(i,{uid:t.uid,payload:t.payload});const s="".concat(i.id,"-").concat(t.uid),c=xI.get(s)||[],u=c.findIndex(y=>t.sendTs>=y.sendTs),h=Y8(Y8({},t),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),xI.set(s,c);let m=!1;var g;fE.has(s)?m=!((g=fE.get(s))===null||g===void 0||!g.isSyncing):fE.set(s,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||q8(s)}const jve=Wt().name;function J8(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Q8(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?J8(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):J8(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const om="websdk_ng_cache_parameter",Lve=G("MAX_PRELOAD_ASYNC_LENGTH"),Mve=1e4,Yu=new Map,qu=[];let SI=null,wI=0,TI=0;const gE=new Map,Z8=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),Uve=function(t,r){const i=[];let s=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&s<r?c():s--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ke(async(g,y)=>{i.push(async()=>{try{const _=await t(...h);g(_)}catch(_){y(_)}}),s<r&&(s++,c())})}}(NI,Lve),CI=Ui.CancelToken.source();class Fve{constructor(){L(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const r=this._audioContext.sampleRate,i=10*r,s=this._audioContext.createBuffer(2,i,r),c=this._audioContext.createBufferSource();c.buffer=s;const u=this._audioContext.createMediaStreamDestination();return c.connect(u),c.start(),u.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function NI(t,r,i,s,c,u,h){try{if(!G("ENABLE_PRELOAD"))return;if(!It().supportWebCrypto)return void td(()=>{R.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new he(H.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Mr(i,"token",1,2047),Mr(t,"appid",1,2047),Hb(r),s&&zb(s);const m=Ou();R.debug("preload channel ".concat(r,", uid is ").concat(s));const g={appId:t,cname:r,token:i||t,uid:typeof s!="string"?s:null,sid:m,proxyServer:c,role:h};let y,_;typeof s=="string"?(g.stringUid=s,[_,y]=await ke.all([bve(s,{sid:m,appId:t},CI.token),S8(Q8(Q8({},g),{},{token:i||t,uid:0}),CI.token)]),g.uid=_.uid,y.gatewayInfo.uid=g.uid,y.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),y=await S8(g,CI.token));const x={sid:m,appId:t,cname:r,token:i||t,uid:g.stringUid||s,intUid:g.uid||y.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:_,ap:y};await AI(x),wI++}catch(m){throw TI++,function(g){SI||(SI=window.setTimeout(()=>{let _="";gE.forEach((x,S)=>{_+="".concat(S,": ").concat(x," ;")}),$e.reportApiInvoke(null,{name:Tn.PRELOAD,options:{success:wI,failed:TI,err:_}}).onError(g),wI=0,TI=0,gE.clear(),SI=null},Mve));const y=gE.get(g.code)||0;gE.set(g.code,y+1)}(m),m}}async function RI(t){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const r=eG(t);if(!r||t.cloudProxyServer!=="disabled")return;const i=await async function(s,c){try{const u=await window.crypto.subtle.importKey("raw",BF(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:Z8},u,Iu(s));return JSON.parse(window.atob(nd(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!i||!function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1}(i,t))return;if(i&&Date.now()-i.ts<G("AP_CACHE_LIFETIME"))return i}catch(r){R.warn("Error get preloadInfo",r.message)}}function eG(t){let r;try{if(r=rG(om),!r)return;const i=JSON.parse(r),s=iG(t),c=function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1}(i,h=>s in h);if(c===-1)return;const u=i.splice(c,1)[0];return vE(om,JSON.stringify(i)),u[s]}catch(i){R.warn("Error delete preload info: ".concat(r),i.message),vE(om,"")}}async function AI(t){let r;try{t.uid&&eG({appId:t.appId,cname:t.cname,token:t.token,uid:t.uid,stringUid:t.stringUid});const i=iG(t),s=await async function(u,h){try{const m=await window.crypto.subtle.importKey("raw",BF(h),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:Z8},m,Iu(window.btoa(JSON.stringify(u))));return nd(new Uint8Array(g))}catch{return}}(t,t.token||t.appId);if(!s)return;r=rG(om);const c=r?JSON.parse(r):[];c.push({[i]:s}),c.length>G("AP_CACHE_NUM")&&c.shift(),vE(om,JSON.stringify(c))}catch(i){R.warn("Error caching server parameters:",i.message),vE(om,"")}}function II(t){if(t){let r=Yu.get(t);r&&(window.clearTimeout(r),r=null,Yu.delete(t)),Re(qu).call(qu,t)||t.cloudProxyServer!=="disabled"||qu.push(t)}if(Yu.size<G("AP_CACHE_NUM")&&qu.length>0){const r=qu.shift();Yu.set(r,window.setTimeout(async()=>{const{appId:i,cname:s,token:c,stringUid:u,uid:h,proxyServer:m,role:g}=r;try{await Uve(i,s,c,h,m,u,g),Yu.has(r)&&II(r)}catch(y){R.warn("update preload failed",y.message),tG(r)}},G("AP_UPDATE_INTERVAL")))}}function tG(t){const r=qu.indexOf(t);r!==-1&&qu.splice(r,1);let i=Yu.get(t);i&&(window.clearTimeout(i),i=null,Yu.delete(t),II())}function nG(t,r){const i=t.sua,s=t.ap;r&&i&&$e.reqUserAccount(t.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:t.intUid,errorCode:null,extend:i.req}),$e.reportResourceTiming(t.ap.url,t.sid),$e.joinWebProxyAP(t.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[qn.CHOOSE_SERVER,qn.CLOUD_PROXY_FALLBACK].toString()}),$e.joinChooseServer(t.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[qn.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function rG(t){return window.atob(window.localStorage.getItem(t)||"")}function vE(t,r){window.localStorage.setItem(t,window.btoa(r))}function iG(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),YF(r)}function Vve(t){let r=function(){const i=Wve.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;c!==void 0&&(Xn(s,10),ud(s,c));let u=i.cid;u!==void 0&&(Xn(s,16),Xn(s,u));let h=i.cname;h!==void 0&&(Xn(s,26),ud(s,h));let m=i.deviceId;m!==void 0&&(Xn(s,34),ud(s,m));let g=i.elapse;g!==void 0&&(Xn(s,40),hd(s,g));let y=i.fileSize;y!==void 0&&(Xn(s,48),hd(s,cm(y)));let _=i.height;_!==void 0&&(Xn(s,56),hd(s,cm(_)));let x=i.jpg;x!==void 0&&(Xn(s,66),Xn(s,x.length),sG(s,x));let S=i.networkType;S!==void 0&&(Xn(s,72),hd(s,cm(S)));let C=i.osType;C!==void 0&&(Xn(s,80),hd(s,cm(C)));let M=i.requestId;M!==void 0&&(Xn(s,90),ud(s,M));let D=i.sdkVersion;D!==void 0&&(Xn(s,98),ud(s,D));let j=i.sequence;j!==void 0&&(Xn(s,104),hd(s,cm(j)));let $=i.sid;$!==void 0&&(Xn(s,114),ud(s,$));let K=i.timestamp;K!==void 0&&(Xn(s,120),hd(s,K));let J=i.uid;J!==void 0&&(Xn(s,128),Xn(s,J));let ne=i.vid;ne!==void 0&&(Xn(s,136),Xn(s,ne));let ae=i.width;ae!==void 0&&(Xn(s,144),hd(s,cm(ae)));let Q=i.service;Q!==void 0&&(Xn(s,152),Xn(s,Q));let oe=i.callbackData;oe!==void 0&&(Xn(s,162),Xn(s,oe.length),sG(s,oe));let ge=i.ticket;ge!==void 0&&(Xn(s,170),ud(s,ge));let Ee=i.vendorConfigs;Ee!==void 0&&(Xn(s,178),ud(s,Ee))}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function Bve(t){return function(i){let s={};e:for(;!$ve(i);){let c=dv(i);switch(c>>>3){case 0:break e;case 1:s.code=dv(i);break;case 2:s.msg=oG(i,dv(i));break;case 3:s.requestId=oG(i,dv(i));break;case 4:s.timestamp=Hve(i,!1);break;default:Gve(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function Gve(t,r){switch(r){case 0:for(;128&Ys(t););break;case 2:OI(t,dv(t));break;case 5:OI(t,4);break;case 1:OI(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function cm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Wve=[];function OI(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function $ve(t){return t.offset>=t.limit}function yE(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),s}function aG(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function sG(t,r){let i=yE(t,r.length);t.bytes.set(r,i)}function oG(t,r){let i=aG(t,r),s=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let g,y,_,x,S=c[m+i];128&S?(224&S)==192?m+1>=r?h+=u:(g=c[m+i+1],(192&g)!=128?h+=u:(x=(31&S)<<6|63&g,x<128?h+=u:(h+=s(x),m++))):(240&S)==224?m+2>=r?h+=u:(g=c[m+i+1],y=c[m+i+2],(49344&(g|y<<8))!=32896?h+=u:(x=(15&S)<<12|(63&g)<<6|63&y,x<2048||x>=55296&&x<=57343?h+=u:(h+=s(x),m+=2))):(248&S)==240?m+3>=r?h+=u:(g=c[m+i+1],y=c[m+i+2],_=c[m+i+3],(12632256&(g|y<<8|_<<16))!=8421504?h+=u:(x=(7&S)<<18|(63&g)<<12|(63&y)<<6|63&_,x<65536||x>1114111?h+=u:(x-=65536,h+=s(55296+(x>>10),56320+(1023&x)),m+=3))):h+=u:h+=s(S)}return h}function ud(t,r){let i=r.length,s=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}Xn(t,s);let c=yE(t,s),u=t.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Ys(t){return t.bytes[aG(t,1)]}function cG(t,r){let i=yE(t,1);t.bytes[i]=r}function dv(t){let r,i=0,s=0;do r=Ys(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function Xn(t,r){for(r>>>=0;r>=128;)cG(t,127&r|128),r>>>=7;cG(t,r)}function Hve(t,r){let i,s=0,c=0,u=0;return i=Ys(t),s=127&i,128&i&&(i=Ys(t),s|=(127&i)<<7,128&i&&(i=Ys(t),s|=(127&i)<<14,128&i&&(i=Ys(t),s|=(127&i)<<21,128&i&&(i=Ys(t),c=127&i,128&i&&(i=Ys(t),c|=(127&i)<<7,128&i&&(i=Ys(t),c|=(127&i)<<14,128&i&&(i=Ys(t),c|=(127&i)<<21,128&i&&(i=Ys(t),u=127&i,128&i&&(i=Ys(t),u|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|u<<24,unsigned:r}}function hd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=yE(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[h+4]=u!==5?128|s:127&s;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const lG={},dG={},_E=4294967296,zve=_E*_E,uG=zve/2;pG(0,!0);const hG=pG(0),Kve=uv(0,-2147483648,!1),Yve=uv(-1,2147483647,!1);function pG(t,r){let i,s,c;return r?(c=0<=(t>>>=0)&&t<256)&&(s=dG[t],s)?s:(i=uv(t,0,!0),c&&(dG[t]=i),i):(c=-128<=(t|=0)&&t<128)&&(s=lG[t],s)?s:(i=uv(t,t<0?-1:0,!1),c&&(lG[t]=i),i)}function uv(t,r,i){return{low:0|t,high:0|r,unsigned:!!i}}function mG(t,r){if(isNaN(t))return hG;{if(t<=-uG)return Kve;if(t+1>=uG)return Yve}return t<0?hG:uv(t%_E|0,t/_E|0,r)}function fG(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class PI extends An{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Po.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),L(this,"name","AgoraRTCImageModeration"),L(this,"_connectionState",ps.CONNECTING),L(this,"_sequence",0),L(this,"_moderationStartTime",void 0),L(this,"_workerConnection",void 0),L(this,"_workerMessageLengthLimit",void 0),L(this,"_qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Ui.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"_moderationInterval",void 0),L(this,"_moderationTimer",null),L(this,"_moderationMode",1),L(this,"_quality",1),L(this,"_qualityTimer",null),L(this,"_ticket",void 0),L(this,"_moderationIntervalMinimum",void 0),L(this,"_uploadFailedNum",0),L(this,"_uploadNum",0),L(this,"_uploadTimer",null),L(this,"_extraInfo",void 0),L(this,"_vendor",""),L(this,"_encoder",new TextEncoder),L(this,"_moderationId",void 0),L(this,"inspectImage",()=>{if(this.connectionState!==ps.CONNECTED)throw new ce(H.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ps.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=en(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qg("worker-"+this._moderationId,Yn),this.on(Po.STATE_CHANGE,(s,c)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Xp[s]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(Po.STATE_CHANGE,Xp.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new ke((c,u)=>{this.on(Po.CONNECTION_STATE_CHANGE,(h,m)=>{h===ps.CONNECTED&&c()}),this.requestAP(r,s,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===ps.CONNECTED&&this.inspectImage()}async requestAP(r,i,s){const c=G("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await function(g,y,_,x){let{appId:S,areaCode:C,cname:M,sid:D,token:j,uid:$}=y;tm++;const K="moderation_plugin",J={service_name:K,json_body:JSON.stringify({appId:S,areaCode:C,cname:M,command:"allocateEdge",requestId:tm,seq:tm,sid:D,appToken:j,ts:Date.now(),uid:$+""})};let ne,ae,Q=g[0];return Ro(async()=>{ne=Date.now();const oe=await ko(Q,{data:J,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-ne,oe.code!==0){const ot=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+oe.code,{retry:!0,responseTime:ae});throw R.error(ot.toString()),ot}const ge=JSON.parse(oe.json_body);if(ge.code!==200){const ot=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ge.code,", reason: ").concat(ge.reason),{code:ge.code,responseTime:ae});throw R.error(ot.toString()),ot}if(!ge.servers||!Array.isArray(ge.servers)||ge.servers.length===0){const ot=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ge.code,responseTime:ae});throw R.error(ot.toString()),ot}if(!ge.servers.some(ot=>!!ot.wss)){const ot=new ce(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ge.code,responseTime:ae});throw R.error(ot.toString()),ot}const Ee=G("IMAGE_MODERATION_WORKER_WSS");if(Ee)return{addressList:[Ee],workerToken:ge.workerToken,vid:ge.vid,responseTime:ae};const Fe=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:ge.servers.map(ot=>{let{address:wt,wss:_t}=ot;if(wt&&_t)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(Fe,":").concat(_t,"/moderation")}).filter(ot=>!!ot),workerToken:ge.workerToken,vid:ge.vid,ticket:ge.appTicket,responseTime:ae}},(oe,ge)=>($e.apworkerEvent(D,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(oe.addressList),firstSuccess:ge===0,responseTime:ae,serverIp:g[ge%g.length]}),!1),(oe,ge)=>($e.apworkerEvent(D,{success:!1,sc:oe.data&&oe.data.code||200,serviceName:K,responseTime:ae,serverIp:g[ge%g.length]}),!!(oe.code!==H.OPERATION_ABORTED&&oe.code!==H.UNEXPECTED_RESPONSE||oe.data&&oe.data.retry)&&(Q=g[(ge+1)%g.length],!0)),x)}(c,r,i,s);this.emit(Po.STATE_CHANGE,Xp.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(Po.STATE_CHANGE,Xp.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Et.CONNECTED,async()=>{this.emit(Po.STATE_CHANGE,Xp.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ps.CONNECTED}),this._workerConnection.on(Et.CLOSED,()=>{this.connectionState=ps.CLOSED}),this._workerConnection.on(Et.FAILED,()=>{this.connectionState=ps.CLOSED}),this._workerConnection.on(Et.RECONNECTING,()=>{this.connectionState=this.connectionState===ps.CONNECTED?ps.RECONNECTING:ps.CONNECTING}),this._workerConnection.on(Et.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=Bve(new Uint8Array(r.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{$e.reportApiInvoke(this._connectInfo.sid||null,{name:Tn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:dn.TRACER}).onError(new ce(H.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Et.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this._workerConnection.on(Et.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Ea(this,Po.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(r,i);this._workerConnection.sendMessage(s,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:h,sid:m,uid:g}=i;const y=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),x=await FV(_,s,c),S=this._sequence+"-"+u+"-"+g+"-"+y+"-"+en(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:PI.intToLong(Number(y-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:x,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this._sequence,sid:m,timestamp:mG(y),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;const M=Vve(C);if(M.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(j){for(var $=1;$<arguments.length;$++){var K=arguments[$]!=null?arguments[$]:{};$%2?fG(Object(K),!0).forEach(function(J){L(j,J,K[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(K)):fG(Object(K)).forEach(function(J){Object.defineProperty(j,J,Object.getOwnPropertyDescriptor(K,J))})}return j}({},C);delete D.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return M}{const D=this.quality*this._qualityRatio;return this.quality=D,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ui.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ps.CLOSED,this.emit(Po.STATE_CHANGE,Xp.CLOSED)}}function gG(t){if(ln(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new ce(H.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new ce(H.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const qve={name:"ImageModeration",create:function(t){let{config:r}=t;return gG(r),new PI(r)}};var vG,yG,_G,bG,EG,xG,SG,wG,TG,CG,NG,RG,AG,IG,OG,PG,DG,kG,jG,LG,MG,UG,FG,VG,BG,GG,WG,$G,HG,zG,KG,YG,qG,XG,JG,QG,ZG,eW,tW,nW,rW,iW,Ve;function aW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function qs(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aW(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):aW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}Rr.setLogger(R);let Xve=(vG=at(),yG=at({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Gp))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),_G=at({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Bp.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),bG=at({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),EG=at({argsMap:(t,r,i)=>[r,i]}),xG=at({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return[s==null?void 0:s.uid,c]})}),SG=at({argsMap:(t,r,i,s)=>[typeof r=="object"?r.uid:r,i,s]}),wG=at({argsMap:(t,r)=>r.map(i=>{let{user:s,mediaType:c}=i;return{uid:s==null?void 0:s.uid,mediaType:c}})}),TG=at(),CG=at(),NG=at(),RG=at(),AG=at(),IG=at(),OG=at(),PG=at(),DG=at(),kG=at(),jG=at(),LG=at(),MG=at(),UG=at(),FG=at(),VG=at(),BG=at({argsMap:(t,r)=>[r]}),GG=at(),WG=at(),$G=at(),HG=at(),zG=at(),KG=at(),YG=at(),qG=at(),XG=at({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),JG=at(),QG=at(),ZG=at(),eW=at(),tW=at(),nW=at(),rW=at({reportResult:!0}),iW=at(),Ve=class extends An{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let i;if(super(),L(this,"store",void 0),L(this,"_uid",void 0),L(this,"_channelName",void 0),L(this,"_uintUid",void 0),L(this,"_users",[]),L(this,"_config",void 0),L(this,"_clientId",void 0),L(this,"_appId",void 0),L(this,"_sessionId",null),L(this,"_key",void 0),L(this,"_rtmConfig",{}),L(this,"_joinInfo",void 0),L(this,"_gateway",void 0),L(this,"_statsCollector",void 0),L(this,"_configDistribute",void 0),L(this,"_leaveMutex",void 0),L(this,"_publishMutex",void 0),L(this,"_renewTokenMutex",void 0),L(this,"_subscribeMutex",void 0),L(this,"_encryptionMode","none"),L(this,"_encryptionSecret",null),L(this,"_encryptionSalt",null),L(this,"_encryptDataStream",!1),L(this,"_encryptDataStreamKey",null),L(this,"_encryptDataStreamIv",null),L(this,"_proxyServer",void 0),L(this,"_turnServer",{servers:[],mode:"auto"}),L(this,"_cloudProxyServerMode","disabled"),L(this,"_isDualStreamEnabled",!1),L(this,"_defaultStreamFallbackType",void 0),L(this,"_lowStreamParameter",void 0),L(this,"_streamFallbackTypeCacheMap",new Map),L(this,"_remoteStreamTypeCacheMap",new Map),L(this,"_axiosCancelSource",Ui.CancelToken.source()),L(this,"_audioVolumeIndicationInterval",void 0),L(this,"_networkQualityInterval",void 0),L(this,"_userOfflineTimeout",void 0),L(this,"_streamRemovedTimeout",void 0),L(this,"_rteDetailInterval",void 0),L(this,"_liveTranscodeStreamingClient",void 0),L(this,"_liveRawStreamingClient",void 0),L(this,"_channelMediaRelayClient",void 0),L(this,"_networkQualitySensitivity","normal"),L(this,"_p2pChannel",void 0),L(this,"_useLocalAccessPoint",!1),L(this,"_setLocalAPVersion",void 0),L(this,"_joinAndNotLeaveYet",!1),L(this,"_numberOfJoinCount",0),L(this,"_joinResponse",null),L(this,"_remoteDefaultVideoStreamType",void 0),L(this,"_inspect",void 0),L(this,"_moderation",void 0),L(this,"_license",void 0),L(this,"_pendingPublishedUsers",[]),L(this,"ntpAlignErrorCount",0),L(this,"remoteInboundOffset",0),L(this,"_peerConnectionState",void 0),L(this,"_pendingRtpCapabilityChange",void 0),L(this,"_fallbackServerInfo",void 0),L(this,"_dualStreamMode",void 0),L(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),L(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),L(this,"_handleUserOnline",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(c.uid,this.channelName))return void R.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Rt.USER_JOINED,u));else{const h=new ld(c.uid,c.uint_id||c.uid);this._users.push(h),R.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Rt.USER_JOINED,h)}}),L(this,"_handleUserOffline",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:vb(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),R.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Rt.USER_LEAVED,u,c.reason))}),L(this,"_handleAddAudioOrVideoStream",(c,u,h,m,g,y,_,x)=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(u,this.channelName))return;const S=this._users.find(D=>D.uid===u);if(!S)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(S.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const C=c==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=y||u),c==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,c==="audio"?(S._audio_added_=!0,h!==void 0&&(S._audioSSRC=h),m!==void 0&&(S._cname=m),_&&(S._audioOrtc=_)):(S._video_added_=!0,h!==void 0&&(S._videoSSRC=h),m!==void 0&&(S._cname=m),x!==void 0&&(S._rtxSsrcId=x),_&&(S._videoOrtc=_)),(c==="audio"?S.hasAudio:S.hasVideo)&&!C&&(R.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(c)),this.safeEmit(Rt.USER_PUBLISHED,S,c)),c==="video"?$e.onGatewayStream(this._sessionId,sr.ON_ADD_VIDEO_STREAM,Cn.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:S._videoSSRC}):$e.onGatewayStream(this._sessionId,sr.ON_ADD_AUDIO_STREAM,Cn.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,c,h).then(D=>{if(D&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ku))return this._p2pChannel.unsubscribe(S,c,!0).then(()=>this._subscribe(S,c,!0).catch(j=>{R.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,c,!0).catch(D=>{R.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}));const M=this._getEncodingName(g);c==="video"&&(M==="unknown"?this.safeEmit(Rt.AV1_DECODABLE_RESULT,!1):Nr()||ai()||(M==null?void 0:M.toLocaleLowerCase())!==Du.av1||_ve().then(D=>{G("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Rt.AV1_DECODABLE_RESULT,D),D||this._gateway.downgradeCodec(M)}))}),L(this,"_handleRemoveStream",c=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Rt.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Ku&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),$e.onGatewayStream(this._sessionId,sr.ON_REMOVE_STREAM,Cn.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),L(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(u,this.channelName))return;const m=this._users.find(_=>_.uid===u);if(!m)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const _=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===_)return;{const x=m._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,u,x)}}else{m._trust_video_enabled_state_=!0;const _=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===_)return;{const x=m._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,u,x)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return g!==y?!g&&y?(R.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(Rt.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(Rt.USER_UNPUBLISHED,m,c)):void 0}),L(this,"_handleMuteStream",(c,u,h)=>{if(G("BLOCK_LOCAL_CLIENT")&&Bu(c,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(_=>_.uid===c);if(!m)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const _=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===_)return;{const x=m._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,c,x)}}else{m._trust_video_mute_state_=!0;const _=m._video_muted_;if(m._video_muted_=h,m._video_muted_===_)return;{const x=m._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(x)),this.safeEmit(Rt.USER_INFO_UPDATED,c,x)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(g!==y){if(!g&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(R.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(Rt.USER_PUBLISHED,m,u)):void R.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),R.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(Rt.USER_UNPUBLISHED,m,u)}}),L(this,"_handleP2PLost",async c=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),L(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Rt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),L(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),L(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Rt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Rt.NETWORK_QUALITY,c)}),L(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const g=this._users.find(_=>_.uid===u);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!y&&(R.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Rt.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(_=>{R.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=t,this._clientId=r||en(5,"client-"),this.store=new class{constructor(c,u,h,m,g){vt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Pu.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(c){this.state=function(u,h){switch(h.type){case pt.SET_SESSION_ID:return Oe(Oe({},u),{},{sessionId:h.sessionId});case pt.SET_P2P_ID:return Oe(Oe({},u),{},{p2pId:h.p2pId});case pt.SET_UID:return Oe(Oe({},u),{},{uid:h.uid});case pt.SET_INT_UID:return Oe(Oe({},u),{},{intUid:h.intUid});case pt.SET_PUB_ID:return Oe(Oe({},u),{},{pubId:h.pubId});case pt.KEY_METRIC_CLIENT_CREATED:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{clientCreated:h.metric})});case pt.KEY_METRIC_JOIN_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinStart:h.metric})});case pt.KEY_METRIC_PRELOAD_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{preloadStart:h.metric})});case pt.KEY_METRIC_PRELOAD_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{preloadEnd:h.metric})});case pt.KEY_METRIC_JOIN_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinEnd:h.metric})});case pt.KEY_METRIC_REQUEST_AP_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{requestAPStart:h.metric})});case pt.KEY_METRIC_REQUEST_AP_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{requestAPEnd:h.metric})});case pt.KEY_METRIC_REQUEST_SUA_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{requestSUAEnd:h.metric})});case pt.KEY_METRIC_BEFORE_CONNECT:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{beforeConnect:h.metric})});case pt.KEY_METRIC_PEER_RECEIVER:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{peerReceiver:h.metric})});case pt.KEY_METRIC_SIGNAL_CONNECTED:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{signalConnected:h.metric})});case pt.KEY_METRIC_JOIN_REQ:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinReq:h.metric})});case pt.KEY_METRIC_JOIN_REP:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinRep:h.metric})});case pt.KEY_METRIC_JOIN_GATEWAY_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case pt.KEY_METRIC_JOIN_GATEWAY_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case pt.KEY_METRIC_PEER_CONNECTION_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case pt.KEY_METRIC_PEER_CONNECTION_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case pt.KEY_METRIC_DESCRIPTION_START:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{descriptionStart:h.metric})});case pt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case pt.KEY_METRIC_ICE_CONNECTION_END:return Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case pt.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,g=m.findIndex(y=>y.trackId===h.metric.trackId);return g!==-1?(m[g]=Oe(Oe({},m[g]),h.metric),Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{publish:[...m]})})):Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case pt.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,g=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return g!==-1?(m[g]=Oe(Oe({},m[g]),h.metric),Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{subscribe:[...m]})})):Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case pt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=u.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(y=>y.userId===h.metric.userId);return g!==-1?(m[g]=Oe(Oe({},m[g]),h.metric),Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Oe(Oe({},u),{},{keyMetrics:Oe(Oe({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case pt.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case pt.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case pt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=Oe(Oe({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case pt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case pt.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case pt.SET_USE_P2P:return Oe(Oe({},u),{},{useP2P:h.val});case pt.SET_TRANSPORT_TYPE:return Oe(Oe({},u),{},{p2pTransport:h.val});case pt.SET_RTE_URL:return Oe(Oe({},u),{},{rteUrl:h.rteUrl});case pt.SET_RTE_SID:return Oe(Oe({},u),{},{rteSid:h.rteSid});default:return u}}(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:pt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:pt.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:pt.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:pt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:pt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:pt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:pt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:pt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:pt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:pt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:pt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:pt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:pt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:pt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:pt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:pt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:pt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:pt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:pt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:pt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:pt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:pt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:pt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:pt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:pt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:pt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:pt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:pt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,u){this.dispatch({type:pt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Oe({userId:c},u)})}descriptionStart(){this.dispatch({type:pt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:pt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:pt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:pt.KEY_METRIC_PUBLISH,metric:Oe(Oe({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,g,y,_){this.dispatch({type:pt.KEY_METRIC_SUBSCRIBE,metric:Oe(Oe(Oe(Oe(Oe({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),y&&{streamAdded:y}),_&&{firstDecoded:_})})}massSubscribe(c,u,h,m){c.forEach(g=>{this.dispatch({type:pt.KEY_METRIC_SUBSCRIBE,metric:Oe(Oe(Oe({userId:g.userId,type:g.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:pt.RECORD_JOIN_CHANNEL_SERVICE,record:Oe(Oe({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:pt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:pt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:pt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:pt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId,G("SIGNAL_CHANNEL")===1),this._leaveMutex=new Rr("client-leave",this._clientId),this._publishMutex=new Rr("client-publish",this._clientId),this._renewTokenMutex=new Rr("client-renewtoken",this._clientId),this._subscribeMutex=new Rr("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(cs," build: ").concat(oA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{zR(t.clientRoleOptions),i=Object.assign({},t.clientRoleOptions)}catch(c){R.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new ov(this.store),this._statsCollector.onStatsException=(c,u,h)=>{R.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),c===uI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof kb&&G("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(Rt.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const g=this._users.find(y=>y.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),$e.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(G("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const u=this.localTracks.find(h=>h instanceof un);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?G("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new pve(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Yn,httpRetryConfig:t.httpRetryConfig||Yn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:i}),this._configDistribute=new wve(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Do("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Ku(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,i,s,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sn("JOIN_GATEWAY_USE_443PORT_ONLY",u),sn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof zA&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(g,y,_){pb.get(g)||pb.set(g,[]),mb.get(g)||mb.set(g,y),mc.get(g)||mc.set(g,0);const x=pb.get(g),S=mb.get(g);if(!x||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(mc.get(g)===S){const $=Fg();x.push($),await $.promise}mc.set(g,mc.get(g)+1);for(var C=arguments.length,M=new Array(C>3?C-3:0),D=3;D<C;D++)M[D-3]=arguments[D];const j=await _(...M);return mc.set(g,mc.get(g)-1),mc.get(g)===S-1&&x.length>0&&(x[0].resolve(),x.shift()),mc.get(g)===0&&(pb.set(g,[]),mb.set(g,0),mc.set(g,0)),j}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,i,s,c)}async join(t,r,i,s,c){const u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const h=(bb||bb||(bb=(window.location.protocol.split(":")[0]||"").toUpperCase(),bb))==="HTTPS",m=XF()?window.isSecureContext:"Browser Not Support";(!XF()&&!h||!window.isSecureContext)&&R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;$e.setAppId(t);try{if(!i&&i!==null)throw new ce(H.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&Mr(i,"token",1,2047),Mr(t,"appid",1,2047),Hb(r),s&&zb(s),c)if(typeof c=="string")Mr(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ce(H.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:j,enableInstantMuteRestore:$,networkQualityProbe:K}=c;j&&(Fs(j,"autoSubscribe"),R.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),$&&(Fs($,"enableInstantMuteRestore"),R.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat($)),this.store.enableInstantMuteRestore=$),K&&(Fs(K,"networkQualityProbe"),R.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(K)),this.store.networkQualityProbe=K)}}}catch(j){throw $e.reportApiInvoke(Ou(),{name:Tn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:m},tag:dn.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw $e.reportApiInvoke(Ou(),{name:Tn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:m},tag:dn.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();const y=await RI({appId:t,cname:r,uid:s,stringUid:typeof s=="string"?s:void 0,token:i||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(y==null?void 0:y.sid)||Ou();R.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const x=$e.reportApiInvoke(this._sessionId,{id:this._clientId,name:Tn.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:m},tag:dn.TRACER}),S=qs(qs(qs({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(S.stringUid=s,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async j=>{const $=function(ae){const Q=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),oe=new Uint8Array(new ArrayBuffer(Q.length));for(let ge=0;ge<Q.length;ge+=1)oe[ge]=Q.charCodeAt(ge);return oe}(),K=await window.crypto.subtle.importKey("spki",$,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=$R(j),ne=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},K,J);return function(ae){let Q="";for(let oe=0;oe<ae.length;oe+=1)Q+=String.fromCharCode(ae[oe]);return window.btoa(Q)}(new Uint8Array(ne))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,$=G("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(S.appId+this._encryptionSecret+this._encryptionSecret):j.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(K,J,ne){const ae=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Q=K==="aes-128-gcm2"?128:256,oe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:sV,hash:"SHA-256",salt:ne},ae,Q+Hfe);return new Uint8Array(oe).subarray(Q/8)}(this._encryptionMode,$,Iu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(K,J,ne){const ae=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Q=K==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:sV,hash:"SHA-256",salt:ne},ae,{name:"AES-GCM",length:Q},!0,["encrypt","decrypt"])}(this._encryptionMode,$,Iu(this._encryptionSalt))}else m?R.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):R.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,R.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:S.stringUid});const C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&$e.joinChannelTimeout(this._sessionId,5)},5e3);try{var M;let j;const $=S.cloudProxyServer;if(Re(M=["proxy3","proxy4","proxy5"]).call(M,$)){const Q=G("PROXY_SERVER_TYPE3");Array.isArray(Q)?S.proxyServer=Q[0]:S.proxyServer=Q}if($e.setProxyServer(S.proxyServer),R.setProxyServer(S.proxyServer),this.store.requestAPStart(),y){if(R.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(y.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Q=(await Y6(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||Hr.tcpport,udpport:oe.udpport||Hr.udpport,username:oe.username||Hr.username,password:oe.password||Hr.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:Q}}nG(y,S.stringUid)}else{if(S.stringUid&&!S.uid){let Q;[Q,j]=await ke.all([x8(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store).finally(()=>{this.store.requestSUAEnd()}),E8(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(Q)),S.uid=Q,j.gatewayInfo.uid=Q,j.gatewayInfo.res.uid=Q}else j=await E8(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Oo.UPDATE_BITRATE_LIMIT,Q=>{this._p2pChannel.updateBitrateLimit(Q)}),this._configDistribute.on(Oo.UPDATE_CLIENT_ROLE_OPTIONS,Q=>{this._setClientRoleOptions(Q)}),this._configDistribute.on(Oo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,Q=>{var oe;Re(oe=[0,1,4,5,6,7,8,9]).call(oe,Q)&&(this.remoteUsers.forEach(ge=>{this._remoteStreamTypeCacheMap.get(ge.uid)!==Q&&this.setRemoteVideoStreamType(ge.uid,Q)}),this.setRemoteDefaultVideoStreamType(Q))}),this._configDistribute.on(Oo.FALLBACK_TO_HLS,Q=>{Q&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.CONFIG)}),this._configDistribute.on(Oo.UPDATE_VOS_CONFIGURE,Q=>{this._gateway.setConfigure(Q).catch(oe=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),oe)})})},0),this._key=i||t;const K=j.gatewayInfo,J=S.uid?S.uid:K.uid;this._joinInfo=qs(qs({},S),{},{cid:K.cid,uid:J,vid:K.vid,apResponse:K.res,apGatewayAddress:K.apGatewayAddress,uni_lbs_ip:K.uni_lbs_ip,gatewayAddrs:K.gatewayAddrs}),this.store.intUid=J,this.store.cid=K.cid;const ne=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));x.onSuccess(ne),this._appId=t,this._channelName=S.cname,this._uid=ne,this.store.uid=ne,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ae=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ae)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),D=this,Re(Vu).call(Vu,D)||Vu.push(D),this._cloudProxyServerMode==="disabled"&&It().supportWebCrypto&&G("ENABLE_PRELOAD")&&II(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&$e.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&$e.reportRteDetail(this._sessionId)},G("RTE_DETAIL_REPORT_INTERVAL")||6e4),ne}catch(j){const $=Array.isArray(j)?j[0]:j;throw $&&$.code===H.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),$):R.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),$),$.code!==H.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),x.onError($),$}var D}async _joinGateway(){if(!this._joinInfo||!this._key)throw new ce(H.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(t){if(t.code===H.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Dt.FALLBACK),R.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ce(H.INVALID_OPERATION);return $e.reportApiInvoke(this._sessionId,{name:Tn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:dn.TRACER}).onSuccess(),await this._joinGateway()}throw t}}async leave(){R.info("[".concat(this._clientId,"] Leaving channel"));const t=()=>{!Nr()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Nr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=Vu.indexOf(i);s!==-1&&Vu.splice(s,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||t();const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED",Dt.LEAVE),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r(),this.store.useDcSignal&&t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Gp))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new ce(H.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new ce(H.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Gp))throw new ce(H.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ce(H.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof un&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw R.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(t){if(t==null)throw new ce(H.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));ln(t.id,"id",0,65535,!0),Fs(t.ordered,"ordered"),Mr(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new ce(H.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ce(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return h8(c,!1)}(t),s=await this._p2pChannel.publishDataChannel([i]);if(s.length>0){if(typeof i._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ce(H.CREATE_DATACHANNEL_ERROR);try{await ke.all(s.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==H.DISCONNECT_P2P)throw c}}return R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Gp))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.sendExtensionMessage(Hn.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(s){throw R.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(t,r,i){if(!(t instanceof ld)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new ce(H.INVALID_REMOTE_USER,"user is not in the channel");t=s}return r==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,r)}async presubscribe(t,r){if(Kn(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ce(H.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===Ge.AUDIO,s=r===Ge.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:g,uint_id:y}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new ce(H.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(S=>S.uid===t);_||(_=new ld(t,y||t),_._is_pre_created=!0,this._users.push(_)),g&&(_._cname=g),_._uintid||(_._uintid=y||t),i&&(_._audioSSRC=u,_._audio_pre_subscribed=!0,h&&(_._audioOrtc=h)),s&&(_._videoSSRC=u,_._video_pre_subscribed=!0,h&&(_._videoOrtc=h),m!=null&&(_._rtxSsrcId=m)),R.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(_,r,u,m,h);const x=i?_._audioTrack:_._videoTrack;if(!x)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),s&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),x}catch(u){throw R.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var i;if(ln(r,"channelId",0,65535,!0),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ce(H.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ce(H.INVALID_REMOTE_USER,"user is not published");const c=(i=t._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&Re(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ce(H.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,i){if(Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new ce(H.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!i&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,i){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===t)){const y=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),y}if(!t.hasAudio&&!t.hasVideo){const y=new ce(H.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),y}if(!(i||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const y=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),y}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Ge.AUDIO:Ge.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const _=r==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==c&&(c=_,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Ge.AUDIO:Ge.VIDEO,ssrcId:c}),Zr.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(x){if((x==null?void 0:x.code)!==H.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),x;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,r),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const y=r==="audio"?t._audioTrack:t._videoTrack;if(!y)throw new ce(H.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),y}catch(y){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),y),y}finally{g()}}async massSubscribe(t){if(nl(t,"subscribeList"),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:g,mediaType:y}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(y)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:g,mediaType:y}=m;return{user:g,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const y=t[g],{user:_,mediaType:x}=y;if(Kn(x,"mediaType",["audio","video"]),!_){const D=new ce(H.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),D}if(!this._users.find(D=>D===_)){const D=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),c[g].error=D,t.splice(g,1);continue}if(x==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||x==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const D=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(x,", remote user is not published")),c[g].error=D,t.splice(g,1);continue}const C=br.Video|br.LwoVideo,M=i.get(_);if(M){if(x==="video"?M&C:M&br.Audio){t.splice(g,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(x," twice"));continue}i.set(_,M|(x==="video"?C:br.Audio))}else i.set(_,x==="video"?C:br.Audio)}for(let g=t.length-1;g>=0;g--){const y=t[g],{user:_,mediaType:x}=y,S=br.Video|br.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,x)){await this._p2pChannel.unmuteRemoteNoLock(_,x);const C=i.get(_);i.set(_,x==="video"?C^S:C^br.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let m=ss(h=Array.from(i.entries())).call(h,(g,y)=>{let[_,x]=y;if(x===0)return g;const S={stream_id:_.uid,stream_type:x};return x&br.Audio&&(S.audio_ssrc=_._audioSSRC),x&br.Video&&(S.video_ssrc=_._videoSSRC),g.push(S),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(y=>{let{user:_,mediaType:x}=y;return{user:_,mediaType:x,ssrcId:x===Ge.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:x===Ge.VIDEO?_._rtxSsrcId:void 0}}));const g=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(_=>{let{stream_id:x,video_error_code:S,audio_error_code:C,error_code:M}=_;(S||C||M)&&g.set(x,{video_error_code:S,audio_error_code:C,error_code:M})})}if(Array.from(g.entries()).length>0){const y=[];Array.from(g.entries()).forEach(_=>{let[x,S]=_;const C=this.remoteUsers.find(M=>M.uid===x);if(C){let M;S.error_code||S.video_error_code&&S.audio_error_code?M=void 0:S.video_error_code?M=Ge.VIDEO:S.audio_error_code&&(M=Ge.AUDIO),y.push({user:C,mediaType:M})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const _=g.get(y.user.uid);if(_){const x=_.error_code||y.mediaType==="audio"&&_.audio_error_code||y.mediaType==="video"&&_.video_error_code;if(x){const S=Wu(x);R.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(S.desc)),y.error=new ce(H.SUBSCRIBE_FAILED,"code ".concat(x,": ").concat(S.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var _;$e.subscribe(this.store.sessionId,{succ:!!y.error,ec:((_=y.error)===null||_===void 0?void 0:_.code)||null,video:y.mediaType===Ge.VIDEO,audio:y.mediaType===Ge.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===Ge.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(y=>{let{user:_,mediaType:x}=y;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(x)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{u(),s()}}async unsubscribe(t,r,i){if(!(t instanceof ld)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new ce(H.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(r&&Kn(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&vb(this._users,t),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===H.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&ln(r,"id",0,65535,!0),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new ce(H.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let s;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(s=[c])}else s=t._dataChannels;if(s===void 0){const c=new ce(H.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,s);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===H.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(nl(t,"unsubscribeList"),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:c}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:c}=t[i];if(!s){const m=new ce(H.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Kn(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===s)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const h=br.Video|br.LwoVideo;if(r.has(s)){const m=r.get(s);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&br.Audio;break;default:g=m&(br.Audio|h)}if(g){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),t.splice(i,1);continue}c?c==="audio"?r.set(s,m|br.Audio):c==="video"&&r.set(s,m|h):r.set(s,m|br.Audio|h)}else c?c==="audio"?r.set(s,br.Audio):c==="video"&&r.set(s,h):r.set(s,br.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:c,mediaType:u}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===H.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new he(H.INVALID_PARAMS);kn(i.width)||GR(i.width,"streamParameter.width"),kn(i.height)||GR(i.height,"streamParameter.height"),kn(i.framerate)||GR(i.framerate,"streamParameter.framerate"),kn(i.bitrate)||ln(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ae.LocalVideoLowTrack)}async setDualStreamMode(t,r){Kn(t,"mode",[0,1,-1]);try{switch(r&&await this.setLowStreamParameter(r),this._dualStreamMode=t,this._joinInfo?this._gateway.setDualStreamMode(t).catch(i=>{R.warning("[".concat(this._clientId,"] set dual stream mode failed"),i.toString())}):R.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(t)),t){case Op.AUTO_SIMULCAST_STREAM:R.info("[".concat(this._clientId,"] set dual stream mode to ").concat(t));break;case Op.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case Op.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(i){throw R.error("[".concat(this._clientId,"] set dual stream mode error"),i.toString()),i}}async enableDualStream(){if(!It().supportDualStream)throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ce(H.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ce(H.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,this._dualStreamMode=Op.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),$e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void R.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(Ae.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw $e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,this._dualStreamMode=Op.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(t=>{R.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),t.toString())}),$e.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(s){Kn(s,"role",["audience","host"])}(t),r&&zR(r),this.mode==="rtc"||this.mode==="p2p")throw R.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ce(H.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new ce(H.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new ce(H.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;if(this._joinInfo&&(this._joinInfo.role=t),t!==i&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",$r.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level)),i==="audience"&&t!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Ku){const{video_codec:s}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(s.map(c=>c.toLowerCase()).filter(c=>{var u;return Re(u=Object.keys(Du)).call(u,c)}))}}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&zR(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{R.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Mr(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,$e.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy")}if(Cu(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>UF(i)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"you should set license before join channel");if(Mr(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new ce(H.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ce(H.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new ce(H.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new ce(H.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ce(H.INVALID_OPERATION,"Stop proxy server after leave channel");$e.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new ce(H.INVALID_PARAMS,"accessPoints is required.");nl(t.accessPoints.serverList,"accessPoints.serverList"),Mr(t.accessPoints.domain,"accessPoints.domain");const r=(S,C)=>{ln(S,C,0,65535,!0)};let i=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(sn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(S=>s.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(c):S),h=u.map(S=>"".concat(S,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sn("WEBCS_DOMAIN",h),sn("WEBCS_DOMAIN_BACKUP_LIST",h),sn("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(nl(t.report.hostname,"report.hostname"),sn("EVENT_REPORT_DOMAIN",t.report.hostname[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(sn("EVENT_REPORT_DOMAIN",u[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),sn("STATS_COLLECTOR_PORT",m),t.report?sn("ENABLE_EVENT_REPORT",!0):sn("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(nl(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=u[0];let y=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),y=t.log.port),sn("LOG_UPLOAD_SERVER","".concat(g,":").concat(y));let _=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(nl(t.cds.hostname,"cds.hostname"),_=t.cds.hostname):_=u;let x=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),x=t.cds.port),sn("CDS_AP",_.map(S=>"".concat(S,":").concat(x))),t.cds?sn("ENABLE_CONFIG_DISTRIBUTE",!0):sn("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(nl(t,"serverList"),Mr(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ce(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(r):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sn("WEBCS_DOMAIN",t),sn("WEBCS_DOMAIN_BACKUP_LIST",t),sn("GATEWAY_DOMAINS",[r]),sn("EVENT_REPORT_DOMAIN",t[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),sn("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Kn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Kn(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Kn(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,i,s){(function(u){Kn(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Mr(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Re(c).call(c,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new ce(H.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new ce(H.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Fs(s,"encryptDataStream"),!Re(c).call(c,t))throw new ce(H.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=nd(i))}async renewToken(t){if(Mr(t,"token",1,2047),!this._key||!this._joinInfo)throw new ce(H.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await Sve(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=r,this._joinInfo.token=r,R.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Rt.VOLUME_INDICATOR,t)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new ce(H.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ce(H.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new ce(H.LIVE_STREAMING_TASK_CONFLICT);const i=r?il.TRANSCODE:il.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(il.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!r.length)throw new ce(H.INVALID_PARAMS,"can not find live streaming url to stop");await ke.all(r.map(i=>i&&i.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){R8(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){R8(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Ku&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(s=!0,t.payload=await async function(c,u,h){var m;const g=ss(m=Array.from(h)).call(m,(D,j)=>D+j,0),y={serverTs:0,seq:zfe++,length:h.length,checkSum:g},_=new Uint8Array(KF(g,2)),x=new ArrayBuffer(Mp),S=new DataView(x);S.setUint32(0,y.serverTs),S.setUint16(4,y.seq),S.setUint16(6,y.length),S.setUint16(8,y.checkSum);const C=16-h.length%16;h=GF(h,new Uint8Array(C));const M=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:aV,additionalData:_},u,h);return GF(new Uint8Array(x),new Uint8Array(M))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new ce(H.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Xe.DATA_STREAM,{payload:nd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Pve},!i)}sendMetadata(t){if(!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new ce(H.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Xe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:nd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(tge),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not send custom report, not joined");await $e.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(G("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(i=>i.uid+"");Object.keys(t).forEach(i=>{Re(r).call(r,i)||delete t[i]})}return t}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(t,r){Kn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Kn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:i}=t;if(Fs(r,"apRTM"),ln(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,R.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Yp.indexOf(t);r!==-1&&Yp.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ui.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&tG(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&$e.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&$e.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Rr("client-publish",this._clientId),this._subscribeMutex=new Rr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var i;const s=t||Ou();t?R.debug("[".concat(this._clientId,"] new Session ").concat(s)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=t?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,$e.addSid(s);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};$e.sessionInit(this._sessionId,qs({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ce(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await i.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Hn.PUBLISH,s,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==H.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof un&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{R.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===H.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ce(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ce(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==H.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===H.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new ce(H.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Do("LiveStreaming").create(s));var s;return i.onLiveStreamError=(c,u)=>{$e.reportApiInvoke(this._sessionId,{name:Tn.ON_LIVE_STREAM_ERROR,options:[c,u],tag:dn.TRACER}).onSuccess(),this.safeEmit(Rt.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{$e.reportApiInvoke(this._sessionId,{name:Tn.ON_LIVE_STREAM_WARNING,options:[c,u],tag:dn.TRACER}).onSuccess(),this.safeEmit(Rt.LIVE_STREAMING_WARNING,c,u)},i.on(WA.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new ce(H.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,y,_){const x=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(S=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await gve(x,m,g,y,_)})(c,this._joinInfo,this._axiosCancelSource.token,Yn).then(u).catch(h)}),i};return t===il.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ce(H.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),s=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Do("ChannelMediaRelay").create(t));s.on("state",c=>{c===ta.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Rt.CHANNEL_MEDIA_RELAY_STATE,c)}),s.on("event",c=>{this.safeEmit(Rt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:i,deleted:s}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(g=>g.uid!==h._uintid||g.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:y,metadata:_}=u,x=this._users.find(S=>S._uintid===h);if(!x)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),Re(c).call(c,x)||c.push(x),x._uintid||(x._uintid=h),x._dataChannels.findIndex(S=>S.id===u.stream_id)===-1){const S={id:m,ordered:!!g,maxRetransmits:y,metadata:_},C=function(M){return h8(M,!0)}(S);x._dataChannels.push(C),R.info("[".concat(this._clientId,"] remote user ").concat(x.uid," published datachannel")),r||this.safeEmit(Rt.USER_PUBLISHED,x,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(x,u.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(x.uid," after reconnect.")),this._subscribeDataChannel(x,u.stream_id).catch(S=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),r&&(this.safeEmit(Rt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m}=u,g=this._users.find(_=>_._uintid===h);if(!g)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=g._dataChannels.find(_=>_.id===u.stream_id);y&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[y]).then(_=>{if(g._dataChannels=g._dataChannels.filter(x=>x!==y),_)return this._gateway.unsubscribeDataChannel(_,g.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(Rt.USER_UNPUBLISHED,g,"datachannel",y._config))})}_getEncodingName(t){var r,i;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(!s)return;for(const m of s){var c;if(m.payloadType===t)return m==null||(c=m.rtpMap)===null||c===void 0?void 0:c.encodingName}const u=(i=this._joinResponse.ortc.rtpCapabilities.recv)===null||i===void 0?void 0:i.videoCodecs;if(u)for(const m of u){var h;if(m.payloadType===t)return m==null||(h=m.rtpMap)===null||h===void 0?void 0:h.encodingName}return t===0?"unknown":void 0}_handleRemoveDataChannels(t){const r=this._users.find(i=>i.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(s=>{this.safeEmit(Rt.USER_UNPUBLISHED,r,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,r.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($n.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();Object.keys(r).forEach(s=>{const{value:c,type:u,expires:h}=r[s];h&&h<=i||u||LA()||!Object.prototype.hasOwnProperty.call(wb,s)||(Fa[s]=c,tn[s]=c,R.debug("Update gateway parameters from config distribute",s,c))})}catch(r){R.error("Error update config from local cache",r.message)}})()}),this._gateway.on($n.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($n.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s;if(i===Dt.FALLBACK)return;const c=()=>{this.safeEmit(Rt.CONNECTION_STATE_CHANGE,t,r,i)};if($e.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:Tn.CONNECTION_STATE_CHANGE,options:[t,r,i],tag:dn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:i})),R.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),G("VOS_CONFIGURE")&&Array.isArray(G("VOS_CONFIGURE"))&&G("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(G("VOS_CONFIGURE")).catch(h=>{R.debug("[".concat(this._clientId,"] auto set vos config failed"),h)}),R.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(h=>{R.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),h)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Ge.AUDIO,!1)),h._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Ge.VIDEO,!1)),h._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on($n.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new ce(H.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;if(this._fallbackServerInfo)i=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,$e.reportApiInvoke(this._sessionId,{name:Tn.VOS_FALLBACK_CN,options:{cur:i.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:dn.TRACER}).onSuccess(),R.info("[".concat(this._clientId,"] use fallback cn server info"));else{const c=await RI(qs(qs({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(i=c.ap,nG(c),this._joinInfo.preload=!0):(i=await oE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:u}=c;const[h,m]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:h,port:m}):s.push({host:h,port:m})}),t(s)}catch(i){r(i)}}),this._gateway.on($n.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Rt.NETWORK_QUALITY,t)}),this._gateway.on($n.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Rt.STREAM_TYPE_CHANGED,t,r),$e.reportApiInvoke(this._sessionId,{name:Tn.STREAM_TYPE_CHANGE,options:[t,r],tag:dn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on($n.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on($n.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,i)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(t)),r(s)}catch(s){i(s)}}),this._gateway.on($n.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let i;this._joinResponse=t,t.attributes?i=t.attributes.userAttributes.preSubSsrcs:R.debug("no attributes in joinResponse");const s=n8(t.ortc,r,i);this._p2pChannel.connect(s)}),this._gateway.on($n.PRE_CONNECT_PC,async(t,r,i)=>{const{candidates:s,fingerprint:c,turnServer:u}=t;if(this._joinInfo&&s.length>0&&!this._p2pChannel.isPlanB){const{cert:m,cid:g}=this._joinInfo.apResponse,y="".concat(g,"_").concat(m);if(y.length<4||y.length>256)return void R.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(y.length));await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var h;r(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(m),icePwd:"".concat(g,"_").concat(m)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=G("FINGERPRINT"))!==null&&h!==void 0?h:c}]},candidates:s,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===H.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),i(_)}}}),this._gateway.on($n.VOS_FALLBACK,t=>{t==="fallback_hls"&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.VOSERROR)}),this._gateway.on($n.RESET_SIGNAL,()=>{this._p2pChannel instanceof Ku&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on($n.DATACHANNEL_FAILBACK,()=>{$e.reportApiInvoke(this._sessionId,{name:Tn.DATACHANNEL_FAILBACK,options:{},tag:dn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(mt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(mt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(mt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(mt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(mt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(mt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(mt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(mt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(mt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ge.AUDIO,!0)),this._gateway.signal.on(mt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ge.AUDIO,!1)),this._gateway.signal.on(mt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ge.VIDEO,!0)),this._gateway.signal.on(mt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ge.VIDEO,!1)),this._gateway.signal.on(mt.RECEIVE_METADATA,t=>{const r=Iu(t.metadata);this.safeEmit(Rt.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(mt.ON_DATA_STREAM,async t=>{var r;if(!t)return;let i=Iu(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Mp)throw new ce(H.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Mp));i=await async function(u,h,m){const g=m.subarray(0,Mp),y=g.slice(8,Mp),_=(y[0]<<8)+y[1],x=(g[6]<<8)+g[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:aV,additionalData:new Uint8Array(KF(_,2))},h,m.subarray(Mp));return new Uint8Array(S).subarray(0,x)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let s=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));s=h==null?void 0:h.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),kve(qs(qs({},t),{},{payload:i}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(mt.ON_CRYPT_ERROR,()=>{td(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Rt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Dt.TOKEN_EXPIRE),this.safeEmit(Rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(mt.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Rt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(mt.ENABLE_MULTI_STREAM,t=>{this._dualStreamMode===Op.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(r=>{R.debug("[".concat(this._clientId,"] set dual stream mode error"),r.toString())})}),this._gateway.signal.on(mt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(mt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(mt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ze.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Xe.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,s;const u=c.some(g=>{let{stream_type:y}=g;return y===nn.Audio}),h=c.some(g=>{let{stream_type:y}=g;return y!==nn.Audio}),m=c.some(g=>{let{stream_type:y}=g;return y===nn.Screen||y===nn.ScreenLow});r.state==="offer"&&$e.publish(this._joinInfo.sid,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:H.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(g=>{let{stream_type:y}=g;return y===nn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(s=c.find(g=>{let{stream_type:y}=g;return y!==nn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Xe.SUBSCRIBE:r&&$e.subscribe(this._joinInfo.sid,{succ:!1,ec:H.TIMEOUT,audio:r.stream_type===Ge.AUDIO,video:r.stream_type===Ge.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(mt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(mt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;G("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Bu(s.string_id||s.stream_id,this.channelName)));const r=[],i=[];for(const s of t.users){let c=this._users.find(_=>_._uintid===s.stream_id);c?c._trust_in_room_=!0:(c=new ld(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Rt.USER_JOINED,c)));const u=br.Audio&s.stream_type,h=(br.Video|br.LwoVideo)&s.stream_type,m=(65280&s.stream_type)!=0,g=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),u&&!g&&this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Rt.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(Rt.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Rt.USER_PUBLISHED,c,"video")),(u&&!g||h&&!y||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Rt.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(s=>s.uid).join(", "))),this.safeEmit(Rt.PUBLISHED_USER_LIST,r)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(mt.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;if(this._p2pChannel instanceof Ku){if(this.role==="audience"&&G("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=t,void R.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(t)));this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var s;return Re(s=Object.keys(Du)).call(s,i)}))}}),this._gateway.signal.on(ze.VOS_FALLBACK_PROMISE,async(t,r,i)=>{if(t==="FALLBACKCN"&&G("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return i(new ce(H.UNEXPECTED_ERROR,"can not recover, no join info"));R.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=t;const u=await oE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Yn,this.store);if(G("QUALITY_FALLBACK_REHEARSAL"))return $e.reportApiInvoke(this._sessionId,{name:Tn.VOS_FALLBACK_CN,options:{cur:u.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:dn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void i();this._fallbackServerInfo=u,r()}catch(u){var s;const h=u==null||(s=u.data)===null||s===void 0?void 0:s.desc;G("QUALITY_FALLBACK_REHEARSAL")?($e.reportApiInvoke(this._sessionId,{name:Tn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+h||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:dn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(h)&&Re(h).call(h,"request downgrade fallback")&&this.safeEmit(Rt.FALLBACK_TO_HLS,KR.AP_ERROR),i(u)}}else i()})}_handleP2PEvents(){this._gateway.signal.on(mt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Hn.PUBLISH,(t,r,i)=>{const{uid:s}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(u,s,h[0].ssrcId,m);const y=this._users.find(_=>_.uid===s);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(s,u,!!g)})}),this._gateway.signal.on(Hn.CALL,async(t,r,i)=>{if(this.store.useP2P)try{var s;r(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},t))}catch(c){i(c)}}),this._gateway.signal.on(ze.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Hn.UNPUBLISH,async(t,r,i)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{s.forEach(async h=>{let{stream_type:m}=h;const g=m===nn.Audio?Ge.AUDIO:Ge.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(c,g,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(Hn.CONTROL,async(t,r)=>{const{action:i}=t;switch(i){case sd.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Ge.VIDEO,!0);break;case sd.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Ge.AUDIO,!0);break;case sd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Ge.VIDEO,!1);break;case sd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Ge.AUDIO,!1)}}),this._gateway.signal.on(Hn.RESTART_ICE,async(t,r,i)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=t;s!==Ai.SEND_ONLY||c?r(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),r())}catch(s){i(s)}}),this._gateway.signal.on(Hn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:i}=t;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(Je.RequestP2PRestartICE,async(t,r,i)=>{try{const{direction:s}=t;r(await this._gateway.sendExtensionMessage(Hn.RESTART_ICE,t,s===Ai.SEND_ONLY))}catch(s){i(s)}}),this._p2pChannel.on(Je.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Hn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Je.RequestP2PMuteLocal,async(t,r,i)=>{try{await this._gateway.sendExtensionMessage(Hn.CONTROL,t,!0),r()}catch(s){i(s)}}),this._p2pChannel.on(Je.RequestP2PUnmuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Je.RequestP2PMuteRemote,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Je.StateChange,(t,r)=>{r===Jt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Je.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Rt.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Je.RequestMuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Je.RequestUnmuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===H.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(Je.RequestRePublish,(t,r,i)=>{this.publish(t,!1).then(r).catch(i)}),this._p2pChannel.on(Je.RequestRePublishDataChannel,(t,r,i)=>{ke.all(t.map(async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==H.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(Je.RequestReSubscribe,async(t,r,i)=>{try{for(const{user:s,kind:c}of t)c===Ge.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){i(s)}}),this._p2pChannel.on(Je.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Je.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Je.MediaReconnectStart,t=>{this.safeEmit(Rt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Je.MediaReconnectEnd,t=>{this.safeEmit(Rt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Je.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Je.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),i=await r.next();if(i.done)return;const s=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(Je.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Je.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:s}),h=n8(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Je.RequestUnpublishForReconnectPC,async(t,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):i()}),this._p2pChannel.on(Je.P2PLost,()=>{this.safeEmit(Rt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Je.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Je.ConnectionTypeChange,t=>{this.safeEmit(Rt.IS_USING_CLOUD_PROXY,t),this._gateway.setUsingProxy(t)}),this._p2pChannel.on(Je.FirstVideoBufferReady,(t,r)=>{this.safeEmit(Rt.FIRST_VIDEO_BUFFER_READY,t,r)}),this._p2pChannel.on(Je.FirstVideoPreRender,(t,r)=>{this.safeEmit(Rt.FIRST_VIDEO_PRE_RENDER,t,r)}),this._p2pChannel.on(Je.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Je.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Je.AudioMetadata,t=>{this.safeEmit(Rt.AUDIO_METADATA,t)}),this._p2pChannel.on(Je.AudioPts,t=>{this.safeEmit(Rt.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:t},Do("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:s,cname:c,sid:u,token:h,uid:m,cid:g,vid:y}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:g,vid:y?Number(y):0},Yn)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(t){t.on(Ir.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Rt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===$s.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Rt.CONTENT_INSPECT_ERROR,new ce(H.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Ir.INSPECT_RESULT,(r,i)=>{var s;if((i==null?void 0:i.code)===H.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Rt.CONTENT_INSPECT_RESULT,r,i)}),t.on(Ir.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Fs(t,"enabled"),t){if(!r)throw new ce(H.INVALID_PARAMS,"config is required");if(gG(r),!this._joinInfo)throw new ce(H.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const s=(i={config:r},Do("ImageModeration").create(i));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:u,sid:h,token:m,uid:g,cid:y,vid:_}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:g,cid:y,vid:_?Number(_):0},Yn)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var i;if(!this._moderation)throw new ce(H.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(t){t.on(Po.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(Rt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===ps.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ce(H.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Po.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Kn(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new ce(H.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,R.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Fs(t,"enabled"),sn("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_setRteInfo(t,r){this.store.rteUrl=t,this.store.rteSid=r}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},je(Ve.prototype,"leave",[vG],Object.getOwnPropertyDescriptor(Ve.prototype,"leave"),Ve.prototype),je(Ve.prototype,"publish",[yG],Object.getOwnPropertyDescriptor(Ve.prototype,"publish"),Ve.prototype),je(Ve.prototype,"unpublish",[_G],Object.getOwnPropertyDescriptor(Ve.prototype,"unpublish"),Ve.prototype),je(Ve.prototype,"subscribe",[bG],Object.getOwnPropertyDescriptor(Ve.prototype,"subscribe"),Ve.prototype),je(Ve.prototype,"presubscribe",[EG],Object.getOwnPropertyDescriptor(Ve.prototype,"presubscribe"),Ve.prototype),je(Ve.prototype,"massSubscribe",[xG],Object.getOwnPropertyDescriptor(Ve.prototype,"massSubscribe"),Ve.prototype),je(Ve.prototype,"unsubscribe",[SG],Object.getOwnPropertyDescriptor(Ve.prototype,"unsubscribe"),Ve.prototype),je(Ve.prototype,"massUnsubscribe",[wG],Object.getOwnPropertyDescriptor(Ve.prototype,"massUnsubscribe"),Ve.prototype),je(Ve.prototype,"setLowStreamParameter",[TG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLowStreamParameter"),Ve.prototype),je(Ve.prototype,"setDualStreamMode",[CG],Object.getOwnPropertyDescriptor(Ve.prototype,"setDualStreamMode"),Ve.prototype),je(Ve.prototype,"enableDualStream",[NG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableDualStream"),Ve.prototype),je(Ve.prototype,"disableDualStream",[RG],Object.getOwnPropertyDescriptor(Ve.prototype,"disableDualStream"),Ve.prototype),je(Ve.prototype,"setClientRole",[AG],Object.getOwnPropertyDescriptor(Ve.prototype,"setClientRole"),Ve.prototype),je(Ve.prototype,"_setClientRoleOptions",[IG],Object.getOwnPropertyDescriptor(Ve.prototype,"_setClientRoleOptions"),Ve.prototype),je(Ve.prototype,"setProxyServer",[OG],Object.getOwnPropertyDescriptor(Ve.prototype,"setProxyServer"),Ve.prototype),je(Ve.prototype,"setTurnServer",[PG],Object.getOwnPropertyDescriptor(Ve.prototype,"setTurnServer"),Ve.prototype),je(Ve.prototype,"setLicense",[DG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLicense"),Ve.prototype),je(Ve.prototype,"startProxyServer",[kG],Object.getOwnPropertyDescriptor(Ve.prototype,"startProxyServer"),Ve.prototype),je(Ve.prototype,"stopProxyServer",[jG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopProxyServer"),Ve.prototype),je(Ve.prototype,"setLocalAccessPointsV2",[LG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLocalAccessPointsV2"),Ve.prototype),je(Ve.prototype,"setLocalAccessPoints",[MG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLocalAccessPoints"),Ve.prototype),je(Ve.prototype,"setRemoteDefaultVideoStreamType",[UG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRemoteDefaultVideoStreamType"),Ve.prototype),je(Ve.prototype,"setRemoteVideoStreamType",[FG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRemoteVideoStreamType"),Ve.prototype),je(Ve.prototype,"setStreamFallbackOption",[VG],Object.getOwnPropertyDescriptor(Ve.prototype,"setStreamFallbackOption"),Ve.prototype),je(Ve.prototype,"setEncryptionConfig",[BG],Object.getOwnPropertyDescriptor(Ve.prototype,"setEncryptionConfig"),Ve.prototype),je(Ve.prototype,"renewToken",[GG],Object.getOwnPropertyDescriptor(Ve.prototype,"renewToken"),Ve.prototype),je(Ve.prototype,"enableAudioVolumeIndicator",[WG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableAudioVolumeIndicator"),Ve.prototype),je(Ve.prototype,"startLiveStreaming",[$G],Object.getOwnPropertyDescriptor(Ve.prototype,"startLiveStreaming"),Ve.prototype),je(Ve.prototype,"setLiveTranscoding",[HG],Object.getOwnPropertyDescriptor(Ve.prototype,"setLiveTranscoding"),Ve.prototype),je(Ve.prototype,"stopLiveStreaming",[zG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopLiveStreaming"),Ve.prototype),je(Ve.prototype,"startChannelMediaRelay",[KG],Object.getOwnPropertyDescriptor(Ve.prototype,"startChannelMediaRelay"),Ve.prototype),je(Ve.prototype,"updateChannelMediaRelay",[YG],Object.getOwnPropertyDescriptor(Ve.prototype,"updateChannelMediaRelay"),Ve.prototype),je(Ve.prototype,"stopChannelMediaRelay",[qG],Object.getOwnPropertyDescriptor(Ve.prototype,"stopChannelMediaRelay"),Ve.prototype),je(Ve.prototype,"sendCustomReportMessage",[XG],Object.getOwnPropertyDescriptor(Ve.prototype,"sendCustomReportMessage"),Ve.prototype),je(Ve.prototype,"pickSVCLayer",[JG],Object.getOwnPropertyDescriptor(Ve.prototype,"pickSVCLayer"),Ve.prototype),je(Ve.prototype,"setRTMConfig",[QG],Object.getOwnPropertyDescriptor(Ve.prototype,"setRTMConfig"),Ve.prototype),je(Ve.prototype,"enableContentInspect",[ZG],Object.getOwnPropertyDescriptor(Ve.prototype,"enableContentInspect"),Ve.prototype),je(Ve.prototype,"disableContentInspect",[eW],Object.getOwnPropertyDescriptor(Ve.prototype,"disableContentInspect"),Ve.prototype),je(Ve.prototype,"setImageModeration",[tW],Object.getOwnPropertyDescriptor(Ve.prototype,"setImageModeration"),Ve.prototype),je(Ve.prototype,"setP2PTransport",[nW],Object.getOwnPropertyDescriptor(Ve.prototype,"setP2PTransport"),Ve.prototype),je(Ve.prototype,"getJoinChannelServiceRecords",[rW],Object.getOwnPropertyDescriptor(Ve.prototype,"getJoinChannelServiceRecords"),Ve.prototype),je(Ve.prototype,"setPublishAudioFilterEnabled",[iW],Object.getOwnPropertyDescriptor(Ve.prototype,"setPublishAudioFilterEnabled"),Ve.prototype),Ve);function sW(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=en(5,"client-"),s=$e.reportApiInvoke(null,{id:i,name:Tn.CREATE_CLIENT,options:[r],tag:dn.TRACER});try{(function(c){Kn(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Kn(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Kn(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Mr(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&UF(c.turnServer),c.httpRetryConfig!==void 0&&MF(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&MF(c.websocketRetryConfig)})(r)}catch(c){throw s.onError(c),c}return(wF(16,0,!0)||VR(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",R.debug("browser not support vp9, force use vp8")),sn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),s.onSuccess(),new Xve(qs(qs({forceWaitGatewayResponse:!0},r),{},{role:Re(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),i)}function Jve(){let t=!1;const r=Wt();return(r.name===Kt.CHROME&&Number(r.version)>=58&&(Co.engine.name!=="WebKit"||function(){const i=Wt();if(gb()){if(i.os===vr.MAC_OS)return!0;if(i.os===vr.IOS){const s=Co.os.version&&Co.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())||r.name===Kt.FIREFOX&&Number(r.version)>=56||r.name===Kt.OPERA&&Number(r.version)>=45||r.name===Kt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(ai()||Us())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||NF()||Wt().name===Kt.QQ)&&(t=!0),t}class hv{constructor(r,i){L(this,"id",0),L(this,"element",void 0),L(this,"peerPair",void 0),L(this,"context",void 0),L(this,"audioPlayerElement",void 0),L(this,"audioTrack",void 0),hv.count+=1,this.id=hv.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(s,c)=>{const u=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new ke(h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}})},i=async(s,c)=>await s.setRemoteDescription(c);try{const s=await r(this.peerPair[0],"offer");await i(this.peerPair[1],s);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(s){throw new ce(H.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new ce(H.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new ce(H.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=i.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var oW,bE;L(hv,"count",0);const Qve=window.AudioContext||window.webkitAudioContext,Zve=new(oW=at({report:$e}),je((bE=class{constructor(){L(this,"units",[]),L(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Qve);let r=this.units.find(i=>i&&i.getElement()===t);return r||(r=new hv(t,this.context),this.units.push(r)),r.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Wt().name!==Kt.SAFARI}}).prototype,"processExternalMediaAEC",[oW],Object.getOwnPropertyDescriptor(bE.prototype,"processExternalMediaAEC"),bE.prototype),bE);function cW(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function lW(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cW(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):cW(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}const DI=window||document;function dW(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!DI)return;const i=tr._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const s=c=>{if(!(c&&c.blockedURI&&(tr.onSecurityPolicyViolation||tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(h=>Re(u).call(u,h))&&(tr.onSecurityPolicyViolation&&typeof tr.onSecurityPolicyViolation=="function"&&tr.onSecurityPolicyViolation(c),tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0&&tr.safeEmit(_c.SECURITY_POLICY_VIOLATION,c))};i&&DI.removeEventListener("securitypolicyviolation",i),(r||t&&typeof t=="function"||tr.getListeners(_c.SECURITY_POLICY_VIOLATION).length>0)&&DI.addEventListener("securitypolicyviolation",s),tr._cspEventHandlerPointer=s}var eye=N,tye=zN,uW=RegExp.prototype,nye=function(t){return t===uW||eye(uW,t)?tye(t):t.flags},mi=d(nye);function lm(t){let r=t.length;for(;--r>=0;)t[r]=0}const kI=256,hW=286,pv=30,mv=15,jI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),EE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),rye=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),pW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cl=new Array(576);lm(cl);const fv=new Array(60);lm(fv);const gv=new Array(512);lm(gv);const vv=new Array(256);lm(vv);const LI=new Array(29);lm(LI);const xE=new Array(pv);function MI(t,r,i,s,c){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=t&&t.length}let mW,fW,gW;function UI(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}lm(xE);const vW=t=>t<256?gv[t]:gv[256+(t>>>7)],yv=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Ka=(t,r,i)=>{t.bi_valid>16-i?(t.bi_buf|=r<<t.bi_valid&65535,yv(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)},Tc=(t,r,i)=>{Ka(t,i[2*r],i[2*r+1])},yW=(t,r)=>{let i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0);return i>>>1},_W=(t,r,i)=>{const s=new Array(16);let c,u,h=0;for(c=1;c<=mv;c++)h=h+i[c-1]<<1,s[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=yW(s[m]++,m))}},bW=t=>{let r;for(r=0;r<hW;r++)t.dyn_ltree[2*r]=0;for(r=0;r<pv;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},EW=t=>{t.bi_valid>8?yv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},xW=(t,r,i,s)=>{const c=2*r,u=2*i;return t[c]<t[u]||t[c]===t[u]&&s[r]<=s[i]},FI=(t,r,i)=>{const s=t.heap[i];let c=i<<1;for(;c<=t.heap_len&&(c<t.heap_len&&xW(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!xW(r,s,t.heap[c],t.depth));)t.heap[i]=t.heap[c],i=c,c<<=1;t.heap[i]=s},SW=(t,r,i)=>{let s,c,u,h,m=0;if(t.sym_next!==0)do s=255&t.pending_buf[t.sym_buf+m++],s+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],s===0?Tc(t,c,r):(u=vv[c],Tc(t,u+kI+1,r),h=jI[u],h!==0&&(c-=LI[u],Ka(t,c,h)),s--,u=vW(s),Tc(t,u,i),h=EE[u],h!==0&&(s-=xE[u],Ka(t,s,h)));while(m<t.sym_next);Tc(t,256,r)},VI=(t,r)=>{const i=r.dyn_tree,s=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,g,y=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(t.heap[++t.heap_len]=y=h,t.depth[h]=0):i[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=y<2?++y:0,i[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=s[2*g+1]);for(r.max_code=y,h=t.heap_len>>1;h>=1;h--)FI(t,i,h);g=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],FI(t,i,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,i[2*g]=i[2*h]+i[2*m],t.depth[g]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,i[2*h+1]=i[2*m+1]=g,t.heap[1]=g++,FI(t,i,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((_,x)=>{const S=x.dyn_tree,C=x.max_code,M=x.stat_desc.static_tree,D=x.stat_desc.has_stree,j=x.stat_desc.extra_bits,$=x.stat_desc.extra_base,K=x.stat_desc.max_length;let J,ne,ae,Q,oe,ge,Ee=0;for(Q=0;Q<=mv;Q++)_.bl_count[Q]=0;for(S[2*_.heap[_.heap_max]+1]=0,J=_.heap_max+1;J<573;J++)ne=_.heap[J],Q=S[2*S[2*ne+1]+1]+1,Q>K&&(Q=K,Ee++),S[2*ne+1]=Q,ne>C||(_.bl_count[Q]++,oe=0,ne>=$&&(oe=j[ne-$]),ge=S[2*ne],_.opt_len+=ge*(Q+oe),D&&(_.static_len+=ge*(M[2*ne+1]+oe)));if(Ee!==0){do{for(Q=K-1;_.bl_count[Q]===0;)Q--;_.bl_count[Q]--,_.bl_count[Q+1]+=2,_.bl_count[K]--,Ee-=2}while(Ee>0);for(Q=K;Q!==0;Q--)for(ne=_.bl_count[Q];ne!==0;)ae=_.heap[--J],ae>C||(S[2*ae+1]!==Q&&(_.opt_len+=(Q-S[2*ae+1])*S[2*ae],S[2*ae+1]=Q),ne--)}})(t,r),_W(i,y,t.bl_count)},wW=(t,r,i)=>{let s,c,u=-1,h=r[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),r[2*(i+1)+1]=65535,s=0;s<=i;s++)c=h,h=r[2*(s+1)+1],++m<g&&c===h||(m<y?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(g=138,y=3):c===h?(g=6,y=3):(g=7,y=4))},TW=(t,r,i)=>{let s,c,u=-1,h=r[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),s=0;s<=i;s++)if(c=h,h=r[2*(s+1)+1],!(++m<g&&c===h)){if(m<y)do Tc(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Tc(t,c,t.bl_tree),m--),Tc(t,16,t.bl_tree),Ka(t,m-3,2)):m<=10?(Tc(t,17,t.bl_tree),Ka(t,m-3,3)):(Tc(t,18,t.bl_tree),Ka(t,m-11,7));m=0,u=c,h===0?(g=138,y=3):c===h?(g=6,y=3):(g=7,y=4)}};let CW=!1;const NW=(t,r,i,s)=>{Ka(t,0+(s?1:0),3),EW(t),yv(t,i),yv(t,~i),i&&t.pending_buf.set(t.window.subarray(r,r+i),t.pending),t.pending+=i};var iye=t=>{CW||((()=>{let r,i,s,c,u;const h=new Array(16);for(s=0,c=0;c<28;c++)for(LI[c]=s,r=0;r<1<<jI[c];r++)vv[s++]=c;for(vv[s-1]=c,u=0,c=0;c<16;c++)for(xE[c]=u,r=0;r<1<<EE[c];r++)gv[u++]=c;for(u>>=7;c<pv;c++)for(xE[c]=u<<7,r=0;r<1<<EE[c]-7;r++)gv[256+u++]=c;for(i=0;i<=mv;i++)h[i]=0;for(r=0;r<=143;)cl[2*r+1]=8,r++,h[8]++;for(;r<=255;)cl[2*r+1]=9,r++,h[9]++;for(;r<=279;)cl[2*r+1]=7,r++,h[7]++;for(;r<=287;)cl[2*r+1]=8,r++,h[8]++;for(_W(cl,287,h),r=0;r<pv;r++)fv[2*r+1]=5,fv[2*r]=yW(r,5);mW=new MI(cl,jI,257,hW,mv),fW=new MI(fv,EE,0,pv,mv),gW=new MI(new Array(0),rye,0,19,7)})(),CW=!0),t.l_desc=new UI(t.dyn_ltree,mW),t.d_desc=new UI(t.dyn_dtree,fW),t.bl_desc=new UI(t.bl_tree,gW),t.bi_buf=0,t.bi_valid=0,bW(t)},aye=(t,r,i,s)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,y=4093624447;for(g=0;g<=31;g++,y>>>=1)if(1&y&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<kI;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),VI(t,t.l_desc),VI(t,t.d_desc),h=(m=>{let g;for(wW(m,m.dyn_ltree,m.l_desc.max_code),wW(m,m.dyn_dtree,m.d_desc.max_code),VI(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*pW[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?NW(t,r,i,s):t.strategy===4||u===c?(Ka(t,2+(s?1:0),3),SW(t,cl,fv)):(Ka(t,4+(s?1:0),3),((m,g,y,_)=>{let x;for(Ka(m,g-257,5),Ka(m,y-1,5),Ka(m,_-4,4),x=0;x<_;x++)Ka(m,m.bl_tree[2*pW[x]+1],3);TW(m,m.dyn_ltree,g-1),TW(m,m.dyn_dtree,y-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),SW(t,t.dyn_ltree,t.dyn_dtree)),bW(t),s&&EW(t)},sye=(t,r,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,r===0?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*(vv[i]+kI+1)]++,t.dyn_dtree[2*vW(r)]++),t.sym_next===t.sym_end),oye=t=>{Ka(t,2,3),Tc(t,256,cl),(r=>{r.bi_valid===16?(yv(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},cye={_tr_init:iye,_tr_stored_block:NW,_tr_flush_block:aye,_tr_tally:sye,_tr_align:oye},_v=(t,r,i,s)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[s++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const lye=new Uint32Array((()=>{let t,r=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;r[i]=t}return r})());var Ii=(t,r,i,s)=>{const c=lye,u=s+i;t^=-1;for(let h=s;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},Xu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},SE={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dye,_tr_stored_block:BI,_tr_flush_block:uye,_tr_tally:pd,_tr_align:hye}=cye,{Z_NO_FLUSH:md,Z_PARTIAL_FLUSH:pye,Z_FULL_FLUSH:mye,Z_FINISH:Xs,Z_BLOCK:RW,Z_OK:$i,Z_STREAM_END:AW,Z_STREAM_ERROR:Cc,Z_DATA_ERROR:fye,Z_BUF_ERROR:GI,Z_DEFAULT_COMPRESSION:gye,Z_FILTERED:vye,Z_HUFFMAN_ONLY:wE,Z_RLE:yye,Z_FIXED:_ye,Z_DEFAULT_STRATEGY:bye,Z_UNKNOWN:Eye,Z_DEFLATED:TE}=SE,WI=286,xye=30,Sye=19,wye=2*WI+1,Tye=15,Ju=258,Nc=262,dm=42,Qu=113,bv=666,Zu=(t,r)=>(t.msg=Xu[r],r),IW=t=>2*t-(t>4?9:0),fd=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Cye=t=>{let r,i,s,c=t.w_size;r=t.hash_size,s=r;do i=t.head[--s],t.head[s]=i>=c?i-c:0;while(--r);r=c,s=r;do i=t.prev[--s],t.prev[s]=i>=c?i-c:0;while(--r)};let gd=(t,r,i)=>(r<<t.hash_shift^i)&t.hash_mask;const ms=t=>{const r=t.state;let i=r.pending;i>t.avail_out&&(i=t.avail_out),i!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),t.next_out),t.next_out+=i,r.pending_out+=i,t.total_out+=i,t.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},fs=(t,r)=>{uye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,ms(t.strm)},Gn=(t,r)=>{t.pending_buf[t.pending++]=r},Ev=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},$I=(t,r,i,s)=>{let c=t.avail_in;return c>s&&(c=s),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),i),t.state.wrap===1?t.adler=_v(t.adler,r,c,i):t.state.wrap===2&&(t.adler=Ii(t.adler,r,c,i)),t.next_in+=c,t.total_in+=c,c)},OW=(t,r)=>{let i,s,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-Nc?t.strstart-(t.w_size-Nc):0,y=t.window,_=t.w_mask,x=t.prev,S=t.strstart+Ju;let C=y[u+h-1],M=y[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(i=r,y[i+h]===M&&y[i+h-1]===C&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<S);if(s=Ju-(S-u),u=S-Ju,s>h){if(t.match_start=r,h=s,s>=m)break;C=y[u+h-1],M=y[u+h]}}while((r=x[r&_])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},um=t=>{const r=t.w_size;let i,s,c;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Nc)&&(t.window.set(t.window.subarray(r,r+r-s),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Cye(t),s+=r),t.strm.avail_in===0)break;if(i=$I(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=gd(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=gd(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Nc&&t.strm.avail_in!==0)},PW=(t,r)=>{let i,s,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(i=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,s=t.strstart-t.block_start,i>s+t.strm.avail_in&&(i=s+t.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==Xs||r===md||i!==s+t.strm.avail_in)))break;h=r===Xs&&i===s+t.strm.avail_in?1:0,BI(t,0,0,h),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,ms(t.strm),s&&(s>i&&(s=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,i-=s),i&&($I(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==md&&r!==Xs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&($I(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,s=t.strstart-t.block_start,(s>=u||(s||r===Xs)&&r!==md&&t.strm.avail_in===0&&s<=c)&&(i=s>c?c:s,h=r===Xs&&t.strm.avail_in===0&&i===s?1:0,BI(t,t.block_start,i,h),t.block_start+=i,ms(t.strm)),h?3:1)},HI=(t,r)=>{let i,s;for(;;){if(t.lookahead<Nc){if(um(t),t.lookahead<Nc&&r===md)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),i!==0&&t.strstart-i<=t.w_size-Nc&&(t.match_length=OW(t,i)),t.match_length>=3)if(s=pd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=gd(t,t.ins_h,t.window[t.strstart+1]);else s=pd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(fs(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Xs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2},hm=(t,r)=>{let i,s,c;for(;;){if(t.lookahead<Nc){if(um(t),t.lookahead<Nc&&r===md)return 1;if(t.lookahead===0)break}if(i=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,i!==0&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Nc&&(t.match_length=OW(t,i),t.match_length<=5&&(t.strategy===vye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,s=pd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(fs(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(s=pd(t,0,t.window[t.strstart-1]),s&&fs(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=pd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Xs?(fs(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(fs(t,!1),t.strm.avail_out===0)?1:2};function Rc(t,r,i,s,c){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=s,this.func=c}const xv=[new Rc(0,0,0,0,PW),new Rc(4,4,8,4,HI),new Rc(4,5,16,8,HI),new Rc(4,6,32,32,HI),new Rc(4,4,16,16,hm),new Rc(8,16,32,32,hm),new Rc(8,16,128,128,hm),new Rc(8,32,128,256,hm),new Rc(32,128,258,1024,hm),new Rc(32,258,258,4096,hm)];function Nye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=TE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*wye),this.dyn_dtree=new Uint16Array(2*(2*xye+1)),this.bl_tree=new Uint16Array(2*(2*Sye+1)),fd(this.dyn_ltree),fd(this.dyn_dtree),fd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Tye+1),this.heap=new Uint16Array(2*WI+1),fd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*WI+1),fd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Sv=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==dm&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Qu&&r.status!==bv?1:0},DW=t=>{if(Sv(t))return Zu(t,Cc);t.total_in=t.total_out=0,t.data_type=Eye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?dm:Qu,t.adler=r.wrap===2?0:1,r.last_flush=-2,dye(r),$i},kW=t=>{const r=DW(t);return r===$i&&(i=>{i.window_size=2*i.w_size,fd(i.head),i.max_lazy_match=xv[i.level].max_lazy,i.good_match=xv[i.level].good_length,i.nice_match=xv[i.level].nice_length,i.max_chain_length=xv[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(t.state),r},jW=(t,r,i,s,c,u)=>{if(!t)return Cc;let h=1;if(r===gye&&(r=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||i!==TE||s<8||s>15||r<0||r>9||u<0||u>_ye||s===8&&h!==1)return Zu(t,Cc);s===8&&(s=9);const m=new Nye;return t.state=m,m.strm=t,m.status=dm,m.wrap=h,m.gzhead=null,m.w_bits=s,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,kW(t)};var Rye=(t,r)=>{if(Sv(t)||r>RW||r<0)return t?Zu(t,Cc):Cc;const i=t.state;if(!t.output||t.avail_in!==0&&!t.input||i.status===bv&&r!==Xs)return Zu(t,t.avail_out===0?GI:Cc);const s=i.last_flush;if(i.last_flush=r,i.pending!==0){if(ms(t),t.avail_out===0)return i.last_flush=-1,$i}else if(t.avail_in===0&&IW(r)<=IW(s)&&r!==Xs)return Zu(t,GI);if(i.status===bv&&t.avail_in!==0)return Zu(t,GI);if(i.status===dm&&i.wrap===0&&(i.status=Qu),i.status===dm){let c=TE+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=wE||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Ev(i,c),i.strstart!==0&&(Ev(i,t.adler>>>16),Ev(i,65535&t.adler)),t.adler=1,i.status=Qu,ms(t),i.pending!==0)return i.last_flush=-1,$i}if(i.status===57){if(t.adler=0,Gn(i,31),Gn(i,139),Gn(i,8),i.gzhead)Gn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gn(i,255&i.gzhead.time),Gn(i,i.gzhead.time>>8&255),Gn(i,i.gzhead.time>>16&255),Gn(i,i.gzhead.time>>24&255),Gn(i,i.level===9?2:i.strategy>=wE||i.level<2?4:0),Gn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gn(i,255&i.gzhead.extra.length),Gn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=Ii(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,0),Gn(i,i.level===9?2:i.strategy>=wE||i.level<2?4:0),Gn(i,3),i.status=Qu,ms(t),i.pending!==0)return i.last_flush=-1,$i}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,ms(t),i.pending!==0)return i.last_flush=-1,$i;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-u,u)),ms(t),i.pending!==0)return i.last_flush=-1,$i;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-u,u)),ms(t),i.pending!==0)return i.last_flush=-1,$i;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gn(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(t.adler=Ii(t.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(ms(t),i.pending!==0))return i.last_flush=-1,$i;Gn(i,255&t.adler),Gn(i,t.adler>>8&255),t.adler=0}if(i.status=Qu,ms(t),i.pending!==0)return i.last_flush=-1,$i}if(t.avail_in!==0||i.lookahead!==0||r!==md&&i.status!==bv){let c=i.level===0?PW(i,r):i.strategy===wE?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(um(u),u.lookahead===0)){if(h===md)return 1;break}if(u.match_length=0,m=pd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Xs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===yye?((u,h)=>{let m,g,y,_;const x=u.window;for(;;){if(u.lookahead<=Ju){if(um(u),u.lookahead<=Ju&&h===md)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,g=x[y],g===x[++y]&&g===x[++y]&&g===x[++y])){_=u.strstart+Ju;do;while(g===x[++y]&&g===x[++y]&&g===x[++y]&&g===x[++y]&&g===x[++y]&&g===x[++y]&&g===x[++y]&&g===x[++y]&&y<_);u.match_length=Ju-(_-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=pd(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=pd(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(fs(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Xs?(fs(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(fs(u,!1),u.strm.avail_out===0)?1:2})(i,r):xv[i.level].func(i,r);if(c!==3&&c!==4||(i.status=bv),c===1||c===3)return t.avail_out===0&&(i.last_flush=-1),$i;if(c===2&&(r===pye?hye(i):r!==RW&&(BI(i,0,0,!1),r===mye&&(fd(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),ms(t),t.avail_out===0))return i.last_flush=-1,$i}return r!==Xs?$i:i.wrap<=0?AW:(i.wrap===2?(Gn(i,255&t.adler),Gn(i,t.adler>>8&255),Gn(i,t.adler>>16&255),Gn(i,t.adler>>24&255),Gn(i,255&t.total_in),Gn(i,t.total_in>>8&255),Gn(i,t.total_in>>16&255),Gn(i,t.total_in>>24&255)):(Ev(i,t.adler>>>16),Ev(i,65535&t.adler)),ms(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?$i:AW)},Aye=(t,r)=>{let i=r.length;if(Sv(t))return Cc;const s=t.state,c=s.wrap;if(c===2||c===1&&s.status!==dm||s.lookahead)return Cc;if(c===1&&(t.adler=_v(t.adler,r,i,0)),s.wrap=0,i>=s.w_size){c===0&&(fd(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(r.subarray(i-s.w_size,i),0),r=g,i=s.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=i,t.next_in=0,t.input=r,um(s);s.lookahead>=3;){let g=s.strstart,y=s.lookahead-2;do s.ins_h=gd(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--y);s.strstart=g,s.lookahead=2,um(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,s.wrap=c,$i},wv={deflateInit:(t,r)=>jW(t,r,TE,15,8,bye),deflateInit2:jW,deflateReset:kW,deflateResetKeep:DW,deflateSetHeader:(t,r)=>Sv(t)||t.state.wrap!==2?Cc:(t.state.gzhead=r,$i),deflate:Rye,deflateEnd:t=>{if(Sv(t))return Cc;const r=t.state.status;return t.state=null,r===Qu?Zu(t,fye):$i},deflateSetDictionary:Aye,deflateInfo:"pako deflate (from Nodeca project)"};const Iye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var CE={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const s in i)Iye(i,s)&&(t[s]=i[s])}}return t},flattenChunks:t=>{let r=0;for(let s=0,c=t.length;s<c;s++)r+=t[s].length;const i=new Uint8Array(r);for(let s=0,c=0,u=t.length;s<u;s++){let h=t[s];i.set(h,c),c+=h.length}return i}};let LW=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{LW=!1}const Tv=new Uint8Array(256);for(let t=0;t<256;t++)Tv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Tv[254]=Tv[254]=1;var Cv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,i,s,c,u,h=t.length,m=0;for(c=0;c<h;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=t.charCodeAt(c),(64512&i)==55296&&c+1<h&&(s=t.charCodeAt(c+1),(64512&s)==56320&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(t,r)=>{const i=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let s,c;const u=new Array(2*i);for(c=0,s=0;s<i;){let h=t[s++];if(h<128){u[c++]=h;continue}let m=Tv[h];if(m>4)u[c++]=65533,s+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&s<i;)h=h<<6|63&t[s++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&LW)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let y=0;y<m;y++)g+=String.fromCharCode(h[y]);return g})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let i=r-1;for(;i>=0&&(192&t[i])==128;)i--;return i<0||i===0?r:i+Tv[t[i]]>r?i:r}},MW=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const UW=Object.prototype.toString,{Z_NO_FLUSH:Oye,Z_SYNC_FLUSH:Pye,Z_FULL_FLUSH:Dye,Z_FINISH:kye,Z_OK:NE,Z_STREAM_END:jye,Z_DEFAULT_COMPRESSION:Lye,Z_DEFAULT_STRATEGY:Mye,Z_DEFLATED:Uye}=SE;function RE(t){this.options=CE.assign({level:Lye,method:Uye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Mye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MW,this.strm.avail_out=0;let i=wv.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==NE)throw new Error(Xu[i]);if(r.header&&wv.deflateSetHeader(this.strm,r.header),r.dictionary){let s;if(s=typeof r.dictionary=="string"?Cv.string2buf(r.dictionary):UW.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=wv.deflateSetDictionary(this.strm,s),i!==NE)throw new Error(Xu[i]);this._dict_set=!0}}function FW(t,r){const i=new RE(r);if(i.push(t,!0),i.err)throw i.msg||Xu[i.err];return i.result}RE.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?kye:Oye,typeof t=="string"?i.input=Cv.string2buf(t):UW.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(u===Pye||u===Dye)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=wv.deflate(i,u),c===jye)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=wv.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===NE;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},RE.prototype.onData=function(t){this.chunks.push(t)},RE.prototype.onEnd=function(t){t===NE&&(this.result=CE.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Fye={deflate:FW,deflateRaw:function(t,r){return(r=r||{}).raw=!0,FW(t,r)}};const AE=16209;var Vye=function(t,r){let i,s,c,u,h,m,g,y,_,x,S,C,M,D,j,$,K,J,ne,ae,Q,oe,ge,Ee;const Fe=t.state;i=t.next_in,ge=t.input,s=i+(t.avail_in-5),c=t.next_out,Ee=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=Fe.dmax,g=Fe.wsize,y=Fe.whave,_=Fe.wnext,x=Fe.window,S=Fe.hold,C=Fe.bits,M=Fe.lencode,D=Fe.distcode,j=(1<<Fe.lenbits)-1,$=(1<<Fe.distbits)-1;e:do{C<15&&(S+=ge[i++]<<C,C+=8,S+=ge[i++]<<C,C+=8),K=M[S&j];t:for(;;){if(J=K>>>24,S>>>=J,C-=J,J=K>>>16&255,J===0)Ee[c++]=65535&K;else{if(!(16&J)){if(!(64&J)){K=M[(65535&K)+(S&(1<<J)-1)];continue t}if(32&J){Fe.mode=16191;break e}t.msg="invalid literal/length code",Fe.mode=AE;break e}ne=65535&K,J&=15,J&&(C<J&&(S+=ge[i++]<<C,C+=8),ne+=S&(1<<J)-1,S>>>=J,C-=J),C<15&&(S+=ge[i++]<<C,C+=8,S+=ge[i++]<<C,C+=8),K=D[S&$];n:for(;;){if(J=K>>>24,S>>>=J,C-=J,J=K>>>16&255,!(16&J)){if(!(64&J)){K=D[(65535&K)+(S&(1<<J)-1)];continue n}t.msg="invalid distance code",Fe.mode=AE;break e}if(ae=65535&K,J&=15,C<J&&(S+=ge[i++]<<C,C+=8,C<J&&(S+=ge[i++]<<C,C+=8)),ae+=S&(1<<J)-1,ae>m){t.msg="invalid distance too far back",Fe.mode=AE;break e}if(S>>>=J,C-=J,J=c-u,ae>J){if(J=ae-J,J>y&&Fe.sane){t.msg="invalid distance too far back",Fe.mode=AE;break e}if(Q=0,oe=x,_===0){if(Q+=g-J,J<ne){ne-=J;do Ee[c++]=x[Q++];while(--J);Q=c-ae,oe=Ee}}else if(_<J){if(Q+=g+_-J,J-=_,J<ne){ne-=J;do Ee[c++]=x[Q++];while(--J);if(Q=0,_<ne){J=_,ne-=J;do Ee[c++]=x[Q++];while(--J);Q=c-ae,oe=Ee}}}else if(Q+=_-J,J<ne){ne-=J;do Ee[c++]=x[Q++];while(--J);Q=c-ae,oe=Ee}for(;ne>2;)Ee[c++]=oe[Q++],Ee[c++]=oe[Q++],Ee[c++]=oe[Q++],ne-=3;ne&&(Ee[c++]=oe[Q++],ne>1&&(Ee[c++]=oe[Q++]))}else{Q=c-ae;do Ee[c++]=Ee[Q++],Ee[c++]=Ee[Q++],Ee[c++]=Ee[Q++],ne-=3;while(ne>2);ne&&(Ee[c++]=Ee[Q++],ne>1&&(Ee[c++]=Ee[Q++]))}break}}break}}while(i<s&&c<h);ne=C>>3,i-=ne,C-=ne<<3,S&=(1<<C)-1,t.next_in=i,t.next_out=c,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=c<h?h-c+257:257-(c-h),Fe.hold=S,Fe.bits=C};const IE=15,Bye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Wye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$ye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Nv=(t,r,i,s,c,u,h,m)=>{const g=m.bits;let y,_,x,S,C,M,D=0,j=0,$=0,K=0,J=0,ne=0,ae=0,Q=0,oe=0,ge=0,Ee=null;const Fe=new Uint16Array(16),ht=new Uint16Array(16);let ot,wt,_t,qt=null;for(D=0;D<=IE;D++)Fe[D]=0;for(j=0;j<s;j++)Fe[r[i+j]]++;for(J=g,K=IE;K>=1&&Fe[K]===0;K--);if(J>K&&(J=K),K===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for($=1;$<K&&Fe[$]===0;$++);for(J<$&&(J=$),Q=1,D=1;D<=IE;D++)if(Q<<=1,Q-=Fe[D],Q<0)return-1;if(Q>0&&(t===0||K!==1))return-1;for(ht[1]=0,D=1;D<IE;D++)ht[D+1]=ht[D]+Fe[D];for(j=0;j<s;j++)r[i+j]!==0&&(h[ht[r[i+j]]++]=j);if(t===0?(Ee=qt=h,M=20):t===1?(Ee=Bye,qt=Gye,M=257):(Ee=Wye,qt=$ye,M=0),ge=0,j=0,D=$,C=u,ne=J,ae=0,x=-1,oe=1<<J,S=oe-1,t===1&&oe>852||t===2&&oe>592)return 1;for(;;){ot=D-ae,h[j]+1<M?(wt=0,_t=h[j]):h[j]>=M?(wt=qt[h[j]-M],_t=Ee[h[j]-M]):(wt=96,_t=0),y=1<<D-ae,_=1<<ne,$=_;do _-=y,c[C+(ge>>ae)+_]=ot<<24|wt<<16|_t|0;while(_!==0);for(y=1<<D-1;ge&y;)y>>=1;if(y!==0?(ge&=y-1,ge+=y):ge=0,j++,--Fe[D]==0){if(D===K)break;D=r[i+h[j]]}if(D>J&&(ge&S)!==x){for(ae===0&&(ae=J),C+=$,ne=D-ae,Q=1<<ne;ne+ae<K&&(Q-=Fe[ne+ae],!(Q<=0));)ne++,Q<<=1;if(oe+=1<<ne,t===1&&oe>852||t===2&&oe>592)return 1;x=ge&S,c[x]=J<<24|ne<<16|C-u|0}}return ge!==0&&(c[C+ge]=D-ae<<24|64<<16|0),m.bits=J,0};const{Z_FINISH:VW,Z_BLOCK:Hye,Z_TREES:OE,Z_OK:eh,Z_STREAM_END:zye,Z_NEED_DICT:Kye,Z_STREAM_ERROR:Js,Z_DATA_ERROR:BW,Z_MEM_ERROR:GW,Z_BUF_ERROR:Yye,Z_DEFLATED:WW}=SE,PE=16180,DE=16190,ll=16191,zI=16192,KI=16194,kE=16199,jE=16200,YI=16206,Pr=16209,$W=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function qye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const th=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<PE||r.mode>16211?1:0},HW=t=>{if(th(t))return Js;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=PE,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,eh},zW=t=>{if(th(t))return Js;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,HW(t)},KW=(t,r)=>{let i;if(th(t))return Js;const s=t.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Js:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=i,s.wbits=r,zW(t))},YW=(t,r)=>{if(!t)return Js;const i=new qye;t.state=i,i.strm=t,i.window=null,i.mode=PE;const s=KW(t,r);return s!==eh&&(t.state=null),s};let qI,XI,qW=!0;const Xye=t=>{if(qW){qI=new Int32Array(512),XI=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(Nv(1,t.lens,0,288,qI,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;Nv(2,t.lens,0,32,XI,0,t.work,{bits:5}),qW=!1}t.lencode=qI,t.lenbits=9,t.distcode=XI,t.distbits=5},XW=(t,r,i,s)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>s&&(c=s),u.window.set(r.subarray(i-s,i-s+c),u.wnext),(s-=c)?(u.window.set(r.subarray(i-s,i),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Jye=(t,r)=>{let i,s,c,u,h,m,g,y,_,x,S,C,M,D,j,$,K,J,ne,ae,Q,oe,ge=0;const Ee=new Uint8Array(4);let Fe,ht;const ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(th(t)||!t.output||!t.input&&t.avail_in!==0)return Js;i=t.state,i.mode===ll&&(i.mode=zI),h=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,m=t.avail_in,y=i.hold,_=i.bits,x=m,S=g,oe=eh;e:for(;;)switch(i.mode){case PE:if(i.wrap===0){i.mode=zI;break}for(;_<16;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ee[0]=255&y,Ee[1]=y>>>8&255,i.check=Ii(i.check,Ee,2,0),y=0,_=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",i.mode=Pr;break}if((15&y)!==WW){t.msg="unknown compression method",i.mode=Pr;break}if(y>>>=4,_-=4,Q=8+(15&y),i.wbits===0&&(i.wbits=Q),Q>15||Q>i.wbits){t.msg="invalid window size",i.mode=Pr;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&y?16189:ll,y=0,_=0;break;case 16181:for(;_<16;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(i.flags=y,(255&mi(i))!==WW){t.msg="unknown compression method",i.mode=Pr;break}if(57344&mi(i)){t.msg="unknown header flags set",i.mode=Pr;break}i.head&&(i.head.text=y>>8&1),512&mi(i)&&4&i.wrap&&(Ee[0]=255&y,Ee[1]=y>>>8&255,i.check=Ii(i.check,Ee,2,0)),y=0,_=0,i.mode=16182;case 16182:for(;_<32;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.head&&(i.head.time=y),512&mi(i)&&4&i.wrap&&(Ee[0]=255&y,Ee[1]=y>>>8&255,Ee[2]=y>>>16&255,Ee[3]=y>>>24&255,i.check=Ii(i.check,Ee,4,0)),y=0,_=0,i.mode=16183;case 16183:for(;_<16;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&mi(i)&&4&i.wrap&&(Ee[0]=255&y,Ee[1]=y>>>8&255,i.check=Ii(i.check,Ee,2,0)),y=0,_=0,i.mode=16184;case 16184:if(1024&mi(i)){for(;_<16;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.length=y,i.head&&(i.head.extra_len=y),512&mi(i)&&4&i.wrap&&(Ee[0]=255&y,Ee[1]=y>>>8&255,i.check=Ii(i.check,Ee,2,0)),y=0,_=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&mi(i)&&(C=i.length,C>m&&(C=m),C&&(i.head&&(Q=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(u,u+C),Q)),512&mi(i)&&4&i.wrap&&(i.check=Ii(i.check,s,C,u)),m-=C,u+=C,i.length-=C),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&mi(i)){if(m===0)break e;C=0;do Q=s[u+C++],i.head&&Q&&i.length<65536&&(i.head.name+=String.fromCharCode(Q));while(Q&&C<m);if(512&mi(i)&&4&i.wrap&&(i.check=Ii(i.check,s,C,u)),m-=C,u+=C,Q)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&mi(i)){if(m===0)break e;C=0;do Q=s[u+C++],i.head&&Q&&i.length<65536&&(i.head.comment+=String.fromCharCode(Q));while(Q&&C<m);if(512&mi(i)&&4&i.wrap&&(i.check=Ii(i.check,s,C,u)),m-=C,u+=C,Q)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&mi(i)){for(;_<16;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(4&i.wrap&&y!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Pr;break}y=0,_=0}i.head&&(i.head.hcrc=mi(i)>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=ll;break;case 16189:for(;_<32;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}t.adler=i.check=$W(y),y=0,_=0,i.mode=DE;case DE:if(i.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=y,i.bits=_,Kye;t.adler=i.check=1,i.mode=ll;case ll:if(r===Hye||r===OE)break e;case zI:if(i.last){y>>>=7&_,_-=7&_,i.mode=YI;break}for(;_<3;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}switch(i.last=1&y,y>>>=1,_-=1,3&y){case 0:i.mode=16193;break;case 1:if(Xye(i),i.mode=kE,r===OE){y>>>=2,_-=2;break e}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Pr}y>>>=2,_-=2;break;case 16193:for(y>>>=7&_,_-=7&_;_<32;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Pr;break}if(i.length=65535&y,y=0,_=0,i.mode=KI,r===OE)break e;case KI:i.mode=16195;case 16195:if(C=i.length,C){if(C>m&&(C=m),C>g&&(C=g),C===0)break e;c.set(s.subarray(u,u+C),h),m-=C,u+=C,g-=C,h+=C,i.length-=C;break}i.mode=ll;break;case 16196:for(;_<14;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(i.nlen=257+(31&y),y>>>=5,_-=5,i.ndist=1+(31&y),y>>>=5,_-=5,i.ncode=4+(15&y),y>>>=4,_-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Pr;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_<3;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.lens[ot[i.have++]]=7&y,y>>>=3,_-=3}for(;i.have<19;)i.lens[ot[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Fe={bits:i.lenbits},oe=Nv(0,i.lens,0,19,i.lencode,0,i.work,Fe),i.lenbits=Fe.bits,oe){t.msg="invalid code lengths set",i.mode=Pr;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ge=i.lencode[y&(1<<i.lenbits)-1],j=ge>>>24,$=ge>>>16&255,K=65535&ge,!(j<=_);){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(K<16)y>>>=j,_-=j,i.lens[i.have++]=K;else{if(K===16){for(ht=j+2;_<ht;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(y>>>=j,_-=j,i.have===0){t.msg="invalid bit length repeat",i.mode=Pr;break}Q=i.lens[i.have-1],C=3+(3&y),y>>>=2,_-=2}else if(K===17){for(ht=j+3;_<ht;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}y>>>=j,_-=j,Q=0,C=3+(7&y),y>>>=3,_-=3}else{for(ht=j+7;_<ht;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}y>>>=j,_-=j,Q=0,C=11+(127&y),y>>>=7,_-=7}if(i.have+C>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Pr;break}for(;C--;)i.lens[i.have++]=Q}}if(i.mode===Pr)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=Pr;break}if(i.lenbits=9,Fe={bits:i.lenbits},oe=Nv(1,i.lens,0,i.nlen,i.lencode,0,i.work,Fe),i.lenbits=Fe.bits,oe){t.msg="invalid literal/lengths set",i.mode=Pr;break}if(i.distbits=6,i.distcode=i.distdyn,Fe={bits:i.distbits},oe=Nv(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Fe),i.distbits=Fe.bits,oe){t.msg="invalid distances set",i.mode=Pr;break}if(i.mode=kE,r===OE)break e;case kE:i.mode=jE;case jE:if(m>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=y,i.bits=_,Vye(t,S),h=t.next_out,c=t.output,g=t.avail_out,u=t.next_in,s=t.input,m=t.avail_in,y=i.hold,_=i.bits,i.mode===ll&&(i.back=-1);break}for(i.back=0;ge=i.lencode[y&(1<<i.lenbits)-1],j=ge>>>24,$=ge>>>16&255,K=65535&ge,!(j<=_);){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if($&&!(240&$)){for(J=j,ne=$,ae=K;ge=i.lencode[ae+((y&(1<<J+ne)-1)>>J)],j=ge>>>24,$=ge>>>16&255,K=65535&ge,!(J+j<=_);){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}y>>>=J,_-=J,i.back+=J}if(y>>>=j,_-=j,i.back+=j,i.length=K,$===0){i.mode=16205;break}if(32&$){i.back=-1,i.mode=ll;break}if(64&$){t.msg="invalid literal/length code",i.mode=Pr;break}i.extra=15&$,i.mode=16201;case 16201:if(i.extra){for(ht=i.extra;_<ht;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ge=i.distcode[y&(1<<i.distbits)-1],j=ge>>>24,$=ge>>>16&255,K=65535&ge,!(j<=_);){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(!(240&$)){for(J=j,ne=$,ae=K;ge=i.distcode[ae+((y&(1<<J+ne)-1)>>J)],j=ge>>>24,$=ge>>>16&255,K=65535&ge,!(J+j<=_);){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}y>>>=J,_-=J,i.back+=J}if(y>>>=j,_-=j,i.back+=j,64&$){t.msg="invalid distance code",i.mode=Pr;break}i.offset=K,i.extra=15&$,i.mode=16203;case 16203:if(i.extra){for(ht=i.extra;_<ht;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Pr;break}i.mode=16204;case 16204:if(g===0)break e;if(C=S-g,i.offset>C){if(C=i.offset-C,C>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Pr;break}C>i.wnext?(C-=i.wnext,M=i.wsize-C):M=i.wnext-C,C>i.length&&(C=i.length),D=i.window}else D=c,M=h-i.offset,C=i.length;C>g&&(C=g),g-=C,i.length-=C;do c[h++]=D[M++];while(--C);i.length===0&&(i.mode=jE);break;case 16205:if(g===0)break e;c[h++]=i.length,g--,i.mode=jE;break;case YI:if(i.wrap){for(;_<32;){if(m===0)break e;m--,y|=s[u++]<<_,_+=8}if(S-=g,t.total_out+=S,i.total+=S,4&i.wrap&&S&&(t.adler=i.check=mi(i)?Ii(i.check,c,S,h-S):_v(i.check,c,S,h-S)),S=g,4&i.wrap&&(mi(i)?y:$W(y))!==i.check){t.msg="incorrect data check",i.mode=Pr;break}y=0,_=0}i.mode=16207;case 16207:if(i.wrap&&mi(i)){for(;_<32;){if(m===0)break e;m--,y+=s[u++]<<_,_+=8}if(4&i.wrap&&y!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Pr;break}y=0,_=0}i.mode=16208;case 16208:oe=zye;break e;case Pr:oe=BW;break e;case 16210:return GW;default:return Js}return t.next_out=h,t.avail_out=g,t.next_in=u,t.avail_in=m,i.hold=y,i.bits=_,(i.wsize||S!==t.avail_out&&i.mode<Pr&&(i.mode<YI||r!==VW))&&XW(t,t.output,t.next_out,S-t.avail_out),x-=t.avail_in,S-=t.avail_out,t.total_in+=x,t.total_out+=S,i.total+=S,4&i.wrap&&S&&(t.adler=i.check=mi(i)?Ii(i.check,c,S,t.next_out-S):_v(i.check,c,S,t.next_out-S)),t.data_type=i.bits+(i.last?64:0)+(i.mode===ll?128:0)+(i.mode===kE||i.mode===KI?256:0),(x===0&&S===0||r===VW)&&oe===eh&&(oe=Yye),oe},dl={inflateReset:zW,inflateReset2:KW,inflateResetKeep:HW,inflateInit:t=>YW(t,15),inflateInit2:YW,inflate:Jye,inflateEnd:t=>{if(th(t))return Js;let r=t.state;return r.window&&(r.window=null),t.state=null,eh},inflateGetHeader:(t,r)=>{if(th(t))return Js;const i=t.state;return 2&i.wrap?(i.head=r,r.done=!1,eh):Js},inflateSetDictionary:(t,r)=>{const i=r.length;let s,c,u;return th(t)?Js:(s=t.state,s.wrap!==0&&s.mode!==DE?Js:s.mode===DE&&(c=1,c=_v(c,r,i,0),c!==s.check)?BW:(u=XW(t,r,i,i),u?(s.mode=16210,GW):(s.havedict=1,eh)))},inflateInfo:"pako inflate (from Nodeca project)"},Qye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const JW=Object.prototype.toString,{Z_NO_FLUSH:Zye,Z_FINISH:e0e,Z_OK:Rv,Z_STREAM_END:JI,Z_NEED_DICT:QI,Z_STREAM_ERROR:t0e,Z_DATA_ERROR:QW,Z_MEM_ERROR:n0e}=SE;function LE(t){this.options=CE.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new MW,this.strm.avail_out=0;let i=dl.inflateInit2(this.strm,r.windowBits);if(i!==Rv)throw new Error(Xu[i]);if(this.header=new Qye,dl.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Cv.string2buf(r.dictionary):JW.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=dl.inflateSetDictionary(this.strm,r.dictionary),i!==Rv)))throw new Error(Xu[i])}function ZW(t,r){const i=new LE(r);if(i.push(t),i.err)throw i.msg||Xu[i.err];return i.result}LE.prototype.push=function(t,r){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?e0e:Zye,JW.call(t)==="[object ArrayBuffer]"?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),u=dl.inflate(i,h),u===QI&&c&&(u=dl.inflateSetDictionary(i,c),u===Rv?u=dl.inflate(i,h):u===QW&&(u=QI));i.avail_in>0&&u===JI&&i.state.wrap>0&&t[i.next_in]!==0;)dl.inflateReset(i),u=dl.inflate(i,h);switch(u){case t0e:case QW:case QI:case n0e:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===JI))if(this.options.to==="string"){let g=Cv.utf8border(i.output,i.next_out),y=i.next_out-g,_=Cv.buf2string(i.output,g);i.next_out=y,i.avail_out=s-y,y&&i.output.set(i.output.subarray(g,g+y),0),this.onData(_)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==Rv||m!==0){if(u===JI)return u=dl.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},LE.prototype.onData=function(t){this.chunks.push(t)},LE.prototype.onEnd=function(t){t===Rv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=CE.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var r0e={inflate:ZW,inflateRaw:function(t,r){return(r=r||{}).raw=!0,ZW(t,r)}};const{deflate:i0e,deflateRaw:a0e}=Fye,{inflate:s0e,inflateRaw:o0e}=r0e;var c0e=i0e,l0e=a0e,d0e=s0e,u0e=o0e,e$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(e$||{});class h0e{constructor(){L(this,"_sequence",0),L(this,"_startTime",Date.now()),L(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&R.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),u=new DataView(s);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let s=0;const c=i.getUint16(s,!0);s+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(s+2,!0)<<16|i.getUint16(s,!0)};let h,m;if(s+=4,G("SHOW_DATASTREAM2_LOG")&&R.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(s,!0),s+=2,u.extension){m=this.deserializeExtension(r.slice(s)),s+=2+m.length,h=r.slice(s);let g=!1;if(m.datas.length>0){const y=m.datas.find(_=>_.id===0);y&&(g=(1&new DataView(y.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:s,datas:c}=r,u=new ArrayBuffer(s+2),h=new Uint8Array(u),m=new DataView(u);let g=0;if(m.setUint8(g++,i),m.setUint8(g++,s),c.forEach(y=>{i?(m.setUint8(g++,y.id),m.setUint8(g++,y.length),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength):(m.setUint8(g++,y.id|y.length<<4),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength)}),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return u}deserializeExtension(r){const i=new DataView(r);let s=0;const c=i.getUint8(s);s++;const u=i.getUint8(s);s++;const h=c===e$.TWO_BYTE,m=[],g=new DataView(r,2);let y=0;for(;y<u;){let _=0,x=0,S=new ArrayBuffer(0);h?(_=g.getUint8(y),y++,x=g.getUint8(y),y++):(_=15&g.getUint8(y),x=g.getUint8(y)>>4,y++),x>0&&(S=g.buffer.slice(y+2,y+2+x),y+=S.byteLength),m.push({id:_,length:x,data:S})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return d0e(new Uint8Array(r))}compress(r){return c0e(new Uint8Array(r))}}const p0e={name:"DataStream",create:(t,r)=>{const i=r?new vge(t):new yge(t);return i.useDataStream(new h0e),i}};class m0e extends An{constructor(r,i,s){super(),L(this,"ws",void 0),L(this,"requestId",1),L(this,"heartBeatTimer",void 0),L(this,"joinInfo",void 0),L(this,"clientId",void 0),L(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),L(this,"onClose",c=>{this.emit("close"),this.dispose()}),L(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new Qg("cross-channel-".concat(this.clientId),s),this.ws.on(Et.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Et.CONNECTED,this.onOpen),this.ws.on(Et.ON_MESSAGE,this.onMessage),this.ws.on(Et.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new ke((i,s)=>{const c=window.setTimeout(()=>{s(new ce(H.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?s(new ce(H.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new ce(H.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new ce(H.WS_DISCONNECT);const i=()=>new ke((h,m)=>{this.ws.once(Et.CLOSED,()=>m(new ce(H.WS_ABORT))),this.ws.once(Et.CONNECTED,h)});this.ws.state!=="connected"&&await i();const s=this.sendMessage(r),c=new ke((h,m)=>{const g=()=>{m(new ce(H.WS_ABORT))};this.ws.once(Et.RECONNECTING,g),this.ws.once(Et.CLOSED,g),this.once("req_".concat(s),h),yr(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(Et.RECONNECTING,g),this.ws.off(Et.CLOSED,g),m(new ce(H.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new ce(H.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Et.REQUEST_NEW_URLS),this.ws.on(Et.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class f0e extends An{set state(r){r!==this._state&&(r!==ta.RELAY_STATE_FAILURE&&(this.errorCode=qp.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,s,c,u){super(),L(this,"joinInfo",void 0),L(this,"sid",void 0),L(this,"clientId",void 0),L(this,"cancelToken",Ui.CancelToken.source()),L(this,"workerToken",void 0),L(this,"requestId",0),L(this,"signal",void 0),L(this,"prevChannelMediaConfig",void 0),L(this,"httpRetryConfig",void 0),L(this,"_resolution",void 0),L(this,"_state",ta.RELAY_STATE_IDLE),L(this,"errorCode",qp.RELAY_OK),L(this,"onStatus",h=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",al.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",al.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=qp.SRC_TOKEN_EXPIRED,this.state=ta.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=qp.DEST_TOKEN_EXPIRED,this.state=ta.RELAY_STATE_FAILURE))}),L(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",al.NETWORK_DISCONNECTED),this.state=ta.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==ta.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",h.toString()),this.errorCode=qp.SERVER_CONNECTION_LOST,this.state=ta.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=Ou(),this.signal=new m0e(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==ta.RELAY_STATE_IDLE)throw new ce(H.INVALID_OPERATION);this.state=ta.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new ce(H.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new ce(H.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new ce(H.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==ta.RELAY_STATE_RUNNING)throw new ce(H.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==ta.RELAY_STATE_RUNNING)throw new ce(H.INVALID_OPERATION);const i=this.genMessage(Bi.SetVideoProfile);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ta.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ui.CancelToken.source(),this.state=ta.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await xve(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",al.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(Bi.SetSdkProfile,r);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Bi.SetSourceChannel,r);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",al.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const c=this.genMessage(Bi.SetSourceUserId,r);await this.signal.request(c),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const u=this.genMessage(Bi.SetDestChannel,r);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",al.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Bi.StartPacketTransfer,r);await this.signal.request(h),this.emit("event",al.PACKET_SENT_TO_DEST_CHANNEL),this.state=ta.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(Bi.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",al.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Bi.StopPacketTransfer);await this.signal.request(r),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const s=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:cs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.2"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case Bi.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Bi.SetSourceChannel:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce(H.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case Bi.SetSourceUserId:if(g=i&&i.getSrcChannelMediaInfo(),!g)throw new ce(H.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case Bi.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new ce(H.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{s.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:u},h;case Bi.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Bi.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Bi.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Bi.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new ce(H.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{s.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:u},h;case Bi.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const g0e={name:"ChannelMediaRelay",create:function(t){return new f0e(t.joinInfo,t.clientId,t.websocketRetryConfig||Yn,t.httpRetryConfig||Yn,t.resolution)}};function t$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Av(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?t$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):t$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class v0e extends An{constructor(r,i,s,c){super(),L(this,"spec",void 0),L(this,"token",void 0),L(this,"websocket",void 0),L(this,"pingpongTimer",void 0),L(this,"reconnectMode","retry"),L(this,"serviceMode",void 0),L(this,"reqId",0),L(this,"commandReqId",0),L(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),L(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):($e.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===il.TRANSCODE?1:2}),this.emit(id.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new Qg("live-streaming",s),this.websocket.on(Et.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Et.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Et.REQUEST_NEW_URLS,(u,h)=>{er(this,id.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Et.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,s,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ce(H.UNEXPECTED_ERROR);const m=Av({command:r,sdkVersion:cs==="4.24.2"?"0.0.1":cs,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new ce(H.WS_DISCONNECT);const g=()=>new ke((S,C)=>{this.websocket.once(Et.CLOSED,()=>C(new ce(H.WS_ABORT))),this.websocket.once(Et.CONNECTED,S)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new ke((S,C)=>{const M=()=>{C(new ce(H.WS_ABORT))};this.websocket.once(Et.RECONNECTING,M),this.websocket.once(Et.CLOSED,M),this.once("@".concat(h,"-").concat(this.spec.sid),D=>{S(D)})});c&&$e.workerEvent(this.spec.sid,Av(Av({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(m);let x=null;try{x=await y}catch(S){if(this.websocket.state==="closed")throw S;return await g(),await this.request(r,i,s)}return c&&$e.workerEvent(this.spec.sid,Av(Av({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(x.serverResponse),serverCode:x.code,success:x.code===200,responseTime:Date.now()-_})),x.code!==200&&this.handleResponseError(x),x}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=cs==="4.24.2"?"0.0.1":cs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case cr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case cr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case cr.LIVE_STREAM_RESPONSE_BAD_STREAM:case cr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ce(H.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ce(H.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new ce(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new ce(H.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ce(H.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new ce(H.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(id.WARNING,i,r.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case cr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ce(H.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch($g)},6e3)}}function n$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ra(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class y0e extends An{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yn,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Yn;super(),L(this,"onLiveStreamWarning",void 0),L(this,"onLiveStreamError",void 0),L(this,"spec",void 0),L(this,"retryTimeout",1e4),L(this,"connection",void 0),L(this,"httpRetryConfig",void 0),L(this,"wsRetryConfig",void 0),L(this,"streamingTasks",new Map),L(this,"isStartingStreamingTask",!1),L(this,"taskMutex",new Rr("live-streaming")),L(this,"cancelToken",Ui.CancelToken.source()),L(this,"transcodingConfig",void 0),L(this,"uapResponse",void 0),L(this,"lastTaskId",1),L(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=s,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=ra(ra({},tve),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>ra(ra(ra({},eve),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){kn(h.width)||ln(h.width,"config.width",0,1e4),kn(h.height)||ln(h.height,"config.height",0,1e4),kn(h.videoBitrate)||ln(h.videoBitrate,"config.videoBitrate",1,1e6),kn(h.videoFrameRate)||ln(h.videoFrameRate,"config.videoFrameRate"),kn(h.lowLatency)||Fs(h.lowLatency,"config.lowLatency"),kn(h.audioSampleRate)||Kn(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kn(h.audioBitrate)||ln(h.audioBitrate,"config.audioBitrate",1,128),kn(h.audioChannels)||Kn(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),kn(h.videoGop)||ln(h.videoGop,"config.videoGop"),kn(h.videoCodecProfile)||Kn(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kn(h.userCount)||ln(h.userCount,"config.userCount",0,17),kn(h.backgroundColor)||ln(h.backgroundColor,"config.backgroundColor",0,16777215),kn(h.userConfigExtraInfo)||Mr(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!kn(h.transcodingUsers)&&(nl(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{zb(m.uid),kn(m.x)||ln(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),kn(m.y)||ln(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),kn(m.width)||ln(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),kn(m.height)||ln(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),kn(m.zOrder)||ln(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),kn(m.alpha)||ln(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),kn(h.watermark)||GA(h.watermark,"watermark"),kn(h.backgroundImage)||GA(h.backgroundImage,"backgroundImage"),h.images&&!kn(h.images)&&(nl(h.images,"config.images"),h.images.forEach((m,g)=>{GA(m,"images[".concat(g,"]"))}))}(i);const s=[];i.images&&s.push(...i.images.map(h=>ra(ra(ra({},BA),h),{},{zOrder:255}))),i.backgroundImage&&(s.push(ra(ra(ra({},BA),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(s.push(ra(ra(ra({},BA),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=s,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>ra({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?ke.resolve(h.uid):x8(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ke.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ya(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(r,i,s){if(!this.transcodingConfig&&i===il.TRANSCODE)throw new ce(H.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(r)&&!s)return u(),new ce(H.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case il.TRANSCODE:c.transcodingConfig=ra({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ke((y,_)=>{yr(this.retryTimeout).then(()=>{if(s)return _(s);const x=this.statusError.get(r);return x?(this.statusError.delete(r),_(x)):void 0})}),g=await ke.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===il.TRANSCODE?1:2,requestByUser:!s,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||s)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new ke((i,s)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ce(H.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===il.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(s)})}resetAllTask(){var r;const i=Array.from(ya(r=this.streamingTasks).call(r));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ui.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ce(H.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await er(this,WA.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new v0e(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(id.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(id.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(id.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new ce(H.UNEXPECTED_ERROR,"can not get new live streaming address list"));er(this,WA.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=r.reason;switch(r.code){case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ce(H.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(s)return R.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ce(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(ya(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new ce(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{R.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const _0e={name:"LiveStreaming",create:function(t){return new y0e(t.joinInfo,t.websocketRetryConfig||Yn,t.httpRetryConfig||Yn)}};function b0e(t){let r=a$();return function(i,s){let c=i.appId;c!==void 0&&(rn(s,10),Ac(s,c));let u=i.cid;u!==void 0&&(rn(s,16),rn(s,u));let h=i.cname;h!==void 0&&(rn(s,26),Ac(s,h));let m=i.deviceId;m!==void 0&&(rn(s,34),Ac(s,m));let g=i.elapse;g!==void 0&&(rn(s,40),vd(s,g));let y=i.fileSize;y!==void 0&&(rn(s,48),vd(s,pm(y)));let _=i.height;_!==void 0&&(rn(s,56),vd(s,pm(_)));let x=i.jpg;x!==void 0&&(rn(s,66),rn(s,x.length),function(Nn,ve){let Pe=mm(Nn,ve.length);Nn.bytes.set(ve,Pe)}(s,x));let S=i.networkType;S!==void 0&&(rn(s,72),vd(s,pm(S)));let C=i.osType;C!==void 0&&(rn(s,80),vd(s,pm(C)));let M=i.requestId;M!==void 0&&(rn(s,90),Ac(s,M));let D=i.sdkVersion;D!==void 0&&(rn(s,98),Ac(s,D));let j=i.sequence;j!==void 0&&(rn(s,104),vd(s,pm(j)));let $=i.sid;$!==void 0&&(rn(s,114),Ac(s,$));let K=i.timestamp;K!==void 0&&(rn(s,120),vd(s,K));let J=i.uid;J!==void 0&&(rn(s,128),rn(s,J));let ne=i.vid;ne!==void 0&&(rn(s,136),rn(s,ne));let ae=i.width;ae!==void 0&&(rn(s,144),vd(s,pm(ae)));let Q=i.service;Q!==void 0&&(rn(s,152),rn(s,Q));let oe=i.callbackData;oe!==void 0&&(rn(s,162),Ac(s,oe));let ge=i.jpgEncryption;ge!==void 0&&(rn(s,168),rn(s,ge));let Ee=i.requestType;Ee!==void 0&&(rn(s,176),rn(s,Ee));let Fe=i.scorePorn;Fe!==void 0&&(rn(s,185),rO(s,Fe));let ht=i.scoreSexy;ht!==void 0&&(rn(s,193),rO(s,ht));let ot=i.scoreNeutral;ot!==void 0&&(rn(s,201),rO(s,ot));let wt=i.scene;wt!==void 0&&(rn(s,208),rn(s,wt));let _t=i.ossFilePrefix;_t!==void 0&&(rn(s,218),Ac(s,_t));let qt=i.serviceVendor;if(qt!==void 0)for(let Nn of qt){rn(s,226);let ve=a$();S0e(Nn,ve),rn(s,ve.limit),N0e(s,ve),C0e(ve)}}(t,r),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(r)}function E0e(t){return function(i){let s={};e:for(;!s$(i);){let c=Ic(i);switch(c>>>3){case 0:break e;case 1:s.code=Ic(i);break;case 2:s.msg=o$(i,Ic(i));break;case 3:{let u=w0e(i);s.data=x0e(i),i.limit=u;break}default:r$(i,7&c)}}return s}({bytes:r=t,offset:0,limit:r.length});var r}function x0e(t){let r={};e:for(;!s$(t);){let i=Ic(t);switch(i>>>3){case 0:break e;case 1:r.requestId=o$(t,Ic(t));break;case 2:r.requestType=Ic(t)>>>0;break;case 3:r.scorePorn=nO(t);break;case 4:r.scoreSexy=nO(t);break;case 5:r.scoreNeutral=nO(t);break;case 6:r.requestScene=Ic(t)>>>0;break;case 7:r.scene=Ic(t)>>>0;break;default:r$(t,7&i)}}return r}function S0e(t,r){let i=t.service;i!==void 0&&(rn(r,8),rn(r,i));let s=t.vendor;s!==void 0&&(rn(r,16),rn(r,s));let c=t.token;c!==void 0&&(rn(r,26),Ac(r,c));let u=t.callbackUrl;u!==void 0&&(rn(r,34),Ac(r,u))}function w0e(t){let r=Ic(t),i=t.limit;return t.limit=t.offset+r,i}function r$(t,r){switch(r){case 0:for(;128&c$(t););break;case 2:eO(t,Ic(t));break;case 5:eO(t,4);break;case 1:eO(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let T0e=new Float32Array(1);new Uint8Array(T0e.buffer);let ZI=new Float64Array(1),ia=new Uint8Array(ZI.buffer);function pm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let i$=[];function a$(){const t=i$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function C0e(t){i$.push(t)}function eO(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function s$(t){return t.offset>=t.limit}function mm(t,r){let i=t.bytes,s=t.offset,c=t.limit,u=s+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),s}function tO(t,r){let i=t.offset;if(i+r>t.limit)throw new Error("Read past limit");return t.offset+=r,i}function o$(t,r){let i=tO(t,r),s=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let g,y,_,x,S=c[m+i];128&S?(224&S)==192?m+1>=r?h+=u:(g=c[m+i+1],(192&g)!=128?h+=u:(x=(31&S)<<6|63&g,x<128?h+=u:(h+=s(x),m++))):(240&S)==224?m+2>=r?h+=u:(g=c[m+i+1],y=c[m+i+2],(49344&(g|y<<8))!=32896?h+=u:(x=(15&S)<<12|(63&g)<<6|63&y,x<2048||x>=55296&&x<=57343?h+=u:(h+=s(x),m+=2))):(248&S)==240?m+3>=r?h+=u:(g=c[m+i+1],y=c[m+i+2],_=c[m+i+3],(12632256&(g|y<<8|_<<16))!=8421504?h+=u:(x=(7&S)<<18|(63&g)<<12|(63&y)<<6|63&_,x<65536||x>1114111?h+=u:(x-=65536,h+=s(55296+(x>>10),56320+(1023&x)),m+=3))):h+=u:h+=s(S)}return h}function Ac(t,r){let i=r.length,s=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}rn(t,s);let c=mm(t,s),u=t.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function N0e(t,r){let i=mm(t,r.limit),s=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)s[u+i]=c[u]}function c$(t){return t.bytes[tO(t,1)]}function l$(t,r){let i=mm(t,1);t.bytes[i]=r}function nO(t){let r=tO(t,8),i=t.bytes;return ia[0]=i[r++],ia[1]=i[r++],ia[2]=i[r++],ia[3]=i[r++],ia[4]=i[r++],ia[5]=i[r++],ia[6]=i[r++],ia[7]=i[r++],ZI[0]}function rO(t,r){let i=mm(t,8),s=t.bytes;ZI[0]=r,s[i++]=ia[0],s[i++]=ia[1],s[i++]=ia[2],s[i++]=ia[3],s[i++]=ia[4],s[i++]=ia[5],s[i++]=ia[6],s[i++]=ia[7]}function Ic(t){let r,i=0,s=0;do r=c$(t),i<32&&(s|=(127&r)<<i),i+=7;while(128&r);return s}function rn(t,r){for(r>>>=0;r>=128;)l$(t,127&r|128),r>>>=7;l$(t,r)}function vd(t,r){let i=r.low>>>0,s=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?s===0?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=mm(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?s>>>21|128:s>>>21&127;case 7:m[h+6]=u!==7?s>>>14|128:s>>>14&127;case 6:m[h+5]=u!==6?s>>>7|128:s>>>7&127;case 5:m[h+4]=u!==5?128|s:127&s;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function d$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}const R0e=new Map([["moderation",1],["supervise",2]]);class A0e extends An{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Ir.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=ss(i=r.map(s=>R0e.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),L(this,"name","AgoraRTCVideoContentInspect"),L(this,"_connectionState",$s.CONNECTING),L(this,"_innerConnectionState",void 0),L(this,"sequence",0),L(this,"inspectStartTime",void 0),L(this,"workerManagerConnection",void 0),L(this,"workerConnection",void 0),L(this,"workerMessageLengthLimit",void 0),L(this,"inspectIntervalMinimum",void 0),L(this,"qualityRatio",void 0),L(this,"_connectInfo",void 0),L(this,"_cancelTokenSource",Ui.CancelToken.source()),L(this,"_retryConfig",void 0),L(this,"wmSequence",0),L(this,"inspectInterval",void 0),L(this,"inspectTimer",null),L(this,"ossFilePrefix",void 0),L(this,"extraInfo",void 0),L(this,"_inspectType",void 0),L(this,"_inspectMode",void 0),L(this,"_quality",1),L(this,"qualityTimer",null),L(this,"_inspectId",void 0),L(this,"_needWorkUrlOnly",!1),L(this,"inspectImage",()=>{if(this.connectionState!==$s.CONNECTED)throw new ce(H.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===$s.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=en(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qg("worker-manager-"+this._inspectId,Yn),this.on(Ir.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Hs[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qg("worker-"+this._inspectId,Yn),this.handleWorkerEvents()}async init(r,i){this.emit(Ir.STATE_CHANGE,Hs.CONNECT_AP),this._connectInfo=r;const s=this._cancelTokenSource.token;return this._retryConfig=i,new ke((c,u)=>{this.on(Ir.CONNECTION_STATE_CHANGE,(h,m)=>{m===$s.CONNECTED&&c()}),this.requestAP(r,s,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,s){const c=G("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,g,y,_){let{appId:x,areaCode:S,cname:C,sid:M,token:D,uid:j}=g;tm++;const $="image_moderation_api",K={service_name:$,json_body:JSON.stringify({appId:x,areaCode:S,cname:C,command:"allocateEdge",requestId:tm,seq:tm,sid:M,token:D,ts:Date.now(),uid:j+""})};let J,ne,ae=m[0];return Ro(async()=>{J=Date.now();const Q=await ko(ae,{data:K,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ne=Date.now()-J,Q.code!==0){const ot=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:ne});throw R.error(ot.toString()),ot}const oe=JSON.parse(Q.json_body);if(oe.code!==200){const ot=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(oe.code,", reason: ").concat(oe.reason),{code:oe.code,responseTime:ne});throw R.error(ot.toString()),ot}if(!oe.servers||!Array.isArray(oe.servers)||oe.servers.length===0){const ot=new ce(H.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:oe.code,responseTime:ne});throw R.error(ot.toString()),ot}const ge=G("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ge)return{addressList:[ge],workerToken:oe.workerToken,vid:oe.vid,responseTime:ne};const Ee=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Fe=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:oe.servers.map(ot=>{let{address:wt,wss:_t}=ot;if(wt&&_t)return"wss://".concat(wt.replace(/\./g,"-"),".").concat(Ee,":").concat(Fe||_t)}).filter(ot=>!!ot),workerToken:oe.workerToken,vid:oe.vid,responseTime:ne}},(Q,oe)=>($e.apworkerEvent(M,{success:!0,sc:200,serviceName:$,responseDetail:JSON.stringify(Q.addressList),firstSuccess:oe===0,responseTime:ne,serverIp:m[oe%m.length]}),!1),(Q,oe)=>($e.apworkerEvent(M,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:$,responseTime:ne,serverIp:m[oe%m.length]}),!!(Q.code!==H.OPERATION_ABORTED&&Q.code!==H.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(ae=m[(oe+1)%m.length],!0)),_)}(c,r,i,s);this.emit(Ir.STATE_CHANGE,Hs.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Ir.STATE_CHANGE,Hs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Et.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,Hs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Et.CLOSED,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Et.FAILED,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Et.RECONNECTING,()=>{this._innerConnectionState<Hs.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Et.ON_MESSAGE,async r=>{this.emit(Ir.STATE_CHANGE,Hs.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(r.data);if(s.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new ce(H.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&i))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new ce(H.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=G("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Ir.STATE_CHANGE,Hs.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Ir.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Et.WILL_RECONNECT,(r,i,s)=>{s(r)}),this.workerManagerConnection.on(Et.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Et.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,Hs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=$s.CONNECTED}),this.workerConnection.on(Et.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=E0e(new Uint8Array(r.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ir.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var i;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=ss(i=Object.keys(c)).call(i,(m,g)=>c[m]>c[g]?m:g,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Ir.INSPECT_RESULT,h)}else this.emit(Ir.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(Ir.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ir.INSPECT_RESULT,void 0,new ce(H.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Et.CLOSED,()=>{this.connectionState=$s.CLOSED}),this.workerConnection.on(Et.FAILED,()=>{this.connectionState=$s.CLOSED}),this.workerConnection.on(Et.RECONNECTING,()=>{this.connectionState=this.connectionState===$s.CONNECTED?$s.RECONNECTING:$s.CONNECTING}),this.workerConnection.on(Et.WILL_RECONNECT,(r,i,s)=>{r==="recover"&&s(r),s("tryNext")}),this.workerConnection.on(Et.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(Ir.REQUEST_NEW_WORKER_URL,s=>{r([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{i(s)})})}async requestToInspectImage(){this.sequence++;const r=Ea(this,Ir.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Ir.INSPECT_RESULT,void 0,new ce(H.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(r,i);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(Ir.INSPECT_RESULT,void 0,new ce(H.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:s,cname:c,cid:u,vid:h,sid:m,uid:g}=i;const y=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),x=await FV(_,s,c),S=this.sequence+"-"+u+"-"+g+"-"+y+"-"+en(12,""),C={appId:s,cid:u,cname:c,deviceId:"",elapse:(M=Number(y-this.inspectStartTime),{low:M|=0,high:M>>31,unsigned:M>=0}),fileSize:x.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:x,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.2",sequence:this.sequence,sid:m,timestamp:mG(y),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var M;this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;const D=b0e(C);if(D.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function($){for(var K=1;K<arguments.length;K++){var J=arguments[K]!=null?arguments[K]:{};K%2?d$(Object(J),!0).forEach(function(ne){L($,ne,J[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(J)):d$(Object(J)).forEach(function(ne){Object.defineProperty($,ne,Object.getOwnPropertyDescriptor(J,ne))})}return $}({},C);delete j.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return D}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:s,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ui.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$s.CLOSED,this.emit(Ir.STATE_CHANGE,Hs.CLOSED)}}const I0e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(i){if(!i)throw new ce(H.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new ce(H.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(i.inspectType)];s.forEach(c=>{var u;if(!Re(u=["supervise","moderation"]).call(u,c))throw new ce(H.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=s}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new ce(H.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new A0e(r)}};var u$=d(zt.Object.getOwnPropertySymbols),O0e=Zt,P0e=JT.indexOf,D0e=z0,iO=ie([].indexOf),h$=!!iO&&1/iO([1],1,-0)<0;O0e({target:"Array",proto:!0,forced:h$||!D0e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return h$?iO(this,t,r)||0:P0e(this,t,r)}});var k0e=as("Array","indexOf"),j0e=N,L0e=k0e,aO=Array.prototype,M0e=function(t){var r=t.indexOf;return t===aO||j0e(aO,t)&&r===aO.indexOf?L0e:r},p$=d(M0e);function U0e(t,r){if(t==null)return{};var i,s,c=function(h,m){if(h==null)return{};var g={};for(var y in h)if({}.hasOwnProperty.call(h,y)){if(p$(m).call(m,y)!==-1)continue;g[y]=h[y]}return g}(t,r);if(u$){var u=u$(t);for(s=0;s<u.length;s++)i=u[s],p$(r).call(r,i)===-1&&{}.propertyIsEnumerable.call(t,i)&&(c[i]=t[i])}return c}let m$=class{get localCapabilities(){return xn(this._localCapabilities)}get rtpCapabilities(){return xn(this._rtpCapabilities)}get candidates(){return xn(this._candidates)}get iceParameters(){return xn(this._iceParameters)}get dtlsParameters(){return xn(this._dtlsParameters)}constructor(t){L(this,"sessionDesc",void 0),L(this,"_localCapabilities",void 0),L(this,"_rtpCapabilities",void 0),L(this,"_candidates",void 0),L(this,"_iceParameters",void 0),L(this,"_dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname","o/i14u9pJrxRKAsu"),L(this,"firefoxSsrcMidMap",new Map),t=xn(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:g,audioCodec:y}=t;let _;this.setup=m,_=h===Ai.RECEIVE_ONLY?Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const x=h===Ai.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=h===Ai.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=h===Ai.RECEIVE_ONLY?c.send.videoCodecs:iv(Ge.VIDEO,x,S,g),M=h===Ai.RECEIVE_ONLY?c.send.audioCodecs:iv(Ge.AUDIO,x,S,y);for(const D of _.mediaDescriptions)D.attributes.iceUfrag=r.iceUfrag,D.attributes.icePwd=r.icePwd,D.attributes.fingerprints=i.fingerprints,D.attributes.candidates=s,D.attributes.setup=this.setup,D.media.mediaType==="application"&&(D.attributes.sctpPort="5000"),D.media.mediaType==="video"&&(D.media.fmts=C.map(j=>j.payloadType.toString(10)),D.attributes.payloads=C,D.attributes.extmaps=x.videoExtensions),D.media.mediaType==="audio"&&(D.media.fmts=M.map(j=>j.payloadType.toString(10)),D.attributes.payloads=M,D.attributes.extmaps=x.audioExtensions,em(D));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return rl(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,i,s,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=nv(r,this.cname,G("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(En()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,u,s);let y;return g===-1?(y=this.createOrRecycleSendMedia(t,u,h,"sendonly",s,c),this.updateBundleMids()):(y=xn(this.sessionDesc.mediaDescriptions[g]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(y,c)),En()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,i){const s=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=xn(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),s.push({mid:m.attributes.mid,needCreateTransceiver:g})}),s}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:i,address:s,port:c,type:u,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(t),y={foundation:r??"",componentId:"1",transport:i??"",priority:g?g+"":"",connectionAddress:s??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(_=>_.priority===y.priority&&_.connectionAddress===y.connectionAddress&&_.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,i,s,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=iv(u,h,this.localCapabilities.send,u===Ge.AUDIO?c:s),g=u===Ge.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let _={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};_=this.mungRecvMediaDsec(_,t);const x=this.findFirstClosedMedia(u);if(x){const S=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Re(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(i=>Re(t).call(t,i.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===t&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(En()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return c&&s.attributes.mid===i})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(t){t=xn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,i,s,c,u){const h=this.rtpCapabilities.send,m=t===Ge.VIDEO?h.videoCodecs:h.audioCodecs,g=t===Ge.VIDEO?h.videoExtensions:h.audioExtensions;En()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const _=this.findFirstClosedMedia(t);if(_){const x=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[x]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(t,r,i){const s=xn(t);return JA(s),$u(s,r),QA(s,r),i8(s),tE(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,r){const i=xn(t);return tE(i,r,this.localCapabilities.recv),em(i),i}updateRecvMedia(t,r){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>En()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const F0e=["sdp"];var Sn;function f$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function yd(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?f$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let g$=(Sn=class Sm extends V6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,s){super(r,i),L(this,"direction",void 0),L(this,"name",void 0),L(this,"store",void 0),L(this,"spec",void 0),L(this,"peerConnection",void 0),L(this,"initialOffer",void 0),L(this,"transport",void 0),L(this,"statsFilter",void 0),L(this,"localCandidateCount",0),L(this,"_isInRestartIce",!1),L(this,"mutex",void 0),L(this,"onLocalCandidate",void 0),L(this,"remoteSDP",void 0),L(this,"pendingCandidates",[]),L(this,"localCapabilities",void 0),L(this,"isReady",!1),L(this,"restartCnt",0),L(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Sm.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Ai.SEND_ONLY,this.name=this.direction===Ai.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Sb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await eI();if(this.localCapabilities=rv(i),r){const{sdp:s}=r,c=U0e(r,F0e),u=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},x=tv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ks(x,_,"videoExtensions",S,C,M),Ks(x,_,"videoCodecs",S,C,M),Ks(x,_,"audioExtensions",S,C,M),Ks(x,_,"audioCodecs",S,C,M),G("RAISE_H264_BASELINE_PRIORITY")){const D=M.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(D!==-1){const j=M.videoCodecs.findIndex($=>$.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<D){R.debug("raising H264 baseline profile priority");const $=M.videoCodecs[D];M.videoCodecs.splice(D,1),M.videoCodecs.splice(j,0,$)}j!==-1&&G("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter($=>!($.rtpMap&&$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&$.fmtp&&$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:C,sendrecv:M}}({},{},s);this.remoteSDP=new m$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Ec(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await s8({},{},h.sdp);this.localCapabilities=rv(g);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),yd(yd({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ec(s.sdp);return this.initialOffer=s,yd(yd({},c),{},{sdp:s.sdp})}}catch(i){throw new he(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:s,dtlsParameters:c}=r,u=await s8({},{},i);this.remoteSDP=new m$({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new he(H.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Mi(function*(){const u=yield Tt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,s);r.forEach((j,$)=>{if(m[$].needCreateTransceiver){const K=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(K),j._updateRtpTransceiver(K)}else{const K=c.peerConnection.getTransceivers().find(J=>J.mid===m[$].mid);if(!K)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[$].mid));h.push(K),j._updateRtpTransceiver(K)}}),En()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=m.map(j=>j.mid),y=yield Tt(c.peerConnection.createOffer()),_=c.mungSendOfferSDP(y.sdp,r,g),x=Ci(_),S=g.map(j=>{const $=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return XA($,G("USE_PUB_RTX"))}),C=h.map((j,$)=>{const K=g[$];return{localSSRC:S[$],id:K}});yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield C}catch(j){const $=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Tt(c.stopSending(g,!0)),j}yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r));const M=c.remoteSDP.toString(),D=c.logSDPExchange(_,"offer","local","send");return D==null||D(M),yield Tt(c.setRemoteDescription({type:"answer",sdp:M})),h.map((j,$)=>{const K=g[$];return{localSSRC:S[$],id:K}})}catch(h){throw h instanceof he?h:new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var y;g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);if(h){const g=this.remoteSDP.toString(),y=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const _=await this.peerConnection.createAnswer(),x=this.mungReceiveAnswerSDP(_.sdp,u,r);y==null||y(x||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:x}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(y.sdp,u,r);g==null||g(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Pu.Auto&&(this.store.p2pTransport=Pu.SdRtn,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,It().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Sm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=Ec(i.sdp);return this.store.descriptionStart(),this.direction===Ai.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Ai.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=Ec(i.sdp);return await this.peerConnection.setLocalDescription(i),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new he(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?En()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:yd(yd({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:yd(yd({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;Re(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Cu(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...Sm.turnServerConfigToIceServers(r.turnServer.servers,i,s)),G("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...Sm.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,s)),Re(u=[Pu.Relay,Pu.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),R.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);R.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));const h=u.length>s?u[s]:u[0];switch(i){case Pu.SdRtn:const m=r.filter(y=>{var _;return Re(_=y.username).call(_,"glb:")&&y.turnServerURL==y.turnServerURL}),g=m.length>s?m[s]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(zs(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(zs(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Pu.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zs(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(zs(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var s;r!=null&&r.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,r.state))},r.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const s=r==null?void 0:r.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:c}=i.getSelectedCandidatePair()||{};if(s&&c){const u=s.address+":"+s.port,h=c.address+":"+c.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(u)),", remote ").concat(JSON.stringify(bc(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(_=>_.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:_,frameRate:x,scaleResolutionDownBy:S}=r._encoderConfig;_&&(u.maxBitrate=1e3*_),Re(h=r._hints).call(h,Qt.LOW_STREAM)&&(x&&(u.maxFramerate=Gi(x)),S&&S>=1&&(u.scaleResolutionDownBy=S))}if(G("DSCP_TYPE")&&fc()){var m;const _=G("DSCP_TYPE");Re(m=["very-low","low","medium","high"]).call(m,_)&&(u.networkPriority=_)}const g=i.getParameters(),y=(s=g.encodings)===null||s===void 0?void 0:s[0];En()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(g,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await i.setParameters(g)}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof un&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ci(r);return i.forEach((u,h)=>{const m=s[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&($u(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,m;const y=r[g],_=i[g];if(_ instanceof un&&!Re(s=_._hints).call(s,Qt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=y.sender.getParameters();await y.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!En()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof un&&this.isVP8Simulcast(c)){const u=r[s],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof un&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Re(i=r._hints).call(i,Qt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var s;if(i=i??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var c;const u=(c=Ci(i).mediaDescriptions.find(h=>h.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),Re(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,s){const c=Ci(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&s===Ge.AUDIO&&u.media.mediaType==="audio"&&em(u),rl(c)}},je(Sn.prototype,"establish",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"establish"),Sn.prototype),je(Sn.prototype,"connect",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"connect"),Sn.prototype),je(Sn.prototype,"receive",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"receive"),Sn.prototype),je(Sn.prototype,"mockReceive",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"mockReceive"),Sn.prototype),je(Sn.prototype,"stopReceiving",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"stopReceiving"),Sn.prototype),je(Sn.prototype,"restartICE",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"restartICE"),Sn.prototype),je(Sn.prototype,"close",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"close"),Sn.prototype),je(Sn.prototype,"updateEncoderConfig",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"updateEncoderConfig"),Sn.prototype),je(Sn.prototype,"updateSendParameters",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"updateSendParameters"),Sn.prototype),je(Sn.prototype,"replaceTrack",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"replaceTrack"),Sn.prototype),je(Sn.prototype,"muteLocal",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"muteLocal"),Sn.prototype),je(Sn.prototype,"unmuteLocal",[Qs],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteLocal"),Sn.prototype),Sn);function Qs(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}let Mo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var v$,y$,_$,b$,E$,x$,S$,w$,T$,C$,N$,In;function R$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function ME(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?R$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let V0e=(v$=Uo(Mo.SEND_ONLY),y$=Uo(Mo.SEND_ONLY),_$=Uo(),b$=Uo(Mo.RECEIVE_ONLY),E$=Uo(Mo.RECEIVE_ONLY),x$=Uo(Mo.RECEIVE_ONLY),S$=Uo(Mo.RECEIVE_ONLY),w$=Uo(Mo.RECEIVE_ONLY),T$=Uo(Mo.RECEIVE_ONLY),C$=Uo(),N$=Uo(Mo.RECEIVE_ONLY),In=class extends An{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Je.StateChange,r,this._state)}constructor(t,r){super(),L(this,"isPlanB",!1),L(this,"store",void 0),L(this,"statsUploader",void 0),L(this,"sendConnection",void 0),L(this,"recvConnection",void 0),L(this,"localTrackMap",new Map),L(this,"remoteUserMap",new Map),L(this,"localDataChannels",[]),L(this,"pendingLocalTracks",[]),L(this,"pendingRemoteTracks",[]),L(this,"statsCollector",void 0),L(this,"dtlsFailedCount",0),L(this,"sendMutex",void 0),L(this,"recvMutex",void 0),L(this,"_state",Jt.Disconnected),L(this,"_restartStates",["disconnected","failed"]),L(this,"reconnectInterval",void 0),L(this,"uploadUnplinkStarted",!1),L(this,"uploadDownlinkStarted",!1),L(this,"uplinkStateUploadInterval",void 0),L(this,"downlinkStatsUploadInterval",void 0),L(this,"handleMuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void c(new he(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(i);if(g.length===0)return void s();const y=g.find(C=>C[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(C=>{let[,{id:M}]=C;return M}));let _=!1;var h,m;i.trackMediaType==="video"?_=!((h=this.localTrackMap.get(Ae.LocalAudioTrack))===null||h===void 0||!h.track._muted):_=((m=this.localTrackMap.get(Ae.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const x=this.createMuteMessage(g);await fn(this,Je.RequestMuteLocal,x);const S=i.trackMediaType==="video"?sd.MUTE_LOCAL_VIDEO:sd.MUTE_LOCAL_AUDIO;await fn(this,Je.RequestP2PMuteLocal,{action:S,message:x,isMuteAll:_}),s()}catch(g){c(g)}finally{u()}}),L(this,"handleUnmuteLocalTrack",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jt.Connected)return void c(new he(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:_}]=y;return _}));const m=this.createUnmuteMessage(h),g=i.trackMediaType==="video"?sd.UNMUTE_LOCAL_VIDEO:sd.UNMUTE_LOCAL_AUDIO;await fn(this,Je.RequestP2PMuteLocal,{action:g,message:m}),s()}catch(h){c(h)}finally{u()}}),L(this,"handleUpdateVideoEncoder",async(i,s,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==Jt.Connected)return void s();const{id:y,track:_}=g;y&&(await this.sendConnection.updateSendParameters(y,_),await this.sendConnection.updateEncoderConfig(y,_),this.emit(Je.UpdateVideoEncoder,_)),s()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),L(this,"handleUpdateVideoSendParameters",async(i,s,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Jt.Connected)return void s();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),s()}catch(h){c(h)}finally{u()}}),L(this,"handleReplaceTrack",async(i,s,c,u)=>{let h;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:x}]=_;return i===x});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Jt.Connected)return void s();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===Ae.LocalVideoTrack&&It().supportDualStreamEncoding){const _=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(_){const x=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=x,_.track._originMediaStreamTrack=x,await new ke((S,C)=>{this.handleReplaceTrack(_.track,S,C,!0)})}}s()}catch(y){c(y)}finally{var g;(g=h)===null||g===void 0||g()}}),L(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),L(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),L(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),L(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new G8(t),this.bindStatsUploaderEvents(),this.sendMutex=new Rr("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Rr("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new he(H.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new he(H.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let i;try{if(r){this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new g$(t,this.store,Ai.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(r);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Jt.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new g$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{i&&i()}}async p2pConnect(t){if(!this.sendConnection)throw new he(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jt.Connected}async addRemoteCandidate(t,r){if(r===Ai.RECEIVE_ONLY){if(!this.sendConnection)throw new he(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new he(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,i){var s=this;return Mi(function*(){const c=yield Tt(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Jt.Connected){s.throwIfTrackTypeNotMatch(t);const y=t.filter(_=>s.pendingLocalTracks.indexOf(_)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(y))}s.store.pubId=s.store.pubId+1,Zr.markPublishStart(s.store.clientId,s.store.pubId);const u=s.filterTobePublishedTracks(t,r,i);if(u.length===0)return void(yield Tt(s.tryToUnmuteAudio(t)));u.forEach(y=>{let{track:_,type:x}=y;const S=Date.now();s.store.publish(_.getTrackId(),x===Ae.LocalAudioTrack?"audio":"video",S)}),s.bindLocalTrackEvents(u);const h=yield Tt(s.sendConnection.send(u.map(y=>{let{track:_}=y;return _}),s.store.codec,s.store.audioCodec)),m=(yield Tt(h.next())).value,g=s.createGatewayPublishMessage(u,m);try{yield g}catch(y){throw h.throw(y),(y==null?void 0:y.code)===H.WS_ABORT&&u.forEach(_=>{let{track:x}=_;s.pendingLocalTracks.indexOf(x)===-1&&s.pendingLocalTracks.push(x)}),s.unbindLocalTrackEvents(u),y}yield Tt(h.next()),u.forEach(y=>{let{type:_}=y;s.statsCollector.addLocalStats(_)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,m),u.forEach(y=>{let{track:_,type:x}=y;const S=Date.now();s.store.publish(_.getTrackId(),x===Ae.LocalAudioTrack?"audio":"video",void 0,S)}),s.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Jt.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!Re(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jt.Connected)return i&&i[1].track.close(),s;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[c,{track:u,ssrcs:h}]=s;const m={stream_type:Rve(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(s=>{fn(this,Je.RequestMuteLocal,[s])}),i.length>0&&i.forEach(s=>{fn(this,Je.RequestUnmuteLocal,[s])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Mi(function*(){throw new he(H.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,Je.RequestRePublish,this.pendingLocalTracks),this.emit(Je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new he(H.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,i,s){var c;if(!this.recvConnection)throw new he(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(t.uid),s);r===Ge.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new zp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new Hp(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(_=>{let{user:x,kind:S}=_;return x.uid===t.uid&&r===S});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Je.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,i,s){if(!this.recvConnection)throw new he(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(t.uid),s)}async unsubscribe(t,r,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(s.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||s.forEach(u=>{let{kind:h}=u;var m;if(h===Ge.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===Ge.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var g,y;if(m===Ge.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Ge.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===Ge.AUDIO){var _;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((_=h._audioTrack)===null||_===void 0||_._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;fn(this,Je.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[Ge.VIDEO,Ge.AUDIO].forEach(s=>{i.has(s)?fn(this,Je.RequestP2PUnmuteRemote,s):fn(this,Je.RequestP2PMuteRemote,s)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new he(H.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new he(H.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new he(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new he(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(r))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const s=r===Ge.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(r)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ae.LocalAudioTrack);if((r==null?void 0:r.track)instanceof or){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return c!==Ae.LocalAudioTrack}).filter(s=>{let[c]=s;return!(t&&c===Ae.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Ae.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,r,i,s,c){if(t){const h=this.localTrackMap.get(Ae.LocalAudioTrack),m=s?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Qt.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(g=>g instanceof Vn),m=s?(u=this.localTrackMap.get(Ae.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(g=>g instanceof un);$e.publish(this.store.sessionId,{eventElapse:Zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Qt.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,i,s){const c=s===Ge.VIDEO?i._videoSSRC:i._audioSSRC;c&&$e.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===Ge.VIDEO,audio:s===Ge.AUDIO,peerid:i.uid,subscribeRequestid:s===Ge.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zr.measureFromSubscribeStart(this.store.clientId,c)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Rr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Rr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof or){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jt.Disconnected}getStats(t){var r,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ae.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ae.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof un||r&&r.track instanceof Vn?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r;const i=Array.from(si(r=this.remoteUserMap).call(r)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ae.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=gu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[i,{track:s}]=t;switch(i){case Ae.LocalVideoTrack:Re(r=s._hints).call(r,Qt.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Ae.LocalAudioTrack:s instanceof or?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Ae.LocalVideoLowTrack:}}),this.emit(Je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;Array.from(si(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(r,s)}),this.emit(Je.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:c}=i;if((t instanceof ld?t.uid:t)===s.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let i,s;if(t===Ai.SEND_ONLY){if(!this.sendConnection)throw new he(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new he(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(r){const c=await s.restartICE(r);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const u=await er(this,Je.RequestP2PRestartICE,{direction:Ai.RECEIVE_ONLY,iceParameter:c});await s.restartICE(u),s.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ae.LocalVideoTrack),i=this.localTrackMap.get(Ae.LocalAudioTrack),s=t.videoSend.find(C=>{var M;return C.ssrc===(r==null||(M=r.ssrcs)===null||M===void 0?void 0:M[0].ssrcId)}),c=t.audioSend.find(C=>{var M;return C.ssrc===(i==null||(M=i.ssrcs)===null||M===void 0?void 0:M[0].ssrcId)});if(!s||!c)return 1;const u=Ea(this,Je.NeedSignalRTT),h=s?s.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,_=100*t.sendPacketLossRate*.7/50+.3*y/1500,x=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=r==null?void 0:r.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qt.SCREEN_TRACK)===-1){const C=S._encoderConfig.bitrateMax,M=t.bitrate.actualEncoded;if(C&&M){const D=(1e3*C-M)/(1e3*C);return P6[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][x]}}return x}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const c=s._audioSSRC,u=s._videoSSRC,h=t.audioRecv.find(M=>M.ssrc===c),m=t.videoRecv.find(M=>M.ssrc===u);if(!h&&!m)return void(r+=1);const g=Ea(this,Je.NeedSignalRTT),y=t.rtt,_=(y&&g?(y+g)/2:y||g)||0,x=h?h.jitterMs:void 0,S=t.recvPacketLossRate;let C=.7*S*100/50+.3*_/1500;x&&(C=.6*S*100/50+.2*_/1500+.2*x/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ke((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}filterTobePublishedTracks(t,r,i){const s=[],c=It(),u=this.getAllTracks();t=Pp(t=t.filter(g=>u.indexOf(g)===-1));let h=!1,m=!1;for(const g of t){if(g instanceof un&&(this.localTrackMap.has(Ae.LocalVideoTrack)||h?new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:Ae.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(g,i);s.push({track:y,type:Ae.LocalVideoLowTrack})}if(g instanceof Vn){const y=this.localTrackMap.get(Ae.LocalAudioTrack);if(y){if(!(y.track instanceof or))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const _=s.find(x=>{let{type:S}=x;return S===Ae.LocalAudioTrack});if(!(_.track instanceof or))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof or||g._bypassWebAudio)s.push({track:g,type:Ae.LocalAudioTrack});else{const _=new or;_.addAudioTrack(g),s.push({track:_,type:Ae.LocalAudioTrack})}m=!0}}}return s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Pp(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Vn){const c=this.localTrackMap.get(Ae.LocalAudioTrack);if(!c)continue;c.track instanceof or?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(r.push([Ae.LocalAudioTrack,c]),c.track.close())):r.push([Ae.LocalAudioTrack,c])}if(s instanceof un){const c=this.localTrackMap.get(Ae.LocalVideoTrack);if(!c)continue;r.push([Ae.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ae.LocalVideoLowTrack);u&&r.push([Ae.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ae.LocalVideoTrack:i.addListener(He.GET_STATS,this.handleGetLocalVideoStats),i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof or?t.trackList.forEach(i=>{i.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(He.GET_STATS,this.handleGetLocalAudioStats),i.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(He.GET_STATS,this.handleGetLocalAudioStats),t.addListener(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(He.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:s}]=r;return{track:s,type:i}})),t.forEach(r=>{let{track:i,type:s}=r;switch(s){case Ae.LocalVideoTrack:i.off(He.GET_STATS,this.handleGetLocalVideoStats),i.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(He.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(He.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof or?t.trackList.forEach(r=>{r.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(He.GET_STATS,this.handleGetLocalAudioStats),r.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(He.GET_STATS,this.handleGetLocalAudioStats),t.off(He.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(He.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(He.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(He.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Hp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof zp&&r.addListener(He.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(He.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,i]=t;i.has(Ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(Ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((i,s)=>{var c;let u,{track:h,type:m}=i;switch(m){case Ae.LocalAudioTrack:u=nn.Audio;break;case Ae.LocalVideoTrack:u=Re(c=h._hints).call(c,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:u=nn.Low}return{kind:m===Ae.LocalAudioTrack?Ge.AUDIO:Ge.VIDEO,stream_type:u,mid:r[s].id,ssrcs:r[s].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((i,s)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var i;R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Je.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),Re(i=this._restartStates).call(i,r)&&!t.isInRestartIce&&(r==="disconnected"&&await yr(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),$e.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:dn.TRACER}).onSuccess(),this.emit(Je.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(ds.FIRST_FRAME_DECODED),$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_DECODE,Cn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_AUDIO_RECEIVED,Cn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{this.reportVideoFirstFrameDecoded(r,i,s)},t.onFirstVideoReceived=r=>{var i;const s=Array.from(si(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);s&&$e.firstRemoteFrame(this.store.sessionId,sr.FIRST_VIDEO_RECEIVED,Cn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,i)=>{const s=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&s===c||this.emit(Je.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(od(i))," -> ").concat(JSON.stringify(od(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Je.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Ai.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,R.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Ai.SEND_ONLY?this.restartICE(t):er(this,Je.RequestP2PRestartICE,{direction:Ai.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const i=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive||r.push([Ae.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s&&(r.push(s),s[0]===Ae.LocalVideoTrack)){const c=this.localTrackMap.get(Ae.LocalVideoLowTrack);c&&r.push([Ae.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],i=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof Vn&&(i==null?void 0:i.track)instanceof or)return i.track.isActive&&r.push([Ae.LocalAudioTrack,i]),r;const s=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(s)if(s[0]===Ae.LocalVideoTrack){r.push(s);const c=this.localTrackMap.get(Ae.LocalVideoLowTrack);c&&r.push([Ae.LocalVideoLowTrack,c])}else r.push(s);return r}createMuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var i;let s,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ae.LocalAudioTrack:s=nn.Audio;break;case Ae.LocalVideoTrack:s=Re(i=u._hints).call(i,Qt.SCREEN_TRACK)?nn.Screen:nn.High;break;case Ae.LocalVideoLowTrack:s=nn.Low}return{stream_type:s,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const c=s.get(r);if(!c)return i;i.push([t,{kind:r,id:c}])}else Array.from(s.entries()).forEach(c=>{let[u,h]=c;i.push([t,{kind:u,id:h}])});return i}createUnsubscribeMessage(t){const r=[];return t.forEach(i=>{let[s,{kind:c,id:u}]=i;switch(c){case Ge.VIDEO:return void(s._videoSSRC&&r.push({stream_type:Ge.VIDEO,ssrcId:s._videoSSRC}));case Ge.AUDIO:return void(s._audioSSRC&&r.push({stream_type:Ge.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[i,{kind:s}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ae.LocalVideoTrack),i=this.localTrackMap.get(Ae.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ke((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})),i&&t.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ke((s,c)=>{this.handleUpdateVideoEncoder(i.track,s,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Vn){const i=this.filterTobeUnmutedTracks(t[r]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await fn(this,Je.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Je.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Je.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await yr(_b(this.dtlsFailedCount,Yn)),this.emit(Je.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof un)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof un).length>1)throw new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Vn).length>1&&(t.some(r=>r instanceof Vn&&r._bypassWebAudio)||!It().webAudioMediaStreamDest))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof un&&this.pendingLocalTracks.some(i=>i instanceof un))throw new he(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Vn&&this.pendingLocalTracks.some(i=>i instanceof Vn)&&(!It().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Vn&&i._bypassWebAudio)))throw new he(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const i=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&It().supportDualStreamEncoding,s=ME(ME({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?t._mediaStreamTrack.clone():_I(t,s);const u=en(8,"track-low-"),h=new un(c,ME(ME({},i&&{scaleResolutionDownBy:qA(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return h.on(ju.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Fp.LOW_STREAM)}),h._hints.push(Qt.LOW_STREAM),t.addListener(He.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,i,s){var c;const u=Array.from(si(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");$e.firstRemoteVideoDecode(this.store.sessionId,sr.FIRST_VIDEO_DECODE,Cn.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,r,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const c=s.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new he(H.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new he(H.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new he(H.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new he(H.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new he(H.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new he(H.NOT_SUPPORTED)}async preConnect(t){throw new he(H.NOT_SUPPORTED)}getEstablishParams(){throw new he(H.NOT_SUPPORTED)}async reSubscribe(t){throw new he(H.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new he(H.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:i}]=t;r===Ae.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Fp.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},je(In.prototype,"p2pConnect",[v$],Object.getOwnPropertyDescriptor(In.prototype,"p2pConnect"),In.prototype),je(In.prototype,"unpublish",[y$],Object.getOwnPropertyDescriptor(In.prototype,"unpublish"),In.prototype),je(In.prototype,"unpublishLowStream",[_$],Object.getOwnPropertyDescriptor(In.prototype,"unpublishLowStream"),In.prototype),je(In.prototype,"subscribe",[b$],Object.getOwnPropertyDescriptor(In.prototype,"subscribe"),In.prototype),je(In.prototype,"mockSubscribe",[E$],Object.getOwnPropertyDescriptor(In.prototype,"mockSubscribe"),In.prototype),je(In.prototype,"unsubscribe",[x$],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribe"),In.prototype),je(In.prototype,"muteRemote",[S$],Object.getOwnPropertyDescriptor(In.prototype,"muteRemote"),In.prototype),je(In.prototype,"unmuteRemote",[w$],Object.getOwnPropertyDescriptor(In.prototype,"unmuteRemote"),In.prototype),je(In.prototype,"hasRemoteMediaWithLock",[T$],Object.getOwnPropertyDescriptor(In.prototype,"hasRemoteMediaWithLock"),In.prototype),je(In.prototype,"disconnectForReconnect",[C$],Object.getOwnPropertyDescriptor(In.prototype,"disconnectForReconnect"),In.prototype),je(In.prototype,"remoteMediaSsrcChanged",[N$],Object.getOwnPropertyDescriptor(In.prototype,"remoteMediaSsrcChanged"),In.prototype),In);function Uo(t){return function(r,i,s){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case Mo.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g()}}case Mo.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{g(),y()}}}},s}}class nh extends An{constructor(r,i){super(),L(this,"signal",void 0),L(this,"token",void 0),L(this,"tokenTimeout",void 0),L(this,"tokenInterval",void 0),L(this,"_sequence",0),L(this,"userMap",new Map),L(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const s=()=>{this.signal.connectionState===kt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*G("P2P_TOKEN_INTERVAL"))};s()}async send(r,i,s,c,u){var h;if(this.userMap.size===0)return;const m=Array.from(ya(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=c??en(6,""),u=u??this._sequence++;const g={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(m)};G("SHOW_P2P_LOG")&&R.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach(_=>{this.signal.request(Xe.DATA_STREAM,{payload:nd(this.encoder.encode(_))})});const y=new ke((_,x)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),D),this.off(Jp.ABORT,M),R.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?x(new he(H.INVALID_REMOTE_USER)):x(new he(H.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{S&&window.clearTimeout(S),this.off(Jp.ABORT,M),s&&_()},M=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),C),this.off("res-@".concat(c),D),x(new he(H.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Jp.ABORT,M),this.once("res-@".concat(c,"_ack"),C);const D=($,K)=>{j=!0,S&&window.clearTimeout(S),this.off("res-@".concat(c,"_ack"),C),this.off(Jp.ABORT,M),$==="success"?_(K):x(new he(H.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let j=!1;s||(this.once("res-@".concat(c),D),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||R.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await y}catch(_){if(_.code===H.TIMEOUT)return await this.send(r,i,s,c,u);throw _}}onMessage(r){var i;const{_uid:s}=r;let c,u=this.userMap.get(s);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Hn.CHECK)return;const{token:y}=r;c=new Map,u={uid:s,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(mt.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:y,total:_}=r,x=(h=c.get(y))!==null&&h!==void 0?h:[];if(x.push(r),c.has(y)||c.set(y,x),x.length!==_)return;{const S=gu(x).call(x,(C,M)=>C.index-M.index).map(C=>C.payload).join("");c.delete(y),(r=JSON.parse(S))._uid=s}}const{_type:m,token:g}=r;if(Re(i=[Hn.ACK,Hn.CHECK]).call(i,m))return m===Hn.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(r);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):R.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:en(6,""),token:this.token,_type:Hn.CHECK};G("SHOW_P2P_LOG")&&R.debug("send message",r),this.signal.request(Xe.DATA_STREAM,{payload:nd(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Hn.ACK,token:this.token};G("SHOW_P2P_LOG")&&R.debug("send message",i),this.signal.request(Xe.DATA_STREAM,{payload:nd(this.encoder.encode(JSON.stringify(i)))})}response(r,i,s){this.send(Hn.RESPONSE,JSON.stringify({success:!s,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:x}=y;for(;_.has(x);){const S=_.get(x);_.delete(x),this.receiveMessage(S),y.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:s,_seq:c}=r,u=this.userMap.get(s),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=u;if(c<g)return this.ack(r._id),void R.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:s,_message:c,_uid:u}=r;if(G("SHOW_P2P_LOG")&&R.debug("receive message",r),i){let h;switch(r._type!==Hn.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Hn.CANDIDATE:case Hn.CONTROL:this.signal.emit(s,h,u);break;case Hn.PUBLISH:case Hn.UNPUBLISH:case Hn.RESTART_ICE:case Hn.CALL:h.uid=u,er(this.signal,s,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Hn.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Hn.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(i),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<nh.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:s}=JSON.parse(r),c=en(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const g={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>nh.MAX_MESSAGE_SIZE?h-=50:(i.push(g),r=r.slice(h))}return i.map(g=>JSON.stringify(g))}handleCheckToken(r,i){return r.token!==i?(R.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{R.debug("token timeout, ".concat(i)),this.reset(r.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await er(this.signal,Hn.CALL,void 0),i=await this.send(Hn.CALL,r);this.signal.emit(ze.P2P_CONNECTION,i,!0)}async reset(r,i){const s=this.userMap.get(r);s&&(this.emit(Jp.ABORT),this.signal.emit(mt.ON_USER_OFFLINE,{uid:s.uid,reason:nve.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(R.debug("change local token from ".concat(i," to ").concat(i)),this.token=en(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Jp.ABORT)}}L(nh,"MAX_SIZE",1),L(nh,"MAX_MESSAGE_SIZE",1024);class B0e extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),L(this,"__name__","P2PSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"p2pToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"_external_signal",void 0),L(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case mt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case mt.MUTE_AUDIO:case mt.MUTE_VIDEO:case mt.ON_P2P_LOST:case mt.ON_USER_ONLINE:return;case mt.ON_USER_OFFLINE:const{uid:u}=c._message;return R.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===mt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===mt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}if(c._type===mt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case tt.ERR_LICENSE_MISSING:this.close(Dt.LICENSE_MISSING);break;case tt.ERR_LICENSE_EXPIRED:this.close(Dt.LICENSE_EXPIRED);break;case tt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Dt.LICENSE_MINUTES_EXCEEDED);break;case tt.ERR_LICENSE_PERIOD_INVALID:this.close(Dt.LICENSE_PERIOD_INVALID);break;case tt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Dt.LICENSE_MULTIPLE_SDK_SERVICE);break;case tt.ERR_LICENSE_ILLEGAL:this.close(Dt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",$r.OFFLINE)}),this.p2pToken=en(6,""),this._external_signal=new nh(this,this.p2pToken)}async request(r,i,s,c){const u=en(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new ke((M,D)=>{if(this.connectionState===kt.CONNECTED)return M();const j=()=>{this.off(ze.WS_CLOSED,$),M()},$=()=>{this.off(ze.WS_CONNECTED,j),D(new he(H.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,$)});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Xe.JOIN||r===Xe.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const y=new ke((M,D)=>{let j=!1;const $=(J,ne)=>{j=!0,M({isSuccess:J==="success",message:ne||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{D(new he(H.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await y}catch(M){if(this.connectionState===kt.CLOSED||r===Xe.LEAVE)throw new he(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===Xe.JOIN||r===Xe.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Wu(x),C=new he(H.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message,desc:S.desc});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===tt.ERR_TOO_MANY_BROADCASTERS?((r===Xe.JOIN||r===Xe.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===tt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$r.MULTI_IP)):this.reconnect(S.action,$r.SERVER_ERROR),r===Xe.JOIN||r===Xe.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ke(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Gu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const s={_type:r,_message:i};this.websocket.sendMessage(s)}async sendExtensionMessage(r,i,s){return await this._external_signal.send(r,i,s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ke((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,()=>s(this.initError||new he(H.WS_ABORT))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=en(6,""),this._external_signal.clear(),this._external_signal=new nh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION);const r=await er(this,ze.REQUEST_JOIN_INFO),i=await this.request(Xe.JOIN,r);if(!i)return this.emit(ze.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){return!1}handleDataStream(r){try{var i;const s=Iu(r.payload),c=new TextDecoder().decode(s),u=JSON.parse(c);"total"in u&&"id"in u||Re(i=Object.values(Hn)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(mt.ON_DATA_STREAM,r)}catch{this.emit(mt.ON_DATA_STREAM,r)}}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Wu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?r.code===tt.ERR_REPEAT_JOIN_CHANNEL&&G("IGNORE_UID_CHECK")?void this.close(Dt.UID_CONFLICT):(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(i.action,$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$r.TIMEOUT):this.request(Xe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Xe.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(Et.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Et.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Et.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(Et.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(Et.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(Et.WILL_RECONNECT,(r,i,s)=>{r!=="retry"?(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):R.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(r)}),this.websocket.on(Et.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof he&&r.code===H.UNEXPECTED_RESPONSE&&r.data.code===tt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$r.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$r.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Et.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const G0e={name:"P2PChannel",create:function(t){let{store:r,statsCollector:i}=t;return new V0e(r,i)},createSubmodule:function(t){let{store:r,spec:i}=t;return new B0e(i,r)}};function A$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function I$(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?A$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}class W0e{constructor(r){L(this,"sessionDesc",void 0),L(this,"localCapabilities",void 0),L(this,"rtpCapabilities",void 0),L(this,"candidates",void 0),L(this,"_originCandidates",void 0),L(this,"iceParameters",void 0),L(this,"dtlsParameters",void 0),L(this,"setup",void 0),L(this,"currentMidIndex",void 0),L(this,"cname",void 0),r=xn(r);const{iceParameters:i,dtlsParameters:s,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:g,cname:y}=r,_=Ci(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=xn(c),this.iceParameters=i,this.dtlsParameters=s,this.setup=h,this.localCapabilities=m,this.cname=y;for(let x=0;x<_.mediaDescriptions.length;x++){const S=_.mediaDescriptions[x];if(S.attributes.iceUfrag=i.iceUfrag,S.attributes.icePwd=i.icePwd,S.attributes.fingerprints=s.fingerprints,S.attributes.candidates=c,S.attributes.setup=h,S.media.mediaType==="video"){S.media.fmts=u.videoCodecs.map(D=>D.payloadType.toString(10));const C=u.videoCodecs.filter(D=>{var j,$;return(j=D.rtpMap)===null||j===void 0?void 0:Re($=j.encodingName.toLowerCase()).call($,g)}),M=u.videoCodecs.filter(D=>!Re(C).call(C,D));S.attributes.payloads=[...C,...M],S.attributes.extmaps=u.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=u.audioCodecs.map(C=>C.payloadType.toString(10)),S.attributes.payloads=u.audioCodecs,S.attributes.extmaps=u.audioExtensions),_.mediaDescriptions[x]=this.mungMediaDesc(S)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return rl(this.sessionDesc)}send(r,i,s){const{ssrcs:c,ssrcGroups:u}=nv(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>r===Ge.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:g}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:c}=i;return this.send(s,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{Re(r).call(r,h.attributes.label||"")?u.push(h):s.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;Re(m=u.map(g=>g.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),s=[];if(i.forEach(c=>{s.push(I$(I$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case Ar.TCP_RELAY:this.candidates=s;break;case Ar.UDP_TCP_RELAY:case Ar.RELAY:this.candidates=[...i,...s];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=xn(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=xn(r);return $u(s,i),QA(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Ge.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=s,(u=h.attributes.msid)===null||u===void 0||u.replace(i,s))}}mungMediaDesc(r){const i=xn(r);return JA(i),function(s){const c=s.attributes.extmaps.find(u=>eE(u.extensionName));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}var gn;function O$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function UE(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?O$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let $0e=(gn=class ry extends qb{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Re(i=Object.keys(Du)).call(i,r)}))]}constructor(r,i){super(r,i),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"statsFilter",void 0),L(this,"useRTX",!1),L(this,"localCapabilities",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"establishPromise",void 0),L(this,"mutex",void 0),this.store=i,this.mutex=new Rr("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ry.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=Sb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Ec(r.sdp),s=tv(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=r,UE(UE({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:r.sdp})}catch(r){throw new he(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new W0e(UE(UE({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new he(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var s=this;return Mi(function*(){const c=yield Tt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(S=>s.peerConnection.addTrack(S._mediaStreamTrack)),h=yield Tt(s.peerConnection.createOffer()),m=Ci(h.sdp),g=r.map(S=>{const C=S._mediaStreamTrack,M=m.mediaDescriptions.find(D=>D.attributes.mid===C.kind);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return function(D,j,$){const K=D.attributes.ssrcs.filter(ne=>ne.attributes.label===j),J=D.attributes.ssrcGroups;if(K.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(J&&K.length>1){const ne=J.find(ae=>ae.ssrcIds.indexOf(K[0].ssrcId)!==-1);return ne?[{ssrcId:ne.ssrcIds[0],rtx:$?ne.ssrcIds[1]:void 0}]:[{ssrcId:K[0].ssrcId}]}return[{ssrcId:K[0].ssrcId}]}(M,C.id,s.useRTX)});let y;try{y=yield g}catch(S){throw u.forEach(C=>{Nr()&&C.replaceTrack(null),s.peerConnection.removeTrack(C)}),S}const _=s.mungSendOfferSDP(h.sdp,r);s.remoteSDP.receive(r,i,y);const x=s.remoteSDP.toString();return yield Tt(s.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(s.applySendEncodings(u,r)),yield Tt(s.peerConnection.setRemoteDescription({type:"answer",sdp:x})),r.map((S,C)=>{const M=S._mediaStreamTrack.id;return{localSSRC:g[C],id:M}})}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{Nr()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new ke((_,x)=>{const S=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(u)))},1e4),C=M=>{const D=Wt();if((D.name==="Safari"&&Number(D.version)===11||ai())&&M.track.id!==u&&M.streams[0].id===h){var j;const $=M.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,M.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _($)}if(M.track.id===u)return this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _(M.track)};this.peerConnection.addEventListener("track",C)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(s=>{var c;return r.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(s=>{if(Nr()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach(u=>u.active=!1),s.setParameters(c)}})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(Nr()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Mi(function*(){const s=yield Tt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration;if(r===Ar.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),_=r===Ar.RELAY?"relay":"all";y.iceTransportPolicy!==_&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(_,"]")),y.iceTransportPolicy=_,i.peerConnection.setConfiguration(y))}r!==Ar.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ec(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const g=i.remoteSDP.toString();yield Tt(i.peerConnection.setLocalDescription(u)),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new he(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});s.length===1&&await this.applySendEncodings(s,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});s&&await s.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new he(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new he(H.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Cu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...ry.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...ry.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var s;if(i||(i=this.peerConnection.getSenders().find(y=>{var _;return((_=y.track)===null||_===void 0?void 0:_.id)===r._mediaStreamTrack.id})),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!It().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof un)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(G("DSCP_TYPE")&&fc()){var h;const y=G("DSCP_TYPE");Re(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),g=(s=m.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,u),Object.assign(m,c),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const s=Ci(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=s.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&$u(m,c)}),rl(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:g}=u;const{kind:y}=r[h];return new ke((_,x)=>{const S=setTimeout(()=>{x(new Error("Cannot receive track, id: ".concat(m)))},1e4),C=M=>{const D=Wt();if(D.name==="Safari"&&Number(D.version)===11&&M.track.id!==m&&M.streams[0].id===g){var j;const $=M.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(y,m,M.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _({track:$,id:m})}if(M.track.id===m)return this.peerConnection.removeEventListener("track",C),clearTimeout(S),void _({track:M.track,id:m})};this.peerConnection.addEventListener("track",C)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ke.all(i)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(It().supportPCSetConfiguration){const i=ry.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},je(gn.prototype,"connect",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"connect"),gn.prototype),je(gn.prototype,"stopSending",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"stopSending"),gn.prototype),je(gn.prototype,"receive",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"receive"),gn.prototype),je(gn.prototype,"stopReceiving",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"stopReceiving"),gn.prototype),je(gn.prototype,"muteRemote",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"muteRemote"),gn.prototype),je(gn.prototype,"unmuteRemote",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteRemote"),gn.prototype),je(gn.prototype,"muteLocal",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"muteLocal"),gn.prototype),je(gn.prototype,"unmuteLocal",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"unmuteLocal"),gn.prototype),je(gn.prototype,"close",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"close"),gn.prototype),je(gn.prototype,"updateEncoderConfig",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"updateEncoderConfig"),gn.prototype),je(gn.prototype,"updateSendParameters",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"updateSendParameters"),gn.prototype),je(gn.prototype,"replaceTrack",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"replaceTrack"),gn.prototype),je(gn.prototype,"getRemoteSSRC",[gs],Object.getOwnPropertyDescriptor(gn.prototype,"getRemoteSSRC"),gn.prototype),gn);function gs(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}const H0e={name:"PlanBConnection",create:function(t){let{store:r,spec:i}=t;return new $0e(i,r)}},z0e={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Lb.has(t)||!t.track)return;const i={track:t.track};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const g=r.metadata&&r.metadata();g?function(y,_){const{chunk:x,controller:S}=_,C=rd.METADATA;x.data=function(M,D,j){const $=j.byteLength,K=$+AA+w6,J=NA+RA+K,ne=new ArrayBuffer(M.byteLength+J),ae=new DataView(ne);ae.setUint8(0,S6),ae.setUint16(1,K),ae.setUint8(3,D),ae.setUint16(4,$);for(let oe=0;oe<$;oe++)ae.setUint8(6+oe,j[oe]);const Q=new Uint8Array(ae.buffer);return Q.set(new Uint8Array(M),J),Q.buffer}(x.data,C,y),S.enqueue(x)}(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=jb(),u=new MessageChannel;await new ke(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new ke(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(m.data.getMetadata){const y=r.metadata&&r.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=Lb.get(t);if(c){Lb.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){R.warning(m&&m.message)}}}Lb.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support audio encoded transform");if(Gb.has(t))return;const i={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(tl()&&!ai()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");UR(Kt.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),t.track&&t.track.id!==i.track.id&&(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)),r.enableTopn?function(g,y,_){var x;const S=IA(new DataView(y.data));if(!S)return _.enqueue(y);const C=g.track.id;Sge.set(C,g.track);const M=(x=S.tlv.find(ne=>ne.tag===rd.AUDIO_LEVEL))===null||x===void 0?void 0:x.value;let D=0;typeof M=="number"&&(D=127-M);const j=Math.round(Math.pow(10,D/60)-1),{selected:$,speaker:K}=function(ne,ae){let Q=Kp.get(ne);if(Q||(Q=function(oe){const ge=new C6;return Kp.set(oe,ge),Ao||(Ao=new Ege(G("TOPN_SILENCE_THRESHOLD")||500),Ao.on("ActiveSpeakerChanged",Ee=>{Ee!=null&&(Fb=Ee)})),Ao.addSpeakers([ge]),ge}(ne)),Kp.size<=N6)return{selected:!0,speaker:Q};if(!Ao)throw new Error("no active speaker detector");return Ao.levelChanged(Q.id,ae),Fu=Ao.loudest.map(oe=>oe.id),Fb&&!Re(Fu).call(Fu,Fb)&&Fu.length>=N6&&Fu.pop(),{selected:Re(Fu).call(Fu,Q.id)||Q.id===Fb,speaker:Q}}(g,j),J=function(ne,ae,Q){const oe=Io.get(ne)||new xge(ne,ae);return oe.score=Q,Io.set(ne,oe),function(ge){if(Vb.set(ge,!0),!Bb)return void(Bb=Date.now());const Ee=Date.now();Ee-Bb>1e3&&(Vb.get(ge)?Vb.set(ge,!1):(R6(ge),Vb.delete(ge)),Bb=Ee)}(ne),oe}(C,g.track,K.energyScore);J.addSample($),J.active&&(y.data=S.frame.buffer,_.enqueue(y))}(t,h,m):r.enableMetadata||r.enablePts?function(g,y,_,x){const S=new DataView(g.data),C=S.getUint8(0);let M;if(128&C&&C!==71){const $=function(K){if(K.byteLength<=0)return[];const J=[];let ne=0;for(;ne<K.byteLength;){const Q=(128&K.getUint8(ne))>>7,oe=127&K.getUint8(ne);if(!(Q&&ne+4<=K.byteLength)){ne++;break}{const ge=K.getUint32(ne,!1),Ee=(16776192&ge)>>10,Fe=1023&ge;J.push({pt:oe,ts_offset:Ee,length:Fe,data:new Uint8Array}),ne+=4}}let ae=K.byteLength-ne;for(const Q of J){if(Q.length>ae)return console.warn("Broken red payload"),[];Q.length>0&&(Q.data=new Uint8Array(K.buffer,K.byteOffset+ne,Q.length),ne+=Q.length,ae-=Q.length)}if(ae>0){const Q={pt:J.length>0?J[J.length-1].pt:0,ts_offset:0,length:ae,data:new Uint8Array(K.buffer,K.byteOffset+ne,ae)};J.push(Q)}return J}(S);if($.length>0){const K=function(J){let ne=0;for(let oe=0;oe<J.length;oe++)ne+=oe<J.length-1?4:1,ne+=J[oe].length;const ae=new Uint8Array(ne);let Q=0;for(let oe=0;oe<J.length;oe++)if(oe<J.length-1){const ge=(2147483648|(127&J[oe].pt)<<24|(262143&J[oe].ts_offset)<<10|1023&J[oe].length)>>>0;ae[Q++]=ge>>24&255,ae[Q++]=ge>>16&255,ae[Q++]=ge>>8&255,ae[Q++]=255&ge}else ae[Q++]=127&J[oe].pt;for(const oe of J)ae.set(oe.data,Q),Q+=oe.length;return ae}($.map(J=>{const ne=new Uint8Array(J.length);ne.set(J.data);const ae=IA(new DataView(ne.buffer));return ae!=null&&ae.frame&&(J.data=ae==null?void 0:ae.frame),M=ae,J}));g.data=K.buffer}}else M=IA(S),M&&(g.data=M.frame.buffer);if(y.enqueue(g),!M)return;const D=M.tlv.find($=>$.tag===rd.METADATA);D&&_&&D.value instanceof Uint8Array&&_(D.value);const j=M.tlv.find($=>$.tag===rd.AUDIO_64_BIT_PTS);j&&x&&j.value instanceof Uint8Array&&j.value.length==8&&x(new DataView(j.value.buffer).getBigUint64(0,!0))}(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=jb(),u=new MessageChannel;await new ke(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new ke(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id?(R.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s)):m.data.metadata&&i.onMetadata?i.onMetadata(m.data.metadata):m.data.pts&&i.onPts&&i.onPts(m.data.pts)},i.worker=c}function s(){t.track.removeEventListener("ended",s),function(c){const u=Gb.get(c);if(u){(function(g){const y=Kp.get(g);y&&(Kp.delete(g),Ao&&(Ao.removeSpeakers([y]),Kp.size===0&&(Ao.destroy(),Ao=null)))})(c),R6(c.track.id),Gb.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){R.warning(g&&g.message)}}}(t)}Gb.set(t,i),t.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(t,r){if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(Wb.has(t)||!t.track)return;const i={track:t.track};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void R.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,g){i.controller||(i.controller=g),t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const y=O6(new Uint8Array(m.data)),_=u.shift();if(_){const x=function(S,C,M){switch(M){case kA:return function(D,j){const $=I6(j),K=$.length,J=Math.floor(K/255),ne=K%255,ae=new Uint8Array(6+J+1+K+D.byteLength);ae[0]=0,ae[1]=0,ae[2]=0,ae[3]=1,ae[4]=6,ae[5]=101;let Q=0;for(;Q<J;)ae[6+Q]=255,Q++;return ae[6+Q]=ne,Q++,ae.set($,6+Q),ae.set(new Uint8Array(D),6+Q+K),ae.buffer}(S,C);case jA:return function(D,j){const $=I6(j),K=$.length,J=Math.floor(K/255),ne=K%255,ae=new Uint8Array(7+J+1+K+1+D.byteLength);ae[0]=0,ae[1]=0,ae[2]=0,ae[3]=1,ae[4]=78,ae[5]=1,ae[6]=101;let Q=0;for(;Q<J;)ae[7+Q]=255,Q++;return ae[7+Q]=ne,Q++,ae.set($,7+Q),Q+=K,ae[7+Q]=128,Q++,ae.set(new Uint8Array(D),7+Q),ae.buffer}(S,C);default:return null}}(m.data,_,y);x&&(m.data=x)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Nr())return;{if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=jb(),u=new MessageChannel;await new ke(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new ke(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s))},i.worker=c}}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}const c=Wb.get(t);if(c){Wb.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){R.warning(m&&m.message)}}}Wb.set(t,i),t.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!It().supportWebRTCEncodedTransform)return void R.warning("browser not support video encoded transform");if(!t.track)return;if(Jg.has(t)){const c=Jg.get(t);return void(c&&(c.onSei=r.onSei))}const i={track:t.track,onSei:r.onSei};if(tl()){if(!t.createEncodedStreams)return void R.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void R.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){if(i.controller||(i.controller=m),!i.firstFrameInfo){var g;const _=h.getMetadata()||{};i.firstFrameInfo=_n({type:h.type,rtpTimestamp:h.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:h.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(g=r.onFirstFrame)===null||g===void 0||g.call(r,i.firstFrameInfo)}t.track&&t.track.id!==i.track.id&&(R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s));const y=function(_,x){switch(x){case kA:return function(S){const C=new DataView(S.data);let M=0;for(;M+4<S.data.byteLength;){if(C.getUint8(M+0)===0&&C.getUint8(M+1)===0&&C.getUint8(M+2)===0&&C.getUint8(M+3)===1&&C.getUint8(M+4)===6){let D=M+6,j=0,$=0;for(;($=C.getUint8(D++))===255;)j+=255;j+=$;const K=A6(S.data,D,j);return new Uint8Array(K)}M++}return null}(_);case jA:return function(S){const C=new DataView(S.data);let M=0;for(;M+5<S.data.byteLength;){if(C.getUint8(M+0)===0&&C.getUint8(M+1)===0&&C.getUint8(M+2)===0&&C.getUint8(M+3)===1&&C.getUint8(M+4)===78&&C.getUint8(M+5)===1&&C.getUint8(M+6)===101){let D=M+7,j=0,$=0;for(;($=C.getUint8(D++))===255;)j+=255;j+=$;const K=A6(S.data,D,j);return new Uint8Array(K)}M++}return null}(_);default:return null}}(h,O6(new Uint8Array(h.data)));y&&i.onSei&&i.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Nr()){if(typeof RTCRtpScriptTransform>"u")return void R.warning("browser not support RTCRtpScriptTransform");const c=jb(),u=new MessageChannel;await new ke(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new ke(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==i.track.id)R.debug("video track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",s),i.track=t.track,i.track.addEventListener("ended",s);else if(m.data.sei&&i.onSei)i.onSei(m.data.sei);else if(m.data.firstFrameInfo&&r.onFirstFrame){var y;(y=r.onFirstFrame)===null||y===void 0||y.call(r,m.data.firstFrameInfo)}},i.worker=c}function s(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",s)}(function(c){const u=Jg.get(c);if(u){Jg.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){R.warning(g&&g.message)}}})(t)}Jg.set(t,i),t.track.addEventListener("ended",s)}},K0e={name:"InterceptFrame",create:()=>z0e};var Bt;function P$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}function Fo(t){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(i),!0).forEach(function(s){L(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):P$(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}let Y0e=(Bt=class wm extends qb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return Re(i=Object.keys(Du)).call(i,r)}))]}constructor(r,i,s){super(r,i),L(this,"id",en(5,"connection-")),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"forceTurn",!1),L(this,"remoteSDP",void 0),L(this,"initialOffer",void 0),L(this,"transportEventReceiver",void 0),L(this,"statsFilter",void 0),L(this,"extension",{useXR:G("USE_XR")}),L(this,"localCapabilities",void 0),L(this,"remoteCodecs",void 0),L(this,"localCandidateCount",0),L(this,"allCandidatesReceived",!1),L(this,"isPreallocation",!1),L(this,"preMediaMap",new Map),L(this,"dataStreamChannelMap",new Map),L(this,"establishPromise",void 0),L(this,"recoveredDataChannelIds",[]),L(this,"currentDataChannelId",1),L(this,"supportAV1RtpSpec",!1),L(this,"mutex",void 0),L(this,"qualityLimitationReason",jp.NONE),L(this,"isFirstConnected",!1),this.store=i,this.forceTurn=yI(r),this.mutex=new Rr("NVConnectionExtension-mutex",i.clientId),this.peerConnection=s,this.isFirstConnected=!1,this.statsFilter=Sb(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void R.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ec(i.sdp),c=await eI({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:G("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:G("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=rv(c),this.initialOffer=i,G("ENABLE_SVC")&&this.store.codec=="av1"){const h=await a8();var r;h&&(this.supportAV1RtpSpec=!0,(r=c.send)===null||r===void 0||r.videoExtensions.push(h))}let u;return i.sdp&&nE(i.sdp)&&(u=xn(c),J6(u)),Fo(Fo({},s),{},{rtpCapabilities:u||c,offerSDP:i.sdp})}catch(i){throw new he(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&nE(this.initialOffer.sdp)&&Q6(r.rtpCapabilities,this.localCapabilities),this.remoteSDP=new I8(Fo(Fo({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!G("ENABLE_PRE_SUB_WITH_PRE_PC")||!G("PRE_USE_LOCAL_CODECS"))&&Yg(this.store),!0),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString(),s=tI(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});const u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),Yg(this.store))if(r.preallocation&&G("ENABLE_PRE_SUB_WITH_PRE_PC")){const h=G("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{const{preSSRCs:h=[]}=r,m=h.map(y=>y.ssrcMsg[0].ssrcId);if(h.length===0)return;const{mids:g}=this.remoteSDP.batchSend(h.map(y=>Object.assign({},y)));await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(i.toString()))}}presetMedia(r,i){r.forEach((s,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){const h=u.receiver.track;let m;h.kind==="video"&&G("ENABLE_PRE_RENDER")&&(m=new Db({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(en(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const y=this.preMediaMap.get(i[c]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,i[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,i[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[c],{mid:s,track:h,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:s}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||h}const{preSSRCs:c=[]}=r,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:_,player:x,track:S}]=g;return h.push(_),m.push(y),this.preMediaMap.delete(y),x&&x.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await na(this.peerConnection,this.remoteSDP,this.extension),R.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),$e.reportApiInvoke(this.store.sessionId,{name:Tn.PRELOAD_MEDIA_FAILED,options:[c,m],tag:dn.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(y=>Object.assign({},y)));await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}i?(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):R.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,s){var c=this;return Mi(function*(){const u=yield Tt(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const h=[],m=ev();r.forEach(j=>{const $=c.peerConnection.addTransceiver(j._mediaStreamTrack,Fo({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push($),j._updateRtpTransceiver($)}),En()&&G("SIMULCAST")===!0&&(yield Tt(c.applySimulcastForFirefox(h,r)));const g=yield Tt(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),_=c.mungSendOfferSDP(g.sdp,r,y),x=Ci(_),S=y.map(j=>{const $=x.mediaDescriptions.find(K=>K.attributes.mid===j);if(!$)throw new Error("Cannot extract ssrc from mediaDescription.");return XA($,G("USE_PUB_RTX"))});let C;try{C=yield S}catch(j){C=[],c.remoteSDP.receive(r,i,s,C);const $=c.remoteSDP.toString();throw yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:$})),yield Tt(c.stopSending(y,!0)),j}c.remoteSDP.receive(r,i,s,C);const M=c.remoteSDP.toString(),D=c.logSDPExchange(_,"offer","local","send");return yield Tt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Tt(c.applySimulcastEncodings(h,r)),yield Tt(c.applySendEncodings(h,r)),D==null||D(M),yield Tt(c.peerConnection.setRemoteDescription({type:"answer",sdp:M})),h.map((j,$)=>{const K=y[$];return{localSSRC:S[$],id:K,transceiver:j}})}catch(h){throw h instanceof he?h:new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(r);if(s&&s.readyState==="open")R.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,s)}i.forEach(u=>{u._updateOriginDataChannel(s)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),R.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else R.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof he?s:new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof he?i:new he(H.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const s=i?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(g=>{var y;im(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(r,i,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,s,c);h&&(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:s}=this.remoteSDP.batchSend(r);return s&&(await na(this.peerConnection,this.remoteSDP,this.extension),R.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:y}]=h;if(g===u)return this.preMediaMap.delete(m),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new he(H.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return Mi(function*(){const s=yield Tt(i.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=It().supportPCSetConfiguration,u=G("FORCE_TURN_TCP")||i.forceTurn;if(r===Ar.RELAY&&!c)return;if(c&&!u){const x=r===Ar.RELAY?"relay":"all",S=i.peerConnection.getConfiguration();S.iceTransportPolicy!==x&&(R.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(x,"]")),S.iceTransportPolicy=x,i.peerConnection.setConfiguration(S))}i.remoteSDP.updateCandidates(r);const h=yield Tt(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Ec(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;i.remoteSDP.restartICE(g);const y=i.remoteSDP.toString(),_=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Tt(i.peerConnection.setLocalDescription(h)),_==null||_(y),yield Tt(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){R.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Ar.TCP_RELAY),await na(this.peerConnection,this.remoteSDP,this.extension)}catch(i){R.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{im(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:s}=i;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Fo(Fo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new he(H.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(r,i){const s=this.peerConnection.getTransceivers().filter(c=>c.mid===r);s.length===1&&(this.isVP8Simulcast(i)?En()||await this.applySimulcastEncodings(s,[i]):await this.applySendEncodings(s,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const s=this.peerConnection.getTransceivers().find(c=>c.mid===i);s&&await s.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:s,remote:c}=i.getSelectedCandidatePair();return{local:Fo(Fo({},Bs),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Fo(Fo({},Bs),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const s="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",u=bc(r.url||"");R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,s)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},s=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(Cu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:G("NEW_TURN_MODE")&&i.iceServers&&s==="disabled"?(G("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...wm.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...wm.newTurnServerConfigToIceServers(r.turnServer.servers)),G("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...wm.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...wm.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{const c=G("NEW_TURN_MODE");c===1?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:u}=s.getSelectedCandidatePair()||{};if(c&&u){const h=c.address+":"+c.port,m=u.address+":"+u.port;R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(bc(h)),", remote ").concat(JSON.stringify(bc(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var s,c;if(i||(i=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!i)return R.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!It().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=q6(this.peerConnection,r._mediaStreamTrack),g=UV(r);if(L8(r)&&m&&i&&g&&this.getLocalVideoStats&&Re(s=["vp8","vp9"]).call(s,this.store.codec)){var y;const D=u.degradationPreference||(Re(y=r._hints).call(y,Qt.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");M8(this.id+m.mid,g,this,D,j=>{i&&this.updateAdaptation(i,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;const{bitrateMax:D,frameRate:j,scaleResolutionDownBy:$}=r._encoderConfig;D&&(h.maxBitrate=1e3*D),(Re(_=r._hints).call(_,Qt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=Gi(j)),$&&$>=1&&(h.scaleResolutionDownBy=$))}const{maxFramerate:x}=G("ENCODER_CONFIG_LIMIT");if(x&&typeof x=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,x):x),G("DSCP_TYPE")&&fc()){var S;const D=G("DSCP_TYPE");Re(S=["very-low","low","medium","high"]).call(S,D)&&(h.networkPriority=D)}const C=i.getParameters(),M=(c=C.encodings)===null||c===void 0?void 0:c[0];En()&&!M&&(u.encodings=[h]),M&&Object.assign(M,h),Object.assign(C,u),R.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await c8(this.store.codec,i,G("SVC_MODE"))}async updateAdaptation(r,i){var s,c;if(!r)return R.debug("[updateAdaptation] no rtpSender found");if(!It().supportSetRtpSenderParameters)return R.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Gi(m)),g&&g>=1&&Re(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);const y=r.getParameters(),_=(c=y.encodings)===null||c===void 0?void 0:c[0];_&&Object.assign(_,u),Object.assign(y,{});try{await r.setParameters(y),R.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(x){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?R.debug("[updateAdaptation] peerConnection not connected}"):R.debug("[updateAdaptation] updateRtpSenderEncodings failed",x):R.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!It().supportSetRtpSenderParameters||r.length!==i.length)return;for(let s=0;s<r.length;s++){const c=r[s],u=i[s];u instanceof un&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,s){const c=Ci(r);return i.forEach((u,h)=>{const m=s[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&($u(g,u),ZA(g,u,this.store.codec))}),rl(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let g=0;g<r.length;g++){var s,c,u,h,m;const y=r[g],_=i[g];if(_ instanceof un&&!Re(s=_._hints).call(s,Qt.LOW_STREAM)&&(c=_._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=_._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=_._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const x={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};x.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const C=y.sender.getParameters();await y.sender.setParameters(Object.assign(C,x))}}}async applySimulcastEncodings(r,i){if(!En()&&r.length===i.length)for(let s=0;s<r.length;s++){const c=i[s];if(c instanceof un&&this.isVP8Simulcast(c)){const u=r[s],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var i,s,c,u,h;return!!(r instanceof un&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Re(i=r._hints).call(i,Qt.LOW_STREAM)&&(s=r._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during NVConnectionExtension.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(It().supportPCSetConfiguration){const i=wm.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},je(Bt.prototype,"updateRemoteRTPCapabilities",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteRTPCapabilities"),Bt.prototype),je(Bt.prototype,"connect",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"connect"),Bt.prototype),je(Bt.prototype,"updateRemoteConnect",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateRemoteConnect"),Bt.prototype),je(Bt.prototype,"createDataChannels",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"createDataChannels"),Bt.prototype),je(Bt.prototype,"receive",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"receive"),Bt.prototype),je(Bt.prototype,"batchReceive",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"batchReceive"),Bt.prototype),je(Bt.prototype,"stopReceiving",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"stopReceiving"),Bt.prototype),je(Bt.prototype,"muteRemote",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"muteRemote"),Bt.prototype),je(Bt.prototype,"unmuteRemote",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteRemote"),Bt.prototype),je(Bt.prototype,"muteLocal",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"muteLocal"),Bt.prototype),je(Bt.prototype,"unmuteLocal",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"unmuteLocal"),Bt.prototype),je(Bt.prototype,"close",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"close"),Bt.prototype),je(Bt.prototype,"updateEncoderConfig",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateEncoderConfig"),Bt.prototype),je(Bt.prototype,"updateSendParameters",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateSendParameters"),Bt.prototype),je(Bt.prototype,"replaceTrack",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"replaceTrack"),Bt.prototype),je(Bt.prototype,"updateAdaptation",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"updateAdaptation"),Bt.prototype),je(Bt.prototype,"getRemoteSSRC",[Hi],Object.getOwnPropertyDescriptor(Bt.prototype,"getRemoteSSRC"),Bt.prototype),Bt);function Hi(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From NVConnectionExtension.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}var an;function D$(t){var r,i,s,c=2;for(typeof Symbol<"u"&&(i=sb,s=Symbol.iterator);c--;){if(i&&(r=t[i])!=null)return r.call(t);if(s&&(r=t[s])!=null)return new FE(r.call(t));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function FE(t){function r(i){if(Object(i)!==i)return ke.reject(new TypeError(i+" is not an object."));var s=i.done;return ke.resolve(i.value).then(function(c){return{value:c,done:s}})}return FE=function(i){this.s=i,this.n=i.next},FE.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return s===void 0?ke.resolve({value:i,done:!0}):r(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return s===void 0?ke.reject(i):r(s.apply(this.s,arguments))}},new FE(t)}let q0e=(an=class Gx extends qb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(r,i){super(r,i),L(this,"name","DataChannelConnection"),L(this,"store",void 0),L(this,"peerConnection",void 0),L(this,"cname",void 0),L(this,"mutex",new Rr("DataChannelConnection-mutex")),L(this,"dataChannel",void 0),L(this,"_p2pConnection",void 0),L(this,"establishPromise",void 0),L(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Gx.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Y0e(r,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(r){var i;return(i=this._p2pConnection)===null||i===void 0?void 0:i.getPreMedia(r)}isPreSub(){var r,i;return(r=(i=this._p2pConnection)===null||i===void 0?void 0:i.isPreSub())!==null&&r!==void 0&&r}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(r){return this._p2pConnection.updateRtpSenderEncodings(r)}async connect(r){return this.cname=r.cname,await this._p2pConnection.connect(r),await new ke((i,s)=>{const c=setTimeout(()=>{this.closeSignal(),s(new ce(H.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r.candidates))))},G("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void i()},this.dataChannel.onerror=u=>{this.closeSignal(),s(u)},this.dataChannel.addEventListener("close",()=>{s(new ce(H.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(r,i){return this._p2pConnection.updateRemoteRTPCapabilities(r,i)}send(r,i,s){var c=this;return Mi(function*(){const u=yield Tt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*Ap(D$(c._p2pConnection.send(r,i,s)))}finally{u()}})()}async stopSending(r,i){return this._p2pConnection.stopSending(r,i)}async createDataChannels(r,i){return this._p2pConnection.createDataChannels(r,i)}async stopDataChannels(r){return this._p2pConnection.stopDataChannels(r)}async receive(r,i,s,c){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(r," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(r,i,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(r," by WebRTC.")),await this._p2pConnection.receive(r,i,s,c))}async batchReceive(r){return[...await this._p2pConnection.batchReceive(r)]}async stopReceiving(r){return await this._p2pConnection.stopReceiving(r)}async muteRemote(r){return await this._p2pConnection.muteRemote(r)}async unmuteRemote(r){return await this._p2pConnection.unmuteRemote(r)}async muteLocal(r){return await this._p2pConnection.muteLocal(r)}async unmuteLocal(r){return await this._p2pConnection.unmuteLocal(r)}restartICE(r){var i=this;return Mi(function*(){return yield*Ap(D$(i._p2pConnection.restartICE(r)))})()}close(){var r;(r=this._nvMedia)===null||r===void 0||r.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(r){return this._p2pConnection.getRemoteVideoIsReady(r)}updateRemoteConnect(r){var i;return(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(r),this._p2pConnection.updateRemoteConnect(r)}async updateEncoderConfig(r,i){return await this._p2pConnection.updateEncoderConfig(r,i)}async updateSendParameters(r,i){return await this._p2pConnection.updateSendParameters(r,i)}setStatsRemoteVideoIsReady(r,i){this._p2pConnection.setStatsRemoteVideoIsReady(r,i)}async replaceTrack(r,i){return await this._p2pConnection.replaceTrack(r,i)}async getRemoteSSRC(r){return this._p2pConnection.getRemoteSSRC(r)}logSDPExchange(r,i,s,c){if(G("SDP_LOGGING"))return R.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Cu(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...Gx.turnServerConfigToIceServers(r.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...Gx.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&It().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(zs(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!G("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=r=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onConnectionStateChange=r=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportStateChange=r=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onDTLSTransportError=r=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onICETransportStateChange=r=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioReceived=r=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoReceived=r=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstAudioDecoded=r=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoRender=r=>{var i;return(i=this.onFirstVideoRender)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoBufferReady=r=>{var i;return(i=this.onFirstVideoBufferReady)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onFirstVideoDecoded=(r,i,s)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,r,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=r=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,r)},this._p2pConnection.onSelectedLocalCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedLocalCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(r,i)=>{var s;return(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0?void 0:s.call(this,r,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}setConfiguration(r){this._p2pConnection.setConfiguration(r)}},je(an.prototype,"connect",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"connect"),an.prototype),je(an.prototype,"updateRemoteRTPCapabilities",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"updateRemoteRTPCapabilities"),an.prototype),je(an.prototype,"createDataChannels",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"createDataChannels"),an.prototype),je(an.prototype,"receive",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"receive"),an.prototype),je(an.prototype,"stopReceiving",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"stopReceiving"),an.prototype),je(an.prototype,"muteRemote",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"muteRemote"),an.prototype),je(an.prototype,"unmuteRemote",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"unmuteRemote"),an.prototype),je(an.prototype,"muteLocal",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"muteLocal"),an.prototype),je(an.prototype,"unmuteLocal",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"unmuteLocal"),an.prototype),je(an.prototype,"close",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),je(an.prototype,"updateEncoderConfig",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"updateEncoderConfig"),an.prototype),je(an.prototype,"updateSendParameters",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"updateSendParameters"),an.prototype),je(an.prototype,"replaceTrack",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"replaceTrack"),an.prototype),je(an.prototype,"getRemoteSSRC",[Ya],Object.getOwnPropertyDescriptor(an.prototype,"getRemoteSSRC"),an.prototype),an);function Ya(t,r,i){const s=t[r];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From DataChannelConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await s.apply(this,m)}finally{u()}},i}function k$(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),i.push.apply(i,s)}return i}class X0e extends An{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;Re(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(lr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(lr.CONNECTED):this._state==="closed"?this.emit(lr.CLOSED):this._state==="failed"&&this.emit(lr.FAILED))}constructor(r,i,s,c){super(),L(this,"connectionID",0),L(this,"currentURLIndex",0),L(this,"reconnectReason",void 0),L(this,"_reconnectMode","tryNext"),L(this,"_initMutex",void 0),L(this,"_name",void 0),L(this,"_state","closed"),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_retryConfig",void 0),L(this,"_reconnectCount",0),L(this,"_forceCloseTimeout",5e3),L(this,"_onlineReconnectListener",void 0),L(this,"_closeEstablishingTransmitter",()=>{}),L(this,"_store",void 0),L(this,"_joinChannelServiceRecordIndex",void 0),L(this,"_transmitter",void 0),L(this,"_useCompress",void 0),L(this,"_inflateLength",0),L(this,"_deflateLength",0),this._store=c,this._name=r,this._retryConfig=function(u){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?k$(Object(m),!0).forEach(function(g){L(u,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(m)):k$(Object(m)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(m,g))})}return u}({},i),this._useCompress=s}resetReconnectCount(r){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(r)),this._reconnectCount=0}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=r?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(r,i){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((s=this._store)===null||s===void 0||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const r=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:r,deflateLength:i}}setInflateData(r){this._deflateLength=this._deflateLength+r.originLength,this._inflateLength=this._inflateLength+r.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Vo=function(t){return t[t.Default=0]="Default",t[t.Ack=1]="Ack",t}({});class J0e{constructor(r,i,s){L(this,"version",1),L(this,"initialRTO",void 0),L(this,"maxBatchAckCount",void 0),L(this,"maxRTO",void 0),L(this,"initialRTT",void 0),L(this,"ID",void 0),L(this,"rtt",void 0),L(this,"packetNumber",1),L(this,"rtoRatioMap",new Map),L(this,"timeoutMap",new Map),L(this,"unorderedPacketQueue",[]),L(this,"batchAckPacketQueue",[]),L(this,"lastOrderedPacketNumber",0),L(this,"batchAckTimer",void 0),L(this,"sendImpl",void 0),L(this,"receiveImpl",void 0),this.sendImpl=r,this.receiveImpl=i,this.ID=en(7,"transmitter-"),this.initialRTO=(s==null?void 0:s.initialRTO)!==void 0?s.initialRTO:G("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.rtt=(s==null?void 0:s.initialRTT)!==void 0?s.initialRTT:G("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(s==null?void 0:s.maxBatchAckCount)!==void 0?s.maxBatchAckCount:G("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(s==null?void 0:s.maxRTO)!==void 0?s.maxRTO:G("TRANSMITTER_MAX_RTO")}packetize(r,i){return{type:Vo.Default,version:this.version,packetNumber:i,payload:r}}serialize(r){switch(r.type){case Vo.Default:{let i;typeof r.payload=="string"?i=new TextEncoder().encode(r.payload):i=r.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,r.version),c.setUint8(2,r.type),c.setUint32(3,r.packetNumber),DF(c,7,BigInt(r.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case Vo.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,r.version),s.setUint8(2,r.type),s.setUint32(3,r.maxAckPacketNumber),s.setUint8(7,r.shift),DF(s,8,BigInt(r.ackSendTs)),i}}}deserialize(r){const i=new DataView(r),s=i.getUint16(0),c=i.getUint8(2);switch(c){case Vo.Default:{const u=i.getUint32(3),h=PF(i,7),m=r.slice(15),g=new Uint8Array(m);return{version:s,type:c,packetNumber:u,sendTs:Number(h),payload:g}}case Vo.Ack:{const u=i.getUint32(3),h=i.getUint8(7),m=PF(i,8);return{version:s,type:c,maxAckPacketNumber:u,shift:h,ackSendTs:Number(m)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(r){G("DC_DEBUG_LOG")&&typeof r=="string"&&R.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(r));const i=this.packetize(r,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(r){const i=this.deserialize(r);i.type===Vo.Default?this.ack(i):i.type===Vo.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(r=>{let[i,s]=r;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(r){const i=this.calculateRTO(r),s=window.setTimeout(()=>{G("DC_DEBUG_LOG")&&typeof r.payload=="string"&&R.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(r.payload),"timeout: ".concat(i)),this.resendMessage(r)},i);this.timeoutMap.set(r.packetNumber,s),this.sendPacket(r)}calculateRTO(r){const i=this.rtoRatioMap.get(r.packetNumber);if(i===void 0)return this.rtoRatioMap.set(r.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(r.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(r,i){const s=r.ackSendTs;this.rtt=this.rtt*(7/8)+(i-s-this.rtt)/8}ack(r){if(r.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(r):(this.batchAckPacketQueue.push(r),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(r.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(r.packetNumber<=this.lastOrderedPacketNumber){const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}else if(r.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[r.packetNumber-this.lastOrderedPacketNumber-2]=r;const i={ackSendTs:r.sendTs,maxAckPacketNumber:r.packetNumber,shift:0,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending ack packet"),i,"packetNumber: ".concat(r.packetNumber)),this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const r={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Vo.Ack,version:this.version};G("DC_DEBUG_LOG")&&R.debug("[".concat(this.ID,"] sending batch ack packet"),r,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(r),this.batchAckPacketQueue=[]}sendPacket(r){r.type===Vo.Default&&(r.sendTs=Math.round(performance.now()));const i=this.serialize(r);this.sendImpl(i)}clearRTO(r){for(let i=r.maxAckPacketNumber-r.shift;i<=r.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);s!==void 0&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class j$ extends X0e{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),L(this,"_initMutex",void 0),L(this,"_reconnectInterrupter",void 0),L(this,"_url",void 0),L(this,"_transmitter",void 0),L(this,"_addresses",void 0),L(this,"_reliableTransmission",void 0),L(this,"_textEncoder",void 0),L(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new Rr("datachannel");const{timeout:s,timeoutFactor:c}=i,u=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*c)/10);Ti.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h),jn.on(Nu.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===Ti.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;const s=(c,u)=>{this._addresses=r,this.currentURLIndex=this._addresses.findIndex(m=>m.fingerprint||G("FINGERPRINT"));const h=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(h).then(c).catch(u),this.once(lr.CLOSED,()=>u(new ce(H.WS_DISCONNECT))),this.once(lr.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new ke((u,h)=>{s(u,h)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ce(H.WS_ABORT,"datachannel is not ready");try{i||(r=JSON.stringify(r));const s=this._textEncoder.encode(r),c=l0e(s,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(s){throw new ce(H.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(r){const i=JSON.stringify(r);return{compressed:i,compressedLength:i.length,origin:r}}sendMessageWithUint8Array(r){return{compressed:r,compressedLength:r.byteLength,origin:r}}createTransmitterConnection(r){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(r.ip,":").concat(r.port),new ke((i,s)=>{var c;const u=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),i()},h=async _=>{var x;if((x=this._closeEstablishingTransmitter)===null||x===void 0||x.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ea(this,lr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,C=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!C)return s(new ce(H.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);i()}else s(new ce(H.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},m=async _=>{try{var x;(x=this._reliableTransmission)===null||x===void 0||x.onData(_.data)}catch(S){console.log(S)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(r)));const g=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),y=Date.now();er(this,lr.TO_CONNECT_DATACHANNEL).then(_=>{var x,S;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:C,close:M}=_;this._transmitter=C,(x=this._store)===null||x===void 0||x.signalChannelOpen();const D=Date.now()-y;R.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new J0e(j=>{var $;this._transmitter&&this._transmitter.readyState==="open"&&(($=this._transmitter)===null||$===void 0||$.send(j))},j=>{if(typeof j=="string")this.emit(lr.ON_MESSAGE,j);else{const $=u0e(j,{raw:!0}).buffer,K=this._textDecoder.decode($);this.emit(lr.ON_MESSAGE,K)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,M()},u&&u(),C.onclose=h,C.onmessage=m,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(_=>{var x;if((x=this._store)===null||x===void 0||x.recordJoinChannelService({endTs:Date.now(),status:_ instanceof ce&&_.code===H.WS_ABORT?"aborted":"error",errors:[_]},g),this.state!=="closed"){if(_ instanceof ce&&_.code===H.WS_ERR){const S=new ce(H.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(S)),void s(S)}h&&h(_)}else s(new ce(H.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||jn.networkState!==Ti.OFFLINE||(this._onlineReconnectListener=jn.onlineWaiter&&jn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let s=!0;if(this._reconnectInterrupter=()=>{s=!1},i){const m=_b(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(m,"ms to reconnect datachannel, mode: ").concat(r)),await ke.race([yr(m),this._onlineReconnectListener||new ke(()=>{})])}if(this.state==="closed"||!s)return!1;this._reconnectCount+=1;const c=async(m,g)=>{this.emit(lr.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(m)};try{if(r==="retry"){const m=this._addresses[this.currentURLIndex];await c(m,r)}else if(r==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||G("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const m=this._addresses[this.currentURLIndex];await c(m,r)}else r==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(lr.FAILBACK));return!0}catch(m){var u,h;return R.error("[".concat(this._name,"] reconnect failed"),m.toString()),m!=null&&(u=m.data)!==null&&u!==void 0&&u.desc&&Array.isArray(m.data.desc)&&m.data.desc.length&&Re(h=m.data.desc).call(h,"dynamic key expired")?(this.emit(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(r,i)}}}class Q0e extends An{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kt.CONNECTED?this.emit(ze.WS_CONNECTED):r===kt.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):r===kt.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(R.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(r=>{let{type:i,message:s}=r;this.emit(i,s),i===mt.ON_NOTIFICATION&&this.handleNotification(s),i===mt.ON_USER_BANNED&&this.handleUserBanned(s)}),this.pendingNotifications=[])}handleUserBanned(r){switch(r.error_code){case 14:this.close(Dt.UID_BANNED);break;case 15:this.close(Dt.IP_BANNED);break;case 16:this.close(Dt.CHANNEL_BANNED)}}constructor(r,i){super(),L(this,"__name__","DataChannelSignal"),L(this,"_disconnectedReason",void 0),L(this,"_websocketReconnectReason",void 0),L(this,"_connectionState",kt.CLOSED),L(this,"reconnectToken",void 0),L(this,"websocket",void 0),L(this,"openConnectionTime",void 0),L(this,"clientId",void 0),L(this,"lastMsgTime",Date.now()),L(this,"uploadCache",[]),L(this,"uploadCacheInterval",void 0),L(this,"rttRolling",new QR(5)),L(this,"pingpongTimer",void 0),L(this,"inflateDataTimer",void 0),L(this,"pingpongTimeoutCount",0),L(this,"ortc",void 0),L(this,"joinResponse",void 0),L(this,"multiIpOption",void 0),L(this,"initError",void 0),L(this,"spec",void 0),L(this,"store",void 0),L(this,"isJoining",!1),L(this,"pendingNotifications",[]),L(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,s);const c=JSON.parse(s);if(G("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===mt.ON_NOTIFICATION||c._type===mt.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===mt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===mt.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),R.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===mt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===mt.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new j$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kt.CONNECTED&&this.reconnect("retry",ad.OFFLINE)})}async request(r,i,s,c){const u=en(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,g=()=>new ke((M,D)=>{if(this.connectionState===kt.CONNECTED)return M();const j=()=>{this.off(ze.WS_CLOSED,$),M()},$=()=>{this.off(ze.WS_CONNECTED,j),D(new ce(H.WS_ABORT))};this.once(ze.WS_CONNECTED,j),this.once(ze.WS_CLOSED,$),r!==Xe.PUBLISH&&r!==Xe.SUBSCRIBE&&r!==Xe.UNSUBSCRIBE&&r!==Xe.UNPUBLISH&&r!==Xe.CONTROL&&r!==Xe.RESTART_ICE||this.once(ze.DISCONNECT_P2P,()=>{D(new ce(H.DISCONNECT_P2P))}),r!==Xe.PUBLISH&&r!==Xe.RESTART_ICE||this.once(ze.ABORT_P2P_EXECUTION,()=>{D(new ce(H.DISCONNECT_P2P))})});if(this.connectionState!==kt.CONNECTING&&this.connectionState!==kt.RECONNECTING||r===Xe.JOIN||r===Xe.REJOIN||await g(),r===Xe.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),G("DC_DEBUG_LOG")&&R.debug("[datachannel-signal] sendMessage",h),await this.websocket.sendMessage(h,!0,!1),c)return;const y=new ke((M,D)=>{let j=!1;const $=(J,ne)=>{j=!0,M({isSuccess:J==="success",message:ne||{}}),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.emit(ze.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),$);const K=()=>{D(new ce(H.WS_ABORT,"type: ".concat(r))),this.off(ze.WS_CLOSED,K),this.off(ze.WS_RECONNECTING,K),this.off("res-@".concat(u),$)};this.once(ze.WS_CLOSED,K),this.once(ze.WS_RECONNECTING,K),yr(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(R.warning("dc request timeout, type: ".concat(r)),this.emit(ze.REQUEST_TIMEOUT,r,i))})});let _=null;try{_=await y}catch(M){if(this.connectionState===kt.CLOSED||r===Xe.LEAVE)throw new ce(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?M.throw():r===Xe.JOIN||r===Xe.REJOIN?null:(await g(),await this.request(r,i))}if(_.isSuccess)return _.message;const x=Number(_.message.error_code||_.message.code),S=Wu(x),C=new ce(H.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:x,data:_.message});return S.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(x,", message: ").concat(S.desc,", action: ").concat(S.action)),x===tt.ERR_TOO_MANY_BROADCASTERS?((r===Xe.JOIN||r===Xe.REJOIN)&&(this.initError=C,this.close()),C.throw()):S.action==="failed"?C.throw():S.action==="quit"?(this.initError=C,this.close(),C.throw()):(x===tt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ad.MULTI_IP)):this.reconnect(S.action,ad.SERVER_ERROR),r===Xe.JOIN||r===Xe.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ke(s=>{const c=u=>{(!i||i(u))&&(this.off(r,c),s(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void R.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(Gu.WRTC_STATS,i)}upload(r,i){const s={_type:r,_message:i};try{this.websocket.sendMessage(s)}catch{const u=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(r,i){const s={_type:r,_message:i};await this.websocket.sendMessage(s)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ke((i,s)=>{this.once(ze.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ze.WS_CLOSED,()=>s(this.initError||new ce(H.WS_ABORT))),this.connectionState=kt.CONNECTING,this.websocket.init(r).catch(s),this.websocket.once(lr.FAILBACK,()=>{s(new ce(H.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new ce(H.INIT_DATACHANNEL_TIMEOUT)))},G("DC_JOIN_WITH_FAILBACK"))})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=r||Dt.LEAVE,this.connectionState=kt.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),r===Dt.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new j$("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await er(this,ze.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const i=await this.request(Xe.JOIN,r);if(this.store.joinRep(),this.ortc=r==null?void 0:r.ortc,!i)return this.emit(ze.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new ce(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Ru(this,ze.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Xe.REJOIN,r);return!!i&&(this.connectionState=kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),G("DC_PINGPONG_INTERVAL")),i.peers&&i.peers.forEach(s=>{this.emit(mt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(mt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(mt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(mt.MUTE_AUDIO,{uid:s.uid}):this.emit(mt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(mt.MUTE_VIDEO,{uid:s.uid}):this.emit(mt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(mt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(mt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(mt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(mt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(mt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Xe.DOWNGRADE_CODEC,i)}handleNotification(r){R.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Wu(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Dt.UID_BANNED),void this.close()):void this.reconnect(i.action,ad.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,G("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const r=G("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(R.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",ad.FALLBACK):this.request(Xe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),G("REPORT_STATS")&&this.send(Xe.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:r,deflateLength:i}=this.websocket.getInflateData();r!==0&&i!==0&&this.upload(Gu.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(lr.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(lr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lr.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.websocket.on(lr.FAILED,()=>{this._disconnectedReason=Dt.NETWORK_ERROR,this.connectionState=kt.CLOSED}),this.websocket.on(lr.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kt.CONNECTED?this.connectionState=kt.RECONNECTING:this.connectionState=kt.CONNECTING}),this.websocket.on(lr.WILL_RECONNECT,(r,i)=>{if(Ru(this,ze.IS_P2P_DISCONNECTED)&&r==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ze.NEED_RENEW_SESSION),this.emit(ze.DISCONNECT_P2P),i("tryNext");r!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(ze.NEED_RENEW_SESSION),this.emit(ze.DISCONNECT_P2P)),i(r)}),this.websocket.on(lr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",ad.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof ce&&r.code===H.UNEXPECTED_RESPONSE&&r.data.code===tt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ad.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ad.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(lr.REQUEST_NEW_URLS,(r,i)=>{er(this,ze.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(lr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(lr.TO_CONNECT_DATACHANNEL,(r,i)=>{er(this,ze.PRE_CONNECT_PC).then(r).catch(i)}),this.websocket.on(lr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ze.DATACHANNEL_FAILBACK)})}}const Z0e={name:"DataChannelConnection",create:function(t){let{store:r,spec:i}=t;return new q0e(i,r)}},e_e={name:"DataChannelSignal",create:function(t){let{store:r,spec:i}=t;return new Q0e(i,r)}};iA(),sn("PROCESS_ID","process-".concat(en(8,""),"-").concat(en(4,""),"-").concat(en(4,""),"-").concat(en(4,""),"-").concat(en(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void R.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),i=Date.now();R.debug("Loading global parameters from cache",r),Object.keys(r).forEach(s=>{if(Object.prototype.hasOwnProperty.call(tn,s)){const{value:c,expires:u}=r[s];if(u&&u<=i)return;Fa[s]=c,tn[s]=c}})}catch(r){R.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Fa.AREAS)&&Fa.AREAS.length>0&&aI(Fa.AREAS,!0);const L$=(t,r,i)=>{R.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),sn(t,r,i)};xc(g0e,!1),xc(_0e,!1),xc(qve,!1),xc(I0e,!1),xc(p0e,!1),xc(G0e,!1),xc(H0e,!1),xc(K0e,!1),xc(Z0e,!1),xc(e_e,!1);const tr=function(t){const r=new An,i=t,s={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===_c.SECURITY_POLICY_VIOLATION&&dW(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return lW(lW({},i),s)}({__TRACK_LIST__:ku,VERSION:cs,BUILD:oA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:L$,getParameter:G,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(s){let c;return It().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return t;r.close(),r=null,t=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new ce(H.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const r=$e.reportApiInvoke(null,{name:Tn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:dn.TRACER}),i=function(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],h=!1;try{const m=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,y=window.WebSocket;h=!(!m||!y),u&&!g&&(h=!1),h&&Vg()&&EF(75)&&new m().close()}catch(m){R.error("check system requirement failed: ",m),h=!1}return h}(t),s=Jve();R.debug("checkSystemRequirements, api:",i,"browser",s);const c=i&&s;return r.onSuccess(c),G("IGNORE_RTC_DEVICE_CHECK")?i:c},getDevices:function(t){return $a.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return $a.getRecordingDevices(t)},getCameras:function(t){return $a.getCamerasDevices(t)},getElectronScreenSources:CV,getPlaybackDevices:function(t){return $a.getSpeakers(t)},createClient:sW,createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=G("CAMERA_CAPTURE_CONFIG"),i=en(8,"track-cam-"),s=$e.reportApiInvoke(null,{id:i,tag:dn.TRACER,name:Tn.CREATE_CAM_VIDEO_TRACK,options:[_n({},t),r]});r&&(t.encoderConfig=r);const c=Pb(t);let u=null;R.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{u=(await Wa({video:c},i)).getVideoTracks()[0]||null}catch(m){throw s.onError(m),m}if(!u){const m=new he(H.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(m),m.throw(R)}if(t.optimizationMode&&CA(i,u,t,Ws(t.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const m=Ws(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new kb(u,t,c,t.scalabiltyMode?Rb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s.onSuccess(h.getTrackId()),R.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(t){const r=en(8,"track-cus-"),i=$e.reportApiInvoke(null,{id:r,tag:dn.TRACER,name:Tn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});G("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const s=new un(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Rb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Qt.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),R.info("create custom video track success with config",t,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(S){const C=LV(S);return fV()&&S.suppressLocalAudioPlayback&&(C.suppressLocalAudioPlayback=S.suppressLocalAudioPlayback),gV()&&S.restrictOwnAudio&&(C.restrictOwnAudio=!0),C}(r):void 0;i&&(r="auto");const s=en(8,"track-scr-v-"),c=$e.reportApiInvoke(null,{id:s,tag:dn.TRACER,name:Tn.CREATE_SCREEN_VIDEO_TRACK,options:[_n({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(S){const C={};S.screenSourceType&&(C.mediaSource=S.screenSourceType),S.extensionId&&tl()&&(C.extensionId=S.extensionId);const{displaySurface:M,selfBrowserSurface:D,surfaceSwitching:j,systemAudio:$,preferCurrentTab:K,windowAudio:J,monitorTypeSurfaces:ne}=S;(No(107)||ed(107)||Tu(93))&&(M&&(Kn(M,"displaySurface",["browser","window","monitor"]),C.displaySurface=M),D?(Kn(D,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=D):C.selfBrowserSurface="include",j&&(Kn(j,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=j)),(No(105)||ed(105)||Tu(91))&&$&&(Kn($,"systemAudio",["exclude","include"]),C.systemAudio=$),(No(94)||ed(94)||Tu(80))&&K&&(C.preferCurrentTab=!0),(No(141)||ed(141)||Tu(125))&&J&&(Kn(J,"windowAudio",["exclude","system"]),C.windowAudio=J),(No(119)||ed(119)||Tu(105))&&ne&&(Kn(ne,"monitorTypeSurfaces",["exclude","include"]),C.monitorTypeSurfaces=ne),S.electronScreenSourceId&&(C.sourceId=S.electronScreenSourceId);const ae=S.encoderConfig?pA(S.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(C.mandatory.maxFrameRate=ae.frameRate,C.mandatory.minFrameRate=ae.frameRate):(C.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,C.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),C.frameRate=ae.frameRate),ae.width&&(C.width=ae.width),ae.height&&(C.height=ae.height)),C}(t);let h=null,m=null;const g=It();if(!g.supportShareAudio&&r==="enable"){const S=new he(H.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(S),S.throw(R)}R.info("start create screen video track with config",t,"withAudio",r,"trackId",s);const y=g.supportShareAudio&&r!=="disable";try{const S=await Wa({screen:u,screenAudio:y?i||!0:void 0},s);h=S.getVideoTracks()[0]||null,m=S.getAudioTracks()[0]||null}catch(S){throw c.onError(S),S}if(!h){const S=new he(H.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(S),S.throw(R)}if(!m&&r==="enable"){h&&h.stop();const S=new he(H.SHARE_AUDIO_NOT_ALLOWED);return c.onError(S),S.throw(R)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(CA(s,h,t,t.encoderConfig&&pA(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const _=new un(h,t.encoderConfig?pA(t.encoderConfig):{},t.scalabiltyMode?Rb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s,[Qt.SCREEN_TRACK]);if(!m)return c.onSuccess(_.getTrackId()),R.info("create screen video track success","video:",_.getTrackId()),_;const x=new Vn(m,void 0,en(8,"track-scr-a-"),!1);return c.onSuccess([_.getTrackId(),x.getTrackId()]),R.info("create screen video track success","video:",_.getTrackId(),"audio:",x.getTrackId()),[_,x]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=G("CAMERA_CAPTURE_CONFIG"),s=en(8,"track-mic-"),c=en(8,"track-cam-"),u=$e.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:dn.TRACER,name:Tn.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,i]});i&&(r.encoderConfig=i);const h=Pb(r),m=MV(t);let g=null,y=null;R.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const S=await Wa({audio:m,video:h},"".concat(s,"-").concat(c));g=S.getAudioTracks()[0],y=S.getVideoTracks()[0]}catch(S){throw u.onError(S),S}if(!g||!y){const S=new he(H.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(S),S.throw(R)}if(r.optimizationMode&&CA(c,y,r,Ws(r.encoderConfig)),G("USE_STANDARD_BITRATE_DEFAULT")){const S=Ws(r.encoderConfig);r.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const _=new Xg(g,t,m,s),x=new kb(y,r,h,r.scalabiltyMode?Rb(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([_.getTrackId(),x.getTrackId()]),R.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[_,x]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=en(8,"track-mic-"),i=$e.reportApiInvoke(null,{id:r,tag:dn.TRACER,name:Tn.CREATE_MIC_AUDIO_TRACK,options:[t]}),s=MV(t);let c=null;R.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Wa({audio:s},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new he(H.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(R)}const u=new Xg(c,t,s,r);return i.onSuccess(u.getTrackId()),R.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:l6,createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:i,encoderConfig:s}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:s},h=en(8,"track-buf-"),m=$e.reportApiInvoke(null,{id:h,tag:dn.TRACER,name:Tn.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(G("DISABLE_WEBAUDIO"))throw new he(H.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");R.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(x,S){let C=null;if(typeof x=="string"){const D=wB.get(x);if(D)return R.debug("use cached audio resource: ",x),D;try{C=(await Ro(()=>Ui.get(x,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new he(H.FETCH_AUDIO_FILE_FAILED,j.toString())}}else C=await new ke((j,$)=>{const K=new FileReader;K.onload=J=>{J.target?j(J.target.result):$(new he(H.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{$(new he(H.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(x)});const M=await function(D){const j=Wp();return new ke(($,K)=>{j.decodeAudioData(D,J=>{$(J)},J=>{K(new he(H.DECODE_AUDIO_FILE_FAILED,J.toString()))})})}(C);return typeof x=="string"&&S&&wB.set(x,M),M}(c,i)}catch(x){return m.onError(x),x.throw(R)}const y=new gge(c),_=new fge(g,y,s?Ab(s):{},h);return R.info("create buffer source audio track success, trackId:",h),m.onSuccess(_.getTrackId()),_},setAppType:function(t){if(R.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw R.debug("Invalid appType"),new ce(H.INVALID_PARAMS,"invalid app type",t);sn("APP_TYPE",Math.floor(t))},setLogLevel:function(t){R.setLogLevel(t)},enableLogUpload:function(){G("USE_NEW_LOG")?sn("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?sn("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new N8},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=$e.reportApiInvoke(null,{tag:dn.TRACER,name:Tn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Vn||t instanceof zp)){const g=new ce(H.INVALID_TRACK,"the parameter is not a audio track");return i.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof Vn?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ke(g=>{const y=setInterval(()=>{const _=t.getVolumeLevel();u=_>u?_:u,h=_<h?_:h;const x=u-h>1e-4,S=Date.now()-m;if(x||S>r){clearInterval(y);const C=x,M={duration:S,deviceLabel:s,maxVolumeLevel:u,result:C};R.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(M))),i.onSuccess(M),g(C)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=$e.reportApiInvoke(null,{tag:dn.TRACER,name:Tn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof un||t instanceof Hp)){const x=new ce(H.INVALID_TRACK,"the parameter is not a video track");return i.onError(x),x.throw()}r&&r<1e3&&(r=1e3);const s=t instanceof un?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Nr()||gb())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const x=Date.now();m=await function(S,C,M,D){let j,$=0,K=null;return new ke((J,ne)=>{function ae(){$>D&&j&&(j(),J($));const Q=M.getContext("2d");if(!Q){const Ee=new ce(H.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(Ee.toString()),void ne(Ee)}Q.drawImage(S,0,0,160,120);const oe=Q.getImageData(0,0,M.width,M.height),ge=Math.floor(oe.data.length/3);if(K){for(let Ee=0;Ee<ge;Ee+=3)if(oe.data[Ee]!==K[Ee])return $+=1,void(K=oe.data);K=oe.data}else K=oe.data}setTimeout(()=>{j&&(j(),J($))},C),j=_A(()=>{ae()},30)})}(u,r,h,4),g=Date.now()-x}catch(x){throw i.onError(x),x}jve===Kt.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,_={duration:g,changedPicNum:m,deviceLabel:s,result:y};return R.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),i.onSuccess(_),y},setArea:aI,audioElementPlayCenter:hi,resumeAudioContext:function(){return hi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){Zve.processExternalMediaAEC(t)},registerExtensions:function(t){const r=G("PLUGIN_INFO")||[];t.forEach(i=>{"name"in i&&!Re(r).call(r,i.name)&&r.push(i.name);const s=i;s.__registered__=!0,s.logger.hookLog=R.extLog,s.reporter.hookApiInvoke=$e.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(c=>{s.parameters[c]=G(c)})}),L$("PLUGIN_INFO",r)},ChannelMediaRelayError:qp,ChannelMediaRelayEvent:al,ChannelMediaRelayState:ta,RemoteStreamFallbackType:lge,RemoteStreamType:cge,ConnectionDisconnectedReason:Dt,AudienceLatencyLevelType:Mfe,AREAS:Xt,preload:async function(t,r,i,s){return NI(t,r,i,s)},startLastmileProbeTest:async function(t,r,i,s){let c={state:"unavailable"};await NI(t,r,i,s);const u=await RI({appId:t,cname:r,token:i||t,uid:s,cloudProxyServer:"disabled"});if(!u)return c;await AI(u);let h,m=sW({mode:"rtc",codec:"vp8"});try{h=await m.join(t,r,i,s,{networkQualityProbe:!0})}catch{return c}const g=new Fve,y=g.createMuteAudioTrack();let _=await l6({mediaStreamTrack:y});await m.publish([_]);let[x,S,C]=await new ke((J,ne)=>{const ae=setTimeout(()=>{clearTimeout(ae),J([!0,null,"audio"])},5e3);m.on("user-published",async(Q,oe)=>{Q.uid===h&&(clearTimeout(ae),J([!1,Q,oe]))})});if(x||!S)return await m.unpublish([_]),await m.leave(),_.close(),g.close(),c;await m.subscribe(S,C),await new ke((J,ne)=>{const ae=setTimeout(()=>{clearTimeout(ae),J(null)},5e3)});let M=m.getRTCStats(),D=m.getLocalAudioStats();const j=M.RTT,$=D.sendJitterMs,K=D.currentPacketLossRate;return c={state:"complete",rtt:j,packetLossRate:K,jitter:$,networkQuality:((J,ne,ae)=>{let Q=1;if(ae>0){let ht=Math.log(100*ae)/Math.log(2)+1;ht=Math.min(5,Math.max(0,ht)),Q=1-ht/5}let oe=1;if(J>0){let ht=Math.log(J/40)/Math.log(2)+1;ht=Math.min(5,Math.max(0,ht)),oe=1-ht/5}let ge=1;if(ne>0){let ht=Math.log(ne/10)/Math.log(2.5)+1;ht=Math.min(5,Math.max(0,ht)),ge=1-ht/5}const Ee=.5*Q+.3*oe+.2*ge;let Fe=0;return Fe=Ee>=.8?1:Ee>=.6?2:Ee>=.4?3:Ee>=.2?4:5,Fe})(j,$,K)},await m.unsubscribe(S),await m.unpublish([_]),await m.leave(),_.close(),g.close(),await AI(u),c}});return Object.defineProperties(tr,{onAudioAutoplayFailed:{get:()=>Vi.onAudioAutoplayFailed,set:t=>{Vi.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Vi.onAutoplayFailed,set:t=>{Vi.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>tr._onSecurityPolicyViolation,set(t){tr._onSecurityPolicyViolation=t,dW(t)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?Vu:[]}}),$a.on(Lu.CAMERA_DEVICE_CHANGED,t=>{R.info("camera device changed",JSON.stringify(t)),tr.onCameraChanged&&tr.onCameraChanged(t),tr.safeEmit(_c.CAMERA_CHANGED,t)}),$a.on(Lu.RECORDING_DEVICE_CHANGED,t=>{R.info("microphone device changed",JSON.stringify(t)),tr.onMicrophoneChanged&&tr.onMicrophoneChanged(t),tr.safeEmit(_c.MICROPHONE_CHANGED,t)}),$a.on(Lu.PLAYOUT_DEVICE_CHANGED,t=>{R.debug("playout device changed",JSON.stringify(t)),tr.onPlaybackDeviceChanged&&tr.onPlaybackDeviceChanged(t),tr.safeEmit(_c.PLAYBACK_DEVICE_CHANGED,t)}),hi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Vi.onAudioAutoplayFailed&&Vi.onAudioAutoplayFailed()},on.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Vi.onAudioAutoplayFailed&&Vi.onAudioAutoplayFailed(),tr.safeEmit(_c.AUTOPLAY_FAILED)}),on.on(Ur.STATE_CHANGE,(t,r)=>{R.info("audio context state changed: ".concat(r," => ").concat(t)),tr.onAudioContextStateChanged&&tr.onAudioContextStateChanged(t,r),tr.safeEmit(_c.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),jn.on(Nu.NETWORK_STATE_CHANGE,(t,r)=>{R.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=tr),tr})})(Mte);var lKe=Mte.exports;const Jm=ar(lKe);function dKe(){var Se,we,qe,lt,Ut,Ht,Ue,dt,Ne,Ke,bt;const{appointmentId:e}=Vw(),n=Is(),[a,o]=q.useState(null),[d,p]=q.useState(!0),[f,v]=q.useState(!1),[b,E]=q.useState("video"),[T,w]=q.useState([]),[N,P]=q.useState(""),[A,k]=q.useState({video:!0,audio:!0,speaker:!0}),[I,F]=q.useState(null),[U,V]=q.useState(null),[W,B]=q.useState(null),[z,Y]=q.useState([]),[re,Z]=q.useState(!1),ie=q.useRef(null),te=q.useRef(null);q.useEffect(()=>(me(),de(),()=>{xe()}),[e]);const de=()=>{const Te=Jm.createClient({mode:"rtc",codec:"vp8"});Te.on("user-published",async(gt,Qe)=>{await Te.subscribe(gt,Qe),Qe==="video"&&(Y(Ft=>[...Ft.filter(At=>At.uid!==gt.uid),gt]),te.current&&gt.videoTrack.play(te.current)),Qe==="audio"&&gt.audioTrack.play()}),Te.on("user-unpublished",gt=>{Y(Qe=>Qe.filter(Ft=>Ft.uid!==gt.uid))}),Te.on("user-left",gt=>{Y(Qe=>Qe.filter(Ft=>Ft.uid!==gt.uid))}),F(Te)},xe=async()=>{U&&(U.stop(),U.close()),W&&(W.stop(),W.close()),I&&re&&await I.leave()},me=async()=>{try{const{data:Te}=await Ja.getAppointmentDetails(e);o(Te)}catch{it.error("Failed to load appointment details"),n("/doctors")}finally{p(!1)}},Ce=async()=>{if(!I||!(a!=null&&a.videoRoom)){it.error("Video call not available");return}try{const{config:Te}=a.videoRoom;if(Te.type==="agora"&&Te.appId&&Te.token){await I.join(Te.appId,Te.channelName,Te.token,Te.uid);const gt=await Jm.createCameraVideoTrack(),Qe=await Jm.createMicrophoneAudioTrack();V(gt),B(Qe),ie.current&&gt.play(ie.current),await I.publish([gt,Qe]),Z(!0),it.success("Joined video call successfully")}else it.error("Video call configuration not available")}catch(Te){console.error("Error joining video call:",Te),it.error("Failed to join video call")}},ue=async()=>{try{await xe(),Z(!1),Y([]),it.success("Left video call")}catch(Te){console.error("Error leaving video call:",Te)}},be=async()=>{try{await Ja.startConsultation(e),v(!0),(a==null?void 0:a.type)==="video"&&await Ce(),it.success("Consultation started")}catch{it.error("Failed to start consultation")}},se=async()=>{try{re&&await ue(),await Ja.endConsultation(e),v(!1),it.success("Consultation ended"),n("/consultation-summary/"+e)}catch{it.error("Failed to end consultation")}},pe=()=>{if(!N.trim())return;const Te={id:Date.now(),text:N,sender:"patient",timestamp:new Date};w([...T,Te]),P("")},De=async Te=>{if(Te==="video"&&U){const gt=!A.video;await U.setEnabled(gt),k(Qe=>({...Qe,video:gt}))}else if(Te==="audio"&&W){const gt=!A.audio;await W.setEnabled(gt),k(Qe=>({...Qe,audio:gt}))}else Te==="speaker"&&k(gt=>({...gt,speaker:!gt.speaker}))};return d?l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):a?l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a]",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(co,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-lg font-bold text-white",children:((qe=(we=(Se=a.doctor)==null?void 0:Se.name)==null?void 0:we[0])==null?void 0:qe.toUpperCase())||"D"}),l.jsxs("div",{children:[l.jsxs("h1",{className:"text-lg font-bold text-white",children:["Dr. ",(lt=a.doctor)==null?void 0:lt.name]}),l.jsx("p",{className:"text-sm text-slate-400",children:(Ut=a.doctor)==null?void 0:Ut.specialization})]})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.status==="confirmed"?"bg-green-500/20 text-green-400":a.status==="pending"?"bg-yellow-500/20 text-yellow-400":"bg-slate-500/20 text-slate-400"}`,children:a.status})})]})}),f?l.jsxs("div",{className:"h-[calc(100vh-80px)] flex",children:[l.jsxs("div",{className:"flex-1 bg-slate-900 relative",children:[b==="video"&&l.jsxs("div",{className:"h-full relative",children:[l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:z.length>0?l.jsx("div",{ref:te,className:"w-full h-full",style:{background:"#1e293b"}}):l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-4xl font-bold text-white mx-auto mb-4",children:((Ke=(Ne=(dt=a.doctor)==null?void 0:dt.name)==null?void 0:Ne[0])==null?void 0:Ke.toUpperCase())||"D"}),l.jsxs("p",{className:"text-white text-lg",children:["Dr. ",(bt=a.doctor)==null?void 0:bt.name]}),l.jsx("p",{className:"text-slate-400",children:re?"Waiting for doctor to join...":"Video consultation ready"})]})}),re&&l.jsxs("div",{className:"absolute top-4 right-4 w-48 h-36 bg-slate-800 rounded-lg overflow-hidden border-2 border-slate-600",children:[l.jsx("div",{ref:ie,className:"w-full h-full",style:{background:"#1e293b"}}),l.jsx("div",{className:"absolute bottom-2 left-2 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"You"})]}),l.jsx("div",{className:"absolute top-4 left-4",children:l.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${re?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${re?"bg-green-400":"bg-yellow-400"} animate-pulse`}),re?"Connected":"Connecting..."]})}),re&&l.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm",children:[l.jsx(of,{className:"w-4 h-4"}),z.length+1," participants"]})})]}),l.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2",children:l.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/90 backdrop-blur-sm rounded-full px-6 py-3",children:[l.jsx("button",{onClick:()=>De("audio"),className:`p-3 rounded-full transition-colors ${A.audio?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.audio?"Mute microphone":"Unmute microphone",children:A.audio?l.jsx(kJ,{className:"w-5 h-5"}):l.jsx(DJ,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>De("video"),className:`p-3 rounded-full transition-colors ${A.video?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.video?"Turn off camera":"Turn on camera",children:A.video?l.jsx(s2,{className:"w-5 h-5"}):l.jsx(wP,{className:"w-5 h-5"})}),l.jsx("button",{onClick:()=>De("speaker"),className:`p-3 rounded-full transition-colors ${A.speaker?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,title:A.speaker?"Mute speaker":"Unmute speaker",children:A.speaker?l.jsx(NTe,{className:"w-5 h-5"}):l.jsx(RTe,{className:"w-5 h-5"})}),l.jsx("button",{className:"p-3 rounded-full bg-slate-700 text-white hover:bg-slate-600 transition-colors",title:"Share screen",children:l.jsx(_Te,{className:"w-5 h-5"})}),l.jsx("button",{onClick:se,className:"p-3 rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors",title:"End consultation",children:l.jsx(Ji,{className:"w-5 h-5"})})]})})]}),l.jsxs("div",{className:"w-80 bg-[#111827] border-l border-slate-700 flex flex-col",children:[l.jsx("div",{className:"p-4 border-b border-slate-700",children:l.jsx("h3",{className:"text-white font-medium",children:"Chat"})}),l.jsx("div",{className:"flex-1 p-4 overflow-y-auto space-y-3",children:T.map(Te=>l.jsx("div",{className:`flex ${Te.sender==="patient"?"justify-end":"justify-start"}`,children:l.jsx("div",{className:`max-w-xs px-3 py-2 rounded-lg text-sm ${Te.sender==="patient"?"bg-cyan-500 text-white":"bg-slate-700 text-white"}`,children:Te.text})},Te.id))}),l.jsx("div",{className:"p-4 border-t border-slate-700",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:N,onChange:Te=>P(Te.target.value),onKeyPress:Te=>Te.key==="Enter"&&pe(),placeholder:"Type a message...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:pe,className:"bg-cyan-500 hover:bg-cyan-600 text-white p-2 rounded-lg transition-colors",children:l.jsx(Bf,{className:"w-4 h-4"})})]})})]})]}):l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Appointment Details"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ji,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Date & Time"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[new Date(a.date).toLocaleDateString()," at ",a.timeSlot]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Kd,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Consultation Type"}),l.jsx("p",{className:"text-slate-400 text-sm capitalize",children:a.type})]})]}),a.symptoms&&l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(li,{className:"w-5 h-5 text-cyan-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Symptoms"}),l.jsx("p",{className:"text-slate-400 text-sm",children:a.symptoms})]})]})]})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h2",{className:"text-lg font-bold text-white mb-6",children:"Doctor Information"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(RJ,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Experience"}),l.jsxs("p",{className:"text-slate-400 text-sm",children:[((Ht=a.doctor)==null?void 0:Ht.experience)||"5+"," years"]})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(xP,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Location"}),l.jsx("p",{className:"text-slate-400 text-sm",children:((Ue=a.doctor)==null?void 0:Ue.location)||"Online"})]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(zc,{className:"w-5 h-5 text-cyan-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white font-medium",children:"Rating"}),l.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(Te=>l.jsx(zc,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},Te)),l.jsx("span",{className:"text-slate-400 text-sm ml-1",children:"(4.8)"})]})]})]})]})]})]}),l.jsx("div",{className:"mt-8 text-center",children:l.jsxs("button",{onClick:be,className:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-8 py-4 rounded-xl font-medium transition-all inline-flex items-center gap-2",children:[l.jsx(Kd,{className:"w-5 h-5"}),"Start Consultation"]})})]})]}):l.jsxs("div",{className:"text-center py-12",children:[l.jsx(Aa,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Appointment Not Found"}),l.jsx("p",{className:"text-slate-400",children:"The appointment you're looking for doesn't exist."})]})}function uKe(){const{appointmentId:e}=Vw(),n=Is(),[a,o]=q.useState(null),[d,p]=q.useState(!0),[f,v]=q.useState(0),[b,E]=q.useState(""),[T,w]=q.useState(!1),[N,P]=q.useState("summary");q.useEffect(()=>{A()},[e]);const A=async()=>{try{const{data:V}=await Ja.getConsultationSummary(e);o(V)}catch{it.error("Failed to load consultation summary"),n("/doctors")}finally{p(!1)}},k=async()=>{if(f===0){it.error("Please provide a rating");return}w(!0);try{await Ja.submitReview(e,{rating:f,review:b}),it.success("Review submitted successfully"),o(V=>({...V,reviewSubmitted:!0}))}catch{it.error("Failed to submit review")}finally{w(!1)}},I=async()=>{try{const V=await Ja.downloadPrescription(e),W=new Blob([V.data],{type:"application/pdf"}),B=window.URL.createObjectURL(W),z=document.createElement("a");z.href=B,z.download=`prescription-${e}.pdf`,z.click(),window.URL.revokeObjectURL(B)}catch{it.error("Failed to download prescription")}};if(d)return l.jsx("div",{className:"flex items-center justify-center min-h-screen",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})});const F={doctor:{name:"Dr. Sarah Johnson",specialization:"General Physician"},date:new Date().toISOString(),duration:"30 minutes",diagnosis:"Vitamin D deficiency with mild fatigue symptoms",prescription:[{medication:"Vitamin D3 Supplement",dosage:"1000 IU daily",duration:"3 months",instructions:"Take with food, preferably in the morning"},{medication:"Multivitamin",dosage:"1 tablet daily",duration:"1 month",instructions:"Take after breakfast"}],recommendations:["Get 15-20 minutes of sunlight exposure daily","Include vitamin D rich foods like fatty fish, eggs, and fortified milk","Regular exercise to improve energy levels","Follow-up blood test in 3 months"],followUp:{date:new Date(Date.now()+90*24*60*60*1e3).toISOString(),type:"Blood test review"},notes:"Patient reported fatigue and low energy levels. Blood work shows vitamin D deficiency at 18 ng/mL (normal: 30-100). Recommended supplementation and lifestyle changes.",reviewSubmitted:!1},U=a||F;return l.jsxs("div",{className:"min-h-screen bg-[#0a0f1a] pb-8",children:[l.jsx("div",{className:"bg-[#111827] border-b border-slate-700 px-4 py-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("button",{onClick:()=>n("/doctors"),className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:l.jsx(co,{className:"w-5 h-5 text-slate-400"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-lg font-bold text-white",children:"Consultation Summary"}),l.jsxs("p",{className:"text-sm text-slate-400",children:[new Date(U.date).toLocaleDateString(),"  ",U.duration]})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:I,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:[l.jsx(IJ,{className:"w-4 h-4"}),"Download"]}),l.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors",children:[l.jsx(CTe,{className:"w-4 h-4"}),"Share"]})]})]})}),l.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[l.jsx("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6 mb-6",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-xl font-bold text-white",children:U.doctor.name[0]}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h2",{className:"text-xl font-bold text-white",children:U.doctor.name}),l.jsx("p",{className:"text-slate-400",children:U.doctor.specialization})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"flex items-center gap-1 mb-1",children:[1,2,3,4,5].map(V=>l.jsx(zc,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},V))}),l.jsx("p",{className:"text-sm text-slate-400",children:"4.8 rating"})]})]})}),l.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-xl w-fit mb-6",children:[l.jsx("button",{onClick:()=>P("summary"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="summary"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Summary"}),l.jsx("button",{onClick:()=>P("prescription"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="prescription"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Prescription"}),l.jsx("button",{onClick:()=>P("followup"),className:`px-4 py-2 rounded-lg font-medium transition-all ${N==="followup"?"bg-slate-700 text-white":"text-slate-400 hover:text-white"}`,children:"Follow-up"})]}),l.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[l.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[N==="summary"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:l.jsx(ir,{className:"w-5 h-5 text-blue-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Diagnosis"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:U.diagnosis})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center",children:l.jsx(li,{className:"w-5 h-5 text-green-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Doctor's Notes"})]}),l.jsx("p",{className:"text-slate-300 leading-relaxed",children:U.notes})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center",children:l.jsx(bi,{className:"w-5 h-5 text-cyan-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Recommendations"})]}),l.jsx("ul",{className:"space-y-3",children:U.recommendations.map((V,W)=>l.jsxs("li",{className:"flex items-start gap-3",children:[l.jsx(bi,{className:"w-5 h-5 text-green-400 mt-0.5 shrink-0"}),l.jsx("span",{className:"text-slate-300",children:V})]},W))})]})]}),N==="prescription"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:l.jsx(Qw,{className:"w-5 h-5 text-purple-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Prescription"})]}),l.jsx("div",{className:"space-y-4",children:U.prescription.map((V,W)=>l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-bold text-white",children:V.medication}),l.jsx("span",{className:"text-sm text-slate-400",children:V.duration})]}),l.jsx("p",{className:"text-cyan-400 font-medium mb-2",children:V.dosage}),l.jsx("p",{className:"text-slate-300 text-sm",children:V.instructions})]},W))}),l.jsx("div",{className:"mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Yw,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-yellow-400 font-medium mb-1",children:"Important"}),l.jsx("p",{className:"text-slate-300 text-sm",children:"Take medications as prescribed. Do not stop or change dosage without consulting your doctor."})]})]})})]}),N==="followup"&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[l.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:l.jsx(ji,{className:"w-5 h-5 text-orange-400"})}),l.jsx("h3",{className:"text-lg font-bold text-white",children:"Follow-up Care"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[l.jsx(ic,{className:"w-5 h-5 text-cyan-400"}),l.jsx("h4",{className:"font-bold text-white",children:"Next Appointment"})]}),l.jsxs("p",{className:"text-slate-300",children:[new Date(U.followUp.date).toLocaleDateString()," - ",U.followUp.type]})]}),l.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl",children:[l.jsx("h4",{className:"font-bold text-white mb-2",children:"Health Tracking"}),l.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Monitor your progress and upload follow-up reports to track improvements."}),l.jsx("button",{className:"bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm transition-colors",children:"Upload Report"})]})]})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(ji,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Book Follow-up"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(k0,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Message Doctor"})]}),l.jsxs("button",{className:"w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-colors",children:[l.jsx(aTe,{className:"w-5 h-5 text-cyan-400"}),l.jsx("span",{className:"text-white",children:"Save to Health Records"})]})]})]}),!U.reviewSubmitted&&l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Rate this Consultation"}),l.jsxs("div",{className:"mb-4",children:[l.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"How was your experience?"}),l.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(V=>l.jsx("button",{onClick:()=>v(V),className:`p-1 transition-colors ${V<=f?"text-yellow-400":"text-slate-600 hover:text-slate-400"}`,children:l.jsx(zc,{className:"w-6 h-6 fill-current"})},V))})]}),l.jsx("textarea",{value:b,onChange:V=>E(V.target.value),placeholder:"Share your feedback (optional)",className:"w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-400 resize-none h-20 focus:outline-none focus:border-cyan-500"}),l.jsx("button",{onClick:k,disabled:T||f===0,className:"w-full mt-4 bg-cyan-500 hover:bg-cyan-600 disabled:bg-slate-600 text-white py-2 rounded-lg transition-colors flex items-center justify-center gap-2",children:T?l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):l.jsxs(l.Fragment,{children:[l.jsx(Bf,{className:"w-4 h-4"}),"Submit Review"]})})]}),l.jsxs("div",{className:"bg-[#111827] rounded-2xl border border-slate-700 p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Health Tracking"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Vitamin D Level"}),l.jsx("span",{className:"text-yellow-400",children:"Improving"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Energy Level"}),l.jsx("span",{className:"text-green-400",children:"Stable"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"text-slate-300",children:"Sleep Quality"}),l.jsx("span",{className:"text-cyan-400",children:"Good"})]})]})]})]})]})]})]})}function hKe(){const[e,n]=q.useState(null),[a,o]=q.useState(null),[d,p]=q.useState(null),[f,v]=q.useState([]),[b,E]=q.useState(!1),[T,w]=q.useState(!0),[N,P]=q.useState(!0),A=q.useRef(null),k=q.useRef(null),I="e788e8f838484d4dafe4705d682df57c",F="healthai-test";q.useEffect(()=>(U(),()=>{B()}),[]);const U=()=>{const re=Jm.createClient({mode:"rtc",codec:"vp8"});re.on("user-published",async(Z,ie)=>{await re.subscribe(Z,ie),ie==="video"&&(v(te=>[...te.filter(de=>de.uid!==Z.uid),Z]),k.current&&Z.videoTrack.play(k.current)),ie==="audio"&&Z.audioTrack.play()}),re.on("user-unpublished",Z=>{v(ie=>ie.filter(te=>te.uid!==Z.uid))}),re.on("user-left",Z=>{v(ie=>ie.filter(te=>te.uid!==Z.uid))}),n(re)},V=async()=>{if(e)try{const re=Math.floor(Math.random()*1e4);let Z=null;try{const xe=await(await fetch("/api/doctors/generate-video-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:F,uid:re})})).json();xe.success&&(Z=xe.token,console.log("Generated token:",Z?"Token received":"No token (testing mode)"))}catch(de){console.log("Failed to get token from server, using null token:",de)}await e.join(I,F,Z,re);const ie=await Jm.createCameraVideoTrack(),te=await Jm.createMicrophoneAudioTrack();o(ie),p(te),A.current&&ie.play(A.current),await e.publish([ie,te]),E(!0),it.success("Joined video call successfully!")}catch(re){console.error("Error joining channel:",re),it.error("Failed to join video call: "+re.message)}},W=async()=>{if(e)try{await B(),E(!1),v([]),it.success("Left video call")}catch(re){console.error("Error leaving channel:",re),it.error("Failed to leave video call")}},B=async()=>{a&&(a.stop(),a.close(),o(null)),d&&(d.stop(),d.close(),p(null)),e&&b&&await e.leave()},z=async()=>{if(a){const re=!T;await a.setEnabled(re),w(re)}},Y=async()=>{if(d){const re=!N;await d.setEnabled(re),P(re)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-6xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Video Call Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your Agora.io video calling setup"}),l.jsx("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:l.jsxs("p",{className:"text-sm text-slate-300",children:[l.jsx("strong",{children:"Channel:"})," ",F," | ",l.jsx("strong",{children:"App ID:"})," ",I.substring(0,8),"..."]})})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[l.jsx("div",{ref:A,className:"w-full h-full bg-slate-800"}),l.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:["You ",b?"(Live)":"(Preview)"]}),!T&&l.jsx("div",{className:"absolute inset-0 bg-slate-800 flex items-center justify-center",children:l.jsx(wP,{className:"w-16 h-16 text-slate-400"})})]}),l.jsxs("div",{className:"bg-slate-900 rounded-2xl overflow-hidden aspect-video relative",children:[f.length>0?l.jsx("div",{ref:k,className:"w-full h-full bg-slate-800"}):l.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx(Kd,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),l.jsx("p",{className:"text-slate-400",children:b?"Waiting for others to join...":"Remote participant will appear here"})]})}),f.length>0&&l.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:"Remote User"})]})]}),l.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[l.jsx("button",{onClick:Y,className:`p-4 rounded-full transition-colors ${N?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:N?l.jsx(kJ,{className:"w-6 h-6"}):l.jsx(DJ,{className:"w-6 h-6"})}),l.jsx("button",{onClick:z,className:`p-4 rounded-full transition-colors ${T?"bg-slate-700 text-white hover:bg-slate-600":"bg-red-500 text-white hover:bg-red-600"}`,disabled:!b,children:T?l.jsx(Kd,{className:"w-6 h-6"}):l.jsx(wP,{className:"w-6 h-6"})}),b?l.jsxs("button",{onClick:W,className:"bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(xTe,{className:"w-5 h-5"}),"Leave Call"]}):l.jsxs("button",{onClick:V,className:"bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-medium transition-colors flex items-center gap-2",children:[l.jsx(d2,{className:"w-5 h-5"}),"Join Call"]})]}),l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium ${b?"bg-green-500/20 text-green-400":"bg-slate-500/20 text-slate-400"}`,children:[l.jsx("div",{className:`w-2 h-2 rounded-full ${b?"bg-green-400 animate-pulse":"bg-slate-400"}`}),b?`Connected (${f.length+1} participants)`:"Not connected"]})}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Testing Instructions:"}),l.jsxs("ol",{className:"text-slate-300 space-y-2 list-decimal list-inside",children:[l.jsx("li",{children:'Click "Join Call" to start the video call'}),l.jsx("li",{children:"Allow camera and microphone permissions when prompted"}),l.jsx("li",{children:"Open this page in another browser tab/window to test with multiple participants"}),l.jsx("li",{children:"Test the mute/unmute and video on/off controls"}),l.jsx("li",{children:"Check that you can see and hear other participants"})]}),l.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:l.jsxs("p",{className:"text-blue-400 text-sm",children:[l.jsx("strong",{children:"Note:"})," This is using your Agora.io free tier (10,000 minutes/month). Perfect for testing and development!"]})}),l.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-yellow-400 font-medium mb-2",children:" Troubleshooting"}),l.jsxs("div",{className:"text-yellow-300 text-sm space-y-1",children:[l.jsx("p",{children:l.jsx("strong",{children:"If video call fails:"})}),l.jsx("p",{children:" Check browser console for error messages"}),l.jsx("p",{children:" Ensure camera/microphone permissions are granted"}),l.jsx("p",{children:" Try disabling token authentication in Agora Console"}),l.jsx("p",{children:" Check server logs for token generation issues"})]})]}),l.jsxs("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[l.jsx("h4",{className:"text-green-400 font-medium mb-2",children:" Quick Fix"}),l.jsx("div",{className:"text-green-300 text-sm",children:l.jsxs("p",{children:[l.jsx("strong",{children:"Easiest solution:"}),' Go to Agora Console  Project Settings  Change Authentication from "App ID + Token" to "App ID only"']})})]})]})]})})}function pKe(){const[e,n]=q.useState(""),[a,o]=q.useState(!1),[d,p]=q.useState(null),f=async v=>{if(v.preventDefault(),!e){it.error("Please enter an email address");return}o(!0),p(null);try{const E=await(await fetch("/api/doctors/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).json();E.success?(p({success:!0,message:E.message}),it.success("Test email sent successfully!")):(p({success:!1,message:E.message}),it.error("Failed to send email"))}catch(b){console.error("Email test error:",b),p({success:!1,message:b.message}),it.error("Failed to send email")}finally{o(!1)}};return l.jsx("div",{className:"min-h-screen bg-[#0a0f1a] p-6",children:l.jsxs("div",{className:"max-w-2xl mx-auto",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Email Test"}),l.jsx("p",{className:"text-slate-400",children:"Test your SMTP email configuration"})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[l.jsx(D0,{className:"w-5 h-5 text-cyan-400"}),"Current SMTP Configuration"]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Host:"}),l.jsx("span",{className:"text-white ml-2",children:"smtp.gmail.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"Port:"}),l.jsx("span",{className:"text-white ml-2",children:"587"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"User:"}),l.jsx("span",{className:"text-white ml-2",children:"tech@colabplatforms.com"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-slate-400",children:"From:"}),l.jsx("span",{className:"text-white ml-2",children:"HealthAI <tech@colabplatforms.com>"})]})]})]}),l.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mb-8",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Send Test Email"}),l.jsxs("form",{onSubmit:f,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Test Email Address"}),l.jsx("input",{type:"email",value:e,onChange:v=>n(v.target.value),placeholder:"Enter email to receive test appointment confirmation",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:border-cyan-500",required:!0})]}),l.jsx("button",{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 text-white py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2",children:a?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Sending..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Bf,{className:"w-5 h-5"}),"Send Test Email"]})})]})]}),d&&l.jsxs("div",{className:`rounded-2xl p-6 ${d.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[l.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.success?l.jsx(bi,{className:"w-6 h-6 text-green-400"}):l.jsx(Aa,{className:"w-6 h-6 text-red-400"}),l.jsx("h3",{className:`text-lg font-bold ${d.success?"text-green-400":"text-red-400"}`,children:d.success?"Email Sent Successfully!":"Email Failed"})]}),l.jsx("p",{className:`${d.success?"text-green-300":"text-red-300"}`,children:d.message}),d.success&&l.jsxs("div",{className:"mt-4 p-4 bg-slate-800 rounded-lg",children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:"What to expect:"}),l.jsxs("ul",{className:"text-slate-300 text-sm space-y-1",children:[l.jsx("li",{children:' Check your inbox for "Appointment Confirmation - HealthAI"'}),l.jsx("li",{children:" The email will contain appointment details and a join link"}),l.jsx("li",{children:" It may take a few minutes to arrive"}),l.jsx("li",{children:" Check spam folder if not received"})]})]})]}),l.jsxs("div",{className:"mt-8 bg-slate-800 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Email Features"}),l.jsxs("div",{className:"space-y-4 text-slate-300",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Appointment Confirmation"}),l.jsx("p",{className:"text-sm",children:"Professional HTML email with appointment details, doctor info, and video call join link."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Automated Reminders"}),l.jsx("p",{className:"text-sm",children:"System sends reminders 24 hours before and 30 minutes before appointments."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Mobile Responsive"}),l.jsx("p",{className:"text-sm",children:"Emails look great on all devices with touch-friendly buttons and responsive design."})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"text-white font-medium mb-2",children:" Professional Design"}),l.jsx("p",{className:"text-sm",children:"Branded emails with HealthAI colors, gradients, and professional layout."})]})]})]}),l.jsxs("div",{className:"mt-8 bg-yellow-500/10 border border-yellow-500/20 rounded-2xl p-6",children:[l.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-4",children:"Troubleshooting"}),l.jsxs("div",{className:"space-y-2 text-yellow-300 text-sm",children:[l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Gmail App Password:"})," Make sure you're using an app password, not your regular Gmail password"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"2FA Required:"})," Gmail requires 2-factor authentication to generate app passwords"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Less Secure Apps:"}),' App passwords bypass the need for "less secure apps" setting']}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Rate Limits:"})," Gmail has sending limits (500 emails/day for free accounts)"]}),l.jsxs("p",{children:[" ",l.jsx("strong",{children:"Spam Filters:"})," Test emails might go to spam initially"]})]})]})]})})}const mKe=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ml={startTime:"09:00",endTime:"18:00",slotDuration:30};function fKe(){const[e,n]=q.useState(ml),[a,o]=q.useState({}),[d,p]=q.useState({}),[f,v]=q.useState(!1),[b,E]=q.useState(!0),T=()=>{const W=[],B=new Date;for(let z=0;z<7;z++){const Y=new Date(B);Y.setDate(B.getDate()+z),W.push({date:Y.toISOString().split("T")[0],dayName:mKe[Y.getDay()],displayDate:Y.toLocaleDateString("en-US",{month:"short",day:"numeric"}),isToday:z===0})}return W},[w]=q.useState(T());q.useEffect(()=>{N()},[]);const N=async()=>{var W,B,z,Y,re,Z,ie;try{const{data:te}=await Ja.getMyAvailability(),de={startTime:((B=(W=te.availability)==null?void 0:W.settings)==null?void 0:B.startTime)||ml.startTime,endTime:((Y=(z=te.availability)==null?void 0:z.settings)==null?void 0:Y.endTime)||ml.endTime,slotDuration:((Z=(re=te.availability)==null?void 0:re.settings)==null?void 0:Z.slotDuration)||ml.slotDuration};n(de),(ie=te.availability)!=null&&ie.blockedSlots&&p(te.availability.blockedSlots),P(de)}catch(te){console.error("Failed to fetch availability:",te),P(ml)}finally{E(!1)}},P=W=>{W||(W=ml);const B={},z=W.startTime||ml.startTime,Y=W.endTime||ml.endTime,re=W.slotDuration||ml.slotDuration,Z=z.split(":"),ie=Y.split(":");if(Z.length<2||ie.length<2){console.error("Invalid time format");return}const te=parseInt(Z[0],10),de=parseInt(Z[1],10),xe=parseInt(ie[0],10),me=parseInt(ie[1],10);w.forEach(Ce=>{B[Ce.date]=[];let ue=te*60+de;const be=xe*60+me;for(;ue<be;){const se=Math.floor(ue/60),pe=ue%60,De=`${se.toString().padStart(2,"0")}:${pe.toString().padStart(2,"0")}`,Se=new Date(`2000-01-01T${De}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});B[Ce.date].push({time:De,display:Se}),ue+=re}}),o(B)},A=(W,B)=>{const z={...e,[W]:B};n(z),P(z)},k=(W,B)=>{p(z=>{const Y=z[W]||[];return Y.includes(B)?{...z,[W]:Y.filter(re=>re!==B)}:{...z,[W]:[...Y,B]}})},I=W=>{const B=a[W]||[];(d[W]||[]).length===B.length?p(Y=>({...Y,[W]:[]})):p(Y=>({...Y,[W]:B.map(re=>re.time)}))},F=(W,B)=>(d[W]||[]).includes(B),U=W=>{const B=a[W]||[],z=d[W]||[];return B.length>0&&z.length===B.length},V=async()=>{var W,B;v(!0);try{const z=await Ja.updateMyAvailability({settings:e,blockedSlots:d});console.log("Save response:",z.data),it.success("Availability saved successfully!")}catch(z){console.error("Failed to save:",z),it.error(((B=(W=z.response)==null?void 0:W.data)==null?void 0:B.message)||"Failed to save availability")}finally{v(!1)}};return b?l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading availability..."})]})}):l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manage Your Slots"}),l.jsx("p",{className:"text-slate-500 mt-1",children:"Set your operating hours and block unavailable times"})]}),l.jsxs("button",{onClick:V,disabled:f,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all disabled:opacity-50",children:[f?l.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):l.jsx(jJ,{className:"w-5 h-5"}),"Save Changes"]})]}),l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(ic,{className:"w-5 h-5 text-cyan-500"}),"Operating Hours"]}),l.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Start Time"}),l.jsx("select",{value:e.startTime,onChange:W=>A("startTime",W.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(W,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,Y=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:Y},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"End Time"}),l.jsx("select",{value:e.endTime,onChange:W=>A("endTime",W.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:Array.from({length:24},(W,B)=>{const z=`${B.toString().padStart(2,"0")}:00`,Y=new Date(`2000-01-01T${z}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return l.jsx("option",{value:z,children:Y},z)})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"Slot Duration"}),l.jsxs("select",{value:e.slotDuration,onChange:W=>A("slotDuration",parseInt(W.target.value)),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:border-cyan-500 focus:outline-none",children:[l.jsx("option",{value:15,children:"15 minutes"}),l.jsx("option",{value:30,children:"30 minutes"}),l.jsx("option",{value:45,children:"45 minutes"}),l.jsx("option",{value:60,children:"60 minutes"})]})]})]}),l.jsxs("p",{className:"text-sm text-slate-400 mt-3",children:["Current: ",e.startTime," to ",e.endTime,", ",e.slotDuration," min slots"]})]}),l.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-100 border-2 border-emerald-300"}),l.jsx("span",{className:"text-slate-600",children:"Available"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-4 h-4 rounded-full bg-red-100 border-2 border-red-300"}),l.jsx("span",{className:"text-slate-600",children:"Blocked"})]}),l.jsx("p",{className:"text-slate-400 ml-auto",children:"Click on slots to block/unblock"})]}),l.jsx("div",{className:"space-y-4",children:w.map(W=>{const B=a[W.date]||[],z=U(W.date);return l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-5 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(ji,{className:"w-5 h-5 text-cyan-500"}),l.jsxs("div",{children:[l.jsxs("h3",{className:"font-semibold text-slate-800",children:[W.dayName,W.isToday&&l.jsx("span",{className:"ml-2 text-xs bg-cyan-100 text-cyan-600 px-2 py-0.5 rounded-full",children:"Today"})]}),l.jsx("p",{className:"text-sm text-slate-500",children:W.displayDate})]})]}),l.jsx("button",{onClick:()=>I(W.date),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${z?"bg-emerald-100 text-emerald-600 hover:bg-emerald-200":"bg-red-100 text-red-600 hover:bg-red-200"}`,children:z?l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(yh,{className:"w-4 h-4"})," Unblock All"]}):l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(Ji,{className:"w-4 h-4"})," Block Day"]})})]}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[B.map(Y=>{const re=F(W.date,Y.time);return l.jsx("button",{onClick:()=>k(W.date,Y.time),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all ${re?"bg-red-100 text-red-600 border border-red-200 hover:bg-red-200":"bg-emerald-100 text-emerald-600 border border-emerald-200 hover:bg-emerald-200"}`,children:Y.display},Y.time)}),B.length===0&&l.jsx("p",{className:"text-slate-400 text-sm py-2",children:"No slots - check your operating hours"})]})]},W.date)})}),l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4",children:[l.jsx("h3",{className:"font-medium text-cyan-800 mb-2",children:" Quick Tips"}),l.jsxs("ul",{className:"text-sm text-cyan-700 space-y-1",children:[l.jsx("li",{children:" Set your operating hours above to auto-generate time slots"}),l.jsx("li",{children:" Click individual slots to block specific times"}),l.jsx("li",{children:' Use "Block Day" to mark entire days as unavailable'}),l.jsx("li",{children:" Don't forget to save your changes!"})]})]})]})}const gKe={"Vitamin D":{foods:[{name:"Fish (salmon, mackerel, rohu)",diet:["non-vegetarian"]},{name:"Egg yolks",diet:["eggetarian","non-vegetarian"]},{name:"Fortified milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushrooms",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Egg bhurji with paneer",diet:["eggetarian","non-vegetarian"]},{name:"Dalia with milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom omelette",diet:["eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Fish fry with salad",diet:["non-vegetarian"]},{name:"Fish curry with rice",diet:["non-vegetarian"]},{name:"Egg curry with rice",diet:["eggetarian","non-vegetarian"]},{name:"Mushroom pulao",diet:["vegan","vegetarian"]}],dinner:[{name:"Tandoori fish with vegetables",diet:["non-vegetarian"]},{name:"Paneer tikka",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Mushroom masala",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Paneer cubes",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Boiled eggs",diet:["eggetarian","non-vegetarian"]},{name:"Orange juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Get 15-20 minutes of morning sunlight daily","Include fortified foods in your diet"]},"Vitamin B12":{foods:[{name:"Chicken, mutton",diet:["non-vegetarian"]},{name:"Fish",diet:["non-vegetarian"]},{name:"Eggs",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt, milk, paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Nutritional yeast",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Eggs with whole wheat bread",diet:["eggetarian","non-vegetarian"]},{name:"Yogurt with muesli",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk smoothie",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia with almond milk",diet:["vegan"]}],lunch:[{name:"Chicken with rice",diet:["non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Paneer salad",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan"]}],dinner:[{name:"Tandoori chicken",diet:["non-vegetarian"]},{name:"Mutton curry",diet:["non-vegetarian"]},{name:"Paneer butter masala",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Soya chunks curry",diet:["vegan"]}],snacks:[{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk",diet:["vegan"]}],tips:["Vegetarians and vegans should consider B12 supplements","Include fortified foods in every meal"]},Iron:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Rajma, chana",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified cereals",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Spinach smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified dalia",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Poha with peanuts",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Dal rice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Liver curry",diet:["non-vegetarian"]},{name:"Rajma rice",diet:["vegan"]}],dinner:[{name:"Dal soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Grilled meat with vegetables",diet:["non-vegetarian"]}],snacks:[{name:"Pumpkin seeds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dried apricots",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C for better absorption","Avoid tea/coffee with meals"]},Calcium:{foods:[{name:"Milk",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Leafy green vegetables",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Fortified almond milk",diet:["vegan"]}],breakfast:[{name:"Milk with dalia",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt with fruits",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer paratha",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Almond milk smoothie",diet:["vegan"]}],lunch:[{name:"Paneer curry",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Tofu bhurji",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Palak paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Fish curry",diet:["non-vegetarian"]},{name:"Broccoli soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Almonds",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Paneer",diet:["vegetarian","eggetarian","non-vegetarian"]},{name:"Yogurt",diet:["vegetarian","eggetarian","non-vegetarian"]}],tips:["Include calcium-rich foods in every meal","Get adequate Vitamin D for calcium absorption"]},Hemoglobin:{foods:[{name:"Red meat",diet:["non-vegetarian"]},{name:"Liver",diet:["non-vegetarian"]},{name:"Spinach (palak)",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],breakfast:[{name:"Beetroot juice",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Spinach paratha",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate smoothie",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],lunch:[{name:"Liver curry",diet:["non-vegetarian"]},{name:"Spinach dal",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Beetroot salad",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],dinner:[{name:"Grilled meat",diet:["non-vegetarian"]},{name:"Spinach soup",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Dal curry",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],snacks:[{name:"Dates",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Pomegranate",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]},{name:"Jaggery",diet:["vegan","vegetarian","eggetarian","non-vegetarian"]}],tips:["Eat iron-rich foods with Vitamin C","Avoid calcium with iron-rich meals"]}};function vKe(){var be,se,pe,De,Se,we,qe,lt,Ut,Ht;const{user:e}=ma(),[n,a]=q.useState(!0),[o,d]=q.useState(!1),[p,f]=q.useState([]),[v,b]=q.useState(null),[E,T]=q.useState(null),[w,N]=q.useState(""),[P,A]=q.useState(!1),[k,I]=q.useState(null),[F,U]=q.useState(!0),[V,W]=q.useState(!1);q.useEffect(()=>{B(),z(),Y()},[]);const B=async()=>{var Ue;try{const{data:dt}=await Nh.getDashboard(),Ne=((Ue=dt.latestAnalysis)==null?void 0:Ue.deficiencies)||[];f(Ne.map(Ke=>typeof Ke=="string"?Ke:Ke.name||Ke.nutrient))}catch(dt){console.error("Failed to fetch health data:",dt)}finally{a(!1)}},z=async()=>{try{const Ue=localStorage.getItem("token"),Ne=await(await fetch("/api/diet-recommendations/diet-plan/active",{headers:{Authorization:`Bearer ${Ue}`}})).json();Ne.success&&Ne.dietPlan&&(b(Ne.dietPlan),W(!0))}catch(Ue){console.error("Failed to fetch personalized plan:",Ue)}},Y=async()=>{try{const Ue=localStorage.getItem("token"),Ne=await(await fetch("/api/diet-recommendations/supplements/active",{headers:{Authorization:`Bearer ${Ue}`}})).json();Ne.success&&Ne.recommendations&&T(Ne.recommendations)}catch(Ue){console.error("Failed to fetch supplement recommendations:",Ue)}},re=async()=>{d(!0);try{const Ue=localStorage.getItem("token"),Ne=await(await fetch("/api/diet-recommendations/diet-plan/generate",{method:"POST",headers:{Authorization:`Bearer ${Ue}`,"Content-Type":"application/json"}})).json();Ne.success?(b(Ne.dietPlan),W(!0),it.success("AI-powered diet plan generated!")):it.error(Ne.message||"Failed to generate plan")}catch(Ue){console.error("Failed to generate AI plan:",Ue),it.error("Failed to generate personalized plan")}finally{d(!1)}},Z=async()=>{try{const Ue=localStorage.getItem("token"),Ne=await(await fetch("/api/diet-recommendations/supplements/generate",{method:"POST",headers:{Authorization:`Bearer ${Ue}`,"Content-Type":"application/json"}})).json();Ne.success?(T(Ne.recommendations),it.success("Supplement recommendations generated!")):it.error(Ne.message||"Failed to generate recommendations")}catch(Ue){console.error("Failed to generate supplements:",Ue),it.error("Failed to generate supplement recommendations")}},ie=()=>{if(w.trim()){const Ue=w.split(",").map(dt=>dt.trim()).filter(Boolean);f([...new Set([...p,...Ue])]),N(""),A(!1),it.success("Deficiencies added")}},te=Ue=>{f(p.filter(dt=>dt!==Ue))},de=()=>{var Ne;const Ue={breakfast:[],lunch:[],dinner:[],snacks:[],tips:[],foods:[]},dt=((Ne=e==null?void 0:e.profile)==null?void 0:Ne.dietaryPreference)||"non-vegetarian";return p.forEach(Ke=>{const bt=Object.entries(gKe).find(([Te])=>Ke.toLowerCase().includes(Te.toLowerCase())||Te.toLowerCase().includes(Ke.toLowerCase()));if(bt){const[,Te]=bt,gt=Qe=>Qe.filter(Ft=>Ft.diet.includes(dt)).map(Ft=>Ft.name);Ue.breakfast.push(...gt(Te.breakfast||[])),Ue.lunch.push(...gt(Te.lunch||[])),Ue.dinner.push(...gt(Te.dinner||[])),Ue.snacks.push(...gt(Te.snacks||[])),Ue.foods.push(...gt(Te.foods||[])),Ue.tips.push(...Te.tips||[])}}),Object.keys(Ue).forEach(Ke=>{Ue[Ke]=[...new Set(Ue[Ke])]}),Ue},xe=()=>E?p.map(Ue=>{const dt=Object.entries(E).find(([Ne])=>Ue.toLowerCase().includes(Ne.toLowerCase())||Ne.toLowerCase().includes(Ue.toLowerCase()));return dt?{deficiency:Ue,...dt[1]}:null}).filter(Boolean):[];if(n)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4"}),l.jsx("p",{className:"text-slate-500",children:"Loading your personalized plan..."})]})});const me=de(),Ce=xe(),ue=p.length>0&&(me.breakfast.length>0||me.lunch.length>0);return l.jsxs("div",{className:"space-y-6 animate-fade-in",children:[l.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Personalized Diet Plan"}),l.jsxs("p",{className:"text-slate-500 mt-1",children:["AI-generated nutrition guidance based on your health data",((be=e==null?void 0:e.profile)==null?void 0:be.age)&&`  ${e.profile.age} years`,((se=e==null?void 0:e.profile)==null?void 0:se.gender)&&`  ${e.profile.gender}`,((pe=e==null?void 0:e.profile)==null?void 0:pe.dietaryPreference)&&`  ${e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)}`]})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("button",{onClick:re,disabled:o,className:"px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg flex items-center gap-2 disabled:opacity-50 transition-all",style:{backgroundColor:"#8B7355"},children:o?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Generating..."]}):v?l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-5 h-5"}),"Regenerate Plan"]}):l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-5 h-5"}),"Generate AI Plan"]})}),l.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[l.jsx("input",{type:"checkbox",checked:F,onChange:Ue=>U(Ue.target.checked),className:"w-4 h-4 rounded border-slate-300 focus:ring-2",style:{accentColor:"#8B7355"}}),l.jsx("span",{className:"text-sm text-slate-600",children:"Enable diet recommendations"})]})]})]}),F?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(Aa,{className:"w-5 h-5 text-amber-500"}),"Detected Deficiencies"]}),l.jsxs("button",{onClick:()=>A(!P),className:"flex items-center gap-1 text-sm text-cyan-600 hover:text-cyan-700",children:[l.jsx(Wc,{className:"w-4 h-4"})," Add Manually"]})]}),((De=e==null?void 0:e.profile)==null?void 0:De.dietaryPreference)&&l.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-xl",children:l.jsxs("p",{className:"text-sm text-green-700",children:[l.jsx("strong",{children:"Dietary Preference:"})," ",e.profile.dietaryPreference.charAt(0).toUpperCase()+e.profile.dietaryPreference.slice(1)," ","- All recommendations are filtered to match your preference.",l.jsx(hn,{to:"/profile",className:"ml-2 text-cyan-600 hover:text-cyan-700 underline",children:"Change in Profile"})]})}),P&&l.jsxs("div",{className:"mb-4 p-4 bg-slate-50 rounded-xl",children:[l.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Don't have reports? Add your known deficiencies manually:"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:w,onChange:Ue=>N(Ue.target.value),placeholder:"e.g., Vitamin D, Iron, B12",className:"flex-1 px-4 py-2 bg-white border border-slate-200 rounded-lg text-slate-800 placeholder-slate-400 focus:border-cyan-500 focus:outline-none"}),l.jsx("button",{onClick:ie,className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600",children:"Add"})]})]}),p.length>0?l.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((Ue,dt)=>l.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-amber-100 text-amber-700 rounded-full text-sm",children:[Ue,l.jsx("button",{onClick:()=>te(Ue),className:"hover:text-amber-900",children:""})]},dt))}):l.jsx("p",{className:"text-slate-500 text-sm",children:"No deficiencies detected. Upload a health report or add deficiencies manually to get personalized recommendations."})]}),v&&V&&l.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 rounded-2xl border-2 border-purple-200 p-6 shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-xl font-bold text-purple-900 flex items-center gap-2",children:[l.jsx(Hd,{className:"w-6 h-6 text-purple-600"}),"AI-Powered Personalized Diet Plan"]}),l.jsx("button",{onClick:()=>W(!1),className:"text-purple-600 hover:text-purple-800 text-sm",children:"Show Basic Plan"})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-4",children:["Generated on ",new Date(v.generatedAt).toLocaleDateString(),"  Valid until ",new Date(v.validUntil).toLocaleDateString()]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Daily Calories"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:v.dailyCalorieTarget})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Protein"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[(Se=v.macroTargets)==null?void 0:Se.protein,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Carbs"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[(we=v.macroTargets)==null?void 0:we.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 text-center",children:[l.jsx("p",{className:"text-sm text-slate-600",children:"Fats"}),l.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[(qe=v.macroTargets)==null?void 0:qe.fats,"g"]})]})]}),l.jsx("div",{className:"space-y-4",children:Object.entries(v.mealPlan||{}).map(([Ue,dt])=>{const Ne=Array.isArray(dt)?dt:dt?[dt]:[];return Ne&&Ne.length>0&&l.jsxs("div",{className:"bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3 capitalize",children:Ue.replace(/([A-Z])/g," $1").trim()}),l.jsx("div",{className:"space-y-3",children:Ne.map((Ke,bt)=>l.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-100",children:[l.jsxs("div",{className:"flex justify-between items-start mb-2",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"font-semibold text-purple-900",children:Ke.name}),Ke.difficulty&&l.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ke.difficulty==="Easy"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:Ke.difficulty})]}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:Ke.description})]}),l.jsxs("div",{className:"text-right ml-4",children:[l.jsxs("p",{className:"text-sm font-semibold text-purple-900",children:[Ke.calories," cal"]}),l.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[Ke.protein,"g protein"]}),l.jsxs("p",{className:"text-xs text-purple-600",children:[Ke.carbs,"g carbs"]}),l.jsxs("p",{className:"text-xs text-purple-600",children:[Ke.fat,"g fat"]})]})]}),Ke.portionSize&&l.jsxs("p",{className:"text-xs text-purple-600 mb-2",children:[l.jsx("strong",{children:"Portion:"})," ",Ke.portionSize]}),Ke.ingredients&&Ke.ingredients.length>0&&l.jsxs("div",{className:"mb-3 p-2 bg-white rounded border border-purple-100",children:[l.jsx("p",{className:"text-xs font-semibold text-purple-900 mb-2",children:"Ingredients:"}),l.jsx("ul",{className:"text-xs text-purple-700 space-y-1",children:Ke.ingredients.map((Te,gt)=>l.jsxs("li",{className:"flex justify-between",children:[l.jsxs("span",{children:[Te.item,": ",Te.quantity]}),l.jsxs("span",{className:"text-purple-600",children:["(",Te.calories," cal)"]})]},gt))})]}),Ke.cookingMethod&&l.jsxs("p",{className:"text-xs text-purple-700 mb-2",children:[l.jsx("strong",{children:"How to prepare:"})," ",Ke.cookingMethod]}),Ke.cookingTime&&l.jsxs("p",{className:"text-xs text-purple-600 mb-2",children:[l.jsx("strong",{children:" Time:"})," ",Ke.cookingTime]}),Ke.benefits&&l.jsxs("p",{className:"text-xs text-green-700",children:[" ",l.jsx("strong",{children:"Benefits:"})," ",Ke.benefits]})]},bt))})]},Ue)})}),v.keyFoods&&v.keyFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Key Foods to Include"}),l.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:v.keyFoods.map((Ue,dt)=>l.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[l.jsx("p",{className:"font-medium text-green-900",children:Ue.name}),l.jsx("p",{className:"text-sm text-green-700 mt-1",children:Ue.reason}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Frequency: ",Ue.frequency]})]},dt))})]}),v.deficiencyCorrections&&v.deficiencyCorrections.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Deficiency Corrections"}),l.jsx("div",{className:"space-y-3",children:v.deficiencyCorrections.map((Ue,dt)=>l.jsxs("div",{className:"p-3 bg-amber-50 rounded-lg border border-amber-200",children:[l.jsx("p",{className:"font-medium text-amber-900",children:Ue.deficiency}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Foods:"})," ",Ue.indianFoods.join(", ")]}),l.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:[l.jsx("strong",{children:"Meals:"})," ",Ue.mealSuggestions.join(", ")]})]},dt))})]}),v.lifestyleRecommendations&&v.lifestyleRecommendations.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsxs("h3",{className:"font-semibold text-purple-900 mb-3 flex items-center gap-2",children:[l.jsx(py,{className:"w-5 h-5 text-purple-600"}),"Lifestyle Tips"]}),l.jsx("ul",{className:"space-y-2",children:v.lifestyleRecommendations.map((Ue,dt)=>l.jsxs("li",{className:"flex items-start gap-2 text-purple-700",children:[l.jsx(bi,{className:"w-4 h-4 mt-0.5 text-purple-500 shrink-0"}),Ue]},dt))})]}),v.avoidFoods&&v.avoidFoods.length>0&&l.jsxs("div",{className:"mt-6 bg-white rounded-xl p-4",children:[l.jsx("h3",{className:"font-semibold text-red-900 mb-3",children:"Foods to Avoid"}),l.jsx("div",{className:"space-y-2",children:v.avoidFoods.map((Ue,dt)=>l.jsxs("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[l.jsx("p",{className:"font-medium text-red-900",children:Ue.food}),l.jsx("p",{className:"text-sm text-red-700 mt-1",children:Ue.reason})]},dt))})]})]}),ue&&!V&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(fTe,{className:"w-5 h-5 text-green-500"}),"Recommended Foods"]}),l.jsx("div",{className:"flex flex-wrap gap-2",children:me.foods.slice(0,15).map((Ue,dt)=>l.jsx("span",{className:"px-3 py-1.5 bg-green-50 text-green-700 rounded-full text-sm border border-green-200",children:Ue},dt))})]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(Sx,{icon:uTe,title:"Breakfast",color:"amber",items:me.breakfast,expanded:k==="breakfast",onToggle:()=>I(k==="breakfast"?null:"breakfast")}),l.jsx(Sx,{icon:UJ,title:"Lunch",color:"orange",items:me.lunch,expanded:k==="lunch",onToggle:()=>I(k==="lunch"?null:"lunch")}),l.jsx(Sx,{icon:Vf,title:"Dinner",color:"indigo",items:me.dinner,expanded:k==="dinner",onToggle:()=>I(k==="dinner"?null:"dinner")}),l.jsx(Sx,{icon:nc,title:"Snacks",color:"green",items:me.snacks,expanded:k==="snacks",onToggle:()=>I(k==="snacks"?null:"snacks")})]}),me.tips.length>0&&l.jsxs("div",{className:"bg-cyan-50 border border-cyan-200 rounded-2xl p-6",children:[l.jsxs("h2",{className:"text-lg font-semibold text-cyan-800 mb-4 flex items-center gap-2",children:[l.jsx(py,{className:"w-5 h-5"}),"Nutritional Tips"]}),l.jsx("ul",{className:"space-y-2",children:me.tips.map((Ue,dt)=>l.jsxs("li",{className:"flex items-start gap-2 text-cyan-700",children:[l.jsx(bi,{className:"w-4 h-4 mt-0.5 text-cyan-500 shrink-0"}),Ue]},dt))})]}),E&&E.supplements&&E.supplements.length>0?l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(zd,{className:"w-5 h-5 text-purple-500"}),"AI-Powered Supplement Recommendations"]}),l.jsx("button",{onClick:Z,className:"text-sm text-purple-600 hover:text-purple-700",children:"Regenerate"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:E.consultationNote||"Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:E.supplements.map((Ue,dt)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Ue.name}),Ue.priority&&l.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${Ue.priority==="high"?"bg-red-100 text-red-700":Ue.priority==="medium"?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700"}`,children:[Ue.priority," priority"]})]}),l.jsxs("p",{className:"text-sm text-purple-700 mb-2",children:[l.jsx("strong",{children:"For:"})," ",Ue.deficiency]}),l.jsx("p",{className:"text-sm text-purple-700 mb-2",children:Ue.reason}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-2 mt-3",children:[l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Dosage:"}),l.jsx("p",{className:"text-purple-600",children:Ue.dosage})]}),l.jsxs("div",{className:"text-sm",children:[l.jsx("strong",{className:"text-purple-800",children:"Timing:"}),l.jsx("p",{className:"text-purple-600",children:Ue.timing})]})]}),Ue.foodAlternatives&&Ue.foodAlternatives.length>0&&l.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-green-700",children:[l.jsx("strong",{children:"Food alternatives:"})," ",Ue.foodAlternatives.join(", ")]})}),Ue.indianBrands&&Ue.indianBrands.length>0&&l.jsxs("div",{className:"mt-2 text-xs text-purple-600",children:[l.jsx("strong",{children:"Available brands:"})," ",Ue.indianBrands.join(", ")]}),Ue.precautions&&l.jsx("div",{className:"mt-2 p-2 bg-amber-50 rounded-lg",children:l.jsxs("p",{className:"text-xs text-amber-700",children:[l.jsx("strong",{children:" Precautions:"})," ",Ue.precautions]})})]},dt))}),E.generalGuidance&&E.generalGuidance.length>0&&l.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl",children:[l.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"General Guidance"}),l.jsx("ul",{className:"space-y-1",children:E.generalGuidance.map((Ue,dt)=>l.jsxs("li",{className:"text-sm text-blue-700 flex items-start gap-2",children:[l.jsx(bi,{className:"w-4 h-4 mt-0.5 shrink-0"}),Ue]},dt))})]})]}):Ce.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[l.jsx(zd,{className:"w-5 h-5 text-purple-500"}),"Supplement Recommendations"]}),l.jsx("button",{onClick:Z,className:"px-4 py-2 text-sm text-white rounded-lg hover:shadow-lg",style:{backgroundColor:"#8B7355"},children:"Get AI Recommendations"})]}),l.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"General wellness guidance based on your deficiencies. Always consult a healthcare provider before starting supplements."}),l.jsx("div",{className:"space-y-4",children:Ce.map((Ue,dt)=>l.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-xl",children:[l.jsx("h3",{className:"font-medium text-purple-800",children:Ue.category}),l.jsx("p",{className:"text-sm text-purple-700 mt-1",children:Ue.description}),l.jsx("p",{className:"text-xs text-purple-600 mt-2 italic",children:Ue.note})]},dt))})]})]}),!ue&&p.length===0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(nc,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:"No Diet Plan Available"}),l.jsx("p",{className:"text-slate-500 mb-4",children:"Upload a health report to get AI-analyzed deficiencies and personalized diet recommendations, or add your known deficiencies manually."}),l.jsx("button",{onClick:()=>A(!0),className:"px-6 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium hover:shadow-lg transition-all",children:"Add Deficiencies Manually"})]}),v&&v.shoppingList&&v.shoppingList.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(zd,{className:"w-5 h-5 text-green-500"}),"Shopping List"]}),l.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Quantities needed for the week"}),l.jsx("div",{className:"space-y-4",children:v.shoppingList.map((Ue,dt)=>l.jsxs("div",{className:"p-4 bg-green-50 rounded-xl border border-green-200",children:[l.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:Ue.category}),l.jsx("ul",{className:"space-y-1",children:Ue.items&&Ue.items.map((Ne,Ke)=>l.jsxs("li",{className:"text-sm text-green-700 flex justify-between",children:[l.jsx("span",{children:Ne.item}),l.jsxs("span",{className:"text-green-600 font-medium",children:[Ne.quantity," ",Ne.unit]})]},Ke))})]},dt))})]}),v&&v.dailyMacroSummary&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsx("h2",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Daily Macro Summary"}),l.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-4 border border-red-200",children:[l.jsx("p",{className:"text-sm text-red-700 font-medium",children:"Calories"}),l.jsx("p",{className:"text-2xl font-bold text-red-900 mt-1",children:v.dailyMacroSummary.totalCalories}),l.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Target: ",v.dailyCalorieTarget]}),v.dailyMacroSummary.calorieAccuracy&&l.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Accuracy: ",v.dailyMacroSummary.calorieAccuracy]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:[l.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Protein"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:[v.dailyMacroSummary.totalProtein,"g"]}),l.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Target: ",(lt=v.macroTargets)==null?void 0:lt.protein,"g"]}),v.dailyMacroSummary.proteinAccuracy&&l.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Accuracy: ",v.dailyMacroSummary.proteinAccuracy]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4 border border-yellow-200",children:[l.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"Carbs"}),l.jsxs("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:[v.dailyMacroSummary.totalCarbs,"g"]}),l.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Target: ",(Ut=v.macroTargets)==null?void 0:Ut.carbs,"g"]}),v.dailyMacroSummary.carbsAccuracy&&l.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Accuracy: ",v.dailyMacroSummary.carbsAccuracy]})]}),l.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200",children:[l.jsx("p",{className:"text-sm text-orange-700 font-medium",children:"Fat"}),l.jsxs("p",{className:"text-2xl font-bold text-orange-900 mt-1",children:[v.dailyMacroSummary.totalFat,"g"]}),l.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Target: ",(Ht=v.macroTargets)==null?void 0:Ht.fat,"g"]}),v.dailyMacroSummary.fatAccuracy&&l.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Accuracy: ",v.dailyMacroSummary.fatAccuracy]})]})]}),v.dailyMacroSummary.note&&l.jsx("p",{className:"text-sm text-slate-600 mt-4 p-3 bg-slate-50 rounded-lg",children:v.dailyMacroSummary.note})]}),v&&v.trackingTips&&v.trackingTips.length>0&&l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6 shadow-sm",children:[l.jsxs("h2",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[l.jsx(py,{className:"w-5 h-5 text-amber-500"}),"Tracking Tips"]}),l.jsx("ul",{className:"space-y-2",children:v.trackingTips.map((Ue,dt)=>l.jsxs("li",{className:"flex items-start gap-2 text-slate-700",children:[l.jsx(bi,{className:"w-4 h-4 mt-0.5 text-green-500 shrink-0"}),Ue]},dt))})]}),l.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-500",children:[l.jsx("strong",{children:"Disclaimer:"})," This diet plan is AI-generated for informational purposes only. It is not a substitute for professional medical advice. Please consult a healthcare provider or registered dietitian before making significant changes to your diet."]})]}):l.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-8 text-center",children:[l.jsx(nc,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"Diet Recommendations Disabled"}),l.jsx("p",{className:"text-slate-500",children:"Enable diet recommendations to see your personalized plan."})]})]})}function Sx({icon:e,title:n,color:a,items:o,expanded:d,onToggle:p}){const f={amber:"bg-amber-100 text-amber-700",orange:"bg-orange-100 text-orange-700",indigo:"bg-indigo-100 text-indigo-700",green:"bg-green-100 text-green-700"},v={amber:"border-amber-200",orange:"border-orange-200",indigo:"border-indigo-200",green:"border-green-200"};return l.jsxs("div",{className:`bg-white rounded-2xl border-2 ${v[a]} p-5 shadow-sm hover:shadow-md transition-shadow`,children:[l.jsxs("button",{onClick:p,className:"w-full flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-10 h-10 rounded-xl ${f[a]} flex items-center justify-center`,children:l.jsx(e,{className:"w-5 h-5"})}),l.jsx("h3",{className:"font-semibold text-slate-800 text-lg",children:n})]}),d?l.jsx(cTe,{className:"w-5 h-5 text-slate-400"}):l.jsx(o2,{className:"w-5 h-5 text-slate-400"})]}),d&&o.length>0&&l.jsx("ul",{className:"mt-4 space-y-2",children:o.map((b,E)=>l.jsxs("li",{className:"flex items-center gap-2 text-slate-700 text-sm font-medium",children:[l.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${f[a].split(" ")[1].replace("text-","bg-")}`}),b]},E))}),!d&&o.length>0&&l.jsxs("p",{className:"mt-2 text-sm text-slate-600 font-medium",children:[o.length," options available"]})]})}function yKe(){const{user:e}=ma(),n=Ul(),[a,o]=q.useState([]),[d,p]=q.useState(""),[f,v]=q.useState(!1),[b,E]=q.useState(!1),[T,w]=q.useState(""),[N,P]=q.useState(null),[A,k]=q.useState([]),[I,F]=q.useState(!0),U=q.useRef(null),V=q.useRef(null);q.useEffect(()=>{(async()=>{try{const ie=localStorage.getItem("token"),te=await fetch("/api/health/reports",{headers:{Authorization:`Bearer ${ie}`}});if(te.ok){const de=await te.json();k(de.reports||[])}}catch(ie){console.error("Failed to load reports:",ie)}finally{F(!1)}})()},[]),q.useEffect(()=>{var ie;if(e&&(async()=>{try{const te=localStorage.getItem(`chat_history_${e==null?void 0:e.id}`);if(te){const de=JSON.parse(te);o(de),console.log("Loaded chat history from localStorage:",de.length,"messages")}else o([{role:"assistant",content:`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant. I can help you understand your health reports, explain medical terms, provide diet guidance, and answer health-related questions. What would you like to know?`,timestamp:new Date}])}catch(te){console.error("Failed to load chat history:",te),o([{role:"assistant",content:`Hello ${(e==null?void 0:e.name)||"there"}!  I'm your AI health assistant. How can I help you today?`,timestamp:new Date}])}})(),(ie=n.state)!=null&&ie.selectedText){const te=n.state.selectedText;p(`Can you explain this: "${te}"`)}},[e==null?void 0:e.id,n.state,e==null?void 0:e.name]),q.useEffect(()=>{W()},[a,T]);const W=()=>{var Z;(Z=U.current)==null||Z.scrollIntoView({behavior:"smooth"})},B=(Z,ie)=>{E(!0),w("");let te=0;const de=setInterval(()=>{te<=Z.length?(w(Z.substring(0,te)),te++):(clearInterval(de),E(!1),ie())},15);return()=>clearInterval(de)},z=async Z=>{if(Z.preventDefault(),!d.trim()||f)return;const ie={role:"user",content:d,timestamp:new Date};o(de=>[...de,ie]);const te=d;p(""),v(!0);try{const de=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:te,conversationHistory:a.slice(-10),userReports:A.map(me=>({type:me.reportType,date:me.uploadDate,analysis:me.analysis,metrics:me.metrics}))})});if(!de.ok){const me=await de.json().catch(()=>({}));throw console.error("API Error:",de.status,me),new Error(me.message||`Failed to get AI response (${de.status})`)}const xe=await de.json();if(xe.success&&xe.response)B(xe.response,()=>{const me={role:"assistant",content:xe.response,timestamp:new Date};o(ue=>[...ue,me]),w("");const Ce=[...a,ie,me];localStorage.setItem(`chat_history_${e==null?void 0:e.id}`,JSON.stringify(Ce))});else throw new Error("Invalid response from AI")}catch(de){console.error("AI Chat error:",de),it.error("Failed to get response. Using fallback.");const xe=Y(te);B(xe,()=>{const me={role:"assistant",content:xe,timestamp:new Date};o(Ce=>[...Ce,me]),w("")})}finally{v(!1)}},Y=Z=>{const ie=Z.toLowerCase();return ie.includes("vitamin d")||ie.includes("vitamin-d")?`Based on your query about Vitamin D:

**What is Vitamin D?**
Vitamin D is essential for bone health, immune function, and overall wellbeing.

**Normal Range:** 30-100 ng/mL

**If Low:**
 Get 15-20 minutes of morning sunlight daily
 Eat fish, eggs, fortified milk
 Consider supplements (consult your doctor)

**Symptoms of Deficiency:**
 Fatigue and tiredness
 Bone pain or weakness
 Frequent infections
 Mood changes

Would you like more specific information about your levels?`:ie.includes("iron")||ie.includes("hemoglobin")?`Regarding Iron and Hemoglobin:

**Importance:**
Iron is crucial for producing hemoglobin, which carries oxygen in your blood.

**Normal Hemoglobin:** 12-17 g/dL
**Normal Iron:** 60-170 mcg/dL

**To Increase Iron:**
 Red meat, spinach, dal
 Eat with Vitamin C foods
 Avoid tea/coffee with meals

**Symptoms of Low Iron:**
 Extreme fatigue
 Pale skin
 Shortness of breath
 Cold hands and feet

Consult your doctor if symptoms persist.`:ie.includes("diet")||ie.includes("food")?`For a healthy diet plan:

**General Guidelines:**
 Eat balanced meals with proteins, carbs, and healthy fats
 Include plenty of fruits and vegetables
 Stay hydrated (8-10 glasses of water daily)
 Limit processed foods and sugar

**Based on Your Health Data:**
I can provide personalized diet recommendations based on your deficiencies. Check your Diet Plan page for detailed meal suggestions.

Would you like specific recommendations for any nutrient?`:`Thank you for your question. I'm here to help with:

 Understanding your health reports
 Explaining medical terms and values
 Providing general health guidance
 Diet and lifestyle recommendations
 Symptom information

**Important:** I provide general information only. For medical diagnosis and treatment, please consult with a healthcare professional.

Could you please provide more details about what you'd like to know?`},re=(Z,ie)=>{navigator.clipboard.writeText(Z),P(ie),setTimeout(()=>P(null),2e3),it.success("Copied to clipboard")};return l.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundColor:"#F5F1EA"},children:[l.jsxs("div",{ref:V,className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 md:py-6 space-y-4 pb-32 md:pb-28",style:{userSelect:"text"},onMouseUp:Z=>{Z.stopPropagation()},children:[a.map((Z,ie)=>l.jsxs("div",{className:`flex gap-3 ${Z.role==="user"?"justify-end":"justify-start"}`,children:[Z.role==="assistant"&&l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{className:`max-w-[80%] sm:max-w-[70%] rounded-2xl px-4 py-3 shadow-sm ${Z.role==="user"?"text-white shadow-sm":"bg-white text-slate-800"}`,style:Z.role==="user"?{backgroundColor:"#8B7355",border:"1px solid #E5DFD3"}:{border:"1px solid #E5DFD3"},children:[l.jsx("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base leading-relaxed",children:Z.content}),l.jsxs("div",{className:"flex items-center justify-between mt-2 gap-2",children:[l.jsx("span",{className:`text-xs ${Z.role==="user"?"text-white/70":"text-slate-400"}`,children:Z.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),Z.role==="assistant"&&l.jsx("button",{onClick:()=>re(Z.content,ie),className:"transition-colors p-1 rounded",style:{color:"#5C4F3D"},onMouseEnter:te=>{te.currentTarget.style.color="#8B7355",te.currentTarget.style.backgroundColor="#F5F1EA"},onMouseLeave:te=>{te.currentTarget.style.color="#5C4F3D",te.currentTarget.style.backgroundColor="transparent"},title:"Copy response",children:N===ie?l.jsx(yh,{className:"w-4 h-4 text-green-500"}):l.jsx(hTe,{className:"w-4 h-4"})})]})]}),Z.role==="user"&&l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm",style:{backgroundColor:"#E5DFD3"},children:l.jsx(Kc,{className:"w-5 h-5",style:{color:"#5C4F3D"}})})]},ie)),b&&T&&l.jsxs("div",{className:"flex gap-3 justify-start",children:[l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsx("div",{className:"max-w-[80%] sm:max-w-[70%] bg-white rounded-2xl px-4 py-3 shadow-sm",style:{border:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"whitespace-pre-wrap break-words text-sm sm:text-base leading-relaxed",style:{color:"#2C2416"},children:[T,l.jsx("span",{className:"inline-block w-1 h-4 ml-1 animate-pulse",style:{backgroundColor:"#8B7355"}})]})})]}),f&&!b&&l.jsxs("div",{className:"flex gap-3 justify-start",children:[l.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md",style:{backgroundColor:"#8B7355"},children:l.jsx(LO,{className:"w-5 h-5 text-white"})}),l.jsx("div",{className:"bg-white rounded-2xl px-4 py-3 shadow-sm",style:{border:"1px solid #E5DFD3"},children:l.jsxs("div",{className:"flex items-center gap-2",style:{color:"#5C4F3D"},children:[l.jsx(my,{className:"w-4 h-4 animate-spin",style:{color:"#8B7355"}}),l.jsx("span",{className:"text-sm",children:"Analyzing your question..."})]})})]}),l.jsx("div",{ref:U})]}),l.jsx("div",{className:"fixed bottom-20 md:bottom-0 left-0 right-0 flex justify-center items-center px-3 md:px-6 py-3 md:py-4",style:{backgroundColor:"#F5F1EA",zIndex:40},children:l.jsxs("form",{onSubmit:z,className:"w-full md:max-w-2xl flex gap-2 md:gap-3 items-end",children:[l.jsxs("div",{className:"flex-1 relative",children:[l.jsx("input",{type:"text",value:d,onChange:Z=>p(Z.target.value),placeholder:"Ask about your health...",className:"w-full px-4 py-2.5 md:py-3 pr-10 bg-white rounded-full focus:outline-none focus:ring-2 transition-all text-sm md:text-base shadow-md hover:shadow-lg",style:{border:"1.5px solid #E5DFD3",color:"#2C2416"},onFocus:Z=>{Z.target.style.borderColor="#8B7355",Z.target.style.boxShadow="0 4px 16px rgba(139, 115, 85, 0.2)"},onBlur:Z=>{Z.target.style.borderColor="#E5DFD3",Z.target.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.08)"},disabled:f||b}),d&&l.jsx("button",{type:"button",onClick:()=>p(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-lg hover:opacity-70 transition-opacity",style:{color:"#5C4F3D"},children:""})]}),l.jsx("button",{type:"submit",disabled:!d.trim()||f||b,className:"px-4 md:px-5 py-2.5 md:py-3 text-white rounded-full font-medium hover:shadow-lg hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-1 md:gap-2 flex-shrink-0 text-sm md:text-base shadow-md",style:{backgroundColor:"#8B7355"},title:d.trim()?"Send message":"Type a message first",children:f||b?l.jsx(my,{className:"w-4 md:w-5 h-4 md:h-5 animate-spin"}):l.jsxs(l.Fragment,{children:[l.jsx(Bf,{className:"w-4 md:w-5 h-4 md:h-5"}),l.jsx("span",{className:"hidden sm:inline",children:"Send"})]})})]})})]})}function _Ke(){const{user:e}=ma(),[n,a]=q.useState(!0),[o,d]=q.useState(!1),[p,f]=q.useState([]),[v,b]=q.useState(null),[E,T]=q.useState(null),[w,N]=q.useState(!1),[P,A]=q.useState(null),[k,I]=q.useState(null),[F,U]=q.useState(null),[V,W]=q.useState([]),[B,z]=q.useState(""),[Y,re]=q.useState(()=>{const Ye=localStorage.getItem("quickCheckResult");return Ye?JSON.parse(Ye):null}),[Z,ie]=q.useState(!1),[te,de]=q.useState(null),[xe,me]=q.useState(null),[Ce,ue]=q.useState(!1),[be,se]=q.useState(""),[pe,De]=q.useState(new Date().toISOString().split("T")[0]),[Se,we]=q.useState("breakfast"),[qe,lt]=q.useState(""),[Ut,Ht]=q.useState(null),[Ue,dt]=q.useState(null),[Ne,Ke]=q.useState(null);q.useEffect(()=>{bt()},[pe]);const bt=async()=>{try{const St={Authorization:`Bearer ${localStorage.getItem("token")}`},Dn=new Date().toISOString().split("T")[0],ni=pe===Dn,[ka,Zi,gr]=await Promise.all([ni?Mn.get("/api/nutrition/logs/today",{headers:St}):Mn.get(`/api/nutrition/logs?startDate=${pe}&endDate=${pe}`,{headers:St}),Mn.get(`/api/nutrition/summary/daily?date=${pe}`,{headers:St}),Mn.get("/api/nutrition/goals",{headers:St}).catch(()=>({data:{healthGoal:null}}))]);f(ka.data.foodLogs||[]),b(Zi.data.summary),T(gr.data.healthGoal);try{const Xr=await Mn.get("/api/nutrition/activity/week",{headers:St});W(Xr.data.weekData||[])}catch{console.log("Activity data not available"),W([])}}catch(Ye){console.error("Failed to fetch data:",Ye),it.error("Failed to load nutrition data")}finally{a(!1)}},Te=Ye=>{const St=Ye.target.files[0];if(St){Ht(St);const Dn=new FileReader;Dn.onloadend=()=>{dt(Dn.result)},Dn.readAsDataURL(St)}},gt=async()=>{if(!qe&&!Ut){it.error("Please provide food description or image");return}d(!0);try{const Ye=localStorage.getItem("token");let St=null;if(Ut){const ni=new FileReader;St=await new Promise(ka=>{ni.onloadend=()=>{const Zi=ni.result.split(",")[1];ka(Zi)},ni.readAsDataURL(Ut)})}const Dn=await Mn.post("/api/nutrition/analyze-food",{foodDescription:qe||void 0,imageBase64:St,additionalContext:qe||void 0},{headers:{Authorization:`Bearer ${Ye}`}});Ke(Dn.data.analysis),it.success("Food analyzed successfully!")}catch(Ye){console.error("Analysis error:",Ye),it.error("Failed to analyze food")}finally{d(!1)}},Qe=async()=>{if(!Ne){it.error("Please analyze food first");return}try{const Ye=localStorage.getItem("token");await Mn.post("/api/nutrition/log-meal",{mealType:Se,foodItems:Ne.foodItems,imageUrl:Ue,notes:qe},{headers:{Authorization:`Bearer ${Ye}`}}),it.success("Meal logged successfully!"),N(!1),At(),bt()}catch(Ye){console.error("Log meal error:",Ye),it.error("Failed to log meal")}},Ft=async Ye=>{if(confirm("Delete this meal?"))try{const St=localStorage.getItem("token");await Mn.delete(`/api/nutrition/logs/${Ye}`,{headers:{Authorization:`Bearer ${St}`}}),it.success("Meal deleted"),bt()}catch(St){console.error("Delete error:",St),it.error("Failed to delete meal")}},At=()=>{we("breakfast"),lt(""),Ht(null),dt(null),Ke(null)},ye=Ye=>{I(Ye._id),U({mealType:Ye.mealType,foodDescription:Ye.foodItems.map(St=>`${St.name} (${St.quantity})`).join(", "),totalCalories:Ye.totalNutrition.calories,totalProtein:Ye.totalNutrition.protein,totalCarbs:Ye.totalNutrition.carbs,totalFats:Ye.totalNutrition.fats})},et=async()=>{if(F)try{const Ye=localStorage.getItem("token");await Mn.put(`/api/nutrition/logs/${k}`,{mealType:F.mealType,notes:F.foodDescription},{headers:{Authorization:`Bearer ${Ye}`}}),it.success("Meal updated successfully!"),I(null),U(null),bt()}catch(Ye){console.error("Update error:",Ye),it.error("Failed to update meal")}},zt=Ye=>{const St=Ye.target.files[0];if(St){de(St);const Dn=new FileReader;Dn.onloadend=()=>{me(Dn.result)},Dn.readAsDataURL(St)}},ui=Ye=>{const St=Ye.toLowerCase();return/\d+/.test(St)||St.includes("bowl")||St.includes("plate")||St.includes("cup")||St.includes("glass")||St.includes("slice")||St.includes("piece")||St.includes("gram")||St.includes("kg")||St.includes("ml")||St.includes("litre")?{show:!1,unit:"",examples:""}:["juice","milk","water","tea","coffee","smoothie","shake","lassi","buttermilk","soup","dal","curry","gravy","kadhi","rasam","sambhar"].some(Xr=>St.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 250ml, 1 glass, 2 cups"}:["pizza","bread","toast","cake","pie","sandwich","paratha","naan"].some(Xr=>St.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 2 slices, 1 piece"}:["rice","roti","chapati","chicken","fish","meat","paneer","vegetables","salad","pasta","noodles","biryani","pulao","khichdi"].some(Xr=>St.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 100g, 1 bowl, 1 plate"}:["egg","banana","apple","orange","samosa","pakora","biscuit","cookie","idli","dosa","vada","gulab jamun","ladoo"].some(Xr=>St.includes(Xr))?{show:!0,examples:" Add quantity: e.g., 2 pieces, 1 banana"}:{show:!0,examples:" Add quantity for accurate results: e.g., 100g, 1 bowl, 2 pieces, 250ml"}},fa=Ye=>{const St=Ye.target.value;if(z(St),St.length>=3){const Dn=ui(St);ue(Dn.show),se(Dn.examples)}else ue(!1),se("")},Da=async()=>{var Ye,St;if(!B.trim()&&!te){it.error("Please enter a food item or upload an image");return}ie(!0);try{const Dn=localStorage.getItem("token");let ni=null;if(te)try{const gr=new FileReader;ni=await new Promise((Xr,lu)=>{gr.onloadend=()=>{const du=gr.result.split(",")[1];Xr(du)},gr.onerror=lu,gr.readAsDataURL(te)})}catch(gr){console.error("Image read error:",gr),it.error("Failed to read image file"),ie(!1);return}const Zi=(await Mn.post("/api/nutrition/quick-check",{foodDescription:B||void 0,imageBase64:ni,additionalContext:B||void 0},{headers:{Authorization:`Bearer ${Dn}`}})).data;re(Zi),localStorage.setItem("quickCheckResult",JSON.stringify(Zi)),it.success("Food analyzed!"),ue(!1)}catch(Dn){console.error("Quick check error:",Dn);const ni=((St=(Ye=Dn.response)==null?void 0:Ye.data)==null?void 0:St.message)||Dn.message||"Failed to analyze food";it.error(ni)}finally{ie(!1)}},oc=()=>{re(null),z(""),de(null),me(null),localStorage.removeItem("quickCheckResult")};if(n)return l.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:l.jsx(my,{className:"w-8 h-8 animate-spin text-cyan-500"})});const nt=(v==null?void 0:v.caloriePercentage)||0,Lt=(v==null?void 0:v.proteinPercentage)||0,fr=(v==null?void 0:v.carbsPercentage)||0,Wn=(v==null?void 0:v.fatsPercentage)||0;return l.jsxs("div",{className:"space-y-6 animate-fade-in w-full overflow-x-hidden",children:[l.jsxs("div",{className:"bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-[#E5DFD3] w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:"Your Activity"}),l.jsxs("div",{className:"flex items-center gap-1 text-sm md:text-base text-[#5C4F3D] bg-[#F5F1EA] px-2 md:px-3 py-2 rounded-lg cursor-pointer hover:bg-[#E5DFD3] flex-shrink-0",children:[l.jsx(ji,{className:"w-4 h-4 flex-shrink-0"}),l.jsx("input",{type:"date",value:pe,onChange:Ye=>De(Ye.target.value),className:"bg-transparent text-xs md:text-sm text-[#2C2416] cursor-pointer outline-none w-24 md:w-32"})]})]}),v&&E?l.jsxs("div",{className:"bg-gradient-to-br from-[#E8F5E9] to-[#C8E6C9] rounded-2xl p-4 md:p-6 mb-4 w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[l.jsx(ir,{className:"w-5 h-5 text-[#2E7D32]"}),l.jsx("span",{className:"text-sm md:text-base font-medium text-[#2E7D32]",children:"Daily Intake"})]}),l.jsxs("div",{className:"md:hidden flex flex-col items-center gap-6 w-full",children:[l.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#2E7D32",strokeWidth:"3",strokeDasharray:`${Math.min(nt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-lg font-bold text-[#1B5E20]",children:v.totalCalories}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"kcal"})]})]}),l.jsxs("div",{className:"w-full space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Protein"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[v.totalProtein.toFixed(2),"/",E.macroTargets.protein,"g"]})]}),l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Carbs"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[v.totalCarbs.toFixed(2),"/",E.macroTargets.carbs,"g"]})]}),l.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full flex-shrink-0"}),l.jsx("span",{className:"text-xs text-[#2E7D32] truncate",children:"Fats"})]}),l.jsxs("span",{className:"text-xs font-bold text-[#1B5E20] flex-shrink-0 whitespace-nowrap",children:[v.totalFats.toFixed(2),"/",E.macroTargets.fats,"g"]})]})]})]}),l.jsxs("div",{className:"hidden md:grid md:grid-cols-5 gap-3 w-full items-center",children:[l.jsxs("div",{className:"col-span-1 flex flex-col items-center",children:[l.jsxs("div",{className:"relative w-28 h-28 flex-shrink-0 mb-2",children:[l.jsxs("svg",{className:"w-28 h-28 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(46, 125, 50, 0.2)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#2E7D32",strokeWidth:"3",strokeDasharray:`${Math.min(nt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-xl font-bold text-[#1B5E20]",children:v.totalCalories}),l.jsx("span",{className:"text-[10px] text-[#2E7D32]",children:"kcal"})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D] font-medium",children:"Consumed"}),l.jsxs("p",{className:"text-xs text-[#2E7D32] font-semibold",children:["of ",E.dailyCalorieTarget||2e3]})]})]}),l.jsxs("div",{className:"col-span-1 flex flex-col items-center",children:[l.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0 mb-2",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(239, 68, 68, 0.2)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#EF4444",strokeWidth:"3",strokeDasharray:`${Math.min(Lt,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-sm font-bold text-[#1B5E20]",children:v.totalProtein.toFixed(0)}),l.jsx("span",{className:"text-[9px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D] font-medium",children:"Protein"}),l.jsxs("p",{className:"text-xs text-[#2E7D32] font-semibold",children:["/",E.macroTargets.protein,"g"]})]})]}),l.jsxs("div",{className:"col-span-1 flex flex-col items-center",children:[l.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0 mb-2",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(249, 115, 22, 0.2)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#F97316",strokeWidth:"3",strokeDasharray:`${Math.min(fr,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-sm font-bold text-[#1B5E20]",children:v.totalCarbs.toFixed(0)}),l.jsx("span",{className:"text-[9px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D] font-medium",children:"Carbs"}),l.jsxs("p",{className:"text-xs text-[#2E7D32] font-semibold",children:["/",E.macroTargets.carbs,"g"]})]})]}),l.jsxs("div",{className:"col-span-1 flex flex-col items-center",children:[l.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0 mb-2",children:[l.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 36 36",children:[l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"rgba(59, 130, 246, 0.2)",strokeWidth:"3"}),l.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"#3B82F6",strokeWidth:"3",strokeDasharray:`${Math.min(Wn,100)}, 100`,strokeLinecap:"round"})]}),l.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[l.jsx("span",{className:"text-sm font-bold text-[#1B5E20]",children:v.totalFats.toFixed(0)}),l.jsx("span",{className:"text-[9px] text-[#2E7D32]",children:"g"})]})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D] font-medium",children:"Fats"}),l.jsxs("p",{className:"text-xs text-[#2E7D32] font-semibold",children:["/",E.macroTargets.fats,"g"]})]})]}),l.jsxs("div",{className:"col-span-1 flex flex-col gap-2 pl-2 border-l-2 border-[#E5DFD3]",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),l.jsx("span",{className:"text-xs text-[#2E7D32]",children:"Protein"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),l.jsx("span",{className:"text-xs text-[#2E7D32]",children:"Carbs"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),l.jsx("span",{className:"text-xs text-[#2E7D32]",children:"Fats"})]})]})]})]}):l.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:l.jsxs("div",{className:"flex items-start gap-3",children:[l.jsx(Lh,{className:"w-5 h-5 text-amber-600 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-amber-900 mb-1",children:"Set Your Health Goal"}),l.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Set your health goals to get personalized calorie and macro targets."}),l.jsx(hn,{to:"/profile",className:"inline-block px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 text-sm font-medium",children:"Set Goals Now"})]})]})}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full",children:[l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-[#E5DFD3] overflow-hidden",children:[l.jsx("h3",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-1",children:"Activity"}),l.jsx("p",{className:"text-xs text-[#5C4F3D] mb-3",children:"Last 7 days calorie intake"}),l.jsx("div",{className:"flex items-end gap-1 mb-3 justify-center md:justify-start h-20",children:V&&V.length>0?V.map((Ye,St)=>{var gr;const Dn=new Date(Ye.date).toDateString()===new Date().toDateString(),ni=((gr=E==null?void 0:E.macroTargets)==null?void 0:gr.calories)||(E==null?void 0:E.dailyCalorieTarget)||2e3,ka=Math.max(...V.map(Xr=>Xr.calories||0),ni),Zi=Ye.calories/ka*100;return l.jsx("div",{className:`flex-1 rounded-t transition-all group relative cursor-pointer ${Dn?"bg-[#2E7D32]":"bg-[#8B7355]"}`,style:{height:`${Math.max(Zi,10)}%`},title:`${new Date(Ye.date).toLocaleDateString("en-US",{weekday:"short"})}: ${Ye.calories} kcal`,children:l.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-[#2C2416] text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:[Ye.calories," kcal"]})},St)}):l.jsx("div",{className:"w-full flex items-center justify-center text-[#5C4F3D] text-sm",children:"No data available"})}),l.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[l.jsx("span",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:(v==null?void 0:v.totalCalories)||0}),l.jsx("span",{className:"text-sm md:text-base text-[#5C4F3D]",children:"Kcal (Today)"}),l.jsx(Ca,{className:"w-4 h-4 text-[#2E7D32]"})]})]}),l.jsxs("div",{className:"bg-white rounded-xl p-4 border border-[#E5DFD3] overflow-hidden",children:[l.jsx("h3",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-3",children:"Meals Summary"}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D] mb-3",children:"Logged meals today"}),l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[p.length===0?l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"No meals logged yet"}):l.jsxs(l.Fragment,{children:[p.slice(0,3).map((Ye,St)=>l.jsxs("div",{className:"group relative",children:[l.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center text-white text-xs font-bold cursor-pointer hover:shadow-lg transition-shadow",children:Ye.mealType.charAt(0).toUpperCase()}),l.jsxs("div",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-[#2C2416] text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:[Ye.mealType,": ",Ye.totalNutrition.calories," cal"]})]},St)),p.length>3&&l.jsxs("div",{className:"text-xs text-[#5C4F3D] font-medium",children:["+",p.length-3]})]}),l.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-[#8B7355] text-white flex items-center justify-center text-lg md:text-xl font-medium hover:bg-[#A0826D] transition-colors",title:"Add new meal",children:"+"})]})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-3 md:p-6 shadow-sm border border-[#E5DFD3] w-full overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Fy,{className:"w-5 h-5 text-[#5C4F3D]"}),l.jsx("h2",{className:"text-lg md:text-xl font-semibold text-[#2C2416]",children:"Quick Food Check"})]}),Y&&l.jsx("button",{onClick:oc,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"Clear"})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"text",value:B,onChange:fa,onKeyPress:Ye=>Ye.key==="Enter"&&Da(),placeholder:"E.g., Pizza, 2 slices or Milk, 250ml",className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base"}),Ce&&be&&l.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 p-3 bg-blue-50 border-2 border-blue-200 rounded-xl shadow-lg z-10",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(py,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),l.jsx("p",{className:"text-xs md:text-sm text-blue-700",children:be})]})})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-[#E5DFD3] rounded-xl hover:border-[#8B7355] cursor-pointer transition-colors",children:[l.jsx(s2,{className:"w-5 h-5 text-[#5C4F3D]"}),l.jsx("span",{className:"text-sm text-[#5C4F3D] hidden md:inline",children:te?"Image Selected ":"Photo"}),l.jsx("span",{className:"text-xs text-[#5C4F3D] md:hidden",children:te?"Image ":"Photo"}),l.jsx("input",{type:"file",accept:"image/*",onChange:zt,className:"hidden"})]}),l.jsxs("button",{onClick:Da,disabled:Z,className:"px-6 py-3 bg-[#8B7355] text-white rounded-xl font-medium hover:bg-[#A0826D] disabled:opacity-50 flex items-center gap-2 text-sm md:text-base",children:[Z?l.jsx(my,{className:"w-5 h-5 animate-spin"}):l.jsx(Hd,{className:"w-5 h-5"}),Z?"Checking...":"Check"]})]}),xe&&l.jsxs("div",{className:"relative",children:[l.jsx("img",{src:xe,alt:"Food preview",className:"w-full h-40 md:h-48 object-cover rounded-xl"}),l.jsx("button",{onClick:()=>{de(null),me(null)},className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600",children:l.jsx(SP,{className:"w-3 h-3"})})]})]}),Y&&l.jsxs("div",{className:"mt-4 bg-gray-50 rounded-xl p-4 md:p-6 space-y-4",children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-lg md:text-xl text-slate-800",children:Y.foodItem.name}),l.jsx("p",{className:"text-sm md:text-base text-slate-600",children:Y.foodItem.quantity})]}),l.jsx("div",{className:`px-3 py-1 rounded-full text-xs md:text-sm font-medium ${Y.isHealthy?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Y.isHealthy?" Healthy":" Unhealthy"})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(Bx,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-orange-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Calories"}),l.jsx("p",{className:"text-base md:text-lg font-bold text-slate-800",children:Y.foodItem.nutrition.calories})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(ir,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-blue-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Protein"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[Y.foodItem.nutrition.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(nc,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-green-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Carbs"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[Y.foodItem.nutrition.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center",children:[l.jsx(qw,{className:"w-5 h-5 md:w-6 md:h-6 mx-auto mb-2 text-purple-500"}),l.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Fats"}),l.jsxs("p",{className:"text-base md:text-lg font-bold text-slate-800",children:[Y.foodItem.nutrition.fats,"g"]})]})]}),l.jsx("div",{className:"bg-white p-3 md:p-4 rounded-lg",children:l.jsx("p",{className:"text-sm md:text-base text-slate-700",children:Y.analysis})}),Y.warnings&&Y.warnings.length>0&&l.jsx("div",{className:"bg-red-50 p-3 md:p-4 rounded-lg border border-red-200",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(Aa,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-red-900 mb-2",children:"Warnings:"}),l.jsx("ul",{className:"text-sm md:text-base text-red-700 space-y-1",children:Y.warnings.map((Ye,St)=>l.jsxs("li",{children:[" ",Ye]},St))})]})]})}),Y.alternatives&&Y.alternatives.length>0&&l.jsxs("div",{className:"bg-green-50 p-3 md:p-4 rounded-lg border border-green-200",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(py,{className:"w-5 h-5 text-green-600"}),l.jsx("h4",{className:"text-sm md:text-base font-semibold text-green-900",children:"Healthier Alternatives"})]}),l.jsx("div",{className:"space-y-3",children:Y.alternatives.map((Ye,St)=>l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-green-900",children:Ye.name}),l.jsx("p",{className:"text-xs md:text-sm text-green-700",children:Ye.description})]}),l.jsxs("p",{className:"text-xs md:text-sm font-medium text-green-900",children:[Ye.nutrition.calories," cal"]})]}),l.jsxs("div",{className:"flex gap-3 text-xs md:text-sm text-green-700 mb-2",children:[l.jsxs("span",{children:["P: ",Ye.nutrition.protein,"g"]}),l.jsxs("span",{children:["C: ",Ye.nutrition.carbs,"g"]}),l.jsxs("span",{children:["F: ",Ye.nutrition.fats,"g"]})]}),l.jsxs("p",{className:"text-xs md:text-sm text-green-600",children:[" ",Ye.benefits]})]},St))})]})]})]}),l.jsxs("div",{className:"bg-white rounded-2xl p-4 md:p-6 shadow-sm border border-[#E5DFD3] overflow-hidden w-full",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-lg md:text-xl font-semibold text-[#2C2416]",children:"Recently logged"}),l.jsx("button",{onClick:()=>N(!0),className:"p-2 bg-[#8B7355] text-white rounded-full hover:bg-[#A0826D] flex-shrink-0",children:l.jsx(Wc,{className:"w-5 h-5"})})]}),p.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(nc,{className:"w-12 h-12 text-[#E5DFD3] mx-auto mb-3"}),l.jsx("p",{className:"text-[#5C4F3D] mb-3",children:"No meals logged today"}),l.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-[#8B7355] text-white rounded-lg hover:bg-[#A0826D] text-sm",children:"Log Your First Meal"})]}):l.jsx("div",{className:"space-y-3 overflow-x-hidden",children:p.map(Ye=>{var St;return l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 p-3 md:p-4 bg-[#F5F1EA] rounded-xl hover:bg-[#E5DFD3] transition-colors overflow-hidden",children:[l.jsx("div",{className:"w-14 h-14 md:w-20 md:h-20 bg-gradient-to-br from-orange-400 to-red-500 rounded-xl flex-shrink-0"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h3",{className:"font-medium text-sm md:text-base text-[#2C2416] capitalize truncate",children:((St=Ye.foodItems[0])==null?void 0:St.name)||Ye.mealType}),l.jsxs("div",{className:"flex items-center gap-2 md:gap-3 text-[10px] md:text-xs text-[#5C4F3D] mt-1 overflow-x-auto",children:[l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),l.jsxs("span",{children:[Ye.totalNutrition.protein,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full"}),l.jsxs("span",{children:[Ye.totalNutrition.carbs,"g"]})]}),l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),l.jsxs("span",{children:[Ye.totalNutrition.fats,"g"]})]})]})]}),l.jsxs("div",{className:"text-right flex-shrink-0",children:[l.jsx("p",{className:"text-sm md:text-base font-semibold text-[#2C2416]",children:Ye.totalNutrition.calories}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"kcal"})]}),l.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[l.jsx("button",{onClick:()=>ye(Ye),className:"p-1.5 md:p-2 text-[#5C4F3D] hover:text-[#8B7355] rounded-lg hover:bg-white transition-colors",title:"Edit meal",children:l.jsx(ETe,{className:"w-4 h-4"})}),l.jsx("button",{onClick:()=>Ft(Ye._id),className:"p-1.5 md:p-2 text-[#5C4F3D] hover:text-red-600 rounded-lg hover:bg-red-50 transition-colors",title:"Delete meal",children:l.jsx(SP,{className:"w-4 h-4"})})]})]},Ye._id)})})]}),l.jsx("div",{className:"h-6 md:h-0"}),k&&F&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-50 overflow-hidden",onClick:()=>I(null),children:l.jsxs("div",{className:"bg-white rounded-t-2xl md:rounded-2xl w-full md:max-w-2xl h-[70vh] md:h-auto md:max-h-[75vh] flex flex-col",onClick:Ye=>Ye.stopPropagation(),children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 p-4 md:p-6",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold text-[#2C2416]",children:"Edit Meal"}),l.jsx("button",{onClick:()=>I(null),className:"text-[#5C4F3D] hover:text-[#2C2416] text-2xl flex-shrink-0",children:""})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 md:pr-0 p-4 md:p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Meal Type"}),l.jsxs("select",{value:F.mealType,onChange:Ye=>U({...F,mealType:Ye.target.value}),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base",children:[l.jsx("option",{value:"breakfast",children:"Breakfast"}),l.jsx("option",{value:"lunch",children:"Lunch"}),l.jsx("option",{value:"dinner",children:"Dinner"}),l.jsx("option",{value:"snack",children:"Snack"})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Food Items"}),l.jsx("textarea",{value:F.foodDescription,onChange:Ye=>U({...F,foodDescription:Ye.target.value}),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none resize-none text-sm md:text-base",rows:"3"})]}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Calories"}),l.jsx("p",{className:"text-lg font-bold text-[#2C2416]",children:F.totalCalories})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Protein"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalProtein,"g"]})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Carbs"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalCarbs,"g"]})]}),l.jsxs("div",{className:"bg-[#F5F1EA] p-3 rounded-lg",children:[l.jsx("p",{className:"text-xs text-[#5C4F3D]",children:"Fats"}),l.jsxs("p",{className:"text-lg font-bold text-[#2C2416]",children:[F.totalFats,"g"]})]})]})]}),l.jsxs("div",{className:"flex-shrink-0 border-t border-[#E5DFD3] pt-4 mt-4 gap-3 flex p-4 md:p-6 bg-white",children:[l.jsx("button",{onClick:et,className:"flex-1 px-6 py-3 bg-[#2E7D32] text-white rounded-xl font-medium hover:bg-[#1B5E20] text-sm md:text-base",children:"Save Changes"}),l.jsx("button",{onClick:()=>I(null),className:"flex-1 px-6 py-3 bg-[#E5DFD3] text-[#2C2416] rounded-xl font-medium hover:bg-[#D4CFC3] text-sm md:text-base",children:"Cancel"})]})]})}),w&&l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-end md:items-center justify-center z-50 overflow-hidden",onClick:()=>N(!1),children:l.jsxs("div",{className:"bg-white rounded-t-2xl md:rounded-2xl w-full md:max-w-2xl h-[70vh] md:h-auto md:max-h-[75vh] flex flex-col",onClick:Ye=>Ye.stopPropagation(),children:[l.jsxs("div",{className:"flex items-center justify-between mb-4 flex-shrink-0 p-4 md:p-6",children:[l.jsx("h2",{className:"text-xl md:text-2xl font-bold text-[#2C2416]",children:"Add Meal"}),l.jsx("button",{onClick:()=>N(!1),className:"text-[#5C4F3D] hover:text-[#2C2416] text-2xl flex-shrink-0",children:""})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 md:pr-0 p-4 md:p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Meal Type"}),l.jsxs("select",{value:Se,onChange:Ye=>we(Ye.target.value),className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none text-sm md:text-base",children:[l.jsx("option",{value:"breakfast",children:"Breakfast"}),l.jsx("option",{value:"lunch",children:"Lunch"}),l.jsx("option",{value:"dinner",children:"Dinner"}),l.jsx("option",{value:"snack",children:"Snack"})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"What did you eat?"}),l.jsx("textarea",{value:qe,onChange:Ye=>lt(Ye.target.value),placeholder:"E.g., 2 eggs, 2 slices of whole wheat toast, 1 banana",className:"w-full px-4 py-3 border-2 border-[#E5DFD3] rounded-xl focus:border-[#8B7355] focus:outline-none resize-none text-sm md:text-base",rows:"3"})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-sm md:text-base font-medium text-[#2C2416] mb-2",children:"Or upload a photo"}),l.jsxs("label",{className:"flex items-center justify-center gap-2 px-4 py-6 border-2 border-dashed border-[#E5DFD3] rounded-xl hover:border-[#8B7355] cursor-pointer transition-colors",children:[l.jsx(lo,{className:"w-6 h-6 text-[#5C4F3D]"}),l.jsx("span",{className:"text-[#5C4F3D] text-sm md:text-base",children:"Upload Image"}),l.jsx("input",{type:"file",accept:"image/*",onChange:Te,className:"hidden"})]}),Ue&&l.jsx("div",{className:"mt-3",children:l.jsx("img",{src:Ue,alt:"Food",className:"w-full h-48 object-cover rounded-xl"})})]}),Ne&&l.jsxs("div",{className:"border-2 border-[#2E7D32] rounded-xl p-4 md:p-6 bg-[#E8F5E9] mb-4",children:[l.jsx("h3",{className:"font-semibold text-lg md:text-xl text-[#1B5E20] mb-4",children:"Nutrition Breakdown"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Calories"}),l.jsx("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:Ne.totalNutrition.calories})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Protein"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Ne.totalNutrition.protein,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Carbs"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Ne.totalNutrition.carbs,"g"]})]}),l.jsxs("div",{className:"bg-white p-3 md:p-4 rounded-lg text-center border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:"Fats"}),l.jsxs("p",{className:"text-lg md:text-xl font-bold text-[#2C2416]",children:[Ne.totalNutrition.fats,"g"]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg mb-4 border border-[#E5DFD3]",children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-[#2C2416] mb-3",children:"Detected Items:"}),l.jsx("div",{className:"space-y-2",children:Ne.foodItems.map((Ye,St)=>l.jsxs("div",{className:"border-l-4 border-[#8B7355] pl-3 py-2",children:[l.jsxs("div",{className:"flex items-start justify-between mb-1",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm md:text-base font-medium text-[#2C2416]",children:Ye.name}),l.jsx("p",{className:"text-xs md:text-sm text-[#5C4F3D]",children:Ye.quantity})]}),l.jsxs("p",{className:"text-sm md:text-base font-bold text-[#2C2416]",children:[Ye.nutrition.calories," cal"]})]}),l.jsxs("div",{className:"flex gap-3 text-xs md:text-sm text-[#5C4F3D]",children:[l.jsxs("span",{children:["P: ",Ye.nutrition.protein,"g"]}),l.jsxs("span",{children:["C: ",Ye.nutrition.carbs,"g"]}),l.jsxs("span",{children:["F: ",Ye.nutrition.fats,"g"]})]})]},St))})]})]})]}),l.jsxs("div",{className:"flex-shrink-0 border-t border-[#E5DFD3] pt-4 mt-4 space-y-3 p-4 md:p-6 bg-white",children:[l.jsx("button",{onClick:gt,disabled:o||!qe&&!Ut,className:"w-full px-6 py-4 bg-gradient-to-r from-[#8B7355] to-[#A0826D] text-white rounded-xl font-medium hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm md:text-base",children:o?l.jsxs(l.Fragment,{children:[l.jsx(my,{className:"w-5 h-5 animate-spin"}),"Analyzing..."]}):l.jsxs(l.Fragment,{children:[l.jsx(Hd,{className:"w-5 h-5"}),"Analyze with AI"]})}),Ne&&l.jsx("button",{onClick:Qe,className:"w-full px-6 py-3 bg-[#2E7D32] text-white rounded-xl font-medium hover:bg-[#1B5E20] text-sm md:text-base",children:"Log This Meal"})]})]})})]})}const ro=({children:e,allowedRoles:n})=>{const{user:a,loading:o}=ma();return o?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a?n&&!n.includes(a.role)?a.role==="admin"?l.jsx(Ss,{to:"/admin"}):a.role==="doctor"?l.jsx(Ss,{to:"/doctor/dashboard"}):l.jsx(Ss,{to:"/dashboard"}):e:l.jsx(Ss,{to:"/login"})},bKe=({children:e})=>{const{user:n,loading:a,isAdmin:o}=ma();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(Ss,{to:"/dashboard"}):l.jsx(Ss,{to:"/login"})},f1=({children:e})=>{const{user:n,loading:a,isDoctor:o}=ma();return a?l.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n?o()?e:l.jsx(Ss,{to:"/dashboard"}):l.jsx(Ss,{to:"/login"})};function EKe(){const{user:e,isAdmin:n,isDoctor:a}=ma(),o=()=>e?n()?l.jsx(Ss,{to:"/admin"}):a()?l.jsx(Ss,{to:"/doctor/dashboard"}):l.jsx(Ss,{to:"/dashboard"}):l.jsx(YTe,{});return l.jsxs(l.Fragment,{children:[l.jsx(jTe,{}),l.jsxs(bxe,{children:[l.jsx(Dr,{path:"/",element:l.jsx(KTe,{})}),l.jsx(Dr,{path:"/login",element:o()}),l.jsx(Dr,{path:"/register",element:e?l.jsx(Ss,{to:"/dashboard"}):l.jsx(qTe,{})}),l.jsx(Dr,{path:"/register/doctor",element:e?l.jsx(Ss,{to:"/doctor/dashboard"}):l.jsx(JTe,{})}),l.jsx(Dr,{path:"/dashboard",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(X7e,{})})})}),l.jsx(Dr,{path:"/upload",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(zze,{})})})}),l.jsx(Dr,{path:"/reports/:id",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(Yze,{})})})}),l.jsx(Dr,{path:"/doctors",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(Xze,{})})})}),l.jsx(Dr,{path:"/consultation/:appointmentId",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(dKe,{})})}),l.jsx(Dr,{path:"/consultation-summary/:appointmentId",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(uKe,{})})})}),l.jsx(Dr,{path:"/wearables",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(oKe,{})})})}),l.jsx(Dr,{path:"/nutrition",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(_Ke,{})})})}),l.jsx(Dr,{path:"/subscription",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(sKe,{})})})}),l.jsx(Dr,{path:"/diet-plan",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(vKe,{})})})}),l.jsx(Dr,{path:"/ai-chat",element:l.jsx(ro,{allowedRoles:["patient","client"],children:l.jsx(wa,{children:l.jsx(yKe,{})})})}),l.jsx(Dr,{path:"/doctor/dashboard",element:l.jsx(f1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(J7e,{})})})}),l.jsx(Dr,{path:"/doctor/availability",element:l.jsx(f1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(fKe,{})})})}),l.jsx(Dr,{path:"/patient/:patientId",element:l.jsx(f1,{children:l.jsx(wa,{isDoctor:!0,children:l.jsx(cKe,{})})})}),l.jsx(Dr,{path:"/profile",element:l.jsx(ro,{children:l.jsx(wa,{children:l.jsx(Jze,{})})})}),l.jsx(Dr,{path:"/admin",element:l.jsx(bKe,{children:l.jsx(wa,{isAdmin:!0,children:l.jsx(nKe,{})})})}),l.jsx(Dr,{path:"/demo",element:l.jsx(tKe,{})}),l.jsx(Dr,{path:"/video-test",element:l.jsx(hKe,{})}),l.jsx(Dr,{path:"/email-test",element:l.jsx(pKe,{})})]})]})}g1.createRoot(document.getElementById("root")).render(l.jsx(fe.StrictMode,{children:l.jsx(Rxe,{children:l.jsx(Qwe,{children:l.jsxs(eCe,{children:[l.jsx(EKe,{}),l.jsx(bSe,{position:"top-right"})]})})})}));
