================================================================================
VERCEL DEPLOYMENT - STEP BY STEP INSTRUCTIONS
================================================================================

WHAT WAS FIXED:
- Added buildCommand to vercel.json to rebuild client on every deployment
- Updated api/chat.js to use Claude models instead of GPT-4o
- Rebuilt client with latest UI changes
- Pushed all changes to GitHub (commit bf07019)

================================================================================
STEP 1: CLEAR VERCEL CACHE
================================================================================

1. Go to https://vercel.com/dashboard
2. Click on your project "AI-Diagnostic"
3. Go to "Settings" tab
4. Click on "Git" in the left sidebar
5. Find "Build Cache" section
6. Click "Clear Build Cache" button
7. Confirm the action

Expected Result: Cache cleared, ready for fresh build

================================================================================
STEP 2: TRIGGER REDEPLOY
================================================================================

Option A: Automatic (Recommended)
1. Go to Vercel Dashboard
2. Click "Deployments" tab
3. Find the latest deployment
4. Click the three dots menu
5. Select "Redeploy"
6. Confirm

Option B: Manual via Git
1. Make a small change to any file (e.g., add a comment)
2. Commit: git add -A && git commit -m "trigger rebuild"
3. Push: git push origin main
4. Vercel will automatically redeploy

Expected Result: New deployment starts with fresh build

================================================================================
STEP 3: MONITOR BUILD PROGRESS
================================================================================

1. Go to Vercel Dashboard
2. Click "Deployments" tab
3. Watch the latest deployment
4. Look for these stages:
   ✓ Building...
   ✓ Analyzing...
   ✓ Installing dependencies...
   ✓ Building client...
   ✓ Deploying...
   ✓ Build successful

Expected Result: Deployment completes with "✓ Build successful"

If you see errors:
- Click on the deployment to view logs
- Look for error messages
- Check if buildCommand ran: "cd client && npm install && npm run build"
- Verify environment variables are set

================================================================================
STEP 4: VERIFY ENVIRONMENT VARIABLES
================================================================================

1. Go to Vercel Dashboard
2. Select your project
3. Go to "Settings" tab
4. Click "Environment Variables" in left sidebar
5. Verify these are set:
   ✓ OPENROUTER_API_KEY (your API key)
   ✓ MONGODB_URI (database connection)
   ✓ JWT_SECRET (auth secret)
   ✓ NODE_ENV = production
   ✓ SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS
   ✓ AGORA_APP_ID, AGORA_APP_CERTIFICATE

If any are missing:
- Add them with correct values
- Redeploy after adding

Expected Result: All environment variables are set

================================================================================
STEP 5: TEST ON PRODUCTION
================================================================================

1. Go to your Vercel URL (e.g., https://ai-diagnostic-steel.vercel.app)
2. Hard refresh: Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)
3. Check the AI Chat page:
   ✓ New UI loads (centered input field, pill-shaped)
   ✓ Input field is sticky at bottom
   ✓ Messages display correctly
   ✓ Send a test message
   ✓ Verify Claude responds (not GPT-4o)
   ✓ Refresh page and verify message persists

If old UI still shows:
- Clear browser cache completely
- Try incognito/private window
- Check browser console (F12) for errors
- Verify Vercel deployment succeeded

Expected Result: New UI visible, all features working

================================================================================
STEP 6: VERIFY API FUNCTIONALITY
================================================================================

1. Open browser DevTools (F12)
2. Go to "Network" tab
3. Go to AI Chat page
4. Type a message and send
5. Look for "/api/chat" request
6. Check response:
   ✓ Status: 200 (success)
   ✓ Response contains "success": true
   ✓ Response contains AI response text
   ✓ No error messages

If API fails:
- Check status code (404, 500, etc.)
- Look at error message in response
- Verify OPENROUTER_API_KEY is set in Vercel
- Check Vercel logs for API errors

Expected Result: API requests succeed with 200 status

================================================================================
STEP 7: VERIFY CHAT PERSISTENCE
================================================================================

1. Go to AI Chat page
2. Send a few messages
3. Refresh the page (F5)
4. Check that messages are still there
5. Open DevTools (F12)
6. Go to "Application" tab
7. Click "Local Storage"
8. Look for key: "chat_history_[userId]"
9. Verify data is saved

Expected Result: Messages persist after refresh

================================================================================
STEP 8: FINAL VERIFICATION
================================================================================

Checklist:
☐ Vercel deployment shows "✓ Build successful"
☐ New UI loads on production
☐ Input field is centered and pill-shaped
☐ Input field is sticky at bottom
☐ AI Chat responds with Claude model
☐ Messages persist after refresh
☐ No errors in browser console
☐ API requests return 200 status
☐ Environment variables are set

If all checks pass: ✅ DEPLOYMENT SUCCESSFUL

================================================================================
TROUBLESHOOTING
================================================================================

Problem: Still seeing old UI
Solution:
1. Clear Vercel cache (Step 1)
2. Redeploy (Step 2)
3. Hard refresh browser (Ctrl+Shift+R)
4. Try incognito window
5. Check Vercel build logs

Problem: API returns 404 or 500
Solution:
1. Verify OPENROUTER_API_KEY is set in Vercel
2. Check Vercel build logs for errors
3. Verify api/chat.js is deployed
4. Check browser console for error details

Problem: Chat not persisting
Solution:
1. Check browser console for errors
2. Verify localStorage is enabled
3. Check DevTools > Application > Local Storage
4. Verify user is logged in

Problem: Build fails
Solution:
1. Check Vercel build logs
2. Look for error messages
3. Verify buildCommand: "cd client && npm install && npm run build"
4. Check if client/package.json exists
5. Verify all dependencies are installed

================================================================================
QUICK REFERENCE
================================================================================

Vercel Dashboard: https://vercel.com/dashboard
Your Project: https://vercel.com/dashboard/[your-project]
Production URL: https://ai-diagnostic-steel.vercel.app

Build Command: cd client && npm install && npm run build
Latest Commit: bf07019

Environment Variables to Set:
- OPENROUTER_API_KEY
- MONGODB_URI
- JWT_SECRET
- NODE_ENV=production

Files Modified:
- vercel.json (added buildCommand)
- api/chat.js (updated to Claude models)
- client/dist/ (rebuilt with latest code)

================================================================================
SUPPORT
================================================================================

If you encounter issues:
1. Check Vercel build logs
2. Review this guide's troubleshooting section
3. Verify all environment variables are set
4. Clear Vercel cache and redeploy
5. Check browser console for errors

Status: ✅ Ready for deployment
Date: January 29, 2026

================================================================================
